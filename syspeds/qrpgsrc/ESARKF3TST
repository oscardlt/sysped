     Ffak8      IF   E           K DISK
     FKODTGE    IF   E           K DISK
     FKODTG2    IF   E           K DISK
     FKODSAM    IF   E           K DISK
n01   * Sammenslåing av F-linjer baserer seg på SAMME varekode/tekst ELLER sammensl.kode/tekst
N01  D FLI             S             85    DIM(100)
      *
N01  D XN01            s              3  0
N01  D MaxXN           s              3  0
N01  D StrXN           s              3  0
n01  D                 DS
n01  D  FAVT                   1     20
n01  D    FAVT1                1      1
n01  D    FAVT2_20             2     20
n01  D                 DS
n01  D  GMDS                   1     84
n01  D    GM_SORT              1      3
n01  D    GM_SAMM              5      5
n01  D    GM_VT                7     47
n01  D    GM_MK               49     49
     D      GMDS_A             1     49
n01  D    GM_VAL              51     53
n01  D    GM_BELV             55     67  2
n01  D    GM_BELN             69     81  2
n01  D    GM_VK               83     85
n01  D                 DS
n01  D  NYDS                   1     84
n01  D    NY_SORT              1      3
n01  D    NY_SAMM              5      5
n01  D    NY_VT                7     47
n01  D    NY_MK               49     49
     D      NYDS_A             1     49
n01  D    NY_VAL              51     53
n01  D    NY_BELV             55     67  2
n01  D    NY_BELN             69     81  2
n01  D    NY_VK               83     85
      ***
     C     KGEKey        KLIST
     C                   KFLD                    KGEUNI
     C                   KFLD                    FAVK
     C                   MOVE      'GE'          KGEUNI
     C     KG2Key        KLIST
     C                   KFLD                    KG2UNI
     C                   KFLD                    FAVK
     C                   MOVE      'G2'          KG2UNI
     C     FakKey        KLIST
     C                   KFLD                    AVDN              4 0
     C                   KFLD                    OPDN              5 0
     C                   KFLD                    FAKNRN            7 0
      ***
     C                   z-add     1             AVDN              4 0
     C                   z-add     54430         OPDN              5 0
     C                   z-add     0283753       FAKNRN            7 0
      ***
     C                   MOVE      '  '          XSPRÅK            2
      ***
     C                   MOVE      *ZEROS        TOTFRI           13 2
     C                   MOVE      *ZEROS        TOTPLI           13 2
     C                   MOVE      *ZEROS        TOTN             13 2
     C                   MOVE      *ZEROS        TOTM             13 2
     C                   MOVE      *ZEROS        TOTB             13 2
     C     FAKKEY        SETLL     fak8
     C     FAKKEY        READE     fak8                                   33
     C     *in33         DOWEQ     '0'
     c     FASK          cabeq     'I'           NEXTFA
     c     FAKDA         cabeq     'K'           NEXTFA
     c     FAKDA         cabeq     'D'           NEXTFA
     c     FAOPKO        cabeq     'D'           NEXTFA
     c     FAOPKO        cabeq     ' '           NEXTFA
     C*                  exsr      Setrow
     C*                  callp     wrtsection('row')
N01  C                   exsr      SamSort
     C                   ADD       FABELN        TOTN
     C                   ADD       FABELN        TOTB
     C                   ADD       MOMS          TOTM
     C                   ADD       MOMS          TOTB
     C                   MOVE      FASK          XXSK              1
     C     NEXTFA        TAG
     C     FAKKEY        READE     fak8                                   33
     c                   end
      *
N01  c                   sorta     FLI
N01  c                   eval      strXn = 100 - MaxXn + 1                      5 lin: elem 96->
n01  C     strXN         DO        100           XN01
n01  C     FLI(XN01)     IFNE      *BLANKS
n01  C                   MOVE      FLI(XN01)     NYDS
N01  C**                 exsr      Setrow
N01  C**                 callp     wrtsection('row')
n01  C                   END
n01  C                   ENDDO
      *
     C                   eval      *inlr = *on
     C                   return
      *
n01   ***********************************************************
n01  C     SamSort       begsr
n01   ***********************************************************
      *
     C     FAKDM         IFEQ      'J'
     C                   ADD       FABELN        TOTPLI
     C     FABELN        MULT      0,25          MOMS             11 2
     c                   ELSE
     C                   ADD       FABELN        TOTFRI
     C                   MOVE      *ZEROS        MOMS
     c                   end
     C     FABELN        ADD       MOMS          BELB             11 2
      *
      * varetekst
     C     KG2Key        CHAIN     KODTG2                             33
     C     KGEKey        CHAIN     KODTGE                             33
N14  c     XSPRÅK        ifeq      'EN'
     C                   eval      NY_VT = KGEENT+' '+FAVT
     c                   else
     C                   eval      NY_VT = KGENOT+' '+FAVT
     c                   end
n01  c     FAVT1         ifeq      'X'
n01  C                   eval      NY_VT =  FAVT2_20
n01  c                   end
      *
      * sort/sammenslå
      * kriterium for sammenslåing  - IKKE FRITEKST
      *            A)  SAMME GEBYRKODE       / FRITEKST  / momskode,
      *  ELLER     B)  SAMME SAMMENSNL.KODE  / FRITEKST  / momskode,
      * SAMMENSLÅTTE LINJER KOMMER FØRST
      * DERETTER LINJER  MED SAM-KODE MEN SOM IKKES SLÅS SAMMEN PGA FRITEKST
      * DERETTER ANDRE LINJER BASERT PÅ SORT-KODE
     C                   MOVE      KG2SRT        NY_SORT
     C                   MOVE      FACD11        NY_SAMM
     C     NY_SAMM       IFNE      *BLANKS
     C     FAVT          IFNE      *BLANKS
     C                   MOVE      '  1'         NY_SORT
     C                   MOVE      *BLANKS       NY_SAMM
     C                   else
     C                   MOVE      '  2'         NY_SORT
     C     NY_SAMM       CHAIN     KODSAM                             33
N14  c  N33XSPRÅK        ifeq      'EN'
     C                   eval      NY_VT = SAENGE
     c                   else
     C                   eval      NY_VT = SANORS
     c                   end
     C                   END
     C                   END
      *
     C                   MOVE      FAKDM         NY_MK
     C                   MOVE      FAVAL         NY_VAL
     C                   MOVE      FABELV        NY_BELV
     C                   MOVE      FABELN        NY_BELN
     C                   MOVE      FAVK          NY_VK
      * slå sammen eller legg i første ledige
n01  C     1             DO        100           XN01              3 0
     C     FLI(XN01)     IFNE      *BLANKS
n01  C                   MOVE      FLI(XN01)     GMDS
     C     NYDS_A        IFEQ      GMDS_A
n01  C                   ADD       FABELV        GM_BELV
n01  C                   ADD       FABELN        GM_BELN
n01  C                   MOVE      GMDS          FLI(XN01)
     C                   LEAVE
     C                   END
     C                   ELSE
n01  C                   MOVE      NYDS          FLI(XN01)
N01  c                   z-add     XN01          MaxXN
     C                   LEAVE
     C                   END
n01  C                   ENDDO
n01   *
n01  C                   endsr
n01   *
      *
      *
