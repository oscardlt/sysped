********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 bruke riktig kurs og evt kunde tillegg frakt
********************************************************************
      *
N01  FKODTCC    IF   E           K DISK
     FFIRM      IF   E           K DISK
     FHEADF     IF   E           K DISK
     FFAKT      IF   E           K DISK
     F                                     RENAME(FAKTR:FAKTR0)
     FFAK5      UF A E           K DISK
     FVALUL01   IF   E           K DISK
     FKODTFR    IF   E           K DISK
     FKODTDIN   IF   E           K DISK
      *
N01  C     CCK1          KLIST
N01  C                   KFLD                    FIFIRM
N01  C                   KFLD                    XKUNR
     C     OVKEY         KLIST
     C                   KFLD                    UONO
     C                   KFLD                    ULNO
      *
     C     HEADFK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
      *
     C     FAKTK         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    YLI
     C                   Z-ADD     99999         YLI               5 0
      *
     C     FAK5K         KLIST
     C                   KFLD                    YOPKO             1
     C                   KFLD                    XSK               1
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
      *
     C     KODVAK        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    UCURC
      *
     C     KODV2K        KLIST
     C                   KFLD                    FIFIRM
     C*                    KFLD           FAVAL
     C                   KFLD                    XVAL
      *
     C     KODFRK        KLIST
     C                   KFLD                    KFRUNI
     C                   KFLD                    HEFR
     C     KODDIK        KLIST
     C                   KFLD                    XDIUNI
      *
     C     *ENTRY        PLIST
     C                   PARM                    UONO              7 0
     C                   PARM                    ULNO              3 0
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD              7 0
     C                   PARM                    UFEEC             3
     C                   PARM                    UCURC             3
     C                   PARM                    UAMT             11 2
     C                   PARM                    UVAT              1
      *
     C     UAVD          CABEQ     0             SLUTT
      *
      * ---------------------------------------------------------------
     C                   MOVE      'FR'          KFRUNI
     C                   MOVE      'DINNF'       XDIUNI            5
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
     C     HEADFK        CHAIN     HEADF                              33
     C     KODFRK        CHAIN     KODTFR                             33
      *
     C                   SELECT
     C     KFRCP         WHENEQ    'CC'
     C     HEVALK        ANDNE     *BLANKS
     C                   MOVE      'K'           XSK
     C                   MOVE      HEKNKF        XKUNR             8 0
     C                   MOVE      HEVALK        XVAL              3
     C     KFRCP         WHENNE    'CC'
     C     HEVALS        ANDNE     *BLANKS
     C                   MOVE      'S'           XSK
     C                   MOVE      HEKNSF        XKUNR
     C                   MOVE      HEVALS        XVAL
     C     HEVALK        WHENNE    *BLANKS
     C                   MOVE      'K'           XSK
     C                   MOVE      HEKNKF        XKUNR
     C                   MOVE      HEVALK        XVAL
     C                   OTHER
     C                   MOVE      'S'           XSK
     C                   MOVE      HEKNSF        XKUNR
     C                   MOVE      HEVALS        XVAL
     C                   ENDSL
      *
     C     XVAL          IFEQ      *BLANKS
     C                   MOVE      FICURR        XVAL
     C                   END
      * Omregn til lokal valuta
     C*          UCURC     IFEQ FIFIRM
     C     UCURC         IFEQ      FICURR
     C                   Z-ADD     UAMT          XBELN            11 2
     C                   MOVE      'N'           XTILB             1
     C                   ELSE
     C                   MOVE      'J'           XTILB             1
N01   *
N01   * sjekk kunde om avtale
N01   *
N01  C     CCK1          CHAIN     KODTCC                             34
N01  c  N34              Z-add     KCCVA         KDIPRO
S01  C*    KODDIK        CHAIN     KODTDINR                           34
N01  C   34KODDIK        CHAIN     KODTDINR                           34
     C  N34KDIPRO        DIV       100           XTILBA            5 4
     C  N34              ADD       1             XTILBA
     C     KODVAK        CHAIN     VALUL01                            34
s01  C*    VALKU1        IFEQ      0
n01  C     VALKU2        IFEQ      0                                              3<-B
n01  C*    UAMT          MULT      VALKU2        XBL              15 5
n01  C     UAMT          MULT      VALKU1        XBL              15 5
     C                   ELSE
s01  C*    UAMT          MULT      VALKU1        XBL
n01  C     UAMT          MULT      VALKU2        XBL
     C                   END
     C     XBL           DIV(H)    OMRFAK        XBELN
     C                   MULT(H)   XTILBA        XBELN
     C                   END
     C                   SELECT
     C     UCURC         WHENEQ    XVAL
      * VALUTAKODE PÅ LINJE = VALUTAKODE TIL FAKTURAMOTTAKER
     C                   Z-ADD     UAMT          XBELV            11 2
     C     FICURR        WHENEQ    XVAL
      * VALUTAKODE TIL FIRMA = VALUTAKODE TIL FAKTURAMOTTAKER
     C                   Z-ADD     XBELN         XBELV
     C                   OTHER
      * HENT TILLEGG BANKKURS
     C     XTILB         IFEQ      'N'
N03   *
N03   * sjekk kunde om avtale
N03   *
N03  C     CCK1          CHAIN     KODTCC                             34
N03  c  N34              Z-add     KCCVA         KDIPRO
S03  C*    KODDIK        CHAIN     KODTDINR                           34
N03  C   34KODDIK        CHAIN     KODTDINR                           34
     C  N34KDIPRO        DIV       100           XTILBA            5 4
     C  N34              ADD       1             XTILBA
     C                   END
      * OMREGN BELØP TIL VALUTAKODE TIL FAKTURAMOTTAKER
     C     KODV2K        CHAIN     VALUL01                            34
     C     XBELN         MULT      OMRFAK        XBELV
     C     VALKU1        IFEQ      0
     C                   DIV(H)    VALKU2        XBELV
     C                   ELSE
     C                   DIV(H)    VALKU1        XBELV
     C                   END
N08  C     XTILB         IFEQ      'N'
N08  C                   MULT(H)   XTILBA        XBELV
N08  C                   END
     C                   ENDSL
      *
      * OPPDATER FAKTURALINEN HVIS DET FINNE FRA FØR.
     C     FAK5K         SETLL     FAK5
     C     FAK5K         READE     FAK5                                   33
     C     *IN33         DOWEQ     '0'
     C     FAKDA         IFNE      'T'
     C     FAVK          ORNE      UFEEC
     C     FAVAL         ORNE      XVAL
     C     FAKDM         ORNE      UVAT
     C     FAKUNR        ORNE      XKUNR
     C     FABÆR         ORNE      HESTD
     C                   UPDATE    FAKTR
     C                   ELSE
     C                   ADD       XBELV         FABELV
     C                   ADD       XBELN         FABELN
     C                   UPDATE    FAKTR
     C                   GOTO      SLUTT
     C                   END
     C     FAK5K         READE     FAK5                                   33
     C                   ENDDO
      *
      * LAGE NY FAKTURALINEJ NÅR DET IKKE FINNES FØR.
     C     FAKTK         SETLL     FAKT
     C     HEADFK        READPE    FAKT                                   33
     C     *IN33         IFEQ      '0'
     C     FALI          ADD       1             XLI               5 0
     C                   ELSE
     C                   Z-ADD     1             XLI
     C                   END
     C                   CLEAR                   FAKTR
     C                   MOVE      HEAVD         FAAVD
     C                   MOVE      HEOPD         FAOPD
     C                   MOVE      XLI           FALI
     C                   MOVE      HESTD         FABÆR
     C                   MOVE      'T'           FAKDA
     C                   MOVE      UVAT          FAKDM
     C                   MOVE      UFEEC         FAVK
     C                   MOVE      XSK           FASK
     C                   MOVE      XKUNR         FAKUNR
     C                   MOVE      XVAL          FAVAL
     C                   Z-ADD     XBELN         FABELN
     C                   Z-ADD     XBELV         FABELV
     C                   WRITE     FAKTR
      * ---------------------------------------------------------------
      *
     C     SLUTT         TAG
     C                   MOVE      *ON           *INLR
     C                   RETURN
