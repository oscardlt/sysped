     H DFTACTGRP(*NO)
     FMAILSP    UF   E           K DISK
     FSAMLA     UF   E           K DISK
     FTRACKK    UF   E           K DISK
     FFREETUR   UF   E           K DISK
     FREIS      UF   E           K DISK
     FTILL      UF   E           K DISK
     FTRAVH     UF   E           K DISK
     FTRAVV     UF   E           K DISK
     FTURER22   UF   E           K DISK
     FTUSTS     UF   E           K DISK
     FARKIVL19  UF   E           K DISK
      *
     FARKTXT    IF   E           K DISK
     FARKEXT    IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FFIRM      IF   E           K DISK
      *

     d                 ds
     d  x_arunde               1     10
     d  x_arunde1              1      2
     d  x_arunde2              3     10  0
     d                 ds
     d  xdtf                   1      8  0
     d  xdtf_6                 3      8  0

     d xdtp            S              8  0
     D xclid           S             20A
     d WhereC          s            512a
     d FirstW          s              1A
     d cQuote          C                   const('''')
     d SqlStm          s            512a
     d myrows0         s             10i 0
     D XPOS            S              3  0
     D Error           S            150
     D ufil            S            256A
      *  Prototype for 'SYREO01C3'
     d SYREO01C3       pr                  extpgm('SYREO01C3')
     d ufil_                               like(ufil)
      *  Prototype for syreo18r
     d syreo18r        pr
     d udtf_                               like(udtf)
     d udtp_                               like(udtp)
      *  *ENTRY Interface for Main Procedure
     d syreo18r        pi
     d udtf                           8
     d udtp                           8
      *
     d MyPoDS0         ds                  Qualified  dim(1)
     d  FIFIRM                        2A
      *
      /free

         exsr init;

         exec sql
         delete from mailsp
         where xdate <= :xdtf_6 and xdate <> 0
         with NC;

         exec sql
         delete from samla
         where smdt <= :xdtf and smdt <> 0
         with NC;

         exec sql
         delete from trackk
         where tkdate <= :xdtf and tkdate <> 0
         with NC;

         setll xdtf turer22;
         readp turer22;
         dow not %eof;
           if tudtt < xdtf and tuetd < xdtf and tueta < xdtf
             and tuatd < xdtf and tuata < xdtf and tudt <> 0;
             exec sql
             delete from freetur
             where frttur = :tupro
             with NC;

             exec sql
             delete from reis
             where repro = :tupro
             with NC;

             exec sql
             delete from till
             where tipro = :tupro
             with NC;

             exec sql
             delete from travv
             where tvtunr = :tupro
             with NC;

             exec sql
             delete from travh
             where thtnr = :tupro
             with NC;

             exec sql
             delete from tursts
             where sstur = :tupro
             with NC;

             // slett arkiv
             x_arunde2 = tupro;
             setll x_arunde arkivl19;
             reade x_arunde arkivl19;
             dow not %eof;
               chain (fifirm) firmarc;
               chain (artype) arktxt;
               if %found and arklag <> *blanks;
                 chain (fifirm:arklag) arkext;
               endif;
               if arbhis <> *blanks;
               // Bane for historikk
                 arcane = arbhis;
               endif;
               xpos = %scan ('.' : arlink : 1);
               if xpos = 0;
                 ufil = '/' + %TRIM(ARCANE) + '/' + %TRIM(ARLINK) + '.pdf';
               else;
                 ufil = '/' + %TRIM(ARCANE) + '/' + %TRIM(ARLINK);
               endif;
               syreo01c3 (ufil);

               delete arkivr;
               reade x_arunde arkivl19;
             enddo;

             delete turerr;
           else;
             update turerr;
           endif;

           readp turer22;
         enddo;

         *inlr = *on;
         return;

      //***********************************************
       begsr init;
      //***********************************************
       xdtf = %float(udtf);
       xdtp = %float(udtp);
       x_arunde1 = 'T:';

       SqlStm = 'Select * ' +
                'from FIRM ' +
                'FOR READ ONLY ';
       Exec SQL PREPARE DynSel0 from :SqlStm;
       EXEC SQL DECLARE  A30  cursor for DynSel0;
       Exec SQL OPEN A30;
       Myrows0 = %elem(MyPoDS0);
       exec sql FETCH A30   for :MyRows0 rows
                  INTO :MyPoDs0;
       Exec SQL CLOSE A30;
       FIFIRM = mypods0(1).fifirm;

       endsr;

      /end-free
