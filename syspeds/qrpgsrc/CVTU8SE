      *____________________
      * DS for input string
      *""""""""""""""""""""
     D                 DS
     D  A                      1  30000
     D                                     DIM(30000)                           Input string
     D  ADS                    1  30000
      *_____________________
      * DS for output string
      *"""""""""""""""""""""
     D                 DS
     D  B                      1  30000
     D                                     DIM(30000)                           Output string
     D  BDS                    1  30000
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   EXSR      SRC
     C                   EVAL      *INLR=*ON
     C                   RETURN
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C                   Z-ADD     0             ØX                2 0
     C                   MOVE      *BLANKS       ØAN              12
     C                   MOVE      *BLANKS       XRDATA        30000
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
      *_____________
      * Init av felt
      *"""""""""""""
      * Workfields for Array's
     C                   Z-ADD     0             AX                2 0          Index for A
     C                   Z-ADD     1             BX                5 0          Index for B
     C                   Z-ADD     0             AXV               5 0          Leftindx A
     C                   Z-ADD     0             AXH               5 0          Rightindx A
     C                   MOVE      *BLANKS       WCHAR             1            Test character
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    STRINGIN      30000
     C                   PARM                    STRINGOUT     30000
     C                   MOVE      *BLANKS       USTEGN            1
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Start av file                                        SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
     C                   MOVEL     STRINGIN      ADS
     C                   EXSR      SRÅ
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Konkatener fil /fjern X'39'                          SRC /
      *////////////////////////////////////////////////////////////
     C     SRC           BEGSR

     C                   IF        USTEGN = 'J'                                 1<-B
     C     ' '           CHECKR    BDS           AXH
     C                   EVAL      XRDATA = *BLANKS
     C     1             DO        AXH           XN                5 0          <-------------I
     C                   IF        B(XN) <> X'39'                                 3<-B
     C                   ADD       1             XN2               5 0
     C                   EVAL      %SUBST(XRDATA:XN2:1) = B(XN)
     C                   ENDIF                                                    3<-E
     C                   ENDDO                                                   2<-E
     C                   EVAL      STRINGOUT=XRDATA
     C                   ELSE                                                   1<-E
     C                   EVAL      STRINGOUT=STRINGIN
     C                   ENDIF                                                  1<-E

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * SR for output string, read input from left              SRÅ
      *////////////////////////////////////////////////////////////
     C     SRÅ           BEGSR
      *_______________
      * Find positions
      *""""""""""""""""
     C                   EVAL      AXV=1
     C     ' '           CHECKR    ADS           AXH
      *________________________________________________
      * Read input string and place it in output string
      *""""""""""""""""""""""""""""""""""""""""""""""""
     C     AXV           DO        AXH           AXV                            <-------------I
     C                   MOVE      A(AXV)        WCHAR                                        I
     C     *IN91         IFEQ      *ON                                           <-----------II
     C                   SELECT
     C     WCHAR         WHENEQ    X'36'
     C                   MOVE      X'EC'         WCHAR                          Ø
     C     WCHAR         WHENEQ    X'B6'
     C                   MOVE      X'CC'         WCHAR                          ø
     C     WCHAR         WHENEQ    X'15'
     C                   MOVE      X'5B'         WCHAR                          Å
     C     WCHAR         WHENEQ    X'B2'
     C                   MOVE      X'D0'         WCHAR                          å
     C     WCHAR         WHENEQ    X'24'
     C                   MOVE      X'63'         WCHAR                          æ
     C     WCHAR         WHENEQ    X'5A'
     C                   MOVE      X'43'         WCHAR                          a
     C     WCHAR         WHENEQ    X'51'
     C                   MOVE      X'C5'         WCHAR                          a
     C     WCHAR         WHENEQ    X'3F'
     C                   MOVE      X'40'         WCHAR                          a
     C                   ENDSL
     C                   EVAL      *IN91=*OFF
     C                   ENDIF                                                   <-----------II
      * If X'66' da er det første tegn i UTF-8 særtegn (norskt)
     C     WCHAR         IFEQ      X'66'                                         <-----------II
     C                   EVAL      *IN91=*ON
     C                   MOVE      'J'           USTEGN
      * Neste tegn skal erstattes med riktig Norsk verdi
     C                   ENDIF                                                   <-----------II
      * If invalid character (' + : ?) then replace with 'Ø'             I
     C     WCHAR         IFLT      X'40'                                         <-----------II
     C     WCHAR         OREQ      X'66'
     C                   MOVE      X'39'         WCHAR
     C                   ENDIF                                                   <-----------II
      * Move to output string                                            I
     C                   MOVE      WCHAR         B(BX)                                        I
     C                   ADD       1             BX                                           I

     C                   ENDDO                                                  <-------------I

     C                   EVAL      ADS=*BLANKS

     C                   ENDSR
