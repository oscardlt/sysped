*********************************************************************
******* MyPack - valg av sevicepartner samt mottaker kontaktinfo..***
*********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 lagt in URL for websøk (se på kart mm)
10XXX * 02 JOV PTF10 Initiell blank I SERVICE-PARTNER FELTENE / F7=Velg nærmeste
10XXX * 03 JOV PTF10 cundc tatt bort  - ikke i bruk
10XXX * 04 JOV PTF10 Mypack via Bring OBS!!-KNR 0413898 HARDKODET (også syfa12/syfa12sf)
12272 * 05 YBC PTF12 URL er endret
********************************************************************
      *
     FDOKUFE    UF A E           K DISK
     FFIRM      IF   E           K DISK
s03  F*CUNDC     IF   E             DISK
     FSYCTAMYD  CF   E             WORKSTN

N01  D WsPnr           s              4
N01  D WsSted          s             30
N01  D WsSted2         s             30
N01  D                 DS
N02  D OPENDS                  1     76
N02   * man
N02  D  Oman                   1     11
N02   * tir
N02  D  Otir                  14     24
N02   * ons
N02  D  Oons                  27     37
N02   * tor
N02  D  Otor                  40     50
N02   * fre
N02  D  Ofre                  53     63
N02   * flør
N02  D  OlØr                  66     76
N02   *
N02  D                 DS
N02  D OPENDS2                 1     15
N02   * søn
N02  D  text7                  1      4
N02  D  OsØn                   5     15
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C     *IN12         IFEQ      *OFF
     C                   EXSR      SRC
     C                   ENDIF
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *_________________
      * Input parametere
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    ZE_DFAVD
     C                   PARM                    ZE_DFOPD
     C                   PARM                    ZE_DFFBNR
     C                   PARM                    WE_N3035
     C                   PARM                    WE_KUNDNR         8 0
     C                   PARM                    WSNAVM           30
     C                   PARM                    WSAD1M           30
     C                   PARM                    WSAD3M           30
     C                   PARM                    WSNAVL           30
     C                   PARM                    WSAD1L           30
     C                   PARM                    WSPOUL            4 0
     C                   PARM                    WSADUL           25
     C                   PARM                    WSKUNR           12
      *
      *_______________
      * Definiere felt
      *"""""""""""""""
     C     *LIKE         DEFINE    FE_N3035      WE_N3035
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     DOKUFEKEY     KLIST
     C                   KFLD                    ZE_DFAVD
     C                   KFLD                    ZE_DFOPD
     C                   KFLD                    ZE_DFFBNR
     C                   KFLD                    WE_N3035
      * Hetn firmakode
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
      * Sjekker først om det finnes noen verdier å vise
     C     DOKUFEKEY     CHAIN(N)  DOKUFE                             90
     C     *IN90         IFEQ      *OFF
     C                   EVAL      WSNAVM=FE_C3413
     C*                  EVAL      ZE_C3412=FE_C3412
     C                   EVAL      ZE_C3148A=FE_C3148A
     C                   EVAL      ZE_C3148B=FE_C3148B
     C                   EVAL      ZE_C3148C=FE_C3148C
     C                   EVAL      ZE_C3148D=FE_C3148D
     C                   EVAL      ZE_C3148E=FE_C3148E
     C                   ENDIF
      * Kvalifikator (Type kundekontakt)
     C                   SELECT
     C     WE_N3035      WHENEQ    'DP '
     C                   EVAL      ZE_TYP='Leveringsadresse'
     C                   OTHER
     C                   EVAL      ZE_TYP='Leveringsadresse'
     C                   ENDSL
      * Viser bilde
     C     TAG01         TAG
N01  c                   movel     WSAD3M        WsPnr
N01  c                   movel     WSAD1M        WsSted
N01  c                   move      *zeros        f                 3 0
N01  C     FlerTegn      tag
N01  C     ' '           SCAN      WsSted        f
N01  C     f             cabeq     *zeros        UtSpecial
N01  c                   if        %subst(WsSted:f:30-f)=*blanks
N01  C                   goto      UtSpecial
N01  c                   end
N01  C                   EVAL      WSSted2 = %SUBST(WsSted:1:f-1) +
N01  C                             '%20'+
N01  C                             %trim(%SUBST(WsSted:f+1:30-f))
N01  C                   eval      WsSted = WsSted2
N01  C                   goto      FlerTegn
N01  C     UtSpecial     tag
S05  c*                  eval      TGURL='http://www.tollpost.no/PLUS?'
S05  c*                            + 'TollpostCompanyID=001'+'&DZipCode='
S05  c*                            + WSPNR +'&DAddressCombined='+WsSted
N05  C                   eval      TGURL='https://api2.postnord.com/rest'
N05  C                             + '/businesslocation/v5/servicepoints'
N05  C                             + '/nearest/byaddress?'
N05  C                             + 'returnType=xml'
N05  C                             + '&countryCode=NO'
N05  C                             + '&agreementCountry=NO'
N05  C                             + '&postalCode=' + %TRIM(WSPNR)
N05  C                             + '&streetName=' + %TRIM(WSSTED)
N05  C                             + '&numberOfServicePoints=5'
N05  C                             + '&srId=EPSG:3A4326'
N05  C                             + '&context=optionalservicepoint'
N05  C                             + '&responseFilter=public&typeId=37'
N05  C                             + '&apikey=43fc3f8567bc38f5321fafc70555c408'
N05   * SYSTEMA SIN Apikey 43fc3f8567bc38f5321fafc70555c408
N05   *
N02  C     WSKUNR        IFEQ      *BLANKS
N02  C                   CLEAR                   WSNAVL
N02  C                   CLEAR                   WSAD1L
N02  C                   CLEAR                   WSPOUL
N02  C                   CLEAR                   WSADUL
N02  C                   END
N02  c     UOPEN         comp      *blanks                            50
N04  C     WSKUNR        comp      '0413898'                              51
     C                   EXFMT     SYCTA01DA
N02  C                   MOVE      *BLANKS       WARNING          75
S02  C*  03              GOTO      TAG02
     C   04              EXSR      SRBA
N02  C   07              EXSR      SRBA
N04  C     *in10         ifeq      '1'
N04  C                   exsr      ViaBring
N04  c                   endif
N02  C     *in03         ifeq      '1'
N02  C     ZE_C3148A     ifeq      *blanks                                      telefon
N02  C     ZE_C3148B     andeq     *blanks                                      mobil
N02  C*    ZE_C3148C     andeq     *blanks                                      fax
N02  C     ZE_C3148D     andeq     *blanks                                      sms
N02  C     ZE_C3148E     andeq     *blanks                                      email
N02  C                   EVAL      WARNING='Tlf/Mob/SMS/E-Post er blanke.   '
N02  C                             +'Hentevarsel via post? F23=Bekreft.'
N02  C                   GOTO      TAG01
N02  c                   endif
N02  C                   GOTO      TAG02
N02  c                   endif
N02  C   23              GOTO      TAG02
     C   12              GOTO      TAG02
     C                   GOTO      TAG01
     C     TAG02         TAG
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Søk kontakter                                       SRBA /
      *////////////////////////////////////////////////////////////
     C     SRBA          BEGSR
     C                   movel     wsad3m        upoul
     C                   move      wsad3m        uste24           24
     C                   movel     uste24        uste
     C                   movel     wsad1m        uadr
     C                   move      *blanks       unav
n02  C                   move      *blanks       ukund
N02  c                   movel     ' '           uFØRST
N02  c   07              movel     'J'           uFØRST
N02  C                   move      *blanks       UDIST
N02  C                   move      *blanks       UOPEN
     C                   CALL      'SYTG01CL'
     C                   PARM                    UNAV             30
     C                   PARM                    UADR             30
     C                   PARM                    UPOUL             4
     C                   PARM                    USTE             25
     C                   PARM                    UKUND            12
N02  C                   PARM                    UFØRST            1
N02  C                   PARM                    UDIST             9
N02  C                   PARM                    UOPEN            91
      *
     C                   EVAL      WSNAVL=UNAV
     C                   EVAL      WSAD1L=UADR
     C                   MOVE      UPOUL         WSPOUL
     C                   MOVEL     USTE          WSADUL
     C                   MOVEL     UKUND         WSKUNR
N02  c     WSKUNR        ifne      *blanks
N02  c                   move      UDIST         TPDIST7           7 0
N02  c                   movel     UOPEN         OPENDS
N02  c                   move      UOPEN         OPENDS2
N02  c                   endif
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Summering                                            SRC /
      *////////////////////////////////////////////////////////////
     C     SRC           BEGSR
     C     DOKUFEKEY     CHAIN     DOKUFE                             90
     C   90              CLEAR                   DOKUFER
     C   90              EVAL      FE_DFAVD=ZE_DFAVD
     C   90              EVAL      FE_DFOPD=ZE_DFOPD
     C   90              EVAL      FE_DFFBNR=ZE_DFFBNR
     C   90              EVAL      FE_N3035=WE_N3035
     C                   EVAL      FE_C3413=WSNAVM
     C*                  EVAL      FE_C3412=ZE_C3412
     C                   EVAL      FE_C3148A=ZE_C3148A
     C                   EVAL      FE_C3148B=ZE_C3148B
     C                   EVAL      FE_C3148C=ZE_C3148C
     C                   EVAL      FE_C3148D=ZE_C3148D
     C                   EVAL      FE_C3148E=ZE_C3148E
     C     FE_C3413      IFEQ      *BLANKS
     C     FE_C3412      ANDEQ     *BLANKS
     C     FE_C3148A     ANDEQ     *BLANKS
     C     FE_C3148B     ANDEQ     *BLANKS
     C     FE_C3148C     ANDEQ     *BLANKS
     C     FE_C3148D     ANDEQ     *BLANKS
     C     FE_C3148E     ANDEQ     *BLANKS
     C  N90              DELETE    DOKUFER
     C                   GOTO      SRC9
     C                   ENDIF
     C   90              WRITE     DOKUFER
     C  N90              UPDATE    DOKUFER
     C     SRC9          TAG
     C                   ENDSR
N04   **************************************************
N04  C     VIABRING      BEGSR
N04   **************************************************
N04  c                   eval      WSKUNR = '0413898'
N04  C                   MOVE      *ZEROS        WSPOUL
N04  C                   MOVE      WSNAVM        WSNAVL
N04  C                   MOVE      WSAD1M        WSAD1L
N04  C                   MOVEL     WSAD3M        TMPPUL            4
N04  C                   TESTN                   TMPPUL               34
N04  C     *IN34         IFEQ      '1'
N04  C                   MOVE      TMPPUL        WSPOUL                          UTL.POSTNR
N04  C                   MOVE      WSAD3M        WSADUL
N04  C                   ELSE
N04  C                   MOVE      *ZEROS        WSPOUL
N04  C                   MOVEL     WSAD3M        WSADUL
N04  C                   END
N04  c                   move      *blanks       UOPEN
N04  c                   move      *blanks       OPENDS
N04  c                   move      *blanks       OPENDS2
N04  C                   ENDSR
