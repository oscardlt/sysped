      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/ESOVERS1S MODULE(*LIBL/ESOVERS1S *LIBL/INCGI
CRTPGM*         *LIBL/CHECKUSR) ACTGRP(CGI) AUT(*USE)
********************************************************************
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
     FBRIDF     UF   E           K DISK    USROPN
     FBRPARF    if   e           k disk    usropn
     FHEADF     IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFR0)
     FHEAD14    IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFR14)
     FHEAD17    IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFR17)
     FHEAD30    IF   E           K DISK    usropn
     FBILLOF    IF   E           K DISK    usropn
     FBILLOFLG  IF   E           K DISK    USROPN
     F                                     RENAME(BILLOFR:BILLOFRG)
     FBLV1      IF   E           K DISK    usropn
     FBLJOINLF  IF   E           K DISK    USROPN
     F                                     RENAME(BILLOFR:BLJOIN0)
     F                                     RENAME(BLV1R:BLJOIN1)
     F                                     RENAME(BLV2R:BLJOIN2)
     FEPOH02    IF   E           K DISK    usropn
     FEPOH04    IF   E           K DISK    usropn
     F                                     RENAME(EPOHR:EPOHR04)
     FEPOL02    IF   E           K DISK    usropn
     FEPOL04    IF   E           K DISK    usropn
     F                                     RENAME(EPOLR:EPOLR04)
     FEPOL      IF   E           K DISK    usropn
     F                                     RENAME(EPOLR:EPOLR00)
     FTURER14   IF   E           K DISK    usropn
     FTRACKT    IF   E           K DISK    usropn
     FTRACKL02  IF   E           K DISK    usropn
     FARKIVL02  IF   E           K DISK    usropn
     FKODTA     IF   E           K DISK    usropn
     FFRISOK    IF   E           K DISK    usropn
     FFRISOL01  IF   E           K DISK    usropn
     F                                     RENAME(FRISOKR:FRISOKR1)
     FKALENDER  IF   E           K DISK    usropn
     FCUNDL01   IF   E           K DISK    usropn
      *--------------------------------------------------------------------
      * Prototype defintions and standard system API error structure
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
     D IfsMultIndicators...
     d                 ds
     D  NoErrors                       n
     D  NameTooLong                    n
     D  NotAccessible                  n
     D  NoFilesUsable                  n
     D  DupSections                    n
     D  FileIsEmpty                    n

      *--------------------------------------------------------------------
     D OddEven         s             10
      * Variables received from the input string
     D BckGnd          s             10
     D UsrSpcName      s             10
     D WSUSER          S             10
     D WSNA            S             30
     D ANTSND          s              5  0
     D MaxSN           s              5
     D MaxSND          s              5  0
     D ANTRCD          s              5  0
     D MaxRC           s              5
     D MaxRCD          s              5  0
     D lstbrd          s              1
     D WSDTF           s              8
     D WSDTT           s              8
     D ArGod           s             40
     D SYSREF          S             12
     D WSPRO           S              8
     D WSPRON          S              8  0
     D XHERFA          S             15
     D WSCONTNR        S            500
     D WSCONTTY        S             50
     D XSTATUS         s             15
     D XSTATSort       s              3
     D XOPPLAST        s              1
     D InqHistory      s              1
     D WSCN            s             17
     D WSBLNR          s             16
     D WSREIS          s             14
     D WSREISMAX       s             14
     D WSAVD           s              4
     D WBAVD           s              4  0
     D WSOPD           s              7
     D WBOPD           s              7  0
     D Kun1Opd         s              1
     D WSAVDDFT        s              4
     D WBAVDDFT        s              4  0
     D KUNFRA          s              5
     D KUNFRA2         s              5
     D KUNFRA3         s              5
     D KUNFRA4         s              5
     D KUNFRA5         s              5
     D KUNTIL          s              5
     D KUNTIL2         s              5
     D KUNTIL3         s              5
     D KUNTIL4         s              5
     D KUNTIL5         s              5
     D WSKODE          s              3
     D WSSOK           s             35
     D WSSOK2          s             35
     D WSBES           s             10
     D WSBESMAX        s             10
     D WSART           s             35
     D WSARTMAX        s             35
     D KUNKNR          s              8
     D KUNKNRN         s              8  0
     D KUNKN2          s              8
     D KUNKN2N         s              8  0
     D KUNKN3          s              8
     D KUNKN3N         s              8  0
     D AVD             s              4  0 DIM(50)
     D OPD             s              7  0 DIM(50)
     D PGM             C                   CONST('SYSPED/CHECKUSR')
     D                 DS
     D  ParmOS1                1   1024
     D  OSCHG                  1      1
     D  OSOT16                 2     49
     D  OT                     2     49    DIM(16)
     D  OSO216               102    149
     D  O2                   102    149    DIM(16)
     D  OSST08               150    197
     D  STD                  150    197    DIM(8)
     D  AV                   198    247    DIM(10)
     D  OSLKF16              248    295
     D  LKF                  248    295    DIM(16)
     D  OSLKT16              296    343
     D  LKT                  296    343    DIM(16)
     D  STDT                 344    391    DIM(8)
     D                 DS
     D BLAVD                   1      4  0
     D BVAVD                   1      4  0
     D FSAVD                   1      4  0
     D                 DS
     D BLOPD                   1      7  0
     D BVOPD                   1      7  0
     D FSOPD                   1      7  0
     D                 DS
     D BLMN                    1     17
     D BVMN                    1     17
     D                 DS
     D WSRFA                   1     15
     D WSRFA35                 1     35
      * Arkivtyper 16 elem. a 3 tegn (sb,si,..) Type er venstrestilt
     D                 DS
     D  ATString               1    192
     D  ATString1              1     48
     D  ATString2             49     96
     D  ATString3             97    144
     D  ATString4            145    192
     D  AT                     1    192    DIM(64)
     D                 DS
     D  A2                     1    128    DIM(64)
      * Variables received from the input string
     D l1              s              3s 0
     D l2              s              3s 0
      * Number of records matching search criteria
     DRecordCnt        s              5S 0
      *
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
      *
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
      *
      * For xlate mellom Upper Case og Lower Case
     D UC              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZÆØÅ')
     D LC              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzæøå')
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================******
      * MAIN PROCESS LINE
      *=====================================================================******
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input
     C                   exsr      Parse
     C                   EXSR      INIT
      *
     C                   CALLB     PGM
     C                   PARM                    BIBRID
     C                   PARM                    UsrSpcName
     C                   PARM                    UINN              1
     C                   IF        UINN = 'N'
     C                   GOTO      SLUTT
     C                   END
     C     WSUSER        CHAIN     BRIDF                              50
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           BIDTF
     C                   MOVE      WTM           BITIDF
     C  N50              UPDATE    BRIDFR
      * Set/READ output skeleton html member name
     C                   exsr      SetSkl
      *------------------                                                   ******
      * Write HTML sections
     C                   exsr      SetTop
     C                   callp     wrtsection('top')
      * Hent avdeling
     C                   exsr      DSPAVD
      *
     c                   move      *blanks       CRTN            100
     C                   IF        OSCHG = 'J'
     c                   eval      CRTN = '<INPUT TYPE="button" VALUE="Create '
     C                             +'order" NAME="OrdButton" '
     c                             +'onClick="CrtOrd(this.form)">'
     C                   END
     C                   callp     updHTMLvar('CRTNEWBUT':CRTN)
     C                   callp     wrtsection('lagnystr')
      *
     C                   callp     wrtsection('tablestr')
      * hent/skriv oppdrag
     c                   if        InqHistory =  'J'
     c                   exsr      InqHist
     c                   else
     C                   exsr      HentOpd
     C                   END
      * tableend
     C                   callp     wrtsection('tableend')
      *
     C                   callp     updHTMLvar('ANTSND':
     C                             %trim(%editc(ANTSND:'3')))
     C                   callp     updHTMLvar('MaxSnd':
     C                             %trim(%editc(MaxSnd:'3')))
     C                   callp     updHTMLvar('ANTRCD':
     C                             %trim(%editc(ANTRCD:'3')))
     C                   callp     updHTMLvar('MaxRcd':
     C                             %trim(%editc(MaxRcd:'3')))
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
     C                   callp     wrtsection('bot')
     C                   callp     wrtsection('stdbot')
     C                   callp     wrtsection('*fini')
     C     SLUTT         tag
     C                   EXSR      EXIT
     C                   return
      *
      *=====================================================================******
      * Parse input
      *=====================================================================******
     C     Parse         begsr
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   eval      BckGnd  = zhbgetvar('bckgnd')
     C                   eval      lstbrd  = zhbgetvar('lstbrd')
     C                   EVAL      WSUSER  = zhbgetvar('USER')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   EVAL      WSNA    = zhbgetvar('KNAVN')
      *
      * Div filterparamtere...
     C                   EVAL      WSRFA   = zhbgetvar('WSRFA')
     C     LC:UC         XLATE     WSRFA         WSRFA
     C                   EVAL      WSPRO   = zhbgetvar('WSPRO')
     C                   eval      WSPRON  = c2n2(WSPRO)
     C                   EVAL      KUNFRA  = zhbgetvar('KUNFRA')
     C     LC:UC         XLATE     KUNFRA        KUNFRA
     C                   EVAL      KUNFRA2 = zhbgetvar('KUNFRA2')
     C     LC:UC         XLATE     KUNFRA2       KUNFRA2
     C                   EVAL      KUNFRA3 = zhbgetvar('KUNFRA3')
     C     LC:UC         XLATE     KUNFRA3       KUNFRA3
     C                   EVAL      KUNFRA4 = zhbgetvar('KUNFRA4')
     C     LC:UC         XLATE     KUNFRA4       KUNFRA4
     C                   EVAL      KUNFRA5 = zhbgetvar('KUNFRA5')
     C     LC:UC         XLATE     KUNFRA5       KUNFRA5
     C                   EVAL      KUNTIL  = zhbgetvar('KUNTIL')
     C     LC:UC         XLATE     KUNTIL        KUNTIL
     C                   EVAL      KUNTIL2 = zhbgetvar('KUNTIL2')
     C     LC:UC         XLATE     KUNTIL2       KUNTIL2
     C                   EVAL      KUNTIL3 = zhbgetvar('KUNTIL3')
     C     LC:UC         XLATE     KUNTIL3       KUNTIL3
     C                   EVAL      KUNTIL4 = zhbgetvar('KUNTIL4')
     C     LC:UC         XLATE     KUNTIL4       KUNTIL4
     C                   EVAL      KUNTIL5 = zhbgetvar('KUNTIL5')
     C     LC:UC         XLATE     KUNTIL5       KUNTIL5
     C                   EVAL      WSKODE  = zhbgetvar('WSKODE')
     C     LC:UC         XLATE     WSKODE        WSKODE
     C                   EVAL      WSSOK   = zhbgetvar('WSSOK')
     C     LC:UC         XLATE     WSSOK         WSSOK
     C                   EVAL      WSBES   = zhbgetvar('WSBES')
     C     LC:UC         XLATE     WSBES         WSBES
     C                   EVAL      WSBESMAX= %TRIM(WSBES) + '999999999'
     C                   EVAL      WSART   = zhbgetvar('WSART')
     C                   EVAL      WSARTMAX= %TRIM(WSART) + '999999999999999999'
     C     LC:UC         XLATE     WSART         WSART
     C                   EVAL      KUNKNR  = zhbgetvar('KUNKNR')
     C                   eval      KUNKNRN  = c2n2(KUNKNR)
     C                   EVAL      KUNKN2  = zhbgetvar('KUNKN2')
     C                   eval      KUNKN2N  = c2n2(KUNKN2)
     C                   EVAL      KUNKN3  = zhbgetvar('KUNKN3')
     C                   eval      KUNKN3N  = c2n2(KUNKN3)
      * Div filterparamtere som indikere spørring på HISTORY
     C                   EVAL      WSCN     = zhbgetvar('WSCN')
     C                   EVAL      WSBLNR   = zhbgetvar('WSBLNR')
     C                   EVAL      WSREIS   = zhbgetvar('WSREIS')
     C                   eval      WSREIS   = uppify(WSREIS)
     C     WSREIS        IFNE      *blanks
     C                   eval      WSREISmax= %trim(WSREIS)+'9999999999999'
     c                   endif
     C                   EVAL      WSAVD    = zhbgetvar('WSAVD')
     C                   eval      WBAVD    = c2n2(WSAVD)
     C                   EVAL      WSOPD    = zhbgetvar('WSOPD')
     C                   eval      WBOPD    = c2n2(WSOPD)
     C                   EVAL      Kun1Opd  = zhbgetvar('Kun1Opd')
     C                   EVAL      WSAVDDFT = zhbgetvar('WSAVDDFT')
     C                   eval      WBAVDDFT = c2n2(WSAVDDFT)
     C     WSCN          IFNE      *BLANKS
     C     WSBLNR        ORNE      *BLANKS
     C     WSAVD         ORNE      *BLANKS
     C     WSKODE        ORNE      *BLANKS
     C     WSSOK         ANDNE     *BLANKS
     C                   eval      WSCN     = uppify(WSCN)
     C                   eval      WSBLNR   = uppify(WSBLNR)
     C                   eval      WSSOK    = uppify(WSSOK)
     C                   MOVE      'J'           InqHistory
     C                   END
      *
     C                   endsr
      *=====================================================================******
      *  Display AVDELING to select from
      *=====================================================================******
     C     DSPAVD        BEGSR
      *
     c                   Eval      DFTUSER = BIBRID
     C                   MOVEL     'OSAVD'       PAID
     C     FirmKey       Chain     BRPARF                             33
     c   33              Eval      DFTUSER = '*KUNDFT*'+BIFIRM
     C   33FirmKey       Chain     BRPARF                             33
      *
      * TEST OM DET KUN ER EN AVDELING
     C                   IF        *IN33 = *OFF
     C     FirmKey       READE     BRPARF                                 33
     C                   IF        *IN33
     C                   EVAL      KOAAVD = PAVRDN
     C                   callp     updHtmlVar('WSAVDDFT':
     C                             %trim(%editc(KOAAVD:'Z')))
     C                   callp     wrtsection('KUNENAVD')
     C                   GOTO      SLDSPAVD
     C                   END
     C                   ELSE
     C                   EVAL      KOAAVD = 0
     C                   callp     updHtmlVar('WSAVDDFT':
     C                             %trim(%editc(KOAAVD:'Z')))
     C                   callp     wrtsection('KUNENAVD')
     C                   GOTO      SLDSPAVD
     C                   END
      *
     C     FirmKey       CHAIN     BRPARF                             33
      *
     C                   callp     wrtsection('AVDSlt')
     C  N33              IF        WBAVDDFT = 0
     C                   EVAL      WBAVDDFT = PAVRDN
     C                   END
      *
     C                   DOW       *IN33 = *OFF
     C                   EVAL      KOAAVD = PAVRDN
     C     KODTAK        CHAIN     KODTA                              33
     C                   callp     updHtmlVar('WSAVD1D':
     C                             %trim(%editc(KOAAVD:'Z')))
     C                   callp     updhtmlvar('WSAVD2D':KOANVN)
     C                   IF        WBAVDDFT = KOAAVD
     C                   callp     updhtmlvar('AVDselected':'selected')
     C                   ELSE
     C                   callp     updHtmlVar('AVDselected':'')
     C                   END
     C                   callp     wrtsection('AVDRow')
     C     FirmKey       READE     BRPARF                                 33
     C                   ENDDO
      *
     C     SLDSPAVD      TAG
     C                   callp     wrtsection('AVDBot')
      *
     C                   ENDSR
      *
      ******************************************************
     C     SetTop        begsr
      ******************************************************
     C                   callp     updHTMLvar('ROWHEAD':RowHead:
     C                             InitHTMLVars)
     C                   callp     updHTMLvar('LogoImg':LogoImg)
      * Color for text, background, links, visited links, active links
     C                   callp     updhtmlvar('TXTCOLOR':'black')
     C                   callp     updhtmlvar('BOLD':' ')
     C                   callp     updhtmlvar('BGCOLOR':BIFARG)
     C                   callp     updhtmlvar('LINK':'0000FF')
     C                   callp     updhtmlvar('VLINK':'FF0000')
     C                   callp     updhtmlvar('ALINK':'00FF00')
      * KUNDE
     C                   callp     updhtmlvar('WSNA':WSNA)
     C                   callp     updhtmlvar('KNAVN':KNAVN)
     C                   callp     updHtmlVar('KUNDE':
     C                             %trim(%editc(BIKUNR:'Z')))
     C                   callp     updhtmlvar('USER':WSUSER)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHTMLvar('sdato':
     C                             %trim(%editw(BIDTV:'    .  .  ')))
     C                   callp     updHTMLvar('stid':
     C                             %trim(%editw(BITIDV:'  .  .  ')))
      *
     C                   callp     updHTMLvar('WSBLNR':WSBLNR)
     C                   callp     updHTMLvar('WSCN':WSCN)
     C                   callp     updHTMLvar('WSRFA':WSRFA)
     C                   callp     updHTMLvar('WSAVD':WSAVD)
     C                   callp     updHTMLvar('WSOPD':WSOPD)
     C                   callp     updHTMLvar('WSKODE':WSKODE)
     C                   callp     updHTMLvar('WSSOK':WSSOK)
      * Søkeparam
     C                   callp     updHTMLvar('WSDTF':WSDTF)
     C                   callp     updHTMLvar('WSDTT':WSDTT)
      *
     C                   callp     updHTMLvar('WSBES':WSBES)
     C                   callp     updHTMLvar('WSART':WSART)
     C                   callp     updHTMLvar('KUNFRA':KUNFRA)
     C                   callp     updHTMLvar('KUNFRA2':KUNFRA2)
     C                   callp     updHTMLvar('KUNFRA3':KUNFRA3)
     C                   callp     updHTMLvar('KUNFRA4':KUNFRA4)
     C                   callp     updHTMLvar('KUNFRA5':KUNFRA5)
     C                   callp     updHTMLvar('KUNTIL':KUNTIL)
     C                   callp     updHTMLvar('KUNTIL2':KUNTIL2)
     C                   callp     updHTMLvar('KUNTIL3':KUNTIL3)
     C                   callp     updHTMLvar('KUNTIL4':KUNTIL4)
     C                   callp     updHTMLvar('KUNTIL5':KUNTIL5)
     C                   callp     updHtmlVar('KUNKNR':
     C                             %trim(%editc(KUNKNRN:'Z')))
     C                   callp     updHtmlVar('KUNKN2':
     C                             %trim(%editc(KUNKN2N:'Z')))
     C                   callp     updHtmlVar('KUNKN3':
     C                             %trim(%editc(KUNKN3N:'Z')))
     C                   callp     updHtmlVar('HEPRO':
     C                             %trim(%editc(WSPRON:'Z')))
      *
     C                   endsr
      ********************************************
     C     InqHist       begsr
      ********************************************
     C                   SELECT
     C                   WHEN      WSBLNR <> *BLANKS
     C                   MOVEL     WSBLNR        XWSBLNR          16
     C                   CAT       '9999999999':0XWSBLNR
     C     WSBLNR        SETLL     BILLOFLG
     C                   READ      BILLOFLG                               35
     C  N35BLBLNR        COMP      XWSBLNR                            35
     C                   DOW       *IN35 = *OFF
     C     HEADFK        CHAIN     HEADF                              35
      * diverse filter legges her..
     C  N35              EXSR      SRFILTER
     C                   EVAL      BVKDC = *BLANKS
     C                   READ      BILLOFLG                               35
     C  N35BLBLNR        COMP      XWSBLNR                            35
     C                   ENDDO
      *
     c                   WHEN      WSCN <> *BLANKS
     C                   MOVEL     WSCN          XWSCN            17
     C                   CAT       '9999999999':0XWSCN
     C     WSCN          SETLL     BLJOINLF
     C                   READ      BLJOINLF                               35
     C  N35BVMN          COMP      XWSCN                              35
     C                   DOW       *IN35 = *OFF
     C     HEADFK        CHAIN     HEADF                              35
      * diverse filter legges her..
     C  N35              EXSR      SRFILTER
     C                   READ      BLJOINLF                               35
     C  N35BVMN          COMP      XWSCN                              35
     C                   ENDDO
      *
     c                   WHEN      WBAVD <> 0
     c     Kun1Opd       ifeq      'Y'
     C     BILLWSK       chain     BILLOF                             35
     C  N35HEADFK        CHAIN     HEADF                              35
     C  N35              EXSR      SRFILTER
     c                   else
     C     BILLWSK       SETLL     HEADF
     C     WBAVD         READE     HEADF                                  35
     C                   DOW       *IN35 = *OFF
     C     BILLOFK       CHAIN     BILLOF                             35
      * diverse filter legges her..
     C  N35              EXSR      SRFILTER
     C     WBAVD         READE     HEADF                                  35
     C                   ENDDO
     c                   endif
      *
     c                   WHEN      WSKODE <> *BLANKS AND WSSOK <> *BLANKS
     C                   EVAL      WSSOK2 = %TRIM(WSSOK)
     C                             + '9999999999999999999999999999999999'
     C     FRISOL01K     SETLL     FRISOL01
     C     WSKODE        READE     FRISOL01                               35
     C  N35WSSOK2        COMP      FSSOK                                35
     C                   DOW       *IN35 = *OFF
     C     HEADFK        CHAIN     HEADF                              35
      * diverse filter legges her..
     C  N35              EXSR      SRFILTER
     C     WSKODE        READE     FRISOL01                               35
     C  N35WSSOK2        COMP      FSSOK                                35
     C                   ENDDO
      *
     c                   ENDSL
      *
     c                   EndSr
      *=====================================================================******
      *  FILTRERE POSTER
      *=====================================================================******
     C     SRFILTER      begsr
      * hele SR bør skrives om..
      *   .. er startet som noen få IFsetninger som senere er blitt mer og mer uoversiktlige
      *   MYE ryddigere om en gjør test for test og dersom oppd. eksluderes hopp til slutten
      *
     C     HEOPD         cablt     0             SLfilter                       = Mønsteroppdrag
     C                   IF        HEST <> 'S'
      *
      * Intern bruker - ser i utg.punktet alle, men filter KAN være på
     C     KUNKNRN       ifne      *zeros
     C     KUNKN2N       orne      *zeros
     C     KUNKN2N       orne      *zeros
     c                   exsr      TstIntKnr
     c     SkipKund      cabeq     'Y'           SLfilter
     C                   goto      InternTag
     c                   end
     C                   IF        ((OSCHG = 'J') OR (XINTERN = 'J'))
     C                   goto      InternTag
     c                   end
      *
      * Kundenummer oppdragsgiver
     C     HEKNKF        IFNE      0
     C     HEKNKF        ANDEQ     BIKUNR
     C     HEKNK         ORNE      0
     C     HEKNK         ANDEQ     BIKUNR
     C     HEKNSF        ORNE      0
     C     HEKNSF        ANDEQ     BIKUNR
     C     HEKNS         ORNE      0
     C     HEKNS         ANDEQ     BIKUNR
     C     HEKNA         ORNE      0
     C     HEKNA         ANDEQ     BIKUNR
      *
     c     InternTag     tag
      *
      * når havnekode finnes (=alltid ??) - er det de som vises som fra/til.      ..)
      * BEVARE CONTAINERNR
     C                   MOVE      BLMN          XBLMN            17
     C     BILLOFK       CHAIN     BILLOF                             33
      * FLYTT CONTAINERNR TILBAKE
     C                   MOVE      XBLMN         BLMN
      * når havnekode finnes (=alltid ??) - er det de som vises som fra/til.
     C                   IF        *IN33 = *OFF
     c                   if        BLLSH  <> *BLANKS
     c                   eval      HESDF  = BLLSH
     c                   endif
     c                   if        BLLOH  <> *BLANKS
     c                   eval      HESDT  = BLLOH
     c                   endif
     C                   END
      * TEST PÅ HOUSE-BL (lagret i BLREIS)
     C                   IF        WSREIS <> *BLANKS
     C     BILLOFK       CHAIN     BILLOF
     C     BLREIS        CABLT     WSREIS        SLFILTER
     C     BLREIS        CABGT     WSREISMAX     SLFILTER
     C                   END
      * TEST FRA-STED
     C                   IF        STD(1) <> *BLANKS
     C     1             DO        8             XN2               3 0
     C                   MOVEL     STD(XN2)      XFRASTED          5
     C     XFRASTED      CABEQ     *BLANKS       SLFILTER
     C     XFRASTED      CABEQ     HESDF         STFILTER
     C                   ENDDO
     C                   GOTO      SLFILTER
     C                   END
     C     STFILTER      TAG
      * TEST TIL-STED
     C                   IF        STDT(1) <> *BLANKS
     C     1             DO        8             XN2               3 0
     C                   MOVEL     STDT(XN2)     XTILSTED          5
     C     XTILSTED      CABEQ     *BLANKS       SLFILTER
     C     XTILSTED      CABEQ     HESDT         STFILTER11
     C                   ENDDO
     C                   GOTO      SLFILTER
     C                   END
     C     STFILTER11    TAG
      * TEST FRA-LANDKODE
     C                   IF        LKF(1) <> *BLANKS
     C     1             DO        16            XN2               3 0
     C                   MOVEL     LKF(XN2)      XLANDKODE         2
     C     XLANDKODE     CABEQ     *BLANKS       SLFILTER
     C     XLANDKODE     CABEQ     HELKA         STFILTER12
     C                   ENDDO
     C                   GOTO      SLFILTER
     C                   END
     C     STFILTER12    TAG
      * TEST TIL-LANDKODE
     C                   IF        LKT(1) <> *BLANKS
     C     1             DO        16            XN2               3 0
     C                   MOVEL     LKT(XN2)      XLANDKODE         2
     C     XLANDKODE     CABEQ     *BLANKS       SLFILTER
     C     XLANDKODE     CABEQ     HETRI         STFILTER13
     C                   ENDDO
     C                   GOTO      SLFILTER
     C                   END
     C     STFILTER13    TAG
      * TEST KUN avdelig
     C                   IF        AV(1)  <> *BLANKS
     C                   MOVE      HEAVD         HEAVDA            4
     C     1             DO        10            XN2               3 0
     C                   MOVEL     AV(XN2)       XAVD              4
     C     XAVD          CABEQ     *BLANKS       SLFILTER
     C     XAVD          CABEQ     HEAVDA        STFILTER2
     C                   ENDDO
     C                   GOTO      SLFILTER
     C                   END
     C     STFILTER2     TAG
      *
      * filter på åpne ordre
     c                   SELECT
     C                   WHEN      (((((KUNFRA = *BLANKS) AND
     C                                 (KUNFRA2 = *BLANKS)) AND
     C                                 (KUNFRA3 = *BLANKS)) AND
     C                                 (KUNFRA4 = *BLANKS)) AND
     C                                 (KUNFRA5 = *BLANKS))
     C                   GOTO      STFILTER3
     C                   WHEN      ((KUNFRA <> *BLANKS) AND (KUNFRA = HESDF))
     C                   GOTO      STFILTER3
     C                   WHEN      ((KUNFRA2 <> *BLANKS) AND (KUNFRA2 = HESDF))
     C                   GOTO      STFILTER3
     C                   WHEN      ((KUNFRA3 <> *BLANKS) AND (KUNFRA3 = HESDF))
     C                   GOTO      STFILTER3
     C                   WHEN      ((KUNFRA4 <> *BLANKS) AND (KUNFRA4 = HESDF))
     C                   GOTO      STFILTER3
     C                   WHEN      ((KUNFRA5 <> *BLANKS) AND (KUNFRA5 = HESDF))
     C                   GOTO      STFILTER3
     C                   OTHER
     C                   GOTO      SLFILTER
     C                   ENDSL
     C     STFILTER3     TAG
     c                   SELECT
     C                   WHEN      (((((KUNTIL = *BLANKS) AND
     C                                 (KUNTIL2 = *BLANKS)) AND
     C                                 (KUNTIL3 = *BLANKS)) AND
     C                                 (KUNTIL4 = *BLANKS)) AND
     C                                 (KUNTIL5 = *BLANKS))
     C                   GOTO      STFILTER4
     C                   WHEN      ((KUNTIL <> *BLANKS) AND (KUNTIL = HESDT))
     C                   GOTO      STFILTER4
     C                   WHEN      ((KUNTIL2 <> *BLANKS) AND (KUNTIL2 = HESDT))
     C                   GOTO      STFILTER4
     C                   WHEN      ((KUNTIL3 <> *BLANKS) AND (KUNTIL3 = HESDT))
     C                   GOTO      STFILTER4
     C                   WHEN      ((KUNTIL4 <> *BLANKS) AND (KUNTIL4 = HESDT))
     C                   GOTO      STFILTER4
     C                   WHEN      ((KUNTIL5 <> *BLANKS) AND (KUNTIL5 = HESDT))
     C                   GOTO      STFILTER4
     C                   OTHER
     C                   GOTO      SLFILTER
     C                   ENDSL
     C     STFILTER4     TAG
      *  Ikke vis når POD finnes (men vis dersom det er inqhistory)
     c     PODkey        chain     TRACKl02                           33
     C     *in33         ifeq      '0'
     C                   IF        InqHistory = 'J'
     C     TRACKTK       CHAIN     TRACKT                             33
     C   33              move      *zeros        TXATAD
     C                   EXSR      settabrow
     C                   endif
     C                   goto      SLFILTER
     C                   endif
      *
      * Siste test - dersom ATA-dato ER SATT - IKKE vis (men da skal normalt OT være annen)
     C     TRACKTK       CHAIN     TRACKT                             33
     C  N33              IF        XATAOPD = 'J'
     C                   IF        TXATAD > XDAGT
     C                   EXSR      settabrow
     C                   END
     C                   ELSE
     C  N33              IF        TXATAD = 0
     C                   EXSR      settabrow
     C                   ELSE
      * men ved spørring på history vis kun de MED ATA-dato satt..
     C                   IF        InqHistory = 'J'
     C                   EXSR      settabrow
     c                   END
     C                   END
     C                   END
     C                   END
      *
     C                   END                                                    HEST
      *
     C     SLFILTER      TAG
     C                   ENDSR
      *
      ******************************************
     C     TstIntKnr     begsr
      ******************************************
     c                   move      'N'           SkipKund          1
      * minst ett KUNKN... er oppgitt
     C     KUNKNRN       ifne      *zeros
     C     KUNKNRN       cabeq     HEKNKF        OkKnr
     C     KUNKNRN       cabeq     HEKNK         OkKnr
     C     KUNKNRN       cabeq     HEKNSF        OkKnr
     C     KUNKNRN       cabeq     HEKNS         OkKnr
     C     KUNKNRN       cabeq     HEKNKF        OkKnr
     C     KUNKNRN       cabeq     HEKNA         OkKnr
     C                   end
      *
     C     KUNKN2N       ifne      *zeros
     C     KUNKN2N       cabeq     HEKNKF        OkKnr
     C     KUNKN2N       cabeq     HEKNK         OkKnr
     C     KUNKN2N       cabeq     HEKNSF        OkKnr
     C     KUNKN2N       cabeq     HEKNS         OkKnr
     C     KUNKN2N       cabeq     HEKNKF        OkKnr
     C     KUNKN2N       cabeq     HEKNA         OkKnr
     C                   end
      *
     C     KUNKN3N       ifne      *zeros
     C     KUNKN3N       cabeq     HEKNKF        OkKnr
     C     KUNKN3N       cabeq     HEKNK         OkKnr
     C     KUNKN3N       cabeq     HEKNSF        OkKnr
     C     KUNKN3N       cabeq     HEKNS         OkKnr
     C     KUNKN3N       cabeq     HEKNKF        OkKnr
     C     KUNKN3N       cabeq     HEKNA         OkKnr
     C                   end
      *
      * Har ikke fått match på noen av de oppgitte kundenr - Skipp
     c                   move      'Y'           SkipKund
      *
     C     OkKnr         ENDSR
      *
      *=====================================================================******
      * HENT OPPDRAG
      *=====================================================================******
     C     HENTOPD       BEGSR
      *
     C                   Move      *zeros        AntSnd
     C                   Move      *zeros        AntRcd
     C     MaxSnd        IFEQ      *ZEROS                                       1<-B
     C                   Z-add     1000          MaxSnd
     C                   END                                                    1<-E
     C     MaxRcd        IFEQ      *ZEROS                                       1<-B
     C                   Z-add     50000         MaxRcd
     C                   END                                                    1<-E
      *
     C                   SELECT                                                 1<-B
     C                   WHEN      WSPRON <> 0                                  1
     C     WSPRON        SETLL     HEAD14
     C     WSPRON        READE     HEAD14                                 35
     C                   DOW       *IN35 = *OFF                                  2<-B
     C                   EXSR      SRFILTER
     C     WSPRON        READE     HEAD14                                 35
     C                   ENDDO                                                   2<-E
     C                   WHEN      WSRFA <> *BLANKS                             1
     C     WSRFA35       SETLL     HEAD17
     C     WSRFA35       READE     HEAD17                                 35
     C                   DOW       *IN35 = *OFF                                  2<-B
     C     1             DO        16            XN                3 0            3<-B
     C                   MOVEL     OT(XN)        XOT               2
     C                   IF        XOT = HEOT                                      4<-B
     C                   EXSR      SRFILTER
     C                   LEAVE
     C                   END                                                       4<-E
     C                   ENDDO                                                    3<-E
     C     WSRFA35       READE     HEAD17                                 35
     C                   ENDDO                                                   2<-E
     C                   WHEN      WSBES <> *BLANKS                             1
      * SØK PÅ BESTILLINGSNR
     C     WSBES         SETLL     EPOH04
     C                   READ      EPOH04                                 35
     C  N35WSBESMAX      COMP      EHBES                                35
     C                   DOW       *IN35 = *OFF                                  2<-B
     C                   IF        EHAVD = 0 OR                                   3<-B
     C                             (EHAVD = 9999 AND EHOPD = 9999999)
      * SJEKK/VIS LINJEPLUKK
     C                   MOVE      *ZEROS        AVD
     C                   MOVE      *ZEROS        OPD
     C     EPOLK         SETLL     EPOL
     C     EPOLK         READE     EPOL                                   33
     C                   DOW       *IN33 = *OFF                                    4<-B
     C                   IF        ELAVD > 0                                        5<-B
     C     1             DO        50            XN                3 0               6<-B
     C                   SELECT                                                       7<-B
     C                   WHEN      AVD(XN) = 0                                        7
     C                   EVAL      AVD(XN) = ELAVD
     C                   EVAL      OPD(XN) = ELOPD
     C                   LEAVE
     C                   WHEN      AVD(XN) = ELAVD AND OPD(XN) = ELOPD                7
     C                   GOTO      XNESTEPOL
     C                   ENDSL                                                        7<-E
     C                   ENDDO                                                       6<-E
     C     HEADFKEL      CHAIN     HEADF                                33
     C  N33              EXSR      SRFILTER
     C                   END                                                        5<-E
     C     XNESTEPOL     TAG
     C     EPOLK         READE     EPOL                                   33
     C                   ENDDO                                                     4<-E
     C                   ELSE                                                     3
      * HELE BESTILLING ER PLUKKET.
     C     HEADFKEH      CHAIN     HEADF                              33
     C  N33              EXSR      SRFILTER
     C                   END                                                      3<-E
     C                   READ      EPOH04                                 35
     C  N35WSBESMAX      COMP      EHBES                                35
     C                   ENDDO                                                   2<-E
     C                   WHEN      WSART <> *BLANKS                             1
      * SØK PÅ ARTIKKELNR
     C     WSART         SETLL     EPOL04
     C                   READ      EPOL04                                 35
     C  N35WSARTMAX      COMP      ELART                                35
     C                   DOW       *IN35 = *OFF                                  2<-B
     C                   IF        ELAVD = 0                                      3<-B
      * LINJE ER IKKE PLUKKET. SJEKK OM BESTILLING ER PLUKKET.
     C     EPOH04K       CHAIN     EPOH04                             33
     C  N33HEADFKEH      CHAIN     HEADF                              33
     C                   ELSE                                                     3
      * LINJE ER PLUKKET.
     C     HEADFKEL      CHAIN     HEADF                                33
     C                   END                                                      3<-E
     C  N33              EXSR      SRFILTER
     C                   READ      EPOL04                                 35
     C  N35WSARTMAX      COMP      ELART                                35
     C                   ENDDO                                                   2<-E
     C                   OTHER                                                  1
     C     1             DO        16            XN                3 0           2<-B
     C                   MOVEL     OT(XN)        HEOT
     C                   IF        HEOT <> *BLANKS OR XN = 1                      3<-B
      *
     C     HEOT          SETLL     HEAD30
     C     HEOT          READE     HEAD30                                 35
     C                   DOW       *IN35 = *OFF                                    4<-B
      * diverse filter legges her..
     C                   EXSR      SRFILTER
     C     HEOT          READE     HEAD30                                 35
     C                   ENDDO                                                     4<-E
      *
     C                   END                                                      3<-E
     C                   ENDDO                                                   2<-E
      *
      * SJEKK OM ORDRE HAR FÅTT ATA DE SISTE X-DAGENE.
     C                   IF        XDAGT > 0                                     2<-B
     C                   MOVE      'J'           XATAOPD           1
     C     1             DO        16            XN                3 0            3<-B
     C                   MOVEL     O2(XN)        HEOT
     C                   IF        HEOT <> *BLANKS                                 4<-B
     C     HEOT          SETLL     HEAD30
     C     HEOT          READE     HEAD30                                 35
     C                   DOW       *IN35 = *OFF                                     5<-B
      * diverse filter legges her..
     C                   EXSR      SRFILTER
     C     HEOT          READE     HEAD30                                 35
     C                   ENDDO                                                      5<-E
     C                   END                                                       4<-E
     C                   ENDDO                                                    3<-E
     C                   END                                                     2<-E
      *
     C                   ENDSL                                                  1<-E
      *
     C     SLHENTOPD     TAG
     C                   ENDSR
      *
      *=====================================================================******
      *  Set output variables for section /$tablerow (table row)
      *=====================================================================******
     C     SetTabRow     begsr
      * SJEKK OM DET ER POMS-OPPDRAG
     C                   EVAL      XHERFA = HERFA
     C                   MOVE      'N'           XPOMS             1
     C                   SELECT                                                 1<-B
     C                   WHEN      WSBES = *BLANKS AND WSART = *BLANKS          1
     C     EPOH02K       CHAIN     EPOH02                             33
     C   33EPOH02K       CHAIN     EPOL02                             33
     C                   IF        *IN33                                         2<-B
     C     HEPRO         CHAIN     TURER14                            33
     C  N33TUSG          COMP      '*PM'                              3333
     C  N33TUATD         COMP      0                                  3333
     C                   END                                                     2<-E
     C  N33              EVAL      HERFA = 'POMS'
     C  N33              EVAL      XPOMS  = 'J'
     C                   WHEN      WSBES <> *BLANKS                             1
     C                   EVAL      HERFA = EHBES
     C                   EVAL      XPOMS  = 'J'
     C                   OTHER                                                  1
     C                   EVAL      HERFA = ELART
     C                   EVAL      XPOMS  = 'J'
     C                   ENDSL                                                  1<-E
      *
     C     ARKIVL02K     Chain     arkivl02                           33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   IF        ARTYPE = 'ZO'                                 2<-B
     C                   LEAVE
     C                   END                                                     2<-E
     C     ARTYPE        LOOKUP    A2                                     34
     C   34              LEAVE
     C     ARKIVL02K     READE     arkivl02                               33
     C                   ENDDO                                                  1<-E
     c  N33              MOVE      'X'           XOPPLAST
     c   33              MOVE      ' '           XOPPLAST
      * HENT B/L-NR OG CONTAINERNR
     C                   IF        InqHistory = 'J'                             1<-B
     C                   MOVE      BVMN          XBVMN            17
     C                   END                                                    1<-E
     C     BILLOFK       CHAIN     BILLOF                             33
     C                   IF        InqHistory = 'J'                             1<-B
     C                   MOVE      XBVMN         BVMN
     C                   END                                                    1<-E
     C                   MOVE      *BLANKS       WSCONTNR
     C                   MOVE      *BLANKS       WSCONTTY
     C                   IF        *IN33                                        1<-B
      * INGEN B/L FINNES
     C                   ELSE                                                   1
     C                   IF        InqHistory = 'J'                              2<-B
     C                   EVAL      WSCONTNR = BVMN
     C                   ELSE                                                    2
     C     BILLOFK       CHAIN     BLV1                               33
     C                   DOW       *IN33 = *OFF                                   3<-B
     C                   IF        BVMN <> *BLANKS                                 4<-B
     C                   IF        WSCONTNR = *BLANKS                               5<-B
     C                   EVAL      WSCONTNR = %TRIM(BVMN) + ' ' + BVKDC
     C                   EVAL      WSCONTTY = BVKDC
     C                   ELSE                                                       5
     C                   EVAL      WSCONTNR = %TRIM(WSCONTNR) + '<br>'
     C                             + %TRIM(BVMN) + ' ' + BVKDC
     C                   EVAL      WSCONTTY = %TRIM(WSCONTTY) + '<br>'
     C                             + %TRIM(BVKDC)
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C     BILLOFK       READE     BLV1                                   33
     C                   ENDDO                                                    3<-E
     C                   END                                                     2<-E
      *
     C                   END                                                    1<-E
      *
     C                   callp     updHTMLvar('HEAVD':
     C                             %trim(%editc(HEAVD:'Z')))
     C                   callp     updHTMLvar('HEOPD':
     C                             %trim(%editc(HEOPD:'Z')))
     C*                  EVAL      SYSREF = %trim(%editc(HEAVD:'Z'))
     C*                            + '/' + %trim(%editc(HEOPD:'Z'))
     C                   MOVEL     HEAVD         SYSREF
     C                   MOVE      HEOPD         SYSREF
     C                   EVAL      %SUBST(SYSREF:5:1) = '_'
     C                   callp     updHTMLvar('SYSREF':SYSREF)
     C                   callp     updHTMLvar('HEPRO':
     C                             %trim(%editc(HEPRO:'Z')))
     C                   SELECT
     C                   WHEN      WSBES <> *BLANKS
     C                   callp     updHTMLvar('HERFA':EHBES)
     C                   WHEN      WSART <> *BLANKS
     C                   callp     updHTMLvar('HERFA':ELART)
     C                   OTHER
     C                   callp     updHTMLvar('HERFA':HERFA)
     C                   ENDSL
     C                   SELECT
     C                   WHEN      WSBES <> *BLANKS
     C                   EVAL      XHERFA = 'Order'
     C                   WHEN      WSART <> *BLANKS
     C                   EVAL      XHERFA = 'Order'
     C                   OTHER
     C                   EVAL      XHERFA = *BLANKS
     C                   ENDSL
     C                   callp     updHTMLvar('XHERFA':XHERFA)
     c     XOPPLAST      ifeq      ' '
     C                   callp     updHTMLvar('OPPLSYMBOL':'Blank.gif')
     C                   callp     updHTMLvar('DOC':' ')
     c                   else
     C                   callp     updHTMLvar('OPPLSYMBOL':'Binders01.jpg')
     C                   callp     updHTMLvar('DOC':'Y')
     c                   end
     C                   callp     updHTMLvar('HENAS':HENAS)
     C                   callp     updHTMLvar('HENAK':HENAK)
     C                   callp     updHTMLvar('HESDF':HESDF)
     C                   callp     updHTMLvar('HESDT':HESDT)
     C                   SELECT
     C                   WHEN      TXATAD <> 0
     C                   EVAL      XSTATUS = 'Arrived  '
     C                   WHEN      TXATDD <> 0
     C                   EVAL      XSTATUS = 'Shipped  '
     C                   WHEN      BLMM    = 'New'
     C                   EVAL      XSTATUS = 'New'
     C                   WHEN      BLMM    = 'Updated'
     C                   EVAL      XSTATUS = 'Updated'
     C                   OTHER
     C                   MOVE      *ZEROS        BLKNR
     C                   MOVE      *BLANKS       BVMN
     C  N33BILLOFK       SETLL     BLV1
     C  N33BILLOFK       READE     BLV1                                   33
     C                   DOW       *IN33 = *OFF
     C                   IF        BVMN <> *BLANKS
     C                   LEAVE
     C                   END
     C     BILLOFK       READE     BLV1                                   33
     C                   ENDDO
     C                   SELECT
     C                   WHEN      ((BVMN <> *BLANKS) and (BVMN <> '?'))
     C                   EVAL      XSTATUS = 'Confirmed'
     C                   WHEN      TXETDD <> 0
     C                   EVAL      XSTATUS = 'Booked'
     C                   WHEN      BVMN    = *BLANKS
     C                   EVAL      XSTATUS = 'Pending'
     C                   OTHER
     C                   EVAL      XSTATUS = 'Pending'
     C                   ENDSL
     C                   ENDSL
     C                   callp     updHTMLvar('STATUS':XSTATUS)
     C                   callp     updHTMLvar('ST':XSTATUS)
      *
     c                   MOVE      'Unch'        CHDStat
     c                   MOVEL     *BLANKS       CHDSTATR
     c                   MOVE      *ZEROS        XLASTCHG          8 0
     c     CHDKey        setgt     Trackl02
     c     CHDKeyE       readpe    trackl02                               33
     c     *in33         ifeq      *off                                         1<-B
     c     TTEDEV        ifeq      *blanks                                       2<-B
     c                   MOVE      TTDATE        XLASTCHG
     c                   MOVE      'Chgd'        CHDStat
     C                   MOVEL     TTEDRE        CHDSTATR
     C                   MOVEL     TTTEXT        XAN03             3
     C                   IF        (((XAN03 = 'ETD') OR                           3<-B
     C                               (XAN03 = 'ETA')) OR
     C                               (XAN03 = 'ATD'))
     C     '00000000'    SCAN      TTTEXT                                 33
     C   33              EVAL      CHDSTATR = 'NY'
     C                   END                                                      3<-E
      *
     C                   IF        CHDSTATR = '00 '                               3<-B
     C                   DOW       *IN33 = *OFF                                    4<-B
     c     CHDKeyE       readpe    trackl02                               33
     c  N33TTEDEV        COMP      *blanks                            3333
     c  N33              IF        CHDSTATR <> '00 '                                5<-B
     C                   MOVEL     TTEDRE        CHDSTATR
     C                   END                                                        5<-E
     C                   ENDDO                                                     4<-E
     C                   END                                                      3<-E
     c                   else                                                    2
     c                   MOVE      'Read'        CHDstat
     c                   endif                                                   2<-E
     c                   endif                                                  1<-E
      *
     c                   move      *blanks       DaTBGcol         20
     c                   select
     c     CHDStat       wheneq    'Chgd'
     c                   eval      CHDStatL = 'Changed'
     C                   IF        CHDSTATR <> '00 '
     c                   eval      DatBGcol='BGCOLOR="#EE9A00"'
     C                   END
     c     CHDStat       wheneq    'Read'
     c                   eval      CHDStatL = 'Read'
     c     CHDStat       wheneq    'Unch'
     c*                  eval      CHDStatL = 'UnChanged'
     c                   move      *blanks       ChdStat
     c                   move      *blanks       ChdStatL
     c                   endsl
     C                   callp     updHTMLvar('CHDStat':CHDStat)
     C                   callp     updHTMLvar('CHDStatL':CHDStatL)
     C                   callp     updHTMLvar('CDS':CHDStatL)
     C                   callp     updHTMLvar('DaTBGcol':DaTBGcol)
      *
     C                   callp     updHTMLvar('WSCONTNR':WSCONTNR)
     C                   callp     updHTMLvar('CON':WSCONTNR)
     C                   callp     updHTMLvar('CT':WSCONTTY)
     C                   callp     updHTMLvar('BLBLNR':BLBLNR)
     C                   callp     updHTMLvar('BL':BLBLNR)
     C                   callp     updHTMLvar('BLORR':BLCH)
     C                   callp     updHTMLvar('ORR':BLCH)
     C                   callp     updHTMLvar('TR':BLTR)
      *
     C     TXOS02        ifne      *zeros
     C                   callp     updHTMLvar('TXOS02':
     C                             %trim(%editw(TXOS02:'    .  .  ')))
     c                   else
     C                   callp     updHTMLvar('TXOS02':'__________')
     c                   end
      *
     C     XLASTCHG      ifne      *zeros
     C                   callp     updHTMLvar('XLASTCHG':
     C                             %trim(%editw(XLASTCHG:'    .  .  ')))
     c                   else
     C                   callp     updHTMLvar('XLASTCHG':'__________')
     c                   end
     C     TXETDD        ifne      *zeros
     C                   callp     updHTMLvar('TXETDD':
     C                             %trim(%editw(TXETDD:'    .  .  ')))
     c                   else
     C                   callp     updHTMLvar('TXETDD':'__________')
     c                   end
     C     TXATDD        ifne      *zeros
     C                   callp     updHTMLvar('TXATDD':
     C                             %trim(%editw(TXATDD:'    .  .  ')))
     c                   else
     C                   callp     updHTMLvar('TXATDD':'__________')
     c                   end
     C     TXETAD        ifne      *zeros
     C                   callp     updHTMLvar('TXETAD':
     C                             %trim(%editw(TXETAD:'    .  .  ')))
     c                   else
     C                   callp     updHTMLvar('TXETAD':'__________')
     c                   end
     C     TXATAD        ifne      *zeros
     C                   callp     updHTMLvar('TXATAD':
     C                             %trim(%editw(TXATAD:'    .  .  ')))
     c                   else
     C                   callp     updHTMLvar('TXATAD':'__________')
     c                   end
      *
     C                   callp     updHTMLvar('HENT':
     C                             %trim(%editc(HENT:'Z')))
     C                   callp     updHtmlVar('HEVKT':
     C                             %trim(%editc(HEVKT:'Z')))
     c     hem3          ifne      *zeros
     C                   callp     updHtmlVar('HEM3':
     C                             %trim(%editw(HEM3:'    .   ')))
     c                   else
     C                   callp     updHTMLvar('HEM3':'0.000')
     c                   end
     C                   callp     updHtmlVar('HELM':
     C                             %trim(%editw(HELM:' 0.  ')))
      *
     C                   callp     wrtsection('tablerow')
     C                   callp     wrtsection('rowChg1')
     C                   callp     wrtsection('rowChg2')
     C                   IF        XPOMS = 'J'                                   2<-B
     C                   callp     wrtsection('rowPO02')
     C                   ELSE                                                    2
     C                   callp     wrtsection('rowPO01')
     C                   END                                                     2<-E
     C                   callp     wrtsection('rowPO03')
     C                   IF        XDAGT > 0                                     2<-B
     C                   callp     wrtsection('rowChg3')
     C                   ELSE                                                    2
     C                   callp     wrtsection('rowChg4')
     C                   END                                                     2<-E
     C                   callp     wrtsection('rowChg5')
     C                   Add       1             AntSnd
      *
     C                   endsr
      *=====================================================================******
      * Set html output skeleton member/read into memory
      *=====================================================================******
     C     SetSkl        begsr
      *------------------
     C                   eval      IfsMultIndicators = gethtmlifsmult(
     C                             '/syspeddev/html/Header/eSpedTop.html -
     C                             /syspeddev/html/ESOVERS1S.html -
     C                             /syspeddev/html/Footer/eSpedBotEN.html':
     C                             '/CGITAG/')
     C                   endsr
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   OPEN      BRIDF
     C     WSUSER        CHAIN(N)  BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
OddEv * hent Parametre som går igjen i mange prog:
OddEv *      Odd/Even/Rowhead-farger,Logobilde,Språk,Intern/Ekstern bruker,  mm
OddEvc                   call      'ESGETPAR'
OddEvc                   parm                    BIBRID
OddEvc                   parm                    BIFIRM
OddEvc                   parm                    BIKUNR
OddEvc                   parm                    BIKNG
OddEvc                   parm                    RowHead          10
OddEvc                   parm                    Odd              10
OddEvc                   parm                    Even             10
OddEvc                   parm                    LogoImg          50
OddEvc                   parm                    XSPRÅK            2
OddEvc                   parm                    XINTERN           1
OddEvc                   parm                    ParmDS1        1024
OddEvc                   parm                    ParmDS2        1024
OddEvc                   parm                    ParmDS3        1024
      * HENTER PARAMETER
     C                   CALL      'ESGETOS'
     C                   parm                    BIBRID
     C                   parm                    BIFIRM
     C                   parm                    BIKUNR
     C                   parm                    BIKNG
     C                   parm                    ParmOS1        1024
      *
     C                   open      HEADF                                50
     C                   OPEN      HEAD14
     C                   OPEN      HEAD17
     C                   OPEN      HEAD30
     C                   OPEN      BILLOF
     C                   OPEN      BILLOFLG
     C                   OPEN      BLV1
     C                   OPEN      BLJOINLF
     C                   OPEN      EPOH02
     C                   OPEN      EPOH04
     C                   OPEN      EPOL02
     C                   OPEN      EPOL04
     C                   OPEN      EPOL
     C                   OPEN      TURER14
     C                   OPEN      TRACKT
     C                   OPEN      TRACKL02
     C                   OPEN      ARKIVL02
     C                   OPEN      BRPARF
     C                   OPEN      KODTA
     C                   OPEN      FRISOK
     C                   OPEN      FRISOL01
     C                   OPEN      KALENDER
     C                   open      BRPARF                               50
     C                   open      CUNDL01
      *
     C     KunKey        klist
     C                   kfld                    BIFIRM
     C                   kfld                    BIKUNR
     C     TRACKTK       KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     BILLOFK       KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     BILLWSK       KLIST
     C                   KFLD                    WBAVD
     C                   KFLD                    WBOPD
     C     EPOH02K       KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     EPOH04K       KLIST
     C                   KFLD                    ELBES
     C                   KFLD                    ELKUND
     C     EPOLK         KLIST
     C                   KFLD                    EHKUND
     C                   KFLD                    EHBES
     C     FRISOL01K     KLIST
     C                   KFLD                    WSKODE
     C                   KFLD                    WSSOK
     C     HEADFK        KLIST
     C                   KFLD                    BLAVD
     C                   KFLD                    BLOPD
     C     HEADFKEH      KLIST
     C                   KFLD                    EHAVD
     C                   KFLD                    EHOPD
     C     HEADFKEL      KLIST
     C                   KFLD                    ELAVD
     C                   KFLD                    ELOPD
     C     ARKIVL02K     KLIST
     C                   KFLD                    UNKODE
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   MOVE      'A'           UNKODE            1
     c     CHDKey        Klist
     c                   kfld                    HEAVD
     c                   kfld                    HEOPD
     c                   kfld                    TTFBNR
     c                   kfld                    CHDACT
     c                   kfld                    MAXDAT
     c                   move      'CHD'         CHDACT            3
     c                   move      99999999      Maxdat            8 0
     c     CHDKeyE       Klist
     c                   kfld                    HEAVD
     c                   kfld                    HEOPD
     c                   kfld                    TTFBNR
     c                   kfld                    CHDACT
     c     PODKey        Klist
     c                   kfld                    HEAVD
     c                   kfld                    HEOPD
     c                   kfld                    TTFBNR
     c                   kfld                    PODACT
     c                   move      'POD'         PODACT            3
     c     KODTAK        Klist
     c                   kfld                    KOAUNI
     c                   kfld                    KOAAVD
     c                   MOVE      'A'           KOAUNI
      *
     C     BRPARFK       klist
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
      *
     C                   EVAL      PABRID = WSUSER
      * Vis kun dokumeter bruker er autorisert for å se...
     C                   move      *blanks       ATString
     C                   MOVE      'ARKTY'       PAID
     C     BRPARFK       chain     BRPARF                             33
     C                   IF        *IN33 = *OFF
     C                   movel     Pavrda        ATstring1
     C     BRPARFK       READE     BRPARF                                 33
     C  N33              movel     Pavrda        ATstring2
     C  N33BRPARFK       READE     BRPARF                                 33
     C  N33              movel     Pavrda        ATstring3
     C  N33BRPARFK       READE     BRPARF                                 33
     C  N33              movel     Pavrda        ATstring4
     C     1             DO        64            ln                2 0
     c                   movea     AT(ln)        A2(ln)
     c                   end
     C                   END
      *
     c     FirmKey       klist
     c                   kfld                    DFTUSER          10
     c                   kfld                    NULLKU            8 0
     c                   kfld                    PAID
      *
     c                   Eval      DFTUSER = '*KUNDFT*'+BIFIRM
     C                   MOVEL     'OSPOF'       PAID
     C     FirmKey       Chain     BRPARF                             33
     c     FrisokKey     klist
     c                   kfld                    HEAVD
     c                   kfld                    HEOPD
     c                   kfld                    FSKODE
     C                   MOVEL     PAVRDA        OSPOF_KD          3
      *
     c                   Eval      DFTUSER = '*KUNDFT*'+BIFIRM
     C                   MOVEL     'OSDAG'       PAID
     C     FirmKey       Chain     BRPARF                             33
     c   33              Eval      DFTUSER = WSUSER
     C   33FirmKey       Chain     BRPARF                             33
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   IF        *IN33
     C                   MOVE      *ZEROS        XDAGT             8 0
     C                   ELSE
     C                   MOVE      WDT           XDAGT
     C                   IF        PAVRDN > 10
     C                   EVAL      PAVRDN = 10
     C                   END
     C     XDAGT         SETLL     KALENDER
     C                   Z-ADD     PAVRDN        XN                3 0
     C     1             DO        XN
     C                   READP     KALENDER                               33
     C                   ENDDO
     C                   MOVE      KADATE        XDAGT
     C                   END
      *
     c     KunKey        chain     cundl01                            33
     C                   MOVE      *BLANKS       CHDStat           4            Changed date status
     C                   MOVE      *BLANKS       CHDStatR          3            REASON
     c                   move      *blanks       CHDStatL         20            Change-statsu LONG
      *
     C                   endsr
      *=====================================================================******
      *  AVSLUTT
      *=====================================================================******
     C     EXIT          begsr
     C                   close     BRPARF
     C                   close     BRIDF
     C                   CLOSE     HEADF
     C                   CLOSE     HEAD14
     C                   CLOSE     HEAD17
     C                   CLOSE     HEAD30
     C                   CLOSE     BILLOF
     C                   CLOSE     BILLOFLG
     C                   CLOSE     BLV1
     C                   CLOSE     BLJOINLF
     C                   CLOSE     EPOH02
     C                   CLOSE     EPOH04
     C                   CLOSE     EPOL02
     C                   CLOSE     EPOL04
     C                   CLOSE     EPOL
     C                   CLOSE     TURER14
     C                   CLOSE     TRACKT
     C                   CLOSE     TRACKL02
     C                   CLOSE     ARKIVL02
     C                   CLOSE     BRPARF
     C                   CLOSE     KODTA
     C                   CLOSE     FRISOK
     C                   CLOSE     FRISOL01
     C                   CLOSE     KALENDER
     C                   close     CUNDL01
     C                   eval      *inlr = *on
      *
     C                   endsr
