      ***********************************************************
      *** PROGRAM SKAL KONVERTER ACK/NAC XML.MELDING          ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01 02 04 07 09-11 13-24          ***
      *** LEDIGE INDIKATORER 27-29 31 32 34-39 41-88 95-97    ***
      ***********************************************************
      *
     FXMLRCVF   IF   E           K DISK
     FXMLRCVF01 IF   E           K DISK    RENAME(XMLRCVFR:XMLRCVFR01)
     FXMLRCVF02 IF   E           K DISK    RENAME(XMLRCVFR:XMLRCVFR02)
     FXMLRCVF03 IF   E           K DISK    RENAME(XMLRCVFR:XMLRCVFR03)
     FXMLRCVF04 IF   E           K DISK    RENAME(XMLRCVFR:XMLRCVFR04)
     FXMLRCVF05 IF   E           K DISK    RENAME(XMLRCVFR:XMLRCVFR05)
     FXMLRCAF   IF   E           K DISK
     FEDIM      O  A E             DISK
     FEDIC      UF   E             DISK
     FHEADF     IF   E           K DISK
     FTRACKF    O  A E             DISK
     D                SDS
     D  ZUSER                254    263
      *
     C                   EXSR      INIT
      *
     C                   EXSR      SRXML1
      *
     C                   EVAL      *INLR = *ON
     C                   RETURN
      *
      ***********************************************
     C     SRXML1        BEGSR
      ***********************************************
      *
     C     XRSN          SETLL     XMLRCVF
     C     XRSN          READE     XMLRCVF                                33
     C                   DOW       *IN33 = *OFF
     C                   SELECT
     C                   WHEN      XRNV = 'MessageDetails'
     C                   EXSR      SRXML2
     C                   WHEN      XRNV = 'EventStructure'
     C                   EXSR      SRXML3
     C                   EXSR      SROPD
     C                   END
     C     XRSN          READE     XMLRCVF                                33
     C                   ENDDO
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML2        BEGSR
      ***********************************************
      *
     C                   EVAL      X000_XRLEV1 = XRLEV1
     C                   EVAL      X000_XRLEV2 = 1
     C                   EVAL      X000_XRLEV3 = 0
      *
     C     XMLKEY00      CHAIN     XMLRCVF                            33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'MessageSender'                        2
      * Avsender-id
     C     XMLRCAFK      SETLL     XMLRCAF
     C     XMLRCAFK      READE     XMLRCAF                                33
     C                   DOW       *IN33 = *OFF                                   3<-B
     C                   IF        XRATN = 'partyId'                               4<-B
     C                   EVAL      M0004 = XRATV
     C                   LEAVE
     C                   END                                                       4<-E
     C     XMLRCAFK      READE     XMLRCAF                                33
     C                   ENDDO                                                    3<-E
     C                   WHEN      XRNV = 'MessageRecipient'                     2
      * Mottaker-id
     C     XMLRCAFK      SETLL     XMLRCAF
     C     XMLRCAFK      READE     XMLRCAF                                33
     C                   DOW       *IN33 = *OFF                                   3<-B
     C                   IF        XRATN = 'partyId'                               4<-B
     C                   EVAL      M0010 = XRATV
     C                   LEAVE
     C                   END                                                       4<-E
     C     XMLRCAFK      READE     XMLRCAF                                33
     C                   ENDDO                                                    3<-E
     C                   WHEN      XRNV = 'MessageDate'                          2
     C                   EVAL      M0062 = %SUBST(XRVERD:1:4) +
     C                             %SUBST(XRVERD:6:2) + %SUBST(XRVERD:9:2) +
     C                             %SUBST(XRVERD:12:2) + %SUBST(XRVERD:15:2) +
     C                             %SUBST(XRVERD:18:2)
     C                   ENDSL                                                   2<-E
     C                   ADD       1             X000_XRLEV2
     C     XMLKEY00      CHAIN     XMLRCVF                            33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML3        BEGSR
      ***********************************************
     C                   MOVE      *BLANKS       XAVD              4
     C                   MOVE      *BLANKS       XOPD              7
     C                   MOVE      *BLANKS       XEC               2
     C                   MOVE      *BLANKS       XRC               3
     C                   MOVE      *BLANKS       XDTE              8
     C                   MOVE      *BLANKS       XTME              6
     C                   MOVE      *BLANKS       XTXT1            70
     C                   MOVE      *BLANKS       XTXT2            70
      *
     C                   EVAL      X000_XRLEV1 = XRLEV1
     C                   EVAL      X000_XRLEV2 = 1
     C                   EVAL      X000_XRLEV3 = 0
      *
     C     XMLKEY00      CHAIN     XMLRCVF                            33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'ConsignmentSet'                       2
     C                   EXSR      SRXML301
     C                   ENDSL                                                   2<-E
     C                   ADD       1             X000_XRLEV2
     C     XMLKEY00      CHAIN     XMLRCVF                            33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML301      BEGSR
      ***********************************************
      *
     C                   EVAL      X001_XRLEV1 = XRLEV1
     C                   EVAL      X001_XRLEV2 = XRLEV2
     C                   EVAL      X001_XRLEV3 = 1
     C                   EVAL      X001_XRLEV4 = 0
      *
     C     XMLKEY01      CHAIN     XMLRCVF01                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'Consignment'                          2
     C                   EXSR      SRXML301A
     C                   WHEN      XRNV = 'EventSet'                             2
     C                   EXSR      SRXML301B
     C                   ENDSL                                                   2<-E
      *
     C                   EVAL      X001_XRLEV3 = X001_XRLEV3 + 1
     C     XMLKEY01      CHAIN     XMLRCVF01                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML301A     BEGSR
      ***********************************************
      *
     C                   EVAL      X002_XRLEV1 = XRLEV1
     C                   EVAL      X002_XRLEV2 = XRLEV2
     C                   EVAL      X002_XRLEV3 = XRLEV3
     C                   EVAL      X002_XRLEV4 = 1
      *
     C     XMLKEY02      CHAIN     XMLRCVF02                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'Reference'                            2
     C                   EXSR      SRXML301A01
     C                   ENDSL
     C                   EVAL      X002_XRLEV4 = X002_XRLEV4 + 1
     C     XMLKEY02      CHAIN     XMLRCVF02                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML301A01   BEGSR
      ***********************************************
      *
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = XRLEV4
     C                   EVAL      X003_XRLEV5 = 1
      *
     C     XMLKEY03      CHAIN     XMLRCVF03                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'ReferenceNo'                          2
     C                   EVAL      XAVD = %SUBST(XRVERD:1:4)
     C                   EVAL      XOPD = %SUBST(XRVERD:6:7)
     C                   LEAVE
     C                   ENDSL
     C                   EVAL      X003_XRLEV5 = X003_XRLEV5 + 1
     C     XMLKEY03      CHAIN     XMLRCVF03                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML301B     BEGSR
      ***********************************************
      *
     C                   EVAL      X002_XRLEV1 = XRLEV1
     C                   EVAL      X002_XRLEV2 = XRLEV2
     C                   EVAL      X002_XRLEV3 = XRLEV3
     C                   EVAL      X002_XRLEV4 = 1
      *
     C     XMLKEY02      CHAIN     XMLRCVF02                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'Event'                                2
     C                   EXSR      SRXML301B01
     C                   ENDSL
     C                   EVAL      X002_XRLEV4 = X002_XRLEV4 + 1
     C     XMLKEY02      CHAIN     XMLRCVF02                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML301B01   BEGSR
      ***********************************************
      *
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = XRLEV4
     C                   EVAL      X003_XRLEV5 = 1
      *
     C     XMLKEY03      CHAIN     XMLRCVF03                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'Type'                                 2
     C                   WHEN      XRNV = 'EventCode'                            2
     C                   EVAL      XEC = XRVERD
     C                   WHEN      XRNV = 'DateAndTimes'                         2
     C                   EXSR      SRXML301B01A
     C                   WHEN      XRNV = 'FreeText'                             2
     C                   EXSR      SRXML301B01B
     C                   WHEN      XRNV = 'Reason'                               2
     C                   EXSR      SRXML301B01C
     C                   ENDSL
     C                   EVAL      X003_XRLEV5 = X003_XRLEV5 + 1
     C     XMLKEY03      CHAIN     XMLRCVF03                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML301B01A  BEGSR
      ***********************************************
      *
     C                   EVAL      X004_XRLEV1 = XRLEV1
     C                   EVAL      X004_XRLEV2 = XRLEV2
     C                   EVAL      X004_XRLEV3 = XRLEV3
     C                   EVAL      X004_XRLEV4 = XRLEV4
     C                   EVAL      X004_XRLEV5 = XRLEV5
     C                   EVAL      X004_XRLEV6 = 1
      *
     C     XMLKEY04      CHAIN     XMLRCVF04                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'DateTime'                             2
     C                   EVAL      XDTE = %SUBST(XRVERD:1:4) +
     C                             %SUBST(XRVERD:6:2) + %SUBST(XRVERD:9:2)
     C                   EVAL      XTME = %SUBST(XRVERD:12:2) +
     C                             %SUBST(XRVERD:15:2) + %SUBST(XRVERD:18:2)
     C                   LEAVE
     C                   ENDSL
     C                   EVAL      X004_XRLEV6 = X004_XRLEV6 + 1
     C     XMLKEY04      CHAIN     XMLRCVF04                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML301B01B  BEGSR
      ***********************************************
      *
     C                   EVAL      X004_XRLEV1 = XRLEV1
     C                   EVAL      X004_XRLEV2 = XRLEV2
     C                   EVAL      X004_XRLEV3 = XRLEV3
     C                   EVAL      X004_XRLEV4 = XRLEV4
     C                   EVAL      X004_XRLEV5 = XRLEV5
     C                   EVAL      X004_XRLEV6 = 1
      *
     C     XMLKEY04      CHAIN     XMLRCVF04                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'Usage'                                2
     C                   WHEN      XRNV = 'Text'                                 2
     C                   EVAL      XTXT1 = XRVERD
     C                   LEAVE
     C                   ENDSL
     C                   EVAL      X004_XRLEV6 = X004_XRLEV6 + 1
     C     XMLKEY04      CHAIN     XMLRCVF04                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML301B01C  BEGSR
      ***********************************************
      *
     C                   EVAL      X004_XRLEV1 = XRLEV1
     C                   EVAL      X004_XRLEV2 = XRLEV2
     C                   EVAL      X004_XRLEV3 = XRLEV3
     C                   EVAL      X004_XRLEV4 = XRLEV4
     C                   EVAL      X004_XRLEV5 = XRLEV5
     C                   EVAL      X004_XRLEV6 = 1
      *
     C     XMLKEY04      CHAIN     XMLRCVF04                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'ReasonCode'                           2
     C                   WHEN      XRNV = 'FreeText'                             2
     C                   EXSR      SRXML301B01C1
     C                   LEAVE
     C                   ENDSL
     C                   EVAL      X004_XRLEV6 = X004_XRLEV6 + 1
     C     XMLKEY04      CHAIN     XMLRCVF04                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML301B01C1 BEGSR
      ***********************************************
      *
     C                   EVAL      X005_XRLEV1 = XRLEV1
     C                   EVAL      X005_XRLEV2 = XRLEV2
     C                   EVAL      X005_XRLEV3 = XRLEV3
     C                   EVAL      X005_XRLEV4 = XRLEV4
     C                   EVAL      X005_XRLEV5 = XRLEV5
     C                   EVAL      X005_XRLEV6 = XRLEV6
     C                   EVAL      X005_XRLEV7 = 1
      *
     C     XMLKEY05      CHAIN     XMLRCVF05                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'Usage'                                2
     C                   WHEN      XRNV = 'Text'                                 2
     C                   EVAL      XTXT2 = XRVERD
     C                   LEAVE
     C                   ENDSL
     C                   EVAL      X005_XRLEV7 = X005_XRLEV7 + 1
     C     XMLKEY05      CHAIN     XMLRCVF05                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SROPD         BEGSR
      ***********************************************
     C                   MOVE      XAVD          HEAVD
     C                   MOVE      XOPD          HEOPD
     C     HEADFK        CHAIN     HEADF                              33
     C                   IF        *IN33 = *OFF
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C                   IF        XEC = 'U3'
     C                   MOVE      'ACK'         TTACTI
     C                   ELSE
     C                   MOVE      'NAC'         TTACTI
     C                   END
     C                   MOVE      XDTE          TTDATE
     C                   MOVE      XTME          TTTIME
     C                   MOVEL     XTXT1         TTTEXT
     C                   IF        XTXT2 = *BLANKS
     C                   MOVEL     XTXT1         TTTEXL
     C                   ELSE
     C                   MOVEL     XTXT2         TTTEXL
     C                   END
     C                   MOVE      ZUSER         TTUSER
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
     C                   MOVEL     XEC           TTEDEV
     C                   MOVEL     XRC           TTEDRE
     C                   MOVE      'E'           TTMANU
      *
     C                   WRITE     TRACKFR
      *
     C                   END
      *
     C                   EXSR      SROPDEDI
      *
     C                   ENDSR
      *
      ***********************************************
     C     SROPDEDI      BEGSR
      ***********************************************
     C     1             CHAIN     EDIC                               33
     C                   ADD       1             CMN
     C                   UPDATE    EDICR
      *
     C                   MOVE      'XMLRST'      M0065
     C                   EVAL      M0068 = M0062
     C                   IF        XEC = 'U3'
     C                   MOVE      'ACK'         M1001
     C                   ELSE
     C                   MOVE      'NAC'         M1001
     C                   END
     C                   MOVE      *BLANKS       M1004
     C                   EVAL      M1225 = XEC
      *
     C                   MOVE      XRSN          MSN
     C                   Z-ADD     CMN           MMN
     C                   MOVE      'R'           MSR
     C                   MOVE      'C'           MST
     C                   MOVE      WDT           MDT
     C                   MOVE      WTM           MTM
     C                   MOVE      HEAVD         MAVD
     C                   MOVE      HEOPD         MTDN
      *
     C                   WRITE     EDIMR
      *
     C                   ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    USN               9
      *
     C     HEADFK        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     XMLKEY00      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X000_XRLEV1
     C                   KFLD                    X000_XRLEV2
     C                   KFLD                    X000_XRLEV3
     C     XMLKEY01      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X001_XRLEV1
     C                   KFLD                    X001_XRLEV2
     C                   KFLD                    X001_XRLEV3
     C                   KFLD                    X001_XRLEV4
     C     XMLKEY02      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X002_XRLEV1
     C                   KFLD                    X002_XRLEV2
     C                   KFLD                    X002_XRLEV3
     C                   KFLD                    X002_XRLEV4
     C                   KFLD                    X002_XRLEV5
     C     XMLKEY03      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X003_XRLEV1
     C                   KFLD                    X003_XRLEV2
     C                   KFLD                    X003_XRLEV3
     C                   KFLD                    X003_XRLEV4
     C                   KFLD                    X003_XRLEV5
     C                   KFLD                    X003_XRLEV6
     C     XMLKEY04      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X004_XRLEV1
     C                   KFLD                    X004_XRLEV2
     C                   KFLD                    X004_XRLEV3
     C                   KFLD                    X004_XRLEV4
     C                   KFLD                    X004_XRLEV5
     C                   KFLD                    X004_XRLEV6
     C                   KFLD                    X004_XRLEV7
     C     XMLKEY05      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X005_XRLEV1
     C                   KFLD                    X005_XRLEV2
     C                   KFLD                    X005_XRLEV3
     C                   KFLD                    X005_XRLEV4
     C                   KFLD                    X005_XRLEV5
     C                   KFLD                    X005_XRLEV6
     C                   KFLD                    X005_XRLEV7
     C                   KFLD                    X005_XRLEV8
     C     XMLRCAFK      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    XRLEV1
     C                   KFLD                    XRLEV2
     C                   KFLD                    XRLEV3
     C                   KFLD                    XRLEV4
     C                   KFLD                    XRLEV5
     C                   KFLD                    XRLEV6
     C                   KFLD                    XRLEV7
     C                   KFLD                    XRLEV8
     C                   KFLD                    XRLEV9
      *
     C     *LIKE         DEFINE    XRLEV1        X000_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X000_XRLEV2
     C     *LIKE         DEFINE    XRLEV3        X000_XRLEV3
     C     *LIKE         DEFINE    XRLEV1        X001_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X001_XRLEV2
     C     *LIKE         DEFINE    XRLEV3        X001_XRLEV3
     C     *LIKE         DEFINE    XRLEV4        X001_XRLEV4
     C     *LIKE         DEFINE    XRLEV1        X002_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X002_XRLEV2
     C     *LIKE         DEFINE    XRLEV3        X002_XRLEV3
     C     *LIKE         DEFINE    XRLEV4        X002_XRLEV4
     C     *LIKE         DEFINE    XRLEV4        X002_XRLEV5
     C     *LIKE         DEFINE    XRLEV1        X003_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X003_XRLEV2
     C     *LIKE         DEFINE    XRLEV3        X003_XRLEV3
     C     *LIKE         DEFINE    XRLEV4        X003_XRLEV4
     C     *LIKE         DEFINE    XRLEV5        X003_XRLEV5
     C     *LIKE         DEFINE    XRLEV6        X003_XRLEV6
     C     *LIKE         DEFINE    XRLEV1        X004_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X004_XRLEV2
     C     *LIKE         DEFINE    XRLEV3        X004_XRLEV3
     C     *LIKE         DEFINE    XRLEV4        X004_XRLEV4
     C     *LIKE         DEFINE    XRLEV5        X004_XRLEV5
     C     *LIKE         DEFINE    XRLEV6        X004_XRLEV6
     C     *LIKE         DEFINE    XRLEV7        X004_XRLEV7
     C     *LIKE         DEFINE    XRLEV1        X005_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X005_XRLEV2
     C     *LIKE         DEFINE    XRLEV3        X005_XRLEV3
     C     *LIKE         DEFINE    XRLEV4        X005_XRLEV4
     C     *LIKE         DEFINE    XRLEV5        X005_XRLEV5
     C     *LIKE         DEFINE    XRLEV6        X005_XRLEV6
     C     *LIKE         DEFINE    XRLEV7        X005_XRLEV7
     C     *LIKE         DEFINE    XRLEV8        X005_XRLEV8
      *
     C                   MOVE      USN           XRSN
      *
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
      *
     C                   ENDSR
      *
