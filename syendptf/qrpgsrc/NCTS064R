********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12323 * 01 YBC PTF12 Ikke set sealdefault til '1'
12334 * 02 CB  PTF12 Test lossedato
********************************************************************
      *
      ***********************************************************
      *** PROGRAM SKAL ARBEIDE MED TET-IMPORT LOSSEMERKNADER  ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01-03 05 06 08 09 11 13 14 16-22 24-26
      *** LEDIGE INDIKATORER 31 32 34 35 38-87
      ***        INDIKATOR   27 PÅ = SPØRRING                 ***
      *** ALLE VARIABLER SOM STARTER MED 'X' ER ARBERDSVAR.   ***
      ***   OG DEFINERES I PROGRAM                            ***
      ***********************************************************
      *
     FEDIM1     UF   E           K DISK
     FEDIM2     IF   E           K DISK    RENAME(EDIMR:EDIMR2)
     FNCTSIH    UF   E           K DISK
     FNCTSIC    IF   E           K DISK
     FNCTSIV    IF   E           K DISK
     FTRKODL01  IF   E           K DISK
     FKODTS2    IF   E           K DISK
     FNCTS064D  CF   E             WORKSTN
     F                                     INFDS(FBAREA)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  WSDTFD                 1      2  0
     D  WSDTFM                 3      4  0
     D  WSDTFA                 5      6  0
     D  WSDTF                  1      6  0
     D                 DS
     D  TIDTFA                 1      4  0
     D  TIDTFM                 5      6  0
     D  TIDTFD                 7      8  0
     D  TIDTF                  1      8  0
     D                 DS
     D  WSULDTD                1      2  0
     D  WSULDTM                3      4  0
     D  WSULDTA                5      6  0
     D  WSULDT                 1      6  0
     D                 DS
     D  NIULDTA                1      4  0
     D  NIULDTM                5      6  0
     D  NIULDTD                7      8  0
     D  NIULDT                 1      8  0
      *
     D                 DS
     D  TIAVD                  1      4  0
     D  TITDN                  5     11  0
     D  UIN27                 12     12
     D  UWS2                  18     27
     D  TIKDC                 28     28
     D  UPARM2                 1    128
N02  D                 DS
N02  D  XDT                    1      8  0
N02  D  XDTY                   1      2  0
N02  D  XDTA                   3      4  0
N02  D  XDTM                   5      6  0
N02  D  XDTD                   7      8  0
      *
     C                   EXSR      INIT
      *
     C     START         TAG
     C                   EXSR      TSTTK
     C  N30
     CANN04
     CANN15              Z-ADD     13            LINNBR
     C  N30
     CANN04
     CANN15              Z-ADD     12            POSNBR
      *
     C                   EXFMT     NC064D01
     C                   MOVEA     '000000000000'*IN(88)
     C                   MOVEA     '000000'      *IN(82)
     C                   SETOFF                                       30
      *
      *  04 = SØK AVSENDER/MOTTAKER/HOVEDANSVARLIG
     C   04              DO
     C                   EXSR      SOKDT
     C                   GOTO      START
     C                   END
      *
      *  07 = SØKE OPPDRAG
     C   07              DO
     C                   MOVE      'S'           UTYPES            1
     C                   CALL      'SYFM21'
     C                   PARM                    UTYPES
     C                   PARM                    UAVD
     C                   PARM                    TITDN
     C                   PARM                    TISG
     C                   GOTO      START
     C                   END
      *
      *  10 = SE OPPLYSNIGER OM GODKJENNELSE FRA TOLLVESENET (KUN KOMMUNIKASJON)
     C   10              DO
     C                   EXSR      VISTOL
     C                   GOTO      START
     C                   END
      *
      *  12 = AVBRYT, FRIGJØR E-MERKING OG GÅ TIL TR061D01
     C   12              DO
     C     UTYPE         IFNE      'DSP'
     C     NCTSIHK       CHAIN     NCTSIH                             33
     C                   MOVE      XISTGM        TIST
     C  N33              UPDATE    NCTSIHR
     C                   END
     C                   GOTO      SLUTT
     C                   END
      *
     C   15              DO
     C                   EXSR      TILKOD
     C                   GOTO      START
     C                   END
      *
     C     UTYPE         IFEQ      'DSP'
     C                   GOTO      START2
     C                   END
      *
     C                   EXSR      TESTB
     C   30              GOTO      START
      *
      * ----- INGEN FEIL HITTIL     OPPDATER TRUH -----
     C                   EXSR      OPDNCTS
      *
      *===============================================
      *
     C     START2        TAG
     C                   EXSR      TOTRV
     C   12              GOTO      START
      *
     C     SLUTT         TAG
     C     *IN12         IFEQ      '1'
     C                   Z-ADD     1             UFLAGG
     C                   ELSE
     C                   Z-ADD     0             UFLAGG
     C                   END
     C                   MOVE      '1'           *INLR
     C                   RETURN
      *
      ***********************************************
     C     SOKDT         BEGSR
      ***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      * Tollsted på destinasjon
     C     LINNBR        IFEQ      12
     C     POSNBR        ANDGE     15
     C     POSNBR        ANDLE     22
     C                   MOVE      '106'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTSB         UKODE
     C                   MOVE      'ANK'         UTYPE2            3
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTSB
     C                   Z-ADD     45            POSNBR
     C                   GOTO      SLSOK
     C                   END
      * Transportmiddel avsender, type identitet
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     13
     C                   MOVE      '750'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTATY        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTATY
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLSOK
     C                   END
      * Transportmiddels nasjonalitet
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     61
     C     POSNBR        ANDLE     61
     C                   CALL      'SYFI10L'
     C                   PARM                    WSTALK
     C                   PARM                    USPED
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      SLSOK
     C                   END
      * Support document
     C     LINNBR        IFEQ      19
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     15
     C                   MOVE      '213'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTATY        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTATY
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLSOK
     C                   END
      * Transport document
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     15
     C                   MOVE      '754'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTDTY        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTDTY
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLSOK
     C                   END
      * Additional referece
     C     LINNBR        IFEQ      21
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     15
     C                   MOVE      '380'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSADTY        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSADTY
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLSOK
     C                   END
      *
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
      *
     C     SLSOK         ENDSR
      *
      ***********************************************
     C     TILKOD        BEGSR
      ***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
     C     LINNBR        IFEQ      18
     C*                  CALL      'NCTS073R'
     C*                  PARM                    UAVD
     C*                  PARM                    UTDN
     C*                  PARM                    WSCTP
     C*                  PARM                    WSCTNV
     C*                  PARM                    UTYPE
     C*    *IN27         IFEQ      '0'
     C*    NCTSIHK       CHAIN     NCTSIH                             33
     C*                  MOVEL     WSCTP         NICTP
     C*                  MOVE      WSCTNV        NICTNV
     C*                  UPDATE    NCTSIHR
     C*                  END
     C                   END
      *
     C  N37LINNBR        IFEQ      19
     C*                  CALL      'NCTS069R'
     C*                  PARM                    UAVD
     C*                  PARM                    UTDN
     C*                  PARM                    TIDFKD
     C*                  PARM                    TIDFSK
     C*                  PARM                    WSDFKD
     C*                  PARM                    WSDFSK
     C*                  PARM                    UTYPE
     C*    *IN27         IFEQ      '0'
     C*    NCTSIHK       CHAIN     NCTSIH                             33
     C*                  MOVE      WSDFKD        NIDFKD
     C*                  MOVE      WSDFSK        NIDFSK
     C*                  UPDATE    NCTSIHR
     C*                  END
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     TESTB         BEGSR
      ***********************************************
      * Test tollsted destinasjon
     C                   MOVE      '106'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTSB         YKODE
     C     TRK01K        CHAIN     TRKODL01                           99
     C   99
     CANN30              MOVE      'YBC0811'     MSGNR
     C   99              SETON                                        30
      * Trader på destinasjon
     C                   IF        WSTINT = *BLANKS
     C                   EVAL      *IN98 = *ON
     C                   IF        *IN30 = *OFF
     C                   EVAL      MSGNR = 'YBC2240'
     C                   EVAL      *IN30 = *ON
     C                   END
     C                   END
      * Lossedato
     C                   CALL      'TESTDATO'
     C                   PARM      WSULDTD       UDD               2 0
     C                   PARM      WSULDTM       UMM               2 0
     C                   PARM      WSULDTA       UAA               2 0
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      97
     C                   IF        *IN30 = *OFF AND *IN97
     C                   MOVE      'SPD0001'     MSGNR
     C                   EVAL      *IN30 = *ON
     C                   END
N02   * Legg inn test av dato her......................
N02  C                   EVAL      XDTY=20
N02  C                   EVAL      XDTA=WSULDTA
N02  C                   EVAL      XDTM=WSULDTM
N02  C                   EVAL      XDTD=WSULDTD
N02  C                   MOVEL     WDT           WDTN              8 0
N02  C  N97XDT           COMP      TIDTR                                97
N02  C  N97XDT           COMP      WDTN                               97
N02  C                   IF        *IN30 = *OFF AND *IN97
N02  C                   MOVE      'YBC2296'     MSGNR
N02  C                   EVAL      *IN30 = *ON
N02  C                   ENDIF
      * Lossemerknad
     C                   IF        WSULMR = *BLANKS AND WSULKF = 0
     C                   EVAL      *IN96 = *ON
     C                   IF        *IN30 = *OFF
     C                   EVAL      MSGNR = 'YBC2241'
     C                   EVAL      *IN30 = *ON
     C                   END
     C                   END
      * Bruttovekt
      * Antall seal
     C                   IF        WSDANT = 0 AND WSDFKD <> *BLANKS
     C                   EVAL      *IN94 = *ON
     C                   IF        *IN30 = *OFF
     C                   EVAL      MSGNR = 'YBC2242'
     C                   EVAL      *IN30 = *ON
     C                   END
     C                   END
      * Seal status
S01  C*                  IF        WSULKF = 1 AND WSDFKD <> *BLANKS
S01  C*                  EVAL      WSULST = 1
S01  C*                  END
      * Seal id
     C                   IF        WSDANT <> 0 AND WSDFKD = *BLANKS
     C                   EVAL      *IN93 = *ON
     C                   IF        *IN30 = *OFF
     C                   EVAL      MSGNR = 'YBC2243'
     C                   EVAL      *IN30 = *ON
     C                   END
     C                   END
      * Declaration goods item number
      * Type av identitet til transportmiddel
     C     WSTATY        IFNE      0
     C                   MOVE      '750'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTATY        YKODE
     C     TRK01K        CHAIN     TRKODL01                           91
     C   91
     CANN30              MOVE      'YBC2244'     MSGNR
     C   91              SETON                                        30
     C                   END
      * Transportmiddel
     C                   IF        WSTATY <> 0 AND WSTAID = *BLANKS
     C                   EVAL      *IN90 = *ON
     C                   IF        *IN30 = *OFF
     C                   EVAL      MSGNR = 'YBC2244'
     C                   EVAL      *IN30 = *ON
     C                   END
     C                   END
      * Landkode til transportmiddel
     C                   IF        WSTAID <> *BLANKS OR WSTALK <> *BLANKS
     C                   MOVE      WSTALK        KS2LK
     C     KODTS2K       CHAIN     KODTS2                             89
     C   89
     CANN30              MOVE      'SPL0001'     MSGNR
     C   89              SETON                                        30
     C                   END
      * Supporting document
     C                   IF        WSSDTY <> *BLANKS OR WSSDRF <> *BLANKS
     C                   MOVE      '213'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSSDTY        YKODE
     C     TRK01K        CHAIN     TRKODL01                           88
     C   88
     CANN30              MOVE      'YBC2248'     MSGNR
     C   88              SETON                                        30
     C                   END
      * Suppting dokument referanse
     C                   IF        WSSDTY <> *BLANKS AND WSSDRF = *BLANKS
     C                   EVAL      *IN87 = *ON
     C                   IF        *IN30 = *OFF
     C                   EVAL      MSGNR = 'YBC2252'
     C                   EVAL      *IN30 = *ON
     C                   END
     C                   END
      * Suppting dokument informasjon
      * Transport document
     C                   IF        WSTDTY <> *BLANKS OR WSTDRF <> *BLANKS
     C                   MOVE      '754'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTDTY        YKODE
     C     TRK01K        CHAIN     TRKODL01                           85
     C   85
     CANN30              MOVE      'YBC2249'     MSGNR
     C   85              SETON                                        30
     C                   END
      * Suppting dokument referanse
     C                   IF        WSTDTY <> *BLANKS AND WSTDRF = *BLANKS
     C                   EVAL      *IN84 = *ON
     C                   IF        *IN30 = *OFF
     C                   EVAL      MSGNR = 'YBC2253'
     C                   EVAL      *IN30 = *ON
     C                   END
     C                   END
      * Tilleggs referanse
     C                   IF        WSADTY <> *BLANKS OR WSADRF <> *BLANKS
     C                   MOVE      '380'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSADTY        YKODE
     C     TRK01K        CHAIN     TRKODL01                           83
     C   83
     CANN30              MOVE      'YBC2250'     MSGNR
     C   83              SETON                                        30
     C                   END
      * Tilleggs dokument referanse
     C                   IF        WSADTY <> *BLANKS AND WSADRF = *BLANKS
     C                   EVAL      *IN82 = *ON
     C                   IF        *IN30 = *OFF
     C                   EVAL      MSGNR = 'YBC2254'
     C                   EVAL      *IN30 = *ON
     C                   END
     C                   END
      *
     C   30              EXSR      SETCUR
      *
     C                   ENDSR
      *
      ***********************************************
     C     SETCUR        BEGSR
      ***********************************************
     C   82              Z-ADD     21            LINNBR
     C   82              Z-ADD     17            POSNBR
     C   83              Z-ADD     21            LINNBR
     C   83              Z-ADD     12            POSNBR
     C   84              Z-ADD     20            LINNBR
     C   84              Z-ADD     17            POSNBR
     C   85              Z-ADD     20            LINNBR
     C   85              Z-ADD     12            POSNBR
     C   86              Z-ADD     19            LINNBR
     C   86              Z-ADD     88            POSNBR
     C   87              Z-ADD     19            LINNBR
     C   87              Z-ADD     17            POSNBR
     C   88              Z-ADD     19            LINNBR
     C   88              Z-ADD     12            POSNBR
     C   89              Z-ADD     18            LINNBR
     C   89              Z-ADD     61            POSNBR
     C   90              Z-ADD     18            LINNBR
     C   90              Z-ADD     15            POSNBR
     C   91              Z-ADD     18            LINNBR
     C   91              Z-ADD     12            POSNBR
     C   92              Z-ADD     17            LINNBR
     C   92              Z-ADD     12            POSNBR
     C   93              Z-ADD     16            LINNBR
     C   93              Z-ADD     89            POSNBR
     C   94              Z-ADD     16            LINNBR
     C   94              Z-ADD     84            POSNBR
     C   95              Z-ADD     16            LINNBR
     C   95              Z-ADD     12            POSNBR
     C   96              Z-ADD     14            LINNBR
     C   96              Z-ADD     12            POSNBR
     C   97              Z-ADD     13            LINNBR
     C   97              Z-ADD     52            POSNBR
     C   98              Z-ADD     12            LINNBR
     C   98              Z-ADD     45            POSNBR
     C   99              Z-ADD     12            LINNBR
     C   99              Z-ADD     15            POSNBR
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVW2         BEGSR
      ***********************************************
     C                   MOVE      TIDTFD        WSDTFD
     C                   MOVE      TIDTFM        WSDTFM
     C                   MOVE      TIDTFA        WSDTFA
      *
     C                   IF        NITSB = *BLANKS AND NITINT = *BLANKS
     C                   MOVE      TITSB         WSTSB
     C                   MOVE      TITINT        WSTINT
     C                   ELSE
     C                   MOVE      NITSB         WSTSB
     C                   MOVE      NITINT        WSTINT
     C                   END
     C                   MOVE      NIULKF        WSULKF
     C     NIULDT        IFEQ      0
     C     UTYPE         ANDNE     'DSP'
     C                   Z-ADD     1             WSULKM
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           NIULDT
     C                   ELSE
     C                   MOVE      NIULKM        WSULKM
     C                   END
     C                   MOVE      NIULDTD       WSULDTD
     C                   MOVE      NIULDTM       WSULDTM
     C                   MOVE      NIULDTA       WSULDTA
     C                   MOVE      NIULMR        WSULMR
     C                   MOVE      NIVKB         WSVKB
     C                   IF        NICNR = *BLANKS AND TIDANT > 0
     C                   MOVE      TICNR         WSCNR
S01  C*                  EVAL      WSULST = 1
     C                   MOVE      TIDANT        WSDANT
     C                   MOVE      TIDFKD        WSDFKD
     C                   ELSE
     C                   MOVE      NICNR         WSCNR
     C                   MOVE      NIULST        WSULST
     C                   MOVE      NIDANT        WSDANT
     C                   MOVE      NIDFKD        WSDFKD
     C                   END
     C                   MOVE      NIGINR        WSGINR
     C                   MOVE      NITATY        WSTATY
     C                   MOVE      NITAID        WSTAID
     C                   MOVE      NITALK        WSTALK
     C                   MOVE      NISDTY        WSSDTY
     C                   MOVE      NISDRF        WSSDRF
     C                   MOVE      NISDIN        WSSDIN
     C                   MOVE      NITDTY        WSTDTY
     C                   MOVE      NITDRF        WSTDRF
     C                   MOVE      NIADTY        WSADTY
     C                   MOVE      NIADRF        WSADRF
      *
      * SJEKK OM DET ER LOV Å ENDRE FORSELINGS-ID
     C     TIDFKD        IFEQ      *BLANKS
     C     NCTSIHK       SETLL     NCTSIV
     C     NCTSIHK       READE     NCTSIV                                 37
     C                   DOW       *IN37 = *OFF
     C     TVSID         IFNE      *BLANKS
     C                   LEAVE
     C                   END
     C     NCTSIHK       READE     NCTSIV                                 37
     C  N37              ENDDO
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVNCTS       BEGSR
      ***********************************************
     C                   MOVE      WSULDTD       NIULDTD
     C                   MOVE      WSULDTM       NIULDTM
     C     WSULDTA       ADD       2000          NIULDTA
     C                   MOVE      WSTSB         NITSB
     C                   MOVE      WSTINT        NITINT
     C                   MOVE      WSULKF        NIULKF
     C                   MOVE      WSULKM        NIULKM
     C                   MOVE      WSULMR        NIULMR
     C                   MOVE      WSVKB         NIVKB
     C                   MOVE      WSCNR         NICNR
     C                   MOVE      WSULST        NIULST
     C                   MOVE      WSDANT        NIDANT
     C                   MOVE      WSDFKD        NIDFKD
     C                   MOVE      WSGINR        NIGINR
     C                   MOVE      WSTATY        NITATY
     C                   MOVE      WSTAID        NITAID
     C                   MOVE      WSTALK        NITALK
     C                   MOVE      WSSDTY        NISDTY
     C                   MOVE      WSSDRF        NISDRF
     C                   MOVE      WSSDIN        NISDIN
     C                   MOVE      WSTDTY        NITDTY
     C                   MOVE      WSTDRF        NITDRF
     C                   MOVE      WSADTY        NIADTY
     C                   MOVE      WSADRF        NIADRF
     C                   MOVE      *BLANKS       TIMF
     C                   MOVE      *ZEROS        TIMP
     C                   MOVE      *BLANKS       TIKDV
     C                   MOVE      *BLANKS       TI0035
      *
     C                   ENDSR
      *
      ***********************************************
     C     OPDNCTS       BEGSR
      ***********************************************
     C     NCTSIHK       CHAIN     NCTSIH                             33
     C                   EXSR      MOVNCTS
      *
     C                   MOVE      'E'           TIST
     C                   UPDATE    NCTSIHR
      *
     C                   ENDSR
      *
      ***********************************************
     C     TOTRV         BEGSR
      ***********************************************
      *
     C                   MOVE      *IN27         UIN27
     C                   CALL      'NCTS065R'
     C     UPARM2        PARM      UPARM2        UPARM1          128
     C                   PARM                    UFLAGG            1 0
      *
     C     *IN27         IFEQ      '0'
     C                   MOVE      *ZEROS        WSVPOS            5 0
     C                   MOVE      *ZEROS        WSVKB            11 3
     C                   MOVE      'J'           X0MOTT            1
     C                   MOVE      *ZEROS        XLTOTIBV         11 3
     C                   MOVE      *ZEROS        XLTOTBVNE        11 3
     C     NCTSIHK       SETLL     NCTSIC
     C     NCTSIHK       READE     NCTSIC                                 33
     C     *IN33         DOWEQ     '0'
     C                   SELECT
     C*                  WHEN      NCVKTB = -1
     C                   WHEN      TC01 = 'S'
      * Hele consignement manko
     C                   WHEN      NCVKTB = 0
      * Ingen endring på consignement
     C                   EVAL      XLTOTIBV = XLTOTIBV + TCVKTB
     C                   MOVE      'N'           X0MOTT
     C                   OTHER
      * Endring i consignement
     C                   EVAL      XLTOTIBV = XLTOTIBV + NCVKTB
     C                   MOVE      'N'           X0MOTT
     C                   ENDSL
      * SUMMER OPPRINGLIG BRUTTOVEKT PÅ LINJER
     C*                  ADD       TVVKTB        XLTOTIBV
      * SUMMER OPPRINGLIG BRUTTOVEKT PÅ ALLE NYE LINJER
     C*    NVCT          IFEQ      'NE'
     C*                  ADD       NVVKTB        XLTOTBVNE
     C*                  END
      *
     C*    NVCT          IFEQ      'DI'
     C*    NVNT          ANDEQ     0
     C*    NVNTEH        ANDEQ     0
     C*    NVVKTB        ANDEQ     0
     C*    NVCT          OREQ      'DI'
     C*    NVNT          ANDEQ     0
     C*    NVNTEH        ANDEQ     0
     C*    TVNT          ANDNE     0
     C*    NVCT          OREQ      'DI'
     C*    NVNT          ANDEQ     0
     C*    NVNTEH        ANDEQ     0
     C*    TVNTEH        ANDNE     0
     C*                  MOVE      TVEH          XTVEH             2
     C*                  MOVE      TVNT          XTVNT             5 0
     C*                  MOVE      TVNTEH        XTVNTEH           5 0
     C*                  MOVE      NVEH          XNVEH             2
     C*                  MOVE      NVNT          XNVNT             5 0
     C*                  MOVE      NVNTEH        XNVNTEH           5 0
     C*                  MOVE      'J'           XHELMANKO         1
     C*    TRVK          SETLL     TRILKL
     C*    TRVK          READE     TRILKL                                 34
     C*    *IN34         DOWEQ     '0'
     C*    NVNT          IFNE      0
     C*                  MOVE      'N'           XHELMANKO
     C*                  GOTO      TAGTRV01
     C*                  END
     C*    TRVK          READE     TRILKL                                 34
     C* N34              ENDDO
     C*    TAGTRV01      TAG
     C*                  MOVE      XTVEH         TVEH
     C*                  MOVE      XTVNT         TVNT
     C*                  MOVE      XTVNTEH       TVNTEH
     C*                  MOVE      XNVEH         NVEH
     C*                  MOVE      XNVNT         NVNT
     C*                  MOVE      XNVNTEH       NVNTEH
     C*                  ELSE
     C*                  MOVE      'N'           XHELMANKO
     C*                  END
      *
     C*    NVCT          IFEQ      'DI'
     C*    XHELMANKO     ANDEQ     'J'
     C*                  SUB       1             WSVPOS
     C*                  END
     C*    NVCT          IFEQ      'DI'
     C*    NVNT          ANDEQ     0
     C*    NVNTEH        ANDEQ     0
     C*    X0MOTT        ANDEQ     'J'
     C*                  ELSE
     C*                  MOVE      'N'           X0MOTT
     C*                  END
     C*                  ADD       1             WSVPOS
     C*    TVVKTB        IFEQ      0
     C*                  ADD       1             WSVPN
     C*                  END
     C*    XHELMANKO     IFEQ      'N'
     C*                  ADD       NVVKTB        WSVKB
     C*                  END
     C*    NVNT          IFEQ      0
     C*                  ADD       NVNTEH        WSNTK
     C*                  ELSE
     C*                  ADD       NVNT          WSNTK
     C*                  END
     C*    NVEH          IFEQ      'VQ'
     C*    NVEH          OREQ      'VG'
     C*    NVEH          OREQ      'VL'
     C*    NVEH          OREQ      'VY'
     C*    NVEH          OREQ      'VR'
     C*    NVEH          OREQ      'VO'
     C*    NVEH          OREQ      'VS'
     C*                  ADD       1             WSNTK
     C*                  END
      *
     C*    TRVK          SETLL     TRILKL
     C*    TRVK          READE     TRILKL                                 34
     C*    *IN34         DOWEQ     '0'
     C*    NVNT          IFEQ      0
     C*                  ADD       NVNTEH        WSNTK
     C*                  ELSE
     C*                  ADD       NVNT          WSNTK
     C*                  END
     C*    TRVK          READE     TRILKL                                 34
     C* N34              ENDDO
      *
     C     NCTSIHK       READE     NCTSIC                                 33
     C  N33              ENDDO
     C                   EVAL      WSVKB = XLTOTIBV
      *
      * HVIS OPPRINGELIG BRUTTOVEKT = 0, SPØR ETTER BRUTTOVEKT FRA BRUKER
      * MED DEFAULT VEKT = TOTAL BRUTTOVEKT + SUM AV NYE LINJES BRUTTOVEKT.
     C*    XLTOTIBV      IFEQ      0
     C*    WSVKB         ANDNE     0
     C*                  EVAL      WSVKB = TIVKB + XLTOTBVNE
     C*                  DOU       WSVKB <> 0
     C*                  EXFMT     NC064D03
     C*                  ENDDO
     C*                  END
     C     NCTSIHK       CHAIN     NCTSIH                             33
     C*    WSVPOS        IFEQ      TIVPOS
     C*                  MOVE      *ZEROS        NIVPOS
     C*                  ELSE
     C*    WSVPOS        IFEQ      0
     C*                  Z-SUB     1             NIVPOS
     C*                  ELSE
     C*                  MOVE      WSVPOS        NIVPOS
     C*                  END
     C*                  END
     C     WSVKB         IFEQ      TIVKB
     C                   MOVE      *ZEROS        NIVKB
     C                   ELSE
     C     X0MOTT        IFEQ      'J'
     C     WSVKB         ANDEQ     0
     C                   Z-SUB     1             NIVKB
     C                   ELSE
     C                   MOVE      WSVKB         NIVKB
     C                   END
     C                   END
     C*    TINTK         IFLT      0
     C*                  Z-SUB     TINTK         XINTK             7 0
     C*                  ELSE
     C*                  Z-ADD     TINTK         XINTK
     C*                  END
     C*    WSNTK         IFEQ      XINTK
     C*                  MOVE      *ZEROS        NINTK
     C*                  ELSE
     C*                  MOVE      WSNTK         NINTK
     C*                  END
     C                   UPDATE    NCTSIHR
     C                   END
      *
     C     UFLAGG        COMP      1                                      12
      *
     C                   ENDSR
      *
      ***********************************************
     C     VISTOL        BEGSR
      ***********************************************
      *________________________
      * Call på eksternt CL-pgm
      *""""""""""""""""""""""""
     C                   MOVE      '3'           WIN03             1
     C                   CALL      'SAD003'
     C                   PARM      TIAVD         UAVD
     C                   PARM      TITDN         UTDN
     C                   PARM                    WIN03
      *
     C                   ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     NCTSIHK       KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C     TRVK          KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    TVLI
     C     TRK01K        KLIST
     C                   KFLD                    YUNIK             3
     C                   KFLD                    YKODE            10
     C     M2KDCK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    MAX0B
     C                   KFLD                    MAX0C
     C                   KFLD                    MAX0D
     C     M2KD2K        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C     TVINMK        KLIST
     C                   KFLD                    YST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C     KODTS2K       KLIST
     C                   KFLD                    KS2UNI
     C                   KFLD                    KS2LK
      *
     C     *LIKE         DEFINE    TIWS          UWS
     C     *LIKE         DEFINE    M0068A        MAX0B
     C     *LIKE         DEFINE    M0068B        MAX0C
     C     *LIKE         DEFINE    M0068C        MAX0D
      *
     C     *ENTRY        PLIST
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    UTYPE             3
     C                   PARM                    UWS
     C                   PARM                    UFLAGG            1 0
      *
     C                   MOVE      *BLANKS       UUNIK             3
     C                   MOVE      *BLANKS       UKODE            10
     C                   MOVE      '99999999'    MAX0B
     C                   MOVE      '999999'      MAX0C
     C                   MOVE      '99'          MAX0D
     C                   MOVE      ' '           YST               1
     C                   EVAL      KS2UNI = 'S2'
     C                   MOVE      'N'           USPED             1
      *
     C     UTYPE         COMP      'DSP'                                  27
     C     *IN27         IFEQ      '0'
     C                   EXSR      TSTMTY
     C                   EXSR      TSTTRH
     C                   ELSE
     C     NCTSIHK       CHAIN(N)  NCTSIH                             33
     C                   MOVE      TIST          XISTGM            1
     C                   END
      *
     C                   EXSR      MOVW2
N02  C                   CALL      'SYGE15C'
N02  C                   PARM                    WDT               8
     C                   PARM                    WTM               6
      *
     C                   ENDSR
      *
      ***********************************************
     C     TSTTRH        BEGSR
      ***********************************************
     C     NCTSIHK       CHAIN     NCTSIH                             33
     C     *IN33         IFEQ      '1'
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   ELSE
     C                   MOVE      TIST          XISTGM            1
      * TIST = ' ' --> ÅPEN TRANSITTERING
      *        'A' --> HOLD PÅ Å SENDE UT
      *        'B' --> SENDT TIL IBM
      *        'C' --> SENDT TIL TOLLVESENET
      *        'E' --> HOLD PÅ Å BLI ENDRET
      *        'M' --> FEILMELDING FRA TOLLVESENET
      *        'N' --> FEILMELDING FRA TOLLVESENET IE58
      *        'P' --> TRANSITTERING AVSLUTTET
      *        'K' --> VENT PÅ Å BLI UTSKREVET
      *        'Q' --> I UTGÅENDE POSTKASSE
      *        'U' --> HAR FÅTT LOSSETILLATELSE
     C                   SELECT
     C*    TILSTL        WHENGT    0
      * VED PLL SENDS IKKE IE44
     C*                  UPDATE    NCTSIHR
     C*                  MOVE      '1'           *INLR
     C*                  RETURN
     C     TIST          WHENEQ    'U'
     C     TIST          OREQ      'N'
     C     TIST          OREQ      'M'
     C                   MOVE      'E'           TIST
     C                   UPDATE    NCTSIHR
     C     TIST          WHENEQ    'Q'
      * SLIPP POST FØRST
     C                   UPDATE    NCTSIHR
     C     STTRH         TAG
     C                   EXFMT     NC064D02
     C     *IN12         IFEQ      '1'
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END
     C     *IN23         CABEQ     '0'           STTRH
     C     NCTSIHK       CHAIN     NCTSIH                             33
     C                   IF        TIST <> 'Q'
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   ELSE
     C                   MOVE      'E'           TIST
     C                   UPDATE    NCTSIHR
     C                   END
     C                   MOVE      'U'           XISTGM            1
     C     TVINMK        SETGT     EDIM1
     C     STTRH2        TAG
     C     TVINMK        READPE    EDIM1                                  33
     C     *IN33         IFEQ      '0'
     C     MSR           IFEQ      'S'
     C     M1001         ANDEQ     'TEI'
     C     M1N07         ANDEQ     '044'
     C                   DELETE    EDIMR
     C                   ELSE
     C                   UPDATE    EDIMR
     C                   GOTO      STTRH2
     C                   END
     C                   END
     C                   OTHER
      * FEIL! AVSLUTT
     C                   UPDATE    NCTSIHR
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   ENDSL
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     TSTMTY        BEGSR
      ***********************************************
     C     M2KDCK        SETLL     EDIM2                              33
     C     STTSTM        TAG
     C     M2KD2K        READPE    EDIM2                                  33
     C     *IN33         IFEQ      '0'
     C                   SELECT
     C     M1001         WHENNE    'TEI'
     C                   GOTO      STTSTM
     C     M1N07         WHENEQ    '043'
      * LOSSETILLATELSE --> OK FOR LOSSEMERKNADER
     C                   GOTO      SLTSTM
     C     M1N07         WHENEQ    '007'                                        ANKOMSTMELDING
     C     M1N07         OREQ      '025'                                        TRANSIT AVSLUTTET
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   OTHER
     C                   GOTO      STTSTM
     C                   ENDSL
     C                   ELSE
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END
      *
     C     SLTSTM        ENDSR
      *
      ***********************************************
     C     TSTTK         BEGSR
      ***********************************************
      *
     C                   ENDSR
      *
