SY    *   ENDRET FOR Å KUNNE KJØRES I BATCH - ENDRINGER MERKET *SY*
      /TITLE  STYRING AV UTSKRIFTER
      *****************************************************************
      *   5797-AWD    IBM NORWAY 1988                                 *
      *   5797-AWD    COPYRIGHT IBM CORP 1988                         *
      *   REFER TO INSTRUCTIONS ON COPYRIGHT NOTICE NO. G120-2083     *
      *****************************************************************
      *               --- V R 0 0 1 ---                               *
      *****************************************************************
N24   *   Det er foretatt endringer i dette program.
E55   *   Endringer er foretatt ifølge endringsmelding nr: 55
E55   *
E55   * MERK! Slettede linjer er fysisk fjernet fra kildekoden.
      *****************************************************************
      *                                                               *
      *                  INDIKATORER                                  *
      *                                                               *
      *  12 - F12 Annuller                                            *
      *  03 - F3 Gå ut                                                *
      *  04 - F4 Forespørsel                                          *
      *  06 - F6 Opprette skriverfil (call VR015 - ikke i bruk)       *
      *  07 - Roll framover                                           *
      *  08 - Roll bakover                                            *
      *  10 - Programmet kalles fra VR005 - pålogging                 *
      *  31 - SFLDSP                                                  *
      *  32 - SFLDSPCTL                                               *
      *  33 - SFLCLR                                                  *
      *  34 - SFLEND                                                  *
      *  35 - Protect felt for formularnavn                           *
      *  36 - --------"------- skriver                                *
      *  37 - --------"------- utskriftskø                            *
      *  38 - --------"------- ant.eks.                               *
      *  39 - --------"------- form.lengde                            *
      *  40 - --------"------- skrivetetthet                          *
      *  41 - --------"------- save                                   *
      *  42 - --------"------- hold                                   *
      *  43 - --------"------- jobbkø                                 *
      *  44 - --------"------- holde i jobbkø                         *
      *  49 - DSPATR(ND) på skriverfil                                *
      *  50 - CHAIN                                                   *
      *  51 - OPEN FORML01                                            *
      *  52 - OPEN BRSKL01                                            *
      *  53 - CHAIN                                                   *
      *  70 - Feilmelding ved inntasting                              *
      *  71 - ---------- " -------------                              *
      *  72 - ---------- " -------------                              *
      *  73 - ---------- " -------------                              *
      *  74 - ---------- " -------------                              *
      *  75 - ---------- " -------------                              *
      *  76 - ---------- " -------------                              *
      *  77 - ---------- " -------------                              *
      *  78 - ---------- " -------------                              *
      *  91 - Brukes i autostart 3.P-meny                             *
      *  92 - Brukes i autostart 3.P-meny                             *
      *  98 - Feilindikator                                           *
      *****************************************************************
      *                  SUBRUTINER                                   *
      *                                                               *
      *  SUBR01 - Søking på skrivere                                  *
      *  SUBR02 - Kontroll hvis SKRILD i *LDA er utfyllt              *
      *  SUBR03 - Viser vindu med tegn og font for printer/kø         *
      *  FEILSR - Feilrutine ved feil på arbeidsstasjonen             *
      *  FINPOS - Finner cursor-posisjon i bilde.                     *
      *                                                               *
      *****************************************************************
      *                  SKJERMBILDER                                 *
      *                                                               *
      *  VR001B01 - Heading                                           *
      *  VR001B02 - Inntasting                                        *
      *  VR001B03 - Funksjonstaster                                   *
      *  VR001B04 - Viser tegn og event. font for skriver             *
      *  VR001B99 - Vindusdefinisjon for H01/K01                      *
      *  VR030H01 - Søk på skrivere                                   *
      *  VR030K01 - ---"---                                           *
      *                                                               *
      *****************************************************************
      *
SY   F*VR001D01  CF   E             WORKSTN
SY   FVR001D01  CF   E             WORKSTN USROPN
     F                                     SFILE(VR001H01:RRN)
     F                                     INFDS(FEILDS)
     F                                     INFSR(FEILSR)
     FSKIDL01   IF   E           K DISK
     FFORML01   IF   E           K DISK    USROPN
     FBRSKL01   IF   E           K DISK    USROPN
     FRUTIL01   IF   E           K DISK
     FTPMER5BF  UF   E           K DISK    USROPN
     FFEILLOGG  O    E             PRINTER USROPN
      *
     D ARRC            S             60    DIM(3) CTDATA PERRCD(1)
     D WPR             S              1    DIM(10)                              Protekt av felt
      *
     D LDARU           DS
     D  LDAFL1                 1    256
     D  LDAFL2               257    512
     D  LDAFL3               513    600
     D                SDS
     D  ZPROG                  1     10
     D  ZPMSG                 40     46
     D  ZBIBLO                81     90
     D  ZJOBB                244    253
     D  ZBRKR                254    263
     D  ZJNR                 264    269
      *
     D FEILDS          DS
     D  ZSTAT            *STATUS
     D  ZFILE            *FILE
     D  ZLINE                 30     37
     D  ZFMT                  38     45
     D  ZFMSG                 46     52
     D  ZDSP                 273    282
     D  CURLIN               370    371B 0
     D  ZMAJ                 401    402
     D  ZMIN                 403    404
      *
      *****************************************************************
      * LOCAL DATA AREA                                               *
      *****************************************************************
      *
     D DATA1         EUDS                  EXTNAME(LDADS)
     D  WIN74                400    400
E24  D  WSKIDF               568    577
     D  LDAUTO              1010   1012
      *
SY    * SKAL ALDRI ÅPNES-DENNE METODE GIR MINIMALE ENDRINGER
SY   C                   MOVE      'J'           BATCH             1
SY   C     BATCH         IFEQ      'N'
SY   C                   OPEN      VR001D01
SY   C                   END
      *****************************************************************
      *   PLIST for call til VC001A - Sjekk av objekt (*JOBQ/*OUTQ)   *
      *****************************************************************
      *
     C     PVC001        PLIST
     C                   PARM                    PARMA1            1
     C                   PARM                    PARMA2           10
     C                   PARM                    PARMA3            7
      *
      *****************************************************************
      *   PLIST for call til VR015  - Oppretting av formular          *
      *****************************************************************
      *
     C     PVR015        PLIST
     C                   PARM                    PARMO1            1            Call-type
     C                   PARM                    PARMO2            1            File
     C                   PARM                    PARMO3            1            Beh.kode
     C                   PARM                    PARMO4           30            Data
      *
      *****************************************************************
      *   Definering og flytting til hjelpefelter                     *
      *****************************************************************
      *
     C     KEYSTD        KLIST                                                  <FORML01
     C                   KFLD                    WFKODE
     C                   KFLD                    WFIRMA
     C                   KFLD                    STDFOR
     C     KEY01         KLIST                                                  <FORML01
     C                   KFLD                    WFKODE
     C                   KFLD                    WFIRMA
     C                   KFLD                    SKRILD
     C     KEY02         KLIST                                                  <BRSKL01
     C                   KFLD                    WFKODE
     C                   KFLD                    WFIRMA
     C                   KFLD                    LAGNR
     C                   KFLD                    USER
     C                   KFLD                    SKRILD
     C     KEY03         KLIST                                                  <RUTIL01
     C                   KFLD                    WFKODE
     C                   KFLD                    WFIRMA
     C                   KFLD                    RUTNLD
     C                   KFLD                    WNR
      *
      *****************************************************************
      *   Parameterliste:  Input :  WIN12 = '9': Kall fra VR005       *
      *                    Output:  WIN03 = *IN03                     *
      *                             WIN12 = *IN12                     *
      *                                                               *
      *   I tillegg overføres følgende parametre via LDA:             *
      *                    SKRILD:  Skriverfil                        *
      *                    RUTNLD:  Rutinenavn                        *
      *****************************************************************
      *
     C     *ENTRY        PLIST
     C                   PARM                    WIN12             1            < F12
     C                   PARM                    WIN03             1            < F3
      *
     C     WIN12         IFEQ      '9'
     C                   MOVE      *ON           *IN10
     C                   ENDIF                                                  <WIN12
     C                   MOVE      '0'           WIN12
     C                   MOVE      '0'           WIN03
      *
     C     *DTAARA       DEFINE    *LDA          DATA1
     C                   IN        *DTAARA
     C                   MOVE      ARRC(2)       ARRC(2)                        <COPYRIGHT
     C     *LIKE         DEFINE    RUTNRU        WNR
     C     *LIKE         DEFINE    SKRILD        STDFOR
     C     *LIKE         DEFINE    RRN           WRRN
N24  C     *LIKE         DEFINE    FLENGD        HOVFL
N24P C     *LIKE         DEFINE    FLENGD        XLINJE
N55  C     *LIKE         DEFINE    HLENGD        W_HLENGD
     C                   MOVE      *ZEROS        X                 2 0
     C                   MOVE      *ZEROS        Y                 2 0
      *
     C     LDAUTO        IFEQ      '¤¤¤'
     C                   OPEN      TPMER5BF
     C                   CLEAR                   *IN91
     C                   MOVE      *ON           *IN92
     C                   READ      TPMER5BF                             9191
     C     *IN91         IFEQ      *ON
     C                   CLEAR                   *IN92
     C                   CLEAR                   LDAUTO
     C                   CLOSE     TPMER5BF                             91
     C                   ENDIF                                                  <*IN91
     C                   ENDIF                                                  <LDAUTO
      *
      *
      *  Les inn rutineregister for å finne jobbkø, holde i jobbkø
      *  og om printerstyringsbildet skal vises.
      *
      *  RUTIL01 leses med rutinenavn CLP-seleksjon + Rutinenr 000
      *  Hvis rutinenavn er blankt, brukes STANDARD
      *
     C     RUTNLD        IFEQ      *BLANKS
     C                   MOVEL     'STANDARD'    RUTNLD
     C                   ENDIF                                                  <RUTNLD
     C                   MOVE      *BLANKS       JOBQRU
     C                   MOVE      *BLANKS       HOLDRU
     C                   MOVE      *ZEROS        WNR
     C     KEY03         CHAIN     RUTIL01                            48
     C     *IN48         IFEQ      *ON
      *
      *  Rutinen finnes ikke - sett inn defaultverdier fra LDA
      *
     C                   MOVE      JOBQLD        JOBQRU
     C                   MOVE      HJOBLD        HOLDRU
     C                   MOVE      'J'           VISPRU
     C     JOBQLD        IFEQ      *BLANKS
     C                   MOVEL     'QBATCH'      JOBQRU
     C                   MOVE      *BLANKS       HOLDRU
     C                   ENDIF                                                  <JOBQLD
     C                   ENDIF                                                  <*IN48
     C                   MOVE      JOBQRU        HJOBQ
     C                   MOVE      HOLDRU        HJHOLD
      *
     C     SKRILD        IFEQ      'FR331U01'
     C                   MOVEL     WSKIDF        HSKID
     C                   ELSE
     C                   MOVE      WSKID         HSKID                          <SKRIVER
     C                   ENDIF
     C     HSKID         IFEQ      *BLANKS
     C                   MOVE      WSKKO         HSKKO                          <SKRIVERKØ
     C                   ENDIF
     C                   MOVE      WANTKO        HANTKO                         <ANT.KOPIER
     C                   MOVE      WLENGD        HLENGD                         <FORMULARLENGDE
     C                   MOVE      WTEGN         HTEGN                          <TEGN PR. TOMME
     C                   MOVE      WSAVE         HSAVE                          <TA VARE PÅ
     C                   MOVE      WHOLD         HHOLD                          <HOLD PÅ KØ
     C     WFORM         IFEQ      *BLANKS
     C                   MOVEL     '*STD'        HFORM                          <FORM TYPE
     C                   ELSE
     C                   MOVE      WFORM         HFORM
     C                   ENDIF
      *
      *****************************************************************
      *  HOVEDPROGRAM                                                 *
      *****************************************************************
      *
     C     SKRILD        CASNE     *BLANKS       SUBR02
     C                   ENDCS
      *
      *  Skal printerstyringsbildet vises ?
      *
     C     VISPRU        IFEQ      'J'
      *
     C                   WRITE     VR001B01                                     <HEADING
      *
     C     VISB02        TAG
      *
      *  Hvis overstyring ikke er tillatt protektes feltene (IND 35-44)
      *
     C                   MOVEA     '00000000'    *IN(35)                        35-42
     C                   MOVEA     '00'          *IN(43)                        43-44
     C     1             DO        10            X
     C     WPR(X)        IFEQ      'N'
     C     X             ADD       34            Y
     C                   MOVE      '1'           *IN(Y)
     C                   ENDIF                                                  <WPR,X
     C                   ENDDO
N24   *
N24   * Ved utskrift av faktura skjer valg av skriver/kø i program
N24   * FR300, og dette valget kan ikke endres i VR001.
N24   *
N24  C     SKRILD        IFEQ      'FR331U01'
N24  C                   MOVEA     '11'          *IN(36)
N24  C                   ENDIF                                                  <SKRILD
      *
      * Hvis fil for auto er OPEN, les denne, ved tilslag gå til
      * behandle valg.
      *
     C     *IN92         IFEQ      *ON
     C     *IN91         DOWEQ     *OFF
     C     R5BID         IFEQ      'A20'
     C                   SELECT
     C     R5BSEQ        WHENEQ    1
     C                   MOVEL     R5BDTA        HFORM
     C     R5BSEQ        WHENEQ    2
     C                   MOVEL     R5BDTA        HSKID
     C     R5BSEQ        WHENEQ    3
     C                   MOVEL     R5BDTA        HSKKO
     C     R5BSEQ        WHENEQ    4
     C                   MOVEL     R5BDTA        HANTKO
     C     R5BSEQ        WHENEQ    5
     C                   MOVEL     R5BDTA        HLENGD
     C     R5BSEQ        WHENEQ    6
     C                   MOVEL     R5BDTA        HTEGN
     C     R5BSEQ        WHENEQ    7
     C                   MOVEL     R5BDTA        HSAVE
     C     R5BSEQ        WHENEQ    8
     C                   MOVEL     R5BDTA        HHOLD
     C     R5BSEQ        WHENEQ    9
     C                   MOVEL     R5BDTA        HJOBQ
     C     R5BSEQ        WHENEQ    10
     C                   MOVEL     R5BDTA        HJHOLD
     C                   ENDSL
     C                   DELETE    TPMER5BF
     C                   ENDIF                                                  <R5BID
     C                   READ      TPMER5BF                               91
     C                   ENDDO                                                  <*IN91
     C                   WRITE     VR001B02
     C     *IN91         IFEQ      *ON
     C                   CLEAR                   *IN92
     C                   CLEAR                   LDAUTO
     C                   CLOSE     TPMER5BF
     C                   ENDIF                                                  <*IN91
      *
     C                   ELSE                                                   <*IN92
     C                   EXFMT     VR001B02
     C                   ENDIF                                                  <*IN92
     C     *IN12         IFEQ      *OFF
     C     *IN03         ANDEQ     *OFF
      *
      *  Hvis F6, registrer skriveropplysning
      *  F6 er inntil videre avsatt til framtidig bruk
      *
     C     *IN06         IFEQ      *ON                                          <F6
     C                   MOVE      '1'           PARMO1                         TYPE CALL
     C                   MOVE      '1'           PARMO2                         FORMF
     C                   MOVE      '1'           PARMO3                         BEH.KODE
     C                   MOVEL     SKRILD        PARMO4
     C                   CALL      'VR015'       PVR015
     C                   MOVE      *OFF          *IN03
     C                   MOVE      *OFF          *IN06
     C                   EXSR      SUBR02
     C                   WRITE     VR001B01                                     <HEADING
     C                   GOTO      VISB02
     C                   ENDIF                                                  <IN06
      *
     C                   MOVEA     *ALL'0'       *IN(70)                        <SETOF 70...
      *
     C     HSKID         IFNE      *BLANKS
     C     HSKKO         ANDNE     *BLANKS
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB02                                       <RETUR UTVALG
     C                   ENDIF
      *
     C     *IN04         IFEQ      *ON
     C                   EXSR      FINPOS
     C     LINJE         IFEQ      8
     C                   EXSR      SUBR01                                       <SUBF SKRIVERE
     C                   ELSE
     C     LINJE         IFEQ      12
     C     HSKID         IFEQ      *BLANKS
     C     HSKKO         ANDEQ     *BLANKS
     C                   MOVE      *ON           *IN78                          <FEIL
     C                   ELSE
     C                   EXSR      SUBR03                                       <VIS TEGN/FONT
     C                   ENDIF                                                  <HSKID
     C                   ENDIF                                                  <LINJE 12
     C                   ENDIF                                                  <LINJE 8
     C                   GOTO      VISB02
     C                   ENDIF                                                  <*IN04
      *
      *  Antall eksemplarer 1-99
      *
     C     HANTKO        IFLE      *ZEROS
     C     HANTKO        ORGT      99
     C                   MOVE      *ON           *IN79                          <FEIL
     C                   GOTO      VISB02
     C                   ENDIF                                                  <HANTKO
      *
      *  Formularlengde 1-255
      *
     C     HLENGD        IFLE      *ZEROS
     C     HLENGD        ORGT      255
     C                   MOVE      *ON           *IN80                          <FEIL
     C                   GOTO      VISB02
     C                   ENDIF                                                  <HLENGD
      *
      *****************************************************************
      *   Hvis skriver er valgt, sjekkes det om det er en gyldig      *
      *   skriver. Gyldige skrivere ligger i filen SKIDF.             *
      *   Verdiene for tegn/font er registrert på skriveren.          *
      *****************************************************************
      *
     C     HSKID         IFNE      *BLANKS
     C     HSKID         CHAIN     SKIDL01                            50
     C     *IN50         IFEQ      *ON                                          <NF
     C                   MOVE      *ON           *IN71                          <FEILIND
     C                   MOVE      *ON           *IN98                          <PUTOVR
     C                   ENDIF
      *
     C     *IN50         IFEQ      *OFF
      *
     C     HTEGN         IFEQ      *BLANKS
     C                   MOVE      *ON           *IN70
     C                   MOVE      *ON           *IN98
     C                   ELSE
     C     HTEGN         IFNE      TEG1SK
     C     HTEGN         ANDNE     TEG2SK
     C     HTEGN         ANDNE     TEG3SK
     C     HTEGN         ANDNE     TEG4SK
     C                   MOVE      *ON           *IN70
     C                   MOVE      *ON           *IN98
     C                   ENDIF                                                  <HTEGN
     C                   ENDIF                                                  <HTEGN...
      *
     C                   ENDIF                                                  <*IN50
     C                   ENDIF                                                  <HSKID NE ' '
      *
      *****************************************************************
      *  Sjekk om utfylt utkø er gyldig, flytt til skrivertype.       *
      *****************************************************************
      *
     C     HSKKO         IFNE      *BLANKS
     C                   MOVE      '0'           PARMA1                         RETURKODE
     C                   MOVEL     HSKKO         PARMA2                         OBJEKT
     C                   MOVEL     '*OUTQ'       PARMA3                         OBJ.TYPE
     C                   CALL      'VC001A'      PVC001
      *
     C     PARMA1        IFEQ      '1'                                          FEIL
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   ELSE
      *
      *  Gyldig skriverkø, sjekk om køen også er opprettet som skriver
      *
     C     HSKKO         CHAIN     SKIDL01                            50
     C     *IN50         IFEQ      *OFF                                         <NF
     C     HTEGN         IFEQ      *BLANKS
     C                   MOVE      *ON           *IN70
     C                   MOVE      *ON           *IN98
     C                   ELSE
     C     HTEGN         IFNE      TEG1SK
     C     HTEGN         ANDNE     TEG2SK
     C     HTEGN         ANDNE     TEG3SK
     C     HTEGN         ANDNE     TEG4SK
     C                   MOVE      *ON           *IN70
     C                   MOVE      *ON           *IN98
     C                   ENDIF                                                  <HTEGN...
     C                   ENDIF                                                  <HTEGN
     C                   ELSE                                                   <*IN50
      *
      *  Skriverkøen er ikke en printer. Test skrivetetthet mot
      *  standardverdier, og sett skrivertype = 1
      *
     C                   MOVE      '1'           SKTYPE
     C     HTEGN         IFNE      '10  '
     C     HTEGN         ANDNE     '12  '
     C     HTEGN         ANDNE     '15  '
     C     HTEGN         ANDNE     '16.7'
     C                   MOVE      *ON           *IN70
     C                   MOVE      *ON           *IN98
     C                   ENDIF                                                  <HTEGN...
     C                   ENDIF                                                  <*IN50
     C                   ENDIF                                                  <PARMA1
     C                   ENDIF                                                  <HSKKO = ' '
      *
      *****************************************************************
      *  Sjekk felter for formularnavn, skriverid og skriverkø        *
      *****************************************************************
      *
     C     HFORM         IFEQ      *BLANKS
     C                   MOVE      *ON           *IN72                          <FEIL
     C                   MOVE      *ON           *IN98                          <FEIL
     C                   ENDIF
      *
     C     HSKID         IFNE      *BLANKS
     C     HSKKO         ANDNE     *BLANKS
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98                          <FEIL
     C                   ENDIF
      *
     C     HSKID         IFEQ      *BLANKS
     C     HSKKO         ANDEQ     *BLANKS
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98                          <FEIL
     C                   ENDIF
      *
      *****************************************************************
      *  Sjekk om utfylt jobbø er gyldig                              *
      *****************************************************************
      *
     C                   MOVE      '0'           PARMA1                         RETURKODE
     C                   MOVEL     HJOBQ         PARMA2                         OBJEKT
     C                   MOVEL     '*JOBQ'       PARMA3                         OBJ.TYPE
     C                   CALL      'VC001A'      PVC001
      *
     C     PARMA1        IFEQ      '1'
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   ENDIF                                                  <ÅRCODE
      *
     C     *IN98         CABEQ     *ON           VISB02                         <VIS FEILMELD
      *
      *****************************************************************
      *  Oppdater verdier i local data area for bruk til override.    *
      *****************************************************************
      *
     C                   MOVE      HFORM         WFORM
     C     SKRILD        IFNE      'FR331U01'
     C     HSKKO         IFEQ      *BLANKS
     C                   MOVE      HSKID         WWSKKO
     C                   ELSE
     C                   MOVE      HSKKO         WWSKKO
     C                   ENDIF
     C                   ENDIF                                                  <WSKRID
     C     HANTKO        IFNE      *ZEROS
     C                   MOVE      HANTKO        WWANTK
     C                   ELSE
     C                   Z-ADD     1             WWANTK
     C                   ENDIF
     C                   MOVE      HTEGN         WWTEGN
     C                   MOVE      HLENGD        WWLENG
     C                   MOVE      HSAVE         WWSAVE
     C                   MOVE      HHOLD         WWHOLD
     C                   MOVE      SKTYPE        WWSKTY
     C     WWSKTY        IFEQ      '3'                                          IPDS
      *
      * Hvis programmet ikke kalles fra VR005, konverteres antall
      * tegn til tilsvarende font for skrivertype 3
      *
     C     *IN10         IFEQ      *OFF
     C                   SELECT
     C     HTEGN         WHENEQ    TEG1SK
     C                   MOVE      FON1SK        WWTEGN
     C     HTEGN         WHENEQ    TEG2SK
     C                   MOVE      FON2SK        WWTEGN
     C     HTEGN         WHENEQ    TEG3SK
     C                   MOVE      FON3SK        WWTEGN
     C     HTEGN         WHENEQ    TEG4SK
     C                   MOVE      FON4SK        WWTEGN
     C                   ENDSL
     C                   ENDIF                                                  <*IN10
     C                   ENDIF                                                  <WWSKTY
      *
N24   * Hvis det er definert en overflow linje i FORMF eller BRSKF så
N24   * benyttes denne.
E24   * Hvis ikke beregnes overflow-linjeen til WWLENG - 6.
      * Hvis lengden er 6 eller mindre settes WWOVFL = WWTEGN
      *
N24P C     WWLENG        IFLT      60
N24P C                   MOVE      *BLANK        BFKODE
N24P C                   ENDIF                                                  <WWLENG
N55
N24P C     BFKODE        IFNE      *BLANKS
N55
N55  C     BFKODE        IFEQ      'K'
N55  C     WWLENG        SUB       31            XLINJE
N55  C                   ELSE                                                   <BFKODE
N24P C     WWLENG        SUB       26            XLINJE
N55  C                   ENDIF                                                  <BFKODE
N55
N24P C     HOVFL         IFGT      XLINJE
N55  C     HLENGD        ANDNE     W_HLENGD
N24P C     HOVFL         OREQ      *ZEROS
N24P C                   Z-ADD     XLINJE        HOVFL
N24P C                   ENDIF                                                  <HOVFL
N55
N24P C                   ENDIF                                                  <BFKODE
N24P  *
N24P  * HVIS LENGDE OVERSTYRT TIL MER ENN 2 LINJER FLERE BØR OGSÅ
N24P  * OVERFLOW ØKES/ENDRES TIL LENGDE - 6.
N24P  * (ELLERS BLIR F.EKS OFLOW=43 V/ENDRING FRA 48 TIL 72)
N24P C     WWLENG        SUB       WLENGD        WWWLEN            3 0
E24P C     HOVFL         IFNE      *ZEROS
E24P C     HOVFL         ANDLE     WWLENG
E24P C                   Z-ADD     HOVFL         WWOVFL
E24P C                   ELSE                                                   <HOVFL
E24P C     WWLENG        SUB       6             WWOVFL
E24P C                   ENDIF                                                  <HOVFL
      *
     C                   MOVE      HJOBQ         JOBQLD
     C                   MOVE      HJHOLD        HJOBLD
     C                   OUT       *DTAARA
      *
     C                   ELSE                                                   <*IN12...
     C                   MOVE      *IN12         WIN12                          <AVBRYT
     C                   MOVE      *IN03         WIN03                          <GÅ UT
      *
     C                   ENDIF                                                  <*IN12
     C                   ELSE                                                   VISPRU
     C     SKRILD        IFNE      'FR331U01'
     C     HSKKO         IFEQ      *BLANKS
     C                   MOVE      HSKID         WWSKKO
     C                   ELSE
     C                   MOVE      HSKKO         WWSKKO
     C                   ENDIF
     C                   ENDIF                                                  <WSKRID
     C                   MOVE      HFORM         WFORM
     C                   MOVE      HTEGN         WWTEGN
     C     WWSKKO        CHAIN     SKIDL01                            50
     C     *IN50         IFEQ      *OFF
     C     SKTYPE        IFEQ      '3'                                          IPDS
     C                   SELECT
     C     HTEGN         WHENEQ    TEG1SK
     C                   MOVE      FON1SK        WWTEGN
     C     HTEGN         WHENEQ    TEG2SK
     C                   MOVE      FON2SK        WWTEGN
     C     HTEGN         WHENEQ    TEG3SK
     C                   MOVE      FON3SK        WWTEGN
     C     HTEGN         WHENEQ    TEG4SK
     C                   MOVE      FON4SK        WWTEGN
     C                   ENDSL
     C                   ENDIF                                                  <WWSKTY
     C                   ENDIF                                                  <*IN50
     C                   MOVE      SKTYPE        WWSKTY
     C                   MOVE      HANTKO        WWANTK
     C                   MOVE      HLENGD        WWLENG
     C                   MOVE      HSAVE         WWSAVE
     C                   MOVE      HHOLD         WWHOLD
     C                   MOVE      HJOBQ         JOBQLD
     C                   MOVE      HJHOLD        HJOBLD
N24   *
N24P C     WWLENG        IFLT      60
N24P C                   MOVE      *BLANK        BFKODE
N24P C                   ENDIF                                                  <WWLENG
N55
N24P C     BFKODE        IFNE      *BLANKS
N55
N55  C     BFKODE        IFEQ      'K'
N55  C     WWLENG        SUB       31            XLINJE
N55  C                   ELSE                                                   <BFKODE
N24P C     WWLENG        SUB       26            XLINJE
N55  C                   ENDIF                                                  <BFKODE
N55
N24P C     HOVFL         IFGT      XLINJE
N24P C     HOVFL         OREQ      *ZEROS
N24P C                   Z-ADD     XLINJE        HOVFL
N24P C                   ENDIF                                                  <HOVFL
N55
N24P C                   ENDIF                                                  <BFKODE
N24P  *
E24P C     HOVFL         IFNE      *ZEROS
E24P C     HOVFL         ANDLE     WWLENG
N24  C                   Z-ADD     HOVFL         WWOVFL
N24  C                   ELSE                                                   <HOVFL
     C     WWLENG        SUB       6             WWOVFL
N24  C                   ENDIF                                                  <HOVFL
N24   *
     C                   ENDIF                                                  <VISPRU
      *
     C     *IN92         IFEQ      *ON
     C                   CLOSE     TPMER5BF                             91
     C                   ENDIF                                                  <*IN92
     C                   MOVE      *ON           *INLR
      *
      *****************************************************************
      *  S U B R 0 1    Viser oversikt over alle skrivere i SKIDF     *
      *****************************************************************
      *
     C     SUBR01        BEGSR
      ****
      *  Tømmer subfilen
      ****
     C                   WRITE     VR001B99
     C                   MOVE      *ON           *IN33
     C                   WRITE     VR001K01
     C                   MOVE      *OFF          *IN33
     C                   MOVE      *OFF          *IN34
      *
     C                   Z-ADD     *ZEROS        RRN
      ****
      *  Leser filen
      ****
     C     HSKID         SETLL     SKIDL01                              34      INGEN REC
     C  N34              READ      SKIDL01                                34    NESTE OM N34
      *
     C     *IN34         IFEQ      *ON
     C                   MOVE      *ON           *IN36
     C                   GOTO      SUB09
     C                   ENDIF
      ****
      *  Fyll subfilen
      ****
     C     SUB02         TAG
     C  N34              DO
     C                   DO        8
     C                   ADD       1             RRN
     C                   WRITE     VR001H01
     C                   READ      SKIDL01                                34
     C  N34              ENDDO
     C                   ENDDO
      ****
      *  Skriv ut subfilen
      ****
     C     SUB03         TAG
     C                   MOVEA     '11'          *IN(31)
     C     RRN           IFNE      *ZEROS
     C                   WRITE     VR001B03
     C                   EXFMT     VR001K01
     C                   ENDIF
     C                   MOVEA     '00'          *IN(31)
      ****
      *  Hvis F12 avsluttes søking
      ****
     C     *IN12         IFEQ      *ON
     C                   GOTO      SUB09
     C                   ENDIF
      ****
      *  Hvis ROLL fylles ny poster i subfilen
      ****
     C     *IN07         IFEQ      *ON
     C                   MOVE      *OFF          *IN07
     C                   GOTO      SUB02
     C                   ENDIF
      ****
      *  Hvis ENTER, finn posten som er valgt
      ****
     C     *IN36         IFEQ      *OFF                                         REC PÅ SUBF
     C     LESNY         TAG
     C                   READC     VR001H01                               37
     C     *IN37         CABEQ     *ON           SUB03
     C     VELG          CABNE     '1'           LESNY
     C                   MOVE      *OFF          *IN34
     C                   MOVE      SKID          HSKID
     C                   GOTO      SUB09
     C                   ENDIF
      ****
      *  Skriv subfilen på nytt, valg ikke foretatt
      ****
     C                   GOTO      SUB03
     C     SUB09         TAG
      *
     C                   ENDSR
      *
      *****************************************************************
      *  S U B R 0 2    Sjekker evt. henter opplysninger fra          *
      *                 skriverstyringsfilen(e)                       *
      *****************************************************************
      *
     C     SUBR02        BEGSR
     C                   MOVE      *ON           *IN49
      *
      *  Åpne styringsfiler for utskrift
      *
     C     *IN51         IFEQ      *OFF
     C                   MOVE      *ON           *IN51
     C                   OPEN      FORML01
     C                   ENDIF
     C     *IN52         IFEQ      *OFF
     C                   MOVE      *ON           *IN52
     C                   OPEN      BRSKL01
     C                   ENDIF
      *
     C                   MOVE      *OFF          *IN76
      *
      *  Hvis programmet kalles opp fra VR005 (*IN10) er skriverfil
      *  i LDA satt til 'STANDARD'. Hvis denne finnes i formularfilen
      *  vises ikke skriverbildet da eventuelle overstyringer på bildet
      *  ikke vil få noen effekt. Dette formularet vil brukes der hvor
      *  tilhørende formular ikke er opprettet.
      *
     C     KEY01         CHAIN     FORMR                              50
     C     *IN50         IFEQ      *OFF                                         <FUNNET
     C     *IN10         ANDEQ     *ON                                          <VR005
     C                   MOVE      'N'           VISPRU
     C                   ENDIF                                                  <*IN50...
     C     *IN50         IFEQ      *ON                                          <UKJENT
     C                   MOVEL     'STANDARD'    STDFOR
     C     KEYSTD        CHAIN     FORMR                              53
     C     *IN53         IFEQ      *OFF
     C                   MOVE      *BLANKS       SKKOMM
     C                   MOVE      *ON           *IN76                          <FEILMELD.
     C                   ENDIF                                                  <*IN53
     C                   ENDIF                                                  <*IN50
     C     *IN50         IFEQ      *ON
     C     *IN53         ANDEQ     *ON
     C                   MOVE      *OFF          *IN49
     C                   ELSE                                                   <FINNES
     C                   MOVE      FORTRY        FORTLD                         <FORTRYKT
     C                   MOVE      FORMID        HFORM                          <FORMULAR
     C     SKRILD        IFNE      'FR331U01'
     C                   MOVE      SKID          HSKID                          <SKRIVER
     C                   ENDIF                                                  <WSKRID
     C                   MOVE      *BLANKS       HSKKO                          <KØ
     C                   Z-ADD     KOPI          HANTKO                         <ANT.KOPIER
N50  C     SKRILD        IFNE      'VR975U01'
     C                   Z-ADD     FLENGD        HLENGD                         <LENGDE
N55  C                   Z-ADD     FLENGD        W_HLENGD                       <LENGDE
N50  C                   ENDIF
N24P C                   Z-ADD     OVFLFO        HOVFL                          <OVERLOW
     C                   MOVE      TEGN          HTEGN                          <TEGN/FONT
     C                   MOVE      HOLD          HHOLD                          <HOLD
     C                   MOVE      SAVE          HSAVE                          <SAVE
     C                   MOVE      OVR1FO        WPR(1)                         <PR FORMID
     C                   MOVE      OVR2FO        WPR(2)                         <PR SKRIVER
     C                   MOVE      OVR2FO        WPR(3)                         <PR KØ
     C                   MOVE      OVR3FO        WPR(4)                         <PR ANT EKS
     C                   MOVE      OVR4FO        WPR(5)                         <PR LENGDE
     C                   MOVE      OVR5FO        WPR(6)                         <PR TEGN
     C                   MOVE      OVR6FO        WPR(7)                         <PR SAVE LISTE
     C                   MOVE      OVR7FO        WPR(8)                         <PR HOLDE LISTE
     C                   MOVE      OVR8FO        WPR(9)                         <PR JOBQ
     C                   MOVE      OVR9FO        WPR(10)                        <PR HOLDE I JOBQ
     C                   MOVEL     HEADFO        WFELTA                         <FULL HEADING
      *
     C     OVRKOD        IFEQ      'J'                                          <OVERSTYRT
     C                   MOVE      *BLANKS       LAGNR
     C                   MOVE      WUSER         USER
      *
     C     *IN76         IFEQ      *ON
     C                   MOVE      STDFOR        SKRILD
     C                   ENDIF
     C     KEY02         CHAIN     BRSKR                              50
     C     *IN50         IFEQ      *ON                                          <UKJENT
N40P C     LAGAVG        IFEQ      *BLANKS
N40P C                   MOVE      *BLANKS       LAGNR
N40P C                   ELSE
N40P C                   MOVE      LAGELD        LAGNR
N40P C                   ENDIF                                                  <LAGAVG
     C                   MOVE      *BLANKS       USER
     C     KEY02         CHAIN     BRSKR                              50
     C                   ENDIF                                                  <IN50
      *
     C     *IN50         IFEQ      *OFF                                         <FINNES
     C                   MOVE      FORMID        HFORM                          <FORMULAR
N24P C     SKRILD        IFNE      'FR331U01'
     C                   MOVE      SKID          HSKID                          <SKRIVER
N24P C                   ENDIF                                                  <SKRILD
     C                   MOVE      *BLANKS       HSKKO                          <KØ
     C                   Z-ADD     KOPI          HANTKO                         <ANT.KOPIER
     C                   MOVE      TEGNBR        HTEGN                          <TEGN
     C                   Z-ADD     FLENBR        HLENGD                         <LENGDE
N55  C                   Z-ADD     FLENBR        W_HLENGD                       <LENGDE
N24P C                   Z-ADD     OVFLBR        HOVFL                          <OVERLOW
     C                   MOVE      HOLDBR        HHOLD                          <HOLDE LISTE
     C                   MOVE      SAVEBR        HSAVE                          <SAVE  LISTE
     C                   MOVE      FORTBR        FORTLD                         <FORTRYKT
     C                   MOVE      OVR1BR        WPR(1)                         <PR FORMID
     C                   MOVE      OVR2BR        WPR(2)                         <PR SKRIVER
     C                   MOVE      OVR2BR        WPR(3)                         <PR KØ
     C                   MOVE      OVR3BR        WPR(4)                         <PR ANT EKS
     C                   MOVE      OVR4BR        WPR(5)                         <PR LENGDE
     C                   MOVE      OVR5BR        WPR(6)                         <PR TEGN
     C                   MOVE      OVR6BR        WPR(7)                         <PR SAVE LISTE
     C                   MOVE      OVR7BR        WPR(8)                         <PR HOLDE LISTE
     C                   MOVE      OVR8BR        WPR(9)                         <PR JOBQ
     C                   MOVE      OVR9BR        WPR(10)                        <PR HOLDE I JOBQ
     C                   MOVEL     HEADBR        WFELTA                         <FULL HEADING
     C                   ENDIF                                                  <IN50
     C                   ENDIF                                                  <OVRKOD
     C                   ENDIF                                                  <IN50
      *
      *  Lukke styringsfiler for utskrift
      *
     C     *IN51         IFEQ      *ON
     C                   MOVE      *OFF          *IN51
     C                   CLOSE     FORML01
     C                   ENDIF
     C     *IN52         IFEQ      *ON
     C                   MOVE      *OFF          *IN52
     C                   CLOSE     BRSKL01
     C                   ENDIF
      *
     C                   ENDSR
      *
      *****************************************************************
      * Subrutine som viser tegn og font for skriver eller kø         *
      *****************************************************************
      *
     C     SUBR03        BEGSR
      *
     C                   MOVE      *OFF          *IN50
     C                   MOVE      *BLANKS       MELD04
     C                   MOVE      *BLANKS       VELG1
     C                   MOVE      *BLANKS       VELG2
     C                   MOVE      *BLANKS       VELG3
     C                   MOVE      *BLANKS       VELG4
      *
     C     HSKKO         IFNE      *BLANKS
     C                   MOVE      HSKKO         WSKRIV
     C     HSKKO         CHAIN     SKIDL01                            53
     C     *IN53         IFEQ      *ON
     C                   MOVE      '10  '        TEG1SK
     C                   MOVE      '12  '        TEG2SK
     C                   MOVE      '15  '        TEG3SK
     C                   MOVE      '16.7'        TEG4SK
     C                   MOVE      *BLANKS       FON1SK
     C                   MOVE      *BLANKS       FON2SK
     C                   MOVE      *BLANKS       FON3SK
     C                   MOVE      *BLANKS       FON4SK
     C                   ENDIF                                                  <*IN53
     C                   ELSE
     C                   MOVE      HSKID         WSKRIV
     C     HSKID         CHAIN     SKIDL01                            50
     C     *IN50         IFEQ      *ON
     C                   MOVEL     ARRC(3)       MELD04
     C                   MOVE      *BLANKS       TEG1SK
     C                   MOVE      *BLANKS       TEG2SK
     C                   MOVE      *BLANKS       TEG3SK
     C                   MOVE      *BLANKS       TEG4SK
     C                   MOVE      *BLANKS       FON1SK
     C                   MOVE      *BLANKS       FON2SK
     C                   MOVE      *BLANKS       FON3SK
     C                   MOVE      *BLANKS       FON4SK
     C                   ENDIF                                                  <*IN50
     C                   ENDIF                                                  <HSKKO
     C     VISB04        TAG
     C                   EXFMT     VR001B04
     C     *IN12         IFEQ      *OFF
     C     VELG1         IFEQ      '1'
     C                   MOVE      TEG1SK        HTEGN
     C                   ELSE
     C     VELG2         IFEQ      '1'
     C                   MOVE      TEG2SK        HTEGN
     C                   ELSE
     C     VELG3         IFEQ      '1'
     C                   MOVE      TEG3SK        HTEGN
     C                   ELSE
     C     VELG4         IFEQ      '1'
     C                   MOVE      TEG4SK        HTEGN
     C                   ELSE
     C                   GOTO      VISB04
     C                   ENDIF                                                  <VELG4
     C                   ENDIF                                                  <VELG3
     C                   ENDIF                                                  <VELG2
     C                   ENDIF                                                  <VELG1
     C                   ENDIF                                                  <*IN12
      *
     C                   ENDSR
      *
      *****************************************************************
      * Subrutine som finner cursorposisjon                           *
      *****************************************************************
      *
     C     FINPOS        BEGSR
      *
     C                   Z-ADD     CURLIN        CURLI1            5 0
     C     CURLI1        DIV       256           LINJE             2 0
     C     LINJE         MULT      256           CURLI2            5 0
     C     CURLI1        SUB       CURLI2        POS               3 0
     C                   ENDSR
      *
      *****************************************************************
      * F E I L S R                                                   *
      * Subrutine som rydder opp etter en feil i forbindelse          *
      * med et skjermbilde                                            *
      *****************************************************************
      *
     C     FEILSR        BEGSR
      ****
      * Skriver feillogg
      ****
     C                   OPEN      FEILLOGG
     C                   WRITE     FEIL
     C                   CLOSE     FEILLOGG
      ****
      * Lukker programkontrollerte filer og tar SIGNOFF
      ****
     C                   MOVE      *ON           *INLR
     C                   Z-ADD     15            LEN              15 5
     C                   MOVEL     ARRC(1)       KOMM             60
     C                   CALL      'QCMDEXC'
     C                   PARM                    KOMM
     C                   PARM                    LEN
      *
     C                   ENDSR
      *                                                                ***
**  COPYRIGHT LOAD
CALL PGM(VC006)
5797-AWH IBM NORWAY 1988  5797-AWD COPYRIGHT IBM CORP. 1988
Ukjent skriver
