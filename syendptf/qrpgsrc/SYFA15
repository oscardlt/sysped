********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 vis flagg dersom arkivert dok finnes.. ikke vis null i foretn/tollkonto
      *              Parameterlengde ved kall på ARC003
12XXX * 02 YBC PTF12 NULLSTILL CAVD
********************************************************************
     FVADR      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     F                                     RENAME(KUNDR:KUNDL1)
     FCUNDC01   IF A E           K DISK
     FSYFA15FM  CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     FCUNDL02   IF   E           K DISK
     FCUNDL03   IF   E           K DISK
     FCUNDL04   IF   E           K DISK
     FCUNDL05   IF   E           K DISK
     FCUNDL06   IF   E           K DISK
     F                                     RENAME(KUNDR:KUNDR6)
     FCUNDL08   IF   E           K DISK
     F                                     RENAME(KUNDR:KUNDR8)
n01  FARKIVL11  IF   E           K DISK
     FFIRM      IF   E           K DISK
     D                 DS
     D  WSPOST                 1      4
     D  WSPO11                 1      1
     D  WSPO12                 1      2
     D  WSPO13                 1      3
     D  WSPO14                 1      4  0
     D  WSPO24                 2      4
     D  WSPO34                 3      4
     D  WSPO44                 4      4
     D                 DS
     D  ENGAD3                 1     30
     D  SYPOGE                 1      9
     D  ADR3                  11     34
     D                 DS
     D  SYKONX                 1      9
     D  SYFR02                 1      1
     D  SYKO05                 2      6
     D  SYKO02                 8      9
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYA          KLIST                                                  CUNDL02
     C                   KFLD                    FIFIRM
     C                   KFLD                    ZSØNAV
      *________________
      * Hente Firmakode
      *""""""""""""""""
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   60
     C     KUNKEY        KLIST                                                  CUNDL02
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C     VADKEY        KLIST                                                  CUNDL02
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C                   KFLD                    VADRNR
     C                   Z-ADD     1             VADRNR
      *
     C     KUND2K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    ZSØNAV
     C     KUND3K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSPO11
     C                   KFLD                    ZSØNAV
     C     KUND4K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSPO12
     C                   KFLD                    ZSØNAV
     C     KUND5K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSPO13
     C                   KFLD                    ZSØNAV
     C     KUND6K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSPO14
     C                   KFLD                    ZSØNAV
     C     WFIPO3        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSPO11
     C     WFIPO4        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSPO12
     C     WFIPO5        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSPO13
     C     WFIPO6        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSPO14
     C     KUND8K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSLK
     C                   KFLD                    ZSØNAV
     C     WFIRLA        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSLK
N01  C     ArkKey11      KLIST
N01  C                   KFLD                    ARSTAT
N01  C                   KFLD                    uuparu
N01  C                   move      'A'           ARSTAT
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
      *__________
      * Valgbilde
      *""""""""""
     C     SRB1          TAG
      *
     C                   WRITE     BUNN
     C                   EXFMT     VALG
     C     *IN03         CABEQ     '1'           SRB9
     C     *IN12         CABEQ     '1'           SRB9
      * Hvis søkefelt=*blank, vis bilde igjen.
     C     ZSØNAV        CABEQ     *BLANKS       SRB1
     C                   SETOFF                                       828384
     C     WSPOST        COMP      *BLANKS                            818180
     C   81WSPO24        COMP      *BLANKS                            828281
     C   82WSPO34        COMP      *BLANKS                            838382
     C   83WSPO44        COMP      *BLANKS                            848483
      *______________
      * Tømme Subfile
      *""""""""""""""
     C     SRB3          TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZERO         ZRECNO
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C*          KEYA      SETLLCUNDL02
     C*          FIFIRM    READECUNDL02                  94
     C   80WSLK          IFEQ      *BLANKS
     C     KUND2K        SETLL     CUNDL02
     C                   ELSE
     C     KUND8K        SETLL     CUNDL08
     C                   END
     C   81KUND3K        SETLL     CUNDL03
     C   82KUND4K        SETLL     CUNDL04
     C   83KUND5K        SETLL     CUNDL05
     C   84KUND6K        SETLL     CUNDL06
     C   80WSLK          IFEQ      *BLANKS
     C     FIFIRM        READE     CUNDL02                                94
     C                   ELSE
     C     WFIRLA        READE     CUNDL08                                94
     C                   END
     C   81WFIPO3        READE     CUNDL03                                94
     C   82WFIPO4        READE     CUNDL04                                94
     C   83WFIPO5        READE     CUNDL05                                94
     C   84WFIPO6        READE     CUNDL06                                94
     C     *IN94         CABEQ     '1'           SRB1
      *
     C     SRB4          TAG
      *
     C  N94              DO
     C                   DO        5
     C                   ADD       1             ZRECNO
     C                   MOVE      *BLANKS       WSADR3
     C     POSTNR        IFEQ      *ZEROS
     C     SYPOGE        IFEQ      *BLANKS
     C                   MOVEL     ADR3          WSADR3
     C                   ELSE                                                     4
     C                   MOVE      ENGAD3        WSADR3
     C                   END
     C                   ELSE                                                     4
     C                   MOVEL     POSTNR        WSADR3
     C                   MOVE      ADR3          WSADR3
     C                   END                                                      4<-E
     C                   MOVEL     SYRG          SFFORE
     C                   MOVE      SYKONT        SYKO02
     C                   MOVEL     SYKONT        SYKO05
N01  c     SFFORE        ifeq      '000000000'
n01  c                   move      *blanks       SFFORE
n01  c                   end
N01  c     SYKO05        ifeq      '00000'
n01  c                   move      *blanks       SYKONX
n01  c                   end
N01   * finnes arkivpost ?
N01  C                   MOVEL     'K:'          uuparu
n01  C                   MOVE      KUNDNR        uuparu           10
N01  c     ArkKey11      chain     arkivl11                           33
N01  c   33              move      ' '           SFARKIV
N01  c  N33              move      'A'           SFARKIV
     C                   WRITE     SUBFIL
     C*          FIFIRM    READECUNDL02                  94
     C   80WSLK          IFEQ      *BLANKS
     C     FIFIRM        READE     CUNDL02                                94
     C                   ELSE
     C     WFIRLA        READE     CUNDL08                                94
     C                   END
     C   81WFIPO3        READE     CUNDL03                                94
     C   82WFIPO4        READE     CUNDL04                                94
     C   83WFIPO5        READE     CUNDL05                                94
     C   84WFIPO6        READE     CUNDL06                                94
     C  N94              END
     C                   END
      *_______________
      * Behandle bilde
      *"""""""""""""""
     C     VISSUB        TAG
     C                   MOVEA     '11'          *IN(91)
     C                   WRITE     BUNN
     C                   EXFMT     SUBCTL
      *
     C     *IN12         CABEQ     '1'           SRB1
     C     *IN03         IFEQ      '0'
      *
     C                   MOVEA     '00'          *IN(91)
      *_______
      * ROLLUP
      *"""""""
     C     *IN25         IFEQ      '1'
     C                   MOVE      '0'           *IN25
     C                   GOTO      SRB4
     C                   END
      *
     C                   EXSR      HENT
     C     OPSJON        IFEQ      'J'
     C                   GOTO      VISSUB
     C                   ELSE
     C                   GOTO      SRB4
     C                   END
      *
     C                   END
      *
     C     SRB9          ENDSR
     C***********************************************
     C***********************************************
     C     HENT          BEGSR
     C***********************************************
     C                   MOVE      *BLANKS       OPSJON            1
     C                   Z-ADD     ZRECNO        GMREC             5 0
     C                   SETOFF                                       98
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C     *IN98         IFEQ      '0'

      * S= Skilleark
     C     WSNR          IFEQ      'S'                                          KPERS
     C                   MOVE      '  '          SCATYP            2
     C                   MOVEL     KUNDNR        SCASTR           20
     C                   CALL      'ARCA000CL'
     C                   PARM                    SCATYP
     C                   PARM                    SCASTR
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   END
      * P= PDF (=se arkiv)
     C     WSNR          IFEQ      'P'                                          KPERS
     C                   MOVEL     'K:'          uuparu
     C                   MOVE      KUNDNR        uuparu           10
     C                   CALL      'ARC003'
     C                   PARM                    uuuavd            4 0
s01  C*                  PARM                    uuuopd            5 0
N01  C                   PARM                    uuuopd            7 0
     C                   PARM                    uuparu
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   END
      *
     C     WSNR          IFEQ      'K'                                          KPERS
     C                   MOVE      'J'           OPSJON            1
     C                   EXSR      CUNDCA
     C                   CALL      'VCUNDCR'
     C                   PARM                    FIFIRM
     C                   PARM                    KUNDNR
     C                   PARM                    RRN              10 0
     C                   PARM                    UEMFA             1
     C                   PARM                    UCONTA           30
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   END
      *
     C     WSNR          IFEQ      'V'                                          VIS KUNDE
     C                   MOVE      'J'           OPSJON            1
     C     VADKEY        CHAIN     VADR                               33
     C   33              MOVE      *BLANKS       VADRNA
     C   33              MOVE      *BLANKS       VADRN1
     C   33              MOVE      *BLANKS       VADRN2
     C   33              MOVE      *BLANKS       VADRN3
     C   33              MOVE      *BLANKS       VADRNA
     C   33              MOVE      *BLANKS       VADRNA
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C     KUNKEY        CHAIN     CUNDL01                            33
     C                   MOVEL     SYRG          SYFORE
     C                   EXFMT     BILDEKU
     C                   END
     C     WSNR          IFEQ      'L'                                          KPERS
     C                   MOVE      'J'           OPSJON            1
     C                   CALL      'SOEKVADR'
     C                   PARM                    FIFIRM
     C                   PARM                    KUNDNR
     C                   PARM                    WNAVN            30
     C                   PARM                    WADR1            30
     C                   PARM                    WADR2            30
     C                   PARM                    WADR3            30
     C                   PARM                    WLAND             2
     C                   PARM                    WADRNR            5
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   END
      *
     C     WSNR          IFEQ      'F'                                          KPERS
     C                   MOVE      'KUNDER: '    XTXT              8
     C                   Z-ADD     1             UFLAGG            1 0
     C                   MOVE      'V'           DELSY             1
     C                   CALL      'FRITXTSK'
     C                   PARM                    FIFIRM
     C                   PARM                    KUNDNR
     C                   PARM                    XTXT
     C                   PARM                    UFLAGG
     C                   PARM                    DELSY
     C*
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   END
     C                   END
     C                   END
     C*
     C                   Z-ADD     GMREC         ZRECNO
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     CUNDCA        BEGSR
     C***********************************************
      * ADD POST I CUNDC HVIS MANGLER
     C     KUNKEY        SETLL     CUNDC01                                51
     C     *IN51         IFEQ      *OFF
     C                   MOVEL     FIRMA         CFIRMA
     C                   Z-ADD     KUNDNR        CCOMPN
     C                   MOVEL     KPERS         CCONTA
     C     TFAXNR        IFNE      *BLANKS
     C                   MOVEL     TFAXNR        CFAX
     C                   ELSE
     C                   MOVEL     TLF           CFAX
     C                   ENDIF
N02  C                   MOVE      *ZEROS        CAVD
     C                   WRITE     CUNDCR
     C                   ENDIF
     C                   ENDSR
