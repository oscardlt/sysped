     ‚****************************************************************************************
     ‚* Send SMS med lenke til tur godsliste for smartphone (og derfra til TKEVENT-grabber)  *
     ‚*      (svært likt som ESOP11HS som er å sende lenke direkte til TKEVENT-grabber)      *
     ‚****************************************************************************************
****‚***************************************************************
     ‚* RETTINGER I DETTE PROGRAM:
PTFn‚:*Sek Sig Vers  Beskrivelse...........................
""""‚"*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX‚* 01 JOV PTF11
****‚***************************************************************
     H DftActGrp( *No )
     fturer14   if   e           k disk
     ffirm      if   e           k disk
     ffirmarc   if   e           k disk
     fsyparl3   if   e           k disk
     ftrackf    o  a e           k disk
     ‚*__________
     ‚* Variabler
     ‚*""""""""""
     d usrid           s            128
     d pw              s             32
     d smsnr           s             16
N05  d smsnr2          s             20a   varying
     d body            s           1280
     d smslen          s              5  0
     d smsant          s              1  0
     d lf              c                   x'25'
     d up              c                   const('ABCDEFGHIJKLMNOPQRST-
     d                                     UVWXYZÆØÅ')
     d lo              c                   const('abcdefghijklmnopqrst-
     d                                     uvwxyzæøå')
     d                sds
     d zuser                 254    263
     ‚*  Prototype for 'SYGE99'
     d syge99          pr                  extpgm('SYGE99')
     d usrid_                              like(usrid)
     d pw_                                 like(pw)
     d smsnr_                              like(smsnr)
     d body_                               like(body)
     ‚*  Prototype for syfa55s
     d syfa55s         pr
     d tuproa_                             like(tuproa)
     d uusms_                              like(uusms)
     d uuuser_                             like(uuuser)
     d uuspra_                             like(uuspra)
     ‚*  Prototype for 'SYGE15C'
     d syge15c         pr                  extpgm('SYGE15C')
     d wdt_                                like(wdt)
     d wtm_                                like(wtm)
     ‚*  *ENTRY Interface for Main Procedure
     d syfa55s         pi
     d tuproa                         8
     d uusms                         15
     d uuuser                        10
     d uuspra                         2
     ‚*----------------------------------------------------------------------
     ‚* Stand Alone Fields - TOP
     ‚*----------------------------------------------------------------------
     d sprak           s              7
     d sykd            s              5
     d wdt             s              8
     d wtm             s              6
     ‚*----------------------------------------------------------------------
     ‚* Stand Alone Fields - BOTTOM
     ‚*----------------------------------------------------------------------


      /free
       exsr init;

       chain ( tupro ) turer14;
       if %found;
         exsr lagsms;
         exsr ttsr;
       endif;

       *inlr = *on;
       return;



       //*****************************************************************************
       begsr lagsms;
       //*****************************************************************************
        // OBS - HS SYSTEMA - MÅ KOMILER MOT *PRV eller høyere
         smsnr2 = %ScanRpl( ' ': '': uusms );
         smsnr2 = %ScanRpl( '+': '%2B': smsnr2 );
         uusms  = smsnr2;
         // mer enn 8 tegn- engelsk språk
         if uuspra <> *blanks;
           if uuspra <> 'NO';
             sprak = '%26s=EN';
           endif;
         else;
           if %subst(uusms:9)<>*blanks;
             sprak = '%26s=EN';
           endif;
         endif;
        // språktest / også norske tekster endret ingen merking ...
         if sprak = *blanks;
           body='Lenke til godsliste-App for '+ %trim(fift);
           body=%trim(body)+' http://'+ %trim(arcpae) + '/sycgip/estk550T.pgm'
           +'?user='+%trim(syvrda) +'%26t='+%trim(uusms)
           +'%26tur='+%trim(tuproa) +sprak;
         else;
         // engelsk
           body='Link to Manifest App for '+ %trim(fift);
           body=%trim(body)+' http://'+ %trim(arcpae) + '/sycgip/estk550T.pgm'
           +'?user='+%trim(syvrda) +'%26t='+%trim(uusms)
           +'%26tur='+%trim(tuproa) +sprak;
         endif;

         smslen=%len(%trim(body));
         smsant=(smslen/160)+0.9999;
         usrid='roger@systema.no';
         pw='straffe12';
         smsnr= uusms;
         syge99 ( usrid : pw : smsnr : body );

       endsr;

       //*****************************************************************************
       begsr ttsr;
       //*****************************************************************************
         tttur = tupro;
         ttdate = %int(wdt);
         tttime = %int(wtm);
         ttdatl = ttdate;
         tttiml = tttime;
         ttacti = 'CMS';
         ttuser = zuser;
         if uuuser <> *blanks;
           ttuser = uuuser;
         endif;
         tttext ='Link to manifest App SMS sent to '
                  + uusms;
         tttexl ='Lenke til godslisteApp SMS sent til '
                  + uusms;
         ttedre = %trim(%editc(smsant:'Z'));
         ttdepo = 'Len:'+%trimr(%editc(smslen:'Z'));
         ttmanu = 'S';
         write trackfr;

       endsr;

       //*****************************************************************************
       begsr init;
       //*****************************************************************************
         tupro  = %int(tuproa);
         sykd = 'ESUSR';
         chain ( sykd ) syparl3;
         if not %found;
           syvrda = 'NN';
         endif;

         setll *loval firm;
         read firm;
         chain fifirm firmarc;
         arcpae = %xlate(up:lo:arcpae);
         // hent dato tid
         syge15c ( wdt : wtm );
       endsr;

      /end-free
