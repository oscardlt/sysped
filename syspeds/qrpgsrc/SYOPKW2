      *********************************************************************
      *
      *
CRTPG+*  CRTPGM SYSPED/SYOPKW2 MODULE(*LIBL/SYOPKW2 *LIBL/INCGI)
CRTPGM*         ACTGRP(CGI) AUT(*USE)
      *
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
     FHENOP     IF   E           K DISK    USROPN
     FHENOS02   IF   E           K DISK    USROPN
     FHENOF01   IF   E           K DISK    USROPN
      *********************************************************************
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      /copy syspeds/qrpgsrcpy,variables3
      *
OddEvD OddEven         s             10
      * Client input variables
     D user            s             10
     D Term            s              4
     D KUNDE           s              8
     D Dager           s              3
     D DagerN          s              5  0
      *
     D XXDATN          s              8  0
     D XXTIMN          s              4  0
     D AddSub          s              3
     D Idag            s              8  0
     D DatoGmN         s              8  0
     D BlankIco        s             20a   inz('blank.gif')
     D MeldIco         s             20a   inz('melding.gif')
     D FarlIco         s             20a   inz('farlig.gif')
     D VarmIco         s             20a   inz('varme.gif')
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
     D ItemCount       s             10i 0
     D i               s             10i 0
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XUL≈≈                 11     14  0
     D  XULDDMM                7     10  0
     D  XUL≈≈2                13     14  0
     D                 DS
     D  UL≈≈                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     D                 DS
     D  HSds                   1     30
     D  XXDATE                 1      8
     D  XXTIME                 9     14
     D                 DS
     D  WDs≈MD                 1      8  0
     D  WDs≈MD≈                1      4  0
     D  WDs≈MDM                5      6  0
     D  WDs≈MDD                7      8  0
     D                 DS
     D  WDsDM≈                 1      8  0
     D  WDsDM≈D                1      2  0
     D  WDsDM≈M                3      4  0
     D  WDsDM≈≈                5      8  0
     D                 DS
     D  HSNAK                  1     30
     D  XXNAK                  1     15
     D                 DS
     D  HSPNRK                 1      4  0
     D  XXPNRK                 1      4
     D                 DS
     D  HSSTDK                 1     25
     D  XXSTDK                 1     15
      /copy syspeds/qrpgsrcpy,prolog3
      *
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input / cvt to numeric
     C                   exsr      Parse
      * File open / keys
     C                   EXSR      INIT
      * Read output skeleton html member into memory
     C                   exsr      LoadHtml
      * Set section variables
     C                   exsr      Settop
     C                   callp     wrtsection('top')
      *
      * HOVEDRUTINE
      *
      * 1. Vis liste over registrete sendinger  - I DAG
     C                   callp     wrtsection('top2a')
     C                   callp     wrtsection('top2t')
      *
     c     HOLNR         setLL     HENOS02
     c     HOLNR         ReadE     HENOS02                                35
      *
     c     *IN35         doweq     '0'
     C                   eval      XXDATN   = c2n2(XXDATE)
     c     XXDATN        IFGE      ULDT
     C                   exsr      Setrow
     C                   callp     wrtsection('row')
     c                   end
     c     HOLNR         ReadE     HENOS02                                35
      *
     c                   end
      *
      * 2. Vis liste over registrete sendinger XX foregÂende dager
     C                   callp     wrtsection('top2b')
     C                   callp     wrtsection('top2t')
      *
     c     HOLNR         setLL     HENOS02
     c     HOLNR         ReadE     HENOS02                                35
      *
     c     *IN35         doweq     '0'
     C                   eval      XXDATN   = c2n2(XXDATE)
     c     XXDATN        IFLT      ULDT
     c     XXDATN        andge     DatoGmN
     C                   exsr      Setrow
     C                   callp     wrtsection('row')
     c                   end
     c     HOLNR         ReadE     HENOS02                                35
      *
     c                   end
      *
      * 3. Vis liste over ELDRE registrete sendinger
      *
     C                   callp     wrtsection('top2c')
     C                   callp     wrtsection('top2t')
     c     HOLNR         setLL     HENOS02
     c     HOLNR         ReadE     HENOS02                                35
      *
     c     *IN35         doweq     '0'
     C                   eval      XXDATN   = c2n2(XXDATE)
     c     XXDATN        IFLT      DatoGmN
     C                   exsr      Setrow
     C                   callp     wrtsection('row')
     c                   end
     c     HOLNR         ReadE     HENOS02                                35
      *
     c                   end
      * Quit
      * Compute run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   callp     wrtsection('bot')
      *
     C                   exsr      Exit
      *
     C                   eval      *inlr = *on
     C                   return
      *
      *
      *=====================================================================
      * Parse input / cvt to numeric
      *=====================================================================
     C     Parse         begsr
      * Parse variables from QUERY_STRING environment variable
     C                   eval      term     = zhbgetvar('term')
     C                   eval      KUNDE    = zhbgetvar('KUNDE')
     C                   eval      HOLNR    = c2n2(KUNDE)
     C                   MULT      -1            HOLNR
     C                   eval      Dager    = zhbgetvar('Dager')
     C                   eval      DagerN   = c2n2(Dager)
     c     DagerN        Ifeq      *zeros
     c                   eval      DagerN   = 3
     c                   end
      * Userid.....
     C                   eval      user = zhbgetvar('user')
     C                   endsr
      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      * Quit
     C                   CLOSE     BRIDF
     C                   CLOSE     HENOP
     C                   CLOSE     HENOS02
     C                   CLOSE     HENOF01
     C                   endsr
      *=====================================================================
      * Read output skeleton html member into memory
      *=====================================================================
     C     LoadHtml      begsr
     C                   callp     gethtml('HTMLSRC':
     C                             '*LIBL':
     C                             'SYOPKW2':'/CGITAG/')
     C                   endsr
      *=====================================================================
      *  Set variable data for section /$top
      *=====================================================================
     C     SetTop        begsr
      *
OddEvC                   callp     updHTMLvar('ROWHEAD':RowHead)
OddEvC                   callp     updHTMLvar('LogoImg':LogoImg)
     C                   callp     updHTMLvar('USER':USER)
     C                   callp     updHTMLvar('TERM':TERM)
     C                   callp     updHTMLvar('KUNDE':KUNDE)
     C                   callp     updHTMLvar('HONAS':HONAS)
     C                   callp     updHTMLvar('DAGER':
     C                             %trim(%editc(DAGERN:'Z')))
      *
     C                   endsr
      *=====================================================================
      *  Set variable data for section /$row
      *=====================================================================
     C     Setrow        begsr
OddEvc     OddEven       IFEQ      ODD
OddEvc                   eval      OddEven = EVEN
OddEvc                   else
OddEvc                   eval      OddEven = ODD
OddEvc                   end
OddEvC                   callp     updHTMLvar('ODDEVEN':OddEven)
OddEv *
     C                   callp     updHTMLvar('LNR':
     C                             %trim(%editc(HSLNR:'Z')))
     C                   callp     updHTMLvar('HSSNDN':HSSNDN)
      * snu dato ≈.M.dag
     c                   move      XXDATN        WDs≈MD
     c                   move      WDs≈MD≈       WDsDM≈≈
     c                   move      WDs≈MDM       WDsDM≈M
     c                   move      WDs≈MDD       WDsDM≈D
     C                   callp     updHTMLvar('DATO':
     C                             %trim(%editw(WDsDM≈:'  .  .    ')))
     C                   Movel     XXTIME        XXTIM4            4
     C                   eval      XXTIMN   = c2n2(XXTIM4)
     C                   callp     updHTMLvar('TID':
     C                             %trim(%editw(XXTIMN:'  :  ')))
     C                   callp     updHTMLvar('XXNAK':XXNAK)
     C                   callp     updHTMLvar('XXPNRK':XXPNRK)
     C                   callp     updHTMLvar('XXSTDK':XXSTDK)
     C                   callp     updHTMLvar('HSAVDH':
     C                             %trim(%editc(HSAVDH:'Z')))
     C                   callp     updHTMLvar('HSANT':
     C                             %trim(%editc(HSANT:'Z')))
     C                   callp     updHTMLvar('HSVKT':
     C                             %trim(%editc(HSVKT:'Z')))
     C                   callp     updHTMLvar('HSM3':
     C                             %trim(%editc(HSM3:'3')))
     C                   callp     updHTMLvar('HSLM':
     C                             %trim(%editc(HSLM:'3')))
      * Melding til transport¯r??
     c     Henofkey      chain     henof01                            33
     C     *in33         ifeq      *ON
     C                   callp     updHTMLvar('MELDICO':BlankIco)
     c                   else
     C                   callp     updHTMLvar('MELDICO':MeldIco)
     c                   end
      * Farlig gods ??
     C     HSFARL        ifeq      *blanks
     C                   callp     updHTMLvar('FARLICO':BlankIco)
     c                   else
     C                   callp     updHTMLvar('FARLICO':FarlIco)
     c                   end
      * Varmegods ??
     C     HSVARM        ifeq      *blanks
     C                   callp     updHTMLvar('VARMICO':BlankIco)
     c                   else
     C                   callp     updHTMLvar('VARMICO':VarmIco)
     c                   end
      *
     C                   endsr
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   OPEN      BRIDF
     C     USER          CHAIN     BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt pÂ user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
      *
OddEv * hent Parametre som gÂr igjen i mange prog:
OddEv *      Odd/Even/Rowhead-farger,Logobilde,SprÂk,Intern/Ekstern bruker,  mm
OddEvc                   call      'ESGETPAR'
OddEvc                   parm                    BIBRID
OddEvc                   parm                    BIFIRM
OddEvc                   parm                    BIKUNR
OddEvc                   parm                    BIKNG
OddEvc                   parm                    RowHead          10
OddEvc                   parm                    Odd              10
OddEvc                   parm                    Even             10
OddEvc                   parm                    LogoImg          50
OddEvc                   parm                    XSPR≈K            2
OddEvc                   parm                    XINTERN           1
OddEvc                   parm                    ParmDS1        1024
OddEvc                   parm                    ParmDS2        1024
OddEvc                   parm                    ParmDS3        1024
      *
     C                   OPEN      HENOP
     C                   OPEN      HENOS02
     C                   OPEN      HENOF01
      *
      * Hentekundens navn
     c     HOLNR         Chain     HENOP
      *
      * HENT DATO/KLOKKESLETT
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XUL≈≈         UL≈≈
      *
      * ULDT er nÂ dagens dato i form HH≈≈MMDD
      * Finn datogrense for gruppa "foregÂende XX dager"
     c                   move      *zeros        Idag
     c                   move      *zeros        DatoGmN
     c                   move      'SUB'         AddSub
     C                   CALL      'SYGE20'
     C                   PARM                    AddSub
     C                   PARM                    IDag
     C                   PARM                    DatoGmN
     C                   PARM                    DagerN
      *
      * Key for sendings-fritekst
     C     HENOFKey      KLIST
     C                   KFLD                    HSLNR
     C                   KFLD                    HSSNDN
      *
     C                   endsr
      *
