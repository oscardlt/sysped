     FPALLDL04  IF   E           K DISK
     FPALLDL08  IF   E           K DISK
     F                                     RENAME(PALLDR:PALLDR08)
     FPAPA      IF   E           K DISK
     FPAPAL01   IF   E           K DISK
     F                                     RENAME(PAPAR:PAPAR2)
     FFIRM      IF   E           K DISK
     FPALFIR    IF   E             DISK
     FCUNDL01   IF   E           K DISK
     FSYPA06P   O    E             PRINTER OFLIND(*IN90)
     D                 DS
     D  IDAG                   1      8  0
     D  IDAG≈                  1      4  0
     D  IDAGM                  5      6  0
     D  IDAGD                  7      8  0
     C                   EXSR      INIT
      *
      * Skriv - Kun for en / flere utfra utvalg???
     C     UUPPNR        IFNE      *ZEROS
     C                   MOVE      UUPPNR        XXPPNR            8 0
     C     XXPPNR        CHAIN(N)  PAPA                               33
     C                   EXSR      ENPART
     C                   ELSE
     C                   EXSR      FLPART
     C                   END
      *
      *
     C                   SETON                                        LR
     C                   RETURN
      *
      *
      ********************************************************
     C     ENPART        BEGSR
      ********************************************************
     C                   MOVE      *BLANKS       XXBILN
     C                   MOVE      *ZEROS        SIDE
     C                   MOVE      *ZEROS        TOTANT            5 0
     C                   MOVE      *ZEROS        TOTMAN
     C                   MOVE      *ZEROS        TOTLAN
      * Hent pallepartens navn
     C     KUNKEY        CHAIN     CUNDL01                            33
     C                   MOVE      PPNR          XXNR              8 0
     C                   MOVE      PPKUNR        XXKUNR            8 0
     C                   MOVE      KNAVN         XKNAVN
     C                   MOVE      ADR1          XADR1
     C                   MOVE      ADR2          XADR2
     C                   MOVE      POSTNR        XPOSTN
     C                   MOVE      ADR3          XADR3
      *
      *
      * SKRIV/Merk detaljlinjer med status/KTO-UTDRAGSNR
     C     PPTRNR        COMP      *ZEROS                             70
      * 70 OFF=KUN PARTSSALDO
     C     *IN70         IFEQ      '0'
     C                   EXSR      SKRIV
     C                   ELSE
      * 70 ON=OPPFÿLGING P≈ BILNIV≈, Akkumuler ogsÂ parens totaler
     C                   MOVE      *ZEROS        XOTANT
     C                   MOVE      *ZEROS        XOTMAN
     C                   MOVE      *ZEROS        XOTLAN
      * Finn f¯rste bilnr som har bevegelse (og hent inngÂende saldo)
     C     NESTEB        TAG
     C                   EXSR      FINBIL
     C                   EXSR      SKRIV
     C     *IN75         IFNE      '1'
     C                   GOTO      NESTEB
     C                   END
     C                   END
      **
      * Minst en er skrevet. (RETURPARAMETER)
     C                   MOVE      'X'           MINST1
     C*                    END
      *
     C                   ENDSR
      *
      ********************************************************
     C     FINBIL        BEGSR
      ********************************************************
     C                   MOVE      *ZEROS        TOTANT
     C                   MOVE      *ZEROS        TOTMAN
     C                   MOVE      *ZEROS        TOTLAN
     C* Finn neste bil for aktuell part.. UAVH av fra dato...
     C     NXTBIL        TAG
     C                   MOVE      '9'           XXBILN
     C     PALKBI        SETLL     PALLDL08
     C     PALKEY        READE     PALLDL08                               75
     C     *IN75         DOWEQ     '0'
      * hopp ut straks EN potesiell gyldig post er funnet, IGNORER....
     C     PASTAT        IFNE      'B'                                          I ≈PEN BUNT
     C     PASTAT        ANDNE     'D'                                          SLETTEDE
     C     PAKVDT        IFLE      UUDTT8
     C                   GOTO      UTFINB
     C                   END
     C                   END
     C     PALKEY        READE     PALLDL08                               75
     C                   END
      *
     C     UTFINB        TAG
      *
      * 75 OFF- FUNNET EN BIL SOM HAR POSTER
      *  Sjekk om minst 1 mellom fra/til-dato, Hvis ikke hent neste
     C     *IN75         IFEQ      '0'
     C                   MOVE      PABILN        XXBILN
     C     PLLKBI        SETLL     PALLDL08
     C     NXTBIP        TAG
     C     PALKBI        READE     PALLDL08                               74
     C     *IN74         IFEQ      '1'
     C                   GOTO      NXTBIL
     C                   ELSE
     C     PAKVDT        IFGT      UUDTT8
     C                   GOTO      NXTBIL
     C                   END
      * Ignorer i Âpen bunt/slettede - dvs hent bilens neste post
     C     PASTAT        IFEQ      'B'                                          I ≈PEN BUNT
     C     PASTAT        OREQ      'D'                                          SLETTEDE
     C                   GOTO      NXTBIP
     C                   END
     C                   END
      *
     C     *IN74         IFEQ      '1'
     C                   GOTO      NXTBIL
     C                   END
      * kommet gjennom hit, sÂ betyr det at bilen har gyldige poster
      *
      * 75 ON - INGEN FLERE BILER,,, KLAGJÿR FOR TOTALER..
     C                   ELSE
     C                   MOVE      *BLANKS       XXBILN
     C                   MOVEL     '*TOTAL*'     XXBILN
     C                   END
      *
      *
     C                   ENDSR
      *
      ********************************************************
     C     SKRIV         BEGSR
      ********************************************************
     C* Skriv dokumentet
      *
     C   70              Z-ADD     1             BISIDE
     C                   ADD       1             SIDE
      *
     C                   WRITE     HEAD
     C                   EXSR      INNSAL
      *
     C     XXBILN        IFNE      '*TOTAL*'
      * 70 OFF=STIGENDE DATO , 70 ON=P≈ STIGENDE BILNR (BILOPPFÿLGING)
     C  N70PLLKEY        SETLL     PALLDL04
     C   70PLLKBI        SETLL     PALLDL08
     C     NXTPOS        TAG
     C  N70PALKEY        READE     PALLDL04                               33
     C   70PALKBI        READE     PALLDL08                               33
     C     *IN33         DOWEQ     '0'
     C     PASTAT        IFEQ      'B'
     C     PASTAT        OREQ      'D'
     C                   GOTO      NXTPOS
     C                   END
     C     PAKVDT        IFGT      UUDTT8
     C                   GOTO      UTSKRI
     C                   END
     C                   MOVE      *ZEROS        XXMANT            5 0
     C                   MOVE      *ZEROS        XXLANT            5 0
     C     PAANT         IFGT      0
     C                   Z-ADD     PAANT         XXMANT                           MOTTATT
     C                   ELSE
     C                   Z-SUB     PAANT         XXLANT                           LEVERT
     C                   END
      * KOLONNETALL(ALLTID +)/GRANDTOTAL M/FORTEGN
     C                   ADD       XXMANT        TOTMAN                           MOTATT
     C                   ADD       XXLANT        TOTLAN                           LEVERT
     C                   ADD       PAANT         TOTANT                           TOTALT
     C   70              ADD       XXMANT        XOTMAN                           MOTATT
     C   70              ADD       XXLANT        XOTLAN                           LEVERT
     C   70              ADD       PAANT         XOTANT                           TOTALT
      * SIDESKIFT
     C     PABEIE        COMP      'X'                                    62     (=BILEIER)
     C     *IN90         IFEQ      '1'
     C                   ADD       1             SIDE
     C   70              ADD       1             BISIDE
     C                   WRITE     HEAD
     C                   MOVE      '0'           *IN90
     C                   END
     C                   WRITE     DET
     C  N70PALKEY        READE     PALLDL04                               33
     C   70PALKBI        READE     PALLDL08                               33
     C                   END
      *
     C     UTSKRI        TAG
      *
     C                   ELSE
      * KUN VED PARTER SOM HAR SPESIFIKASJON PR.BIL
      * SKRIVER SIDE FOR *TOTAL*, LEGG PARTENS GRANDTOTALER I TOT....
     C                   MOVE      XOTANT        TOTANT
     C                   MOVE      XOTMAN        TOTMAN
     C                   MOVE      XOTLAN        TOTLAN
     C                   WRITE     TOTTXT
     C                   END
      *
     C     TOTANT        COMP      *ZEROS                               6060
     C  N60              MULT      -1            TOTANT
     C                   WRITE     TOT
      *
      *
     C                   ENDSR
      *
      *
     C***********************************************
     C     FLPART        BEGSR
     C***********************************************
     C* FLERE PARTER - G≈ GJENNOM ALLE EXKLUDER ETTER UVALG I BILDET
     C* 51 ON ALFA SORTERING/OFF PARTSNR SORTERING
     C     W2ALFA        COMP      'X'                                    51
     C  N51*LOVAL        SETLL     PAPA
     C   51*LOVAL        SETLL     PAPAL01
     C*
     C  N51              READ      PAPA                                   94
     C   51              READ      PAPAL01                                94
      *
     C     *IN94         DOWEQ     '0'
     C     NESTE         TAG
     C                   EXSR      TSTEXC
     C     EXCLUD        IFEQ      'J'
     C  N51              READ      PAPA                                   94
     C   51              READ      PAPAL01                                94
     C  N94              GOTO      NESTE
     C   94              GOTO      UTFLER
     C                   END
     C* SKAL V∆RE MED...
     C                   MOVE      PPNR          XXPPNR
     C                   EXSR      ENPART
     C  N51              READ      PAPA                                   94
     C   51              READ      PAPAL01                                94
     C  N94              END
     C*
     C     UTFLER        ENDSR
     C***********************************************
     C     TSTEXC        BEGSR
     C***********************************************
     C                   MOVE      'N'           EXCLUD            1
     C*
     C     W2KUNR        IFNE      *ZEROS
     C     W2KUNR        ANDNE     PPKUNR
     C                   MOVE      'J'           EXCLUD
     C                   GOTO      UTEXCL
     C                   END
     C     W2KATE        IFNE      ' '
     C     W2KATE        ANDNE     PPKATE
     C                   MOVE      'J'           EXCLUD
     C                   GOTO      UTEXCL
     C                   END
     C     W2SPPM        IFEQ      '+'
     C     PPSALP        ANDLE     0
     C                   MOVE      'J'           EXCLUD
     C                   GOTO      UTEXCL
     C                   END
     C     W2SPPM        IFEQ      '-'
     C     PPSALP        ANDGE     0
     C                   MOVE      'J'           EXCLUD
     C                   GOTO      UTEXCL
     C                   END
     C     W2SPPM        IFEQ      '0'
     C     PPSALP        ANDNE     0
     C                   MOVE      'J'           EXCLUD
     C                   GOTO      UTEXCL
     C                   END
     C     W2STPM        IFEQ      '+'
     C     PPSALT        ANDLE     0
     C                   MOVE      'J'           EXCLUD
     C                   GOTO      UTEXCL
     C                   END
     C     W2STPM        IFEQ      '-'
     C     PPSALT        ANDGE     0
     C                   MOVE      'J'           EXCLUD
     C                   GOTO      UTEXCL
     C                   END
     C     W2STPM        IFEQ      '0'
     C     PPSALT        ANDNE     0
     C                   MOVE      'J'           EXCLUD
     C                   GOTO      UTEXCL
     C                   END
     C*
     C     UTEXCL        ENDSR
      *
      ********************************************************
     C     INNSAL        BEGSR
      ********************************************************
     C                   MOVE      *ZEROS        XXMANT                           MOTTATT
     C                   MOVE      *ZEROS        XXLANT                           LEVERT
     C                   MOVE      *ZEROS        XXSALD                           SALDO
     C                   SETOFF                                       33
      *
     C  N70PALKEY        SETLL     PALLDL04
     C   70PALKBI        SETLL     PALLDL08
     C     *IN33         DOWEQ     '0'
     C     NXTINN        TAG
     C  N70PALKEY        READE     PALLDL04                               33
     C   70PALKBI        READE     PALLDL08                               33
     C  N33PAKVDT        COMP      UUDTF8                             33  33
     C  N33              DO
      *
      * STATUS M≈ V∆RE KORREKT
      *
     C     PASTAT        IFEQ      'B'
     C     PASTAT        OREQ      'D'
     C                   GOTO      NXTINN
     C                   END
      *
     C     PAANT         IFGT      0
     C                   ADD       PAANT         XXMANT                           MOTTATT
     C                   ELSE
     C                   ADD       PAANT         XXLANT                           LEVERT
     C                   END
     C                   ADD       PAANT         XXSALD                           INN SALDO
     C                   ADD       PAANT         TOTANT                           TOTALT
     C   70              ADD       PAANT         XOTANT                           TOTALT
      * KOLONNETALL(ALLTID +)/GRANDTOTAL M/FORTEGN
     C                   END
     C                   END
     C                   WRITE     PINNSA
     C                   ENDSR
      ********************************************************
     C     INIT          BEGSR
      ********************************************************
      *
     C     *ENTRY        PLIST
     C                   PARM                    UUPPNR            8 0
     C                   PARM                    UUFDAT            6 0
     C                   PARM                    UUTDAT            6 0
     C                   PARM                    W2KUNR            8 0
     C                   PARM                    W2KATE            1
     C                   PARM                    W2SPPM            1
     C                   PARM                    W2STPM            1
     C                   PARM                    W2ALFA            1
     C                   PARM                    MINST1            1
      *
     C                   MOVE      ' '           MINST1
      * FRADATO 6->8 SIFFER
     C                   MOVE      UUFDAT        FOMDAT            6 0
     C     UUFDAT        IFGT      501231
     C     UUFDAT        ADD       19000000      UUDTF8            8 0
     C                   ELSE
     C     UUFDAT        ADD       20000000      UUDTF8
     C                   END
      * TILDATO 6->8 SIFFER
     C                   MOVE      UUTDAT        TOMDAT            6 0
     C     UUTDAT        IFGT      501231
     C     UUTDAT        ADD       19000000      UUDTT8            8 0
     C                   ELSE
     C     UUTDAT        ADD       20000000      UUDTT8
     C                   END
      *
     C     PALKEY        KLIST
     C                   KFLD                    XXPPNR
     C     PLLKEY        KLIST
     C                   KFLD                    XXPPNR
     C                   KFLD                    UUDTF8
     C     PALKBI        KLIST
     C                   KFLD                    XXPPNR
     C                   KFLD                    XXBILN           10
     C     PLLKBI        KLIST
     C                   KFLD                    XXPPNR
     C                   KFLD                    XXBILN           10
     C                   KFLD                    UUDTF8
     C     KUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    PPKUNR
      *
     C     *LIKE         DEFINE    TOTANT        XOTANT
     C     *LIKE         DEFINE    TOTMAN        XOTMAN
     C     *LIKE         DEFINE    TOTLAN        XOTLAN
      * Dato for purring i ≈≈MMDD format
     C                   MOVE      UDAY          IDAGD
     C                   MOVE      UMONTH        IDAGM
     C     UYEAR         IFGT      50
     C     UYEAR         ADD       1900          IDAG≈
     C                   ELSE
     C     UYEAR         ADD       2000          IDAG≈
     C                   END
      * Hent datoformat/firmakode
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
      *Konverter dato til inhouseformat
     C                   CALL      'DATFM3'
     C                   PARM                    FIDTFM
     C                   PARM                    FOMDAT
     C                   CALL      'DATFM3'
     C                   PARM                    FIDTFM
     C                   PARM                    TOMDAT
      * Hent headingtekst
     C     1             CHAIN     PALFIR                             33
      *
     C                   ENDSR
      *
