/* EPOJN KAN HA VERDI N/J/S HVOR S ER SDV */
             PGM
             DCL        VAR(&SNDNA) TYPE(*CHAR) LEN(8)
             DCL        VAR(&SNDAD) TYPE(*CHAR) LEN(8)
             DCL        VAR(&MBR) TYPE(*CHAR) LEN(10) /* MEMBER +
                          til register SYTL02F */
             DCL        VAR(&FILE) TYPE(*CHAR) LEN(10) +
                          VALUE('SYTL02F')
             DCL        VAR(&MBR) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DAG) TYPE(*CHAR) LEN(3) /* PRINTER */
             DCL        VAR(&DATO) TYPE(*CHAR) LEN(6) /* PRINTER */
             DCL        VAR(&PRT) TYPE(*CHAR) LEN(10) /* PRINTER */
             DCL        VAR(&FAX) TYPE(*CHAR) LEN(15) /* FAXNR   */
             DCL        VAR(&PDF) TYPE(*CHAR) LEN(4) VALUE('*YES')
             DCL        VAR(&EPOST) TYPE(*CHAR) LEN(70) /* MAIL    */
             DCL        VAR(&EPOJN) TYPE(*CHAR) LEN(1) /* MAIL J/N*/
             DCL        VAR(&CVP1) TYPE(*CHAR) LEN(70)
             DCL        VAR(&PRTNA) TYPE(*CHAR) LEN(10) +
                          VALUE('SYTL02PF')
             DCL        VAR(&PRTN2) TYPE(*CHAR) LEN(10) +
                          VALUE('SYTL02P2')
             DCL        VAR(&KODE) TYPE(*CHAR) LEN(1)
             DCL        VAR(&QUSER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QJOB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QNBR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&CVP2) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP3) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP4) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP5) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP6) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP7) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP8) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP9) TYPE(*CHAR) LEN(40)
             DCL        VAR(&KOD) TYPE(*CHAR) LEN(5) /* BEV.KODE*/
             DCL        VAR(&KOD2) TYPE(*CHAR) LEN(1) /* ENHET */
             DCL        VAR(&IN01) TYPE(*LGL) LEN(1) VALUE('0') /* +
                          AVSLUTT*/
             RTVJOBA    JOB(&QJOB) USER(&QUSER) NBR(&QNBR)
/*                         */
/* HENT EGEN INTERNETTADDR */
/*                         */
             CALL       PGM(EPOS04E) PARM(&QUSER &SNDNA &SNDAD &EPOST)
    /* */
    /* UTSKRIFT AV GODSJOURNAL */
    /* */
             CALL       PGM(SYTL04) PARM(&PRT &IN01 &KOD &KOD2 +
                          &DATO &DAG &EPOST &CVP1 &CVP2 &CVP3 &CVP4 +
                          &CVP5 &CVP6 &CVP7 &CVP8 &EPOJN)

             IF         COND(&IN01 = '1') THEN(GOTO CMDLBL(SLUTT)) /* +
                          Hvis &IN01 på, avslutter program. */
    /*           */
    /* IKKE MAIL */
    /*           */
             IF         COND(&EPOJN = 'N') THEN(DO)
             OVRPRTF    FILE(SYTL02PF) PAGESIZE(70 80) CPI(10) +
                          OVRFLW(70) PRTQLTY(*DRAFT) PAGRTT(0) +
                          OUTQ(&PRT) FORMTYPE(*STD) /*NY*/
             OVRPRTF    FILE(SYTL02P2) PAGESIZE(72 132) CPI(20) +
                          OVRFLW(55) PRTQLTY(*DRAFT) OUTQ(&PRT) +
                          FORMTYPE(*STD)
             ENDDO
    /*           */
    /* MAIL PDF  */
    /*           */
             IF         COND(&EPOJN = 'J') THEN(DO)
             OVRPRTF    FILE(SYTL02PF) PAGESIZE(70 80) CPI(10) +
                          OVRFLW(70) PRTQLTY(*DRAFT) OUTQ(OUTMAIL) +
                          FORMTYPE(*STD) HOLD(*YES) /*NY*/
             OVRPRTF    FILE(SYTL02P2) PAGESIZE(70 132) CPI(12) +
                          OVRFLW(66) PRTQLTY(*DRAFT) PAGRTT(90) +
                          OUTQ(OUTMAIL) FORMTYPE(*STD) HOLD(*YES)
             ENDDO
    /* */
    /*           */
    /* MAIL SDV  */
    /*           */
             IF         COND(&EPOJN = 'S') THEN(DO)
             CHGVAR     VAR(&MBR) VALUE('W' *CAT &QNBR)
             RMVM       FILE(SYTL02F) MBR(&MBR)
             MONMSG     MSGID(CPF7310)
NYADD:       ADDPFM     FILE(SYTL02F) MBR(&MBR)
             MONMSG     MSGID(CPF7306) EXEC(GOTO CMDLBL(NYADD))
             OVRDBF     FILE(SYTL02F) TOFILE(SYTL02F) MBR(&MBR)
             ENDDO
    /*           */
    /*  SYTL02   */
    /*           */
             CALL       PGM(SYTL02) PARM(&KOD &KOD2 &DATO &DAG &EPOJN)
    /*           */
    /* MAIL      */
    /* SDV       */
             IF         COND(&EPOJN = 'S') THEN(DO)
             CALL       PGM(SYGE55CLE) PARM(&FILE &MBR &EPOST &CVP1 +
                          &CVP2)
             RMVM       FILE(SYTL02F) MBR(&MBR)
             MONMSG     MSGID(CPF7310)
             RETURN
             ENDDO
    /*           */
    /* MAIL      */
    /* PDF       */
             IF         COND(&EPOJN = 'J') THEN(DO)
    /* GODSJOURNAL */
             RLSSPLF    FILE(&PRTNA) JOB(&QNBR/&QUSER/&QJOB) +
                          SPLNBR(*LAST)
             MONMSG     MSGID(CPF3309 CPF3303 CPF3322) EXEC(GOTO +
                          CMDLBL(NESTE))
             CALL       PGM(FAXEPMMCL) PARM(&QUSER &QNBR &QJOB +
                          &PRTNA &EPOST &CVP1 &CVP2 &CVP3 &CVP4 +
                          &CVP5 &CVP6 &CVP7 &CVP8 &CVP9 &PDF)
             DLTSPLF    FILE(&PRTNA) JOB(&QNBR/&QUSER/&QJOB) +
                          SPLNBR(*LAST)
             MONMSG     MSGID(CPF0000)
    /* MERKNADSJOURNAL */
NESTE:       RLSSPLF    FILE(&PRTN2) JOB(&QNBR/&QUSER/&QJOB) +
                          SPLNBR(*LAST)
             MONMSG     MSGID(CPF3309 CPF3303 CPF3322) EXEC(GOTO +
                          CMDLBL(SLUTT))
             CALL       PGM(FAXEPMMCL) PARM(&QUSER &QNBR &QJOB +
                          &PRTN2 &EPOST &CVP1 &CVP2 &CVP3 &CVP4 +
                          &CVP5 &CVP6 &CVP7 &CVP8 &CVP9 &PDF)
             DLTSPLF    FILE(&PRTN2) JOB(&QNBR/&QUSER/&QJOB) +
                          SPLNBR(*LAST)
             MONMSG     MSGID(CPF0000)
             ENDDO
/*                                       */
 SLUTT:      ENDPGM
