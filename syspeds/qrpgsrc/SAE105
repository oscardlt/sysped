********************************************************************
      * Program for å arbeide med Ufortollede oppdrag dokumentløst
********************************************************************
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 verdi IE i 'Adobe-path gir åpning som URL = I IE / browser
10XXX * 02 JOV PTF10 filter også på godsnr HESG og Mottaker
10XXX * 03 JOV PTF10 ved F8 der søk ER *AL/*UT set curosr i ext dersom det benyttes
10XXX * 04 JOV PTF10 *PUBLIC SKAL HA *RWX-TILGANG TIL IFS-FILE
10XXX * 05 JOV PTF10 F23 - TILDEL/SETT DATO (MEST FOR TEST ..)
10XXX * 06 SH  PTF10 Bytte av farger i subfil ODDEVE ind 80
10XXX * 07 SH  PTF10 vis merkede
10XXX * 08 SH  PTF10 4=SLETT
10XXX * 09 SH  PTF10 NYSIG
10XXX * 10 SH  PTF10 rettelse til 9
10XXX * 11 SH  PTF10 f20 = bytt sortering
********************************************************************
      * inkluder div /copy ... for å kunne bruke funskjoner fra CGIDEV2 serviceprog
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FHEAD44    IF   E           K DISK
N08  FHEADF     UF   E           K DISK
N08  F                                     RENAME(HEADFR:HEADFF)
     FSADH      IF   E           K DISK
     FSADEUF    UF A E           K DISK
     FEDIM4     IF   E           K DISK
     FFRISOK    IF   E           K DISK
     FARKIVL02  IF   E           K DISK
N01  FFIRMARC   IF   E           K DISK
N01  FARKTXT    IF   E           K DISK
N01  FARKEXT    IF   E           K DISK
     FADOBEF    IF   E           K DISK
     FQ         O  A F  200        DISK    Usropn
     FSAe105FM  CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      /copy syspeds/qrpgsrcpy,variables3
      *
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
      *
     D BatDta          s            200
     D FraFil          s            200
     D TilFil          s            200
     D FraMappe        s            200
     D TilMappe        s            200
     D PCMappe         s            200
     D PCTemp          s            200
     D VBZ             s            200
     D VBC             s            200
     D STRVBC          s            200
     D CPY             s            200
N01  D OPNIEBAT        s            512
N01  D Ubane           s            512
     D TilPage         s              1
     D AdobePath       s            200
     D OldFile         s            200
     D PDFfil          s            200
     D Tstcmd          s            200
N01  D W2EXMax         s             15
N02  D W2GNMax         s             15
     D W2MoVar         s             15    VARYING
      *
     D                 DS
     D HEDTOP                  1      8  0
     D  HEÅR2                  3      4  0
     D  HEMND                  5      6  0
     D  HEDAG                  7      8  0
     D                 DS
     D SFDATO                  1      6  0
     D  SFDAT4                 1      4  0
     D   SFDAG                 1      2  0
     D   SFMND                 3      4  0
     D   SFÅR2                 5      6  0
     D                 DS
     D  WSFTXT                 1    650
     D    WSIME1               1     65
     D    WSIME2              66    130
     D    WSIME3             131    195
     D    WSIME4             196    260
     D    WSIME5             261    325
     D    WSIME6             326    390
     D    WSIME7             391    455
     D    WSIME8             456    520
     D    WSIME9             521    585
     D    WSIME10            586    650
     D                 DS
     D  SAITXT                 1    650
     D    SAIME1               1     65
     D    SAIME2              66    130
     D    SAIME3             131    195
     D    SAIME4             196    260
     D    SAIME5             261    325
     D    SAIME6             326    390
     D    SAIME7             391    455
     D    SAIME8             456    520
     D    SAIME9             521    585
     D    SAIME10            586    650
     D                UDS
     D  UFIRM                  1      2
     D  UAVD                  15     18  0
     D  USG                   19     21
      *
N02  D UPC             C                   CONST('ABCDEFGHIJKLMNOPQRST-
N02  D                                     UVWXYZÆØÅ')
N02  D LO              C                   CONST('abcdefghijklmnopqrst-
N02  D                                     uvwxyzæøå')
     C                   EXSR      INIT
      *
      *
     C     Start0        tag
     c                   Move      USG           W2SG
      *
     c                   movea     '00'          *in(71)
     c                   move      '0'           *in(30)
s01  C*                  Z-ADD     6             LINNBR
s01  C*                  Z-ADD     2             POSNBR
     C     START         TAG
n10  c     wssigi        comp      'N'                                    53
N01  C                   Z-ADD     6             LINNBR
N01  C                   Z-ADD     2             POSNBR
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
      * Sett ind, for underutvalg  (*IN50 brukes i DSPF)
     C                   MOVE      '0'           *IN50                          EKSKLUDERT??
      *_____________
      * Fyll Subfile
      *"""""""""""""
N11  C     sort          iflt      0
     C     'J'           SETLL     HEAD44
N11  C                   else
N11  C     'J'           SETGT     HEAD44
N11  C                   END
     C*
N11  C     sort          iflt      0
     C     'J'           READE     HEAD44                                 94
N11  C                   else
N11  C     'J'           READPE    HEAD44                                 94
N11  C                   end
     C     *IN94         DOWEQ     '0'
     c                   EXSR      GETSubf                                       fix/hent annen info
     C                   EXSR      INCLUD
     C     INCL          IFEQ      'J'
     C                   EXSR      TSTSUBF                                       Kan være endret
     C                   ADD       1             ZRECNO
N06  C                   MULT      -1            ODDEVE
N06  C     oddeve        comp      0                                  80
     C                   WRITE     SUBFIL
     C                   END
N11  C     sort          iflt      0
     C     'J'           READE     HEAD44                                 94
N11  C                   else
N11  C     'J'           READPE    HEAD44                                 94
N11  C                   end
     C  N94              END
      *
     C                   MOVE      'J'           FRTOPP            1
      *
     C     START3        TAG
N07  C                   MOVE      WSMERK        GMMERK            1
N07  C                   MOVE      WSTVIN        GMTVIN            1
N07  C                   MOVE      WSSIGI        GMSIGI            1
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   EXFMT     NYWRK
     C* Ingen underutvalg, likevel ingen poster ->FORIGE uansett tast..
     C**   *IN50         IFEQ      '0'
     C**                 MOVE      '1'           *IN03
     C**                 GOTO      SLUTT
     C**                 END
     C                   ELSE
     C     FRTOPP        IFEQ      'J'
     C                   Z-ADD     1             ZRECNO
     C                   MOVE      'N'           FRTOPP            1
     C                   END
s07  C*                  EXFMT     BUNN
s07  C                   WRITE     SUBCTL
n07  C                   WRITE     BUNN
n07  C                   READ      SUBCTL
     C                   END
n07  C     wsmerk        ifne      gmmerk
n07  c                   move      wsmerk        gmmerk
n07  c                   goto      start
n07  c                   end
n07  C     wstvin        ifne      gmtvin
n07  c                   move      wstvin        gmtvin
n07  c                   goto      start
n07  c                   end
n07  C     wssigi        ifne      gmsigi
n07  c                   move      wssigi        gmsigi
n07  c                   goto      start
n07  c                   end
     C*
     C                   SETOFF                                       9899
     C*** AVSLUTT
     C   03              GOTO      SLUTT
     C*
     C*** FRISK OPP
     C   05              GOTO      START
     C*
N11  C*** BYTT SORTERING
N11  C   20              mult      -1            sort
N11  C   20              goto      start
     C*** Underutvalg
     C     *IN08         IFEQ      '1'
     C                   Z-ADD     25            LINNBR
     C                   Z-ADD     11            POSNBR
N03   * ved gjentatt søk på alle eller utildelte / plasser cursor avvikende
N03  c     W2SG          ifeq      '*AL'
N03  c     W2SG          oreq      '*UT'
N03  c     SFEXTR        ifne      *blanks
N03  C                   Z-ADD     32            POSNBR                         ext ref om i bruk..
N03  c                   else
N03  C                   Z-ADD     15            POSNBR                         Avd/oppd
N03  c                   endif
N03  c                   endif
     C                   EXFMT     VAREL2
     C   12              GOTO      START3
N01  c                   eval      W2EXMax =%trim(W2EXTR)+'999999999999999'
N02  c                   eval      W2GNMax =%trim(W2GN)+'999999999999999'
     c     W2SG          ifeq      *blanks
     C                   move      '*AL'         W2SG
     c                   endif
     C                   GOTO      START
     C                   END
     C*** Bytt signatur på alle i subfil
     C     *IN09         IFEQ      '1'
     C                   Z-ADD     25            LINNBR
     C                   Z-ADD     20            POSNBR
     c                   move      USG           W3SG
     C                   EXFMT     VAREL4
     c   12              move      *blanks       W3SG
     C   12              Z-ADD     6             LINNBR
     C   12              Z-ADD     2             POSNBR
     C   12              GOTO      START3
     c                   exsr      Byttsign
     C                   GOTO      START
     C                   END
N05  C*** Kjør tildeling/sett dato
N05  C     *IN23         IFEQ      '1'
N05  c                   exsr      Tildel
N05  C                   GOTO      START
N05  C                   END
      *
     C*** Switch til/fra Plukk-modus
      *
     C     *IN10         IFEQ      '1'
      * 51 OFF = Switch TIL plukkmode
     c     *in51         ifeq      *off
     C                   Z-ADD     25            LINNBR
     C                   Z-ADD     20            POSNBR
     c                   move      USG           W3SG
     C                   EXFMT     VAREL3
     C   12              Z-ADD     6             LINNBR
     C   12              Z-ADD     2             POSNBR
     c   12              move      *blanks       W3SG
     C   12              GOTO      START3
S09  c*                  move      '*UT'         W2SG                           Utildelte,plukke fra
     c                   move      *on           *in51
     c                   else
      *
      * 51 ON  = Switch FRA/ forlat plukkmode
      *
     c     W3SG          ifne      *blanks
s09  c*                  move      W3SG          W2SG                           Vis den som fikk
     c                   endif
     c                   move      *blanks       W3SG
     c                   move      *off          *in51
n09  c                   move      *blanks       wsnr
     c                   endif
     C                   GOTO      START
     C                   END
     C*** Forrige
     C** 12              GOTO      VALGTAG
     C*
     C*
     C     ZRECNO        IFNE      0
     C                   EXSR      HENTSR
     C                   END
      * Enter - også uten utført valg - vis samme bilde/poster
     C                   GOTO      START3
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
N05
N05  C***********************************************
N05  C     TILDEL        BEGSR
N05  C***********************************************
N05  C* kunne  lese subile i stedet for...
N05  C     'J'           SETLL     HEAD44
N05  C     'J'           READE     HEAD44                                 94
N05  C     *IN94         DOWEQ     '0'
N05  c                   EXSR      GETSubf                                       fix/hent annen info
N05  C                   EXSR      INCLUD
N05  C     INCL          IFEQ      'J'
N05  C                   CALL      'SAE105M'
N05  C                   PARM                    HEAVD
N05  C                   PARM                    HEOPD
N05  C                   END
N05  C     'J'           READE     HEAD44                                 94
N05  C  N94              END
N05  c                   endsr
     C***********************************************
     C     Byttsign      BEGSR
     C***********************************************
      * ER DENNE FOR BRUTAL ???
     c     W3SG          cabeq     *blanks       UtBsg
     C* kunne  lese subile i stedet for...
     C     'J'           SETLL     HEAD44
     C     'J'           READE     HEAD44                                 94
     C     *IN94         DOWEQ     '0'
     c                   EXSR      GETSubf                                       fix/hent annen info
     C                   EXSR      INCLUD
     C     INCL          IFEQ      'J'
     C                   EXSR      SRPLUKK                                       Kan være endret
     C                   END
     C     'J'           READE     HEAD44                                 94
     C  N94              END
     c     UtBsg         endsr
     C***********************************************
     C     GetSUBF       BEGSR
     C***********************************************
     C     hedtop        ifeq      0
     c                   z-add     hedtr         hedtop
     c                   end
      * oppdr-dato
     C                   MOVE      HEÅR2         SFÅR2
     C                   MOVE      HEMND         SFMND
     C                   MOVE      HEDAG         SFDAG
      * hent antall dager
     c                   move      'DIF'         ufunk
     c                   move      hedtop        dato2
     C                   CALL      'SYGE20'
     c                   parm                    ufunk             3
     C                   parm                    dato1             8 0
     C                   parm                    dato2             8 0
     C                   parm                    sfdage            5 0
      * ekstern ref
     c                   move      *blanks       SFEXTR
     c     ExtImpKey     chain     FRISOK                             33
     c  N33              movel     FSSOK         SFEXTR
      *
      * ant arkiverte handelsfakt.
     c                   move      *blanks       SFARK
     c                   move      *zeros        antZH             1 0
     c     ArkZHkey      setll     ARKIVL02
     c     ArkZHkey      reade     ARKIVL02                               33
     c     *in33         doweq     '0'
     c                   add       1             antZH
     c     antZH         ifeq      9
     c                   leave
     c                   endif
     c     ArkZHkey      reade     ARKIVL02                               33
     C                   enddo
     c     antZH         ifgt      0
     c                   move      antZH         SFARK
     c                   endif
      * Tildelt tarifør ? / Finnes melding..
     c                   move      *blanks       SAISG
     c                   move      *blanks       SAIME1
     c     HeaKey        chain(N)  SADEUF                             33
     c                   move      SAISG         SFTARF
     c                   Move      ' '           SFMERK
     c     SAIME1        COMP      *BLANKS                            5252
     c   52              Move      'M'           SFMERK
     C
     C                   ENDSR
     C***********************************************
     C     TSTSUBF       BEGSR
     C***********************************************
N06  C     oddeve        comp      0                                  80
S02  c**                 move      *off          *in50
     c                   move      ' '           SFSIST
      * ant vekt fra oppdrag
     c     HENT          ifgt      99999
     c                   z-add     99999         SFANTK
     c                   else
     c                   z-add     HENT          SFANTK
     c                   endif
     c     HEVKT         ifgt      99999
     c                   z-add     99999         SFVKT
     c                   else
     c                   z-add     HEVKT         SFVKT
     c                   endif
     c                   eval      SFMOTT=HENAK
      * Finnes sad ??
     c     HeaKey        chain     SADH                               33
     c     *in33         ifeq      *off
S02  c**                 move      *on           *in50
     c                   move      SIST          SFSIST
     c     SINTK         ifgt      99999
     c                   z-add     99999         SFANTK
     c                   else
     c                   z-add     SINTK         SFANTK
     c                   endif
     c     SIVKB         ifgt      99999
     c                   z-add     99999         SFVKT
     c                   else
     c                   z-add     SIVKB         SFVKT
     c                   endif
     c                   eval      SFMOTT=SINAK
     c                   endif
      *
      * Tildelt tarifør ? / Finnes melding..
     c                   move      *blanks       SAISG
     c                   move      *blanks       SAIME1
     c     HeaKey        chain(N)  SADEUF                             33
     c                   move      SAISG         SFTARF
     c     SAIME1        COMP      *BLANKS                            5252
     C*
     C                   ENDSR
N08  C***********************************************
N08  C     SLETT         BEGSR
N08  C***********************************************
N08  C*
N08  c     HeaKey        chain     SADEUF                             33
N08  C  N33              delete    sadeufr
N08  c     HeaKey        chain     HEADF                              33
     C                   EVAL      HENAK='*DELETED*'
N08  C     HEPK4         IFNE      'P'
N08  C                   MOVE      'N'           HEPK4
N08  C                   END
N08  C  N33              UPDATE    HEADFF
N80  C                   ENDSR
     C***********************************************
     C     INCLUD        BEGSR
     C***********************************************
      **  Bare Gitte ekskusjoner via underutvalg VARSLES  (50 ON)
     C                   MOVE      'N'           INCL              1
      **
     c     HEST          cabeq     'S'           EndInc
     c     HETLL         cabne     *blanks       EndInc
     c     HEGNN         cabne     *blanks       EndInc
      * de som alt er sendt Tvinn skal ikke vises
     c     wstvin        ifeq      'N'
     c     EDIMkey       setll     EDIM4
     c     EDIMkey       reade     EDIM4                                  33
     c     *in33         doweq     '0'
     c     M1N07         cabeq     'DFU'         EndInc                         Normal
     c     M1N07         cabeq     'DMA'         EndInc                         Andre pros(enn 40)
     c     M1N07         cabeq     'DFO'         EndInc                         Foreløpig/Innstikk
     c     EDIMkey       reade     EDIM4                                  33
     c                   enddo
     c                   end
     c     HEOPD         cablt     *zeros        EndInc                         Mønster-oppd/TRmod
      *tarifør
     c     W2SG          ifne      *blanks
     c     W2SG          andne     '*AL'
     c     W2SG          ifeq      '*UT'
     C     SFTARF        CABNE     *blanks       EndInc
     c                   else
     C     W2SG          IFNE      SFTARF
     C     W2SG          IFNE      USG
     C                   MOVE      '1'           *IN50                           EKSKLUDERT
     c                   endif
     c                   goto      EndInc
     c                   endif
     c                   endif
     c                   endif
      *avd
     C     W2AVD         IFNE      *ZEROS
     C     W2AVD         andne     HEAVD
     C                   MOVE      '1'           *IN50                           EKSKLUDERT
     c                   goto      EndInc
     C                   END
      *oppd
     C     W2OPD         IFNE      *ZEROS
     C     W2OPD         andne     HEOPD
     C                   MOVE      '1'           *IN50                           EKSKLUDERT
     c                   goto      EndInc
     C                   END
N02   * signatur fra opprinnelig oppdrag
N02  C     W2HESG        IFNE      *blanks
N02  C     W2HESG        andne     HESG
N02  C                   MOVE      '1'           *IN50                           EKSKLUDERT
N02  c                   goto      EndInc
N02  C                   END
      *Ext-ref
     C     W2EXTR        IFNE      *blanks
     C     SFEXTR        Iflt      W2EXTR
     C     SFEXTR        orgt      W2EXMax
     C                   MOVE      '1'           *IN50                           EKSKLUDERT
     c                   goto      EndInc
     C                   END
     C                   END
N02   *Mottaker navn (inneholder)
N02  C     W2MOTT        IFNE      *blanks
N02   * SFmott settes først i TSTSUBF.. Ved filter på MOTT så må den kalles en enkstra gang
N02  C                   EXSR      TSTSUBF                                       Kan være endret
N02  C     LO:UPC        XLATE     SFmott        SFMottUp         30
N02  C     ' '           CHECKR(E) W2MOTT        NUX               2 0           finn var-lengde
N02  C                   EVAL      %len(W2MOVar)= NUX
     C     NUX           SUBST     W2MOTT:1      W2MoVar
N02  C     W2MOVar       SCAN      SFMottUp                               33
N02  c     *IN33         ifeq      *OFF
N02  C                   MOVE      '1'           *IN50                           EKSKLUDERT
N02  c                   goto      EndInc
N02  C                   END
N02  C                   END
N02   *Godsnr
N02  C     W2GN          IFNE      *blanks
N02  C     HEGN          Iflt      W2GN
N02  C     HEGN          orgt      W2GNMax
N02  C                   MOVE      '1'           *IN50                           EKSKLUDERT
N02  c                   goto      EndInc
N02  C                   END
N02  C                   END
      *ant arkiverte
     C     W2ARK         IFNE      ' '
     C     W2ARK         andne     SFARK
     C                   MOVE      '1'           *IN50                           EKSKLUDERT
     c                   goto      EndInc
     C                   END
      * ta med merkede ?
N07  c     wsmerk        ifeq      'N'
N07  c     sfmerk        andne     ' '
N07  c                   goto      EndInc
N07  c                   end
N07  c     wsmerk        ifeq      'K'
N07  c     sfmerk        andeq     ' '
N07  c                   goto      EndInc
N07  c                   end
      * Kommet gjennom hit uten uthopp = Skal Inkluderes
     C                   MOVE      'J'           INCL
      *
     C     ENDINC        ENDSR
     C*
     C***********************************************
     C     HENTSR        BEGSR
     C***********************************************
     C     WSCLOC        DIV       256           LINNBR            3 0
     C                   MVR                     POSNBR            3 0
     C                   move      LINNBR        GMLNBR            3 0
     C                   move      POSNBR        GMPNBR            3 0
     C                   SETOFF                                       30
     C                   SETOFF                                       919299
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C   98              DO
     C   99              SETOFF                                       98
     C                   GOTO      SLHENT
     C                   END
     C     WSNR          IFEQ      '1'                                          Plukk/tildel->SIGN
     C     *IN51         andeq     '1'                                          kun hvis PLUKKMODE
     C                   EXSR      SRPLUKK
     C                   MOVE      ' '           WSNR
     C                   seton                                        99
     C                   EXSR      TSTSUBF
     C                   UPDATE    SUBFIL
     C                   END
     C     WSNR          IFEQ      '2'                                          SLETTE
     C                   EXSR      WRKSAD
     C                   MOVE      ' '           WSNR
     C                   SETON                                        99
     C                   EXSR      TSTSUBF
     C                   UPDATE    SUBFIL
     C                   END
     C     WSNR          IFEQ      '4'                                          SLETTE
     C                   EXSR      SLETT
     C                   MOVE      ' '           WSNR
     C                   SETON                                        99
     C                   EXSR      TSTSUBF
     C                   UPDATE    SUBFIL
     C                   END
     C     WSNR          IFEQ      'P'
     C                   EXSR      SRPDF
     C                   MOVE      ' '           WSNR
     C                   SETON                                        99
     C                   EXSR      TSTSUBF
     C                   UPDATE    SUBFIL
     C                   END
      * Vis SAD
     C     WSNR          IFEQ      '5'
     C                   CALL      'SAD023A'
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    UFLAGG            1 0
     C                   MOVE      ' '           WSNR
     C                   SETON                                        99
     C                   EXSR      TSTSUBF
     C                   UPDATE    SUBFIL
     C                   END
      * Vedlikehold av oppdrag
     C     WSNR          IFEQ      '6'

     c                   select
     c     HEUR          wheneq    'A'
     C                   MOVE      ' '           WSNR
     C                   CALL      'SYFA10'
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    HESG              3
     C                   PARM      'CHG'         UTYPE             3
     C                   PARM      ' '           UKODE             1
     C                   PARM      ' '           UDUMMY            1
     C                   PARM      0             UAVDNY            4 0
     c     HEUR          wheneq    'C'
     C                   MOVE      ' '           WSNR
     C                   CALL      'SYFI10'
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    HESG              3
     C                   PARM      'CHG'         UTYPE             3
     C                   PARM      ' '           UKODE             1
     C                   PARM      ' '           UDUMMY            1
     C                   PARM      0             UAVDNY            4 0
     c                   endsl
     C                   EXSR      TSTSUBF
     C                   SETON                                        99
     C                   UPDATE    SUBFIL
     C                   END
     C     WSNR          IFEQ      '8'
     C                   MOVE      ' '           WSNR
     c                   clear                   SAIST
     c                   clear                   SAISG
     c                   clear                   SAIUSE
     c                   clear                   SAIUSD
     c                   clear                   SAIUSK
     c     HeaKey        chain(N)  SADEUF                             33
     c     *in33         ifeq      '1'
     c                   move      *blanks       WSFTXT
     c                   else
     c                   move      SAITXT        WSFTXT                         DS med 10 lin a 65
     c                   endif
      *
     C                   Z-ADD     3             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   EXFMT     FRITXT
     c     *in12         cabeq     '1'           SLhent
     c     HeaKey        chain     SADEUF                             33
     c                   move      WSFTXT        SAITXT
     c     *in33         ifeq      '1'
     c                   write     SADEUFR
     c                   else
     c                   Update    SADEUFR
     c                   endif
     C                   EXSR      TSTSUBF
     C                   SETON                                        99
     C                   UPDATE    SUBFIL
     C                   END
      * Vis på web
     C     WSNR          IFEQ      'W'
     C                   MOVE      ' '           WSNR
     C                   exsr      DSPWEB
     C                   END
      * Se T&Tlogg på oppdragsnivå
     C     WSNR          IFEQ      'L'                                          SLETTE
     C                   EXSR      SRTT
     C                   END
     C*
n09  C     NYSIG         IFNE      *blanks
n09  C                   exsr      srplukk
n09  C                   MOVE      ' '           WSNR
n09  c                   move      nysig         SFTARF
n09  c                   move      *blanks       nysig
n09  C                   SETON                                        99
n09  C                   EXSR      TSTSUBF
n09  c                   update    subfil
n09  c                   end
     C                   END
     C*
     C     SLHENT        TAG
     C                   move      GMLNBR        LINNBR
     C                   move      GMPNBR        POSNBR
     C*
     C                   ENDSR
      ***********************************************
     C     SRPDF         BEGSR
      ***********************************************
     C                   CALL      'ARC003'
     C                   PARM      HEAVD         UAVD2             4 0
     C                   PARM      HEOPD         UOPD2             7 0
     C                   PARM                    URUNDE           10
     C                   ENDSR
      ***********************************************
     C     SRPLUKK       BEGSR
      ***********************************************
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     c     HeaKey        chain     SADEUF                             33
     c                   Move      ' '           SAIST
     c                   Move      W3SG          SAISG
N09  c     nysig         ifne      *blanks
n09  c                   move      nysig         SAISG
N09  c                   end
     c                   Move      PSDSUSRNAM    SAIUSE
     c                   Move      WDT           SAIUSD
     c                   Move      WTM           SAIUSK
     c   33              write     SADEUFR
     c  N33              update    SADEUFR
     C                   ENDSR
      ***********************************************
     C     WRKSAD        BEGSR
      ***********************************************
      ***** Ett og bare ett ZH.dokument
     C                   move      *blanks       Oldfile
     C     SFARK         ifeq      '1'
N01  c     AdobePath     ifne      'IE'
N01  c     AdobePath     andne     'LINK'
     c                   exsr      VisPdf
     c                   eval      Oldfile = ARLINK
N01  c                   else
N01  c                   exsr      VisPdfIE
N01  c                   endif
     c                   endif
      ***** Åpne SAD
     C                   MOVE      'CHG'         XTYPE             3
     C                   MOVE      'E'           XKODE             1
     C                   CALL      'SAD052CL'
     C                   PARM      HEAVD         SEAVD             4 0
     C                   PARM      HEOPD         SETDN             7 0
     C                   PARM      USG           SESG              3
     C                   PARM                    XKODE
     C                   PARM                    XTYPE
     C                   CALL      'SAD52P01'
     C                   PARM                    UPRT1            10
     C                   PARM                    UPRT2            10
     C                   PARM                    UPRT3            10
      *
     c     Oldfile       ifne      *blanks
     C                   exsr      ClosePDF
     c                   endif
      *
     C                   ENDSR
      ***********************************************
     C     VISPDF        BEGSR
      ***********************************************
      * 1) Finn fil/kopier til temporær IFS-mappe med nettverks-stasjons-tilgang
      * 2) Bygg VBscriptfil (USER+OPN.VBS) i samme temporære mappe
      * 3) Kopier VBscript-fila til mappe på lokal PC som user har tilgang til(%USERPROFILE%='Home')
      *          (i Wind.7 oppfattes kjøring av VBS fra remote mappe som risiko - kopi=workaroud)
      * 4) Kjør VBscriptet
      *(  5) Filnavn huskes i variabel OldFile - gjøres rett etter denne SR, for å kalle ClosePDF )
      *
     c     ArkZHkey      chain     ARKIVL02                           33
     c     *in33         cabeq     '1'           EndPDF
      *
     c                   Eval      Frafil= %trim(FraMappe)+ARLINK
     c                   Eval      Tilfil= %trim(TilMappe)+ARLINK
     c                   Eval      PDFfil= %trim(PCMappe) +ARLINK
      *
     C                   eval      rc = docmd(' +
     C                             cpy obj("'+%trim(Frafil)+'")'
     C                             +' toobj("'+%trim(Tilfil)+'")'
     c                             +' replace(*YES) +
     c                             ')
      * lage bat-fil med åpningskommando
     C                   eval      rc = docmd(' +
     C                             dltf FILE(QTEMP/Q)  +
     C                             ')
      *
     C                   eval      rc = docmd(' +
     C                             CRTPF FILE(QTEMP/Q) RCDLEN(200) +
     C                             ')
     C                   OPEN      Q
      *
     c                   eval      BatDta='adobePath = CHR(34) & "'
     c                             + %trim(AdobePath) +'" & CHR(34)'
     C                   EXCEPT    QData
     c                   eval      BatDta='newFilePath = CHR(34) & "'
     c                             + %trim(PDFfil) +'" & CHR(34)'
     C                   EXCEPT    QData
     c                   eval      BatDta='page = "' + %trim(TilPage)+'"'
     C                   EXCEPT    QData
      /free
          eval BatDta='set WshShell = WScript.CreateObject("WScript.Shell")';
          EXCEPT QData;
          eval BatDta='WshShell.Run( adobePath & " /A " & CHR(34) &'
                     +'"page=" & page & CHR(34)   & newFilePath)';
          EXCEPT QData;

        //eval BatDta='WScript.Sleep 100';
        //EXCEPT QData;

        //eval BatDta='WshShell.AppActivate("Sesjon B - [24 x 80]")';
        //EXCEPT QData;
      /end-free
      *
     C                   close     Q
      * kopier AS-fil streamfil
     C                   eval      rc = docmd(' +
     C                             CPYTOSTMF  +
     C                             FROMMBR("/QSYS.LIB/QTEMP.LIB/Q.FILE/Q.MBR") +
     C                             TOSTMF("' +
     C                             %trim(TilMappe)+%trim(PSDSUSRNAM)+
     C                             'OPN.VBS") STMFOPT(*REPLACE) +
     C                             CVTDTA(*AUTO) STMFCODPAG(*PCASCII) +
     C                             ENDLINFMT(*CRLF) +
     C                             ')
N04  C                   eval      rc = docmd(' +
N04  c                             CHGAUT OBJ("' +
N04  C                             %trim(TilMappe)+%trim(PSDSUSRNAM)+
N04  C                             'OPN.VBS") USER(*PUBLIC) DTAAUT(*RWX) ' +
N04  C                             'OBJAUT(*ALL)')
      * Hjelpevariabler for å forenkle PCO-kommandoene
     C                   EVAL      VBZ  =%trim(PCMappe)+%trim(PSDSUSRNAM)
     c                             +'OPN.VBS'
     C                   EVAL      VBC  ='"'+%trim(PCTemp)+%trim(PSDSUSRNAM)
     c                             +'.VBS"'
      * kommando for copy av fil til lokal disk/home, samt for å kjøre VBscript
     C                   EVAL      CPY  = '"copy '+%trim(VBZ)+' '+%trim(VBC)+'"'
     c                   eval      STRVBC = '"cscript ' +%trim(VBC)+'"'
      * START PCO/PCCMD
     C                   eval      rc = docmd(' +
     C                             STRPCO  +
     C                             ')
      * Denne burde gå men......
     C*                  eval      rc = docmd('STRPCCMD PCCMD('
     C*                            +%trim(CPY)+') PAUSE(*NO)')
      *
      ******* EKS: CPY   = "copy Z:\JOVOOPN.VBS "%USERPROFILE%\JOVO.VBS""
     C                   CALL      'SAE105CP'
     c                   parm                    CPY
     C
      ******* EKS: STRVBC= "cscript "%USERPROFILE%\JOVO.VBS""
     C                   CALL      'SAE105CP'
     c                   parm                    STRVBC
      *
     C     EndPDF        ENDSR
N01   ***********************************************
N01  C     VISPDFIE      BEGSR
N01   ***********************************************
N01   * hent ip/bane mm..
N01  c     ArkZHkey      chain     ARKIVL02                           33
N01  c  N33UFIRM         chain     firmarc                            33
N01  c     *in33         cabeq     '1'           EndPDFIE
N01  c     artype        chain     ARKTXT                             33
N01  C     ARKLAG        IFNE      *blanks
N01  c     arklagk       chain     arkext
N01  c                   endif
N01  c                   move      *blanks       Ubane
N01  c                   eval      Ubane='http://'+%trim(ARCPAD)+'/'
N01  c                             +%trim(ARCANE)+'/'+%trim(ARLINK)
N01   * bevisst valg via LINK (f.eks har ikke tilgang til sharet nettverksstasjon pga security)
N01  c     AdobePath     ifeq      'LINK'
N01  c                   Movel     UBANE         HFLINK
     C                   EXFMT     VISLINK
N01  c                   goto      EndPDFIE
N01  c                   endif
      * direkte - (trenger ikke bat-fil - åpner via dll direkte)
N01   * START PCO/PCCMD
N01  C                   eval      rc = docmd(' +
N01  C                             STRPCO  +
N01  C                             ')
     c                   eval      OPNIEBAT = 'RunDll32.exe url.dll ,'
     c                             +'FileProtocolHandler "'+%trim(Ubane)+'"'
N01  C                   CALL      'SAE105CP'
N01  c                   parm                    OPNIEBAT
N01  C
N01  C     EndPDFIE      ENDSR
      ***********************************************
     C     ClosePDF      BEGSR
      ***********************************************
      * 1) Bygg VBscriptfil (USER+CL.VBS) i temporær IFS-mappe med nettv-stasj-tilgang
      * 2) Kopier VBscript-fila til mappe på lokal PC som user har tilgang til(%USERPROFILE%='Home')
      *          (i Wind.7 oppfattes kjøring av VBS fra remote mappe som risiko - kopi=workaroud)
      * 3) Kjør VBscriptet
     C                   eval      rc = docmd(' +
     C                             dltf FILE(QTEMP/Q)  +
     C                             ')
      *
     C                   eval      rc = docmd(' +
     C                             CRTPF FILE(QTEMP/Q) RCDLEN(200) +
     C                             ')
     C                   OPEN      Q
      *
     c                   eval      BatDta='oldFileName = "' + %trim(OldFile)+'"'
     C                   EXCEPT    QData
      /free
          eval BatDta='set WshShell = WScript.CreateObject("WScript.Shell")';
          EXCEPT QData;

          eval BatDta='If (WshShell.AppActivate'
                     +'(oldFileName & " - Adobe Reader") = true) Then';
          EXCEPT QData;

          eval BatDta='WScript.Sleep 100';
          EXCEPT QData;

          eval BatDta='WshShell.SendKeys "^w"';
          EXCEPT QData;

          eval BatDta='End If';
          EXCEPT QData;

      /end-free
      *
     C                   close     Q
      * kopier AS-fil streamfil
     C                   eval      rc = docmd(' +
     C                             CPYTOSTMF  +
     C                             FROMMBR("/QSYS.LIB/QTEMP.LIB/Q.FILE/Q.MBR") +
     C                             TOSTMF("' +
     C                             %trim(TilMappe)+%trim(PSDSUSRNAM)+
     C                             'CL.VBS") STMFOPT(*REPLACE) +
     C                             CVTDTA(*AUTO) STMFCODPAG(*PCASCII) +
     C                             ENDLINFMT(*CRLF) AUT(*FILE) +
     C                             ')
N04  C                   eval      rc = docmd(' +
N04  c                             CHGAUT OBJ("' +
N04  C                             %trim(TilMappe)+%trim(PSDSUSRNAM)+
N04  C                             'CL.VBS") USER(*PUBLIC) DTAAUT(*RWX) ' +
N04  C                             'OBJAUT(*ALL)')
      *
      * Hjelpevariabler for å forenkle PCO-kommandoene
     C                   EVAL      VBZ  =%trim(PCMappe)+%trim(PSDSUSRNAM)
     c                             +'CL.VBS'
     C                   EVAL      VBC  ='"'+%trim(PCTemp)+%trim(PSDSUSRNAM)
     c                             +'.VBS"'
      * kommando for copy av fil til lokal disk/home, samt for å kjøre VBscript
     C                   EVAL      CPY  = '"copy '+%trim(VBZ)+' '+%trim(VBC)+'"'
     c                   eval      STRVBC = '"cscript ' +%trim(VBC)+'"'
      * START PCO/PCCMD
     C                   eval      rc = docmd(' +
     C                             STRPCO  +
     C                             ')
      *
      ******* EKS: CPY   = "copy Z:\JOVOCL.VBS "%USERPROFILE%\JOVO.VBS""
     C                   CALL      'SAE105CP'
     c                   parm                    CPY
     C
      ******* EKS: STRVBC= "cscript "%USERPROFILE%\JOVO.VBS""
     C                   CALL      'SAE105CP'
     c                   parm                    STRVBC
      *
     C     EndClPDF      ENDSR
      ***********************************************
     C     DSPWEB        BEGSR
      ***********************************************
     C                   SETON                                        99
     C                   EVAL      Overskr = 'Se SYSPED oppdrag på WEB (eSped) '
     C                   EVAL      WebType = 'ESPEO'
     C                   move      HEAVD         HEAVDA            4
     C                   move      HEOPD         HEOPDA            7
     C                   EVAL      WebSok  = '&heavd='+HEAVDA+
     C                             '&heopd='+HEOPDA
     C                   CALL      'WEBLINKR'
     C                   PARM                    Overskr          40
     C                   PARM                    WebType           5
     C                   PARM                    WebSok           50
      *
     C                   EXSR      TSTSUBF
     C                   UPDATE    SUBFIL
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRTT          BEGSR
      ***********************************************
      * T&T å oppdragsnivå.
     C                   SETON                                        99
     C                   Z-ADD     1             TTFLAG            1 0
     C                   CALL      'SYTT01CL'
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    TTFLAG
     C                   MOVE      ' '           WSNR
     C                   EXSR      TSTSUBF
     C                   UPDATE    SUBFIL
     C                   ENDSR
     C***********************************************
     C     SØKDTA        BEGSR
     C***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
     C                   ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
N11  C                   Z-ADD     1             SORT              1 0
N10  C                   move      'N'           WSSIGI
      *
     c                   move      'J'           wsmerk
     c                   move      'N'           wstvin
      *
     C     HeaKey        Klist
     c                   kfld                    HEAVD
     c                   kfld                    HEOPD
      *
     C     EdiMKey       Klist
     c                   kfld                    MSR
     c                   kfld                    HEAVD
     c                   kfld                    HEOPD
     c                   move      'S'           MSR
      *
     C     ExtImpKey     Klist
     c                   kfld                    HEAVD
     c                   kfld                    HEOPD
     c                   kfld                    FSKODE
     c                   move      '*CE'         FSKODE
      *
     C     ArkZHKey      Klist
     c                   kfld                    ARSTAT
     c                   kfld                    HEAVD
     c                   kfld                    HEOPD
     c                   kfld                    ARTYPE
     c                   move      'A'           ARSTAT
      *
N01  C     arklagk       KLIST
N01  C                   KFLD                    UFIRM
N01  C                   KFLD                    arklag
      * Init Num. DS
     C                   move      *zeros        HEDTOP
     C                   move      *zeros        SFDATO
N06  C                   z-add     1             oddeve            1 0
      * Hent systemverdier som går på åpning av adobe i acrobat mm
     c     '          '  chain     ADOBEF
     c     PSDSUSRNAM    chain     ADOBEF
      * ADUSER        10          COLHDG('BRUKER')
      * ADARKM        70          COLHDG('IFS ARKIVMAPPE')
      * ADIFTM        70          COLHDG('IFS TEMP-MAPPE - med AS-400 navn'
      * ADNETV        70          COLHDG('IFS NETV.S/BANE-
      * ADPCTM        70          COLHDG('PC TEMP-MAPPE')
      * ADPATH       170          COLHDG('ADOBE-PATH(PGM)')
      * ADPAGE         1          COLHDG('PAGE(ÅPNE FRA)')
      *
     c                   eval      ARTYPE=ADARTY                                Arkivkode Hand.Fakt
     C                   eval      FraMappe=ADARKM                              Arkivmappe
     C                   eval      TilMappe=ADIFTM                              TilMappe AS/400-navn
     C                   eval      PCMappe =ADNETV                              TilM,PCnavn (Z:\...)
     C                   eval      PCTemp  =ADPCTM                              PCTempmappe,userHome
     C                   eval      AdobePath=ADPATH                             Path til Acr Reader
     c                   eval      TilPage = ADPAGE                             Åpne fra side...
      *
     C                   ENDSR
     C*
     OQ         EADD         Qdata
     O                       BatDta             200
