      *********************************************************************
      * Spørring på oppdrag (vis oppdrag)
      * PROGRAM BEHANDLER INPUT FRA ESOVERS1
********************************************************************
CRTPG+* CRTPGM SYSPED/ESOVERS2 MODULE(*LIBL/ESOVERS2
CRTPGM*        *LIBL/CHECKUSR *LIBL/INCGI) ACTGRP(CGI) AUT(*USE)
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 VIS TEKST TIL ENDRINGS ÅRSAK
10019 * 02 YBC PTF10 VIS LINK TIL SYSPED-OPPDRAG SOM ER KNYTTET TIL OS-ORDRE
10XXX * 03 YBC URL TIL PDF-DOK. ER ØKT FRA 120 TIL 180
10XXX * 04 YBC BRUKER-ID = NN, VIS OPPDRAG UTEN TEST BRUKER
10172 * 05 SH  PTF10 norsk text til Track and trace
      *%%%%%%%%%%%%%%%%%%%%%%%%
11XXX * 06 jov PTF11 Danske Fragtmænd
11XXX * 07 sh  PTF11 parameter 256 url
11XXX * 08 YBC SJEKK EKSTENSJON .PDF ER MED I LINK
********************************************************************
      *
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
     FBRIDF     UF   E           K DISK    USROPN
     FHEADF     IF   E           K DISK    USROPN
     FBILLOF    IF   E           K DISK    USROPN
     FBLV1      IF   E           K DISK    USROPN
     FTRACKT    IF   E           K DISK    USROPN
     Farkivl02  IF   E           K DISK    usropn
     FFIRMARC   IF   E           K DISK    usropn
     FARKTXT    IF   E           K DISK    usropn
     FARKEXT    IF   E           K DISK    usropn
     FFRISOK    IF   E           K DISK    usropn
     FCDBOAT    IF   E           K DISK    usropn
     FCDTRAFL2  IF   E           K DISK    usropn
     FKODTFR    IF   E           K DISK    usropn
     FKODTOTY   IF   E           K DISK    usropn
     FKOFAST    IF   E           K DISK    usropn
     FKODFRI    IF   E           K DISK    usropn
     FDOKUF7    IF   E           K DISK    usropn
     FTRAN      IF   E           K DISK    usropn
     FBRPARF    if   e           k disk    usropn
     FTRACKL01  IF   E           K DISK    usropn
     FFREETXT2  IF   E           K DISK    usropn
     FFAK8      IF   E           K DISK    usropn
      *--------------------------------------------------------------------
      * Prototype defintions and standard system API error structure
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      *--------------------------------------------------------------------
      * Variables common to CGI programs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
     D OddEven         s             10
      * Variables received from the input string
     D lng             s              2
     D UsrSpcName      s             10
N04  D UsrSpcLib       c                   'SYCGIUSP'
     D WSUSER          S             10
     D DIR             s              1
     D WSAVD           S              4
     D WSOPD           S              7
     D WSSOK           S             80
     D WSSOKURL        S            200
     D UtText          s            150
     D WSCONTNR        S            360
     D PGM             C                   CONST('*LIBL/CHECKUSR')
N04   * Message ID for CrtUsrSpc
N04  D MsgId           s              7
N04   * State related variables
N04  D State           ds                  based(StateP)
N04  D  UBRID                        10
N04  D  UAVD                1001   1080  0 DIM(20)
N04  D  UOPD                1081   1220  0 DIM(20)
      *
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
      *
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
     D                 DS
     D  ParmOS1                1   1024
     D  OSCHG                  1      1
E03  D                 DS
E03  D  updf1                  1    180
E03  D  updf2                181    360
E03  D  updf3                361    540
E03  D  updf4                541    720
E03  D  updf5                721    900
E03  D  updf6                901   1080
E03  D  updf7               1081   1260
E03  D  updf8               1261   1440
E03  D  updf9               1441   1620
E03  D  updf10              1621   1800
E03  D  updf11              1801   1980
E03  D  updf12              1981   2160
E03  D  updf13              2161   2340
E03  D  updf14              2341   2520
E03  D  updf15              2521   2700
E03  D  updf16              2701   2880
E03  D  updf17              2881   3060
E03  D  updf18              3061   3240
E03  D  updf19              3241   3420
E03  D  updf20              3421   3600
E03  D  updf                   1   3600    DIM(20)
      * Faktura-linker
     D                 DS
     D  FakL1                  1    120
     D  FakL2                121    240
     D  FakL3                241    360
     D  FakL4                361    480
     D  FakL5                481    600
     D  FakL6                601    720
     D  FakL7                721    840
     D  FakL8                841    960
     D  FakL9                961   1080
     D  FakL10              1081   1200
     D  FakL11              1201   1320
     D  FakL12              1321   1440
     D  FakL13              1441   1560
     D  FakL14              1561   1680
     D  FakL15              1681   1800
     D  FakL16              1801   1920
     D  FakL17              1921   2040
     D  FakL18              2041   2160
     D  FakL19              2161   2280
     D  FakL20              2281   2400
     D  FakL                   1   2400
     D                                     DIM(20)
      * Arkivtyper 16 elem. a 3 tegn (sb,si,..) Type er venstrestilt
     D                 DS
     D  ATString               1    192
     D  ATString1              1     48
     D  ATString2             49     96
     D  ATString3             97    144
     D  ATString4            145    192
     D  AT                     1    192    DIM(64)
     D                 DS
     D  A2                     1    128    DIM(64)
     D                 DS
     D  DFS                    1     10    DIM(10)
     D  KFSODK                 1     10
     D                 DS
     D  KFTXT                  1     50
     D  KFTXTB                 5     49
     D  VisWEB                50     50
     D                 DS
     D  WDsÅMD                 1      8  0
     D  WDsÅMDÅ                1      4  0
     D  WDsÅMDM                5      6  0
     D  WDsÅMDD                7      8  0
     D                 DS
     D  WDsDMÅ                 1      8  0
     D  WDsDMÅD                1      2  0
     D  WDsDMÅM                3      4  0
     D  WDsDMÅÅ                5      8  0
     D                 DS
     D  HXSNDN                 1     20
     D  HXSNR17                4     20
     D                 DS
     D  HEGN                   1     15
     D  HEGN04                 1      4
     D  HEGN03                 5      7
     D  HEGN08                 8     15
     D  HEGN515                5     15
     D                 DS
     D* HERFA                  1     15
     D  HERFA                  1     35
     D  HERFA03                1      3
     D  HERFA08                4     11
     D                 DS
     D  HEDTMO                 1      8
     D  HEDTMOD                1      2
     D  HEDTMOM                3      4
     D  HEDTMOÅ                5      6
     D  HEDTMO6                1      6
     D  HEDTMO2                7      8
     D                 DS
     D  WSATA                  1      8  0
     D  WSATAÅ                 1      4  0
     D  WSATAM                 5      6  0
     D  WSATAD                 7      8  0
N02  D                 DS
N02  D  FSSOK                  1     35
N02  D  FSSOKAVD               1      4
N02  D  FSSOKOPD               6     12
      *
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================******
      * MAIN PROCESS LINE
      *=====================================================================******
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input
     C                   exsr      Parse
      *
     C                   EXSR      INIT
      *
N04  C                   IF        WSUSER = 'NN'
N04  C     1             DO        20            XN                3 0
N04  C                   IF        ((UAVD(XN) = HEAVD) AND (UOPD(XN) = HEOPD))
N04  C                   GOTO      START
N04  C                   END
N04  C                   ENDDO
N04  C                   GOTO      SLUTT
N04  C                   ELSE
     C                   CALLB     PGM
     C                   PARM                    BIBRID
     C                   PARM                    UsrSpcName
     C                   PARM                    UINN              1
     C                   IF        UINN = 'N'
     C                   GOTO      SLUTT
     C                   END
     C     WSUSER        CHAIN     BRIDF                              50
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           BIDTF
     C                   MOVE      WTM           BITIDF
     C                   UPDATE    BRIDFR
N04  C                   END
N04  C     START         TAG
     c                   movel     Bibesk        KNAVN            30
      * Set output skeleton html member name
     C                   exsr      SetSkl
      * Read skeleton output html, etc.
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
      * Retrieve environment variables
     C                   exsr      RtvEnvVar
      *
      * 1-Section /$top
     C                   exsr      SetTop
      * 2-Prod.koder -pulldown (+bunn)
     C                   exsr      DspPart
      *
     C                   exsr      SetEnd
      *
     C                   callp     wrtsection('top')
      *
     C                   IF        OSCHG = 'J'
     C                   callp     wrtsection('ChgDTStr')
     C                   END
     C                   callp     wrtsection('ChgDTEnd')
      *
     C                   exsr      DspFAKT
      *
     C                   exsr      DspFT
N02   *
N02  C                   exsr      DspSYSOPD
      *
     C                   exsr      DspTT
      *
     C                   callp     wrtsection('BOTT')
      *
     C     SLUTT         TAG
     C                   EXSR      EXIT
     C                   return
      *=====================================================================******
      * Parse input
      *=====================================================================******
     C     Parse         begsr
     C                   eval      lng     = zhbgetvar('lng')
     C                   eval      WSUSER  = zhbgetvar('USER')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
N04  C                   eval      StateP = RtvUsrSpcPtr(UsrSpcName:
N04  C                             UsrSpcLib)
     C                   eval      WSAVD   = zhbgetvar('HEAVD')
     C                   MOVE      *ZEROS        HEAVD
     C                   EVAL      HEAVD = c2n2(WSAVD)
     C                   eval      WSOPD   = zhbgetvar('HEOPD')
     C                   MOVE      *ZEROS        HEOPD
     C                   EVAL      HEOPD = c2n2(WSOPD)
      * DIREKTE KALL fra annet program - ikke vis button for nytt søk
     C                   eval      DIR     = zhbgetvar('DIR')
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$top
      *  (search criteria)
      *=====================================================================******
     C     SetTop        begsr
      * Repeat national language for the next invocation
     C                   callp     updhtmlvar('LNG':lng:
     C                             InitHTMLVars)
     C                   callp     updHTMLvar('ROWHEAD':RowHead)
     C                   callp     updHTMLvar('LogoImg':LogoImg)
      * KUNDE
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updHtmlVar('USER':WSUSER)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHTMLvar('KNAVN':KNAVN)
     C                   callp     updHtmlVar('KUNDE':
     C                             %trim(%editc(BIKUNR:'Z')))
     C                   callp     updHTMLvar('sdato':
     C                             %trim(%editw(BIDTV:'    .  .  ')))
     C                   callp     updHTMLvar('stid':
     C                             %trim(%editw(BITIDV:'  .  .  ')))
      *
     C                   endsr
      *=====================================================================******
      *  Display Product codes to select from
      *=====================================================================******
     C     DspPart       begsr
      *
     C     HEADFK        CHAIN     TRACKT                             33
     C     HEADFK        CHAIN     HEADF                              33
     C  N33              exsr      lesdok
      *
     C                   callp     updHtmlVar('HEAVD':
     C                             %trim(%editc(HEAVD:'Z')))
     C                   callp     updHtmlVar('HEOPD':
     C                             %trim(%editc(HEOPD:'Z')))
     C                   callp     updHtmlVar('HESG':HESG)
     C                   callp     updHtmlVar('HEDTOP':
     C                             %trim(%editw(HEDTOP:'    .  .  ')))
     C                   callp     updHtmlVar('HEPRO':
     C                             %trim(%editc(HEPRO:'Z')))
     C     TXETDD        ifne      *zeros
     C                   callp     updHTMLvar('TXETDD':
     C                             %trim(%editw(TXETDD:'    .  .  ')))
     c                   else
     C                   callp     updHTMLvar('TXETDD':'__________')
     c                   end
     C     TXATDD        ifne      *zeros
     C                   callp     updHTMLvar('TXATDD':
     C                             %trim(%editw(TXATDD:'    .  .  ')))
     c                   else
     C                   callp     updHTMLvar('TXATDD':'__________')
     c                   end
     C     TXETAD        ifne      *zeros
     C                   callp     updHTMLvar('TXETAD':
     C                             %trim(%editw(TXETAD:'    .  .  ')))
     c                   else
     C                   callp     updHTMLvar('TXETAD':'__________')
     c                   end
     C     TXATAD        ifne      *zeros
     C                   callp     updHTMLvar('TXATAD':
     C                             %trim(%editw(TXATAD:'    .  .  ')))
     c                   else
     C                   callp     updHTMLvar('TXATAD':'__________')
     c                   end
      *
     C                   IF        HEUR = 'C'
     C                   MOVE      *BLANKS       KFKOD3
     C                   MOVEL     HERFA03       KFKOD3
     C     KOFASTK3      CHAIN     KOFAST                             33
     C   33KOFASTK5      CHAIN     KOFAST                             33
     C                   MOVE      *BLANKS       XTXT            200
     C                   MOVE      KFTXTE        XTXTA             1
     C                   MOVE      ' '           KFTXTE
     C                   MOVEL     KFTXT         XTXT
     C                   CAT       KFTXTE:0      XTXT
     C     KOFASTK4      CHAIN     KOFAST                             33
     C                   IF        *IN33 = *OFF
     C                   MOVE      KFTXTE        XTXTA             1
     C                   MOVE      ' '           KFTXTE
     C                   CAT       KFTXT:0       XTXT
     C                   CAT       KFTXTE:0      XTXT
     C                   ENDIF
     C                   IF        XTXTA = 'A'
     C                   CAT       HERFA08:0     XTXT
     C                   ENDIF
     C                   callp     updHtmlVar('TRACKING2':XTXT)
      *
     C                   ELSE
      *
     C                   MOVE      *BLANKS       XTXT
     C                   IF        (HEGN515 = '00000000000')
     C                             OR(HEGN515 = '           ')
     C                   MOVE      *BLANKS       HEGN
     C                   END
     C                   IF        HEGN04 = *BLANKS
      *
      * 4 første av godnr ER IKKE fylt ut   - AWB
     C                   MOVE      *BLANKS       KFKOD3
     C                   MOVEL     HEGN03        KFKOD3
      * sjekk flyselskap / other ( med kofasttype 'WEBETRACK' )
     C     KOFASTK3      CHAIN     KOFAST                             33
     C   33KOFASTK5      CHAIN     KOFAST                             33
     C                   MOVE      *BLANKS       XTXT            200
     C                   MOVE      KFTXTE        XTXTA             1
     C                   MOVE      ' '           KFTXTE
     C                   MOVEL     KFTXT         XTXT
     C                   CAT       KFTXTE:0      XTXT
     C     KOFASTK4      CHAIN     KOFAST                             33
     C                   IF        *IN33 = *OFF
     C                   MOVE      KFTXTE        XTXTA             1
     C                   MOVE      ' '           KFTXTE
     C                   CAT       KFTXT:0       XTXT
     C                   CAT       KFTXTE:0      XTXT
     C                   ENDIF
     C                   IF        XTXTA = 'A'
     C                   CAT       HEGN08:0      XTXT
     C                   ENDIF
     C                   ENDIF
      *
     C                   callp     updHtmlVar('TRACKING':XTXT)
     C                   ENDIF
      *
     C                   callp     updHtmlVar('HEGN':HEGN)
     C                   callp     updHtmlVar('HERFA':HERFA)
      *
     C                   callp     updhtmlvar('HENAS':HENAS)
     C                   callp     updhtmlvar('HEADS1':HEADS1)
     C                   callp     updhtmlvar('HEADS2':HEADS2)
     C                   callp     updhtmlvar('HEADS3':HEADS3)
     C                   callp     updhtmlvar('HENAK':HENAK)
     C                   callp     updhtmlvar('HEADK1':HEADK1)
     C                   callp     updhtmlvar('HEADK2':HEADK2)
     C                   callp     updhtmlvar('HEADK3':HEADK3)
     C                   callp     updhtmlvar('HESDFF':HESDFf)
     C                   callp     updhtmlvar('HESDF':HESDF)
     C                   callp     updhtmlvar('HESDT':HESDT)
     C                   callp     updhtmlvar('HESDVT':HESDVT)
     C                   callp     updHtmlVar('HENT':
     C                             %trim(%editc(HENT:'Z')))
     C                   callp     updHtmlVar('HEVKT':
     C                             %trim(%editc(HEVKT:'Z')))
     C                   callp     updHtmlVar('HEFBV':
     C                             %trim(%editc(HEFBV:'Z')))
     C                   callp     updHtmlVar('HEM3':
     C                             %trim(%editc(HEM3:'4')))
     C                   callp     updHtmlVar('HELM':
     C                             %trim(%editc(HELM:'4')))
     C                   callp     updhtmlvar('HEVS1':HEVS1)
     C                   callp     updhtmlvar('HEVS2':HEVS2)
     C                   callp     updhtmlvar('HEGM1':HEGM1)
     C                   callp     updhtmlvar('HEGM2':HEGM2)
     C                   callp     updhtmlvar('HESGM':HESGM)
     c                   move      hedtmo        hedtm2            8 0
     C     HEDTM2        ifne      *zeros
     C                   callp     updHTMLvar('HEDTM2':
     C                             %trim(%editw(HEDTM2:'    .  .  ')))
     c                   else
     C                   callp     updHTMLvar('HEDTM2':'')
     c                   end
     C                   callp     updHTMLvar('HEOT':HEOT)
     C     KODTOTYK      CHAIN     KODTOTY                            33
     C   33              MOVE      *BLANKS       KO1ETX
     C                   callp     updHTMLvar('KO1ETX':KO1ETX)
     C                   callp     updHTMLvar('HEFR':HEFR)
     C     KODTFRK       CHAIN     KODTFR                             33
     C   33              MOVE      *BLANKS       KFRTTX
     C                   callp     updHTMLvar('KFRTTX':KFRTTX)
      *
     C     HEADFK        CHAIN     BILLOF                             33
     C                   MOVE      *BLANKS       WSCONTNR
     C                   IF        *IN33
     C                   MOVE      *BLANKS       BLBLNR
     C                   ELSE
     C     HEADFK        CHAIN     BLV1                               33
     C                   DOW       *IN33 = *OFF
     C                   IF        BVMN <> *BLANKS
     C                   IF        WSCONTNR = *BLANKS
     C                   MOVEL     BVMN          WSCONTNR
     C                   ELSE
     C                   CAT       ',':0         WSCONTNR
     C                   CAT       BVMN:1        WSCONTNR
     C                   END
     C                   END
     C     HEADFK        READE     BLV1                                   33
     C                   ENDDO
     C                   END
     C                   callp     updHTMLvar('WSCONTNR':WSCONTNR)
     C                   callp     updHTMLvar('BLBLNR':BLBLNR)
     C                   callp     updHTMLvar('BLREIS':BLREIS)
     C                   callp     updHTMLvar('BLTR':BLTR)
     C                   callp     updHTMLvar('BLOB':BLOB)
     C                   callp     updHTMLvar('BLLSS':BLLSS)
     C                   callp     updHTMLvar('BLLSH':BLLSH)
     C                   callp     updHTMLvar('BLVH':BLVH)
     C                   callp     updHTMLvar('BLVH2':BLVH2)
     C                   callp     updHTMLvar('BLLOH':BLLOH)
     C                   callp     updHTMLvar('BLLOS':BLLOS)
     C     CDTRAFL2K     CHAIN     CDTRAFL2                           33
     C   33              MOVE      *BLANKS       CTFT
     C                   callp     updHTMLvar('CTFT':CTFT)
     C     BLOB          CHAIN     CDBOAT                             33
     C   33              MOVE      *BLANKS       CBNAB
     C                   callp     updHTMLvar('CBNAB':CBNAB)
      *
     C                   callp     updHTMLvar('UPDF1':UPDF1)
     C                   callp     updHTMLvar('UPDF2':UPDF2)
     C                   callp     updHTMLvar('UPDF3':UPDF3)
     C                   callp     updHTMLvar('UPDF4':UPDF4)
     C                   callp     updHTMLvar('UPDF5':UPDF5)
     C                   callp     updHTMLvar('UPDF6':UPDF6)
     C                   callp     updHTMLvar('UPDF7':UPDF7)
     C                   callp     updHTMLvar('UPDF8':UPDF8)
     C                   callp     updHTMLvar('UPDF9':UPDF9)
     C                   callp     updHTMLvar('UPDF10':UPDF10)
     C                   callp     updHTMLvar('UPDF11':UPDF11)
     C                   callp     updHTMLvar('UPDF12':UPDF12)
     C                   callp     updHTMLvar('UPDF13':UPDF13)
     C                   callp     updHTMLvar('UPDF14':UPDF14)
     C                   callp     updHTMLvar('UPDF15':UPDF15)
     C                   callp     updHTMLvar('UPDF16':UPDF16)
     C                   callp     updHTMLvar('UPDF17':UPDF17)
     C                   callp     updHTMLvar('UPDF18':UPDF18)
     C                   callp     updHTMLvar('UPDF19':UPDF19)
     C                   callp     updHTMLvar('UPDF20':UPDF20)
      *
     C                   endsr
      *=====================================================================******
      *  Display Faktura-linker (uavh av arkiv)
      *=====================================================================******
     C     DspFAKT       begsr
      *
     c                   move      *zeros        FAFAKT
     C                   clear                   FakL
     c                   z-add     1             na
     C     FAKKey        SETLL     Fak8
     C     HEADFK        READE     Fak8                                   33
     C     *in33         DOWeq     *OFF
     C     FAKUNR        cabne     BIKUNR        NextFak
     C     FASK          cabeq     'I'           NextFak
     C     FAKDA         cabeq     'K'           NextFak
     C     FAKDA         cabeq     'D'           NextFak
     C     FAOPKO        cabeq     'D'           NextFak
     C     FAOPKO        cabeq     ' '           NextFak
      * lest faktura for gitt kunde
     C                   Move      HEAVD         AAAVD             4
     C                   Move      HEOPD         AAOPD             7
     C                   Move      FAFAKT        AAFAKT            6
     C                   Eval      FakL(na)='<a href="/sycgip/ESOVERS3.pgm'
     C                                 + '?USER=' + %trim(BIBRID)
     C                                 + '&FAKNR=' + AAFAKT
     C                                 + '&AVD=' +AAAVD
     C                                 + '&OPD=' +AAOPD
     C                                 + '" target="_top">'
     C                                 + AAFAKT + '</A>&nbsp'
     C                   add       1             na
     C     NextFak       tag
     c                   add       1             FAFAKT
     C     FAKKey        SETLL     Fak8
     C     HEADFK        READE     Fak8                                   33
     C  N33              ENDDO
     C                   callp     updHTMLvar('FakL1':FakL1)
     C                   callp     updHTMLvar('FakL2':FakL2)
     C                   callp     updHTMLvar('FakL3':FakL3)
     C                   callp     updHTMLvar('FakL4':FakL4)
     C                   callp     updHTMLvar('FakL5':FakL5)
     C                   callp     updHTMLvar('FakL6':FakL6)
     C                   callp     updHTMLvar('FakL7':FakL7)
     C                   callp     updHTMLvar('FakL8':FakL8)
     C                   callp     updHTMLvar('FakL9':FakL9)
     C                   callp     updHTMLvar('FakL10':FakL10)
     C                   callp     updHTMLvar('FakL11':FakL11)
     C                   callp     updHTMLvar('FakL12':FakL12)
     C                   callp     updHTMLvar('FakL13':FakL13)
     C                   callp     updHTMLvar('FakL14':FakL14)
     C                   callp     updHTMLvar('FakL15':FakL15)
     C                   callp     updHTMLvar('FakL16':FakL16)
     C                   callp     updHTMLvar('FakL17':FakL17)
     C                   callp     updHTMLvar('FakL18':FakL18)
     C                   callp     updHTMLvar('FakL19':FakL19)
     C                   callp     updHTMLvar('FakL20':FakL20)
      *
     C                   endsr
      *
N02   *=====================================================================******
N02   *  Display SYSPED-OPPDRAG SOM ER KNYTTET TIL OVERSJØ-ORDRE
N02   *=====================================================================******
N02  C     DspSYSOPD     begsr
N02   *
N02  C     FRISOKK       SETLL     FRISOK
N02  C     FRISOKK       READE     FRISOK                                 33
N02  C                   DOW       *IN33 = *OFF
N02  C                   Eval      SYSLINK = '<a href="/sycgip/ESOVERS2.pgm'
N02  C                                 + '?USER=' + %trim(BIBRID)
N02  C                                 + '&UsrSpcName=' + UsrSpcName
N02  C                                 + '&HEAVD=' + FSSOKAVD
N02  C                                 + '&HEOPD=' + FSSOKOPD
N02  C                                 + '" target="_blank">'
N02  C                                 + FSSOKAVD + '/' + FSSOKOPD + '</A>&nbsp'
N02  C                   callp     updHTMLvar('SYSLINK':SYSLINK)
N02  C                   callp     wrtsection('LINKROW')
N02  C     FRISOKK       READE     FRISOK                                 33
N02  C  N33              ENDDO
N02   *
N02  C                   callp     wrtsection('LINKSLUTT')
N02   *
N02  C                   endsr
N02   *
      *=====================================================================******
      *  Display INFORMATIONS
      *=====================================================================******
     C     DspFT         begsr
      *
     C     FREETXT2K     SETLL     FREETXT2
     C     FREETXT2K     READE     FREETXT2                               33
     C                   IF        *IN33 = *ON
     C                   MOVE      *BLANKS       FRTTXT
     C                   callp     updHTMLvar('FRTTXT':FRTTXT)
     C                   callp     wrtsection('INFOROW')
     C                   ELSE
     C                   DOW       *IN33 = *OFF
     C                   callp     updHTMLvar('FRTTXT':FRTTXT)
     C                   callp     wrtsection('INFOROW')
     C     FREETXT2K     READE     FREETXT2                               33
     C  N33              ENDDO
     C                   END
      *
     C                   callp     wrtsection('INFOSLUTT')
      *
     C                   endsr
      *
      *=====================================================================******
      *  Display TRACK & TRACE
      *=====================================================================******
     C     DspTT         begsr
      *
      * VIS TRACKBAR SØKEVEI
     c                   move      'Y'           Firstfri          1
     c                   Eval      Snr = *blanks
     C     HEADFK        SETLL     FRISOK
     C     HEADFK        READE     FRISOK                                 33
     C                   DOW       *IN33 = *OFF                                 1<-B
     c     FSKODE        Chain     KODFRI                             33
     C     *IN33         CABEQ     '1'           NextFri1
     C                   IF        FSKODE = 'IFB'                                2<-B
     C                   exsr      TstFbr
     C                   IF        Snr = *Blanks                                 2<-B
     c                   movel     FSSOK         Snr              17
     C                   else                                                    2<-E
     c                   Eval      Snr    = 'FLERE'
     C                   END                                                     2<-E
     C                   END                                                     2<-E
      * Har denne frisok-kode peker til Track&Trace-URL-definisjon?
     C                   EVAL      KFKOD = KFSTTU
     C     KOFASTK1      CHAIN     KOFAST                             33
     C                   IF        *IN33 = *OFF                                  2<-B
      * Verdi som vises i link..
     C                   EVAL      WSSOK = FSSOK
      * URL som skal utføres
     C                   EVAL      WSSOKURL = KFTXT
      * append linje 2 (engelsk tekst når siet tegn er A)
     C                   MOVE      KFTXTE        TstAppend         1
     C     TstAppend     IFEQ      'A'                                            3<-B
     c                   move      ' '           KFTXTE
     C                   CAT       KFTXTE:0      WSSOKURL
     C                   end                                                      3<-E
N06   * Visse transportører har søk på kunderef - Avd/Oppdrag i stedet for sendingsnr
N06  c                   if        KFKOD = 'DKFRA'                              Danske Fraktmænd
N06  c                   move      HEAVD         WSAVD
N06  c                   move      HEOPD         WSOPD
N06  C                   eval      FSSOK = WSAVD+'/'+WSOPD
N06  c                   endif
     C                   CAT       FSSOK:0       WSSOKURL
      * Suffix i søkestrengen..
     C     KOFASTK2      CHAIN     KOFAST                             33
     C                   IF        *IN33 = *OFF                                   3<-B
     C                   CAT       KFTXT:0       WSSOKURL
     C                   END                                                      3<-E
      *
     c     FirstFri      Ifeq      'Y'                                            3<-B
      * Skrive ledertekst.
     C                   callp     wrtsection('TTSTART')
     c     xsprÅk        ifeq      'EN'
     C                   callp     updHTMLvar('WSSOKTXT':'External T&T-links.')
     c                   else
     C                   callp     updHTMLvar('WSSOKTXT':'Eksterne T&T-linker.')
     c                   end
     C                   callp     updHTMLvar('WSSOK':'')
     C                   callp     updHTMLvar('WSSOKURL':'')
     C                   callp     wrtsection('TTROWH')
     c                   move      'N'           Firstfri
     c                   end                                                      3<-E
     C                   callp     updHTMLvar('WSSOKTXT':KFSOTX)
     C                   callp     updHTMLvar('WSSOK':WSSOK)
     C                   callp     updHTMLvar('WSSOKURL':WSSOKURL)
     C                   callp     wrtsection('TTROW')
     C     NextFri1      TAG
     C                   END                                                     2<-E
     C     HEADFK        READE     FRISOK                                 33
     C  N33              ENDDO                                                  1<-E
     c     FirstFri      Ifeq      'N'
     C                   callp     wrtsection('TTSLUTT')
     C                   End
      *
      * VIS IKKE-TRACKBAR SØKEVEI
     C                   move      'Y'           Firstfri          1
     C     HEADFK        SETLL     FRISOK
     C     HEADFK        READE     FRISOK                                 33
     C                   DOW       *IN33 = *OFF                                 1<-B
     c     FSKODE        Chain     KODFRI                             33
     C     *IN33         CABEQ     '1'           NextFri2
     C     'A'           LOOKUP    DFS                                    33
     C     *IN33         CABEQ     '0'           NextFri2
     C                   IF        FSKODE = 'IFB'                                2<-B
     C                   exsr      TstFbr
     C                   END                                                     2<-E
      * Har denne frisok-kode peker til Track&Trace-URL-definisjon?
     C                   EVAL      KFKOD = KFSTTU
     C     KOFASTK1      CHAIN     KOFAST                             33
     C                   IF        *IN33                                         2<-B
     C     FirstFri      Ifeq      'Y'
     C                   callp     wrtsection('TTSTART')
     c     xsprÅk        ifeq      'EN'
     C                   callp     updHTMLvar('KFSOTX':'Other references')
     c                   else
     C                   callp     updHTMLvar('KFSOTX':'Andre referanser')
     c                   end
     C                   callp     updHTMLvar('FSSOK':' ')
     C                   callp     wrtsection('TT2ROWH')
     C                   move      'N'           Firstfri
     C                   END
     C                   callp     updHTMLvar('KFSOTX':KFSOTX)
     C                   callp     updHTMLvar('FSSOK':FSSOK)
     C                   callp     wrtsection('TT2ROW')
     C     NextFri2      TAG
     C                   END                                                     2<-E
     C     HEADFK        READE     FRISOK                                 33
     C  N33              ENDDO                                                  1<-E
     C     FirstFri      Ifeq      'N'
     C                   callp     wrtsection('TTSLUTT')
     C                   End
      *
     C                   exsr      TRACKINFO
      *
     C                   endsr
      *=====================================================================******
      *  TRACKINFO
      *=====================================================================******
     C     TRACKINFO     begsr
     C                   callp     wrtsection('rowhead')
     c     TrackKey      setll     trackl01
     c     TrackKey      reade     trackl01                               50
     c     *in50         doweq     *OFF
     c                   move      ' '           VisWEB
     C                   EVAL      KFKOD = TTACTI
     c     ACTKey        chain     KOFAST
     C     TTFBNR        Ifne      0
     c                   move      ' '           VisWEB
     C                   end
     c     VisWEB        ifeq      'J'
      * snu dato Å.M.dag
     c                   move      TTDATE        WDsÅMD
     c                   move      WDsÅMDÅ       WDsDMÅÅ
     c                   move      WDsÅMDM       WDsDMÅM
     c                   move      WDsÅMDD       WDsDMÅD
     C                   callp     updHTMLvar('DATE':
     C                             %trim(%editw(WDsDMÅ:'  .  .    ')))
     C                   callp     updHTMLvar('TIME':
     C                             %trim(%editw(TTTIME:'  :  :  ')))
     c     TTacti        ifeq      'POD'
n05  c     xsprÅk        ifeq      'EN'
     c                   eval      UTTEXT = KFTXTB + TTTEXT
n05  c                   else
n05  c                   eval      UTTEXT = KFTXTB + TTTEXL
n05  c                   end
     c                   else
n05  c     xsprÅk        ifeq      'EN'
     c                   eval      UTTEXT = TTTEXT
n05  c                   else
n05  c                   eval      UTTEXT = TTTEXL
n05  c                   end
     C                   end
N01   *
N01  c                   IF        ((TTEDRE <> *BLANKS) AND (TTEDRE <> '00'))
N01  C                   MOVEL     'OSREA'       PAID
N01  C                   MOVE      BIBRID        PABRID
N01  C     BRPARFK       CHAIN     BRPARF                             33
N01  c   33              Eval      PABRID = '*KUNDFT*'+BIFIRM
N01  C   33BRPARFK       CHAIN     BRPARF                             33
N01  C                   DOW       *IN33 = *OFF
N01  C                   MOVEL     PAVRDA        XAN03             3
N01  C                   IF        XAN03 = TTEDRE
N01  c                   eval      UTTEXT = %TRIM(UTTEXT) + ' ' + %TRIM(PAVRDA)
N01  C                   LEAVE
N01  C                   END
N01  C     BRPARFK       READE     BRPARF                                 33
N01  C                   ENDDO
N01  c                   END
N01   *
     C                   callp     updHTMLvar('TEXT':UTTEXT)
     C                   callp     wrtsection('row')
      * dersom det er kun ett fraktbrevsnr kan evt.  gif vises
     C     HXSNR17       IFNE      *BLANKS
     C                   EVAL      SNR  = HXSNR17
     C                   END
     c     TTacti        ifeq      'POD'
     c     snr           andne     'FLERE'
     c     snr           andne     *blanks
     C                   exsr      getgif
     C                   end
     c                   end
     c     TrackKey      reade     trackl01                               50
     c                   end
      *
      *
     C                   callp     wrtsection('Rowbot')
     C     DIR           IFNE      'Y'
     C                   callp     wrtsection('Buttons')
     C*                  IF        OSCHG = 'J'
     C*                  callp     wrtsection('ChgDTStr')
     C*                  END
     C*                  callp     wrtsection('ChgDTEnd')
     C                   END
     C                   callp     wrtsection('Rowbot2')
     C                   endsr
      *=====================================================================******
      *  Hent evt grafisk signatur
      *=====================================================================******
     C     GETGIF        begsr
      *
     c                   MOVE      'N'           GIFOK             1
s07  c*                  move      *blanks       ubane            70
n07  c                   move      *blanks       ubane           256
     C                   movel     '/syspeddev/' ubane
     C     ubane         CAT       'signatur/':0 ubane
     C     ubane         CAT       SNR:0         ubane
     C     ubane         CAT       '.gif':0      ubane
     c                   CALL      'BHRURLCL'
     c                   Parm                    ubane
     c                   Parm                    GIFOK
     c     GIFOK         ifeq      'J'
     c                   move      *blanks       uttext
     c                   movel     '<p><img bord'uttext
     C     uttext        CAT       'er="0" sr':0 uttext
     C     uttext        CAT       'c="':0       uttext
     C     uttext        CAT       ubane:0       uttext
     C     uttext        CAT       '"></p>':0    uttext
     C                   callp     updHTMLvar('TEXT':UtText)
     C                   callp     wrtsection('row')
     c                   move      *blanks       uttext
     c                   end
     C                   endsr
     C***********************************************
     C     TSTFBR        BEGSR
     C***********************************************
      * Test om transportør på fraktbrev overstyrer T&T-URL-kode
      *
     C     FSSOK         chain     dokuf7                             33
     c     *IN33         cabeq     '1'           UtTstFbr
     c     DFTRAN        cabeq     0             UtTstFbr
     C     TranKey       chain     Tran                               33
     c     *IN33         cabeq     '1'           UtTstFbr
     c     VMINTP        cabeq     *blanks       UtTstFbr
     C                   EVAL      KFSTTU  = VMINTP
     C                   EVAL      KFSOTX  = 'Fr.brevsnr ' + DFNAT
     C     UtTstFbr      ENDSR
     C*
      *=====================================================================******
      * Set html output skeleton member before its read into memory
      *=====================================================================******
     C     SetSkl        begsr
      *------------------
      * Set html output skeleton member
     C                   eval      lng = uppify(lng)
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC' + lng
N04  C                   IF        WSUSER = 'NN'
N04  C                   eval      Mbr = 'ESOVERS2CC'
N04  C                   ELSE
     C                   eval      Mbr = 'ESOVERS2'
N04  C                   END
     C****               CAT       XSPRÅK:0      MBR
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$endhtml
      *=====================================================================******
     C     SetEnd        begsr
      * Server protocol
     C                   callp     updhtmlvar('PROTOCOL':S_Protocol)
      * Compute run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   endsr
      *=====================================================================******
      *  Retrieve environment variables
      *=====================================================================******
     C     RtvEnvVar     begsr
      * Use getenvp to get this server's protocol and name
     C                   eval      S_Protocol =getenv('SERVER_PROTOCOL':
     C                             qusec)
     C                   eval      S_Name     =getenv('SERVER_NAME':
     C                             qusec)
      *
     C                   endsr
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C     arkivkey      KLIST
     C                   KFLD                    unkode
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    ARTYPE
     C                   MOVE      'A'           unkode            1
     C                   MOVE      'ZO'          ARTYPE
     C     HEADFK        klist
     C                   kfld                    HEAVD
     C                   kfld                    HEOPD
N02  C     FRISOKK       klist
N02  C                   kfld                    HEAVD
N02  C                   kfld                    HEOPD
N02  C                   kfld                    FSKODESYS
N02  C                   MOVE      '*O1'         FSKODESYS         3
     C     FAKKEY        klist
     C                   kfld                    HEAVD
     C                   kfld                    HEOPD
     C                   kfld                    FAFAKT
     C     CDTRAFL2K     klist
     C                   kfld                    BIFIRM
     C                   kfld                    BLTR
     C     KODTFRK       klist
     C                   kfld                    KFRUNI
     C                   kfld                    HEFR
     C                   EVAL      KFRUNI = 'FR'
     C     KODTOTYK      klist
     C                   kfld                    KO1UNI
     C                   kfld                    HEOT
     C                   EVAL      KO1UNI = 'OTY'
     C     KOFASTK1      klist
     C                   kfld                    KFTYP1           10
     C                   kfld                    KFKOD
     C                   EVAL      KFTYP1 = 'TRACKPREFI'
     C     KOFASTK2      klist
     C                   kfld                    KFTYP2           10
     C                   kfld                    KFKOD
     C                   EVAL      KFTYP2 = 'TRACKSUFFI'
     C     KOFASTK3      klist
     C                   kfld                    KFTYP3           10
     C                   kfld                    KFKOD3            5
     C                   MOVEL     'WEBETRACK'   KFTYP3
     C     KOFASTK4      klist
     C                   kfld                    KFTYP3
     C                   kfld                    KFKOD4            5
     C                   MOVEL     '   **'       KFKOD4
     C     KOFASTK5      klist
     C                   kfld                    KFTYP3
     C                   kfld                    KFKOD5            5
     C                   MOVEL     'OTHER'       KFKOD5
     C     TrackKey      KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     ActKey        KLIST
     C                   KFLD                    KFTYPT           10
     C                   KFLD                    KFKOD
     c                   MOVEL     'TRACKT'      KFTYPT
     C     TranKey       klist
     C                   kfld                    BIFIRM
     C                   kfld                    DFTRAN
     C     ARKEXTK       KLIST
     C                   KFLD                    ARFIRM
     C                   KFLD                    ARCEXT
     C     FREETXT2K     KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    FRTKOD
     C                   MOVE      'A'           FRTKOD
      *
     C                   OPEN      BRIDF
     C     WSUSER        CHAIN(N)  BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
      * hent Parametre som går igjen i mange prog:
      *      Odd/Even/Rowhead-farger,Logobilde,Språk,Intern/Ekstern bruker,  mm
     c                   call      'ESGETPAR'
     c                   parm                    BIBRID
     c                   parm                    BIFIRM
     c                   parm                    BIKUNR
     c                   parm                    BIKNG
     c                   parm                    RowHead          10
     c                   parm                    Odd              10
     c                   parm                    Even             10
     c                   parm                    LogoImg          50
     c                   parm                    XSPRÅK            2
     c                   parm                    XINTERN           1
     c                   parm                    ParmDS1        1024
     c                   parm                    ParmDS2        1024
     c                   parm                    ParmDS3        1024
      * HENTER PARAMETER
     C                   CALL      'ESGETOS'
     C                   parm                    BIBRID
     C                   parm                    BIFIRM
     C                   parm                    BIKUNR
     C                   parm                    BIKNG
     C                   parm                    ParmOS1        1024
      *
     C                   OPEN      HEADF
     C                   OPEN      BILLOF
     C                   OPEN      BLV1
     C                   OPEN      TRACKT
     C                   OPEN      arkivl02
     C                   OPEN      firmarc
     C                   OPEN      arktxt
     C                   OPEN      ARKEXT
     C                   OPEN      FRISOK
     C                   OPEN      KODFRI
     C                   OPEN      DOKUF7
     C                   OPEN      TRAN
     C                   OPEN      BRPARF
     C                   OPEN      CDBOAT
     C                   OPEN      CDTRAFL2
     C                   OPEN      KODTFR
     C                   OPEN      KODTOTY
     C                   OPEN      KOFAST
     C                   OPEN      TRACKL01
     C                   OPEN      FREETXT2
     C                   OPEN      FAK8
      *
N01  C     BRPARFK       KLIST
N01  C                   kfld                    PABRID
N01  C                   kfld                    PAKUNR
N01  C                   kfld                    PAID
     C     BrParKey      klist
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
      *
     C                   MOVE      BIBRID        PABRID
     C                   MOVE      *zeros        PAKUNR
N02  C                   MOVE      *BLANKS       SYSLINK         200
     c*                  read      firmarc                                41
     C                   endsr
      *=====================================================================******
      *  AVSLUTT
      *=====================================================================******
     C     EXIT          begsr
     C                   callp     wrtsection('endhtml')
     C                   callp     wrtsection('*fini')
     C                   close     BRIDF
     C                   close     HEADF
     C                   close     BILLOF
     C                   close     BLV1
     C                   close     trackt
     C                   CLOSE     arkivl02
     C                   CLOSE     firmarc
     C                   CLOSE     arktxt
     C                   CLOSE     ARKEXT
     C                   CLOSE     FRISOK
     C                   CLOSE     CDBOAT
     C                   CLOSE     CDTRAFL2
     C                   CLOSE     KODTFR
     C                   CLOSE     KODTOTY
     C                   CLOSE     KODFRI
     C                   CLOSE     KOFAST
     C                   CLOSE     DOKUF7
     C                   CLOSE     TRAN
     C                   close     BRPARF
     C                   CLOSE     TRACKL01
     C                   CLOSE     FREETXT2
     C                   CLOSE     FAK8
     C                   eval      *inlr = *on
      *
     C                   endsr
      *
     C***********************************************
     C     genbane       BEGSR
     C***********************************************
     C                   MOVE      ARKLAG        ARCEXT
     C     ARKEXTK       CHAIN     ARKEXT                             33
     C   33ARFIRM        CHAIN     FIRMARC                            33
     C* genererer bane for lagring
     C                   MOVE      ARAVD         AAVD              4
     C                   MOVE      AROPD         AOPD              7
     c                   movel     '<a href="'   UPDF(na)
     C     UPDF(na)      CAT       '/':0         UPDF(na)
     C     UPDF(na)      CAT       arcane:0      UPDF(na)
     C     UPDF(na)      CAT       '/':0         UPDF(na)
     C     ARLINK        IFNE      *Blanks
     C     UPDF(na)      CAT       ArLink:0      UPDF(na)
     c                   else
     C     UPDF(na)      CAT       aavd:0        UPDF(na)
V10   * TEST LINK
V10  C                   EVAL      UXLINK = '/' + %TRIM(ARCANE)
V10  C                             + '/' + AAVD + AOPD
V10  C                             + %TRIM(ARTYPE)
V10  C                             + %TRIM(ARUNDE)
S08  C*                            + '.pdf'
N08  C     '.pdf'        SCAN      UXLINK                                 33
N08  C                   IF        *IN33 = *OFF
N08  C                   EVAL      UXLINK = %TRIM(UXLINK) + '.pdf'
N08  C                   END
V10  C                   MOVE      'J'           UXOK
V10  C                   CALL      'CHECKLNK'
V10  C                   PARM                    UXLINK           50
V10  C                   PARM                    UXOK              1
V10   *
V10  C                   IF        UXOK = 'N'
V10   * GAMMEL DOKUMENT MED 5 SIFRE OPPDRAGSNR
V10  C                   MOVE      aopd          AOPD5             5
V10  C                   CAT       aopd5:0       UPDF(NA)
V10  C                   ELSE
     C     UPDF(na)      CAT       aopd:0        UPDF(na)
V10  C                   END
     C     UPDF(na)      CAT       artype:0      UPDF(na)
     C     UPDF(na)      CAT       arunde:0      UPDF(na)
     c                   end
     C                   IF        ARKLAG = *Blanks
S03  C*    UPDF(na)      CAT       '.pdf">':0    UPDF(na)
N08  C     '.pdf'        SCAN      UPDF(NA)                               33
N08  C                   IF        *IN33
N08  C                   EVAL      UPDF(na) = %TRIM(UPDF(NA))
N08  C                             + '" target="_blank">'
N08  C                   ELSE
N03  C                   EVAL      UPDF(na) = %TRIM(UPDF(NA))
N03  C                             + '.pdf" target="_blank">'
N08  C                   END
     C                   ELSE
S03  C*                  CAT       '">':0        UPDF(na)
N08  C     '.pdf'        SCAN      UPDF(NA)                               33
N08  C                   IF        *IN33
N08  C                   EVAL      UPDF(na) = %TRIM(UPDF(NA))
N08  C                             + '" target="_blank">'
N08  C                   ELSE
N03  C                   EVAL      UPDF(na) = %TRIM(UPDF(NA))
N03  C                             + '" target="_blank">'
N08  C                   END
     C                   END
      *
     C                   IF        ARRFK = *BLANKS
     C                   CAT       ARTXT:0       UPDF(na)
     C                   ELSE
     C                   CAT       ARRFK:0       UPDF(na)
     C                   END
     C     UPDF(na)      CAT       '<img src="':0UPDF(na)
     C     UPDF(na)      CAT       '/syspeddev':0UPDF(na)
     C     UPDF(na)      CAT       '/PDF.gif"':0 UPDF(na)
     C     UPDF(na)      CAT       'ALT="':1     UPDF(na)
     C     UPDF(na)      CAT       artxt:0       UPDF(na)
     C     UPDF(na)      CAT       '"></a>':0    UPDF(na)
      *
     c                   endsr
      *
     c**************************************************************
     c     lesdok        begsr
     c**************************************************************
     c                   z-add     1             na                3 0
     c                   movea     *blanks       updf
      * Vis kun dokumeter bruker er autorisert for å se...
     C                   move      *blanks       ATString
     C                   MOVE      'ARKTY'       PAID
     C     BrParKey      chain     BRPARF                             33
     C     *IN33         CABEQ     '1'           UtDok
     C                   movel     Pavrda        ATstring1
     C     BrParKey      READE     BRPARF                                 33
     C  N33              movel     Pavrda        ATstring2
     C  N33BrParKey      READE     BRPARF                                 33
     C  N33              movel     Pavrda        ATstring3
     C  N33BrParKey      READE     BRPARF                                 33
     C  N33              movel     Pavrda        ATstring4
     C     1             DO        64            ln                2 0
     c                   movea     AT(ln)        A2(ln)
     c                   end
      *
     c                   setoff                                       94
     C     arkivkey      SETLL     ARKIVL02
     C     *in(94)       doweq     '0'
     C     arkivkey      READE     ARKIVL02                               94
     c  N94na            comp      20                                 94
     C     *in94         ifeq      '0'
     c* visse typer dokument må "eies" av webkunden
     c     artype        ifeq      'go'
     c     artype        oreq      'am'
     c     artype        oreq      'fa'
     c     artype        oreq      'fs'
     c     artype        oreq      'fx'
     c     artype        oreq      'dg'
     c     artype        oreq      'ta'
     c     arkund        cabne     bikunr        NextDoc
     c                   end
     c* Brukeren må være autorisert for å se aktuell type
     C     artype        lookup    A2                                     33
     c     *in33         cabeq     '0'           NextDoc
      * OK
     c     artype        ifeq      'go'
     c     artype        oreq      'am'
     c     artype        oreq      'fx'
     c     artype        oreq      'fs'
     c                   move      *zeros        aravd
     c                   move      *zeros        aropd
     C                   END
     c     artype        chain     arktxt                             95
     c  n95              exsr      genbane
     c  n95              add       1             na
      *
     C     NextDoc       TAG
     C                   END
     C                   END
     C*
     c     UtDOK         endsr
