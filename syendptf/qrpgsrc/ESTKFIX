***** *         NULLSTILLE TUR KOMPLETT MHT PDA-aktivitet          *
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 slett oggså loggposter i TKSGM
10XXX * 02 JOV PTF11 de fleste events/trackT/signaturer mmm..
10XXX * 03 JOV PTF11 også bilder + sign ved TEU (henting terminal)
10XXX * 04 JOV PTF11 cargof også
10XXX * 05 JOV PTF12 Også BILDE fra TKsmart
10XXX * 06 JOV PTF12 Også avvik på DOKUFM nivå (FMLEDI) / fjern skyting fra STS...
********************************************************************
     FTURER14   UF   E           K DISK
     FHEAD14    UF   E           K DISK
     FTRACKT    UF   E           K DISK
     FTRACKL01  UF   E           K DISK
     FDOKUFM    UF   E           K DISK
     FDOKUFN    UF   E           K DISK
N04  FCARGOF    UF   E           K DISK
N04  FCARGOO    UF   E           K DISK
N01  FTKSGM     UF   E           K DISK
N01  FSTSTUR    UF   E           K DISK
N01  FSTSOPD1   UF   E           K DISK
N01  FSTSFBR    UF   E           K DISK
N01  FSTSCLI    UF   E           K DISK
     FFRISOK    IF   E           K DISK
     C     *entry        Plist
     C                   PARM                    UTUR              8
     C                   move      UTUR          HEPRO
      *
     C     HeaKey        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
      *
      *
     C     DOKUFMK       KLIST
     C                   KFLD                    FMRI
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   move      'F'           FMRI
      *
     c     HEPRO         cabeq     0             Slutt
     c     HEPRO         chain     Turer14                            33
     c     *in33         ifeq      '0'
     C                   MOVE      ' '           TUST
     C                   MOVE      ' '           TUTST4
     C                   update    TurerR
     c                   end
     c
     C     HEPRO         setll     head14
     C     HEPRO         reade     head14                                 33
     C     *IN33         DOWEQ     *OFF
     C                   MOVE      *BLANKS       HESGM
     C                   MOVE      *BLANKS       HEDTMO
     C                   MOVE      *ZEROS        HEKLMO
     C                   UPDATE    HEADFR
      * fjern evt post i cargoo
     C     HeaKey        Chain     CARGOO
     C                   if        %found
     C                   DELETE    CARGOOR
     C                   endif
      * fjern Actual-tider
     C     HeaKey        Chain     Trackt                             33
     C     *in33         ifeq      '0'
     C                   move      *zeros        TXATDD
     C                   move      *zeros        TXATDK
     C                   move      *zeros        TXATAD
     C                   move      *zeros        TXATAK
     C                   UPDATE    TRACKTR
     C                   endif
      *
     C     HeaKey        setll     TRACKL01
     C     HeaKey        reade     TRACKL01                               33
     C     *IN33         DOWEQ     *OFF
     C     TTACTI        IFne      'ED1'
     C     TTACTI        andne     'ED2'
     C     TTACTI        andne     'STR'
     C                   DELETE    TRACKFR
     C                   END
     C     HeaKey        reade     TRACKL01                               33
     C                   END
      *
     C     DokufmK       setll     Dokufm
     C     DokufmK       reade     Dokufm                                 33
     C     *IN33         DOWEQ     *OFF
     C                   MOVE      *zeros        FMItDt
     C                   MOVE      *zeros        FMItTm
     C                   MOVE      *blanks       FMItUs
     c                   move      *blanks       FMITER
     C                   MOVE      *zeros        FMUtDt
     C                   MOVE      *zeros        FMUtTm
     C                   MOVE      *blanks       FMUtUs
     c                   move      *blanks       FMUTER
     C                   MOVE      *zeros        FMPODt
     C                   MOVE      *zeros        FMPOTm
     C                   MOVE      *blanks       FMPOUs
     c                   move      *blanks       FMLEVE
N06  c                   move      *blanks       FMLEDI                         avvik inn/ut
     C                   update    DOKUFMR
     c                   exsr      delDokufn
N04  c                   exsr      delCargof
N06   * Fjern alle lenker/Bilder på kollinivå
E06  C                   exsr      DELLNK_C
     C     DokufmK       reade     Dokufm                                 33
     C                   END
      * Fjern alle lenker/Bilder på Oppdragsnivå
E06  C                   exsr      DELLNK_O
N06   * Fjern oppdr. fra skyteworkfil (både inng/utg. samt underliggende)
N06  C                   exsr      DELSTS_O
      *
     C     HEPRO         reade     head14                                 33
     C                   END
      *
N01   * Tk loggfil
N01  C     HEPRO         reade     TKSGM                                  33
N01  C     *in33         doweq     '0'
N01  c                   delete    TKSGMR
N01  C     HEPRO         reade     TKSGM                                  33
N01  C                   END
      *
N06  C                   exsr      DELSTS_T
      *
     C     Slutt         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
      ******************************************************
     C     DelDokufn     begsr
      ******************************************************
      * DOKUFN er kolliskytinger inn/ut FREMMED terminal - fjern disse
     c                   movel     FMMRK1        FNCLID
     c     FNCLID        setll     DOKUFN
     c     FNCLID        reade     DOKUFN                                 33
     c     *in33         doweq     '0'
     c                   delete    dokufnr
     c     FNCLID        reade     DOKUFN                                 33
     c                   end
     c                   endsr
N04   ******************************************************
N04  C     DelCargof     begsr
N04   ******************************************************
N04   * DOKUFN er kolliskytinger inn/ut FREMMED terminal - fjern disse
N04  c                   eval      KOID ='00' + FMMRK1
N04  c     KOID          setll     CARGOF
N04  c     KOID          reade     CARGOF                                 33
N04  c     *in33         doweq     '0'
N04  c                   delete    CARGOFR
N04  c     KOID          reade     CARGOF                                 33
N04  c                   end
N04  c                   endsr
      ******************************************************
E06  C     DelLNK_O      begsr
      ******************************************************
      *
     c                   movel     *blanks       AV_OPD           12
     c                   movel     Heavd         AVDA              4
     c                   movel     Heopd         OPDA              7
     c                   eval      AV_OPD = AVDA+'_'+OPDA
      *
     c     IFBkey        klist
     c                   kfld                    Heavd
     c                   kfld                    Heopd
     c                   kfld                    FSKODE
     c                   movel     'IFB'         FSKODE
     c                   move      *blanks       FBNR17           17
     c     IFBkey        chain     FRISOK                             33
     c  N33              movel     FSSOK         FBNR17
     c                   if        FBNR17 = *Blanks
     c                   if        %subst(HXSNDN:20) <> *blanks
     c                   eval      FBNR17=%subst(HXSNDN:4:17)
     C                   else
     c                   eval      FBNR17=HXSNDN
     c                   endif
     c                   endif
      *
     c                   move      '.gif'        extn              4
     c                   if        FBNR17 = *Blanks
     c                   goto      Avd_OpdTag
     c                   endif
      * på fraktbrev .. Ulike varianter / ulike extentions
     c     FbrTag        tag
     c                   eval      URL='/syspeddev/signatur/'+FBNR17+extn
     c                   call      'ESTKFIXL'
     c                   parm                    URL              70
     c                   parm                    FINS              1
     c                   eval      URL='/syspeddev/signatur/COL_'+FBNR17+extn
     c                   call      'ESTKFIXL'
     c                   parm                    URL              70
     c                   parm                    FINS              1
N03  c                   eval      URL='/syspeddev/signatur/TEU_'+FBNR17+extn
N03  c                   call      'ESTKFIXL'
N03  c                   parm                    URL              70
N03  c                   parm                    FINS              1
     c                   eval      URL='/syspeddev/signatur/TEI_'+FBNR17+extn
     c                   call      'ESTKFIXL'
     c                   parm                    URL              70
     c                   parm                    FINS              1
     c                   eval      URL='/syspeddev/signatur/TE2_'+FBNR17+extn
     c                   call      'ESTKFIXL'
     c                   parm                    URL              70
     c                   parm                    FINS              1
      *
     c                   select
     c     extn          wheneq    '.gif'
     c                   move      '.bmp'        extn              4
     c                   goto      FbrTag
     c     extn          wheneq    '.bmp'
     c                   move      '.jpg'        extn              4
     c                   goto      FbrTag
     c                   other
     c                   move      '.gif'        extn              4
     c                   endsl
      * på avd._opd....
     c     Avd_OpdTag    tag
N05   * sign ved POD
     c                   eval      URL='/syspeddev/signatur/'+AV_OPD+extn
     c                   call      'ESTKFIXL'
     c                   parm                    URL              70
     c                   parm                    FINS              1
N05   * sign ved COL
     c                   eval      URL='/syspeddev/signatur/COL_'+AV_OPD+extn
     c                   call      'ESTKFIXL'
     c                   parm                    URL              70
     c                   parm                    FINS              1
N03  c                   eval      URL='/syspeddev/signatur/TEU_'+AV_OPD+extn
N03  c                   call      'ESTKFIXL'
N03  c                   parm                    URL              70
N03  c                   parm                    FINS              1
     c                   eval      URL='/syspeddev/signatur/TEI_'+AV_OPD+extn
     c                   call      'ESTKFIXL'
     c                   parm                    URL              70
     c                   parm                    FINS              1
     c                   eval      URL='/syspeddev/signatur/TE2_'+AV_OPD+extn
     c                   call      'ESTKFIXL'
     c                   parm                    URL              70
     c                   parm                    FINS              1
N05   * bilde ved COL - funker ikke har en TS som jeg må finne
      *  Bilde_COL_0080_0201638_20210505T202845_2.jpg
N05  c                   eval      URL='/syspeddev/signatur/Bilde_COL_'
N05  c                                +AV_OPD+extn
N05  c                   call      'ESTKFIXL'
N05  c                   parm                    URL              70
N05  c                   parm                    FINS              1
N05   * bilde ved POD - funker ikke har en TS som jeg må finne
      *  Bilde_POD_0080_0201638_20210505T202845_3.jpg
N05  c                   eval      URL='/syspeddev/signatur/Bilde_POD_'
N05  c                                +AV_OPD+extn
N05  c                   call      'ESTKFIXL'
N05  c                   parm                    URL              70
N05  c                   parm                    FINS              1
      *
     c                   select
     c     extn          wheneq    '.gif'
     c                   move      '.bmp'        extn              4
     c                   goto      Avd_OpdTag
     c     extn          wheneq    '.bmp'
     c                   move      '.jpg'        extn              4
     c                   goto      Avd_OpdTag
     c                   other
     c                   move      '.gif'        extn              4
     c                   endsl
      *
N03
N03   * Til sist bilder
N03  c                   move      '.jpg'        extn              4
N03  c                   eval      URL='/syspeddev/signatur/Bilde_POD_'
N03  c                                 +AV_OPD+extn
N03  c                   call      'ESTKFIXL'
N03  c                   parm                    URL              70
N03  c                   parm                    FINS              1
N03  c                   eval      URL='/syspeddev/signatur/Bilde_COL_'
N03  c                                 +AV_OPD+extn
N03  c                   call      'ESTKFIXL'
N03  c                   parm                    URL              70
N03  c                   parm                    FINS              1
N03  c                   eval      URL='/syspeddev/signatur/Bilde_TEU_'
N03  c                                 +AV_OPD+extn
N03  c                   call      'ESTKFIXL'
N03  c                   parm                    URL              70
N03  c                   parm                    FINS              1
N03  c                   eval      URL='/syspeddev/signatur/Bilde_TEI_'
N03  c                                 +AV_OPD+extn
N03  c                   call      'ESTKFIXL'
N03  c                   parm                    URL              70
N03  c                   parm                    FINS              1
N03  c                   eval      URL='/syspeddev/signatur/Bilde_TE2_'
N03  c                                 +AV_OPD+extn
N03  c                   call      'ESTKFIXL'
N03  c                   parm                    URL              70
N03  c                   parm                    FINS              1
      *
     c                   endsr
      *
N06   ******************************************************
N06  C     DelLNK_C      begsr
N06   ******************************************************
N06   * disse kommer vet fra TKtermS - unødig å sjekke så mange varianter
N06   *
N06   * typisk lenke = /syspeddev/clid/TEI_00370701550000181163.jpg
N06   * A Inngående=TEI
N06  c                   eval      URL='/syspeddev/clid/TEI_00'
N06  c                                +%trim(fmmrk1)+'.jpg'
N06  c                   call      'ESTKFIXL'
N06  c                   parm                    URL              70
N06  c                   parm                    FINS              1
N06   * B Utgående=TEU
N06  c                   eval      URL='/syspeddev/clid/TEU_00'
N06  c                                +%trim(fmmrk1)+'.jpg'
N06  c                   call      'ESTKFIXL'
N06  c                   parm                    URL              70
N06  c                   parm                    FINS              1
N06  C                   ENDSR
N06
N06  C***********************************************
N06  C     DELSTS_O      BEGSR
N06  C***********************************************
N06  C     HeaKey        setll     STSOPD1
N06  C     HeaKey        reade     STSOPD1                                33
N06  C     *IN33         DOWEQ     *OFF
N06  c                   delete    STSOPDR
N06   * Slett underordnede uavhengig av om dr er inn eller ut
N06  c                   exsr      DELSTS_FC
N06  C     HeaKey        reade     STSOPD1                                33
N06  c                   enddo
N06   *
N06  c                   endsr
N06
N06  C***********************************************
N06  C     DELSTS_FC     BEGSR
N06  C***********************************************
N06  C     OpdKeySTS     KLIST
N06  C                   KFLD                    SOTYPE
N06  C                   KFLD                    SOPRO
N06  C                   KFLD                    SOAVD
N06  C                   KFLD                    SOOPD
N06   *
N06  C     OpdKeySTS     SETLL     STSCLI
N06  C     OpdKeySTS     READE     STSCLI                                 33
N06  C     *IN33         DOWEQ     '0'
N06  c                   delete    stsclir
N06  C     OpdKeySTS     READE     STSCLI                                 33
N06  C  N33              ENDDO
N06   *
N06  C     OpdKeySTS     SETLL     STSfbr
N06  C     OpdKeySTS     READE     STSfbr                                 33
N06  C     *IN33         DOWEQ     '0'
N06  c                   delete    stsfbrr
N06  C     OpdKeySTS     READE     STSfbr                                 33
N06  C  N33              ENDDO
N06   *
N06  C                   ENDSR
N06
N06  C***********************************************
N06  C     DELSTS_T      BEGSR
N06  C***********************************************
N06   *
N06  C     TurKey        KLIST
N06  C                   KFLD                    YYTYPE            5            Blank = utgående
N06  C                   KFLD                    HEPRO
N06   *
N06  C     TurKey        SETLL     STStur
N06  C     TurKey        READE     STStur                                 33
N06  C     *IN33         DOWEQ     '0'
N06  c                   delete    ststurr
N06  C     TurKey        READE     STStur                                 33
N06  C  N33              ENDDO
N06   *
N06  C                   ENDSR
