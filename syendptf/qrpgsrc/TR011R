********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 HENT BEST.STED FRA KUNDES DIV. PARMETER (TETBS)
10001 * 02 YBC PTF10 KLARGJØR TIL EKSTERN REFERANSE
10XXX * 03 YBC PTF10 RUBR 51 TESTER OM DET ER TRASITTERINGSTOLLSTED
10XXX * 04 YBC PTF10 BRUKER KODE *CN
10XXX * 05 SH  PTF10 INNført TRXREF
10XXX * 06 SH  PTF10 endignger intern ref
10017 * 07 YBC PTF10 SKILLE TET-EKSPORT OG FORHÅNDSVARSLING IMPORT
10XXX * 08 YBC PTF10 TEST BESTEMMELSES LANDKODE VED FORHÅNDSVARSLING
10020 * 09 YBC PTF10 TEST TURNR MOT HEAD14 VED FORHÅNDSVARSLING
10XXX * 10 YBC PTF10 TEST POSTNR, POSTSTED OG DEKL.STED
10XXX * 11 YBC PTF10 HENT ANTALL DAGER PÅ FRIST FRA AVDELING
10XXX * 12 SH  PTF10 frisøk delsystemkode N
10158 * 13 YBC PTF10 HENT LANDKODE TIL TR.MIDDEL FRA TUR-REGISTER
10171 * 14 YBC PTF10 RUNDSKRIV 2012/10167-3/7. HR/TR ER MED PÅ NCTS
10171 * 15 SH  PTF10 flytter henger til bilnummer hvis ikke finnes
10253 * 16 YBC PTF10 NY PAKKETYPE VS, BEHANLES SAMME SOM VR
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
10253 * 17 SH  PTF11 transp.middel landkode fra headf hvis ikke i saeh
11XXX * 18 YBC PTF11 FJERN TEST PÅ NCTS0002
11XXX * 19 SH  PTF11 Søke vareaderesse avsender mottager
11115 * 20 YBC PTF11 THGBL INNEHOLDER NÅ TO DESIMALER
11128 * 21 YBC PTF11 VEKT ER ENDRET FRA 9.0 TIL 11.3, EGET FELT FOR GARANTI
11129 * 22 YBC PTF11 NYE KODER FOR FORHÅNDSVARSEL FRA JUNI 2016
11XXX * 23 YBC PTF11 TILLATE TIN PÅ MOTTAKER VÆRE BLANK.
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
12XXX * 24 YBC PTF12 TEST FØRSTE TO BOKSTAVER OM ER LANDKODE
12XXX * 25 YBC PTF12 Henting av landkode fra kundes vareregister
12XXX * 26 YBC PTF12 Ved normal prosedyre kan ktl.res ikke være A3
      * 27 JOV PTF12 Ved normal Blank  ktl.res (hvis dft = A3) ved ny
12XXX * 28 YBC PTF12 Hent org.nr fra SAEH ved avsendersnr er 0
12XXX * 29 YBC PTF12 Ved rent forhåndsvarsel skal avgang/transitt/bestemmelse
      *              tollsted være like
12248 * 30 YBC PTF12 VEKT, KOLLI ER UTVIDET.
********************************************************************
      *
      ***********************************************************
      *** PROGRAM SKAL ARBEIDE MED EL.TRANSIT HOVED-OPPLYSNING***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01 02 05 06 08 09 11 13 16 18-26
      *** LEDIGE INDIKATORER 40 42
      ***        INDIKATOR   27 PÅ = SPØRRING                 ***
      ***        INDIKATOR   34 BRUKES FOR TVINN              ***
      *** ALLE VARIABLER SOM STARTER MED 'X' ER ARBERDSVAR.   ***
      ***   OG DEFINERES I PROGRAM                            ***
      ***********************************************************
      *
N05  FTRXREF    UF A E           K DISK
     FSYPTFF    IF   E           K DISK
     FFRATXT    IF   E           K DISK
     FTRUH      UF A E           K DISK
     FTRUH10    IF   E           K DISK
     F                                     RENAME(TRUHR:TRUHR10)
     FTRUHFV    IF A E           K DISK    PREFIX(FV_)
     FTRUV      IF A E           K DISK
     FTRUVFV    IF A E           K DISK    PREFIX(FV_)
     FTRUVAM    IF A E           K DISK
     FTRUVCN    IF A E           K DISK
     FTRUVDK    IF A E           K DISK
     FTRUVFS    IF A E           K DISK
     FTRUVMN    IF A E           K DISK
     FTRUVTD    IF A E           K DISK
     FTRUVVT    IF A E           K DISK
     FTRUSTD    UF   E           K DISK
     FTRKODL01  IF   E           K DISK
     FTRUHL     UF A E           K DISK
     FTRUHGB    IF A E           K DISK
     FTRUHFS    IF A E           K DISK
     FTRUHGN    IF A E           K DISK
     FTRUGH     UF   E           K DISK
     FTRUGD     IF   E           K DISK
     FKODTVAL2  IF   E           K DISK
     FTURER14   IF   E           K DISK
     FHEADF     IF   E           K DISK
N09  FHEAD14    IF   E           K DISK    RENAME(HEADFR:HEADFR14)
N09  FKODTA     IF   E           K DISK
N09  FSAMLB     IF   E           K DISK
     FSAEH      IF   E           K DISK
     FFIRM      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FSYPARL1   IF   E           K DISK
N02  FFRISOK    IF A E           K DISK
N02  FFRISOL01  IF   E           K DISK    RENAME(FRISOKR:FRISOKR1)
N02  FZTRUHL01  UF   E           K DISK    RENAME(TRUHR:ZTRUHR)
N02  F                                     PREFIX(Z_)
     FEDIM1     UF   E           K DISK
     FEDIM4     IF   E           K DISK
     F                                     RENAME(EDIMR:EDIMR4)
     F*MULTKOD2  IF   E           K DISK
     FKODTSI    IF   E           K DISK
     FKODTS2    IF   E           K DISK
     FKODTS4    IF   E           K DISK
     FTR011D    CF   E             WORKSTN USROPN
     F                                     INFDS(FBAREA)
n19  D AD              s             30
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  TUBILN                 1     10
     D  TUBIL8                 1      8
     D                 DS
     D  TUHENG                 1     10
     D  TUHEN8                 1      8
     D                 DS
     D  WSDTD                  1      2  0
     D  WSDTM                  3      4  0
     D  WSDTÅ                  5      6  0
     D  WSDT                   1      6  0
     D                 DS
     D  THDTÅ                  1      4  0
     D  THDTM                  5      6  0
     D  THDTD                  7      8  0
     D  THDT                   1      8  0
     D                 DS
     D  WSDDTD                 1      2  0
     D  WSDDTM                 3      4  0
     D  WSDDTÅ                 5      6  0
     D  WSDDT                  1      6  0
     D                 DS
     D  THDDTÅ                 1      4  0
     D  THDDTM                 5      6  0
     D  THDDTD                 7      8  0
     D  THDDT                  1      8  0
     D                 DS
     D  WSTDTD                 1      2  0
     D  WSTDTM                 3      4  0
     D  WSTDTÅ                 5      6  0
     D  WSTRDT                 1      6  0
     D                 DS
     D  THTDTÅ                 1      4  0
     D  THTDTM                 5      6  0
     D  THTDTD                 7      8  0
     D  THTRDT                 1      8  0
     D                 DS
     D  WSDDKD                 1      2  0
     D  WSDDKM                 3      4  0
     D  WSDDKÅ                 5      6  0
     D  WSDDTK                 1      6  0
     D                 DS
     D  THDDKÅ                 1      4  0
     D  THDDKM                 5      6  0
     D  THDDKD                 7      8  0
     D  THDDTK                 1      8  0
     D                 DS
     D  HESG                   1      3
     D  SESG                   1      3
     D                 DS
     D  HEKNK                  1      8  0
     D  SEKNS                  1      8  0
     D                 DS
     D  HENAK                  1     30
     D  SENAS                  1     30
     D                 DS
     D  HEADK1                 1     30
     D  SEADS1                 1     30
     D                 DS
     D  HEADK3                 1     30
     D  SEADS3                 1     30
     D                 DS
     D  HEKNS                  1      8  0
     D  SEKNK                  1      8  0
     D                 DS
     D  HENAS                  1     30
     D  SENAK                  1     30
     D                 DS
     D  HEADS1                 1     30
     D  SEADK1                 1     30
     D                 DS
     D  HEADS3                 1     30
     D  SEADK3                 1     30
     D                 DS
S30  D* HEVKT                  1      9  0
S30  D* SEVKB                  1      9  0
N30  D  HEVKT                  3     11  0
N30  D  SEVKB                  1     11  0
     D                 DS
S30  D* HENT                   1      7  0
S30  D* SENTK                  1      7  0
N30  D  HENT                   4     10  0
N30  D  SENTK                  1     10  0
      *
     D                 DS
     D  SYRG                   1     14
     D  SYFOR9                 1      9
     D  SYFORE                 1     11
     D                 DS
     D  THAVD                  1      4  0
     D  THTDN                  5     11  0
     D  BLUR                  12     12
     D  UWS2                  13     22
     D  WSTVIN                23     23
     D  UIN27                 24     24
     D  UIN34                 25     25
     D  UIN36                 26     26
S21  D* THVKB                 27     35  0
N21  D  THVKB                 27     37  3
E21  D  U1N07                 38     40
E21  D  THDK                  41     45
E21  D  THKDC                 46     46
E21  D  THALK                 47     48
E21  D  THBLK                 49     50
E21  D  WSPRO                 51     58  0
E21  D  WSLSTL                59     62  0
E21  D  U2REFF                63     79
E21  D  U2UNIK                80     88  0
     D  UPARM2                 1    128
      *
     C                   OPEN      TR011D
     C                   EXSR      INIT
     C     UTYPE         CABEQ     'DSP'         START1
      *...............................................
      * BILDE-1 INNLESING AV OPDNR./TARIFFØR OSV.
      *'''''''''''''''''''''''''''''''''''''''''''''''
     C     START         TAG
     C  N30
     CANN31              Z-ADD     10            LINNBR
     C  N30
     CAN 31              Z-ADD     9             LINNBR
     C  N30UTYPE         IFEQ      'CPY'
     C                   Z-ADD     13            LINNBR
     C                   END
     C  N30              Z-ADD     34            POSNBR
     C  N30WSSG          IFEQ      *BLANKS
     C                   Z-ADD     9             LINNBR
     C                   END
     C                   EXFMT     TR011D01
     C                   MOVEA     '00'          *IN(98)
     C                   SETOFF                                       3095
      *
      *  07 = SØKE OPPDRAG
     C   07              DO
     C                   MOVE      'S'           UTYPES            1
     C                   CALL      'SYFM21'
     C                   PARM                    UTYPES
     C                   PARM                    UAVD
     C                   PARM                    WSTDN
     C                   PARM                    WSSG
     C                   GOTO      START
     C                   END
     C   12              GOTO      SLUTT
      *
     C     START1        TAG
     C                   EXSR      TESTB1
     C   30              GOTO      START
     C   04UFLAGG        CABEQ     1             START
      *
     C     UTYPE         IFEQ      'CPY'
     C                   MOVE      *ZEROS        WSTDN
     C                   MOVE      *ZEROS        THTDN
     C                   MOVE      *BLANKS       WSTRNR
     C                   MOVE      *BLANKS       WSTRDT
     C                   MOVE      *ZEROS        WSDDT
     C                   END
      *===============================================
      *
      *...............................................
      * BILDE-2 INNLESING AV HOVED OPPLYSNINGER AV SAD
      *'''''''''''''''''''''''''''''''''''''''''''''''
     C     START2        TAG
     C  N30              Z-ADD     2             LINNBR
     C  N30              Z-ADD     10            POSNBR
     C     ST21          TAG
      *
     C                   EXSR      TSTOPL
      *
     C                   EXFMT     TR011D02
     C                   MOVEA     '00000000'    *IN(92)
     C                   MOVEA     '00000000'    *IN(84)
     C                   MOVEA     '00000000'    *IN(76)
     C                   MOVEA     '00000000'    *IN(68)
     C                   MOVEA     '00000000'    *IN(60)
     C                   MOVEA     '000000000000'*IN(48)
S10  C*                  MOVE      '0'           *IN(47)
N10  C                   MOVEA     '000'         *IN(45)
S14  C*                  MOVE      '0'           *IN(43)
N14  C                   MOVEA     '00'          *IN(42)
     C                   SETOFF                                       30
      *
      *  04 = SØK AVSENDER/MOTTAKER/HOVEDANSVARLIG
     C   04              DO
     C                   EXSR      SØKDT2
     C                   GOTO      ST21
     C                   END
      *
      *  07 = SØKE OPPDRAG
     C   07              DO
     C                   MOVE      'S'           UTYPES            1
     C                   CALL      'SYFM21'
     C                   PARM                    UTYPES
     C                   PARM                    UAVD
     C                   PARM                    WSTDN
     C                   PARM                    WSSG
     C                   GOTO      START2
     C                   END
      *
      *  10 = SE OPPLYSNIGER OM GODKJENNELSE FRA TOLLVESENET (KUN KOMMUNIKASJON)
     C   10              DO
     C                   EXSR      VISTOL
     C                   GOTO      START2
     C                   END
      *
      *  12 = AVBRYT, FRIGJØR E-MERKING OG GÅ TIL TR011D01
     C   12              DO
     C     UTYPE         IFNE      'DSP'
     C     TRHK          CHAIN     TRUH                               33
     C                   MOVE      ' '           THST
     C  N33              UPDATE    TRUHR
     C                   END
     C     UTYPE         IFEQ      'CR2'
     C                   MOVE      *ZEROS        WSTDN
     C                   GOTO      START
     C                   ELSE
     C                   GOTO      SLUTT
     C                   END
     C                   END
     C   14              DO
     C                   EXSR      VISOPL
     C                   GOTO      START2
     C                   END
      *
     C   15UTYPE         IFEQ      'DSP'
     C                   EXSR      TILKOD
     C                   GOTO      START2
     C                   END
      *
     C     UTYPE         IFEQ      'DSP'
     C                   GOTO      START3
     C                   END
      *
      * ----------- T E S T   B I L D E 0 2 ----------
     C                   EXSR      TESTB2
     C   30              GOTO      START2
      * TEST OM GARANTITYPE PASSER PROSEDYRE
S22  C*                  IF        WSDK = 'SS'
N22  C                   IF        WSDK='SS' OR WSDK='ENTRY' OR WSDK='EXIT'
     C                   EVAL      WSGKD = 7
     C                   ELSE
     C                   IF        ((WSENKL = 'J') AND (WSGKD > 1))
     C                   MOVE      'J'           WSJN
     C                   EXFMT     TR011D04
     C     WSJN          CABEQ     'N'           START2
     C                   MOVE      'N'           WSENKL
     C                   END
     C                   END
      *
      * ----- INGEN FEIL HITTIL     OPPDATER TRUH -----
     C                   EXSR      OPDTRH
     C   15              GOTO      START2
      *
      *===============================================
      *
     C     START3        TAG
      *
      * VEDLIKEHOLD INFORMASJONER OM FORHÅNDSVARSLING
     C     TRHK          CHAIN     TRUHFV                             33
S14  C*                  IF        PTFDT <= XIDAG
S22  C*                  IF        (((WSDK = 'SS') OR
S22  C*                              (*IN33 = *OFF)) OR *IN06)
N22  C                   IF        WSDK='SS' OR WSDK='ENTRY' OR WSDK='EXIT' OR
N22  C                             *IN33 = *OFF OR *IN06
     C                   CALL      'TR011RA'
     C                   PARM                    UAVD
     C                   PARM                    WSTDN
     C                   PARM                    WSSG
     C                   PARM                    WSDK
     C                   PARM                    UTYPE
     C                   PARM                    UFLAGG
     C     UFLAGG        CABEQ     1             START2
     C                   END
S14  C*                  END
      *
     C                   EXSR      TOTRV
     C   12              GOTO      START2
     C     UTYPE         IFEQ      'CR2'
     C     *IN17         OREQ      '1'
     C                   MOVE      *ZEROS        WSTDN
     C  N03              DO
     C                   MOVE      *ZEROS        THTDN
     C                   MOVE      *ZEROS        WSNTK
     C                   MOVE      *ZEROS        WSVKB
     C                   MOVE      *BLANKS       WSTRNR
     C                   MOVE      *BLANKS       WSTRDT
     C                   GOTO      START2
     C                   END
     C                   GOTO      START
     C                   END
      *
     C     SLUTT         TAG
     C     *IN12         IFEQ      '1'
     C                   Z-ADD     1             UFLAGG
     C                   ELSE
     C                   Z-ADD     0             UFLAGG
     C                   END
     C                   CLOSE     TR011D
     C                   EVAL      *INLR = *ON
     C                   RETURN
      *
     C***********************************************
     C     TILKOD        BEGSR
     C***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
     C     LINNBR        IFEQ      19
     C     POSNBR        ANDGE     76
     C     POSNBR        ANDLE     77
     C                   CALL      'TR017R'
     C                   PARM                    UAVD
     C                   PARM                    WSTDN
     C                   PARM                    WSGBGU
     C                   PARM                    UTYPE
     C     TRHK          CHAIN     TRUH                               33
     C                   MOVE      WSGBGU        THGBGU
     C                   UPDATE    TRUHR
     C                   END
      *
     C     LINNBR        IFEQ      19
     C     POSNBR        ANDGE     8
     C     POSNBR        ANDLE     31
     C     *IN35         IFEQ      '1'
     C     WSGKD         OREQ      2
     C     WSGKD         OREQ      4
     C                   CALL      'TR025R'
     C                   PARM                    UAVD
     C                   PARM                    WSTDN
     C                   PARM                    WSGFT1
     C                   PARM                    WSGADK
     C                   PARM                    WSGBGI
     C                   PARM                    WSGBGU
     C                   PARM                    WSGBL
     C                   PARM                    WSGVK
     C                   PARM                    UTYPE
     C     TRHK          CHAIN     TRUH                               33
     C                   MOVE      WSGFT1        THGFT1
     C                   MOVE      WSGADK        THGADK
     C                   MOVE      WSGBGI        THGBGI
     C                   MOVE      WSGBGU        THGBGU
     C                   UPDATE    TRUHR
     C                   END
     C                   END
      *
     C     LINNBR        IFEQ      21
     C     POSNBR        ANDGE     57
     C     POSNBR        ANDLE     79
     C                   CALL      'TR016R'
     C                   PARM                    UAVD
     C                   PARM                    WSTDN
     C                   PARM                    WSDFKD
     C                   PARM                    WSDFSK
     C                   PARM                    UTYPE
     C     TRHK          CHAIN     TRUH                               33
     C                   MOVE      WSDFKD        THDFKD
     C                   MOVE      WSDFSK        THDFSK
     C                   UPDATE    TRUHR
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     SØKDT2        BEGSR
     C***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
      * DEKLARASJONSTYPE
     C     LINNBR        IFEQ      2
     C     POSNBR        ANDGE     10
     C     POSNBR        ANDLE     14
     C                   MOVE      '031'         UUNIK             3
     C                   MOVE      *BLANKS       UKODE            10
     C                   MOVEL     WSDK          UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSDK
     C                   Z-ADD     3             LINNBR
     C                   Z-ADD     13            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * AVSENDERSNR
     C     LINNBR        IFEQ      3
     C     POSNBR        ANDGE     13
     C     POSNBR        ANDLE     20
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    WSKNS
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN
     C                   Z-ADD     50            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *søk vareadresse avsender
N19  C     LINNBR        IFEQ      4
N19  C                   CALL      'SOEKVADR'
N19  C                   PARM                    FIFIRM
N19  C                   PARM                    WSKNS
N19  C                   PARM                    WSNAS
N19  C                   PARM                    WSADS1
N19  C                   PARM                    WSADS2           30
N19  C                   PARM                    WSADS3           30
S25  C*                  PARM                    WSLAND            2
N25  C                   PARM                    WSLKS
N19  C                   PARM                    UADRNR            5
n19  C     wsnas         IFNE      *blanks
n19  c                   move      wsads3        ad
n19  c     ' '           scan      ad            f                 2 0
n19  c     f             ifgt      9
n19  c                   eval      wspss=wsads3
n19  c                   else
n19  c                   eval      wspns = %SUBST(ad:1:f-1)
n19  c                   eval      wspss = %SUBST(ad:f+1:30-f-1)
n19  c                   move      '.'           wspss
N19  C                   Z-ADD     9             LINNBR
N19  C                   Z-ADD     49            POSNBR
N19  C                   END
N19  C                   END
n19  C                   GOTO      SLSØK
N19  C                   END
      * AVSENDERSLANDKODE
     C     LINNBR        IFEQ      5
     C     POSNBR        ANDGE     56
     C     POSNBR        ANDLE     57
     C                   CALL      'SYFI10L'
     C                   PARM                    WSALK
     C                   PARM                    USPED
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     56            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * BESTEMMELESLANDKODE
     C     LINNBR        IFEQ      6
     C     POSNBR        ANDGE     56
     C     POSNBR        ANDLE     57
     C                   CALL      'SYFI10L'
     C                   PARM                    WSBLK
     C                   PARM                    USPED
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * LANDKODE TIL AVSENDER
     C     LINNBR        IFEQ      7
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     13
     C                   CALL      'SYFI10L'
     C                   PARM                    WSLKS
     C                   PARM                    USPED
     C                   Z-ADD     32            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * SPRÅKKODE TIL AVSENDER
     C     LINNBR        IFEQ      7
     C     POSNBR        ANDGE     32
     C     POSNBR        ANDLE     33
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSSKS         UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSSKS
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     13            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * MOTTAKERSNR
     C     LINNBR        IFEQ      8
     C     POSNBR        ANDGE     13
     C     POSNBR        ANDLE     20
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    WSKNK
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN
     C                   Z-ADD     43            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * LANDKODE TIL TRANSPORTMIDDEL VED AVGANG
     C     LINNBR        IFEQ      8
     C     POSNBR        ANDGE     71
     C     POSNBR        ANDLE     72
     C                   CALL      'SYFI10L'
     C                   PARM                    WSTALK
     C                   PARM                    USPED
     C                   Z-ADD     74            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * SPRÅKKODE TIL TRANSPORTMIDDEL VED AVGANG
     C     LINNBR        IFEQ      8
     C     POSNBR        ANDGE     74
     C     POSNBR        ANDLE     75
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTASK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTASK
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     49            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *søk vareadresse mottager
N19  C     LINNBR        IFEQ      9
N19  C                   CALL      'SOEKVADR'
N19  C                   PARM                    FIFIRM
N19  C                   PARM                    WSKNK
N19  C                   PARM                    WSNAK
N19  C                   PARM                    WSADK1
N19  C                   PARM                    WSADK2           30
N19  C                   PARM                    WSADK3           30
S25  C*                  PARM                    WSLAND            2
N25  C                   PARM                    WSLKK
N19  C                   PARM                    UADRNR            5
n19  C     wsnaK         IFNE      *blanks
n19  c                   move      wsadK3        ad
n19  c     ' '           scan      ad            f                 2 0
n19  c     f             ifgt      9
n19  c                   eval      wspsK=wsads3
n19  c                   else
n19  c                   eval      wspnk = %SUBST(ad:1:f-1)
n19  c                   eval      wspsk = %SUBST(ad:f+1:30-f-1)
n19  c                   move      '.'           wspsk
N19  C                   Z-ADD     9             LINNBR
N19  C                   Z-ADD     49            POSNBR
N19  C                   END
N19  C                   END
n19  C                   GOTO      SLSØK
N19  C                   END
      * LANDKODE TIL TRANSPORTMIDDEL VED GRENSE
     C     LINNBR        IFEQ      11
     C     POSNBR        ANDGE     71
     C     POSNBR        ANDLE     72
     C                   CALL      'SYFI10L'
     C                   PARM                    WSTGLK
     C                   PARM                    USPED
     C                   Z-ADD     74            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * SPRÅKKODE TIL TRANSPORTMIDDEL VED GRENSE
     C     LINNBR        IFEQ      11
     C     POSNBR        ANDGE     74
     C     POSNBR        ANDLE     75
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTGSK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTGSK
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * LANDKODE TIL MOTTAKER
     C     LINNBR        IFEQ      12
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     13
     C                   CALL      'SYFI10L'
     C                   PARM                    WSLKK
     C                   PARM                    USPED
     C                   Z-ADD     32            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * SPRÅKKODE TIL MOTTAKER
     C     LINNBR        IFEQ      12
     C     POSNBR        ANDGE     32
     C     POSNBR        ANDLE     33
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSSKK         UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSSKK
     C                   Z-ADD     51            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * TRANSPORTMÅTE
     C     LINNBR        IFEQ      12
     C     POSNBR        ANDGE     51
     C     POSNBR        ANDLE     52
     C                   CALL      'SAD061I'
     C                   PARM                    WSTRM
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     13            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * HOVEDANSVARLIGNR
     C     LINNBR        IFEQ      13
     C     POSNBR        ANDGE     13
     C     POSNBR        ANDLE     20
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    WSKNA
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     53            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * AVGANGSTOLLSTED
     C     LINNBR        IFEQ      14
     C     POSNBR        ANDGE     57
     C     POSNBR        ANDLE     64
     C                   MOVE      '106'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSCATS        UKODE
     C                   MOVE      'AVG'         UTYPE2            3
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSCATS
     C                   Z-ADD     15            LINNBR
     C                   Z-ADD     63            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * SPRÅKKODE PÅ FØLGEDOKUMENTER
     C     LINNBR        IFEQ      15
     C     POSNBR        ANDGE     63
     C     POSNBR        ANDLE     64
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSSKFD        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSSKFD
     C                   Z-ADD     17            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * LANDKODE TIL HOVEDANSVARLIG
     C     LINNBR        IFEQ      17
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     13
     C                   CALL      'SYFI10L'
     C                   PARM                    WSLKA
     C                   PARM                    USPED
     C                   Z-ADD     32            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * SPRÅKKODE TIL HOVEDANSVARLIG
     C     LINNBR        IFEQ      17
     C     POSNBR        ANDGE     32
     C     POSNBR        ANDLE     33
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSSKA         UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSSKA
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     6             POSNBR
     C                   GOTO      SLSØK
     C                   END
      * TOLLSTED TRANSIT-1
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     6
     C     POSNBR        ANDLE     13
     C                   MOVE      '106'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTSD1        UKODE
     C                   MOVE      'TRS'         UTYPE2            3
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTSD1
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * TOLLSTED TRANSIT-2
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     15
     C     POSNBR        ANDLE     22
     C                   MOVE      '106'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTSD2        UKODE
     C                   MOVE      'TRS'         UTYPE2            3
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTSD2
     C                   Z-ADD     24            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * TOLLSTED TRANSIT-3
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     24
     C     POSNBR        ANDLE     31
     C                   MOVE      '106'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTSD3        UKODE
     C                   MOVE      'TRS'         UTYPE2            3
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTSD3
     C                   Z-ADD     33            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * TOLLSTED TRANSIT-4
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     33
     C     POSNBR        ANDLE     40
     C                   MOVE      '106'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTSD4        UKODE
     C                   MOVE      'TRS'         UTYPE2            3
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTSD4
     C                   Z-ADD     42            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * TOLLSTED TRANSIT-5
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     42
     C     POSNBR        ANDLE     49
     C                   MOVE      '106'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTSD5        UKODE
     C                   MOVE      'TRS'         UTYPE2            3
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTSD5
     C                   Z-ADD     51            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * TOLLSTED TRANSIT-6
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     51
     C     POSNBR        ANDLE     58
     C                   MOVE      '106'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTSD6        UKODE
     C                   MOVE      'TRS'         UTYPE2            3
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTSD6
     C                   Z-ADD     60            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * TOLLSTED TRANSIT-7
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     60
     C     POSNBR        ANDLE     67
     C                   MOVE      '106'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTSD7        UKODE
     C                   MOVE      'TRS'         UTYPE2            3
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTSD7
     C                   Z-ADD     69            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * TOLLSTED TRANSIT-8
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     69
     C     POSNBR        ANDLE     76
     C                   MOVE      '106'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVE      'TRS'         UTYPE2            3
     C                   MOVEL     WSTSD8        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTSD8
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     6             POSNBR
     C                   GOTO      SLSØK
     C                   END
      * ADGANGSKODE FOR GARANTI
     C     LINNBR        IFEQ      19
     C     POSNBR        ANDGE     69
     C     POSNBR        ANDLE     72
     C                   IF        WSGFT1 <> *BLANKS
     C                   CALL      'TR034R'
     C                   PARM                    WSGFT1
     C                   PARM                    WSGADK
     C                   ELSE
     C                   MOVE      '105'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSGADK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSGADK
     C                   END
     C                   Z-ADD     74            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * LANDKODE TIL GARANTI BEGRENSNING
     C     LINNBR        IFEQ      19
     C     POSNBR        ANDGE     76
     C     POSNBR        ANDLE     77
     C                   CALL      'SYFI10L'
     C                   PARM                    WSGBGU
     C                   PARM                    USPED
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     35
     C     POSNBR        ANDLE     37
     C                   MOVE      WDT           UDT               8 0
     C                   CALL      'SAD061F'
     C                   PARM                    WSGVK
     C                   PARM                    UDT
     C                   Z-ADD     67            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * BESTEMMELSESTEDS TOLLSTED
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     67
     C     POSNBR        ANDLE     74
     C                   MOVE      '106'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVE      'ANK'         UTYPE2            3
     C                   MOVEL     WSTSB         UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSTSB
     C                   Z-ADD     21            LINNBR
     C                   Z-ADD     52            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * SPRÅKKODE TIL DEKLARASJON
     C     LINNBR        IFEQ      17
     C     POSNBR        ANDGE     77
     C     POSNBR        ANDLE     78
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSDSK         UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSDSK
     C                   Z-ADD     21            LINNBR
     C                   Z-ADD     13            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * KONTROLL RESULTAT
     C     LINNBR        IFEQ      21
     C     POSNBR        ANDGE     13
     C     POSNBR        ANDLE     14
     C                   MOVE      '047'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSDKR         UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSDKR
     C                   Z-ADD     22            POSNBR
     C                   END
      * SPRÅKKODE TIL FORSEGLING
     C     LINNBR        IFEQ      21
     C     POSNBR        ANDGE     78
     C     POSNBR        ANDLE     79
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSDFSK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2
     C                   MOVEL     UKODE         WSDFSK
     C                   GOTO      SLSØK
     C                   END
      *
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
      *
     C     SLSØK         ENDSR
      *
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
N02  C                   MOVE      *ZEROS        Z_THUNIK
N02  C                   MOVE      *BLANKS       Z_THREFF
N02   *
N02   * henter fra eksterref
N02   *
N02  C   04              IF        LINNBR = 8
N02  C                   CALL      'SYGE47R'
N02  C                   PARM      'B'           UHEUR             1
N02  C                   PARM                    WSEXTR
N02  C                   EVAL      *IN04=*OFF
N02  C                   IF        WSEXTR = *BLANKS
N02  C                   EVAL      *IN30=*ON
N02  C                   GOTO      SLTB1
N02  C                   ENDIF
N02  C                   ENDIF
N02   * EKSTEN REFERANSE
N02  C                   IF        ((UTYPE <> 'CPY') AND (WSEXTR <> *BLANKS))
N02  C     FRISOL01K     CHAIN     FRISOL01                           33
N02  C                   DOW       *IN33 = *OFF
N02  C     TRHKFRI       CHAIN(N)  TRUH                               33
N02  C                   IF        *IN33 = *OFF
N02  C                   MOVE      FSOPD         WSTDN
N02  C                   MOVE      FSAVD         UAVD
N02  C                   LEAVE
N02  C                   END
N02  C     FRISOL01K     READE     FRISOL01                               33
N02  C                   ENDDO
N02   * Ny ekstern ref  - hent data
N06  C                   move      'N'           EXTMAN            1
N02  C   33              IF        THEKST = 'J'
N06  C     FRISOL01K2    CHAIN     FRISOL01                           33
N06  C     *in33         ifeq      '0'
N06  C                   move      fsopd         UXOPD
N06  C                   move      'M'           EXTMAN
N06  c                   ELSE
N02  C                   MOVE      *ZEROS        UXOPD             7 0
N02  C                   CALL      'SADEXT'
N02  C                   PARM                    UAVD
N02  C                   PARM                    WSEXTR
N02  C                   PARM                    UXOPD
N02  C                   PARM                    WSSG
N06  C                   end
N02  C                   MOVE      UXOPD         WSTDN
N02  C                   IF        WSTDN = 0
N02  C                   SETON                                        30
N02  C                   Z-ADD     7             LINNBR
N02  C                   Z-ADD     20            POSNBR
N02  C                   MOVE      'SHU1172'     MSGNR
N02  C                   GOTO      SLTB1
N02  C                   END
N02  C                   END
N02  C                   END
      *** TEST AVDELING
     C     UAVD          CHAIN(N)  TRUSTD                             95
     C  N95              DO
     C                   MOVE      *BLANKS       THST
     C                   MOVE      *ZEROS        THTDN
N11  C                   MOVE      *ZEROS        THDDT
S20  C*                  IF        THGBL < 100
S20  C*                  MOVE      *ZEROS        THGBL
S21  C*    THGBL         DIV       100           X_THGBL           9 2
S21  C*                  IF        X_THGBL < 100
S21  C*                  EVAL      THGBL = 0
S21  C*                  ELSE
S21  C*                  EVAL      THGBL = X_THGBL
S21  C*                  END
     C                   END
     C   95              DO
     C                   MOVE      'SPA0001'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     34            POSNBR
     C                   GOTO      SLTB1
     C                   END
      *** TEST TARIFFØR
     C                   IF        UTYPE <> 'DSP'
     C     KODSIK        CHAIN     KOSIR                              99
     C   99              DO
     C                   MOVE      'SPS0001'     MSGNR
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     34            POSNBR
     C                   SETON                                        30
     C                   GOTO      SLTB1
     C                   END
     C                   END
      *
      *** TEST OM TASTET TOLLDEKNR. ER RIKTIG
      * WSTDN = 0  --> HENT STANDARD SAD-OPPLYSNINGER
     C     UTYPE         IFEQ      'CPY'                                        1<-B
     C     TRHKK         CHAIN(N)  TRUH                               33
     C                   ELSE                                                   1
     C     WSTDN         IFNE      0                                             2<-B
     C     TRHK          CHAIN     TRUH                               33
     C  N33UTYPE         IFEQ      'DSP'                                          3<-B
     C                   UPDATE    TRUHR
     C                   GOTO      STTB1
     C                   END                                                      3<-E
      * THST = ' ' --> ÅPEN TRANSITTERING
      *        'A' --> HOLD PÅ Å SENDE UT
      *        'B' --> SENDT TIL IBM
      *        'C' --> SENDT TIL TOLLVESENET
      *        'D' --> KANSELLERT
      *        'E' --> HOLD PÅ Å BLI ENDRET
      *        'F' --> MELDING OM INGEN FRIGIVELSE
      *        'K' --> VENT PÅ Å BLI UTSKREVET
      *        'M' --> FEILMELDING FRA TOLLVESENET
      *        'P' --> UTSKREVET
      *        'S' --> MELDING OM AVVIST FRIGIVELSE
      *        'U' --> HAR FÅTT MRN-NUMMER
      *        'V' --> VAREKONTROLL
      *        'Z' --> TRANSITT AVSLUTTET
     C  N33THST          IFNE      ' '                                            3<-B
     C     THST          ANDNE     'K'
     C     THST          ANDNE     'M'
     C     THST          COMP      'P'                                9898
     C   98THST          COMP      'Q'                                9898
     C   98THST          COMP      'F'                                9898
     C                   END                                                      3<-E
     C  N33
     CANN98THST          IFEQ      'A'                                            3<-B
     C     THWS          COMP      UWS                                9898
     C                   END                                                      3<-E
      *
     C  N33
     CANN98              DO                                                       3<-B
     C                   EXSR      TSTM
     C   98              UPDATE    TRUHR
     C   98              GOTO      SLTB1
     C                   END                                                      3<-E
     C  N33
     CANN98              MOVE      'E'           THST
     C  N33              UPDATE    TRUHR
     C   33HEADFK        CHAIN     HEADF                              98
     C   33
     CAN 98HEADFK        CHAIN     SAEH                               98
      *
     C   98              DO                                                       3<-B
     C                   MOVE      'SPT0028'     MSGNR
     C                   Z-ADD     10            LINNBR
     C                   Z-ADD     34            POSNBR
     C                   SETON                                        30
     C                   GOTO      SLTB1
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      * TEST OM DET SKAL SENDES PÅ TVINN  (34 ON = DENNE SENDES TVINN)
     C     WSTOLK        COMP      'J'                                    34
N02   *
N02   *  04 = PLUKK FRA Z-FIL
N02  C                   MOVE      *ZEROS        UZAVD             4 0
N02  C                   MOVE      *ZEROS        UZTDN             7 0
N02  C                   MOVE      *BLANKS       UZREFF           17
N02  C                   MOVE      *ZEROS        UZUNIK            9 0
N02  C  N30              IF        *IN04
N02  C                   CALL      'TR011RB'
N02  C                   PARM                    FIFIRM
N02  C                   PARM                    UZAVD
N02  C                   PARM                    UZTDN
N02  C                   PARM                    UZREFF
N02  C                   PARM                    UZUNIK
N02  C                   PARM                    UFLAGG
N02  C     UFLAGG        CABEQ     1             SLTB1
N02  C                   IF        UZREFF <> *BLANKS
N02  C                   EVAL      WSSOK = UZREFF
N02  C                   END
N02  C                   END
      *
      *** HENT OPPLYSNINGER FRA HEADF/DOKUF
     C  N30
     CAN 33              MOVE      WSTDN         UTDN
     C  N30
     CAN 33              EXSR      SRU1
      *
      *** FLYTT DATA FRA FIL-VARIABLER TIL WS-VARIABLER
     C     STTB1         TAG
     C  N30              EXSR      MOVW2
N02   *
N02  C  N30              IF        (*IN04 OR (Z_THREFF <> *BLANKS))
N02  C                   EXSR      HZFIL
N02  C                   END
      *
     C     SLTB1         ENDSR
      *
     C***********************************************
     C     TSTM          BEGSR
     C***********************************************
      *
      * Test om det finnes sending i "postkasse"
     C     TVINMK        SETGT     EDIM1
     C     STTSTM        TAG
     C     TVINMK        READPE    EDIM1                                  98
     C  N98MSR           IFEQ      'S'
     C     M1001         ANDEQ     'TET'
     C   10              DELETE    EDIMR
     C   10              GOTO      SLTSTM
     C                   UPDATE    EDIMR
     C                   MOVE      'SPT0043'     MSGNR
     C                   SETON                                        3098
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     34            POSNBR
     C                   GOTO      SLTSTM
     C                   ELSE
     C                   UPDATE    EDIMR
     C                   GOTO      STTSTM
     C                   END
      *
      * Test om det har fått transitteringsnr
     C     TVIM4K        SETLL     EDIM4                              98
     C     STTST2        TAG
     C     TVI41K        READPE    EDIM4                                  98
     C  N98MST           IFEQ      'D'
     C     M1001         ORNE      'TET'
     C                   GOTO      STTST2
     C                   ELSE
     C     M1N07         IFEQ      '028'
     C     M1N07         OREQ      '029'
     C                   MOVE      'YBC0819'     MSGNR
     C                   SETON                                        3098
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     34            POSNBR
     C                   GOTO      SLTSTM
     C                   END
     C                   END
     C                   MOVE      '0'           *IN98
      *
     C     SLTSTM        ENDSR
      *
     C***********************************************
     C     TESTB2        BEGSR
     C***********************************************
      *
S22  C*                  IF        WSDK = 'SS'
N22  C                   IF        WSDK='SS' OR WSDK='ENTRY' OR WSDK='EXIT'
     C                   MOVE      'N'           WSENKL
N03  C                   IF        WSTSD1 = *BLANKS
     C                   EVAL      WSTSD1 = WSCATS
N03  C                   END
     C                   EVAL      WSTSB  = WSCATS
     C                   END
      *
     C     WSPRO         IFNE      0
     C     WSLSTL        ORGT      0
     C     WSENKL        ANDEQ     'N'
     C     WSPRO         CHAIN     TURER14                            99
N15  c  n99tubiln        ifeq      *blanks
N15  c                   movel     tuheng        tubiln
N15  c                   end
S22  C*  99              IF        WSDK = 'SS'
N22  C   99              IF        WSDK='SS' OR WSDK='ENTRY' OR WSDK='EXIT'
N09  C     WSPRO         CHAIN     HEAD14                             99
N09  C  N99              IF        ((WSKNS = 0) AND (WSNAS = *BLANKS))
N09  C     KODTAK        CHAIN     KODTA                              33
N09  C                   MOVE      KOAKNR        WSKNS
N09  C                   EXSR      TESTSS
N09  C                   END
N09  C  N99              IF        ((WSKNK = 0) AND (WSNAK = *BLANKS))
N09  C                   MOVEL     HESAML        SMSD
N09  C                   MOVE      HESAML        SMLNR
N09  C     SAMLBK        CHAIN     SAMLB                              33
N09  C  N33              MOVE      SMKNS         WSKNK
N09  C                   EXSR      TESTKK
N09  C                   END
N09  C                   END
     C   99              MOVE      'SPT0017'     MSGNR
     C   99              SETON                                        30
     C     *IN99         IFEQ      '0'
     C     WSKNK         IFEQ      0
     C     WSNAK         ANDEQ     *BLANKS
     C                   MOVE      TUKNA         WSKNK
     C                   END
     C     WSTAID        IFEQ      *BLANKS
     C                   MOVEL     TUBILN        WSTAID
N13  C                   MOVEL     TULK          WSTALK
     C                   END
     C     WSTGID        IFEQ      *BLANKS
     C                   MOVEL     TUBILN        WSTGID
     C                   END
     C     WSTRM         IFEQ      0
     C                   MOVE      TUTRMA        WSTRM
     C                   END
     C                   END
     C                   END
      *
N07  C                   IF        UIE = 'I'
N07  C     WSDK          COMP      'SS'                               9898
N22  C   98WSDK          COMP      'ENTRY'                            9898
N22  C   98WSDK          COMP      'EXIT'                             9898
N07  C                   ELSE
     C                   MOVE      '031'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSDK          YKODE
     C     TRK01K        CHAIN     TRKODL01                           98
N07  C                   END
     C   98
     CANN30              MOVE      'YBC0809'     MSGNR
     C   98              SETON                                        30
      *
     C     WSENKL        IFEQ      'J'
     C     WSLSTL        ANDGT     0
     C  N30              MOVE      'YBC1734'     MSGNR
     C                   MOVE      '1'           *IN55
     C                   MOVE      '1'           *IN30
     C                   END
      *
     C     WSKNS         IFNE      0
     C                   EXSR      TESTSS
     C                   END
     C                   IF        ((WSTINS <> *BLANKS) AND (WSLKS = 'NO'))
S24  C*                  MOVEL     WSTINS        XAN02             2
S24  C*                  IF        XAN02 <> 'NO'
N24  C                   MOVEL     WSTINS        KS2LK
N24  C     KODS2K        CHAIN     KOS2R                              33
N24  C                   IF        *IN33
     C                   EVAL      WSTINS = 'NO' + %TRIM(WSTINS)
     C                   END
     C                   END
      *
     C     WSENKL        IFEQ      'J'
     C     WSTINS        COMP      *BLANKS                                96
     C   96
     CANN30              MOVE      'YBC0812'     MSGNR
     C   96              SETON                                        30
     C                   END
      *
     C     WSNAS         COMP      *BLANKS                                95
     C   95
     CANN30              MOVE      'SPK0037'     MSGNR
     C   95              SETON                                        30
      *
     C                   MOVE      WSALK         KS2LK
     C     KODS2K        CHAIN     KOS2R                              94
     C   94
     CANN30              MOVE      'SPL0001'     MSGNR
     C   94              SETON                                        30
N14  C   94              MOVE      'X'           XEFTA             1
N14  C  N94              MOVE      KS2PRE        XEFTA
N10   *
N10  C     WSPNS         COMP      *BLANKS                                46
N10  C   46
N10  CANN30              MOVE      'YBC1976'     MSGNR
N10  C   46              SETON                                        30
N10   *
N10  C     WSPSS         COMP      *BLANKS                                45
N10  C   45
N10  CANN30              MOVE      'YBC1975'     MSGNR
N10  C   45              SETON                                        30
      *
N14  C                   MOVE      ' '           XEUEFTA           1
S08  C*                  IF        ((WSBLK <> *BLANKS) OR (WSENKL = 'J'))
N08  C                   IF        (((WSBLK <> *BLANKS) OR
N08  C                               (WSENKL = 'J')) OR
N22  C                               (WSDK = 'ENTRY') OR (WSDK = 'EXIT') OR
N08  C                               (WSDK = 'SS'))
N01  C                   IF        ((WSBLK = *BLANKS) AND (WSKNK <> 0))
N01  C                   MOVE      WSKNK         KUNDNR
N01  C     CUND1K        CHAIN     CUNDL01                            33
N01  C  N33              MOVE      SYLAND        WSBLK
N01  C                   END
N07  C                   IF        UIE = 'I'
N07  C     WSBLK         COMP      'NO'                               9393
N07  C                   ELSE
     C                   MOVE      WSBLK         KS2LK
     C     KODS2K        CHAIN     KOS2R                              93
N14   *
N14   * AVSENDERS LAND = EFTA ELLER HR/TR --> BESTEMMELSES LAND KAN IKKE VÆRE AD ELLER SM
N14  C  N93              IF        XEFTA = 'C' OR
N14  C*                            WSALK = 'HR' OR WSALK = 'TR'
N14  C                             WSALK = 'HR'                                 Turkia venter
N14  C                   IF        WSBLK = 'AD' OR WSBLK = 'SM'
N14  C                   EVAL      *IN93 = *ON
N14  C                   END
N14  C                   END
N14  C  N93              MOVE      KS2PRE        XEUEFTA
N07  C                   END
     C   93
     CANN30              MOVE      'SPL0001'     MSGNR
     C   93              SETON                                        30
     C                   END
      *
     C     WSLKS         IFEQ      *BLANKS
     C                   MOVE      FILAND        WSLKS
     C                   END
     C                   MOVE      WSLKS         KS2LK
     C     KODS2K        CHAIN     KOS2R                              92
     C   92
     CANN30              MOVE      'SPL0001'     MSGNR
     C   92              SETON                                        30
     C  N92WSSKS         IFEQ      *BLANKS
     C                   MOVE      KS2NAS        WSSKS
     C                   END
      *
N14  C  N30              MOVE      'N'           XFEIL             1
N14  C   30              MOVE      'J'           XFEIL
      *
     C     WSTAID        IFEQ      *BLANKS
     C  N30              MOVE      'YBC1705'     MSGNR
     C                   SETON                                        3056
     C                   END
      *
     C     WSSKS         IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSSKS         YKODE
     C     TRK01K        CHAIN     TRKODL01                           91
     C   91
     CANN30              MOVE      'YBC0810'     MSGNR
     C   91              SETON                                        30
     C                   END
      *
     C     WSKNK         IFNE      0
     C                   EXSR      TESTKK
     C                   END
     C                   IF        ((WSTINK <> *BLANKS) AND (WSLKK = 'NO'))
S24  C*                  MOVEL     WSTINK        XAN02             2
S24  C*                  IF        XAN02 <> 'NO'
N24  C                   MOVEL     WSTINK        KS2LK
N24  C     KODS2K        CHAIN     KOS2R                              33
N24  C                   IF        *IN33
     C                   EVAL      WSTINK = 'NO' + %TRIM(WSTINK)
     C                   END
     C                   END
N14   *
N14   * TEST MOTTAKERS ORGANISASJONSNR
S18  C*                  IF        PTFDT <= XIDAG
S23  C*                  IF        WSTINK = *BLANKS
S23  C*                  IF        XEUEFTA = 'B' OR XEUEFTA = 'C' OR
S23  C*                            WSBLK = 'AD' OR WSBLK = 'SM' OR
N14  C*                            WSBLK = 'HR' OR WSBLK = 'TR'
S23  C*                            WSBLK = 'HR'                                 TURKIA VENTER
S23  C*                  IF        XFEIL = 'N'
S23  C*                  MOVE      'YBC1988'     MSGNR
S23  C*                  END
S23  C*                  EVAL      *IN42 = *ON
S23  C*                  EVAL      *IN30 = *ON
S23  C*                  END
S23  C*                  END
S18  C*                  END
      *
     C                   MOVE      WSTALK        KS2LK
     C     KODS2K        CHAIN     KOS2R                              89
     C   89
     CANN30              MOVE      'SPL0001'     MSGNR
     C   89              SETON                                        30
     C  N89WSTASK        IFEQ      *BLANKS
     C                   MOVE      KS2NAS        WSTASK
     C                   END
      *
     C     WSTASK        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTASK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           88
     C   88
     CANN30              MOVE      'YBC0810'     MSGNR
     C   88              SETON                                        30
     C                   END
      *
     C     WSNAK         COMP      *BLANKS                                87
     C   87
     CANN30              MOVE      'SPK0038'     MSGNR
     C   87              SETON                                        30
      *
     C     WSADK1        COMP      *BLANKS                                53
     C   53
     CANN30              MOVE      'YBC1883'     MSGNR
     C   53              SETON                                        30
      *
     C     WSPNK         COMP      *BLANKS                                52
     C   52
     CANN30              MOVE      'YBC1884'     MSGNR
     C   52              SETON                                        30
      *
     C     WSPSK         COMP      *BLANKS                                51
     C   51
     CANN30              MOVE      'YBC1885'     MSGNR
     C   51              SETON                                        30
      *
     C     WSTGID        COMP      *BLANKS                                54
     C   54
     CANN30              MOVE      'YBC1705'     MSGNR
     C   54              SETON                                        30
      *
     C                   MOVE      WSTGLK        KS2LK
     C     KODS2K        CHAIN     KOS2R                              86
     C   86
     CANN30              MOVE      'SPL0001'     MSGNR
     C   86              SETON                                        30
     C  N86WSTGSK        IFEQ      *BLANKS
     C                   MOVE      KS2NAS        WSTGSK
     C                   END
      *
     C     WSTGSK        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTGSK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           85
     C   85
     CANN30              MOVE      'YBC0810'     MSGNR
     C   85              SETON                                        30
     C                   END
      *
     C                   MOVE      WSLKK         KS2LK
     C     KODS2K        CHAIN     KOS2R                              84
     C   84
     CANN30              MOVE      'SPL0001'     MSGNR
     C   84              SETON                                        30
     C  N84WSSKK         IFEQ      *BLANKS
     C                   MOVE      KS2NAS        WSSKK
     C                   END
      *
     C     WSSKK         IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSSKK         YKODE
     C     TRK01K        CHAIN     TRKODL01                           83
     C   83
     CANN30              MOVE      'YBC0810'     MSGNR
     C   83              SETON                                        30
     C                   END
      *
     C     KODS4K        CHAIN     KOS4R                              82
     C   82
     CANN30              MOVE      'SPL0001'     MSGNR
     C   82              SETON                                        30
      *
     C     WSKNA         IFNE      0
     C                   EXSR      TESTAA
     C                   END
      *
     C     WSENKL        IFEQ      'J'
     C     WSDKR         ORNE      *BLANKS
     C     WSTINA        COMP      *BLANKS                                80
     C   80
     CANN30              MOVE      'YBC0812'     MSGNR
     C   80              SETON                                        30
     C                   END
      *
     C     TRHK          CHAIN     TRUHFV                             33
     C                   IF        ((((((WSDK = 'SS') OR
N22  C                                  (WSDK = 'ENTRY') OR (WSDK = 'EXIT') OR
     C                                  (WSBLK = 'CH')) OR
     C                                  (WSBLK = 'IS')) OR
     C                                  (WSBLK = 'SJ')) OR
     C                                  (WSBLK = 'FO')) OR
     C                                  (*IN33 = *OFF) OR *IN06)
     C     WSLSD         COMP      *BLANKS                                47
     C   47
     CANN30              MOVE      'YBC1949'     MSGNR
     C   47              SETON                                        30
     C                   END
      *
     C     WSNAA         COMP      *BLANKS                                79
     C   79
     CANN30              MOVE      'SPK0037'     MSGNR
     C   79              SETON                                        30
      *
     C                   MOVE      '106'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSCATS        YKODE
     C     TRK01K        CHAIN     TRKODL01                           78
     C   78
     CANN30              MOVE      'YBC1768'     MSGNR
     C   78              SETON                                        30
      *
     C     WSSKFD        IFEQ      *BLANKS
     C                   MOVE      WSSKA         WSSKFD
     C                   ELSE
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSSKFD        YKODE
     C     TRK01K        CHAIN     TRKODL01                           77
     C   77
     CANN30              MOVE      'YBC0810'     MSGNR
     C   77              SETON                                        30
     C                   END
      *
     C                   MOVE      WSLKA         KS2LK
     C     KODS2K        CHAIN     KOS2R                              76
     C   76
     CANN30              MOVE      'SPL0001'     MSGNR
     C   76              SETON                                        30
     C  N76WSSKA         IFEQ      *BLANKS
     C                   MOVE      KS2NAS        WSSKA
     C                   END
      *
     C     WSSKA         IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSSKA         YKODE
     C     TRK01K        CHAIN     TRKODL01                           75
     C   75
     CANN30              MOVE      'YBC0810'     MSGNR
     C   75              SETON                                        30
     C                   END
N10   *
N10  C     WSDST         COMP      *BLANKS                                43
N10  C   43
N10  CANN30              MOVE      'YBC1977'     MSGNR
N10  C   43              SETON                                        30
      *
     C     WSDSK         IFEQ      *BLANKS
     C                   MOVE      WSSKA         WSDSK
     C                   ELSE
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSDSK         YKODE
     C     TRK01K        CHAIN     TRKODL01                           62
     C   62
     CANN30              MOVE      'YBC0810'     MSGNR
     C   62              SETON                                        30
     C                   END
      *
     C     WSTSD1        IFNE      *BLANKS
     C     WSENKL        OREQ      'J'
     C                   MOVE      '106'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTSD1        YKODE
     C     TRK01K        CHAIN     TRKODL01                           74
N03  C  N74TKTRS         COMP      'J'                                7474
N14  C  N74              IF        XEFTA = 'C' OR
N14  C*                            WSALK = 'HR' OR WSALK = 'TR'
N14  C                             WSALK = 'HR'                                 TURKIA VENTER
N14  C                   MOVEL     WSTSD1        XAN02             2
N14  C                   IF        XAN02 = 'AD' OR XAN02 = 'SM'
N14  C                   EVAL      *IN74 = *ON
N14  C                   END
N14  C                   END
     C   74
     CANN30              MOVE      'YBC1768'     MSGNR
     C   74              SETON                                        30
     C                   END
      *
     C     WSTSD2        IFNE      *BLANKS
     C                   MOVE      '106'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTSD2        YKODE
     C     TRK01K        CHAIN     TRKODL01                           73
N03  C  N73TKTRS         COMP      'J'                                7373
N14  C  N73              IF        XEFTA = 'C' OR
N14  C*                            WSALK = 'HR' OR WSALK = 'TR'
N14  C                             WSALK = 'HR'                                 TURKIA VENTER
N14  C                   MOVEL     WSTSD2        XAN02             2
N14  C                   IF        XAN02 = 'AD' OR XAN02 = 'SM'
N14  C                   EVAL      *IN73 = *ON
N14  C                   END
N14  C                   END
     C   73
     CANN30              MOVE      'YBC1768'     MSGNR
     C   73              SETON                                        30
     C                   END
      *
     C     WSTSD3        IFNE      *BLANKS
     C                   MOVE      '106'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTSD3        YKODE
     C     TRK01K        CHAIN     TRKODL01                           72
N03  C  N72TKTRS         COMP      'J'                                7272
N14  C  N72              IF        XEFTA = 'C' OR
N14  C*                            WSALK = 'HR' OR WSALK = 'TR'
N14  C                             WSALK = 'HR'                                 TURKIA VENTER
N14  C                   MOVEL     WSTSD3        XAN02             2
N14  C                   IF        XAN02 = 'AD' OR XAN02 = 'SM'
N14  C                   EVAL      *IN72 = *ON
N14  C                   END
N14  C                   END
     C   72
     CANN30              MOVE      'YBC1768'     MSGNR
     C   72              SETON                                        30
     C                   END
      *
     C     WSTSD4        IFNE      *BLANKS
     C                   MOVE      '106'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTSD4        YKODE
     C     TRK01K        CHAIN     TRKODL01                           71
N03  C  N71TKTRS         COMP      'J'                                7171
N14  C  N71              IF        XEFTA = 'C' OR
N14  C*                            WSALK = 'HR' OR WSALK = 'TR'
N14  C                             WSALK = 'HR'                                 TURKIA VENTER
N14  C                   MOVEL     WSTSD4        XAN02             2
N14  C                   IF        XAN02 = 'AD' OR XAN02 = 'SM'
N14  C                   EVAL      *IN71 = *ON
N14  C                   END
N14  C                   END
     C   71
     CANN30              MOVE      'YBC1768'     MSGNR
     C   71              SETON                                        30
     C                   END
      *
     C     WSTSD5        IFNE      *BLANKS
     C                   MOVE      '106'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTSD5        YKODE
     C     TRK01K        CHAIN     TRKODL01                           70
N03  C  N70TKTRS         COMP      'J'                                7070
N14  C  N70              IF        XEFTA = 'C' OR
N14  C*                            WSALK = 'HR' OR WSALK = 'TR'
N14  C                             WSALK = 'HR'                                 TURKIA VENTER
N14  C                   MOVEL     WSTSD5        XAN02             2
N14  C                   IF        XAN02 = 'AD' OR XAN02 = 'SM'
N14  C                   EVAL      *IN70 = *ON
N14  C                   END
N14  C                   END
     C   70
     CANN30              MOVE      'YBC1768'     MSGNR
     C   70              SETON                                        30
     C                   END
      *
     C     WSTSD6        IFNE      *BLANKS
     C                   MOVE      '106'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTSD6        YKODE
     C     TRK01K        CHAIN     TRKODL01                           69
N03  C  N69TKTRS         COMP      'J'                                6969
N14  C  N69              IF        XEFTA = 'C' OR
N14  C*                            WSALK = 'HR' OR WSALK = 'TR'
N14  C                             WSALK = 'HR'                                 TURKIA VENTER
N14  C                   MOVEL     WSTSD6        XAN02             2
N14  C                   IF        XAN02 = 'AD' OR XAN02 = 'SM'
N14  C                   EVAL      *IN69 = *ON
N14  C                   END
N14  C                   END
     C   69
     CANN30              MOVE      'YBC1768'     MSGNR
     C   69              SETON                                        30
     C                   END
      *
     C     WSTSD7        IFNE      *BLANKS
     C                   MOVE      '106'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTSD7        YKODE
     C     TRK01K        CHAIN     TRKODL01                           68
N03  C  N68TKTRS         COMP      'J'                                6868
N14  C  N68              IF        XEFTA = 'C' OR
N14  C*                            WSALK = 'HR' OR WSALK = 'TR'
N14  C                             WSALK = 'HR'                                 TURKIA VENTER
N14  C                   MOVEL     WSTSD7        XAN02             2
N14  C                   IF        XAN02 = 'AD' OR XAN02 = 'SM'
N14  C                   EVAL      *IN68 = *ON
N14  C                   END
N14  C                   END
     C   68
     CANN30              MOVE      'YBC1768'     MSGNR
     C   68              SETON                                        30
     C                   END
      *
     C     WSTSD8        IFNE      *BLANKS
     C                   MOVE      '106'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTSD8        YKODE
     C     TRK01K        CHAIN     TRKODL01                           67
N03  C  N67TKTRS         COMP      'J'                                6767
N14  C  N67              IF        XEFTA = 'C' OR
N14  C*                            WSALK = 'HR' OR WSALK = 'TR'
N14  C                             WSALK = 'HR'                                 TURKIA VENTER
N14  C                   MOVEL     WSTSD8        XAN02             2
N14  C                   IF        XAN02 = 'AD' OR XAN02 = 'SM'
N14  C                   EVAL      *IN67 = *ON
N14  C                   END
N14  C                   END
     C   67
     CANN30              MOVE      'YBC1768'     MSGNR
     C   67              SETON                                        30
     C                   END
      *
S22  C*                  IF        WSDK = 'SS'
N22  C                   IF        WSDK='SS' OR WSDK='ENTRY' OR WSDK='EXIT'
     C                   EVAL      WSGKD  = 7
     C                   EVAL      WSGFT1 = *BLANKS
     C                   EVAL      WSGFT2 = *BLANKS
     C                   EVAL      WSGADK = *BLANKS
     C                   EVAL      WSGBL  = *ZEROS
     C                   EVAL      WSGVK  = *BLANKS
      *
     C                   ELSE
      *
     C                   MOVE      *ZEROS        XGGBLR           11 0
     C     WSGFT1        IFEQ      *BLANKS                                      1<-B
     C     WSGFT2        COMP      *BLANKS                                66
     C   66              MOVE      'YBC0838'     MSGNR
     C   66              SETON                                        30
      *
     C     WSGKD         IFEQ      0                                             2<-B
     C     WSGKD         OREQ      1
     C     WSGKD         OREQ      2
     C     WSGKD         OREQ      4
     C     WSGKD         OREQ      9
     C     WSGADK        ORNE      *BLANKS
     C                   MOVE      '105'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSGADK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           65
     C   65
     CANN30              MOVE      'YBC0811'     MSGNR
     C   65              SETON                                        30
     C                   END                                                     2<-E
      *
     C                   ELSE                                                   1
      *
     C                   IF        ((WSGKD = 2) OR (WSGKD = 4))                  2<-B
     C     WSGADK        COMP      *BLANKS                                65
     C   65
     CANN30              MOVE      'YBC0811'     MSGNR
     C   65              MOVE      '1'           *IN30
     C                   ELSE                                                    2
     C                   MOVE      *BLANKS       WSGFT2
     C     WSGFT1        CHAIN(N)  TRUGH                              50
     C  N50TGST          COMP      'S'                                    50
     C  N50              IF        TGGTY >= 6                                     3<-B
     C                   Z-ADD     0             XSGBL2           11 0
     C                   EVAL      XSGBL2 = TGGBL - TGGBLB + XSGBL - WSGBL
     C     XSGBL2        COMP      0                                    50
     C                   END                                                      3<-E
     C                   IF        *IN50                                          3<-B
     C  N30              MOVE      'YBC1900'     MSGNR
     C  N30              SETON                                        30
     C                   ELSE                                                     3
     C                   MOVE      TGGTY         WSGKD
     C                   EVAL      XGGBLR = TGGBL - TGGBLB + XSGBL
     C                   MOVE      TGGVK         WSGVK
     C                   IF        ((WSGADK <> TGAKNY) OR (WSGADK = *BLANKS))      4<-B
     C     TRUGDK        CHAIN     TRUGD                              65
     C   65
     CANN30              MOVE      'YBC0811'     MSGNR
     C   65              MOVE      '1'           *IN30
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C     WSGBGU        IFEQ      *BLANKS
     C     TRHK          SETLL     TRUHGB
     C     TRHK          READE     TRUHGB                                 33
     C     *IN33         IFEQ      '0'
     C  N30              MOVE      'YBC0822'     MSGNR
     C                   MOVE      '1'           *IN66
     C                   SETON                                        30
     C                   END
     C                   ELSE
     C                   MOVE      WSGBGU        KS2LK
     C     KODS2K        CHAIN     KOS2R                              64
     C   64
     CANN30              MOVE      'SPL0001'     MSGNR
     C   64              SETON                                        30
     C                   END
      *
     C                   IF        ((WSGBL > XGGBLR) AND (XGGBLR <> 0))
     C  N30              MOVE      'YBC1902'     MSGNR
     C                   MOVE      '1'           *IN49
     C                   MOVE      '1'           *IN30
     C                   END
      *
     C     WSGVK         CHAIN     KODTVAL2                           48
     C   48
     CANN30              MOVE      'SPV0001'     MSGNR
     C   48              MOVE      '1'           *IN30
      *
     C                   END
      *
N01  C                   IF        WSTSB = *BLANKS
N01  C     SYPARL1K      CHAIN     SYPARL1                            33
N01  C  N33              EVAL      WSTSB = SYVRDA
N01  C                   END
     C                   MOVE      '106'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTSB         YKODE
     C     TRK01K        CHAIN     TRKODL01                           63
N03  C  N63TKANK         COMP      'J'                                6363
     C   63
     CANN30              MOVE      'YBC1768'     MSGNR
     C   63              SETON                                        30
      *
     C     WSDKR         IFNE      *BLANKS
     C     WSDDT         ORNE      0
     C     WSENKL        OREQ      'J'                                          FORENKLET PROS.
     C                   MOVE      '047'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSDKR         YKODE
     C     TRK01K        CHAIN     TRKODL01                           61
     C   61
     CANN30              MOVE      'YBC0854'     MSGNR
N26  C  N61              IF        WSENKL = 'N' AND WSDKR = 'A3'
N26  C                   EVAL      *IN61 = *ON
N26  C                   EVAL      MSGNR = 'YBC2032'
N26  C                   END
     C   61              SETON                                        30
      *
     C     WSDDT         IFEQ      0
     C                   MOVE      *ZEROS        UINNDT            6 0
N11  C                   IF        XANTDG = 0
     C                   Z-ADD     8             UANTDG            3 0
N11  C                   ELSE
N11  C                   Z-ADD     XANTDG        UANTDG
N11  C                   END
     C                   CALL      'SYFA20B'
     C                   PARM                    UINNDT
     C                   PARM                    UANTDG
     C     WSDDT         PARM                    UUTDT             6 0
N13  C                   PARM                    UFLAGG            1 0
     C                   END
      *
     C                   CALL      'TESTDATO'
     C                   PARM      WSDDTD        UDD               2 0
     C                   PARM      WSDDTM        UMM               2 0
     C                   PARM      WSDDTÅ        UÅÅ               2 0
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      60
     C   60
     CANN30              MOVE      'SPD0001'     MSGNR
     C   60              SETON                                        30
     C                   END
      *
     C     WSDFSK        IFNE      *BLANKS
      * KREVES HVIS DET ER SENSITIVE VARER. DET ER IKKE MULIG PÅ NÅVARENDE TIDPUNKT.
     C     WSDFKD        COMP      *BLANKS                                59
     C   59
     CANN30              MOVE      'YBC0839'     MSGNR
     C   59              SETON                                        30
     C                   END
      *
     C     WSDFSK        IFNE      *BLANKS
      * KREVES HVIS DET ER SENSITIVE VARER. DET ER IKKE MULIG PÅ NÅVARENDE TIDPUNKT.
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSDFSK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           58
     C   58
     CANN30              MOVE      'YBC0810'     MSGNR
     C   58              SETON                                        30
     C                   END
      *
     C  N59
     CANN58WSDFSK        IFEQ      *BLANKS
     C     WSDFKD        ANDEQ     *BLANKS
     C     WSDANT        IFGT      0
     C  N30              MOVE      'YBC0820'     MSGNR
     C                   SETON                                        3059
     C                   END
     C                   ELSE
     C     WSDANT        IFEQ      0
     C                   Z-ADD     1             WSDANT
     C                   END
     C                   END
      *
     C     WSTRDT        IFNE      0
     C                   CALL      'TESTDATO'
     C                   PARM      WSTDTD        UDD
     C                   PARM      WSTDTM        UMM
     C                   PARM      WSTDTÅ        UÅÅ
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      57
     C   57
     CANN30              MOVE      'SPD0001'     MSGNR
     C   57              SETON                                        30
     C                   END
N29   *
N29  C  N30              IF        WSDK = 'ENTRY' OR WSDK = 'EXIT'
N29  C                   IF        WSCATS <> WSTSD1 OR WSCATS <> WSTSB
N29  C                   EVAL      *IN78 = *ON
N29  C                   EVAL      *IN74 = *ON
N29  C                   EVAL      *IN63 = *ON
N29  C                   EVAL      *IN30 = *ON
N29  C                   EVAL      MSGNR = 'YBC2120'
N29  C                   END
N29  C                   END
      *
     C   30              EXSR      SETCUR
      *
     C                   ENDSR
      *
     C***********************************************
     C     SETCUR        BEGSR
     C***********************************************
     C   57              Z-ADD     22            LINNBR
     C   57              Z-ADD     72            POSNBR
     C   58              Z-ADD     21            LINNBR
     C   58              Z-ADD     78            POSNBR
     C   59              Z-ADD     21            LINNBR
     C   59              Z-ADD     57            POSNBR
     C   60              Z-ADD     21            LINNBR
     C   60              Z-ADD     22            POSNBR
     C   61              Z-ADD     21            LINNBR
     C   61              Z-ADD     13            POSNBR
     C   63              Z-ADD     20            LINNBR
     C   63              Z-ADD     67            POSNBR
     C   48              Z-ADD     20            LINNBR
     C   48              Z-ADD     35            POSNBR
     C   49              Z-ADD     20            LINNBR
     C   49              Z-ADD     15            POSNBR
     C   64              Z-ADD     19            LINNBR
     C   64              Z-ADD     76            POSNBR
     C   65              Z-ADD     19            LINNBR
     C   65              Z-ADD     69            POSNBR
     C   66              Z-ADD     19            LINNBR
     C   66              Z-ADD     33            POSNBR
     C   50              Z-ADD     19            LINNBR
     C   50              Z-ADD     8             POSNBR
     C   67              Z-ADD     18            LINNBR
     C   67              Z-ADD     69            POSNBR
     C   68              Z-ADD     18            LINNBR
     C   68              Z-ADD     60            POSNBR
     C   69              Z-ADD     18            LINNBR
     C   69              Z-ADD     51            POSNBR
     C   70              Z-ADD     18            LINNBR
     C   70              Z-ADD     42            POSNBR
     C   71              Z-ADD     18            LINNBR
     C   71              Z-ADD     33            POSNBR
     C   72              Z-ADD     18            LINNBR
     C   72              Z-ADD     24            POSNBR
     C   73              Z-ADD     18            LINNBR
     C   73              Z-ADD     15            POSNBR
     C   74              Z-ADD     18            LINNBR
     C   74              Z-ADD     6             POSNBR
     C   62              Z-ADD     17            LINNBR
     C   62              Z-ADD     77            POSNBR
N10  C   43              Z-ADD     17            LINNBR
N10  C   43              Z-ADD     50            POSNBR
     C   75              Z-ADD     17            LINNBR
     C   75              Z-ADD     32            POSNBR
     C   76              Z-ADD     17            LINNBR
     C   76              Z-ADD     12            POSNBR
     C   77              Z-ADD     15            LINNBR
     C   77              Z-ADD     63            POSNBR
     C   78              Z-ADD     14            LINNBR
     C   78              Z-ADD     57            POSNBR
     C   47              Z-ADD     13            LINNBR
     C   47              Z-ADD     53            POSNBR
     C   79              Z-ADD     14            LINNBR
     C   79              Z-ADD     2             POSNBR
     C   80              Z-ADD     13            LINNBR
     C   80              Z-ADD     22            POSNBR
     C   82              Z-ADD     12            LINNBR
     C   82              Z-ADD     51            POSNBR
     C   83              Z-ADD     12            LINNBR
     C   83              Z-ADD     32            POSNBR
     C   84              Z-ADD     12            LINNBR
     C   84              Z-ADD     12            POSNBR
     C   85              Z-ADD     11            LINNBR
     C   85              Z-ADD     74            POSNBR
     C   86              Z-ADD     11            LINNBR
     C   86              Z-ADD     71            POSNBR
     C   54              Z-ADD     11            LINNBR
     C   54              Z-ADD     43            POSNBR
     C   51              Z-ADD     11            LINNBR
     C   51              Z-ADD     12            POSNBR
     C   52              Z-ADD     11            LINNBR
     C   52              Z-ADD     2             POSNBR
     C   53              Z-ADD     10            LINNBR
     C   53              Z-ADD     2             POSNBR
     C   87              Z-ADD     9             LINNBR
     C   87              Z-ADD     2             POSNBR
     C   88              Z-ADD     8             LINNBR
     C   88              Z-ADD     74            POSNBR
     C   89              Z-ADD     8             LINNBR
     C   89              Z-ADD     71            POSNBR
     C   56              Z-ADD     8             LINNBR
     C   56              Z-ADD     43            POSNBR
N14  C   42              Z-ADD     8             LINNBR
N14  C   42              Z-ADD     22            POSNBR
     C   91              Z-ADD     7             LINNBR
     C   91              Z-ADD     32            POSNBR
     C   92              Z-ADD     7             LINNBR
     C   92              Z-ADD     12            POSNBR
     C   93              Z-ADD     6             LINNBR
     C   93              Z-ADD     56            POSNBR
N10  C   45              Z-ADD     6             LINNBR
N10  C   45              Z-ADD     12            POSNBR
N10  C   46              Z-ADD     6             LINNBR
N10  C   46              Z-ADD     2             POSNBR
     C   94              Z-ADD     5             LINNBR
     C   94              Z-ADD     56            POSNBR
     C   95              Z-ADD     4             LINNBR
     C   95              Z-ADD     2             POSNBR
     C   96              Z-ADD     3             LINNBR
     C   96              Z-ADD     22            POSNBR
     C   55              Z-ADD     2             LINNBR
     C   55              Z-ADD     26            POSNBR
     C   98              Z-ADD     2             LINNBR
     C   98              Z-ADD     10            POSNBR
     C   99              Z-ADD     1             LINNBR
     C   99              Z-ADD     72            POSNBR
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVW2         BEGSR
     C***********************************************
N02  C                   IF        WSSOK = *BLANKS
N02  C                   EVAL      WSSOK = WSEXTR
N02  C                   END
     C                   MOVE      THDTD         WSDTD
     C                   MOVE      THDTM         WSDTM
     C                   MOVE      THDTÅ         WSDTÅ
     C     WSTDN         IFEQ      0
     C                   MOVE      UPRO2         WSPRO
     C                   MOVE      *ZEROS        WSDDTK
     C                   MOVE      *BLANKS       WSDATS
S02  C*                  MOVE      *BLANKS       WSDKAV
S02  C*                  MOVE      *BLANKS       WSDKSK
     C                   ELSE
     C                   MOVE      THPRO         WSPRO
     C                   MOVE      THDDKD        WSDDKD
     C                   MOVE      THDDKM        WSDDKM
     C                   MOVE      THDDKÅ        WSDDKÅ
     C                   MOVE      THDATS        WSDATS
S02  C*                  MOVE      THDKAV        WSDKAV
S02  C*                  MOVE      THDKSK        WSDKSK
     C                   END
     C                   MOVE      THDK          WSDK
     C                   MOVE      THKNA         WSKNA
     C                   MOVE      THNAA         WSNAA
     C                   MOVE      THADA1        WSADA1
     C                   MOVE      THPNA         WSPNA
     C                   MOVE      THPSA         WSPSA
     C                   MOVE      THLKA         WSLKA
     C                   MOVE      THSKA         WSSKA
     C                   MOVE      THTINA        WSTINA
     C                   MOVE      THKNS         WSKNS
     C                   MOVE      THNAS         WSNAS
     C                   MOVE      THADS1        WSADS1
     C                   MOVE      THPNS         WSPNS
     C                   MOVE      THPSS         WSPSS
     C                   MOVE      THLKS         WSLKS
     C                   MOVE      THSKS         WSSKS
     C                   MOVE      THTINS        WSTINS
     C                   MOVE      THKNK         WSKNK
     C                   MOVE      THNAK         WSNAK
     C                   MOVE      THADK1        WSADK1
     C                   MOVE      THPNK         WSPNK
     C                   MOVE      THPSK         WSPSK
     C                   MOVE      THLKK         WSLKK
     C                   MOVE      THSKK         WSSKK
     C                   MOVE      THTINK        WSTINK
     C                   MOVE      THBLK         WSBLK
     C                   MOVE      THLSD         WSLSD
     C                   MOVE      THALK         WSALK
     C                   MOVE      THTRM         WSTRM
     C                   MOVE      THTAID        WSTAID
     C                   MOVE      THTASK        WSTASK
     C                   MOVE      THTALK        WSTALK
     C                   MOVE      THTGID        WSTGID
     C                   MOVE      THTGSK        WSTGSK
     C                   MOVE      THTGLK        WSTGLK
     C                   MOVE      THSKFD        WSSKFD
     C                   MOVE      THCATS        WSCATS
     C                   MOVE      THTSD1        WSTSD1
     C                   MOVE      THTSD2        WSTSD2
     C                   MOVE      THTSD3        WSTSD3
     C                   MOVE      THTSD4        WSTSD4
     C                   MOVE      THTSD5        WSTSD5
     C                   MOVE      THTSD6        WSTSD6
     C                   MOVE      THTSD7        WSTSD7
     C                   MOVE      THTSD8        WSTSD8
     C                   MOVE      THTSB         WSTSB
     C                   MOVE      THDDTD        WSDDTD
     C                   MOVE      THDDTM        WSDDTM
     C                   MOVE      THDDTÅ        WSDDTÅ
     C                   MOVE      THDFKD        WSDFKD
     C                   MOVE      THDFSK        WSDFSK
     C                   MOVE      THDKR         WSDKR
     C                   MOVE      THDANT        WSDANT
     C                   MOVE      THGKD         WSGKD
     C                   MOVE      THGFT1        WSGFT1
     C                   IF        THGBL < 0
     C                   Z-SUB     THGBL         WSGBL
     C                   MOVE      *ZEROS        XSGBL            11 0
     C                   ELSE
     C                   MOVE      THGBL         WSGBL
     C                   MOVE      THGBL         XSGBL            11 0
     C                   END
     C                   MOVE      THGVK         WSGVK
     C                   MOVE      THGFT2        WSGFT2
     C                   MOVE      THGADK        WSGADK
     C                   MOVE      THGBGI        WSGBGI
     C                   MOVE      THGBGU        WSGBGU
     C                   MOVE      THKDC         WSKDC
     C                   MOVEL     THTSN1        WSTSN1
     C                   MOVEL     THTSN2        WSTSN2
     C                   MOVE      THLSTL        WSLSTL
     C                   MOVE      THVPOS        WSVPOS
     C                   MOVE      THNTK         WSNTK
     C                   MOVE      THVKB         WSVKB
     C                   MOVE      THDST         WSDST
     C                   MOVE      THDSK         WSDSK
     C     KODSIK        CHAIN     KOSIR                              33
     C                   MOVE      KSINAV        WSTARF
     C                   MOVE      THTRNR        WSTRNR
     C                   MOVE      THTDTD        WSTDTD
     C                   MOVE      THTDTM        WSTDTM
     C                   MOVE      THTDTÅ        WSTDTÅ
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVTRH        BEGSR
     C***********************************************
     C                   MOVE      UAVD          THAVD
     C                   MOVE      WSTDN         THTDN
     C                   MOVE      WSSG          THSG
     C                   MOVE      WSENKL        THENKL
     C                   MOVE      WSPRO         THPRO
     C     WSDDTK        IFEQ      0
     C                   MOVE      *ZEROS        THDDTK
     C                   ELSE
     C                   MOVE      WSDDKD        THDDKD
     C                   MOVE      WSDDKM        THDDKM
     C     WSDDKÅ        ADD       2000          THDDKÅ
     C                   END
     C                   MOVE      WSDK          THDK
     C                   MOVE      WSKNA         THKNA
     C                   MOVE      WSNAA         THNAA
     C                   IF        WSADA1 = *BLANKS
     C                   EVAL      THADA1 = '.'
     C                   ELSE
     C                   MOVE      WSADA1        THADA1
     C                   END
     C                   MOVE      WSPNA         THPNA
     C                   MOVE      WSPSA         THPSA
     C                   MOVE      WSLKA         THLKA
     C                   MOVE      WSSKA         THSKA
     C                   MOVE      WSTINA        THTINA
     C                   MOVE      WSKNS         THKNS
     C                   MOVE      WSNAS         THNAS
     C                   IF        WSADS1 = *BLANKS
     C                   EVAL      THADS1 = '.'
     C                   ELSE
     C                   MOVE      WSADS1        THADS1
     C                   END
     C                   MOVE      WSPNS         THPNS
     C                   MOVE      WSPSS         THPSS
     C                   MOVE      WSLKS         THLKS
     C                   MOVE      WSSKS         THSKS
     C                   MOVE      WSTINS        THTINS
     C                   MOVE      WSKNK         THKNK
     C                   MOVE      WSNAK         THNAK
     C                   IF        WSADK1 = *BLANKS
     C                   EVAL      THADK1 = '.'
     C                   ELSE
     C                   MOVE      WSADK1        THADK1
     C                   END
     C                   MOVE      WSPNK         THPNK
     C                   MOVE      WSPSK         THPSK
     C                   MOVE      WSLKK         THLKK
     C                   MOVE      WSSKK         THSKK
     C                   MOVE      WSTINK        THTINK
     C                   MOVE      WSBLK         THBLK
     C                   MOVE      WSLSD         THLSD
     C                   MOVE      WSALK         THALK
     C                   MOVE      WSTRM         THTRM
     C                   MOVE      WSTAID        THTAID
     C                   MOVE      WSTASK        THTASK
     C                   MOVE      WSTALK        THTALK
     C                   MOVE      WSTGID        THTGID
     C                   MOVE      WSTGSK        THTGSK
     C                   MOVE      WSTGLK        THTGLK
     C                   MOVE      WSSKFD        THSKFD
     C                   MOVE      WSCATS        THCATS
     C                   MOVE      WSTSD1        THTSD1
     C                   MOVE      WSTSD2        THTSD2
     C                   MOVE      WSTSD3        THTSD3
     C                   MOVE      WSTSD4        THTSD4
     C                   MOVE      WSTSD5        THTSD5
     C                   MOVE      WSTSD6        THTSD6
     C                   MOVE      WSTSD7        THTSD7
     C                   MOVE      WSTSD8        THTSD8
     C                   MOVE      WSTSB         THTSB
     C     WSENKL        IFEQ      'J'
     C     WSTRNR        ORNE      *BLANKS
     C     WSDDT         IFEQ      0
     C                   MOVE      *ZEROS        THDDT
     C                   ELSE
     C                   MOVE      WSDDTD        THDDTD
     C                   MOVE      WSDDTM        THDDTM
     C     WSDDTÅ        ADD       2000          THDDTÅ
     C                   END
     C                   MOVE      WSDFKD        THDFKD
     C                   MOVE      WSDFSK        THDFSK
     C                   MOVE      WSDKR         THDKR
     C                   MOVE      WSDANT        THDANT
     C                   ELSE
     C                   MOVE      *ZEROS        THDDT
     C                   MOVE      *BLANKS       THDFKD
     C                   MOVE      *BLANKS       THDFSK
     C                   MOVE      *BLANKS       THDKR
     C                   MOVE      *ZEROS        THDANT
     C                   END
      * OPPDATER TOTAL PÅ GAMMEL GARANTI
     C  N33              IF        ((THGFT1 <> *BLANKS) AND
     C                             ((THGKD <= 1) OR
     C                               (THGKD >= 6)))
     C     THGFT1        CHAIN     TRUGH                              30
     C  N30              EVAL      TGGBLB = TGGBLB - THGBL
     C  N30              UPDATE    TRUGHR
     C  N30              MOVE      THGBL         XSGBL            11 0
     C                   MOVE      '0'           *IN30
     C                   END
      * OPPDATER TOTAL PÅ NY GARANTI
     C                   IF        ((WSGFT1 <> *BLANKS) AND
     C                             ((WSGKD <= 1) OR
     C                               (WSGKD >= 6)))
     C     WSGFT1        CHAIN     TRUGH                              30
     C                   IF        *IN30 = *OFF
     C                   EVAL      TGGBLB = TGGBLB + WSGBL
     C                   UPDATE    TRUGHR
     C                   MOVE      THGBL         XSGBL            11 0
     C                   IF        TGGBLB > TGGBL
     C                   Z-ADD     100           XPRM
     C                   ELSE
     C     TGGBLB        DIV       TGGBL         XPRM              5 2
     C                   MULT      100           XPRM
     C                   END
     C                   IF        ((XPRM > TGPRM) AND (TGPRM <> 0))
     C                   EXFMT     TR011D03
     C                   END
     C                   END
     C                   MOVE      '0'           *IN30
     C                   END
      *
     C                   MOVE      WSGBL         THGBL
     C                   MOVE      WSGVK         THGVK
     C                   MOVE      WSGKD         THGKD
     C                   MOVE      WSGFT1        THGFT1
     C                   MOVE      WSGFT2        THGFT2
     C                   MOVE      WSGADK        THGADK
     C                   MOVE      WSGBGI        THGBGI
     C                   MOVE      WSGBGU        THGBGU
     C                   MOVE      WSKDC         THKDC
     C                   MOVEL     WSTSN1        THTSN1
     C                   MOVEL     WSTSN2        THTSN2
     C                   MOVE      WSLSTL        THLSTL
     C                   MOVE      WSVPOS        THVPOS
     C                   MOVE      WSNTK         THNTK
     C                   MOVE      WSVKB         THVKB
     C                   MOVE      WSDST         THDST
     C                   MOVE      WSDSK         THDSK
     C                   MOVE      WSTARF        THTARF
     C                   MOVE      UWS           THWS
     C                   MOVE      WSTRNR        THTRNR
     C     WSTRDT        IFEQ      *ZEROS
     C                   MOVE      *ZEROS        THTRDT
     C                   ELSE
     C                   MOVE      WSTDTD        THTDTD
     C                   MOVE      WSTDTM        THTDTM
     C     WSTDTÅ        ADD       2000          THTDTÅ
     C                   END
     C                   MOVE      *BLANKS       THMF
     C                   MOVE      *ZEROS        THMP
     C                   MOVE      *BLANKS       THPKL
     C                   MOVE      *BLANKS       TH0035
      *
     C                   ENDSR
      *
     C***********************************************
     C     OPDTRH        BEGSR
     C***********************************************
     C     WSTDN         IFEQ      0
     C     UAVD          CHAIN     TRUSTD                             33
     C                   MOVE      THTDN         WSTDN
     C                   ADD       1             THTDN
     C                   UPDATE    TRUSTDR
     C                   END
      *
     C     TRHK          CHAIN     TRUH                               33
     C                   EXSR      MOVTRH
      *
     C                   MOVE      'E'           THST
     C   33              DO
     C                   MOVE      UAVD          THAVD
     C                   MOVE      WSTDN         THTDN
     C                   MOVE      WSSG          THSG
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           THDT
     C                   MOVE      THDTD         WSDTD
     C                   MOVE      THDTM         WSDTM
     C                   MOVE      THDTÅ         WSDTÅ
     C     UTYPE         IFEQ      'CPY'
     C     KAVD          ANDNE     0
     C                   EXSR      CPYTRV
     C                   MOVE      *ZEROS        KAVD
     C                   END
     C                   Z-ADD     1             THTET
     C                   WRITE     TRUHR
N05  C     WSEXTR        IFNE      *BLANKS
N05  C                   MOVE      THAVD         TRXAVD
N05  C                   MOVE      THTDN         TRXOPD
N05  C                   MOVE      *ZEROS        TRXLI
N05  C                   MOVEl     WSEXTR        TRXEXT
N05  C                   WRITE     TRXREFR
N05  C                   END
N02   *
N02   * OPPDATER Z-FIL
N02   *
N02  C                   IF        ((Z_THREFF<>*BLANKS) AND (Z_THUNIK <> 0))     2<-B
N02  C     ZTRUHK        CHAIN     ZTRUHL01                           33
N02  C                   IF        *IN33 = *OFF                                   3<-B
N02  C                   MOVE      'O'           Z_THST
N02  C                   MOVE      THAVD         Z_THAVD
N02  C                   MOVE      THTDN         Z_THTDN
N02  C                   MOVE      THDT          Z_THDT
N02  C                   UPDATE    ZTRUHR
N02  C                   END                                                      3<-E
N02  C                   MOVE      '1'           *IN33
N02  C                   END                                                     2<-E
      *
     C                   END
     C  N33              UPDATE    TRUHR
      *
     C     WSLSTL        IFEQ      0
     C     TRHK          SETLL     TRUHL
     C     TRHK          READE     TRUHL                                  33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    TRUHLR
     C     TRHK          READE     TRUHL                                  33
     C  N33              END
     C                   END
N02   *
N02   * FOR DE SOM REGISTRERER EGEN REF
N02   *
s06  C*                  IF        ((THEKST = 'R') AND (WSEXTR <> 'WSSOK'))
N06  C                   IF        ((THEKST = 'R') OR (EXTMAN = 'M'))
s06  C*                  IF        (WSEXTR <> 'WSSOK')
n06  C                   IF        (WSSOK <> *BLANKS)
N02  C     FRISOKK2      CHAIN     FRISOK                             33
N02  C                   EVAL      FSSOK = WSSOK
N02  C                   IF        *IN33
N06  C                   EVAL      FSKODE  = '*CN'
N02  C                   EVAL      FSAVD  = THAVD
N02  C                   EVAL      FSOPD  = THTDN
N02  C                   EVAL      FSKODE = WSKODE
N02  C                   EVAL      FSSOK  = WSSOK
N02  C                   EVAL      FSDTOP = THDT
N02  C                   WRITE     FRISOKR
N02  C                   ELSE
N02  C                   EVAL      WSSOK  = WSEXTR
N02  C                   END
N02  C                   END
N06  C                   END
      *
     C   15              EXSR      TILKOD
      *
     C                   ENDSR
      *
     C***********************************************
     C     CPYTRV        BEGSR
     C***********************************************
     C     TRHKK         CHAIN     TRUHFV                             33
     C                   IF        *IN33 = *OFF
     C                   MOVE      THAVD         FV_THAVD
     C                   MOVE      THTDN         FV_THTDN
     C                   WRITE     TRUHFVR
     C                   END
      *
     C     TRHK          SETLL     TRUHFS
     C     TRHK          READE     TRUHFS                                 33
     C     *IN33         IFEQ      '1'
     C     TRHKK         SETLL     TRUHFS
     C     TRHKK         READE     TRUHFS                                 33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      THAVD         TFAVD
     C                   MOVE      THTDN         TFTDN
     C                   WRITE     TRUHFSR
     C     TRHKK         READE     TRUHFS                                 33
     C  N33              ENDDO
     C                   END
      *
     C     TRHK          SETLL     TRUHL
     C     TRHK          READE(N)  TRUHL                                  33
     C     *IN33         IFEQ      '1'
     C     TRHKK         SETLL     TRUHL
     C     TRHKK         READE(N)  TRUHL                                  33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      THAVD         TLAVD
     C                   MOVE      THTDN         TLTDN
     C                   WRITE     TRUHLR
     C     TRHKK         READE(N)  TRUHL                                  33
     C  N33              ENDDO
     C                   END
      *
     C     TRHK          SETLL     TRUHGB
     C     TRHK          READE     TRUHGB                                 33
     C     *IN33         IFEQ      '1'
     C     TRHKK         SETLL     TRUHGB
     C     TRHKK         READE     TRUHGB                                 33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      THAVD         TGAVD
     C                   MOVE      THTDN         TGTDN
     C                   WRITE     TRUHGBR
     C     TRHKK         READE     TRUHGB                                 33
     C  N33              ENDDO
     C                   END
      *
     C     TRHK          SETLL     TRUHGN
     C     TRHK          READE     TRUHGN                                 33
     C     *IN33         IFEQ      '1'
     C     TRHKK         SETLL     TRUHGN
     C     TRHKK         READE     TRUHGN                                 33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      THAVD         TGAVD
     C                   MOVE      THTDN         TGTDN
     C                   WRITE     TRUHGNR
     C     TRHKK         READE     TRUHGN                                 33
     C  N33              ENDDO
     C                   END
      *
     C     TRHKK         SETLL     TRUV
     C     TRHKK         READE     TRUV                                   33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      THAVD         TVAVD
     C                   MOVE      THTDN         TVTDN
     C                   WRITE     TRUVR
     C     TRHKK         READE     TRUV                                   33
     C  N33              ENDDO
      *
     C     TRHKK         SETLL     TRUVFV
     C     TRHKK         READE     TRUVFV                                 33
     C                   DOW       *IN33 = *OFF
     C                   MOVE      THAVD         FV_TVAVD
     C                   MOVE      THTDN         FV_TVTDN
     C                   WRITE     TRUVFVR
     C     TRHKK         READE     TRUVFV                                 33
     C                   ENDDO
      *
     C     TRHKK         SETLL     TRUVAM
     C     TRHKK         READE     TRUVAM                                 33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      THAVD         TVAVD
     C                   MOVE      THTDN         TVTDN
     C                   WRITE     TRUVAMR
     C     TRHKK         READE     TRUVAM                                 33
     C  N33              ENDDO
      *
     C     TRHKK         SETLL     TRUVCN
     C     TRHKK         READE     TRUVCN                                 33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      THAVD         TVAVD
     C                   MOVE      THTDN         TVTDN
     C                   WRITE     TRUVCNR
     C     TRHKK         READE     TRUVCN                                 33
     C  N33              ENDDO
      *
     C     TRHKK         SETLL     TRUVDK
     C     TRHKK         READE     TRUVDK                                 33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      THAVD         TVAVD
     C                   MOVE      THTDN         TVTDN
     C                   WRITE     TRUVDKR
     C     TRHKK         READE     TRUVDK                                 33
     C  N33              ENDDO
      *
     C     TRHKK         SETLL     TRUVFS
     C     TRHKK         READE     TRUVFS                                 33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      THAVD         TVAVD
     C                   MOVE      THTDN         TVTDN
     C                   WRITE     TRUVFSR
     C     TRHKK         READE     TRUVFS                                 33
     C  N33              ENDDO
      *
     C     TRHKK         SETLL     TRUVMN
     C     TRHKK         READE     TRUVMN                                 33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      THAVD         TVAVD
     C                   MOVE      THTDN         TVTDN
     C                   WRITE     TRUVMNR
     C     TRHKK         READE     TRUVMN                                 33
     C  N33              ENDDO
      *
     C     TRHKK         SETLL     TRUVTD
     C     TRHKK         READE     TRUVTD                                 33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      THAVD         TVAVD
     C                   MOVE      THTDN         TVTDN
     C                   WRITE     TRUVTDR
     C     TRHKK         READE     TRUVTD                                 33
     C  N33              ENDDO
      *
     C     TRHKK         SETLL     TRUVVT
     C     TRHKK         READE     TRUVVT                                 33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      THAVD         TVAVD
     C                   MOVE      THTDN         TVTDN
     C                   WRITE     TRUVVTR
     C     TRHKK         READE     TRUVVT                                 33
     C  N33              ENDDO
      *
     C                   ENDSR
      *
     C***********************************************
     C     TOTRV         BEGSR
     C***********************************************
      *
     C                   MOVE      *IN34         UIN34
     C                   MOVE      *IN27         UIN27
N02  C                   MOVE      UZREFF        U2REFF
N02  C                   MOVE      UZUNIK        U2UNIK
     C                   CALL      'TR012R'
     C     UPARM2        PARM      UPARM2        UPARM1          128
     C                   PARM                    UFLAGG            1 0
      *
     C     *IN27         IFEQ      '0'
     C                   MOVE      *ZEROS        WSVPOS
     C                   MOVE      *ZEROS        WSVKB
     C                   MOVE      *ZEROS        WSNTK
     C     TRHK          SETLL     TRUV
     C     TRHK          READE     TRUV                                   33
     C     *IN33         DOWEQ     '0'
     C                   ADD       1             WSVPOS
     C                   ADD       TVVKTB        WSVKB
     C     TVNT          IFEQ      0
     C                   ADD       TVNTEH        WSNTK
     C                   ELSE
     C                   ADD       TVNT          WSNTK
     C                   END
     C     TVEH          IFEQ      'VQ'
     C     TVEH          OREQ      'VG'
     C     TVEH          OREQ      'VL'
     C     TVEH          OREQ      'VY'
     C     TVEH          OREQ      'VR'
     C     TVEH          OREQ      'VO'
N16  C     TVEH          OREQ      'VS'
     C                   ADD       1             WSNTK
     C                   END
     C     TRHK          READE     TRUV                                   33
     C  N33              ENDDO
     C*                    ADD  WSNTB     WSNTK
     C     TRHK          CHAIN     TRUH                               33
     C                   MOVE      WSPRO         THPRO
     C     WSLSTL        IFNE      0
     C                   MOVE      *ZEROS        WSVPOS
     C     TRHK          SETLL     TRUHL
     C     TRHK          READE     TRUHL                                  33
     C     *IN33         DOWEQ     '0'
     C                   ADD       1             WSVPOS
     C     TRHK          READE     TRUHL                                  33
     C  N33              ENDDO
     C                   END
     C                   MOVE      WSVPOS        THVPOS
     C                   MOVE      WSVKB         THVKB
     C                   MOVE      WSNTK         THNTK
     C                   UPDATE    TRUHR
     C                   END
      *
     C     UFLAGG        COMP      1                                      12
     C     UFLAGG        COMP      2                                      17
     C     UFLAGG        COMP      3                                      03
      *
     C                   ENDSR
      *
     C***********************************************
     C     VISTOL        BEGSR
     C***********************************************
      *________________________
      * Call på eksternt CL-pgm
      *""""""""""""""""""""""""
     C                   MOVE      '2'           WIN03             1
     C                   CALL      'SAD003'
     C                   PARM      THAVD         UAVD
     C                   PARM      THTDN         UTDN
     C                   PARM                    WIN03
      *
     C                   ENDSR
      *
     C***********************************************
     C     TESTSS        BEGSR
     C***********************************************
     C                   MOVE      WSKNS         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            97
     C     *IN97         IFEQ      '1'                                          1<-B
     C  N30              MOVE      'SPK0001'     MSGNR
     C  N30              Z-ADD     3             LINNBR
     C  N30              Z-ADD     13            POSNBR
     C                   SETON                                        30
     C                   ELSE                                                   1
      * ikke flytt hvis vareadresse plukket
n19  c                   move      wspss         punkt             1
n19  c     punkt         ifne      '.'
     C                   MOVE      KNAVN         WSNAS
     C                   MOVE      ADR1          WSADS1
     C     SYPOGE        IFEQ      *BLANKS                                       2<-B
     C                   MOVE      *BLANKS       WSPNS
     C                   MOVEL     POSTNR        WSPNS
     C                   ELSE                                                    2
     C                   MOVEL     SYPOGE        WSPNS
     C                   END                                                     2<-E
     C                   MOVE      ADR3          WSPSS
n19  c                   end
     C     SYLAND        IFNE      *BLANKS                                       2<-B
     C                   MOVE      SYLAND        WSLKS
     C                   END                                                     2<-E
     C     WSTINS        IFEQ      *BLANKS                                       2<-B
     C                   SELECT                                                   3<-B
S14  C*                  WHEN      PTFDT > XIDAG                                  3
S14  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))    4<-B
S14  C*                  MOVEL     SYFOR9        WSTINS
S14  C*                  END                                                       4<-E
     C                   WHEN      EORI = *BLANKS                                 3
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))    4<-B
     C                   IF        WSLKS = *BLANKS                                  5<-B
     C                   EVAL      WSTINS = 'NO' + SYFOR9
     C                   ELSE                                                       5
     C                   EVAL      WSTINS = WSLKS + SYFOR9
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   OTHER                                                    3
     C                   EVAL      WSTINS = EORI
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
     C***********************************************
     C     TESTKK        BEGSR
     C***********************************************
     C                   MOVE      WSKNK         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            90
     C     *IN90         IFEQ      '1'                                          1<-B
     C  N30              MOVE      'SPK0001'     MSGNR
     C  N30              Z-ADD     8             LINNBR
     C  N30              Z-ADD     13            POSNBR
     C                   SETON                                        30
     C                   ELSE                                                   1
n19  c                   move      wspsk         punkt             1
n19  c     punkt         ifne      '.'
     C                   MOVE      KNAVN         WSNAK
     C                   MOVE      ADR1          WSADK1
     C     SYPOGE        IFEQ      *BLANKS                                       2<-B
     C                   MOVE      *BLANKS       WSPNK
     C                   MOVEL     POSTNR        WSPNK
     C                   ELSE                                                    2
     C                   MOVEL     SYPOGE        WSPNK
     C                   END                                                     2<-E
     C                   MOVE      ADR3          WSPSK
n19  c                   end
     C     SYLAND        IFNE      *BLANKS                                       2<-B
     C                   MOVE      SYLAND        WSLKK
     C                   END                                                     2<-E
     C     WSTINK        IFEQ      *BLANKS                                       2<-B
     C                   SELECT                                                   3<-B
S14  C*                  WHEN      PTFDT > XIDAG                                  3
S14  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))    4<-B
S14  C*                  MOVEL     SYFOR9        WSTINK
S14  C*                  END                                                       4<-E
     C                   WHEN      EORI = *BLANKS                                 3
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))    4<-B
     C                   IF        WSLKK = *BLANKS                                  5<-B
     C                   EVAL      WSTINK = 'NO' + SYFOR9
     C                   ELSE                                                       5
     C                   EVAL      WSTINK = WSLKK + SYFOR9
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   OTHER                                                    3
     C                   EVAL      WSTINK = EORI
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
     C***********************************************
     C     TESTAA        BEGSR
     C***********************************************
     C                   MOVE      WSKNA         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            81
     C     *IN81         IFEQ      '1'                                          1<-B
     C  N30              MOVE      'SPK0001'     MSGNR
     C  N30              Z-ADD     13            LINNBR
     C  N30              Z-ADD     13            POSNBR
     C                   SETON                                        30
     C                   ELSE                                                   1
     C                   MOVE      KNAVN         WSNAA
     C                   MOVE      ADR1          WSADA1
     C     SYPOGE        IFEQ      *BLANKS                                       2<-B
     C                   MOVE      *BLANKS       WSPNA
     C                   MOVEL     POSTNR        WSPNA
     C                   ELSE                                                    2
     C                   MOVEL     SYPOGE        WSPNA
     C                   END                                                     2<-E
     C                   MOVE      ADR3          WSPSA
     C     SYLAND        IFNE      *BLANKS                                       2<-B
     C                   MOVE      SYLAND        WSLKA
     C                   END                                                     2<-E
     C     WSTINA        IFEQ      *BLANKS                                       2<-B
     C                   SELECT                                                   3<-B
S14  C*                  WHEN      PTFDT > XIDAG                                  3
S14  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))    4<-B
S14  C*                  MOVEL     SYFOR9        WSTINA
S14  C*                  END                                                       4<-E
     C                   WHEN      EORI = *BLANKS                                 3
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))    4<-B
     C                   IF        WSLKA = *BLANKS                                  5<-B
     C                   EVAL      WSTINA = 'NO' + SYFOR9
     C                   ELSE                                                       5
     C                   EVAL      WSTINA = WSLKA + SYFOR9
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   OTHER                                                    3
     C                   EVAL      WSTINA = EORI
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
     C***********************************************
     C     SRU1          BEGSR
     C***********************************************
     C                   MOVE      UTDN          WSTDN
     C     TRHK          CHAIN     TRUH                               98
     C     *IN98         IFEQ      '0'
     C                   MOVE      'E'           THST
     C                   UPDATE    TRUHR
     C                   GOTO      SLSRU
     C                   END
      *
      * HENT STANDARDVERDIER FOR AVDELING
     C     TRSTDK        CHAIN(N)  TRUSTD                             98
     C  N98              MOVE      *BLANKS       THST
     C                   MOVE      *ZEROS        THGBL
N11  C                   MOVE      *ZEROS        THDDT
N27   * A3 = FORENKLET ER IKKE TILLATT VED NORMAL-PROSEDYRE
N27  C                   IF        WSENKL = 'N' AND THDKR = 'A3'
N27  C                   EVAL      THDKR = '  '
N27  C                   EVAL      THDDT = 0
N27  C                   ENDIF
      * HENT FRA OPPDRAG
     C                   CLEAR                   HEADFR
     C                   CLEAR                   SAEHR
     C     HEADFK        CHAIN     HEADF                              98
     C     HEADFK        CHAIN     SAEH                               33
N28  C   33              EVAL      SERG = *BLANKS
     C   98
     CANN33              MOVE      '0'           *IN98
     C                   MOVE      *ZEROS        WSTDN
      *
     C  N98WSSG          IFEQ      *BLANKS
     C                   MOVE      HESG          WSSG
     C                   END
     C     THTARF        IFEQ      *BLANKS
     C     KODSIK        CHAIN     KOSIR                              97
     C  N97              MOVE      KSINAV        THTARF
     C                   END
      *
      *** START N98
     C  N98              DO                                                     1<-B
      *
      *.................................................
      *** FLYTT DATA FRA HEADF TIL TRUH
      ** AVSENDER HENT NAVN/ADR FRA REGISTER - EVT FRA OPPDRAG
     C                   MOVE      HEKNS         THKNS
     C                   MOVE      HEKNS         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            97
     C   97              MOVE      'D'           DKUND
     C     DKUND         IFEQ      'D'                                           2<-B
     C                   MOVE      *ZEROS        THKNS
     C                   MOVE      HENAS         THNAS
     C                   MOVE      HEADS1        THADS1
     C                   MOVEL     HEADS3        THPNS
     C                   MOVEL     HEADS3        THPSS
N28  C                   IF        SERG <> *BLANKS
N28  C                   EVAL      THTINS = 'NO' + %TRIM(SERG)
N28  C                   END
     C                   ELSE                                                    2
     C                   MOVE      KNAVN         THNAS
     C                   MOVE      ADR1          THADS1
     C     SYPOGE        IFEQ      *BLANKS                                        3<-B
     C                   MOVE      *BLANKS       THPNS
     C                   MOVEL     POSTNR        THPNS
     C                   ELSE                                                     3
     C                   MOVEL     SYPOGE        THPNS
     C                   END                                                      3<-E
     C                   MOVE      ADR3          THPSS
     C     SYLAND        IFEQ      *BLANKS                                        3<-B
     C                   MOVE      FILAND        THLKS
     C                   ELSE                                                     3
     C                   MOVE      SYLAND        THLKS
     C                   END                                                      3<-E
     C                   MOVE      *BLANKS       WSTINS
     C                   SELECT                                                   3<-B
S14  C*                  WHEN      PTFDT > XIDAG                                  3
S14  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))    4<-B
S14  C*                  MOVEL     SYFOR9        WSTINS
S14  C*                  END                                                       4<-E
     C                   WHEN      EORI = *BLANKS                                 3<-B
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))    4<-B
     C                   IF        THLKS = *BLANKS                                  5<-B
     C                   EVAL      THTINS = 'NO' + SYFOR9
     C                   ELSE                                                       5
     C                   EVAL      THTINS = THLKS + SYFOR9
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   OTHER                                                    3
     C                   EVAL      THTINS = EORI
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C     HEUR          IFNE      'H'                                           2<-B
     C                   MOVE      HELKA         THBLK
     C                   ELSE                                                    2
     C                   MOVE      HETRI         THBLK
     C                   END                                                     2<-E
      *
      ** MOTTAKER HENT NAVN/ADR FRA REGISTER - EVT FRA OPPDRAG
     C                   MOVE      HEKNK         THKNK
     C                   MOVE      HEKNK         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            97
     C   97              MOVE      'D'           DKUND
     C     DKUND         IFEQ      'D'                                           2<-B
     C                   MOVE      *ZEROS        THKNK
     C                   MOVE      *BLANKS       THTINK
     C                   MOVE      HENAK         THNAK
     C                   MOVE      HEADK1        THADK1
     C                   MOVEL     HEADK3        THPNK
     C                   MOVEL     HEADK3        THPSK
     C                   MOVE      HELKK         THLKK
     C                   ELSE                                                    2
     C                   MOVE      KNAVN         THNAK
     C                   MOVE      ADR1          THADK1
     C     SYPOGE        IFEQ      *BLANKS                                        3<-B
     C                   MOVE      *BLANKS       THPNK
     C                   MOVEL     POSTNR        THPNK
     C                   ELSE                                                     3
     C                   MOVEL     SYPOGE        THPNK
     C                   END                                                      3<-E
     C                   MOVE      ADR3          THPSK
     C     SYLAND        IFNE      *BLANKS                                        3<-B
     C                   MOVE      SYLAND        THLKK
     C                   END                                                      3<-E
     C                   MOVE      *BLANKS       WSTINK
     C                   SELECT                                                   3<-B
S14  C*                  WHEN      PTFDT > XIDAG                                  3
S14  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))    4<-B
S14  C*                  MOVEL     SYFOR9        WSTINK
S14  C*                  END                                                       4<-E
     C                   WHEN      EORI = *BLANKS                                 3<-B
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))    4<-B
     C                   IF        THLKK = *BLANKS                                  5<-B
     C                   EVAL      THTINK = 'NO' + SYFOR9
     C                   ELSE                                                       5
     C                   EVAL      THTINK = THLKK + SYFOR9
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   OTHER                                                    3
     C                   EVAL      THTINK = EORI
     C                   END                                                      3<-E
     C                   END                                                     2<-E
      *
     C                   Z-ADD     HENT          THNTK
     C                   Z-ADD     HEVKT         THVKB
S09  C*                  MOVE      HEPRO         THPRO
     C     SELKB         IFNE      *BLANKS                                       2<-B
     C                   MOVE      SELKB         THBLK
     C                   END                                                     2<-E
     C     SETRID        IFNE      *BLANKS                                       2<-B
     C     SELKT         ORNE      *BLANKS
     C                   MOVEL     SETRID        THTGID
     C                   MOVE      SELKT         THTGLK
     C                   MOVE      *BLANKS       THTGSK
     C                   MOVEL     SETRID        THTAID
     C                   MOVE      SELKT         THTALK
     C                   MOVE      *BLANKS       THTASK
     C                   END                                                     2<-E
n17  C     SETRID        IFEQ      *BLANKS                                       2<-B
n17  C     SELKT         andeq     *BLANKS
n17  c     hepro         andne     0
n17  C     HEPRO         CHAIN     TURER14                            98
n17  c     *in98         ifeq      '0'
n17  C                   eval      thtgid=tubiln
n17  c     tuheng        ifne      *blanks
n17  c     thtgid        cat       ',':0         thtgid
n17  c     thtgid        cat       tuheng:0      thtgid
n17  c                   end
n17  C                   eval      thtglk=tulk
n17  C                   eval      thtaid=thtgid
n17  C                   eval      thtalk=tulk
n17  C                   end
n17  C                   end
     C     SETRM         IFNE      0                                             2<-B
     C                   MOVE      SETRM         THTRM
     C                   END                                                     2<-E
     C                   MOVE      *ZEROS        THDDTK
     C                   MOVE      *BLANKS       THDATS
     C                   MOVE      *BLANKS       THDKAV
     C                   MOVE      *BLANKS       THDKSK
     C                   MOVE      UTDN          WSTDN
     C     WSSG          IFEQ      *BLANKS                                       2<-B
     C                   MOVE      HESG          THSG
     C                   END                                                     2<-E
      *
     C                   END                                                    1<-E
      *
     C     SLSRU         TAG
     C                   SETOFF                                       9897
      *
     C                   ENDSR
      *
     C***********************************************
     C     PRINT         BEGSR
     C***********************************************
     C                   Z-ADD     7             UFLAGG            1 0
     C                   MOVE      *IN34         UIN34
     C                   CALL      'TR013R'
     C                   PARM      UPARM2        UPARM1
     C                   PARM                    UFLAGG
      *
     C     UFLAGG        COMP      1                                      12
      *
     C                   ENDSR
      *
N02   ***********************************************
N02  C     HZFIL         BEGSR
N02   ***********************************************
N02  C                   MOVE      UZUNIK        Z_THUNIK
N02  C                   MOVE      UZREFF        Z_THREFF
N02   *
N02  C     ZTRUHK        CHAIN(N)  ZTRUHL01                           98
N02  C     *IN98         IFEQ      '0'                                          1<-B
N02  C                   IF        WSDK = *BLANKS                                2<-B
N02  C                   MOVE      Z_THDK        WSDK
N02  C                   END                                                     2<-E
N02  C                   IF        ((WSKNS = 0) AND (WSNAS = *BLANKS))           2<-B
N02  C                   MOVE      Z_THKNS       WSKNS
N02  C                   MOVE      Z_THNAS       WSNAS
N02  C                   MOVE      Z_THADS1      WSADS1
N02  C                   MOVE      Z_THPNS       WSPNS
N02  C                   MOVE      Z_THPSS       WSPSS
N02  C                   MOVE      Z_THLKS       WSLKS
N02  C                   MOVE      Z_THSKS       WSSKS
N02  C                   MOVE      Z_THTINS      WSTINS
N02  C                   END                                                     2<-E
N02  C                   IF        ((WSKNK = 0) AND (WSNAK = *BLANKS))           2<-B
N02  C                   MOVE      Z_THKNK       WSKNK
N02  C                   MOVE      Z_THNAK       WSNAK
N02  C                   MOVE      Z_THADK1      WSADK1
N02  C                   MOVE      Z_THPNK       WSPNK
N02  C                   MOVE      Z_THPSK       WSPSK
N02  C                   MOVE      Z_THLKK       WSLKK
N02  C                   MOVE      Z_THSKK       WSSKK
N02  C                   MOVE      Z_THTINK      WSTINK
N02  C                   END                                                     2<-E
N02  C                   IF        WSBLK = *BLANKS                               2<-B
N02  C                   MOVE      Z_THBLK       WSBLK
N02  C                   END                                                     2<-E
N02  C                   IF        WSLSD = *BLANKS                               2<-B
N02  C                   MOVE      Z_THLSD       WSLSD
N02  C                   END                                                     2<-E
N02  C                   IF        WSALK = *BLANKS                               2<-B
N02  C                   MOVE      Z_THALK       WSALK
N02  C                   END                                                     2<-E
N02  C                   IF        WSTRM = 0                                     2<-B
N02  C                   MOVE      Z_THTRM       WSTRM
N02  C                   END                                                     2<-E
N02  C                   IF        WSTAID = *BLANKS                              2<-B
N02  C                   MOVE      Z_THTAID      WSTAID
N02  C                   MOVE      Z_THTASK      WSTASK
N02  C                   MOVE      Z_THTALK      WSTALK
N02  C                   END                                                     2<-E
N02  C                   IF        WSTGID = *BLANKS                              2<-B
N02  C                   MOVE      Z_THTGID      WSTGID
N02  C                   MOVE      Z_THTGSK      WSTGSK
N02  C                   MOVE      Z_THTGLK      WSTGLK
N02  C                   END                                                     2<-E
N02  C                   IF        WSTSD1 = *BLANKS                              2<-B
N02  C                   MOVE      Z_THTSD1      WSTSD1
N02  C                   MOVE      Z_THTSD2      WSTSD2
N02  C                   MOVE      Z_THTSD3      WSTSD3
N02  C                   MOVE      Z_THTSD4      WSTSD4
N02  C                   MOVE      Z_THTSD5      WSTSD5
N02  C                   MOVE      Z_THTSD6      WSTSD6
N02  C                   MOVE      Z_THTSD7      WSTSD7
N02  C                   MOVE      Z_THTSD8      WSTSD8
N02  C                   END                                                     2<-E
N02  C                   IF        WSTSB = *BLANKS                               2<-B
N02  C                   MOVE      Z_THTSB       WSTSB
N02  C                   END                                                     2<-E
N02  C                   IF        WSKDC = *BLANKS                               2<-B
N02  C                   MOVE      Z_THKDC       WSKDC
N02  C                   END                                                     2<-E
N02  C                   END                                                    1<-E
N02   *
N02  C                   ENDSR
N02   *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
N05  C     TRXREFK       KLIST
N05  C                   KFLD                    TRXAVD
N05  C                   KFLD                    TRXOPD
N05  C                   KFLD                    TRXLI
N09  C     KODTAK        KLIST
N09  C                   KFLD                    KOAUNI
N09  C                   KFLD                    UAVD
N09  C                   MOVE      'A'           KOAUNI
N09  C     SAMLBK        KLIST
N09  C                   KFLD                    SMSD
N09  C                   KFLD                    SMLNR
     C     FRATXK        KLIST
     C                   KFLD                    FXKNR
     C                   KFLD                    DELSYI            1
s12  C*                  MOVE      'L'           DELSYI
n12  C                   MOVE      'N'           DELSYI
     C     FRAT2K        KLIST
     C                   KFLD                    FXKNR
     C                   KFLD                    DELSYB            1
     C     TRHK          KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    WSTDN
     C     TRH10K        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UPRO2
     C     TRHKK         KLIST
     C                   KFLD                    KAVD
     C                   KFLD                    KTDN
     C     TRSTDK        KLIST
     C                   KFLD                    UAVD
     C     TRK01K        KLIST
     C                   KFLD                    YUNIK             3
     C                   KFLD                    YKODE            10
     C     TRUGDK        KLIST
     C                   KFLD                    WSGFT1
     C                   KFLD                    WSGADK
     C     HEADFK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    WSTDN
     C     BILLK         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    WSTDN
     C     CUND1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C     SYPARL1K      KLIST
S01  C*                  KFLD                    KUNDNR
N01  C                   KFLD                    WSKNK
     C                   KFLD                    SYPAID
S01  C*                  EVAL      SYPAID = 'EORI'
N01  C                   EVAL      SYPAID = 'TETBS'
     C     KODSIK        KLIST
     C                   KFLD                    XSIUNI
     C                   KFLD                    WSSG
     C     KODS2K        KLIST
     C                   KFLD                    XS2UNI
     C                   KFLD                    KS2LK
     C     KODS4K        KLIST
     C                   KFLD                    XS4UNI
     C                   KFLD                    WSTRM
     C     TVINMK        KLIST
     C                   KFLD                    YST
     C                   KFLD                    UAVD
     C                   KFLD                    WSTDN
     C     TVIM4K        KLIST
     C                   KFLD                    XSR1
     C                   KFLD                    UAVD
     C                   KFLD                    WSTDN
     C                   KFLD                    MAX0B
     C                   KFLD                    MAX0C
     C                   KFLD                    MAX0D
     C     TVI41K        KLIST
     C                   KFLD                    XSR1
     C                   KFLD                    UAVD
     C                   KFLD                    WSTDN
N02  C     TRHKFRI       KLIST
N02  C                   KFLD                    FSAVD
N02  C                   KFLD                    FSOPD
N02  C     FRISOL01K     KLIST
N02  C                   KFLD                    WSKODE            3
N02  C                   KFLD                    WSEXTR
S04  C*                  MOVEL     '*CR'         WSKODE
N04  C                   MOVEL     '*CN'         WSKODE
N02  C     FRISOKK1      KLIST
N02  C                   KFLD                    UAVD
N02  C                   KFLD                    WSTDN
N02  C                   KFLD                    WSKODE            3
N06  C     FRISOL01K2    KLIST
N06  C                   KFLD                    WSKODE2           3
N06  C                   KFLD                    WSEXTR
N06  C                   MOVEL     '*CE'         WSKODE2
N02  C     FRISOKK2      KLIST
N02  C                   KFLD                    THAVD
N02  C                   KFLD                    THTDN
N02  C                   KFLD                    WSKODE            3
N02  C     ZTRUHK        KLIST
N02  C                   KFLD                    Z_THREFF
N02  C                   KFLD                    Z_THUNIK
      *
     C     *LIKE         DEFINE    THTDN         UTDN
     C     *LIKE         DEFINE    THPRO         UPRO
     C     *LIKE         DEFINE    THPRO         UPRO2
     C     *LIKE         DEFINE    THSG          USG
     C     *LIKE         DEFINE    THWS          UWS
     C     *ENTRY        PLIST
     C                   PARM                    UAVD
     C     WSTDN         PARM      WSTDN         UTDN
     C     UPRO2         PARM                    UPRO
     C     WSSG          PARM                    USG
     C                   PARM                    UTYPE             3
N07  C                   PARM                    UIE               1
     C     UWS2          PARM      UWS2          UWS
     C                   PARM                    UFLAGG            1 0
      *
S14  C*    'TET00004'    CHAIN     SYPTFF                             33
S18  C*    'NCTS0002'    CHAIN     SYPTFF                             33
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           XIDAG             8 0
     C                   MOVE      *ZEROS        THAVD
     C                   MOVE      *ZEROS        THTDN
     C                   MOVE      *BLANKS       BLUR
     C                   MOVE      '0'           UIN27
     C                   MOVE      '0'           UIN34
     C                   MOVE      *ZEROS        THVKB
     C                   MOVE      *BLANKS       U1N07
      *
     C     UTYPE         IFEQ      'CSL'
     C                   MOVE      UAVD          THAVD
     C                   MOVE      WSTDN         THTDN
     C                   MOVE      'J'           WSTOLK
     C                   MOVE      'N'           WSTVIN
     C                   MOVE      '1'           UIN34
     C                   MOVE      '014'         U1N07
     C                   CALL      'TR013R'
     C                   PARM      UPARM2        UPARM1
     C                   PARM                    UFLAGG
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END
      *
     C     UTYPE         IFEQ      'PRT'
     C     TRHK          CHAIN     TRUH                               31
     C  N31              DO
     C                   MOVE      UWS           THWS
     C                   MOVE      'K'           THST
     C                   MOVE      'J'           THPKL
     C                   MOVE      ' '           TH0035
     C                   UPDATE    TRUHR
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END
     C                   END
      *
     C     UPRO2         IFNE      0
     C     TRH10K        SETLL     TRUH10
     C     TRH10K        READE     TRUH10                                 33
     C     *IN33         DOWEQ     '0'
     C     THLSTL        IFGT      0
     C                   MOVE      THTDN         UTDN
     C                   MOVE      THTDN         WSTDN
     C                   MOVE      *ZEROS        UPRO2
     C                   MOVE      'CHG'         UTYPE
     C                   LEAVE
     C                   END
     C     TRH10K        READE     TRUH10                                 33
     C  N33              ENDDO
     C                   END
      *
     C     UTYPE         COMP      'DSP'                                  27
     C     UTYPE         COMP      'CHG'                                  31
     C     UTYPE         COMP      'CHG'                                  32
     C  N32UTYPE         COMP      'CPY'                                  32
     C     UTYPE         IFEQ      'CPY'
     C                   MOVE      UAVD          KAVD              4 0
     C                   MOVE      WSTDN         KTDN              7 0
     C                   MOVE      *ZEROS        WSTDN
     C                   END
      *
     C                   MOVE      'A'           YAUNI             1
     C                   MOVE      *ZEROS        KUNDNR            8 0
     C                   MOVE      'SI'          XSIUNI            2
     C                   MOVE      'S2 '         XS2UNI            3
     C                   MOVE      'S4 '         XS4UNI            3
     C                   MOVE      ' '           YST               1
     C                   MOVE      '99999999'    MAX0B             8 0
     C                   MOVE      '999999'      MAX0C             6 0
     C                   MOVE      '99'          MAX0D             2 0
     C                   MOVE      'R'           XSR1              1
     C                   MOVE      'N'           USPED             1
     C                   MOVE      *ZEROS        WSDT
     C                   MOVE      *ZEROS        WSDDT
     C                   MOVE      *ZEROS        WSTRDT
     C                   MOVE      *ZEROS        THDT
     C                   MOVE      *ZEROS        THDDT
     C                   MOVE      *ZEROS        THTRDT
N07  C     UIE           COMP      'I'                                    41
      *
     C                   Z-ADD     3             SOANTK            1 0
     C                   MOVE      'AVSENDER'    SOTXT1            8
     C                   MOVE      'MOTTAKER'    SOTXT2            8
     C                   MOVE      'H.ANSVAR'    SOTXT3            8
     C                   MOVE      *BLANKS       SOTXT4            8
     C                   MOVE      *BLANKS       SOTXT5            8
     C                   MOVE      *BLANKS       SOTXT6            8
     C                   MOVE      *BLANKS       SOTXT7            8
     C                   MOVE      *BLANKS       SOTXT8            8
     C                   MOVE      *ZEROS        SOKNR4            8 0
     C                   MOVE      *ZEROS        SOKNR5            8 0
     C                   MOVE      *ZEROS        SOKNR6            8 0
     C                   MOVE      *ZEROS        SOKNR7            8 0
     C                   MOVE      *ZEROS        SOKNR8            8 0
      *
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
     C     UAVD          CHAIN(N)  TRUSTD                             33
N11  C                   IF        THDDT < 100
N11  C                   Z-ADD     THDDT         XANTDG
N11  C                   ELSE
N11  C                   MOVE      *ZEROS        XANTDG            3 0
N11  C                   END
N11  C                   MOVE      *ZEROS        THDDT
      * WSTVIN = J BETYR SKRIVES NÅ
     C                   MOVE      'J'           WSTOLK
     C                   MOVE      'N'           WSTVIN
     C                   MOVE      THENKL        WSENKL
     C     HEADFK        SETLL     HEADF
     C                   READ      HEADF                                  36
     C                   MOVE      *IN36         UIN36
N02   *
N02   * henteventuell externrefkode
N02   *
N02  C     FRISOKK1      CHAIN     FRISOK                             33
N02  C  N33              MOVEL     FSSOK         WSEXTR
N02  C     THEKST        COMP      'R'                                4444
      *
     C                   ENDSR
      *
      *
     C***********************************************
     C     VISOPL        BEGSR
     C***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
      * AVSENDER   ...
     C     LINNBR        IFEQ      3
     C     POSNBR        ANDGE     13
     C     POSNBR        ANDLE     20
     C     WSKNS         ANDGT     0
     C                   MOVE      WSKNS         XSKKNR
     C                   GOTO      STVISO
     C                   END
      *
      *
      * MOTTAGER   ...
     C     LINNBR        IFEQ      8
     C     POSNBR        ANDGE     13
     C     POSNBR        ANDLE     20
     C     WSKNK         ANDGT     0
     C                   MOVE      WSKNK         XSKKNR
     C                   GOTO      STVISO
     C                   END
      *
      *
      * HOVEDANSVARLIG   ...
     C     LINNBR        IFEQ      13
     C     POSNBR        ANDGE     13
     C     POSNBR        ANDLE     20
     C     WSKNA         ANDGT     0
     C                   MOVE      WSKNA         XSKKNR
     C                   GOTO      STVISO
     C                   END
      *
      *
     C                   MOVE      'DIV1036'     MSGNR
     C                   SETON                                        30
     C                   GOTO      SLVISO
      *
     C     STVISO        TAG
     C                   MOVE      *ZEROS        UFLAGG
     C                   CALL      'FRITXTSK'
     C                   PARM                    FIFIRM
     C                   PARM                    XSKKNR            8 0
     C                   PARM                    XSKMOT            8
     C                   PARM                    UFLAGG
     C                   PARM                    DELSYI
      *
     C     SLVISO        ENDSR
      *
     C***********************************************
     C     TSTOPL        BEGSR
     C***********************************************
     C                   MOVEA     '000'         *IN(37)
     C                   MOVEA     '00'          *IN(28)
     C                   MOVE      '0'           *IN35
      *** TEST OM SELGER OPPLYSNING. HVIS DET, SETT 37 PÅ
     C                   MOVE      WSKNS         FXKNR
     C     FRATXK        CHAIN     FRATXT                             33
     C   33FRAT2K        CHAIN     FRATXT                             33
     C  N33              SETON                                        37
      *
      *** TEST OM KJØPER OPPLYSNING. HVIS DET, SETT 38 PÅ
     C                   MOVE      WSKNK         FXKNR
     C     FRATXK        CHAIN     FRATXT                             33
     C   33FRAT2K        CHAIN     FRATXT                             33
     C  N33              SETON                                        38
      *
      *** TEST OM HOVEDANSVALIG OPPLYSNING. HVIS DET, SETT 39 PÅ
     C                   MOVE      WSKNA         FXKNR
     C     FRATXK        CHAIN     FRATXT                             33
     C   33FRAT2K        CHAIN     FRATXT                             33
     C  N33              SETON                                        39
      *** TEST OM FLERE LANDKODER PÅ GARANTIBEGRENSNING
     C     TRHK          SETLL     TRUHGB
     C     TRHK          READE     TRUHGB                                 33
     C  N33              SETON                                        28
      *** TEST OM FLERE FORSEGLINGSLINJER
     C     TRHK          SETLL     TRUHFS
     C     TRHK          READE     TRUHFS                                 33
     C  N33              SETON                                        29
      *** TEST OM FLERE FORSEGLINGSLINJER
     C     TRHK          SETLL     TRUHGN
     C     TRHK          READE     TRUHGN                                 33
     C  N33              SETON                                        35
      *
     C                   ENDSR
      *
