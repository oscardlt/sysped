********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10193 * 01 YBC PTF10 SIST BRUKTE VERDIER ER DEFAULT FOR NESTE
10193 * 01 YBC PTF11 SIST emnerubrikk 80  lang
********************************************************************
      *
      ***********************************************************
      *** PROGRAM SKAL plukke epostadresse                    ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01 02 04-26                      ***
      *** LEDIGE INDIKATORER 28 29 31 32 35 38 51-56 58-69    ***
      ***                    74-78 80-87 89-99                ***
      ***********************************************************
     FCUNDC     IF   E             DISK
     FFIRM      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FKUNDL01   IF   E           K DISK
     F                                     RENAME(KUNDR:KUNDR2)
N01  FEPOS05F   UF A E           K DISK
     FEPOS05FM  CF   E             WORKSTN
     F                                     INFDS(FBAREA)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
N01  D                SDS
N01  D  ZUSER                254    263
     D F5              S             75    DIM(12)
     D                 DS
     D  USØKKN                 1     30
     D  USØKKO                 1      2
     D  URRN                   3     12
     D  epofax                13     13
     D                 DS
     D  F3                     1      6
     D                                     DIM(6)
     D UP              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZÆØÅ')
     D LO              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzæøå')
     IKUNDR
     I              BANKG                       SYBAGI
     I              POSTG                       SYPOGI
     C*
     C                   EXSR      INIT
     C*
     C     START         TAG
     C                   EXFMT     BILDE
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   SETOFF                                       30
     C   03              GOTO      SLUTT
     C   04              DO
     C     LINNBR        IFeq      8
     C     LO:UP         XLATE     EPOST         usok
     C                   CALL      'VCUNDC2R'
     C                   PARM                    FIFIRM
     C                   PARM                    USOK             30
     C                   PARM                    URRN2            10 0
     c                   parm                    epofax            1
     C     URRN2         IFNE      *ZEROS
     C                   MOVE      URRN2         URRN
     C                   MOVE      'KP'          USØKKO
     c                   else
     c                   movel     usok          epost
     C                   END
     C                   ELSE
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    KUNDNR
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN           30
     c                   end
     C* RETUR MED KONTAKTPERS
     C     USØKKO        IFEQ      'KP'
     C                   MOVE      URRN          RRN              10 0
     C     RRN           CHAIN     CUNDC                              31
     C  N31              MOVEL     CEMAIL        EPOST
     C  N31              MOVE      CCOMPN        KUNDNR
     C                   END
     C                   END
     C                   EXSR      TEST
     C   30              GOTO      START
     C*
     C                   z-add     12            LINNBR
     C                   z-add     10            POSNBR
     C*
     C  N10              GOTO      START
     C*
     c     epost         ifne      *blanks
     C                   move      epost         EPOSTu
     C                   move      wscvp1        COV01u
     C                   move      wscvp2        COV02u
     C                   move      wscvp3        COV03u
     C                   move      wscvp4        COV04u
     C                   move      wscvp5        COV05u
     C                   move      wscvp6        COV06u
     C                   move      wscvp7        COV07u
     C                   move      wscvp8        COV08u
     c                   movel     '*YES'        selu
     c     wssel         ifeq      'N'
     c                   movel     '*NO '        selu
     c                   end
     c                   move      '*YES'        pdfu
     c     wspdf         ifeq      'N'
     c                   movel     '*NO '        pdfu
     c                   end
     c                   move      wsqry         qryu
     c                   move      wsqryl        qrylibu
     c                   end
N01   *
N01  C     ZUSER         CHAIN     EPOS05F                            33
N01  C                   EVAL      E5QRY  = WSQRY
N01  C                   EVAL      E5LIB  = WSQRYL
N01  C                   EVAL      E5SEL  = WSSEL
N01  C                   EVAL      E5PDF  = WSPDF
N01  C                   EVAL      E5EM   = EPOST
N01  C                   EVAL      E5KN   = KUNDNR
N01  C                   EVAL      E5NV   = KNAVN
N01  C                   EVAL      E5CVP1 = WSCVP1
N01  C                   EVAL      E5CVP2 = WSCVP2
N01  C                   EVAL      E5CVP3 = WSCVP3
N01  C                   EVAL      E5CVP4 = WSCVP4
N01  C                   EVAL      E5CVP5 = WSCVP5
N01  C                   EVAL      E5CVP6 = WSCVP6
N01  C                   EVAL      E5CVP7 = WSCVP7
N01  C                   EVAL      E5CVP8 = WSCVP8
N01  C                   IF        *IN33
N01  C                   EVAL      E5USER = ZUSER
N01  C                   WRITE     EPOS05FR
N01  C                   ELSE
N01  C                   UPDATE    EPOS05FR
N01  C                   END
N01   *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     TEST          BEGSR
     C***********************************************
     C
      *
      * skjekk om tastet query finnes
      *
     c                   setoff                                       30
     c                   setoff                                       707172
     c                   move      '0'           feil              1
     c                   movel     '*QRYDFN'     otype            10
     c                   CALL      'SYGE00C'
     c                   parm                    WSQRY
     c                   parm                    WSQRYL
     c                   parm                    feil
     c                   parm                    otype
     c     feil          ifeq      '1'
     C                   SETON                                        3070
     C                   MOVE      'SHU0849'     MSGNR
     C                   z-add     4             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     C                   END
     C
      *
     C     KUNDNR        IFNE      *ZEROS
     C     KUKEY         CHAIN     CUNDL01                            71
     C  N71EPOST         IFEQ      *BLANKS
     C                   MOVEl     syepos        epost
     C                   END
     c     *in(71)       ifeq      '1'
     C                   SETON                                        30
     C                   MOVE      'SPK0001'     MSGNR
     C                   z-add     9             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
      *
      * IKKE EPOST-ADRESSE LAGT INN
      *
     C     EPOST         ifeq      *BLANKS
     C                   SETON                                        3072
     C                   MOVE      'SHU0835'     MSGNR
     C                   z-add     8             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
      *
      * adresse må inneholde @
      *
     c                   else
     C     '@'           SCAN      EPOST                                  62
     c     *in(62)       ifeq      '0'
     C                   SETON                                        3072
     C                   MOVE      'SHU0848'     MSGNR
     C                   z-add     8             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
      *
      *
     C*
     C     SLTB          ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    QRYu             10
     C                   PARM                    QRYLIBU          10
     C                   PARM                    selu             10
S02  C*                  PARM                    pdfu             10
N02  C                   PARM                    pdfu              4
     C                   PARM                    EPOSTu           70
s02  C*                  PARM                    COV01u           40
n02  C                   PARM                    COV01u           70
     C                   PARM                    COV02u           40
     C                   PARM                    COV03u           40
     C                   PARM                    COV04u           40
     C                   PARM                    COV05u           40
     C                   PARM                    COV06u           40
     C                   PARM                    COV07u           40
     C                   PARM                    COV08u           40
     C                   move      COV01u        wscvp1
     C     KUKEY         KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
      *
     C                   READ      FIRM                                   44
     C*
     c                   move      'J'           wssel
     c     selu          ifeq      '*NO '
     c                   move      'N'           wssel
     c                   end
     c                   move      'J'           wspdf
     c     pdfu          ifeq      '*NO '
     c                   move      'N'           wspdf
     c                   end
     c                   move      qryu          wsqry
     c                   move      qrylibu       wsqryl
     C                   move      epostu        EPOST
N01   *
N01  C     ZUSER         CHAIN(N)  EPOS05F                            33
N01  C                   IF        *IN33 = *OFF
N01  C                   EVAL      WSQRY  = E5QRY
N01  C                   EVAL      WSQRYL = E5LIB
N01  C                   EVAL      WSSEL  = E5SEL
N01  C                   EVAL      WSPDF  = E5PDF
N01  C                   EVAL      EPOST  = E5EM
N01  C                   EVAL      KUNDNR = E5KN
N01  C                   EVAL      KNAVN  = E5NV
N01  C                   EVAL      WSCVP1 = E5CVP1
N01  C                   EVAL      WSCVP2 = E5CVP2
N01  C                   EVAL      WSCVP3 = E5CVP3
N01  C                   EVAL      WSCVP4 = E5CVP4
N01  C                   EVAL      WSCVP5 = E5CVP5
N01  C                   EVAL      WSCVP6 = E5CVP6
N01  C                   EVAL      WSCVP7 = E5CVP7
N01  C                   EVAL      WSCVP8 = E5CVP8
N01  C                   END
      *
     C                   ENDSR
      *
