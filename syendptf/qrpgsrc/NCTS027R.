      *
      ***********************************************************
      *** PROGRAM SKAL SKRIVE UT T-DOK. (NØDLØSNING)          ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 1-26                             ***
      *** LEDIGE INDIKATORER 31 37 51-95
      ***********************************************************
     H DECEDIT('0,') DATEDIT(*DMY.)
     FKODTFM    IF   E           K DISK
     FKODTP     IF   E           K DISK
     FTRKODL01  IF   E           K DISK
     FNCTSESTD  IF   E           K DISK    PREFIX(STD_)
     FNCTSEH    UF   E           K DISK
     FNCTSEC    IF   E           K DISK
     FNCTSEI    IF   E           K DISK
     FSADTRTB   UF A E           K DISK
     FTRACKF    O  A E             DISK
     FNCTS027PF O    E             PRINTER USROPN
     FNCTS027PL O    E             PRINTER USROPN
     F                                     OFLIND(*IN01)
     D F11             S             75    DIM(9)
     D F12             S             75    DIM(9)
     D UCMD            DS          1024
     D                 DS
     D XCMD11          C                   CONST('OVRPRTF -
     D                                     FILE(NCTS027PF) -
     D                                     DEVTYPE(*AFPDS) -
     D                                     OUTQ(')
     D XCMD12          C                   CONST('OVRPRTF -
     D                                     FILE(NCTS027PL) -
     D                                     OUTQ(')
     D XCMD21          C                   CONST('PAGESIZE(72 210) -
     D                                     CPI(10) -
     D                                     OVRFLW(70)')
     D XCMD22          C                   CONST('PAGESIZE(72 120) -
     D                                     CPI(15) -
     D                                     OVRFLW(71)')
     D XCMD23          C                   CONST('PAGESIZE(70 80) -
     D                                     CPI(10) -
     D                                     OVRFLW(70)')
     D XCMD31          C                   CONST(' COPIES(')
     D XCMD41          C                   CONST(' FORMTYPE(')
     D XCMD51          C                   CONST('FRONTOVL(TETN 0.16 0.200)')
     D                 DS
     D  TIPMRK                 1    120
     D  TIPMRK_17              1     17
     D                 DS
     D  TIPNT                  1      8  0
     D  TIPNT_5                4      8  0
     D                 DS
     D  TIVKB                  1     13  3
     D  TIVKB_11               3     13  3
     D                 DS
     D  TICTX                  1    120
     D  TICTX_30               1     30
     D                 DS
     D  TIPDRF                 1     70
     D  TIPDRF_20              1     20
     D                 DS
     D  THNTTD                 1      1  0
     D  XHNTTD                 1      1
     D                 DS
     D  THNTLL                 1      1  0
     D  XHNTLL                 1      1
     D                 DS
     D  STD_THCNA              1     22
     D  XHCNA1                 1     12
     D  XHCNA2                13     22
     D                 DS
     D  STD_THCNR              1     17
     D  XHCNR1                 1      6
     D  XHCNR2                 7     12
     D                SDS
     D  ZUSER                254    263
      *
     C                   EXSR      INIT
      *
     C     NCTSEHK       CHAIN     NCTSEH                             33
     C                   IF        *IN33 = *OFF
     C     THAVD         CHAIN     NCTSESTD                           33
     C     STD_THFMLL    COMP      'J'                                    27
     C                   MOVEL     THCATS        YKODE
     C     TRK01K        CHAIN     TRKODL01                           33
     C  N33              MOVEL     TKTXTN        XKTXTC
     C   33              EVAL      XKTXTC = THCATS
     C                   MOVEL     THTSB         YKODE
     C     TRK01K        CHAIN     TRKODL01                           33
     C  N33              MOVEL     TKTXTN        XKTXTB
     C   33              EVAL      XKTXTB = THTSB
     C                   MOVEL     THTSB         XXTSB
      *
     C                   MOVE      'N'           THST
     C                   MOVEL     THTRNR        XAN08             8
     C                   IF        XAN08 = 'NØDPROS.'
     C                   MOVE      THTRNR        XNPNR
     C                   ELSE
      * HENT NØDPROSEDYRENR
     C                   IF        STD_THNPNS = ' '
     C                   EVAL      STD_THNPNS = 'A'
     C                   END
     C     STD_THNPNS    CHAIN     SADTRTB                            33
     C                   IF        *IN33
     C                   EVAL      STTTYP = STD_THNPNS
     C                   Z-ADD     2             STTNR
     C                   WRITE     SADTRTR
     C                   Z-ADD     1             XNPNR
     C                   ELSE
     C                   EVAL      XNPNR = STTNR
     C                   ADD       1             STTNR
     C                   UPDATE    SADTRTR
     C                   END
     C                   EVAL      THTRNR = 'NØDPROS.   ' + STD_THNPNS
     C                   MOVE      XNPNR         THTRNR
     C                   END
     C                   UPDATE    NCTSEHR
      * HENT TOLLSTEDSNAVN
     C                   EXSR      HENTTS
     C*                  EVAL      XHADA3 = %TRIM(THPNA) + ' ' + %TRIM(THPSA)
      *
     C                   MOVE      'SAD1'        XSIDE             4
     C     START         TAG
     C                   IF        XPDF = 'J'
     C                   MOVE      *BLANKS       UCMD
     C     XCMD11        CAT       XKOPNVN:0     UCMD
     C                   CAT       ')':0         UCMD
     C                   CAT       XCMD23:1      UCMD
     C                   CAT       XCMD31:0      UCMD
     C                   CAT       '1)':0        UCMD
     C                   CAT       XCMD41:0      UCMD
     C                   CAT       GRAAPP:0      UCMD
     C                   CAT       XKOPTY:0      UCMD
     C                   CAT       GRAAPP:0      UCMD
     C                   CAT       ')':0         UCMD
     C                   CAT       XCMD51:1      UCMD
     c                   move      *blanks       FMOVL            20
     c                   eval      FMOVL='FRONTMGN(0.14 0.16)'                  PDF(LIKT SAD IMP)
     C                   CAT       FMOVL:1       UCMD
     C                   CALL      'QCMDEXC'                            34
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     C                   MOVE      *BLANKS       F11
     C                   EVAL      F11(1) = '.'
     C                   END
      *
     C                   OPEN      NCTS027PF
     C     THGFT1        COMP      *BLANKS                                49
     C     1             DO        9             YN                3 0
     C                   IF        F11(YN) <> *BLANKS
     C                   EVAL      PFFM1 = F11(YN)
     C                   EVAL      PFFM2 = F12(YN)
     C     NCTSEHK       CHAIN     NCTSEC                             33
     C     NCTSEHK       CHAIN     NCTSEI                             33
     C                   z-add     1             antlis
     C                   IF        THVPOS <= 1
     C                   z-add     0             antlis
     C                   END
     C                   WRITE     NCTS027PF1
     C                   IF        THVPOS <= 1
     C                   WRITE     NCTS027PF2
     C                   ELSE
     C                   WRITE     NCTS027PF3
     C                   EXSR      SRLL
     C                   END
     C                   WRITE     NCTS027PF4
     C                   IF        XPDF = 'J'
     C                   WRITE     NCTS027PF6
     C                   ELSE
     C                   WRITE     NCTS027PF5
     C                   END
     C                   WRITE     NCTS027PF7
     C                   END
     C                   ENDDO
     C                   CLOSE     NCTS027PF
      *
     C                   IF        XPDF = 'J'
     C                   SELECT
     C                   WHEN      XSIDE = 'SAD1'
     C                   EVAL      XSIDE = 'SAD4'
     C                   GOTO      START
     C                   WHEN      XSIDE = 'SAD4'
     C                   EVAL      XSIDE = 'SAD5'
     C                   GOTO      START
     C                   ENDSL
     C                   END
      *
      * OPPDATER T&T
     C                   EVAL      TTAVD  = THAVD
     C                   EVAL      TTOPD  = THTDN
     C                   EVAL      TTACTI = 'TET'
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   EVAL      TTUSER = ZUSER
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
     C                   EVAL      TTEDRE = 'NØD'
     C                   EVAL      TTTEXT = THTRNR
     C                   EVAL      TTTEXL = THTRNR
     C                   WRITE     TRACKFR
      *
     C                   END
      *
     C                   MOVE      '1'           *INLR
     C                   RETURN
      *
      ***********************************************
     C     HENTTS        BEGSR
      ***********************************************
     C                   EVAL      YKODE = THTSD1
     C     TRK01K        CHAIN     TRKODL01                           34
     C  N34              MOVEL     TKTXTN        XKTXT1
     C   34              EVAL      XKTXT1 = THTSD1
     C                   MOVEL     THTSD1        XHTSD1
     C                   EVAL      YKODE = THTSD2
     C     TRK01K        CHAIN     TRKODL01                           34
     C  N34              MOVEL     TKTXTN        XKTXT2
     C   34              EVAL      XKTXT2 = THTSD2
     C                   MOVEL     THTSD2        XHTSD2
     C                   EVAL      YKODE = THTSD3
     C     TRK01K        CHAIN     TRKODL01                           34
     C  N34              MOVEL     TKTXTN        XKTXT3
     C   34              EVAL      XKTXT3 = THTSD3
     C                   MOVEL     THTSD3        XHTSD3
     C                   EVAL      YKODE = THTSD4
     C     TRK01K        CHAIN     TRKODL01                           34
     C  N34              MOVEL     TKTXTN        XKTXT4
     C   34              EVAL      XKTXT4 = THTSD4
     C                   MOVEL     THTSD4        XHTSD4
     C                   EVAL      YKODE = THTSD5
     C     TRK01K        CHAIN     TRKODL01                           34
     C  N34              MOVEL     TKTXTN        XKTXT5
     C   34              EVAL      XKTXT5 = THTSD5
     C                   MOVEL     THTSD5        XHTSD5
     C                   EVAL      YKODE = THTSD6
     C     TRK01K        CHAIN     TRKODL01                           34
     C  N34              MOVEL     TKTXTN        XKTXT6
     C   34              EVAL      XKTXT6 = THTSD6
     C                   MOVEL     THTSD6        XHTSD6
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRLL          BEGSR
      ***********************************************
     C                   OPEN      NCTS027PL
     C                   MOVE      *ON           *IN01
     C     NCTSEHK       SETLL     NCTSEC
     C     NCTSEHK       READE     NCTSEC                                 33
     C                   DOW       *IN33 = *OFF
      *
     C     NCTSECK       SETLL     NCTSEI
     C     NCTSECK       READE     NCTSEI                                 33
     C                   DOW       *IN33 = *OFF
     C                   IF        *IN01
     C                   WRITE     NCTS027PL1
     C                   MOVE      *OFF          *IN01
     C                   END
     C                   ADD       1             XLNR
     C                   WRITE     NCTS027PL2
     C     NCTSECK       READE     NCTSEI                                 33
     C                   ENDDO
      *
     C     NCTSEHK       READE     NCTSEC                                 33
     C                   ENDDO
      *
     C   27              DOW       XLNR < 41
     C                   ADD       1             XLNR
     C                   WRITE     NCTS027PL3
     C                   ENDDO
     C                   WRITE     NCTS027PL4
     C                   CLOSE     NCTS027PL
      *
     C                   ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    UAVD              4 0
     C                   PARM                    UTDN              7 0
      *
     C     NCTSEHK       KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C     NCTSECK       KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    TCLI
     C     TRK01K        KLIST
     C                   KFLD                    YUNIK             3
     C                   KFLD                    YKODE            10
     C     KODKEY        KLIST
     C                   KFLD                    KOPUNI
     C                   KFLD                    UAVD
     C                   KFLD                    KOPLNR
      *
     C                   MOVE      'P'           KOPUNI
     C                   MOVE      '106'         YUNIK
     C                   Z-ADD     1024          UCMDL            15 5
     C                   BITON     '123457'      GRAAPP            1
     C                   BITOFF    '06'          GRAAPP
     C                   EVAL      TIPMRK = *BLANKS
     C                   EVAL      TIPNT  = 0
     C                   EVAL      TIVKB  = 0
     C                   EVAL      TIPDRF = *BLANKS
     C                   EVAL      THNTTD = 0
     C                   EVAL      STD_THCNA  = *BLANKS
     C                   EVAL      STD_THCNR  = *BLANKS
      *
     C                   EXSR      OVRF
      *
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
      *
     C                   ENDSR
      ***********************************************
     C     OVRF          BEGSR
      ***********************************************
     C                   MOVE      '0'           *IN97
      * Printerstyring for hovedark (A)
     C                   Z-ADD     90            KOPLNR
     C     KODKEY        CHAIN     KODTP                              33
     C                   MOVE      *BLANKS       PFFM1
     C                   MOVE      *BLANKS       PFFM2
     C     *IN33         IFEQ      '1'
     C                   MOVE      '1'           *IN97
     C                   MOVE      *BLANKS       KOPNVN
     C                   MOVEL     '*JOB'        KOPNVN
     C                   MOVE      *BLANKS       KOPTY
     C                   ELSE
     C     KOPFM         SETLL     KODTFM                             33
     C                   MOVE      *ZEROS        YN                3 0
     C     STFM1         TAG
     C     KOPFM         READE     KODTFM                                 33
     C  N33KFMT1         IFNE      *BLANKS
     C                   ADD       1             YN
     C                   MOVE      KFMT1         F11(YN)
     C                   MOVE      KFMT2         F12(YN)
     C                   END
     C  N33              GOTO      STFM1
     C                   ENDIF
     C                   IF        ((KOPLAS = 'P') or (KOPLAS = 'F'))
     C                   MOVE      'J'           XPDF              1
     C                   MOVE      KOPNVN        XKOPNVN          10
     C                   MOVE      KOPTY         XKOPTY           10
     C                   ELSE
     C                   MOVE      'N'           XPDF
     C                   MOVE      *BLANKS       UCMD
     C     XCMD11        CAT       KOPNVN:0      UCMD
     C                   CAT       ')':0         UCMD
     C                   CAT       XCMD21:1      UCMD
     C                   CAT       XCMD31:0      UCMD
     C                   CAT       '1)':0        UCMD
     C                   CAT       XCMD41:0      UCMD
     C                   CAT       GRAAPP:0      UCMD
     C                   CAT       KOPTY:0       UCMD
     C                   CAT       GRAAPP:0      UCMD
     C                   CAT       ')':0         UCMD
     C                   CALL      'QCMDEXC'                            34
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     C                   END
      *
      * Printerstyring for lasteliste
     C                   Z-ADD     95            KOPLNR
     C     KODKEY        CHAIN     KODTP                              33
     C                   MOVE      *BLANKS       PLFM1
     C                   MOVE      *BLANKS       PLFM2
     C     *IN33         IFEQ      '1'
     C                   MOVE      *BLANKS       KOPNVN
     C                   MOVEL     '*JOB'        KOPNVN
     C                   MOVE      *BLANKS       KOPTY
     C                   ELSE
     C     KOPFM         SETLL     KODTFM                             33
     C     KOPFM         READE     KODTFM                                 33
     C  N33KFMT1         IFNE      *BLANKS
     C                   MOVE      KFMT1         PLFM1
     C                   MOVE      KFMT2         PLFM2
     C                   END
     C                   ENDIF
     C                   MOVE      *BLANKS       UCMD
     C     XCMD12        CAT       KOPNVN:0      UCMD
     C                   CAT       ')':0         UCMD
     C                   CAT       XCMD22:1      UCMD
     C                   CAT       XCMD31:0      UCMD
     C                   CAT       '1)':0        UCMD
     C                   CAT       XCMD41:0      UCMD
     C                   CAT       GRAAPP:0      UCMD
     C                   CAT       KOPTY:0       UCMD
     C                   CAT       GRAAPP:0      UCMD
     C                   CAT       ')':0         UCMD
     C                   CALL      'QCMDEXC'                            34
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
      *
     C                   ENDSR
      *
