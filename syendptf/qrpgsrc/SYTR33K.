********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 Inndato mm kan nå finnes på DOKUFM
10XXX * 02 JOV PTF10 LM INNFØRT - Sts inn/Ut fra rett sted - F5=REFRESH
      *%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * 03 JOV PTF11 IKKE VIS GENRELL GODSMERKE - KUN KOLLI-ID  (= LINJE 00 I/E )
      *%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * 04 JOV PTF12 vis også lengre kolliIDs enn 18(20)/ F13 = Som F13 under fraktbr 1
      * 05 JOV PTF12 Subfil utvidet - viser også siste lokasjon og Pallid/merknad fra dokufm
12154 * 06 SH  PTF12 print merkelapp
      * 07 SH  PTF12 E=endre kollidetaljer
      * 08 JOV PTF12 vis også status for henting /COL og POD dersom det er gjort på kollinivå.
********************************************************/***********
     FDOKUFM    IF   E           K DISK
N05  FDOKUFN    IF   E           K DISK
     FCARGOF    IF   E           K DISK
     FHEADF     IF   E           K DISK
     FCARGOO    IF   E           K DISK
     FSYTR33KM  CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
N04  D                 DS
N04  D FMMRK1                  1     35
N04  D  WFMMRK1                1     35
N04  D  WFMMRK1A               1     18
     D                 DS
     D DsDat                   1      8  0
     D  DsDatÅÅ                1      4  0
     D  DsDatMM                5      6  0
     D  DsDatDD                7      8  0
      *____
      * Inz
      *""""
     C     *ENTRY        PLIST
     C                   PARM                    UFMAVD
     C                   PARM                    UFMOPD
     C     *LIKE         DEFINE    FMAVD         UFMAVD
     C     *LIKE         DEFINE    FMOPD         UFMOPD
     C     *LIKE         DEFINE    FMRI          WFMRI
     C     *LIKE         DEFINE    KOID          WKOID
     C     *LIKE         DEFINE    KOID          XKOID
     C     *LIKE         DEFINE    KOTERM        XKOTERM
     C                   EVAL      WFMRI='F'
     C     KEYDOK        KLIST
     C                   KFLD                    WFMRI
     C                   KFLD                    UFMAVD
     C                   KFLD                    UFMOPD
N04  C                   KFLD                    UFBNR1
N04  C                   KFLD                    ULINR0
N04  C                   MOVE      001           UFBNR1            3 0
N04  C                   MOVE      *ZEROS        ULINR0            2 0
     C     KEYHEA        KLIST
     C                   KFLD                    UFMAVD
     C                   KFLD                    UFMOPD
      *______________
      * Clear Subfile
      *""""""""""""""
     C     START1        TAG

     C                   MOVE      '1'           *IN93
     C                   MOVE      *BLANKS       SFNR
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
     C                   MOVE      'N'           NullVKT           1
     C                   EVAL      XANT=0
     C                   EVAL      XKOMM3=0
N02  C                   EVAL      XKOMLM=0
     C                   EVAL      XKOMVKT=0
N08  C                   move      *blanks       ColPod            1
N08  C                   move      *blanks       InfoTxt
     C     KEYHEA        CHAIN     HEADF
      * når post finnes i CARGOO vis orginal-verdier derfra
     C     KEYHEA        CHAIN     CARGOO
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     KEYDOK        SETLL     DOKUFM
     C     KEYDOK        READE     DOKUFM                                 94

     C     *IN94         DOWEQ     '0'
N03  C                   IF        FMST<>'I' AND FMST<>'E'
N03  C                   GOTO      NEXTREC
N03  C                   ENDIF
S04  C*                  EVAL      WFMMRK1A=%SUBST(FMMRK1:1:18)
s02  C*                  EVAL      WFMMRK1B=%SUBST(FMMRK1:33:1)
s02  C*                  EVAL      WFMMRK1C=%SUBST(FMMRK1:34:1)
s02  C*                  EVAL      WFMMRK1D=%SUBST(FMMRK1:35:1)
n02  C                   EVAL      WFMITER=FMITER
n02  C                   EVAL      WFMUTER=FMUTER
n08  C                   EVAL      WFMCOL =FMCOL
n08  C                   EVAL      WFMLEVE=FMLEVE
N08  C                   if        FMCOL<>' ' or FMLEVE<>' '
N08  C                   move      'J'           ColPod            1
N08  C                   endif
n02  C                   EVAL      DSdat  =FMUTDT
N02  C                   MOVEL     DsDatDD       WKOUTDT4
N02  C                   MOVE      DsDatMM       WKOUTDT4
N02  C                   MOVEL     FMUTTM        WKOUTTI4
      * Er det minst en post i CARGOF ?
     C     '00'          CAT       WFMMRK1A:0    WKOID
     C                   EVAL      *IN51=*OFF
     C     WKOID         SETLL     CARGOF
     C     WKOID         READE     CARGOF                                 51
N04   * mer enn 18 lang (+ 00) - da kan en ikke matche mot CARGOF ...
N04  c                   IF        %SUBST(FMMRK1:19:1)<>' '
N04  C                   EVAL      *IN51='1'
N04  c                   ENDIF
     C                   IF        *IN51
      * ingen cargof - hent tid mm fra dokufm..
     C                   EVAL      WKOTERM1=*BLANKS
s01  C*                  EVAL      WKOINDT=0
s01  C*                  EVAL      WKOINTI=0
s01  C*                  EVAL      WKOMVKT=0
s01  C*                  EVAL      WKOMM3=0
s02  C*                  EVAL      WKOINDT=FMITDT
s02  C*                  EVAL      WKOINTI=FMITTM
n02  C                   EVAL      DSdat  =FMITDT
N02  C                   MOVEL     DsDatDD       WKOINDT4
N02  C                   MOVE      DsDatMM       WKOINDT4
N02  C                   MOVEL     FMITTM        WKOINTI4
n01  C                   EVAL      WKOMVKT=FMVKT
n01  C                   EVAL      WKOMM3= FMVOL
n02  C                   EVAL      WKOMLM= FMLM
     C                   ADD       1             XANT
     C                   ELSE
      * CARGOF finnes - dato/tid- vekter mm erfra
     C                   EVAL      WKOTERM1=%SUBST(KOTERM:1:3)
s02  C*                  EVAL      WKOINDT=KOINDT
s02  C*                  EVAL      WKOINTI=KOINTI
n02  C                   EVAL      DSdat  =KOINDT
N02  C                   MOVEL     DsDatDD       WKOINDT4
N02  C                   MOVE      DsDatMM       WKOINDT4
N02  C                   MOVEL     KOINTI        WKOINTI4
     C                   EVAL      WKOMVKT=KOMVKT
     C                   EVAL      WKOMM3=KOMM3
N02  C                   EVAL      WKOMLM=KOMLM
     C                   ADD       1             XANT
     C                   ADD       KOMVKT        XKOMVKT
     C                   ADD       KOMM3         XKOMM3
N02  c     KOMLM         ifgt      XKOMLM
N02  C                   z-add     KOMLM         XKOMLM
N02  c                   endif
     C     KOMVKT        IFEQ      0
     C                   EVAL      NullVKT = 'Y'
     C                   end
     C                   ENDIF
N05   * Hvis ankommet Terminal men ennå ikke avgått - vis evt siste lokasjon
N05  C                   EVAL      WLOC = *blanks
N05  C                   if        WKOINDT4 <> *zeros and WKOUTDT4 = *zeros
N05  C                   EVAL      FNCLID = FMMRK1
N05  c     FNCLID        setll     DOKUFN
N05  c     FNCLID        reade     DOKUFN                                 33
N05  c     *in33         doweq     '0'
N05  C                   EVAL      WLOC = FNTERM
N05  c     FNCLID        reade     DOKUFN                                 33
N05  c                   enddo
N05  c                   endif
N05  C                   EVAL      WPALLID=FMPAID
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
S02   * Finnes det flere poster i CARGOF ?
S02   * DET SKAL IKKE FOREKOMME - BLIR IKKE NOE MER RETT OM EN ADDERE
S02   * NÅR DET FOREKOMMER SÅ VIL DET VÆRE PÅ EN ANNE TERMINAL (SPES MÅ FILTRERE TIL OPPDR.)
S02  C**                 EXSR      CARGOSR
N03  C     NEXTREC       TAG
     C     KEYDOK        READE     DOKUFM                                 94
     C  N94              ENDDO
      *
N08  C                   if        ColPod = 'J'
N08  C                   eval      INFOTXT = %trim(infotxt)
N08  C                             +' For å se dato/klokke for Col/Pod velg '
N08  C                             +'L=Se Loggdetaljer'
N08  C                   endif
     C                   IF        ZRECNO>0
     C                   EVAL      ZRECNO=1
     C                   ENDIF
      * Dersom minst 1 CS-psot uten vekt, ikke vis sum...
      *________________
      * Display Subfile
      *""""""""""""""""
     C     START2        TAG

     C                   MOVE      *OFF          *IN51
     C                   MOVEA     '11'          *IN(91)
     C* KOMMER HIT VED TOM FIL
     C     ZRECNO        IFEQ      0
     C                   MOVE      *OFF          *IN94
     C                   ADD       1             ZRECNO
     C                   MOVE      *ON           *IN51
     C                   WRITE     SUBFIL
     C                   SETON                                        94
     C                   ENDIF
     C                   WRITE     WIND01
     C                   WRITE     BUNN
     C     STBUNN        TAG

     C                   EXFMT     SUBCTL

     C                   SETOFF                                       999830
      * FORRIGE
     C   12              GOTO      SLUTT
N01   * REFRESH
N01  C   05              GOTO      START1
N04   * Kolli_IDs under fraktbrev  1
N04  C     *IN13         IFEQ      *ON
N04  C                   MOVE      *BLANK        UVIS              1
N04  C                   CALL      'SYFA10B'
N04  C                   PARM                    UFMAVD
N04  C                   PARM                    UFMOPD
N04  C                   PARM                    UFBNR1
N04  C                   PARM                    ULINR0
N04  C                   PARM                    UVIS
N04  C                   GOTO      START1
N04  C                   ENDIF

     C     ZRECNO        IFNE      0
     C                   MOVE      *OFF          *IN98
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
N06  C     *IN98         IFEQ      '0'
      * Vis detaljer
     C     SFNR          IFEQ      '5'
     C
     C     '00'          CAT       WFMMRK1A:0    XKOID
     C                   MOVEL     WKOTERM1      XKOTERM
     C                   CALL      'SYTR33K2'
     C                   PARM                    XKOID
     C                   PARM                    XKOTERM
     C                   EVAL      SFNR=*BLANKS
     C                   ENDIF
      * L=se Logg
N07  C     SFNR          IFEQ      'L'
     c                   move      'V'           modek             1
     C                   MOVEL     WKOTERM1      XKOTERM
     C                   CALL      'SYFA10B2'
     C                   PARM      WFMMRK1A      XKOID18          18
N07  C                   parm                    modek
     C                   EVAL      SFNR=*BLANKS
     C                   ENDIF
N07   * E=endre logg
N07  C     SFNR          IFEQ      'E'
N07  c                   move      'E'           modek             1
N07  C                   MOVEL     WKOTERM1      XKOTERM
N07  C                   CALL      'SYFA10B2'
N07  C                   PARM      WFMMRK1A      XKOID18          18
N07  C                   parm                    modek
N07  C                   EVAL      SFNR=*BLANKS
N07  C                   ENDIF
N06   * M=print merkelapp
N06  C     SFNR          IFEQ      'M'
N06  C                   EXSR      PrtMlapp
N06  C                   ENDIF
N06   *
N06  C                   END
     C                   ENDDO
     C                   GOTO      START1
     C                   ENDIF

     C     SLUTT         TAG

     C                   SETON                                        LR
S02   *
S02   * DET SKAL IKKE KUNNE FINNES FLERE POSTER I CARGOF BASERT PÅ EN PSOT I DOKUF !!!
S02   *_____________________________________________________
S02   * CARGOSR
S02   *"""""""""""""""""""""""""""""""""""""""""""""""""""""
S02  C*    CARGOSR       BEGSR
S02  C*    WKOID         READE     CARGOF                                 51
S02  C*    *IN51         DOWEQ     *OFF
S02  C*                  EVAL      WKOTERM1=%SUBST(KOTERM:1:3)
S02  C*                  EVAL      WKOINDT=KOINDT
S02  C*                  EVAL      WKOINTI=KOINTI
S02  C*                  EVAL      WKOMVKT=KOMVKT
S02  C*                  EVAL      WKOMM3=KOMM3
S02  C*                  ADD       KOMVKT        XKOMVKT
S02  C*                  ADD       KOMM3         XKOMM3
S02  C*                  ADD       1             ZRECNO
S02  C*    KOMVKT        IFEQ      0
S02  C*                  EVAL      NullVKT = 'Y'
S02  C*                  end
S02  C*                  WRITE     SUBFIL
S02  C*    WKOID         READE     CARGOF                                 51
S02  C*                  ENDDO
S02  C*                  ENDSR
N06   ***********************************************
N06  C     PrtMlapp      BEGSR
N06   ***********************************************
N06  C                   move      HEAVD         HEAVDA            4
N06  C                   move      HEOPD         HEOPDA            7
N06   * Hent printerstyring fra HO-avdeling
N06  C                   CALL      'GETPR3'
N06  C                   PARM                    HEAVDA
N06  C                   PARM      067           zzNR67            3 0
N06  C                   PARM                    zzPRT67          10
N06  C                   PARM                    zzPT67           10
N06  C                   PARM                    zzLAS             2 0
N06  C                   PARM      00            zzLPI             2 0
N06  C                   IF        TROPD2 <> 0
N06  C                   move      TRAVD2        HEAVDA            4
N06  C                   move      TROPD2        HEOPDA            7
N06  C                   ENDIF
N06  C                   CALL      'SYFA12CLL'
N06  C                   PARM                    HEAVDA
N06  C                   PARM                    HEOPDA
N06  C                   PARM      '000'         zzFbn             3
N06  C                   PARM      '00000000'    zzTur             8
N06  C                   PARM                    zzPRT67          10
N06  C                   PARM                    zzPT67           10
N06  C                   PARM      'J'           zzOrig            1
N06  C                   PARM                    WFMMRK1          35
N06  C                   ENDSR
N06   *
N06   *
