      ***************************************************************
      *** PROGRAM FOR VEDLIKEHOLD R38 FRAKTBREV/TOLLPASS          ***
      ***************************************************************
      *             VED MER ENN EN KODE, HENT ALLE
     FDOK29     UF A E           K DISK
     FKODTFT    IF   E           K DISK
     FSYFI10FU  CF   E             WORKSTN
     F                                     INFDS(FBAREA)
      *
      *
     D FBAREA          DS
      * OBS! SKAL HA TIL AKTIVT VINDU      B 370 3710WSCLOC
     D  WSCLOC               382    383B 0
     D                 DS
     D  TX                     1   1120
     D                                     DIM(16)
     D  TXT01                  1     70
     D  TXT02                 71    140
     D  TXT03                141    210
     D  TXT04                211    280
     D  TXT05                281    350
     D  TXT06                351    420
     D  TXT07                421    490
     D  TXT08                491    560
     D  TXT09                561    630
     D  TXT10                631    700
     D  TXT11                701    770
     D  TXT12                771    840
     D  TXT13                841    910
     D  TXT14                911    980
     D  TXT15                981   1050
     D  TXT16               1051   1120
     D                 DS
     D  KO                     1     32
     D                                     DIM(16)
     D  KOD01                  1      2
     D  KOD02                  3      4
     D  KOD03                  5      6
     D  KOD04                  7      8
     D  KOD05                  9     10
     D  KOD06                 11     12
     D  KOD07                 13     14
     D  KOD08                 15     16
     D  KOD09                 17     18
     D  KOD10                 19     20
     D  KOD11                 21     22
     D  KOD12                 23     24
     D  KOD13                 25     26
     D  KOD14                 27     28
     D  KOD15                 29     30
     D  KOD16                 31     32
      *
     C     R29KEY        KLIST
     C                   KFLD                    WAVD
     C                   KFLD                    WOPD
     C                   KFLD                    WFNR
      *
     C     *ENTRY        PLIST
     C                   PARM                    PAVD
     C                   PARM                    POPD
     C                   PARM                    PFNR
     C                   PARM                    PFLAG             1
      *
     C     *LIKE         DEFINE    D29AVD        PAVD
     C     *LIKE         DEFINE    D29OPD        POPD
     C     *LIKE         DEFINE    D29FNR        PFNR
     C     *LIKE         DEFINE    D29AVD        WAVD
     C     *LIKE         DEFINE    D29OPD        WOPD
     C     *LIKE         DEFINE    D29FNR        WFNR
     C                   Z-ADD     1             X                 3 0
     C                   Z-ADD     0             WX                3 0
     C     PFLAG         IFNE      *BLANKS
     C                   MOVE      *ON           *IN88
     C                   ENDIF
      *
     C                   Z-ADD     PAVD          WAVD
     C                   Z-ADD     POPD          WOPD
     C                   Z-ADD     PFNR          WFNR
      * Sjekker først om det finnes noen verdier å vise
     C     R29KEY        SETLL     DOK29
     C     R29KEY        READE(N)  DOK29                                  90
     C     *IN90         DOWEQ     *OFF
     C                   MOVEA     D29TXT        TX(X)
     C                   ADD       1             X
     C     X             IFGT      16
     C                   LEAVE
     C                   ENDIF
     C     R29KEY        READE(N)  DOK29                                  90
     C                   ENDDO
      * Viser bilde
     C     TAG01         TAG
     C                   EXFMT     BILDE1
     C     *IN12         CABEQ     *ON           SLUTT
     C     *IN88         CABEQ     *ON           SLUTT
      * Søk på fritekstkoder
     C     *IN04         IFEQ      *ON
     C                   EXSR      SOEK
     C                   GOTO      TAG01
     C                   ENDIF
      * Sjekk om det skal hentes noe fritekst
     C                   EXSR      GETTXT
     C     XHENT         CABEQ     'J'           TAG01
     C     *IN30         CABEQ     *ON           TAG01
      * Enter medfører oppdatering, først sletting og deretter WRITE
     C     R29KEY        SETLL     DOK29
     C     R29KEY        READE     DOK29                                  90
     C     *IN90         DOWEQ     *OFF
     C                   DELETE    DOK29R
     C     R29KEY        READE     DOK29                                  90
     C                   ENDDO
      * Skriver så alle poster til fil.
      * Skriver også blanke linjer, men ikke når det er bare blanke
     C                   Z-ADD     1             X
     C                   Z-ADD     0             WX
     C                   DO        16
     C     TX(X)         IFNE      *BLANKS
     C                   Z-ADD     X             WX
     C                   ENDIF
     C                   ADD       1             X
     C                   ENDDO
     C                   Z-ADD     1             X
     C     WX            IFGT      0
     C                   DO        16
     C                   MOVEA     TX(X)         D29TXT
     C                   Z-ADD     WAVD          D29AVD
     C                   Z-ADD     WOPD          D29OPD
     C                   Z-ADD     WFNR          D29FNR
     C                   WRITE     DOK29R
     C     X             IFGE      WX
     C                   LEAVE
     C                   ENDIF
     C                   ADD       1             X
     C                   ENDDO
     C                   ENDIF
      *
      * Låner parameter P-flagg for å indikere (for SYFI10a) at en skal videre til T-info
     c     *in17         ifeq      *ON
     C                   MOVE      'T'           PFLAG
     c                   end
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *****************************************************************
     C     SOEK          BEGSR
      *****************************************************************
     C     WSCLOC        DIV       256           LINNBR            3 0
     C                   MOVEL     *BLANKS       PKODE             2
     C                   CALL      'SYFI10I'
     C                   PARM                    PKODE
     C     LINNBR        IFGT      3
     C     LINNBR        ANDLT     20
     C     LINNBR        SUB       3             X
     C                   MOVEL     PKODE         KO(X)
     C                   ENDIF
      *
     C                   ENDSR
      *****************************************************************
     C     GETTXT        BEGSR
      *****************************************************************
     C                   Z-ADD     0             X                 3 0
     C                   Z-ADD     0             Y                 3 0
     C                   MOVE      'N'           XHENT             1
     C                   MOVE      *OFF          *IN30
     C                   DO        16
     C                   ADD       1             X
     C     KO(X)         IFNE      *BLANKS
     C                   MOVE      *ON           *IN30
     C     KO(X)         SETLL     KODTFT                                 90
     C     *IN90         IFEQ      *ON                                          <RECORD FINNES
     C                   Z-ADD     X             Y
     C     KO(X)         READE     KODTFT                                 90
     C     *IN90         DOWEQ     *OFF
     C     Y             IFGT      16
     C                   LEAVE
     C                   ENDIF
     C                   MOVEL     KFTFTX        TX(Y)
     C                   ADD       1             Y
     C     KO(X)         READE     KODTFT                                 90
     C                   ENDDO                                                  <*IN90
     C                   ENDIF                                                  <*IN90
     C                   MOVEA     *BLANKS       KO(X)
     C                   MOVE      'J'           XHENT
     C                   ENDIF                                                  <KO,X
     C                   ENDDO                                                  <DO 16
      *
     C                   ENDSR
