********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 ny parameter til arc014
10XXX * 02 SH  PTF10 årstall + div test årstall
10XXX * 03 SH  PTF10 feil i ds
10XXX * 04 SH  PTF10 forbedring L1
10XXX * 05 SH  PTF10 rettelse bilag
10XXX * 06 SH  PTF10 rettelse samlefaktura
10XXX * 07 SH  PTF10 også 2 dokumenter ved scannet
10XXX * 08 SH  PTF11 L1 faktura
10XXX * 09 SH  PTF12 årstall fakturanummer
10XXX * 10 SH  PTF12 eventuell i history
********************************************************************
      *
      ***********************************************************
      *** PROGRAM vise fakrtura fra arkiv
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 04 05 08 11 13-24                ***
      *** LEDIGE INDIKATORER 36-47 52-90 95-97                ***
      ***********************************************************
      *
      * 50 = TAX AND TOTAL-LINES ON SCREEN
      *
     FARKEXT    IF   E           K DISK
     FARKTXT    IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     Faruserf   IF   E           K DISK
     FARKIVL06  IF   E           K DISK
     FKOSTA14   IF   E           K DISK
     FARKIVL11  IF   E           K DISK
     F                                     RENAME(arkivr:arkivr11)
      *___________________________
      * Finner username
      *"""""""""""""""""""""""""""
     D                SDS
     D  ZUSER                254    263
N03  D                 DS
N03  D  ARLINK                 1     40
     D  ARAAR                  3      6
     D  ARAARN                 3      6  0
     C*
     C     *entry        plist
     C                   parm                    ufirm             2
     C                   parm                    ufakt             7
n01  C                   parm                    fakkos            1
n03  C                   parm                    uaar              4
      *
     c     keykos        klist
     c                   kfld                    KODEA             1
     c                   kfld                    XXunde           10
      *
      *
n07  c     keykos2       klist
n07  c                   kfld                    KODEA             1
n07  c                   kfld                    XXunde           10
n07  c                   kfld                    arlink
      *
     C*
     C     arklagk       KLIST
     C                   KFLD                    ufirm
     C                   KFLD                    arklag
     C*
     c     keya          klist
     c                   kfld                    FIRM              2
     c                   kfld                    KODE              2
     c                   kfld                    FAKT             10
     c                   move      ufirm         firm
     c                   move      'fa'          kode
     c                   move      'A'           kodea
     c                   movel     ufakt         fakt
n01  c     fakkos        cabeq     'K'           kost
s09  c*    keya          chain     arkivl06                           44
n09  c                   exsr      arkivl06sr
     c  N44              move      arlink        arlink1          40
      *
     c     *in(44)       ifeq      '1'
     c                   move      'ta'          kode
s09  c*    keya          chain     arkivl06                           44
n09  c                   exsr      arkivl06sr
     c  N44              move      arlink        arlink1          40
      *
     c     *in(44)       ifeq      '1'
     c                   move      'ff'          kode
s09  c*    keya          chain     arkivl06                           44
n09  c                   exsr      arkivl06sr
     c  N44              move      arlink        arlink1          40
      *
n08  c     *in(44)       ifeq      '1'
n08  c                   move      'lf'          kode
s09  c*    keya          chain     arkivl06                           44
n09  c                   exsr      arkivl06sr
n08  c  N44              move      arlink        arlink1          40
      *
      *
     c     *in(44)       ifeq      '1'
     c                   move      'fs'          kode
s09  c*    keya          chain     arkivl06                           44
n09  c                   exsr      arkivl06sr
     c  N44              move      arlink        arlink1          40
      *
      *
      *
     c                   move      'fx'          kode
s09  c*    keya          chain     arkivl06                           44
n09  c                   exsr      arkivl06sr
     C  N44ARLINK1       IFEQ      *BLANKS
     c                   move      arlink        arlink1          40
     C                   ELSE
     C                   MOVE      'J'           TO                1
     c                   move      arlink        arlink2          40
     C                   END
     c                   end
n06  c     arlink1       ifne      *blanks
n06  c                   setoff                                       44
n06  c                   end
      **********************************
      * test om kostnadsbilag
      **********************************
     c     *in(44)       ifeq      '1'
n01  c     kost          tag
     c                   move      ufakt         bil6              7 0
     c                   z-add     bil6          kabnr2               44
     c     kabnr2        chain     kosta14                            44
     c     *in(44)       ifeq      '0'
     c                   movel     'KL:'         xxunde
     c                   move      kabnr         xxunde
     c     keykos        chain     arkivl11                           44
n05  c  N44              movel     kapcc         aark              4
n05  c  N44              move      kapÅr         aark
s05  c* N44uaar          comp      araar                              4444
n05  c  N44uaar          comp      aark                               4444
     c  N44              move      arlink        arlink1          40
     c  N44              move      'J'           scannet           1
N07  c     *in44         ifeq      '0'
N07  c     keykos2       setgt     arkivl11
N07  c     keykos        reade     arkivl11                               37
N07  c  N37              move      arlink        arlink2          40
N07  C  N37              MOVE      'J'           TO                1
N07  c                   end
     c                   end
     c                   end
     c                   end
      * Fantes ikke via kostnadsføring.. Rent L1-bilag/ren L1-scan ??
     c     *in(44)       ifeq      '1'
     c                   movel     'L1:'         xxunde
     c                   move      Bil6          xxunde
n04  c                   setoff                                       44
n04  c     keykos        setll     arkivl11
n04  c     *in44         doweq     '0'
n04  c     keykos        reade     arkivl11                               44
n04  c     *in44         ifeq      '0'
n04  c     uaar          comp      araar                                  45
n04  c     *in45         ifeq      '1'
n04  c                   goto      utok
n04  c                   endif
n04  c                   endif
n04  c                   enddo
n04  c     utok          tag
      *
      *
s04  c*    keykos        chain     arkivl11                           44
s04  c* N44uaar          comp      araar                              4444
s04  c*  44araar         ifne      *blanks
s04  c*  44araarn        sub       1             nyaar             4 0
s04  c*  44              move      nyaar         nyaara            4
s04  c*  44uaar          comp      nyaara                             4444
s04  c*                  end
     c  N44              move      arlink        arlink1          40
     c  N44              move      'J'           scannet           1
     c                   end
n08  c                   end
     c                   end
      *
     c     *in44         ifeq      '0'
      *
      * SKJEKKER HVA SLAGS FAKTURA DET ER SNAKK OM
      *
     c                   move      'I'           arinek
     C     ufirm         CHAIN     FIRMARC                            32
     c  n32zuser         chain     aruserf                            39
     c     *in(32)       ifeq      '0'
N10  c     arbhis        ifne      *blanks
N10  c                   eval      arcane=arbhis
N10  c                   end
     c                   exsr      pdfinv
     c                   end
     c                   end
      *
      * vise   spesifikasjon gå til topp
      *
     c                   seton                                        lr
     c                   return
     C*
     C***********************************************
     C     PDFINV        BEGSR
     C***********************************************
     c* eksternt lager
     c     artype        chain     ARKTXT                             33
     C  N33ARKLAG        IFNE      *blanks
     c     arklagk       chain     arkext                             33
N10  c  N33arbhis        ifne      *blanks
N10  c                   eval      arcane=arbhis
N10  c                   end
     c                   end
     C                   MOVE      'J'           Avise             1
     C                   move      *blanks       updf1            70
     C                   move      *blanks       updf2            70
     c                   movel     'http://'     updf1
      * INTER/EKSTERN
     c     arinek        ifeq      'I'
     C     updf1         CAT       arcpad:0      updf1
     c                   else
     C     updf1         CAT       arcpae:0      updf1
     c                   end
      *
     C     updf1         CAT       '/':0         updf1
     C     updf1         CAT       arcane:0      updf1
     C     updf1         CAT       '/':0         updf1
     c                   moveL     updf1         updf2
     C     updf1         CAT       arlink1:0     updf1
     C     '.pdf'        SCAN      updf1                                  33
     C  N33'.PDF'        SCAN      updf1                                  33
     c     scannet       ifne      'J'
     C     *in33         andeq     '0'
     C     updf1         CAT       '.pdf':0      updf1
     c                   end
     C     updf2         CAT       arlink2:0     updf2
     C     '.pdf'        SCAN      updf2                                  33
     C  N33'.PDF'        SCAN      updf2                                  33
     c     scannet       ifne      'J'
     C     *in33         andeq     '0'
     C     updf2         CAT       '.pdf':0      updf2
     c                   end
     c*
     c     arlink2       ifeq      *blanks
     c                   move      *blanks       updf2
     c                   end
     C                   CALL      'SYGE33CL'
     C                   PARM                    updf1
     C     TO            IFEQ      'J'
     C                   CALL      'SYGE33CL'
     C                   PARM                    updf2
     C                   END
     C                   ENDSR
     C*
n09   **********************************************************
n09  c     arkivl06sr    begsr
n09   **********************************************************
n09  c                   setoff                                       44
n09  c                   setoff                                       45
n09  c     keya          setgt     arkivL06
n09  c     *in44         doweq     '0'
n09  c     keya          readpe    arkivl06                               44
n09  c     *in44         ifeq      '0'
n09  c     uaar          comp      araar                                  45
n09  c     *in45         ifeq      '1'
n11  c     artype        oreq      'fa'
n11  c     artype        oreq      'fs'
n11  c     artype        oreq      'fx'
n09  c                   goto      utsr
n09  c                   endif
n09  c                   endif
n09  c                   enddo
n09  c     utsr          endsr
