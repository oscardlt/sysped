********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 FEILTEST P≈ DATO
********************************************************************
      *
      **************************************************************
      *** PROGRAM SKAL VEDLIKEHOLDE FISKEAVGIFTER                ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER       ***
      *** LEDIGE INDIKATORER 01 02 04 07 09-11 13-24             ***
      *** LEDIGE INDIKATORER 27-29 31 32 34-39 41-87 95-97       ***
      **************************************************************
      *
     Fsysthlp   IF   E             DISK
     FSADAVGE   UF A E           K DISK
E01  FSADAETST  IF   E           K DISK    PREFIX(TS_)
     F                                     RENAME(SADAVGER:SADAETR)
     FTARI      IF   E           K DISK
     FSAD015FM  CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  WXDTFD                 1      2  0
     D  WXDTFM                 3      4  0
     D  WXDTF≈                 5      8  0
     D  WXDTF                  1      8  0
     D                 DS
     D  WSDTFD                 1      2  0
     D  WSDTFM                 3      4  0
     D  WSDTF≈                 5      8  0
     D  WSDTF                  1      8  0
     D                 DS
     D  AGDTF≈                 1      4  0
     D  AGDTFM                 5      6  0
     D  AGDTFD                 7      8  0
     D  AGDTF                  1      8  0
     D                 DS
     D  AXDTF≈                 1      4  0
     D  AXDTFM                 5      6  0
     D  AXDTFD                 7      8  0
     D  AXDTF                  1      8  0
     D                 DS
     D  WXDTTD                 1      2  0
     D  WXDTTM                 3      4  0
     D  WXDTT≈                 5      8  0
     D  WXDTT                  1      8  0
     D                 DS
     D  WSDTTD                 1      2  0
     D  WSDTTM                 3      4  0
     D  WSDTT≈                 5      8  0
     D  WSDTT                  1      8  0
     D                 DS
     D  AGDTT≈                 1      4  0
     D  AGDTTM                 5      6  0
     D  AGDTTD                 7      8  0
     D  AGDTT                  1      8  0
     D                 DS
     D  AXDTT≈                 1      4  0
     D  AXDTTM                 5      6  0
     D  AXDTTD                 7      8  0
     D  AXDTT                  1      8  0
      *
     C                   EXSR      INIT
      *
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
     C                   MOVE      *ZEROS        YTANR             8 0
     C                   MOVE      *ZEROS        YDTF              8 0
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     W2TANR        SETLL     SADAVGE
     C                   READ(N)   SADAVGE                                94
      *
     C     *IN94         DOWEQ     *OFF
     C                   ADD       1             ZRECNO
     C     TARIK1        CHAIN     TARI                               33
     C     *IN33         IFEQ      *ON
     C                   MOVE      *BLANKS       TAALFA
     C                   MOVEL     '*UKJENT'     TAALFA
     C                   END
     C     AGAKTK        IFEQ      'I'
     C                   MOVEL     'INAKTIV'     AGST
     C                   ELSE
     C                   MOVEL     'AKTIV  '     AGST
     C                   END
     C                   MOVE      AGDTFD        WXDTFD
     C                   MOVE      AGDTFM        WXDTFM
     C                   MOVE      AGDTF≈        WXDTF≈
     C                   MOVE      AGDTTD        WXDTTD
     C                   MOVE      AGDTTM        WXDTTM
     C                   MOVE      AGDTT≈        WXDTT≈
     C                   WRITE     SUBFIL
     C                   READ(N)   SADAVGE                                94
     C  N94              ENDDO
      *
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
     C     ZRECNO        IFGT      1
     C                   Z-ADD     1             ZRECNO
     C                   END
      *
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   EXFMT     NYWRK
     c   01              do
     c                   movel     'sad015'      hlpna             8
     c                   exsr      helpsr
     C                   GOTO      START3
     c                   end
     C                   ELSE
     C                   WRITE     SUBCTL
     C                   EXFMT     BUNN
     c   01              do
     c                   movel     'sad015'      hlpna             8
     c                   exsr      helpsr
     C                   GOTO      START3
     c                   end
     C                   END
     C*
     C***
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   END
     C***
     C*
     C                   SETOFF                                       989930
      *
     C   03              GOTO      SLUTT
      *** FRISK OPP
     C   05              GOTO      START
      *** LAGE NY
     C   06              DO
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     5             POSNBR
     C                   MOVE      *OFF          *IN40
     C                   MOVE      *ZEROS        WSTANR
     C                   MOVE      *BLANKS       TAALFA
     C                   GOTO      START5
     C                   END
      *** SOEK FRA
     C   08              GOTO      START6
      *
     C     ZRECNO        IFNE      0
     C                   EXSR      HENT
     C                   END
     C   98XRECNO        IFNE      0
     C                   Z-ADD     XRECNO        ZRECNO
     C                   END
     C                   GOTO      START3
      *
      *** LAGE NY
     C     START5        TAG
     C                   EXFMT     VARELI
     c   01              do
     c                   movel     'sad015'      hlpna             8
     c                   exsr      helpsr
     C                   GOTO      START5
     c                   end
     C                   MOVEA     '000'         *IN(88)
     C                   SETOFF                                       30
     C  N12              EXSR      TESTB1
     C  N12
     CAN 30              GOTO      START5
     C  N12              EXSR      OPDREC
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   GOTO      START3
      *
      *** SÿK
     C     START6        TAG
     C                   MOVE      *ZEROS        W2TANR
     C                   EXFMT     SOKAVG
     c   01              do
     c                   movel     'sad015'      hlpna             8
     c                   exsr      helpsr
     C                   GOTO      START
     c                   end
     C   12              GOTO      START6
     C                   GOTO      START
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
      *
      *** TEST TARIFFNR.
     C     TARIK2        CHAIN     TARI                               90
     C     *IN90         IFEQ      *ON
     C                   MOVE      'SPT0033'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
      *
      * TEST F.O.M. DATO
     C                   CALL      'TESTDATO'
     C                   PARM      WSDTFD        XDD               2 0
     C                   PARM      WSDTFM        XMM               2 0
     C                   PARM      WSDTF≈        X≈≈
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVE      'SPD0001'     MSGNR
     C                   MOVE      '1'           *IN88
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLT1
     C                   END
      *
      * TEST F.O.M. DATO
     C                   IF        WSDTT <> 99999999
     C                   CALL      'TESTDATO'
     C                   PARM      WSDTTD        XDD               2 0
     C                   PARM      WSDTTM        XMM               2 0
     C                   PARM      WSDTT≈        X≈≈               2 0
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVE      'SPD0001'     MSGNR
     C                   MOVE      '1'           *IN87
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLT1
     C                   END
     C                   END
      *
     C                   MOVE      WSDTFD        AXDTFD
     C                   MOVE      WSDTFM        AXDTFM
     C                   MOVE      WSDTF≈        AXDTF≈
     C                   MOVE      WSDTTD        AXDTTD
     C                   MOVE      WSDTTM        AXDTTM
     C                   MOVE      WSDTT≈        AXDTT≈
     C     WSDTT         IFNE      99999999
     C     AXDTF         IFGT      AXDTT
     C                   MOVE      'SPD0007'     MSGNR
     C                   MOVEA     '11'          *IN(87)
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLT1
     C                   END
     C                   END
      *
     C     AGK11         SETLL     SADAETST
     C     AGKEY1        READPE    SADAETST                               33
     C     *IN33         IFEQ      '0'
S01  C*    AXDTF         ANDNE     AGDTF
S01  C*    AXDTF         ANDLT     AGDTT
N01  C     AXDTF         ANDLT     TS_AGDTT
     C                   MOVE      'YBC1795'     MSGNR
     C                   MOVEA     '11'          *IN(87)
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLT1
     C                   END
S01  C*    AGK11         SETLL     SADAETST
S01  C*    AGKEY1        READPE    SADAETST                               33
S01  C*    *IN33         IFEQ      '0'
S01  C*    AXDTF         ANDNE     AGDTF
S01  C*    AXDTT         ANDGT     AGDTF
S01  C*                  MOVE      'YBC1795'     MSGNR
S01  C*                  MOVEA     '11'          *IN(87)
S01  C*                  MOVE      '1'           *IN30
S01  C*                  GOTO      SLT1
S01  C*                  END
     C*
     C*** TEST SEKVENSNR
     C     WSSKV         COMP      *BLANKS                                89
     C     *IN89         IFEQ      *ON
     C  N30              MOVE      'YBC0769'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
      *
      *** TEST SATS
     C     WSSATS        COMP      0                                      86
     C     *IN86         IFEQ      *ON
     C  N30              MOVE      'YBC0770'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
      *
     C     SLT1          TAG
     C   30              Z-ADD     22            LINNBR
     C   86              Z-ADD     67            POSNBR
     C   87              Z-ADD     51            POSNBR
     C   88              Z-ADD     42            POSNBR
     C   89              Z-ADD     36            POSNBR
     C   90              Z-ADD     5             POSNBR
      *
     C                   ENDSR
      *
     C***********************************************
     C     HENT          BEGSR
     C***********************************************
     C                   SETOFF                                       919299
      *
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
      *
     C   98              DO
     C   99              SETOFF                                       98
     C   98              MOVE      'DIV0012'     MSGNR
     C   98              SETON                                            30
     C                   Z-ADD     2             LINNBR
     C                   GOTO      SLHENT
     C                   END
      *
     C     ZRECNO        DIV       15            LINNBR
     C                   MVR                     LINNBR
     C     LINNBR        IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   END
      *
     C     WSNR          IFEQ      '2'
     C                   MOVE      ' '           WSNR
     C     AGST          COMP      'AKTIV'                            9898
     C   98              MOVE      'DIV0012'     MSGNR
     C   98              SETON                                            30
     C   98              GOTO      SLHENT
     C                   EXSR      CHGREC
     C   12              GOTO      SLHENT
     C                   END
      *
     C     WSNR          IFEQ      'A'
     C     AGKEY2        CHAIN     SADAVGE                            33
     C                   MOVE      'A'           AGAKTK
     C                   UPDATE    SADAVGER
     C                   MOVEL     'AKTIV  '     AGST
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   MOVE      '1'           *IN99
     C                   END
      *
     C     WSNR          IFEQ      'I'
     C     AGKEY2        CHAIN     SADAVGE                            33
     C                   MOVE      'I'           AGAKTK
     C                   UPDATE    SADAVGER
     C                   MOVEL     'INAKTIV'     AGST
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   END
      *
     C                   END
      *
     C     SLHENT        TAG
     C                   ADD       3             LINNBR
     C                   Z-ADD     2             POSNBR
      *
     C                   ENDSR
      *
     C***********************************************
     C     CHGREC        BEGSR
     C***********************************************
     C                   EXSR      MOVAGW
     C                   SETON                                        99
     C     STCHG         TAG
     C                   EXFMT     VARELI
     c   01              do
     c                   movel     'sad015'      hlpna             8
     c                   exsr      helpsr
     C                   GOTO      STCHG
     c                   end
     C                   MOVEA     '000'         *IN(88)
     C                   SETOFF                                       30
     C   12              UPDATE    SUBFIL
     C  N12              EXSR      TESTB1
     C  N12
     CAN 30              GOTO      STCHG
     C  N12              EXSR      OPDREC
     C     LINNBR        IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     OPDREC        BEGSR
     C***********************************************
S01  C*    AGKEY1        CHAIN     SADAVGE                            33
N01  C     AGK11         CHAIN     SADAVGE                            33
     C                   EXSR      MOVWAG
     C  N33              UPDATE    SADAVGER
     C   33              WRITE     SADAVGER
      *
     C                   MOVE      AGDTFD        WXDTFD
     C                   MOVE      AGDTFM        WXDTFM
     C                   MOVE      AGDTF≈        WXDTF≈
     C                   MOVE      AGDTTD        WXDTTD
     C                   MOVE      AGDTTM        WXDTTM
     C                   MOVE      AGDTT≈        WXDTT≈
     C   40              UPDATE    SUBFIL
     C  N40              ADD       1             YRECNO
     C  N40              Z-ADD     YRECNO        ZRECNO
     C  N40              WRITE     SUBFIL
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVAGW        BEGSR
     C***********************************************
     C                   MOVE      AGTANR        WSTANR
     C                   MOVE      AGAKD         WSAKD
     C                   MOVE      AGSKV         WSSKV
     C                   MOVE      AGKD          WSKD
     C                   MOVE      AGPP          WSPP
     C                   MOVE      AGSATS        WSSATS
     C                   MOVE      AGDTFD        WSDTFD
     C                   MOVE      AGDTFM        WSDTFM
     C                   MOVE      AGDTF≈        WSDTF≈
     C                   MOVE      AGDTTD        WSDTTD
     C                   MOVE      AGDTTM        WSDTTM
     C                   MOVE      AGDTT≈        WSDTT≈
     C                   MOVE      '1'           *IN40
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     67            POSNBR
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVWAG        BEGSR
     C***********************************************
     C                   MOVE      WSTANR        AGTANR
     C                   MOVE      WSAKD         AGAKD
     C                   MOVE      WSSKV         AGSKV
     C                   MOVE      WSKD          AGKD
     C                   MOVE      WSPP          AGPP
     C                   MOVE      WSSATS        AGSATS
     C                   MOVE      AXDTF         AGDTF
     C                   MOVE      AXDTT         AGDTT
     C                   MOVE      'A'           AGAKTK
     C                   MOVEL     'AKTIV  '     AGST
      *
     C                   ENDSR
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     TARIK1        KLIST
     C                   KFLD                    AGTANR
     C                   KFLD                    YTAR
     C     TARIK2        KLIST
     C                   KFLD                    WSTANR
     C                   KFLD                    YTAR
     C     AGKEY1        KLIST
     C                   KFLD                    WSTANR
     C                   KFLD                    WSAKD
     C                   KFLD                    WSSKV
     C     AGK11         KLIST
     C                   KFLD                    WSTANR
     C                   KFLD                    WSAKD
     C                   KFLD                    WSSKV
     C                   KFLD                    AXDTF
     C     AGKEY2        KLIST
     C                   KFLD                    AGTANR
     C                   KFLD                    AGAKD
     C                   KFLD                    AGSKV
     C                   KFLD                    AGDTF
      *
     C                   MOVE      *ZEROS        W2TANR
     C                   MOVE      *BLANKS       YTAR              3
     C                   MOVE      'FF'          WSAKD
     C                   MOVE      '100'         WSSKV
     C                   MOVE      'P'           WSPP
     C                   MOVE      *ZEROS        WSDTF
     C                   MOVE      *ZEROS        WSDTT
      *
     C                   ENDSR
     C***********************************************
     C     HELPSR        BEGSR
     C***********************************************
     c
     c                   move      *blanks       pcocmd           70
     c     1             chain     systhlp                            33
     c     *in(33)       ifeq      '0'
      *
      * intern
     c                   movel     'http://'     pcocmd
     C     pcocmd        CAT       systip:0      pcocmd
     C     pcocmd        CAT       '/':0         pcocmd
     C     pcocmd        CAT       systba:0      pcocmd
     C     pcocmd        CAT       '/':0         pcocmd
     C     pcocmd        CAT       hlpna:0       pcocmd
     C     pcocmd        CAT       '.htm':0      pcocmd
      *
     c                   call      'SYGE34CL'
     c                   parm                    pcocmd
     c                   end
     C                   ENDSR
      *
