      * kompilering: addlible libhttp
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11023 * 01 CB  PTF11 Feilet med å alltid finne LF
      * 02 JOV PTF12 TOTALT endret, same input men bruker nå QSH-kommando tr = translate
********************************************************************
     H DFTACTGRP(*NO) BNDDIR('HTTPAPI')
      /copy qrpglesrc,httpapi_h
     D rc              s             10i 0
     D CmdLine         S            512
     D CmdLen          S             15  5
     D FileName        s            256                                         Fullt m/path
     D EntryName       s            120                                         Bare filnavnet
     D FileBack        s            256
     D FileTemp        s             45A   varying
     D Tsz             S               Z
     D Ts              S             26
      * Definere  hex appostrof
     D Ap              c                   x'7D'
      *______
      * Input
      *""""""
     C     *ENTRY        PLIST
     C                   parm                    FileName
     C                   parm                    EntryName
      *
     C     Qcmdexc       PLIST
     C                   PARM                    CmdLine
     C                   PARM                    Cmdlen
      *
N06  C                   TIME                    Tsz
N06  C                   MOVEL     Tsz           TS
     c                   eval      rc = %scan(%trim(EntryName):FileName)
     C                   eval      FileBack = %subst(FileName:1:rc-1)+'BACKUP/'
     c                                      + TS + '-Orig-'+ EntryName
     c                   eval      FileTemp = http_tempfile()
      * Translate til tempfil
      *                        eksempel: qsh cmd('tr -d "\r\n" <infile> outfile')
     C                   eval      Cmdline= 'QSH cmd('+Ap+ 'tr -d "\r\n" '
     C                                    + '<'+ %trim(FileName)+'> '
     C                                    + %trim(FileTemp)+Ap+')'
N09  C                   EVAL      CmdLen = %len(%trim(CmdLine))
     C                   CALL      'QCMDEXC'     Qcmdexc
      * flytt original til bakupmappe
     C                   eval      Cmdline= 'mov obj('+Ap+%trim(FileName)+Ap+')'
     C                                   + ' toobj('+Ap+ %trim(FileBack)+Ap+')'
N09  C                   EVAL      CmdLen = %len(%trim(CmdLine))
     C                   CALL      'QCMDEXC'     Qcmdexc
      * flytt temp til originalt filnavn
     C                   eval      Cmdline= 'mov obj('+Ap+%trim(FileTemp)+Ap+')'
     C                                   + ' toobj('+Ap+ %trim(FileName)+Ap+')'
N09  C                   EVAL      CmdLen = %len(%trim(CmdLine))
     C                   CALL      'QCMDEXC'     Qcmdexc
      *
     C                   EVAL      *INLR = *On
     C                   RETURN
