      *
      ***********************************************************
      *** PROGRAM for  forenklet prosedyre skriver samleliste  **
      ***********************************************************
      *
     FFRISOK    IF   E           K DISK
     FHEADF     IF   E           K DISK
     FSTANDI    IF   E           K DISK
     FSADH      IF   E           K DISK
     FSADV      IF   E           K DISK
     FFPXREF1   IF   E           K DISK
     FFP0004F   O  A E             disk
      *
     D                UDS
     D                SDS
     D  ZUSER                254    263
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XDDMM                  7     10  0
     D  XUL電                 11     14  0
     D                 DS
     D  UL電                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     C                   EXSR      INIT
     c                   EXSR      LES
     c                   seton                                        lr
     c                   return
     C*
     C***********************************************
     C     LES           BEGSR
     C***********************************************
     c     key           chain     fpxref1                            33
     C     KEYSADf       CHAIN     SADH                               34
     c  N34              movel     sirg          orgnr
      *
     c                   setoff                                       33
     c     key           setll     fpxref1
     c     *in(33)       doweq     '0'
     c     key           READE     fpxref1                                33
     c     *in(33)       IFEQ      '0'
      *
      * hent antall kolli
      *
     C                   CLEAR                   SADHR
     C     KEYSAD        CHAIN     SADH                               34
     C                   CLEAR                   HEADFR
     C     KEYSAD        CHAIN     HEADF                              34
     C  N34              MOVEL     HESDL         UTLS
     C  N34              MOVEL     HEVS1         VABE
     c     keyfri        chain     frisok                             34
     c  n34              movel     fssok         fr15
     c                   EXSR      SADVSR
     c                   write     FP0004FR
     c                   end
     c                   end
     C                   ENDSR
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     *entry        plist
     c                   parm                    uavd              4 0
     c                   parm                    uopd              7 0
      *
     c                   move      'O'           sta               1
     c                   move      uavd          avd               4 0
     c                   move      uopd          opd               7 0
      *
     c     avd           chain     standi                             33
     c  N33              movel     s0004         dekl
     C     key           KLIST
     C                   KFLD                    sta
     C                   KFLD                    avd
     C                   KFLD                    opd
     C*
     C     keyfri        KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C                   KFLD                    kode
     c                   move      '*CR'         kode              3
     C     keysad        KLIST
     C                   KFLD                    FPAVD
     C                   KFLD                    FPOPD
      *
     C     keysadf       KLIST
     C                   KFLD                    FPAVDH
     C                   KFLD                    FPOPDH
      *
      *
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XUL電         UL電
     C                   ENDSR
     C***********************************************
     C     SADVSR        BEGSR
     C***********************************************
      *
     C                   Z-ADD     0             NOKFRI           13 2
     C                   Z-ADD     0             NOKTOL           13 2
     C                   Z-ADD     0             VALFRI           13 2
     C                   Z-ADD     0             VALTOL           13 2
     C                   Z-ADD     0             VALSUM           13 2
     C                   Z-ADD     0             NOKSUM           13 2
     C                   Z-ADD     0             BRUVKT           12 2
      *
     c                   setoff                                       35
     c     KEYSAD        setll     SADV
     c     *in(35)       doweq     '0'
     c     keySAD        READE     SADV                                   35
     c     *in(35)       IFEQ      '0'
     C                   ADD       SVBELT        VALSUM
     C                   ADD       SVBELS        NOKSUM
     C                   ADD       SVVKTB        BRUVKT
     c                   movel     svvnt         hsnr
     C     SVPVA         IFEQ      'F'
     C                   ADD       SVBELS        NOKFRI
     C                   ADD       SVBELT        VALFRI
     C                   ADD       SVBELS        NOKFRI
     C                   ADD       SVBELT        VALFRI
     C                   ELSE
     C                   ADD       SVBELS        NOKTOL
     C                   ADD       SVBELT        VALTOL
     C                   END
     c                   end
     c                   end
     C                   ENDSR
