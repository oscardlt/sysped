********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12248 * 01 YBC PTF12 VEKT, KOLLI ER UTVIDET.
********************************************************************
     FXMLRCVF   IF   E           K DISK
     FXMLRCVF01 IF   E           K DISK    RENAME(XMLRCVFR:XMLRCVFR01)
     FXMLRCVF02 IF   E           K DISK    RENAME(XMLRCVFR:XMLRCVFR02)
     FXMLRCVF03 IF   E           K DISK    RENAME(XMLRCVFR:XMLRCVFR03)
     FXMLRCAF   IF   E           K DISK
     FEDIS      IF   E           K DISK
     FEDIM      O  A E             DISK
     FEDIC      UF   E             DISK
     FCUNDL01   UF A E           K DISK
     FSYPARL3   UF A E           K DISK
     FFIRKU     UF   E           K DISK
     FTELLGE    UF   E           K DISK
     FHEADF     UF A E           K DISK
     FSAEH      UF A E           K DISK
     FSTANDE    UF   E           K DISK
     FFRISOL01  IF A E           K DISK
     FFIRM      IF   E           K DISK
     FKODTLB    IF   E           K DISK
     FKODTSI    IF   E           K DISK
     FKODTS2    IF   E           K DISK
     FKODTVAL2  IF   E           K DISK

     D                 DS
     D  XTXT                   1     15
     D  XT                     1     15    DIM(15)
     D                 DS
     D  XTAL                   1     15  3
     D  XTALH                  1     12  0
     D  XTALD1                13     13
     D  XTALD2                14     14
     D  XTALD3                15     15
     D                 DS
     D  XCHKTAL                1     10
     D  XCT                    1     10    DIM(10)
     D                 DS
     D  SEKTC                  1      1
     D  SEKTA                  2      6  0
     D  SEKTB                  7      8  0
     D  SEKT8                  1      8
     D  SEKT7                  2      8
     D                 DS
     D  HEAVD                  1      4  0
     D  SEAVD                  1      4  0
     D  SVAVD                  1      4  0
     D  FSAVD                  1      4  0
     D  HEOPD                  5     11  0
     D  SETDN                  5     11  0
     D  SVTDN                  5     11  0
     D  FSOPD                  5     11  0
     D  HESG                  12     14
     D  SESG                  12     14
     D  X14S                   1     14
     D                 DS
     D  HEDTOP                 1      8  0
     D  HEDTR                  1      8  0
     D  SEDT                   1      8  0
     D  FSDTOP                 1      8  0
     D                 DS
     D  HENAS                  1     30
     D  SENAK                  1     30
     D                 DS
     D  HEADS1                 1     30
     D  SEADK1                 1     30
     D                 DS
     D  HEADS2                 1     30
     D  SEADK2                 1     30
     D                 DS
     D  HEADS3                 1     30
     D  SEADK3                 1     30
     D                 DS
     D  HENAK                  1     30
     D  SENAS                  1     30
     D                 DS
     D  HEKNS                  1      8  0
     D  SEKNK                  1      8  0
     D                 DS
     D  HEADK1                 1     30
     D  SEADS1                 1     30
     D                 DS
     D  HEADK2                 1     30
     D  SEADS2                 1     30
     D                 DS
     D  HEADK3                 1     30
     D  SEADS3                 1     30
     D                 DS
S01  D* HEVKT                  1      9  0
S01  D* SEVKB                  1      9  0
N01  D  HEVKT                  3     11  0
N01  D  SEVKB                  1     11  0
     D                 DS
S01  D* HENT                   1      7  0
S01  D* SENTK                  1      7  0
N01  D  HENT                   4     10  0
N01  D  SENTK                  1     10  0
     D                 DS
     D  HEFR                   1      3
     D  SELV                   1      3
     D                 DS
     D  HETRM                  1      2  0
     D  SETRM                  1      2  0
     D                 DS
     D  HETRI                  1      2
     D  SELKT                  1      2
     D                 DS
     D  KLBXXX                 1     35
     D  KLBHAD                 1      1
     D                 DS
     D  SYRG                   1     14
     D  SYFORE                 1      9
     D                 DS
     D  WSERG14                1     14
     D  WSERG2                 1      2
     D  WSERG9                 3     11
     D  WSERG9B                1      9

     C                   EXSR      INIT

     C                   EXSR      SRXML0

     C                   EVAL      *INLR = *ON
      ***********************************************
     C     SRXML0        BEGSR
      ***********************************************
      * HENT KODE FOR IMPORT ELLER EKSPORT, STED FOR Å IDENTIFISERE HVILKEN AVDELING
     C     XRSN          SETLL     XMLRCVF
     C     XRSN          READE     XMLRCVF                                33
     C                   DOW       *IN33 = *OFF

     C                   SELECT
     C                   WHEN      XRNV = 'BranchCode'
     C                   MOVEL     XRVERD        XBRANCH           3
     C                   WHEN      XRNV = 'DepartmentCode'
     C                   MOVEL     XRVERD        XDEPART           3
     C                   WHEN      XRNV = 'HousebillNumber'
     C                   MOVEL     XRVERD        XHAWB             9
     C                   WHEN      XRNV = 'ModeOfTransport'
     C                   MOVEL     XRVERD        XTRTYPE          10
     C                   WHEN      XRNV = 'MasterbillNumber'
     C                   MOVEL     XRVERD        XMAWB            11
     C                   LEAVE
     C                   ENDSL
     C     XRSN          READE     XMLRCVF                                33
     C                   ENDDO
      * Programet avslutas om det inte finns en giltig departmentcode
     C                   SELECT
     C                   WHEN      XDEPART = 'FEA'
     C                   EVAL      HEUR   = 'D'
     C                   WHEN      XDEPART = 'FOA'
     C                   EVAL      HEUR   = 'D'
     C                   WHEN      XDEPART = 'FPE'
     C                   EVAL      HEUR   = 'D'
     C                   WHEN      XDEPART = 'PEA'
     C                   EVAL      HEUR   = 'D'
     C                   WHEN      XDEPART = 'FES'
     C                   EVAL      HEUR   = 'G'
     C                   WHEN      XDEPART = 'FFE'
     C                   EVAL      HEUR   = 'G'
     C                   WHEN      XDEPART = 'FLE'
     C                   EVAL      HEUR   = 'G'
     C                   ENDSL
     C     HEUR          CABEQ     *BLANKS       SLSRXML0
      * HENT MELDINGS REFERANSE IMPORT
     C                   Z-ADD     1             X000_XRLEV1
     C                   Z-ADD     0             X000_XRLEV2
     C                   Z-ADD     0             X000_XRLEV3
     C                   Z-ADD     0             X000_XRLEV4
     C                   Z-ADD     0             X000_XRLEV5
     C                   Z-ADD     0             X000_XRLEV6
     C                   Z-ADD     0             X000_XRLEV7
     C                   Z-ADD     0             X000_XRLEV8
     C                   Z-ADD     0             X000_XRLEV9
     C     XMLKEY00      CHAIN     XMLRCVF                            33
     C     *IN33         CABEQ     *ON           SLSRXML0
     C                   DOW       *IN33 = *OFF
     C                   SELECT
     C                   WHEN      XRNV = 'Filing'
     C                   EXSR      SRXML101
     C                   WHEN      XRNV = 'Shipment'
     C                   EXSR      SRXML102
     C                   ENDSL
     C                   ADD       1             X000_XRLEV1
     C     XMLKEY00      CHAIN     XMLRCVF                            33
     C                   ENDDO

     C     SLSRXML0      ENDSR
      ***********************************************
     C     SRXML101      BEGSR
      ***********************************************

     C                   MOVE      *BLANKS       XTRM              3
     C                   MOVE      *BLANKS       XSETRID          17
     C                   MOVE      *BLANKS       XSELKT            2
     C                   MOVE      *BLANKS       XSELKA            2
     C                   EVAL      X001_XRLEV1 = XRLEV1
     C                   Z-ADD     1             X001_XRLEV2
     C                   Z-ADD     0             X001_XRLEV3
     C                   Z-ADD     0             X001_XRLEV4
     C                   Z-ADD     0             X001_XRLEV5
     C                   Z-ADD     0             X001_XRLEV6
     C                   Z-ADD     0             X001_XRLEV7
     C                   Z-ADD     0             X001_XRLEV8
     C                   Z-ADD     0             X001_XRLEV9
     C     XMLKEY01      CHAIN     XMLRCVF                            33
     C                   DOW       *IN33 = *OFF
     C                   SELECT
     C                   WHEN      XRNV = 'ShipmentFileNumber'
     C                   EXSR      SRXML302
     C                   WHEN      XRNV = 'ModeOfTransport'
     C                   EVAL      XTRM    = XRVERD
     C                   WHEN      XRNV = 'TransportMeansName'
     C                   EVAL      XSETRID = XRVERD
     C                   WHEN      XRNV = 'CarrierNationality'
     C                   EVAL      XSELKT  = XRVERD
     C                   WHEN      XRNV = 'CountryCode'
     c                   IF        XRPATH = '/CustomsFiling/Shipment/Housebill/+
     c                                       /Origin'
     C                   EVAL      XSELKA  = XRVERD
     C                   ENDIF
     C                   WHEN      XRNV   = 'TransportUnits'
     C                   EXSR      TransU
     C                   ENDSL
     C                   ADD       1             X001_XRLEV2
     C     XMLKEY01      CHAIN     XMLRCVF                            33
     C                   ENDDO
     C                   ENDSR
      ***********************************************
     C     SRXML102      BEGSR
      ***********************************************
     C                   EVAL      X001_XRLEV1 = XRLEV1
     C                   Z-ADD     1             X001_XRLEV2
     C                   Z-ADD     0             X001_XRLEV3
     C                   Z-ADD     0             X001_XRLEV4
     C                   Z-ADD     0             X001_XRLEV5
     C                   Z-ADD     0             X001_XRLEV6
     C                   Z-ADD     0             X001_XRLEV7
     C                   Z-ADD     0             X001_XRLEV8
     C                   Z-ADD     0             X001_XRLEV9
     C     XMLKEY01      CHAIN     XMLRCVF                            33
     C                   DOW       *IN33 = *OFF
     C                   SELECT
     C                   WHEN      XRNV = 'Housebill'
     C                   EXSR      SRXML201
     C                   WHEN      XRNV = 'GoodsLines'
     C                   EXSR      GoodsL1
     C                   LEAVE
     C                   ENDSL
     C                   ADD       1             X001_XRLEV2
     C     XMLKEY01      CHAIN     XMLRCVF                            33
     C                   ENDDO
     C                   IF        NY='J'
     C                   EXSR      SKRIVNYSAD
     C                   ENDIF

     C                   ENDSR
      ***********************************************
     C     SRXML201      BEGSR
      ***********************************************
     C                   EVAL      X002_XRLEV1 = X001_XRLEV1
     C                   EVAL      X002_XRLEV2 = X001_XRLEV2
     C                   EVAL      X002_XRLEV3 = 1
     C                   EVAL      X002_XRLEV4 = 0

     C     XMLKEY02      CHAIN     XMLRCVF                            33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
      * HENT INFOR. FRA <ModeOfTransport>
     C                   WHEN      XRNV = 'ModeOfTransport'                      2
     C                   EXSR      SRXML303
      * HENT INFOR. FRA <Shipper>
     C                   WHEN      XRNV = 'Shipper'                              2
     C                   EXSR      SRXML305
      * HENT INFOR. FRA <Consignee>
     C                   WHEN      XRNV = 'Consignee'                            2
     C                   EXSR      SRXML306
      * HENT INFOR. FRA <TODCode>
     C                   WHEN      XRNV = 'INCOTerms'                            2
     C                   EXSR      SRXML307
      * HENT INFOR. FRA <TotalPackages>
     C                   WHEN      XRNV = 'TotalPackages'                        2
     C                   EXSR      SRXML309
      * HENT INFOR. FRA <TotalWeight>
     C                   WHEN      XRNV = 'TotalWeight'                          2
     C                   EXSR      SRXML310
      * HENT INFOR. FRA <ValueOfGoods>
     C                   WHEN      XRNV = 'ValueOfGoods'                         2
     C                   EXSR      SRXML311
     C                   ENDSL
     C                   ADD       1             X002_XRLEV3
     C     XMLKEY02      CHAIN     XMLRCVF                            33
     C                   ENDDO                                                  1<-E

     C     SLXML201      ENDSR
      ***********************************************
     C     SRXML302      BEGSR
      ***********************************************
     C                   EVAL      FSSOK  = XRVERD

     C                   EVAL      FSKODE = '*CE'
     C     FRISOL01K     CHAIN     FRISOL01                           33

      * Start finnes ikke fra før

     C                   IF        *IN33
     C                   MOVE      'J'           NY                1

     C                   EXSR      HENTTELL
     C                   EVAL      SEDP   = 10
     C                   EVAL      SETRID = XSETRID
     C                   EVAL      SELKT  = XSELKT
     C                   IF        XSELKA <> *BLANKS
     C                   EVAL      SELKA  = XSELKA
     C                   END

      * Start finnes fra før

     C                   ELSE
     C                   MOVE      'N'           NY                1
     C                   MOVE      FSAVD         XAVD
     C                   MOVE      FSOPD         XTDN
     C
     C                   END

     C     SLXML302      ENDSR
      ***********************************************
     C     SRXML303      BEGSR
      ***********************************************
     C                   SELECT
     C                   WHEN      XRVERD = '1'
     C                   MOVE      '1'           SEKDC
     C                   EVAL      SETRM  = 10
     C                   WHEN      XRVERD = '4'                                 Air
     C                   MOVE      '0'           SEKDC
     C                   EVAL      SETRM  = 40
     C                   WHEN      XRVERD = '3'                                 Road
     C                   MOVE      '0'           SEKDC
     C                   EVAL      SETRM  = 30
     C                   WHEN      XRVERD = '2'                                 Rail
     C                   MOVE      '0'           SEKDC
     C                   EVAL      SETRM  = 20
     C                   ENDSL

     C                   ENDSR
      ***********************************************
     C     SRXML305      BEGSR
      ***********************************************
      * INFOR. FRA <Shipper>

     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = 1
     C                   EVAL      X003_XRLEV5 = 0

     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'AccountNumber'                        2
     C                   EVAL      XSYPAID='CWACC'
     C                   MOVEL     XRVERD        XSYVRDA
     C     SYPARKEY      CHAIN     SYPARL3
     C                   IF        %FOUND(SYPARL3)
     C                   EVAL      SEKNK=SYKUNR
     C                   ELSE
     C                   EXSR      NYTTKNR
     C                   EVAL      SEKNK=SYKUNR
     C                   ENDIF
     C                   WHEN      XRNV = 'Name'                                 2
     C                   EVAL      SENAK  = XRVERD
     C                   WHEN      XRNV = 'Address'                              2
     C                   EXSR      SRXMLSHIPP
     C                   WHEN      XRNV = 'TaxID'
     C                   EVAL      WSERG14=XRVERD
     C                   IF        WSERG2='NO'
     C                   EVAL      SERG = WSERG9
     C                   ELSE
     C                   EVAL      SERG = WSERG9B
     C                   ENDIF
     C                   ENDSL                                                   2<-E

     C                   EVAL      X003_XRLEV4 = X003_XRLEV4 + 1
     C                   EVAL      X003_XRLEV5 = 0
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   ENDDO                                                  1<-E

     C                   ENDSR
      ***********************************************
     C     SRXML306      BEGSR
      ***********************************************
      * INFOR. FRA <Consignee>
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = 1
     C                   EVAL      X003_XRLEV5 = 0

     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'AccountNumber'                        2
     C                   WHEN      XRNV = 'Name'                                 2
     C                   EVAL      SENAS  = XRVERD
     C                   WHEN      XRNV = 'Address'
     C                   EXSR      SRXMLCONSI
     C                   WHEN      XRNV = 'Contact'                              2
     C                   EXSR      SRXML306A
     C                   WHEN      XRNV = 'CustomsAccountNumber'                 2
     C                   MOVEL     XRVERD        XCHKTAL
     C                   MOVE      *ZEROS        XNR08             8 0
     C                   MOVE      *ZEROS        XNR01             1 0
     C     1             DO        10            XN                               3<-B
     C                   IF        XCT(XN) >= '0' AND XCT(XN) <= '9'               4<-B
     C                   MULT      10            XNR08
     C                   MOVE      XCT(XN)       XNR08
     C                   ADD       1             XNR01
     C                   IF        XNR01 = 8                                        5<-B
     C                   LEAVE
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   ENDDO                                                    3<-E
     C                   MOVE      XNR08         SEKT8
     C                   IF        SEKTC = '0' AND XNR01 < 8                      3<-B
     C                   MOVE      ' '           SEKTC
     C                   END                                                      3<-E
     C                   ENDSL                                                   2<-E

     C                   EVAL      X003_XRLEV4 = X003_XRLEV4 + 1
     C                   EVAL      X003_XRLEV5 = 0
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   ENDDO                                                  1<-E

     C     KODTS2K       CHAIN     KODTS2                             33
     C                   SELECT
     C                   WHEN      *IN33
     C                   EVAL      SEDTY  = *BLANKS
     C                   WHEN      KS2PRE = 'A' OR KS2PRE = 'B' OR KS2PRE = 'C'
     C                   EVAL      SEDTY  = 'EU'
     C                   OTHER
     C                   EVAL      SEDTY  = 'EX'
     C                   ENDSL


     C                   ENDSR
      ***********************************************
     C     SRXML306A     BEGSR
      ***********************************************
     C                   EVAL      X003_XRLEV4 = XRLEV4

     C     XMLKEY031     CHAIN     XMLRCVF02                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'Name'                                 2
     C                   WHEN      XRNV = 'Phone'                                2
     C                   ENDSL                                                   2<-E

     C     XMLKEY031     READE     XMLRCVF02                              33
     C                   ENDDO                                                  1<-E

     C                   ENDSR
      ***********************************************
     C     SRXML307      BEGSR
      ***********************************************
      * INFOR. FRA <TODCode>
     C                   EVAL      SELV   = XRVERD

     C     KODTLBK       CHAIN     KODTLB                             33
     C                   SELECT
     C                   WHEN      *IN33
     C                   EVAL      SELVT  = *BLANKS
     C                   WHEN      KLBHAD = 'A'
     C                   EVAL      SELVT  = SEADS3
     C                   WHEN      KLBHAD = 'M'
     C                   EVAL      SELVT  = SEADK3
     C                   ENDSL

     C                   ENDSR
      ***********************************************
     C     SRXML309      BEGSR
      ***********************************************
      * INFOR. FRA <NumberOfPackages>
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          SENTK

     C                   ENDSR
      ***********************************************
     C     SRXML310      BEGSR
      ***********************************************
      * INFOR. FRA <GrossWeight>
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          SEVKB

     C                   ENDSR
      ***********************************************
     C     SRXML311      BEGSR
      ***********************************************
      * INFOR. FRA <ValueOfGoods>
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = 0
     C                   EVAL      X003_XRLEV5 = 0

     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'ValueOfGoods'                         2
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          SEBEL1
     C     XMLRCAFK      CHAIN     XMLRCAF
     C                   IF        %FOUND
     C                   IF        XRATN = 'currencycode'
     C                   EVAL      SEVAL1 = XRATV
     C                   ENDIF
     C                   ENDIF
      *
     c                   MOVE      SEVAL1        TRVERV
     C     KODTVAL2K1    SETGT     KODTVAL2
     C     SEVAL1        READPE    KODTVAL2                               33
     C* N33              MOVE      KVAOMR        XOMRF             3 0
     C* N33              MOVE      KVAKRS        SEVKU
     C                   ENDSL                                                   2<-E

     C                   EVAL      X003_XRLEV4 = X003_XRLEV4 + 1
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   ENDDO                                                  1<-E

     C                   ENDSR
      ***********************************************
     C     SKRIVNYSAD    BEGSR
      ***********************************************
      * finnes ikke fra før så ny sad skrives
     C                   MOVE      *ZEROS        SEMP
     C                   MOVE      *BLANKS       SEDTØ
     C                   MOVE      *BLANKS       SE0035

     C                   IF        SESG = *BLANKS
     C                   MOVE      'CW1'         SESG
     C                   END
     C                   IF        SETARF = *BLANKS
     C     KODTSIK       CHAIN     KODTSI                             33
     C                   EVAL      SETARF = KSINAV
     C                   END
     C                   MOVE      ' '           SEUR
     C                   MOVE      ' '           SEST
     C                   IF        SEKTB = *ZEROS
     C                   IF        SEKNK <> 0
     C     CUNDL01K      CHAIN(N)  CUNDL01
     C                   IF        %FOUND(CUNDL01)
     C                   MOVEL     SYKONT        SEKTA
     C                   MOVE      SYKONT        SEKTB
     C                   MOVE      SYFR02        SEKTC
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C                   WRITE     SAEHR
      * OPPDATER KUNDE HVIS DET IKKE FINNES I KUNDEREGISTER
     C                   IF        SEKNK <> 0
     C     CUNDL01K      CHAIN     CUNDL01                            33
     C                   IF        *IN33
     C                   CLEAR                   KUNDR
     C                   MOVEL     'A'           AKTKOD
     C                   MOVEL     FIFIRM        FIRMA
     C                   Z-ADD     SEKNK         KUNDNR
     C                   MOVEL     SENAK         KNAVN
     C                   EVAL      SYLAND = XSELKA2
     C                   MOVEL     SEADK1        ADR1
     C                   MOVEL     SEADK2        ADR2
     C                   IF        SYLAND = 'NO' or SYLAND = '  '
N23  C                   MOVEL     SEADK3        POSTNR
     C                   ELSE
N23  C                   MOVEL     SEADK3        SYPOGE
     C                   ENDIF
N23  C                   EVAL      ADR3  = %SUBST(SEADK3:6:24)
     C                   MOVEL     SENAK         SONAVN
     C                   MOVEL     SEKTA         SYKONT
     C                   MOVE      SEKTB         SYKONT
     C                   MOVE      SEKTC         SYFR02
     C                   MOVEL     SERG          SYRG
     C                   EVAL      BETBET='D0'
     C                   EVAL      SYMVJN='N'
     C                   WRITE     KUNDR
     C                   ELSE
     C*                  MOVEL     SENAK         KNAVN
     C*                  MOVEL     SEADK1        ADR1
     C*                  MOVEL     SEADK2        ADR2
N23  C*                  MOVEL     SEADK3        POSTNR
N23  C*                  EVAL      ADR3  = %SUBST(SEADK3:6:24)
     C*                  MOVEL     SENAK         SONAVN
     C*                  MOVEL     SEKTA         SYKONT
     C*                  MOVE      SEKTB         SYKONT
     C*                  MOVE      SEKTC         SYFR02
     C*                  MOVEL     SERG          SYRG
     C                   UPDATE    KUNDR
     C                   END
     C                   END

     C                   SELECT
     C                   WHEN      XDEPART = 'FEA'
     C                   EVAL      HEUR   = 'D'
     C                   WHEN      XDEPART = 'FOA'
     C                   EVAL      HEUR   = 'D'
     C                   WHEN      XDEPART = 'FPE'
     C                   EVAL      HEUR   = 'D'
     C                   WHEN      XDEPART = 'PEA'
     C                   EVAL      HEUR   = 'D'
     C                   WHEN      XDEPART = 'FES'
     C                   EVAL      HEUR   = 'G'
     C                   WHEN      XDEPART = 'FFE'
     C                   EVAL      HEUR   = 'G'
     C                   WHEN      XDEPART = 'FLE'
     C                   EVAL      HEUR   = 'G'
     C                   ENDSL
     C                   EVAL      HERFA  = FSSOK
     C                   EVAL      HERFK  = FSSOK
     C                   EVAL      HEKDFS = 'X'
     C                   EVAL      HEOT   = '0 '
     C                   IF        SEKDC  = '1'
     C                   EVAL      HETRCN = SETRID
     C                   EVAL      HETRC  = 1
     C                   ELSE
     C                   EVAL      HETRC  = 0
     C                   END
     C                   MOVE      'J'           hepk6
     C*                  MOVE      XMAWB         HEGN
     C                   MOVE      XHAWB         HEHAWB
     C                   WRITE     HEADFR

     C     1             CHAIN     EDIC                               20
     C                   ADD       1             CMN
     C                   UPDATE    EDICR
     C                   EVAL      M0004  = S0004
     C                   EVAL      M0010  = S0010
     C                   EVAL      M0035  = S0035
     C                   EVAL      M0062  = S0020
     C                   EVAL      M0065  = 'XMLCW '
     C                   EVAL      M0068  = FSSOK
     C                   EVAL      M1001  = 'XML'
     C                   EVAL      M1225  = 'IMP'
     C                   EVAL      MSN    = SSN
     C                   EVAL      MMN    = CMN
     C                   EVAL      MSR    = SSR
     C                   EVAL      MST    = 'C'
     C                   EVAL      M1N07  = 'CW '
     C                   MOVE      WDT           MDT
     C                   MOVE      WTM           MTM
     C                   EVAL      MAVD   = SEAVD
     C                   EVAL      MTDN   = SETDN
     C                   WRITE     EDIMR
     C                   EVAL      NY='N'

     C                   ENDSR
      ***********************************************
     C     KNVTAL        BEGSR
      ***********************************************
     C                   MOVE      *ZEROS        XTAL
     C     1             DO        15            XN                3 0          1<-B
     C                   IF        XT(XN) = *BLANKS OR XT(XN) = '.'              2<-B
     C                             OR XT(XN) < '0' OR XT(XN) > '9'
     C                   LEAVE
     C                   ENDIF                                                   2<-E
     C                   MULT      10            XTALH
     C                   MOVE      XT(XN)        XTALH
     C                   ENDDO                                                  1<-E

     C                   IF        XT(XN) = '.'                                 1<-B
     C                   ADD       1             XN
     C                   MOVE      XT(XN)        XTALD1
     C                   ADD       1             XN
     C                   IF        XT(XN) <> ' '                                 2<-B
     C                   MOVE      XT(XN)        XTALD2
     C                   ADD       1             XN
     C                   IF        XT(XN) <> ' '                                  3<-B
     C                   MOVE      XT(XN)        XTALD3
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E

     C                   ENDSR
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    USN               9

     C     CUNDL01K      KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    SEKNK
     C     SAEHK         KLIST
     C                   KFLD                    XAVD
     C                   KFLD                    XTDN
     C     SAEHK2        KLIST
     C                   KFLD                    SEAVD
     C                   KFLD                    SETDN
     C     FRISOL01K     KLIST
     C                   KFLD                    FSKODE
     C                   KFLD                    FSSOK
     C     KODTLBK       KLIST
     C                   KFLD                    KLBUNI
     C                   KFLD                    SELV
     C     KODTSIK       KLIST
     C                   KFLD                    KSIUNI
     C                   KFLD                    SESG
     C     KODTS2K       KLIST
     C                   KFLD                    KS2UNI
     C                   KFLD                    SELKB
     C     KODTVAL2K1    KLIST
     C                   KFLD                    SEVAL1
     C                   KFLD                    WDT08
     C     XMLKEY00      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X000_XRLEV1
     C                   KFLD                    X000_XRLEV2
     C                   KFLD                    X000_XRLEV3
     C                   KFLD                    X000_XRLEV4
     C                   KFLD                    X000_XRLEV5
     C                   KFLD                    X000_XRLEV6
     C                   KFLD                    X000_XRLEV7
     C                   KFLD                    X000_XRLEV8
     C                   KFLD                    X000_XRLEV9
     C     XMLKEY01      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X001_XRLEV1
     C                   KFLD                    X001_XRLEV2
     C                   KFLD                    X001_XRLEV3
     C                   KFLD                    X001_XRLEV4
     C                   KFLD                    X001_XRLEV5
     C                   KFLD                    X001_XRLEV6
     C                   KFLD                    X001_XRLEV7
     C                   KFLD                    X001_XRLEV8
     C                   KFLD                    X001_XRLEV9
     C     XMLKEY02      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X002_XRLEV1
     C                   KFLD                    X002_XRLEV2
     C                   KFLD                    X002_XRLEV3
     C                   KFLD                    X002_XRLEV4
     C     XMLKEY03      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X003_XRLEV1
     C                   KFLD                    X003_XRLEV2
     C                   KFLD                    X003_XRLEV3
     C                   KFLD                    X003_XRLEV4
     C                   KFLD                    X003_XRLEV5
     C     XMLKEY031     KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X003_XRLEV1
     C                   KFLD                    X003_XRLEV2
     C                   KFLD                    X003_XRLEV3
     C                   KFLD                    X003_XRLEV4
     C     XMLKEY032     KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X003_XRLEV1
     C                   KFLD                    X003_XRLEV2
     C                   KFLD                    X003_XRLEV3
     C                   KFLD                    X003_XRLEV4
     C                   KFLD                    X003_XRLEV5
     C                   KFLD                    X003_XRLEV6
     C     XMLKEY033     KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X003_XRLEV1
     C                   KFLD                    X003_XRLEV2
     C                   KFLD                    X003_XRLEV3
     C                   KFLD                    X003_XRLEV4
     C                   KFLD                    X003_XRLEV5
     C     XMLRCAFK      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    XRLEV1
     C                   KFLD                    XRLEV2
     C                   KFLD                    XRLEV3
     C                   KFLD                    XRLEV4
     C                   KFLD                    XRLEV5
     C                   KFLD                    XRLEV6
     C     SYPARKEY      KLIST
     C                   KFLD                    XSYPAID
     C                   KFLD                    XSYVRDA

     C     *LIKE         DEFINE    SEAVD         XAVD
     C     *LIKE         DEFINE    SETDN         XTDN
     C     *LIKE         DEFINE    SETRID        XTRID
     C     *LIKE         DEFINE    XRLEV1        X000_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X000_XRLEV2
     C     *LIKE         DEFINE    XRLEV3        X000_XRLEV3
     C     *LIKE         DEFINE    XRLEV4        X000_XRLEV4
     C     *LIKE         DEFINE    XRLEV5        X000_XRLEV5
     C     *LIKE         DEFINE    XRLEV6        X000_XRLEV6
     C     *LIKE         DEFINE    XRLEV7        X000_XRLEV7
     C     *LIKE         DEFINE    XRLEV8        X000_XRLEV8
     C     *LIKE         DEFINE    XRLEV9        X000_XRLEV9
     C     *LIKE         DEFINE    XRLEV1        X001_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X001_XRLEV2
     C     *LIKE         DEFINE    XRLEV3        X001_XRLEV3
     C     *LIKE         DEFINE    XRLEV4        X001_XRLEV4
     C     *LIKE         DEFINE    XRLEV5        X001_XRLEV5
     C     *LIKE         DEFINE    XRLEV6        X001_XRLEV6
     C     *LIKE         DEFINE    XRLEV7        X001_XRLEV7
     C     *LIKE         DEFINE    XRLEV8        X001_XRLEV8
     C     *LIKE         DEFINE    XRLEV9        X001_XRLEV9
     C     *LIKE         DEFINE    XRLEV1        X002_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X002_XRLEV2
     C     *LIKE         DEFINE    XRLEV3        X002_XRLEV3
     C     *LIKE         DEFINE    XRLEV4        X002_XRLEV4
     C     *LIKE         DEFINE    XRLEV1        X003_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X003_XRLEV2
     C     *LIKE         DEFINE    XRLEV3        X003_XRLEV3
     C     *LIKE         DEFINE    XRLEV4        X003_XRLEV4
     C     *LIKE         DEFINE    XRLEV5        X003_XRLEV5
     C     *LIKE         DEFINE    XRLEV6        X003_XRLEV6
     C     *LIKE         DEFINE    XRLEV1        X102_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X102_XRLEV2
     C     *LIKE         DEFINE    XRNV          X001_XRNV
     C     *LIKE         DEFINE    SVAVD         XSVAVD
     C     *LIKE         DEFINE    SVTDN         XSVTDN
     C     *LIKE         DEFINE    SYPAID        XSYPAID
     C     *LIKE         DEFINE    SYVRDA        XSYVRDA
     C     *LIKE         DEFINE    SYRECN        XSYRECN
     C     *LIKE         DEFINE    HEAVD         XXAVD

     C                   MOVE      USN           XRSN
     C                   MOVE      'LB'          KLBUNI
     C                   MOVE      'SI'          KSIUNI
     C                   MOVE      'S2 '         KS2UNI
N01  C                   EVAL      SEVKB = 0
N01  C                   EVAL      SENTK = 0

     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           WDT08             8 0

     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
     C     XRSN          CHAIN     EDIS                               33

     C                   ENDSR
     C***********************************************
     C     HENTTELL      BEGSR
     C***********************************************
     C                   SELECT

     C                   WHEN      XBRANCH = 'BGO'
     C                   SELECT
     C                   WHEN      XDEPART = 'FEA'
     C                   EVAL      XXAVD=515
     C                   WHEN      XDEPART = 'FOA'
     C                   EVAL      XXAVD=515
     C                   WHEN      XDEPART = 'FPE'
     C                   EVAL      XXAVD=515
     C                   ENDSL

     C                   WHEN      XBRANCH = 'OSL'
     C                   SELECT
     C                   WHEN      XDEPART = 'FEA'
     C                   EVAL      XXAVD=215
     C                   WHEN      XDEPART = 'FOA'
     C                   EVAL      XXAVD=215
     C                   WHEN      XDEPART = 'FPE'
     C                   EVAL      XXAVD=215
     C                   WHEN      XDEPART = 'FES'
     C                   EVAL      XXAVD=275
     C                   WHEN      XDEPART = 'FFE'
     C                   EVAL      XXAVD=275
     C                   WHEN      XDEPART = 'FLE'
     C                   EVAL      XXAVD=275
     C                   WHEN      XDEPART = 'PEA'
     C                   EVAL      XXAVD=215
     C                   ENDSL
     C                   ENDSL
     C*                  EVAL      XXAVD=9915

     C     XXAVD         CHAIN     STANDE                             33
     C                   MOVE      SETDN         XSETDN            7 0
     C                   ADD       1             SETDN
     C                   UPDATE    STANDER
     C                   EVAL      SETARF = *BLANKS
     C                   MOVE      XSETDN        SETDN
     C                   MOVE      *BLANKS       SEST
     C                   MOVE      WDT           SEDT
     C                   WRITE     FRISOKR
     C     *LIKE         DEFINE    FSSOK         WFSSOK
     C                   EVAL      WFSSOK=FSSOK
      * Skriv Cargowise referanse
     C                   EVAL      FSKODE='CW1'
     C                   WRITE     FRISOKR
      * Skriv HAWB nummer
     C                   EVAL      FSKODE='HWB'
     C                   EVAL      FSSOK=*BLANKS
     C                   EVAL      FSSOK=XHAWB
     C                   WRITE     FRISOKR
      * Skriv MAWB nummer
     C                   EVAL      FSKODE='MWB'
     C                   EVAL      FSSOK=*BLANKS
     C                   EVAL      FSSOK=XMAWB
     C                   WRITE     FRISOKR
      * Still tilbake fskode
     C                   EVAL      FSKODE='*CE'
     C                   EVAL      FSSOK=WFSSOK

     C                   ENDSR
      ***********************************************
     C     OPDATGMSAD    BEGSR
      ***********************************************
      * ooppdaterer godsnummer
      *
     C     HEGN          IFNE      *blanks
     C     *LIKE         DEFINE    hegn          hegnopd
     C     *LIKE         DEFINE    hepos1        hepoopd
     c                   eval      hegnopd=hegn
     c                   eval      hepoopd=hepos1
     C     SAEHK2        CHAIN     HEADF                              33
     c     *in33         ifeq      '0'
     c                   eval      hegn=hegnopd
     c                   eval      hepos1=hepoopd
     c                   update    headfr
     c                   end

     C     SAEHK2        CHAIN     SAEH                               33
     c     *in33         ifeq      '0'
     C                   EVAL      SEGN   = HEGNOPD
     c                   eval      sEpos = hepoopd
     c                   update    saehr
     C                   END
     C                   END

     c                   endsr
      ***********************************************
     C     Transu        BEGSR
      ***********************************************
     C                   EVAL      X002_XRLEV1 = X001_XRLEV1
     C                   EVAL      X002_XRLEV2 = X001_XRLEV2
     C                   EVAL      X002_XRLEV3 = 3
     C                   EVAL      X002_XRLEV4 = 1

     C     XMLKEY02      CHAIN     XMLRCVF                            33
     C                   DOW       *IN33 = *OFF
     C                   SELECT

     C                   WHEN      XRNV = 'TransportUnitID'
     C                   LEAVE
     C                   ENDSL
     C                   ADD       1             X002_XRLEV3
     C     XMLKEY02      CHAIN     XMLRCVF                            33
     C                   ENDDO

     C                   ENDSR
      ***********************************************
     C     SRXMLshipp    BEGSR
      ***********************************************
     C                   EVAL      X003_XRLEV4 = XRLEV4

     C     XMLKEY031     CHAIN     XMLRCVF02                          33
     C                   DOW       *IN33 = *OFF
     C                   SELECT
     C                   WHEN      XRNV = 'AddressLine1'
     C                   EVAL      SEADK1 = XRVERD
     C                   WHEN      XRNV = 'PostalCode'
     C                   EVAL      SEADK3 = XRVERD
     C                   WHEN      XRNV = 'City'
     C                   IF        SEADK3 = *BLANKS                               3<-B
     C                   EVAL      SEADK3 = XRVERD
     C                   ELSE                                                     3
     C                   CAT       XRVERD:1      SEADK3
     C                   END                                                      3<-E
     C                   WHEN      XRNV = 'CountryCode'
     C                   IF        XSELKA = *BLANKS                               3<-B
     C                   EVAL      SELKA  = XRVERD
     C                   END                                                      3<-E
     C                   MOVEL     XRVERD        XSELKA2           2
     C                   ENDSL

     C     XMLKEY031     READE     XMLRCVF02                              33
     C                   ENDDO

     C                   ENDSR
      ***********************************************
     C     SRXMLconsi    BEGSR
      ***********************************************
     C                   EVAL      X003_XRLEV4 = XRLEV4

     C     XMLKEY031     CHAIN     XMLRCVF02                          33
     C                   DOW       *IN33 = *OFF
     C                   SELECT
     C                   WHEN      XRNV = 'AddressLine1'
     C                   EVAL      SEADS1 = XRVERD
     C                   WHEN      XRNV = 'PostalCode'
     C                   EVAL      SEADS3 = XRVERD
     C                   WHEN      XRNV = 'City'
     C                   IF        SEADS2 = *BLANKS                               3<-B
     C                   EVAL      SEADS3 = XRVERD
     C                   ELSE                                                     3
     C                   CAT       XRVERD:1      SEADS3
     C                   END                                                      3<-E
     C                   WHEN      XRNV = 'CountryCode'
     C                   IF        SELKB = *BLANKS                                3<-B
     C                   EVAL      SELKB  = XRVERD
     C                   END                                                      3<-E
     C                   ENDSL

     C     XMLKEY031     READE     XMLRCVF02                              33
     C                   ENDDO

     C                   ENDSR
      ***********************************************
     C     Goodsl1       BEGSR
      ***********************************************
     C                   EVAL      X002_XRLEV1 = X001_XRLEV1
     C                   EVAL      X002_XRLEV2 = X001_XRLEV2
     C                   EVAL      X002_XRLEV3 = 1
     C                   EVAL      X002_XRLEV4 = 0

     C     XMLKEY02      CHAIN     XMLRCVF                            33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
      * HENT INFOR. FRA <GoodsLines>
     C                   WHEN      XRNV = 'GoodsLine'
     C     NY            IFEQ      'J'
     C                   EXSR      SKRIVNYSAD
     C                   ELSE
     C                   EXSR      OPDATGMSAD
     C                   END
     C                   ENDSL                                                   2<-E
     C                   ADD       1             X002_XRLEV3
     C     XMLKEY02      CHAIN     XMLRCVF                            33
     C                   ENDDO                                                  1<-E

     C                   ENDSR
      *______________________________________________
      * Hent nytt kundenummer                 NYTTKNR
      *""""""""""""""""""""""""""""""""""""""""""""""
     C     NyttKnr       BEGSR
      * Hent neste ledige kundenummer
     C     FIFIRM        CHAIN     FIRKU
     C                   IF        %FOUND(FIRKU)
     C                   EVAL      SEKNK=FIKUNE
     C                   ADD       1             FIKUNE
     C                   UPDATE    FIRKUR
     C                   ENDIF
      * Hent recordnumber til SYPARF
     C     'SYPAR   '    CHAIN     TELLGE
     C                   IF        %FOUND(TELLGE)
     C                   MOVE      GENO          XSYRECN
     C                   ADD       1             GENO
     C                   UPDATE    TELLGER
     C                   ENDIF
      * Skriv til SYPARF
     C                   CLEAR                   SYPARFR
     C                   EVAL      SYRECN=XSYRECN
     C                   EVAL      SYPAID='CWACC'
     C                   EVAL      SYVRDA=XSYVRDA
     C                   EVAL      SYKUNR=SEKNK
     C                   WRITE     SYPARFR
     C                   ENDSR
