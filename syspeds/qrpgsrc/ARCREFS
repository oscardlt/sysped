      ***********************************************************
      *** PROGRAM for arkivering
      ***********************************************************
     FFIRMARC   IF   E           K DISK
     FFIRM      IF   E           K DISK
     FFAK3      IF   E           K DISK
     FARKIVL06  UF   E           K DISK
     D                SDS
     D  UUSR                 254    263
      *
      *
     C                   READ      FIRM                                   33
     C                   MOVE      FIFIRM        ARFIRM
     C                   READ      FIRMARC                                33
      *
     c     KEYARK        KLIST
     c                   kfld                    fifirm
     c                   kfld                    artype
      *
     c     KEYSAM        KLIST
     c                   kfld                    fifirm
     c                   kfld                    artype
     c                   kfld                    arunde
      *
     c     KEYSAM2       KLIST
     c                   kfld                    fifirm
     c                   kfld                    artype2
     c                   kfld                    arunde
      *
     c                   exsr      singel
      *
     c                   exsr      samle
      *
     C                   GOTO      SLUTT
     c                   move      'fa'          artype
     c                   call      'ARC002CLB'
     c                   parm                    artype
     c                   parm                    uusr
     c                   move      'fs'          artype
     c                   call      'ARC002CLB'
     c                   parm                    artype
     c                   parm                    uusr
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      ************************************************************************
     c     samle         begsr
      ************************************************************************
     c                   move      'fs'          artype
      *
     C     KEYARK        SETLL     ARKIVL06
     C                   SETOFF                                       33
      *
      *
     C     *IN(33)       DOWEQ     '0'
     C     KEYARK        READE     ARKIVL06                               33
     c     *in(33)       ifeq      '0'
     c     ardate        andge     20080101
      *
      *
     C                   move      *BLANKS       ubane           256
     C                   movel     '/'           ubane
     C     ubane         CAT       arcane:0      ubane
     C     ubane         CAT       '/':0         ubane
     C     ubane         CAT       ARLINK:0      ubane
     C     ubane         CAT       '.PDF':0      ubane
     C                   MOVE      *BLANKS       FINS
     c                   call      'SYGE35CL'
     c                   parm                    UBANE
     c                   parm                    fins              1
     c                   move      *blanks       ARFRI
     c     FINS          ifeq      '1'
      *
      * skjekk om faktura i det hele tatt finnes
      *
     c                   movel     arunde        fafakt
     c     fakey         chain     fak3                               34
     c     *in(34)       ifeq      '1'
     c                   DELETE    ARKIVR
     c                   else
     C                   MOVEL     'NEI'         ARFRI
     C                   MOVE      *BLANKS       ARUSER
     c                   movel     uusr          aruser
     c                   move      ' '           arstat
     c                   move      *zeros        aravd
     c                   move      *zeros        aropd
     C                   UPDATE    ARKIVR
     C                   END
     c* slett fordelinger på oppdrag
     c                   exsr      slesam
     c                   exsr      slesam2
     C                   ELSE
     C                   MOVEL     'JA'          ARFRI
     C                   UPDATE    ARKIVR
     C                   END
     C                   ENDIF
     c     arfri         ifne      'JA'
     c     keysam        setgt     arkivl06
     c                   end
     C                   ENDDO
     c                   endsr
      ************************************************************************
     c     slesam        begsr
      ************************************************************************
     c* ikke setll da ikke første post skal slettes
     c                   setoff                                       34
     c     *in(34)       doweq     '0'
     c     keysam        reade     arkivl06                               34
     c     *in34         ifeq      '0'
     c                   delete    arkivr
     c                   endif
     c                   enddo
     c                   endsr
      ************************************************************************
     c     slesam2       begsr
      ************************************************************************
     c                   move      'fx'          artype2           2
     C     KEYSAM2       SETLL     ARKIVL06
     c* ikke setll da ikke første post skal slettes
     c                   setoff                                       34
     c     *in(34)       doweq     '0'
     c     keysam2       reade     arkivl06                               34
     c     *in34         ifeq      '0'
     c                   delete    arkivr
     c                   endif
     c                   enddo
     c                   endsr
      ************************************************************************
     c     singel        begsr
      ************************************************************************
     c                   move      'fa'          artype
     c     fakey         klist
     c                   kfld                    kode              1
     c                   kfld                    fafakt
     c                   move      'O'           kode
      *
     C     KEYARK        SETLL     ARKIVL06
     C                   SETOFF                                       33
      *
      *
     C     *IN(33)       DOWEQ     '0'
     C     KEYARK        READE     ARKIVL06                               33
     c     *in(33)       ifeq      '0'
     c     ardate        andge     20040101
      *
      *
     C                   move      *BLANKS       ubane
     C                   movel     '/'           ubane
     C     ubane         CAT       arcane:0      ubane
     C     ubane         CAT       '/':0         ubane
     C     ubane         CAT       ARLINK:0      ubane
     C     ubane         CAT       '.PDF':0      ubane
     c                   call      'SYGE35CL'
     c                   parm                    UBANE
     c                   parm                    fins              1
     c                   move      *blanks       ARFRI
     c     FINS          ifeq      '1'
      *
      * skjekk om faktura i det hele tatt finnes
      *
     c                   movel     arunde        fafakt
     c     fakey         chain     fak3                               34
     c     *in(34)       ifeq      '1'
     c                   DELETE    ARKIVR
     c                   else
     C                   MOVE      *BLANKS       ARUSER
     c                   movel     uusr          aruser
     c                   move      ' '           arstat
     C                   MOVEL     'NEI'         ARFRI
     C                   UPDATE    ARKIVR
     c                   end
     C                   ELSE
     C                   MOVEL     'JA'          ARFRI
     C                   UPDATE    ARKIVR
     C                   END
     C                   ENDIF
     C                   ENDDO
     c                   endsr
