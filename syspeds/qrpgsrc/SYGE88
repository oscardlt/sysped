     H DECEDIT(',') debug(*yes)
      ************************************************************************
      *  beregner budsjetter
      ************************************************************************
     F*EVEL01   UF A E           K DISK
     FLEVEBU    UF A E           K DISK
     F*OSBU12   UF A E           K DISK
     F*OSTB     UF   E           K DISK
     F*OSTA1    IF   E           K DISK
     FTRAN      IF   E           K DISK
     Ffirm      if   E           K disk
     FHEADF     IF   E           K DISK
     FDOKUF     IF   E           K DISK
     D                 DS
     D  HXHEAD                 1    256
     D  HEUR                   1      1
     D  HEFR                   2      4
     D  HEKDPL                 5      5
     D  HELKA                  6      7
     D  HESDF                  8     12
     D  HETRI                 13     14
     D  HESDT                 15     19
     D  HELKS                 20     21
     D  HESDFF                22     26
     D  HELKK                 27     28
     D  HESDVT                29     33
     D  HEVKT                 34     42  0
     D  HEFBV                 43     51  0
     D  HEM3                  52     58  3
     D  HELM                  59     62  2
     D  HENT                  63     69  0
     D  TRVERV                70     72
     D  XXVERB                73     75  2
     D                 DS
     D  TRVK01                 1      5  0
     D  TRVK02                 6     10  0
     D  TRVK03                11     15  0
     D  TRVK04                16     20  0
     D  TRVK05                21     25  0
     D  TRVK06                26     30  0
     D  TRVK07                31     35  0
     D  TRVK08                36     40  0
     D  TRVK09                41     45  0
     D  TRVK10                46     50  0
     D  TRVK11                51     55  0
     D  TRVK12                56     60  0
     D  FV                     1     60  0
     D                                     DIM(12) ASCEND                       VEKTGR. AVTALE
     D                 DS
     D  TRPA01                 1      3  1
     D  TRPA02                 4      6  1
     D  TRPA03                 7      9  1
     D  TRPA04                10     12  1
     D  TRPA05                13     15  1
     D  TRPA06                16     18  1
     D  TRPA07                19     21  1
     D  TRPA08                22     24  1
     D  TRPA09                25     27  1
     D  TRPA10                28     30  1
     D  TRPA11                31     33  1
     D  TRPA12                34     36  1
     D  FP                     1     36  1
     D                                     DIM(12)                              VEKTGR. AVTALE
     D                 DS
     D  HEDTÅ                  1      4  0
     D  HEDTM                  5      6  0
     D  HEDTD                  7      8  0
     D  HEDTOP                 1      8  0
      *
     c                   exsr      init
      *
     c                   exsr      hentb
      *
     c                   seton                                        lr
     c                   return
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     c     *entry        plist
     c                   parm                    uavd              4 0
     c                   parm                    uopd              7 0
     c                   parm                    ubud              9 2
     c                   z-add     uavd          heavd
     c                   z-add     uopd          heopd
     C*    levek         KLIST
     C*                  KFLD                    FIFIRM
     C*                  KFLD                    vmtrku
     C*    levebuk       KLIST
     C*                  KFLD                    vmtrle
     C*    kostak        KLIST
     C*                  KFLD                    kast
     C*    kostbk        KLIST
     C*                  KFLD                    kabnr
     C     DOKUFK        KLIST
     C                   KFLD                    DFRI
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    DFFBNR
     c                   z-add     1             dffbnr
     c                   move      'F'           DFRI
     C     headfk        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     KOSBUK        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    UTXT             35
     C     TRAKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    DFTRAN
     C                   read      firm                                   33
     C                   ENDSR
      *
      ***********************************************
     C     HENTB         BEGSR
      ***********************************************
     c     headfk        chain     headf                              34
     c  n34dokufk        chain     dokuf                              34
     C  n34TRAKEY        CHAIN     TRAN                               34
     c     *in34         ifeq      '0'
     c                   exsr      berbud
     c*                  z-add     nyttbu        kbbuds
     c*                  update    kostbr
     C                   end
     c                   endsr
      ***********************************************
     C     BERBUD        BEGSR
      ***********************************************
     c                   z-add     vmtrku        uukn
     C                   EVAL      utxt='*fb*'
     c                   move      dffbnr        dffbna            3
     c     UTXT          CAT       DFFBNA:0      UTXT
     C                   MOVE      *ZEROS        UUBELØ
      *
     C                   MOVE      *ZEROS        N7                7 0
     C                   MOVE      ' '           USKA              1
     C                   MOVE      *ZEROS        DUVNR             9 0
     C                   MOVE      *BLANK        DUVMSG           50
      * FINN FRAKT I KUNDERSFRAKTAVTALE
     C                   MOVE      *BLANKS       UUVAL             3
     C                   MOVE      'FRA'         UGEB              3
     c                   MOVE      '   '         UGEBKO            3
     C                   MOVE      *ZEROS        UUBELØ           13 2
     c                   movel     dfprok        hekdpl
     C                   MOVE      HXHEAD        UHEAD           256
      *
      *
     C                   CALL      'SYGE14'
     C                   PARM                    UGEBKO
     C                   PARM                    UGEB
     C                   PARM                    HEAVD
     C                   PARM                    N7
     C                   PARM                    UUKN              8 0
     C                   PARM                    UUVAL
     C                   PARM                    UUBELØ
     C                   PARM                    DUVNR             9 0
     C                   PARM                    DUVMSG           50
     C                   PARM                    USKA
     C                   PARM                    UHEAD
      *
     C                   Z-ADD     UUBELØ        NYTTBU            9 0
     C                   Z-ADD     UUBELØ        ubud              9 2
     c*    nyttbu        ifne      *zeros
     c*                  exsr      oppdat
     c*                  end
     C                   ENDSR
     C*********************************************************************
     c*    oppdat        begsr
     C*********************************************************************
     c*    kosbuk        chain     kosbu12                            34
      *
      * hopp ut hvis budsjett er ført
      *
     c* n34bust          ifne      ' '
     c*                  goto      utbud
     c*                  end
      *
      * flytter data til budsjett record
      *
     c*                  move      'NOK'         buval
      *                  z-add     nyttbu        bubl
     c*                  z-add     dftran        butnr
     c*                  z-add     vmtrle        bulnr
     C*                  MOVEL     HEDTÅ         BUPCC
     C*                  MOVE      HEDTÅ         BUPÅR
     C*                  MOVE      HEDTM         BUPMN
     C*                  MOVE      'FRA'         BUVK
     C*                  MOVE      HESG          BUSG
     C*                  MOVE      'O'           BUFER                          *O = OPPDRAG
     C*                  MOVE      'E'           BUBLST
     C*                  MOVE      'E'           BUTYPE
     c*                  move      utxt          butxt
      * endre gammelt budsjett
      *
     c*    *in34         ifeq      '0'
     c*                  update    kosbur
      * logikk ved skrive ny
     c*                  else
     c*                  move      kbavd         buoavd
     c*                  move      kbopd         buopd
     c*                  write     kosbur
     c*                  end
     c*    utbud         endsr
