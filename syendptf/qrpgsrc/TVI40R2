      *
     FEDIM2     IF   E           K DISK
     Farklogh   O  A E             DISK
     Farklogd   O  A E             DISK
     Farklogt   UF a E           K DISK
     Farksrc    O    E             DISK
     F                                     RENAME(arksrc:arcdat)
     Farkepol2  uF   E           K DISK
      *  Prototype for tvi40r2
     d tvi40r2         pr
     d uuser_                              like(uuser)
     d uemne_                              like(uemne)
     d uavd_                               like(uavd)
     d uopd_                               like(uopd)
     d ubane1_                             like(ubane1)
     d ubane2_                             like(ubane2)
     d ubane3_                             like(ubane3)
     d ubane4_                             like(ubane4)
     d ubane5_                             like(ubane5)
     d ubane6_                             like(ubane6)
     d ubane7_                             like(ubane7)
     d ubane8_                             like(ubane8)
     d ubane9_                             like(ubane9)
     d uban10_                             like(uban10)
     d uban11_                             like(uban11)
     d uban12_                             like(uban12)
     d uban13_                             like(uban13)
     d uban14_                             like(uban14)
     d uban15_                             like(uban15)
     d uban16_                             like(uban16)
     d uban17_                             like(uban17)
     d uban18_                             like(uban18)
     d uban19_                             like(uban19)
     d uban20_                             like(uban20)
     d uban21_                             like(uban21)
     d uban22_                             like(uban22)
     d uban23_                             like(uban23)
     d uban24_                             like(uban24)
     d uban25_                             like(uban25)
     d uban26_                             like(uban26)
     d uban27_                             like(uban27)
     d uban28_                             like(uban28)
     d uban29_                             like(uban29)
     d uban30_                             like(uban30)
      *  *ENTRY Interface for Main Procedure
     d tvi40r2         pi
     d uuser                         10a
     d uemne                         40a
     d uavd                           4a
     d uopd                           7a
     d ubane1                       140a
     d ubane2                       140a
     d ubane3                       140a
     d ubane4                       140a
     d ubane5                       140a
     d ubane6                       140a
     d ubane7                       140a
     d ubane8                       140a
     d ubane9                       140a
     d uban10                       140a
     d uban11                       140a
     d uban12                       140a
     d uban13                       140a
     d uban14                       140a
     d uban15                       140a
     d uban16                       140a
     d uban17                       140a
     d uban18                       140a
     d uban19                       140a
     d uban20                       140a
     d uban21                       140a
     d uban22                       140a
     d uban23                       140a
     d uban24                       140a
     d uban25                       140a
     d uban26                       140a
     d uban27                       140a
     d uban28                       140a
     d uban29                       140a
     d uban30                       140a
      *  Prototype for 'SYGE15C'
     d syge15c         pr                  extpgm('SYGE15C')
     d wdt_                                like(wdt)
     d wtm_                                like(wtm)
      *
     d mdt_max         s              8s 0
     d wdt             s              8a
     d wtm             s              6a
     d xfunnet         s              1a
     d epn             s              3s 0
     d nr              s              3s 0
      *
     D CrLf            c                   x'0D25'
     D                 DS
     D  BA                     1   4200    DIM(30)
     D  BANE1                  1    140
     D  BANE2                141    280
     D  BANE3                281    420
     D  BANE4                421    560
     D  BANE5                561    700
     D  BANE6                701    840
     D  BANE7                841    980
     D  BANE8                981   1120
     D  BANE9               1121   1260
     D  BAN10               1261   1400
     D  BAN11               1401   1540
     D  BAN12               1541   1680
     D  BAN13               1681   1820
     D  BAN14               1821   1960
     D  BAN15               1961   2100
     D  BAN16               2101   2240
     D  BAN17               2241   2380
     D  BAN18               2381   2520
     D  BAN19               2521   2660
     D  BAN20               2661   2800
     D  BAN21               2801   2940
     D  BAN22               2941   3080
     D  BAN23               3081   3220
     D  BAN24               3221   3360
     D  BAN25               3361   3500
     D  BAN26               3501   3640
     D  BAN27               3641   3780
     D  BAN28               3781   3920
     D  BAN29               3921   4060
     D  BAN30               4061   4200
     D                 DS
     D  eptext                 1     77
     D  eptex1                 1     15
     D  eptex2                17     76
     D                 DS
     D  srcdta                 1    160
     D  epdata                 1    160
     D  src008                 1      8

      /free

       epavd = %int(uavd);
       epopd = %int(uopd);
       mdt_max = 99999999;
       syge15c (wdt: wtm);
       epdate = %int(wdt);
       eptime = %int(wtm);
       epuser = uuser;

       // Klargjør emne
       xfunnet = 'N';
       setll (epavd: epopd: mdt_max) edim2;
       readpe (epavd: epopd) edim2;
       dow not %eof;
         if msr = 'S' and m1001 = '929';
           xfunnet = 'J';
           leave;
         endif;
         readpe (epavd: epopd) edim2;
       enddo;

       if xfunnet = 'J';
         uemne = 'Deklarasjon ' + %subst(m0068:1:9) + ' ' + %subst(m0068:10:8)
                 + ' ' + %subst(m0068:18:6);
        //henter neste teller
         eptelk = 'A';
         chain (eptelk) arklogt;
         if %found;
           epunik = epunik + 1;
           update arklogtr;
         else;
           epunik = 1;
           write arklogtr;
         endif;

        //skriver første loggpost
         srcdta = uemne;
         write arkloghr;
         write arklogdr;

        //skriver linker
         setll (uuser) arkepol2;
         reade (uuser) arkepol2;
         dow not %eof;
           if epbane <> *blanks and epn < 30;
             epn = epn + 1;
             ba(epn) = epbane;
           endif;
           delete arkepor;
           srcdta = eptext;
           srcseq = srcseq + 1;
           write arcdat;
           write arklogdr;
           reade (uuser) arkepol2;
         enddo;

         srcdta = *blanks;
         if epbane = *blanks;
           srcdta = eplink;
         endif;
         if srcdta <> *blanks;
           srcseq = srcseq + 1;
           write arcdat;
           write arklogdr;
         endif;
         if %subst(eplink:81:72) <> *blanks;
           srcdta = %subst(eplink:81:72);
           srcseq = srcseq + 1;
           write arcdat;
           write arklogdr;
         endif;
       endif;   // if xfunnet = 'J';

       ubane1 = bane1;
       ubane2 = bane2;
       ubane3 = bane3;
       ubane4 = bane4;
       ubane5 = bane5;
       ubane6 = bane6;
       ubane7 = bane7;
       ubane8 = bane8;
       ubane9 = bane9;
       uban10 = ban10;
       uban11 = ban11;
       uban12 = ban12;
       uban13 = ban13;
       uban14 = ban14;
       uban15 = ban15;
       uban16 = ban16;
       uban17 = ban17;
       uban18 = ban18;
       uban19 = ban19;
       uban20 = ban20;
       uban21 = ban21;
       uban22 = ban22;
       uban23 = ban23;
       uban24 = ban24;
       uban25 = ban25;
       uban26 = ban26;
       uban27 = ban27;
       uban28 = ban28;
       uban29 = ban29;
       uban30 = ban30;

       if bane1 <> *blanks;
         epdata = 'attachment';
         srcseq = srcseq + 1;
         write arklogdr;
         nr = 1;
         dow nr < 30;
           if ba(nr) <> *blanks;
             epdata = ba(nr);
             write arklogdr;
           endif;
           nr = nr + 1;
         enddo;
       endif;   // if bane1 <> *blanks;

       *inlr = *on;
       return;

      /end-free
