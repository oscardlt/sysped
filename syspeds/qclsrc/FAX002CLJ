/* INNFØRT BLUFAX */
             PGM        PARM(&BPARM)
             DCL        VAR(&BPARM)    TYPE(*CHAR) LEN(430)
             DCL        VAR(&UNIK) TYPE(*CHAR) LEN(7) /* Unikkode +
                          til register SORT. */
             DCL        VAR(&COVP) TYPE(*CHAR) LEN(8)
             DCL        VAR(&COVL) TYPE(*CHAR) LEN(10)
             DCL        VAR(&P1) TYPE(*CHAR) LEN(2)
             DCL        VAR(&P1E) TYPE(*CHAR) LEN(2)
             DCL        VAR(&P1S) TYPE(*CHAR) LEN(2)
             DCL        VAR(&P2) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P3) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P4) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P5) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P6) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P7) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P8) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P9) TYPE(*CHAR) LEN(1)
             DCL        VAR(&TUR) TYPE(*CHAR) LEN(8)
             DCL        VAR(&MAPPE) TYPE(*CHAR) LEN(20)
             DCL        VAR(&PTIME) TYPE(*CHAR) LEN(8)
             DCL        VAR(&PDATE) TYPE(*CHAR) LEN(8)
             DCL        VAR(&QUSER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QJOB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QNBR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&FAX) TYPE(*CHAR) LEN(21)
             DCL        VAR(&FILEN) TYPE(*CHAR) LEN(10)
             DCL        VAR(&KNAVN) TYPE(*CHAR) LEN(30)
             DCL        VAR(&AVD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&OPD) TYPE(*CHAR) LEN(7)
             DCL        VAR(&KODE) TYPE(*CHAR) LEN(1)
             DCL        VAR(&DONAV) TYPE(*CHAR) LEN(12)
             DCL        VAR(&CVP1) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP2) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP3) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP4) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP5) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP6) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP7) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP8) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP) TYPE(*CHAR) LEN(1)
             DCL        VAR(&LTYPE) TYPE(*CHAR) LEN(1)
             DCL        VAR(&FIFIRM) TYPE(*CHAR) LEN(2)
             DCL        VAR(&FILIBF) TYPE(*CHAR) LEN(10)
             DCLF       FILE(FAXSEN)
             RCVF       RCDFMT(*FILE)
    /* SKRIVER UT FAKTURAKOPI             */
    /*                                    */
             CHGVAR     VAR(&FAX) VALUE(%SST(&BPARM 1 21))
             CHGVAR     VAR(&FILEN) VALUE(%SST(&BPARM 22 10))
             CHGVAR     VAR(&PTIME) VALUE(%SST(&BPARM 32 8))
             CHGVAR     VAR(&PDATE) VALUE(%SST(&BPARM 40 8))
             CHGVAR     VAR(&KNAVN) VALUE(%SST(&BPARM 48 30))
             CHGVAR     VAR(&AVD) VALUE(%SST(&BPARM 78 4))
             CHGVAR     VAR(&OPD) VALUE(%SST(&BPARM 82 7))
             CHGVAR     VAR(&KODE) VALUE(%SST(&BPARM 89 1))
             CHGVAR     VAR(&DONAV) VALUE(%SST(&BPARM 80 12))
             CHGVAR     VAR(&P1) VALUE(%SST(&BPARM 102 2))
             CHGVAR     VAR(&P2) VALUE(%SST(&BPARM 104 1))
             CHGVAR     VAR(&P3) VALUE(%SST(&BPARM 105 1))
             CHGVAR     VAR(&P4) VALUE(%SST(&BPARM 106 1))
             CHGVAR     VAR(&P5) VALUE(%SST(&BPARM 107 1))
             CHGVAR     VAR(&P6) VALUE(%SST(&BPARM 108 1))
             CHGVAR     VAR(&P7) VALUE(%SST(&BPARM 109 1))
             CHGVAR     VAR(&CVP1) VALUE(%SST(&BPARM 110 40))
             CHGVAR     VAR(&CVP2) VALUE(%SST(&BPARM 150 40))
             CHGVAR     VAR(&CVP3) VALUE(%SST(&BPARM 190 40))
             CHGVAR     VAR(&CVP4) VALUE(%SST(&BPARM 230 40))
             CHGVAR     VAR(&CVP5) VALUE(%SST(&BPARM 270 40))
             CHGVAR     VAR(&CVP6) VALUE(%SST(&BPARM 310 40))
             CHGVAR     VAR(&CVP7) VALUE(%SST(&BPARM 350 40))
             CHGVAR     VAR(&CVP8) VALUE(%SST(&BPARM 390 40))
             CHGVAR     VAR(&CVP) VALUE(%SST(&BPARM 430 1))
             RTVDTAARA  DTAARA(*LDA (81 1)) RTNVAR(&LTYPE)
             OVRPRTF    FILE(FAKTURA) DEV(FAX3812) DEVTYPE(*AFPDS) +
                          PAGESIZE(72 90) LPI(8) CPI(15) FRONTMGN(0 +
                          0.5) DRAWER(3) OUTQ(QFAX/QFAXOUTQ) +
                          FORMTYPE(*STD)
             OVRPRTF    FILE(SYFA27PF) DEV(FAX3812) DEVTYPE(*AFPDS) +
                          PAGESIZE(72 90) LPI(8) CPI(15) FRONTMGN(0 +
                          0.5) OVRFLW(72) DRAWER(3) +
                          OUTQ(QFAX/QFAXOUTQ) FORMTYPE(*STD) +
                          COPIES(1) HOLD(*YES)
             OVRPRTF    FILE(SYFA27PS) DEV(FAX3812) DEVTYPE(*AFPDS) +
                          PAGESIZE(72 90) LPI(8) CPI(15) FRONTMGN(0 +
                          0.5) DRAWER(3) OUTQ(QFAX/QFAXOUTQ) +
                          FORMTYPE(*STD) COPIES(1)
             OVRPRTF    FILE(SYFA20P) DEV(FAX3812) DEVTYPE(*AFPDS) +
                          PAGESIZE(72 90) LPI(6) CPI(12) +
                          FRONTMGN(0.0 0.5) OVRFLW(72) DRAWER(3) +
                          OUTQ(QFAX/QFAXOUTQ) FORMTYPE(*STD)
             IF         COND(&LTYPE = 'S') THEN( +
             OVRPRTF    FILE(SYFA20PS) DEV(FAX3812) DEVTYPE(*AFPDS) +
                          PAGESIZE(96 90) LPI(8) CPI(12) +
                          FRONTMGN(0.0 0.5) OVRFLW(96) DRAWER(3) +
                          OUTQ(QFAX/QFAXOUTQ) FORMTYPE(*STD) )
             ELSE       CMD( +
             OVRPRTF    FILE(SYFA20PS) DEV(FAX3812) DEVTYPE(*AFPDS) +
                          PAGESIZE(72 90) LPI(8) CPI(12) +
                          FRONTMGN(0.0 0.5) OVRFLW(72) DRAWER(3) +
                          OUTQ(QFAX/QFAXOUTQ) FORMTYPE(*STD) )
             OVRPRTF    FILE(SYFA20PD) DEV(FAX3812) DEVTYPE(*AFPDS) +
                          PAGESIZE(72 90) LPI(6) CPI(12) +
                          FRONTMGN(0.0 0.5) OVRFLW(72) DRAWER(3) +
                          OUTQ(QFAX/QFAXOUTQ) FORMTYPE(*STD)
             OVRPRTF    FILE(SYFA20PT) DEVTYPE(*AFPDS) PAGESIZE(72 +
                          90) CPI(12) FRONTMGN(0.0 0.5) OVRFLW(72) +
                          DRAWER(3) OUTQ(QFAX/QFAXOUTQ) +
                          FORMTYPE(*STD) /*N01*/

    /* */
    /* */
    /* FIX SEPARATE GIRO */
    /* */
    /* */
             RTVJOBA    JOB(&QJOB) USER(&QUSER) NBR(&QNBR)
    /* */
    /*                                    */
    /*                                    */
             CHGVAR     VAR(&UNIK) VALUE('W' *CAT &QNBR)
/* SORT OGSÅ I LØSNING 1 - INLIBL FOR Å SIKRE BIBLIOTEKSLISTE */
             CALL INLIBL
/* HENT FILBIBLIOTEKSNAVN */
             CALL       PGM(GETFIRMF2) PARM(&FIFIRM &FILIBF)
             RMVM       FILE(SORT) MBR(&UNIK)
             MONMSG     MSGID(CPF7310 CPF5815 CPF7315)
             ADDPFM     FILE(SORT) MBR(&UNIK)
             OVRDBF     FILE(SORT) TOFILE(SORT) MBR(&UNIK)
             OVRMSGF    MSGF(QUSERMSG) TOMSGF(SYMSGF)

             CALL       PGM(SYFA20) PARM(&P1 &P1E &P1S &P2 &P3 &P4 +
                          &P5 &P6 &P7 &P8 &P9)
             RMVM       FILE(SORT) MBR(&UNIK)
             MONMSG     MSGID(CPF7310 CPF5815 CPF7315)
             CALL       PGM(FAX017) PARM(&FAX)

             /* HENTER COVERPAGE PÅ AVDELING       */
             IF         COND(&CVP = 'J') THEN(CALL PGM(FAX024A) +
                          PARM(&AVD &COVP &COVL))
             /* FAXSYS = F FACSIMILIE-SUPPORTY 400 */
             IF         COND(&FAXSYS = 'F') THEN(DO)
             IF         COND(&CVP = 'J') THEN(SNDFAX TO((&FAX &CVP2 +
                          &CVP3 &CVP4)) FILE(&FILEN) +
                          JOB(&QNBR/&QUSER/&QJOB) SPLNBR(*LAST) +
                          CRTCVRP(*YES) CVRPRTF(&COVL/&COVP) +
                          TITLE(&CVP1) FROM(&CVP5 &CVP6 &CVP7) +
                          COMMENT(&CVP8) FAXSNDDQ(&FILIBF/FAXDTAQ) +
                          SNDTIME(&PTIME) SNDDATE(&PDATE))

             ELSE       CMD(SNDFAX TO((&FAX)) FILE(&FILEN) +
                          JOB(&QNBR/&QUSER/&QJOB) SPLNBR(*LAST) +
                          CRTCVRP(*NO) FAXSNDDQ(&FILIBF/FAXDTAQ) +
                          SNDTIME(&PTIME) SNDDATE(&PDATE))
             ENDDO
 /* PRØVER SAMLEFAKTURA */
             IF         COND(&FILEN *NE 'SYFA27PF') THEN(DO)
/*                                       */
             RLSSPLF    FILE(SYFA27PF) JOB(&QNBR/&QUSER/&QJOB) +
                          SPLNBR(*LAST)
             MONMSG     MSGID(CPF3309 CPF3303 CPF3322) EXEC(DO)
             GOTO       CMDLBL(UT)
             ENDDO
/*                                       */
             CHGVAR     VAR(&FILEN) VALUE('SYFA27PF')
             IF         COND(&CVP = 'J') THEN(SNDFAX TO((&FAX &CVP2 +
                          &CVP3 &CVP4)) FILE(&FILEN) +
                          JOB(&QNBR/&QUSER/&QJOB) SPLNBR(*LAST) +
                          CRTCVRP(*YES) CVRPRTF(&COVL/&COVP) +
                          TITLE(&CVP1) FROM(&CVP5 &CVP6 &CVP7) +
                          COMMENT(&CVP8) FAXSNDDQ(&FILIBF/FAXDTAQ) +
                          SNDTIME(&PTIME) SNDDATE(&PDATE))
             ELSE       CMD(SNDFAX TO((&FAX)) FILE(&FILEN) +
                          JOB(&QNBR/&QUSER/&QJOB) SPLNBR(*LAST) +
                          CRTCVRP(*NO) FAXSNDDQ(&FILIBF/FAXDTAQ) +
                          SNDTIME(&PTIME) SNDDATE(&PDATE))
             ENDDO
             IF         COND(&FILEN = 'SYFA27PF') THEN(DO)
             /* FAXSYS = F FACSIMILIE-SUPPORTY 400 */
             IF         COND(&FAXSYS = 'F') THEN(DO)
             IF         COND(&CVP = 'J') THEN(SNDFAX TO((&FAX &CVP2 +
                          &CVP3 &CVP4)) FILE(SYFA27PS) +
                          JOB(&QNBR/&QUSER/&QJOB) SPLNBR(*LAST) +
                          CRTCVRP(*YES) CVRPRTF(&COVL/&COVP) +
                          TITLE(&CVP1) FROM(&CVP5 &CVP6 &CVP7) +
                          COMMENT(&CVP8) FAXSNDDQ(&FILIBF/FAXDTAQ) +
                          SNDTIME(&PTIME) SNDDATE(&PDATE))

             ELSE       CMD(SNDFAX TO((&FAX)) FILE(SYFA27PS) +
                          JOB(&QNBR/&QUSER/&QJOB) SPLNBR(*LAST) +
                          CRTCVRP(*NO) FAXSNDDQ(&FILIBF/FAXDTAQ) +
                          SNDTIME(&PTIME) SNDDATE(&PDATE))
             ENDDO
             ENDDO


UT:          CALL       PGM(FAX013) PARM(&QUSER &QNBR &QJOB +
                          &FAX &DONAV &MAPPE &PTIME &PDATE &KNAVN +
                          &AVD &OPD &TUR &KODE)
    /* */
 SLUTT:      ENDPGM
