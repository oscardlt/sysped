      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/TJETUR05LL MODULE(*LIBL/TJETUR05LL *LIBL/INCGI)
CRTPGM*        ACTGRP(*NEW) AUT(*USE)
      *
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX * 01 JOV PTF11 MaxLes/MaxVis innført - hardkodet 10000 / 1000
11XXX * 02 JOV PTF11 flere parametre i søk/filter, avd-logikke totalt endret (se se TJETU.05LL)
      *%%%%%%%%%%
11XXX * 03 JOV PTF12 Filter på bokkingstaus (A=Alle, P=Prebooket(P)/F=Fredig( blank )
11XXX * 04 JOV PTF12 Intern melding (kode A) vises i lista
      *%%%%%%%%%%
12XXX * 05 JOV PTF12 Avdelinggrupper + Faste + MYDP
12XXX * 06 JOV PTF12 Turtype - TURPL - L=Land = idefault (ikke O= Oversjø)
12XXX * 07 JOV PTF12 maxles/maxvi 3-doblet (til 15000 / 600)
      *              Hvis Avs gitt(og ulik H.adr) skriv først med | før H.adr / tilsvar på Mottaker
      * 08 JOV PTF12 Kan søke på ulike dispstatuser(WSDISTA)
      * 09 JOV PTF12 send også TTstatus  / flere filter
      * 10 JOV PTF12 ny tag ttStat2 for utvidet satusinfo ..
      * 11 JOV PTF12 Filter på FRISOK
*********************************************************3**********
      *********************************************************************
      /copy SYSPEDS/qrpgsrcpy,hspecs
      /copy SYSPEDS/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
     FBRPARF    IF   E           K DISK    USROPN
     FDISP      IF   E           K DISK    USROPN
     FDISPL04   IF   E           K DISK    USROPN
     F                                     RENAME(DISPR:DISPR04)
     FDISPL19   IF   E           K DISK    USROPN
     F                                     RENAME(DISPR:DISPR19)
     FKODTA     IF   E           K DISK    USROPN
     FHEADF     IF   E           K DISK    USROPN
     FDOKUF     IF   E           K DISK    USROPN
N07  FCUNDL01   IF   E           K DISK    USROPN
N07  FVADR      IF   E           K DISK    USROPN
N04  FFREETXT2  IF   E           K DISK    USROPN
N09  FTRACKL02  IF   E           K DISK    USROPN
N11  FFRISOK    IF   E           K DISK    USROPN
      /copy SYSPEDS/qrpgsrcpy,prototypeb
      /copy SYSPEDS/qrpgsrcpy,usec
      /copy SYSPEDS/qrpgsrcpy,variables3
N08  D WSDISTA         S              1
     D WBETD           S              8  0
     D WBETA           S              8  0
     D WBATD           S              8  0
     D WBATA           S              8  0
     D WSSDF           S              8
     D WSSDT           S              8
     D TstSte          S              8
     D MaxSte          S              8
     D WSSAVD          S              4
     D WBSAVD          S              4  0
N02  D WSSOPD          S              7
N02  D WBSOPD          S              7  0
     D XAVDA           S              4A
     D XAVDN           S              4  0
     D XOPDA           S              7A
     D XOPDN           S              7  0
N02  D WOPDTF          S              8
N02  D WOPDTFN         S              8  0
N02  D WOPDTF2         S              8
N02  D WOPDTF2N        S              8  0
N02  D WOPDTT          S              8
N02  D WOPDTTN         S              8  0
N02  D WOPDTT2         S              8
N02  D WOPDTT2N        S              8  0
N02  D WSSOT           S              2
N02  D WSSSG           S              3
N03  D WSPREBOOK       S              1
N09  D WSOPDGI         S             20
N09  D WSOPDGIN        S              8  0
N09  D WSAVS           S             20
N09  D WSAVSN          S              8  0
N09  D WSMOT           S             20
N09  D WSMOTN          S              8  0
N09  D WSRFA           S             35
N11  D WSFSKOD         S              3
N11  D WSFSSOK         S             35
N11  D MaxFsSok        S             35
N04  D InternInfo      S            700
N07  D HENASutv        S            150
N07  D HENAKutv        S            150
     D UdispHea        S             70
N09  D HENLEV          s              6
     D i               S             10i 0
N09  D SOKVAR          s             15    varying
N09  D TSTSCAN         s             30
     D JSONstring      S          32000
     D Error           S            150
     D AntLest         S              9  0
N01  D AntVist         S              9  0
N01  D MaxLes          S              9  0
N01  D MaxVis          S              9  0
     D USER            s             10
N05  D sAv             S              4  0 DIM(99)
      * For xlate mellom Upper Case og Lower Case
     D UC              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZÆØÅ')
     D LC              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzæøå')

     D                 DS
     D  PARMOS1                1   1024
     D  OSCHG                  1      1
     D  OSOT16                 2     49
     D  OT                     2     49    DIM(16)
     D  OSST08               150    197
     D  STD                  150    197    DIM(8)
     D  AV                   198    247    DIM(10)
     D  OSLKF16              248    295
     D  LKF                  248    295    DIM(16)
     D  OSLKT16              296    343
     D  LKT                  296    343    DIM(16)
     D  STDT                 344    391    DIM(8)
     D                 DS
     D  HEPOS1                 1      7
     D  POS                    1      7    DIM(7)
     D                 DS
     D  TUTARF                 1     15
     D  TUBLORR                1      1
     D  TUTR                   2      5

      *get input-string
      /copy syspeds/qrpgsrcpy,prolog3

     C                   EXSR      PARSE

     C                   EXSR      INIT

     c                   callp     gethtmlifs(
     C                             '/syspeddev/html/JSON.html':
     C                             '/CGITAG/')
     C                   callp     wrtsection('top')

      /free
        JSONstring='{'
        +'¬user¬ : ¬'+%trim(USER)+'¬, '
        +'¬wssdf¬ : ¬'+%trim(WSSDF)+'¬, '
        +'¬wssdt¬ : ¬'+%trim(WSSDT)+'¬, '
        +'¬wssavd¬ : ¬'+%trim(WSSAVD)+'¬, '
        +'¬stdavd¬ : ¬'+%trim(XSTDAVD)+'¬, '
        +'¬wssopd¬ : ¬'+%trim(WSSopd)+'¬, '
        +'¬wopdtf¬ : ¬'+%trim(WOPDTF)+'¬, '
        +'¬wopdtf2¬ : ¬'+%trim(WOPDTF2)+'¬, '
        +'¬wopdtt¬ : ¬'+%trim(WOPDTT)+'¬, '
        +'¬wopdtt2¬ : ¬'+%trim(WOPDTT2)+'¬, '
        +'¬wsssg¬ : ¬'+%trim(WSSSG)+'¬, '
N03     +'¬wsprebook¬ : ¬'+%trim(WSPREBOOK)+'¬, '
        +'¬wssot¬ : ¬'+%trim(WSSOT)+'¬, '
        +'¬error¬ : ¬'+%trim(ERROR)+'¬, ';
      /end-free
      * JSONfix escaper " i tekst,  for deretter å bytte ¬->"
     c                   call      'JSONFIX'
     c                   parm                    JSONstring
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')

     c                   EVAL      JSONstring ='"orderlistlandled" : ['
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   CALLP     wrtsection('JSONlin')

      * HOVEDRUTINE
     c     Error         IFEQ      *blanks
      * (ikke merkert - endre fra å lese alle udisp til en og en avd... - se TJETU.05LL )
      * kun ett oppdrag ??
     C                   IF        WBSOPD <> *zeros
     C                   EXSR      Setrow2
     c                   goto      UtLes
     C                   ENDIF
      * alle avdelinger evt med filter
     C                   IF        MangeAvd='J'
N04   * logikk flyttet (uten annen merking til egen SR for å få bedret oversikt)
N04  C                   EXSR      MangeAvdSR
     C                   ELSE
      * en avd
     c                   EXSR      Enavd
     C                   ENDIF
      *
     c                   endif                                                  end error=*blank
     c     UtLes         tag

     c                   EVAL      JSONstring =']'
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   CALLP     wrtsection('JSONlin')
     c
N01  c                   IF        AntLest >= MaxLes or
N01  c                             AntVist >= MaxVis
N01  c                   IF        AntVist >= MaxVis
N01  c                   EVAL      JSONstring =',"maxWarning" : "Max '
N01  c                             +%trim(%editc(MaxVis:'Z'))+ ' is shown. '
N01  c                             +'Please limit your search."'
N01  c                   else
N01  c                   EVAL      JSONstring =',"maxWarning" : "Max '
N01  c                             +%trim(%editc(MaxLes:'Z'))+ ' is searched.'
N01  c                             +'Please limit your search."'
N01  c                   endif
N01  C                   CALLP     updHTMLvar2('JSONstring'
N01  C                                         :%addr(JSONstring)
N01  C                                         :%len(JSONstring))
N01  C                   CALLP     wrtsection('JSONlin')
N01  c                   endif

     c                   eval      JSONstring ='}'
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      * Quit
     C                   EXSR      EXIT
      *
      *
N04  ******************************************************
N04  C     MangeAvdSR    BEGSR
N04  ******************************************************
N04  C     *loval        SETLL     KODTA
N04  C                   READ      KODTA                                  35
N04  C                   DOW       *IN35 = *OFF
N04  C                   EXSR      AVDFILTER
N04  C                   IF        XVIS = 'J'
N04  c                   move      KOAAVD        XDIAVD
N04  c                   EXSR      Enavd
N04  c                   ENDIF
N02  c                   if        AntLest >= MaxLes or
N04  c                             AntVist >= MaxVis
N04  c                   leave
N04  c                   endif
N04  C                   READ      KODTA                                  35
N04  C                   ENDDO
N04   *
N04  c                   ENDSR
N02
N02  ******************************************************
N02  C     EnAvd         BEGSR
N02  ******************************************************
N02   * Vis udisp oppdrag i danne avd
N02  C     DISPL04K      SETLL     DISPL04
N02  C     DISPL04K      READE     DISPL04                                35
N02  C                   DOW       *IN35 = *OFF
N02  c                   ADD       1             AntLest
N02  C                   EXSR      SRFILTER2
N02  C                   IF        XVIS = 'J'
N02  C                   EXSR      Setrow2
N02  C                   ENDIF
N02  c                   IF        AntLest >= MaxLes or
N02  c                             AntVist >= MaxVis
N02  c                   leave
N02  c                   endif
N02  C     DISPL04K      READE     DISPL04                                35
N02  C                   ENDDO
N02   *
N02  c                   ENDSR
      *
      *=====================================================================
      * Parse input / cvt to numeric
      *=====================================================================
     C     PARSE         BEGSR
     C                   EVAL      user     = zhbgetvar('user')
     C                   EVAL      WSDISTA  = zhbgetvar('WSDISTA')
     C                   EVAL      WSSDF    = zhbgetvar('WSSDF')
     C     LC:UC         XLATE     WSSDF         WSSDF
     C                   EVAL      WSSDT    = zhbgetvar('WSSDT')
     C     LC:UC         XLATE     WSSDT         WSSDT
     C                   EVAL      WSSAVD   = zhbgetvar('WSSAVD')
     C     LC:UC         XLATE     WSSAVD        WSSAVD                         I fall all,in,out..
     C                   EVAL      WBSAVD   = c2n2(WSSAVD)                      I fall numerisk
N02  C                   EVAL      WSSOPD   = zhbgetvar('WSSOPD')
N02  C                   EVAL      WBSOPD   = c2n2(WSSOPD)
N02  C                   eval      WOPDTF   = zhbgetvar('WOPDTF')
N02  C                   EVAL      WOPDTFN  = c2n2(WOPDTF)
N02  C                   eval      WOPDTF2  = zhbgetvar('WOPDTF2')
N02  C                   EVAL      WOPDTF2N = c2n2(WOPDTF2)
N02  C                   eval      WOPDTT   = zhbgetvar('WOPDTT')
N02  C                   EVAL      WOPDTTN  = c2n2(WOPDTT)
N02  C                   eval      WOPDTT2  = zhbgetvar('WOPDTT2')
N02  C                   EVAL      WOPDTT2N = c2n2(WOPDTT2)
N02  C                   EVAL      WSSOT    = zhbgetvar('WSSOT')
N02  C     LC:UC         XLATE     WSSOT         WSSOT
N02  C                   EVAL      WSSSG    = zhbgetvar('WSSSG')
N02  C     LC:UC         XLATE     WSSSG         WSSSG
N02  C                   EVAL      WSPREBOOK= zhbgetvar('WSPREBOOK')
N09  C                   EVAL      WSRFA   = uppify(zhbgetvar('WSRFA'))
N09  C                   EVAL      WSOPDGI = uppify(zhbgetvar('WSOPDGI'))
N09  C                   EVAL      WSOPDGIN= c2n2(WSOPDGI)
N09  C                   if        WSOPDGIN <> *zeros
N09  C                   EVAL      WSOPDGI = *blanks
N09  C                   endif
N09  C                   EVAL      WSAVS   = uppify(zhbgetvar('WSAVS'))
N09  C                   EVAL      WSAVSN  = c2n2(WSAVS)
N09  C                   if        WSAVSN <> *zeros
N09  C                   EVAL      WSAVS = *blanks
N09  C                   endif
N09  C                   EVAL      WSMOT   = uppify(zhbgetvar('WSMOT'))
N09  C                   EVAL      WSMOTN  = c2n2(WSMOT)
N09  C                   if        WSMOTN <> *zeros
N09  C                   EVAL      WSMOT = *blanks
N09  C                   endif
N11  C                   EVAL      WSFSKOD  = zhbgetvar('WSFSKOD')
N11  C     LC:UC         XLATE     WSFSKOD       WSFSKOD
N11  C                   EVAL      WSFSSOK  = zhbgetvar('WSFSSOK')
N11  C     LC:UC         XLATE     WSFSSOK       WSFSSOK
N09  C
     C                   ENDSR
      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          BEGSR
     C                   callp     wrtsection('*fini')
     C                   CLOSE     BRIDF
     C  N50              CLOSE     BRPARF
     C  N50              CLOSE     DISP
     C  N50              CLOSE     DISPL04
     C  N50              CLOSE     DISPL19
     C  N50              CLOSE     KODTA
     C  N50              CLOSE     HEADF
     C  N50              CLOSE     DOKUF
N04  C  N50              CLOSE     FREETXT2
N07  C  N50              CLOSE     CUNDL01
N07  C  N50              CLOSE     VADR
N09  C  N50              CLOSE     TRACKL02
N11  C  N50              CLOSE     FRISOK
     C                   MOVE      *ON           *INLR
     C                   RETURN
     C                   ENDSR
      *=====================================================================******
      *  FILTRERE POSTER
      *=====================================================================******
     C     SRFILTER2     BEGSR
     C                   MOVE      'N'           XVIS              1
S05  C*    HEADFKLT      CHAIN(N)  HEADF                              35
N05  C     HEADFKLT      CHAIN     HEADF                              35
     C     *in35         CABEQ     '1'           SlFilter2
      *  FRA - Postnr - Landkode/postnr eller SONE (land)
     C                   IF        WSSDF<>*blanks
     C                   IF        %subst(WSSDF:1:1)>='0'
     C                   EVAL      TstSte=HEADS3
     C                   ELSE
     C                   EVAL      TstSte=HELKA+'-'+HEADS3
     C                   ENDIF
     C                   EVAL      MaxSte=%trim(WSSDF)+'99999999'
     C                   IF        TstSte<WSSDF or TstSte>MaxSte
     C                   GOTO      SlFilter2
     C                   ENDIF
     C                   ENDIF
      *  TIL - Postnr - Landkode/postnr eller SONE (land)
     C                   IF        WSSDT<>*blanks
     C                   IF        %subst(WSSDT:1:1)>='0'
     C                   EVAL      TstSte=HEADK3
     C                   ELSE
     C                   EVAL      TstSte=HETRI+'-'+HEADK3
     C                   ENDIF
     C                   EVAL      MaxSte=%trim(WSSDT)+'99999999'
     C                   IF        TstSte<WSSDT or TstSte>MaxSte
     C                   GOTO      SlFilter2
     C                   ENDIF
     C                   ENDIF
N02
N02   * FraDato
N02   *   F.o.m
N02  C     WOPDTFN       IFNE      *ZEROS
N02  C     TRSDFD        ANDLT     WOPDTFN
N02  C                   GOTO      SlFilter2
N02  C                   ENDIF
N02   *   T.o.m
N02  C     WOPDTF2N      IFNE      *ZEROS
N02  C     TRSDFD        ANDGT     WOPDTF2N
N02  C                   GOTO      SlFilter2
N02  C                   ENDIF
N02   * TilDato
N02   *   F.o.m
N02  C     WOPDTTN       IFNE      *ZEROS
N02  C     TRSDTD        ANDLT     WOPDTTN
N02  C                   GOTO      SlFilter2
N02  C                   ENDIF
N02   *   T.o.m
N02  C     WOPDTT2N      IFNE      *ZEROS
N02  C     TRSDTD        ANDGT     WOPDTT2N
N02  C                   GOTO      SlFilter2
N02  C                   ENDIF
N02   * signaur
N02  C     WSSSG         IFNE      *BLANKS
N02  C     WSSSG         ANDNE     HESG
N02  C                   GOTO      SlFilter2
N02  C                   ENDIF
N03   * prebookstatus
N03  C     WSPREBOOK     IFNE      'A'
N03   * kun de med P
N03  C                   if        WSPREBOOK = 'P' and
N03  C                             HESTN7 <> 'P'
N03  C                   GOTO      SlFilter2
N03  C                   ENDIF
N03   * kun de med BLANK = (ferdig booket)
N03  C                   if        WSPREBOOK = 'F' and
N03  C                             HESTN7 = 'P'
N03  C                   GOTO      SlFilter2
N03  C                   ENDIF
N03  C                   ENDIF
N02   * oppdragstype
N02  C     WSSOT         IFNE      *BLANKS
N02  C     WSSOT         ANDNE     HEOT
N02  C                   GOTO      SlFilter2
N02  C                   ENDIF
N09  C*  // Oppdgiver via kunde-nummer
N09  C                   if        WSOPDGIN > 0 and
N09  C                             WSOPDGIN <> TRKNFA
N09  C                   goto      SlFilter2
N09  C                   endIf
N09   *
N09  C*  // Avsender  via kunde-nummer
N09  C                   if        WSAVSN   > 0 and
N09  C                             WSAVSN   <> HEKNS
N09  C                   goto      SlFilter2
N09  C                   endIf
N09  C*  // Mottaker  via kunde-nummer
N09  C                   if        WSMOTN   > 0 and
N09  C                             WSMOTN   <> HEKNK
N09  C                   goto      SlFilter2
N09  C                   endIf
N09   *  // Oppdragsgiver  navn -
N09   *  // MED TIDEN bytte ut med DB-felt HENAO som er klargjort, men ennå "lånes" Agents navn
N09  c                   If        WSOPDGI <> *blanks
N09  C                   eval      SOKVAR = %trim(WSOPDGI)
N09  C                   eval      TSTSCAN= HENAA
N09  C     LC:UC         XLATE     TSTSCAN       TSTSCAN
N09  C     SOKVAR        SCAN      TSTSCAN                                34
N09  C  N34              goto      SlFilter2
N09  c                   endIf
N09   *  // Avsender       navn -
N09  c                   If        WSAVS   <> *blanks
N09  C                   eval      SOKVAR = %trim(WSAVS)
N09  C                   eval      TSTSCAN= HENAS
N09  C     LC:UC         XLATE     TSTSCAN       TSTSCAN
N09  C     SOKVAR        SCAN      TSTSCAN                                34
N09  C  N34              goto      SlFilter2
N09  c                   endIf
N09   *  // mottaker       navn -
N09  c                   If        WSMOT   <> *blanks
N09  C                   eval      SOKVAR = %trim(WSMOT)
N09  C                   eval      TSTSCAN= HENAK
N09  C     LC:UC         XLATE     TSTSCAN       TSTSCAN
N09  C     SOKVAR        SCAN      TSTSCAN                                34
N09  C  N34              goto      SlFilter2
N09  c                   endIf
N09   *  // Senders ref    navn -
N09  c                   If        WSRFA   <> *blanks
N09  C                   eval      SOKVAR = %trim(WSRFA)
N09  C                   eval      TSTSCAN= HERFA
N09  C     LC:UC         XLATE     TSTSCAN       TSTSCAN
N09  C     SOKVAR        SCAN      TSTSCAN                                34
N09  C  N34              goto      SlFilter2
N09  c                   endIf
N11   * Fri søkevei
N11  C                   move      ' '           xVisTmp           1
N11  C     WSFSKOD       IFNE      *BLANKS
N11  C     WSFSSOK       ANDNE     *BLANKS
N11   /free
N11      eval MaxFsSok = %trim(WSFSSOK)+'99999999999999999999';
N11      setll ( HEAVD : HEOPD : WSFSKOD : WSFSSOK ) frisok;
N11      reade ( HEAVD : HEOPD : WSFSKOD ) frisok;
N11   /end-free
N11    if %eof or FSSOK > MaxFsSok;
N11      xVisTmp = 'N';
N11    endif;
N11  C                   IF        xVisTmp = 'N'
N11  C                   GOTO      SlFilter2
N11  C                   ENDIF
N11  C                   ENDIF

S02   * AVD-TESTER SKILT UT I EGEN SR UTEN ANNEN MERKING

      * KOMMET GJENNOM ALLE FILTER = J I XVIS
     C                   MOVE      'J'           XVIS              1

     C     SlFilter2     TAG
     C                   ENDSR
      ****************************************************
     C     AVDFILTER     begsr
      ****************************************************

     C                   MOVE      'J'           XVIS              1
N05   * skrevet om fra individuell IF.. til Select - ingen merking
N05  C                   select
N05   *  Array med avdelinger (selve avdelingslesen skulle kanskje vært en og en ??)
N05  C                   when      anr <> *zeros
N05  c                   if        %lookup(KOAAVD:sAv:1:anr) = *zeros           Avd finnes IKKE
N05  C                   eval      XVIS='N'
N05  C                   endif
      *  IN - kun inngående avdelinger innland
     C                   when      WSSAVD = 'IN '
     C                   if        KOAIE <> '2'
     C                   eval      XVIS='N'
     C                   endif
      *  OUT- kun utgående  avdelinger innland
     C                   when      WSSAVD = 'OUT'
     C                   if        KOAIE <> '1'
     C                   eval      XVIS='N'
     C                   endif
      *  DOM- kun domestic (D/1/2)
     C                   when      WSSAVD = 'DOM'
     C                   if        KOAIE<>'D' and KOAIE<>'1' and KOAIE<>'2'
     C                   eval      XVIS='N'
     C                   endif
      *  IMP- kun import
     C                   when      WSSAVD = 'IMP'
     C                   if        KOAIE <> 'I'
     C                   eval      XVIS='N'
     C                   endif
      *  EXP- kun eksport
     C                   when      WSSAVD = 'EXP'
     C                   if        KOAIE <> 'E'
N05  C                   eval      XVIS='N'
     C                   endif
      *
N05  C                   endsl
      *
     C     SlavdFilt     endsr
      *=====================================================================
      *  Set variable data for section /$row
      *=====================================================================
     C     Setrow2       BEGSR
N04   * Fix div felt
     C     DOKUFKey      CHAIN     DOKUF                              33
     c                   if        DFTOLL=*zeros
     c                   move      *blanks       WSTOLL            4
     c                   else
     c                   move      DFTOLL        WSTOLL
     c                   endif
N04   *
N04  c                   exsr      FixIntern
N07   * Hvis avd/mottaker oppgitt (kundenr) og avvikende fra hente/levadr - vis i HENAS/HENAK
N07  c                   exsr      FixNavn
N09   * sett  T&T-status Urørt / Hentet / Levert i felt HenLev
N09  c                   exsr      TTstatus
      *
N02  c                   ADD       1             AntVist
      /free
         if AntVist=1;
          JSONstring=*blanks;
          else;
          JSONstring=', ';
         endif;
       JSONstring=%trim(JSONstring)+'{'
N08     +'¬dista1¬ : ¬'+%trim(DISTA1)+'¬, '
        +'¬heur¬ : ¬'+%trim(HEUR)+'¬, '
        +'¬heavd¬ : ¬'+%trim(%editc(HEAVD:'Z'))+'¬, '
        +'¬heopd¬ : ¬'+%trim(%editc(HEOPD:'Z'))+'¬, '
        +'¬hesg¬ : ¬'+%trim(HESG)+'¬, '
        +'¬hedtop¬ : ¬'+%trim(%editc(HEDTOP:'Z'))+'¬, '
        +'¬hedtr¬ : ¬'+%trim(%editc(HEDTR:'Z'))+'¬, '
        +'¬hesdff¬ : ¬'+%trim(HESDFF)+'¬, '
        +'¬hesdf¬ : ¬'+%trim(HESDF)+'¬, '
        +'¬hesdt¬ : ¬'+%trim(HESDT)+'¬, '
        +'¬hesdvt¬ : ¬'+%trim(HESDVT)+'¬, '
        +'¬hegn¬ : ¬'+%trim(HEGN)+'¬, '
        +'¬hegnn¬ : ¬'+%trim(HEGNN)+'¬, '
        +'¬hepro¬ : ¬'+%trim(%editc(HEPRO:'Z'))+'¬, '
        +'¬heplan¬ : ¬'+%trim(HEPLAN)+'¬, '
        +'¬trrund¬ : ¬'+%trim(%editc(TRRUND:'Z'))+'¬, '
        +'¬hepos1¬ : ¬'+%trim(HEPOS1)+'¬, '
        +'¬hepos2¬ : ¬'+%trim(%editc(HEPOS2:'Z'))+'¬, '
        +'¬trknfa¬ : ¬'+%trim(%editc(TRKNFA:'Z'))+'¬, '
        +'¬henao¬ : ¬'+%trim(HENAO)+'¬, '
        +'¬hekna¬ : ¬'+%trim(%editc(HEKNA:'Z'))+'¬, '
        +'¬henaa¬ : ¬'+%trim(HENAA)+'¬, '
        +'¬herfa¬ : ¬'+%trim(HERFA)+'¬, '
        +'¬hesaml¬ : ¬'+%trim(HESAML)+'¬, '
        +'¬hehawb¬ : ¬'+%trim(HEHAWB)+'¬, '
        +'¬hesdla¬ : ¬'+%trim(HESDLA)+'¬, '
        +'¬hesdl¬ : ¬'+%trim(HESDL)+'¬, '
        +'¬hevalt¬ : ¬'+%trim(HEVALT)+'¬, '
        +'¬hevalp¬ : ¬'+%trim(%editc(HEVALP:'4'))+'¬, '
        +'¬heknt¬ : ¬'+%trim(%editc(HEKNT:'Z'))+'¬, '
        +'¬helka¬ : ¬'+%trim(HELKA)+'¬, '
        +'¬hekns¬ : ¬'+%trim(%editc(HEKNS:'Z'))+'¬, '
S07     //+'¬henas¬ : ¬'+%trim(HENAS)+'¬, '
N07     +'¬henas¬ : ¬'+%trim(HENASutv)+'¬, '
        +'¬heads1¬ : ¬'+%trim(HEADS1)+'¬, '
        +'¬heads2¬ : ¬'+%trim(HEADS2)+'¬, '
        +'¬hepns¬ : ¬'+%trim(HEPNS)+'¬, '
        +'¬heads3¬ : ¬'+%trim(HEADS3)+'¬, '
-----   +'¬helks¬ : ¬'+%trim(HELKS)+'¬, '
        +'¬heknh¬ : ¬'+%trim(%editc(HEKNH:'Z'))+'¬, '
-----   +'¬henah¬ : ¬'+%trim(HENAH)+'¬, '
        +'¬headh1¬ : ¬'+%trim(HEADH1)+'¬, '
        +'¬headh2¬ : ¬'+%trim(HEADH2)+'¬, '
        +'¬hepnh¬ : ¬'+%trim(HEPNH)+'¬, '
        +'¬headh3¬ : ¬'+%trim(HEADH3)+'¬, '
        +'¬helkh¬ : ¬'+%trim(HELKH)+'¬, '
        +'¬hehbre¬ : ¬'+%trim(%editc(HEHBRE:'4'))+'¬, '
        +'¬hehlen¬ : ¬'+%trim(%editc(HEHLEN:'4'))+'¬, '
        +'¬hehblk¬ : ¬'+%trim(HEHBLK)+'¬, '
        +'¬hekdfs¬ : ¬'+%trim(HEKDFS)+'¬, '
        +'¬hevals¬ : ¬'+%trim(HEVALS)+'¬, '
        +'¬heknsf¬ : ¬'+%trim(%editc(HEKNSF:'Z'))+'¬, '
        +'¬heans¬ : ¬'+%trim(%editc(HEANS:'Z'))+'¬, '
        +'¬henasf¬ : ¬'+%trim(HENASF)+'¬, '
        +'¬heknk¬ : ¬'+%trim(%editc(HEKNK:'Z'))+'¬, '
S07     //+'¬henak¬ : ¬'+%trim(HENAK)+'¬, '
N07     +'¬henak¬ : ¬'+%trim(HENAKutv)+'¬, '
        +'¬headk1¬ : ¬'+%trim(HEADK1)+'¬, '
        +'¬headk2¬ : ¬'+%trim(HEADK2)+'¬, '
        +'¬hepnk¬ : ¬'+%trim(HEPNK)+'¬, '
        +'¬headk3¬ : ¬'+%trim(HEADK3)+'¬, '
        +'¬helkk¬ : ¬'+%trim(HELKK)+'¬, '
        +'¬heknl¬ : ¬'+%trim(%editc(HEKNL:'Z'))+'¬, '
        +'¬henal¬ : ¬'+%trim(HENAL)+'¬, '
        +'¬headl1¬ : ¬'+%trim(HEADL1)+'¬, '
        +'¬headl2¬ : ¬'+%trim(HEADL2)+'¬, '
        +'¬hepnl¬ : ¬'+%trim(HEPNL)+'¬, '
        +'¬headl3¬ : ¬'+%trim(HEADL3)+'¬, '
        +'¬helkl¬ : ¬'+%trim(HELKL)+'¬, '
        +'¬helbre¬ : ¬'+%trim(%editc(HELBRE:'4'))+'¬, '
        +'¬hellen¬ : ¬'+%trim(%editc(HELLEN:'4'))+'¬, '
        +'¬helblk¬ : ¬'+%trim(HELBLK)+'¬, '
        +'¬hekdfk¬ : ¬'+%trim(HEKDFK)+'¬, '
        +'¬hevalk¬ : ¬'+%trim(HEVALK)+'¬, '
        +'¬heknkf¬ : ¬'+%trim(%editc(HEKNKF:'Z'))+'¬, '
        +'¬heank¬ : ¬'+%trim(%editc(HEANK:'Z'))+'¬, '
        +'¬henakf¬ : ¬'+%trim(HENAKF)+'¬, '
        +'¬heot¬ : ¬'+%trim(HEOT)+'¬, '
        +'¬hekdpl¬ : ¬'+%trim(HEKDPL)+'¬, '
        +'¬hefr¬ : ¬'+%trim(HEFR)+'¬, '
        +'¬hent¬ : ¬'+%trim(%editc(HENT:'Z'))+'¬, '
        +'¬hevs1¬ : ¬'+%trim(HEVS1)+'¬, '
        +'¬hevs2¬ : ¬'+%trim(HEVS2)+'¬, '
        +'¬hegm1¬ : ¬'+%trim(HEGM1)+'¬, '
        +'¬hegm2¬ : ¬'+%trim(HEGM2)+'¬, '
        +'¬hevkt¬ : ¬'+%trim(%editc(HEVKT:'4'))+'¬, '
        +'¬helm¬ : ¬'+%trim(%editc(HELM:'4'))+'¬, '
        +'¬hem3¬ : ¬'+%trim(%editc(HEM3:'4'))+'¬, '
        +'¬hefbv¬ : ¬'+%trim(%editc(HEFBV:'4'))+'¬, '
        +'¬hekf¬ : ¬'+%trim(HEKF)+'¬, '
        +'¬hekft1¬ : ¬'+%trim(HEKFT1)+'¬, '
        +'¬heft1¬ : ¬'+%trim(HEFT1)+'¬, '
        +'¬hedtcp¬ : ¬'+%trim(%editc(HEDTCP:'Z'))+'¬, '
        +'¬hedtap¬ : ¬'+%trim(%editc(HEDTÅP:'Z'))+'¬, '
        +'¬hedtmp¬ : ¬'+%trim(%editc(HEDTMP:'Z'))+'¬, '
        +'¬hekdkk¬ : ¬'+%trim(HEKDKK)+'¬, '
        +'¬hefngk¬ : ¬'+%trim(%editc(HEFNGK:'Z'))+'¬, '
        +'¬hefngs¬ : ¬'+%trim(%editc(HEFNGS:'Z'))+'¬, '
        +'¬hekdtm¬ : ¬'+%trim(HEKDTM)+'¬, '
        +'¬hetrm¬ : ¬'+%trim(%editc(HETRM:'Z'))+'¬, '
        +'¬hetri¬ : ¬'+%trim(HETRI)+'¬, '
        +'¬hetrc¬ : ¬'+%trim(%editc(HETRC:'Z'))+'¬, '
        +'¬hetrcn¬ : ¬'+%trim(HETRCN)+'¬, '
        +'¬hefbk¬ : ¬'+%trim(%editc(HEFBK:'4'))+'¬, '
        +'¬hetle¬ : ¬'+%trim(HETLE)+'¬, '
        +'¬hetll¬ : ¬'+%trim(HETLL)+'¬, '
        +'¬hetlku¬ : ¬'+%trim(HETLKU)+'¬, '
        +'¬hentvs¬ : ¬'+%trim(%editc(HENTVS:'Z'))+'¬, '
        +'¬hevn¬ : ¬'+%trim(%editc(HEVN:'Z'))+'¬, '
        +'¬hentf¬ : ¬'+%trim(%editc(HENTF:'Z'))+'¬, '
        +'¬hebelt¬ : ¬'+%trim(%editc(HEBELT:'4'))+'¬, '
        +'¬hebelm¬ : ¬'+%trim(%editc(HEBELM:'4'))+'¬, '
        +'¬hesgm¬ : ¬'+%trim(HESGM)+'¬, '
        +'¬hedtmo¬ : ¬'+%trim(HEDTMO)+'¬, '
        +'¬heklmo¬ : ¬'+%trim(%editc(HEKLMO:'Z'))+'¬, '
N09     +'¬ttstat¬ : ¬'+%trim(HenLev)+'¬, '
N10     +'¬ttstat2¬ : ¬'+%trim(ttStat2)+'¬, '
        +'¬hepk1¬ : ¬'+%trim(HEPK1)+'¬, '
        +'¬dftoll¬ : ¬'+%trim(WSTOLL)+'¬, '     //tollsted
        +'¬hepk2¬ : ¬'+%trim(HEPK2)+'¬, '
        +'¬hepk3¬ : ¬'+%trim(HEPK3)+'¬, '
        +'¬hepk4¬ : ¬'+%trim(HEPK4)+'¬, '
        +'¬hepk5¬ : ¬'+%trim(HEPK5)+'¬, '
        +'¬hepk6¬ : ¬'+%trim(HEPK6)+'¬, '
        +'¬hepk7¬ : ¬'+%trim(HEPK7)+'¬, '
        +'¬hepk8¬ : ¬'+%trim(HEPK8)+'¬, '
        +'¬hepk9¬ : ¬'+%trim(HEPK9)+'¬, '
        +'¬hekdl¬ : ¬'+%trim(HEKDL)+'¬, '
        +'¬helb¬ : ¬'+%trim(HELB)+'¬, '
        +'¬helkfr¬ : ¬'+%trim(HELKFR)+'¬, '
        +'¬hesdfr¬ : ¬'+%trim(HESDFR)+'¬, '
        +'¬hestfr¬ : ¬'+%trim(HESTFR)+'¬, '
        +'¬herfk¬ : ¬'+%trim(HERFK)+'¬, '
        +'¬trslag¬ : ¬'+%trim(TRSLAG)+'¬, '
        +'¬travd0¬ : ¬'+%trim(%editc(TRAVD0:'Z'))+'¬, '
        +'¬tropd0¬ : ¬'+%trim(%editc(TROPD0:'Z'))+'¬, '
        +'¬travd1¬ : ¬'+%trim(%editc(TRAVD1:'Z'))+'¬, '
        +'¬tropd1¬ : ¬'+%trim(%editc(TROPD1:'Z'))+'¬, '
        +'¬travd2¬ : ¬'+%trim(%editc(TRAVD2:'Z'))+'¬, '
        +'¬tropd2¬ : ¬'+%trim(%editc(TROPD2:'Z'))+'¬, '
        +'¬trsffd¬ : ¬'+%trim(%editc(TRSFFD:'Z'))+'¬, '
        +'¬trsffk¬ : ¬'+%trim(%editc(TRSFFK:'Z'))+'¬, '
        +'¬trsdfd¬ : ¬'+%trim(%editc(TRSDFD:'Z'))+'¬, '
        +'¬trsdfk¬ : ¬'+%trim(%editc(TRSDFK:'Z'))+'¬, '
        +'¬trsdtd¬ : ¬'+%trim(%editc(TRSDTD:'Z'))+'¬, '
        +'¬trsdtk¬ : ¬'+%trim(%editc(TRSDTK:'Z'))+'¬, '
        +'¬trsvtd¬ : ¬'+%trim(%editc(TRSVTD:'Z'))+'¬, '
        +'¬trsvtk¬ : ¬'+%trim(%editc(TRSVTK:'Z'))+'¬, '
        +'¬trkdak¬ : ¬'+%trim(TRKDAK)+'¬, '
        +'¬trkdff¬ : ¬'+%trim(TRKDFF)+'¬, '
        +'¬trverv¬ : ¬'+%trim(TRVERV)+'¬, '
        +'¬trverb¬ : ¬'+%trim(%editc(TRVERB:'Z'))+'¬, '
        +'¬trettv¬ : ¬'+%trim(TRETTV)+'¬, '
        +'¬trettb¬ : ¬'+%trim(%editc(TRETTB:'Z'))+'¬, '
        +'¬trfrak¬ : ¬'+%trim(TRFRAK)+'¬, '
        +'¬trfrav¬ : ¬'+%trim(TRFRAV)+'¬, '
        +'¬trfrab¬ : ¬'+%trim(%editc(TRFRAB:'4'))+'¬, '
        +'¬trmva¬ : ¬'+%trim(TRMVA)+'¬, '
        +'¬trfa11¬ : ¬'+%trim(TRFA11)+'¬, '
        +'¬trfa12¬ : ¬'+%trim(TRFA12)+'¬, '
        +'¬trflP1¬ : ¬'+%trim(%editc(TRFLP1:'Z'))+'¬, '
        +'¬trfa21¬ : ¬'+%trim(TRFA21)+'¬, '
        +'¬trfa22¬ : ¬'+%trim(TRFA22)+'¬, '
        +'¬trflp2¬ : ¬'+%trim(%editc(TRFLP2:'Z'))+'¬, '
        +'¬trtsta¬ : ¬'+%trim(TRTSTA)+'¬, '
        +'¬trstaf¬ : ¬'+%trim(TRSTAF)+'¬, '
        +'¬trstae¬ : ¬'+%trim(TRSTAE)+'¬, '
        +'¬trsta1¬ : ¬'+%trim(TRSTA1)+'¬, '
        +'¬trsta2¬ : ¬'+%trim(TRSTA2)+'¬, '
        +'¬trsta3¬ : ¬'+%trim(TRSTA3)+'¬, '
        +'¬trsta4¬ : ¬'+%trim(TRSTA4)+'¬, '
        +'¬trkm¬ : ¬'+%trim(%editc(TRKM:'Z'))+'¬, '
        +'¬he01¬ : ¬'+%trim(HE01)+'¬, '
        +'¬hestd¬ : ¬'+%trim(%editc(HESTD:'Z'))+'¬, '
        +'¬hxsndn¬ : ¬'+%trim(HXSNDN)+'¬, '
        +'¬hxpall¬ : ¬'+%trim(%editc(HXPALL:'Z'))+'¬, '
        +'¬hxblgk¬ : ¬'+%trim(HXBLGK)+'¬, '
        +'¬hxLkod¬ : ¬'+%trim(HXLKOD)+'¬, '
        +'¬hxllst¬ : ¬'+%trim(HXLLST)+'¬, '
        +'¬hxedik¬ : ¬'+%trim(HXEDIK)+'¬, '
        +'¬hxteri¬ : ¬'+%trim(HXTERI)+'¬, '
S01     +'¬hehakn¬ : ¬'+%trim(%editc(HEHAKN:'Z'))+'¬, '
S01     +'¬hehaan¬ : ¬'+%trim(%editc(HEHAAN:'Z'))+'¬, '
S01     +'¬helakn¬ : ¬'+%trim(%editc(HELAKN:'Z'))+'¬, '
S01     +'¬helaan¬ : ¬'+%trim(%editc(HELAAN:'Z'))+'¬, '
TMS     +'¬helmla¬ : ¬'+%trim(%editc(HELMLA:'Z'))+'¬, '
TMS     +'¬hepoen¬ : ¬'+%trim(%editc(HEPOEN:'Z'))+'¬, '
TMS     +'¬hestl1¬ : ¬'+%trim(HESTL1)+'¬, '
TMS     +'¬hestl2¬ : ¬'+%trim(HESTL2)+'¬, '
TMS     +'¬hestl3¬ : ¬'+%trim(HESTL3)+'¬, '
TMS     +'¬hestl4¬ : ¬'+%trim(HESTL4)+'¬, '
TMS     +'¬hestn1¬ : ¬'+%trim(HESTN1)+'¬, '
TMS     +'¬hestn2¬ : ¬'+%trim(HESTN2)+'¬, '
TMS     +'¬hestn3¬ : ¬'+%trim(HESTN3)+'¬, '
TMS     +'¬hestn4¬ : ¬'+%trim(HESTN4)+'¬, '
TMS     +'¬hestn5¬ : ¬'+%trim(HESTN5)+'¬, '
TMS     +'¬hestn6¬ : ¬'+%trim(HESTN6)+'¬, '
TMS     +'¬hestn7¬ : ¬'+%trim(HESTN7)+'¬, '
TMS     +'¬hestn8¬ : ¬'+%trim(HESTN8)+'¬, '
TMS     +'¬hestn9¬ : ¬'+%trim(HESTN9)+'¬, '
TMS     +'¬herfed¬ : ¬'+%trim(HERFED)+'¬, '
        +'¬helib¬ : ¬'+%trim(HELIB)+'¬, '
        +'¬hefile¬ : ¬'+%trim(HEFILE)+'¬, '
        +'¬hembr¬ : ¬'+%trim(HEMBR)+'¬, '
        +'¬hetype¬ : ¬'+%trim(HETYPE)+'¬, '
        +'¬helvl¬ : ¬'+%trim(HELVL)+'¬, '
        +'¬hesnn¬ : ¬'+%trim(%editc(HESNN:'Z'))+'¬, '
        +'¬heunik¬ : ¬'+%trim(%editc(HEUNIK:'Z'))+'¬, '
        +'¬hereff¬ : ¬'+%trim(HEREFF)+'¬, '
N04     +'¬interninfo¬ : ¬'+%trim(InternInfo)+'¬}';
      /end-free
     C                   CALL      'JSONFIX'
     C                   PARM                    JSONstring
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   CALLP     wrtsection('JSONlin')

     C                   ENDSR
      *
N04   ************************************************************************
N04  C     FixIntern     BEGSR
N04   ************************************************************************
N04  c                   eval      InternInfo=*blanks
N04   *
N04  C     FREEKey       SETLL     FREETXT2
N04  C     FREEKey       READE     FREETXT2
N04  c                   dow       not %eof
N04  c                   if        InternInfo<>*blanks
N04  c                   eval      InternInfo=%trim(InternInfo)+'<br>'
N04  c                   endif
N04  c                   eval      InternInfo=%trim(InternInfo)+FRTTXT
N04  C     FREEKey       READE     FREETXT2
N04  C                   enddo
N04  C                   ENDSR
N07   ************************************************************************
N07  C     FixNavn       BEGSR
N07   ************************************************************************
N07   * Utgangspunktet er hente / leveringsadresse
N07  C                   eval      HENASutv = HENAS
N07  C                   eval      HENAKutv = HENAK
N07   * Avsender ?? (var i ferd med å sjekke både navn/adr1/adr2/ men KUN NAVN vises jo i kolonna)
N07  C                   if        HEKNS <> *zeros
N07  c                   eval      KUNDNR = HEKNS
N07  c     VadrKey       chain     VADR
N07  c                   if        not %found
N07  c     KunKey        chain     Cundl01
N07  C                   eval      VADRNA = KNAVN
N07  C                   endif
N07  C     LC:UC         XLATE     HENAS         Test1            30
N07  C     LC:UC         XLATE     VADRNA        Test2            30
N07  c                   if        Test1 <> Test2
N07  C                   eval      HENASutv =%trim(VADRNA)+'/ '+HENAS
N07  C                   endif
N07  C                   endif
N07   * Mottaker ?? (var i ferd med å sjekke både navn/adr1/adr2/ men KUN NAVN vises jo i kolonna)
N07  C                   if        HEKNK <> *zeros
N07  c                   eval      KUNDNR = HEKNK
N07  c     VadrKey       chain     VADR
N07  c                   if        not %found
N07  c     KunKey        chain     Cundl01
N07  C                   eval      VADRNA = KNAVN
N07  C                   endif
N07  C     LC:UC         XLATE     HENAK         Test1            30
N07  C     LC:UC         XLATE     VADRNA        Test2            30
N07  c                   if        Test1 <> Test2
N07  C                   eval      HENAKutv =%trim(VADRNA)+'/ '+HENAK
N07  C                   endif
N07  C                   endif
N07   *
N07  C                   ENDSR
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          BEGSR
     C                   OPEN      BRIDF
     C     USER          CHAIN     BRIDF                              50
      * En "standardvariant" libl: CALL bound (INCGI=*MODULE) med parameter.
     C     BILIBL        IFEQ      *blanks
     C                   CALLB     'INCGI'
     C                   PARM                    BISTDL
     C                   ELSE
      * Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   CALL      BILIBL
     C                   ENDIF

      * hent Parametre som går igjen i mange prog:
      *      Odd/Even/Rowhead-farger,Logobilde,Språk,Intern/Ekstern bruker,  mm
     C                   CALL      'ESGETPAR'
     C                   PARM                    BIBRID
     C                   PARM                    BIFIRM
     C                   PARM                    BIKUNR
     C                   PARM                    BIKNG
     C                   PARM                    RowHead          10
     C                   PARM                    Odd              10
     C                   PARM                    Even             10
     C                   PARM                    LogoImg          50
     C                   PARM                    XSPRÅK            2
     C                   PARM                    XINTERN           1
     C                   PARM                    PARMDS1        1024
     C                   PARM                    PARMDS2        1024
     C                   PARM                    PARMDS3        1024
      * HENTER PARAMETER
     C                   CALL      'ESGETOS'
     C                   PARM                    BIBRID
     C                   PARM                    BIFIRM
     C                   PARM                    BIKUNR
     C                   PARM                    BIKNG
     C                   PARM                    PARMOS1        1024

     C   50              EVAL      Error = 'Invalid userID'
N02  c   50              goto      UtIni
      *
     C  N50              OPEN      BRPARF
     C  N50              OPEN      DISP
     C  N50              OPEN      DISPL04
     C  N50              OPEN      DISPL19
     C  N50              OPEN      KODTA
     C  N50              OPEN      HEADF
     C  N50              OPEN      DOKUF
N04  C  N50              OPEN      FREETXT2
N07  C  N50              OPEN      CUNDL01
N07  C  N50              OPEN      VADR
N09  C  N50              OPEN      TRACKL02
N11  C  N50              OPEN      FRISOK

     C     HEADFKLT      KLIST
     C                   KFLD                    DIAVD
     C                   KFLD                    DIOPD
     C     DISPL04K      KLIST
S08  C*                  KFLD                    XDISTA1
N08  C                   KFLD                    WSDISTA
     C                   KFLD                    XDITUR
     C                   KFLD                    XDIAVD
     C     DISPL19K      KLIST
S08  C*                  KFLD                    XDISTA1
N08  C                   KFLD                    WSDISTA
     C                   KFLD                    XDITUR
     C     HEADFKey      KLIST
     C                   KFLD                    WBSAVD
     C                   KFLD                    WBSOPD
     C     DOKUFKey      klist
     C                   kfld                    DFRI
S04  C*                  kfld                    WBSAVD
S04  C*                  kfld                    WBSOPD
N04  C                   kfld                    HEAVD
N04  C                   kfld                    HEOPD
     C                   kfld                    DFFBNR
     C                   move      'F'           DFRI
     C                   z-add     1             DFFBNR
N04  C     FREEKey       KLIST
N04  C                   kfld                    HEAVD
N04  C                   kfld                    HEOPD
N04  C                   KFLD                    FRTKOD
N07  C     KunKey        KLIST
N07  C                   kfld                    BIFIRM
N07  C                   kfld                    KUNDNR
N07  C     VadrKey       KLIST
N07  C                   kfld                    BIFIRM
N07  C                   kfld                    KUNDNR
N07  C                   kfld                    VADRNR
N07  C                   z-add     1             VADRNR
N09  C     TT02KEY       KLIST
N09  C                   KFLD                    HEAVD
N09  C                   KFLD                    HEOPD
N09  C                   KFLD                    TTFBNR
N09  C                   KFLD                    TTACTI
     C     KOAkey        KLIST
     C                   KFLD                    KOAUNI
     C                   KFLD                    HEAVD
     C                   MOVEL     'A'           KOAUNI
     C     BrParKey      KLIST
     C                   KFLD                    PABRID
     C                   KFLD                    PAKUNR
     C                   KFLD                    PAID
     C                   MOVE      BIBRID        PABRID
     C                   MOVE      *zeros        PAKUNR

     C                   MOVE      'TURPL'       PAID
     C  N50BrParKey      CHAIN     BRPARF                             33
     C  N33              MOVEL     PAVRDA        XTURTYPE          1
S06  C*  33              MOVE      'O'           XTURTYPE
N06  C   33              MOVE      'L'           XTURTYPE
S08  C*                  MOVE      ' '           XDISTA1           1
     C                   MOVE      *ZEROS        XDITUR            8 0

     C                   MOVE      'LTAVD'       PAID
     C  N50BrParKey      CHAIN     BRPARF                             33
     C  N33              Z-ADD     PAVRDN        XDIAVD            4 0
     C  N33              MOVE      XDIAVD        XSTDAVD           4
      * select avd oppgitt (annet enn all/in/out..)
     C                   IF        WBSAVD <> 0
     C                             and WSSAVD <> *blanks
     C                   MOVE      WBSAVD        XDIAVD
     C                   ENDIF
N05  c                   IF        WSSAVD <> *blanks and
N05  c                             WSSAVD  < '0000'                             alfa
N02  C                   IF        WSSAVD='ALL' OR
N02  C                             WSSAVD='IN ' OR WSSAVD='OUT' OR
N02  C                             WSSAVD='IMP' OR WSSAVD='EXP' OR
N02  C                             WSSAVD='DOM'
N02  C                   MOVE      'J'           MANGEAVD          1
N05  C                   ELSE
N05   * Alfa utenom de faste = avd-gruppe
N05  c                   exsr      AvdGruppe
N05  c                   if        aNr <> *zeros
N05  C                   eval      MANGEAVD = 'J'
N05  c                   endif
N02  c                   ENDIF
N05  C                   ENDIF
      *
N02  C                   IF        WBSOPD <> *zeros
N02  C     HEADFKey      CHAIN     HEADF                              33
N02  C   33              eval      Error = 'Ukjent oppdragsnummer '
N02  C                                   + %trim(%editc(WBSAVD:'Z'))+'/'
N02  C                                   + %trim(%editc(WBSOPD:'Z'))
N02  C                   ENDIF
      *
N01  C**                 z-add     5000          MaxLes
N01  C**                 z-add     200           MaxVis
N07  C                   z-add     15000         MaxLes
N07  C                   z-add     600           MaxVis

     C     UtIni         ENDSR
      *
N05   ****************************************************************
N05  c     AvdGruppe     BEGSR
N05   ****************************************************************
N05  c                   move      *zeros        aNr               2 0
N05   * MYDP = My Departments - alle av type
N05  c                   if        WSSAVD = 'MYDP'
N05  C                   MOVE      'LTAVD'       PAID
N05  C     BrParKey      setll     BRPARF
N05  C     BrParKey      reade     BRPARF                                 33
N05  c     *in33         doweq     '0'
N05  c                   add       1             aNr
N05  C                   Z-ADD     PAVRDN        sAv(aNr)
N05  C     BrParKey      reade     BRPARF                                 33
N05  c                   enddo
N05  c                   ELSE
      * .. navngitt avd-gruppe, primært på User/sekundært på Firma
N05  C                   MOVE      'LTAGD'       PAID
N05  C     StrLes        tag
N05  C     BrParKey      setll     BRPARF
N05  C     BrParKey      reade     BRPARF                                 33
N05  c     *in33         doweq     '0'
N05  c                   add       1             aNr
N05  C                   Z-ADD     PAVRDN        sAv(aNr)
N05  C     BrParKey      reade     BRPARF                                 33
N05  c                   enddo
N05   * ingen på user-nivå - prøv firmanivå
N05  c                   if        aNr = *zeros and
N05  c                             %subst(PABRID:1:8) <> '*KUNDFT*'
N05  C                   eval      PABRID    = '*KUNDFT*'+BIFIRM
N05  C                   goto      StrLes
N05  c                   endif
N05  c
N05  c                   ENDIF
N05  C                   ENDSR
N09  C***********************************************
N09  C     TTstatus      BEGSR
N09  C***********************************************
N09   * Status m.h.t. T&Tevents hentet / levert...
N09  C                   eval      HENLEV='Levert'
N09   * sjekk om den er levert / evt hentet
N09   * LEVERT ??
N09  C                   MOVE      'POD'         TTACTI
N09  c     TT02key       Chain     TRACKl02                           33
N09  C                   if        *in33=*on and TRSLAG='FF'
N09  C   33              MOVE      'TEI'         TTACTI
N09  c   33TT02key       Chain     TRACKl02                           33
N09  c                   endif
N09  C     *in33         ifeq      *ON
N09  C                   MOVE      'TE2'         TTACTI
N09  c     TT02key       setll     TRACKl02
N09  c     TT02key       reade     TRACKl02                               33
N09  c     *in33         doweq     '0'
N09  c                   if        %subst(TTTEXT:1:9)='Signed by'
N09  c                   leave
N09  c                   endif
N09  c     TT02key       reade     TRACKl02                               33
N09  c                   enddo
N09  c                   endif
N09   * er ikke levert...
N09   * HENTET ??
N09  C     *in33         ifeq      *ON
N09  C                   eval      HENLEV='Hentet'
N09  C                   MOVE      'COL'         TTACTI
N09  c     TT02key       Chain     TRACKl02                           33
N09  C   33              MOVE      'TEU'         TTACTI
N09  c   33TT02key       Chain     TRACKl02                           33
N09   * heller ikke hentet
N09  C   33              Movea     '10'          *IN(57)
N09  C   33              eval      HENLEV='Urørt'
N09   * På term ?
N09  c     *in33         ifeq      '1'
N09  C                   MOVE      'TEI'         TTACTI
N09  c     TT02key       Chain     TRACKl02                           33
N09  C   33              MOVE      'TE2'         TTACTI
N09  c   33TT02key       Chain     TRACKl02                           33
N09  C  N33              eval      HENLEV='På Term'
N09  c                   endif
N09  c                   endif
N09   * Ekstra felt for utvidet status ??
N10  c                   move      *blanks       ttStat2          10
N09   *
N09  c                   ENDSR
N09  C*
