     H  debug(*yes)
********************************************************************
      *__________________________
      * Utskrift av samlefaktura.
      *""""""""""""""""""""""""""
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 avvikende fakturaadr(vadr -1) - Skannesentral el.l. - LÅNER XDINV / ind 48
10XXX * 02 SH  PTF10 moms i norske kroner
10XXX * 03 SH  PTF10 feil språkkode test grunnet endring 01
10XXX * 04 SH  PTF10 sikre tømming fitaxb
10XXX * 05 SH  PTF10 endrer indikator i INIT  (arkivrelatert)
10XXX * 06 SH  PTF10 tatt bort noen gamle dump statement
10XXX * 07 SH  PTF10 fjernet bruk av indikator 84
10XXX * 08 YBC PTF10 SPESIFIKASJON PÅ LAGERGEBYR (TOTAL)
10XXX * 09 SH  PTF10 tar vare på betbet
10XXX * 10 SH  PTF10 selektere selger
10XXX * 11 SH  PTF10 ikke test kreditnota side 2 av original eller arkiv
10XXX * 12 SH  PTF10 kidnummer er nå fakturanummer
10XXX * 13 SH  PTF10 EGEN TEKST TRACK AND TRACE VED EPOST
10XXX * 14 SH  PTF10 ikke hode på fax/arkiv
10XXX * 15 SH  PTF10 gironummer økt til 25
10XXX * 16 SH  PTF10 rettelse text i TT
      * 17 SH  PTF10 Printe prøvekjøring uansett
      * 18 SH  PTF10 fikser på taxnummer
10172 * 19 SH  PTF10 norsk text til Track and trace
10172 * 20 SH  PTF10 lankkode avvikende fakturaadresse
10172 * 21 SH  PTF10 valuta også ved  NOK local valuta
10172 * 22 SH  PTF10 også norske kundwer kan ha vatnr i sypar
10207 * 23 SH  PTF10 FRITEKST VARELINJE
10207 * 24 SH  PTF10 fra til sted på standardlayout
10XXX * 25 YBC PTF10 XML-FAKT SKAL OGSÅ KUNNE KREDITERE
10207 * 26 SH  PTF10 rettelse til PTF 24
10XXX * 27 YBC PTF10 ENDRING 12 ER IKKE TATT MED TIL XML-FAKTURA
10XXX * 28 SH  PTF10 Uhod = C er ny kode ved arkivering
10XXX * 29 SH  PTF10 utelate epost på oppdragstyper
10XXX * 30 SH  PTF10 landkoder på engelsk tysk norsk
10XXX * 31 JOV PTF10 Fakturageby rkan føyes til (på siste oppdrag)
10XXX * 32 JOV PTF10 Test mot Kredit ved arkivert faktura
10XXX * 33 SH  PTF10 slår av of-indikator 90 annulert
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11XXX * 34 YBC PTF11 HENT KID-NR SENERE VED XML-FAKTURA
10XXX * 35 SH  PTF11 annulert ptf 33
10XXX * 36 SH  PTF11 layout printfil
10XXX * 37 SH  PTF11 kidlinje er flyttet litt opp og fakturatotal
11XXX * 38 SH  PTF11 KODE F SKAL VÆRE LIK KODE P PDF
11XXX * 39 SH  PTF11 Dobbelskrift siderudd
11XXX * 40 JOV PTF11 sie GodsNr ELLER Innlands sendnr + få med Antall
11XXX * 41 SH  PTF11 korrigerer litt fakturagebyr
11XXX * 42 YBC PTF11 IKKE TEST MAIL VED XML-FAKTURA
11XXX * 43 SH  PTF11 KOWHOD ved Arkivering
11XXX * 44 SH  PTF11 FTOT2B endret noe
      * 45 JOV PTF11 SKILLE PÅ KRED-NOTA OGSÅ PÅ SPESIFIK.
      * 46 JOV PTF11 Sjekke om det er kredit FØR print også ved original..
      * 47 SH  PTF11 finpuss aft/pdf etc
      * 48 SH  PTF11 FORBEDRET DETALJER PÅ PDF ETC
      * 49 JOV PTF11 Ekstra linje for sFak-geb ikke rett oppdatert (hvis siste linje ble deletet)
      * 50 JOV PTF11 Databasefelt (knytte til Rambergspesial) utgår i CUTRAN
      * 51 SH  PTF11 div finpuss
      * 52 SH  PTF11 skriver både til epostmottager og andre
      * 52 SH  PTF11 slettet litt tester litt rått da det er rotete ellers
      * 52 SH  PTF11 OBS INDIKATON 55 ER SKAL PRINTES  IKKE MERKET
      * 53 TH  PTF11 Langt kundenavn (ZKNAV)
      * 54 SH  PTF11 Stygg feil i fakturagebyr
      * 55 SH  PTF11 sikre skriv facd22
      * 56 SH  PTF12 rettelse til 52
      * 57 SH  PTF12 måtte flytte test om skrive eller ikke
      * 58 SH  PTF12 rettelse ind 55 ved output printer
      * 59 SH  PTF12 kroner/øre gjort om til et felt på kidlin
      * 60 SH  PTF12 stopper å plukke ved 7000 record
12XXX * 61 YBC PTF12 Valutakonto i GIRO25
12XXX * 62 SH  PTF12 EVT Utelate kundenummer
12XXX * 63 SH  PTF12 mva i nok var feil + Endre SHU1220 i SYMSGF
12XXX * 64 YBC PTF12 Feil i oppdatering på XMLUFF ved flere momskoder
12XXX * 65 sh  PTF12 tester til og med dato
12164 * 66 YBC PTF12 Send kreditnota på e2b eller EHF
      * 67 JOV PTF12 NY: F.DATO i XMLUFF
      * 68 SH Også kid8 ved kopi
12XXX * 69 YBC PTF12 Total moms i NOK = 0
********************************************************************
      *____________________________________________________
      *  INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER
      *  INNDIKATOR 27 PÅ/28 AV = KOPI AV SAMLEFAKTURA
      *  INNDIKATOR 27 PÅ/28 PÅ = PRØVEKJØRING AV SAMLEFAKTURA
      *  INNDIKATOR 27 PÅ/28 PÅ/URETUR=S PRØVEKJ. KUN SPESIFIK.DELEN
      *  INNDIKATOR 90 PÅ = OVERFLOW AV SYFA27PS (SAMLELIST)
      *  35 = GIRO SKRIVES IKKE
      *"""""""""""""""""""""""""""""""""""""""""""""""""""""
N24  FSTED2D    IF   E           K DISK
N24  FSTED2     IF   E           K DISK
N24  F                                     RENAME(STED2R:STED2DR)
N23  FFAKTXT    IF   E           K DISK
     FBAGIRO    IF   E           K DISK
     FCUNDC03   IF   E           K DISK
     FARKTXT    IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FARKIVP    O  A E             DISK
s12  F*IRKID    UF   E           K DISK
n12  FFIRKID    IF   E           K DISK
     FKIDTRAN   UF A E           K DISK
     FKODTFT    IF   E           K DISK
     FKODTFM    IF   E           K DISK
     FKODTP     IF   E           K DISK
S31  F*FAKT      UF   E           K DISK
N31  FFAKT      UF A E           K DISK
N31  FFIRINL    IF   E           K DISK
N31  FCUTRAN    IF   E           K DISK
     FFAK8      IF   E           K DISK    RENAME(FAKTR:FAK8R)
     FSORT      UF A E           K DISK
     FFAIN      UF A E           K DISK
     FHEADF     UF   E           K DISK
     FTURER     IF   E           K DISK
     FTURER14   IF   E           K DISK    RENAME(TURERR:TURERR14)
     FDISP      IF   E           K DISK
     FKODTGE    IF   E           K DISK
     FKODTLK    IF   E           K DISK
     FKODTG2    IF   E           K DISK
     FKODSAM    IF   E           K DISK
     FKODTOTY   IF   E           K DISK
     FKODTFR    IF   E           K DISK
     FKODTA     IF   E           K DISK
     FKODTV     IF   E           K DISK
     FKODTÅ     IF   E           K DISK
     FKODTH     IF   E           K DISK
     FKODTW     IF   E           K DISK
     FHODE      IF   E           K DISK
     FHODEFAX   IF   E           K DISK    RENAME(HODER:HODERF)
     FfIRM      iF   E           K DISK
     Ftellfa    uF   E           K DISK
     FFREETXT2  UF   E           K DISK
     FCUNDL01   IF   E           K DISK
N01  FVADR      IF   E           K DISK
     FSAML      UF   E           K DISK
     FWSAML     UF A E           K DISK
     FWSAMGE    UF A E           K DISK
     FWSAMGE1   IF   E           K DISK    RENAME(WSAMGER:WSAMG1R)
     FCUSAPR    IF   E           K DISK
     FFRISOK    IF   E           K DISK
     FKODFRI    IF   E           K DISK
     FKODWL01   IF   E           K DISK
     FCUFLD     IF   E           K DISK
     FSYPARL1   IF   E           K DISK
     FLLGSFL06  IF   E           K DISK
N08  FLLGSFL01  IF   E           K DISK    RENAME(LLGSFR:LLGSFR1)
     FTRACKF    O  A E           K DISK
     FSYFA27W   O  A E             DISK
     FECMSG     IF   E           K DISK
     FXMLUFF    O  A E             DISK
     FSYFA27FM  CF   E             WORKSTN USROPN
     F                                     INFDS(FBAREA)
     FSYFA27PF  O    E             PRINTER USROPN
     FSYFA27PG  O    E             PRINTER USROPN
     FSYFA27PS  O    E             PRINTER OFLIND(*IN90)
     F                                     USROPN
     D HO              S             80    DIM(10)
     D HE              S             80    DIM(10)
     D HT              S             80    DIM(10)
N08  D GEB             S              3    DIM(100)
N08  D ANT             S              9  2 DIM(100)
N08  D PRI             S              7  2 DIM(100)
N23  D FTX             S             40    DIM(100)
      *___________________________
      * Finner username
      *"""""""""""""""""""""""""""
     D                SDS
     D  ZJOB                 244    253
     D  ZUSER                254    263
     D  ZJOBNR               264    269  0
N64  D                 DS
N64  D  XFMS01                 1      4  2
N64  D  XFMS02                 5      8  2
N64  D  XFMS03                 9     12  2
N64  D  XFMS04                13     16  2
N64  D  XFMS05                17     20  2
N64  D  XFMS06                21     24  2
N64  D  XFMS07                25     28  2
N64  D  XFMS08                29     32  2
N64  D  XFMS09                33     36  2
N64  D  XFMS10                37     40  2
N64  D  XFMS11                41     44  2
N64  D  XFMS                   1     44  2 DIM(11)
N64  D                 DS
N64  D  XFMV01                 1      3
N64  D  XFMV02                 4      6
N64  D  XFMV03                 7      9
N64  D  XFMV04                10     12
N64  D  XFMV05                13     15
N64  D  XFMV06                16     18
N64  D  XFMV07                19     21
N64  D  XFMV08                22     24
N64  D  XFMV09                25     27
N64  D  XFMV10                28     30
N64  D  XFMV11                31     33
N64  D  XFMV                   1     33    DIM(11)
N64  D                 DS
N64  D  XFMGN1                 1     13  2
N64  D  XFMGN2                14     26  2
N64  D  XFMGN3                27     39  2
N64  D  XFMGN4                40     52  2
N64  D  XFMGN5                53     65  2
N64  D  XFMGN6                66     78  2
N64  D  XFMGN7                79     91  2
N64  D  XFMGN8                92    104  2
N64  D  XFMGN9               105    117  2
N64  D  XFMGNA               118    130  2
N64  D  XFMGNB               131    143  2
N64  D  XFMGN                  1    143  2 DIM(11)
N64  D                 DS
N64  D  XFMGV1                 1     13  2
N64  D  XFMGV2                14     26  2
N64  D  XFMGV3                27     39  2
N64  D  XFMGV4                40     52  2
N64  D  XFMGV5                53     65  2
N64  D  XFMGV6                66     78  2
N64  D  XFMGV7                79     91  2
N64  D  XFMGV8                92    104  2
N64  D  XFMGV9               105    117  2
N64  D  XFMGVA               118    130  2
N64  D  XFMGVB               131    143  2
N64  D  XFMGV                  1    143  2 DIM(11)
N67  D                 DS
N67  D  XFN                    1      7  0
N67  D  YFN                    1      7  0
     D                 DS
     D  DFS                    1     10
     D                                     DIM(10)
     D  FSDOKK                 1     10
     D                 DS
     D  HEPOS1                 1      7
     D  XPOS1                  1      4
NRFA D                 DS
NRFA D  HERFA                  1     35
NRFA D  HERFA15                1     15
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D UCMD            DS          1024
     D                 DS
     D XCMD11          C                   CONST('OVRPRTF -
     D                                     FILE(SYFA27PS) -
     D                                     COPIES(')
     D                 DS
     D  WSFDAD                 1      2  0
     D  WSFDAM                 3      4  0
     D  WSFDAA                 5      6  0
     D  WSFDAT                 1      6  0
     D                 DS
     D  WKID                   1     19
     D  XWKID                  1     19
     D  KWKID                  1     19
     D  KUNDNR                 1      8  0
     D  TEFFNR                 9     15  0
     D  XNULL                 16     19  0
     D                 DS
     D  XBAK                   1      1  0
     D  ABAK                   1      1
     D  KBAK                   1      1
     D  XTOTØR                13     14  0
     D  ATOTØR                13     14
     D  ATOTØK                13     14
     D  KTOTØR                13     14  0
     D                 DS
     D  XBRUT                  1     13  2
     D  CBRUTT                 1     13  2
     D                 DS
     D  A                      1     11
     D                                     DIM(11)
     D  ATOTKR                 1     11
     D  ATOTKK                 1     11
     D                 DS
     D  D                      1     10
     D                                     DIM(10)
     D  WSDS                   1     10
     D                 DS
     D  DGR                    1     10
     D                                     DIM(10)
     D  WSGRDS                 1     10
     D                 DS
     D  ADR3                   1     24
     D  ADR31                  1     24
     D  ADR3B                  1     24
     D  ADR3C                  1     24
     D                 DS
     D  XVAL                   1      3
     D  XVAL1                  1      3
     D                 DS
     D  SAAVD                  1      4  0
     D  SAOPD                  5     11  0
     D  AVOPDS                 1     11
     D                 DS
     D  FADATO                 1      8  0
     D  FADATÅ                 1      4  0
     D  FADATM                 5      6  0
     D  FADATD                 7      8  0
     D                 DS
     D  FADAFF                 1      8  0
     D  FADAFÅ                 1      4  0
     D  FADAFM                 5      6  0
     D  FADAFD                 7      8  0
     D                 DS
     D  IDAGÅ                  1      4  0
     D  IDAGM                  5      6  0
     D  IDAGD                  7      8  0
     D  IDAG8                  1      8  0
     D  IDAG                   3      8  0
     D                 DS
     D  IDAGXD                 1      2  0
     D  IDAGXM                 3      4  0
     D  IDAGXÅ                 5      6  0
     D  IDAGX                  1      6  0
     D                 DS
     D  XFFDTD                 1      2  0
     D  XFFDTM                 3      4  0
     D  XFFDTÅ                 5      6  0
     D  XFFDT                  1      6  0
     D                 DS
     D  HEDTÅ                  1      4  0
     D  HEDTYY                 3      4  0
     D  HEDTM                  5      6  0
     D  HEDTD                  7      8  0
     D  HEDTOP                 1      8  0
     D                 DS
     D  XEDTOD                 1      2  0
     D  XEDTOM                 3      4  0
     D  XEDTOÅ                 5      6  0
     D  XEDTOP                 1      6  0
     D                 DS
     D  WSPER                  1      4  0
     D  YDTPM                  1      2  0
     D  YDTPÅ                  3      4  0
     D                 DS
     D  SOLNR                  1      3  0
     D  KG2SRT                 1      3  0
     D                 DS
     D  SOAVD                  2      5  0
     D  FAAVD                  2      5  0
     D  SOOPD                  6     12  0
     D  FAOPD                  6     12  0
     D  SOSK                  13     13
     D  FASK                  13     13
     D  SOVK                  14     16
     D  FAVK                  14     16
     D  SOVT                  17     36
     D  FAVT                  17     36
     D  XFAVT1                17     17
     D  XFAVT2                18     36
     D  SOVAL                 37     39
     D  FAVAL                 37     39
     D  SOBELV                40     52  2
     D  FABELV                40     52  2
     D  SOKDM                 53     53
     D  FAKDM                 53     53
     D  SOBELN                54     66  2
     D  FABELN                54     66  2
     D  SOSAMM                67     67
     D  FACD11                67     67
n23  D  SOLI                  70     74  0
n23  D  FALI                  70     74  0
     D                 DS
     D  HOHT1                  1     80
     D  HOHT2                 81    160
     D  HOHT3                161    240
     D  HOHT4                241    320
     D  HOHT5                321    400
     D  HOHT6                401    480
     D  HOHT7                481    560
     D  HOBT1                561    640
     D  HOBT2                641    720
     D  HOBT3                721    800
     D  HP                     1    800
     D                                     DIM(10)
     D                 DS
     D  XTOTKR                 1     11  0
     D  KTOTKR                 1     11  0
     D                 DS
     D  XFBANK                 1     15
     D  KFBANK                 1     15
     D  XFB1                   1     15    DIM(15)
     D                 DS
     D  XFBANK2                1     15
     D  XFB2                   1     15    DIM(15)
     D                 DS
     D  BANKG                  1     15
     D  BANKGK                 1     15
      *
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     D                 DS
     D  TTTEXT                 1     70
     D  TTINT1                 1      9
     D  TTINVN                11     40
s16  D* TTINT2                44     50
s16  D* TTINVR                52     57
      * Arrays - oppdragsnivå - for variabel moms
     D  WSMVAK         S              1    DIM(11)                              Momskoder
     D  WSMVAP         S              4  2 DIM(11)                              %-sats
     D  WSGRL          S             13  2 DIM(11)                              Grunnlag
     D  WSMVA          S              9  2 DIM(11)                              Mva-bel.
      * Arrays - TOTALnivå    - for variabel moms
     D  WXMVAK         S              1    DIM(11)                              Momskoder
     D  WXMVAP         S              4  2 DIM(11)                              %-sats
     D  WXGRL          S             13  2 DIM(11)                              Grunnlag NOK
     D  WXMVA          S              9  2 DIM(11)                              Mva-bel. NOK
      * Benyttet momssats dobbeltdefinert i DS for å forenkle logikk i pgm
     D                 DS
     D  MVAPRO                 1      4  2                                      eks: 25,00
     D  FITAXB                 1      4  4                                      eks: 0,2500
     D                 DS
     D  WSDATE                 1      6  0
     D  WSYYE                  1      2  0
     D  WSMME                  3      4  0
     D  WSDDE                  5      6  0
     D                 DS
     D  WSDATO                 1      6  0
     D  WSDDO                  1      2  0
     D  WSMMO                  3      4  0
     D  WSYYO                  5      6  0
n29  D                 DS
n29  D  av                     1     80  0
n29  D                                     DIM(20)
n29  D  CAVD                   1     80
n29   *
n29  D                 DS
n29  D  OTY                    1     10
n29  D                                     DIM(5)
n29  D  COPD                   1     10
     D                UDS
     D  UFIRM                  1      2
     D  UAVD                  15     18  0
     D  USG                   19     21
     D  UPRO                  22     29  0
     D  UDT                   30     35  0
     D  UHOD                  47     47
     D  UBBS                  48     48
     D  UGN                  981    995
     D                 DS
     D  SYRG                   1     14
     D  SYFOR1                 1      9
     D  SYFOR2                10     11
     D                 DS
     D  INKL                   1    210
     D  INKL1                  1     70
     D  INKL2                 71    140
     D  INKL3                141    210
S52  D*EPOTXI          C                   CONST('SELEKTERING EPOST-MO-
S52  D*                                    TTAGERE')
     IKODSAMR
     I              SANORS                      KGENOT
     I              SAENGE                      KGEENT
     I              SATYSK                      KG2TYT
      *
     C                   EXSR      INIT
     C     UFNKOP        IFEQ      *ZEROS
     C                   OPEN      SYFA27FM
     C                   END
      *
     C     *IN27         IFEQ      *OFF
      * ORIGINAL
     C                   EXSR      PRINT1
     C                   ELSE
      * KOPI
     C                   EXSR      PRINTK
     C                   END
      *
     C                   MOVE      XPRANT        UPRANT
      *
     C     UFNKOP        IFEQ      *ZEROS
     C                   CLOSE     SYFA27FM
     C                   END
     C                   SETON                                        LR
     C                   RETURN
      *
      ******************************************
     C     PRINT1        BEGSR
      ******************************************
      *
     C                   CLEAR                   WSDATO
     C     STB1          TAG
     C                   EXSR      XDTFMT
     C                   EXFMT     BILDE01
     C                   EXSR      XDTFMT
      *
     C     *IN03         IFEQ      '1'
      * Tøm WSAML for poster denne job/WS
     C                   EXSR      DELW
     C                   GOTO      ENDPR1
     C                   END
      *
     C     *IN04         IFEQ      '1'
     C                   EXSR      SØKDTA
     C                   GOTO      STB1
     C                   END
      *
     C                   EXSR      TESTB1
     C     *IN30         IFEQ      '1'
     C                   GOTO      STB1
     C                   END
      * Plukk (basert på valg i BILDE01) poster til Work-fil
      * Workfil vises/kan fjerne poster (F12 - tilbake til Bild01)
     C                   EXSR      PLUKK
      *
      * F12=NYTT UTVALG
     C     URETUR        IFEQ      'Y'
     C                   GOTO      STB1
     C                   END
      * F3=AVBRUDD
     C     URETUR        IFEQ      '3'
     C                   GOTO      ENDPR1
     C                   END
      *
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
      * HAR NÅ SLÅTT F16= KJØR FAKTURA  ( )
      *        ELLER F10= KJØR PRØVEKJ. (P)
      *        ELLER F11= KJØR PRØVEKJ. KUN SPESIFIK.(S)
      *''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      * Hvis prøvekjøring valgt SIMULERES kopi med fakt.nr=0 + *IN28 ON
     C     URETUR        IFEQ      'P'
     C     URETUR        OREQ      'S'
     C                   MOVE      *ZEROS        WSFN
     C                   MOVEA     '11'          *IN(27)                         *IN27 OG 28
s52  C*                  MOVE      'J'           CPRINT
     C                   END                                                     =PRØVEKJ.
      *
     C                   MOVE      *ZEROS        XXFAKT
     C                   EXSR      PRISAM
      *
     C     ENDPR1        ENDSR
      *
      ******************************************
     C     PRISAM        BEGSR
      ******************************************
     C     PRISTR        TAG
      *PRØVEUTSKRIFT
     C   27              Z-ADD     1             ANTKOP
      *
      * RESTILLER TIL FØRSTE HEADINGTEKST
     C     KOPFM         SETLL     KODTFM
     C     KOPFM         READE     KODTFM                                 42
     C                   Z-ADD     1             KOPINR            5 0
     C                   EXSR      LESWFI
      *
      * SKRIVER EKSTRAKOPIER AV SAMLEFAKTURA
      *
     C  N27KOPINR        IFLT      ANTKOP
     C                   SETOFF                                       42
     C     *IN42         DOWEQ     '0'
     C     KOPFM         READE     KODTFM                                 42
     C                   ADD       1             KOPINR
     C  N42              DO
     C                   MOVE      XFN           WSFN
     C                   Z-ADD     WSFN          XXFAKT
     C                   Z-ADD     WSFN          TEFFNR
     C                   SETON                                        27
     C                   EXSR      LESWFI
     C                   SETOFF                                       27
     C                   END
     C                   END
     C                   END
      *  flere kunde/valutaer i workfila.
     C     XXUNIK        SETLL     WSAML
     C     XXUNIK        READE     WSAML                                  30
     C  N30              MOVE      *ZEROS        WSFN
     C  N30              MOVE      *ZEROS        XXFAKT
     C  N30              GOTO      PRISTR
     C                   ENDSR
      ******************************************
     C     TESTB1        BEGSR
      ******************************************
      *
     C                   SETOFF                                       30
     C                   MOVEA     '000000'      *IN(94)
      *
     C     WSAVD         IFNE      *ZEROS
     C     KODTAK        CHAIN     KODTA                              99
     C   99              SETON                                        30
     C   99              MOVE      'SPA0002'     MSGNR
     C                   END
      * Dersom avdeling er gitt test gyldighet
      * Dersom varsel alt er gitt - Ikke sjekk kundenr =0
     C   72WSKN          IFEQ      *ZEROS
     C                   SETOFF                                           72
     C                   GOTO      STINI2
     C                   END
     C  N72WSKN          IFEQ      *ZEROS
     C                   SETON                                            72
     C   98              MOVE      'SPK0002'     MSGNR
     C   98              SETON                                        30
     C                   END
      * Test Periode
     C     STINI2        TAG
n65   *** TEST oppdragsdato DATO
n65  C     WSDATO        IFNE      *ZEROS
n65  C                   MOVE      WSYYO         UÅÅ               2 0
n65  C                   MOVE      WSMMO         UMM               2 0
n65  C                   MOVE      WSDDO         UDD               2 0
n65  C                   CALL      'TESTDATO'
n65  C                   PARM                    UDD
n65  C                   PARM                    UMM
n65  C                   PARM                    UÅÅ
n65  C                   PARM                    UFLAGG            1 0
n65  C     UFLAGG        COMP      1                                      81
n65  C   81              MOVE      'SPD0001'     MSGNR
n65  C   81              SETON                                        30
n65  c                   end
S65  C* N30YDTPÅ         IFGT      50
N65  C     YDTPÅ         IFGT      50
     C                   MOVE      '19'          YDTPC
     C                   ELSE
     C                   MOVE      '20'          YDTPC
     C                   END
     C     KODTÅK        CHAIN     KODTÅ                              96
N65  C     *IN30         IFEQ      '0'
     C   96              MOVE      'SPP0001'     MSGNR
     C   96              SETON                                        30
n65  C                   END
      *** TEST DATO
     C     WSFDAT        IFNE      *ZEROS
     C                   MOVE      WSFDAA        UÅÅ               2 0
     C                   MOVE      WSFDAM        UMM               2 0
     C                   MOVE      WSFDAD        UDD               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      94
N65  C     *IN30         IFEQ      '0'
     C   94              MOVE      'SPD0001'     MSGNR
     C   94              SETON                                        30
n65  C                   END
     C     *IN30         IFEQ      '0'
     C                   MOVE      WSFDAT        IDAGX
     C     WSFDAT        IFEQ      0
     C                   MOVE      *ZEROS        IDAG8
     C                   ELSE
     C                   MOVE      IDAGXD        IDAGD
     C                   MOVE      IDAGXM        IDAGM
     C     IDAGXÅ        IFGT      50
     C     IDAGXÅ        ADD       1900          IDAGÅ
     C                   ELSE
     C     IDAGXÅ        ADD       2000          IDAGÅ
     C                   END
     C                   END
     C                   END
     C                   END
      *
      *
     C                   ENDSR
      *
      ******************************************
     C     PLUKK         BEGSR
      ******************************************
n60  c                   z-add     0             antrecords        5 0
n60  c                   z-add     0             sistekunde        8 0
     C     *LOVAL        SETLL     SAML
      *
      *
     C                   SORTA     D
     C                   SORTA     DGR
      *
     C                   READ(N)   SAML                                   30
     C     *IN30         DOWEQ     '0'
      * TESTER AVDELING
     C     WSAVD         IFNE      *ZEROS
     C     WSAVD         ANDNE     SAAVD
     C                   GOTO      NESTE
     C                   END
      * TESTER KUNDENUMMER
N62  C     WSKNU         IFNE      'U'
     C     WSKN          IFNE      *ZEROS
     C     WSKN          ANDNE     SAKN
     C                   GOTO      NESTE
     C                   END
N62  C                   ELSE
N62  C     WSKN          IFNE      *ZEROS
N62  C     WSKN          ANDEQ     SAKN
N62  C                   GOTO      NESTE
N62  C                   END
N62  C                   END
      *
N57   * alt dette er flyttet da det må ned på fakturanivå
s57  C*
s57  C* er kunden epostkunde ?   ikke ved arkivering
s57  C*
s57  C*                  MOVE      '1'           *IN33
s57  C*                  MOVE      'N'           EPOSTKU           1
s57  C*                  MOVE      'J'           CPRINT            1
s57  C*  55 = skal printes
s57  C*                  SETON                                        55
s57  C* ikke test hvis ikke arkiv ikke ved C=arkivering *in27=prøvekjøring
s57  C*    arksnd        ifeq      'J'
s57  C*    uhod          andne     'C'
s57  C*    *in27         andne     '1'
s57  C* vanlig epostkunde
s57  C*    epokey        CHAIN     cundc03                            33
s57  C* n33              exsr      testep
s57  C* n33              move      'J'           EPOSTKU
s57  C*
s57  C* Eventuelt  XML kunde
s57  C*    EPOSTKU       IFEQ      'N'
s57  C*    CUNDC03K      CHAIN     CUNDC03                            33
s57  C* N33              MOVE      'J'           epostku
s57  C*                  END
s57  C*                  END
s57  C*    CPRINT        IFEQ      'N'
s57  C*                  SETOFF                                       55
s57  C*                  END
      *
      * TESTER PROSJEKT(INIT HAR VIA SYFA27D REFRESHET SAML MHT. SAPRO)
     C     WSPRO         IFNE      *ZEROS
     C     WSPRO         ANDNE     SAPRO
     C                   GOTO      NESTE
     C                   END
      * TESTER AT PROSJ.NR ER GITT DERSOM AVD. KREVER DET
     C     WSKUNT        IFEQ      'J'
     C     SAPRO         ANDEQ     *ZEROS
     C     KOVKEY        CHAIN     KODTV                              33
     C     *IN33         IFEQ      '0'
     C     KOVPRO        ANDEQ     'J'
     C                   GOTO      NESTE
     C                   END
     C                   END
      * TESTER OPPDRAG (
     C                   Z-ADD     SAAVD         HEAVD
     C                   Z-ADD     SAOPD         HEOPD
     C     HEADFK        CHAIN(N)  HEADF                              33
     C     *IN33         IFEQ      '1'
     C     HEST          OREQ      'S'
     C                   GOTO      NESTE
     C                   END
N10   * TESTER selger
n10  C     WSSELG        IFNE      *ZEROS
n10  C     WSSELG        ANDNE     HEKNS
n10  C                   GOTO      NESTE
n10  C                   END
      * TESTER FRA-TILPERIODE
     C                   Z-ADD     0             XXPER             4 0
     C     HEPRO         CHAIN     TURER14                            77
     C     *IN77         IFEQ      *OFF
     C                   MOVEL     TURAAR        XXPER
     C                   MOVE      TURMND        XXPER
     C                   ENDIF
     C     XXPER         IFEQ      0
     C                   MOVEL     HEDTYY        XXPER
     C                   MOVE      HEDTM         XXPER
     C                   ENDIF
     C                   MOVEL     WSFRA         YMM               2 0
     C                   MOVE      WSFRA         YYY               2 0
     C                   MOVEL     YYY           YYPERF            4 0
     C                   MOVE      YMM           YYPERF
     C                   MOVEL     WSTIL         YMM
     C                   MOVE      WSTIL         YYY
     C                   MOVEL     YYY           YYPERT            4 0
     C                   MOVE      YMM           YYPERT
      *
     C     WSTIL         IFNE      0
     C     XXPER         IFLT      YYPERF
     C     XXPER         ORGT      YYPERT
     C                   GOTO      NESTE
     C                   ENDIF
     C                   ENDIF
     C                   Z-ADD     WSDDO         WSDDE
     C                   Z-ADD     WSMMO         WSMME
     C                   Z-ADD     WSYYO         WSYYE
      * TESTER DATO
     C     WSDATE        IFNE      *ZEROS
     C     WSDATE        IFGT      501231
     C     WSDATE        ADD       19000000      WSDAT8            8 0
     C                   ELSE
     C     WSDATE        ADD       20000000      WSDAT8
     C                   END
     C     HEDTOP        CABGT     WSDAT8        NESTE
     C                   END
      * TESTER URSPRUNGSKODE
     C     D(10)         IFNE      ' '
     C     HEUR          LOOKUP    D                                      33
     C  N33              GOTO      NESTE
     C                   END
      *
      * TESTER SAMLEFAKTURAGRUPPE
     C     DGR(10)       IFNE      ' '
     C     SAGRP         LOOKUP    DGR                                    33
     C  N33              GOTO      NESTE
     C                   END
      *
      *  Legg ut post i workfile evt. m.kundens spesielle sort.ønske
     C                   MOVE      XXUNIK        WAUNIK
     C                   MOVE      SAKN          WAKN
     C                   MOVE      SAVAL         WAVAL
     C                   MOVE      *BLANKS       WASORT
     C     WAKN          CHAIN     CUSAPR                             33
     C     *IN33         IFEQ      '1'
     C     KOAKNR        CHAIN     CUSAPR                             33
     C                   END
     C   33              MOVE      ' '           CPSORT
     C                   SELECT
     C     CPSORT        WHENEQ    ' '
     C                   MOVEL     AVOPDS        WASORT
     C     CPSORT        WHENEQ    'A'
     C                   MOVEL     HERFA         WASORT
     C     CPSORT        WHENEQ    'B'
     C                   MOVEL     HEDTOP        WASORT
     C     CPSORT        WHENEQ    'C'
     C                   MOVEL     HEPRO         WASORT
     C     CPSORT        WHENEQ    'D'
     C                   MOVEL     HESDF         WASORT
     C     CPSORT        WHENEQ    'E'
     C                   MOVEL     HESDT         WASORT
     C     CPSORT        WHENEQ    'F'
     C                   MOVEL     HEGM1         WASORT
     C     CPSORT        WHENEQ    'G'
     C                   MOVEL     HEVS1         WASORT
     C     CPSORT        WHENEQ    'H'
     C     WAKN          IFEQ      HEKNKF
     C                   MOVEL     HENAS         XXPART
     C                   ELSE
      * Faktura mot selger - oppgi mottaker på s-faktspesifikasj.
     C     WAKN          IFEQ      HEKNSF
     C                   MOVEL     HENAK         XXPART
     C                   ELSE
      * Faktura mot 3.part - oppgi Avsender OG mottaker
     C                   MOVEL     HENAS         XXPARA
     C                   MOVEL     HENAK         XXPARB
     C                   MOVEL     XXPARA        XXPART
     C                   MOVE      XXPARB        XXPART
     C                   END
     C                   END
     C                   MOVEL     XXPART        WASORT
     C     CPSORT        WHENEQ    'I'
     C                   MOVEL     HEGN          WASORT
     C     CPSORT        WHENEQ    'J'
     C                   MOVEL     HEHAWB        WASORT
     C     CPSORT        WHENEQ    'K'
     C                   MOVEL     HEOT          WASORT
     C     CPSORT        WHENEQ    'L'
     C                   MOVEL     HEFR          WASORT
     C     CPSORT        WHENEQ    '1'
     C                   MOVE      CPFS01        YFSKOD
     C     FRIKEY        CHAIN     FRISOK                             33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     FSSOK         WASORT
     C                   END
     C     CPSORT        WHENEQ    '2'
     C                   MOVE      CPFS02        YFSKOD
     C     FRIKEY        CHAIN     FRISOK                             33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     FSSOK         WASORT
     C                   END
     C     CPSORT        WHENEQ    '3'
     C                   MOVE      CPFS03        YFSKOD
     C     FRIKEY        CHAIN     FRISOK                             33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     FSSOK         WASORT
     C                   END
     C     CPSORT        WHENEQ    '4'
     C                   MOVE      CPFS04        YFSKOD
     C     FRIKEY        CHAIN     FRISOK                             33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     FSSOK         WASORT
     C                   END
     C     CPSORT        WHENEQ    '5'
     C                   MOVE      CPFS05        YFSKOD
     C     FRIKEY        CHAIN     FRISOK                             33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     FSSOK         WASORT
     C                   END
     C     CPSORT        WHENEQ    'M'
     C                   MOVEL     HENAK         WASORT
     C     CPSORT        WHENEQ    'N'
     C                   MOVEL     HENAS         WASORT
     C                   ENDSL
     C                   MOVE      SAAVD         WAAVD
     C                   MOVE      SAOPD         WAOPD
     C                   MOVE      SAPRO         WAPRO
     C                   MOVE      SAGRP         WAGRP
     C                   MOVE      SADATO        WADATO
     C                   MOVE      SAUR          WAUR
      * Legg ut i workfile
     C                   MOVE      ' '           WFK               1
     C                   CALL      'SYGE41'
     C                   PARM                    WAAVD
     C                   PARM                    WAOPD
     C                   PARM                    WAKN
     C                   PARM                    WFK
     C     WSFK          IFEQ      ' '
n60  c                   add       1             antrecords
n60  c     antrecords    ifeq      7000
n60  c                   z-add     sakn          sistekunde        8 0
n60  c                   end
     C                   WRITE     WSAMLR
     C                   ELSE
     C     WSFK          IFEQ      WFK
n60  c                   add       1             antrecords
n60  c     antrecords    ifeq      7000
n60  c                   z-add     sakn          sistekunde        8 0
n60  c                   end
     C                   WRITE     WSAMLR
     C                   ENDIF
     C                   ENDIF
     C     WSFK          IFEQ      'K'
     C                   MOVE      *ON           *IN80
     C                   ELSE
     C                   MOVE      *OFF          *IN80
     C                   ENDIF
      *
     C     NESTE         TAG
     C                   READ(N)   SAML                                   30
n60  c     *in30         ifeq      '0'
n60  c     sistekunde    andne     0
n60  c     sakn          andne     sistekunde
n60  c                   seton                                        30
n60  c                   end
     C                   END                                                       DOWEQ'0'
      *
      *
      * Program for å vise/tilby sletting av valgte poster
     C                   CALL      'SYFA27A '
     C                   PARM                    URETUR            1
      *
      *TØMMER WORKFILE HVIS RETUR = Y/3  (F12 / F3)
     C     URETUR        IFEQ      'Y'
     C     URETUR        OREQ      '3'
     C                   EXSR      DELW
     C                   END
      *
     C                   ENDSR
      *
      ******************************************
     C     DELW          BEGSR
      ******************************************
      * Oppdrag til samlefakt
     C     XXUNIK        SETLL     WSAML
     C     XXUNIK        READE     WSAML                                  33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    WSAMLR
     C     XXUNIK        READE     WSAML                                  33
     C                   END
     C                   ENDSR
      *
      ******************************************
     C     DELW2         BEGSR
      ******************************************
      * Sumliste pr gebyr
     C     XXUNIK        SETLL     WSAMGE
     C     XXUNIK        READE     WSAMGE                                 33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    WSAMGER
     C     XXUNIK        READE     WSAMGE                                 33
     C                   END
      *
     C                   ENDSR
      *
      ******************************************
     C     PRINTK        BEGSR
      ******************************************
      *
     c                   move      'J'           ekteko            1
     c*3ukke kopitekst v fax og email
s43  c*    uhod          ifne      'F'
s43  c     uhodc         ifne      'F'
s43  c*    uhod          andne     'A'
s43  c     uhodc         andne     'A'
s43  c*    uhod          andne     'C'
n43  c     uhodc         andne     'C'
     C                   MOVE      '  COPY  '    CPYTXT
     c                   end
     C     UFNKOP        IFNE      *ZEROS
     C                   MOVE      UFNKOP        WSFN
     C                   GOTO      STPRK2
     C                   END
     C     STPRK         TAG
     C                   EXFMT     BILDE02
     C   03              GOTO      SLPRK
     C     STPRK2        TAG
     C                   SETOFF                                       9930
     C     WSFN          SETLL     FAIN
     C     WSFN          READE     FAIN                                   99
     C     *IN99         IFEQ      '1'
     C                   MOVE      'SPF0003'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      STPRK
     C                   END
      * Finn kundenr via 1. reelle fakt linje
      * Hvis det/de første er nulloppdr, les vider. BARE nulloppd=FEIL
     C     *IN99         DOWEQ     '0'
     C                   MOVE      FIAVD         HEAVD
     C                   MOVE      FIOPD         HEOPD
     C     FAK8K2        CHAIN     FAK8                               33
     C     *IN33         IFEQ      '0'
     C     FAKDA         ANDNE     'K'
     C                   GOTO      STKOPI
     C                   END
     C     WSFN          READE     FAIN                                   99
     C  N99              END
     C     *IN99         IFEQ      '1'
     C                   MOVE      'JOV0540'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      STPRK
     C                   END
      *
     C     STKOPI        TAG
     C     *IN99         DOWEQ     '0'
     C                   MOVE      FIAVD         HEAVD
     C                   MOVE      FIOPD         HEOPD
     C     HEADFK        CHAIN(N)  HEADF                              33
     C     *IN33         IFEQ      '0'
      * Legg ut post i workfile
      * Blank i WASORT alle poster - gir samme rekkefølge som FAIN..
     C                   MOVE      XXUNIK        WAUNIK
     C                   MOVE      FAKUNR        WAKN
     C                   MOVE      FACURI        WAVAL
     C                   MOVE      *BLANKS       WASORT
     C     WAKN          CHAIN     CUSAPR                             33
     C     *IN33         IFEQ      '1'
     C     KOAKNR        CHAIN     CUSAPR                             33
     C                   END
     C   33              MOVE      ' '           CPSORT
     C                   SELECT
     C     CPSORT        WHENEQ    ' '
     C                   MOVEL     AVOPDS        WASORT
     C     CPSORT        WHENEQ    'A'
     C                   MOVEL     HERFA         WASORT
     C     CPSORT        WHENEQ    'B'
     C                   MOVE      HEDTOP        WASORT
     C     CPSORT        WHENEQ    'C'
     C                   MOVEL     HEPRO         WASORT
     C     CPSORT        WHENEQ    'D'
     C                   MOVEL     HESDF         WASORT
     C     CPSORT        WHENEQ    'E'
     C                   MOVEL     HESDT         WASORT
     C     CPSORT        WHENEQ    'F'
     C                   MOVEL     HEGM1         WASORT
     C     CPSORT        WHENEQ    'G'
     C                   MOVEL     HEVS1         WASORT
     C     CPSORT        WHENEQ    'H'
     C     WAKN          IFEQ      HEKNKF
     C                   MOVEL     HENAS         XXPART
     C                   ELSE
      * Faktura mot selger - oppgi mottaker på s-faktspesifikasj.
     C     WAKN          IFEQ      HEKNSF
     C                   MOVEL     HENAK         XXPART
     C                   ELSE
      * Faktura mot 3.part - oppgi Avsender OG mottaker
     C                   MOVEL     HENAS         XXPARA
     C                   MOVEL     HENAK         XXPARB
     C                   MOVEL     XXPARA        XXPART
     C                   MOVE      XXPARB        XXPART
     C                   END
     C                   END
     C                   MOVEL     XXPART        WASORT
     C     CPSORT        WHENEQ    'I'
     C                   MOVEL     HEGN          WASORT
     C     CPSORT        WHENEQ    'J'
     C                   MOVEL     HEHAWB        WASORT
     C     CPSORT        WHENEQ    'K'
     C                   MOVEL     HEOT          WASORT
     C     CPSORT        WHENEQ    'L'
     C                   MOVEL     HEFR          WASORT
     C     CPSORT        WHENEQ    '1'
     C                   MOVE      CPFS01        YFSKOD
     C     FRIKEY        CHAIN     FRISOK                             33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     FSSOK         WASORT
     C                   END
     C     CPSORT        WHENEQ    '2'
     C                   MOVE      CPFS02        YFSKOD
     C     FRIKEY        CHAIN     FRISOK                             33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     FSSOK         WASORT
     C                   END
     C     CPSORT        WHENEQ    '3'
     C                   MOVE      CPFS03        YFSKOD
     C     FRIKEY        CHAIN     FRISOK                             33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     FSSOK         WASORT
     C                   END
     C     CPSORT        WHENEQ    '4'
     C                   MOVE      CPFS04        YFSKOD
     C     FRIKEY        CHAIN     FRISOK                             33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     FSSOK         WASORT
     C                   END
     C     CPSORT        WHENEQ    '5'
     C                   MOVE      CPFS05        YFSKOD
     C     FRIKEY        CHAIN     FRISOK                             33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     FSSOK         WASORT
     C                   END
     C     CPSORT        WHENEQ    'M'
     C                   MOVEL     HENAK         WASORT
     C     CPSORT        WHENEQ    'N'
     C                   MOVEL     HENAS         WASORT
     C                   ENDSL
     C                   MOVE      HEAVD         WAAVD
     C                   MOVE      HEOPD         WAOPD
     C                   MOVE      *ZEROS        WAPRO
     C                   MOVE      *BLANKS       WAGRP
     C                   MOVE      *ZEROS        WADATO
     C                   MOVE      *BLANKS       WAUR
     C                   END
      * Hvis dette oppdrag er SLETTET fra fakt. - skipp...
      * (men er det et NULL oppdrag - ta det med )
     C     FAK8K2        CHAIN     FAK8                               33
     C   33              move      'O'           faopko
     C     FAOPKO        IFNE      'D'
     C     FAKDA         IFNE      'K'
     C                   WRITE     WSAMLR
     C                   END
     C                   END
     C     WSFN          READE     FAIN                                   99
     C  N99              END
      *
     C                   Z-ADD     WSFN          XXFAKT
     C                   Z-ADD     WSFN          TEFFNR
     C                   EXSR      PRISAM
      *
     C     SLPRK         ENDSR
      *
      *
      *
      ******************************************
     C     LESWFI        BEGSR
      ******************************************
      *
      *
      *
      * Les fortløpende posterfra workfila.
      * Brudd på Kunde/valutasort.
      *
     C     XXUNIK        SETLL     WSAML
     C     XXUNIK        READE     WSAML                                  30
      * 30 ER INGEN FUNNET
     C     *IN30         IFEQ      '0'
      * Funnet en post... Behandle/slette alle på akt. kunde/valuta
     C                   EXSR      KUNVAL
     C                   END
      *
     C                   ENDSR
      *
      *
      ***********************************************
     C     KUNVAL        BEGSR
      ***********************************************
      *
      * Denne SR skriver EN samlefaktura.
      * D.v.s. EN kunde / EN valuta.
      *
      * Først klargjør div "Heading-info"
     C                   EXSR      HEAINF
      *
      * Behandle alle oppdrag på aktuell kunde/valutkode..
     C     KUNVAK        SETLL     WSAML
     C     KUNVAK        READE     WSAML                                  33
     C     *IN33         DOWEQ     '0'
     C                   EXSR      ETTOPD
     C     KOPINR        IFGE      ANTKOP
     C                   DELETE    WSAMLR
     C                   END
     C     DELKEY        CHAIN     SAML                               33
     C     KOPINR        IFGE      ANTKOP
     C     URETUR        ANDNE     'P'
     C     URETUR        ANDNE     'S'
     C  N33              DELETE    SAMLR
     C                   END
     C     KUNVAK        READE     WSAML                                  33
     C                   END
      *
     C                   EXSR      TOTFAK
      * STENG PRINTERFILER MELLOM HVER FOR SORTERING
     C                   CLOSE     SYFA27PF
     C                   CLOSE     SYFA27PG
     C                   CLOSE     SYFA27PS
     C                   ENDSR
      ***********************************************
     C     HEAINF        BEGSR
      ***********************************************
N     * IKKE Faktuabegy på denne kunde  ??
S50  C*                  MOVE      ' '           CTIKMF
N31  C                   MOVE      ' '           CTIKFG
N31  c                   move      IFFAGB        XXFAGB            3 0
N31  C     WAKN          CHAIN     CUTRAN                             33
S54  c*    CTAVFG        ifne      *zeros
N54  c  N33CTAVFG        ifne      *zeros
N31  c                   move      CTAVFG        XXFAGB
N31  c                   endif
N54  c  N33CTIKFG        ifeq      'X'
N54  c     CTIKFG        oreq      'N'
N54  c                   move      *zeros        XXFAGB
N54  c                   end
      *
     C     KUND1K        CHAIN     CUNDL01                            33
N57   * SJEKKER OM EPOSTKUNDE OG OM SKAL PRINTES (*IN55)
N57  C                   EXSR      TESTEP0
     C                   CALL      'SYGE36'
     C                   PARM                    FIFIRM
     C                   PARM                    WAKN
     C                   PARM                    PNPBKUU          10
     C                   PARM                    PNPBKUN           4 0
     c     pnpbkun       ifne      *zeros
     c                   move      pnpBKUN       postnr
     c                   end
     c     pnpbkuu       ifne      *blanks
     c                   movel     pnpBKUU       sypoge
     c                   end
     C     POSTNR        COMP      0                                      37
     C     SYPOGE        COMP      *BLANKS                                38
n03  C     SPRAAK        COMP      'E'                                    70
n03  C     SPRAAK        COMP      'T'                                    79
N01  c     VadrKey       Chain     VADR                               33
N01  c     *in33         IFEQ      *OFF
N01  C                   MOVE      VADRNA        KNAVN
N01  C                   MOVE      VADRN1        ADR1
N01  C                   MOVE      VADRN2        ADR2
N01  C                   MOVEL     VADRN3        ADR3                           Vadrn3=inkl postnr
N20  C                   MOVE      VALAND        SYLAND                         Vadrn3=inkl postnr
N01  C                   MOVEA     '11'          *in(37)
N01  c                   end
      *
s03  C* N33SPRAAK        COMP      'E'                                    70
s03  C* N33SPRAAK        COMP      'T'                                    79
      *
     C                   move      *off          *in75
N18  C     RNRAKU        ifne      *blanks
N18  C                   eval      kutax=RNRAKU
N18  C                   move      *on           *in75
N18  C                   end
      *
      * Har kunden ORG.nr registrert (må ikke være persnr)
E18  C  N75SYFOR1        Ifne      '000000000'
     C     SYFOR1        andne     '         '
     C     SYFOR2        andeq     *blanks
N18  c     SYLAND        ifeq      *blanks
N18  c     SYLAND        oreq      'NO'
     C                   move      *on           *in75
n18  c                   eval      kutax=SYLAND
n18  C     kutax         cat       syrg:0        kutax
N18  C                   END                                                                   D150
     C                   END                                                                   D150
     c     *in75         ifeq      *off
s22  c*    SYLAND        andne     *blanks
s22  c*    SYLAND        andne     'NO'
     C                   movel     'VATNR'       XXPAID
     C     VATKey        chain     SYPARL1                            33
s18  c*                  movel     SYVRDA        SYRG
S18  C*                  move      *on           *in75
n18  c  N33              eval      kutax=SYVRDA
n18  C  N33              move      *on           *in75
     c                   end
N53   * langt kundenavn
N53  c                   eval      KNAVN50 = KNAVN
N53  C                   movel     'ZKNAV'       XXPAID
N53  C     VATKey        chain     SYPARL1                            33
N53  c  N33              eval      KNAVN50 = SYVRDA
      *
      *
      *
     C  N70
     CANN79              MOVE      HO            HP
     C   70              MOVE      HE            HP
     C   79              MOVE      HT            HP
     C                   SETOFF                                       88
     C                   MOVE      *BLANKS       KLKNVN
n30  C                   MOVE      *BLANKS       KLKNVE
n30  C                   MOVE      *BLANKS       KLKNVT
     C     LKKEY         CHAIN     KODTLK                             33
      *
     C                   MOVE      WAVAL         XVAL
n21  C     XVAL          IFEQ      *BLANKS
n21  C                   MOVE      FICURR        XVAL
n21  C                   END
      *
      * OPEN / CLOSE FOR HVER KUNDE FOR SORTERING (SYFA27PS LENGER NED)
     C                   OPEN      SYFA27PF
     C                   OPEN      SYFA27PG
      *
      * SPESIELL SAMLEFAKTURAPROFIL, OG EVT EGEN SAML.SPESIF.-LAYOUT
     C                   MOVE      'N'           PROFIL            1            Egen profil?
     C                   MOVE      'N'           PROFI2            1            Egen fltlis?
     C                   MOVE      'N'           PRTKO             1            Print Kos.O?
     C                   MOVE      '1'           ANTKOK            1            Ant. KO.kop?
     C                   MOVE      *BLANKS       XKOHE            28            Ko.over.HEAD
     C                   MOVE      'J'           PRTSPE            1            Print Spes.?
     C                   MOVE      '1'           ANTSPK            1            Ant. Sp.kop?
     C                   MOVE      'J'           PRTSPS            1            Spes.SUM/KOD
     C                   MOVE      'J'           PRTLIN            1            Print F.lin?
     C                   MOVE      *BLANKS       CPHEN1                         Fast henvis?
     C     WAKN          CHAIN     CUSAPR                             33
     C                   MOVE      'N'           AVDPRF            1
     C     *IN33         IFEQ      '1'
     C     KOAKNR        CHAIN     CUSAPR                             33
     C  N33              MOVE      'J'           AVDPRF
     C                   END
     C     *IN33         IFEQ      *OFF
     C                   MOVE      'J'           PROFIL
      * Engelsk Y likeverdig med "J" i alle J/N valg
     C     CPSP          IFEQ      'Y'
     C                   MOVE      'J'           CPSP
     C                   END
     C     CPSPSU        IFEQ      'Y'
     C                   MOVE      'J'           CPSPSU
     C                   END
     C     CPFALI        IFEQ      'Y'
     C                   MOVE      'J'           CPFALI
     C                   END
     C                   MOVE      CPKO          PRTKO
     C                   MOVE      CPKOAK        ANTKOK
     C                   MOVE      CPSP          PRTSPE
     C                   MOVE      CPSPSU        PRTSPS
     C                   MOVE      CPFALI        PRTLIN
     C                   MOVE      CPSPAK        ANTSPK
     C     AVDPRF        IFEQ      'N'
     C     CUFLDK        CHAIN     CUFLD                              33
     C                   ELSE
     C     AVFLDK        CHAIN     CUFLD                              33
     C                   END
     C     *IN33         IFEQ      *OFF
     C                   MOVE      'J'           PROFI2
     C                   END
     C                   END
      *
      * Antall kopier kan variere fra kunde til kunde
      * Ny override av printerfil
     C     ANTSPK        IFEQ      '0'
     C     ANTSPK        OREQ      ' '
     C                   MOVE      '1'           ANTSPK
     C                   END
     C                   MOVE      *BLANKS       UCMD
     C     XCMD11        CAT       ANTSPK:0      UCMD
     C                   CAT       ')':0         UCMD
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     C                   OPEN      SYFA27PS
N08  C                   MOVE      *BLANKS       GEB
N08  C                   MOVE      *ZEROS        ANT
N08  C                   MOVE      *ZEROS        PRI
      *
      * Ikke henvisning til oppdrag, men bare fast tekst om 93 ON.
     C     CPHEN1        COMP      *BLANKS                            9393      *For PRTF
      *
      * Skriv gebyr sumliste... tøm workfile
     C     PRTSPS        IFEQ      'J'
     C                   EXSR      DELW2
     C                   END
      *
      * Faktnr/forfallsdato....
      * Original
     C                   MOVE      'N'           XNYFAKT           1
     C     *IN27         IFEQ      '0'
     C     UFIRM         CHAIN     tellfa                             33
     C     *IN33         IFEQ      '0'
     C                   MOVE      FIFNR         XFN               7 0
     C                   ADD       1             FIFNR
     C                   UPDATE    tellfar
     C                   MOVE      'J'           XNYFAKT
     C                   END
     C                   MOVE      XFN           TEFFNR
     C                   EXSR      BETSR
     C     FIFIRM        CHAIN     FIRMARC                            33
     C     *IN33         IFEQ      '0'
     C     'fs'          chain     arktxt                             33
     C     *IN33         IFEQ      '0'
     C     arkjn         andeq     'J'
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      FIFIRM        ARFIRM
     C                   MOVE      UAVD          ARAVD
     C                   MOVE      *zeros        AROPD
     C                   MOVEL     XFN           ARUNDE
     C                   MOVE      'fs'          ARTYPE
     C                   MOVE      ZUSER         ARUSER
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     C                   MOVE      KUNDNR        ARKUND
     C                   WRITE     ARKIVR
     C                   END
     C                   END
     C                   ELSE
      * Prøvekjøring
     C     *IN28         IFEQ      '1'
     C                   EXSR      BETSR
     C                   ELSE
      * Kopi
     C                   EXSR      BETSR
     C                   MOVE      WSFN          XFN
     c     ekteko        ifeq      'J'
     C                   MOVE      FADATO        IDAG8
     C                   MOVE      FADATD        IDAGXD
     C                   MOVE      FADATM        IDAGXM
     C                   MOVE      FADATÅ        IDAGXÅ
     C                   MOVE      FADAFD        XFFDTD
     C                   MOVE      FADAFM        XFFDTM
     C                   MOVE      FADAFÅ        XFFDTÅ
     C                   MOVE      XFFDT         KFFDT
     C                   end
     C                   END
     C                   END
      *
      * Nullstill div. variable/indikatore..  PÅ FAKTURA-TOTAL-NIVÅ
      *
     C                   Z-ADD     1             PAGEPS            4 0
     C                   Z-ADD     1             PAGEPF            4 0
     C                   MOVE      *ZEROS        XMVAGR            9 2
N02  C                   MOVE      *ZEROS        XMVAGN           13 2
N02  C                   MOVE      *ZEROS        XMVGN            13 2
     C                   MOVE      *ZEROS        XMVAFR            9 2
N48  c                   move      *zeros        xbru92t
N48  c                   move      *zeros        xmva92t
N48  c                   move      *zeros        xtot92t
N54  c                   move      *zeros        xbru92
N54  c                   move      *zeros        xmva92
N54  c                   move      *zeros        xtot92
     C                   CLEAR                   WXMVAK
     C                   CLEAR                   WXMVAP
     C                   CLEAR                   WXGRL
     C                   CLEAR                   WXMVA
n54  C                   MOVE      *blanks       WSMVAK
n54  C                   move      *zeros        WSMVAP
n54  C                   move      *zeros        WSGRL
n54  C                   move      *zeros        WSMVA
n54  c                   move      *zeros        xxtill
     C                   Z-ADD     1             XANT              2 0
     C                   SETOFF                                       908889
     C                   MOVE      *OFF          *IN16
      *
      *
      *
      * Skriv heading selve fakturaen
N46   * sjekk om det er kredit = 80 *ON
N46  C                   MOVE      ' '           FAKKRED           1
N46  C                   MOVE      *OFF          *IN80
N46  C     WSFN          ifeq      *zeros
N46  C                   EXSR      TSTKRED
N46  C                   else
N46  C                   CALL      'SYGE42'
N46  C                   PARM                    WSFN
N46  C                   PARM                    FAKKRED
N46  C                   endif
N46  C     FAKKRED       ifeq      'K'
N46  C                   MOVE      *ON           *IN80
N46  C                   ENDIF
N46   *
     C                   EXSR      KDTFM1
     C     URETUR        IFNE      'S'
S46  C* KOPI
S46  C*    *IN27         IFEQ      *ON
S46  C*    *IN28         ANDEQ     *OFF
S46  C*                  MOVE      ' '           Y                 1
S46  C*    UIN01         ifeq      '1'
S46  C*    UHODc         andne     'A'
S46  C*                  CALL      'SYGE42'
S46  C*                  PARM                    WSFN
S46  C*                  PARM                    Y
S46  C*                  end
S46  C*                  MOVE      *OFF          *IN80
S46  C*    Y             IFEQ      'K'
S46  C*                  MOVE      *ON           *IN80
S46  C*                  ENDIF
S46  C*                  ENDIF
N52  C     *IN55         IFEQ      '1'
     C                   WRITE     FHEAD                                         SYFA27PF
N48  C  N64              WRITE     FDETH
N48  C   64              WRITE     FDETHPDF
     C                   EXSR      FRISR
N52  C                   END
      *
     C     ECMKEY        CHAIN     ECMSG                              17
     C     *IN17         IFEQ      *OFF
     C     *IN27         ANDEQ     *OFF
     C                   MOVE      *ON           *IN16
     C                   CLEAR                   SYFA27WR
     C                   MOVEL     ECIIDI        WA01
     C                   MOVEL     ECIIDC        WA02
     C                   Z-ADD     XFN           WA03
     C                   MOVEL     'FHEAD'       WA04
     C                   MOVEL     KNAVN         WB01
     C                   MOVEL     ADR1          WB02
     C                   MOVEL     ADR2          WB03
     C                   Z-ADD     POSTNR        WB04
     C                   MOVEL     ADR3          WB05
     C                   Z-ADD     XFN           WB06
     C                   Z-ADD     KUNDNR        WB07
     C                   Z-ADD     IDAGX         WB08
     C                   Z-ADD     XFFDT         WB09
     C                   WRITE     SYFA27WR
     C                   ENDIF
      *
     C                   END
      * Skriv heading spesifikasjon
     C     PRTSPE        IFEQ      'J'
     C     KOPINR        ANDLE     ANTKOS
     C                   EXSR      SPHEAD
     C                   END
     C                   EXSR      KDTFM1
      *
     C                   ADD       1             XPRANT
      *
     C                   ENDSR
      *
N46  C******************************************
N46  C     TSTKRED       BEGSR
N46  C******************************************
N46  C                   MOVE      *ZEROS        DEKRETOT         13 2
N46   *
N46  C     KUNVAK        SETLL     WSAML
N46  C     KUNVAK        READE     WSAML                                  33
N46  C     *IN33         DOWEQ     '0'
N46  C                   MOVE      WAAVD         HEAVD
N46  C                   MOVE      WAOPD         HEOPD
N46  C                   MOVE      WAVAL         WAVAL8
N46   *
N46  C     FAK8K         SETLL     FAK8
N46  C     FAK8K         READE     FAK8                                   33
N46  C     *IN33         DOWEQ     '0'
N46  C     FAKDA         IFNE      'K'
N46  C                   ADD       FABELN        DEKRETOT
N46  C     FAKDM         IFNE      ' '
N46  C     FAKDM         ANDNE     'N'
N46  C                   MOVE      FITAX         FITAXB
N46  C     FITAXD        IFNE      *ZEROS
N46  C     FITAX2        ANDNE     *ZEROS
N46  C     IDAG8         ANDLT     FITAXD
N46  C                   MOVE      FITAX2        FITAXB
N46  C                   END
N46  C     KODWKY        CHAIN     KODWL01                            33
N46  C     *IN33         IFEQ      *OFF
N46  C     MVAAVI        DIV       100           FITAXB
N46  C                   ENDIF
N46  C     FABELN        MULT(H)   FITAXB        DEKREMVA         13 2
N46  C                   ADD       DEKREMVA      DEKRETOT
N46  C                   ENDIF
N46  C                   ENDIF
N46  C     FAK8K         READE     FAK8                                   33
N46  C                   ENDDO
N46   *
N46  C     KUNVAK        READE     WSAML                                  33
N46  C                   ENDDO
N46   *
N46  C     DEKRETOT      IFGE      *ZEROS
N46  C                   MOVE      'F'           FAKKRED
N46  C                   ELSE
N46  C                   MOVE      'K'           FAKKRED
N46  C                   ENDIF
N46   *
N46  C                   ENDSR
N46   *
      ******************************************
     C     ETTOPD        BEGSR
      ******************************************
      *
     C                   MOVE      WAAVD         HEAVD
     C                   MOVE      WAOPD         HEOPD
     C     HEADFK        CHAIN     HEADF                              33
     C     *IN33         IFEQ      '0'
     C     *IN27         ANDEQ     '0'                                             ORIGINAL
      * X-ref oppdrag/faktnr i FAIN
     C                   MOVE      XFN           FIFN
     C                   MOVE      HEAVD         FIAVD
     C                   MOVE      HEOPD         FIOPD
     C                   WRITE     FAINR
     C     FIURBL        IFEQ      'J'
     C                   EXSR      TTSR
     C                   END
     C                   END
      * DISSE FELTENE SKAL VEL DROPPES I VER4.....
      * Kjøper
     C     KUNDNR        IFEQ      HEKNKF
     C                   MOVE      'K'           XXSKKO
     C                   ELSE
      * Selger
     C     KUNDNR        IFEQ      HEKNSF
     C                   MOVE      'S'           XXSKKO
     C                   ELSE
     C                   MOVE      'X'           XXSKKO
     C                   END
     C                   END
     C     *IN33         IFEQ      '0'
     C     *IN27         ANDEQ     '0'                                             ORIGINAL
     C                   MOVE      'F'           HEST
     C                   UPDATE    HEADFR
     C                   END
      *
     C     HEUR          IFEQ      'H'
     C     HEADFK        CHAIN     DISP                               33
     C     TUKEY2        CHAIN     TURER                              33
     C                   END
      *
      * VED FLY KAN F.B.VEKT TASTES DIREKTE (UTEN M3/LM)
     C                   Z-ADD     HEVKT         XXVKT
     C     HEUR          IFEQ      'C'
     C     HEUR          OREQ      'D'
     C     HEUR          OREQ      'E'
     C     HEFBV         IFGT      HEVKT
     C                   Z-ADD     HEFBV         XXVKT
     C                   END
     C                   END
N40  C                   Z-ADD     HENT          XXNT
N40   * Vis GodsNr ELLER Sendingsnr
N40  c                   eval      XXGNSN = HEGN
N40  c                   if        HXSNDN<>*blanks
N40  c                   if        %subst(HXSNDN:20:1)<>' '
N40  c                   eval      XXGNSN = %subst(HXSNDN:4:17)
N40  C                   else
N40  c                   eval      XXGNSN = HXSNDN
N40  c                   endif
N40  c                   endif
      * HENTER FRANKATURTEKST
     C     KODFRK        CHAIN     KODTFR                             33
s40  C*                  MOVEL     KFRNTX        XFRNTX           20
s40  C*                  MOVEL     KFRTTX        XFRTTX           20
N40  C                   MOVEL     KFRNTX        XFRNTX
N40  C                   MOVEL     KFRTTX        XFRTTX
      *
      * HENTER OPPDRAGSTYPE TEKST
     C     KODOTK        CHAIN     KODTOTY                            33
      *
      * Skriv "Motsatt" part  (39/49=indikator for ledetekst i prtf)
     C                   SETOFF                                         3949
      * Faktura mot kjøper - oppgi avsender på s-faktspesifikasj.
     C     KUNDNR        IFEQ      HEKNKF
     C                   MOVEL     HENAS         XXPART           20            *39OFF/49OFF
     C                   ELSE
      * Faktura mot selger - oppgi mottaker på s-faktspesifikasj.
     C     KUNDNR        IFEQ      HEKNSF
     C                   MOVEL     HENAK         XXPART                         *39ON /49OFF
     C                   SETON                                            39
     C                   ELSE
      * Faktura mot 3.part - oppgi Avsender OG mottaker
     C                   MOVEL     HENAS         XXPARA            9
     C                   MOVEL     HENAK         XXPARB            9
     C                   MOVEL     XXPARA        XXPART                         *39OFF/49ON
     C                   MOVE      XXPARB        XXPART                         *39OFF/49ON
     C                   SETON                                            49
     C                   END
     C                   END
      *
      * Behandle varelinjene (samt skriv oppdraget) på fakt/spes.
     C                   EXSR      VALI
     C                   EXSR      TOTOPD
      * 89 On: Første oppdr. skrevet (minst). Skriv ==== foran neste.
     C                   SETON                                        89
      *
      *  Syfa27b bruker også SORT - kalles derfor først nå..
      *  SKAL "KOSTNADSOVERSLAG" (FULL A4 SPESIFIKASJON) SKRIVES
      * (O=PÅ OPPDR.TIDSPKUNKT, S=SAML.FAK.TIDSP., B=BEGGE)
     C     PRTKO         IFEQ      'S'                                          B1
     C     PRTKO         OREQ      'B'                                          B1
     C                   Z-ADD     XFN           UFAKT             7 0
     C                   Z-ADD     KUNDNR        UKUNDE            8 0
      *(XTYPE:O=PÅ OPPDRAGSTIDSP./S=SAMLEF.TIDSP./P=PRØVE/K=KOPI)
     C     *IN27         IFEQ      '0'
     C                   MOVE      'S'           XTYPE             1
     C                   ELSE
     C     *IN28         IFEQ      '0'
     C                   MOVE      'K'           XTYPE             1
     C                   ELSE
     C                   MOVE      'P'           XTYPE             1
     C                   END
     C                   END
     C                   move      waval         uuuval            3
     c  N27waval         ifeq      '   '
     c                   move      ficurr        uuuval
     c                   end
N52  C     *IN55         IFEQ      '1'
     C                   CALL      'SYFA27B'
     C                   PARM                    UKUNDE
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    UFAKT
     C                   PARM                    UUUVAL
     C                   PARM                    ANTKOK
     C                   PARM                    XKOHE
     C     IDAG          PARM      IDAG          IDAG6P            6 0
     C     XFFDT         PARM      XFFDT         XFDT6P            6 0
     C                   PARM                    XTYPE
N52  C                   END
     C                   END                                                    E1
      *
      * OPPDATER FAKTURANR PÅ GRUNNLAGFIL
     C                   MOVE      HEAVD         ULAVD             4
     C                   MOVE      HEOPD         ULOPD             7
     C                   MOVE      *ZEROS        ULLI              5
     C                   MOVE      XFN           ULFN              7
     C     *IN27         IFEQ      '0'
     C                   MOVE      'N'           ULKOPI            1
     C                   MOVE      IDAG8         ULFDT             8
     C                   ELSE
     C                   MOVE      'J'           ULKOPI
     C                   MOVE      FADATO        ULFDT
     C                   END
     C                   MOVE      'O'           ULOPT             1
     C                   CALL      'LL054C'
     C                   PARM                    ULAVD
     C                   PARM                    ULOPD
     C                   PARM                    ULLI
     C                   PARM                    ULFDT
     C                   PARM                    ULFN
     C                   PARM                    ULKOPI
     C                   PARM                    ULOPT
N08   *
N08   * SUMMERE ANTALL PR GEBYR
N08  C     HEADFK        SETLL     LLGSFL01
N08  C     HEADFK        READE     LLGSFL01                               33
N08  C                   DOW       *IN33 = *OFF
N08  C                   IF        ((GSST = ' ') OR (GSST = 'E'))
N08  C     1             DO        100           XN1
N08  C                   SELECT
N08  C                   WHEN      GEB(XN1) = *BLANKS
N08  C                   EVAL      GEB(XN1) = GSGEB
N08  C                   EVAL      ANT(XN1) = GSANT
N08  C                   EVAL      PRI(XN1) = GSPR
N08  C                   LEAVE
N08  C                   WHEN      GEB(XN1) = GSGEB
N08  C                   EVAL      ANT(XN1) = ANT(XN1) + GSANT
N08  C                   IF        PRI(XN1) <> GSPR
N08  C                   EVAL      PRI(XN1) = 99999,99
N08  C                   END
N08  C                   LEAVE
N08  C                   ENDSL
N08  C                   ENDDO
N08  C                   END
N08  C     HEADFK        READE     LLGSFL01                               33
N08  C                   ENDDO
      *
     C                   ENDSR
      ***********************************************
     C     SPHEAD        BEGSR
      ***********************************************
      * Skriv spesifikasjons-header
      * Hvis overflow skriv "Fortsetter..." i bunnen før sideskift
      *
      * VED FLERE SIDER LEGGER INN NY STRINGKODE
      *
     C     KOPINR        IFGT      1
     C                   MOVE      SFMT12        SFMT1
     C                   MOVE      SFMT22        SFMT2
     C                   END
     C     *IN90         IFEQ      '1'
     C                   ADD       1             PAGEPS
     C   55              WRITE     KJØP1                                             ..Ps
     C                   END
     C                   EXSR      KDTFM1
     C   55              WRITE     KJØP                                              ..PS
     C                   EXSR      KDTFM1
     C     PROFIL        IFEQ      'J'                                            B3
     C     CPSPH1        IFNE      *BLANKS
     C   55              WRITE     KJØPH1                                            ..PS
     C                   END
     C     CPSPH2        IFNE      *BLANKS
     C   55              WRITE     KJØPH2                                            ..PS
     C                   END
     C     CPSPH3        IFNE      *BLANKS
     C   55              WRITE     KJØPH3                                            ..PS
     C                   END
     C                   END                                                      E3
     C   55              WRITE     KJØPHX
     C   90              EXSR      SPHEA2
     C                   SETOFF                                       90
      *
     C                   ENDSR
      *
      ***********************************************
     C     SPHEA2        BEGSR
      ***********************************************
      *
      * KUNDESPESIFIK LAYOUT - returner inntil 3 komponerte linjer.
     C     PROFI2        IFEQ      'J'                                           B2
     C                   Z-ADD     HEOPD         UOPD              7 0
     C                   Z-ADD     KUNDNR        UKUNDE            8 0
     C                   Z-ADD     KUNDNR        UKUNBEL           8 0
     C     AVDPRF        IFEQ      'J'
     C                   MOVE      KOAKNR        UKUNDE
     C                   END
     C                   Z-ADD     XFN           YYFAKT
      *
      * ved original er linjer alklerede oppdatert med valutakode
      *
     C                   move      waval         uuuval            3
     c  N27waval         ifeq      '   '
     c                   move      ficurr        uuuval
     c                   end
     c
     C                   CALL      'SYFA27C'
     C                   PARM                    UKUNDE
     C                   PARM                    UDOKUM
     C                   PARM                    HEAVD
     C                   PARM                    UOPD
     C                   PARM                    YYFAKT
     C                   PARM                    uuuval
     C                   PARM                    XKULI1           79
     C                   PARM                    XKULI2           79
     C                   PARM                    XKULI3           79
     C                   PARM                    UKUNBEL
     C                   PARM                    Uinnland
     C                   PARM                    Uflag1            1
     C                   PARM                    Uflag2            1
     C     XKULI1        IFNE      *BLANKS
     C   55              WRITE     KJØP21                                        SYFA27PS
     C                   END
     C     XKULI2        IFNE      *BLANKS
     C   55              WRITE     KJØP22                                        ......PS
     C                   END
     C     XKULI3        IFNE      *BLANKS
     C   55              WRITE     KJØP23
     C                   END                                                      .....PS
     C                   ELSE                                                    X2
      * Standard spesifik. layout
N24  C*** henter fra til sted
      *
N24  c                   EXSR      FRATILSR
     C                   EXSR      KDTFM2
     C                   SETOFF                                       33
     C                   MOVE      *BLANKS       FRI001
     C     CPFS01        IFNE      *blanks
     C                   MOVE      CPFS01        YFSKOD
     C     FRIKEY        CHAIN     FRISOK                             33
     C  N33CPFS01        CHAIN     KODFRI                             33
     C  N33              eval      FRI001=KFSOTX
     C  N33FRI001        CAT       FSSOK:1       FRI001           75
     C                   END
     C     CPFS02        IFNE      *blanks
     C                   MOVE      CPFS02        YFSKOD
     C     FRIKEY        CHAIN     FRISOK                             33
     C  N33CPFS02        CHAIN     KODFRI                             33
     C  N33FRI001        CAT       KFSOTX        FRI001
     C  N33FRI001        CAT       FSSOK:1       FRI001           75
     C                   END
     C     CPFS03        IFNE      *blanks
     C                   MOVE      CPFS03        YFSKOD
     C     FRIKEY        CHAIN     FRISOK                             33
     C  N33CPFS03        CHAIN     KODFRI                             33
     C  N33FRI001        CAT       KFSOTX        FRI001
     C  N33FRI001        CAT       FSSOK:1       FRI001           75
     C                   END
      * PRINTES VED N33
     C     FRI001        COMP      *BLANKS                                33
     C   55              WRITE     KJØP2                                          .....PS
     C                   END                                                     E2
     C                   ENDSR                                                   E2
      ***********************************************
     C     VALI          BEGSR
      ***********************************************
      *
      * Summer fakt.linjer m.m. uansett om de skal skrives eller ei
      * Summer linjer/legg ut i SORT/sett indikator for kredit/S,K,X?
     C                   EXSR      KREDIT
      *
      *  SKAL VANLIG SPESIFIKASJON SKRIVES....
      *
     C     PRTSPE        IFEQ      'J'                                          B1
     C     KOPINR        ANDLE     ANTKOS
      *
      * overflow på spesifikasjonen....
     C     *IN90         IFEQ      '1'                                           B2
     C                   EXSR      SPHEAD
     C                   ELSE
     C                   EXSR      SPHEA2
S35  C*                  SETOFF                                       90
     C                   END                                                     E2
      *
      * Fritekstlinjer på spesifikasjon (overflowchek i rutinen)
     C                   EXSR      FRILIN
      *
     C     PRTLIN        IFEQ      'J'
      * ------------------  SPACEB(1)/SPACEA(1) kun når FA.linj skrives
     C   55              WRITE     KJØP4
     C                   END
      *
     C                   END                                                    E1
      *
      *
      * EN (el fl) linj med  gebyrer utenom FRA som er inkludert i bel.)
     C                   EVAL      INKL = '(Inkl:'
      **
      ** GÅR I LØKKE OG HENTER LINJER FRA SORT (LAGT UT AV SR KREDIT)
      **  GJØRES UAVHENGIG AV OM DETALJLINJER/SPESIFIKASJ SKRIVES (PGA sum/moms mm)
      **  (MANGE FAKT/SORT VARIABLER ER DOBBELTDEFINERT VIA DS)
      **
     C     SORTK         SETLL     SORT
N25  C                   MOVE      *ZEROS        XFANTL
      *
     C     STVALI        TAG
     C                   SETOFF                                       33
     C                   READ      SORT                                   33
     C   33              GOTO      SLVALI
      *
      * TEST IF NEXT LINE HAVE SOME CODE AND NO TEXT
      *
     C     SOVT          IFEQ      *BLANKS
     C                   MOVE      SOKDM         XOKDM             1
     C                   MOVE      SOSAMM        XOSAMM            1
     C                   MOVE      SOVK          XOVK              3
     C                   MOVE      SOVT          XOVT             20
     C                   MOVE      SOBELN        XOBELN           13 2
     C                   MOVE      SOBELV        XOBELV           13 2
     C                   EXSR      TESTEQ
n23  C                   ELSE
n23  C                   MOVE      *BLANKS       FTX
n23  C                   MOVE      *ZEROS        XN01
n23  C                   EXSR      HENTFTXT
     C                   END
     C
     C                   MOVE      SOVK          YVK
     C     KODGEK        CHAIN     KODTGE                             33
     C     KODG2K        CHAIN     KODTG2                             33
     C   33              MOVE      *ZEROS        KG2SRT
     C   33              MOVE      *BLANKS       KGENOT
     C   33              MOVE      *BLANKS       KGEENT
     C   33              MOVE      *BLANKS       KG2TYT
     C   33              MOVEL     YVK           KGENOT
     C   33              MOVEL     YVK           KGEENT
     C   33              MOVEL     YVK           KG2TYT
     C     SOSAMM        IFNE      *BLANK
     C     SOSAMM        CHAIN     KODSAM                             33
     C                   END
     C  N71              Z-ADD     SOBELN        XPFNOK
     C   71              Z-ADD     SOBELV        XPFNOK
N63  C     sokdm         ifeq      'J'
N02  C                   add       sobeln        XMVAGN
N63  C                   end
     C                   ADD       XPFNOK        XTOTAL           13 2
     C                   EXSR      MVASR
      *
     C     PRTSPE        IFEQ      'J'
     C     KOPINR        ANDLE     ANTKOS
      * Hvis 0 skrives blank (ikke 0,00) Indikator for prtf.
     C     XPFNOK        COMP      *ZEROS                             3636
      *
      * Hvis sum pr gebyrkode - akkumuler i workfile
     C     PRTSPS        IFEQ      'J'
     C     SOSAMM        IFNE      *BLANK
     C                   MOVE      SOSAMM        WGVK
     C                   MOVEL     '**'          WGVK
     C                   ELSE
     C                   MOVE      SOVK          WGVK
     C                   END
     C                   MOVE      SOKDM         WGKDM
     C     SUMKEY        CHAIN     WSAMGE                             33
      *
      * post finnes ikke fra før
      *
     C     *IN33         IFEQ      '1'
     C  N70
     CANN79              MOVE      KGENOT        WGTEXT
     C   70              MOVE      KGEENT        WGTEXT
     C   79              MOVE      KG2TYT        WGTEXT
     c     SOKDM         ifne      ' '
     c     SOKDM         andne     'J'
     c     SOKDM         andne     'N'
     c                   eval      WGTEXT = %trim(WGTEXT)+ ' (' + SOKDM + ')'
     c                   end
     C                   MOVE      SOLNR         WGSORT
     C                   Z-add     NETTOF        WGNETF
     C                   Z-add     NETTO         WGNETT
     C                   Z-ADD     MVA           WGMVA
     C                   Z-ADD     BRUTTO        WGBRUT
     C                   WRITE     WSAMGER
     C                   ELSE
     C                   add       NETTOF        WGNETF
     C                   add       NETTO         WGNETT
     C                   ADD       MVA           WGMVA
     C                   ADD       BRUTTO        WGBRUT
     C                   UPDATE    WSAMGER
     C                   END
     C                   END
      *
     C     PRTLIN        IFEQ      'J'
     C     KOPINR        ANDLE     ANTKOS
      * Sjekk overflow på spesifikasjon
     C     *IN90         IFEQ      '1'
     C                   EXSR      SPHEAD
     C                   END
     C* "Tillegsttekst" fakt.linje skal ERSTATTE standardtekst
     C     XFAVT1        IFEQ      'X'
     C                   MOVEL     XFAVT2        KGENOT
     C                   MOVEL     XFAVT2        KGEENT
     C                   MOVEL     XFAVT2        KG2TYT
     C                   MOVE      ' '           KGENOT
     C                   MOVE      ' '           KGEENT
     C                   MOVE      ' '           KG2TYT
     C                   MOVE      *BLANKS       SOVT
     C                   END
      *
     C   55              WRITE     DET
n23   *
n23  C     1             DO        100           XN01
n23  C                   IF        FTX(XN01) = *BLANKS
n23  C                   LEAVE
n23  C                   END
n23  C                   MOVE      FTX(XN01)     FXVT
s58  C*                  WRITE     DETTXT
n58  C   55              WRITE     DETTXT
S25  C*                  ADD       1             XFANTL
n23  C                   ENDDO
      *
     C                   END
      *
     C                   END
      *
      * ved kode I i PrtLin skrives en/fler linjer med (Inkluderer: ...) = Annet en FRA
     c     PRTLIN        ifeq      'I'
     C     FAVK          ANDNE     'FRA'
     C                   EXSR      ADDINKL
     C                   END
     C                   ADD       1             XFANTL
     C                   DELETE    SORTR
     C                   GOTO      STVALI
      *
     C     SLVALI        TAG
     c     PRTLIN        IFEQ      'I'
     c     INKL1         andne     '(Inkl:'
     C                   eval      INKL = %trim(INKL) + ')'
     C                   eval      XKULI3 = INKL1
     C   55              write     KJØP23
     c     INKL2         ifne      *blanks
     C                   eval      XKULI3 = INKL2
     C   55              write     KJØP23
     C                   end
     c     INKL2         ifne      *blanks
     C                   eval      XKULI3 = INKL2
     C   55              write     KJØP23
     C                   end
     C                   END
     C                   ENDSR
      *
      *******************************************
     C     ADDINKL       BEGSR
      ***********************************************
     C                   eval      INKL = %trim(INKL) + '  ' + KGENOT
     c     SOVT          ifne      *blanks
     C                   eval      INKL = %trim(INKL) + '/' + SOVT
     c                   end
     C                   eval      INKL = %trim(INKL) + ' Kr ' +
     C                             %trim(%editc(FABELN:'J'))
     C                   ENDSR
      ***********************************************
     C     KREDIT        BEGSR
      ***********************************************
      * WAVAL 'kommer fra" FACURI i FAKT
      *  - Denne er ulik blank kun ved fremmedvaluta (ulik FICURR)
     C     WAVAL         COMP      *BLANKS                            7171
     C   71WAVAL         COMP      FICURR                             7171
     C                   MOVE      *ZEROS        XTOTAL
     C                   MOVE      *ZEROS        XMVAGR
N02  C                   MOVE      *ZEROS        XMVAGN
     C                   MOVE      *ZEROS        XMVAFR
      *
      * DA FACURI OPPDATERES  MED NOK I RUNDE 1 MÅ VI
      * LEGGE FICURR I KEYEN VED RUNDE NUMMER 2
      *
     C                   MOVE      WAVAL         WAVAL8
     C   27KOPINR        IFGT      1
     C     WAVAL         ANDEQ     *BLANKS
     C                   MOVE      FICURR        WAVAL8
     C                   END
     C     FAK8K         SETLL     FAK8
      *
     C     STKRE         TAG
     C                   SETOFF                                       33
     C     FAK8K         READE     FAK8                                   33
      *
     C   33              GOTO      SLKRE
      *
      * AGENTLINJER SKAL IKKE VÆRE MED
      *
     C     FASK          CABEQ     'A'           STKRE
     C     FASK          CABEQ     'F'           STKRE
     C     FASK          CABEQ     'I'           STKRE
     C     FASK          CABEQ     'E'           STKRE
     C     FAKDA         CABEQ     'K'           STKRE
      *
      * SLETTEDE LINJER SKAL IKKE
      *
     C     FAOPKO        CABEQ     'D'           STKRE
      *
      * ORIGINAL: OPPDATER FILE (ELLER SKIPP/DELETE)
      *
     C     *IN27         IFEQ      '0'                                          1B
      *
      * INVOICE LINES WITH AMT. ZERO:
      *
     C     FABELN        IFEQ      0                                             2B
      *
      * SKIPP BUT DO NOT DELETE IF OTHER UNIT=D(PR DAY)
      *
     C     FA01B         IFEQ      'D'                                            3B
     C                   GOTO      STKRE
     C                   END                                                      3E
      *
      * SKIPP 0-LINE TYPE "PR LINE ON SAD" - DELETE IF SAD FINISHED
      *
     C     FA01B         IFEQ      'L'                                            3B
     C     HEPK1         IFEQ      'J'                                             4B
     C                   GOTO      STKRE                                         SAD UFERDIG
     C                   ELSE                                                      X4
     C     FAKTK         CHAIN     FAKT                               33
     C  N33              DELETE    FAKTR
     C                   GOTO      STKRE
     C                   END                                                       4E
     C                   END                                                      3E
     C* UTL-LINJE SOM ER ENDRET TIL 0
     C     FAVK          IFEQ      'UTL'
     C     FAKDA         IFEQ      'M'
     C     FAKDA         OREQ      'E'
     C     FAKTK         CHAIN     FAKT                               33
     C  N33              DELETE    FAKTR
     C                   GOTO      STKRE
     C                   END                                                     3<-E
     C                   END                                                     3<-E
      *
      * SKIPP AND DELETE IF AUTOGENERATED LINE
      *
     C     FAKDA         IFEQ      'A'                                            3B
     C     FAKDA         OREQ      'B'
     C                   MOVE      FAVK          YVK
     C     KODGEK        CHAIN     KOGER                              33
     C     KGETYP        IFNE      'NUL'                                           4B
     C     FAKTK         CHAIN     FAKT                               33
     C  N33              DELETE    FAKTR
     C                   GOTO      STKRE
     C                   END                                                       4E
     C                   END                                                      3E
     C                   END                                                     2E (BEL=0)
      *
      * Linjen skal skrives .. oppdater
     C     FAKTK         CHAIN     FAKT                               33
     C     *in33         IFEQ      '0'
     C                   MOVE      KUNDNR        FAKUNR
     C                   MOVE      XFN           FAFAKT
     C                   MOVE      'F'           FAOPKO
     C                   MOVE      YDTPM         FAMND
     C                   MOVE      YDTPÅ         FAÅR
     C                   MOVE      YDTPC         FACC
     C                   MOVE      IDAG8         FADATO
     C                   MOVE      XFFDTD        FADAFD
     C                   MOVE      XFFDTM        FADAFM
     C     XFFDTÅ        IFGT      50
     C     XFFDTÅ        ADD       1900          FADAFÅ
     C                   ELSE
     C     XFFDTÅ        ADD       2000          FADAFÅ
     C                   END
     C                   MOVE      'S'           FAKDA
     C                   MOVE      WAVAL         FACURI
     C     WAVAL         IFEQ      *BLANKS
     C                   MOVE      FICURR        FACURI
     C                   END
N55  C                   move      FACD22F       FACD22
     C                   EXCEPT    OPDFAK
     C                   END
      *
     C                   END                                                    1E(N27=ORI.)
      *
     C                   MOVE      FAVK          YVK
     C     KODGEK        CHAIN     KODTGE                             33
     C     KODG2K        CHAIN     KODTG2                             33
     C   33              MOVE      *ZEROS        KG2SRT
     C   33              MOVE      *BLANKS       KGENOT
     C   33              MOVE      *BLANKS       KGEENT
     C   33              MOVE      *BLANKS       KG2TYT
     C   33              MOVEL     YVK           KGENOT
     C   33              MOVEL     YVK           KGEENT
     C   33              MOVEL     YVK           KG2TYT
     C     SOSAMM        IFNE      *BLANK
     C     SOSAMM        CHAIN     KODSAM                             33
     C                   END
     C     SOSAMM        IFNE      *BLANKS
     C                   Z-SUB     1             SOLNR
     C                   END
     C                   WRITE     SORTR
      * Selger/kjøper/X??? for key FREETK
     C                   MOVE      FASK          XXSKKO
      *
     C                   GOTO      STKRE
      *
     C     SLKRE         ENDSR
      *
      ******************************************
     C     TOTOPD        BEGSR
      ******************************************
     C     XMVAGR        MULT(H)   FITAXB        XMOMS             9 2
     C                   Z-ADD     XMOMS         XPMOMS            9 2
     C     XTOTAL        ADD       XMOMS         XBRUTT           13 2
      *
     C     XPMOMS        COMP      *ZEROS                             7272
     C                   ADD       XPMOMS        XMOM              9 2
     C                   ADD       XBRUTT        XBRUT            13 2
     C                   ADD       XMVAGR        XMVGR             9 2
N02  C                   ADD       XMVAGN        XMVGN
     C                   ADD       XMVAFR        XMVFR             9 2
      *
      *
     C                   EXSR      TSTBRU
      * FJERNET LIBNJER FYSISK
      *
     C     *IN88         IFEQ      '1'
     C                   ADD       1             PAGEPF
     C   55              WRITE     FHEAD1
     C                   EXSR      KDTFM1
N52  C     *in55         ifeq      '1'
     C                   WRITE     FHEAD
N48  C  N64              WRITE     FDETH
N48  C   64              WRITE     FDETHPDF
N52  C                   END
     C                   EXSR      KDTFM1
     C                   Z-ADD     1             XANT              2 0
     C                   SETOFF                                       88
     C                   END
      *
      * Selve fakturaen, detaljlinje
      * IKKE skriv/tell hvis fast teskt i steden for linje pr oppdrag
     C     CPHEN1        IFEQ      *BLANKS
     C     URETUR        ANDNE     'S'
S48  C*                  WRITE     FDET
N48  c     *in(64)       ifeq      '0'
N48  C   55              WRITE     FDET
N48  C                   else
N48  c                   z-add     xbrutt        xbru92
n48  c                   movea     wsmva         xmva92
N48  C     XBRUTT        ADD       XMVA92        XTOT92
n48  c                   add       xbru92        xbru92t
N48  c                   add       xmva92        xmva92t
N48  c                   add       xtot92        xtot92t
N48  C   55              WRITE     FDETPDF
N48  c                   end
     C                   ADD       1             XANT
      *
     C     *IN16         IFEQ      *ON
     C                   MOVEL     'FDET '       WA04
     C                   Z-ADD     HEFBV         WC01
     C                   Z-ADD     HEVKT         WC02
     C                   Z-ADD     HENT          WC03
     C                   Z-ADD     HEAVD         WC04
     C                   Z-ADD     HEOPD         WC05
     C                   Z-ADD     XTOTAL        WC06
     C                   MOVEL     *BLANKS       WC07                           FSSOK
     C                   WRITE     SYFA27WR
     C                   ENDIF
      *
     C                   END
      *
      * Spesifikasjon, oppdragstotal  (men kun hvis linjene skrives)
     C     PRTSPE        IFEQ      'J'
     C     KOPINR        ANDLE     ANTKOS
     C     PRTLIN        ANDEQ     'J'
      * Overflow..
     C     *IN90         IFEQ      '1'
     C                   EXSR      SPHEAD
     C                   END
      *
      * skriv variabelt antall momslinjer før TOT
     C                   Z-ADD     1             XX
     C     SKMVA         TAG
     C     WSMVAK(XX)    IFNE      ' '
     C                   MOVE      WSMVAK(XX)    XMVAK
     C                   Z-ADD     WSMVAP(XX)    MVAPRO
     C                   Z-ADD     WSGRL(XX)     XMVAGR
     C                   Z-ADD     WSMVA(XX)     XPMOMS
     C                   ADD       XPMOMS        XBRUTT
     C   55              WRITE     TOTMB
     C                   ADD       1             XX
     C                   GOTO      SKMVA
     C                   ENDIF
      *TOT inkluderer også sum momsfri
     C   55              WRITE     TOT
     C                   END
      *
     C                   MOVE      *ZEROS        XMVAGR
     C                   MOVE      *ZEROS        XMVAFR
     C                   MOVE      *ZEROS        XPMOMS
     C                   MOVE      *ZEROS        XBRUTT
     C                   MOVE      *ZEROS        XTOTAL
s54  C*                  CLEAR                   WSMVAK
s54  C*                  CLEAR                   WSMVAP
s54  C*                  CLEAR                   WSGRL
s54  C*                  CLEAR                   WSMVA
n54  C                   MOVE      *blanks       WSMVAK
n54  C                   move      *zeros        WSMVAP
n54  C                   move      *zeros        WSGRL
n54  C                   move      *zeros        WSMVA
n54  c                   move      *zeros        xxtill
      *
     C                   ENDSR
      *
     C********************************************************
     C     SPESUM        BEGSR
     C********************************************************
     C                   MOVE      *ZEROS        XETTO            11 2
     C                   MOVE      *ZEROS        XETTOF           11 2
     C                   MOVE      *ZEROS        XVA              11 2
     C                   MOVE      *ZEROS        XRUTTO           11 2
     C                   MOVE      *ZEROS        X2NETT
     C                   MOVE      *ZEROS        X2MVAT
     C                   MOVE      *ZEROS        X2BRTT
      * Heading
     C                   EXSR      KDTFM1
     C                   ADD       1             PAGEPS
     C   55              WRITE     KJØP                                              ..PS
     C                   EXSR      KDTFM1
      * SETT IND. 48 PÅ HVIS DET ER LAGERFAKTURA
     C     WGUNIK        SETLL     WSAMGE1
     C     WGUNIK        READE     WSAMGE1                                33
     C     *IN33         IFEQ      '0'
     C     XFN           SETLL     LLGSFL06
     C     XFN           READE     LLGSFL06                               33
     C     *IN33         IFEQ      '0'
S08  C*    XFN           andne     *zeros
     C                   MOVE      '1'           *IN48
     C                   ELSE
     C                   MOVE      '0'           *IN48
     C                   END
     C                   MOVE      '0'           *IN33
     C                   END
     C     *IN48         IFEQ      '0'
     C   55              WRITE     SUMLH
     C                   ELSE
     C   55              WRITE     SUMLH2
     C                   END
     C                   MOVE      '0'           *IN90
      *
     C     WGUNIK        SETLL     WSAMGE1
     C     ST            TAG
     C     WGUNIK        READE     WSAMGE1                                33
     C     *IN33         DOWEQ     '0'
      * overflow på spesifikasjonen....
     C     *IN90         IFEQ      '1'
     C                   EXSR      KDTFM1
     C                   ADD       1             PAGEPS
     C   55              WRITE     KJØP                                              ..PS
     C                   EXSR      KDTFM1
     C     *IN48         IFEQ      '0'
     C   55              WRITE     SUMLH
     C                   ELSE
     C   55              WRITE     SUMLH2
     C                   END
     C                   MOVE      '0'           *IN90
     C                   END
     C     *IN48         IFEQ      '0'
     C                   Z-ADD     WGNETT        NETTO            11 2
     C                   Z-ADD     WGNETF        NETTOF           11 2
     C                   Z-ADD     WGMVA         MVA              11 2
     C                   Z-ADD     WGBRUT        BRUTTO           11 2
     C   55              WRITE     SUMLD
      *
     C                   ADD       NETTO         XETTO            11 2
     C                   ADD       NETTOF        XETTOF           11 2
     C                   ADD       MVA           XVA              11 2
     C                   ADD       BRUTTO        XRUTTO           11 2
     C                   ELSE
     C                   MOVE      *ZEROS        X2ANT
     C                   MOVE      *ZEROS        X2PRIS
N08  C                   IF        XFN = 0
N08  C     1             DO        100           XN1
N08  C                   IF        WGVK   = GEB(XN1)
N08  C                   EVAL      X2ANT  = ANT(XN1)
N08  C                   EVAL      X2PRIS = PRI(XN1)
N08  C                   LEAVE
N08  C                   END
N08  C                   ENDDO
N08  C                   ELSE
     C     LGS06K        SETLL     LLGSFL06
     C     LGS06K        READE     LLGSFL06                               33
     C     *IN33         DOWEQ     '0'
     C                   ADD       GSANT         X2ANT
     C                   SELECT
     C     X2PRIS        WHENEQ    0
     C                   MOVE      GSPR          X2PRIS
     C     X2PRIS        WHENNE    GSPR
     C                   MOVE      9999999       X2PRIS
     C                   ENDSL
     C     LGS06K        READE     LLGSFL06                               33
     C  N33              ENDDO
N08  C                   END
     C                   Z-ADD     WGNETT        X2NET
     C                   ADD       WGNETF        X2NET
     C                   Z-ADD     WGMVA         X2MVA
     C                   Z-ADD     WGBRUT        X2BRT
     C   55              WRITE     SUMLD2
     C                   ADD       X2NET         X2NETT
     C                   ADD       X2MVA         X2MVAT
     C                   ADD       X2BRT         X2BRTT
     C                   END
     C*
     C     WGUNIK        READE     WSAMGE1                                33
     C                   END
      *
      * TOTAL
     C     *IN48         IFEQ      '0'
     C   55              WRITE     SUMLT
     C                   ELSE
     C   55              WRITE     SUMLT2
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     TOTFAK        BEGSR
      ***********************************************
s06  C***                DUMP
N41  C                   EXSR      TotTillegg
     C     XBRUT         COMP      *ZEROS                               73
     C     XMOM          COMP      *ZEROS                             7272
      * Tillegg fakturagebyr (mm..)
S41  C*                  EXSR      TotTillegg
      *
      *TOTALER PÅ SPESIFIKASJON
      * MEN KUN NÅR SPESIFIKASJON SKRIVES  (50 ON)
     c                   move      *OFF          *in50
     C     PRTSPE        IFEQ      'J'
     C     KOPINR        ANDLE     ANTKOS
     c                   move      *ON           *in50
      * overflow på spesifikasjonen....
     C     *IN90         IFEQ      '1'                                           B2
     C                   EXSR      SPHEAD
     C                   END                                                     E2
     C   55              WRITE     TOT2H
     C                   END
      * skriv variabelt antall momslinjer før TOT
      * - MEN MOMSEN MÅ UANSETT ADDES TIL XBRUT !!!! (uavhengig av print spesifikasjon)
     C                   Z-ADD     1             XX
     C     SKMVAT        TAG
     C     WXMVAK(XX)    IFNE      ' '
     C                   MOVE      WXMVAK(XX)    XMVAK
     C                   Z-ADD     WXMVAP(XX)    MVAPRO
     C                   Z-ADD     WXGRL(XX)     XMVGR
     C                   Z-ADD     WXMVA(XX)     XMOM
     C                   ADD       XMOM          XBRUT
N52  C     *in55         ifeq      '1'
     C   50              WRITE     TOT2L
N52  C                   end
     C                   ADD       1             XX
     C                   GOTO      SKMVAT
     C                   ENDIF
N52  C     *in55         ifeq      '1'
     C   50              WRITE     TOT2T
N52  C                   end
      * SKRIVER GEBYR-TOTALLISTE
      *         IKKE HVIS PROFIL SIER NEI/IKKE VED PRØVEKJØRING
     C   50PRTSPS        IFEQ      'J'
     C                   EXSR      SPESUM
     C                   END
      *
      * Splitt heltall/desimal for giro
     C                   MOVEL     XBRUT         XTOTKR
     C                   MOVE      XBRUT         XTOTØR
      * MVA (TOTAL) Skrives som separat detaljlinje.
      * HVIS IND 72 ON. - SJEKK OVERFLOW.
      * (men ikke hvis kunden har profil med fast teksthenvisning)
     C     URETUR        IFNE      'S'
     C     CPHEN1        IFEQ      *BLANKS
      *
     C                   EXSR      TSTBRU
      *
      *
     C     *IN88         IFEQ      '1'
     C                   ADD       1             PAGEPF
N52  C     *in55         ifeq      '1'
     C                   WRITE     FHEAD1
     C                   EXSR      KDTFM1
     C                   WRITE     FHEAD
N48  C  N64              WRITE     FDETH
N48  C   64              WRITE     FDETHPDF
N52  c                   end
     C                   EXSR      KDTFM1
     C                   Z-ADD     1             XANT              2 0
     C                   SETOFF                                       88
     C                   END
     C   55              WRITE     FTOT
     C                   ADD       1             XANT
      * skriv variabelt antall momslinjer før FTOT
     C                   Z-ADD     1             XX
     C     SKMVAFT       TAG
     C     WXMVAK(XX)    IFNE      ' '
     C                   MOVE      WXMVAK(XX)    XMVAK
     C                   Z-ADD     WXMVAP(XX)    MVAPRO
     C                   Z-ADD     WXGRL(XX)     XMVGR
     C                   Z-ADD     WXMVA(XX)     XMOM
     C                   EXSR      TSTBRU
     C     *IN88         IFEQ      '1'
     C                   ADD       1             PAGEPF
N52  C     *in55         IFEQ      '1'
     C                   WRITE     FHEAD1
     C                   EXSR      KDTFM1
     C                   WRITE     FHEAD
N48  C  N64              WRITE     FDETH
N48  C   64              WRITE     FDETHPDF
N52  C                   end
     C                   EXSR      KDTFM1
     C                   Z-ADD     1             XANT              2 0
     C                   SETOFF                                       88
     C                   END
N02  C     *in71         ifeq      '1'
N69  C                   IF        XMVGR = 0
N69  C                   EVAL      KURS = 0
N69  C                   EVAL      MVANOK = 0
N69  C                   ELSE
N02  C     XMVGN         DIV(H)    XMVGR         kurs             11 7
N02  C     XMOM          MULT(H)   kurs          MVANOK           11 2
s06  C*                  DUMP
N69  C                   END
N02  C                   end
     C   55              WRITE     FTOTMB
     C                   ADD       2             XANT
     C                   ADD       1             XX
     C                   GOTO      SKMVAFT
     C                   ENDIF
     C                   END
     C     XVAL          IFNE      *BLANKS
     C                   MOVE      XVAL          PVAL              3
     C                   ELSE
     C                   MOVE      FICURR        PVAL
     C                   END
      *
      * VED KIDGIRO EGEN TOTALLINJE
      *
N52  C     *in55         ifeq      '1'
     C  N35              WRITE     FTOT2
     C   35              WRITE     FTOT2B
N52  C                   end
      *
     C     *IN16         IFEQ      *ON
     C                   MOVEL     'FTOT '       WA04
     C                   Z-ADD     MVAPRO        WD01
     C                   Z-ADD     XMVGR         WD02
     C                   Z-ADD     XMOM          WD03
     C                   Z-ADD     XBRUT         WE01
     C                   WRITE     SYFA27WR
     C                   ENDIF
      *
N34  C                   IF        KOWAWB = 'K'
N34  C                   exsr      KIDGIR
N34  C                   END
     C     XNYFAKT       IFEQ      'J'
N66  C     XOPDXML       OREQ      'J'
N66  C                   MOVE      'N'           XOPDXML
     C     CUNDC03K2     CHAIN     CUNDC03                            33
     C  N33              EXSR      OPDXML
     C                   ENDIF
      *
     C                   END
     C                   MOVE      *ZEROS        XMVGR
     C                   MOVE      *ZEROS        XMVFR
     C                   MOVE      *ZEROS        XMOM
     C                   MOVE      *ZEROS        XBRUT
      *
      *
      * PRINT GIRO (73 OFF= BELØP ER POSITIVT/71 OFF="BLANK" Valuta
      *
      *
     C     kowawb        ifeq      'K'
S34  C*                  exsr      KIDGIR
     C                   GOTO      slgiro
     c                   end
     C     *IN73         IFEQ      '0'                                          1<-B
     C     *IN71         ANDEQ     '0'                                          1<-B
     C     URETUR        ANDNE     'S'
     C     UBBS          IFNE      'N'                                           2<-B
     C     KOWAWB        IFNE      'J'                                            3<-B
     C                   EXSR      KDTFM1
     C   55              WRITE     BGIR
     C                   EXSR      KDTFM1
     C                   EXSR      MOD10
     C     UBBS          IFEQ      'A'                                             4<-B
     C   55              WRITE     BGIR2A
     C                   ELSE                                                      4
     C     UBBS          IFEQ      'B'                                              5<-B
      * FIX Z-SUPRESS FOR ALFA-FILED
     C                   MOVE      XTOTKR        ATOTKR
     C     1             DO        10            AX                2 0               6<-B
     C     A(AX)         IFEQ      '0'                                                7<-B
     C                   MOVE      ' '           A(AX)
     C                   ELSE                                                         7
     C                   GOTO      BGIRT2
     C                   END                                                          7<-E
     C                   END                                                         6<-E
     C     BGIRT2        TAG
      *
     C   55              WRITE     BGIR2B
     C                   ELSE                                                       5
     C     UBBS          IFEQ      'C'                                               6<-B
     C   55              WRITE     BGIR2C
     C                   ELSE                                                        6
     C     UBBS          IFEQ      'D'                                                7<-B
     C   55              WRITE     BGIR2D
     C                   ELSE                                                         7
     C     UBBS          IFEQ      'E'                                                 8<-B
      * FIX Z-SUPRESS FOR ALFA-FILED
     C                   MOVE      XTOTKR        ATOTKR
     C     1             DO        10            AX                2 0                  9<-B
     C     A(AX)         IFEQ      '0'                                                   10<-B
     C                   MOVE      ' '           A(AX)
     C                   ELSE                                                            10
     C                   GOTO      BGIRE2
     C                   END                                                             10<-E
     C                   END                                                            9<-E
     C     BGIRE2        TAG
      *
     C   55              WRITE     BGIR2E
     C                   ELSE                                                          8
      *
     C     UBBS          IFEQ      'F'
     C   55              WRITE     BGIR2F
      *
     C                   ELSE
     C   55              WRITE     BGIR3
     C                   END
      *
     C                   END                                                           8<-E
     C                   END                                                          7<-E
     C                   END                                                         6<-E
     C                   END                                                        5<-E
     C                   END                                                       4<-E
      * WHEN SPLIT INVOICE/GIRO
     C                   ELSE                                                     3
     C     BETMAT        IFEQ      'B'
     C                   EXSR      DELTG
     C                   END                                                      3<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     c     slgiro        tag
      *
     C                   ENDSR
      *
N31   ***********************************************
N31  C     TOTTILLEGG    BEGSR
N31   ***********************************************
N31  C* FAKTURAGEBYR... (MEN IKKE HVIS KUNDEN HAR UNNTAK..../ikke ved kredit )
N31  C* LEGG TIL FAKT.LINJE PÅ SISTE OPPDRAG (SOM HADDE FAKT.LINJE)
N31   * *IN27=1 = kopi/prøvekjøring!! kan da selvsagt IKKE legge til fakt-linje!!!
N31  C     XBRUT         cable     *ZEROS        UtTotTil
N31  C     *IN27         cabeq     '1'           UtTotTil
N31   * Hjelpevariabel for 'noe lagt til' = Rekalkuler moms/total
N31  C                   MOVE      *ZEROS        XXTILL            9 0
N31   *fakturagebyr
N31  C     IFFAGE        Ifne      *blanks                                      Gebyr i FIRINL
N31  C     XXFAGB        andne     *zeros                                       Beløp i FIRINL
N31  C     CTIKFG        ANDNE     'X'
N31  C     CTIKFG        ANDNE     'N'
N31  C     WAVAL         Ifeq      *blanks                                      kun tillat i
N31  C     WAVAL         oreq      FICURR                                       hjemme-valuta
N31  C                   MOVE      IFFAGE        FAVK
N31  C                   Z-ADD     FAAVD         UUAVD             4 0
N31  C                   Z-ADD     FAOPD         UUOPD             7 0
N31  C                   move      *zeros        UULI              5 0
N31  C                   CALL      'SYGE06'
N31  C                   PARM                    UUAVD
N31  C                   PARM                    UUOPD
N31  C                   PARM                    UULI
N31  C                   Z-ADD     UULI          FALI
N49  C                   MOVE      KUNDNR        FAKUNR
N49  C                   MOVE      XFN           FAFAKT
N49  C                   MOVE      'F'           FAOPKO
N49  C                   MOVE      YDTPM         FAMND
N49  C                   MOVE      YDTPÅ         FAÅR
N49  C                   MOVE      YDTPC         FACC
N49  C                   MOVE      IDAG8         FADATO
N49  C                   MOVE      XFFDTD        FADAFD
N49  C                   MOVE      XFFDTM        FADAFM
N49  C     XFFDTÅ        IFGT      50
N49  C     XFFDTÅ        ADD       1900          FADAFÅ
N49  C                   ELSE
N49  C     XFFDTÅ        ADD       2000          FADAFÅ
N49  C                   END
N49  C                   MOVE      'S'           FAKDA
N49  C                   MOVE      WAVAL         FACURI
N49  C     WAVAL         IFEQ      *BLANKS
N49  C                   MOVE      FICURR        FACURI
N49  C                   END
N31  C                   Z-ADD     XXFAGB        FABELN
N31  C                   Z-ADD     XXFAGB        FABELV
n41  C                   MOVE      FAVK          YVK
n41  C     KODGEK        CHAIN     KODTGE                             33
n41  C     KODG2K        CHAIN     KODTG2                             33
N31  C                   WRITE     FAKTR                                        FIL FAKT
N31  C   55              WRITE     TOTFGE                                       PRINTERFIL
N41  C   55              WRITE     TOTFG2
N31  C                   ADD(H)    FABELN        XXTILL
N31  C                   END
N31  C                   END
N31   *
N31   * ER DET LAGT TIL... JUSTER TOTAL MOMS/TOTALBELØP
N31  C     XXTILL        IFNE      *ZEROS
N31  C                   ADD       XXTILL        XBRUT
n41  C     FAKDM         IFEQ      'N'
n41  C     FAKDM         OREQ      ' '
n41  C                   ADD       XXTILL        XMVFR
n41  C                   END
S41  C*    FAKDM         IFEQ      'J'
N31  C                   Z-ADD     XXTILL        XPFNOK
N31  C                   EXSR      MVASR
s41  C*                  ELSE
s41  C*                  ADD       XXTILL        XMVFR
s41  C*                  END
N41  C                   exsr      faktgeb
N31  C                   END
N31  C*
N31  C     UtTotTil      ENDSR
      *
      ***********************************************
     C     DELTG         BEGSR
      ***********************************************
     C                   EXSR      KDTFM1
     C   55              WRITE     SGIR
     C                   EXSR      KDTFM1
     C                   EXSR      MOD10
     C     UBBS          IFEQ      'A'
     C   55              WRITE     SGIR2A
     C                   ELSE
     C     UBBS          IFEQ      'B'
      * FIX Z-SUPRESS FOR ALFA-FILED
     C                   MOVE      XTOTKR        ATOTKR
     C     1             DO        10            AX                2 0
     C     A(AX)         IFEQ      '0'
     C                   MOVE      ' '           A(AX)
     C                   ELSE
     C                   GOTO      SGIRT
     C                   END
     C                   END
     C     SGIRT         TAG
      *
     C   55              WRITE     SGIR2B
     C                   ELSE
     C     UBBS          IFEQ      'C'
     C   55              WRITE     SGIR2C
     C                   ELSE
     C     UBBS          IFEQ      'D'
     C   55              WRITE     SGIR2D
     C                   ELSE
     C     UBBS          IFEQ      'E'
      * FIX Z-SUPRESS FOR ALFA-FILED
     C                   MOVE      XTOTKR        ATOTKR
     C     1             DO        10            AX                2 0
     C     A(AX)         IFEQ      '0'
     C                   MOVE      ' '           A(AX)
     C                   ELSE
     C                   GOTO      SGIRE
     C                   END
     C                   END
     C     SGIRE         TAG
      *
     C   55              WRITE     SGIR2E
     C                   ELSE
      *
     C     UBBS          IFEQ      'F'
     C   55              WRITE     SBGIR2F
      *
     C                   ELSE
     C   55              WRITE     SGIR3
     C                   END
      *
     C                   END
     C                   END
     C                   END
     C                   END
     C                   END
     C                   ENDSR
      *
      ***********************************************
     C     BETSR         BEGSR
      ***********************************************
      *
      *** FINNER BETBET OG FORFALLSDATO
      *** INN ÅÅMMDD   UT DDMMÅÅ
     C     WSFDAT        IFEQ      *ZEROS
     C                   MOVE      *ZEROS        XFFDT             6 0
     C                   ELSE
     C                   MOVE      WSFDAT        XFFDT
     C                   END
     C                   MOVE      *BLANKS       BETTXT           30
     C                   CALL      'SYFA20A'
     C     XFFDT         PARM      XFFDT         UFFDT             6 0
     C                   PARM                    BETTXT
     C                   PARM                    UFIRM
     C                   PARM                    BETBET
     C                   MOVE      XFFDT         KFFDT
S55  C*                  MOVE      BETBET        FACD22
N55  C                   MOVE      BETBET        FACD22F           2
      *
     C                   ENDSR
      *
      ******************************************
      *  MOD10     -    UTREGNING AV MOD-10 KONTROLLFELT (WBAK)
      *-----------------------------------------
     C     MOD10         BEGSR
     C                   MOVE      *ZEROS        UPAR21           21
     C                   MOVE      WKID          UPAR21
     C                   CALL      'SYGE09'
     C                   PARM                    UPAR21
     C                   PARM                    UMOD              1 0
     C                   MOVE      UMOD          XBAK              1 0
      * HENTER MODULUS TIL BELØP
     C   59              MOVE      *ZEROS        UPAR21           21
     C   59              MOVE      *ZEROS        UPAR19           19
     C   59              MOVE      XTOTKR        UPAR19
     C   59              MOVEL     UPAR19        UPAR21
     C   59              MOVE      XTOTØR        UPAR21
     C   59              CALL      'SYGE09'
     C                   PARM                    UPAR21
     C                   PARM                    UMOD              1 0
     C   59              MOVE      UMOD          KNYMOD            1
      *                                                                   D150
      *
      * KID AV LENGDE 8
      *
     C                   MOVEL     WKID          KID20            20
     C                   MOVE      XBAK          KID20
      *
     C                   SETOFF                                       62
     C     UFIRM         CHAIN     FIRKID                             33
     C  N33              SETON                                        62
N68   *
N68   * *in62= kid 8 lang
N68   *
     C     *IN62         IFEQ      '1'
      *
     C*FINNES FRA FØR ? VED KOPI
      *
     C     *IN27         IFEQ      '1'
     C     KID20         CHAIN     KIDTRAN                            33
S68  C*  33              SETOFF                                       62
N68  c     *in33         ifeq      '1'
N68  C                   MOVE      *ZEROS        UPAR21           21
N68  C                   MOVE      TEFFNR        UPAR21
N68  C                   CALL      'SYGE09'
N68  C                   PARM                    UPAR21
N68  C                   PARM                    UMOD              1 0
N68  C                   MOVEL     TEFFNR        KID8              8
N68  C                   MOVE      UMOD          KID8
N68  C                   MOVE      KID8          KID8B             8
N68  C                   MOVE      KID8          TRKI08
N68  C                   MOVE      KID20         TRKI20
N68  C                   WRITE     KIDTRANR
N68  c                   end
     C  N33              MOVE      TRKI08        KID8              8
     C  N33              MOVE      KID8          KID8B             8
     C* ELSE IKKE KOPI
     C                   ELSE
     C     KID20         CHAIN     KIDTRAN                            33
     C  N33              MOVE      TRKI08        KID8              8
     C  N33              MOVE      KID8          KID8B             8
     C  N33              GOTO      UTKID
     C     UFIRM         CHAIN     FIRKID                             33
     C     *IN33         IFEQ      '0'
S12  C*                  ADD       1             FIKID8
S12  C*                  UPDATE    FIRKIDR
S12  C*                  SUB       1             FIKID8
     C                   MOVE      *ZEROS        UPAR21           21
s12  C*                  MOVE      FIKID8        UPAR21
n12  C                   MOVE      TEFFNR        UPAR21
     C                   CALL      'SYGE09'
     C                   PARM                    UPAR21
     C                   PARM                    UMOD              1 0
s12  C*                  MOVEL     FIKID8        KID8              8
n12  C                   MOVEL     TEFFNR        KID8              8
     C                   MOVE      UMOD          KID8
     C                   MOVE      KID8          KID8B             8
     C                   MOVE      KID8          TRKI08
     C                   MOVE      KID20         TRKI20
     C                   WRITE     KIDTRANR
     C                   END
     C                   END
     C                   END
      *
     C     UTKID         ENDSR
      *
      ******************************************                       ***
     C     AVDSR         BEGSR
      ******************************************
     C     KODTA9        CHAIN     KODTA                              33
     C                   MOVE      KOAKNR        WAKN
     C     KUND1K        CHAIN     CUNDL01                            33
     C  N33              DO
     C                   MOVE      KNAVN         XFNAVN           30
     C                   MOVE      ADR1          XFADR1           30
     C                   MOVE      ADR2          XFADR2           30
     C                   MOVE      POSTNR        XFPONR            4 0
     C                   MOVE      ADR3          XFADR3           24
     C                   MOVE      BANKG         XFBANK           15
     C                   END
     c                   move      ' '           Uinnland          1
     c     KOAIE         ifeq      '1'
     c     KOAIE         oreq      '2'
     c     KOAIE         oreq      '3'
     c                   move      'J'           Uinnland
     c                   end
      *
     C                   ENDSR
      *
     C***********************************************
     C     SØKDTA        BEGSR
     C***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
     C                   Z-ADD     1             UFLAGG
     C     LINNBR        IFEQ      8
     C     POSNBR        ANDGE     37
     C     POSNBR        ANDLE     40
     C                   CALL      'SYFA14B'
     C                   PARM                    WSAVD
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     33            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      9
     C     POSNBR        ANDGE     33
     C     POSNBR        ANDLE     40
     C                   MOVE      *BLANKS       USØKNV           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    WSKN
     C                   PARM                    UFIRM
     C                   PARM                    USØKNV           30
     C                   Z-ADD     10            LINNBR
     C                   Z-ADD     33            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C*
      * selger
N10  C     LINNBR        IFEQ      17
N10  C     POSNBR        ANDGE     33
N10  C     POSNBR        ANDLE     40
N10  C                   MOVE      *BLANKS       USØKNV           30
N10  C                   CALL      'SOEKKUN'
N10  C                   PARM                    WSSELG
N10  C                   PARM                    UFIRM
N10  C                   PARM                    USØKNV           30
N10  C                   Z-ADD     18            LINNBR
N10  C                   Z-ADD     33            POSNBR
N10  C                   GOTO      SLSØK
N10  C                   END
     C*
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
     C*
     C     SLSØK         ENDSR
     C*
     C*******************************************************
     C     OPDXML        BEGSR
     C*******************************************************
N64  C                   CLEAR                   XMLUFFR
     C                   MOVE      FIFIRM        XFFIRM
     C                   MOVEL     CPHONE        XFTYPE
     C                   MOVE      XFN           XFFN
N67  C                   MOVE      IDAG8         XFDTFA
     C                   MOVE      WAKN          XFKN
N25  C                   IF        XBRUT >= 0
     C                   MOVE      'F'           XFFK
N25  C                   ELSE
N25  C                   MOVE      'K'           XFFK
N25  C                   END
     C                   MOVE      UAVD          XFAVD
     C                   MOVE      'J'           XFSAML
     C                   MOVE      PVAL          XFVAL
     C                   MOVE      BETBET        XFBB
     C                   MOVE      BETTXT        XFBBT
     C                   MOVE      *BLANKS       XFBANK2
     C                   MOVE      *ZEROS        XN2               3 0
     C     1             DO        15            XN1               3 0
     C                   IF        ((XFB1(XN1) >= '0') AND (XFB1(XN1) <= '9'))
     C                   ADD       1             XN2
     C                   MOVE      XFB1(XN1)     XFB2(XN2)
     C                   END
     C                   ENDDO
     C                   MOVEL     XFBANK2       XFKT
N34  C                   IF        KOWAWB = 'K'
N34  C                   EVAL      XFKID = LIN20
N61  C                   EVAL      XFKT  = GIRO25
N34  C                   ELSE
     C                   EVAL      XFKID = WKID
     C                   EXSR      MOD10
     C                   CAT       KBAK:0        XFKID
N34  C                   END
N27  C   62              EVAL      XFKID = KID8
     C                   MOVE      XBRUT         XFTOT
S64  C*                  MOVE      MVAPRO        XFMS01
S64  C*                  MOVE      PVAL          XFMV01
S64  C*                  MOVE      XMVGR         XFMGN1
S64  C*                  MOVE      XMVGR         XFMGV1
N64  C                   Z-ADD     0             XN                3 0
N64  C     1             DO        11            XX
N64  C                   IF        WXMVAK(XX) <> ' '
N64  C                   ADD       1             XN
N64  C                   Z-ADD     WXMVAP(XX)    XFMS(XN)
N64  C                   MOVE      PVAL          XFMV(XN)
N64  C                   Z-ADD     WXGRL(XX)     XFMGN(XN)
N64  C                   Z-ADD     WXGRL(XX)     XFMGV(XN)
N64  C                   END
N64  C                   ENDDO
     C                   WRITE     XMLUFFR
      *
     C                   ENDSR
      *
     C***********************************************
     C     MVASR         BEGSR
     C***********************************************
     C*  Ved utgang av denne SR gir følgende variabler verdier FOR DENNE LINJA!!
      *    XPFNOK = beløp til print (i NOK /Valuta avh. av *IN71)
      *    MVAPRO = momssats 4,2 (eks 25,00)
      *    FITAXB = Momssats 4,4 (eks 0,250)
      *    XMVAK  = momskode på printet linje (* = Ja , ' '=N)
      *    NETTOF = Netto beløp Fritt
      *    NETTO  = Netto beløp Pliktig
      *    MVA    = Momsbeløp
      *    BRUTTO = Brutto
      * (variabelnavn lånt fra totalliste pr gebyr)
     C                   MOVE      *ZEROS        NETTOF                         Netto beløp Fritt
     C                   MOVE      *ZEROS        NETTO                          Netto beløp Pliktig
     C                   MOVE      *ZEROS        MVA                            Momsbeløp
     C                   MOVE      *ZEROS        BRUTTO                         Brutto
     C                   MOVE      *ZEROS        FITAXB
     c                   select
     c     SOKDM         Wheneq    'J'
     C                   MOVE      '*'           XMVAK
     c     SOKDM         Wheneq    'N'
     C                   MOVE      ' '           XMVAK
     c                   other
     C                   MOVE      SOKDM         XMVAK
     c                   endsl
      *
     C     FAKDM         IFEQ      ' '
     C     FAKDM         OREQ      'N'
      *  Momsfritt
     C                   ADD       XPFNOK        XMVAFR
     C                   z-add     XPFNOK        NETTOF
     C                   ELSE
      * DET ER moms  - sats kan varier - gr.lag mm må lagres i array
     C                   z-add     XPFNOK        NETTO
      * finn aktuell momssats
     C                   MOVE      FITAX         FITAXB
     C     FITAXD        IFNE      *ZEROS
     C     FITAX2        ANDNE     *ZEROS
     C     IDAG8         ANDLT     FITAXD
     C                   MOVE      FITAX2        FITAXB
     C                   END
s07  C*    KODWKY        CHAIN     KODWL01                            84
n07  C     KODWKY        CHAIN     KODWL01                            33
s07  C*    *IN84         IFEQ      *OFF
n07  C     *IN33         IFEQ      *OFF
     C     MVAAVI        DIV       100           FITAXB
     C                   ENDIF
     C     XPFNOK        MULT(H)   FITAXB        MVA
     C*
     C* legg ut i array på oppdragsnivå (finn samme eller første ledige..)
     C                   Z-ADD     1             XX                2 0
     C     TMVA          TAG
     C     WSMVAK(XX)    IFEQ      ' '
     C     WSMVAK(XX)    OREQ      XMVAK
     C                   MOVEL     XMVAK         WSMVAK(XX)
     C                   Z-add     MVAPRO        WSMVAP(XX)
     C                   ADD       XPFNOK        WSGRL(XX)
     C                   ADD       MVA           WSMVA(XX)
     C                   ELSE
     C                   ADD       1             XX
     C                   GOTO      TMVA
     C                   ENDIF
     C*
     C* legg ut i array på TOTALnivå    (finn samme eller første ledige..)
     C                   Z-ADD     1             XX                2 0
     C     TMVAT         TAG
     C     WXMVAK(XX)    IFEQ      ' '
     C     WXMVAK(XX)    OREQ      XMVAK
     C                   MOVEL     XMVAK         WXMVAK(XX)
     C                   Z-add     MVAPRO        WXMVAP(XX)
     C                   ADD       XPFNOK        WXGRL(XX)
     C                   ADD       MVA           WXMVA(XX)
     C                   ELSE
     C                   ADD       1             XX
     C                   GOTO      TMVAT
     C                   ENDIF
     C*
     C                   ENDIF
     C*
     C     XPFNOK        ADD       MVA           BRUTTO           11 2
     C*
     C                   ENDSR
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
      *
     C     TUKEY2        KLIST
     C                   KFLD                    DITUAV
     C                   KFLD                    DITUR
      *
     C     KODTPK        KLIST
     C                   KFLD                    KOPUNI
     C                   KFLD                    UAVD
     C                   KFLD                    KOPLNR
     C                   MOVE      'P'           KOPUNI
     C     FREETK        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    XXSKKO            1
     C                   KFLD                    XXFA00            7 0
     C                   MOVEL     'LK'          YLKUNI            3
     C     LKKEY         KLIST
     C                   KFLD                    YLKUNI
     C                   KFLD                    SYLAND
     C     FAKTK         KLIST
     C                   KFLD                    FAAVD
     C                   KFLD                    FAOPD
     C                   KFLD                    FALI
     C     FAK8K         KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    XXFAKT
     C                   KFLD                    WAKN
     C                   KFLD                    WAVAL8
     C     *LIKE         DEFINE    WAVAL         WAVAL8
     C     *LIKE         DEFINE    FAFAKT        XXFAKT
     C     *LIKE         DEFINE    FAFAKT        YYFAKT
      *
     C     FAK8K2        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    WSFN
n23  C     FAKTXTK       KLIST
n23  C                   KFLD                    SOAVD
n23  C                   KFLD                    SOOPD
     C                   KFLD                    SOLI
     C     SORTK         KLIST
     C                   KFLD                    YSOLNR
     C                   KFLD                    YSAMM
     C                   KFLD                    YSOAVD
     C                   KFLD                    YSOOPD
     C                   KFLD                    YSOSK
     C     HEADFK        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     KODGEK        KLIST
     C                   KFLD                    YGEUNI
     C                   KFLD                    YVK
     C     KODG2K        KLIST
     C                   KFLD                    YG2UNI
     C                   KFLD                    YVK
     C     KODOTK        KLIST
     C                   KFLD                    YOTUNI
     C                   KFLD                    HEOT
     C     KODFRK        KLIST
     C                   KFLD                    YFRUNI
     C                   KFLD                    HEFR
     C     KODTHK        KLIST
     C                   KFLD                    YHUNI
     C                   KFLD                    UAVD
     C     KODTAK        KLIST
     C                   KFLD                    YAUNI
     C                   KFLD                    WSAVD
     C     KODTA9        KLIST
     C                   KFLD                    YAUNI
     C                   KFLD                    UAVD
     C     KODTÅK        KLIST
     C                   KFLD                    YÅUNI
     C                   KFLD                    YDTPC
     C                   KFLD                    YDTPÅ
     C                   KFLD                    YDTPM
     C     ECMKEY        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    KUNDNR
     C                   KFLD                    WCSR
     C                   KFLD                    WC0065
     C     *LIKE         DEFINE    ECSR          WCSR
     C     *LIKE         DEFINE    EC0065        WC0065
     C                   MOVEL     'S'           WCSR
     C                   MOVEL     'INVOIC'      WC0065
     C     HODEK         KLIST
     C                   KFLD                    YNET
     C                   KFLD                    UAVD
     C     KUND1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WAKN
N01  C     VadrKey       KLIST
N01  C                   KFLD                    UFIRM
N01  C                   KFLD                    WAKN
N01  C                   KFLD                    YADRNR
N01  C                   z-sub     1             YADRNR            5 0
     C     KUNVAK        KLIST
     C                   KFLD                    XXUNIK
     C                   KFLD                    WAKN
     C                   KFLD                    WAVAL
     C     DELKEY        KLIST
     C                   KFLD                    WAKN
     C                   KFLD                    WAVAL
     C                   KFLD                    WAAVD
     C                   KFLD                    WAOPD
     C     CUFLDK        KLIST
     C                   KFLD                    KUNDNR
     C                   KFLD                    UDOKUM
     C     KODTWK        KLIST
     C                   KFLD                    KOWUNI
     C                   KFLD                    UAVD
     C     AVFLDK        KLIST
     C                   KFLD                    KOAKNR
     C                   KFLD                    UDOKUM
     C     SUMKEY        KLIST
     C                   KFLD                    WGUNIK
     C                   KFLD                    WGVK
     C                   KFLD                    WGKDM
     C                   MOVEL     ZJOBNR        WGUNIK
     C     FRIKEY        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    YFSKOD            3
     C     LGS06K        KLIST
     C                   KFLD                    XFN
     C                   KFLD                    WGVK
     C     KODWKY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WMVAKD
     C                   KFLD                    FAKDM
     C                   MOVE      *BLANKS       WMVAKD            2
      *
     C     KOVKEY        KLIST
     C                   KFLD                    KOVUNI
     C                   KFLD                    SAAVD
     C     EPOKEY        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    mail30
S57  C*                  KFLD                    SAKN
N57  C                   KFLD                    WAKN
     C     CUNDC03K      KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    XCTYPE           30
S57  C*                  KFLD                    SAKN
N57  C                   KFLD                    WAKN
     C     CUNDC03K2     KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    XCTYPE           30
     C                   KFLD                    WAKN
     C                   EVAL      XCTYPE = '*XML FAKTURA SAM'
     C     VATKey        KLIST
     C                   KFLD                    KUNDNR
     C                   KFLD                    XXPAID            5
      *
      * fix key for epostmottager
      *
     C     'fs'          CHAIN     ARKTXT                             33
     C  N33ARKSND        IFEQ      'J'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   end
      *
      *
     C                   MOVE      'V'           KOVUNI
     C                   MOVE      *BLANKS       WMVAKD            2
      *
     C                   MOVE      ' '           BLANK1            1
     C                   MOVE      'W'           KOWUNI
s51  C*                  MOVE      '********'    CPYTXT
     C     KODTWK        CHAIN     KOWR                               33
      * Kall fra arkiv = C
N43  c  N33uhod          ifeq      'C'
N43  c     uhod          oreq      'A'
N43  c     uhod          oreq      'F'
N43  c                   move      uhod          uhodc             1
N43  c                   move      KOWHOD        uhod
N52  C                   MOVE      'J'           cprint
N52   * *in55 er print
N52  C                   seton                                        55
N43  c                   end
     C     KOWKOM        COMP      'J'                                    59
      *
      * SKAL GIRO SKRIVES
      *
     C     UBBS          COMP      'N'                                    35
     C  N35KOWAWB        COMP      'K'                                    35
      *
      *
     C     *ENTRY        PLIST
     C                   PARM                    UPRANT            2
     C                   PARM                    UIN01             1
     C                   PARM                    UFNKOP            7 0
s52  C*                  PARM                    UEMAIL            1
      *
N47  C                   MOVE      *ZEROS        XFN
N66  C                   IF        UIN01 = 'X'
N66  C                   EVAL      UIN01 = '1'
N66  C                   MOVE      'J'           XOPDXML           1
N66  C                   ELSE
N66  C                   MOVE      'N'           XOPDXML
N66  C                   END
      *
s52  C*    UEMAIL        IFEQ      'J'
s52  C*                  MOVEL     EPOTXI        EPOTXT
s52  C*                  END
      *
      * 27 ON=KOPI..
      *
     C     UIN01         COMP      '1'                                    27
n56  c   27              seton                                        55
      *
     C                   MOVEL     'SAMLEF.S'    UDOKUM           10
     C                   MOVE      'PE'          UDOKUM
     C                   MOVEL     ZJOBNR        XXUNIK            6 0
      * Tøm WSAML for poster denne job/WS
     C                   EXSR      DELW
      *
N04  C                   MOVE      *ZEROS        FITAXB
     C                   MOVE      ' '           YSK               1
     C                   MOVE      *ZEROS        YOPD              7 0
     C                   MOVE      ' '           YST               1
     C                   MOVE      '<'           HAKE              1
     C                   Z-SUB     1             YSOLNR            3 0
     C                   MOVE      ' '           YSAMM             1
     C                   MOVE      *ZEROS        YSOAVD            4 0
     C                   MOVE      *ZEROS        YSOOPD            7 0
     C                   MOVE      ' '           YSOSK             1
     C                   MOVE      *ZEROS        YSKKN             8 0
     C                   MOVE      *ZEROS        YSKPOS            4 0
     C                   MOVE      'GE'          YGEUNI            2
     C                   MOVE      *BLANKS       YVK               3
     C                   MOVE      'G2'          YG2UNI            2
     C                   MOVE      'OTY'         YOTUNI            3
     C                   MOVE      'FR'          YFRUNI            2
     C                   MOVE      'H'           YHUNI             1
     C                   MOVE      'A'           YAUNI             1
     C                   MOVE      'Å'           YÅUNI             1
     C                   MOVE      *BLANKS       YNET              1
     C                   MOVE      *ZEROS        XPRANT            2 0
     C                   MOVE      *ZEROS        KUNDNR
     C                   MOVE      *ZEROS        TEFFNR
     C                   MOVE      *ZEROS        XNULL
     C                   MOVEL     'F A K T '    XF2NV            16
     C                   MOVE      'U R A   '    XF2NV
     C                   MOVEL     'I N V O '    XF2NV2           16
     C                   MOVE      'I C E   '    XF2NV2
     C     UYEAR         IFGT      50
     C     UYEAR         ADD       1900          IDAGÅ
     C                   ELSE
     C     UYEAR         ADD       2000          IDAGÅ
     C                   END
     C                   MOVE      UMONTH        IDAGM
     C                   MOVE      UDAY          IDAGD
     C                   MOVE      UYEAR         IDAGXÅ
     C                   MOVE      UMONTH        IDAGXM
     C                   MOVE      UDAY          IDAGXD
     C                   MOVE      *ZEROS        YDTPC             2 0
     C                   MOVE      *ZEROS        WSPER
     C                   MOVEL     '2BD10601'    XW77             16
     C                   MOVE      '00000154'    XW77
     C                   MOVEL     '2BD10601'    XW66             16
     C                   MOVE      '00000277'    XW66
     C                   MOVE      *ZEROS        WSFDAT
     C                   MOVE      *ZEROS        CBRUTT
     C                   MOVE      *ZEROS        FADATO
      *
     C                   READ      FIRM                                   33
N31   * hent verdi for evt fakturagebyr (ligger i innland..)
N31  C                   READ      FIRINL                                 33
     C*
     C* HENTER HEADINGTEKST TIL SPESIFIKASJONEN
     C*
     C                   Z-ADD     19            KOPLNR
     C                   Z-ADD     1             ANTKOS            2 0
     C     KODTPK        CHAIN     KOPR                               42
      * ikke printerstyring ved fax etc
s43  c*    uhod          ifeq      'F'
n43  c     uhodc         ifeq      'F'
s43  c*    uhod          oreq      'A'
n43  c     uhodc         oreq      'A'
s43  c*    uhod          oreq      'C'
n43  c     uhodc         oreq      'C'
     C                   SETON                                        68
     c                   move      *blanks       KOPFM
     c                   end
     C  N42KOPFM         IFNE      *BLANKS
     C     KOPFM         SETLL     KODTFM
     C*SIDE 1
     C     KOPFM         READE     KODTFM                                 42
     C  N42              MOVE      KFMT1         SFMT1            75
     C  N42              MOVE      KFMT2         SFMT2            75
     C*SIDE 2
     C     KOPFM         READE     KODTFM                                 42
     C  N42              Z-ADD     2             ANTKOS            2 0
     C  N42              MOVE      KFMT1         SFMT12           75
     C  N42              MOVE      KFMT2         SFMT22           75
     C                   END
     C*
     C* GÅR I RUNDER FOR LASERLOGIKK FOR SELVE FAKTURAEN
     C*
     C                   Z-ADD     4             KOPLNR
     C                   Z-ADD     0             ANTKOP            5 0
     C                   MOVE      *BLANKS       KFMT1
     C                   MOVE      *BLANKS       KFMT2
     C     KODTPK        CHAIN     KOPR                               42
     C     KOPLPI        COMP      8                                      60
     C     KOPLAS        COMP      'J'                                    61
     C  N61KOPLAS        COMP      'A'                                    61
     C  N61KOPLAS        COMP      'P'                                    61
     C     KOPLAS        COMP      'A'                                    63
N38  C     KOPLAS        IFEQ      'F'
N43  C     UHODC         OREQ      'F'
N43  C     UHODC         OREQ      'C'
N38  C                   MOVE      'P'           KOPLAS
N38  C                   END
     C     KOPLAS        COMP      'P'                                    64
      *
      * KIDLINJE
      *
     C     KOWAWB        COMP      'K'                                    65
s43  C*    UHOD          IFEQ      'F'
n43  C     UHODC         IFEQ      'F'
s05  C*    UHOD          OREQ      'A'
     c                   move      *blanks       KOPFM
     C                   SETOFF                                       606163
     C                   END
s43  C*    UHOD          IFEQ      'A'
n43  C     UHODC         IFEQ      'A'
s43  C*    UHOD          OREQ      'C'
n43  C     UHODC         OREQ      'C'
n05  C                   SETOFF                                       63
n05  c                   move      *blanks       KOPFM
N05  c                   end
     C     KOPFM         IFEQ      *BLANKS
     C                   SETON                                        42
     C                   Z-ADD     1             ANTKOP
     C                   END
      * FINN ANT KOPIER (POSTER I KODTFM) FOR Å KUNNE SLETTE I SISTE..
     C  N42              DO
      *
      * HENTER OCRSTYRING FØR OG ETTER H-LINJEN
      *
     C     KOPFM         IFNE      *BLANKS
     C     KOPFM         CHAIN     KODTFM                             42
     C  N42KFMOCR        IFNE      *BLANKS
     C     KFMOCR        CHAIN     KODTFM                             42
     C  N42              MOVE      KFMT1         OCRF             75
     C  N42              MOVE      KFMT2         OCRE             75
     C                   END
     C                   END
      *
     C     KOPFM         SETLL     KODTFM
     C     STFM0         TAG
     C     KOPFM         READE     KODTFM                                 42
     C  N42              ADD       1             ANTKOP
     C  N42              GOTO      STFM0
     C     ANTKOP        IFEQ      0
     C                   Z-ADD     1             ANTKOP
     C                   END
     C                   END
      *
      * HENT EGEN (BESTILLENDE) AVDELINGS  NAVN. OG GIRONR.
     C                   EXSR      AVDSR
      *
     C     KODTHK        CHAIN     KODTH                              33
     C     KOHFAK        COMP      'J'                                    47
      * Koden for hode kan være J(topp/bunntekst), T(kuntopp)
      * B(kun bunn) - videre setninger setter indikator (PRTF)
     C     UHOD          IFEQ      'J'
S14  C*    UHOD          OREQ      'F'
S14  C*    UHOD          OREQ      'A'
     C                   SETON                                        4446
     C                   ELSE
     C     UHOD          IFEQ      'T'
     C                   SETOFF                                       44
     C                   SETON                                        46
     C                   ELSE
     C     UHOD          IFEQ      'B'
     C                   SETON                                        44
     C                   SETOFF                                       46
     C                   END
     C                   END
     C                   END
      *
      * Henter hode i alle språkvarianter
     C   44
     COR 46
     COR 47              DO
      *** 44 PÅ SKRIVER UT BUNN     46 PÅ SKRIVER UT TOPP
s43  C*    UHOD          IFNE      'F'
n43  C     UHODC         IFNE      'F'
     C     HODEK         CHAIN     HODE                               33
     C                   ELSE
     C     HODEK         CHAIN     HODEFAX                            33
     C   33HODEK         CHAIN     HODE                               33
     C                   END
     C  N33              MOVE      HP            HO
     C  N33              MOVE      HOSTFR        XHOSTN            2
     C                   MOVEL     'E'           YNET
s43  C*    UHOD          IFNE      'F'
n43  C     UHODC         IFNE      'F'
     C     HODEK         CHAIN     HODE                               33
     C                   ELSE
     C     HODEK         CHAIN     HODEFAX                            33
     C   33HODEK         CHAIN     HODE                               33
     C                   END
     C  N33              MOVE      HP            HE
     C  N33              MOVE      HOSTFR        XHOSTE            2
     C                   MOVEL     'T'           YNET
s43  C*    UHOD          IFNE      'F'
n43  C     UHODC         IFNE      'F'
     C     HODEK         CHAIN     HODE                               33
     C                   ELSE
     C     HODEK         CHAIN     HODEFAX                            33
     C   33HODEK         CHAIN     HODE                               33
     C                   END
     C  N33              MOVE      HP            HT
     C  N33              MOVE      HOSTFR        XHOSTT            2
     C                   END
      *
      * OPPDATER TURNR/DATO PÅ ALLE OPPDRAG
     C                   CALL      'SYFA27D'
      *
     C                   MOVE      ' '           GMSPK             1            Ant. Sp.kop?
     C                   Z-ADD     1024          UCMDL            15 5
      *
     C                   Z-ADD     0             FADAFF
     C                   ENDSR
      *
      *
n23   ***********************************************
n23  C     HENTFTXT      BEGSR
n23   ***********************************************
n23  C     FAKTXTK       SETLL     FAKTXT
n23  C     FAKTXTK       READE     FAKTXT                                 91
n23  C                   DOW       *IN91 = *OFF
n23  C                   IF        FXVT <> *BLANKS
n23  C                   ADD       1             XN01
n23  C                   MOVE      FXVT          FTX(XN01)
n23  C                   END
n23  C     FAKTXTK       READE     FAKTXT                                 91
n23  C                   ENDDO
n23   *
n23  C                   ENDSR
      *
      ***********************************************
     C     KDTFM1        BEGSR
      ***********************************************
     C                   MOVE      XFFDTD        UDT1              2 0
     C                   MOVE      XFFDTM        UDT2              2 0
     C                   MOVE      XFFDTÅ        UDT3              2 0
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          XFFDTD
     C                   MOVE      UDT2          XFFDTM
     C                   MOVE      UDT3          XFFDTÅ
      *
     C                   MOVE      HEDTD         UDT1
     C                   MOVE      HEDTM         UDT2
     C                   MOVE      HEDTÅ         UDT3
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          XEDTOD
     C                   MOVE      UDT2          XEDTOM
     C                   MOVE      UDT3          XEDTOÅ
      *
     C                   ENDSR
      *
      ***********************************************
     C     KDTFM2        BEGSR
      ***********************************************
     C                   MOVE      HEDTD         UDT1
     C                   MOVE      HEDTM         UDT2
     C                   MOVE      HEDTÅ         UDT3
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          XEDTOD
     C                   MOVE      UDT2          XEDTOM
     C                   MOVE      UDT3          XEDTOÅ
      *
     C                   ENDSR
      *
      ***********************************************
     C     KDTFMT        BEGSR
      ***********************************************
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
      *
     C                   ENDSR
      ***********************************************
     C     XDTFMT        BEGSR
      ***********************************************
     C                   MOVE      WSFDAD        UDT1              2 0
     C                   MOVE      WSFDAM        UDT2              2 0
     C                   MOVE      WSFDAA        UDT3              2 0
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WSFDAD
     C                   MOVE      UDT2          WSFDAM
     C                   MOVE      UDT3          WSFDAA
      *
     C                   ENDSR
      *
      *
      ***********************************************
     C     TESTEQ        BEGSR
      ***********************************************
n23  C                   MOVE      *BLANKS       FTX
n23  C                   MOVE      *ZEROS        XN01              3 0
n23  C                   EXSR      HENTFTXT
     C     STEQ          TAG
     C                   READ      SORT                                   33
     C   33              DO
     C     *LOVAL        SETLL     SORT
     C                   READ      SORT                                   33
     C                   GOTO      UTEQSR
     C                   END
      *
     C     XOKDM         IFEQ      SOKDM
     C     XOSAMM        IFNE      ' '
     C     XOSAMM        IFEQ      SOSAMM
     C                   ADD       SOBELN        XOBELN
     C                   ADD       SOBELV        XOBELV
     C                   DELETE    SORTR
n23  C                   EXSR      HENTFTXT
     C                   GOTO      STEQ
     C                   END
     C                   END
     C     XOVK          IFEQ      SOVK
     C     XOVT          IFEQ      SOVT
     C     SOSAMM        ANDEQ     ' '
     C                   ADD       SOBELN        XOBELN
     C                   ADD       SOBELV        XOBELV
n23  C                   EXSR      HENTFTXT
     C                   DELETE    SORTR
     C                   GOTO      STEQ
     C                   ELSE
     C                   GOTO      UTEQ
     C                   END
     C                   ELSE
     C                   GOTO      UTEQ
     C                   END
     C                   ELSE
     C                   GOTO      UTEQ
     C                   END
     C     UTEQ          TAG
     C                   READP     SORT                                   33
     C     UTEQSR        TAG
     C                   Z-ADD     XOBELN        SOBELN
     C                   Z-ADD     XOBELV        SOBELV
     C                   ENDSR
      ***********************************************
     C     FRILIN        BEGSR
      ***********************************************
      * FRIE SØKEVEIER (KUN DE SOM HAR DOK.KODE LIK K/S/X  EL B)
      * SKRIVES IKKE!! NÅR KUNDEN HAR SPESIALLAYOUT(SPESIFIKE FELT)
      * (DA KAN JO INNTIL 5 FRIE SØKEV. INNGÅ I SPESIALEN-BLIR DOBBELT)
     C                   MOVE      *BLANKS       FSFORI
     C     *LIKE         DEFINE    FSKODE        FSFORI
     C     PROFI2        IFNE      'J'
     C     HEADFK        SETLL     FRISOK
     C     HEADFK        READE     FRISOK                                 91
     C     *IN91         DOWEQ     '0'
     C                   SORTA     DFS
     C     DFS(10)       IFNE      ' '
     C     XXSKKO        LOOKUP    DFS                                    91
     C  N91'B'           LOOKUP    DFS                                    91
     C     *IN91         IFEQ      '1'
     C     FSKODE        CHAIN     KODFRI                             91
     C     *IN91         IFEQ      '0'
     C     FSKODE        IFEQ      FSFORI
     C                   MOVE      *BLANKS       KFSOTX
     C                   END
     C                   MOVE      FSKODE        FSFORI
      * OVERFLOW??
     C   90              DO
     C                   SETON                                        88
     C   55              WRITE     KJØP1
     C                   ADD       1             PAGEPS
     C                   EXSR      KDTFM1
     C   55              WRITE     KJØP
     C                   EXSR      KDTFM1
     C     PROFIL        IFEQ      'J'
     C     CPSPH1        IFNE      *BLANKS
     C   55              WRITE     KJØPH1                                            ..PS
     C                   END
     C     CPSPH2        IFNE      *BLANKS
     C   55              WRITE     KJØPH2                                            ..PS
     C                   END
     C     CPSPH3        IFNE      *BLANKS
     C   55              WRITE     KJØPH3                                            ..PS
     C                   END
     C                   END
     C   55              WRITE     KJØPHX
     C                   SETOFF                                       90
     C                   END
     C   55              WRITE     KJØPFS
     C                   END
     C                   END
     C                   END
     C*
     C     HEADFK        READE     FRISOK                                 91
     C                   END
     C                   END
      *
      * FRIE LINJER OPPDRAG
      *
      *
     C   27              MOVE      XFN           XXFA00
     C  N27              MOVE      *ZEROS        XXFA00
     C     FREETK        SETLL     FREETXT2
     C     FRIST         TAG
     C     FREETK        READE     FREETXT2                               91
     C  N91              DO
     C  N27              MOVE      XFN           FRTFAK
     C                   UPDATE    FREETXTR
     C   90              DO
     C                   SETON                                        88
     C   55              WRITE     KJØP1
     C                   ADD       1             PAGEPS
     C                   EXSR      KDTFM1
     C   55              WRITE     KJØP
     C                   EXSR      KDTFM1
     C     PROFIL        IFEQ      'J'
     C     CPSPH1        IFNE      *BLANKS
     C   55              WRITE     KJØPH1                                            ..PS
     C                   END
     C     CPSPH2        IFNE      *BLANKS
     C   55              WRITE     KJØPH2                                            ..PS
     C                   END
     C     CPSPH3        IFNE      *BLANKS
     C   55              WRITE     KJØPH3                                            ..PS
     C                   END
     C                   END
     C   55              WRITE     KJØPHX
     C                   SETOFF                                       90
     C                   END
     C   55              WRITE     KJØP3
     C                   GOTO      FRIST
     C                   END
     C                   ENDSR
      *
     C***********************************************
     C     TTSR          BEGSR
     C***********************************************
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      'INV'         TTACTI
s52  c*    UEMAIL        IFEQ      'J'
n52  c     EPOSTKU       IFEQ      'J'
N13  C                   MOVE      'INM'         TTACTI
N13  C                   END
     C                   MOVE      ULDT          TTDATE
     C                   MOVE      XULTM         TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
     C                   MOVE      ZUSER         TTUSER
s16  C*                  MOVEL     'Invoiced'    TTINT1
s156 C*                  MOVE      ':'           TTINT1
s16  C*                  MOVE      KNAVN         TTINVN
s16  C*                  MOVE      'INVNBR:'     TTINT2
s16  C*                  MOVE      FIFN          TTINVR
n16  C                   MOVE      *blanks       TTTEXT
n16  c                   move      *blanks       FIFNA             7
n16  C                   eval      TTTEXT = 'Invoiced no:'
n16  c                   eval      FIFNA = %triml(%editc(FIFN:'Z'))
n16  C     TTTEXT        CAT       FIFNA:1       TTTEXT
n16  C     TTTEXT        CAT       KNAVN:1       TTTEXT
n19  C                   eval      TTTEXL = 'Faktura nr:'
n19  C     TTTEXL        CAT       FIFNA:1       TTTEXL
n19  C     TTTEXL        CAT       KNAVN:1       TTTEXL
     C                   WRITE     TRACKFR
      *
     C                   ENDSR
      *
     C*******************************************************
     C     KIDGIR        BEGSR
     C*******************************************************
S59  C*                  MOVE      *BLANKS       kidtxt            4
n59  C                   MOVE      *BLANKS       kidtxt
     C                   MOVE      *BLANKS       LIN20
s15  C*                  MOVE      *BLANKS       GIRO20
n15  C                   MOVE      *BLANKS       GIRO25
     C     XVAL          CHAIN     bagiro                             33
     C     *IN(33)       IFEQ      '1'
     C     KOWBBS        IFNE      ' '
s59  C*                  MOVE      'KID:'        kidtxt
N59  C                   EVAL      KIDTXT='KID:'
     C                   EXSR      MOD10
     C  N62              MOVEL     KWKID         LIN20
     C  N62              MOVE      KBAK          LIN20
     C   62              MOVEL     KID8          LIN20
     C                   end
     C                   MOVEL     'KONTONR:'    IBATXT            8
s15  C*                  MOVEL     XFBANK        GIRO20
n15  C                   MOVEL     XFBANK        GIRO25
     C                   ELSE
s59  C*                  MOVEL     'SWIFT:'      LIN20
N59  C                   EVAL      KIDTXT='SWIFT:'
     C                   MOVEL     'IBAN NO:'    IBATXT
s59  C*                  MOVE      BASWIF        LIN20
N59  C                   EVAL      LIN20=BASWIF
S15  C*                  MOVEL     BAGIRN        GIRO20
n15  C                   MOVEL     BAGIRN        GIRO25
     C                   END
N52  C     *in55         ifeq      '1'
N59  c                   movel     ktotkr        krore
N59  c                   move      KTOTØR        krore
     C  N73              WRITE     KIDLIN
     C   64              write     cvrpa2
N52  C                   end
     C                   ENDSR
     C*******************************************************
     C     FRISR         BEGSR
     C*******************************************************
     C     KODFTK        KLIST
     C                   KFLD                    XXSTKO            2
     C
     C* Standardtekst for kunde = 1. prioritet
     C     SYFR03        IFNE      *BLANKS
     C                   MOVE      SYFR03        XXSTKO
     C                   END
     C* Standardtekst for avdeling = 2. prioritet
     C*          - ULIKE FELT ALT ETTER SPRAAKKODE
     C     XXSTKO        IFEQ      *BLANKS
     C                   MOVE      HOSTFR        XXSTKO
     C     SPRAAK        IFEQ      'E'
     C                   MOVE      XHOSTE        XXSTKO
     C                   ELSE
     C     SPRAAK        IFEQ      'T'
     C                   MOVE      XHOSTT        XXSTKO
     C                   ELSE
     C                   MOVE      XHOSTN        XXSTKO
     C                   END
     C                   END
     C                   END
     C* Standardtekst for firma = 3. prioritet
     C*          - ULIKE FELT ALT ETTER SPRAAKKODE
     C     XXSTKO        IFEQ      *BLANKS
     C     SPRAAK        IFEQ      'E'
     C                   MOVE      FISTFE        XXSTKO
     C                   ELSE
     C     SPRAAK        IFEQ      'T'
     C                   MOVE      FISTFE        XXSTKO
     C                   ELSE
     C                   MOVE      FISTFN        XXSTKO
     C                   END
     C                   END
     C                   END
     c     xxstko        ifne      *blanks
     C     KODFTK        SETLL     KODTFT
     C     KODFTK        READE     KODTFT                                 33
     C     *IN(33)       DOWEQ     '0'
     C   55              write     prtfri
     c                   add       1             xant
     C     KODFTK        READE     KODTFT                                 33
     C                   END
     C                   END
     C                   ENDSR
     C*******************************************************
     C     TSTBRU        BEGSR
     C*******************************************************
      *
      * Sideskift kort/lang faktura...
      *
     C* N35N60   XANT      COMP 19                   88
      *
      * GIRO - IKKE 8LPI - IKKE LASER
     C  N35
     CANN60
     CANN61XANT          COMP      19                                 88        6 LPI/72-LIN
      *
      * GIRO - IKKE 8LPI - LASER
     C  N35
     CANN60
     CAN 61XANT          COMP      15                                 88        6 LPI/LASER
      *
      * GIRO - 8LPI
     C  N35
     CAN 60XANT          COMP      24                                 88        8 LPI
      *
      *  IKKE GIRO
     C   35XANT          COMP      33                                 88        FULL A4
      *
      *  KIDLINJEFAKTURA
s39  C*  65XANT          COMP      28                                 88        FULL A4
n39  C   65XANT          COMP      26                                 88        FULL A4
     C                   ENDSR
N24  C*******************************************************
N24  C     FRATILSR      BEGSR
N24  C*******************************************************
N24  C     HESDFK        KLIST
N24  C                   KFLD                    LKF               2
N24  C                   KFLD                    STF               5
N24  C     HESDTK        KLIST
N24  C                   KFLD                    LKT               2
N24  C                   KFLD                    STT               5
N24   *ordner først landkoder
N24   * import
N24  C     HEUR          IFEQ      'A'
N24  C     HEUR          OREQ      'C'
N24  C     HEUR          OREQ      'F'
N24  C                   MOVE      HELKA         LKF
N24  C                   MOVE      FILAND        LKT
N24  C                   END
N24   * eksport
N24  C     HEUR          IFEQ      'B'
N24  C     HEUR          OREQ      'D'
N24  C     HEUR          OREQ      'G'
N24  C                   MOVE      HELKA         LKT
N24  C                   MOVE      FILAND        LKF
N24  C                   END
N24   * transportdisponering
N24  C     HEUR          IFEQ      'H'
N24  C                   MOVE      HELKA         LKF
N24  C                   MOVE      HETRI         LKT
N24  C                   END
N24   *ordner deretter stedskoder
N24  C                   MOVE      HESDF         STF
N24  C                   MOVE      HESDT         STT
N24  C     hesdff        ifne      *blanks
N24  c                   move      hesdff        STF
N24  c                   end
N24  C     hesdvt        ifne      *blanks
s26  c*                  move      hesdvt        STF
s26  c                   move      hesdvt        STT
N24  c                   end
N24  c                   move      *blanks       fratil
N24  C     HESDFK        CHAIN     STED2D                             33
N24  C   33STF           CHAIN     STED2                              33
N24  C                   MOVEL     LKF           fratil
N24  C     FRATIL        CAT       '-':0         fratil
N24  C     FRATIL        CAT       STF:0         fratil
N24  C  N33FRATIL        CAT       ST2NVN:1      fratil
N24  C     FRATIL        CAT       '->':0        fratil
N24  C*
N24  C*
N24  C*** GETS DESTINATION
N24  C     HESDTK        CHAIN     STED2D                             33
N24  C   33HESDT         CHAIN     STED2                              33
N24  C     FRATIL        CAT       LKT:0         fratil
N24  C     FRATIL        CAT       '-':0         fratil
N24  C     FRATIL        CAT       STT:0         fratil
s26  C* N33STT           CAT       ST2NVN:1      fratil
n26  C  N33FRATIL        CAT       ST2NVN:1      fratil
N24  C                   ENDSR
N29  C*******************************************************
N29  C     TESTEP        BEGSR
N29  C*******************************************************
n29   *
n29   * utelate epost i visse tilfelle
N29   *
N29  c     testny        tag
N29   *
n29   * tester oppdragstype
N29   *
N29  c     copd          ifne      *blanks
N29  C     heot          LOOKUP    oty                                    34
n29  c     copdio        ifeq      'I'
n29  c  N34              seton                                        33
N29  c                   end
N29  c     copdio        ifeq      'O'
N29  c   34              seton                                        33
N29  c                   end
N29  c                   end
n29   *
N29   * tester avdeling
N29   *
N29  C     cavd          ifne      *zeros
n29  C     heavd         LOOKUP    av                                     34
N29  c     cavdio        ifeq      'I'
N29  c  N34              seton                                        33
N29  c                   end
n29  c     cavdio        ifeq      'O'
N29  c   34              seton                                        33
N29  c                   end
N29  c                   end
n29   *
N29   * les videre hvis 33 er satt på
N29   *
N29  c     *in33         ifeq      '1'
N29  c                   setoff                                       34
N29  c     epokey        reade     cundc03                                34
N29  c     *in34         ifeq      '0'
n29  c                   setoff                                       33
n29  c                   goto      testny
n29  c                   end
n29  c                   end
n29  c                   endsr
N57  C*******************************************************
N57  C     TESTEP0       BEGSR
N57  C*******************************************************
N57  C*
N57  C* er kunden epostkunde ?   ikke ved arkivering
N57  C*
N57  C                   MOVE      'N'           EPOSTKU           1
N57  C                   MOVE      'J'           CPRINT            1
N57  C*  55 = skal printes  INITIERES MED 55 PÅ
N57  C                   SETON                                        55
N57  C* ikke test hvis ikke arkiv ikke ved C=arkivering *in27=prøvekjøring
N57  C     arksnd        ifeq      'J'
N57  C     uhod          andne     'C'
N57  C     *in27         andne     '1'
N57  C* vanlig epostkunde
N57  C     epokey        CHAIN     cundc03                            33
N57  C  n33              exsr      testep
N57  C  n33              move      'J'           EPOSTKU
N57   *
N57   * Eventuelt  XML kunde
N57   *
N57  C     EPOSTKU       IFEQ      'N'
N57  C     CUNDC03K      CHAIN     CUNDC03                            33
s57  C  N33              MOVE      'J'           epostku
N57  C                   END
N57  C                   END
N57  C     CPRINT        IFEQ      'N'
N57  C                   SETOFF                                       55
N57  C                   END
N57  C                   ENDSR
n41   **********************************************************************
n41  c     faktgeb       begsr
n41   **********************************************************************
n41  C                   MOVE      FAVK          WGVK
n41  C                   MOVE      FAKDM         WGKDM
n41  C  N79
n41  CANN70              MOVE      KGENOT        WGTEXT
n41  C   70              MOVE      KGEENT        WGTEXT
n41  C   79              MOVE      KG2TYT        WGTEXT
n41   *
n41  c     FAKDM         ifne      ' '
n41  c     FAKDM         andne     'J'
n41  c     FAKDM         andne     'N'
n41  c                   eval      WGTEXT = %trim(WGTEXT)+ ' (' + FAKDM + ')'
n41  c                   end
n41  C                   MOVE      999           WGSORT
n41  C                   Z-add     NETTOF        WGNETF
n41  C                   Z-add     NETTO         WGNETT
n41  C                   Z-ADD     MVA           WGMVA
n41  C                   Z-ADD     BRUTTO        WGBRUT
n41  C                   WRITE     WSAMGER
n41  C                   ENDSR
      *
     OFAKTR     E            OPDFAK
     O                       FAOPKO
     O                       FAKDA
     O                       FAKUNR
     O                       FAFAKT
     O                       FACC
     O                       FAÅR
     O                       FAMND
     O                       FADATO
     O                       FADAFF
     O                       FACURI
N09  O                       FACD22
