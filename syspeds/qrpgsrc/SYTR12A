      **************************************************************
      *** PROGRAM SKAL ARBEIDE MED TRANSPORTØRAVREGNING          ***
      ***        AKKUMULERE EN TUR                               ***
      **************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 Ved INGEN B-linjer/dummy 0-linje hruk OPPDRAGETS sts (nullfaktura?)
10XXX * 02 sh  PTF10 ny parameter syge03
********************************************************************
      *
     FTRAVH     O  A E           K DISK
     FTRAVH1    UF   E           K DISK
     F                                     RENAME(TRAVHR:TRVH1R)
     FTRAVV     UF A E           K DISK
     FKOSBU12   IF   E           K DISK
     FKOSBU2    IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSB2R)
     FKOSTA     IF   E           K DISK
     FTURER     IF   E           K DISK
     FHEAD11    IF   E           K DISK
     FHEADF     IF   E           K DISK
     F                                     RENAME(HEADFR:HEAR)
     FFAK2      IF   E           K DISK
     FKODTGE    IF   E           K DISK
     FKODTGI    IF   E           K DISK
     FVALUL01   IF   E           K DISK
     FTRAN      IF   E           K DISK
     FTRAB      IF   E           K DISK
     FFIRM      IF   E           K DISK
     FFIRTR     IF   E           K DISK
     D                 DS
     D  BUTXT                  1     35
     D  BUTX_20                1     20
     D  BUTX_7                29     35
     D* DS FOR "FRITEKST" VED HOVED OPPDRAG  (TYPE B)
     D                 DS
     D  OPDDS                  1     35
     D  FMOTNA                 1     10
     D  VTX                   12     13
     D  HEVKTA                14     18
     D  XXVKT1                14     14
     D  XXVKT2                15     15
     D  XXVKT3                16     16
     D  XXVKT4                17     17
     D  LTX                   20     21
     D  HELM1                 22     23
     D  XXLM1                 22     22
     D  KOMMA                 24     24
     D  HELM2                 25     26
     D  CTX                   28     29
     D  TRM31                 30     32
     D  XXM31                 30     30
     D  XXM32                 31     31
     D  KOMMA2                33     33
     D  TRM32                 34     35
     D* DS FOR "FRITEKST" VED INNH./UTKJ. OPPDRAG  (TYPE C/D))
     D                 DS
     D  OPIUDS                 1     35
     D  IUTX                   1     10
     D  HEAVD                 12     15  0
     D  STREK                 16     16
     D  HEOPD                 17     23  0
     D  HEHAWB                25     33
      *
     C                   EXSR      INIT
     C*IKKE AKKUMULER PÅ NY DERSOM BESKYTTET ELLER AVREGNET
     C*  99 ON = STATUS ELLER "I ARBEID" ULIK BLANK IKKE REGENERER
     C*  98 ON = UGYLDIG TURNUMMER
     C  N99
     CANN98              EXSR      AKKUM
     C  N98UVIS          IFEQ      'J'                                          VEDLIKEH.
     C     UVIS          OREQ      'S'                                          KUN SPØRR.
     C     UVIS          IFEQ      'S'                                          VEDLIKEH.
     C                   MOVE      'J'           XSPØR             1
     C                   ELSE
     C                   MOVE      'N'           XSPØR             1
     C                   END
     C                   MOVE      ' '           XF12              1
     C                   CALL      'SYTR12B'
     C                   PARM                    TUAVD
     C                   PARM                    TUPRO
     C                   PARM                    XSPØR
     C                   PARM                    XF12
      * VED RETUR FRA VISNING AV SIMULERT AVREGNING- ENKELTOPPDRAG - RYDD
     C     TUPRO         iflt      *zeros
     C     TURERK        CHAIN     TRAVH1                             33
     C   33              MOVE      ' '           THST
     C   33              MOVE      ' '           THSTAR
     C   33              EXSR      DELDET                                       *EVT- GAMLE
     C  N33THST          IFEQ      ' '
     C     THSTAR        ANDEQ     ' '
     C                   DELETE    TRVH1R
     C                   EXSR      DELDET
     C                   END
     C                   END
     C                   END
     C*
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     AKKUM         BEGSR
     C***********************************************
     C*
     C********************************************************
     C*                                                      *
     C*         AVTALTE TRANSPORTØRHONORAR..????....         *
     C*    LEGG ALLTID UT POST - MEN BELØP KAN VÆRE 0        *
     C********************************************************
     C* HENT AVTALT HONORAR DIREKTE FRA TUREN...
     C* (SAMME BELØP LIGGER PÅ BUDSJETT/REKV.FIL - MEN KUN FOR Å LETTE
     C* ATTESTASJON AV INNGÅENDE LEV.FAKTURA FRA TRANSPORTØREN)
     C* LEGG UT DETALJPOST
     C                   MOVE      'A'           TVTYP
     C                   Z-ADD     1             THAVTA
     C                   Z-ADD     1             TVLNR
     C                   MOVE      TUTREF        TVBNRB
     C                   MOVE      *ZEROS        TVBNRK
     C                   MOVE      *ZEROS        TVOAVD
     C                   MOVE      *ZEROS        TVOPD
     C                   MOVE      *BLANKS       TVVK
     C                   MOVE      *BLANKS       TVTXT
     C     TUTAKO        IFEQ      'A'
     C                   MOVEL     '*AVTALT '    TVTXT1           16
     C                   MOVE      'HONORAR*'    TVTXT1
     C                   ELSE
     C                   MOVEL     '*ESTIM. '    TVTXT1           16
     C                   MOVE      'HONORAR*'    TVTXT1
     C                   END
     C                   MOVEL     TVTXT1        TVTXT
     C                   MOVE      *ZEROS        TVPRO
     C                   MOVE      TUTAKO        TVAVES
     C                   MOVE      TUST          TVOPKO
     C                   MOVE      TUSTEF        TVFRA
     C                   MOVE      TUSTET        TVTIL
     C     TUTVAL        IFNE      *BLANKS
     C                   MOVE      TUTVAL        TVVAL
     C                   ELSE
     C                   MOVE      FICURR        TVVAL
     C                   END
     C                   Z-ADD     TUTBEL        TVBL
     C     TVVAL         IFNE      FICURR
     C                   EXSR      VALUT
     C                   ELSE
     C                   Z-ADD     TVBL          TVBLLB
     C                   Z-ADD     TVBL          TVBLL
     C                   END
     C                   EXSR      DECI1
     C                   WRITE     TRAVVR
     C* OPPDATER SUMPOST FOR TUREN
     C                   ADD       TVBLL         THAVT
     C     TUTAKO        IFEQ      'A'
     C                   ADD       TVBLL         THTOT
     C                   END
     C*
     C*
     C*
     C********************************************************
     C*                                                      *
     C*   INGEN AVTALTE TRANSPORTØRHONORAR..........         *
     C*                                                      *
     C********************************************************
     C*
     C* NÅR AVTALE IKKE FANTES-GÅ PÅ:
     C*                              -BRUTTO UTFAKT MINUS PROVI.
     C* (I-LINJER LIGGER MED NETTO KOSTN - IKKE TREKK PROVISJON)       -
     C*                              -FORFRAKT FRA DUPOPPDRAG
     C*                              -ETTERFRAKT FRA DUPOPDRAG
     C*  DERSOM UTFØRENDE AV DUP.OPPDRAG HAR ANNEN PROV SATS ENN DEN
     C*  SOM AVREGNES HER VIL TRANSPORTØR PÅ HOVEDOPPDRAGET FÅ
     C*  FOR MYE/FOR LITE (HAN FÅR JO SIN RATE PÅ HELE KUNDEOPPDRAGET
     C*  MINUS NETTO DUP-KOSTNAD) MEN HAN UTFØRER BARE EN DEL
     C*                              -REKVISISJ. BELASTBAR. TRANSP.
     C*                              +REKVISISJ. HVOR TRANSPORTØREN ER DEN
     C*                               UTFØRENDE PART (GODSKRIVES)
     C*                            +/-JUSTERINGER.
     C*
     C* ----------------------------------------------------
     C* AKKUMULER ALLE GEBYR SOM ER DEFINERT MED 'T' "KGEAVR"
     C* """"""""""""""""""""""""""""""""""""""""""""""""""""
     C*
     C                   MOVE      'N'           ETTLEST           1
     C* FINN ALL OPPDRAG PÅ TUREN
     C     HEA11K        SETLL     HEAD11
     C     HETAG1        TAG
      * ELLER BARE ETT..
     C     UOPD          IFNE      *ZEROS
     C     ETTLEST       CABEQ     'J'           UTAKKU
     C                   MOVE      UOAVD         HEAVD
     C                   MOVE      UOPD          HEOPD
     C     FAK2K         CHAIN     HEADF                              34
     C                   MOVE      'J'           ETTLEST
     C                   ELSE
     C     HEA11K        READE     HEAD11                                 34
     C                   END
     C* MÅ VÆRE TRANSP.MODUL OPPDRAG / HEADTR MÅ FINNES
     C  N34HEUR          COMP      'H'                                3737
     C  N34
     CAN 37              GOTO      HETAG1
     C     *LIKE         DEFINE    HEAVD         HEAVDT
     C     *LIKE         DEFINE    HEOPD         HEOPDT
     C                   MOVE      HEAVD         HEAVDT
     C                   MOVE      HEOPD         HEOPDT
     C* FOR ALLE -HEAD
     C                   MOVE      HESDF         TVFRA
     C                   MOVE      HESDT         TVTIL
      * Dersom avtale om faktsum pr sending i.h.t.avtale - hent fra KOSBU
     c     VMINCR        IFEQ      4
     c     VMINCR        oreq      5
     C     *in34         IFEQ      *OFF
     C                   move      'N'           UMID              1
     C                   call      'SYTR12AS'
     C                   parm                    HEAVDT
     C                   parm                    HEOPDT
     C                   PARM                    TUPRO
     C                   PARM                    VMTRAN
     C                   PARM                    VMTRKU
     C                   PARM                    VMTRLE
     C                   PARM                    VMINCR
     C                   PARM                    UMID                           MIDLERTIDIG
     C                   PARM                    SBEL             13 2          retur beløp
     C                   PARM                    UBNR              7 0          Når EN er skapt
     c                   EXSR      SrBuTv
     c                   goto      HETAG1
     c                   else
     c                   goto      UTAKKU
     c                   end
     c                   end
     C  N34              DO
     C* LES ALLE FAKTURALINJENE PÅ OPPDRAGET
     C     FAK2K         SETLL     FAK2
     C                   SETOFF                                           35
     C                   Z-ADD     0             ANTAVL            2 0
     C     FATAG1        TAG
     C                   READ      FAK2                                   35
     C  N35FAAVD         COMP      HEAVD                              3535
     C  N35FAOPD         COMP      HEOPD                              3535
     C  N35              DO
     C     FAKDA         IFEQ      'D'                                          *SLETTET?
     C                   GOTO      FATAG1
     C                   END
     C     FAKDA         IFEQ      'K'                                          *KOSTNAD?
     C                   GOTO      FATAG1
     C                   END
     C* GEBYRET DEFINE T TIL Å VÆRE MED PÅ TRANSP.AVREGN
     C     KODGEK        CHAIN     KODTGE                             36
     C   36              MOVE      ' '           KGEAVR
     C* ILINJER SKAL ALLTID MEDTAS -I.H.T. KINGSRØD-ØNSKE 23.04.92
     C* (ILINJER VIL VÆRE REDUKSJON/ØKING AV ET ENNET GEBYR
     C* - VANLIGVIS FRAKT - SOM ALT ER TATT MED MED FULLT (FEIL) BELØP)
      * (MEN ETTER DUP PÅ DUP ER DET KUN NÅR PÅ HOVEDOPPDRAG!!!!
     C     FASK          IFEQ      'I'
     C     TRSLAG        ANDEQ     'HO'
     C                   MOVE      'T'           KGEAVR
     C                   END
     C     KGEAVR        IFNE      'T'
     C                   GOTO      FATAG1
     C                   END
     C* I-LINJER MED FAKDA = I  ER LAGT INN PÅ HOVEDOPPDRAG UNDER OVERFØRING
     C* AV DUPOPPDRAG (FOR Å KUNNE FINNE HOVEDOPPDRAGS NETTO VED F.EKS QUERY)
     C* DISSE BELASTNINGENE TAR AVREGNINGEN HENSYN TIL VED Å GÅ RETT PÅ DUPOPD.
     C* (PÅ DENNE MÅTEN BLIR LOGIKK ENHETLIG UAVHENGIG AV OM DUP.OPD. OVERFØRT.)
     C* --- FRA HØSTEN 93 ER DET LOV MED "DUP PÅ DUP" ---- DA KAN OGSÅ
     C* DUPOPPDRAG HA STATISTISKE KOSTNADSLINJER (FAKDA I)--MEDTAS IKKE
     C     FASK          IFEQ      'I'
     C     FAKDA         ANDEQ     'I'
     C                   GOTO      FATAG1
     C                   END
     C* ILINJER PÅ HOVEDOPPDRAG KAN VÆRE F.EKS FORTOLLING SOM ER INKALKULERT
     C* I FRAKTPRISEN (SKAL MED ANDRE ORD TREKKES PÅ TRANSP.AVREGN.) DISSE
     C* GEBYRENE LIGGER MED BYTT=J I INTENKONTERINGSREGISTER.
     C* DERSOM OVERFØRT ER BYTT GJORT - NEG FORTEGN OK.
     C* DERSOM IKKE OVERFØRT - SNU FORTEGN PÅ VARELINJA
     C*
     C* MOTSATT (BYTT=N) PÅ OPPDRAG ER NÅR LINJEN REPRESENTERER EN TILLEGS-
     C* TJENESTE SOM ER UTFØRT (INTERNT). INTERN OVERFØRING INNEN AVD.M.M
     C* FIXES AV SYTR35, MEN TRANSPORTØREN SKAL GODSKRIVES BELØPET.
     C* LINJENE LIGGER PÅ HOVEDOPPDRAG MED POS  FORTEGN. SKAL IKKE SNUS.
     C* (DET ER DEN AVDELINGEN SOM SKAL HA PENGENE SOM TASTER EN INTERNFAKTURA
     C* "MOT" DENAVDELIGEN SOM SKAL TREKKES.   - POSITIVT FORTEGN)
     C     GEBIK         CHAIN     KODTGI                             12
     C     *IN12         IFEQ      '1'
     C     GEBIK2        CHAIN     KODTGI                             12
     C     *IN12         IFEQ      '1'
     C     GEBIK3        CHAIN     KODTGI                             12
     C                   END
     C                   END
     C   12              MOVE      'N'           KGIBYT
     C     FASK          IFEQ      'I'
     C     TRSLAG        ANDEQ     'HO'
     C     KGIBYT        ANDEQ     'J'
     C     FAOPKO        ANDLT     'O'
     C                   MULT      -1            FABELN
     C                   END
     C* GBEYR SOM SKAL MED I AVREGNING ER FUNNET
     C                   ADD       1             ANTAVL
     C*
      * Hvis Grunn-pris benyttes skal den gjelde såfremt .....
      * (men kun på HOVED FRAKT LINJEN (lin.nr 0) og ikke ved DUP)
     c     GRPRJN        ifeq      'J'
     c     FALI          andeq     0
     c     FASK          andne     'I'
     c                   exsr      GRPRIS
     c     GRPRBL        ifne      *zeros
     C                   Z-ADD     GRPRBL        FABELN
     c                   end
     c                   end
      *
     C                   Z-ADD     FABELN        TVBLLB
     C                   MOVE      *ZEROS        TBPRO
      * NÅR NETTO PRISING AV ININJER SKAL PROV IKKE TREKES UT.
     C     FASK          IFEQ      'I'                                          *ORDINÆRT OPPDR.
     C     FIBRUT        ANDEQ     'N'                                                      PDR.
     C* VED NETTO-BASERTE I-LINJER SOM ER OVERFØRT, FINN RETT NETTOBEL.
     C* DUPOPPDRAG HAR FÅTT PROV. PÅPLUSSET-NETTO I FABELU
     C* ANDRE TEKK (TERMINAL M.M.) LIGGER UFORANDRET I FABELN(FABELU=0)
     C     FAOPKO        IFGE      'O'                                           I-LINJE ER NETTO
     C     FABELU        IFNE      *ZEROS                                        I-LINJE ER NETTO
     C                   Z-ADD     FABELU        FABELN                          AVTALT. TRANSP
     C                   END
     C                   Z-ADD     FABELN        TVBLLB
     C                   END
     C                   GOTO      SKIPPR
     C                   END
     C* NÅR EGEN TUR SKAL VISES SKAL PROV IKKE TREKES UT.
     C     VMINCR        IFEQ      2
     C                   GOTO      SKIPPR
     C                   END
      *
      * FINN PROVISJONSSATS..
     C* Transp. har egen avtale om prov.sats.....
     C                   MOVE      TUKNT2        YYTNR
     C                   EXSR      PROV
     C     TBPRO         IFEQ      *ZEROS
     C* ... eller generell prov.sats benyttes ...
     C                   MOVE      *ZEROS        YYTNR
     C                   EXSR      PROV
     C                   END
     C* TREKK FRA PROVISJON (EKS: SATS = 10,0 % --> 90 % ER KOSTNAD)
     C*
     C     100           SUB       TBPRO         XPRFAK            7 4
     C                   DIV       100           XPRFAK
     C                   MULT      XPRFAK        FABELN
     C     SKIPPR        TAG
     C* LEGG UT DETALJPOST
     C                   MOVE      'B'           TVTYP
     C                   ADD       1             THBRTA
     C                   MOVE      THBRTA        TVLNR
     C                   MOVE      *ZEROS        TVBNRB
     C                   MOVE      *ZEROS        TVBNRK
     C                   MOVE      FAAVD         TVOAVD
     C                   MOVE      FAOPD         TVOPD
     C                   MOVE      FAVK          TVVK
     C                   EXSR      OPPDS
     C                   MOVE      OPDDS         TVTXT
     C                   MOVE      TBPRO         TVPRO
     C     FASK          IFEQ      'E'
     C     FASK          OREQ      'I'
     C                   MOVE      FASK          TVAVES
     C                   ELSE
     C                   MOVE      *BLANKS       TVAVES
     C                   END
     C                   MOVE      FAOPKO        TVOPKO
     C* FABELN ER ALLTID I LOKAL VALUTA
     C                   MOVE      FICURR        TVVAL
     C                   Z-ADD     FABELN        TVBL
     C                   Z-ADD     FABELN        TVBLL
     C                   EXSR      DECI1
     C                   WRITE     TRAVVR
     C* OPPDATER SUMPOST FOR TUREN
     C                   ADD       TVBLL         THBRT
     C     TUTAKO        IFNE      'A'
     C                   ADD       TVBLL         THTOT
     C                   END
     C* FLERE FAKTLINJER PÅ DETTE OPPDRAGET
     C                   GOTO      FATAG1
     C                   END
     C*
     C* LEGG UT VARNING DERSOM INGEN AVREGNINGSLINJER
     C     ANTAVL        IFEQ      *ZEROS
     C                   MOVE      'B'           TVTYP
     C                   ADD       1             THBRTA
     C                   MOVE      THBRTA        TVLNR
     C                   MOVE      *ZEROS        TVBNRB
     C                   MOVE      *ZEROS        TVBNRK
     C                   MOVE      HEAVD         TVOAVD
     C                   MOVE      HEOPD         TVOPD
     C                   MOVE      *BLANKS       TVVK
     C                   EXSR      OPPDS
     C                   MOVE      OPDDS         TVTXT
     C                   MOVE      *ZEROS        TVPRO
     C                   MOVE      TUKNT2        YYTNR
     C                   EXSR      PROV
     C     TBPRO         IFEQ      *ZEROS
     C                   MOVE      *ZEROS        YYTNR
     C                   EXSR      PROV
     C                   END
     C                   MOVE      TBPRO         TVPRO
     C                   MOVE      *BLANKS       TVAVES
S01  C*                  MOVE      ' '           TVOPKO
N01  C                   MOVE      HEST          TVOPKO
     C                   MOVE      FICURR        TVVAL
     C                   MOVE      *ZEROS        TVBL
     C                   MOVE      *ZEROS        TVBLLB
     C                   MOVE      *ZEROS        TVBLL
     C                   WRITE     TRAVVR
     C                   END
      *
      *   VAR DET NOEN HENTE-OPPDRAG MED DIREKTE-GODSKRIVING???
      *
     C*
     C*
     C* ----------------------------------------------------
     C* TREKK FRA ALLE BELASTNINGER PÅ FORFRAKTOPPDRAG
     C* """"""""""""""""""""""""""""""""""""""""""""""""""""
     C     TROPD1        IFNE      *ZEROS
     C                   MOVE      TRAVD1        HEAVD                           KAN HA DUPLIKATER
     C                   MOVE      TROPD1        HEOPD
     C                   MOVE      HESDF         TVFRA                          *HOV OP.FRA
     C                   MOVE      HESDFF        TVTIL                          *HOV OP.VIA1
     C* LES ALLE FAKTURALINJENE PÅ OPPDRAGET
     C     FAK2K         SETLL     FAK2
     C                   SETOFF                                           35
     C                   Z-ADD     0             ANTAVL            2 0
     C     FATAG2        TAG
     C                   READ      FAK2                                   35
     C  N35FAAVD         COMP      TRAVD1                             3535
     C  N35FAOPD         COMP      TROPD1                             3535
     C  N35              DO
     C* GEBYRET DEFINERT TIL Å VÆRE MED PÅ TRANSP.AVREGN
     C     FAKDA         IFEQ      'D'                                          *SLETTET?
     C                   GOTO      FATAG2
     C                   END
     C     FAKDA         IFEQ      'K'                                          *KOSTNAD?
     C                   GOTO      FATAG2
     C                   END
     C     FAKDA         IFEQ      'I'
     C                   GOTO      FATAG2                                       "DUP-PÅ-DUP"
     C                   END
     C     KODGEK        CHAIN     KODTGE                             36
     C   36              MOVE      ' '           KGEAVR
     C     KGEAVR        IFNE      'T'
     C                   GOTO      FATAG2
     C                   END
      * KAN VÆRE EKSTERN BELASTNING PÅ DUP-OPPDRAG, SKAL IKKE TREKKES
     C     FASK          IFNE      'I'
     C                   GOTO      FATAG2
     C                   END
     C* GBEYR SOM SKAL MED I AVREGNING ER FUNNET
     C                   ADD       1             ANTAVL
     C* LEGG UT DETALJPOST
     C                   MOVE      'C'           TVTYP
     C                   ADD       1             THINHA
     C                   MOVE      THINHA        TVLNR
     C                   MOVE      *ZEROS        TVBNRB
     C                   MOVE      *ZEROS        TVBNRK
     C                   MOVE      HEAVDT        TVOAVD
     C                   MOVE      HEOPDT        TVOPD
     C                   MOVE      FAVK          TVVK
     C                   MOVE      ITX           IUTX
     C                   MOVE      OPIUDS        TVTXT
     C                   MOVE      *ZEROS        TVPRO
     C     FASK          IFEQ      'E'
     C                   MOVE      'E'           TVAVES
     C                   ELSE
     C                   MOVE      *BLANKS       TVAVES
     C                   END
     C                   MOVE      FAOPKO        TVOPKO
     C* FABELN ER ALLTID I LOKAL VALUTA
     C                   MOVE      FICURR        TVVAL
     C                   MOVE      *ZEROS        TBPRO
     C     FAOPKO        IFGE      'O'
     C                   Z-ADD     FABELU        FABELN
     C                   END
     C                   Z-SUB     FABELN        TVBLLB
      * TREKK PROVISJON UT AV BRUTTO-BASERT I-LINJE-TREKK???
     C     FIBRUT        IFNE      'B'
     C                   GOTO      SKIPP2
     C                   END
     C* NÅR EGEN TUR SKAL VISES SKAL PROV IKKE TREKES UT.
     C     VMINCR        IFEQ      2
     C                   GOTO      SKIPP2
     C                   END
      * FINN PROVISJONSSATS..
     C* Transp. har egen avtale om prov.sats.....
     C                   MOVE      TUKNT2        YYTNR
     C                   EXSR      PROV
     C     TBPRO         IFEQ      *ZEROS
     C* ... eller generell prov.sats benyttes ...
     C                   MOVE      *ZEROS        YYTNR
     C                   EXSR      PROV
     C                   END
      * TREKK UT PROV
     C     100           SUB       TBPRO         XPRFAK            7 4
     C                   DIV       100           XPRFAK
     C                   MULT      XPRFAK        FABELN
      *
     C     SKIPP2        TAG
     C                   MOVE      TBPRO         TVPRO
     C                   Z-SUB     FABELN        TVBL
     C                   Z-SUB     FABELN        TVBLL
     C                   EXSR      DECI1
     C                   WRITE     TRAVVR
     C* GEBYRET SKAL TREKKES - OPPDATER SUMPOST
     C                   ADD       TVBLL         THINH
     C     TUTAKO        IFNE      'A'
     C                   ADD       TVBLL         THTOT
     C                   END
     C* FLERE FAKTLINJER PÅ DETTE OPPDRAGET
     C                   GOTO      FATAG2
     C                   END
     C*
     C* LEGG UT VARNING DERSOM DUP-OPPDRAG MEN INGEN AVREGNINGSLINJER
     C     ANTAVL        IFEQ      *ZEROS
     C                   MOVE      'C'           TVTYP
     C                   ADD       1             THINHA
     C                   MOVE      THINHA        TVLNR
     C                   MOVE      *ZEROS        TVBNRB
     C                   MOVE      *ZEROS        TVBNRK
     C                   MOVE      HEAVDT        TVOAVD
     C                   MOVE      HEOPDT        TVOPD
     C                   MOVE      *BLANKS       TVVK
     C                   MOVE      ITX           IUTX
     C                   MOVE      OPIUDS        TVTXT
     C                   MOVE      *ZEROS        TVPRO
     C                   MOVE      *BLANKS       TVAVES
     C                   MOVE      ' '           TVOPKO
     C                   MOVE      FICURR        TVVAL
     C                   MOVE      *ZEROS        TVBL
     C                   MOVE      *ZEROS        TVBLLB
     C                   MOVE      *ZEROS        TVBLL
     C                   WRITE     TRAVVR
     C                   END
     C*
     C                   END
     C*
     C* ----------------------------------------------------
     C* TREKK FRA ALLE BELASTNINGER PÅ VIDEREFRAKTOPPDRAG
     C* """"""""""""""""""""""""""""""""""""""""""""""""""""
     C     TROPD2        IFNE      *ZEROS
     C                   MOVE      TRAVD2        HEAVD
     C                   MOVE      TROPD2        HEOPD
     C                   MOVE      HESDVT        TVFRA                          *HOV OP.VIA2
     C                   MOVE      HESDT         TVTIL                          *HOV OP.TIL
     C* LES ALLE FAKTURALINJENE PÅ OPPDRAGET
     C     FAK2K         SETLL     FAK2
     C                   SETOFF                                           35
     C                   Z-ADD     0             ANTAVL            2 0
     C     FATAG3        TAG
     C                   READ      FAK2                                   35
     C  N35FAAVD         COMP      TRAVD2                             3535
     C  N35FAOPD         COMP      TROPD2                             3535
     C  N35              DO
     C* GEBYRET DEFINERT TIL Å VÆRE MED PÅ TRANSP.AVREGN
     C     FAKDA         IFEQ      'D'                                          *SLETTET?
     C                   GOTO      FATAG3
     C                   END
     C     FAKDA         IFEQ      'K'                                          *KOSTNAD?
     C                   GOTO      FATAG3
     C                   END
     C     FAKDA         IFEQ      'I'
     C                   GOTO      FATAG3                                       "DUP-PÅ-DUP"
     C                   END
     C     KODGEK        CHAIN     KODTGE                             36
     C   36              MOVE      ' '           KGEAVR
     C     KGEAVR        IFNE      'T'
     C                   GOTO      FATAG3
     C                   END
      * KAN VÆRE EKSTERN BELASTNING PÅ DUP-OPPDRAG, SKAL IKKE TREKKES
     C     FASK          IFNE      'I'
     C                   GOTO      FATAG3
     C                   END
     C* GBEYR SOM SKAL MED I AVREGNING ER FUNNET
     C                   ADD       1             ANTAVL
     C* LEGG UT DETALJPOST
     C                   MOVE      'D'           TVTYP
     C                   ADD       1             THUTKA
     C                   MOVE      THUTKA        TVLNR
     C                   MOVE      *ZEROS        TVBNRB
     C                   MOVE      *ZEROS        TVBNRK
     C                   MOVE      HEAVDT        TVOAVD
     C                   MOVE      HEOPDT        TVOPD
     C                   MOVE      FAVK          TVVK
     C                   MOVE      UTX           IUTX
     C                   MOVE      OPIUDS        TVTXT
     C                   MOVE      *ZEROS        TVPRO
     C     FASK          IFEQ      'E'
     C                   MOVE      'E'           TVAVES
     C                   ELSE
     C                   MOVE      *BLANKS       TVAVES
     C                   END
     C                   MOVE      FAOPKO        TVOPKO
     C* FABELN ER ALLTID I LOKAL VALUTA
     C                   MOVE      FICURR        TVVAL
     C                   MOVE      *ZEROS        TBPRO
     C     FAOPKO        IFGE      'O'
     C                   Z-ADD     FABELU        FABELN
     C                   END
     C                   Z-SUB     FABELN        TVBLLB
      * TREKK PROVISJON UT AV BRUTTO-BASERT I-LINJE-TREKK???
     C     FIBRUT        IFNE      'B'
     C                   GOTO      SKIPP3
     C                   END
     C* NÅR EGEN TUR SKAL VISES SKAL PROV IKKE TREKES UT.
     C     VMINCR        IFEQ      2
     C                   GOTO      SKIPP3
     C                   END
      * FINN PROVISJONSSATS..
     C* Transp. har egen avtale om prov.sats.....
     C                   MOVE      TUKNT2        YYTNR
     C                   EXSR      PROV
     C     TBPRO         IFEQ      *ZEROS
     C* ... eller generell prov.sats benyttes ...
     C                   MOVE      *ZEROS        YYTNR
     C                   EXSR      PROV
     C                   END
      * TREKK UT PROV
     C     100           SUB       TBPRO         XPRFAK            7 4
     C                   DIV       100           XPRFAK
     C                   MULT      XPRFAK        FABELN
      *
     C     SKIPP3        TAG
     C                   MOVE      TBPRO         TVPRO
     C                   Z-SUB     FABELN        TVBL
     C                   Z-SUB     FABELN        TVBLL
     C                   EXSR      DECI1
     C                   WRITE     TRAVVR
     C* GEBYRET SKAL TREKKES
     C                   ADD       TVBLL         THUTK
     C     TUTAKO        IFNE      'A'
     C                   ADD       TVBLL         THTOT
     C                   END
     C* FLERE FAKTLINJER PÅ DETTE OPPDRAGET
     C                   GOTO      FATAG3
     C                   END
     C*
     C* LEGG UT VARNING DERSOM DUP-OPPDRAG MEN INGEN AVREGNINGSLINJER
     C     ANTAVL        IFEQ      *ZEROS
     C                   MOVE      'D'           TVTYP
     C                   ADD       1             THUTKA
     C                   MOVE      THUTKA        TVLNR
     C                   MOVE      *ZEROS        TVBNRB
     C                   MOVE      *ZEROS        TVBNRK
     C                   MOVE      HEAVDT        TVOAVD
     C                   MOVE      HEOPDT        TVOPD
     C                   MOVE      *BLANKS       TVVK
     C                   MOVE      UTX           IUTX
     C                   MOVE      OPIUDS        TVTXT
     C                   MOVE      *ZEROS        TVPRO
     C                   MOVE      *BLANKS       TVAVES
     C                   MOVE      ' '           TVOPKO
     C                   MOVE      FICURR        TVVAL
     C                   MOVE      *ZEROS        TVBL
     C                   MOVE      *ZEROS        TVBLL
     C                   MOVE      *ZEROS        TVBLLB
     C                   WRITE     TRAVVR
     C                   END
     C*
     C                   END
     C*
     C* FLERE OPPDRAG PÅ DENNE TUREN
     C                   GOTO      HETAG1
     C                   END
     C*
     C                   MOVE      *BLANKS       TVTIL
     C                   MOVE      *BLANKS       TVFRA
     C*
     C* ----------------------------------------------------
     C* TREKK FRA ALLE KOSTNADER SOM BELASTES TRANSP
     C* FØRST KOSTNADER SOM ER I KOSTA ( VIA BUDSJ./REKV.)
     C* (STATUS F I KOSBU)
     C* (DERETTER BELØP SOM ER GODSKREVET ANNEN TRANSPORTØR)
     C* (DERETTER BUDSJETTERTE ENNÅ IKKE PÅLØPNE)
     C* """"""""""""""""""""""""""""""""""""""""""""""""""""
     C                   MOVE      'F'           YST
     C     KOS2K         SETLL     KOSBU2
     C     KOTAG2        TAG
     C                   READ      KOSBU2                                 34
     C  N34BUTUNR        COMP      TUPRO                              3434
     C* KUN FØRTE/ATTESTERTE KOSTNADER
     C  N34BUST          COMP      'F'                                3434
     C  N34BUFER         IFEQ      'F'                                          * IKKE FERGE
     C                   GOTO      KOTAG2
     C                   END
     C  N34BUBLST        IFNE      'T'                                          * KUN DE MED BELASTN
     C                   GOTO      KOTAG2                                         KODE = T
     C                   END
     C  N34              DO
     C* ETT KOSTN.BILAG KAN VÆRE BASERT PÅ MANGE BUDJ.POSTER
     C* ER SAMLEBILAG ALT FUNNET PÅ GRUNNLAG AV TIDLIGERE BUDSJ.POST - HOPP OVER
     C*          BUBNR2    CHAINTRAVV1               35
     C* N35                GOTO KOTAG2
     C     BUBNR2        CHAIN     KOSTA                              35
     C   35              GOTO      KOTAG2
     C* I KOSTA LIGGER LEVR.FAKT MED NEG. FORTEGN (ADD BLIR TREKK FRA)
     C* LEGG UT DETALJPOST
     C                   MOVE      'E'           TVTYP
     C                   ADD       1             THRKVA
     C                   MOVE      THRKVA        TVLNR
     C                   MOVE      BUBNR         TVBNRB
     C                   MOVE      KABNR         TVBNRK
     C                   MOVE      BUOAVD        TVOAVD
     C                   MOVE      BUOPD         TVOPD
     C                   MOVE      BUVK          TVVK
     C                   MOVE      BUTXT         TVTXT
     C                   MOVE      *ZEROS        TVPRO
     C                   MOVE      BUTYPE        TVAVES
     C                   MOVE      KAST          TVOPKO
     C* MÅ BENYTTE BELØP FRA KOSBU -
     C* I KOSTA KAN DET LIGGE SAMLEBILAG HVOR KUN LITEN DEL GJELDER DENNE AVR.
     C                   MOVE      KAVAL         TVVAL
     C*                    Z-ADDKABL      TVBL
     C                   Z-SUB     BUBL          TVBL
     C     TVVAL         IFNE      FICURR
     C* VED FØRT- KOSTNAD- BENYTT KURS FRA FØRINGSTIDSPKT
     C     TVBL          MULT      KAVKU         XWORK
     C     XWORK         DIV(H)    KAOMRF        TVBLL
     C                   Z-ADD     TVBLL         TVBLLB
     C                   ELSE
     C                   Z-ADD     TVBL          TVBLL
     C                   Z-ADD     TVBL          TVBLLB
     C                   END
     C                   EXSR      DECI1
     C                   WRITE     TRAVVR
     C* AKKUMULER PÅ TURNIVÅ
     C                   ADD       TVBLL         THRKV
     C     TUTAKO        IFNE      'A'
     C                   ADD       TVBLL         THTOT
     C                   END
     C* FLERE KOSTNADSLINJER PÅ DENNE TUREN
     C                   GOTO      KOTAG2
     C                   END
     C*
     C* ----------------------------------------------------
     C* DERETTER KOSTNADER SOM ER GODSKREVET ANNEN TRANSPORTØR
     C* (STATUS S I KOSBU)
     C* """"""""""""""""""""""""""""""""""""""""""""""""""""
     C                   MOVE      'A'           YST
     C     KOS2K         SETLL     KOSBU2
     C     KOTA22        TAG
     C                   READ      KOSBU2                                 34
     C  N34BUTUNR        COMP      TUPRO                              3434
     C* KUN FØRTE/ATTESTERTE KOSTNADER
     C  N34BUST          COMP      'A'                                3434
     C  N34BUFER         IFEQ      'F'                                          * IKKE FERGE
     C                   GOTO      KOTA22
     C                   END
     C  N34BUBLST        IFNE      'T'                                          * KUN DE MED BELASTN
     C                   GOTO      KOTA22                                         KODE = T
     C                   END
     C  N34              DO
     C* LEGG UT DETALJPOST
     C                   MOVE      'E'           TVTYP
     C                   ADD       1             THRKVA
     C                   MOVE      THRKVA        TVLNR
     C                   MOVE      BUBNR         TVBNRB
     C                   MOVE      *ZEROS        TVBNRK
     C                   MOVE      BUOAVD        TVOAVD
     C                   MOVE      BUOPD         TVOPD
     C                   MOVE      BUVK          TVVK
     C                   MOVE      BUTXT         TVTXT
     C                   MOVE      *ZEROS        TVPRO
     C                   MOVE      BUTYPE        TVAVES
     C                   MOVE      BUST          TVOPKO
     C                   MOVE      BUVAL         TVVAL
     C                   Z-SUB     BUBL          TVBL
     C     TVVAL         IFNE      FICURR
     C                   EXSR      VALUT
     C                   ELSE
     C                   Z-ADD     TVBL          TVBLL
     C                   Z-ADD     TVBL          TVBLLB
     C                   END
     C                   EXSR      DECI1
     C                   WRITE     TRAVVR
     C* AKKUMULER PÅ TURNIVÅ
     C                   ADD       TVBLL         THRKV
     C     TUTAKO        IFNE      'A'
     C                   ADD       TVBLL         THTOT
     C                   END
     C* FLERE KOSTNADSLINJER PÅ DENNE TUREN
     C                   GOTO      KOTA22
     C                   END
     C*
     C*
     C* ----------------------------------------------------
     C* DERETTER KOSTNADER FOR TJENESTER UTFØRT AV INTERN BIL
     C* (STATUS I I KOSBU)
     C* """"""""""""""""""""""""""""""""""""""""""""""""""""
     C                   MOVE      'I'           YST
     C     KOS2K         SETLL     KOSBU2
     C     KOTA23        TAG
     C                   READ      KOSBU2                                 34
     C  N34BUTUNR        COMP      TUPRO                              3434
     C* KUN KOSTNADER MED STATUS I
     C  N34BUST          COMP      'I'                                3434
     C  N34BUFER         IFEQ      'F'                                          * IKKE FERGE
     C                   GOTO      KOTA23
     C                   END
     C  N34BUBLST        IFNE      'T'                                          * KUN DE MED BELASTN
     C                   GOTO      KOTA23                                         KODE = T
     C                   END
     C  N34              DO
     C* LEGG UT DETALJPOST
     C                   MOVE      'E'           TVTYP
     C                   ADD       1             THRKVA
     C                   MOVE      THRKVA        TVLNR
     C                   MOVE      BUBNR         TVBNRB
     C                   MOVE      *ZEROS        TVBNRK
     C                   MOVE      BUOAVD        TVOAVD
     C                   MOVE      BUOPD         TVOPD
     C                   MOVE      BUVK          TVVK
     C                   MOVE      BUTXT         TVTXT
     C                   MOVE      *ZEROS        TVPRO
     C                   MOVE      BUTYPE        TVAVES
     C                   MOVE      BUST          TVOPKO
     C                   MOVE      BUVAL         TVVAL
     C                   Z-SUB     BUBL          TVBL
     C     TVVAL         IFNE      FICURR
     C                   EXSR      VALUT
     C                   ELSE
     C                   Z-ADD     TVBL          TVBLL
     C                   Z-ADD     TVBL          TVBLLB
     C                   END
     C                   EXSR      DECI1
     C                   WRITE     TRAVVR
     C* AKKUMULER PÅ TURNIVÅ
     C                   ADD       TVBLL         THRKV
     C     TUTAKO        IFNE      'A'
     C                   ADD       TVBLL         THTOT
     C                   END
     C* FLERE KOSTNADSLINJER PÅ DENNE TUREN
     C                   GOTO      KOTA23
     C                   END
     C*
     C* ----------------------------------------------------
     C* TREKK FRA BUDSJETTERTE KOSTNADER SOM IKKE ER FØRT ENNÅ
     C* """"""""""""""""""""""""""""""""""""""""""""""""""""
     C                   MOVE      ' '           YST
     C     KOS2K         SETLL     KOSBU2
     C     KOTAG3        TAG
     C                   READ      KOSBU2                                 34
     C  N34BUTUNR        COMP      TUPRO                              3434
     C* KUN FØRTE/ATTESTERTE KOSTNADER
     C  N34BUST          COMP      ' '                                3434
     C  N34BUFER         IFEQ      'F'                                          * IKKE FERGE
     C                   GOTO      KOTAG3
     C                   END
     C  N34BUBLST        IFNE      'T'                                          * KUN DE MED BELASTN
     C                   GOTO      KOTAG3                                         KODE = T
     C                   END
     C  N34              DO
     C* I KOSBU LIGGER LEVR.FAKT MED POS. FORTEGN (SNU)
     C* LEGG UT DETALJPOST
     C                   MOVE      'F'           TVTYP
     C                   ADD       1             THBUDA
     C                   MOVE      THBUDA        TVLNR
     C                   MOVE      BUBNR         TVBNRB
     C                   MOVE      *ZEROS        TVBNRK
     C                   MOVE      BUOAVD        TVOAVD
     C                   MOVE      BUOPD         TVOPD
     C                   MOVE      BUVK          TVVK
     C                   MOVE      BUTXT         TVTXT
     C                   MOVE      *ZEROS        TVPRO
     C                   MOVE      BUTYPE        TVAVES
     C                   MOVE      *BLANKS       TVOPKO
     C                   MOVE      BUVAL         TVVAL
     C                   Z-SUB     BUBL          TVBL
     C     TVVAL         IFNE      FICURR
     C                   EXSR      VALUT
     C                   ELSE
     C                   Z-ADD     TVBL          TVBLLB
     C                   Z-ADD     TVBL          TVBLL
     C                   END
     C                   EXSR      DECI1
     C                   WRITE     TRAVVR
     C* AKKUMULER PÅ TURNIVÅ
     C                   ADD       TVBLL         THBUD
     C     TUTAKO        IFNE      'A'
     C                   ADD       TVBLL         THTOT
     C                   END
     C* FLERE BUDSJETTLINJER PÅ DENNE TUREN
     C                   GOTO      KOTAG3
     C                   END
     C*
     C* OPPDATER - ALLTID NY
     C     UtAkku        tag
     C                   EXSR      DECI
     C                   WRITE     TRAVHR
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     SrBuTV        BEGSR
     C***********************************************
     C     FAK2K         SETLL     KOSBU12
     C     FAK2K         READE     KOSBU12                                34
     C     *in34         doweq     *off
     C     BUTX_7        IFEQ      '* OPD *'
     C     BUST          andeq     ' '
     C* LEGG UT DETALJPOST
     C                   MOVE      'F'           TVTYP
     C                   ADD       1             THBUDA
     C                   MOVE      THBUDA        TVLNR
     C                   MOVE      BUBNR         TVBNRB
     C                   MOVE      *ZEROS        TVBNRK
     C                   MOVE      BUOAVD        TVOAVD
     C                   MOVE      BUOPD         TVOPD
     C                   MOVE      BUVK          TVVK
     C                   MOVE      BUTXT         TVTXT
     C                   MOVE      *ZEROS        TVPRO
     C                   MOVE      BUTYPE        TVAVES
     C                   MOVE      *BLANKS       TVOPKO
     C                   MOVE      BUVAL         TVVAL
     C                   Z-ADD     BUBL          TVBL
     C     TVVAL         IFNE      FICURR
     C                   EXSR      VALUT
     C                   ELSE
     C                   Z-ADD     TVBL          TVBLLB
     C                   Z-ADD     TVBL          TVBLL
     C                   END
     C                   EXSR      DECI1
     C                   WRITE     TRAVVR
     C* AKKUMULER PÅ TURNIVÅ
     C                   ADD       TVBLL         THBUD
     C     TUTAKO        IFNE      'A'
     C                   ADD       TVBLL         THTOT
     C                   END
     C                   END
     C*
     C     FAK2K         READE     KOSBU12                                34
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     OPPDS         BEGSR
     C***********************************************
     C*
     C                   MOVE      *BLANKS       TVTXT
     C     HENASF        IFNE      *BLANKS
     C                   MOVEL     HENASF        FMOTNA
     C                   ELSE
     C                   MOVEL     HENAKF        FMOTNA
     C                   END
     C* Z-SUPPR. VEKT
     C                   MOVE      HEVKT         HEVKTA
     C     XXVKT1        IFEQ      '0'
     C                   MOVE      ' '           XXVKT1
     C     XXVKT2        IFEQ      '0'
     C                   MOVE      ' '           XXVKT2
     C     XXVKT3        IFEQ      '0'
     C                   MOVE      ' '           XXVKT3
     C     XXVKT4        IFEQ      '0'
     C                   MOVE      ' '           XXVKT4
     C                   END
     C                   END
     C                   END
     C                   END
     C*
     C* Z-SUPPR. LASTEM
     C                   MOVEL     HELM          HELM1
     C                   MOVE      HELM          HELM2
     C     XXLM1         IFEQ      '0'
     C                   MOVE      ' '           XXLM1
     C                   END
     C* Z-SUPPR. KUBIKK
     C                   Z-ADD(H)  HEM3          HEM352            5 2
     C                   MOVEL     HEM352        TRM31
     C                   MOVE      HEM352        TRM32
     C     XXM31         IFEQ      '0'
     C                   MOVE      ' '           XXM31
     C     XXM32         IFEQ      '0'
     C                   MOVE      ' '           XXM32
     C                   END
     C                   END
     C                   ENDSR
     C*
     C***********************************************
     C     VALUT         BEGSR
     C***********************************************
     C*
     C     VALU1K        CHAIN     VALUL01                            39
     C  N39              DO
     C     VALKU2        IFNE      0
     C                   MOVE      VALKU2        VALKU1
     C                   END
     C     TVBL          MULT      VALKU1        XWORK            15 4
     C     XWORK         DIV(H)    OMRFAK        TVBLLB
     C                   Z-ADD     TVBLLB        TVBLL
     C                   END
     C   39              Z-ADD     TVBL          TVBLL
     C   39              Z-ADD     TVBL          TVBLLB
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     PROV          BEGSR
     C***********************************************
     C     TRABK         SETLL     TRAB
     C     YYTNR         READE     TRAB                                   37
     C     *IN37         DOWEQ     '0'
     C     YYTNR         IFEQ      *ZEROS                                       KUN VED GENERELL..
     C     TBTKAT        ANDNE     *BLANKS                                      *KATEGORI
     C     TBTKAT        ANDNE     VMTKAT                                       (MEDLEM/IKKE
     C                   GOTO      NESTE                                         M.M....)
     C                   END
     C     TBUNIT        IFNE      *BLANKS                                      KUN BILNR...
     C     TBUNIT        ANDNE     TUBILN
     C                   GOTO      NESTE
     C                   END
     C     TBAVD         IFNE      *ZEROS                                       KUN AVDELING..
     C     TBAVD         ANDNE     FAAVD
     C                   GOTO      NESTE
     C                   END
     C     TBGEB         IFNE      *BLANKS                                      KUN GEBYR...
     C     TBGEB         ANDNE     FAVK
     C                   GOTO      NESTE
     C                   END
     C     TBLK          IFNE      *BLANKS                                      KUN LANDKODE..
     C* INNLAND - BEGGE KODER MÅ MATCHE
     C     TBLK          IFEQ      'NO'
     C     TBLK          IFNE      HELKA                                            FRA
     C     TBLK          ORNE      HETRI                                            TIL
     C                   GOTO      NESTE
     C                   END
     C                   ELSE
     C* IMP/EKSP- ENTEN FRA ELLER TIL MÅ MATCHE...
     C     TBLK          IFNE      HELKA                                            FRA
     C     TBLK          ANDNE     HETRI                                            TIL
     C                   GOTO      NESTE
     C                   END
     C                   END
     C                   END
      *  Opp.type
     C     TBOPTY        IFNE      *BLANKS                                      KUN BILNR...
     C     TBOPTY        ANDNE     HEOT
     C                   GOTO      NESTE
     C                   END
      *
     C     TBVKTT        IFNE      *ZEROS                                       KUN Vekt T.o.m..
     C     TBVKTT        ANDLT     HEFBV
     C                   GOTO      NESTE
     C                   END
     C     TBDATE        IFLT      TUDT                                         UTLØPT DATO...
     C                   GOTO      NESTE
     C                   END
     C* OK!! - Er gjennom alle testene - gyldig prov.linje er funnet.....
     C                   GOTO      ENDPRO
     C***
     C* Kommer hit når ett av vilkårene ikke ble oppfylt
     C     NESTE         TAG
     C     YYTNR         READE     TRAB                                   37
     C  N37              END
     C* GÅR UT HER - HAR IKKE FUNNET PROV
     C                   MOVE      *ZEROS        TBPRO
     C***
     C     ENDPRO        ENDSR
     C*
     C***********************************************
     C     DELDET        BEGSR
     C***********************************************
     C* FJERN EVT. GAMLE DETALJLINJER FRA TRAVV
     C                   MOVE      ' '           YVTYP
     C                   SETOFF                                       39
     C*                  END
     C*
     C     TRAVK         SETLL     TRAVV
     C     TURERK        READE     TRAVV                                  39
     C     *IN39         doweq     '0'
     C                   DELETE    TRAVVR
     C     TURERK        READE     TRAVV                                  39
     C                   END
     C                   ENDSR
     C*
     C*
     C*
     C***********************************************
     C     MOVBX         BEGSR
     C***********************************************
     C                   SETOFF                                       40
     C* SETTER INN VERDIER FRA HENTET TUR
     C                   MOVE      ' '           THST
     C                   Z-ADD     TUKNT2        THTNR
     C                   Z-ADD     TURUND        THRTNR
     C                   Z-ADD     TUAVD         THTAVD
     C                   Z-ADD     TUPRO         THTUNR
     C* MVAKODE - DEFAULT : J OM BEGGE DEST= NO / ELLERS N
     C                   MOVEL     TUSONF        FRALK             2
     C                   MOVEL     TUSONT        TILLK             2
     C     FRALK         IFEQ      'NO'
     C     TILLK         ANDEQ     'NO'
     C                   MOVE      'J'           THKDM
     C                   ELSE
     C                   MOVE      'N'           THKDM
     C                   END
     C* BLANKER ALLE ARBEIDS VARIABLE TIL TURPOST
     C                   MOVE      *ZEROS        THAVT
     C                   MOVE      *ZEROS        THBRT
     C                   MOVE      *ZEROS        THINH
     C                   MOVE      *ZEROS        THUTK
     C                   MOVE      *ZEROS        THRKV
     C                   MOVE      *ZEROS        THBUD
     C                   MOVE      *ZEROS        THJUS
     C                   MOVE      *ZEROS        THTOT
     C* BLANKER TELLER FOR ANTALL AV ULIKE SUBPOSTER (A-G)
     C                   MOVE      *ZEROS        THAVTA
     C                   MOVE      *ZEROS        THBRTA
     C                   MOVE      *ZEROS        THINHA
     C                   MOVE      *ZEROS        THUTKA
     C                   MOVE      *ZEROS        THRKVA
     C                   MOVE      *ZEROS        THBUDA
     C                   MOVE      *ZEROS        THJUSA
     C                   MOVE      ' '           THSTAR
     C* SETT FASTE FELT FOR ALLE DETALJPOSTER PÅ DENNE TUREN.
     C                   MOVE      TUAVD         TVTAVD
     C                   MOVE      TUPRO         TVTUNR
     C                   ENDSR
     C*
     C***********************************************
     C     DECI          BEGSR
     C***********************************************
     C* TEST FIRMS NUMBER OF DECIMALS
     C*
     C* NO DECIMALS
     C     FIDECI        IFEQ      0
     C                   Z-ADD(H)  THTOT         FABEL0           11 0
     C                   Z-ADD     FABEL0        THTOT
     C                   ELSE
     C* 1 DECIMAL
     C     FIDECI        IFEQ      1
     C                   Z-ADD(H)  THTOT         FABEL1           12 1
     C                   Z-ADD     FABEL1        THTOT
     C                   END
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     DECI1         BEGSR
     C***********************************************
     C* TEST FIRMS NUMBER OF DECIMALS
     C*
     C* NO DECIMALS
     C     FIDECI        IFEQ      0
     C                   Z-ADD(H)  TVBLL         FABEL0           11 0
     C                   Z-ADD     FABEL0        TVBLL
     C                   ELSE
     C* 1 DECIMAL
     C     FIDECI        IFEQ      1
     C                   Z-ADD(H)  TVBLL         FABEL1           12 1
     C                   Z-ADD     FABEL1        TVBLL
     C                   END
     C                   END
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     GRPRIS        BEGSR
     C***********************************************
     C* BEREGN GRUNNPRIS ETTER G-TABELL
     C* (låner innparameter SONE for å indikerer G-pris-beregning.)
     C                   Move      *zeros        GRPRBL           11 0
     C                   MOVE      *ZEROS        GRRAB
     C                   MOVE      *BLANKS       GRVAL             3
     C                   MOVE      'FRA'         GRGEB             3
     C                   MOVE      *ZEROS        GRBELØ           13 2
     C                   MOVE      *ZEROS        GRKUND            8 0
     C                   MOVE      HEAVD         GRAVD             4 0
     C                   MOVE      HEOPD         GROPD             7 0
     C                   MOVE      'G    '       GRSONE
     C                   CALL      'SYGE03'
     C                   PARM                    GRGEB
     C                   PARM                    GRAVD
     C                   PARM                    GROPD
     C                   PARM                    GRVAL
     C                   PARM                    GRBELØ
     C                   PARM                    GRSONE            5
     C                   PARM                    GRRAB             5 2
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    GRKUND
     C                   PARM                    GRavnr            9 0
N02  c                   parm                    atdum             1
     C                   Z-ADD(H)  GRBELØ        GRPRBL
     C                   ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C**
     C     *ENTRY        PLIST
     C                   PARM                    UAVD              4 0
     C                   PARM                    UTUNR             8 0
     C                   PARM                    UVIS              1            *TIL SYTR12B
     C                   PARM                    UOAVD             4 0
     C                   PARM                    UOPD              7 0
     C                   PARM                    UTRAN             8 0
     C*
     c                   MOVE      'N'           GRPRJN            1
     C     *LIKE         DEFINE    BUST          YST
     C     *LIKE         DEFINE    BULNR         YLNR
     C     *LIKE         DEFINE    BUBNR         YBNR
     C     *LIKE         DEFINE    TBFIRM        YYTNR
     C     *LIKE         DEFINE    TBLIN         YYLIN
     C     *LIKE         DEFINE    TVTYP         YVTYP
     C*
     C                   MOVE      *ZEROS        YLNR
     C                   MOVE      *ZEROS        YBNR
     C                   MOVE      'GE'          YGEUNI            2
     C                   MOVE      ' '           YYKDM             1
     C                   MOVE      ' '           YST
     C* TEKSTER TIL "OPDDS"
     C                   MOVE      'V:'          VTX
     C                   MOVE      'L:'          LTX
     C                   MOVE      'C:'          CTX
     C                   MOVE      ','           KOMMA
     C                   MOVE      ','           KOMMA2
     C* TEKSTER TIL "OPIUDS"
     C                   MOVEL     'Innhenti'    ITX              10
     C                   MOVE      'ng'          ITX
     C                   MOVEL     'Utkjørin'    UTX              10
     C                   MOVE      'g '          UTX
     C                   MOVE      '/'           STREK
     C                   MOVE      *ZEROS        HEAVD
     C                   MOVE      *ZEROS        HEOPD
     C*
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODE-TEKST-FIL TYPE GI (GEBYRKODER)
     C*--------------------------------------------------------------
     C     GEBIK         KLIST
     C                   KFLD                    FAVK
     C                   KFLD                    TUAVD
     C                   KFLD                    TUBILK
     C     GEBIK2        KLIST
     C                   KFLD                    FAVK
     C                   KFLD                    IKAVD
     C                   KFLD                    TUBILK
     C     GEBIK3        KLIST
     C                   KFLD                    FAVK
     C                   KFLD                    IKAVD
     C                   KFLD                    IKBILK
     C                   MOVE      *ZEROS        IKAVD             4 0
     C                   MOVE      *BLANKS       IKBILK            3
     C* VALUTAFIL
     C     VALU1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    TVVAL
     C* BUDSJETTFIL
     C     KOS2K         KLIST
     C                   KFLD                    YST
     C                   KFLD                    TUPRO
     C                   KFLD                    YLNR
     C                   KFLD                    YBNR
     C     KODGEK        KLIST
     C                   KFLD                    YGEUNI
     C                   KFLD                    FAVK
     C     TRABK         KLIST
     C                   KFLD                    YYTNR
     C                   KFLD                    YYLIN
     C                   MOVE      *ZEROS        YYLIN
     C* KEY FOR DETALJLINJER
     C     TRAVK         KLIST
     C                   KFLD                    TUAVD
     C                   KFLD                    TUPRO
     C                   KFLD                    YVTYP
     C     FAK2K         KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     HEA11K        KLIST
     C                   KFLD                    TUPRO
     C     HEATRK        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     TURERK        KLIST
     C                   KFLD                    TUAVD
     C                   KFLD                    TUPRO
     C                   MOVE      UAVD          TUAVD
     C                   MOVE      UTUNR         TUPRO
     C     TRANKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    TUKNT2
     C*
     C                   MOVE      ' '           YTHST             1
     C*
     C     UTUNR         IFNE      *ZEROS
     C     TURERK        CHAIN     TURER                              98
     C                   ELSE
     C     UOAVD         IFEQ      *ZEROS
     C     UOPD          OREQ      *ZEROS
     C     UTRAN         OREQ      *ZEROS
     C                   SETON                                        98
     C                   ELSE
     C                   Z-SUB     UOAVD         TUAVD
     C                   Z-SUB     UOPD          TUPRO
     C                   Z-ADD     UTRAN         TUKNT2
     C                   END
     C                   END
     C   98              GOTO      UTI
     C                   READ      FIRM                                   33
     C                   READ      FIRTR                                  33
     C     TURERK        CHAIN     TRAVH1                             33
     C   33              MOVE      ' '           THST
     C   33              MOVE      ' '           THSTAR
     C   33              EXSR      DELDET                                       *EVT- GAMLE
     C  N33THST          IFEQ      ' '
     C     THSTAR        ANDEQ     ' '
     C                   DELETE    TRVH1R
     C                   EXSR      DELDET
     C                   ELSE
     C                   SETON                                        99
     C                   UPDATE    TRVH1R
     C                   END
     C     TRANKE        CHAIN     TRAN                               33
     C*
     C* INITIER ARBEIDSFELT FOR HEADINGPOST
     C  N99              EXSR      MOVBX
     C     UTI           ENDSR
     C*
