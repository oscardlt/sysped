      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/TTCI006R MODULE(*LIBL/TTCI006R *LIBL/INCGI)
CRTPGM*        ACTGRP(*NEW) AUT(*USE)
      *
      *********************************************************************
      /copy SYSPEDS/qrpgsrcpy,hspecs
      /copy SYSPEDS/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
     FTRIH      UF   E           K DISK    USROPN
     F                                     PREFIX(X_)
     FTRIHFS    UF A E           K DISK    USROPN
     F                                     PREFIX(XH_)
     FTRIHPK    UF A E           K DISK    USROPN
     F                                     PREFIX(XH_)
     FKODTSI1   IF   E           K DISK    USROPN
     F                                     RENAME(KOSIR:KOSIR1)
     FKODTSI    IF   E           K DISK    USROPN
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy SYSPEDS/qrpgsrcpy,prototypeb
      /copy SYSPEDS/qrpgsrcpy,usec
      /copy SYSPEDS/qrpgsrcpy,variables3
      *
      * Varible for
     D WSUSER          S             10
     D TIAVD_A         S              4
     D TIAVD           S              4  0
     D TITDN_A         S              7
     D TITDN           S              7  0
     D WMODE           S              2
     D WSIGN           S              3
     D TISG            S              3
     D TIST            S              1
     D TIENKL          S              1
     D TITRNR          S             18
     D TIGN            S             35
     D TITARF          S             16
     D TIDK            S              5
     D TIKNA_A         S              8
     D TIKNA           S              8  0
     D TINAA           S             30
     D TIADA1          S             30
     D TIPNA           S              9
     D TIPSA           S             24
     D TILKA           S              2
     D TISKA           S              2
     D TITINA          S             17
     D TIKNS_A         S              8
     D TIKNS           S              8  0
     D TINAS           S             30
     D TIADS1          S             30
     D TIPNS           S              9
     D TIPSS           S             24
     D TILKS           S              2
     D TISKS           S              2
     D TITINS          S             17
     D TIKNK_A         S              8
     D TIKNK           S              8  0
     D TINAK           S             30
     D TIADK1          S             30
     D TIPNK           S              9
     D TIPSK           S             24
     D TILKK           S              2
     D TISKK           S              2
     D TITINK          S             17
     D TIBLK           S              2
     D TIALK           S              2
     D TITAID          S             27
     D TITASK          S              2
     D TITALK          S              2
     D TIKDC           S              1
     D TITRDT_A        S              8
     D TITRDT          S              8  0
     D TILSTL_A        S              4
     D TILSTL          S              4  0
     D TIVPOS_A        S              5
     D TIVPOS          S              5  0
     D TINTK_A         S              7
     D TINTK           S              7  0
     D TIVKB_A         S             12
     D TIVKB           S             11  3
     D TICATS          S              8
     D TICTL           S              1
     D TIDANT_A        S              4
     D TIDANT          S              4  0
     D*TIDFKD          S             20
     D*TIDFSK          S              2
     D TIMF            S              3
     D TIMP_A          S              1
     D TIMP            S              1  0
     D TIKDV           S              1
     D TI0035          S              1
     D TIWS            S             10
     D TITUID          S             14
     D TISGDK          S              6
     D TISGME          S              3
     D TISGUT          S              6
     D TISGID          S             10
     D TISGDT          S             12
     D TIBYTE_A        S              7
     D TIBYTE          S              7  0
      *
     D NIVPOS_A        S              5
     D NIVPOS          S              5  0
     D NINTK_A         S              7
     D NINTK           S              7  0
     D NIVKB_A         S             12
     D NIVKB           S             11  3
     D NIDFST          S              1
     D NIDANT_A        S              4
     D NIDANT          S              4  0
     D*NIDFKD          S             20
     D*NIDFSK          S              2
     D NIMN1           S             70
     D NIMN2           S             70
     D NIMNSK          S              2
     D NIKONF_A        S              1
     D NIKONF          S              1  0
     D NIFULF_A        S              1
     D NIFULF          S              1  0
     D NIDTL_A         S              8
     D NIDTL           S              8  0
     D NICTB           S             70
     D NICTB2          S             70
     D NICTSK          S              2
     D*NICTP           S             35
     D*NICTNV          S             15
      *
     D JSONstring      S          32000
     D Error           S            150
     D                 DS
     D  TIDFKD                 1     20
     D  TIDFSK                21     22
     D  NIDFKD                23     42
     D  NIDFSK                43     44
     D  FSORG                  1     44
     D                 DS
     D  TIDFKD1                1     20
     D  TIDFSK1               21     22
     D  NIDFKD1               23     42
     D  NIDFSK1               43     44
     D  TIDFKD2               45     64
     D  TIDFSK2               65     66
     D  NIDFKD2               67     86
     D  NIDFSK2               87     88
     D  TIDFKD3               89    108
     D  TIDFSK3              109    110
     D  NIDFKD3              111    130
     D  NIDFSK3              131    132
     D  TIDFKD4              133    152
     D  TIDFSK4              153    154
     D  NIDFKD4              155    174
     D  NIDFSK4              175    176
     D  FS                     1    176    DIM(4)
     D                 DS
     D  NICTP                  1     35
     D  NICTNV                36     50
     D  PKORG                  1     44
     D                 DS
     D  NICTP1                 1     35
     D  NICTNV1               36     50
     D  NICTP2                51     85
     D  NICTNV2               86    100
     D  NICTP3               101    135
     D  NICTNV3              136    150
     D  NICTP4               151    185
     D  NICTNV4              186    200
     D  PK                     1    200    DIM(4)

      *get input-string
      /copy syspeds/qrpgsrcpy,prolog3

      * Parse input
     C                   EXSR      Parse
      * Open files etc
     C                   EXSR      INIT
      *
     c                   callp     gethtmlifs(
     C                             '/syspeddev/html/JSON.html':
     C                             '/CGITAG/')
     C                   callp     wrtsection('top')
      * Teste input og utfør
     C  N50              EXSR      TEST

      * ............................................................................................
      * skriv JSON-Object start..(alltid '{' + x ant param. m/komma mellom (IKKE komma etter siste))
      * ............................................................................................
      *
      /free
        JSONstring='{'
        +'¬user¬ : ¬'+%trim(WSUSER)+'¬, '
        +'¬tiavd¬ : ¬'+%trim(%editc(TIAVD:'Z'))+'¬, '
        +'¬titdn¬ : ¬'+%trim(%editc(TITDN:'Z'))+'¬, '
        +'¬mode¬ : ¬'+%trim(WMODE)+'¬, '
        +'¬tituid¬ : ¬'+%trim(TITUID)+'¬, '
        +'¬tisg¬ : ¬'+%trim(TISG)+'¬, '
        +'¬tist¬ : ¬'+%trim(TIST)+'¬, '
        +'¬tienkl¬ : ¬'+%trim(TIENKL)+'¬, '
        +'¬titrnr¬ : ¬'+%trim(TITRNR)+'¬, '
        +'¬tign¬ : ¬'+%trim(TIGN)+'¬, '
        +'¬timf¬ : ¬'+%trim(TIMF)+'¬, '
        +'¬timp¬ : ¬'+%trim(%editc(TIMP:'Z'))+'¬, '
        +'¬tikdv¬ : ¬'+%trim(TIKDV)+'¬, '
        +'¬ti0035¬ : ¬'+%trim(TI0035)+'¬, '
        +'¬titarf¬ : ¬'+%trim(TITARF)+'¬, '
        +'¬tidk¬ : ¬'+%trim(TIDK)+'¬, '
        +'¬tikna¬ : ¬'+%trim(%editc(TIKNA:'Z'))+'¬, '
        +'¬tinaa¬ : ¬'+%trim(TINAA)+'¬, '
        +'¬tiada1¬ : ¬'+%trim(TIADA1)+'¬, '
        +'¬tipna¬ : ¬'+%trim(TIPNA)+'¬, '
        +'¬tipsa¬ : ¬'+%trim(TIPSA)+'¬, '
        +'¬tilka¬ : ¬'+%trim(TILKA)+'¬, '
        +'¬tiska¬ : ¬'+%trim(TISKA)+'¬, '
        +'¬titina¬ : ¬'+%trim(TITINA)+'¬, '
        +'¬tikns¬ : ¬'+%trim(%editc(TIKNS:'Z'))+'¬, '
        +'¬tinas¬ : ¬'+%trim(TINAS)+'¬, '
        +'¬tiads1¬ : ¬'+%trim(TIADS1)+'¬, '
        +'¬tipns¬ : ¬'+%trim(TIPNS)+'¬, '
        +'¬tipss¬ : ¬'+%trim(TIPSS)+'¬, '
        +'¬tilks¬ : ¬'+%trim(TILKS)+'¬, '
        +'¬tisks¬ : ¬'+%trim(TISKS)+'¬, '
        +'¬titins¬ : ¬'+%trim(TITINS)+'¬, '
        +'¬tiknk¬ : ¬'+%trim(%editc(TIKNK:'Z'))+'¬, '
        +'¬tinak¬ : ¬'+%trim(TINAK)+'¬, '
        +'¬tiadk1¬ : ¬'+%trim(TIADK1)+'¬, '
        +'¬tipnk¬ : ¬'+%trim(TIPNK)+'¬, '
        +'¬tipsk¬ : ¬'+%trim(TIPSK)+'¬, '
        +'¬tilkk¬ : ¬'+%trim(TILKK)+'¬, '
        +'¬tiskk¬ : ¬'+%trim(TISKK)+'¬, '
        +'¬titink¬ : ¬'+%trim(TITINK)+'¬, '
        +'¬tiblk¬ : ¬'+%trim(TIBLK)+'¬, '
        +'¬tialk¬ : ¬'+%trim(TIALK)+'¬, '
        +'¬titaid¬ : ¬'+%trim(TITAID)+'¬, '
        +'¬titask¬ : ¬'+%trim(TITASK)+'¬, '
        +'¬titalk¬ : ¬'+%trim(TITALK)+'¬, '
        +'¬tikdc¬ : ¬'+%trim(TIKDC)+'¬, '
        +'¬titrdt¬ : ¬'+%trim(%editc(TITRDT:'Z'))+'¬, '
        +'¬tilstl¬ : ¬'+%trim(%editc(TILSTL:'Z'))+'¬, '
        +'¬tivpos¬ : ¬'+%trim(%editc(TIVPOS:'Z'))+'¬, '
        +'¬tintk¬ : ¬'+%trim(%editc(TINTK:'Z'))+'¬, '
        +'¬tivkb¬ : ¬'+%trim(%editc(TIVKB:'4'))+'¬, '
        +'¬ticats¬ : ¬'+%trim(TICATS)+'¬, '
        +'¬tictl¬ : ¬'+%trim(TICTL)+'¬, '
        +'¬tidant¬ : ¬'+%trim(%editc(TIDANT:'Z'))+'¬, '
        +'¬tidfkd¬ : ¬'+%trim(TIDFKD1)+'¬, '
        +'¬tidfsk¬ : ¬'+%trim(TIDFSK1)+'¬, '
        +'¬tidfkd2¬ : ¬'+%trim(TIDFKD2)+'¬, '
        +'¬tidfsk2¬ : ¬'+%trim(TIDFSK2)+'¬, '
        +'¬tidfkd3¬ : ¬'+%trim(TIDFKD3)+'¬, '
        +'¬tidfsk3¬ : ¬'+%trim(TIDFSK3)+'¬, '
        +'¬tidfkd4¬ : ¬'+%trim(TIDFKD4)+'¬, '
        +'¬tidfsk4¬ : ¬'+%trim(TIDFSK4)+'¬, '
        +'¬tisgdk¬ : ¬'+%trim(TISGDK)+'¬, '
        +'¬tisgme¬ : ¬'+%trim(TISGME)+'¬, '
        +'¬tisgut¬ : ¬'+%trim(TISGUT)+'¬, '
        +'¬tisgid¬ : ¬'+%trim(TISGID)+'¬, '
        +'¬tisgdt¬ : ¬'+%trim(TISGDT)+'¬, '
        +'¬tibyte¬ : ¬'+%trim(%editc(TIBYTE:'Z'))+'¬, '
        +'¬nivpos¬ : ¬'+%trim(%editc(NIVPOS:'Z'))+'¬, '
        +'¬nintk¬ : ¬'+%trim(%editc(NINTK:'Z'))+'¬, '
        +'¬nivkb¬ : ¬'+%trim(%editc(NIVKB:'4'))+'¬, '
        +'¬nidfst¬ : ¬'+%trim(NIDFST)+'¬, '
        +'¬nidant¬ : ¬'+%trim(%editc(NIDANT:'Z'))+'¬, '
        +'¬nidfkd¬ : ¬'+%trim(NIDFKD1)+'¬, '
        +'¬nidfsk¬ : ¬'+%trim(NIDFSK1)+'¬, '
        +'¬nidfkd2¬ : ¬'+%trim(NIDFKD2)+'¬, '
        +'¬nidfsk2¬ : ¬'+%trim(NIDFSK2)+'¬, '
        +'¬nidfkd3¬ : ¬'+%trim(NIDFKD3)+'¬, '
        +'¬nidfsk3¬ : ¬'+%trim(NIDFSK3)+'¬, '
        +'¬nidfkd4¬ : ¬'+%trim(NIDFKD4)+'¬, '
        +'¬nidfsk4¬ : ¬'+%trim(NIDFSK4)+'¬, '
        +'¬nimn1¬ : ¬'+%trim(NIMN1)+'¬, '
        +'¬nimn2¬ : ¬'+%trim(NIMN2)+'¬, '
        +'¬nimnsk¬ : ¬'+%trim(NIMNSK)+'¬, '
        +'¬nikonf¬ : ¬'+%trim(%editc(NIKONF:'Z'))+'¬, '
        +'¬nifulf¬ : ¬'+%trim(%editc(NIFULF:'Z'))+'¬, '
        +'¬nidtl¬ : ¬'+%trim(%editc(NIDTL:'Z'))+'¬, '
        +'¬nictb¬ : ¬'+%trim(NICTB)+'¬, '
        +'¬nictb2¬ : ¬'+%trim(NICTB2)+'¬, '
        +'¬nictsk¬ : ¬'+%trim(NICTSK)+'¬, '
        +'¬nictp¬ : ¬'+%trim(NICTP1)+'¬, '
        +'¬nictnv¬ : ¬'+%trim(NICTNV1)+'¬, '
        +'¬nictp2¬ : ¬'+%trim(NICTP2)+'¬, '
        +'¬nictnv2¬ : ¬'+%trim(NICTNV2)+'¬, '
        +'¬nictp3¬ : ¬'+%trim(NICTP3)+'¬, '
        +'¬nictnv3¬ : ¬'+%trim(NICTNV3)+'¬, '
        +'¬nictp4¬ : ¬'+%trim(NICTP4)+'¬, '
        +'¬nictnv4¬ : ¬'+%trim(NICTNV4)+'¬, '
        +'¬errMsg¬ : ¬'+%trim(Error)+'¬, ';
      /end-free
      * JSONfix escaper " i tekst,  for deretter å bytte ¬->"
     c                   call      'JSONFIX'
     c                   parm                    JSONstring
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      *
      * ............................................................................................
      * Skriv JSON-LISTE Start (en liste er EN parameter(fra [ til   )
      * ............................................................................................
     c                   eval      JSONstring ='"orderupdate" : ['
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      * ............................................................................................
      * Skriv JSON-Liste/Array  Avslutning
      * ............................................................................................
     c                   eval      JSONstring =']'
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      * ............................................................................................
      * Skriv JSON-string Avsluttning
      * ............................................................................................
     c                   eval      JSONstring ='}'
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      *
      * Quit
     C                   exsr      Exit


      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Lukk fil
     C                   CLOSE     BRIDF
     C  N50              CLOSE     TRIH
     C  N50              CLOSE     TRIHFS
     C  N50              CLOSE     TRIHPK
     C  N50              CLOSE     KODTSI
     C  N50              CLOSE     KODTSI1

      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      * Quit
     C                   MOVE      *ON           *INLR
     C                   return
     C                   endsr
      *
      *********************************************************
     C     Parse         Begsr
      *********************************************************
     C                   EVAL      FS       = *BLANKS
     C                   EVAL      PK       = *BLANKS
      * Get input
     C                   EVAL      WSUSER   = zhbgetvar('USER')
     C                   EVAL      TIAVD_A  = zhbgetvar('TIAVD')
     C                   EVAL      TIAVD    = c2n2(TIAVD_A)
     C                   EVAL      TITDN_A  = zhbgetvar('TITDN')
     C                   EVAL      TITDN    = c2n2(TITDN_A)
     C                   EVAL      WMODE    = zhbgetvar('MODE')
     C                   EVAL      TISG     = zhbgetvar('TISG')
     C                   EVAL      TIST     = zhbgetvar('TIST')
     C                   EVAL      TIENKL   = zhbgetvar('TIENKL')
     C*                  EVAL      TITARF   = zhbgetvar('TITARF')
     C                   EVAL      NIVPOS_A = zhbgetvar('NIVPOS')
     C                   EVAL      NIVPOS   = c2n2(NIVPOS_A)
     C                   EVAL      NINTK_A  = zhbgetvar('NINTK')
     C                   EVAL      NINTK    = c2n2(NINTK_A)
     C                   EVAL      NIVKB_A  = zhbgetvar('NIVKB')
     C                   EVAL      NIVKB    = c2n2(NIVKB_A)
     C                   EVAL      NIDFST   = zhbgetvar('NIDFST')
     C                   EVAL      NIDANT_A = zhbgetvar('NIDANT')
     C                   EVAL      NIDANT   = c2n2(NIDANT_A)
     C                   EVAL      NIDFKD1  = zhbgetvar('NIDFKD')
     C                   EVAL      NIDFSK1  = zhbgetvar('NIDFSK')
     C                   EVAL      NIDFKD2  = zhbgetvar('NIDFKD2')
     C                   EVAL      NIDFSK2  = zhbgetvar('NIDFSK2')
     C                   EVAL      NIDFKD3  = zhbgetvar('NIDFKD3')
     C                   EVAL      NIDFSK3  = zhbgetvar('NIDFSK3')
     C                   EVAL      NIDFKD4  = zhbgetvar('NIDFKD4')
     C                   EVAL      NIDFSK4  = zhbgetvar('NIDFSK4')
     C                   EVAL      NIMN1    = zhbgetvar('NIMN1')
     C                   EVAL      NIMN2    = zhbgetvar('NIMN2')
     C                   EVAL      NIMNSK   = zhbgetvar('NIMNSK')
     C                   EVAL      NIKONF_A = zhbgetvar('NIKONF')
     C                   EVAL      NIKONF   = c2n2(NIKONF_A)
     C                   EVAL      NIFULF_A = zhbgetvar('NIFULF')
     C                   EVAL      NIFULF   = c2n2(NIFULF_A)
     C                   EVAL      NIDTL_A  = zhbgetvar('NIDTL')
     C                   EVAL      NIDTL    = c2n2(NIDTL_A)
     C                   EVAL      NICTB    = zhbgetvar('NICTB')
     C                   EVAL      NICTB2   = zhbgetvar('NICTB2')
     C                   EVAL      NICTSK   = zhbgetvar('NICTSK')
     C                   EVAL      NICTP1   = zhbgetvar('NICTP')
     C                   EVAL      NICTNV1  = zhbgetvar('NICTNV')
     C                   EVAL      NICTP2   = zhbgetvar('NICTP2')
     C                   EVAL      NICTNV2  = zhbgetvar('NICTNV2')
     C                   EVAL      NICTP3   = zhbgetvar('NICTP3')
     C                   EVAL      NICTNV3  = zhbgetvar('NICTNV3')
     C                   EVAL      NICTP4   = zhbgetvar('NICTP4')
     C                   EVAL      NICTNV4  = zhbgetvar('NICTNV4')
     C*                  EVAL      TITUID   = zhbgetvar('TITUID')
     C*                  EVAL      TISGDK   = zhbgetvar('TISGDK')
     C*                  EVAL      TISGME   = zhbgetvar('TISGME')
     C*                  EVAL      TISGUT   = zhbgetvar('TISGUT')
     C*                  EVAL      TISGID   = zhbgetvar('TISGID')
     C*                  EVAL      TISGDT   = zhbgetvar('TISGDT')
     C*                  EVAL      TIBYTE_A = zhbgetvar('TIBYTE')
     C*                  EVAL      TIBYTE   = c2n2(TIBYTE_A)
     c                   ENDSR
      *********************************************************
     C     INIT          Begsr
      *********************************************************
     C                   OPEN      BRIDF
      * Test innlogging
     C     WSUSER        CHAIN     BRIDF                              50
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C                   call      BILIBL
     C                   end
      *
     C     KODTSIK       klist
     C                   kfld                    KSIUNI
     C                   kfld                    TISG
     C                   EVAL      KSIUNI = 'SI'
     C     TRIHKey       klist
     C                   kfld                    TIAVD
     C                   kfld                    TITDN
      *
     C   50              eval      Error = 'Invalid userID'
     C  N50              OPEN      TRIH
     C  N50              OPEN      TRIHFS
     C  N50              OPEN      TRIHPK
     C  N50              OPEN      KODTSI
     C  N50              OPEN      KODTSI1
      *_________________________________
      * Hæmta dagens datum och klockslag
      *"""""""""""""""""""""""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C  N50KODTSIK       CHAIN     KODTSI                             33
     C                   MOVEL     KSINAV        TITARF

     c                   endsr
      *
      *______________________________________________________
      * TEST                                             TEST
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     TEST          BEGSR
      * Hæmta userid
     C     WSUSER        CHAIN     KODTSI1                            55
      * Hæmta ærende
     C     TRIHKey       CHAIN     TRIH                               55
      * MODE U=Update
     C                   SELECT
     C     WMODE         WHENEQ    'S'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   eval      Error = *blanks
     C                   EXSR      SRS
     C                   ENDIF
     C     WMODE         WHENEQ    'U'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   eval      Error = *blanks
     C                   EXSR      SRU
     C                   ENDIF
     C                   OTHER
     C                   eval      Error = 'Wrong mode'
     C                   ENDSL
     C                   ENDSR
      *______________________________________________________
      * Skicka                                            SRS
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRS           BEGSR
     C                   eval      Error = *blanks
     C                   UPDATE    TRIHR
      *____________________
      * Skapa edifact + fil
      *""""""""""""""""""""
     C*                  CALL      'DKX063R'
     C*                  PARM                    TIAVD
     C*                  PARM                    TITDN
     C*                  PARM      '044'         X1N07             3
     C*                  PARM                    UFLAGG            1 0
      * Sendeprogram
     C                   MOVEL     WDT           WSDT
     C                   MOVEL     WTM           WSTD
     C                   CALL      'TTCI063R'
     C                   PARM                    TIAVD
     C                   PARM                    TITDN
     C                   PARM      '044'         W1N07             3            Meldingsfunksjon
     C*                                     '007=Ankomstmelding'
     C*                                     '044=Lossemerknader'
     C                   PARM                    WSDT              8 0          Sendningsdato
     C                   PARM                    WSTD              6 0          Sendningstid
     C                   PARM                    WVEN              1            Ventekode
     C                   PARM                    W0035             1            Testindikator
     C                   ENDSR
      *______________________________________________________
      * Update                                            SRU
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRU           BEGSR
      *                  EVAL      X_TISG   = TISG
     C**                 EVAL      X_TIST   = TIST
      *                  EVAL      X_TIDT   = TIDT
      *                  EVAL      X_TITUID = TITUID
     C                   EVAL      X_TITARF = TITARF
     C                   EVAL      X_TIMF   = '044'
     C*                  EVAL      X_TIMP   = TIMP
     C*                  EVAL      X_TIKDV  = TIKDV
     C*                  EVAL      X_TI0035 = TI0035
     C*                  EVAL      X_TISGDK = TISGDK
     C*                  EVAL      X_TISGUT = TISGUT
     C*                  EVAL      X_TISGID = TISGID
     C*                  EVAL      X_TISGDT = TISGDT
     C*                  EVAL      X_TIBYTE = TIBYTE
     C                   EVAL      X_NIVPOS = NIVPOS
     C                   EVAL      X_NINTK  = NINTK
     C                   EVAL      X_NIVKB  = NIVKB
     C                   EVAL      X_NIDFST = NIDFST
     C                   EVAL      X_NIDANT = NIDANT
     C                   EVAL      X_NIDFKD = NIDFKD1
     C                   EVAL      X_NIDFSK = NIDFSK1
     C                   EVAL      X_NIMN1  = NIMN1
     C                   EVAL      X_NIMN2  = NIMN2
     C                   EVAL      X_NIMNSK = NIMNSK
     C                   EVAL      X_NIKONF = NIKONF
     C                   EVAL      X_NIFULF = NIFULF
     C                   EVAL      X_NIDTL  = NIDTL
     C                   EVAL      X_NICTB  = NICTB
     C                   EVAL      X_NICTB2 = NICTB2
     C                   EVAL      X_NICTSK = NICTSK
     C                   EVAL      X_NICTP  = NICTP1
     C                   EVAL      X_NICTNV = NICTNV1
     C                   UPDATE    TRIHR
      *
     C     TRIHKey       SETLL     TRIHFS
     C     TRIHKey       READE     TRIHFS                                 33
     C                   Z-ADD     1             XN                3 0
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   EVAL      XH_NIDFKD  = %SUBST(FS(XN):1:20)
     C                   EVAL      XH_NIDFSK  = %SUBST(FS(XN):21:2)
     C                   UPDATE    TRIHFSR
     C     TRIHKey       READE     TRIHFS                                 33
     C                   ENDDO
     C                   EVAL      XH_TIAVD   = X_TIAVD
     C                   EVAL      XH_TITDN   = X_TITDN
     C                   EVAL      XH_TIDFKD  = *BLANKS
     C                   EVAL      XH_TIDFSK  = *BLANKS
     C                   ADD       1             XN                3 0
     C     XN            DO        4             XN2               3 0
     C                   IF        FS(XN) <> *BLANKS
     C                   EVAL      XH_NIDFKD  = %SUBST(FS(XN2):23:20)
     C                   EVAL      XH_NIDFSK  = %SUBST(FS(XN2):43:2)
     C                   WRITE     TRIHFSR
     C                   END
     C                   ENDDO
      *
     C     TRIHKey       SETLL     TRIHPK
     C     TRIHKey       READE     TRIHPK                                 33
     C                   DOW       *IN33 = *OFF
     C                   DELETE    TRIHPKR
     C     TRIHKey       READE     TRIHPK                                 33
     C                   ENDDO
     C                   EVAL      XH_TIAVD   = X_TIAVD
     C                   EVAL      XH_TITDN   = X_TITDN
     C     1             DO        4             XN                3 0
     C                   IF        PK(XN) <> *BLANKS
     C                   EVAL      XH_NICTP   = %SUBST(PK(XN):1:35)
     C                   EVAL      XH_NICTNV  = %SUBST(PK(XN):25:15)
     C                   WRITE     TRIHPKR
     C                   END
     C                   ENDDO
      *
     C                   ENDSR
