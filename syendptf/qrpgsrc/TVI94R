********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 TOLLSTEDSKODE ER ENDRET 4.0
10XXX * 02 YBC PTF10 VED NEGATIV BELØP PÅ EN SAMLELINJE, SKAL FORDELES ETTER BELØP
10XXX * 03 YBC PTF10 SLUTT DATO PÅ TOLLTARIFF
10024 * 04 YBC PTF10 KODE FOR SAMSLÅING
10262 * 05 YBC PTF10 SATS ER UTVIDERT TIL 7.2
10XXX * 06 YBC PTF10 FLYTT SVFT PÅ RIKTIG MÅTE
10318 * 07 YBC PTF10 VEKT ER ENDRET FRA 9.0 TIL 12.3
      *              VAREBESKRIVELSE ER ØKT FRA 15A TIL 30A
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11016 * 08 YBC PTF11 OMBEREGNING
11XXX * 09 YBC PTF11 STATISTISK VERDI MELLOM 0 OG 1 SETTES TIL 1
11101 * 10 YBC PTF11 5. LINJE FOR BEGRUNNELSE AV OMBEREGING
11176 * 11 YBC PTF11 TILLEGGSLINJER MED SAMME POST
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
12XXX * 12 YBC PTF12 SEND INNTASTET BETALINGSKODE VED OMBEREGNING
12064 * 13 YBC PTF12 FLERE BELØP ER ENDRET FOR Å TA STØRRE VERDI
12081 * 14 YBC PTF12 ALLE NYE LINJER FRA OMBEREGNING SKAL IKKE SLÅ SAMME
12XXX * 15 YBC PTF12 HENT/SEND CONTAINER FRA BL
12XXX * 16 YBC PTF12 Gå i loop pga. fordeling av andre kostnad
12XXX * 17 YBC PTF12 Send blank i betalekode ved ingen avgift
12XXX * 18 YBC PTF12 Fordeling andre kostnad
12121 * 19 YBC PTF12 Bevare betalekode i SEGKD slik at koden kan hentes ved omberegning
12XXX * 20 YBC PTF12 Max 3 ganger forsøk for fordeling av andre kostnad
12XXX * 21 TH  PTF12 enhetskode ligger nå i tariffen
12185 * 22 YBC PTF12 Containernr sendes på egen måte fra 01.05.2019
12199 * 23 YBC PTF12 Feil i omberegning. Linje blir ikke sendt ved første sammenslåtte
      *              er slettet og minst en av sammenslåtte linje ikke er slettet.
12201 * 24 YBC PTF12 CONTAINER ER I EGEN FIL
12165 * 25 CB  Send status til CW1
12XXX * 26 YBC PTF12 OMBEREGNING KAN HA EN TIDLIG DATO
12XXX * 27 YBC PTF12 FORSTÅ IKKE HVORFOR GJORT ENDRING 18. FJERN ENDRING 18.
12230 * 28 YBC PTF12 Preferanse
12XXX * 29 YBC PTF12 Mangle landkode på varelinje i WFILEEXP
12XXX * 30 YBC PTF12 Omberegning utløser avgift -> Send M for betalekode
12XXX * 31 YBC PTF12 Sett utgående linjenr for omberegning
12XXX * 32 YBC PTF12 Nullstille XLVN
12242 * 33 YBC PTF12 Endring 15 fjernes pga. containernr hentes i SAD052A og SAD052U
12248 * 34 YBC PTF12 VEKT, KOLLI ER UTVIDET.
12255 * 35 YBC PTF12 Fra midlertidig innførsel til ordinær utførsel
12XXX * 36 YBC PTF12 Grenseverdi 100 kr er FRA OG MED 100 kr.
12258 * 37 YBC PTF12 VF-KODE FRA OG MED 01.12.2021.
12XXX * 38 YBC PTF12 Prosedyre 34 krever landkode på linje
12201 * 39 YBC PTF12 Containernr sendes også i PCI0V2
12XXX * 40 YBC PTF12 Feilretting på endring 37. Test på feil dato.
12282 * 41 YBC PTF12 4 SIFFER PROSEDYRE OG 2 SIFFER TRANSAKSJONSTYPE
12285 * 42 YBC PTF12 Diverse rettelser på endring 41
12XXX * 43 YBC PTF12 Fristill SADV2
12295 * 44 YBC PTF12 Krav å sende opprinnelsesland ved DFO (innstikk)
12318 * 45 CB  PTF12 21 lange fakturanummer
********************************************************************
     FSADAVGE   IF   E           K DISK
     FEDIS      UF   E           K DISK
     FEDIMC     UF   E           K DISK
N26  FEDIM4     IF   E           K DISK    RENAME(EDIMR:EDIMR4)
N26  F                                     PREFIX(M4_)
S25  F*EADF     IF   E           K DISK
N25  FHEADF     UF   E           K DISK
N04  FSAEHTL    IF   E           K DISK
     FSAEH      UF   E           K DISK
N35  FSAEHMO    IF   E           K DISK
N08  FSAEHOM    IF   E           K DISK    RENAME(SAEHR:SAEHROM)
     FSAEV2     UF   E           K DISK
S04  F*SAEV4     IF   E           K DISK    RENAME(SAEVR:SAEVR4)
N04  FSAEV4     UF   E           K DISK    RENAME(SAEVR:SAEVR4)
     FWFILEEXP  UF A E           K DISK
     FEDIJ2     IF   E           K DISK
     FSAEF      IF   E           K DISK
N45  FSAEFFA    IF   E           K DISK
     FKODTVA    IF   E           K DISK
     FKODTLB    IF   E           K DISK
S01  F*KODTTST   IF   E           K DISK
     FSYPTFF    IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FKODTA     IF   E           K DISK
     FFIRM      IF   E           K DISK
     FTARI      IF   E           K DISK
N07  FSOKTARI2  IF   E           K DISK
     FEDII      IF   E           K DISK
     FEDISE     O  A E             DISK
N25  FFRISOK    IF   E           K DISK
     D TY              S              2    DIM(12)
     D SK              S              3    DIM(12)
S13  D*GL              S              9  0 DIM(12)
N13  D GL              S             11  0 DIM(12)
     D ST              S              6  3 DIM(12)
S13  D*BL              S              9  0 DIM(12)
N13  D BL              S             11  0 DIM(12)
     D T1              S              2    DIM(4)
S13  D*T2              S              9  0 DIM(4)
N13  D T2              S             11  0 DIM(4)
S33  D*MN              S             17    DIM(20)
S33  D*VS              S             25    DIM(20)
     D                 DS
     D  SEFT31                 1      3
     D  SEFT32                 5     45
     D  SEFT3                  1     45
N24  D                 DS
N24  D  CNR50                  1    850
N24  D  CNR                    1    850    DIM(50)
      *____________________
      * DS for input string
      *""""""""""""""""""""
     D                 DS
     D  A                      1     70
     D                                     DIM(70)                              Input string
     D  ADS                    1     70
      *_____________________
      * DS for output string
      *"""""""""""""""""""""
     D                 DS
     D  B                      1     80
     D                                     DIM(80)                              Output string
     D  SDATA                  1     80
      *________________________________________
      * DS for å venstrestille numeriske felter
      *""""""""""""""""""""""""""""""""""""""""
     D                 DS
     D  ØN163                  1     16  3
     D  ØA163H                 1     13
     D  ØA163X                 5     13
     D  ØA163D                14     16
     D                 DS
     D  ØA13                   1     13
     D  Ø13                    1     13
     D                                     DIM(13)                              Num edit
      *_________________
      * DS for FOReløbig
      *"""""""""""""""""
     D                 DS
     D  KO                     1      3
     D  TAORDK                 1      1
     D  TAEFTK                 2      2
     D  TAEFK                  3      3
S05  D*                DS
S05  D* TS                     1     15
S05  D* TAORDB                 1      5  2
S05  D* TAEFTB                 6     10  2
S05  D* TAEFB                 11     15  2
     D                 DS
     D  WFERNR                 1      5  0
     D  XN2                    2      5  0
N07  D                 DS
S34  D* WFEVKB                 1      9  0
S34  D* WFEVKB123              1     12  3
N34  D  WFEVKB                 1     11  0
N34  D  WFEVKB123              1     14  3
N07  D                 DS
S34  D* WFEVKN                 1      9  0
S34  D* WFEVKN123              1     12  3
N34  D  WFEVKN                 1     11  0
N34  D  WFEVKN123              1     14  3
     D                 DS
S07  D* WFEKN1                 1     17
S07  D* WFEKN2                18     34
S07  D* WFEKN3                35     51
S07  D* WFEKN4                52     68
S07  D* WFEKN5                69     85
S07  D* WFEKN6                86    102
S07  D* WFEKN7               103    119
S07  D* KN                     1    119    DIM(7) ASCEND                        Merke & nummer
N07  D  WFEKN1                 1     28
N07  D  WFEKN2                29     56
N07  D  WFEKN3                57     84
N07  D  WFEKN4                85    112
N07  D  WFEKN5               113    140
N07  D  WFEKN6               141    168
N07  D  WFEKN7               169    196
N07  D  KN                     1    196    DIM(7) ASCEND
     D                 DS
S07  D* WFEVB1                 1     15
S07  D* WFEVB2                16     30
S07  D* WFEVB3                31     45
S07  D* WFEVB4                46     60
S07  D* WFEVB5                61     75
S07  D* WFEVB6                76     90
S07  D* WFEVB7                91    105
S07  D* VB                     1    105
S07  D*                                    DIM(7) ASCEND                        Varebeskr
N07  D  WFEVB1                 1     30
N07  D  WFEVB2                31     60
N07  D  WFEVB3                61     90
N07  D  WFEVB4                91    120
N07  D  WFEVB5               121    150
N07  D  WFEVB6               151    180
N07  D  WFEVB7               181    210
N07  D  VB                     1    210    DIM(7) ASCEND                        Varebeskr
     D                 DS
     D  WFETO1                 1     45
     D  WFETO2                46     90
     D  WFETO3                91    135
     D  WFETO4               136    180
     D  WFETO5               181    225
N07  D  WFETO6               226    270
N07  D  WFETO7               271    315
N07  D  WFETO8               316    360
N07  D  WFETO9               361    405
N07  D  WFETO10              406    450
N07  D  WFETO11              451    495
N07  D  WFETO12              496    540
N07  D  WFETO13              541    585
N07  D  WFETO14              586    630
N07  D  WFETO15              631    675
S07  D* TO                     1    225    DIM(5)                               Til.opl
N07  D  TO                     1    675    DIM(15)                              Til.opl
     D                 DS
     D  WFETC1                 1      3
     D  WFETC2                 4      6
     D  WFETC3                 7      9
     D  WFETC4                10     12
     D  WFETC5                13     15
N07  D  WFETC6                16     18
N07  D  WFETC7                19     21
N07  D  WFETC8                22     24
N07  D  WFETC9                25     27
N07  D  WFETC10               28     30
N07  D  WFETC11               31     33
N07  D  WFETC12               34     36
N07  D  WFETC13               37     39
N07  D  WFETC14               40     42
N07  D  WFETC15               43     45
S07  D* TC                     1     15    DIM(5)                               Cref ved komm.
N07  D  TC                     1     45    DIM(15)                              Cref ved komm.
     D                 DS
     D  XDP1                   1      1  0
     D  SEDP                   1      2  0
N41  D  SEDP2                  3      4  0
N41  D  SEDP_4                 1      4  0
     D                 DS
     D  SVVNT                  1      8  0
     D  SVFYL                  9     10
     D  SVAVT                 11     11
     D  SVAVTS                12     14
S07  D* SVAVTP                15     17P 3
S07  D* XBRUD1                 1     17
N07  D  SVAVTP                15     21  3
N28  D  SVPRE                 22     22
N37  D  SVVF                  23     23
N37  D  XBRUD1                 1     23
S37  D* XBRUD1                 1     22
S28  D* XBRUD1                 1     21
     D                 DS
     D  SYRG                   1     14
     D  SYFORE                 1      9
N08  D                 DS
N08  D  SEFT01                 1     70
N08  D  SEFT02                71    140
N08  D  SEFT03               141    210
N08  D  SEFT04               211    280
N10  D  SEFT05               281    350
S10  D* FT0                    1    280    DIM(4)
N10  D  FT0                    1    350    DIM(5)
N35  D                 DS
N35  D  SETXT1                 1     70
N35  D  SETXT2                71    140
N35  D  SETXT3               141    210
N35  D  SETXT4               211    280
N35  D  SETXT5               281    350
N35  D  FT0MO                  1    350    DIM(5)
     D                 DS
     D  SVFT01                 1     28
     D  SVFT02                29     56
     D  SVFT03                57     84
     D  SVFT04                85    112
     D  SVFT05               113    140
     D  SVFT06               141    168
     D  SVFT07               169    196
     D  SVFT                   1    224    DIM(8)
     D                 DS
S34  D* SVNT01                 1      6  0
S34  D* SVNT02                 7     12  0
S34  D* SVNT03                13     18  0
S34  D* SVNT04                19     24  0
S34  D* SVNT05                25     30  0
S34  D* SVNT06                31     36  0
S34  D* SVNT07                37     42  0
S34  D* SVNT                   1     48  0 DIM(8)
N34  D  SVNT01                 1      9  0
N34  D  SVNT02                10     18  0
N34  D  SVNT03                19     27  0
N34  D  SVNT04                28     36  0
N34  D  SVNT05                37     45  0
N34  D  SVNT06                46     54  0
N34  D  SVNT07                55     63  0
N34  D  SVNT                   1     72  0 DIM(8)
     D                 DS
     D  SVEH01                 1      4
     D  SVEH02                 5      8
     D  SVEH03                 9     12
     D  SVEH04                13     16
     D  SVEH05                17     20
     D  SVEH06                21     24
     D  SVEH07                25     28
     D  SVEH                   1     32    DIM(8)
     D                 DS
     D  SVVT01                 1     30
     D  SVVT02                31     60
     D  SVVT03                61     90
     D  SVVT04                91    120
     D  SVVT05               121    150
     D  SVVT                   1    240    DIM(8)
     D                 DS
     D  SVTOP1                 1     17
     D  SVTOP2                18     34
     D  SVTOP3                35     51
     D  SVTOP4                52     68
     D  SVTOP5                69     85
     D  SVTOP6                86    102
     D  SVTOP7               103    119
     D  SVTOP8               120    136
     D  SVTOP9               137    153
     D  SVTOP10              154    170
     D  SVTOP                  1    187    DIM(11)
     D                 DS
     D  SVCRE1                 1      3
     D  SVCRE2                 4      6
     D  SVCRE3                 7      9
     D  SVCRE4                10     12
     D  SVCRE5                13     15
     D  SVCRE6                16     18
     D  SVCRE7                19     21
     D  SVCRE8                22     24
     D  SVCRE9                25     27
     D  SVCRE10               28     30
     D  SVTCR                  1     33    DIM(11)
     D                 DS
     D XFLE7L          C                   CONST('*** >7 LINJER ***')
      *//////////////
      *  Hodelogikk /
      *//////////////
      * Initiering av variabler og nøkler
     C                   EXSR      SRA
      * Initiering av sendingsutgang (IBM/NIT)
     C                   EXSR      SRB
      * Plukk SAD og send til Tollvesenet
     C                   EXSR      SRC
      * Avsluttning av sending
     C                   EXSR      SRD
     C                   MOVE      '1'           *INLR
      *
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    SSN           WSN
     C     *LIKE         DEFINE    S0036         W0036
     C     *LIKE         DEFINE    JCLFE         WCLFE
     C     *LIKE         DEFINE    MST           WST
     C     *LIKE         DEFINE    MVEN          WVEN
     C     *LIKE         DEFINE    TATAR         WATAR
      *
     C                   MOVE      '+'           WST
     C                   MOVE      *BLANKS       WVEN
     C                   MOVE      *BLANKS       WCLFE
     C                   MOVE      *BLANKS       WATAR
     C                   Z-ADD     0             ØX                2 0
     C                   MOVE      *BLANKS       ØAN              13
     C                   Z-ADD     0             W0074             7 0
     C                   Z-ADD     0             WORK             15 5
     C                   MOVEL     *BLANKS       UWS              10
     C                   MOVEL     'TVINN'       UWS
S07  C*                  MOVE      *BLANKS       BLAN15           15
S07  C*                  MOVE      *BLANKS       BLAN17           17
N07  C                   MOVE      *BLANKS       BLAN30           30
N07  C                   MOVE      *BLANKS       BLAN28           28
     C                   MOVE      'LB'          XLBUNI            2
S01  C*                  MOVE      'TST'         XTSUNI            3
     C                   MOVE      'VA'          XVAUNI            2
     C                   MOVE      *BLANKS       XTAR              3
     C                   MOVE      *BLANKS       SEFT3
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYA          KLIST
     C                   KFLD                    WSN
     C     KEYB          KLIST
     C                   KFLD                    SSR
     C                   KFLD                    WST
     C                   KFLD                    WVEN
     C                   KFLD                    S0004
     C                   KFLD                    S0010
     C                   KFLD                    S0035
     C     KEYC          KLIST
     C                   KFLD                    S0004
     C                   KFLD                    S0010
     C                   KFLD                    WCLFE
     C     KEYD          KLIST
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     C     AVGEK         KLIST
     C                   KFLD                    WFEVNT
     C                   KFLD                    AGAKD
     C                   KFLD                    WFEATS
     C                   MOVE      'FF'          AGAKD
     C     SAEV2K        KLIST
     C                   KFLD                    SEAVD
     C                   KFLD                    SETDN
     C     SAEV4K        KLIST
     C                   KFLD                    SEAVD
     C                   KFLD                    SETDN
     C                   KFLD                    WFERNR
     C     KODVAK        KLIST
     C                   KFLD                    XVAUNI
     C                   KFLD                    SEVAL1
     C     KODLBK        KLIST
     C                   KFLD                    XLBUNI
     C                   KFLD                    SELV
S01  C*    KODTSK        KLIST
S01  C*                  KFLD                    XTSUNI
S01  C*                  KFLD                    SEKDH
     C     TARIK         KLIST
     C                   KFLD                    WFEVNT
     C                   KFLD                    XTAR
     C     TARIKM        KLIST
     C                   KFLD                    WFEVNT
     C                   KFLD                    XTAR
     C                   KFLD                    XADATO
     C                   MOVE      99999999      XADATO            8 0
N26  C     TVIM4K2       KLIST
N26  C                   KFLD                    XSR
N26  C                   KFLD                    MAVD
N26  C                   KFLD                    MTDN
N26  C     *LIKE         DEFINE    MSR           XSR
N26  C                   MOVE      'R'           XSR
     C     WFKEY         KLIST
     C                   KFLD                    SEAVD
     C                   KFLD                    SETDN
     C                   KFLD                    XNR
     C     KODTAK        KLIST
     C                   KFLD                    KOAUNI
     C                   KFLD                    SEAVD
     C                   MOVE      'A'           KOAUNI
     C     CUND1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KOAKNR
N25  C     FRIKEN25      KLIST
N25  C                   KFLD                    SEAVD
N25  C                   KFLD                    SETDN
N25  C                   KFLD                    FSKODN25          3
N25  C                   MOVE      'N25'         FSKODN25
N45  C     SAEFFAK       KLIST
N45  C                   KFLD                    SFAVD
N45  C                   KFLD                    SFOPDN
N45  C                   KFLD                    SFTXT
N45  C                   KFLD                    SFDT
      *_____________
      * Init av felt
      *"""""""""""""
      * Hente dagens dato og klokkeslett.
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           WDT80             8 0
      * Workfields for Array's
     C                   Z-ADD     0             AX                2 0          Index for A
     C                   Z-ADD     1             BX                2 0          Index for B
     C                   Z-ADD     0             AXV               2 0          Leftindx A
     C                   Z-ADD     0             AXH               2 0          Rightindx A
     C                   MOVE      'R'           WDIR              1            Search direction
     C                   MOVE      *BLANKS       WCHAR             1            Test character
     C                   MOVE      'Y'           WCHART            1            Test character
     C                   MOVE      *BLANKS       WCONT             5            Continues
      * Workfields for separation character  '
     C                   BITON     '123457'      WAPSTR            1
     C                   BITOFF    '06'          WAPSTR
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C     WSN           PARM                    WSN
     C                   PARM                    WNETW             1
      *__________________
      * Output parametrer
      *""""""""""""""""""
     C     PLISTA        PLIST
     C                   PARM      S0004         S0004
     C                   PARM      S0010         S0010
N41  C     'TVI00011'    CHAIN     SYPTFF                             33
N41  C   33              Z-ADD     0             X_4SIFF           8 0
N41  C  N33              MOVE      PTFDT         X_4SIFF
N37  C     'TVI00010'    CHAIN     SYPTFF                             33
N37  C                   IF        *IN33
N37  C                   MOVE      'J'           XVF               1
N37  C                   ELSE
N37  C                   IF        WDT80 >= PTFDT
N37  C                   MOVE      'J'           XVF
N37  C                   ELSE
N37  C                   MOVE      'N'           XVF
N37  C                   END
N37  C                   END
S22  C*    'TVI00004'    CHAIN     SYPTFF                             33
N22  C     'TVI00007'    CHAIN     SYPTFF                             33
     C   33              MOVE      *ZEROS        PTFDT
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Start av file                                        SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
      *_____________________________
      * Hente data fra sendningslogg
      *"""""""""""""""""""""""""""""
     C     KEYA          CHAIN     EDIS                               81
     C                   MOVEL     SMBR          SEMBR
     C                   Z-ADD     0             W0036
      *_______________________________________________
      * Legg in JCL i starten av filen for Kommunedata
      *"""""""""""""""""""""""""""""""""""""""""""""""
     C                   SELECT
     C     WNETW         WHENEQ    '1'
      *
     C                   MOVE      'F'           WCLFE
     C     KEYC          CHAIN     EDIJ2                              81
     C     *IN81         DOWEQ     '0'
     C                   MOVE      JCLC          SDATA
     C                   WRITE     EDISER
     C     KEYC          READE     EDIJ2                                  81
     C  N81              END
     C                   ENDSL
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Les meldinger                                        SRC /
      *////////////////////////////////////////////////////////////
     C     SRC           BEGSR
      *_____________________________
      * Legg in UNB-segment (Sendningsstart)
      *_____________________________
     C                   EXSR      UNB0
      *
     C     KEYB          CHAIN     EDIMC                              8182
     C     *IN81         DOWEQ     '0'
     C  N82M0065         IFEQ      'CUSDEC'
     C     M1001         ANDEQ     '830'
     C     M1N07         IFEQ      'DFU'
     C     M1N07         OREQ      'DMA'
     C     M1N07         OREQ      'DKO'
     C     M1N07         OREQ      'DFO'
     C     M1N07         OREQ      'DEN'
S08  C*    M1N07         OREQ      'DOM'
N08  C     M1N07         OREQ      'DEB'
N08  C     M1N07         OREQ      'DRE'
N08  C     M1N07         OREQ      'DSO'
N26   * HENT FORTOLLINGSDATO
N26  C                   MOVE      MTDN          X_MTDN            7 0
N26  C                   IF        MTDN < 0
N26  C                   EVAL      MTDN = MTDN * -1
N26  C                   END
N26  C                   MOVE      *ZEROS        X_M0068A          8 0
N26  C     TVIM4K2       SETLL     EDIM4
N26  C     TVIM4K2       READE     EDIM4                                  33
N26  C                   IF        *IN33
N28   * Hent godkjeningsdato
N28  C     KEYD          CHAIN(N)  SAEH                               33
N26  C                   MOVE      *ZEROS        XAN02             2
N26  C                   IF        %SUBST(SEDTG:1:2) = '20'
N26  C                   EVAL      XAN02 = %SUBST(SEDTG:3:2)
N26  C                   MOVE      XAN02         XAAR
N28  C                   IF        %SUBST(SEDTG:3:1) >= '0' AND
N28  C                             %SUBST(SEDTG:3:1) <= '9'
N28  C                   EVAL      XAN02 = %SUBST(SEDTG:5:2)
N28  C                   MOVE      XAN02         XMND
N28  C                   EVAL      XAN02 = %SUBST(SEDTG:7:2)
N28  C                   MOVE      XAN02         XDAG
N28  C                   ELSE
N26  C                   EVAL      XAN02 = %SUBST(SEDTG:7:2)
N26  C                   MOVE      XAN02         XMND
N26  C                   EVAL      XAN02 = %SUBST(SEDTG:9:2)
N26  C                   MOVE      XAN02         XDAG
N28  C                   END
N26  C                   CALL      'TESTDATO'
N26  C                   PARM                    XDAG              2 0
N26  C                   PARM                    XMND              2 0
N26  C                   PARM                    XAAR              2 0
N26  C                   PARM                    FLAGG             1 0
N26  C                   IF        FLAGG <> 1
N26  C                   MOVEL     SEDTG         X_M0068A
N26  C                   END
N26  C                   END
N26  C                   ELSE
N26  C                   DOW       *IN33 = *OFF
N2801C*                  IF        M4_M1N07 = 'DTK' OR M4_M1N07 = 'DUA'
N2801C                   IF        (M4_M1N07 = 'DTK' OR M4_M1N07 = 'DUA')
N2801C                             AND M4_M1001 = '830'
N26  C                   MOVE      M4_M0068A     X_M0068A
N26  C                   LEAVE
N26  C                   END
N26  C     TVIM4K2       READE     EDIM4                                  33
N26  C                   ENDDO
N26  C                   END
N26  C                   EVAL      MTDN = X_MTDN
N26   *
     C     KEYD          CHAIN     SAEH                               82
     C     *IN82         IFEQ      '0'
N26  C                   IF        X_M0068A = 0
N26  C                   MOVE      M0068A        X_M0068A
N26  C                   END
N04  C     KEYD          CHAIN     SAEHTL                             33
N04  C   33              EVAL      SESAM = 'J'
     C                   MOVE      'A'           SEST
     C                   UPDATE    SAEHR
     C                   Z-ADD     SSN           MSN
     C                   MOVE      'A'           MST
     C                   MOVEL     WDT           MDT
     C                   MOVEL     WTM           MTM
     C                   UPDATE    EDIMR
     C                   EXSR      PRINT
     C                   END
     C                   END
     C                   END
     C                   MOVEA     '00'          *IN(81)
     C     KEYB          READE     EDIMC                                8281
     C  N81              END
      *_____________________________
      * Legg in UNZ (Slutt sendning)
      *"""""""""""""""""""""""""""""
     C                   EXSR      UNZ0
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Slutt på file                                        SRD /
      *////////////////////////////////////////////////////////////
     C     SRD           BEGSR
      *________________________
      * Oppdatere sendningslogg
      *""""""""""""""""""""""""
     C                   MOVE      'A'           SST
     C                   Z-ADD     W0036         S0036
     C                   UPDATE    EDISR
      *_______________________________________________
      * Legg in JCL i slutten av filen for Kommunedata
      *"""""""""""""""""""""""""""""""""""""""""""""""
     C     WNETW         IFEQ      '1'
     C                   MOVE      'E'           WCLFE
     C     KEYC          CHAIN     EDIJ2                              81
     C     *IN81         DOWEQ     '0'
     C                   MOVE      JCLC          SDATA
     C                   WRITE     EDISER
     C     KEYC          READE     EDIJ2                                  81
     C  N81              END
     C                   END
     C                   ENDSR
      */////////////////////////////////////////////////////////////
      * Skriv ut Tolldeklarasjon, denne delen er hentet fra SAD52P /
      * Her skrive UNH, BGM og UNT segment                         /
      */////////////////////////////////////////////////////////////
     C     PRINT         BEGSR
N08  C                   IF        MTDN < 0
N08  C     KEYD          CHAIN     SAEHOM                             33
N08  C                   END
N35   * Sjekk om oppdrag er relatert til midlertidig fortolling
N35  C                   IF        SEDP >= 30 AND SEDP <= 39
N35  C  N33KEYD          CHAIN     SAEHMO                             33
N35  C  N33SESTMO        COMP      ' '                                3333
N35  C                   ELSE
N35  C                   EVAL      *IN33 = *ON
N35  C                   END
N35  C   33              EVAL      SETLE1 = *BLANKS
N35  C   33              EVAL      SETLL1 = *BLANKS
     C                   CLEAR                   WFILEER
S34  C*                  MOVE      *ZEROS        XVNTM             9 0
N34  C                   MOVE      *ZEROS        XVNTM            11 0
S22  C*    PTFDT         IFLE      WDT80
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
     C     KODTAK        CHAIN     KODTA                              33
     C     CUND1K        CHAIN     CUNDL01                            33
S22  C*                  END
     C                   EXSR      UNH0
     C                   EXSR      BGM0
     C     SEMF          IFEQ      'DFO'
     C                   EXSR      PRINTF
     C                   ELSE
      *__________________________________
      * Sette nødvendige indkatorer på/av
      *""""""""""""""""""""""""""""""""""
N02  C                   MOVE      'N'           XFDVEKT           1
N20  C                   Z-ADD     0             XANTFD            1 0
N02  C     STSUMVAR      TAG
     C                   EXSR      SETIN1
      *_____________________________________________________________
      * I SUMVAR gjøres nødvendige beregninger (summerer varelinjer)
      * og skriver ut på filen WFILEEXP
      *"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C                   EXSR      SUMVAR
N02  C                   IF        XFDVEKT = 'Y'
N20  C                             AND XANTFD < 3
N02  C                   EVAL      XFDVEKT = 'J'
N02  C     SAEV2K        SETLL     WFILEEXP                           33
N02  C     SAEV2K        READE     WFILEEXP                               33
N02  C                   DOW       *IN33 = *OFF
N02  C                   DELETE    WFILEER
N02  C     SAEV2K        READE     WFILEEXP                               33
N02  C                   ENDDO
N20  C                   ADD       1             XANTFD
N02  C                   GOTO      STSUMVAR
N02  C                   END
      *___________________________________
      * Sette nødvendige indikatorer på/av
      *"""""""""""""""""""""""""""""""""""
     C                   EXSR      SETIN2
      *________________________________
      * Skrive tolldekl. til EDIFACT-fil
      *""""""""""""""""""""""""""""""""
     C                   EXSR      PRINT2
     C                   END
     C                   EXSR      UNT0
N25  C     KEYD          CHAIN(N)  HEADF
N25  C                   IF        TRSTA3=*BLANKS
N25  C     FRIKEN25      CHAIN     FRISOK
N25  C                   IF        %FOUND(FRISOK)
N25  C                   EXSR      N25SR1
N25  C                   ENDIF
N25  C                   ENDIF
      *
     C                   ENDSR
      */////////////////////////////////////////////////////////////
      * Sette nødvendige indikatorer på/av                         /
      */////////////////////////////////////////////////////////////
     C     SETIN1        BEGSR
     C*
      * Hente omregningsfaktor av valuta for faktura
     C     KODVAK        CHAIN     KODTVA                             33
     C   33              MOVE      *ZEROS        KVAOMR
      * Hente tekst til leveringsbetingelse
     C     KODLBK        CHAIN     KODTLB                             33
     C  N33              MOVE      KLBKT         SELV2
     C*
     C                   MOVE      *ZEROS        XNR               5 0
     C                   MOVE      *ZEROS        XN2               4 0
     C                   MOVE      *ZEROS        XN3               5 0
     C                   MOVE      *ZEROS        XTOTT             9 0
      * XTOLKL skal inneholde spesifiserte kolli
     C                   MOVE      *ZEROS        XTOTKL            6 0
      * 50 PÅ ---> Skrive andre kostnad (justering)
      * 64 PÅ ---> Skrive fortegn for justering
     C     SEBEL3        COMP      0                                  5050
     C   50SEFTG2        COMP      '-'                                    64
     C   50
     CANN64SEFTG2        COMP      'M'                                    64
      *
     C                   ENDSR
      */////////////////////////////////////////////////////////////
      * I SUMVAR gjøres nødvendige beregninger (summerer varelinjer)
      * og skriver ut på filen WFILEEXP
      */////////////////////////////////////////////////////////////
     C     SUMVAR        BEGSR
S33  C*                  IF        SEUR = 'G'
S33  C*                  CALL      'SAD61PBL'
S33  C*                  PARM      SEAVD         UAVD2             4 0
S33  C*                  PARM      SETDN         UOPD              7 0
S33  C*                  PARM                    UNR               2 0
S33  C*                  PARM                    MN
S33  C*                  PARM                    UN2               2 0
S33  C*                  PARM                    VS
S33  C*                  END
S33  C*
N08  C                   MOVE      'J'           XORI              1
N08  C                   MOVE      'J'           XTOTSLT           1
      * XBEL1 = Fakturasum +/- frakt
     C     SEBEL2        IFEQ      0                                            1<-B
     C     SEFTG2        OREQ      'P'
     C     SEFTG2        OREQ      'M'
     C                   Z-ADD     0             XBEL1            13 2
     C                   ELSE                                                   1
     C     SEVAL2        IFEQ      SEVAL1                                         2<-B
     C                   Z-ADD     SEBEL2        XBEL1
     C                   ELSE                                                     2
     C     SEVKU         IFNE      0
     C     SEBEL3        DIV       SEVKU         XWORK
     C     XWORK         MULT      KVAOMR        XBEL1
     C                   ELSE
     C                   Z-ADD     SEBEL3        XBEL1
     C                   END
     C                   END                                                      2<-E
     C                   END                                                    1<-E
     C     SEFTG2        IFEQ      '-'
     C     SEFTG2        OREQ      'M'
     C     SEBEL1        SUB       XBEL1         XBEL1
     C                   ELSE
     C     SEBEL1        ADD       XBEL1         XBEL1
     C                   END
      * Omregne fakturasum +/- frakt til NOK
     C     XBEL1         IFNE      0
     C     XBEL1         DIV       KVAOMR        XWORK            15 5
     C     XWORK         MULT(H)   SEVKU         XSUMSV           11 0
     C                   END
N04   *
N04   * OPPDATER LINJENR
S08  C*                  IF        SESAM = 'N'
N08  C                   IF        SESAM = 'N' AND SETDN > 0
N04   * OMNUMMERE LINJENR
N04  C                   MOVE      *ZEROS        XVLN1             5 0
N04  C                   MOVE      *ZEROS        XVLN2             5 0
N04  C     SAEV2K        SETLL     SAEV4
N04  C     SAEV2K        READE     SAEV4                                  33
N04  C                   DOW       *IN33 = *OFF
N04  C                   IF        SVLN <> 0
N04  C                   IF        ((SVLN = XVLN2) OR (SVVKTB = 0))
N04  C                   EVAL      SVLN  = XVLN1
N04  C                   ELSE
N04  C                   EVAL      XVLN2 = SVLN
N04  C                   ADD       1             XVLN1
N04  C                   EVAL      SVLN  = XVLN1
N04  C                   END
N04  C                   END
N04  C                   EXCEPT    SAEVL4
N04  C     SAEV2K        READE     SAEV4                                  33
N04  C                   ENDDO
N31  C                   ELSE
N31  C                   IF        SETDN < 0
N31   * OPPDATER UTGÅENDE LINJENR FOR NYE OMBEREGNINGSLINJE
N31  C     SAEV2K        SETLL     SAEV4
N31  C     SAEV2K        READE     SAEV4                                  33
N31  C                   DOW       *IN33 = *OFF
N31  C                   IF        SVNYL = ' ' OR SVNYL = 'S'                   OPPRINNELIG LINJE
N31  C                   EVAL      XVLN = SVLN
N31  C                   ELSE
N31  C                   EVAL      XVLN = XVLN + 1
N31  C                   EVAL      SVLN = XVLN
N31  C                   END
N31  C                   EXCEPT    SAEVL4
N31  C     SAEV2K        READE     SAEV4                                  33
N31  C                   ENDDO
N31  C                   END
N04  C                   END
      *
N04  C                   IF        SESAM = 'N'
N04  C                   MOVE      *ZEROS        XVLN              5 0
N04  C     SAEV2K        SETLL     SAEV4
N04  C                   ELSE
S07  C*                  MOVE      *BLANKS       XBRUD2           17
S28  C*                  MOVE      *BLANKS       XBRUD2           21
S37  C*                  MOVE      *BLANKS       XBRUD2           22
N37  C                   MOVE      *BLANKS       XBRUD2           23
N32  C                   MOVE      *ZEROS        XVLN              5 0
     C     SAEV2K        SETLL     SAEV2
N04  C                   END
     C                   SETOFF                                       33
      *
      * Samslåing av varelinjer
     C     STSV          TAG
N04  C                   IF        SESAM = 'N'                                  1<-B
N14  C                             OR XORI <> 'J'
N04  C     SAEV2K        READE(N)  SAEV4                                  33
N08  C  N33              IF        XORI = 'J'                                    2<-B
N08  C                   IF        SVNYL = 'J'                                    3<-B
N14  C                             OR SVNYL = 'N' OR SVNYL = 'D'
N08  C                   GOTO      STSV
N08  C                   END                                                      3<-E
N08  C                   ELSE                                                    2
N14  C                   IF        XORI = 'G'                                     3<-B TIDLIGERE OMB
N14  C                   IF        SVNYL <> 'N' AND SVNYL <> 'D'                   4<-B
N14  C                   GOTO      STSV
N14  C                   END                                                       4<-E
N14  C                   ELSE                                                     3
N08  C                   IF        SVNYL <> 'J'                                    4<-B
N08  C                   GOTO      STSV
N08  C                   END                                                       4<-E
N14  C                   END                                                      3<-E
N08  C                   END                                                     2<-E
N08  C   33              IF        SETDN < 0 AND XORI = 'J'                      2<-B
N14  C                             OR SETDN < 0 AND XORI = 'G'
N14  C                   IF        XORI = 'J'                                     3<-B
N14  C                   EVAL      XORI = 'G'
N14  C                   ELSE                                                     3
N08  C                   EVAL      XORI = 'N'
N14  C                   END                                                      3<-E
N08  C     SAEV2K        SETLL     SAEV4
N08  C                   GOTO      STSV
N08  C                   END                                                     2<-E
N04  C   33XVLN          IFNE      0                                             2<-B
N04  C                   EXSR      REGN
N04  C                   END                                                     2<-E
N04  C                   ELSE                                                   1
     C     SAEV2K        READE     SAEV2                                  33
N08  C  N33              IF        XORI = 'J'                                    2<-B
N08  C                   IF        SVNYL = 'J'                                    3<-B
N14  C                             OR SVNYL = 'N' OR SVNYL = 'D'
N43  C                   UPDATE    SAEVR
N08  C                   GOTO      STSV
N08  C                   END                                                      3<-E
N08  C                   ELSE                                                    2
N08  C                   IF        SVNYL <> 'J'                                   3<-B
N43  C                   UPDATE    SAEVR
N08  C                   GOTO      STSV
N08  C                   END                                                      3<-E
N08  C                   END                                                     2<-E
      * XBRUD2 <> BLANK ---> Siste samslåings linje skal til arb.fil
     C   33XBRUD2        IFNE      *BLANKS                                       2<-B
     C                   EXSR      REGN
N08  C                   IF        SETDN > 0 OR XORI <> 'J'                       3<-B
N02  C     XFDVEKT       CABEQ     'Y'           SLSV
N08  C                   END                                                      3<-E
     C                   END                                                     2<-E
N04  C                   END                                                    1<-E
N08  C   33              IF        SETDN < 0 AND XORI = 'J'                     1<-B
N14  C                             OR SETDN < 0 AND XORI = 'G'
N14  C                   IF        XORI = 'J'                                    2<-B
N14  C                   EVAL      XORI = 'G'                                   LES TIDLIGERE OMB
N14  C                   ELSE                                                    2
N08  C                   EVAL      XORI = 'N'
N14  C                   END                                                     2<-E
N08  C                   MOVE      *BLANKS       XBRUD2
S14  C*    SAEV2K        SETLL     SAEV2
N14  C     SAEV2K        SETLL     SAEV4
N08  C                   GOTO      STSV
N08  C                   END                                                    1<-E
     C   33              GOTO      SLSV
N14  C                   IF        SVNYL <> 'S'                                 1<-B
N14  C                             AND SVNYL <> 'D'
N08  C                   MOVE      'N'           XTOTSLT           1
N14  C                   END                                                    1<-E
      *
      * XBRUD2 = BLANK ---> Starte linjeteller med 1 ved 1. record
N04   * STARTER LINJETELLER MED 1 VED 1. RECORD
N04  C     SESAM         IFEQ      'N'
N14  C     XORI          ORNE      'J'
N04  C     XVLN          IFEQ      0
N04  C                   EXSR      FLYTT
N04  C                   ELSE
N04  C     XVLN          IFNE      SVLN
N04  C                   EXSR      REGN
N04  C                   EXSR      FLYTT
N04  C                   END
N04  C                   END
N04  C                   MOVE      SVLN          XVLN
N04  C                   ELSE
     C     XBRUD2        IFEQ      *BLANKS
     C                   EXSR      FLYTT
     C                   ELSE
     C                   MOVE      'N'           XUNR              1
     C     SVEH01        IFEQ      'U.NR'
     C     SVEH01        OREQ      'U-NR'
N22  C     SVEH01        OREQ      'U.'                                         WEB-KODE
N22  C     SVEH01        OREQ      'U-'
     C                   MOVE      'J'           XUNR
     C                   END
     C     XBRUD1        IFNE      XBRUD2
     C     XUNR          OREQ      'J'
      * Ved brudd oppdatere varelinje på arbeidsfil (WFILEEXP)
     C                   EXSR      REGN
N43  C                   IF        XFDVEKT = 'Y'
N43  C                   UPDATE    SAEVR
N43  C                   END
N02  C     XFDVEKT       CABEQ     'Y'           SLSV
     C                   EXSR      FLYTT
     C                   END
     C                   END
      *
     C                   Z-ADD     XNR           SVLN
     C                   EXCEPT    SAEVLN
      *
     C                   MOVE      XBRUD1        XBRUD2
N04  C                   END
N14   *
N14  C                   IF        SVNYL = 'S'
N14  C                             OR SVNYL = 'D'
N14  C                   GOTO      STSV
N14  C                   END
N23  C                   IF        WFENYL = 'S' AND SVNYL <> 'S'
N23  C                   MOVE      SVNYL         WFENYL
N23  C                   END
N15   *
S33  C* N49              IF        SEUR = 'G'
S33  C*    SV01          COMP      'B'                                    49
S33  C*                  END
      *
      * Hvis merke & nr. (containernr.) er ulik fra de foregående,
      * legges inn i array (KN).  Max. 7 linjer
     C     1             DO        7             XN2                            1<-B
     C                   IF        SVFT(XN2) <> *BLANKS                          2<-B
     C     1             DO        7             XN4                              3<-B
     C                   SELECT                                                    4<-B
     C                   WHEN      KN(XN4) = *BLANKS                               4
     C                   EVAL      KN(XN4) = SVFT(XN2)
N22  C                   SELECT                                                     5<-B
S24  C*                  WHEN      SVEH(XN2) = 'CONT' OR SVEH(XN2) = 'C-'           5
S24  C*                            OR SVEH(XN2) = 'C.'
S24  C*                  MOVE      'CONT'        KN(XN4)
N22  C                   WHEN      SVEH(XN2) = 'U.NR' OR SVEH(XN2) = 'U-NR'         5
N22  C                             OR SVEH(XN2) = 'U.' OR SVEH(XN2) = 'U-'
N22  C                   MOVE      'U-NR'        KN(XN4)
N22  C                   ENDSL                                                      5<-E
     C                   LEAVE
     C                   WHEN      KN(XN4) = SVFT(XN2)                             4
     C                   LEAVE
N22  C                   WHEN      %SUBST(KN(XN4):1:17) = %SUBST(SVFT(XN2):1:17)   4
N22  C                             AND SEKDC = '1'
N22  C                   LEAVE
     C                   WHEN      XN4 = 7                                         4
     C                   EVAL      KN(XN4) = XFLE7L
     C                   ENDSL                                                     4<-E
     C                   ENDDO                                                    3<-E
     C                   END                                                     2<-E
     C                   ENDDO                                                  1<-E
      *
      * Hvis vareslag er ulik fra de foregående,
      * legges inn i array (VB).  Max. 7 linjer
     C     STSV2B        TAG
     C     1             DO        7             XN2                            1<-B
     C                   IF        SVVT(XN2) <> *BLANKS                          2<-B
     C     1             DO        7             XN4                              3<-B
     C                   SELECT                                                    4<-B
     C                   WHEN      VB(XN4) = *BLANKS                               4
     C                   EVAL      VB(XN4) = SVVT(XN2)
     C                   LEAVE
     C                   WHEN      VB(XN4) = SVVT(XN2)                             4
     C                   LEAVE
     C                   ENDSL                                                     4<-E
     C                   ENDDO                                                    3<-E
     C                   END                                                     2<-E
     C                   ENDDO                                                  1<-E
      *
      * Enhets kode legges i WFEVT
     C     STSV2         TAG
     C     WFEVT         IFEQ      *BLANKS                                      1<-B
     C                   MOVE      SVEH01        WFEVT
     C                   END                                                    1<-E
N22  C     1             DO        7             XN2
N22  C     SVEH(XN2)     IFEQ      'U-NR'
N22  C     SVEH(XN2)     OREQ      'U.NR'
N22  C     SVEH(XN2)     OREQ      'U.'
N22  C     SVEH(XN2)     OREQ      'U-'
N22  C                   MOVE      SVEH(XN2)     WFEVT
N22  C                   LEAVE
N22  C                   END
N22  C                   ENDDO
      *
      * Summere antall enheter
     C     1             DO        7             XN2                            1<-B
     C                   EVAL      WFEANT = WFEANT + SVNT(XN2)
     C                   ENDDO                                                  1<-E
      *
      * Hvis tilleggsopplysninger er ulik fra de foregående,
      * legges inn i array (TO).  Max. 10 linjer
     C     1             DO        10            XN2                            1<-B
     C                   IF        SVTOP(XN2) <> *BLANKS                         2<-B
     C     1             DO        10            XN4                              3<-B
     C                   SELECT                                                    4<-B
     C                   WHEN      TO(XN4) = *BLANKS                               4
     C                   EVAL      TO(XN4) = SVTOP(XN2)
     C                   EVAL      TC(XN4) = SVTCR(XN2)
     C                   LEAVE
     C                   WHEN      TO(XN4) = SVTOP(XN2) AND TC(XN4) = SVTCR(XN2)   4
     C                   LEAVE
     C                   ENDSL                                                     4<-E
     C                   ENDDO                                                    3<-E
     C                   END                                                     2<-E
     C                   ENDDO                                                  1<-E
      *
     C     STSV3         TAG
      * Summere netto/brutto vekt
S07  C*                  ADD       SVVKTB        WFEVKB
S07  C*                  ADD       SVVKTN        WFEVKN
N07  C                   ADD       SVVKTB        WFEVKB123
N07  C                   ADD       SVVKTN        WFEVKN123
      * Summere mengde hvis prosedyre <> 0, 20 OG 80
S07  C*                  IF        WFENTM < 0
S07  C*                  IF        SVNTM < 0
     C                   ADD       SVNTM         WFENTM
S07  C*                  ELSE
S07  C*                  EVAL      WFENTM = WFENTM + SVNTM / -100
S07  C*                  END
S07  C*                  ELSE
S07  C*                  ADD       SVNTM         WFENTM
S07  C*                  END
      * Summere tollverdi ved utførsel
     C                   ADD       SVBELT        XESTB            13 2
      *
     C                   GOTO      STSV
      *
     C     SLSV          ENDSR
      *////////////////////////////////////////////////////////////
      * Sette nødvendige indikatorer på/av                        /
      *////////////////////////////////////////////////////////////
     C     SETIN2        BEGSR
      *
     C                   MOVE      *BLANKS       T1
     C                   MOVE      *ZEROS        T2
     C     SEFID         COMP      0                                  6161
     C     SEKDDK        COMP      'K'                                    52
      * FORELØPIG MÅ AVGIFT SENDES HVIS AVGIFT > 100
S36  C*    XTOTT         COMP      100                                84
N36  C     XTOTT         COMP      100                                84  84
      *
      * XRESKL skal inneholde 1 eller differanse mellom XTOTKL og SENTK
     C     SENTK         IFGT      XTOTKL
     C     SENTK         SUB       XTOTKL        XRESKL            6 0
     C                   ELSE
     C                   Z-ADD     1             XRESKL
     C                   END
     C                   MOVE      *ZEROS        XN2
     C                   MOVE      *ZEROS        XN3
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Skrive tolldekl. til EDIFACT-fil                          /
      *////////////////////////////////////////////////////////////
     C     PRINT2        BEGSR
      * Skrive ut meldingshode til EDIFACT-fil
     C                   EXSR      UTHODE
      * Seksjonskille
     C                   EXSR      UNSD
      * Skrive ut fakturainfomasjoner
N08  C                   IF        XTOTSLT = 'N'
     C                   EXSR      DMS0
      * Skrive ut meldingsvarelinjer til EDIFACT-fil
     C                   EXSR      UTVLIN
N08  C                   ELSE
N08  C                   EVAL      *IN90 = *OFF
N08  C                   END
      * Seksjonskille
     C                   EXSR      UNSS
      * Skrive ut meldingssumlinje til EDIFACT-fil
     C                   EXSR      UTSUML
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Skrive meldingshode til EDIFACT-fil                       /
      *////////////////////////////////////////////////////////////
     C     UTHODE        BEGSR
      * Tollstatus for gods
     C                   EXSR      CST0
      * Referanser
     C                   EXSR      RFF0
      * Stedsangivelse
     C                   EXSR      LOC0
      * Ønsket behandlingsdato, ekspedisjonsdato og bokføringsdato
     C                   EXSR      DTM0
      * Transportdetaljer
     C                   EXSR      TDT0
      * Generell indikator
     C                   EXSR      GIS0
      * Nødvendige dokumenter
     C                   EXSR      DCR0
      * Eksportør, mottaker, deklaranten, ekspedisjonsenhet hvor
      * deklatasjonen skal ekspederes og toll-/avgiftsbetaler
     C                   EXSR      NAD0
      * Kontaktinformasjon
     C                   EXSR      CTA0
      * Leveringsbetingelse
     C                   EXSR      TOD0
N35   * Relatert til midlertidig fortolling
N35  C                   IF        SETLE1 <> *BLANKS
N35  C                   EXSR      FTX0MO
N35  C                   END
N08   * Omberegning
N08  C                   IF        MTDN < 0
N08  C                   EXSR      FTX0
N08  C                   END
      * Fakturasum
     C                   EXSR      MOA0
      * Valuta
     C                   EXSR      CUX0
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Skrive meldingsvarelinjer til EDIFACT-fil                 /
      *////////////////////////////////////////////////////////////
     C     UTVLIN        BEGSR
      *
     C                   MOVE      *ZEROS        XN3
     C     SAEV2K        SETLL     WFILEEXP                           33
     C                   Z-ADD     4             XN4               5 0
     C                   MOVE      *ZEROS        XTOT             10 0
      *
     C     STPR2         TAG
      * Lese samslående post fra arbeidsfil
     C     SAEV2K        READE     WFILEEXP                               33
N08  C                   DOW       *IN33 = *OFF
N08  C                   IF        WFENYL <> 'S'
N14  C                             AND WFENYL <> 'D'
N08  C                   LEAVE
N08  C                   END
N08  C     SAEV2K        READE     WFILEEXP                               33
N08  C                   ENDDO
     C   33              GOTO      SLPR2
     C                   DELETE    WFILEER
      *
     C                   MOVE      *ZEROS        XN3
     C                   MOVE      *BLANKS       TY
     C                   MOVE      *BLANKS       SK
     C                   MOVE      *ZEROS        GL
     C                   MOVE      *ZEROS        ST
     C                   MOVE      *ZEROS        BL
N18   *
N18  C                   IF        *IN50
N27  C                             AND *IN50 = *OFF
N18  C     WFEVKB        DIV(H)    SEVKB         XWORK
N18  C     XWORK         MULT(H)   SEBEL3        WFEJUS
N18  C   64WFESTB        SUB       WFEJUS        WFESTB
N18  C  N64WFESTB        ADD       WFEJUS        WFESTB
N18  C                   IF        WFEBL <> 0
N18  C     WFESTB        MULT      WFEATP        XWORK
N18  C     AVGEK         SETLL     SADAVGE
N18  C     AVGEK         READE     SADAVGE                                61
N18  C     *IN61         DOWEQ     '0'
S26  C*    AGDTF         IFLE      M0068A
S26  C*    AGDTT         ANDGT     M0068A
N26  C     AGDTF         IFLE      X_M0068A
N26  C     AGDTT         ANDGT     X_M0068A
N18  C                   LEAVE
N18  C                   END
N18  C     AVGEK         READE     SADAVGE                                61
N18  C  N61              ENDDO
N18  C     *IN61         IFEQ      *OFF
N18  C     AGPP          ANDEQ     '%'
N18  C     XWORK         DIV(H)    100           WFEBL
N18  C                   ELSE
N18  C     XWORK         DIV(H)    1000          WFEBL
N18  C                   END
N18  C                   END
N18  C                   END
      *
      * Flytte avgift for torskefiskeriene til array for å skrive ut
      * (SKAL ALLTID!! SENDES PÅ LINJENIVÅ...)
     C     WFEBL         IFNE      0
     C                   ADD       1             XN3
     C                   MOVE      'FF'          TY(XN3)
E13  C                   Z-ADD     WFESTB        GL(XN3)
     C                   MOVE      WFEATS        SK(XN3)
     C                   Z-ADD     WFEATP        ST(XN3)
      *
     C     WFEBL         IFGT      0
     C                   Z-ADD     WFEBL         BL(XN3)
     C                   ADD       WFEBL         T2(4)
     C                   ELSE
     C                   MOVE      *ZEROS        BL(4)
     C                   END
      *
     C                   END
      *
      * Tollstatus for gods
     C                   EXSR      CST0V
      * Forpakning
     C                   EXSR      SJVBES
     C                   EXSR      PAC0V
      * Forpakningsidentifikasjon
     C     KN(7)         IFEQ      XFLE7L
     C                   EXSR      PCI0V2
     C                   ELSE
     C                   EXSR      PCI0V
     C                   END
      * Oppringelsesfylke
     C                   EXSR      LOC0V
      * Tollverdi
     C                   EXSR      MOA0V
      * Vekt og annen enhet
     C                   EXSR      MEA0V
      * Avgifter
     C                   EXSR      TAX0V
      * Nødvendige dokumenter
     C                   EXSR      DCR0V
      * Godsbeskrivelse (TAD-kode)
     C                   EXSR      GDS0V
      * Godsbeskrivelse
     C                   EXSR      FTX0V
      *
     C                   GOTO      STPR2
      *
     C     SLPR2         ENDSR
      *////////////////////////////////////////////////////////////
      * Skrive ut meldingssumlinje til EDIFACT-fil                /
      *////////////////////////////////////////////////////////////
     C     UTSUML        BEGSR
     C                   Z-ADD     0             XN3
      *
     C     T2(4)         IFGT      0
      * FORELØPIG MÅ AVGIFT SENDES HVIS AVGIFT > 0
     C                   ADD       1             XN3
     C                   MOVE      'FF'          T1(XN3)
     C                   MOVE      T2(4)         T2(XN3)
     C                   END
      *
     C     XN3           DOWLT     4
     C                   ADD       1             XN3
     C                   MOVE      *ZEROS        T2(XN3)
     C                   END
      *
     C     T2(1)         ADD       T2(2)         XTOT
     C                   ADD       T2(3)         XTOT
     C                   ADD       T2(4)         XTOT
      * Sum avgifter
     C     XTOT          IFGE      100                                          1<-B
     C                   EXSR      TAX0S
     C                   END
      * Kontroll totaler
     C                   EXSR      CNT0S
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Skrive ut meldingssumlinje til EDIFACT-fil                /
      *////////////////////////////////////////////////////////////
     C     REGN          BEGSR
N07  C                   IF        WFEVKB123 < 0.5
N07  C                   Z-ADD     1             WFEVKB
N07  C                   ELSE
N07  C                   ADD       0,5           WFEVKB123
N07  C                   END
N07  C                   IF        WFEVKN123 < 0.5
N07  C                   Z-ADD     1             WFEVKN
N07  C                   ELSE
N07  C                   ADD       0,5           WFEVKN123
N07  C                   END
N07   *
      * Beregne statistisk verdi
     C     XESTB         IFNE      0
     C     KVAOMR        IFEQ      0
     C                   Z-ADD(H)  XESTB         WFESTB
     C                   ELSE
     C     XESTB         DIV       KVAOMR        XWORK
     C     XWORK         MULT(H)   SEVKU         WFESTB
     C                   END
N03  C                   IF        WFESTB = 0
N03  C                   EVAL      WFESTB = 1
N03  C                   END
     C                   END
      *
      * 50 PÅ ---> Fordele andre kostnad etter vekt og legge det inn
      *            justering og summere det med statistisk verdi
S27  C*                  IF        *IN33 AND *IN33 = *OFF
N16  C                   IF        WFENYL <> 'S' AND WFENYL <> 'D'
N02  C   50              IF        XFDVEKT = 'J'
N02  C     XESTB         DIV(H)    SEBEL1        XWORK
N02  C                   ELSE
     C   50WFEVKB        DIV(H)    SEVKB         XWORK
N02  C                   END
     C   50XWORK         MULT(H)   SEBEL3        WFEJUS
     C   50
     CAN 64WFESTB        SUB       WFEJUS        WFESTB
     C   50
     CANN64WFESTB        ADD       WFEJUS        WFESTB
N02  C   50              IF        WFESTB <= 0
N20  C                             AND XANTFD < 3
N02  C                   MOVE      'Y'           XFDVEKT
N02  C                   END
N16  C                   END
S27  C*                  END
      *
      * Beregne avgift for fersk fisk
     C     XAVT          IFEQ      'X'
     C     WFESTB        MULT      WFEATP        XWORK
     C     AVGEK         SETLL     SADAVGE
     C     AVGEK         READE     SADAVGE                                61
     C     *IN61         DOWEQ     '0'
S26  C*    AGDTF         IFLE      M0068A
S26  C*    AGDTT         ANDGT     M0068A
N26  C     AGDTF         IFLE      X_M0068A
N26  C     AGDTT         ANDGT     X_M0068A
     C                   LEAVE
     C                   END
     C     AVGEK         READE     SADAVGE                                61
     C  N61              ENDDO
     C     *IN61         IFEQ      *OFF
     C     AGPP          ANDEQ     '%'
     C     XWORK         DIV(H)    100           WFEBL
     C                   ELSE
     C     XWORK         DIV(H)    1000          WFEBL
     C                   END
      *
     C     WFEBL         IFEQ      0
     C                   Z-ADD     -1            WFEBL
     C                   END
      *
     C                   END
      *
     C     SLREGN        TAG
S33  C* * 49 PÅ -> LEGGE MERKE & NR. FRA B/L TIL DENNE VARELINJEN
S33  C*  49              IF        SEUR = 'G'
S33  C*                  EXSR      UTBL
S33  C*                  EVAL      *IN49 = *OFF
S33  C*                  END
S33  C*
     C                   MOVE      XNR           WFERNR
      * Summere total kolli
     C                   ADD       WFEANT        XTOTKL
      * Skrive samslående linjer til arbeidsfil
     C     WFKEY         CHAIN     WFILEEXP                           61
     C   61              WRITE     WFILEER
      *
      *** SUMMERE FORSKJELLIGE AVGIFTER
     C     WFEBL         IFGT      0
     C                   ADD       WFEBL         XTOTT
     C                   END
     C*
     C                   ENDSR
S33   ******************************************
S33  C*    UTBL          BEGSR
S33   ******************************************
S33  C*                  Z-ADD     1             XN2
S33  C*                  DOW       XN2 <= 7                                     1<-B
S33  C*                  IF        KN(XN2) = *BLANKS                             2<-B
S33  C*                  GOTO      STUBL1
S33  C*                  ELSE                                                    2
S33  C*                  ADD       1             XN2
S33  C*                  END                                                     2<-E
S33  C*                  END                                                    1<-E
S33  C*    STUBL1        TAG
S33  C*                  Z-ADD     1             XN3
S33  C*                  DOW       XN3 <= 10                                    1<-B
S33  C*                  IF        TO(XN3) = *BLANKS                             2<-B
S33  C*                  GOTO      STUBL2
S33  C*                  ELSE                                                    2
S33  C*                  ADD       1             XN3
S33  C*                  END                                                     2<-E
S33  C*                  END                                                    1<-E
S33   *
S33  C*    STUBL2        TAG
S33  C*                  Z-ADD     1             UN2               2 0
S33   *
S33  C*                  DOW       UN2 <= UNR                                   1<-B
S33  C*                  IF        XN2 <= 7                                      2<-B
S33  C*                  Z-ADD     1             XN4
S33  C*                  DOW       XN4 <= 7                                       3<-B
S33  C*                  IF        MN(UN2) = KN(XN4)                               4<-B
S33  C*                  GOTO      STUBL3
S33  C*                  END                                                       4<-E
S33  C*                  ADD       1             XN4
S33  C*                  END                                                      3<-E
S33  C*                  EVAL      KN(XN2) = MN(UN2)
S33  C*                  ADD       1             XN2
S33  C*                  ELSE                                                    2
S33  C*                  IF        XN3 <= 10                                      3<-B
S33  C*                  EVAL      TO(XN3) = MN(UN2)
S33  C*                  ADD       1             UN2
S33  C*                  IF        UN2 > UNR                                       4<-B
S33  C*                  GOTO      SLUBL
S33  C*                  END                                                       4<-E
S33  C*                  EVAL      TO(XN3) = MN(UN2)
S33  C*                  ADD       1             XN3
S33  C*                  ELSE                                                     3
S33  C*                  GOTO      SLUBL
S33  C*                  END                                                      3<-E
S33  C*                  END                                                     2<-E
S33  C*    STUBL3        TAG
S33  C*                  ADD       1             UN2
S33  C*                  END                                                    1<-E
S33   *
S33  C*    SLUBL         ENDSR
S33   *
      *////////////////////////////////////////////////////////////
      *  Flytte hovedopplysninger fra hovedlinje til arbeidsvariabler
      *  og blanks de andre arbeidsvariabler
      *////////////////////////////////////////////////////////////
     C     FLYTT         BEGSR
     C                   MOVE      SVAVD         WFEAVD
     C                   MOVE      SVTDN         WFETDN
N08  C                   MOVE      SVNYL         WFENYL
     C                   ADD       1             XNR
     C                   Z-ADD     1             XN2
     C                   Z-ADD     1             XN3
      *
     C                   MOVE      SVAVT         XAVT              1
S07  C*                  MOVE      SVAVTP        WFEATP
N07  C                   Z-ADD     SVAVTP        WFEATP
     C                   MOVE      SVAVTS        WFEATS
     C                   MOVE      SVVNT         WFEVNT
N29  C                   IF        SVFYL = '91'
N44  C                             OR M1N07 = 'DFO'
N29  C                   MOVE      SVLK          WFEFYL
N29  C                   ELSE
     C                   MOVE      SVFYL         WFEFYL
N29  C                   END
N28  C                   MOVE      SVPRE         WFEPRE
N37  C                   MOVE      SVVF          WFEVF
     C                   MOVE      *ZEROS        WFEBL
     C                   MOVE      *BLANKS       KN
     C                   MOVE      *ZEROS        WFEANT
     C                   MOVE      *BLANKS       WFEVT
     C                   MOVE      *BLANKS       VB
     C                   MOVE      *BLANKS       TO
     C                   MOVE      *BLANKS       TC
     C                   MOVE      *ZEROS        WFEJUS
     C*
     C                   MOVE      *ZEROS        WFESTB
     C                   MOVE      *ZEROS        XESTB
     C                   MOVE      *ZEROS        WFESUM
S07  C*                  MOVE      *ZEROS        WFEVKB
S07  C*                  MOVE      *ZEROS        WFEVKN
N07  C                   MOVE      *ZEROS        WFEVKB123
N07  C                   MOVE      *ZEROS        WFEVKN123
     C                   MOVE      *ZEROS        WFENTM
     C                   MOVE      *ZEROS        XFLER7            1
     C*
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Sjekke om det finnes merke & nr.
      *////////////////////////////////////////////////////////////
     C     SJVBES        BEGSR
      * Teste om merke & nr. = blank. Hvis der, flytter 'ADR' inn.
     C                   SETOFF                                       33
S07  C*    BLAN17        LOOKUP    KN                                 33
N07  C     BLAN28        LOOKUP    KN                                 33
     C  N33              MOVEL     'ADR'         KN(1)
     C     WFEANT        IFEQ      0
     C     WFEVT         ANDEQ     *BLANKS
     C                   Z-ADD     XRESKL        WFEANT
     C     XNR           IFEQ      1
     C                   MOVE      'PK  '        WFEVT
     C                   ELSE
     C                   MOVEL     'EX  '        WFEVT
     C                   END
     C                   END
      *
     C                   SETOFF                                       33
      * Teste om vareslag = blank. Hvis det, flytter tekst fra
      * tolltariff inn.
S07  C*    BLAN15        LOOKUP    VB                                 33
N07  C     BLAN30        LOOKUP    VB                                 33
     C  N33              DO
     C     WFEVNT        COMP      0                                      33
S07  C* N33TARIK         CHAIN     TARI                               33
S07  C* N33              MOVE      TAALFA        VB(1)
N07  C                   IF        *IN33 = *OFF
N07  C     WFEVNT        CHAIN     SOKTARI2                           33
N07  C                   IF        *IN33
N07  C     TARIK         CHAIN     TARI                               33
N07  C  N33              EVAL      VB(1) = TAALFA
N07  C                   ELSE
N07  C                   EVAL      VB(1) = BESKR1
N07  C                   END
N07  C                   END
     C   33              DO
S25  C*    KEYD          CHAIN     HEADF                              33
N25  C     KEYD          CHAIN(N)  HEADF                              33
     C  N33HEVS1         IFNE      *BLANKS
S07  C*                  MOVEL     HEVS1         VB(1)
S07  C*                  MOVEL     HEVS2         VB(2)
N07  C                   EVAL      VB(1) = HEVS1
N07  C                   EVAL      VB(2) = HEVS2
     C                   END
     C                   END
     C                   END
     C                   SETOFF                                       33
     C*
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Sendningsstart                                      UNB0 /
      *////////////////////////////////////////////////////////////
     C     UNB0          BEGSR
      *__________________________________________________________________________
      * UNA SEGMENT (HVIS VIA EDB FUNDATOR, FJERNES AV EDBF VED SENDN. TIL TOLLV)
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     S0010         CHAIN     EDII                               33
     C     INNETW        IFEQ      'A'
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNA'         ADS
     C     ADS           CAT       ':+,?':0      ADS
     C     ADS           CAT       WAPSTR:1      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   ENDIF
      *______________
      * START SEGMENT
      *""""""""""""""
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNB+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *______________________
      * SYNTAX IDENTIFIKASJON
      *""""""""""""""""""""""
      * Identifikasjon og versjon
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNOA:1+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *____________________
      * OVERFØRINGSAVSENDER
      *""""""""""""""""""""
      * Identifikasjon
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     S0004         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C     S0004         CHAIN     EDII                               33
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     IN0007        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *____________________
      * OVERFØRINGSMOTTAKER
      *""""""""""""""""""""
      * Identifikasjon og Qualifier
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     S0010         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C     S0010         CHAIN     EDII                               33
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     IN0007        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *__________________________________________
      * DATO/TID FOR FREMSTILLING AV OVERFØRINGEN
      *""""""""""""""""""""""""""""""""""""""""""
      * Dato
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SDT           ADS
     C                   Z-ADD     3             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Tid
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     STM           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *________________________
      * OVERFØRINGENS REFERANSE
      *""""""""""""""""""""""""
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     S0020         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   EXSR      SRÅ
      *______________________________________________
      * APPLIKASJONSREFERANSE (Kun hvis nettverk=IBM)
      *""""""""""""""""""""""""""""""""""""""""""""""
     C     WNETW         IFEQ      '2'                                          <----------I
      *                                                               I
     C                   MOVE      *BLANKS       ADS                                       I
     C                   MOVEL     '++'          ADS                                       I
     C                   Z-ADD     1             AXV                                       I
     C                   Z-ADD     2             AXH                                       I
     C                   MOVE      'N'           WCHART                                    I
     C                   EXSR      SRÅ                                                     I
      *                                                               I
     C                   MOVE      *BLANKS       ADS                                       I
     C                   MOVEL     S0026         ADS                                       I
     C                   Z-ADD     1             AXV                                       I
     C                   Z-ADD     14            AXH                                       I
     C                   EXSR      SRÅ                                                     I
      *                                                               I
     C                   END                                                    <----------I
      *______________
      * TESTINDIKATOR
      *""""""""""""""
     C     S0035         IFGT      '0'                                          <----------I
     C                   MOVE      *BLANKS       ADS                                       I
     C                   SELECT
     C     WNETW         WHENEQ    '1'                                           <--------II
     C                   MOVEL     '++++++'      ADS                                      II
     C                   Z-ADD     1             AXV                                      II
     C                   Z-ADD     6             AXH                                      II
     C     WNETW         WHENEQ    '2'                                           <--------II
     C                   MOVEL     '++++'        ADS                                      II
     C                   Z-ADD     1             AXV                                      II
     C                   Z-ADD     4             AXH                                      II
     C                   OTHER                                                   <--------II
     C                   MOVEL     '++++++'      ADS                                      II
     C                   Z-ADD     1             AXV                                      II
     C                   Z-ADD     6             AXH                                      II
     C                   ENDSL                                                   <--------II
     C                   MOVE      'N'           WCHART                                    I
     C                   EXSR      SRÅ                                                     I
      *                                                               I
     C                   MOVE      *BLANKS       ADS                                       I
     C                   MOVEL     S0035         ADS                                       I
     C                   Z-ADD     1             AXV                                       I
     C                   Z-ADD     1             AXH                                       I
     C                   EXSR      SRÅ                                                     I
     C                   END                                                    <----------I
      *______________
      * SLUTT SEGMENT
      *""""""""""""""
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Meldingsstart                                       UNH0 /
      *////////////////////////////////////////////////////////////
     C     UNH0          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   Z-ADD     1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNH+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Meldingsreferanse
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M0062         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     14            AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Meldingstype  (= CUSDEC)
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M0065         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':1:902:U'    ADSX             16
     C                   MOVE      'N:NEP+  '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     15            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Felles referanse, deklarant-ID/dato/sekvensnr./versjonsnr.
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M0068         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     25            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Start på melding                                    BGM0 /
      *////////////////////////////////////////////////////////////
     C     BGM0          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'BGM+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M1001         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '++137:'      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Dato for documentutstedelse
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SDT           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':102+'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Meldingskode
     C                   MOVE      *BLANKS       ADS
     C                   Z-ADD     1             AXV
S08  C*    M1225         IFEQ      '18 '
S08  C*                  MOVEL     '18+ABE'      ADS
S08  C*                  Z-ADD     6             AXH
S08  C*                  MOVE      'N'           WCHART
S08  C*                  ELSE
     C                   MOVEL     M1225         ADS
     C                   Z-ADD     3             AXH
S08  C*                  END
     C                   EXSR      SRÅ
N08   * Omberegning
N08  C                   IF        MTDN < 0
N08  C                   EVAL      ADS = '+ABE:' + SETLE + SETLL
N08  C                   Z-ADD     1             AXV
N08  C                   Z-ADD     21            AXH
N08  C                   MOVE      'N'           WCHART
N08  C                   EXSR      SRÅ
N08  C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Tollstatus for gods                                 CST0 /
      *////////////////////////////////////////////////////////////
     C     CST0          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'CST++'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Deklarasjon (EU=EF/EFTA-land  EX=Ikke EF/EFTA-land)
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEDTY         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      * Deklarasjon (ekspedisjonstyep)
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     XDP1          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':104:1+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Transaksjonstype
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SETST         ADS
N41  C                   IF        SETST > 9
     C                   Z-ADD     1             AXV
N41  C                   ELSE
N41  C                   Z-ADD     2             AXV
N41  C                   END
S41  C*                  Z-ADD     1             AXH
N41  C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':112:NO1'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
N08   * Omberegning
N08  C                   IF        MTDN < 0
N08  C                   EVAL      ADS = '+' + SETYPE + ':110:NO1'
N08  C                   Z-ADD     1             AXV
N08  C                   Z-ADD     13            AXH
N08  C                   MOVE      'N'           WCHART
N08  C                   EXSR      SRÅ
N08  C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Referanser                                          RFF0 /
      *////////////////////////////////////////////////////////////
     C     RFF0          BEGSR
      *__________________________________________
      * Registreringnummer hos fylkesskattesjefen
      *""""""""""""""""""""""""""""""""""""""""""
      * Segmentnavn
S22  C*    PTFDT         IFLE      WDT80
     C     SEKTA         CABEQ     0             STRFF1
S22  C*                  END
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
S22  C*    PTFDT         IFGT      WDT80
S22  C*                  MOVEL     'RFF+VA:'     ADS
S22  C*                  ELSE
     C                   MOVEL     'RFF+CO:'     ADS
S22  C*                  END
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Referansenummer
     C                   MOVE      *BLANKS       ADS
S22  C*    PTFDT         IFGT      WDT80
S22  C*    SERG          IFEQ      *BLANKS
S22  C*                  Z-ADD     1             AXH
S22  C*                  ELSE
S22  C*                  MOVEL     SERG          ADS
S22  C*                  Z-ADD     9             AXH
S22  C*                  END
S22  C*                  Z-ADD     1             AXV
S22  C*                  EXSR      SRÅ
S22  C*                  ELSE
     C     SEKTA         IFEQ      0
     C                   MOVE      *BLANKS       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
     C                   ELSE
     C     SEKTC         IFNE      ' '
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEKTC         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
     C                   END
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEKTA         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   EXSR      SRÅ
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEKTB         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
     C                   END
S22  C*                  END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C     STRFF1        TAG
      *___________
      * Godsnummer
      *"""""""""""
      * Segmentnavn
     C     SEGN          IFNE      *BLANKS
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'RFF+XC:'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Referansenummer
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEGN          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   Z-ADD     15            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *____________
      * Konnosement
      *""""""""""""
      * Segmentnavn
     C     SEPOS         IFNE      *BLANKS
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'RFF+LAR:'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Referansenummer
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEPOS         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   END
     C                   END
N35   *___________
N35   * Relatert til midlertidig fortolling
N35   *"""""""""""
N35   * Segmentnavn
N35  C                   IF        SETLE1 <> *BLANKS
N35  C                   ADD       1             W0074
N35  C                   EVAL      ADS = 'RFF+AEI:'
N35  C                             + %TRIM(SETLE1) + %TRIM(SETLL1)
N35  C                   Z-ADD     1             AXV
N35  C                   Z-ADD     24            AXH
N35  C                   MOVE      'N'           WCHART
N35  C                   EXSR      SRÅ
N35   * Slutt segment
N35  C                   MOVE      *BLANKS       ADS
N35  C                   MOVEL     WAPSTR        ADS
N35  C                   Z-ADD     1             AXV
N35  C                   Z-ADD     1             AXH
N35  C                   MOVE      'N'           WCHART
N35  C                   EXSR      SRÅ
N35  C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Stedsangivelse                                      LOC0 /
      *////////////////////////////////////////////////////////////
     C     LOC0          BEGSR
      *_________________
      * Avsender land
      *"""""""""""""""""
      * Segmentnavn
      * Land ulik NO SKAL oppgis ved pros 2,4,18,81,90
     C     SEDP          IFEQ      2
     C     SEDP          OREQ      4
     C     SEDP          OREQ      18
N42  C     SEDP          OREQ      80
N42  C     X_M0068A      ANDGE     X_4SIFF
     C     SEDP          OREQ      81
N42  C     X_M0068A      ANDLT     X_4SIFF
     C     SEDP          OREQ      90
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'LOC+35:'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SELKA         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      *_________________
      * Bestemmelsesland
      *"""""""""""""""""
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'LOC+36:'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SELKB         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C     SLLOC0        TAG
      *__________________
      * Utførselstollsted
      *""""""""""""""""""
     C     SEKDH         IFNE      0
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'LOC+42:'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
S01  C*    KODTSK        CHAIN     KODTTST                            33
     C                   MOVE      *BLANKS       ADS
S01  C*                  MOVEL     KTSPNR        ADS
N01  C                   MOVEL     SEKDH         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      *____________________
      * Varens lagringssted
      *""""""""""""""""""""
     C     SEKDLS        IFNE      *BLANKS
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'LOC+14:'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEKDLS        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Dato                                                DTM0 /
      *////////////////////////////////////////////////////////////
     C     DTM0          BEGSR
      *_______________________
      * Ønsket behandlingsdato
      *"""""""""""""""""""""""
      * Segmentnavn
     C     M2005B        IFNE      0
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'DTM+256:'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M2005B        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':102'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Transportdetljer                                    TDT0 /
      *////////////////////////////////////////////////////////////
     C     TDT0          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'TDT+11++'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SETRM         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      *
     C     SETRM         IFNE      50
     C     SETRM         ANDNE     20
     C     SELKT         ANDNE     *BLANKS
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+:::::'      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SELKT         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
     C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Generell indikator                                  GIS0 /
      *////////////////////////////////////////////////////////////
     C     GIS0          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
      * Container
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'GIS+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEKDC         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Nødvendige dokumenter                               DCR0 /
      *////////////////////////////////////////////////////////////
     C     DCR0          BEGSR
      * Ikke i bruk
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Navn og adresser                                    NAD0 /
      *////////////////////////////////////////////////////////////
     C     NAD0          BEGSR
      *__________
      * Eksportør
      *""""""""""
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'NAD+EX+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Tollkreditnr.
S22  C*    PTFDT         IFGT      WDT80
S22  C* N52SEKTA         IFNE      0                                            1<-B
S22  C*    SEKTB         ORNE      0
S22  C*    SEKTC         IFNE      ' '
S22  C*                  MOVE      *BLANKS       ADS
S22  C*                  MOVEL     SEKTC         ADS
S22  C*                  Z-ADD     1             AXV
S22  C*                  Z-ADD     1             AXH
S22  C*                  EXSR      SRÅ
S22  C*                  END
S22   *
S22  C*                  MOVE      *BLANKS       ADS
S22  C*                  MOVEL     SEKTA         ADS
S22  C*                  Z-ADD     1             AXV
S22  C*                  Z-ADD     5             AXH
S22  C*                  EXSR      SRÅ
S22   *
S22  C*                  MOVE      *BLANKS       ADS
S22  C*                  MOVEL     SEKTB         ADS
S22  C*                  Z-ADD     1             AXV
S22  C*                  Z-ADD     2             AXH
S22  C*                  EXSR      SRÅ
S22   *
S22  C*                  MOVE      *BLANKS       ADS
S22  C*                  MOVEL     '::NO1'       ADS
S22  C*                  Z-ADD     1             AXV
S22  C*                  Z-ADD     5             AXH
S22  C*                  MOVE      'N'           WCHART
S22  C*                  EXSR      SRÅ
S22  C*                  END                                                    1<-E
S22   *
S22  C*                  MOVE      *BLANKS       ADS
S22  C*                  MOVEL     '+'           ADS
S22  C*                  Z-ADD     1             AXV
S22  C*                  Z-ADD     1             AXH
S22  C*                  MOVE      'N'           WCHART
S22  C*                  EXSR      SRÅ
S22   * Navn
S22  C*                  MOVE      *BLANKS       ADS
S22  C*                  MOVEL     SENAK         ADS
S22  C*                  Z-ADD     1             AXV
S22  C*                  Z-ADD     30            AXH
S22  C*                  EXSR      SRÅ
S22   * Adresse-1
S22  C*    SEADK1        IFEQ      *BLANKS                                      1<-B
S22  C*                  MOVEL     '.'           SEADK1
S22  C*                  END                                                    1<-E
S22  C*                  MOVE      *BLANKS       ADS
S22  C*                  MOVEL     ':'           ADS
S22  C*                  Z-ADD     1             AXV
S22  C*                  Z-ADD     1             AXH
S22  C*                  MOVE      'N'           WCHART
S22  C*                  EXSR      SRÅ
S22   *
S22  C*                  MOVE      *BLANKS       ADS
S22  C*                  MOVEL     SEADK1        ADS
S22  C*                  Z-ADD     1             AXV
S22  C*                  Z-ADD     30            AXH
S22  C*                  EXSR      SRÅ
S22   * Adresse-2
S22  C*    SEADK2        IFEQ      *BLANKS                                      1<-B
S22  C*                  MOVEL     '.'           SEADK2
S22  C*                  END                                                    1<-E
S22  C*                  MOVE      *BLANKS       ADS
S22  C*                  MOVEL     ':'           ADS
S22  C*                  Z-ADD     1             AXV
S22  C*                  Z-ADD     1             AXH
S22  C*                  MOVE      'N'           WCHART
S22  C*                  EXSR      SRÅ
S22   *
S22  C*                  MOVE      *BLANKS       ADS
S22  C*                  MOVEL     SEADK2        ADS
S22  C*                  Z-ADD     1             AXV
S22  C*                  Z-ADD     30            AXH
S22  C*                  EXSR      SRÅ
S22   * Adresse-3
S22  C*    SEADK3        IFEQ      *BLANKS                                      1<-B
S22  C*                  MOVEL     '.'           SEADK3
S22  C*                  END                                                    1<-E
S22  C*                  MOVE      *BLANKS       ADS
S22  C*                  MOVEL     ':'           ADS
S22  C*                  Z-ADD     1             AXV
S22  C*                  Z-ADD     1             AXH
S22  C*                  MOVE      'N'           WCHART
S22  C*                  EXSR      SRÅ
S22   *
S22  C*                  MOVE      *BLANKS       ADS
S22  C*                  MOVEL     SEADK3        ADS
S22  C*                  Z-ADD     1             AXV
S22  C*                  Z-ADD     30            AXH
S22  C*                  EXSR      SRÅ
S22  C*                  ELSE
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SERG          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     11            AXH
     C                   EXSR      SRÅ
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
S22  C*                  END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *_________
      * Mottaker
      *"""""""""
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'NAD+CN++'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Navn
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SENAS         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Adresse-1
     C                   MOVE      *BLANKS       ADS
     C     SEADS1        IFEQ      *BLANKS                                      1<-B
     C                   MOVEL     '.'           ADS
     C                   ELSE                                                   1
     C                   MOVEL     SEADS1        ADS
     C                   END                                                    1<-E
     C                   Z-ADD     1             AXV
     C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
      * Adresse-2
     C     SEADS2        IFNE      *BLANKS                                      1<-B
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEADS2        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
     C                   END                                                    1<-E
      * Adresse-3
     C     SEADS3        IFNE      *BLANKS                                      1<-B
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEADS3        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
     C                   END                                                    1<-E
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *__________
      * Deklarant
      *""""""""""
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'NAD+DT+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Kundenr. hos tollvesenet
     C                   MOVE      *BLANKS       ADS
S22  C*    PTFDT         IFGT      WDT80
S22  C*                  MOVEL     M3039D        ADS
S22  C*                  Z-ADD     1             AXV
S22  C*                  Z-ADD     8             AXH
S22  C*                  MOVE      'L'           WDIR
S22  C*                  ELSE
     C                   MOVEL     SYFORE        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
S22  C*                  END
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *________________________
      * Toll- og avgiftsbetaler
      *""""""""""""""""""""""""
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'NAD+AA+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Måneds-/dags-/kontantoppgjør
     C                   MOVE      *BLANKS       ADS
     C                   SELECT
     C     *IN84         WHENEQ    '1'
     C     SETST         ANDNE     0
     C     SEKTA         ANDEQ     0
     C                   MOVEL     'D'           ADS
     C     *IN84         WHENEQ    '0'
S17  C*    SETST         ANDNE     0
S17  C*    SEKTA         ANDEQ     0
S17  C*    SEKTC         ANDEQ     ' '
S17  C*                  IF        SETDN > 0
     C                   MOVEL     ' '           ADS
S17  C*                  ELSE
S17  C*                  MOVEL     SEKDDK        ADS
S17  C*                  END
     C     SEKDDK        WHENEQ    ' '
     C     SETST         ANDNE     0
     C                   MOVEL     'M'           ADS
     C     SEKDDK        WHENEQ    ' '
     C     SEKTC         ANDNE     '8'
     C     SEKTC         ANDNE     '9'
     C     SEKTA         ANDNE     0
     C                   MOVEL     'M'           ADS
     C                   OTHER
     C                   MOVEL     SEKDDK        ADS
     C                   ENDSL
N19   *
N19  C                   SELECT
N19  C                   WHEN      SETDN > 0
N19   * Bevare betalekode i SEGKD
N19  C     KEYD          CHAIN     SAEH                               33
N19  C  N33              SELECT
N19  C                   WHEN      A(1) = ' '
N19  C                   EVAL      SEGKD = 1
N19  C                   WHEN      A(1) = 'K'
N19  C                   EVAL      SEGKD = 2
N19  C                   WHEN      A(1) = 'D'
N19  C                   EVAL      SEGKD = 3
N19  C                   WHEN      A(1) = 'M'
N19  C                   EVAL      SEGKD = 4
N19  C                   OTHER
N19  C                   EVAL      SEGKD = 0
N19  C                   ENDSL
N19  C  N33              UPDATE    SAEHR
N19  C                   WHEN      SETDN < 0
N19   * Hent betalekode ved omberegning
N19  C                   SELECT
N19  C                   WHEN      SEGKD = 1
N19  C                   EVAL      A(1) = ' '
N19  C                   WHEN      SEGKD = 2
N19  C                   EVAL      A(1) = 'K'
N19  C                   WHEN      SEGKD = 3
N19  C                   EVAL      A(1) = 'D'
N19  C                   WHEN      SEGKD = 4
N19  C                   EVAL      A(1) = 'M'
N19  C                   ENDSL
N30  C                   IF        A(1) = ' ' AND SEKTA <> 0 AND *IN84
N30   * *IN84 -> AVGIFT > 100 (BETALES)
N30  C                   EVAL      A(1) = 'M'
N30  C                   END
N19  C                   ENDSL
N19   *
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *_____________________________________________________
      * Ekspedisjonsenhet hvor deklarasjonen skal ekspederes
      *"""""""""""""""""""""""""""""""""""""""""""""""""""""
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'NAD+EE+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Ekspedisjonsenhet
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M3039E        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Kontaktinformasjon                                  CTA0 /
      *////////////////////////////////////////////////////////////
     C     CTA0          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'CTA++'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SESG          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Leveringsbetingelser                                TOD0 /
      *////////////////////////////////////////////////////////////
     C     TOD0          BEGSR
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'TOD+++'      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Levereingsbetingelser, kodet
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SELV2         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':106:4+1'    ADSX             16
     C                   MOVE      '::::    '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     12            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Leveringsbetingelser
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SELVT         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     17            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
N08   *////////////////////////////////////////////////////////////
N08   *  Fritekster                                          FTX0 /
N08   *////////////////////////////////////////////////////////////
N08  C     FTX0          BEGSR
N08   * Segmentnavn
N08   * W0074  --->  Teller for antall segment
N08  C                   ADD       1             W0074
N08  C                   EVAL      ADS = 'FTX+AAH+++'
N08  C                   Z-ADD     1             AXV
N08  C                   Z-ADD     10            AXH
N08  C                   MOVE      'N'           WCHART
N08  C                   EXSR      SRÅ
N08   * Fritekst
N08  C                   EVAL      ADS = SEFT01
N08  C                   Z-ADD     1             AXV
N08  C                   Z-ADD     70            AXH
N08  C                   EXSR      SRÅ
N08   *
S10  C*    2             DO        4             XN3
N10  C     2             DO        5             XN3
N08  C                   IF        FT0(XN3) <> *BLANKS
N08  C                   ADD       1             W0074
N08  C                   EVAL      ADS = ':'
N08  C                   Z-ADD     1             AXV
N08  C                   Z-ADD     1             AXH
N08  C                   MOVE      'N'           WCHART
N08  C                   EXSR      SRÅ
N08  C                   EVAL      ADS = %TRIM(FT0(XN3))
N08  C                   Z-ADD     1             AXV
N08  C                   Z-ADD     70            AXH
N08  C*                  MOVE      'N'           WCHART
N08  C                   EXSR      SRÅ
N08  C                   END
N08  C                   ENDDO
N08   * Slutt segment
N08  C                   MOVE      *BLANKS       ADS
N08  C                   MOVEL     WAPSTR        ADS
N08  C                   Z-ADD     1             AXV
N08  C                   Z-ADD     1             AXH
N08  C                   MOVE      'N'           WCHART
N08  C                   EXSR      SRÅ
N08   *
N08  C                   ENDSR
N35   *////////////////////////////////////////////////////////////
N35   *  Fritekster                                        FTX0MO /
N35   *////////////////////////////////////////////////////////////
N35  C     FTX0MO        BEGSR
N35   * Segmentnavn
N35   * W0074  --->  Teller for antall segment
N35  C                   ADD       1             W0074
N35  C                   EVAL      ADS = 'FTX+AHZ+++'
N35  C                   Z-ADD     1             AXV
N35  C                   Z-ADD     10            AXH
N35  C                   MOVE      'N'           WCHART
N35  C                   EXSR      SRÅ
N35   * Fritekst
N35  C                   EVAL      ADS = SETXT1
N35  C                   Z-ADD     1             AXV
N35  C                   Z-ADD     70            AXH
N35  C                   EXSR      SRÅ
N35   *
N35  C     2             DO        5             XN3
N35  C                   IF        FT0MO(XN3) <> *BLANKS
N35  C                   ADD       1             W0074
N35  C                   EVAL      ADS = ':'
N35  C                   Z-ADD     1             AXV
N35  C                   Z-ADD     1             AXH
N35  C                   MOVE      'N'           WCHART
N35  C                   EXSR      SRÅ
N35  C                   EVAL      ADS = %TRIM(FT0MO(XN3))
N35  C                   Z-ADD     1             AXV
N35  C                   Z-ADD     70            AXH
N35  C                   EXSR      SRÅ
N35  C                   END
N35  C                   ENDDO
N35   * Slutt segment
N35  C                   MOVE      *BLANKS       ADS
N35  C                   MOVEL     WAPSTR        ADS
N35  C                   Z-ADD     1             AXV
N35  C                   Z-ADD     1             AXH
N35  C                   MOVE      'N'           WCHART
N35  C                   EXSR      SRÅ
N35   *
N35  C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Fakturasum                                          MOA0 /
      *////////////////////////////////////////////////////////////
     C     MOA0          BEGSR
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'MOA+4+39'    ADSX             16
     C                   MOVE      ':       '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Beløp
     C                   MOVE      *BLANKS       ADS
     C                   Z-ADD     XBEL1         ØN163
     C                   EXSR      SRNE
     C                   MOVEL     ØAN           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     12            AXH
     C                   Z-ADD     13            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Valutakode
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEVAL1        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Valuta                                              CUX0 /
      *////////////////////////////////////////////////////////////
     C     CUX0          BEGSR
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'CUX+2++'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Valutakurs
     C                   MOVE      *BLANKS       ADS
     C                   Z-ADD     SEVKU         ØN163
     C                   EXSR      SRNE
     C                   MOVEL     ØAN           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Seksjonskille                                       UNSD /
      *////////////////////////////////////////////////////////////
     C     UNSD          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNS+D'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Fakturanummer og dato                               DMS0 /
      *////////////////////////////////////////////////////////////
     C     DMS0          BEGSR
      *
     C     SEFID         IFNE      0                                            1<-B
     C     SEFID         IFNE      99999999                                      2<-B
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'DMS+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Fakturanummer
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEFIF         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     17            AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+137:'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Dato/tid - qualifier
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEFID         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':102+380'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ELSE                                                    2
      *
     C                   SETOFF                                       33
     C     KEYD          SETLL     SAEF
     C     KEYD          READE     SAEF                                   33
     C     *IN33         DOWEQ     '0'                                           3<-B
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'DMS+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Fakturanummer
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SFTXT         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     17            AXH
     C                   EXSR      SRÅ
N45   * Siste 4 i fakturanummer (21 langt)
N45  C     SAEFFAK       CHAIN     SAEFFA
N45  C                   IF        %FOUND(SAEFFA)
N45  C                   IF        SFAFTXT21 <> *BLANKS
N45  C                   MOVE      *BLANKS       ADS
N45  C                   MOVEL     SFAFTXT21     ADS
N45  C                   Z-ADD     1             AXV
N45  C                   Z-ADD     4             AXH
N45  C                   EXSR      SRÅ
N45  C                   ENDIF
N45  C                   ENDIF
N45   *
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+137:'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Dato, kodet
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SFDT          ADS                            ÅR MND DAG
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':102+380'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C     KEYD          READE     SAEF                                   33
      *
     C  N33              END                                                      3<-E
      *
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Tollstatus for gods                                CST0V /
      *////////////////////////////////////////////////////////////
     C     CST0V         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'CST+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Varepostnummer
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFERNR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Varenummer
      * tariffnr må skrives 121092
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFEVNT        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':122:NO1'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * tariffnr må skrives 121092
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Prosedyre, kodet
     C                   MOVE      *BLANKS       ADS
S42  C*                  IF        WDT80 < X_4SIFF
N42  C                   IF        X_M0068A < X_4SIFF
     C                   MOVEL     SEDP          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
N41  C                   ELSE
N41  C                   MOVEL     SEDP_4        ADS
N41  C                   Z-ADD     1             AXV
N41  C                   Z-ADD     4             AXH
N41  C                   END
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':117:1'      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
N28   * Preferansekode
N28  C                   IF        X_M0068A >= 20200501
N28  C                   IF        WFEPRE = ' '
N28  C                   EVAL      WFEPRE = 'N'
N28  C                   END
N28   *
N28  C                   EVAL      ADS = '+'
N28  C                   Z-ADD     1             AXV
N28  C                   Z-ADD     1             AXH
N28  C                   MOVE      'N'           WCHART
N28  C                   EXSR      SRÅ
N28   *
N28  C                   EVAL      ADS = WFEPRE
N28  C                   Z-ADD     1             AXV
N28  C                   Z-ADD     1             AXH
N28  C                   EXSR      SRÅ
N28   *
N28  C                   EVAL      ADS = ':116:NO1'
N28  C                   Z-ADD     1             AXV
N28  C                   Z-ADD     8             AXH
N28  C                   MOVE      'N'           WCHART
N28  C                   EXSR      SRÅ
N28  C                   END
N37   *
S40  C*                  IF        XVF = 'J'
N40  C                   IF        X_M0068A >= 20211201
N37  C                   EVAL      ADS = '+'
N37  C                   Z-ADD     1             AXV
N37  C                   Z-ADD     1             AXH
N37  C                   MOVE      'N'           WCHART
N37  C                   EXSR      SRÅ
N37   * Verdifastsettelseskode
N37  C                   IF        WFEVF <= '0'
N37  C                   EVAL      ADS = '1'
N37  C                   ELSE
N37  C                   EVAL      ADS = WFEVF
N37  C                   END
N37  C                   Z-ADD     1             AXV
N37  C                   Z-ADD     1             AXH
N37  C                   MOVE      'N'           WCHART
N37  C                   EXSR      SRÅ
N37   *
N37  C                   EVAL      ADS = ':109:1'
N37  C                   Z-ADD     1             AXV
N37  C                   Z-ADD     6             AXH
N37  C                   MOVE      'N'           WCHART
N37  C                   EXSR      SRÅ
N37  C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Forpakning                                         PAC0V /
      *////////////////////////////////////////////////////////////
     C     PAC0V         BEGSR
     C     WFEANT        IFNE      0
     C     WFEVT         ORNE      *BLANKS
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'PAC+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C     WFEVT         IFEQ      'U.NR'
     C     WFEVT         OREQ      'U-NR'
N22  C     WFEVT         OREQ      'U.'                                         WEB-KODE
N22  C     WFEVT         OREQ      'U-'
     C                   Z-ADD     1             WFEANT
     C                   END
      * Antall kolli
     C     WFEVT         IFNE      'EX  '
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFEANT        ADS
     C                   Z-ADD     1             AXV
S34  C*                  Z-ADD     6             AXH
N34  C                   Z-ADD     9             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
     C                   END
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '++'          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Enhet
     C                   MOVE      *BLANKS       ADS
     C     WFEVT         IFEQ      'EX  '
     C     WFEVT         OREQ      'U.NR'
     C     WFEVT         OREQ      'U-NR'
N22  C     WFEVT         OREQ      'U.'                                         WEB-KODE
N22  C     WFEVT         OREQ      'U-'
S24  C*    WFEVT         OREQ      'CONT'
S24  C*    WFEVT         OREQ      'C.'                                         WEB-KODE
N24  C     SEKDC         OREQ      '1'
     C                   MOVEL     'PK  '        ADS
     C                   ELSE
     C     WFEVT         IFEQ      *BLANKS
     C                   MOVEL     'PK  '        ADS
     C                   ELSE
     C                   MOVEL     WFEVT         ADS
     C                   END
     C                   END
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Forpakningsidentifikasjon                          PCI0V /
      *////////////////////////////////////////////////////////////
     C     PCI0V         BEGSR
N24   *
N24  C                   IF        SEKDC = '1'
N24  C                   CALL      'SAD058A'
N24  C                   PARM      SEAVD         UAVDCN            4 0
N24  C                   PARM      SETDN         UOPDCN            7 0
N24  C                   PARM      WFERNR        ULNCN             5 0
N24  C     CNR50         PARM                    UCNR            850
N24  C                   END
N24   *
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'PCI++'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   Z-ADD     1             XN3
      * Underst.nr til slutt (BEGYNN FRA 2 )
     C     WFEVT         IFEQ      'U.NR'
     C     WFEVT         OREQ      'U-NR'
N22  C     WFEVT         OREQ      'U.'                                         WEB-KODE
N22  C     WFEVT         OREQ      'U-'
N22  C*    SEKDC         OREQ      '1'
N22  C*    PTFDT         ANDLE     WDT80
N22  C                   IF        %SUBST(KN(1):25:4) = 'U-NR'
     C                   ADD       1             XN3
N22  C                   END
     C                   END
      *
     C                   MOVE      'N'           XKLN              1
N22  C                   MOVE      'N'           XCONT             1
     C     XN3           DOWLE     7
     C     KN(XN3)       ANDNE     *BLANKS
S24  C*                  IF        %SUBST(KN(XN3):25:4) <> 'CONT'
S24  C*                            AND %SUBST(KN(XN3):25:4) <> 'U-NR'
N24  C                   IF        %SUBST(KN(XN3):25:4) <> 'U-NR'
      * semikolon mellom flere..
     C     XKLN          IFEQ      'J'
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      * Merke & nr.
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     KN(XN3)       ADS
     C                   Z-ADD     1             AXV
S07  C*                  Z-ADD     17            AXH
N07  C                   Z-ADD     28            AXH
     C                   EXSR      SRÅ
     C                   ADD       1             XN3
     C                   MOVE      'J'           XKLN
N22  C                   ELSE
S24  C*                  IF        %SUBST(KN(XN3):25:4) = 'CONT'
S24  C*                  MOVE      'J'           XCONT             1
S24  C*                  END
N22  C                   ADD       1             XN3
N22  C                   END
     C                   END
      * HVIS "KOLLI-TYPE" ER "U.NR" ELLER "U-NR" DA ER DET MOTORV.FORT.
      * QUALIF.1153 SKAL DA VÆRE "VT" OG 1154 SKAL INNEHOLDE UNDERST.NR
     C     WFEVT         IFEQ      'U.NR'
     C     WFEVT         OREQ      'U-NR'
N22  C     WFEVT         OREQ      'U.'                                         WEB-KODE
N22  C     WFEVT         OREQ      'U-'
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+VT:'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   MOVE      *BLANKS       ADS
S22  C*                  MOVEL     KN(1)         ADS
N22  C     1             DO        5             XN3
N22  C                   IF        %SUBST(KN(XN3):25:4) = 'U-NR'
N22  C                   EVAL      ADS = %SUBST(KN(XN3):1:17)
N22  C                   LEAVE
N22  C                   END
N22  C                   ENDDO
     C                   Z-ADD     1             AXV
S07  C*                  Z-ADD     17            AXH
N07  C                   Z-ADD     28            AXH
     C                   EXSR      SRÅ
S24  C*                  IF        SEKDC = '1' AND XCONT = 'J'
N24  C                   IF        SEKDC = '1'
N22  C                   MOVE      *BLANKS       ADS
N22  C                   MOVEL     WAPSTR        ADS
N22  C                   Z-ADD     1             AXV
N22  C                   Z-ADD     1             AXH
N22  C                   MOVE      'N'           WCHART
N22  C                   EXSR      SRÅ
N22   * NYTT SEGMENT FOR CONTAINER
N22  C                   ADD       1             W0074
N22  C                   EVAL      ADS = 'PCI++'
N22  C                   Z-ADD     1             AXV
N22  C                   Z-ADD     5             AXH
N22  C                   MOVE      'N'           WCHART
N22  C                   EXSR      SRÅ
N22  C                   END                                                IF SEKDC = '1'
     C                   END
N22   *
N22   * Container sending
S24  C*                  IF        SEKDC = '1' AND XCONT = 'J'
S24  C*                            AND PTFDT <= WDT80                           TEST PTF-STARTDATO
N24  C                   IF        SEKDC = '1'
N22  C                   EVAL      ADS = '+AAQ:'
N22  C                   Z-ADD     1             AXV
N22  C                   Z-ADD     5             AXH
N22  C                   MOVE      'N'           WCHART
N22  C                   EXSR      SRÅ
N22   *
S24  C*                  IF        WFEVT = 'U.NR' OR WFEVT = 'U-NR'
S24  C*    1             DO        7             XN3
S24  C*                  IF        %SUBST(KN(XN3):25:4) = 'CONT'
S24  C*                  EVAL      ADS = %SUBST(KN(XN3):1:17)
S24  C*                  LEAVE
S24  C*                  END
S24  C*                  ENDDO
S24  C*                  ELSE
S24  C*                  Z-ADD     1             XN3
S24  C*                  EVAL      ADS = KN(1)
S24  C*                  END
N24  C                   Z-ADD     2             XN3
N24  C                   EVAL      ADS = CNR(1)
N22  C                   Z-ADD     1             AXV
N22  C                   Z-ADD     17            AXH
N22  C                   EXSR      SRÅ
N22   *
N22  C                   END                                                IF SEKDC = '1'
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
N22   *
S24  C*                  IF        SEKDC = '1' AND XCONT = 'J'
S24  C*                  DOW       XN3 > 0 AND XN3 < 7
S24  C*                  EVAL      XN2 = XN3 + 1
S24  C*    XN2           DO        7             XN3
S24  C*                  IF        %SUBST(KN(XN3):25:4) = 'CONT'
S24  C*                  GOTO      NESTECONT
S24  C*                  END
S24  C*                  ENDDO
S24  C*                  GOTO      SLCONT
S24  C*    NESTECONT     TAG
N24  C                   IF        SEKDC = '1'
N24  C     XN3           DO        50            XN2
N24  C                   IF        CNR(XN2) = *BLANKS
N24  C                   LEAVE
N24  C                   END
N22  C                   ADD       1             W0074
N22  C                   EVAL      ADS = 'PCI+++AAQ:'
N22  C                   Z-ADD     1             AXV
N22  C                   Z-ADD     10            AXH
N22  C                   MOVE      'N'           WCHART
N22  C                   EXSR      SRÅ
N22   *
S24  C*                  EVAL      ADS = %SUBST(KN(XN3):1:17)
N24  C                   EVAL      ADS = CNR(XN2)
N22  C                   Z-ADD     1             AXV
N22  C                   Z-ADD     17            AXH
N22  C                   EXSR      SRÅ
N22   *
N22  C                   EVAL      ADS = WAPSTR
N22  C                   Z-ADD     1             AXV
N22  C                   Z-ADD     1             AXH
N22  C                   MOVE      'N'           WCHART
N22  C                   EXSR      SRÅ
N22  C                   ENDDO
S24  C*    SLCONT        TAG
N22  C                   END                                                IF SEKDC = '1'
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Forpakningsidentifikasjon                         PCI0V2 /
      *////////////////////////////////////////////////////////////
     C     PCI0V2        BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'PCI++'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *ZEROS        XLIN              3 0
     C     SAEV4K        SETLL     SAEV4
     C     SAEV4K        READE(N)  SAEV4                                  34
     C     *IN34         DOWEQ     '0'                                          1<-B
S39  C*    1             DO        7             XN2                             2<-B
S39  C*                  IF        SVFT(XN2) <> *BLANKS                           3<-B
N39  C     1             DO        7             XN3                             2<-B
N39  C                   IF        SVFT(XN3) <> *BLANKS                           3<-B
      *
     C                   IF        XLIN = 10                                       4<-B
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'PCI++'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   MOVE      *ZEROS        XLIN
     C                   END                                                       4<-E
      *
     C     XLIN          IFGT      0                                               4<-B
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END                                                       4<-E
      * Merke & nr.
S39  C*                  EVAL      ADS = SVFT(XN2)
N39  C                   EVAL      ADS = SVFT(XN3)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     28            AXH
     C                   EXSR      SRÅ
     C                   ADD       1             XN3
     C                   ADD       1             XLIN
     C                   END                                                      3<-E
     C                   ENDDO                                                   2<-E
     C     SAEV4K        READE(N)  SAEV4                                  34
     C  N34              ENDDO                                                  1<-E
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
N39   *
N39  C                   IF        SEKDC = '1'
N39   *
N39  C                   CALL      'SAD058A'
N39  C                   PARM      SEAVD         UAVDCN            4 0
N39  C                   PARM      SETDN         UOPDCN            7 0
N39  C                   PARM      WFERNR        ULNCN             5 0
N39  C     CNR50         PARM                    UCNR            850
N39   *
N39  C     1             DO        50            XN3
N39  C                   IF        CNR(XN3) = *BLANKS
N39  C                   LEAVE
N39  C                   END
N39  C                   ADD       1             W0074
N39  C                   EVAL      ADS = 'PCI+++AAQ:'
N39  C                   Z-ADD     1             AXV
N39  C                   Z-ADD     10            AXH
N39  C                   MOVE      'N'           WCHART
N39  C                   EXSR      SRÅ
N39   *
N39  C                   EVAL      ADS = CNR(XN3)
N39  C                   Z-ADD     1             AXV
N39  C                   Z-ADD     17            AXH
N39  C                   EXSR      SRÅ
N39   *
N39  C                   EVAL      ADS = WAPSTR
N39  C                   Z-ADD     1             AXV
N39  C                   Z-ADD     1             AXH
N39  C                   MOVE      'N'           WCHART
N39  C                   EXSR      SRÅ
N39  C                   ENDDO
N39  C                   END                                                IF SEKDC = '1'
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Stedsangivelse                                     LOC0V /
      *////////////////////////////////////////////////////////////
     C     LOC0V         BEGSR
N29  C                   IF        WFEFYL = *BLANKS
N29  C                   EVAL      FYLK = '91'
N29  C                   ELSE
     C                   MOVEL     WFEFYL        FYLK              2             FYLKE/LAND
N29  C                   END
      *__________________
      * Oppr.land. Ved utenlandske varer ligger Oppr LANDKODE i WFEFYL
      *""""""""""""""""""
      * PROS 2,4,18,81,90 ER TRANSIT AV UTENLANDSKE...
     C     SEDP          IFEQ      2
     C     SEDP          OREQ      4
     C     SEDP          OREQ      18
N42  C     SEDP          OREQ      80
N42  C     X_M0068A      ANDGE     X_4SIFF
     C     SEDP          OREQ      81
N42  C     X_M0068A      ANDLT     X_4SIFF
     C     SEDP          OREQ      90
N38  C     SEDP          OREQ      34
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'LOC+27:'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
N38  C                   IF        SEDP = 34 AND FYLK >= '01' AND FYLK < '90'
N42  C                             OR FYLK = '99'
N38  C                   MOVEL     'NO'          ADS
N38  C                   ELSE
     C                   MOVEL     FYLK          ADS                              = land
N38  C                   END
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      *
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * FAST FYLKE 91 VED UTENLANDSKE VARER
N38  C                   IF        SEDP = 34 AND FYLK >= '01' AND FYLK < '90'
N42  C                             OR FYLK = '99'
N38  C                   ELSE
     C                   MOVE      '91'          FYLK
N38  C                   END
     C                   END
      *__________________
      * Opprinelsesfylke
      *""""""""""""""""""
N29  C                   IF        %SUBST(WFEFYL:1:1) < '0'
N29  C                             OR %SUBST(WFEFYL:1:1) > '9'                  VED LANDKODE SETTE
N29  C                   EVAL      FYLK = '91'                                  FYLKEKODE = 91
N29  C                   END
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'LOC+106:'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     FYLK          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
N44   *////////////////////////////////////////////////////////////
N44   *  Stedsangivelse                                  LOC0V_FO /
N44   *////////////////////////////////////////////////////////////
N44  C     LOC0V_FO      BEGSR
N44   * Segmentnavn
N44  C                   ADD       1             W0074
N44  C                   MOVE      *BLANKS       ADS
N44  C                   MOVEL     'LOC+27:'     ADS
N44  C                   Z-ADD     1             AXV
N44  C                   Z-ADD     7             AXH
N44  C                   MOVE      'N'           WCHART
N44  C                   EXSR      SRÅ
N44   *
N44  C                   EVAL      ADS = SVLK
N44  C                   Z-ADD     1             AXV
N44  C                   Z-ADD     2             AXH
N44  C                   EXSR      SRÅ
N44   *
N44   * Slutt segment
N44  C                   MOVE      *BLANKS       ADS
N44  C                   MOVEL     WAPSTR        ADS
N44  C                   Z-ADD     1             AXV
N44  C                   Z-ADD     1             AXH
N44  C                   MOVE      'N'           WCHART
N44  C                   EXSR      SRÅ
N44   *
N44  C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Tollverdi                                          MOA0V /
      *////////////////////////////////////////////////////////////
     C     MOA0V         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C     WFESTB        IFNE      0
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'MOA+14+1'    ADSX             16
     C                   MOVE      '23:     '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     11            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Beløp
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFESTB        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     11            AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Mål                                                MEA0V /
      *////////////////////////////////////////////////////////////
     C     MEA0V         BEGSR
      *___________
      * Bruttovekt
      *"""""""""""
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'MEA+AAF+'    ADSX             16
     C                   MOVE      'G+KGM:  '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     14            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Bruttovekt
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFEVKB        ADS
     C                   Z-ADD     1             AXV
S34  C*                  Z-ADD     9             AXH
N34  C                   Z-ADD     11            AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C     SEMF          IFNE      'DFO'
      *__________
      * Nettovekt
      *""""""""""
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'MEA+AAF+'    ADSX             16
     C                   MOVE      'N+KGM:  '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     14            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Nettovekt
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFEVKN        ADS
     C                   Z-ADD     1             AXV
S34  C*                  Z-ADD     9             AXH
N34  C                   Z-ADD     11            AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
      *_______
      * Mengde
      *"""""""
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C     TARIKM        SETLL     TARI
     C     TARIK         READPE    TARI                                   33
     C     *IN33         DOWEQ     '0'
     C     TADATO        IFLE      M0068A
N03  C     TADTS         ANDEQ     0
N03  C     TADATO        ORLE      M0068A
N03  C     TADTS         ANDGE     M0068A
     C                   LEAVE
     C                   END
     C     TARIK         READPE    TARI                                   33
     C  N33              ENDDO
      *
     C  N33TAENHE        IFNE      *BLANKS
     C     WFENTM        ANDNE     0
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'MEA+AAF+'    ADSX             16
     C                   MOVE      'ZZ+     '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     11            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Enhet
S21  C*    TAENHE        IFEQ      'stk'
S21  C*    TAENHE        OREQ      'STK'
S21  C*                  MOVE      'NMB'         TAENHE
S21  C*                  END
S21  C*    TAENHE        IFEQ      'par'
S21  C*    TAENHE        OREQ      'PAR'
S21  C*                  MOVE      'NPR'         TAENHE
S21  C*                  END
S21  C*    TAENHE        IFEQ      'lit'
S21  C*    TAENHE        OREQ      'LIT'
S21  C*                  MOVE      'LTR'         TAENHE
S21  C*                  END
S21  C*    TAENHE        IFEQ      'm3 '
S21  C*    TAENHE        OREQ      'M3 '
S21  C*                  MOVE      'MTQ'         TAENHE
S21  C*                  END
S21  C*    TAENHE        IFEQ      'm2 '
S21  C*    TAENHE        OREQ      'M2 '
S21  C*                  MOVE      'MTK'         TAENHE
S21  C*                  END
S21  C*    TAENHE        IFEQ      'gra'
S21  C*    TAENHE        OREQ      'GRA'
S21  C*                  MOVE      'GRM'         TAENHE
S21  C*                  END
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     TAENHE        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Mengde
     C                   MOVE      *BLANKS       ADS
S07  C*                  IF        WFENTM < 0
S07  C*                  EVAL      XVNTM = WFENTM * -100
S07  C*                  ELSE
     C                   EVAL      XVNTM = WFENTM
S07  C*                  END
     C                   MOVEL     XVNTM         ADS
     C                   Z-ADD     1             AXV
S34  C*                  Z-ADD     9             AXH
N34  C                   Z-ADD     11            AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   END
     C                   SETOFF                                       33
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Avgifter                                           TAX0V /
      *////////////////////////////////////////////////////////////
     C     TAX0V         BEGSR
     C     1             DO        4             XN3
     C     TY(XN3)       IFNE      *BLANKS
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'TAX+1+16'    ADSX             16
     C                   MOVE      '1:      '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftsbeløp
     C                   MOVE      *BLANKS       ADS
     C                   Z-ADD     1             AXV
     C     BL(XN3)       IFEQ      0
     C                   MOVEL     '0'           ADS
     C                   Z-ADD     1             AXH
     C                   ELSE
     C                   MOVEL     BL(XN3)       ADS
S13  C*                  Z-ADD     9             AXH
N13  C                   Z-ADD     11            AXH
     C                   MOVE      'L'           WDIR
     C                   END
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftstype
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     TY(XN3)       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':107:NO1'    ADSX             16
     C                   MOVE      '+       '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgifts sekvens
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SK(XN3)       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     ':105:NO1'    A(1)
     C                   MOVEA     '+'           A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftsgrunnlag
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     GL(XN3)       ADS
     C                   Z-ADD     1             AXV
S13  C*                  Z-ADD     9             AXH
N13  C                   Z-ADD     11            AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftsats
     C                   MOVE      *BLANKS       ADS
     C                   Z-ADD     ST(XN3)       ØN163
     C                   EXSR      SRNE
     C                   MOVEL     ØAN           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     13            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   END
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Nødvendige dokumenter                              DCR0V /
      *////////////////////////////////////////////////////////////
     C     DCR0V         BEGSR
     C                   Z-ADD     1             XN3
S07  C*    XN3           DOWLE     5
N07  C     XN3           DOWLE     10
     C     TO(XN3)       IFNE      *BLANKS
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'DCR+811+'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Kode for dokument
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     TC(XN3)       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Dokument
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     TO(XN3)       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     17            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   END
     C                   ADD       1             XN3
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Godsbeskrivelse                                    GDS0V /
      *////////////////////////////////////////////////////////////
     C     GDS0V         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'GDS+2'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Fritekster                                         FTX0V /
      *////////////////////////////////////////////////////////////
     C     FTX0V         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'FTX+AAA+'    ADSX             16
     C                   MOVE      '++      '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Fritekst
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     VB(1)         ADS
     C                   Z-ADD     1             AXV
S07  C*                  Z-ADD     15            AXH
N07  C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
      *
     C                   Z-ADD     2             XN3
     C     XN3           DOWLE     5
     C     VB(XN3)       IFNE      *BLANKS
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Fritekst
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     VB(XN3)       ADS
     C                   Z-ADD     1             AXV
S07  C*                  Z-ADD     15            AXH
N07  C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
     C                   END
     C                   ADD       1             XN3
     C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Seksjonskille                                       UNSS /
      *////////////////////////////////////////////////////////////
     C     UNSS          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNS+S'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Sum avgifter                                       TAX0S /
      *////////////////////////////////////////////////////////////
     C     TAX0S         BEGSR
     C     XTOT          IFNE      0                                            1<-B
      *___________________
      * Sum av totalavgift
      *"""""""""""""""""""
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'TAX+4+16'    ADSX             16
     C                   MOVE      '1:      '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftsbeløp
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     XTOT          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END                                                    1<E
      *
      *___________________
      * Sum av delavgift
      *"""""""""""""""""""
     C                   Z-ADD     1             XN3
     C     XN3           DOWLE     4                                            1<B
     C     T1(XN3)       IFNE      *BLANKS                                       2<-B
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'TAX+3+16'    ADSX             16
     C                   MOVE      '1:      '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftsbeløp
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     T2(XN3)       ADS
     C                   Z-ADD     1             AXV
S13  C*                  Z-ADD     9             AXH
N13  C                   Z-ADD     11            AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftstype
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     T1(XN3)       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':107:NO1'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   END                                                     2<-E
     C                   ADD       1             XN3
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Kontrolltotaler                                    CNT0S /
      *////////////////////////////////////////////////////////////
     C     CNT0S         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'CNT+5:'      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Antall poster
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     XNR           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+11:'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Antall poster
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SENTK         ADS
     C                   Z-ADD     1             AXV
S34  C*                  Z-ADD     7             AXH
N34  C                   Z-ADD     10            AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Meldingsslutt                                       UNT0 /
      *////////////////////////////////////////////////////////////
     C     UNT0          BEGSR
      * Segmentnavn
     C                   ADD       1             W0036
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNT+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Antall segmenter i meldingen (inkludert UNH og UNT)
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     W0074         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Meldingsreferanse
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M0062         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     14            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Sendningsslutt                                      UNZ0 /
      *////////////////////////////////////////////////////////////
     C     UNZ0          BEGSR
      * Start segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNZ+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     W0036         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     S0020         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Legg in 3 blanke i slutten for IBM IN
     C     WNETW         IFEQ      '2'
     C     1             DO        3
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ' '           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   ENDDO
     C                   ENDIF
      *
     C     BX            IFGT      1
     C                   WRITE     EDISER
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * SR for output string, read input from left              SRÅ
      *////////////////////////////////////////////////////////////
     C     SRÅ           BEGSR
      *_______________
      * Find positions
      *""""""""""""""""
      * Find first non-0 position
     C     WDIR          IFEQ      'L'                                          <-------------I
     C     AXV           DO        AXH           AXV                             <-----------II
     C     A(AXV)        COMP      '0'                                  8383                 II
     C   83              END                                                     <-----------II
      * Find last non-blank position                                     I
     C                   ELSE                                                   <-------------I
      *                                                                  I
     C     SRÅ01         TAG                                                                  I
      *                                                                  I
     C     AXH           IFGT      AXV                                           <-----------II
     C     A(AXH)        IFEQ      *BLANKS                                        <---------III
     C                   SUB       1             AXH                                        III
     C                   GOTO      SRÅ01                                                    III
     C                   END                                                      <---------III
     C                   END                                                     <-----------II
     C                   END                                                    <-------------I
     C                   MOVE      'R'           WDIR
      *________________________________________________
      * Read input string and place it in output string
      *""""""""""""""""""""""""""""""""""""""""""""""""
     C     AXV           DO        AXH           AXV                            <-------------I
     C                   MOVE      A(AXV)        WCHAR                                        I
      * If invalid character (' + : ?) then replace with 'Ø'             I
     C     WCHART        IFEQ      'Y'                                           <-----------II
     C     WDIR          IFEQ      'R'                                            <---------III
     C     WCHAR         IFEQ      ';'                                                      III
     C                   MOVE      ':'           WCHAR
     C                   ENDIF                                                    <---------III
     C     WCHAR         COMP      WAPSTR                                 83                III
     C  N83WCHAR         COMP      '+'                                    83                III
     C  N83WCHAR         COMP      ':'                                    83                III
     C  N83WCHAR         COMP      '?'                                    83                III
     C   83              EXSR      SRÅA                                                     III
     C                   END                                                      <---------III
     C                   END                                                     <-----------II
      * Move to output string                                            I
     C                   MOVE      WCHAR         B(BX)                                        I
     C                   ADD       1             BX                                           I
      * If arrayindex for output array is over 80 Then add a record      I
     C     BX            IFGT      80                                            <-----------II
     C                   WRITE     EDISER                                                    II
     C                   Z-ADD     1             BX                                          II
     C                   MOVE      *BLANKS       SDATA                                       II
     C                   END                                                     <-----------II
      *                                                                  I
     C                   END                                                    <-------------I
      *
     C                   MOVE      'Y'           WCHART
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * SR for replace control characters                      SRÅA
      *////////////////////////////////////////////////////////////
     C     SRÅA          BEGSR
      * Move '?' before the character
     C                   MOVE      '?'           B(BX)
     C                   ADD       1             BX
     C     BX            IFGT      80                                           <-------------I
     C                   WRITE     EDISER                                                     I
     C                   Z-ADD     1             BX                                           I
     C                   MOVE      *BLANKS       SDATA                                        I
     C                   END                                                    <-------------I
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Venstrestill numeriske verdier                      SRNE /
      *////////////////////////////////////////////////////////////
     C     SRNE          BEGSR
      * Flytte in rett verdi i Alfa 13-felt
     C                   MOVE      *ZEROS        ØA13
     C     ØA163D        IFEQ      '000'                                        <-------------I
     C                   MOVE      ØA163H        ØA13                                         I
     C                   ELSE                                                   <-------------I
     C                   MOVEL     ØA163X        ØA13                                         I
     C                   MOVE      ',   '        ØA13                                         I
     C                   MOVE      ØA163D        ØA13                                         I
     C     Ø13(13)       IFEQ      '0'
     C                   MOVE      ' '           Ø13(13)
     C     Ø13(12)       IFEQ      '0'
     C                   MOVE      ' '           Ø13(12)
     C                   END
     C                   END
     C                   END                                                    <-------------I
      * lete fra venstre og finn foerste siffer over 0
     C     1             DO        12            ØX                             <-------------I
     C     Ø13(ØX)       IFNE      '0'                                           <-----------II
     C                   GOTO      SRNE1                                                     II
     C                   END                                                     <-----------II
     C                   END                                                    <-------------I
     C     SRNE1         TAG
      * Venstrestill til et nytt felt
     C                   MOVE      *BLANKS       ØAN
     C                   MOVEA     Ø13(ØX)       ØAN
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Foreløpig toldekralasjon                                  /
      *////////////////////////////////////////////////////////////
     C     PRINTF        BEGSR
      * Tollstatus for gods
     C                   EXSR      CST0
      * Referanser
     C                   EXSR      RFF0
      * Stedsangivelse
     C                   EXSR      LOC0
      * Ønsket behandlingsdato, ekspedisjonsdato og bokføringsdato
     C                   EXSR      DTM0
      * Eksportør, mottaker, deklaranten, ekspedisjonsenhet hvor
      * deklatasjonen skal ekspederes og toll-/avgiftsbetaler
     C                   EXSR      NAD0
      * Kontaktinformasjon
     C                   EXSR      CTA0
      * Fakturasum
     C     SEBEL1        IFNE      0
     C     KODVAK        CHAIN     KODTVA                             33
     C  N33SEBEL1        DIV       KVAOMR        XWORK
     C  N33XWORK         MULT      SEVKU         XBEL1
     C   33              Z-ADD     SEBEL1        XBEL1
     C                   EXSR      MOA0
      * Valuta
     C                   EXSR      CUX0
     C                   END
      * Seksjonskille
     C                   EXSR      UNSD
      * Skrive ut fakturainfomasjoner
     C                   EXSR      DMS0
      *
     C     SAEV2K        SETLL     SAEV2
     C                   MOVE      *ZEROS        WFERNR
S43  C*    SAEV2K        READE     SAEV2                                  33
N43  C     SAEV2K        READE(N)  SAEV2                                  33
     C     *IN33         DOWEQ     '0'
     C     SVVNT         IFNE      0
     C     SVVKTB        ANDNE     0
      * Tollstatus for gods
     C                   ADD       1             WFERNR
     C                   MOVE      SVVNT         WFEVNT
     C                   EXSR      CST0V
      * Forpakning
     C                   MOVE      SVNT01        WFEANT
     C     SVEH01        IFEQ      *BLANKS
     C                   MOVEL     'EX  '        WFEVT
     C                   ELSE
     C                   MOVE      SVEH01        WFEVT
     C                   END
     C                   EXSR      PAC0V
N44   * Oppringelsesland
N44  C                   IF        WDT80 >= 20230801
N44  C                   EXSR      LOC0V_FO
N44  C                   END
      * Vekt og annen enhet
S07  C*                  MOVE      SVVKTB        WFEVKB
N07  C                   Z-ADD     SVVKTB        WFEVKB123
     C                   EXSR      MEA0V
      * Nødvendige dokumenter
     C                   EXSR      DCR0VM
      * Godsbeskrivelse (TAD-kode)
     C                   EXSR      GDS0V
      * Godsbeskrivelse
     C                   EXSR      FTX0VM
     C                   END
S43  C*    SAEV2K        READE     SAEV2                                  33
N43  C     SAEV2K        READE(N)  SAEV2                                  33
     C  N33              ENDDO
      * Seksjonskille
     C                   EXSR      UNSS
      * Kontroll totaler
     C                   Z-ADD     1             XNR
     C                   EXSR      CNT0S
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Mål  (FORELØPIG TOLLDEKLARASJON)                  MEA0VM /
      *////////////////////////////////////////////////////////////
     C     MEA0VM        BEGSR
      *___________
      * Bruttovekt
      *"""""""""""
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'MEA+AAF+'    ADSX             16
     C                   MOVE      'G+KGM:  '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     14            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Bruttovekt
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SEVKB         ADS
     C                   Z-ADD     1             AXV
S34  C*                  Z-ADD     9             AXH
N34  C                   Z-ADD     11            AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Nødvendige dokumenter (FORELØPIG TOLLDEK.)        DCR0VM /
      *////////////////////////////////////////////////////////////
     C     DCR0VM        BEGSR
     C     SVCRE1        IFNE      *BLANKS
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'DCR+811+'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Kode for dokument
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SVCRE1        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Dokument
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SVTOP1        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     41            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   END
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Fritekster  (FORELØPIG DEKLARASJON)               FTX0VM /
      *////////////////////////////////////////////////////////////
     C     FTX0VM        BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'FTX+AAA+'    ADSX             16
     C                   MOVE      '++      '    ADSX
     C                   MOVEL     ADSX          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Fritekst
     C                   MOVE      *BLANKS       ADS
     C     SVVT01        IFEQ      *BLANKS
S07  C*    TARIK         CHAIN     TARI                               34
S07  C*                  MOVEL     TAALFA        ADS
N07  C     WFEVNT        CHAIN     SOKTARI2                           34
N07  C                   IF        *IN34
N07  C     TARIK         CHAIN     TARI                               34
N07  C  N34              EVAL      ADS = TAALFA
N07  C                   ELSE
N07  C                   EVAL      ADS = BESKR1
N07  C                   END
     C                   ELSE
     C                   MOVEL     SVVT01        ADS
     C                   END
     C                   Z-ADD     1             AXV
S07  C*                  Z-ADD     15            AXH
N07  C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
      *
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
N25  C************************************************
N25  C     N25SR1        BEGSR
N25  C************************************************
N25  C     KEYD          CHAIN     HEADF
N25  C                   IF        %FOUND(HEADF)
N25  C                   EVAL      TRSTA3='S'
N25  C                   UPDATE    HEADFR
N25  C                   ENDIF
N25
N25  C                   SELECT
N25  C     HEUR          WHENEQ    'B'
N25  C                   MOVE      'XXX'         TSKODE            3
N25  C     HEUR          WHENEQ    'D'
N25  C                   MOVE      'CEN'         TSKODE
N25  C     HEUR          WHENEQ    'G'
N25  C                   MOVE      'A50'         TSKODE
N25  C                   ENDSL
N25
N25  C                   MOVE      SEAVD         TSAVD             4
N25  C                   MOVE      SETDN         TSOPD             7
N25  C                   MOVE      M0068A        U0068A            9
N25  C                   MOVE      M0068B        U0068B            6
N25  C                   MOVE      M0068C        U0068C            2
N25
N25  C                   CALL      'SYXML45NOE'
N25  C                   PARM                    TSAVD
N25  C                   PARM                    TSOPD
N25  C                   PARM                    TSKODE
N25  C                   PARM                    U0068A
N25  C                   PARM                    U0068B
N25  C                   PARM                    U0068C
N25  C                   ENDSR
     OSAEVR     E            SAEVLN
     O                       SVLN
N04  OSAEVR4    E            SAEVL4
N04  O                       SVLN
