********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX * 01 JOV PTF11 Nye felt for Hentet hos avsender i header av bilde
11XXX * 02 JOV PTF11 Vis Term-tekst også på IN... og OU... egen terminal
      *                    avventer - bør utvide dokufm også med TERMK IN / OUT (lvlchk NO)
********************************************************************
     FDOKUFM1   IF   E           K DISK
     FDOKUFN    IF   E           K DISK
     FFIRM      IF   E           K DISK
     FBRPARF    IF   E           K DISK
     FSYFA10B2D CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
      * lookup-table for terminalkoder - max 100 a 5 tegn
     D                 DS
     D  TK                     1    500
     D                                     DIM(100)
      * lookup-table for terminaltekst - max 100 a 25 tegn
     D                 DS
     D  TT                     1   2500
     D                                     DIM(100)
     D                 DS
     D  PAVRDA                 1     50
     D  PAVRDA1_5              1      5
     D  PAVRDA7_46             7     46
      * DSer for datokonvertering
N01   * COL - Hentet hos kunde/avsender
N01  D                 DS
N01  D  FMCODT                 1      8  0
N01  D  FMCDTÅ                 1      4  0
N01  D  FMCDTM                 5      6  0
N01  D  FMCDTD                 7      8  0
N01  D                 DS
N01  D  FMCODT6                1      6  0
N01  D  FMCDTD6                1      2  0
N01  D  FMCDTM6                3      4  0
N01  D  FMCDTÅ6                5      6  0
N01  D                 DS
N01  D  FMCOTM                 1      6  0
N01  D  FMCOTM4                1      4  0
      * INN egen
     D                 DS
     D  FMITDT                 1      8  0
     D  FMIDTÅ                 1      4  0
     D  FMIDTM                 5      6  0
     D  FMIDTD                 7      8  0
     D                 DS
     D  FMITDT6                1      6  0
     D  FMIDTD6                1      2  0
     D  FMIDTM6                3      4  0
     D  FMIDTÅ6                5      6  0
     D                 DS
     D  FMITTM                 1      6  0
     D  FMITTM4                1      4  0
      * UT  egen
     D                 DS
     D  FMUTDT                 1      8  0
     D  FMUDTÅ                 1      4  0
     D  FMUDTM                 5      6  0
     D  FMUDTD                 7      8  0
     D                 DS
     D  FMUTDT6                1      6  0
     D  FMUDTD6                1      2  0
     D  FMUDTM6                3      4  0
     D  FMUDTÅ6                5      6  0
     D                 DS
     D  FMUTTM                 1      6  0
     D  FMUTTM4                1      4  0
      * POD
     D                 DS
     D  FMPODT                 1      8  0
     D  FMPDTÅ                 1      4  0
     D  FMPDTM                 5      6  0
     D  FMPDTD                 7      8  0
     D                 DS
     D  FMPODT6                1      6  0
     D  FMPDTD6                1      2  0
     D  FMPDTM6                3      4  0
     D  FMPDTÅ6                5      6  0
     D                 DS
     D  FMPOTM                 1      6  0
     D  FMPOTM4                1      4  0
      * Fremmed DATE
     D                 DS
     D  FNDATE                 1      8  0
     D  FNEDTÅ                 1      4  0
     D  FNEDTM                 5      6  0
     D  FNEDTD                 7      8  0
     D                 DS
     D  FNDATE6                1      6  0
     D  FNEDTD6                1      2  0
     D  FNEDTM6                3      4  0
     D  FNEDTÅ6                5      6  0
     D                 DS
     D  FNTIME                 1      6  0
     D  FNTIME4                1      4  0
      * Fremmed DATL - DATE LOGGED
     D                 DS
     D  FNDATL                 1      8  0
     D  FNLDTÅ                 1      4  0
     D  FNLDTM                 5      6  0
     D  FNLDTD                 7      8  0
     D                 DS
     D  FNDATL6                1      6  0
     D  FNLDTD6                1      2  0
     D  FNLDTM6                3      4  0
     D  FNLDTÅ6                5      6  0
     D                 DS
     D  FNTIML                 1      6  0
     D  FNTIML4                1      4  0
      *____
      * Inz
      *""""
     c
     C                   exsr      INIT
      *______________
      * Clear Subfile
      *""""""""""""""
     C     START1        TAG
      * Info om inn/ut /Pod skal i header
     C     FMMRK1        chain     DOKUFM1                            33
     C                   exsr      fixdat1

     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
      *_____________
      * Fyll Subfile (andre hendelser/fremmede terminaler  fra DOKUFN)
      *"""""""""""""
     C     FNCLID        SETLL     DOKUFN
     C     FNCLID        READE     DOKUFN                                 94

     C     *IN94         DOWEQ     '0'
     C                   exsr      fixdat2
     C                   eval      TermTxt = *blanks
     C                   Z-ADD     1             XN
     C     FNTERM        LOOKUP    TK(XN)                                 75
     C   75              eval      TermTxt = TT(XN)
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C     FNCLID        READE     DOKUFN                                 94
     C  N94              ENDDO
     C                   IF        ZRECNO>0
     C                   EVAL      ZRECNO=1
     C                   ENDIF
      *________________
      * Display Subfile
      *""""""""""""""""
     C     START2        TAG

     C                   MOVE      *OFF          *IN51
     C                   MOVEA     '11'          *IN(91)
     C* KOMMER HIT VED TOM FIL
     C     ZRECNO        IFEQ      0
     C                   MOVE      *OFF          *IN94
     C                   ADD       1             ZRECNO
     C                   MOVE      *ON           *IN51
     C                   WRITE     SUBFIL
     C                   SETON                                        94
     C                   ENDIF
     C                   WRITE     WIND01
     C                   WRITE     BUNN
     C     STBUNN        TAG
     C                   EXFMT     SUBCTL

      * FORRIGE
     C   12              GOTO      SLUTT
      * F5 - Refresg
     C   05              GOTO      START1
      * ANNET
     C                   GOTO      START2

     C     SLUTT         TAG
     C                   SETON                                        LR


      **************************************************************************
     c     FIXDAT1       BEGSR
      **************************************************************************
N01   * COL Hentet avsender
N01  C                   MOVE      FMCDTÅ        FMCDTÅ6
N01  C                   MOVE      FMCDTM        FMCDTM6
N01  C                   MOVE      FMCDTD        FMCDTD6
      * Inn egen
     C                   MOVE      FMIDTÅ        FMIDTÅ6
     C                   MOVE      FMIDTM        FMIDTM6
     C                   MOVE      FMIDTD        FMIDTD6
      * Ut  egen
     C                   MOVE      FMUDTÅ        FMUDTÅ6
     C                   MOVE      FMUDTM        FMUDTM6
     C                   MOVE      FMUDTD        FMUDTD6
      * POD
     C                   MOVE      FMPDTÅ        FMPDTÅ6
     C                   MOVE      FMPDTM        FMPDTM6
     C                   MOVE      FMPDTD        FMPDTD6
     c                   endsr
      **************************************************************************
     c     FIXDAT2       BEGSR
      **************************************************************************
      * DATE - EVENT DATE
     C                   MOVE      FNEDTÅ        FNEDTÅ6
     C                   MOVE      FNEDTM        FNEDTM6
     C                   MOVE      FNEDTD        FNEDTD6
      * DATL - DATE LOGGED
     C                   MOVE      FNLDTÅ        FNLDTÅ6
     C                   MOVE      FNLDTM        FNLDTM6
     C                   MOVE      FNLDTD        FNLDTD6
     c                   endsr
      **************************************************************************
     c     INIT          BEGSR
      **************************************************************************
     C     *ENTRY        PLIST
     C                   PARM                    UUCLID           18
     c                   movel     UUCLID        FNCLID
     c                   movel     UUCLID        FMMRK1
     c     *loval        setll     firm
     c                   read      firm
      * Clear numeriske DS-er
N01  c                   clear                   FMCODT
N01  c                   clear                   FMCODT6
N01  c                   clear                   FMCOTM
N01   *
     c                   clear                   FMITDT
     c                   clear                   FMITDT6
     c                   clear                   FMITTM
      *
     c                   clear                   FMUTDT
     c                   clear                   FMUTDT6
     c                   clear                   FMUTTM
      *
     c                   clear                   FMPODT
     c                   clear                   FMPODT6
     c                   clear                   FMPOTM
      *
     c                   clear                   FNDATE
     c                   clear                   FNDATE6
     c                   clear                   FNTIME
      *
     c                   clear                   FNDATL
     c                   clear                   FNDATL6
     c                   clear                   FNTIML
      *
      * Legg terminalkoder / tekster i lookuptable
     C     BrParKey      KLIST
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
     C                   MOVE      *zeros        PAKUNR
     C                   MOVEL     'TERMK'       PAID
     C                   MOVE      '*KUNDFT*  '  PABRID
     C                   MOVE      FIFIRM        PABRID
     C                   move      *zeros        XN                3 0
     c     BrParKey      setll     BRPARF
     c     BrParKey      reade     BRPARF                                 33
     c     *in33         doweq     '0'
     C                   add       1             XN
     c                   eval      TK(XN) = Pavrda1_5
     c                   eval      TT(XN) = Pavrda7_46
     c     XN            ifeq      100
     C                   leave
     c                   end
     c     BrParKey      reade     BRPARF                                 33
     c                   enddo
     c
     c                   endsr
