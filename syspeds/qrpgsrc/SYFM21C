      *
      ***********************************************************
      *** PROGRAM SKAL SPØRRE PÅ OPPDRAG (VISE FRAKTBREV/T.P) ***
      ***********************************************************
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX * 01 JOV PTF11 Flere parameter til SYFA10A (varelinjer) - BRINGTMS-prosjekt.
********************************************************************
      *
     FDOKUF     UF   E           K DISK
     FKOFAST    IF   E           K DISK
     FFIRMPDF   IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FFIRM      IF   E           K DISK
     FSYFM21FC  CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     D                 DS
     D  DFNAVM                 1     30
     D  DFNAMW                 1     29
     D                 DS
     D  DFADUL                 1     30
     D  WSADUL                 1     24
     D                 DS
     D  WSDTUD                 1      2  0
     D  WSDTUM                 3      4  0
     D  WSDTUÅ                 5      6  0
     D  WSDTU                  1      6  0
     D                 DS
     D  DFDTUÅ                 1      4  0
     D  DFDTUM                 5      6  0
     D  DFDTUD                 7      8  0
     D  DFDTU                  1      8  0
     D                 DS
     D  DFMÅL                  1     17
     D  DFDTMO                 1      8
     D  DFKLMO                 9     12
     D  DFSGM                 13     17
     C*
     C     DOKUFK        KLIST
     C                   KFLD                    XDFRI
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C*
     C     DOKUF2        KLIST
     C                   KFLD                    XDFRI
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    XXXNR
     C     PROKEY        KLIST
     C                   KFLD                    PROTYP
     C                   KFLD                    DFPROK
     C                   MOVEL     'FRBREVPR'    PROTYP           10
     C                   MOVE      'O '          PROTYP
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UFIRM             2
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD              7 0
     C                   PARM                    UFBNR             3 0
     C                   PARM                    UFLAGG            1 0
     C*
     C                   MOVE      0             UFLAGG
     C                   MOVE      'F'           XDFRI             1
     C                   Z-ADD     1             XXXNR             3 0
     C                   MOVE      *ZEROS        DFDTU
     C                   MOVE      *ZEROS        WSDTU
     c                   read      firm                                   33
     c                   setoff                                       33
      *
      * DIREKTEKALL SPESIFIKK FRAKTBREV
      *
     C     UFBNR         IFNE      *ZEROS
     C                   MOVE      UFBNR         XXXNR
     C     DOKUF2        CHAIN(N)  DOKUF                              33
     C  N33              MOVEL     DF1004        WSSNDN
     C     DFKDME        IFEQ      'B'
     C                   SETON                                        50
     C                   ELSE
     C                   SETOFF                                       50
     C                   ENDIF
     C                   MOVEL     DFAD3S        WSAD3S
     C                   MOVE      *BLANKS       PRODNA
     C     DFPROK        IFNE      *BLANKS
     C     PROKEY        CHAIN     KOFAST                             77
     C  N77              MOVEL     KFTXT         PRODNA
     C                   END
      *
     C     DFDTU         IFEQ      *ZEROS
     C                   MOVE      *ZEROS        WSDTU
     C                   ELSE
     C                   EXSR      KDTFM1
     C                   END
      *
     C     START         TAG
      *
     C     DFDTMO        COMP      *BLANKS                            5151
     C  N33              EXFMT     BILDE01
     C  N33
     CAN 50              EXFMT     POSTEN
      * ANNEN FRAKTBETALER
     C     *IN20         IFEQ      *ON
     C                   EXFMT     ANNEN
     C                   GOTO      START
     C                   END
      * GÅ TIL VARELINJE VEDLIKEHOLD
     C   10              DO
     C                   MOVE      'J'           UVIS              1
N01  C                   MOVE      *ZEROS        xxLMLA            4 2
N01  C                   MOVE      *ZEROS        xxPOEN            5 0
     C                   CALL      'SYFA10A'
     C                   PARM                    DFAVD
     C                   PARM                    DFOPD
     C                   PARM                    DFFBNR
     C                   PARM                    DFNT
     C                   PARM                    DFVKT
     C                   PARM                    DFLM
N01  C                   PARM                    xxLMLA
     C                   PARM                    DFM3
N01  C                   PARM                    xxPOEN
     C                   PARM                    DFGM
     C                   PARM                    DFGM2
     C                   PARM                    DFCMN
     C                   PARM                    DFVS
     C                   PARM                    UVIS
     C                   GOTO      START
     C                   END
      * GODS-MERKING PÅ FRAKTBREVS-NIVÅ (LINJENR 00) KOLLI-ID M.M.
     C     *IN13         IFEQ      *ON
     C                   MOVE      *ZEROS        ULINR             2 0
     C                   MOVE      'J'           UVIS              1
     C                   CALL      'SYFA10B'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR
     C                   PARM                    ULINR
     C                   PARM                    UVIS
     C                   GOTO      START
     C                   ENDIF
     C     *IN17         IFEQ      *ON
     C                   MOVE      '1'           UVIS              1
     C                   CALL      'SYFI10V'
     C                   PARM                    DFAVD
     C                   PARM                    DFOPD
     C                   PARM                    DFFBNR
     C                   PARM                    UVIS
     C                   GOTO      START
     C                   ENDIF
     C     *IN18         IFEQ      *ON
     C                   MOVE      '1'           UVIS
     C                   CALL      'SYFI10U'
     C                   PARM                    DFAVD
     C                   PARM                    DFOPD
     C                   PARM                    DFFBNR
     C                   PARM                    UVIS
     C                   GOTO      START
     C                   ENDIF
      * F22= SE EDI-LOGG
     C     *IN22         IFEQ      *ON
     C                   MOVE      'IFTMIN'      EDITYP            6
     C                   MOVE      'S'           TSTSPØ            1
     C                   MOVE      ' '           IN29              1
     C                   CALL      'SYEDIL'
     C                   PARM                    DFAVD
     C                   PARM                    DFOPD
     C                   PARM                    DFFBNR
     C                   PARM                    EDITYP
     C                   PARM                    TSTSPØ
     C                   PARM                    IN29
     C                   GOTO      START
     C                   ENDIF
     C                   GOTO      SLUTT
     C                   END
      *
     C     DOKUFK        SETLL     DOKUF
     C     DOKUFK        READE(N)  DOKUF                                  30
     C   30              SETON                                        LR
     C   30              RETURN
     C*
     C                   EXSR      FRASR
     C   03              Z-ADD     3             UFLAGG
     C   12              Z-ADD     9             UFLAGG
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C***********************************************
     C     FRASR         BEGSR
     C***********************************************
     C*
     C*
     C*
     C*
     C     STTUR         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     DOKUFK        SETLL     DOKUF
     C     STTUR1        TAG
     C     DOKUFK        READE(N)  DOKUF                                  94
      *
     C     STTUR2        TAG
      *
     C  N94              DO
     C                   DO        8
     C                   ADD       1             ZRECNO
     C                   MOVEL     DF1004        WSSNDN
     C                   WRITE     SUBFIL
     C                   MOVE      DFFBNR        XXXNR
     C     ST21B         TAG
     C     DOKUFK        READE(N)  DOKUF                                  94
     C  N94              MOVE      DFFBNR        XXXNR
     C  N94              END
     C                   END
     C*
     C     NYTXX         TAG
     C                   MOVE      ZRECNO        XRECNO            4 0
     C     STTUR3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   WRITE     NYVARE
     C                   GOTO      ST41
     C                   END
     C                   WRITE     SUBCTL
     C*
     C*** AVSLUTT
     C     ST41          TAG
     C                   EXFMT     BUNN
     C*
     C*
     C*** BLA VIDERE
     C   25              DO
     C                   Z-ADD     XRECNO        ZRECNO
     C                   SETOFF                                       25
     C     DOKUF2        SETLL     DOKUF
     C                   READ(N)   DOKUF                                  94
     C                   GOTO      STTUR2
     C                   END
     C   12              GOTO      UT
     C   03              GOTO      UT
     C*
     C     LESNT         TAG
     C*
     C     ZRECNO        IFEQ      0
     C                   GOTO      STTUR3
     C                   ELSE
     C                   EXSR      HHENT
     C  N88              GOTO      STTUR3
     C                   SETOFF                                       88
     C                   GOTO      STTUR
     C                   END
     C*
     C     UT            ENDSR
     C*
     C***********************************************
     C     HHENT         BEGSR
     C***********************************************
     C     KEYFB         KLIST
     C                   KFLD                    XDFRI
     C                   KFLD                    DFAVD
     C                   KFLD                    DFOPD
     C                   KFLD                    DFFBNR
     C                   MOVEA     '00'          *IN(91)
     C                   SETOFF                                       9830
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
      *
      * start spørring
      *
     C  N98WSNR          IFEQ      '5'
     C                   move      dffbnr        ufbnr
     C     KEYFB         CHAIN(N)  DOKUF                              33
     C                   MOVEL     DF1004        WSSNDN
     C     DFKDME        IFEQ      'B'
     C                   SETON                                        50
     C                   ELSE
     C                   SETOFF                                       50
     C                   ENDIF
     C                   MOVEL     DFAD3S        WSAD3S
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   MOVE      *BLANKS       PRODNA
     C     DFPROK        IFNE      *BLANKS
     C     PROKEY        CHAIN     KOFAST                             77
     C  N77              MOVEL     KFTXT         PRODNA
     C                   END
     C     DFDTU         IFEQ      *ZEROS
     C                   MOVE      *ZEROS        WSDTU
     C                   ELSE
     C                   EXSR      KDTFM1
     C                   END
     C     HENT02        TAG
     C     DFDTMO        COMP      *BLANKS                            5151
     C                   EXFMT     BILDE01
     C   50              EXFMT     POSTEN
     C                   END
      * ANNEN FRAKTBETALER
     C     *IN20         IFEQ      *ON
     C                   EXFMT     ANNEN
     C                   GOTO      HENT02
     C                   END
      * GÅ TIL VARELINJE VEDLIKEHOLD
      *
     C   10              DO
     C                   MOVE      'J'           UVIS              1
     C                   CALL      'SYFA10A'
     C                   PARM                    DFAVD
     C                   PARM                    DFOPD
     C                   PARM                    DFFBNR
     C                   PARM                    DFNT
     C                   PARM                    DFVKT
     C                   PARM                    DFLM
N01  C                   PARM                    xxLMLA
     C                   PARM                    DFM3
N01  C                   PARM                    xxPOEN
     C                   PARM                    DFGM
     C                   PARM                    DFGM2
     C                   PARM                    DFCMN
     C                   PARM                    DFVS
     C                   PARM                    UVIS
     C                   GOTO      HENT02
     C                   END
      * GODS-MERKING PÅ FRAKTBREVS-NIVÅ (LINJENR 00) KOLLI-ID M.M.
     C     *IN13         IFEQ      *ON
     C                   MOVE      *ZEROS        ULINR             2 0
     C                   MOVE      'J'           UVIS              1
     C                   CALL      'SYFA10B'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR
     C                   PARM                    ULINR
     C                   PARM                    UVIS
     C                   GOTO      HENT02
     C                   ENDIF
     C     *IN17         IFEQ      *ON
     C                   MOVE      '1'           UVIS
     C                   CALL      'SYFI10V'
     C                   PARM                    DFAVD
     C                   PARM                    DFOPD
     C                   PARM                    DFFBNR
     C                   PARM                    UVIS
     C                   GOTO      HENT02
     C                   ENDIF
     C     *IN18         IFEQ      *ON
     C                   MOVE      '1'           UVIS
     C                   CALL      'SYFI10U'
     C                   PARM                    DFAVD
     C                   PARM                    DFOPD
     C                   PARM                    DFFBNR
     C                   PARM                    UVIS
     C                   GOTO      HENT02
     C                   ENDIF
      * F22= SE EDI-LOGG
     C     *IN22         IFEQ      *ON
     C                   MOVE      'IFTMIN'      EDITYP            6
     C                   MOVE      'S'           TSTSPØ            1
     C                   MOVE      ' '           IN29              1
     C                   CALL      'SYEDIL'
     C                   PARM                    DFAVD
     C                   PARM                    DFOPD
     C                   PARM                    DFFBNR
     C                   PARM                    EDITYP
     C                   PARM                    TSTSPØ
     C                   PARM                    IN29
     C                   GOTO      HENT02
     C                   ENDIF
     C                   END                                                    <WSNR = 5
      *
      * start sletting
      *
     C  N98WSNR          IFEQ      '4'
     C*
     C     KEYFB         CHAIN(N)  DOKUF                              33
     C                   MOVEL     DF1004        WSSNDN
     C                   SETON                                        88
     C                   EXFMT     BILDE01
     C     *IN23         IFEQ      *ON
     C     KEYFB         CHAIN     DOKUF                              33
     C     *IN33         IFEQ      *OFF
     C                   DELETE    DOKUFR
     C                   ENDIF
     C                   ENDIF
     C*
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   END                                                    <WSNR = 4
      *
      * FOR PDF BRUKERE
      *
     C  N98WSNR          IFEQ      'P'
     C                   move      dffbnr        ufbnr
     C     KEYFB         CHAIN(N)  DOKUF                              33
     C                   MOVEL     DF1004        WSSNDN
     C     DFKDME        IFEQ      'B'
     C                   SETON                                        50
     C                   ELSE
     C                   SETOFF                                       50
     C                   ENDIF
     C                   MOVEL     DFAD3S        WSAD3S
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   MOVE      *BLANKS       PRODNA
     C     DFPROK        IFNE      *BLANKS
     C     PROKEY        CHAIN     KOFAST                             77
     C  N77              MOVEL     KFTXT         PRODNA
     C                   END
     C     DFDTU         IFEQ      *ZEROS
     C                   MOVE      *ZEROS        WSDTU
     C                   ELSE
     C                   EXSR      KDTFM1
     C                   END
     C     DFDTMO        COMP      *BLANKS                            5151
     C     FIFIRM        CHAIN     FIRMPDF                            33
     C  N33FIFIRM        CHAIN     FIRMARC                            33
     C     *IN33         IFEQ      '1'
     C                   EXFMT     BILDE01
     C   50              EXFMT     POSTEN
     C                   ELSE
     C                   EXSR      PDFFRA
     C                   END
     C                   END
     C*
     C*
     C     UTHENT        ENDSR
     C*
     C*
     C***********************************************
     C     KDTFM1        BEGSR
     C***********************************************
     C                   MOVE      DFDTUD        UDT1              2 0
     C                   MOVE      DFDTUM        UDT2              2 0
     C                   MOVE      DFDTUÅ        UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          WSDTUD
     C                   MOVE      UDT2          WSDTUM
     C                   MOVE      UDT3          WSDTUÅ
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     PDFFRA        BEGSR
     C***********************************************
     c                   move      'J'           vise              1
     c                   move      'F'           type              1
     c     dftoll        ifne      *zeros
     c                   move      'T'           type
     c                   end
     C                   MOVE      UAVD          AAVD              4
     C                   MOVE      UOPD          ATDN              7
     C                   MOVE      '001'         Afbn              3
     C                   move      *blanks       ubane            50
     C                   move      *blanks       updf
     c                   movel     'http://'     updf             70
     C     updf          CAT       pdipad:0      updf
     C     updf          CAT       '/':0         updf
     C     updf          CAT       pdbane:0      updf
     C     updf          CAT       '/':0         updf
     C     updf          CAT       'FBRE':0      updf
     C     updf          CAT       aavd:0        updf
     C     updf          CAT       atdn:0        updf
     C     updf          CAT       afbn:0        updf
     C     updf          CAT       '.PDF':0      updf
     C                   movel     '/'           ubane
     C     ubane         CAT       pdbane:0      ubane
     C     ubane         CAT       '/':0         ubane
     C     ubane         CAT       'FBRE':0      ubane
     C     ubane         CAT       aavd:0        ubane
     C     ubane         CAT       atdn:0        ubane
     C     ubane         CAT       afbn:0        ubane
     C     ubane         CAT       '.PDF':0      ubane
     C                   CALL      'PDF003CL'
     C                   PARM                    AAVD
     C                   PARM                    ATDN
     C                   PARM                    AFBN
     C                   PARM                    type
     C                   PARM                    updf
     C                   PARM                    ubane
     C                   PARM                    vise
     C*
     C                   ENDSR
