      *********************************************************************
      * ARBEID MED ORDRE  (oversjø OG land, merk to ulike HTML ESOVERS5 og ESOVERS5L)
      * PROGRAM BEHANDLER INPUT FRA ESOVERS1
      *
CRTPG+*  CRTPGM SYSPED/ESOVERS5 MODULE(*LIBL/ESOVERS5
CRTPGM*        *LIBL/CHECKUSR *LIBL/INCGI) ACTGRP(CGI) AUT(*USE)
      *
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 KRAV PÅ MOTTAKERS KUNDENR
10014 * 02 YBC PTF10 VIS OPPDRAGSNR VED NY REGISTRERING
      *              KOPIERING AV OPPDRAG
10XXX * 03 YBC PTF10 SJEKK OM DET ER FLERE CONTAINERE ENN 4
10XXX * 04 YBC PTF10 OPPDATER OGSÅ VARIABLE PÅ HTML
10XXX * 05 YBC PTF10 VIS CONTAINER INFORMASJONER
10XXX * 06 YBC PTF10 OPPDATER BLANK PÅ BLMM PGA. STATUS NEW OG UPDATED
10XXX * 07 YBC PTF10 KOLLI PÅ CONTAINER
10XXX * 08 YBC PTF10 DOBBELT BRUK AV INDIKATOR 33
10XXX * 09 YBC PTF10 SJEKK OM POMS-OPPDRAG
10XXX * 10 JOV PTF10 ADVANCED SHIPPING NOTICE BUTTON (EGENTLIG CC-SPESIAL)
10XXX * 11 YBC PTF10 DEFAULT AVDELING, IMPORT/EKSPORT
10XXX * 12 JOV PTF10 TRUCK-lauout, forløpig hardkodet dersom avd = 75 (booking Nortrail)
10XXX * 13 YBC PTF10 UTSKRIFT FOR CC-NEDERLAND
10XXX * 14 JOV PTF10 lagre contact info / merknader
10172 * 15 SH  PTF10 norsk text til Track and trace
10184 * 16 jov PTF10 Ikke error ved M3 over 999,99
      * 17 jov PTF10 Booking Land-ta med kpers/mail/tlf fra CUNDF
      * 18 jov PTF10 Booking Land-ta med GDandMarks
10XXX * 19 YBC PTF10 HINDRE ENDRING PÅ FRA OG TIL HAVN VED POMS
10XXX * 20 YBC PTF10 VED VEKT PÅ TUR > 99999 SETTER 99999 PÅ TUTVKT
10XXX * 21 YBC PTF10 FRITEKST
10XXX * 22 YBC PTF10 c2n2 TOLKE . SOM TUSENTEGN. DVS. 12.345 TOLKET SOM 123456
10XXX *              VED KONVERTERING AV M3 OG LM, BRUKER EGEN RUTINE.
10XXX *              BEHANDLER "." OG "," SAMME SOM KOMMA
10XXX * 23 YBC PTF10 SJEKK OGSÅ KOLLI/VEKT PÅ CONTAINER VED TEST PÅ KOLLI/VEKT
10XXX * 24 YBC PTF10 OPPDATER WSPO/WSART PGA. POMS
10XXX * 25 YBC PTF10 VIS FLERE DOKUMENTER
10XXX * 26 JOV PTF10 HVIS FRAPOMS-summer vekter mm basert på PO/POLIN
10XXX * 27 JOV PTF10 Vis evt HOUSEBL - er lagret i BLREIS
10261 * 28 YBC PTF10 VEKT,KUBIKK,KOLLI PÅ TURER ER ØKT TIL 9.0, 7.3 OG 7.0
      * 29 JOV PTF10 utvidet HERFA
      * 30 JOV PTF10 Ved import land benyttes TIL-dato som oppdragsdato
10XXX * 31 YBC PTF10 VED KOPIERE POMS-OPPDRAG SKAL TURNR IKKE BLANKES
      *%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * 32 JOV PTF11 Button prt wayb/label(genPDF) fra booking land + Key DOKUFE
      * 33 JOV PTF11 Button send pickupmai         fra booking land
      * 34 JOV PTF11 beva tlf/mail selv om kpers er blank (land) + lagre oppd.giv navn
      * 35 JOV PTF11 Innlandshåndtering / vis Fratbrevsnr (MEN ikke tillat manuell tildeling)
      * 36 JOV PTF11 Button send SMS               fra booking land
      * 37 YBC PTF11 OPPDATER T&T VED ENDRING PÅ ETD, ETA, ATD OG ATA
      * 38 JOV PTF11 Load/Unloadpl.
      * 39 JOV PTF11 Innh/utkjøring (i første omgang kun innhenting)
      * 40 YBC PTF11 IKKE OPPDATER BLANK PÅ BLREIS
      * 41 YBC PTF11 BLLSS=HESDFF, BLLSH=HESDF, BLLOH=HESDF, BLLOS=HESDVT
      * 42 YBC PTF11 MAX DOKUMENTER ER ØKT TIL 25
      *%%%%%
      * 43 JOV PTF12 button for TKeventgrabberSMS innført
********************************************************************
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
     FBRIDF     UF   E           K DISK    USROPN
     FTURER14   UF   E           K DISK    USROPN
     FHEADF     UF A E           K DISK    USROPN
     FDISP      UF A E           K DISK    USROPN
N14  FDOKUFE    UF A E           K DISK    USROPN
N14  FFREETXT1  UF A E           K DISK    USROPN
     FBILLOF    UF A E           K DISK    USROPN
     FBLV1      UF A E           K DISK    USROPN
N09  FEPOH02    IF   E           K DISK    USROPN
N09  FEPOL02    IF   E           K DISK    USROPN
     FTRACKT    UF A E           K DISK    USROPN
     FTRACKF    O  A E             DISK    USROPN
     FSTED2     IF   E           K DISK    USROPN
N12  FSTED2D    IF   E           K DISK    USROPN
N12  F                                     RENAME(STED2R:STED2RD)
     FBRPARF    if   e           k disk    usropn
     FCUNDL01   IF   E           K DISK    USROPN
N17  FVADR      IF   E           K DISK    USROPN
     FcdboAT    IF   E           K DISK    USROPN
     FCDTRAFL2  IF   E           K DISK    USROPN
     FCDCON4    IF   E           K DISK    USROPN
N11  FKODTA     IF   E           K DISK    USROPN
     FKODTOTY   if   e           k disk    usropn
N35  FKODTOT2   if   e           k disk    usropn
     FKODTFR    if   e           k disk    usropn
     FTELL      UF   E           K DISK    USROPN
     FARKIVL02  IF   E           K DISK    usropn
     FFIRMARC   IF   E           K DISK    usropn
     FARKTXT    IF   E           K DISK    usropn
     FARKEXT    IF   E           K DISK    usropn
s35  F*RISOK    IF   E           K DISK    usropn
N35  FFRISOK    IF A E           K DISK    usropn
N10  FEPOPOS    IF   E           K DISK    usropn
N38  FKODTERM   IF   E           K DISK    USROPN
      *--------------------------------------------------------------------
      * Prototype definitions and standard system API error structure
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      * Variables common to CGI programs
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
      * VARIABLES SPECIFIC TO THIS PROGRAM
      *--------------------------------------------------------------------
      * Variables received from the input string
     D SubmPressed     s              1
     D lng             s              2
     D OKBUTTON        S             80
N02  D KOPIBUTTON      S             80
N10  D ASNBUTTON       S            180
N32  D FBRBUTTON       S            180
N32  D LABBUTTON       S            180
s43  D*PICKBUTTON      S            180
N43  D PICKBUTTON      S           1000
     D WSMORECN        S              1
N21  D WSFRTXT         S              1
     D BckGnd          s             10
     D UsrSpcName      s             10
     D WSUSER          S             10
     D WSNA            S             30
N24  D WSPO            S             10
N24  D WSART           S             35
     D XXENDRE         S              1
     D XXADR           S             17
     D XXNY            S              1
     D AVVIKSK         S              1
     D GMAVVIKSK       S              1
     D WSUPLOAD        S              1
     D WSRFA           S             15
     D GMRFA           S             15
     D WSBLNR          S             16
     D WSBLORR         S              1
     D WSREIS          S             14
     D WSTR            S              4
     D WSOB            S              5
N09  D WSTUR           S              8
N09  D BSTUR           S              8  0
N09  D FROMPOMS        S              1
N19  D FROMPOMS2       S              1
     D WSAVD           S              4
     D BSAVD           S              4  0
     D WSOPD           S              7
     D BSOPD           S              7  0
N35  D WSFBN           S             17
     D WSETA           S             10
     D BSETA           S              8  0
     D WSETD           S             10
     D BSETD           S              8  0
     D WSATA           S             10
     D BSATA           S              8  0
     D WSATD           S             10
     D BSATD           S              8  0
N38  D WSKNA           S              8
N38  D BSKNA           S              8  0
     D WSKNS           S              8
     D BSKNS           S              8  0
     D WSNAS           S             30
     D WSADS1          S             30
     D WSADS2          S             30
     D WSADS3          S             30
N14  D WSSCONT         S             30
N14  D WSSTLF          S             30
N14  D WSSMAIL         S             70
     D GMKNS           S              8
     D GMNAS           S             30
     D GMADS1          S             30
     D GMADS2          S             30
     D GMADS3          S             30
N14  D WSKCONT         S             30
N14  D WSKTLF          S             30
N14  D WSKMAIL         S             70
     D WSKNK           S              8
     D BSKNK           S              8  0
     D WSNAK           S             30
     D WSADK1          S             30
     D WSADK2          S             30
     D WSADK3          S             30
     D GMKNK           S              8
     D GMNAK           S             30
     D GMADK1          S             30
     D GMADK2          S             30
     D GMADK3          S             30
     D WSLSS           S              5
     D WSLSH           S              5
     D WSVH            S              5
     D WSVH2           S              5
     D WSLOH           S              5
     D WSLOS           S              5
     D WSOT            S              2
     D WSFR            S              3
     D WSNT            S              7
     D BSNT            S              7  0
     D WSVKT           S              9
     D BSVKT           S              9  0
     D WSM3            S              8
     D BSM3            S              7  3
N16  D TUTM3X          S              9  3
     D WSLM            S              5
     D BSLM            S              4  2
     D WSVS1           S             25
     D WSVS2           S             25
     D WSGM1           S             15
     D WSGM2           S             15
N38  D WSSDL           S             20
N14  D WSMTxt          S           6300
N14  D WSTTxt          S           6300
N14  D WSSTxt          S           6300
N07  D WSNT1           S              5
     D WSVKT1          S              9
     D WSM31           S             10
N07  D WSNT2           S              5
     D WSVKT2          S              9
     D WSM32           S             10
N07  D WSNT3           S              5
     D WSVKT3          S              9
     D WSM33           S             10
N07  D WSNT4           S              5
     D WSVKT4          S              9
     D WSM34           S             10
     D NavnAdr         S             60
N17  D LKS             S              2                                         SELGERS LK
N17  D LKK             S              2                                         KJØPERS LK
     D VelgOtFr        S              1
     D KunUpload       S              1
N02  D XKOPIOPD        S              1
N39  D LagFF           S              1
N39  D LagVF           S              1
     D POLine          S            600
      *Array for fri-tekster
s14  D*TX              S             70    DIM(10)
N14  D TX              S             70    DIM(90)
     D PGM             C                   CONST('SYSPED/CHECKUSR')
      * Variables used to load the external html source member
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
      *
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
     D FMELDNR         S              2
     D FEILMELDING     S            100

     D                 DS
     D  ParmOS12               1   1024
     D  OSCHG                  1      1
     D  OSOT16                 2     49
     D  OSOT                   2     49    DIM(16)
     D  OtString               2     49
     D  OT                     2     49    DIM(16)
     D  OSFR12                50     97
     D  OSFR                  50     97    DIM(12)
     D  FrString              50     97
     D  FR                    50     97    DIM(12)
     D  OSAVD                 98    101  0
N09  D                 DS
N09  D  TUTARF                 1     15
N09  D  TUBLORR                1      1
N09  D  TUTR                   2      5
N22  D                 DS
N22  D XALFATALL               1     15
N22  D XAT                     1     15    DIM(15)
N22  D                 DS
N22  D XNUMTAL                 1     15  6
N22  D XNTH                    1      9  0
N22  D XNTD                   10     15  0 DIM(6)
     D                 DS
     D HEAVD                   1      4  0
     D DIAVD                   1      4  0
     D BLAVD                   1      4  0
     D BVAVD                   1      4  0
     D TXAVD                   1      4  0
     D TTAVD                   1      4  0
     D                 DS
     D HEOPD                   1      7  0
     D DIOPD                   1      7  0
     D BLOPD                   1      7  0
     D BVOPD                   1      7  0
     D TXOPD                   1      7  0
     D TTOPD                   1      7  0
     D                 DS
     D HESG                    1      3
     D DISIGN                  1      3
     D BLSG                    1      3
     D                 DS
     D HEUR                    1      1
     D BLUR                    1      1
     D                 DS
     D HEDTR                   1      8  0
     D BLDTR                   1      8  0
     D                 DS
     D WSDTÅÅ                  1      4
     D WSDTMM                  5      6
     D WSDTDD                  7      8
     D WSDT                    1      8
     D                 DS
     D WSCN1                   1     17
     D WSCN2                  18     34
     D WSCN3                  35     51
     D WSCN4                  52     68
S03  D*CN                      1     68    DIM(4)
N03  D CN                      1     85    DIM(5)
     D                 DS
     D WSCT1                   1      2
     D WSCT2                   3      4
     D WSCT3                   5      6
     D WSCT4                   7      8
S03  D*CT                      1      8    DIM(4)
N03  D CT                      1     10    DIM(5)
     D                 DS
     D WSCT1t                  1     30
     D WSCT2t                 31     60
     D WSCT3t                 61     90
     D WSCT4t                 91    120
S03  D*CTt                     1    120    DIM(4)
N03  D CTt                     1    150    DIM(5)
N07  D                 DS
N07  D BSNT1                   1      5  0
N07  D BSNT2                   6     10  0
N07  D BSNT3                  11     15  0
N07  D BSNT4                  16     20  0
N07  D NT                      1     25  0 DIM(5)
     D                 DS
     D BSVKT1                  1      9  0
     D BSVKT2                 10     18  0
     D BSVKT3                 19     27  0
     D BSVKT4                 28     36  0
S03  D*VK                      1     36  0 DIM(4)
N03  D VK                      1     45  0 DIM(5)
     D                 DS
     D BSM31                   1      9  3
     D BSM32                  10     18  3
     D BSM33                  19     27  3
     D BSM34                  28     36  3
S03  D*M3                      1     36  3 DIM(4)
N03  D M3                      1     45  3 DIM(5)
N25   * Arkivtyper 16 elem. a 3 tegn (sb,si,..) Type er venstrestilt
N25  D                 DS
N25  D  ATString               1    192
N25  D  ATString1              1     48
N25  D  ATString2             49     96
N25  D  ATString3             97    144
N25  D  ATString4            145    192
N25  D  AT                     1    192    DIM(64)
N25  D                 DS
N25  D  A2                     1    128    DIM(64)
      * DS for test HEURO/F, om bruker kan velge (mer enn 1) oppdt./franka.
     D                 DS
     D TYPE                    1      9
     D TYPAVD                  1      4
     D TYPMODUL                5      5
     D TYPMODUL2               6      6
     D TypMod12                5      6
     D TYPLand                 7      8
     D TYPSK                   9      9
N14
N14  D                 DS
N14  D  KVTXT                  1   6300
N14  D  KVT                    1   6300    DIM(6300)
N14  D                 DS
N14  D  TXT70                  1     70
N14  D  T70                    1     70    DIM(70)
      *
     D FEIL01          C                   CONST('PO No. has to be given.')
     D FEIL02          C                   CONST('ETD is not valid.-
     D                                      (format CCYY.MM.DD)')
     D FEIL03          C                   CONST('ETA is not valid.-
     D                                      (format CCYY.MM.DD)')
     D FEIL04          C                   CONST('ATD is not valid.-
     D                                      (format CCYY.MM.DD)')
     D FEIL05          C                   CONST('ATA is not valid.-
     D                                      (format CCYY.MM.DD)')
     D FEIL06          C                   CONST('Shippers name and address-
     D                                      has to be given.')
     D FEIL07          C                   CONST('Address 1 of shipper can -
     D                                      not be blank.')
     D FEIL08          C                   CONST('Consignees name and address-
     D                                      has to be given.')
     D FEIL09          C                   CONST('Address 1 of consignee can-
     D                                      not be blank.')
     D FEIL10          C                   CONST('Place of loading is not -
     D                                     valid.')
     D FEIL11          C                   CONST('Port of loading is not -
     D                                     valid.')
     D FEIL12          C                   CONST('Via port is not valid.')
     D FEIL13          C                   CONST('Via port 2 is not valid.')
     D FEIL14          C                   CONST('Port of unloading is not -
     D                                     valid.')
     D FEIL15          C                   CONST('Place of uploading is not -
     D                                     valid.')
     D FEIL16          C                   CONST('Colli can not be 0.')
     D FEIL17          C                   CONST('Weight can not be 0.')
     D FEIL18          C                   CONST('Goods description can not -
     D                                     be blank.')
     D FEIL19          C                   CONST('Vesselcode is not valid.')
     D FEIL20          C                   CONST('Type of container is not -
     D                                     valid.')
     D FEIL24          C                   CONST('Weight of container has to  -
     D                                     be given.')
     D FEIL28          C                   CONST('Shipper No. is not -
     D                                     valid.')
     D FEIL29          C                   CONST('Consignee No. is not -
     D                                     valid.')
     D FEIL30          C                   CONST('Parameter for department is  -
     D                                     missing on your userid. Contact -
     D                                     system administrator.')
N07  D FEIL31          C                   CONST('Colli can not be 0.')
     D FEIL36          C                   CONST('Agent No. is not -
     D                                     valid.')
      *
     D FEIL01EN        C                   CONST('PO no has to be given.')
     D FEIL02EN        C                   CONST('ETA is not valid.-
     D                                      (format CCYY.MM.DD)')
     D FEIL03EN        C                   CONST('ETD is not valid.-
     D                                      (format CCYY.MM.DD)')
     D FEIL04EN        C                   CONST('ATA is not valid.-
     D                                      (format CCYY.MM.DD)')
     D FEIL05EN        C                   CONST('ATD is not valid.-
     D                                      (format CCYY.MM.DD)')
     D FEIL06EN        C                   CONST('Shippers name and address-
     D                                      has to be given.')
     D FEIL07EN        C                   CONST('Address 1 of shipper can -
     D                                      not be blank.')
     D FEIL08EN        C                   CONST('Consignees name and address-
     D                                      has to be given.')
     D FEIL09EN        C                   CONST('Address 1 of consignee can-
     D                                      not be blank.')
     D FEIL10EN        C                   CONST('Place of loading is not -
     D                                     valid.')
     D FEIL11EN        C                   CONST('Port of loading is not -
     D                                     valid.')
     D FEIL12EN        C                   CONST('Via port is not valid.')
     D FEIL13EN        C                   CONST('Via port 2 is not valid.')
     D FEIL14EN        C                   CONST('Port of unloading is not -
     D                                     valid.')
     D FEIL15EN        C                   CONST('Place of uploading is not -
     D                                     valid.')
     D FEIL16EN        C                   CONST('Colli can not be 0.')
     D FEIL17EN        C                   CONST('Weight can not be 0.')
     D FEIL18EN        C                   CONST('Goods description can not -
     D                                     be blank.')
     D FEIL19EN        C                   CONST('Vesselcode is not valid.')
     D FEIL20EN        C                   CONST('Type of container is not -
     D                                     valid.')
     D FEIL24EN        C                   CONST('Weight of container has to  -
     D                                     be given.')
     D FEIL28EN        C                   CONST('Shipper No. is not -
     D                                     valid.')
     D FEIL29EN        C                   CONST('Consignee No. is not -
     D                                     valid.')
     D FEIL30EN        C                   CONST('Parameter for department is  -
     D                                     missing on your userid. Contact -
     D                                     system administrator.')
N07  D FEIL31EN        C                   CONST('Colli can not be 0.')
     D FEIL36EN        C                   CONST('Agent No. is not -
     D                                     valid.')
      * For xlate mellom Upper Case og Lower Case
     D UC              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZÆØÅ')
     D LC              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzæøå')
     D                 DS
      * FOR KORT STRENG, 120->200  INGEN MERKING.
     D  updf1                  1    400
     D  updf2                401    800
     D  updf3                801   1200
     D  updf4               1201   1600
     D  updf5               1601   2000
     D  updf6               2001   2400
     D  updf7               2401   2800
     D  updf8               2801   3200
     D  updf9               3201   3600
     D  updf10              3601   4000
     D  updf11              4001   4400
     D  updf12              4401   4800
     D  updf13              4801   5200
     D  updf14              5201   5600
     D  updf15              5601   6000
     D  updf16              6001   6400
     D  updf17              6401   6800
     D  updf18              6801   7200
     D  updf19              7201   7600
     D  updf20              7601   8000
N42  D  updf21              8001   8400
N42  D  updf22              8401   8800
N42  D  updf23              8801   9200
N42  D  updf24              9201   9600
N42  D  updf25              9601  10000
N42  D  updf26             10001  10400
N42  D  updf27             10401  10800
N42  D  updf28             10801  11200
N42  D  updf29             11201  11600
N42  D  updf30             11601  12000
S42  D* updf                   1   8000    DIM(20)
N42  D  updf                   1  12000    DIM(30)
      *
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================
      * MAIN PROCESSING LINE
      *=====================================================================
      * Parse input string
     C                   exsr      Parse
      *
     C                   EXSR      INIT
      *
N39   * Ved eksisterende oppdrak - hente alle hea-variable, Før kun i først syklus for ressursspar.
N39   * (dette er enkler..)
N39  C                   IF        BSOPD <> 0
N39  C     HEADFK        CHAIN(N)  HEADF                              33
N39  C                   endif
      *
N19  C                   IF        BSOPD <> 0 AND XKOPIOPD <> 'J'
N19  C                   EXSR      TESTPOMS
N19  C                   END
N39  C     LagFF         ifeq      'J'
N39  c                   move      'NO'          DUPTELK
N39  c                   move      '1000 '       DUPTERM
N39  c                   call      'LAGDUP'
N39  c                   parm                    BSAVD
N39  c                   parm                    BSOPD
N39  c                   parm                    DUPTELK           2
N39  c                   parm                    DUPTERM           5
N39  c                   parm      'FF'          DUPFFVF           2
N39  c                   parm                    BIBRID
N39  c                   parm                    SIGN
N39  c                   parm                    DUPIND            1
      * hent på ny..
N39  C     HEADFK        CHAIN(N)  HEADF                              33
N39  C                   endif
      * Hvis første kall OG en...
     c     SubmPressed   IFNE      'Y'
     C     XXENDRE       ANDEQ     ' '
S09  C*    WSAVD         IFNE      *BLANKS
S11  C*                  IF        BSAVD <> 0
N11  C                   IF        BSOPD <> 0
      *      kommer inn med nøkkel - hent data fra fil, klar for vedlikehold
     c                   exsr      GetData
     C                   MOVE      'N'           XXNY
     c                   else
      *      kommer inn uten nøkkel - Blankt bilde, klar for ny post
     c                   exsr      GetDft
     C                   MOVE      'Y'           XXNY
     c                   end
     c                   end
     C                   IF        XXENDRE <> ' '
     C                   EXSR      GETOTFR
     C                   END
      *
      *
      * Avslutt = V - "passiv vis bilde på ny" etter åpning/lukking felt..
     c     AVSLUTT       IFEQ      'V'
     c                   move      ' '           AVSLUTT
     C                   else
      *Om en har tastet submit fra vedlikeholdsbilde, test evt lagre/avslutt
      * (Test-sr setter AVSLUTT=Y hvis feilfritt -> automatisk close...)
     C     SubmPressed   IFEQ      'Y'
      * ingen tester når kun upload
      * (submit er utført via endring i upload checkbox, av bruker som IKKE har OK-button)
     c     KunUpload     ifeq      'J'
     C                   MOVE      'J'           AVSLUTT                        (J=avslutt/Upload)
     C                   GOTO      VisHtml
     c                   end
N05   * IKKE LOV Å ENDRE MED KAN SE FLERE CONTAINER
N05  c                   IF        OSCHG <> 'J'
N21  C                   IF        WSFRTXT  = 'Y'
N21  C                   MOVE      'F'           AVSLUTT
N21  C                   END
N05  C                   IF        WSMORECN = 'Y'
N05  C                   MOVE      'M'           AVSLUTT
N05  C                   END
N05  C                   GOTO      VisHtml
N05  c                   END
     C                   EXSR      TESTB
     C                   END
     C                   END
      *
     C     AVSLUTT       IFEQ      'Y'
     C     AVSLUTT       OREQ      'J'
     C     AVSLUTT       OREQ      'M'
     C                   EXSR      OPDORDRE
     C                   End
N02   *
N02  C                   IF        XKOPIOPD = 'J'
S11  C*                  MOVE      *ZEROS        BSAVD
N02  C                   MOVE      *ZEROS        BSOPD
S35  C*                  MOVE      *ZEROS        HEAVD
N02  C                   MOVE      *ZEROS        HEOPD
N31  C                   IF        FROMPOMS = 'J'
N02  C                   MOVE      *ZEROS        HEPRO
N31  C                   END
N35  C                   MOVE      *BLANKS       WSFBN
N02  C                   MOVE      *BLANKS       WSRFA
N02  C                   MOVE      *BLANKS       WSBLNR
N02  C                   MOVE      *BLANKS       WSBLORR
N02  C                   MOVE      *BLANKS       WSTR
N02  C                   MOVE      *BLANKS       AVSLUTT
N02  C                   END
      *
      * Vis skjermbidet på ny
      * (hvis AVSLUTT=Y så autocloses vinduet umiddelbart ved load..)
      * Set output skeleton html member name
     C     VisHtml       tag
     C                   exsr      SetSkl
      * Read skeleton output html into core
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
      * Issue html section /$top
     C                   exsr      SetTop
     C                   callp     wrtsection('top')
N09  C                   IF        FROMPOMS <> 'J'
N09  C                   callp     wrtsection('PO01')
N09  C                   ELSE
N09  C                   callp     wrtsection('PO02')
N09  C                   END
N09  C                   callp     wrtsection('PO03')
      *
     C                   EXSR      DSPTROB
      *
      * Ved NY vis dato-input  (og ved BILbooking)
     C     BSOPD         ifeq      *ZEROS
N14  C     BilBook       oreq      'J'
     C                   callp     wrtsection('DatoInput')
     C                   else
      * Ved endring - MÅ klikke link for å endre datoer
     C                   callp     wrtsection('DatoLink')
     C                   end
      * Parter
N09  C                   IF        FROMPOMS <> 'J'
S11  C*                  callp     wrtsection('Parties')
N11  C                   IF        XIMPEXP = 'I'
N11  C                   callp     wrtsection('Parties1S1')
N11  C                   callp     wrtsection('Parties1S3')
N11  C                   callp     wrtsection('Parties1K2')
N11  C                   callp     wrtsection('Parties1K3')
N11  C                   ELSE
N11  C                   callp     wrtsection('Parties1S2')
N11  C                   callp     wrtsection('Parties1S3')
N11  C                   callp     wrtsection('Parties1K1')
N11  C                   callp     wrtsection('Parties1K3')
N11  C                   END
N09  C                   ELSE
N09  C                   callp     wrtsection('Parties2')
N09  C                   END
N09  C                   callp     wrtsection('Places')
N19  C                   IF        FROMPOMS <> 'J'
N19  C                   callp     wrtsection('PO11')
N19  C                   ELSE
N19  C                   callp     wrtsection('PO12')
N19  C                   END
N19  C                   callp     wrtsection('PO13')
N19  C                   IF        FROMPOMS <> 'J'
N19  C                   callp     wrtsection('PO21')
N19  C                   ELSE
N19  C                   callp     wrtsection('PO22')
N19  C                   END
N19  C                   callp     wrtsection('PO23')
N19  C                   IF        FROMPOMS <> 'J'
N19  C                   callp     wrtsection('PO31')
N09  C*                  IF        BSTUR = 0
N09  C                   IF        FROMPOMS <> 'J'
N09  C                   callp     wrtsection('LoadingM1')
N09  C                   END
N19  C                   ELSE
N19  C                   callp     wrtsection('PO32')
N19  C                   END
N09  C                   callp     wrtsection('LoadingM2')
N09  C*                  IF        BSTUR = 0
N09  C***                IF        FROMPOMS <> 'J'
N09  C***                callp     wrtsection('GDAndMarks')
N09  C***                END
N18  C                   IF        BilBook = 'J'
N18  C                   callp     wrtsection('GDAndMarks')
N18  C                   END
      *
     C     VelgOtFr      ifeq      'J'
     c                   exsr      DSPOtFr
     C                   end
      *
N14   * Fritekst / textareas
N14  c                   if        BilBook = 'J'
N14  C                   callp     wrtsection('merking')
N14  C                   END
     C
      * Container
     C                   callp     wrtsection('Container')
N09  C                   IF        FROMPOMS <> 'J'
N09  C                   callp     wrtsection('Container01')
N09  C                   END
N09  C                   callp     wrtsection('Container02')
N09  C                   IF        FROMPOMS <> 'J'
N09  C                   callp     wrtsection('Container11')
N09  C                   END
N09  C                   callp     wrtsection('Container21')
N13   *
N13  C                   IF        BIFIRM = 'NL'
N13  C                   callp     wrtsection('CCPrtNL1')
N13  C                   END
N13  C                   callp     wrtsection('CCPrtNL2')
      *
      * Vis opplastet dokumenter
     C                   IF        ((XOPPLAST = 'J') AND (HEAVD <> 0))
     C                   EXSR      HENTDOK
     C                   callp     wrtsection('Dokument')
N05  C                   IF        OSCHG = 'J'
N05  C                   callp     wrtsection('Dokument2')
N05  C                   END
     C                   END
     C                   callp     wrtsection('BUNN')

      *
     C                   exsr      SetEnd
     C                   callp     wrtsection('end')
      *
      * Send output buffer and quit
     C     SLUTT         TAG
     C                   exsr      Exit
      *
      *
      *
      *=====================================================================
      * Parse input string
      *=====================================================================
     C     Parse         begsr
     C                   eval      SubmPressed = zhbgetvar('SubmPressed')
     C                   eval      lng     = zhbgetvar('lng')
     C                   eval      BckGnd  = zhbgetvar('bckgnd')

     C                   eval      WSUSER  = zhbgetvar('USER')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   EVAL      XXENDRE = zhbgetvar('XENDRE')
     C                   EVAL      XXADR   = zhbgetvar('XXADR')
     C                   eval      WSNA    = zhbgetvar('WSNA')
N24  C                   eval      WSPO    = zhbgetvar('WSPO')
N24  C                   eval      WSART   = zhbgetvar('WSART')
     C                   eval      XXNY    = zhbgetvar('XXNY')
     C                   eval      TYPE    = zhbgetvar('TYPE')
      * Ved første kall er avvikSK (åpne både avs/mottak) blank. Hent dft.
      *
     C                   eval      WSRFA   = zhbgetvar('WSRFA')
     C     LC:UC         XLATE     WSRFA         WSRFA
     C                   eval      GMRFA   = zhbgetvar('GMRFA')
     C     LC:UC         XLATE     GMRFA         GMRFA
     C                   eval      WSBLNR  = zhbgetvar('WSBLNR')
     C     LC:UC         XLATE     WSBLNR        WSBLNR
     C                   eval      WSBLORR = zhbgetvar('WSBLORR')
     C                   eval      WSREIS  = zhbgetvar('WSREIS')
     C     LC:UC         XLATE     WSREIS        WSREIS
     C                   eval      WSTR    = zhbgetvar('WSTR')
     C                   eval      WSOB    = zhbgetvar('WSOB')
N09  C                   eval      WSTUR   = zhbgetvar('WSTUR')
N09  C                   eval      BSTUR   = c2n2(WSTUR)
N09  C                   eval      FROMPOMS = zhbgetvar('FROMPOMS')
N19  C                   EVAL      FROMPOMS2 = FROMPOMS
     C                   eval      WSAVD   = zhbgetvar('WSAVD')
     C                   eval      BSAVD   = c2n2(WSAVD)
     C                   eval      HEAVD   = BSAVD
     C                   eval      WSOPD   = zhbgetvar('WSOPD')
     C                   eval      BSOPD   = c2n2(WSOPD)
     C                   eval      HEOPD   = BSOPD
N35  C                   eval      WSFBN   = zhbgetvar('WSFBN')
     C                   eval      WSETA   = zhbgetvar('WSETA')
     C                   eval      BSETA   = c2n2(WSETA)
     C                   eval      WSETD   = zhbgetvar('WSETD')
     C                   eval      BSETD   = c2n2(WSETD)
     C                   eval      WSATA   = zhbgetvar('WSATA')
     C                   eval      BSATA   = c2n2(WSATA)
     C                   eval      WSATD   = zhbgetvar('WSATD')
     C                   eval      BSATD   = c2n2(WSATD)
      *
N38  C                   eval      WSKNA   = zhbgetvar('WSKNA')
N38  C                   eval      BSKNA   = c2n2(WSKNA)
     C                   eval      WSKNS   = zhbgetvar('WSKNS')
     C                   eval      BSKNS   = c2n2(WSKNS)
     C                   eval      WSNAS   = zhbgetvar('WSNAS')
     C     LC:UC         XLATE     WSNAS         WSNAS
     C                   eval      WSADS1  = zhbgetvar('WSADS1')
     C     LC:UC         XLATE     WSADS1        WSADS1
     C                   eval      WSADS2  = zhbgetvar('WSADS2')
     C     LC:UC         XLATE     WSADS2        WSADS2
     C                   eval      WSADS3  = zhbgetvar('WSADS3')
     C     LC:UC         XLATE     WSADS3        WSADS3
N14  C                   eval      WSSCONT = zhbgetvar('WSSCONT')
N14  C     LC:UC         XLATE     WSSCONT       WSSCONT
N14  C                   eval      WSSTLF  = zhbgetvar('WSSTLF')
N14  C                   eval      WSSMAIL = zhbgetvar('WSSMAIL')
     C                   eval      GMKNS   = zhbgetvar('GMKNS')
     C                   eval      GMNAS   = zhbgetvar('GMNAS')
     C                   eval      GMADS1  = zhbgetvar('GMADS1')
     C                   eval      GMADS2  = zhbgetvar('GMADS2')
     C                   eval      GMADS3  = zhbgetvar('GMADS3')
      *
     C                   eval      WSKNK   = zhbgetvar('WSKNK')
     C                   eval      BSKNK   = c2n2(WSKNK)
     C                   eval      WSNAK   = zhbgetvar('WSNAK')
     C     LC:UC         XLATE     WSNAK         WSNAK
     C                   eval      WSADK1  = zhbgetvar('WSADK1')
     C     LC:UC         XLATE     WSADK1        WSADK1
     C                   eval      WSADK2  = zhbgetvar('WSADK2')
     C     LC:UC         XLATE     WSADK2        WSADK2
     C                   eval      WSADK3  = zhbgetvar('WSADK3')
     C     LC:UC         XLATE     WSADK3        WSADK3
N14  C                   eval      WSKCONT = zhbgetvar('WSKCONT')
N14  C     LC:UC         XLATE     WSKCONT       WSKCONT
N14  C                   eval      WSKTLF  = zhbgetvar('WSKTLF')
N14  C                   eval      WSKMAIL = zhbgetvar('WSKMAIL')
     C                   eval      GMKNK   = zhbgetvar('GMKNK')
     C                   eval      GMNAK   = zhbgetvar('GMNAK')
     C                   eval      GMADK1  = zhbgetvar('GMADK1')
     C                   eval      GMADK2  = zhbgetvar('GMADK2')
     C                   eval      GMADK3  = zhbgetvar('GMADK3')
      *
     C                   eval      WSLSS   = zhbgetvar('WSLSS')
     C                   eval      WSLSS   = uppify(WSLSS)
N12  C                   eval      WSLKF   = zhbgetvar('WSLKF')                 ved BIL
N12  C                   eval      WSLKF   = uppify(WSLKF)
     C                   eval      WSLSH   = zhbgetvar('WSLSH')
     C                   eval      WSLSH   = uppify(WSLSH)
     C                   eval      WSVH    = zhbgetvar('WSVH')
     C                   eval      WSVH    = uppify(WSVH)
     C                   eval      WSVH2   = zhbgetvar('WSVH2')
     C                   eval      WSVH2   = uppify(WSVH2)
N12  C                   eval      WSLKT   = zhbgetvar('WSLKT')                 ved BIL
N12  C                   eval      WSLKT   = uppify(WSLKT)
     C                   eval      WSLOH   = zhbgetvar('WSLOH')
     C                   eval      WSLOH   = uppify(WSLOH)
     C                   eval      WSLOS   = zhbgetvar('WSLOS')
     C                   eval      WSLOS   = uppify(WSLOS)
     C                   eval      WSOT    = zhbgetvar('WSOT')
     C                   eval      WSOT    = uppify(WSOT)
     C                   eval      WSFR    = zhbgetvar('WSFR')
     C                   eval      WSFR    = uppify(WSFR)
     C                   eval      VelgOtFr= zhbgetvar('VelgOtFr')
     C                   eval      OtString= zhbgetvar('OtString')
     C                   eval      FrString= zhbgetvar('FrString')
      *
     C                   eval      WSNT    = zhbgetvar('WSNT')
     C                   eval      BSNT    = c2n2(WSNT)
     C                   eval      WSVKT   = zhbgetvar('WSVKT')
     C                   eval      BSVKT   = c2n2(WSVKT)
     C                   eval      WSM3    = zhbgetvar('WSM3')
S22  C*                  eval      BSM3    = c2n2(WSM3)
N22  C                   MOVEL     WSM3          XALFATALL
N22  C                   EXSR      SRKNVTAL
N22  C                   IF        XNUMTAL < 10000
N22  C                   Z-ADD     XNUMTAL       BSM3
N22  C                   ELSE
N22  C                   Z-ADD     0             BSM3
N22  C                   END
     C                   eval      WSLM    = zhbgetvar('WSLM')
S22  C*                  eval      BSLM    = c2n2(WSLM)
N22  C                   MOVEL     WSLM          XALFATALL
N22  C                   EXSR      SRKNVTAL
N22  C                   IF        XNUMTAL < 100
N22  C                   Z-ADD     XNUMTAL       BSLM
N22  C                   ELSE
N22  C                   Z-ADD     0             BSLM
N22  C                   END
      *
     C                   eval      WSVS1   = zhbgetvar('WSVS1')
     C     LC:UC         XLATE     WSVS1         WSVS1
     C                   eval      WSVS2   = zhbgetvar('WSVS2')
     C     LC:UC         XLATE     WSVS2         WSVS2
     C                   eval      WSGM1   = zhbgetvar('WSGM1')
     C     LC:UC         XLATE     WSGM1         WSGM1
     C                   eval      WSGM2   = zhbgetvar('WSGM2')
     C     LC:UC         XLATE     WSGM2         WSGM2
N38  C                   eval      WSSDL   = zhbgetvar('WSSDL')
N38  C*    LC:UC         XLATE     WSSDL         WSSDL
N14  C                   eval      WSMtxt  = zhbgetvar('mTxta')
N14  C     LC:UC         XLATE     WSMtxt        WSMtxt
N14  C                   eval      WSTtxt  = zhbgetvar('tTxta')
N14  C     LC:UC         XLATE     WSTtxt        WSTtxt
N14  C                   eval      WSStxt  = zhbgetvar('sTxta')
N14  C     LC:UC         XLATE     WSStxt        WSStxt
     C                   eval      WSUPLOAD= zhbgetvar('WSUPLOAD')
      *
     C                   eval      WSCN1   = zhbgetvar('WSCN1')
     C     LC:UC         XLATE     WSCN1         WSCN1
     C                   eval      WSCT1   = zhbgetvar('WSCT1')
     C     LC:UC         XLATE     WSCT1         WSCT1
N07  C                   eval      WSNT1   = zhbgetvar('WSNT1')
N07  C                   eval      BSNT1   = c2n2(WSNT1)
     C                   eval      WSVKT1  = zhbgetvar('WSVKT1')
     C                   eval      BSVKT1  = c2n2(WSVKT1)
     C                   eval      WSM31   = zhbgetvar('WSM31')
S22  C*                  eval      BSM31   = c2n2(WSM31)
N22  C                   MOVEL     WSM31         XALFATALL
N22  C                   EXSR      SRKNVTAL
N22  C                   IF        XNUMTAL < 1000000
N22  C                   Z-ADD     XNUMTAL       BSM31
N22  C                   ELSE
N22  C                   Z-ADD     0             BSM31
N22  C                   END
     C                   eval      WSCN2   = zhbgetvar('WSCN2')
     C     LC:UC         XLATE     WSCN2         WSCN2
     C                   eval      WSCT2   = zhbgetvar('WSCT2')
     C     LC:UC         XLATE     WSCT2         WSCT2
N07  C                   eval      WSNT2   = zhbgetvar('WSNT2')
N07  C                   eval      BSNT2   = c2n2(WSNT2)
     C                   eval      WSVKT2  = zhbgetvar('WSVKT2')
     C                   eval      BSVKT2  = c2n2(WSVKT2)
     C                   eval      WSM32   = zhbgetvar('WSM32')
S22  C*                  eval      BSM32   = c2n2(WSM32)
N22  C                   MOVEL     WSM32         XALFATALL
N22  C                   EXSR      SRKNVTAL
N22  C                   IF        XNUMTAL < 1000000
N22  C                   Z-ADD     XNUMTAL       BSM32
N22  C                   ELSE
N22  C                   Z-ADD     0             BSM32
N22  C                   END
     C                   eval      WSCN3   = zhbgetvar('WSCN3')
     C     LC:UC         XLATE     WSCN3         WSCN3
     C                   eval      WSCT3   = zhbgetvar('WSCT3')
     C     LC:UC         XLATE     WSCT3         WSCT3
N07  C                   eval      WSNT3   = zhbgetvar('WSNT3')
N07  C                   eval      BSNT3   = c2n2(WSNT3)
     C                   eval      WSVKT3  = zhbgetvar('WSVKT3')
     C                   eval      BSVKT3  = c2n2(WSVKT3)
     C                   eval      WSM33   = zhbgetvar('WSM33')
S22  C*                  eval      BSM33   = c2n2(WSM33)
N22  C                   MOVEL     WSM33         XALFATALL
N22  C                   EXSR      SRKNVTAL
N22  C                   IF        XNUMTAL < 1000000
N22  C                   Z-ADD     XNUMTAL       BSM33
N22  C                   ELSE
N22  C                   Z-ADD     0             BSM33
N22  C                   END
     C                   eval      WSCN4   = zhbgetvar('WSCN4')
     C     LC:UC         XLATE     WSCN4         WSCN4
     C                   eval      WSCT4   = zhbgetvar('WSCT4')
     C     LC:UC         XLATE     WSCT4         WSCT4
N07  C                   eval      WSNT4   = zhbgetvar('WSNT4')
N07  C                   eval      BSNT4   = c2n2(WSNT4)
     C                   eval      WSVKT4  = zhbgetvar('WSVKT4')
     C                   eval      BSVKT4  = c2n2(WSVKT4)
     C                   eval      WSM34   = zhbgetvar('WSM34')
S22  C*                  eval      BSM34   = c2n2(WSM34)
N22  C                   MOVEL     WSM34         XALFATALL
N22  C                   EXSR      SRKNVTAL
N22  C                   IF        XNUMTAL < 1000000
N22  C                   Z-ADD     XNUMTAL       BSM34
N22  C                   ELSE
N22  C                   Z-ADD     0             BSM34
N22  C                   END
     C                   eval      WSMORECN= zhbgetvar('WSMORECN')
N21  C                   eval      WSFRTXT = zhbgetvar('WSFRTXT')
N02  C                   eval      XKOPIOPD = zhbgetvar('XKOPIOPD')
     C                   eval      KunUpload = zhbgetvar('KunUpload')
N39  C                   eval      LagFF     = zhbgetvar('LagFF')
N39  C                   eval      LagVF     = zhbgetvar('LagVF')

     C                   endsr
      *=====================================================================
      * Set html output skeleton VED FEIL
      *=====================================================================
     C     SetSkl        begsr
     C                   eval      lng = uppify(lng)
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC' + lng
     C                   eval      Mbr = 'ESOVERS5'
N12   * Bil/Landbasert
N12  c                   if        BilBook = 'J'
N12  C                   eval      Mbr = 'ESOVERS5L'
N12  c                   endif
     C                   endsr
      *=====================================================================
      * Set html output variables for section /$top
      *=====================================================================
     C     SetTop        begsr
      * Repeat national language for the next invocation
     C                   callp     updhtmlvar('LNG':lng:
     C                             InitHTMLVars)
      * KUNDE
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updHtmlVar('USER':WSUSER)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHtmlVar('WSNA':WSNA)
     C                   callp     updHtmlVar('KUNDE':
     C                             %trim(%editc(BIKUNR:'Z')))
     C                   callp     updHTMLvar('sdato':
     C                             %trim(%editw(BIDTV:'    .  .  ')))
     C                   callp     updHTMLvar('stid':
     C                             %trim(%editw(BITIDV:'  .  .  ')))
N09  C                   IF        FROMPOMS <> 'J'
N09  C                   callp     updhtmlvar('WIDTH1':'850')
N09  C                   callp     updhtmlvar('WIDTH2':'800')
N09  C                   ELSE
N09  C                   callp     updhtmlvar('WIDTH1':'600')
N09  C                   callp     updhtmlvar('WIDTH2':'550')
N09  C                   END
N24  C                   callp     updHtmlVar('WSPO':WSPO)
N24  C                   callp     updHtmlVar('WSART':WSART)
      *
     C                   callp     updHtmlVar('XXNY':XXNY)
     C                   callp     updHtmlVar('TYPE':TYPE)
      * evt vilkår for om OtY/frank skal vises er hentet opp ved 1. syklus
     C                   callp     updHtmlVar('VelgOtFr':VelgOtFr)
     C                   callp     updHtmlVar('OtString':OtString)
     C                   callp     updHtmlVar('FrString':FrString)
      *
      *
      * Oversjø PO fri søkevei-kode ??
     c                   move      *blanks       POLine
S35  C*    FSKODE        ifne      *blanks
N35  C     OSPOKOD       ifne      *blanks
N35  c                   move      OSPOKOD       FSKODE
     c     FrisokKey     setll     FRISOK
     c     FrisokKey     reade     FRISOK                                 33
     C     *in33         doweq     '0'
     C     POLIne        ifeq      *blanks
     C     WSRFA         ifeq      *blanks
     c                   eval      WSRFA = FSSOK
     c                   else
     C                   eval      POLine='<tr><td></td><td>'+%trim(FSSOK)
     c                   end
     c                   else
     C                   eval      POLine= %trim(POLine)+', '+%trim(FSSOK)
     c                   end
     c     FrisokKey     reade     FRISOK                                 33
     c                   enddo
     C     POLIne        ifne      *blanks
     C                   eval      POLine= %trim(POLine)+'</td></tr>'
     c                   end
     c                   end
     C                   callp     updHtmlVar('POLINE':POLine)
     C                   callp     updHtmlVar('WSRFA':WSRFA)
     C                   callp     updHtmlVar('GMRFA':GMRFA)
     C                   callp     updHtmlVar('WSBLNR':WSBLNR)
     C                   callp     updHtmlVar('WSBLORR':WSBLORR)
     C                   callp     updHtmlVar('WSREIS':WSREIS)
N27   * HouseBL lagret i BLREIS (uheldig dersom en velger å ta i bryk Vessel/Voyage igjen)
N27   * ShowVess er pr nå hardkodet N i init
N27  C                   if        WSReis <> *blanks
N27  C                   callp     updHtmlVar('WSREIS':WSREIS)                  HouseB/L (kun outp.)
N27  C                   else
N27  C                   callp     updHtmlVar('WSREIS':'_________')             HouseB/L (kun outp.)
N27  C                   endif
N09  C                   callp     updhtmlvar('WSTUR':
N09  C                             %trim(%editc(BSTUR:'Z')))
N09  C                   callp     updHtmlVar('FROMPOMS':FROMPOMS)
     C                   callp     updhtmlvar('WSAVD':
     C                             %trim(%editc(HEAVD:'Z')))
     C                   callp     updhtmlvar('WSOPD':
     C                             %trim(%editc(HEOPD:'Z')))
     C                   callp     updhtmlvar('WSPRO':
     C                             %trim(%editc(HEPRO:'Z')))
N35  c                   if        WSFBN = *blanks
N35  c                   move      'IFB'         FSKODE
N35  c     FrisokKey     chain     FRISOK                             33
N35  C  N33              movel     FSSOK         WSFBN
N35  c                   if        *in33= '1' and BSOPD<>0 and Innland='J'
N35  c                   exsr      GetSnd
N35  c                   endif
N35  c                   endif
N35  C                   callp     updHtmlVar('WSFBN':WSFBN)
     C     HEPRO         CHAIN(N)  TURER14                            33
     C                   callp     updHtmlVar('WSBNV':TUBNV)
      * Ved NY = Åpen for input  normal editering
     C                   callp     updHTMLvar('WSETA':
     C                             %trim(%editw(BSETA:'    .  .  ')))
     C                   callp     updHTMLvar('WSETD':
     C                             %trim(%editw(BSETD:'    .  .  ')))
     C                   callp     updHTMLvar('WSATA':
     C                             %trim(%editw(BSATA:'    .  .  ')))
     C                   callp     updHTMLvar('WSATD':
     C                             %trim(%editw(BSATD:'    .  .  ')))
      * Ved ENDRING =  editering  via link.
     C     HEOPD         ifne      *zeros
N14  C     BilBook       andne     'J'
     C     BSETA         ifeq      *zeros
     C                   callp     updHTMLvar('WSETA':'_________')
     C                   end
     C     BSETD         ifeq      *zeros
     C                   callp     updHTMLvar('WSETD':'_________')
     C                   end
     C     BSATA         ifeq      *zeros
     C                   callp     updHTMLvar('WSATA':'_________')
     C                   end
     C     BSATD         ifeq      *zeros
     C                   callp     updHTMLvar('WSATD':'_________')
     C                   end
     c                   end
N38  C                   callp     updhtmlvar('WSKNA':                          AGENT
N38  C                             %trim(%editc(BSKNA:'Z')))
N38  C                   MOVE      *BLANKS       WSNAA            40
N38  C                   IF        BSKNA <> 0
N38  C     CUNDL01KA     CHAIN     CUNDL01                            33
N38  C  N33              EVAL      WSNAA = %TRIM(KNAVN)+' '+ADR3
N38  C                   ENDIF
N38  C                   callp     updHtmlVar('WSNAA':WSNAA)
     C                   callp     updhtmlvar('WSKNS':                          SELGER
     C                             %trim(%editc(BSKNS:'Z')))
     C                   callp     updHtmlVar('WSNAS':WSNAS)
     C                   callp     updHtmlVar('WSADS1':WSADS1)
     C                   callp     updHtmlVar('WSADS2':WSADS2)
     C                   callp     updHtmlVar('WSADS3':WSADS3)
N14  C                   callp     updHtmlVar('WSSCONT':WSSCONT)
N14  C                   callp     updHtmlVar('WSSTLF':WSSTLF)
N14  C                   callp     updHtmlVar('WSSMAIL':WSSMAIL)
     C                   callp     updHtmlVar('GMKNS':GMKNS)
     C                   callp     updHtmlVar('GMNAS':GMNAS)
     C                   callp     updHtmlVar('GMADS1':GMADS1)
     C                   callp     updHtmlVar('GMADS2':GMADS2)
     C                   callp     updHtmlVar('GMADS3':GMADS3)
     C                   callp     updhtmlvar('WSKNK':                          KJØPER
     C                             %trim(%editc(BSKNK:'Z')))
     C                   callp     updHtmlVar('WSNAK':WSNAK)
     C                   callp     updHtmlVar('WSADK1':WSADK1)
     C                   callp     updHtmlVar('WSADK2':WSADK2)
     C                   callp     updHtmlVar('WSADK3':WSADK3)
N14  C                   callp     updHtmlVar('WSKCONT':WSKCONT)
N14  C                   callp     updHtmlVar('WSKTLF':WSKTLF)
N14  C                   callp     updHtmlVar('WSKMAIL':WSKMAIL)
     C                   callp     updHtmlVar('GMKNK':GMKNK)
     C                   callp     updHtmlVar('GMNAK':GMNAK)
     C                   callp     updHtmlVar('GMADK1':GMADK1)
     C                   callp     updHtmlVar('GMADK2':GMADK2)
     C                   callp     updHtmlVar('GMADK3':GMADK3)
     C                   callp     updHtmlVar('WSLSS':WSLSS)
N12  C                   callp     updHtmlVar('WSLKF':WSLKF)                    Ved Bil
     C                   callp     updHtmlVar('WSLSH':WSLSH)
     C                   callp     updHtmlVar('WSVH':WSVH)
     C                   callp     updHtmlVar('WSVH2':WSVH2)
N12  C                   callp     updHtmlVar('WSLKT':WSLKT)                    Ved Bil
     C                   callp     updHtmlVar('WSLOH':WSLOH)
     C                   callp     updHtmlVar('WSLOS':WSLOS)
N39  c                   move      *blanks       INNHUTKJ        500
N39  c                   if        BSOPD <>0                                    Kun tillat når OK
N39  c                   if        TROPD1<>0
N39  c                   eval      INNHUTKJ ='Via <b>'+HELKS+' '+HESDFF+'</b> '
N39  C                             + 'Coll.Ord: <b>'
N39  C                             + %trim(%editc(TRAVD1:'Z'))+'/'
N39  C                             + %trim(%editc(TROPD1:'Z'))+'</b>'
N39  c                   else
N39  c                   eval      INNHUTKJ ='<INPUT TYPE="button" '
N39  C                             +'VALUE=" Via Term/Create Coll.order " '
N39  C                             +'NAME="INNH" onClick="LagInh()">'
N39  c                   endif
N39  c                   endif
N39  C                   callp     updHtmlVar('INNHUTKJ':INNHUTKJ)
      *
     C                   callp     updhtmlvar('WSNT':
     C                             %trim(%editc(BSNT:'Z')))
     C                   callp     updhtmlvar('WSVKT':
     C                             %trim(%editc(BSVKT:'Z')))
     C                   callp     updhtmlvar('WSM3':WSM3)
     C                   callp     updhtmlvar('WSM3':
     C                             %trim(%editc(BSM3:'M')))
     C                   callp     updhtmlvar('WSLM':
     C                             %trim(%editc(BSLM:'M')))
     C                   callp     updhtmlvar('WSVS1':WSVS1)
     C                   callp     updhtmlvar('WSVS2':WSVS2)
     C                   callp     updhtmlvar('WSGM1':WSGM1)
     C                   callp     updhtmlvar('WSGM2':WSGM2)
N38  C                   callp     updhtmlvar('WSSDL':WSSDL)
N14  C                   callp     updhtmlvar('WSMtxt':WSMtxt)
N14  C                   callp     updhtmlvar('WSTtxt':WSTtxt)
N14  C                   callp     updhtmlvar('WSStxt':WSStxt)
      *
     C                   callp     updhtmlvar('WSCN1':WSCN1)
     C                   callp     updhtmlvar('WSCT1':WSCT1)
     C                   callp     updhtmlvar('WSCT1t':WSCT1t)
N07  C                   callp     updhtmlvar('WSNT1':
N07  C                             %trim(%editc(BSNT1:'Z')))
     C                   callp     updhtmlvar('WSVKT1':
     C                             %trim(%editc(BSVKT1:'Z')))
     C                   callp     updhtmlvar('WSM31':
     C                             %trim(%editc(BSM31:'4')))
     C                   callp     updhtmlvar('WSCN2':WSCN2)
     C                   callp     updhtmlvar('WSCT2':WSCT2)
     C                   callp     updhtmlvar('WSCT2t':WSCT2t)
N07  C                   callp     updhtmlvar('WSNT2':
N07  C                             %trim(%editc(BSNT2:'Z')))
     C                   callp     updhtmlvar('WSVKT2':
     C                             %trim(%editc(BSVKT2:'Z')))
     C                   callp     updhtmlvar('WSM32':
     C                             %trim(%editc(BSM32:'4')))
     C                   callp     updhtmlvar('WSCN3':WSCN3)
     C                   callp     updhtmlvar('WSCT3':WSCT3)
     C                   callp     updhtmlvar('WSCT3t':WSCT3t)
N07  C                   callp     updhtmlvar('WSNT3':
N07  C                             %trim(%editc(BSNT3:'Z')))
     C                   callp     updhtmlvar('WSVKT3':
     C                             %trim(%editc(BSVKT3:'Z')))
     C                   callp     updhtmlvar('WSM33':
     C                             %trim(%editc(BSM33:'4')))
     C                   callp     updhtmlvar('WSCN4':WSCN4)
     C                   callp     updhtmlvar('WSCT4':WSCT4)
     C                   callp     updhtmlvar('WSCT4t':WSCT3t)
N07  C                   callp     updhtmlvar('WSNT4':
N07  C                             %trim(%editc(BSNT4:'Z')))
     C                   callp     updhtmlvar('WSVKT4':
     C                             %trim(%editc(BSVKT4:'Z')))
     C                   callp     updhtmlvar('WSM34':
     C                             %trim(%editc(BSM34:'4')))
N03  C                   IF        CN(5) = *BLANKS
N03  C                   callp     updHtmlVar('CONTCHECKED':'')
N03  C                   else
N03  C                   callp     updHtmlVar('CONTCHECKED':'Checked')
N03  C                   end
N21  C                   callp     updHtmlVar('FRTCHECKED':'')
      *
     C                   callp     updhtmlvar('FEILMELDING':
     C                             FEILMELDING)
     C                   callp     updhtmlvar('FMELDNR':FMELDNR)
     C                   callp     updhtmlvar('AVSLUTT':AVSLUTT)
     C     WSUPLOAD      IFEQ      'Y'
     C                   callp     updHtmlVar('UPLOADCHECKED':'Checked')
     C                   else
     C                   callp     updHtmlVar('UPLOADCHECKED':'')
     C                   end
     C                   callp     updhtmlvar('OKBUTTON':OKBUTTON)
S11  c*                  IF        ((OSCHG = 'J') AND (BSAVD <> 0))
N11  C                   IF        ((OSCHG = 'J') AND (BSOPD <> 0))
N02  c                   eval      KOPIButton = '<INPUT TYPE="button" '
N02  c                             + 'NAME="CopyButton" Value="   Copy   " '
N02  c                             + 'OnClick=CpyOrd()>'
N02  c                   ELSE
N02  c                   EVAL      KOPIBUTTON = *BLANKS
N02  c                   END
N02  C                   callp     updhtmlvar('XKOPIOPD':XKOPIOPD)
N02  C                   callp     updhtmlvar('KOPIBUTTON':KOPIBUTTON)
      *
N10   *ADVANCED SHIPING NOTICE
N10  c                   EVAL      ASNBUTTON = *BLANKS
N10  c                   IF        ((BSAVD <> 0) AND (BSOPD <> 0))
N10  C     HEADFK        CHAIN     EPOPOS                             33
N10  c  N33              eval      ASNButton = '<INPUT TYPE="button" '
N10  c                             + 'NAME="ASNButton" '
N10  c                             + 'Value="Advanced Shipping Notice" '
N10  c                             + 'OnClick=VisASN()>'
N10  c                   END
N10  C                   callp     updhtmlvar('ASNBUTTON':ASNBUTTON)
      *
N32   * Button for print av fraktbrev
N32  c                   EVAL      FBRBUTTON = *BLANKS
N32  c                   IF        BilBook='J' AND BSAVD<>0 AND BSOPD<>0
N32  c                   eval      FBRButton = '<INPUT TYPE="button" '
N32  c                             + 'NAME="FBRButton" '
N32  c                             + 'Value="Pdf Waybill" '
N32  c                             + 'OnClick=PrtFBR()>'
N32  c                   END
N32  C                   callp     updhtmlvar('FBRBUTTON':FBRBUTTON)
N32   * Button for print av labels
N32  c                   EVAL      LABBUTTON = *BLANKS
N32  c                   IF        BilBook='J' AND BSAVD<>0 AND BSOPD<>0
N32  c                   eval      LABButton = '<INPUT TYPE="button" '
N32  c                             + 'NAME="LABButton" '
N32  c                             + 'Value="Pdf Labels" '
N32  c                             + 'OnClick=PrtLAB()>'
N32  c                   END
N32  C                   callp     updhtmlvar('LABBUTTON':LABBUTTON)
N32  C                   movel     BSAVD         AVDOPD           11
N32  C                   move      BSOPD         AVDOPD
N32  C                   callp     updhtmlvar('AVDOPD':AVDOPD)
N33   * Button for send av pickupmail
N33  c                   EVAL      PICKBUTTON = *BLANKS
N33  c                   IF        BilBook='J' AND BSAVD<>0 AND BSOPD<>0
N33  c                   eval      PICKButton = '<INPUT TYPE="button" '
N33  c                             + 'NAME="PICKButton" '
N33  c                             + 'Value="Snd PickUpMail" '
N33  c                             + 'OnClick=SndPickUp()>'
N36  c                             + '&nbsp;&nbsp;<INPUT TYPE="button" '
N36  c                             + 'NAME="SMSButton" '
N36  c                             + 'Value="Snd SMS" '
N36  c                             + 'OnClick=SndSMS()>'
N43  c                             + '&nbsp;&nbsp;<INPUT TYPE="button" '
N43  c                             + 'NAME="EVTButton" '
N43  c                             + 'Value="EventGrabSMS" '
N43  c                             + 'OnClick=SndEventGrabber()>'
N33  c                   END
N33  C                   callp     updhtmlvar('PICKBUTTON':PICKBUTTON)
      *
     C                   endsr
N35   *****************************************
N35  C     GetSnd        begsr
N35   *****************************************
N35   * hent eller tildel
N35  c                   if        HXSNDN <> *blanks
N35  C                   Move      HXSNDN        Sndn20           20
N35  c                   else
N35  C                   CALL      'SYGE15'
N35  C                   PARM                    Sndn20           20
N35  c                   endif
N35   * ta hensyn til at det kan være kort nr
N35  c                   if        %subst(Sndn20:17:1)<>' '
N35  c                   eval      WSFBN =%subst(Sndn20:4:17)
N35  c                   else
N35  c                   eval      WSFBN = Sndn20
N35  c                   endif
N35  c                   eval      FSSOK =WSFBN
N35  c                   eval      FSDOKK='GL'
N35  C                   MOVE      BSAVD         FSAVD
N35  C                   MOVE      BSOPD         FSOPD
N35  c                   write     FRISOKR
N35   *
N35  C                   endsr
      *
      *=====================================================================******
      *  Set output variables for section /$end
      *=====================================================================******
     C     SetEnd        begsr
      * Compute run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   endsr
      *
      *////////////////////////////////////////////////////////////
     C     TESTB         BEGSR
      *////////////////////////////////////////////////////////////
      * Ved NY - Avdeling MÅ værer definert på user (param OSAVD )
     C                   IF        ((BSAVD = 0) AND (OSAVD = 0))
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL30EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL30        FEILMELDING
     C                   END
     C                   MOVE      '30'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
      *
      * TEST ORDRENR
S09  C*                  IF        WSRFA = *BLANKS
S19  C*                  IF        WSRFA = *BLANKS AND FROMPOMS <> 'J'
N19  C                   IF        WSRFA = *BLANKS AND FROMPOMS2 <> 'J'
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL01EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL01        FEILMELDING
     C                   END
     C                   MOVE      '01'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
N35   * ETD/ETA er default dagens dato ved innland
N35  C                   IF        Innland = 'J'
N35  C                   IF        BSETD = 0
N35  C                   move      WDT           BSETD
N35  C                   ENDIF
N35  C                   IF        BSETA = 0
N35  C                   move      WDT           BSETA
N35  C                   ENDIF
N35  C                   ENDIF
      * TEST ETD
     C                   IF        BSETD <> 0
N35  C                             or bilbook = 'J'
     C                   MOVE      BSETD         WSDT
     C                   EXSR      TESTDATO
     C                   IF        UFLAGG = 1
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL02EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL02        FEILMELDING
     C                   END
     C                   MOVE      '02'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   ENDIF
      * TEST ETA
     C                   IF        BSETA <> 0
N35  C                             or bilbook = 'J'
     C                   MOVE      BSETA         WSDT
     C                   EXSR      TESTDATO
     C                   IF        UFLAGG = 1
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL03EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL03        FEILMELDING
     C                   END
     C                   MOVE      '03'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   END
      * TEST ATD
     C                   IF        BSATD <> 0
     C                   MOVE      BSATD         WSDT
     C                   EXSR      TESTDATO
     C                   IF        UFLAGG = 1
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL04EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL04        FEILMELDING
     C                   END
     C                   MOVE      '04'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   END
      * TEST ATA
     C                   IF        BSATA <> 0
     C                   MOVE      BSATA         WSDT
     C                   EXSR      TESTDATO
     C                   IF        UFLAGG = 1
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL05EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL05        FEILMELDING
     C                   END
     C                   MOVE      '05'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   END
      * TEST AVSENDER
N09  C                   IF        FROMPOMS <> 'J'
S11  C*                  IF        WSKNS  <> *BLANKS
N11  C                   IF        XIMPEXP = 'E' OR WSKNS  <> *BLANKS
     C     CUNDL01KS     CHAIN     CUNDL01                            33
     C                   IF        *IN33
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL28EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL28        FEILMELDING
     C                   END
     C                   MOVE      '28'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ELSE
N17   * primært via vareadresse 1 - ellers fra CUNDF
n17  c     Vadr1KS       chain     VADR                               33
N17  C     *IN33         IFEQ      *OFF
N17  C                   IF        WSNAS = *BLANKS
N17  C                   EVAL      WSNAS  = VADRNA
N17  C                   EVAL      WSADS1 = VADRN1
N17  C                   EVAL      WSADS2 = VADRN2
N17  C                   EVAL      WSADS3 = VADRN3
N17  C                   ENDIF
N17  C                   eval      LKS    = VALAND
N17  c                   ELSE
N17  C                   IF        WSNAS = *BLANKS
     C                   EVAL      WSNAS = KNAVN
     C                   EVAL      WSADS1 = ADR1
     C                   EVAL      WSADS2 = ADR2
     C                   EVAL      WSADS3 = *BLANKS
     C                   IF        POSTNR = 0
     C                   MOVEL     SYPOGE        WSADS3
     C                   ELSE
     C                   MOVEL     POSTNR        WSADS3
     C                   END
     C                   CAT       ADR3:1        WSADS3
N17  C                   ENDIF
N17  C                   eval      LKS    = SYLAND
N17  c                   END
N17   * kpers mm f. kunde
N17  c                   if        WSSCONT = *blanks
N17  c                   eval      WSSCONT = KPERS
N17  c                   endif
N17  c                   if        WSSTLF  = *blanks
N17  c                   eval      WSSTLF  = TLF
N17  c                   endif
N17  c                   if        WSSMAIL = *blanks
N17  c                   eval      WSSMAIL = SYEPOS
N17  c                   endif
     C                   END                                                    end 33 /CUNDL
     C                   END                                                    end wsknk<>blank
      *
     C                   IF        WSNAS = *BLANKS
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL06EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL06        FEILMELDING
     C                   END
     C                   MOVE      '06'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
      *
     C                   IF        WSADS1 = *BLANKS
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL07EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL07        FEILMELDING
     C                   END
     C                   MOVE      '07'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
N09  C                   END
N38   * AGENT
N38  C                   IF        WSKNA  <> *BLANKS
N38  C     CUNDL01KA     CHAIN     CUNDL01                            33
N38  C                   IF        *IN33
N38  C                   IF        XSPRÅK = 'EN'
N38  C                   MOVEL     FEIL36EN      FEILMELDING
N38  C                   ELSE
N38  C                   MOVEL     FEIL36        FEILMELDING
N38  C                   END
N38  C                   MOVE      '36'          FMELDNR
N38  C                   GOTO      SLTBDT
N38  C                   ENDIF
N38  C                   ENDIF
      * TEST MOTTAKER
S01  C*                  IF        WSKNK  <> *BLANKS
N11  C                   IF        XIMPEXP = 'I' OR WSKNK  <> *BLANKS
     C     CUNDL01KK     CHAIN     CUNDL01                            33
     C                   IF        *IN33
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL29EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL29        FEILMELDING
     C                   END
     C                   MOVE      '29'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ELSE
S17  C*                  IF        WSNAK = *BLANKS
N17   * primært via vareadresse 1 - ellers fra CUNDF
n17  c     Vadr1KK       chain     VADR                               33
N17  C     *IN33         IFEQ      *OFF
N17  C                   IF        WSNAK = *BLANKS
N17  C                   EVAL      WSNAK  = VADRNA
N17  C                   EVAL      WSADK1 = VADRN1
N17  C                   EVAL      WSADK2 = VADRN2
N17  C                   EVAL      WSADK3 = VADRN3
N17  C                   ENDIF
N17  C                   eval      LKK    = VALAND
N17  c                   ELSE
N17  C                   IF        WSNAK = *BLANKS
     C                   EVAL      WSNAK = KNAVN
     C                   EVAL      WSADK1 = ADR1
     C                   EVAL      WSADK2 = ADR2
     C                   EVAL      WSADK3 = *BLANKS
     C                   IF        POSTNR = 0
     C                   MOVEL     SYPOGE        WSADK3
     C                   ELSE
     C                   MOVEL     POSTNR        WSADK3
     C                   END
     C                   CAT       ADR3:1        WSADK3
N17  C                   ENDIF
N17  C                   eval      LKK    = SYLAND
N17  c                   END
S17  C*                  END
N17   * kpers mm f. kunde
N17  c                   if        WSKCONT = *blanks
N17  c                   eval      WSKCONT = KPERS
N17  c                   endif
N17  c                   if        WSKTLF  = *blanks
N17  c                   eval      WSKTLF  = TLF
N17  c                   endif
N17  c                   if        WSKMAIL = *blanks
N17  c                   eval      WSKMAIL = SYEPOS
N17  c                   endif
     C                   END
N11  C                   END
S01  C*                  END
      *
N09  C                   IF        FROMPOMS <> 'J'
     C                   IF        WSNAK = *BLANKS
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL08EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL08        FEILMELDING
     C                   END
     C                   MOVE      '08'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
      *
     C                   IF        WSADK1 = *BLANKS
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL09EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL09        FEILMELDING
     C                   END
     C                   MOVE      '09'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
N09  C                   END
      *
      *
      * TEST FRA/TILSTED
      * defaulter ved bil - hent fra avs / motta
N12  c                   if        bilbook = 'J'
      *
N17  c                   if        WSLKF='  '
N17  c                   eval      WSLKF=LKS                                    Senders land
N17  c                   endif
N35  c                   if        Innland = 'J'
N35  c                   if        WSLKF='  '
N35  c                   eval      WSLKF='NO'
N35  c                   endif
N35  c                   if        WSLKT='  '
N35  c                   eval      WSLKT='NO'
N35  c                   endif
N35  c                   endif
N35  c*
N12  c                   if        WSLKF='  ' and XIMPEXP='E'
N12  c                   eval      WSLKF='NO'
N12  c                   endif
N12  c                   if        WSLSH='  '
N12  c                   eval      WSLSH=WSADS3                                 5 første = PNR??
N12  c                   endif
N17  c                   if        WSLKT='  '
N17  c                   eval      WSLKT=LKK                                    Kjøpers land
N17  c                   endif
N12  c                   if        WSLKT='  ' and XIMPEXP='I'
N12  c                   eval      WSLKT='NO'
N12  c                   endif
N12  c                   if        WSLOH='  '
N12  c                   eval      WSLOH=WSADK3                                 5 første = PNR??
N12  c                   endif
      *
N12  c                   endif
      * Fra sted
     C                   IF        WSLSS = *BLANKS
N12  c                   if        bilbook <> 'J'
     C                   MOVE      *BLANKS       WSLKF             2
N12  c                   endif
     C                   ELSE
     C     WSLSS         CHAIN     STED2                              33
     C                   IF        *IN33
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL10EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL10        FEILMELDING
     C                   END
     C                   MOVE      '10'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   MOVE      ST2LK         WSLKF
     C                   ENDIF
      * Fra havn
     C     WSLSH         COMP      *BLANKS                                33
N14   * bil - ubetinget krav
N12  c                   if        BilBook = 'J'
N12  C  N33StedFraKey    CHAIN     STED2D                             33
N12  C                   IF        *IN33
N12  C                   IF        XSPRÅK = 'EN'
N12  C                   EVAL      FEILMELDING = 'Country+Postal code invalid'
N12  C                   ELSE
N12  C                   EVAL      FEILMELDING = 'Country+Postal code invalid'
N12  C                   END
N12  C                   MOVE      '11'          FMELDNR
N12  C                   GOTO      SLTBDT
N12  C                   ENDIF
N12  c                   else
     C  N33WSLSH         CHAIN     STED2                              33
     C                   IF        *IN33
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL11EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL11        FEILMELDING
     C                   END
     C                   MOVE      '11'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
N12  c                   endif
     C                   IF        WSLKF = *BLANKS
     C                   MOVE      ST2LK         WSLKF
     C                   END
      * Via havn
     C                   IF        WSVH <> *BLANKS
     C     WSVH          CHAIN     STED2                              33
     C                   IF        *IN33
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL12EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL12        FEILMELDING
     C                   END
     C                   MOVE      '12'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   ENDIF
      * Via havn 2
     C                   IF        WSVH2 <> *BLANKS
     C     WSVH2         CHAIN     STED2                              33
     C                   IF        *IN33
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL13EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL13        FEILMELDING
     C                   END
     C                   MOVE      '13'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   ENDIF
      * Til havn
     C     WSLOH         COMP      *BLANKS                                33
N14   * bil - ubetinget krav
N12  c                   if        BilBook = 'J'
N12  C  N33StedTilKey    CHAIN     STED2D                             33
N12  C                   IF        *IN33
N12  C                   IF        XSPRÅK = 'EN'
N12  C                   EVAL      FEILMELDING = 'Country+Postal code invalid'
N12  C                   ELSE
N12  C                   EVAL      FEILMELDING = 'Country+Postal code invalid'
N12  C                   END
N12  C                   MOVE      '14'          FMELDNR
N12  C                   GOTO      SLTBDT
N12  C                   ENDIF
N12  c                   else
     C  N33WSLOH         CHAIN     STED2                              33
     C                   IF        *IN33
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL14EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL14        FEILMELDING
     C                   END
     C                   MOVE      '14'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   MOVE      ST2LK         WSLKT             2
N12  c                   endif
      * Til sted
     C                   IF        WSLOS <> *BLANKS
     C     WSLOS         CHAIN     STED2                              33
     C                   IF        *IN33
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL15EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL15        FEILMELDING
     C                   END
     C                   MOVE      '15'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   MOVE      ST2LK         WSLKT
     C                   ENDIF
N38   * laste/losested angutt med ett tegn=kode , hent (ikke treff= blank)
N38  c                   if        WSSDL<>*blanks and
N38  c                             %subst(WSSDL:2:19)=*blanks
N38  c                   eval      KOTMKO = WSSDL                               (1 tegn)
N38  c     SDLKey        chain     KODTERM
N38  c                   movel     KOTMNV        WSSDL
N38  c                   endif
      *
      * TEST KOLLI
     C     BSNT          IFEQ      0
N23  C     BSNT1         ANDEQ     0
N23  C     BSNT2         ANDEQ     0
N23  C     BSNT3         ANDEQ     0
N23  C     BSNT4         ANDEQ     0
     C     BSATD         andne     0
N09  C     FROMPOMS      ANDNE     'J'
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL16EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL16        FEILMELDING
     C                   END
     C                   MOVE      '16'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
N14   * bil - ubetinget krav
N14  c                   if        BilBook = 'J' and BSNT  = 0
N14  C                   IF        XSPRÅK = 'EN'
N14  C                   MOVEL     FEIL16EN      FEILMELDING
N14  C                   ELSE
N14  C                   MOVEL     FEIL16        FEILMELDING
N14  C                   END
N14  C                   MOVE      '16'          FMELDNR
N14  C                   GOTO      SLTBDT
N14  c                   endif
      *
      * TEST VEKT
     C     BSVKT         IFEQ      0
N23  C     BSVKT1        ANDEQ     0
N23  C     BSVKT2        ANDEQ     0
N23  C     BSVKT3        ANDEQ     0
N23  C     BSVKT4        ANDEQ     0
     C     BSATD         andne     0
N09  C     FROMPOMS      ANDNE     'J'
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL17EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL17        FEILMELDING
     C                   END
     C                   MOVE      '17'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
N14   * bil - ubetinget krav
N14  c                   if        BilBook = 'J' and BSVKT = 0
N14  C                   IF        XSPRÅK = 'EN'
N14  C                   MOVEL     FEIL17EN      FEILMELDING
N14  C                   ELSE
N14  C                   MOVEL     FEIL17        FEILMELDING
N14  C                   END
N14  C                   MOVE      '17'          FMELDNR
N14  C                   GOTO      SLTBDT
N14  c                   endif
      *
      * TEST VAREBESKRIVELSE
     C     WSVS1         IFEQ      *BLANKS
N09  C     FROMPOMS      ANDNE     'J'
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL18EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL18        FEILMELDING
     C                   END
     C                   MOVE      '18'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
N14
N14   * MAX 90 LINJER AV ALLE MELDINGER
N14  C                   EXSR      SRTESTL
N14  C                   IF        XANTL > 90
N14  C                   IF        XSPRÅK = 'EN'
N14  C                   eval      FEILMELDING='Number of freetext lines '
N14  c                             +'cannot exeed 90.'
N14  C                   ELSE
N14  C                   eval      FEILMELDING='Max 90 linjer fritekst.'
N14  C                   END
N14  C                   MOVE      '35'          FMELDNR
N14  C                   GOTO      SLTBDT
N14  C                   END
      *
      * TEST CONTAINERKODE
     C     1             DO        4             XN                3 0
     C                   IF        ((VK(XN) <> 0) OR (CT(XN) <> *BLANKS))
     C     CT(XN)        CHAIN     CDCON4                             33
      * TEST KODE
     C                   IF        *IN33
     C     XN            ADD       19            XN2               3 0
     C                   MOVE      XN2           XAN02             2
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL20EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL20        FEILMELDING
     C                   END
     C                   MOVEL     XAN02         FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     c                   move      CC4FT         CTT(XN)
N09   *
N09  C                   IF        FROMPOMS <> 'J'
N07   * TEST KOLLI (men kun når contKode oppgitt/ulik *C = Stykkgods samlecontainer)
N07  C                   IF        ((NT(XN) = 0) and (CT(XN) <> '*C'))
N07  C     XN            ADD       30            XN2               3 0
N07  C                   MOVE      XN2           XAN02             2
N07  C                   IF        XSPRÅK = 'EN'
N07  C                   MOVEL     FEIL31EN      FEILMELDING
N07  C                   ELSE
N07  C                   MOVEL     FEIL31        FEILMELDING
N07  C                   END
N07  C                   MOVEL     XAN02         FMELDNR
N07  C                   GOTO      SLTBDT
N07  C                   END
      * TEST VEKT (men kun når contKode oppgitt/ulik *C = Stykkgods samlecontainer)
     C                   IF        ((VK(XN) = 0) and (CT(XN) <> '*C'))
     C     XN            ADD       23            XN2               3 0
     C                   MOVE      XN2           XAN02             2
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL24EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL24        FEILMELDING
     C                   END
     C                   MOVEL     XAN02         FMELDNR
     C                   GOTO      SLTBDT
     C                   END
N09   *
N09  C                   END
      *
     C                   END
     C                   ENDDO
      *
     C                   IF        WSMORECN = 'Y'
     C                   MOVE      'M'           AVSLUTT
     C                   ELSE
N21  C                   IF        WSFRTXT = 'Y'
N21  C                   MOVE      'F'           AVSLUTT
N21  C                   ELSE
     C                   MOVE      'Y'           AVSLUTT
N39  c                   if        LagFF = 'J' or  LagVF = 'J'
N39  C                   MOVE      'N'           AVSLUTT
N39  c                   endif
N21  C                   END
     C                   END
      *
     C     SLTBDT        ENDSR
      *
      *=====================================================================
      *  TEST DATO
      *=====================================================================
     C     TESTDATO      BEGSR
      *
     C                   MOVE      WSDTDD        UDD               2 0
     C                   MOVE      WSDTMM        UMM               2 0
     C                   MOVE      WSDTÅÅ        UÅÅ               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
      *
     C                   ENDSR
      *
      *=====================================================================
      *  Oppdater heading
      *=====================================================================
     C     OPDORDRE      begsr
      *
N11  C                   IF        BSOPD = 0
     C                   IF        BSAVD = 0
     C                   MOVE      OSAVD         BSAVD
S11  C*    OSAVD         CHAIN     TELL                               33
N11  C                   END
N11  C     BSAVD         CHAIN     TELL                               33
     C                   MOVE      TEOPDN        BSOPD
     C                   ADD       1             TEOPDN
     C                   UPDATE    TELLR
N02  C                   EVAL      FEILMELDING = 'New created order is '
N02  C                             + %TRIM(%EDITC(BSAVD:'Z'))
N02  C                             + '/' + %TRIM(%EDITC(BSOPD:'Z'))
N02  C                   MOVE      'C'           AVSLUTT
     C                   END
      *
     C                   EXSR      MOVEWSH
      *
      * TEST OPPLASTING
     C                   IF        ((XOPPLAST = 'J') AND (WSUPLOAD = 'Y'))
     C                   MOVE      'J'           AVSLUTT
     C                   END
      *
     C     UtOppd        endsr
      *
      *=====================================================================
      *  OPPDATER FELTER I FIL
      *=====================================================================
     C     MOVEWSH       begsr
     C     HEADFK        CHAIN     HEADF                              33
N17  c                   if        BilBook <>'J'
     C                   MOVE      BIKUNR        HEKNA
N17  C                   endif
      * dft = TRmodul
     C                   MOVE      'H'           HEUR
      * hente dynamisk fra ALFA av parameter OSAVD senere...
     C
S39  C*                  MOVE      'WEB'         HESG
N39  C                   MOVE      Sign          HESG
s29  C*                  MOVE      WSRFA         HERFA
N29  C                   MOVEL     WSRFA         HERFA
     C                   MOVE      WDT           HEDTR
N09  C                   IF        FROMPOMS <> 'J'
     C                   MOVE      BSKNS         HEKNS
     C                   MOVE      WSNAS         HENAS
     C                   MOVE      WSADS1        HEADS1
     C                   MOVE      WSADS2        HEADS2
     C                   MOVE      WSADS3        HEADS3
N09  C                   END
     c     HEUR          IFEQ      'H'
N11  C                   IF        XIMPEXP = 'I'
     C                   MOVE      'K'           TRKDAK                         Oppd.giver
     C                   MOVE      'K'           TRKDFF                         F.mottaker
N11  C                   ELSE
N11  C                   MOVE      'S'           TRKDAK                         Oppd.giver
N11  C                   MOVE      'S'           TRKDFF                         F.mottaker
N11  C                   END
     C                   end
N11  C                   IF        XIMPEXP = 'I'
     C                   MOVE      'X'           HEKDFS                         ikke mot S
     C                   MOVE      BSKNK         TRKNFA                         Oppd.giver
N34  C                   MOVE      WSNAK         HENAA                          Navn oppdragsgiver
     C                   MOVE      BSKNK         HEKNKF                         Fakturamottaker
N11  C                   ELSE
N11  C                   MOVE      'X'           HEKDFK                         ikke mot K
N11  C                   MOVE      BSKNS         TRKNFA                         Oppd.giver
N34  C                   MOVE      WSNAS         HENAA                          Navn oppdragsgiver
N11  C                   MOVE      BSKNS         HEKNSF                         Fakturamottaker
N11  C                   END
     C                   MOVE      BSKNK         HEKNK                          Varemottake
     C                   MOVE      WSNAK         HENAK
     C                   MOVE      WSADK1        HEADK1
     C                   MOVE      WSADK2        HEADK2
     C                   MOVE      WSADK3        HEADK3
N38  C                   MOVE      BSKNA         HEKNA                          Agent
     C                   MOVE      WSLKF         HELKA
S41  C*                  IF        WSLSS = *BLANKS
     C                   MOVE      WSLSH         HESDF
S41  C*                  ELSE
S41  C*                  MOVE      WSLSS         HESDF
S41  C*                  END
     C                   MOVE      WSLKT         HETRI
S41  C*                  IF        WSLOS = *BLANKS
     C                   MOVE      WSLOH         HESDT
S41  C*                  ELSE
S41  C*                  MOVE      WSLOS         HESDT
S41  C*                  END
     C                   MOVE      WSOT          HEOT
     C                   MOVE      WSFR          HEFR
      *
N35  C     Ot2Key        chain     KODTOT2                            34
N35  c     *IN34         ifeq      '0'
N35  C                   MOVE      KO2KK         HEPK3
N35  C                   MOVE      KO2TI         HEPK4
N35  C                   MOVE      KO2FI         HEPK5
N35  C                   MOVE      KO2TE         HEPK6
N35  C                   MOVE      KO2FB         HEPK1
N35  C                   MOVE      KO2FPS        HEPK2
N35  C                   MOVE      'N'           HEPK7
N35  C     KO2BI         IFNE      'N'
N35  C                   MOVE      'B'           HEPK7
N35  C                   ELSE
N35  C     KO2CM         IFNE      'N'
N35  C                   MOVE      'C'           HEPK7
N35  C                   END
N35  C                   END
N35  c                   endif
      *
     C                   IF        HEPRO <> 0
S08  C*    HEPRO         CHAIN     TURER14                            33
N08  C     HEPRO         CHAIN     TURER14                            34
     C                   EVAL      TUTS   = TUTS + BSNT - HENT
S20  C*                  EVAL      TUTVKT = TUTVKT + BSVKT - HEVKT
N20  C                   EVAL      XTUTVKT = TUTVKT + BSVKT - HEVKT
S28  C*                  IF        XTUTVKT < 99999
N28  C                   IF        XTUTVKT < 999999999
N20  C                   EVAL      TUTVKT = XTUTVKT
N20  C                   ELSE
S28  C*                  EVAL      TUTVKT = 99999
N28  C                   EVAL      TUTVKT = 999999999
N20  C                   END
s16  C*                  EVAL      TUTM3  = TUTM3 + BSM3 - HEM3
n16  C                   EVAL      TUTM3X = TUTM3 + BSM3 - HEM3
S28  c*                  if        TUTM3X > 99.99
S28  C*                  EVAL      TUTM3  = 99.99
N28  c                   if        TUTM3X > 9999.999
N28  C                   EVAL      TUTM3  = 9999.999
n16  c                   else
n16  C                   EVAL      TUTM3  = TUTM3X
n16  c                   endif
     C                   EVAL      TUTLM  = TUTLM + BSLM - HELM
S08  C* N33              UPDATE    TURERR
N08  C  N34              UPDATE    TURERR
     C                   END
      *
     C                   MOVE      BSNT          HENT
     C                   MOVE      BSVKT         HEVKT
     C                   MOVE      BSM3          HEM3
     C                   MOVE      BSLM          HELM
     C                   MOVE      WSVS1         HEVS1
     C                   MOVE      WSVS2         HEVS2
     C                   MOVE      WSGM1         HEGM1
     C                   MOVE      WSGM2         HEGM2
N38  C                   MOVE      WSSDL         HESDL
     C                   MOVE      'HO'          TRSLAG
     C     BSATD         ifne      *zeros
     C                   MOVE      BSATD         TRSDFD
     c                   else
     C                   MOVE      BSETD         TRSDFD
     c                   end
N35  c                   if        Innland = 'J'
N35  c                   if        %subst(WSFBN:17:1)<>' '
N35  c                   eval      HXSNDN='401'+ WSFBN
N35  c                   else
N35  c                   eval      HXSNDN= WSFBN
N35  c                   endif
N35  c                   endif
N14  c                   if        BilBook = 'J'
N14  C     TRSDFD        IFNE      *ZEROS
N14  C                   MOVE      TRSDFD        HEDTOP
N30  C                   if        XIMPEXP = 'I'
N30  C                   MOVE      TRSDTD        HEDTOP
N30  c                   endif
N14  C                   else
N14  C                   MOVE      HEDTR         HEDTOP
N14  C                   endif
N14  C                   endif
     C                   MOVE      BSETA         TRSDTD
     C                   IF        *in33   = '0'
     C                   UPDATE    HEADFR
     C                   ELSE
     C                   MOVE      BSAVD         HEAVD
     C                   MOVE      BSOPD         HEOPD
N09  C                   MOVE      BSTUR         HEPRO
     C                   WRITE     HEADFR
     C                   END
      * DISP
     C     HEADFK        CHAIN     DISP                               33
     C                   MOVE      HESDF         DISTEF
     C                   MOVEL     WSLKF         DISONF
     C                   MOVE      HESDT         DISTET
     C                   MOVEL     WSLKT         DISONT
     C                   MOVE      BSETA         DIDATF
     C                   MOVE      BSETD         DIDATT
     C                   MOVE      WSOT          DIOT
     C                   IF        *in33   = '0'
     C                   UPDATE    DISPR
     C                   ELSE
     C                   WRITE     DISPR
     C                   END
N14
N14   * Contact SHipper (roreløpig kun ved bil..)
N14  c                   if        BilBook = 'J'
N14  c                   clear                   DOKUFER
N14  c                   MOVE      HEAVD         FE_DFAVD
N14  c                   MOVE      HEOPD         FE_DFOPD
N14  c                   MOVE      001           FE_DFFBNR
S32  c*                  MOVE      'SH'          FE_N3035
N32  c                   MOVE      'SH '         FE_N3035
N14  C     ContKey       CHAIN     DOKUFE                             33
N14  C                   movel     WSSCONT       FE_C3412
N14  C                   movel     WSSTLF        FE_C3148B                      mobil
N14  C                   movel     WSSMAIL       FE_C3148E
N14  C                   IF        *in33   = '0'
s34  c*                  if        WSSCONT<>*blanks
N34  c                   if        WSSCONT<>*blanks or WSSTLF <>*blanks
N34  c                             or WSSMAIL<>*blanks
N14  C                   UPDATE    DOKUFER
N14  c                   else
N14  C                   delete    DOKUFER
N14  c                   endif
N14  C                   ELSE
s34  c*                  if        WSSCONT<>*blanks
N34  c                   if        WSSCONT<>*blanks or WSSTLF <>*blanks
N34  c                             or WSSMAIL<>*blanks
N14  C                   WRITE     DOKUFER
N14  c                   endif
N14  C                   END
N14   *
N14  c                   clear                   DOKUFER
N14  c                   MOVE      HEAVD         FE_DFAVD
N14  c                   MOVE      HEOPD         FE_DFOPD
N14  c                   MOVE      001           FE_DFFBNR
S32  c*                  MOVE      'CN'          FE_N3035
N32  c                   MOVE      'CN '         FE_N3035
N14  C     ContKey       CHAIN     DOKUFE                             33
N14  C                   movel     WSKCONT       FE_C3412
N14  C                   movel     WSKTLF        FE_C3148B                      mobil
N14  C                   movel     WSKMAIL       FE_C3148E
N14  C                   IF        *in33   = '0'
S34  c*                  if        WSKCONT<>*blanks
N34  c                   if        WSKCONT<>*blanks or WSKTLF <>*blanks
N34  c                             or WSKMAIL<>*blanks
N14  C                   UPDATE    DOKUFER
N14  c                   else
N14  C                   delete    DOKUFER
N14  c                   endif
N14  C                   ELSE
S34  c*                  if        WSKCONT<>*blanks
N34  c                   if        WSKCONT<>*blanks or WSKTLF <>*blanks
N34  c                             or WSKMAIL<>*blanks
N14  C                   WRITE     DOKUFER
N14  c                   endif
N14  C                   END
N14
N14   * Oppdater Fritekst.
N14   * slett gml type R/G/blank (de ER hentet inn i form via sr GetData)
N14  C     HEADFK        SETLL     freetxt1
N14  C     HEADFK        Reade     freetxt1                               33
N14  C     *in33         doweq     '0'
N14  c                   if        FRTKOD='R' or FRTKOD='G' or FRTKOD=' '
N14  c                   delete    freetxtr
N14  c                   else
N14  c                   update    freetxtr
N14  c                   endif
N14  C     HEADFK        Reade     freetxt1                               33
N14  c                   end
N14   * legg ut nye type R/G/blank
N14  c                   move      HEAVD         FRTAVD
N14  c                   move      HEOPD         FRTOPD
N14  c                   move      *zeros        FRTLI
N14  c                   move      HEDTOP        FRTDT
N14   * Melding til mottaker....
N14  c     WSMtxt        Ifne      *blanks
N14  c                   move      'R'           FRTKOD
N14  C                   EVAL      KVTXT = WSMTXT
N14  C                   Z-ADD     70            XLINL             3 0
N14  C                   EXSR      KVTLIN
N14  c                   exsr      SkrivFrt
N14  c                   end
N14   * Melding til Transportør.
N14  c     WSTtxt        Ifne      *blanks
N14  c                   move      'G'           FRTKOD
N14  C                   EVAL      KVTXT = WSTTXT
N14  C                   Z-ADD     70            XLINL             3 0
N14  C                   EXSR      KVTLIN
N14  c                   exsr      SkrivFrt
N14  c                   end
N14   * Melding til SPEDITØR
N14  C     WSStxt        Ifne      *blanks
N14  C                   move      ' '           FRTKOD
N14  C                   EVAL      KVTXT = WSSTXT
N14  C                   Z-ADD     70            XLINL             3 0
N14  C                   EXSR      KVTLIN
N14  C                   exsr      SkrivFrt
N14  C                   end
N14   *
N14  c                   endif
      *
      * BILLOF
     C     HEADFK        CHAIN     BILLOF                             33
     C   33              MOVE      'J'           XNY               1
     C  N33              MOVE      'N'           XNY
     C                   MOVE      WSBLNR        BLBLNR
      * Låner felt BLCH for status om Original recieved
     C                   MOVE      WSBLORR       BLCH
     C     CDTRAFL2K     CHAIN     CDTRAFL2                           33
     C  N33              MOVE      CTKN          BLKNR
     C   33              MOVE      *ZEROS        BLKNR
N40  C                   IF        WSREIS <> *BLANKS
     C                   MOVE      WSREIS        BLREIS
N40  C                   END
     C                   MOVE      WSTR          BLTR
     C                   MOVE      WSOB          BLOB
     C                   MOVE      WSNAS         BLNAA
     C                   MOVE      WSADS1        BLAD1A
     C                   MOVE      WSADS2        BLAD2A
     C                   MOVE      WSADS3        BLAD3A
     C                   MOVE      WSNAK         BLNAM
     C                   MOVE      WSADK1        BLAD1M
     C                   MOVE      WSADK2        BLAD2M
     C                   MOVE      WSADK3        BLAD3M
     C                   MOVE      WSLSS         BLLSS
     C                   MOVE      WSLSH         BLLSH
     C                   MOVE      WSVH          BLVH
     C                   MOVE      WSVH2         BLVH2
     C                   MOVE      WSLOH         BLLOH
     C                   MOVE      WSLOS         BLLOS
     C                   IF        XNY = 'N'
     C                   UPDATE    BILLOFR
     C                   ELSE
     C                   WRITE     BILLOFR
     C                   END
      * TRACKT
     C     HEADFK        CHAIN     TRACKTR                            33
     C   33              MOVE      'J'           XNY               1
     C  N33              MOVE      'N'           XNY
cc    * POMS er CC-spesial, men lagt inn i std/hos Systema for å kunne teste
cc   c                   IF        BSETA <> TXETAD
cc   c                             or BSETD <> TXETDD
cc   c                             or BSATA <> TXATAD
cc   c                             or BSATD <> TXATDD
cc   c                   call      'EPOMS41'
cc   c                   parm                    BSAVD
cc   c                   parm                    BSOPD
cc   c                   parm      BSETD         UUETD             8 0
cc   c                   parm      BSETA         UUETA             8 0
cc   c                   parm      BSATD         UUATD             8 0
cc   c                   parm      BSATA         UUATA             8 0
cc   c                   parm                    POMSDS          256
cc   c                   endif
N37  C                   MOVE      TXETAD        GMETA             8 0
N37  C                   MOVE      TXETDD        GMETD             8 0
N37  C                   MOVE      TXATAD        GMATA             8 0
N37  C                   MOVE      TXATDD        GMATD             8 0
     C                   MOVE      BSETA         TXETAD
     C                   MOVE      BSETD         TXETDD
     C                   MOVE      BSATA         TXATAD
     C                   MOVE      BSATD         TXATDD
     C                   IF        XNY = 'N'
     C                   UPDATE    TRACKTR
     C                   ELSE
     C                   WRITE     TRACKTR
     C                   END
      * TRACKF
     C                   IF        XNY = 'N'
     C                   MOVE      'CHG'         TTACTI
     C                   EVAL      TTTEXT='Order changed by '
     C                             + %TRIM(BIBRID)
N15  C                   EVAL      TTTEXL='Ordre endret av '
N15  C                             + %TRIM(BIBRID)
     C                   ELSE
     C                   MOVE      'STR'         TTACTI
     C                   EVAL      TTTEXT='Order entered by '
     C                             + %TRIM(BIBRID)
     C                             + ' (WEB-booking).'
N15  C                   EVAL      TTTEXL='Ordre opprettet av '
N15  C                             + %TRIM(BIBRID)
N15  C                             + ' (WEB-booking).'
     C                   END
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
     C                   MOVEL     BIBRID        TTUSER
     C                   EVAL      TTDEPO = 'ESOVERS5'
     C                   WRITE     TRACKFR
N37   * CHANGED DATES?
N37  C                   EXSR      TSTCHD
      * OPPDATER BLV1
     C     HEADFK        SETLL     BLV1
     C     HEADFK        READE     BLV1                                   33
     C                   DOW       *IN33 = *OFF
     C                   IF        BVLI <= 4
     C                   DELETE    BLV1R
     C                   ELSE
     C                   UPDATE    BLV1R
     C                   LEAVE
     C                   END
     C     HEADFK        READE     BLV1                                   33
     C                   ENDDO
      *
     C                   MOVE      *ZEROS        XXNT              7 0
     C                   MOVE      *ZEROS        XXVKT             9 0
     C                   MOVE      *ZEROS        XXM3              7 3
     C                   MOVE      *ZEROS        XVLI              3 0
S03  C*    1             DO        4             XN                3 0
N03  C     1             DO        5             XN                3 0
      * ContainerNr ikke oppgitt når KODE ER gitt - lagre "?" som foreløpig contnr
     C                   IF        ((CT(XN) <> *blanks) and (CN(XN) = *BLANKS))
     C                   EVAL      CN(XN) = '?'
     C                   END
      * ved Stykkgods samlecontainer skal vekt/M3  mm ikke gis på BLlinjer
     C                   IF        CT(XN) = '*C'
     C                   EVAL      VK(XN) = *zeros
     C                   EVAL      M3(XN) = *zeros
     C                   END
     C                   IF        CN(XN) <> *BLANKS
     C                   ADD       1             XVLI              3 0
     C                   EVAL      BVLI   = XVLI
     C                   EVAL      BVSORT = XN * 10
     C                   EVAL      BVMN   = CN(XN)
     C                   EVAL      BVVKT  = VK(XN)
     C                   EVAL      BVM3   = M3(XN)
     C                   IF        BVVKT  = 0
     C                   EVAL      BVNT   = 0
     C                   ELSE
S07  C*                  EVAL      BVNT   = 1
N07  C                   EVAL      BVNT   = NT(XN)
     C                   END
     C                   EVAL      BVKDC  = CT(XN)
     C     BVKDC         CHAIN     CDCON4                             33
     C  N33              EVAL      BVVS   = CC4FT
     C  N33              EVAL      BVVS   = *BLANKS
     C                   EVAL      XXNT   = XXNT + BVNT
     C                   EVAL      XXVKT  = XXVKT + BVVKT
     C                   EVAL      XXM3   = XXM3 + BVM3
     C                   WRITE     BLV1R
     C                   END
     C                   ENDDO
      * SUMMERE ANDRE LINJER
     C     HEADFK        SETLL     BLV1
     C     HEADFK        READE     BLV1                                   33
     C                   DOW       *IN33 = *OFF
     C                   IF        BVLI > 4
     C                   EVAL      XXNT   = XXNT + BVNT
     C                   EVAL      XXVKT  = XXVKT + BVVKT
     C                   EVAL      XXM3   = XXM3 + BVM3
     C                   ADD       1             XVLI              3 0
     C                   EVAL      BVLI   = XVLI
     C                   END
     C                   UPDATE    BLV1R
     C     HEADFK        READE     BLV1                                   33
     C                   ENDDO
      *
     C                   IF        XXNT <> 0
     C     HEADFK        CHAIN     HEADF                              33
     C                   IF        HEPRO = 0
     C                   EVAL      HENT   = XXNT
     C                   EVAL      HEVKT  = XXVKT
     C                   EVAL      HEM3   = XXM3
N04  C                   EVAL      BSNT   = XXNT
N04  C                   EVAL      BSVKT  = XXVKT
N04  C                   EVAL      BSM3   = XXM3
     C                   END
     C                   UPDATE    HEADFR
     C                   END
      *
     C                   endsr
      *
N19   *=====================================================================
N19   *  TEST OM DET ER POMS-OPPDRAG
N19   *=====================================================================
N19  C     TESTPOMS      begsr
N19  C     HEADFK        CHAIN(N)  HEADF                              33
N19  C  N33              IF        FROMPOMS <> 'J'                              1<-B
N19  C     HEADFK        CHAIN     EPOH02                             33
N19  C   33HEADFK        CHAIN     EPOL02                             33
N19  C                   IF        *IN33 = *OFF                                  2<-B
N19  C                   EVAL      FROMPOMS2 = 'J'
N19  C     HEADFK        CHAIN(N)  TRACKT                             33
N19  C                   SELECT                                                   3<-B
N19  C                   WHEN      *IN33                                          3
N19  C                   EVAL      FROMPOMS = 'J'
N19  C                   WHEN      TXATDD = 0                                     3
N19  C                   EVAL      FROMPOMS = 'J'
N19  C                   ENDSL                                                    3<-E
N19  C                   ELSE                                                    2
N19  C     HEPRO         CHAIN(N)  TURER14                            33
N19  C  N33              IF        TUSG = '*PM' AND TUATD = 0                     3<-B
N19  C                   EVAL      FROMPOMS = 'J'
N19  C                   END                                                      3<-E
N19  C  N33              IF        TUSG = '*PM'                                   3<-B
N19  C                   EVAL      FROMPOMS2 = 'J'
N19  C                   END                                                      3<-E
N19  C                   END                                                     2<-E
N19  C                   END                                                    1<-E
N26
N26   * Hvis fra Posms - summer vekt/vol etter artikler (men ikke ved ren spørring/ekstern)
N26  C                   IF        FROMPOMS = 'J' and OSCHG = 'J'
N26  C                   move      *zeros        xxHENT           11 3
N26  C                   move      *zeros        xxHEVKT          13 3
N26  C                   move      *zeros        xxHEM3           11 3
N26   * adder plukkede PO-headers ..
N26  C     HEADFK        setll     EPOH02
N26  C     HEADFK        reade     EPOH02                                 33
N26  c     *in33         doweq     '0'
N26  C                   ADD       EHANTK        xxHENT
N26  C                   ADD       EHVKT         xxHEVKT
N26  C                   ADD       EHM3          xxHEM3
N26  C     HEADFK        reade     EPOH02                                 33
N26  c                   enddo
N26   * adder plukkede enkltlinjer..
N26  C     HEADFK        setll     EPOL02
N26  C     HEADFK        reade     EPOL02                                 33
N26  c     *in33         doweq     '0'
N26  C                   ADD       ELNTSL        xxHENT
N26  C                   ADD       ELVKTL        xxHEVKT
N26  C                   ADD       ELM3L         xxHEM3
N26  C     HEADFK        reade     EPOL02                                 33
N26  c                   enddo
N26  C     HEADFK        CHAIN     HEADF                              33
N26  c     *in33         ifeq      '0'
N26  C                   z-add(H)  xxHENT        HENT
N26  C                   z-add(H)  xxHEVKT       HEVKT
N26  c     xxHEM3        ifgt      9999.999
N26  c                   z-add     9999.999      HEM3
N26  c                   else
N26  C                   z-add     xxHEM3        HEM3
N26  c                   endif
N26  C                   UPDATE    HEADFR
N26  c                   endif
N26  c
N19  C                   END                                                    1<-E
N19   *
N19  C                   endsr
N19   *
      *=====================================================================
      *  Hent data fra fra fil ved først "syklus"  / endring av post
      *=====================================================================
     C     GetData       begsr
     C     HEADFK        CHAIN(N)  HEADF                              33
     C     HEADFK        CHAIN(N)  DISP                               33
S06  C*    HEADFK        CHAIN(N)  BILLOF                             33
N06  C     HEADFK        CHAIN     BILLOF                             33
N06  C  N33              IF        ((BLMM = 'New') OR (BLMM = 'Updated'))
N06  C                   EVAL      BLMM = *BLANKS
N06  C                   UPDATE    BILLOFR
N06  C                   MOVE      'CHG'         TTACTI
N06  C                   EVAL      TTTEXT='Order opened by '
N06  C                             + %TRIM(BIBRID)
N15  C                   EVAL      TTTEXL='Ordre åpnet av '
N15  C                             + %TRIM(BIBRID)
N06  C                   MOVE      WDT           TTDATE
N06  C                   MOVE      WTM           TTTIME
N06  C                   MOVE      WDT           TTDATL
N06  C                   MOVE      WTM           TTTIML
N06  C                   MOVEL     BIBRID        TTUSER
N06  C                   EVAL      TTDEPO = 'ESOVERS5'
N06  C                   WRITE     TRACKFR
N06  C                   END
     C     HEADFK        CHAIN(N)  TRACKT                             33
     C     *IN33         CABEQ     '1'           UtGetData
      *
N14   * Contact SHipper (roreløpig kun ved bil..)
N14  c                   if        BilBook = 'J'
N14  c                   MOVE      BSAVD         FE_DFAVD
N14  c                   MOVE      BSOPD         FE_DFOPD
N14  c                   MOVE      001           FE_DFFBNR
S32  c*                  MOVE      'SH'          FE_N3035
N32  c                   MOVE      'SH '         FE_N3035
N14  C     ContKey       CHAIN(N)  DOKUFE                             33
N14  C                   IF        *in33   = '0'
N14  C                   eval      WSSCONT   =   FE_C3412
N14  C                   eval      WSSTLF    =   FE_C3148B                      mobil
N14  C                   eval      WSSMAIL   =   FE_C3148E
N14  C                   END
N14   * Consignee
S32  c*                  MOVE      'CN'          FE_N3035
N32  c                   MOVE      'CN '         FE_N3035
N14  C     ContKey       CHAIN(N)  DOKUFE                             33
N14  C                   IF        *in33   = '0'
N14  C                   eval      WSKCONT   =   FE_C3412
N14  C                   eval      WSKTLF    =   FE_C3148B                      mobil
N14  C                   eval      WSKMAIL   =   FE_C3148E
N14  C                   END
N14  c                   endif
N14   *
s29  C*                  MOVE      HERFA         WSRFA
s29  C*                  MOVE      HERFA         GMRFA
n29  C                   MOVEL     HERFA         WSRFA
n29  C                   MOVEL     HERFA         GMRFA
     C                   MOVE      HEAVD         BSAVD
     C                   MOVE      HEOPD         BSOPD
     C                   MOVE      TXETAD        BSETA
     C                   MOVE      TXETDD        BSETD
     C                   MOVE      TXATAD        BSATA
     C                   MOVE      TXATDD        BSATD
     C                   MOVE      HEKNS         BSKNS
     C                   MOVE      HENAS         WSNAS
     C                   MOVE      HEADS1        WSADS1
     C                   MOVE      HEADS2        WSADS2
     C                   MOVE      HEADS3        WSADS3
     C                   MOVE      HEKNK         BSKNK
     C                   MOVE      HENAK         WSNAK
     C                   MOVE      HEADK1        WSADK1
     C                   MOVE      HEADK2        WSADK2
     C                   MOVE      HEADK3        WSADK3
N38  C                   MOVE      HEKNA         BSKNA
     C                   MOVE      HELKA         WSLKF
     C                   MOVE      HETRI         WSLKT
     C                   MOVE      BLLSS         WSLSS
     c     WSLSS         ifeq      *blanks
     C                   MOVE      HESDF         WSLSS
     c                   end
     C                   MOVE      BLLSH         WSLSH
     C                   MOVE      BLVH          WSVH
     C                   MOVE      BLVH2         WSVH2
     C                   MOVE      BLLOH         WSLOH
     C                   MOVE      BLLOS         WSLOS
     c     WSLOS         ifeq      *blanks
     C                   MOVE      HESDT         WSLOS
     c                   end
     C                   MOVE      HEOT          WSOT
     C                   MOVE      HEFR          WSFR
     C                   MOVE      HENT          BSNT
     C                   MOVE      HEVKT         BSVKT
     C                   MOVE      HEM3          BSM3
     C                   MOVE      HELM          BSLM
     C                   MOVE      HEVS1         WSVS1
     C                   MOVE      HEVS2         WSVS2
     C                   MOVE      HEGM1         WSGM1
     C                   MOVE      HEGM2         WSGM2
N38  C                   MOVE      HESDL         WSSDL
      *
      * lov å velge oppdr.type/franka. via pulldown?
     C                   exsr      GetOtFr
      *
     C                   MOVE      BLBLNR        WSBLNR
     C                   MOVE      BLCH          WSBLORR
     C                   MOVE      BLREIS        WSREIS
     C                   MOVE      BLTR          WSTR
     C                   MOVE      BLOB          WSOB
      *
     C     HEADFK        SETLL     BLV1
     C     HEADFK        READE     BLV1                                   33
     C                   MOVE      *BLANKS       CN
     C                   MOVE      *BLANKS       CT
     C                   MOVE      *ZEROS        VK
     C                   MOVE      *ZEROS        M3
     C                   MOVE      *ZEROS        XN
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   MOVE      BVMN          CN(XN)
     C                   MOVE      BVKDC         CT(XN)
     c                   move      *blanks       CC4FT
     C     CT(XN)        CHAIN     CDCON4                             33
     c                   move      CC4FT         CTT(XN)
N07  C                   MOVE      BVNT          NT(XN)
     C                   MOVE      BVVKT         VK(XN)
     C                   MOVE      BVM3          M3(XN)
S03  C*                  IF        XN = 4
N03  C                   IF        XN = 5
     C                   LEAVE
     C                   END
     C     HEADFK        READE     BLV1                                   33
     C                   ENDDO
N14
N14   * Hent Fritekst.
N14  C                   MOVE      *BLANKS       TX
N14  C                   MOVE      *ZEROS        NR
N14  C                   MOVE      'J'           X1LIN             1
N14   * HENT MELDING TIL AVSENDER
N14  C     HEADFK        SETLL     Freetxt1
N14  C     HEADFK        Reade(N)  Freetxt1                               33
N14  C     *in33         doweq     '0'
N14  c     frtkod        IFEQ      'R'
N14  C                   IF        X1LIN = 'J'
N14  C                   EVAL      X1LIN = 'N'
N14  C                   ELSE
N14  C                   CAT       XSTEGN1:0     WSMTXT
N14  C                   CAT       XSTEGN2:0     WSMTXT
N14  C                   END
N14  C                   CAT       FRTTXT:0      WSMTXT
N14  c                   end
N14  C     HEADFK        Reade(N)  Freetxt1                               33
N14  c                   end
N14   * HENT MELDING TIL TRANSPORTØR
N14  C                   MOVE      *BLANKS       TX
N14  C                   MOVE      *ZEROS        NR
N14  C                   MOVE      'J'           X1LIN             1
N14  C     HEADFK        SETLL     Freetxt1
N14  C     HEADFK        Reade(N)  Freetxt1                               33
N14  C                   DOW       *IN33 = *OFF
N14  C     FRTKOD        IFEQ      'G'
N14  C                   IF        X1LIN = 'J'
N14  C                   EVAL      X1LIN = 'N'
N14  C                   ELSE
N14  C                   CAT       XSTEGN1:0     WSTTXT
N14  C                   CAT       XSTEGN2:0     WSTTXT
N14  C                   END
N14  C                   CAT       FRTTXT:0      WSTTXT
N14  C                   END
N14  C     HEADFK        Reade(N)  Freetxt1                               33
N14  C                   END
N14   * HENT MELDING TIL SPEDITØR
N14  C                   MOVE      *BLANKS       TX
N14  C                   MOVE      *ZEROS        NR
N14  C                   MOVE      'J'           X1LIN             1
N14  C     HEADFK        SETLL     Freetxt1
N14  C     HEADFK        Reade(N)  Freetxt1                               33
N14  C                   DOW       *IN33 = *OFF
N14  C     FRTKOD        IFEQ      ' '
N14  C                   IF        X1LIN = 'J'
N14  C                   EVAL      X1LIN = 'N'
N14  C                   ELSE
N14  C                   CAT       XSTEGN1:0     WSSTXT
N14  C                   CAT       XSTEGN2:0     WSSTXT
N14  C                   END
N14  C                   CAT       FRTTXT:0      WSSTXT
N14  C                   END
N14  C     HEADFK        Reade(N)  Freetxt1                               33
N14  C                   END
      *
     C     UtgetData     endsr
      *
      *=====================================================================
      *  Hent data fra fra param.fil mm ved første "syklus"  / Ny post
      *=====================================================================
     C     GetDft        begsr
N09  C                   IF        FROMPOMS = 'J'
N09  C     BSTUR         CHAIN(N)  TURER14                            33
N09  C                   IF        *IN33 = *OFF
N09  C                   EVAL      WSBLNR = TUBLNR
N09  C                   EVAL      WSTR   = TUTR
N09  C                   EVAL      WSCN1  = TUCON1
N09  C                   EVAL      WSCT1  = TUCKD1
N09  C                   EVAL      WSLSH  = TUSTEF
N09  C                   EVAL      WSLOH  = TUSTET
N09  C                   EVAL      BSETD    = TUETD
N09  C                   EVAL      BSETA    = TUETA
N09  C                   EVAL      BSATD    = TUATD
N09  C                   EVAL      BSATA    = TUATA
N09  C                   END
N09  C     CUNDL01KK     CHAIN     CUNDL01                            33
N09  C  N33              EVAL      WSNAK = KNAVN
N09  C                   END
N09   *
     C                   MOVE      *BLANKS       GMRFA
      *
      * lov å velge oppdr.type/franka. via pulldown?
     c                   exsr      GetOtFr
      *
     C     UtgetDft      endsr
      *
      *=====================================================================******
      * lov å velge oppdr.type/franka. via pulldown?
      *=====================================================================******
     C     GetOtFr       begsr
      *
      *
     C     WSOT          IFEQ      *blanks
     C                   Movel     OT(1)         WSOT
     C                   end
     C     WSFR          IFEQ      *blanks
     C                   Movel     FR(1)         WSFR
     C                   move      'N'           VelgOtFr
     C                   end
     C     OT(2)         IFNE      *Blanks
     C     FR(2)         orne      *blanks
     C                   move      'J'           VelgOtFr
     C                   end
      *
     C                   endsr
      *
      *
      *=====================================================================******
      *  Display TRAFIKK
      *=====================================================================******
     C     DspTROB       begsr
      * TRAFIKK
     C                   callp     wrtsection('Trafictop')
      *
     C                   IF        WSTR = *BLANKS
     C                   callp     updhtmlvar('CTKD':'')
     C                   callp     updhtmlvar('CTFT':' -- blank -- ')
     C                   callp     wrtsection('Traficrow')
     C                   END
      *
     C     BIFIRM        SETLL     CDTRAFL2
     C     BIFIRM        READE     CDTRAFL2                               33
     C                   DOW       *IN33 = *OFF
     C                   callp     updhtmlvar('CTKD':CTKD)
     C                   callp     updhtmlvar('CTFT':CTFT)
     C                   IF        CTKD = WSTR
     C                   callp     updhtmlvar('SLTRSEL':'SELECTED')
     C                   else
     C                   callp     updhtmlvar('SLTRSEL':spaces)
     C                   END
     C                   callp     wrtsection('Traficrow')
     C     BIFIRM        READE     CDTRAFL2                               33
     C                   ENDDO
      *
      * legg på mulighet til å velge (tilbake til) kun blank når kode er valgt..
     C                   IF        WSTR <> *BLANKS
     C                   callp     updhtmlvar('SLTRSEL':spaces)
     C                   callp     updhtmlvar('CTKD':'  ')
     C                   callp     updhtmlvar('CTFT':' -- blank -- ')
     C                   callp     wrtsection('Traficrow')
     C                   END
     C                   callp     wrtsection('TraficBot')
      * VESSEL
     c     ShowVess      IFEQ      'J'
     C                   callp     wrtsection('Vesseltop')
      *
     C                   IF        WSOB = *BLANKS
     C                   callp     updhtmlvar('CBKDB':'')
     C                   callp     updhtmlvar('CBNAB':' -- blank -- ')
     C                   callp     wrtsection('Vesselrow')
     C                   END
      *
     C     WSTR          COMP      *BLANKS                                33
     C  N33CDTRAFL2K     CHAIN     CDTRAFL2                           33
     C  N33              MOVE      CTKN          XREDERI           8 0
     C   33              MOVE      *ZEROS        XREDERI
     C     *LOVAL        SETLL     CDBOAT
     C                   READ      CDBOAT                                 33
     C                   DOW       *IN33 = *OFF
     C                   callp     updhtmlvar('CBKDB':CBKDB)
     C                   callp     updhtmlvar('CBNAB':CBNAB)
     C                   IF        CBKDB = WSOB
     C                   callp     updhtmlvar('SLOBSEL':'SELECTED')
     C                   else
     C                   callp     updhtmlvar('SLOBSEL':spaces)
     C                   END
     C                   callp     wrtsection('Vesselrow')
     C*                  ENDSL
     C                   READ      CDBOAT                                 33
     C                   ENDDO
      *
      * legg på mulighet til å velge (tilbake til) kun blank når kode er valgt..
     C                   IF        WSOB <> *BLANKS
     C                   callp     updhtmlvar('SLOBSEL':spaces)
     C                   callp     updhtmlvar('CBKDB':'  ')
     C                   callp     updhtmlvar('CBNAB':' -- blank -- ')
     C                   callp     wrtsection('Vesselrow')
     C                   END
     C                   callp     wrtsection('VesselBot')
     c                   END
      *
     C                   endsr
      *
      *=====================================================================******
      *  Display OppdType Frankatur  to select from
      *=====================================================================******
     C     DspOtFr       begsr
      * Oppdrags-type.
     c                   move      *zeros        OtAnt             2 0
     C                   callp     wrtsection('Optytop')
     C     1             DO        16            N                 2 0
     C                   MOVEL     OT(N)         SlOt              2
     C     SlOt          Ifne      *blanks
     C                   callp     updhtmlvar('SLOT':SlOt)
     C     OtyKey        chain     KODTOTY                            33
     C     *in33         Ifeq      '0'
     C                   add       1             OtAnt
     C                   IF        XSPRÅK = 'EN'
     C                   callp     updhtmlvar('SLOTT':KO1ETX)
     C                   ELSE
     C                   callp     updhtmlvar('SLOTT':KO1NTX)
     C                   END
     C     WSOT          IFEQ      SlOt
     C                   callp     updhtmlvar('SLOTSEL':'SELECTED')
     C                   else
     C                   callp     updhtmlvar('SLOTSEL':spaces)
     C                   end
     C                   callp     wrtsection('Optyrow')
     c                   end
     c                   end
     c                   enddo
     C     OtAnt         Ifeq      *zeros
     C                   callp     updhtmlvar('SLOT':'  ')
     C                   callp     updhtmlvar('SLOTT':' -- blank -- ')
     C                   callp     updhtmlvar('SLOTSEL':'SELECTED')
     C                   callp     wrtsection('Optyrow')
     c                   end
     C                   callp     wrtsection('OptyBot')
      *
      * Frankatur
     c                   move      *zeros        FrAnt             2 0
     C                   callp     wrtsection('Franktop')
     C     1             DO        12            N                 2 0
     C                   MOVEL     FR(N)         SlFr              3
     C     SlFr          Ifne      *blanks
     C                   callp     updhtmlvar('SLFR':SlFr)
     C     FraKey        chain     KODTFR                             33
     C     *in33         Ifeq      '0'
     C                   add       1             FrAnt
     C                   IF        XSPRÅK = 'EN'
     C                   callp     updhtmlvar('SLFRT':KFRTTX)
     C                   ELSE
     C                   callp     updhtmlvar('SLFRT':KFRNTX)
     C                   END
     C     WSFR          IFEQ      SlFr
     C                   callp     updhtmlvar('SLFRSEL':'SELECTED')
     C                   else
     C                   callp     updhtmlvar('SLFRSEL':spaces)
     C                   end
     C                   callp     wrtsection('Frankrow')
     c                   end
     c                   end
     c                   enddo
     C     FrAnt         Ifeq      *zeros
     C                   callp     updhtmlvar('SLFR':'   ')
     C                   callp     updhtmlvar('SLFRT':' -- blank -- ')
     C                   callp     updhtmlvar('SLFRSEL':'SELECTED')
     C                   callp     wrtsection('Frankrow')
     c                   end
     C                   callp     wrtsection('FrankBot')
     C                   endsr
      *=====================================================================
      *  HENT DOKUMENTER
      *=====================================================================
     C     HENTDOK       BEGSR
      *
S25  C*    ARTYPE        CHAIN     ARKTXT                             33
S25  C*                  MOVE      ARKLAG        ARCEXT
S25  C*    ARKEXTK       CHAIN     ARKEXT                             33
S25  C*  33BIFIRM        CHAIN     FIRMARC                            33
      *
     C     ARKIVL02K     SETLL     ARKIVL02
     C     ARKIVL02K     READE     ARKIVL02                               33
     C                   MOVE      *BLANKS       UPDF
     C                   MOVE      *ZEROS        XN                3 0
     C                   DOW       *IN33 = *OFF
N25  C                   IF        ARTYPE <> 'ZO'
N25  C     ARTYPE        LOOKUP    A2                                     33
N25  C  N33              GOTO      LESNESTEDOK
N25  C                   END
N25  C     ARTYPE        CHAIN     ARKTXT                             33
N25  C                   MOVE      ARKLAG        ARCEXT
N25  C     ARKEXTK       CHAIN     ARKEXT                             33
N25  C   33BIFIRM        CHAIN     FIRMARC                            33
N25   *
     C                   ADD       1             XN
N25  C                   MOVE      *BLANKS       XEXT              4
N25  C     '.'           SCAN      ARLINK                                 33
N25  C  N33              EVAL      XEXT = '.pdf'
N25  C                   IF        ARRFK = *BLANKS
N25  C                   EVAL      ARRFK = ARTXT
N25  C                   END
      *
     C                   EVAL      UPDF(XN) = '<a href="'
     C                             + '/'  + %trim(ARCANE)
     C                             + '/'  + %trim(ARLINK)
N25  C                             + %trim(XEXT)
     C                             + '" target="SyPDFWindN">'
     C                             + %trim(ARRFK)
     C                             + '<img src="/syspeddev/PDF.gif" ALT="'
     C                             + %trim(ARRFK)
     C                             + '"></a>'
     C                   IF        ((ARUSER <> 'FLATFILE') AND
     C                              (ARUSER <> 'EDI-FACT'))
N25  C                   IF        ARTYPE = 'ZO'
     C                   EVAL      UPDF(XN) = %TRIM(UPDF(XN))
     C                             + ' <a href="#" OnClick="DltDoc('
     C                             + %trim(XAPSTR) + '/'
     C                             + %trim(ARCANE) + '/'
     C                             + %trim(ARLINK)
     C                             + %trim(XAPSTR)
     C                             + ')"> <img src="/syspeddev/DeleteX.gif"'
     C                             + ' width=13 height=13 border=0>'
N25  C                   END
     C                   END
      *
N25  C     LESNESTEDOK   TAG
     C     ARKIVL02K     READE     ARKIVL02                               33
     C                   ENDDO
      *
     C                   callp     updHTMLvar('UPDF1':UPDF1)
     C                   callp     updHTMLvar('UPDF2':UPDF2)
     C                   callp     updHTMLvar('UPDF3':UPDF3)
     C                   callp     updHTMLvar('UPDF4':UPDF4)
     C                   callp     updHTMLvar('UPDF5':UPDF5)
     C                   callp     updHTMLvar('UPDF6':UPDF6)
     C                   callp     updHTMLvar('UPDF7':UPDF7)
     C                   callp     updHTMLvar('UPDF8':UPDF8)
     C                   callp     updHTMLvar('UPDF9':UPDF9)
     C                   callp     updHTMLvar('UPDF10':UPDF10)
     C                   callp     updHTMLvar('UPDF11':UPDF11)
     C                   callp     updHTMLvar('UPDF12':UPDF12)
     C                   callp     updHTMLvar('UPDF13':UPDF13)
     C                   callp     updHTMLvar('UPDF14':UPDF14)
     C                   callp     updHTMLvar('UPDF15':UPDF15)
     C                   callp     updHTMLvar('UPDF16':UPDF16)
     C                   callp     updHTMLvar('UPDF17':UPDF17)
     C                   callp     updHTMLvar('UPDF18':UPDF18)
     C                   callp     updHTMLvar('UPDF19':UPDF19)
     C                   callp     updHTMLvar('UPDF20':UPDF20)
N42  C                   callp     updHTMLvar('UPDF21':UPDF21)
N42  C                   callp     updHTMLvar('UPDF22':UPDF22)
N42  C                   callp     updHTMLvar('UPDF23':UPDF23)
N42  C                   callp     updHTMLvar('UPDF24':UPDF24)
N42  C                   callp     updHTMLvar('UPDF25':UPDF25)
N42  C                   callp     updHTMLvar('UPDF26':UPDF26)
N42  C                   callp     updHTMLvar('UPDF27':UPDF27)
N42  C                   callp     updHTMLvar('UPDF28':UPDF28)
N42  C                   callp     updHTMLvar('UPDF29':UPDF29)
N42  C                   callp     updHTMLvar('UPDF30':UPDF30)
      *
     C                   ENDSR
      *
N22   *=====================================================================
N22   *  KONVERTER TALL
N22   *=====================================================================
N22  C     SRKNVTAL      begsr
N22  C                   Z-ADD     0             XNUMTAL
N22  C     1             DO        9             XN
N22  C                   SELECT
N22  C                   WHEN      XAT(XN) = '.' OR XAT(XN) = ',' OR
N22  C                             XAT(XN) = ' '
N22  C                   LEAVE
N22  C                   WHEN      XAT(XN) >= '0' AND XAT(XN) <= '9'
N22  C                   MULT      10            XNTH
N22  C                   MOVE      XAT(XN)       XNTH
N22  C                   ENDSL
N22  C                   ENDDO
N22   *
N22  C                   IF        XAT(XN) = '.' OR XAT(XN) = ','
N22  C                   Z-ADD     0             XN2
N22  C                   DO        6
N22  C                   ADD       1             XN
N22  C                   IF        XN < 15
N22  C                   IF        XAT(XN) >= '0' OR XAT(XN) <= '9'
N22  C                   ADD       1             XN2
N22XXC                   IF        XN2 <= 6
N22  C                   MOVE      XAT(XN)       XNTD(XN2)
N22XXC                   END
N22  C                   END
N22  C                   END
N22  C                   ENDDO
N22  C                   END
N22   *
N22  C                   ENDSR
N22   *
N37  C***********************************************
N37  C     TSTCHD        BEGSR
N37  C***********************************************
N37  C                   MOVE      HEAVD         UAVD              4 0
N37  C                   MOVE      HEOPD         UOPD              7 0
N37  C* Endret ETD?? Oppdatere oppdrag kun dersom ATD ikke oppgitt
N37  C                   IF        GMETD <> TXETDD                              1<-B
N37  C                   EVAL      UTEXT = BIBRID
N37  C                   MOVE      'ESOVERS5  '  UTEXT
N37  C                   CALL      'SYTTCHD'
N37  C                   PARM                    UAVD
N37  C                   PARM                    UOPD
N37  C                   PARM      'CHD'         UACTI             3
N37  C                   PARM      'ETD'         UTYP             20
N37  C                   PARM      'ETD'         UTYPE            20
N37  C                   PARM      GMETD         UGMDAT            8 0
N37  C                   PARM      TXETDK        UGMTID            4 0
N37  C                   PARM      TXETDD        UNYDAT            8 0
N37  C                   PARM      TXETDK        UNYTID            4 0
N37  C                   PARM                    UTEXT            70
N37  C                   ENDIF                                                  1<-E
N37   *
N37  C* Endret ETA?? Oppdatere oppdrag kun dersom ATA ikke oppgitt
N37  C                   IF        GMETA <> TXETAD                              1<-B
N37  C                   EVAL      UTEXT = BIBRID
N37  C                   MOVE      'ESOVERS5  '  UTEXT
N37  C                   CALL      'SYTTCHD'
N37  C                   PARM                    UAVD
N37  C                   PARM                    UOPD
N37  C                   PARM      'CHD'         UACTI
N37  C                   PARM      'ETA'         UTYP
N37  C                   PARM      'ETA'         UTYPE
N37  C                   PARM      GMETA         UGMDAT
N37  C                   PARM      TXETAK        UGMTID
N37  C                   PARM      TXETAD        UNYDAT
N37  C                   PARM      TXETAK        UNYTID
N37  C                   PARM                    UTEXT            70
N37  C                   ENDIF                                                  1<-E
N37   *
N37  C                   IF        GMATD <> TXATDD                              1<-B
N37  C                   EVAL      UTEXT = BIBRID
N37  C                   MOVE      'ESOVERS5  '  UTEXT
N37  C                   CALL      'SYTTCHD'
N37  C                   PARM                    UAVD
N37  C                   PARM                    UOPD
N37  C                   PARM      'CHD'         UACTI
N37  C                   PARM      'ATD'         UTYP
N37  C                   PARM      'ATD'         UTYPE
N37  C                   PARM      GMATD         UGMDAT
N37  C                   PARM      TXATDK        UGMTID
N37  C                   PARM      TXATDD        UNYDAT
N37  C                   PARM      TXATDK        UNYTID
N37  C                   PARM                    UTEXT            70
N37  C                   ENDIF                                                  1<-E
N37   *
N37  C                   IF        GMATA <> TXATAD                              1<-B
N37  C                   EVAL      UTEXT = BIBRID
N37  C                   MOVE      'ESOVERS5  '  UTEXT
N37  C                   CALL      'SYTTCHD'
N37  C                   PARM                    UAVD
N37  C                   PARM                    UOPD
N37  C                   PARM      'CHD'         UACTI
N37  C                   PARM      'ATA'         UTYP
N37  C                   PARM      'ATA'         UTYPE
N37  C                   PARM      GMATA         UGMDAT
N37  C                   PARM      TXATAK        UGMTID
N37  C                   PARM      TXATAD        UNYDAT
N37  C                   PARM      TXATAK        UNYTID
N37  C                   PARM                    UTEXT            70
N37  C                   ENDIF                                                  1<-E
N37   *
N37  C                   ENDSR
N37   *
      *=====================================================================
      *  Initier
      *=====================================================================
     C     INIT          begsr
      * Get program start time for calculating execution time
     C                   time                    timedata1
      *
     C                   open      BRIDF                                50
     C     WSUSER        CHAIN     BRIDF                              50
      *
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
     C                   EXSR      TSTUSER
      * HENTER PARAMETER
     C                   CALL      'ESGETOS'
     C                   parm                    BIBRID
     C                   parm                    BIFIRM
     C                   parm                    BIKUNR
     C                   parm                    BIKNG
     C     ParmOS12      parm      ParmOS12      ParmOS11       1024
S05  c*    OSCHG         ifeq      'J'
     c                   eval      OKButton = '<INPUT TYPE="SUBMIT" '
     c                             + 'VALUE="   OK   ">'
S05  c*                  end
      *
N12   * Bil/Landbasert
s35  c*    OSAVD         ifeq      75
s35  c*    OSAVD         oreq      76
s35  c*                  move      'J'           BILBOOK           1
s35  c*                  endif
      *
     C                   open      TURER14                              50
     C                   open      HEADF                                50
     C                   open      DISP                                 50
     C                   open      BILLOF                               50
     C                   open      BLV1                                 50
N09  C                   open      EPOH02                               50
N09  C                   open      EPOL02                               50
     C                   open      TRACKT                               50
     C                   open      TRACKF                               50
     C                   open      STED2                                50
N12  C                   open      STED2D                               50
N12  C                   open      DOKUFE                               50
N14  C                   open      FREETXT1                             50
     C                   OPEN      BRPARF
     C                   OPEN      CUNDL01
N17  C                   OPEN      VADR
     C                   OPEN      CDTRAFL2
     C                   OPEN      CDBOAT
     C                   OPEN      CDCON4
N11  C                   OPEN      KODTA
     C                   OPEN      KODTOTY
N35  C                   OPEN      KODTOT2
     C                   OPEN      KODTFR
     C                   OPEN      TELL
     C                   OPEN      ARKIVL02
     C                   OPEN      FIRMARC
     C                   OPEN      ARKTXT
     C                   OPEN      ARKEXT
     C                   OPEN      FRISOK
N10  C                   OPEN      EPOPOS
N38  C                   OPEN      KODTERM
      * Innen Z-filer skapt fra WEB forventes unik kund/reff
     C     HEADFK        klist
     C                   kfld                    BSAVD
     C                   kfld                    BSOPD
N14  C     ContKey       klist
N14  c                   kfld                    FE_DFAVD
N14  c                   kfld                    FE_DFOPD
N14  c                   kfld                    FE_DFFBNR
N14  c                   kfld                    FE_N3035
      *
N12  c     StedFraKey    klist
N12  c                   kfld                    WSLKF
n12  c                   kfld                    WSLSH
N12  c     StedTilKey    klist
N12  c                   kfld                    WSLKT
n12  c                   kfld                    WSLOH
      *
     C     ARKIVL02K     KLIST
     C                   KFLD                    UNKODE
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
S25  C*                  KFLD                    ARTYPE
     C                   MOVE      'A'           UNKODE            1
S25  C*                  MOVE      'ZO'          ARTYPE
     C     ARKEXTK       KLIST
     C                   KFLD                    BIFIRM
     C                   KFLD                    ARCEXT
     C     CDTRAFL2K     KLIST
     C                   KFLD                    BIFIRM
     C                   KFLD                    WSTR
     C     CUNDL01KR     KLIST
     C                   KFLD                    BIFIRM
     C                   KFLD                    CTKN
     C     CUNDL01KS     KLIST
     C                   KFLD                    BIFIRM
     C                   KFLD                    BSKNS
N17  C     Vadr1KS       KLIST
N17  C                   KFLD                    BIFIRM
N17  C                   KFLD                    BSKNS
N17  C                   KFLD                    VADRNR
N17  C                   Z-ADD     1             VADRNR                         EGEN VAREADRESSE
     C     CUNDL01KK     KLIST
     C                   KFLD                    BIFIRM
     C                   KFLD                    BSKNK
N17  C     Vadr1KK       KLIST
N17  C                   KFLD                    BIFIRM
N17  C                   KFLD                    BSKNK
N17  C                   KFLD                    VADRNR
N38  C     CUNDL01KA     KLIST
N38  C                   KFLD                    BIFIRM
N38  C                   KFLD                    BSKNA
     C     BrParKey      klist
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
     C                   MOVE      BIBRID        PABRID
     C                   MOVE      *zeros        PAKUNR
     c     OtyKey        klist
     c                   kfld                    KO1UNI
     c                   kfld                    SlOt
     c                   MOVE      'OTY'         KO1UNI
N35  c     Ot2Key        klist
N35  c                   kfld                    KO2UNI
N35  c                   kfld                    HEOT
N35  c                   MOVE      'O2Y'         KO2UNI
     c     FraKey        klist
     c                   kfld                    KFRUNI
     c                   kfld                    SlFr
     c                   MOVE      'FR'          KFRUNI
N11  C     KODTAK        KLIST
N11  C                   KFLD                    KOAUNI
s33  C*                  KFLD                    OSAVD
N33  C                   KFLD                    BSAVD
N11  C                   MOVE      'A'           KOAUNI
N38   * Key for KODTERM
N38  C     SDLKey        KLIST
N38  C                   KFLD                    KOTMUN
N38  C                   KFLD                    KOTMKO
N38  C                   movel     'TERM'        KOTMUN
N25   *
N25   * Vis kun dokumeter bruker er autorisert for å se...
N25  C                   move      *blanks       ATString
N25  C                   MOVE      'ARKTY'       PAID
N25  C     BRPARKEY      chain     BRPARF                             33
N25  C                   IF        *IN33 = *OFF
N25  C                   movel     Pavrda        ATstring1
N25  C     BRPARKEY      READE     BRPARF                                 33
N25  C  N33              movel     Pavrda        ATstring2
N25  C  N33BRPARKEY      READE     BRPARF                                 33
N25  C  N33              movel     Pavrda        ATstring3
N25  C  N33BRPARKEY      READE     BRPARF                                 33
N25  C  N33              movel     Pavrda        ATstring4
N25  C     1             DO        64            ln                2 0
N25  c                   movea     AT(ln)        A2(ln)
N25  c                   end
N25  C                   END
      * HENT SPRÅKKODE
     C                   MOVEL     'SPRÅK'       PAID
     C     BrParKey      Chain     BRPARF                             33
     C                   IF        (*IN33 OR (PAVRDA <> 'EN'))
     C                   MOVE      *BLANKS       XSPRÅK            2
     C                   ELSE
     C                   MOVE      'EN'          XSPRÅK            2
     C                   END
      *
     C                   MOVE      'OLBAN'       PAID
     C     BrParKey      CHAIN     BRPARF                             33
     C  N33              MOVE      'J'           XOPPLAST          1
     C  N33              MOVEL     PAVRDA        XBANE            50
      *
N39  C                   MOVE      'ASSIG'       PAID
N39  C     BrParKey      CHAIN     BRPARF                             33
N39  C   33              MOVEL     'WEB'         Sign              3
N39  C  N33              MOVEL     PAVRDA        Sign              3
      *
     c     FirmKey       klist
     c                   kfld                    DFTUSER          10
     c                   kfld                    NULLKU            8 0
     c                   kfld                    PAID
     c                   Eval      DFTUSER = '*KUNDFT*'+BIFIRM
     C                   MOVEL     'OSPOF'       PAID
     C     FirmKey       Chain     BRPARF                             33
     c     FrisokKey     klist
     c                   kfld                    HEAVD
     c                   kfld                    HEOPD
     c                   kfld                    FSKODE
S35  c*                  movel     PAVRDA        FSKODE
N35  c                   movel     PAVRDA        OSPOKOD           3
     C                   MOVE      'N'           AVSLUTT           1
     c                   move      *blanks       feilmelding
     c                   move      *blanks       fmeldnr
S28  C*                  MOVE      *ZEROS        XTUTVKT           9 0
N28  C                   MOVE      *ZEROS        XTUTVKT          11 0
      *
     C                   BITON     '457'         XSTEGN1           1
     C                   BITOFF    '01236'       XSTEGN1
     C                   BITON     '257'         XSTEGN2           1
     C                   BITOFF    '01346'       XSTEGN2
     C                   BITON     '123457'      XAPSTR            1
     C                   BITOFF    '06'          XAPSTR
      *
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     c                   move      'N'           ShowVess          1
N11   *
N11  C     KODTAK        CHAIN     KODTA                              33
N11  C  N33KOAIE         COMP      'E'                                3333
N11  C   33              MOVE      'I'           XIMPEXP           1
N11  C  N33              MOVE      'E'           XIMPEXP
N35  c                   move      'N'           Innland           1
N35   * Bil/Landbasert
N35  c     BSAVD         ifeq      75
N35  c     BSAVD         oreq      76
N35  c                   move      'J'           BILBOOK           1
N35  c                   endif
N35  c     KOAIE         ifeq      '1'
N35  c                   move      'J'           BILBOOK
N35  c                   eval      OSOT = 'IN'
N35  c                   eval      OSFR = 'S  ,M  '                             1=Sender 2=Mottaker
N35  c                   move      'J'           Innland
N35  C                   MOVE      'E'           XIMPEXP                        utgående
N35  c                   endif
N35  c     KOAIE         ifeq      '2'
N35  c                   move      'J'           BILBOOK
N35  c                   eval      OSOT = 'IN'
N35  c                   eval      OSFR = 'M  ,S  '                             1=Mottaker 2=Sender
N35  c                   move      'J'           Innland
N35  C                   MOVE      'I'           XIMPEXP                        inngående
N35  c                   endif
      *
     C                   endsr
      *////////////////////////////////////////////////////////////
     C     TSTUSER       BEGSR
      *////////////////////////////////////////////////////////////
      /copy syspeds/qrpgsrcpy,tstuser
      *
     C                   endsr
N14
N14   *=====================================================================
N14   *  FINNE LINJE
N14   *=====================================================================
N14  C     KVTLIN        BEGSR
N14  C                   MOVE      *BLANKS       T70
N14  C                   MOVE      *BLANKS       TX
N14  C                   MOVE      *ZEROS        XN1               5 0
N14  C                   MOVE      *ZEROS        YN2               5 0
N14  C     XLINL         MULT      90            XN5               5 0
N14  C     1             DO        XN5           XN3               5 0
N14  C                   ADD       1             YN2
N14  C                   SELECT
N14  C                   WHEN      YN2 > XLINL
N14  C                   ADD       1             XN1
N14  C                   MOVEL     TXT70         TX(XN1)
N14  C     XN1           CABEQ     90            SLKVTLIN
N14  C                   MOVE      *BLANKS       T70
N14  C                   IF        KVT(XN3) = XSTEGN1
N14  C     XN3           ADD       1             XN4               5 0
N14  C                   IF        KVT(XN4) = XSTEGN2
N14  C                   EVAL      XN3 = XN4
N14  C                   Z-ADD     0             YN2
N14  C                   ELSE
N14  C                   Z-ADD     1             YN2
N14  C                   MOVE      KVT(XN3)      T70(YN2)
N14  C                   END
N14  C                   ELSE
N14  C                   Z-ADD     1             YN2
N14  C                   MOVE      KVT(XN3)      T70(YN2)
N14  C                   END
N14  C                   WHEN      KVT(XN3) = XSTEGN1
N14  C     XN3           ADD       1             XN4               5 0
N14  C                   IF        KVT(XN4) = XSTEGN2
N14  C                   ADD       1             XN1
N14  C                   MOVEL     TXT70         TX(XN1)
N14  C     XN1           CABEQ     90            SLKVTLIN
N14  C                   MOVE      *BLANKS       T70
N14  C                   MOVE      *ZEROS        YN2
N14  C                   EVAL      XN3 = XN4
N14  C                   ELSE
N14  C                   MOVE      KVT(XN3)      T70(YN2)
N14  C                   END
N14  C                   OTHER
N14  C                   MOVE      KVT(XN3)      T70(YN2)
N14  C                   ENDSL
N14  C                   ENDDO
N14   *
N14  C     SLKVTLIN      ENDSR
N14   *=====================================================================
N14   *  Skriv fritekst til fil
N14   *=====================================================================
N14  C     SKRIVFRT      begsr
N14  C     1             Do        90            NR                2 0
N14  c     TX(NR)        Ifne      *blanks
N14  c                   add       1             FRTLI
N14  c                   move      TX(NR)        FRTTXT
N14  c                   write     freetxtr
N14  c                   end
N14  c                   end
N14   *
N14  C                   endsr
N14   *
N14   *=====================================================================
N14   *  TEST ANTALL MELDINGSLINJER
N14   *=====================================================================
N14
N14  C     SRTESTL       begsr
N14   *
N14  C                   Z-ADD     0             XANTL             3 0
N14  C                   EVAL      KVTXT = WSMTXT
N14  C                   EXSR      SRTESTL2
N14   *
N14  C                   EVAL      KVTXT = WSTTXT
N14  C                   EXSR      SRTESTL2
N14   *
N14  C                   EVAL      KVTXT = WSSTXT
N14  C                   EXSR      SRTESTL2
N14   *
N14  C                   ENDSR
N14   *
N14   *=====================================================================
N14   *  TEST ANTALL MELDINGSLINJER
N14   *=====================================================================
N14  C     SRTESTL2      begsr
N14   *
N14  C                   EVAL      TXT70 = *BLANKS
N14  C                   Z-ADD     0             YN2
N14  C     1             DO        6300          YN                5 0
N14  C                   ADD       1             YN2
N14  C                   SELECT
N14  C                   WHEN      YN2 = 70
N14  C                   IF        KVT(YN) = XSTEGN1
N14  C                   EVAL      XN3 = YN + 1
N14  C                   IF        KVT(XN3) = XSTEGN2
N14  C                   EVAL      YN = XN3
N14  C                   ELSE
N14  C                   MOVE      KVT(YN)       T70(YN2)
N14  C                   END
N14  C                   ELSE
N14  C                   MOVE      KVT(YN)       T70(YN2)
N14  C                   END
N14  C                   IF        TXT70 <> *BLANKS
N14  C                   ADD       1             XANTL
N14  C                   END
N14  C                   Z-ADD     0             YN2
N14  C                   EVAL      TXT70 = *BLANKS
N14  C                   WHEN      KVT(YN) = XSTEGN1
N14  C                   EVAL      XN3 = YN + 1
N14  C                   IF        KVT(XN3) = XSTEGN2
N14  C                   EVAL      YN = XN3
N14  C                   IF        TXT70 <> *BLANKS
N14  C                   ADD       1             XANTL
N14  C                   END
N14  C                   Z-ADD     0             YN2
N14  C                   EVAL      TXT70 = *BLANKS
N14  C                   ELSE
N14  C                   MOVE      KVT(YN)       T70(YN2)
N14  C                   END
N14  C                   OTHER
N14  C                   MOVE      KVT(YN)       T70(YN2)
N14  C                   ENDSL
N14  C                   ENDDO
N14   *
N14  C                   ENDSR
N14   *
      *=====================================================================
      * Send output buffer and quit
      *=====================================================================
     C     Exit          begsr
      * Compute and display run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
     C                   callp     wrtsection('endhtml')
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      *
     C                   close     BRIDF
     C                   close     TURER14
     C                   close     HEADF
     C                   close     DISP
     C                   close     BILLOF
     C                   close     BLV1
N09  C                   close     EPOH02
N09  C                   close     EPOL02
     C                   close     TRACKT
     C                   close     TRACKF
     C                   close     STED2
N12  C                   close     STED2D
N12  C                   close     DOKUFE
N14  C                   close     FREETXT1
     C                   close     BRPARF
     C                   close     CUNDL01
N17  C                   close     VADR
     C                   close     CDTRAFL2
     C                   close     CDBOAT
     C                   close     CDCON4
N11  C                   close     KODTA
     C                   close     KODTOTY
N35  C                   close     KODTOT2
     C                   close     KODTFR
     C                   close     TELL
     C                   CLOSE     ARKIVL02
     C                   CLOSE     FIRMARC
     C                   CLOSE     ARKTXT
     C                   CLOSE     ARKEXT
     C                   CLOSE     FRISOK
N10  C                   CLOSE     EPOPOS
N38  C                   CLOSE     KODTERM
     C                   eval      *inlr = *on
     C                   return
     C                   endsr
