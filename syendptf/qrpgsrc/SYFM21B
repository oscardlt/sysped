********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 parameter til arc014  ..
10XXX * 02 CB  PTF10 parameter til arc014  ..
10XXX * 03 sh  PTF10 mindre valutakode endring
10XXX * 04 sh  PTF10 ny parameter arc014
10XXX * 05 JOV PTF10 V10-7 lang-feil rettet (kjør V10V10RE114 ) OGSÅ SYFI10X/SYTR35 !!!!
10XXX * 06 YBC PTF10 BRUKT FEIL VERIABLE VED TESTING AV ARKIV, RETT FEIL I ENDRING 4
10XXX * 07 SH  PTF10 viser nå avtalekundenummer
10252 * 08 SH  PTF10 F15 VIS ARKIV
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
10252 * 09 SH  PTF11 RETURN om HEADF ikke finnes
10252 * 10 SH  PTF11 F5 = REFRESH
10252 * 11 SH  PTF11 full skjermbredde
10252 * 12 SH  PTF11 mindre rettelse til 11
10252 * 13 SH  PTF11 viser feil data     total
10252 * 14 SH  PTF11 opsjon 9  vise fraktavtale
10252 * 15 SH  PTF12 F8 track and trace
10252 * 16 SH  PTF12 vise lokalvalutakode i heading   gjelder skjermbilde
10252 * 17 SH  PTF12 nettobeløp ved mva
10252 * 18 SH  PTF12 HENT ANDEL AV TURKOSTNAD
10252 * 19 SH  PTF12 liten rettelse til 18
10252 * 20 SH  PTF12 feil summering turkostnader
********************************************************************
      *
      ***********************************************************
      *** PROGRAM SKAL SPØRRE PÅ OPPDRAG (VISE FAKTURA)       ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 04 05 08 11 13-24                ***
      *** LEDIGE INDIKATORER 36-47 52-90 95-97                ***
      ***********************************************************
      *
      * 50 = TAX AND TOTAL-LINES ON SCREEN
      *
     Farkivl11  IF   E           K DISK
     Fkosta14   IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FFIRM      IF   E           K DISK
     FKODSAM    IF   E           K DISK
     FVALUL01   IF   E           K DISK
     FHEADF     IF   E           K DISK
     FFAK6      IF   E           K DISK
     FKODTGE    IF   E           K DISK
     FKOSBU9    IF   E           K DISK
N18  FKOSBU17   IF   E           K DISK
N18  F                                     RENAME(KOSBUR:KOSBUR17)
     FSIF       IF   E           K DISK
     FKONTL01   IF   E           K DISK
     FKODWL01   IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FSYFM21FB  CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
     D*
     D*** HØ, LE, BR, AN  BRUKES PGA. KALLER PÅ SYEF10B
     D HØ              S              3  2 DIM(12)
     D LE              S              3  2 DIM(12)
     D BR              S              3  2 DIM(12)
     D AN              S              3  0 DIM(12)
     D*
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
n05  D                 DS
n05  D  FADOCN                 1     11
n05  D    FADOCA               1      4
n05  D    FADOCB               5     11
n11  D                 DS
n11  D  HESTN1                 1      1
n11  D  HESTN2                 2      2
n11  D  HESTN3                 3      3
n11  D  HESTN4                 4      4
n11  D  HESTN5                 5      5
n11  D  WTGX                   1      5
     D                 DS
     D  WSDTOD                 1      2  0
     D  WSDTOM                 3      4  0
     D  WSDTOÅ                 5      6  0
     D  WSDT                   1      6  0
     D                 DS
     D  HEDTOÅ                 1      4  0
     D  HEDTOM                 5      6  0
     D  HEDTOD                 7      8  0
     D  HEDTOP                 1      8  0
     D  OPDÅMD                 1      6  0
     D                 DS
     D  OPDPER                 1      6  0
     D  HEDTCP                 1      2  0
     D  HEDTÅP                 3      4  0
     D  HEDTMP                 5      6  0
     D                 DS
     D  FAKPER                 1      6  0
     D  FACC                   1      2  0
     D  FAÅR                   3      4  0
     D  FAMND                  5      6  0
     D                 DS
     D  FADAG1                 1      2  0
     D  FADAG2                 3      4  0
     D  FADAG3                 5      6  0
     D  FADAGM                 1      6  0
     D                 DS
     D  FADAO1                 1      2  0
     D  FADAO2                 3      4  0
     D  FADAO3                 5      6  0
     D  FADAOL                 1      6  0
     D                 DS
     D  FADTÅ                  1      4  0
     D  FADTM                  5      6  0
     D  FADTD                  7      8  0
     D  FADATO                 1      8  0
     D                 DS
     D  WSDTD                  1      2  0
     D  WSDTM                  3      4  0
     D  WSDTÅ                  5      6  0
     D  WSDATO                 1      6  0
     D                 DS
     D  FADTÅF                 1      4  0
     D  FADTMF                 5      6  0
     D  FADTDF                 7      8  0
     D  FADAFF                 1      8  0
     D                 DS
     D  WSDTDF                 1      2  0
     D  WSDTMF                 3      4  0
     D  WSDTÅF                 5      6  0
     D  WSDAFF                 1      6  0
     D                 DS
     D  WSVT                   1     20
     D  WSVT2                  1      7
     D                 DS
     D  WITAXD                 1      8  0
     D  MVAATW                 1      4  0
     D  MVAMTW                 5      6  0
     D  MVADTW                 7      8  0
      * PARAMETERSTRENG FOR KALL PÅ SYKS12
     D                 DS
     D  P1DS                   1    256
     D  P1FLAG                 1      1
     D  P1BNR                  2      8  0
     D  P1AVD                  9     12  0
     D  P1TUNR                13     20  0
     D  P1OAVD                21     24  0
     D  P1OPD                 25     31  0
     D  P1BL                  32     44  2
     C*
     C                   EXSR      INIT
     C*
N10  C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   EXSR      KDTFM1
     C                   WRITE     SUBCTL
     C                   EXSR      KDTFM1
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     1             DSPRCN
     C                   Z-ADD     *ZEROS        ZRECNO
     C                   MOVE      *ZEROS        WSTAXN
     C                   MOVE      *ZEROS        WSTAXV
     C                   MOVE      *ZEROS        WSTOTN
     C                   MOVE      *ZEROS        WSTOTV
     C                   MOVE      *ZEROS        WSGRAN           13 2
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     FAK2K         SETLL     FAK6
     C     START1        TAG
     C     FAK2K         READE     FAK6                                   94
     C  N94
     CAN 35FAKDA         IFEQ      'K'
     C     FAKUNR        ORNE      IKN
     C     FAFAKT        OREQ      0
     C                   GOTO      START1
     C                   END
     C                   MOVE      *ZEROS        FORIGE            7 0
     C                   MOVE      *BLANK        FORISK            1
     C                   MOVE      FAFAKT        FIRST             7 0
      *
     C     START2        TAG
      *
     C  N94              DO
     C                   DO        9999
     C                   ADD       1             ZRECNO            4 0
     C                   EXSR      MOVWS
     C                   EXSR      MOVDAT
     C                   EXSR      KDTFM2
     C     WSBELN        COMP      *ZEROS                               49
     C                   SETOFF                                       56
     C     OPDPER        IFNE      *ZEROS
     C     FAKPER        ANDNE     *ZEROS
     C     OPDPER        COMP      FAKPER                             5656
     C                   END
     C     FAKDM         IFNE      'N'
     C                   EXSR      MVA
     C                   ENDIF
     C                   WRITE     SUBFIL
     C     ST21          TAG
     C     FAK2K         READE     FAK6                                   94
     C  N94
     CAN 35FAKDA         IFEQ      'K'
     C     FAKUNR        ORNE      IKN
     C     FAFAKT        OREQ      0
     C                   GOTO      ST21
     C                   END
     C   94              EXSR      TOTLIN
     C  N94              END
     C                   END
      *
     C* HVIS ÅPNE ESTIMERTE FINNES..JUSTER / VIS ALLTID GRANDTOTAL
     C     WSESTI        IFNE      *ZEROS
     C                   ADD       WSESTI        WSGRAN
     C                   SETON                                        5153
     C                   ELSE
     C                   SETOFF                                         53
     C                   END
     C     WSGRAN        COMP      0                                    52
     C*
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     2             POSNBR
     C*
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C                   EXSR      KDTFM1
     C     ZRECNO        IFLE      0
     C                   WRITE     NYVARE
     C                   ELSE
     C                   WRITE     SUBCTL
     C                   END
     C                   EXSR      KDTFM1
     C                   EXFMT     BUNN
     C*
     C***
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
     C***
     C*
     C                   SETOFF                                       3098
     C                   MOVE      *ZEROS        UFLAGG
     C   01              ADD       1             UFLAGG
     C   02              ADD       2             UFLAGG
     C   03              ADD       3             UFLAGG
     C   12              ADD       9             UFLAGG
     C*
     C   25              DO
     C                   SETOFF                                       25
     C                   Z-ADD     YRECNO        ZRECNO
     C                   GOTO      START2
     C                   END
     C*
     C* IF NO F-KEYS WORK WITH SUBFILE
     C*
     C  N01
     CANN02
     CANN03
N10  CANN05
     CANN06
     CANN07
N15  CANN08
     CANN09
     CANN10
     CANN12
     CANN11
N08  CANN17
     CANN24
     CANN13
     CANN15              DO
     C     ZRECNO        IFNE      0
     C                   EXSR      FAHENT
     C                   END
     C   98XRECNO        IFNE      0
     C                   Z-ADD     XRECNO        ZRECNO
     C                   END
     C                   GOTO      START3
     C                   END
     C*
N10  C   05              GOTO      START
     C   06              EXSR      VFRB
     C   07              EXSR      VTFRB
N15  C   08              EXSR      TTSR
     C   09              EXSR      VFFRBI
     C   10              EXSR      VFFRBE
     C   11              EXSR      REKV
     C   13              EXSR      SAD
     C   15              EXSR      LAGER
N08  C   17              DO
N08  C                   EXSR      ARKIVSS
N08  C                   END
     C   24              DO
     C                   EXSR      UTCMDL
     C                   GOTO      START3
     C                   END
     C   30              GOTO      START3
     C                   EXSR      TESTFL
     C*
     C  N01
     CANN02
     CANN03
     CANN12              GOTO      START3
     C*
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     FAHENT        BEGSR
     C***********************************************
     C                   SETOFF                                       919299
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C   98              DO
     C   99              SETOFF                                       98
     C   98              MOVE      'DIV0012'     MSGNR
     C   98              SETON                                            30
     C                   Z-ADD     1             LINNBR
     C                   GOTO      SLHENT
     C                   END
     C     ZRECNO        DIV       13            LINNBR
     C                   MVR                     LINNBR
     C                   MOVE      LINNBR        XLIN              2 0
     C     XLIN          IFEQ      0
     C                   Z-ADD     13            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C  N98WSNR          IFEQ      '5'
     C     WSVT2         ANDNE     XTXT1
     C     WSVT2         ANDNE     XTXT2
     C                   MOVE      ' '           WSNR
     C     WSBELN        COMP      *ZEROS                               49
     C                   UPDATE    SUBFIL
     C     FABELV        IFNE      *ZEROS
     C     FABELN        DIV(H)    FABELV        XWORK            15 6
     C                   ELSE
     C                   Z-ADD     1             XWORK
     C                   END
     C     FAEXRA        ifeq      *zeros
     C     VALU1K        CHAIN     VALUL01                            99
     C   99              Z-ADD     1             OMRFAK
     C     XWORK         MULT(H)   OMRFAK        XVKU
     c                   else
     c                   z-add     FAEXRA        xvku
     c                   end
N07  c                   move      fakunr        kunr
     C     KUND1K        CHAIN     CUNDL01                            99
     c   99              move      *blanks       KNAVN
     C                   SETON                                        99
     C                   EXFMT     VAREL3
     C                   END
      *
      * kostnadsbilag
      *
     C  N98WSNR          IFEQ      'K'
     C     fakda         ifeq      'K'
     C                   z-add     5             umode             1 0
     C                   z-add     fafakt        ubnr              7 0
     c     ubnr          chain     kosta14                            33
     c     *in(33)       ifeq      '0'
     C                   seton                                        99
     C                   call      'SYKS02CLD'
     C                   parm                    kabnr
     c                   parm                    umode
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     c                   else
     c                   seton                                        30
     C                   MOVE      'SHU0990'     MSGNR
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   GOTO      SLHENT
     c                   end
     c                   else
     c                   seton                                        30
     C                   MOVE      'SHU0991'     MSGNR
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   GOTO      SLHENT
     c                   end
     c                   end
      *
     c  N98wsnr          ifeq      'P'
     c     fafakt        andne     0
     c     fakda         ifne      'K'
     c     fask          andne     'I'
     C     FIFIRM        CHAIN     FIRMARC                            30
     C                   MOVE      '1'           *IN99
     C   30              MOVE      'SHU0830'     MSGNR
     C   30              MOVE      ' '           WSNR
     C   30              UPDATE    SUBFIL
     C   30              GOTO      SLHENT
     C                   EXSR      PDFINV
     c                   else
     C                   EXSR      ARKIVS
     C                   GOTO      SLHENT
     C                   end
     C                   end
      *
      *
N14  C  N98WSNR          IFEQ      '9'
N14  C                   MOVE      *ZEROS        UUUKUN
N14  C     FAAGRN        IFEQ      *ZEROS
N14  C     FASK          IFEQ      'K'
N14  C                   MOVE      HEKNKF        UUUKUN
N14  C                   ELSE
N14  C     FASK          IFEQ      'S'
N14  C                   MOVE      HEKNSF        UUUKUN
N14  C                   ELSE
N14  C     FASK          IFEQ      'X'
N14  C                   MOVE      FAKUNR        UUUKUN
N14  C                   ELSE
N14  C                   GOTO      TAG09
N14  C                   END
N14  C                   END
N14  C                   END
N14  C                   END
N14   *
N14   *
N14  C                   Z-ADD     1             UFLAGG
N14  C                   CALL      'SYPO09CL2'
N14  C                   PARM                    FAAGRN
N14  C                   PARM                    UUUKUN            8 0
N14  C                   PARM                    UFLAGG
N14  C     TAG09         TAG
N14  C                   MOVE      ' '           WSNR
N14  C                   UPDATE    SUBFIL
N14  C                   GOTO      SLHENT
N14  C                   END
      *
     C  N98WSNR          IFEQ      'F'
     C                   MOVE      FALI          ULI               5 0
     C                   CALL      'SYFI12'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    ULI
     C                   PARM      '1'           UIN27             1
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   END
     C   12              GOTO      SLHENT
     C                   END
     C*
     C     SLHENT        TAG
     C                   ADD       7             LINNBR
     C                   Z-ADD     2             POSNBR
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     VFRB          BEGSR
     C***********************************************
     C* BILL OF LADING
     C*
     C     HEUR          IFEQ      'B'
     C*
     C* CMR
     C*
     C                   Z-ADD     9             UFLAGG
     C     FILAND        IFEQ      *BLANKS
     C     FILAND        OREQ      'NO'
     C                   CALL      'SYEX10B'
     C                   PARM                    UFIRM
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    XMSG
     C                   PARM                    UFLAGG
     C                   ELSE
     C                   CALL      'SYEX10E'
     C                   PARM                    UFIRM
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    XMSG
     C                   PARM                    UFLAGG
     C                   END
     C*
     C* EXPORT TRUCK BILL OF LADING
     C*
     C     UFLAGG        IFEQ      0
     C                   Z-ADD     9             UFLAGG
     C                   CALL      'SYEX10A'
     C                   PARM                    UFIRM
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    XMSG
     C                   PARM                    UFLAGG
     C                   END
     C*
     C* EXPORT TRUCK STYKKGODSFRAKTBREV
     C*
     C     UFLAGG        IFEQ      0
     C                   CALL      'SYFM21C'
     C                   PARM                    UFIRM
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR             3 0
     C                   PARM                    UFLAGG
     C                   END
     C*
     C* ORDINARY WAYBILL
     C*
     C                   ELSE
     C                   CALL      'SYFM21C'
     C                   PARM                    UFIRM
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR             3 0
     C                   PARM                    UFLAGG
     C                   END
     C*
     C     UFLAGG        IFEQ      0
     C                   MOVE      'DIV0126'     MSGNR
     C                   SETON                                        30
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     SAD           BEGSR
     C***********************************************
     C* ASKED FOR DECLARATION
     C                   CALL      'SAD005A'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFLAGG
     C     UFLAGG        IFEQ      0
     C                   CALL      'SAD023A'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFLAGG
     C                   END
     C* HVEN RETURN TEST IF NOT FOUND DECLARATION
     C     UFLAGG        IFEQ      0
     C                   MOVE      'SPD0015'     MSGNR
     C                   SETON                                        30
     C                   END
     C                   ENDSR
      ***********************************************
     C     LAGER         BEGSR
      ***********************************************
     C                   MOVE      UAVD          UAVDLF            4
     C                   MOVE      UOPD          UOPDLF            7
     C                   Z-ADD     1             UFLGLF            1 0
     C                   CALL      'LL052C'
     C                   PARM                    UAVDLF
     C                   PARM                    UOPDLF
     C                   PARM                    UFLGLF
     C                   ENDSR
     C***********************************************
     C     REKV          BEGSR
     C***********************************************
     C* F11 = LOOK AT REQUISITIONS./BUDGETED COSTS
     C                   MOVE      'O'           P1FLAG
     C                   MOVE      *ZEROS        P1BNR
     C                   MOVE      *ZEROS        P1AVD
     C                   MOVE      *ZEROS        P1TUNR
     C                   MOVE      UAVD          P1OAVD
     C                   MOVE      UOPD          P1OPD
     C                   MOVE      *ZEROS        P1BL
     C                   MOVE      P1DS          PARM1           256
     C                   CALL      'SYKS12'
     C                   PARM                    PARM1
     C                   ENDSR
     C***********************************************
     C     VTFRB         BEGSR
     C***********************************************
     C*
     C                   CALL      'SYFM21C'
     C                   PARM                    UFIRM
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR             3 0
     C                   PARM                    UFLAGG
     C     UFLAGG        IFEQ      0
     C                   MOVE      'DIV0127'     MSGNR
     C                   SETON                                        30
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     VFFRBI        BEGSR
     C***********************************************
     C*
     C                   CALL      'SYFM21D'
     C                   PARM                    UFIRM
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFLAGG
     C     UFLAGG        IFEQ      0
     C                   MOVE      'DIV0128'     MSGNR
     C                   SETON                                        30
     C                   END
     C*
     C*
     C     SLVFFI        ENDSR
     C*
     C***********************************************
     C     VFFRBE        BEGSR
     C***********************************************
     C                   Z-ADD     1             UFLAGG
     C                   Z-ADD     1             UULOPE            3 0
     C                   CALL      'SYEF10B'
     C                   PARM                    UFIRM
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UULOPE
     C                   PARM                    XSTLF            15
     C                   PARM                    XKTLF            15
     C                   PARM                    XANRUT            1
     C                   PARM                    XFLYTM            1
     C                   PARM                    HØ
     C                   PARM                    LE
     C                   PARM                    BR
     C                   PARM                    AN
     C                   PARM                    XMSG             62
     C                   PARM                    UFLAGG
     C     UFLAGG        IFEQ      0
     C                   MOVE      'DIV0129'     MSGNR
     C                   SETON                                        30
     C                   END
     C*
     C*
     C     UFLAGG        IFEQ      1
     C                   Z-ADD     6             UFLAGG
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     TESTFL        BEGSR
     C***********************************************
     C     UFLAGG        COMP      1                                      01
     C     UFLAGG        COMP      2                                      02
     C     UFLAGG        COMP      3                                      03
     C     UFLAGG        COMP      9                                      12
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     MOVWS         BEGSR
     C***********************************************
     C* CALCULATE GRAND TOTAL  (SHOWN ONLY IF MORE THAN ONE "FAFAKT")
     C  N51FAFAKT        COMP      FIRST                              5151
     C     FAKDA         IFNE      'D'
     C     FAOPKO        ANDNE     'D'
     C     FASK          ANDNE     'A'
     C     FASK          ANDNE     'E'
     C     FAKDA         IFEQ      'K'
     C                   ADD       FABELN        WSGRAN
     C                   ELSE
     C     FASK          IFNE      'F'                                           IKKE INNTEK
     C                   ADD       FABELN        WSGRAN                          MOT F=FLYSE
     C                   END
     C                   END
     C                   END
     C*
     C* SHOW TAX-LINE IFNE *ZEROS
     C*
     C     FAFAKT        IFNE      FORIGE
     C     FASK          ORNE      FORISK
     C                   EXSR      TOTLIN
     C                   END
     C*
     C*
     C     FACD11        IFNE      *BLANKS
     C     FACD11        CHAIN     KODSAM                             33
     C  N33              MOVEL     SANORS        WSVT
     C                   MOVE      '* '          WSVT
     C                   MOVE      FACD11        WSVT
     C                   ELSE
     C     FAVT          IFEQ      *BLANKS
     C     KODGEK        CHAIN     KODTGE                             33
     C  N33              MOVE      KGENOT        WSVT
     C                   ELSE
     C                   MOVE      FAVT          WSVT
     C                   END
     C                   END
     C                   SETOFF                                       54
     C     FAKDA         IFEQ      'D'
     C                   MOVE      *BLANKS       WSVT
     C                   MOVEL     '*SLETTET'    WSVT
     C                   SETON                                        54
     C                   END
     C                   SETON                                        33
     C*
     C     FASK          IFEQ      'S'
n03  C     faopko        ifle      'C'
     C     HEVALS        COMP      FICURR                                 33
n03  c                   else
n03  C     FACURI        COMP      FICURR                                 33
n03  c                   end
     C                   ELSE
     C     FASK          IFEQ      'K'
n03  C     faopko        ifle      'C'
     C     HEVALK        COMP      FICURR                                 33
n03  c                   else
n03  C     FACURI        COMP      FICURR                                 33
n03  c                   end
     C                   ELSE
     C     FASK          IFEQ      'X'
     C     FACURI        COMP      FICURR                                 33
     C                   END
     C                   END
     C                   END
     C     FACURI        IFEQ      FICURR
     C     FACURI        ANDNE     *BLANKS
     C                   SETON                                        33
     C                   END
     C     FAKDA         IFEQ      'K'
     C                   SETOFF                                       33
     C                   END
     C*
     C* MOVES AMOUNTH TO SCREEN
     C*
     C                   Z-ADD     FABELN        WSBELN
     C  N33              Z-ADD     FABELV        WSBELV
     C   33              Z-ADD     FABELN        WSBELV
     C                   ADD       FABELN        WSTOTN
     C  N33              ADD       FABELV        WSTOTV
     C   33              ADD       FABELN        WSTOTV
     C*
     C* CALCULATES TAX
     C*
     C     FAKDM         IFNE      'N'
     C                   ADD       FABELN        WSTAXN
     C  N33              ADD       FABELV        WSTAXV
     C   33              ADD       FABELN        WSTAXV
     C                   END
      * FLYTTER FAKTURERT VALUTAKODE
     C                   MOVE      FAVAL         WSVAL
     C   33              MOVE      FICURR        WSVAL
     C     FAVAL         IFNE      FACURI
     C     FACURI        ANDNE     *BLANKS
     C                   MOVE      FACURI        WSVAL
     C                   END
     C*
     C     WSVAL         COMP      FAVAL                              6666
n13  C                   MOVE      FAKUNR        WSKUNR
n13  C                   MOVE      FAJOUR        WSJOUR
n13  C                   MOVE      FAACCN        WSACCN
n13  C                   MOVE      FAÅR          WSÅR
n13  C                   MOVE      FAMND         WSMND
     C                   ENDSR
     C*
     C***********************************************
     C     TOTLIN        BEGSR
     C***********************************************
     C* SHOWS TOTALLINE PR. INVOICE
     C*
     C                   SETOFF                                       66
     C                   MOVE      ' '           LASTRE            1
     C   94              MOVE      'J'           LASTRE
     C                   SETOFF                                       94
     C                   SETON                                        50
     C                   MOVE      FITAX         FITAXN
     C     WSTAXN        IFNE      *ZEROS
     C     FITAXD        IFNE      *ZEROS
     C     FITAX2        ANDNE     *ZEROS
     C     FADAMO        ANDLT     FITAXD
     C     FADAMO        ANDNE     *ZEROS
     C                   MOVE      FITAX2        FITAXN
     C                   END
     C*
     C* finn momskode her
     C*
     C                   Z-ADD     WSMVTN        WSBELN
     C                   Z-ADD     WSMVTV        WSBELV
     C   33              Z-ADD     WSMVTN        WSBELV
     C                   Z-ADD     0             WSMVTN
     C                   Z-ADD     0             WSMVTV
     C                   ADD       WSBELN        WSTOTN
     C                   ADD       WSBELV        WSTOTV
     C                   MOVE      *BLANKS       WSVT
N17  C                   EVAL      WSVT=XTXT1
     c                             + %TRIM(%EDITC(WSMVGN:'3'))
N17  c                   move      *zeros        WSMVGN           11 2
     C*                    MOVEL'* TAX *' WSVT
     C     LASTRE        IFEQ      'J'
     C                   ADD       1             ZRECNO
     C                   END
     C     WSBELN        COMP      *ZEROS                               49
     C     OPDPER        IFNE      *ZEROS
     C     FAKPER        ANDNE     *ZEROS
     C     OPDPER        COMP      FAKPER                             5656
     C                   END
     C                   WRITE     SUBFIL
     C     LASTRE        IFNE      'J'
     C                   ADD       1             ZRECNO
     C                   END
     C                   END
     C*
     C* SHOWS TOTALLINE IFNE *ZEROS
     C*
     C     WSTOTN        IFNE      *ZEROS
     C                   MOVE      WSTOTN        WSBELN
     C                   MOVE      WSTOTV        WSBELV
     C                   MOVE      *BLANKS       WSVT
     C                   MOVEL     XTXT2         WSVT
     C                   MOVE      FADAGM        FADAOL
     C                   MOVE      FADAG1        FADAO3
     C                   MOVE      FADAG3        FADAO1
     C                   EXSR      KDTFM3
s11  C*                  MOVE      FADAOL        WSVT
s12  C*                  MOVE      FAFAKT        WSVT
n12  C                   MOVE      FORIGE        WSVT
n13  C                   MOVE      FAKUGM        WSKUNR
n13  C                   MOVE      FAJOGM        WSJOUR
n13  C                   MOVE      FAACGM        WSACCN
n13  C                   MOVE      FAÅRGM        WSÅR
n13  C                   MOVE      FAMNGM        WSMND
     C                   EXSR      KDTFM3
     C     LASTRE        IFEQ      'J'
     C                   ADD       1             ZRECNO
     C                   END
     C     WSBELN        COMP      *ZEROS                               49
     C     OPDPER        IFNE      *ZEROS
     C     FAKPER        ANDNE     *ZEROS
     C     OPDPER        COMP      FAKPER                             5656
     C                   END
     C                   SETON                                        48
     C                   WRITE     SUBFIL
     C                   SETOFF                                       48
     C     LASTRE        IFNE      'J'
     C                   ADD       1             ZRECNO
     C                   END
     C                   END
     C                   Z-ADD     0             WSMVTN
     C                   Z-ADD     0             WSMVTV
     C                   MOVE      *ZEROS        WSTAXN           13 2
     C                   MOVE      *ZEROS        WSTOTN           13 2
     C                   MOVE      *ZEROS        WSTAXV           13 2
     C                   MOVE      *ZEROS        WSTOTV           13 2
     C                   MOVE      FAFAKT        FORIGE
     C                   MOVE      FASK          FORISK
     C                   MOVE      FADATO        FADAGM
     C                   MOVE      FADATO        FADAMO            8 0
N13  C                   MOVE      *ZEROS        wskunr            8 0
n13  C                   MOVE      *ZEROS        wsjour            7 0
n13  C                   MOVE      *ZEROS        wsaccn            5 0
n13  C                   MOVE      *ZEROS        wsÅr              2 0
n13  C                   MOVE      *ZEROS        WSMND             2 0
N13  C                   MOVE      FAKUNR        FAKUGM            8 0
n13  C                   MOVE      FAJOUR        FAJOGM            7 0
n13  C                   MOVE      FAACCN        FAACGM            5 0
n13  C                   MOVE      FAÅR          FAÅRGM            2 0
n13  C                   MOVE      FAMND         FAMNGM            2 0
     C                   SETOFF                                       50
     C     LASTRE        IFEQ      'J'
     C                   SETON                                        94
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     MOVDAT        BEGSR
     C***********************************************
     C                   MOVE      FADTD         WSDTD
     C                   MOVE      FADTM         WSDTM
     C                   MOVE      FADTÅ         WSDTÅ
     C                   MOVE      FADTDF        WSDTDF
     C                   MOVE      FADTMF        WSDTMF
     C                   MOVE      FADTÅF        WSDTÅF
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     MVA           BEGSR
     C***********************************************
     C* finn momskode her
     C                   MOVE      FITAX         FITAXN
     C     FITAXD        IFNE      *ZEROS
     C     FITAX2        ANDNE     *ZEROS
     C     FADAMO        ANDLT     FITAXD
     C     FADAMO        ANDNE     *ZEROS
     C                   MOVE      FITAX2        FITAXN
     C                   END
     C     KODWKY        CHAIN     KODWL01                            42
     C     *IN42         IFEQ      *OFF
     C     MVAAVI        DIV       100           FITAXN
     C                   ENDIF
     C     FABELN        MULT(H)   FITAXN        WSMVAN
     C     FABELV        MULT(H)   FITAXN        WSMVAV
     C                   ADD       WSMVAN        WSMVTN
     C                   ADD       WSMVAV        WSMVTV
N17  c                   add       fabeln        wsmvgn
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     HEADFK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     FAK2K         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     KODGEK        KLIST
     C                   KFLD                    XGEUNI
     C                   KFLD                    FAVK
     C     VALU1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    FAVAL
     C     KOSB9K        KLIST
     C                   KFLD                    YYST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   MOVE      ' '           YYST              1
N18  C     KOSB17K       KLIST
N18  C                   KFLD                    YYST
N18  C                   KFLD                    HEPRO
N18  C                   KFLD                    AVDNUL            4 0
N18  C                   KFLD                    OPDNUL            7 0
     C     KODWKY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WMVAKD
     C                   KFLD                    FAKDM
     C                   MOVE      *BLANKS       WMVAKD            2
     C     KONTKY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSKONT            5 0
     C     KUND1K        KLIST
     C                   KFLD                    FIFIRM
s07  C*                  KFLD                    FAKUNR
n07  C                   KFLD                    KUNR              8 0
n07  c                   move      heknkf        kunr
n07  c     kund1k        chain     cundl01                            33
n07  c  n33aknrku        ifne      *zeros
n07  c                   move      aknrku        kunr
n07  c     kund1k        chain     cundl01                            33
n07  c  n33              move      kundnr        heknka
n07  c  n33              move      knavn         henaka
n07  c                   end
     C*
n07  c                   move      heknsf        kunr
n07  c     kund1k        chain     cundl01                            33
n07  c  n33aknrku        ifne      *zeros
n07  c                   move      kundnr        kunr
n07  c     kund1k        chain     cundl01                            33
n07  c  n33              move      aknrku        heknsa
n07  c  n33              move      knavn         henasa
n07  c                   end
     C     *ENTRY        PLIST
     C                   PARM                    UFIRM             2
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD              7 0
     C                   PARM                    UFLAGG            1 0
     c     UOPD          ifeq      *Zeros
     c                   move      *on           *INLR
     c                   return
     c                   end
     C*
     C     *LIKE         DEFINE    WSBELN        WSMVAN
     C     *LIKE         DEFINE    WSBELV        WSMVAV
     C     *LIKE         DEFINE    WSMVAN        WSMVTN
     C     *LIKE         DEFINE    WSMVAV        WSMVTV
     C                   CALL      'SYFA29CA'
     C                   PARM                    UUSRID           10
     C     UUSRID        CHAIN     SIF                                33
     C  N33              MOVE      '1'           *IN35
      *
     C                   MOVE      'GE'          XGEUNI            2
     C                   MOVE      *ZEROS        FADAGM
     C                   Z-ADD     1             XFBNR             3 0
     C*
     C     UFIRM         CHAIN     FIRM                               33
     C     *LIKE         DEFINE    FITAX         FITAXN
     C                   MOVE      FITAX         FITAXN
     C     HEADFK        CHAIN     HEADF                              33
N09  c     *in33         ifeq      '1'
N09  C                   SETON                                        LR
N09  C                   RETURN
N09  c                   endif
      *
     C     OPDPER        COMP      OPDÅMD                             5555
      *
      * HENT EVT ÅPNE FORVENTEDE (BUDSJETTERTE) KOSTNADER
      *
     C                   MOVE      *ZEROS        WSESTI           13 2
N18  C                   MOVE      *ZEROS        WSESTIO          13 2
     C     KOSB9K        SETLL     KOSBU9
     C     KOSB9K        READE     KOSBU9                                 33
     C     *IN33         DOWEQ     '0'
     C* Omregn valuta
     C     BUVAL         IFNE      FICURR
     C                   MOVE      BUVAL         FAVAL
     C     VALU1K        CHAIN     VALUL01                            34
     C  N34VALKU1        DIV       OMRFAK        XFAK              9 6
     C  N34              MULT(H)   XFAK          BUBL
     C                   END
     C                   SUB       BUBL          WSESTI
n18  C                   SUB       BUBL          WSESTIO
     C     KOSB9K        READE     KOSBU9                                 33
     C                   END
N18   *
N18   * HENT EVT andel rene turkostnader BUDSJETTERTE
N18   *
N18  C                   MOVE      *ZEROS        ufordel          13
N18  C     KOSB17K       chain     KOSBU17                            33
N18  C     *in33         IFeq      '0'
N19  C     hepro         andne     0
n18  c                   move      hepro         uproa             8
n18  c                   move      uavd          uavda             4
n18  c                   move      uopd          uopda             7
N18  C                   CALL      'SYGE90B'
N18  c                   parm                    uproa             8
N18  C                   PARM                    UAVDa             4
N18  C                   PARM                    UOPDa             7
N18  c                   parm                    ufordel          13
n18  c                   move      ufordel       ufordelt         13 2
s20  C*                  SUB       ufordelt      WSESTI
s20  C*                  SUB       ufordelt      WSESTIT          13 2
n20  C                   ADD       ufordelt      WSESTI
n20  C                   add       ufordelt      WSESTIT          13 2
N18  C                   END
N18   *
     C*
     C                   MOVE      'DIV2017'     XMSGNR            7            MELDING-ID
     C                   Z-ADD     3             XLEVEL            1 0          NIVÅ
     C                   Z-ADD     0             XRETUR            1 0          RETURKODE
     C                   Z-ADD     7             XMSGL             4 0          LENGDE PÅ MELDING
     C                   EXSR      HENTMS
     C                   MOVEL     XMSGT         XTXT1             7
     C                   MOVE      'DIV2018'     XMSGNR
     C                   Z-ADD     3             XLEVEL
     C                   Z-ADD     0             XRETUR
     C                   Z-ADD     7             XMSGL
     C                   EXSR      HENTMS
     C                   MOVEL     XMSGT         XTXT2             7
     C*F24 BOTTOM TEXT
s11  C*                  MOVE      'DIV0029'     MSGLN8
n11  C                   MOVE      'DIV0000'     MSGLN12
N11  C                   Z-ADD     0             XCMD              1 0
     C*
     C                   EXSR      UTCMDL
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     HENTMS        BEGSR
     C***********************************************
     C                   CALL      'SUBR23R3'
     C                   PARM                    XMSGNR
     C                   PARM                    XMSGT           100
     C                   PARM                    XLEVEL
     C                   PARM                    XRETUR
     C                   PARM                    XMSGL
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFM1        BEGSR
     C***********************************************
     C                   MOVE      HEDTOD        UDT1              2 0
     C                   MOVE      HEDTOM        UDT2              2 0
     C                   MOVE      HEDTOÅ        UDT3              2 0
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WSDTOD
     C                   MOVE      UDT2          WSDTOM
     C                   MOVE      UDT3          WSDTOÅ
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFM2        BEGSR
     C***********************************************
     C                   MOVE      WSDTD         UDT1
     C                   MOVE      WSDTM         UDT2
     C                   MOVE      WSDTÅ         UDT3
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WSDTD
     C                   MOVE      UDT2          WSDTM
     C                   MOVE      UDT3          WSDTÅ
     C                   MOVE      WSDTDF        UDT1
     C                   MOVE      WSDTMF        UDT2
     C                   MOVE      WSDTÅF        UDT3
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WSDTDF
     C                   MOVE      UDT2          WSDTMF
     C                   MOVE      UDT3          WSDTÅF
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFM3        BEGSR
     C***********************************************
     C                   MOVE      FADAO1        UDT1
     C                   MOVE      FADAO2        UDT2
     C                   MOVE      FADAO3        UDT3
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          FADAO1
     C                   MOVE      UDT2          FADAO2
     C                   MOVE      UDT3          FADAO3
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     UTCMDL        BEGSR
     C***********************************************
N15  C                   MOVE      'DIV0029'     MSGLN12                        F24=Flere Ftaster
     C     XCMD          IFEQ      0
     C                   MOVE      'DIV0067'     MSGLN1
     C                   MOVE      'DIV0113'     MSGLN2
     C                   MOVE      'DIV0020'     MSGLN3
     C                   MOVE      'DIV0143'     MSGLN4
n10  C                   MOVE      'DIV0021'     MSGLN5
     C                   MOVE      'DIV0145'     MSGLN6
     C                   MOVE      'DIV0146'     MSGLN7
N11  C                   MOVE      'SHU1393'     MSGLN8
N11  C                   MOVE      'JOV0081'     MSGLN9
     C  N35              MOVE      'DIV4098'     MSGLN10
     C   35              MOVE      'DIV0000'     MSGLN10
     C                   MOVE      'SHU1692'     MSGLN11                        F8/F9=Track&Trace
N16  C                   ADD       1             XCMD              1 0
     C                   ELSE
N15  C     XCMD          IFEQ      1
     C                   MOVE      'DIV0000'     MSGLN1
     C                   MOVE      'DIV0000'     MSGLN2
     C                   MOVE      'DIV0000'     MSGLN3
     C                   MOVE      'DIV0000'     MSGLN4
     C                   MOVE      'DIV0000'     MSGLN5
     C                   MOVE      'DIV0000'     MSGLN6
     C                   MOVE      'DIV0000'     MSGLN7
     C                   MOVE      'DIV0000'     MSGLN8
     C                   MOVE      'DIV0000'     MSGLN9
     C                   MOVE      'DIV0000'     MSGLN10
     C                   MOVE      'DIV0000'     MSGLN11
N15  C                   Z-ADD     0             XCMD              1 0
N15  C                   END
     C                   END
     C                   ENDSR
     C*
      ***********************************************
     C     ARKIVS        BEGSR
      ***********************************************
     c     fafakt        chain     kosta14                            33
     c     *in33         ifeq      '0'
     c     arkkey        klist
     c                   kfld                    arstat
     c                   kfld                    arunde
     c                   move      'A'           arstat
     c                   movel     'KL:'         arunde
S06  c*                  move      fafakt        arunde
N06  C                   move      KABNR         arunde
     c     arkkey        chain     arkivl11                           33
     c                   end
     c     *in33         ifeq      '0'
     c                   exsr      pdfinv
     c                   else
     C                   Z-ADD     FAAVD         UAVD2             4 0
     C                   Z-ADD     FAOPD         UOPD2             7 0
     C                   MOVEL     *BLANKS       URUNDE           10
     C                   CALL      'ARC003'
     C                   PARM                    UAVD2
     C                   PARM                    UOPD2
     C                   PARM                    URUNDE
     C                   MOVE      ' '           WSNR
N01  C                   MOVE      ' '           FAKDA
     C                   UPDATE    SUBFIL
     c                   end
     C                   ENDSR
     C*
     C***********************************************
     C     PDFINV        BEGSR
     C***********************************************
     c                   MOVE      FAFAKT        AFAK              7
N04  c                   movel     facc          faccAA            4
S06  c*                  movel     faÅR          faccAA
N06  c                   move      faÅR          faccAA
     c                   CALL      'ARC014'
     c                   PARM                    fifirm
     c                   PARM                    afak
S06  c*                  PARM                    FAKKOS            1
N06  c                   PARM                    FAKDA
N04  c                   PARM                    FACCAA
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C*
     C                   ENDSR
     C*
N08   ***********************************************
N08  C     ARKIVSS       BEGSR
N08   ***********************************************
N08  C                   CALL      'ARC003'
N08  C                   PARM                    UAVD
N08  C                   PARM                    UOPD
N08  C                   PARM                    URUNDE           10
N08  C                   ENDSR
N08   ***********************************************
N15  C     TTSR          BEGSR
N15   ***********************************************
N15  C                   CALL      'SYTT01CL'
N15  C                   PARM                    UAVD
N15  C                   PARM                    UOPD
N15  C                   PARM                    UTUR              8 0
N15  C                   PARM                    TTFLAG            1 0
N15  C                   ENDSR
      *
