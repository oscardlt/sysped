     FKOSBU17   IF   E           K DISK
     FTURER14   IF   E           K DISK
     FHEAD11    IF   E           K DISK
     FFIRM      IF   E           K DISK
     FVALUL01   IF   E           K DISK
     D*
     C*
     C     VALU1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    TUTVAL
     C*
     C     *entry        plist
     c                   parm                    uavd              4 0
     c                   parm                    uopd              7 0
     c                   parm                    uturnr            8 0
     c                   parm                    uvekt             9 0
     c                   parm                    uesti            13 2
     c                   parm                    uucur             3
     c                   move      *zeros        uesti
      *
     c     keybut        klist
     C                   KFLD                    YYST              1
     c                   kfld                    hepro
     c                   kfld                    avdk              4 0
     c                   kfld                    opdk              7 0
      *
      *
     c     turkey        klist
     c                   kfld                    hepro
      *
     c                   move      uturnr        hepro
     c                   move      uavd          avdK
     c                   move      uopd          opdK
     c
      *
     c                   read      firm                                   33
     c
      *
     C     turkey        CHAIN     TURER14                            33
      *
     c                   move      tutval        uucur
      *
      *  går i løkke finner totalvekt tur
      *
     c                   exsr      det
      * omregner til NOK
      *
     C     totfbv        ifgt      *ZEROS
     C     TUAVRE        ANDNE     'X'
      *trekk fra egen vekt på ordre
      *
     C     TUTBEL        MULT      uvekt         WORK             15 4
     C     WORK          DIV       totfbv        WORK
      * annen valuta
     C     TUTVAL        IFNE      FICURR
     c                   exsr      valuta
     C                   END
      *
     C                   z-add     WORK          UESTI
     C                   END
      *
      * finn budsjett tur
      *
     c                   exsr      budsr
      *
     c                   seton                                        lr
     c                   return
      *
      *********************************************************************
     C     det           begsr
      *********************************************************************
     c                   setoff                                       33
     C     turkey        setll     head11
     C     *IN33         doweq     '0'
     C     turkey        reade     head11                                 33
     c  N33              add       hefbv         totfbv            9 0
     c                   end
     c                   endsr
      *
      *
      *********************************************************************
     C     valuta        begsr
      *********************************************************************
     C     VALU1K        CHAIN     VALUL01                            34
     C  N34VALKU1        DIV       OMRFAK        XFAK              9 6
     C  N34              MULT(H)   XFAK          WORK
     c                   endsr
      *
      *********************************************************************
     C     budsr         begsr
      *********************************************************************
     c                   setoff                                       33
     C     keybut        setll     kosbu17
     C     *IN33         doweq     '0'
     C     keybut        reade     kosbu17                                33
     C* Omregn valuta
     c     *in33         ifeq      '0'
     C     BUVAL         IFNE      FICURR
     C                   MOVE      BUVAL         TUTVAL
     C     VALU1K        CHAIN     VALUL01                            34
     C  N34VALKU1        DIV       OMRFAK        XFAK              9 6
     C  N34              MULT(H)   XFAK          BUBL
     C                   END
     C*                  SUB       BUBL          WSBUD            11 0
     C                   add       BUBL          WSBUD            11 0
     c                   end
     c                   end
      *
      * slutt leseløkke
      *
      * fordeler hvis ren turkostnad.
      *
     c     uavd          ifeq      *zeros
     c     totfbv        andne     0
     C     WSBUD         MULT      uvekt         WORK             15 4
     C     WORK          DIV       totfbv        WORK
     C                   add       work          UESTI
     c                   else
     c                   add       wsbud         UESTI
     c                   end
     c                   endsr
      *
