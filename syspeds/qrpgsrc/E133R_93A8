      * OBS!! VIKTIG FORUTSETNING, KUNDENR OPPDR.GIVER SKAL LIGGE I ECMSG / ECCNO
HARD  * VIKTIGE HARDKODINGER ET MERKET MED HARD I 1-5
HARD  * HARDKODINGER - TERMINAL=1000  / DEFAULT AVD=1 / LAGDUP=N
      *****************************************************************
      * MOTTAK AV IFTMIN RETT INN TIL HEADF M.M FOR "OPTIMAL INNLAND" *
      * AVDELING STYRES AV MOTTAKERS POSTNR                           *
      * OBS!! HARDKODET OM EN VIL LAGE DUP(HENTING)   (SØK "LAGDUP")  *
      * OBS KUNDENR AVSENDER BØR LIGGE I ECMSG                        *
      *                (EDINMU3 PKT 5 "EDI-PARTERS STANDARDMELDINGER")*
      *****************************************************************
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 DERSOM POSTSTED MANGLER I NAD+CN/DP HENT FRA PONRN
10XXX * 02 JOV PTF10 e-sening som default / binde sammen mde frisok EDS..
10XXX * 03 JOV PTF10 Div ramberglogikk inntatt i standard
10172 * 04 SH  PTF10 norsk text til Track and trace
10172 * 05 SH  PTF10 ny parameter syge13
10172 * 06 JOV PTF10 Takle kOlli-ID med/uten AI 00 i front (før kun uten)
10172 * 07 JOV PTF10 HENTET TEKT UTLEV.FORBEHOLD
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * 08 JOV PTF11 clear av array A før kall på getnum
      * 09 JOV PTF11 EDS fri søkevei flyttet til slutt i RFF03 - ingen merking
      * 10 JOV PTF11 enkelte mottar fraktbrevsnr via AAM i frisok.. (andre via AAS)
********************************************************************
     H DATEDIT(*YMD)
     FEDIS      IF   E           K DISK
     FEDIM      IF   E           K DISK
     FEUNB      IF   E           K DISK
     FFIRM      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FVADR      IF   E           K DISK
     FECMSG2    IF   E           K DISK
     FEMOA93A   IF   E           K DISK
     FEMEA93A   IF   E           K DISK
     FECNT93A   IF   E           K DISK
     FEFTX93A   IF   E           K DISK
     FEGID93A   IF   E           K DISK
     FEPCI93A   IF   E           K DISK
     FENAD93A   IF   E           K DISK
     FERFF93A   IF   E           K DISK
N03  FEEQD93A   IF   E           K DISK
N03  FEEQN93A   IF   E           K DISK
N03  FETDT93A   IF   E           K DISK
N03  FETSR93A   IF   E           K DISK
     FFIRINL    IF   E           K DISK
     FKODTRI    IF   E           K DISK
     FNOPNR     IF   E           K DISK
     FKODTAG    IF   E           K DISK
     FSTED2D    IF   E           K DISK
     FTELL      UF   E           K DISK
     FHEAD39    IF   E           K DISK
     F                                     RENAME(HEADFR:HEAD39R)
     FKODTA     IF   E           K DISK
N07  FKODTU     IF   E           K DISK
N01  FPONRN     IF   E           K DISK
     FHEADF     O  A E             DISK
     FDISP      O  A E             DISK
     FHESTED    O  A E             DISK
     FFRISOK    O  A E             DISK
     FFREETXT   O  A E             DISK
     FFAKT      O  A E             DISK
     FDOK29     O  A E             DISK
     FDOKUFM    O  A E             DISK
     FTRACKF    O  A E             DISK
     D A               S              1    DIM(79)
     D B               S              1    DIM(18)
      *________________________
      * DS for decimal handling
      *""""""""""""""""""""""""
     D                 DS
     D  ZDEC                   1      7  6
     D  ZDEC6                  2      7
     D  ZHEL                  11     22  0
     D                 DS
     D  WMN2                   1      9  0
     D                 DS
     D  M1004                  1     35
     D  W1004A                 1     17
N03  D  W1004b                11     17
     D                 DS
     D  F4440A                 1     70
     D  F444A1                 1      8
     D  F444A2                31     55
N06   * takle både med / uten AI
N06  D                 DS
N06  D  CLID                   1     20
N06  D  CLID20                19     20
N06  D  CLIDB                  3     20
     D                 DS
     D  HXHEAD                 1    256
     D  XXUR                   1      1
     D  XXFR                   2      4
     D  XXKDPL                 5      5
     D  XXLKA                  6      7
     D  XXSDF                  8     12
     D  XXTRI                 13     14
     D  XXSDT                 15     19
     D  XXLKS                 20     21
     D  XXSDFF                22     26
     D  XXLKK                 27     28
     D  XXSDVT                29     33
     D  XXVKT                 34     42  0
     D  XXFBV                 43     51  0
     D  XXM3                  52     58  3
     D  XXLM                  59     62  2
     D  XXNT                  63     69  0
     D  XXVERV                70     72
     D  XXVERB                73     75  2
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
      * Track/Trace-tekster
     D TTXED1          C                   CONST('Incoming EDI prepar-
     D                                     ed from sender      ')
n04  D TTXED1L         C                   CONST('Inkommende EDI klar-
n04  D                                     gjort av avsender   ')
      *
     D TTXED2          C                   CONST('Incoming EDI reciev-
     D                                     ed                  ')
n04  D TTXED2L         C                   CONST('Inkommende EDI er -
n04  D                                     mottatt             ')
      *
     D TTXSTR          C                   CONST('Order entered (proc-
     D                                     essed from EDI-data)')
n04  D TTXSTRL         C                   CONST('Ordre opprettet (beha-
n04  D                                     ndlet fra EDI-data)')
      */////////////
      * MAIN LOGIC /
      */////////////
      *___________
      * Initiering
      *"""""""""""
     C                   EXSR      INIT
      *________
      * CONVERT
      *""""""""
     C                   EXSR      RTVD
      *
     C                   MOVE      '1'           *INLR
      *
      *
      *////////////////////////////////////////////////////////////
      * RETREIVE INFO FROM EDIFACT DATABASE TO SYSPED        RTVD /
      *////////////////////////////////////////////////////////////
     C     RTVD          BEGSR
      *__________________
      * INIT. DATAFELTER
      *""""""""""""""""""
N03  C     W1004b        IFne      *blanks
     C                   MOVEL     '401'         SNDN20           20
     C                   MOVE      W1004A        SNDN20
N03  c                   else
N03  C                   MOVEL     W1004A        SNDN20
N03  c                   end
     c
      * FINNES SENDINGEN ALLEREDE...
     C     Sndn20        chain     Head39                             33
     C     *IN33         CABEQ     '0'           NXTFBR
      *
      * Skal DUP-OPPDRAG (Henteoppdrag)lages?   Foreløpig hardkodet ...
      * med tiden styring via kode i "ett eller annet" edi-segment???
     C                   MOVE      'N'           LAGDUP            1
      *
     C                   CLEAR                   HEADFR
      * INNTIL VIDERE - SKRIV FRAKTBREV VED EDI-MOTTATTE OPPDRAG.
     C                   MOVE      'J'           HEPK1
      * Edi-kode... (K=Kundeløsning, I=InternEDI, E=Ekstern EDI)
     C                   MOVE      'E'           HXEDIK
     C                   MOVE      'H'           HEUR
     C                   MOVEL     SNDN20        HXSNDN
     C                   MOVEL     'S  '         HEFR
     C                   MOVEL     'NOK'         TRFRAV
     C                   MOVE      'EDI'         HESG
     C                   MOVE      'HO'          TRSLAG
      * HARDKODET AVSENDER = OPPDRAGSGIVER = HENTEADRESSE
     C                   MOVEL     'S'           TRKDAK
      *HENTE KUNDENR FRA ECMSG...
      *(dette BURDE kanskje kunne hentes fra NAD+CZ, men da er en avhengig av at
      * motparten gjør en riktig jobb - ved å hente fra ECMSG har en kontrollen i egen ende)
     C     ECMKEY        KLIST
     C                   KFLD                    M0004                          AVSENDER
     C                   KFLD                    M0010                          MOTTAKER
     C                   KFLD                    MSR                            R
     C                   KFLD                    M0065                          IFTMIN
     C     ECMKEY        CHAIN     ECMSG2                             33
     C     *IN33         IFEQ      '0'
     C     ECCNO         ANDNE     *ZEROS
     C                   Z-ADD     ECCNO         TRKNFA                         KNR OPD.GIV
     C                   Z-ADD     ECCNO         KUNDNR
     C     KUNKEY        CHAIN     CUNDL01                            33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     KNAVN         HENAA                          NAVN OPD.GIV
     C     VADRKE        CHAIN     VADR                               33
     C     *IN33         IFEQ      '0'
     C                   MOVE      VADRNA        HENAS
     C                   MOVE      VADRN1        HEADS1
     C                   MOVE      VADRN3        HEADS3
     C                   ELSE
     C                   MOVEL     KNAVN         HENAS
     C                   MOVEL     ADR1          HEADS1
     C                   MOVEL     POSTNR        HEADS3
     C                   MOVE      ADR3          HEADS3
     C                   END
     C                   END
     C                   END
     C                   MOVE      TRKNFA        HEKNSF
     C                   MOVEL     'X'           HEKDFK
     C                   MOVEL     'S'           TRKDFF
     C                   MOVEL     'NO'          HELKA
     C                   MOVEL     HEADS3        HESDF
     C                   MOVEL     'NO'          HETRI
     C                   MOVE      MDT           HEDTOP
     C                   MOVE      MDT           HEDTR
     C                   MOVE      MDT           TRSDFD
     C                   MOVE      MDT           TRSDTD
      *
      *
      *
     C                   MOVE      '0'           *IN51
      *__________________
      * READ ALL SEGMENTS
      *""""""""""""""""""
     C                   Z-ADD     CREP0         ZREPB0
NXX  C                   EXSR      TSR00
     C                   EXSR      NAD10
N03  C                   EXSR      TDT08
     C                   EXSR      RFF03
S03  C**                 EXSR      MOA00
     C                   EXSR      FTX00
SXX  C*                  EXSR      TSR00
     C                   EXSR      CNT00
     C                   EXSR      MEA19
     C                   EXSR      GID16
N03  C                   EXSR      EQD34
      *
      * AUTOPRISE HOVED-OPPDRAGET
     C     TRFRAK        IFNE      'E'                                          (MOA->ESTIMERT)
     C                   EXSR      BERFRP
     C                   MOVEL     ' '           TRFRAK
     C                   MOVE      *ZEROS        TRFRAB
     C                   MOVE      'J'           TRMVA
NXX  C     SYLAND        IFNE      '  '
NXX  C     SYLAND        ANDNE     'NO'
NXX  C                   MOVE      'N'           TRMVA
NXX  C                   END
     C     UUBELØ        IFNE      *ZEROS
     C                   MOVEL     'M'           TRFRAK
     C                   Z-ADD     UUBELØ        TRFRAB
     C                   END
     C                   END
      *
      *__________________
      * LAGE HENTE-DUP???
      *""""""""""""""""""
     C     LAGDUP        IFEQ      'J'
      * NOEN ENDRINGER ALT PÅ HOVEDOPPDRAGET
      * Innhenting! Indiker at VIA på fraside (DUP) ER utført
     C                   MOVE      'O'           TRSTAF
     C                   MOVEL     'NO'          HELKS
     C                   MOVEL     XXTERM        HESDFF
     C                   MOVE      HEDTOP        TRSFFD
      * Hoved-oppd må referere til Duppens avd/opd (nedadgående ref)
     C                   Z-ADD     RIAVDH        TRAVD1
     C     TRAVD1        IFEQ      *ZEROS
HARD C                   Z-ADD     1             TRAVD1
     C                   END
     C                   MOVE      *ZEROS        TROPD1
     C     TRAVD1        CHAIN     TELL                               33
     C   33AVDZER        CHAIN     TELL                               33
     C                   MOVE      TEOPDN        TROPD1
     C                   ADD       1             TEOPDN
     C                   UPDATE    TELLR
     C                   END
      * sett frakttillegg
     C                   exsr      GETFRT
      *
      *________________
      * WRITE TO SYSPED
      *""""""""""""""""
     C                   WRITE     HEADFR
      *
     C                   CLEAR                   DISPR
     C                   CLEAR                   HESTEDR
      *
     C                   MOVE      HEOPD         DIOPD
     C                   MOVE      HEAVD         DIAVD
     C                   MOVE      HEOT          DIOT
     C                   MOVE      HESG          DISIGN
     C                   MOVE      HESDF         DISTEF
     C                   MOVE      TRSDFD        DIDATF
     C                   MOVE      HESDT         DISTET
     C                   MOVE      TRSDTD        DIDATT
s02  C*                  MOVE      ' '           DISTA1
N02  C                   MOVE      'E'           DISTA1
     C                   MOVE      *BLANKS       XDSONF            5             (D=DUP=FF)
     C                   MOVE      HESDF         YYSTED
     C     STEDKE        CHAIN     STED2D                             35
     C  N35              MOVEL     ST2NVN        HSFROM
     C                   MOVEL     'NO'          DISONF
     C  N35              MOVE      ST2SOL        DISONF
     C  N35              MOVEL     ST2LK         XDSONF
     C  N35              MOVE      ST2SOL        XDSONF
     C     HESDFF        IFNE      *BLANKS
      * Hovedfraktens start-pkt skal inn i DISP-sone
     C                   MOVE      HESDFF        DISTEF
     C                   MOVE      HESDFF        YYSTED
     C     STEDKE        CHAIN     STED2D                             35
     C  N35              MOVEL     ST2NVN        HSVIA1
     C  N35              MOVEL     ST2LK         DISONF
     C  N35              MOVE      ST2SOL        DISONF
     C                   END
     C                   MOVE      HESDT         YYSTED
     C     STEDKE        CHAIN     STED2D                             35
     C  N35              MOVEL     ST2NVN        HSTO
     C                   MOVEL     'NO'          DISONT
     C  N35              MOVE      ST2SOL        DISONT
     C                   WRITE     DISPR
      *
     C                   MOVE      HEAVD         HSAVD
     C                   MOVE      HEOPD         HSOPD
     C                   WRITE     HESTEDR
      *
      * GÅR DEN UT VIA AGENT??
     C     TRTSTA        IFEQ      'J'
     C                   MOVE      '0'           XXFLAG            1
     C                   MOVE      'VF'          XXVIA             2
     C                   CALL      'SYTR33C'
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    XXVIA
     C                   PARM                    XXFLAG
     C                   END
      *
     C     FIURBL        IFEQ      'J'
     C                   EXSR      TTSR
     C                   END
      *
      * SKAL DET SKAPES HENTE-OPPDRAGS-DUP??
     C     TROPD1        IFNE      *ZEROS
     C                   EXSR      LAGFF
     C                   END
      *
     C     NXTFBR        TAG
     C                   ENDSR
     C***********************************************
     C     LAGFF         BEGSR
     C***********************************************
      * KUNDE FOR DUPFRAKT
     C                   MOVE      *ZEROS        DUPKNR            8 0
     C                   MOVE      TRAVD1        YYAVD
     C     KODTAK        CHAIN     KODTA                              33
     C  N33              MOVE      KOAKNR        DUPKNR
      * INNHENTINGS DUP-OPPDRAGET, ENDRE VISSE DATA
     C                   MOVE      ' '           TRSTAE
     C                   MOVE      *ZEROS        HEKNA                           AGENT
      * VIA-data fra hovedoppdraget blankes - Tilsted=terminal
     C*DUP-OPPDRAGET FÅR ALLTID PREFIX 402 FOR Å SKILLES FRA HOVED.OPPD
     C                   MOVEL     '402'         HERFK
     C                   MOVE      *ZEROS        HXPALL
     C     HEVKT         IFLE      IFOTVG
     C                   MOVEL     IFOTFF        HEOT
     C                   ELSE
     C                   MOVEL     IFO2FF        HEOT
     C                   END
     C                   MOVE      IFFRFF        HEFR
     C                   MOVE      *ZEROS        HEKNKF
     C                   MOVEL     'X'           HEKDFK
     C                   MOVEL     ' '           HEKDFS
     C                   MOVEL     'S'           TRKDFF
     C                   MOVE      DUPKNR        HEKNSF
     C                   MOVE      DUPKNR        KUNDNR
     C     KUNKEY        CHAIN     CUNDL01                            33
     C  N33              MOVE      KNAVN         HENASF
      *
     C                   MOVE      *BLANKS       TRSTAF
     C                   MOVE      *BLANKS       HELKS
     C                   MOVE      *BLANKS       HESDFF
     C                   MOVE      *ZEROS        TRSFFD
     C                   MOVEL     'NO'          HETRI
     C                   MOVE      *BLANKS       HESDT
     C                   MOVEL     XXTERM        HESDT
     C                   MOVEL     'FF'          TRSLAG
      * REF TIL OVERORNET OPPDRAG...
     C                   MOVE      HEAVD         TRAVD0
     C                   MOVE      HEOPD         TROPD0
      * DUP.OPPDRAGETS AVD/OOPDR.NR
     C                   MOVE      TRAVD1        HEAVD
     C                   MOVE      TROPD1        HEOPD
     C                   MOVE      *ZEROS        TRAVD1
     C                   MOVE      *ZEROS        TROPD1
     C                   MOVE      *ZEROS        TRAVD2
     C                   MOVE      *ZEROS        TROPD2
      * AUTOPRISE DUP-OPPDRAGET
     C                   EXSR      BERFRP
     C                   MOVEL     ' '           TRFRAK
     C                   MOVE      *ZEROS        TRFRAB
     C                   MOVE      'N'           TRMVA
     C     UUBELØ        IFNE      *ZEROS
     C                   MOVEL     'M'           TRFRAK
     C                   Z-ADD     UUBELØ        TRFRAB
     C                   END
     C                   MOVE      'N'           HEPK1
     C                   WRITE     HEADFR
      *
      * Faktura-post
     C     TRFRAB        IFNE      *ZEROS
     C                   CLEAR                   FAKTR
     C                   MOVE      *ZEROS        FALI
     C                   MOVE      HEAVD         FAAVD
     C                   MOVE      HEOPD         FAOPD
     C                   Z-ADD     TRFRAB        FABELV
     C                   Z-ADD     TRFRAB        FABELN
     C                   MOVE      'FRA'         FAVK
     C                   MOVE      FICURR        FAVAL
     C                   MOVE      TRMVA         FAKDM
     C                   MOVE      'M'           FAKDA
     C                   Z-ADD     TRAVD0        FAAVDR                          *DUP AV..
     C                   MOVE      HEKNSF        FAKUNR
     C                   MOVE      'I'           FASK
     C                   WRITE     FAKTR
     C                   END
      *
      * Stedsnavn i egen fil
     C                   CLEAR                   HESTEDR
     C                   MOVE      HEAVD         HSAVD
     C                   MOVE      HEOPD         HSOPD
     C                   MOVEL     HSVIA1        HSTO
     C                   MOVE      *BLANKS       HSVIA1
     C                   WRITE     HESTEDR
      *
     C                   CLEAR                   DISPR
     C                   MOVE      HEOPD         DIOPD
     C                   MOVE      HEAVD         DIAVD
     C                   MOVE      HEOT          DIOT
     C                   MOVE      HESG          DISIGN
     C                   MOVE      HESDF         DISTEF
     C                   MOVE      TRSDFD        DIDATF
     C                   MOVE      TRSDFK        DITIMF
     C                   MOVE      HESDT         DISTET
     C                   MOVE      TRSDTD        DIDATT
     C                   MOVE      TRSDTK        DITIMT
     C                   MOVE      XDSONF        DISONF
     C                   MOVE      ' '           DISTA1
      *
     C                   WRITE     DISPR
      *
     C     FIURBL        IFEQ      'J'
     C                   EXSR      TTSR
     C                   END
      *
     C                   ENDSR
      *
     C******************************************
     C     BERFRP        BEGSR
     C******************************************
     C* POSTNUMMERBASERT KALKULASJON
     C                   MOVE      'H'           XXUR
     C                   MOVE      'NO'          XXLKA
     C                   MOVE      'NO'          XXTRI
     C                   MOVE      *BLANKS       XXLKS
     C                   MOVE      *BLANKS       XXSDFF
     C                   MOVE      *BLANKS       XXLKK
     C                   MOVE      *BLANKS       XXSDVT
     C                   MOVE      *BLANKS       XXVERV
     C                   MOVE      *ZEROS        XXVERB
     C                   MOVE      *ZEROS        N5                5 0
     C                   MOVE      *ZEROS        NOPD              7 0
     C                   MOVE      ' '           USKA              1
     C                   Z-ADD     HEKNSF        UUKN              8 0
      * Finn frakt i kundersfraktavtale
     C                   MOVE      *BLANKS       UUVAL             3
     C                   MOVE      'FRA'         UGEB              3
     C                   MOVE      'FRA'         UGEBKO            3
     C                   MOVE      *ZEROS        UUBELØ           13 2
     C                   MOVE      HXHEAD        UHEAD           256
     C                   CALL      'SYGE14'
     C                   PARM                    UGEBKO
     C                   PARM                    UGEB
     C                   PARM                    UAVD              4 0
     C                   PARM                    NOPD
     C                   PARM                    UUKN
     C                   PARM                    UUVAL
     C                   PARM                    UUBELØ
     C                   PARM                    UAVNR             9 0
     C                   PARM                    UAVMSG           50
     C                   PARM                    USKA
     C                   PARM                    UHEAD
      * BRUTTO
     C     UUBELØ        IFEQ      0
     C                   MOVE      *BLANKS       USONE
     C                   MOVE      *BLANKS       UUVAL
     C                   MOVE      *ZEROS        URABAT
     C                   MOVE      HXHEAD        UHEAD           256
     C                   CALL      'SYGE13'
     C                   PARM                    UGEB
     C                   PARM                    UAVD
     C                   PARM                    NOPD
     C                   PARM                    UUVAL
     C                   PARM                    UUBELØ
     C                   PARM                    USONE             5
     C                   PARM                    URABAT            5 2
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    UUKN
     C                   PARM                    UHEAD
n05  C                   PARM                    ATDUM             1
     C                   END
     C                   ENDSR
     C*
      *////////////////////////////////////////////////////////////
      * MOA00                                               MOA00 /
      *////////////////////////////////////////////////////////////
     C     MOA00         BEGSR
     C                   CLEAR                   FAKTR
     C                   MOVE      *ZEROS        XXLI              5 0
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     0             ZGN1
     C     KEYMS0        SETLL     EMOA93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     EMOA93A                                52
     C     *IN52         DOWEQ     '0'
      * '209' = AGENT COMMISSION AMOUNT
     C                   SELECT
     C     M5025         WHENEQ    '209'
N08  C                   CLEAR                   A
     C                   MOVEA     M5004         A
     C                   EXSR      GETNUM
      * INGEN FAKTURERING, MEN AVREGN-OMSETNING
     C                   Z-ADD     XXLI          FALI
     C                   MOVE      'E'           FASK
     C                   MOVE      'FRA'         FAVK
     C                   MOVE      HEAVD         FAAVDR
     C                   MOVE      HEAVD         FAAVD
     C                   MOVE      HEOPD         FAOPD
     C                   MOVE      'NOK'         FAVAL
     C                   MOVE      'N'           FAKDM
     C                   MOVE      'M'           FAKDA
     C                   Z-ADD     ZNUM          FABELN
     C                   Z-ADD     ZNUM          FABELV
     C                   Z-ADD     TRKNFA        FAKUNR
     C                   WRITE     FAKTR
     C                   ADD       1             XXLI
     C     FALI          IFEQ      0
     C                   MOVE      'N'           TRMVA
     C                   MOVE      'E'           TRFRAK
     C                   Z-ADD     FABELN        TRFRAB
     C                   END
     C     M5025         WHENEQ    'ZZ1'
N08  C                   CLEAR                   A
     C                   MOVEA     M5004         A
     C                   EXSR      GETNUM
      * INGEN FAKTURERING, MEN AVREGN-OMSETNING
     C                   Z-ADD     XXLI          FALI
     C                   MOVE      'E'           FASK
     C                   MOVE      'FRA'         FAVK
     C                   MOVE      HEAVD         FAAVDR
     C                   MOVE      HEAVD         FAAVD
     C                   MOVE      HEOPD         FAOPD
     C                   MOVEL     M6345         FAVAL
     C                   MOVE      'N'           FAKDM
     C                   MOVE      'M'           FAKDA
     C                   Z-ADD     ZNUM          FABELN
     C                   Z-ADD     ZNUM          FABELV
     C                   Z-ADD     TRKNFA        FAKUNR
     C                   WRITE     FAKTR
     C                   ADD       1             XXLI
     C     FALI          IFEQ      0
     C                   MOVE      'N'           TRMVA
     C                   MOVE      'E'           TRFRAK
     C                   Z-ADD     FABELN        TRFRAB
     C                   END
     C                   ENDSL
     C     KEYMS0        READE     EMOA93A                                52
     C                   ENDDO
      *
     C                   ENDIF
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * CNT00                                               CNT00 /
      *////////////////////////////////////////////////////////////
     C     CNT00         BEGSR
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     0             ZGN0
     C     KEYMS0        SETLL     ECNT93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ECNT93A                                51
     C     *IN51         DOWEQ     '0'
      *
N08  C                   CLEAR                   A
     C                   MOVEA     C6066         A
     C                   EXSR      GETNUM
     C                   SELECT
     C     C6069         WHENEQ    '7  '
     C                   Z-ADD     ZNUM          HEVKT
     C     HEVKT         IFLE      IFOTVG
     C                   MOVEL     IFOTHO        HEOT
     C                   ELSE
     C                   MOVEL     IFO2HO        HEOT
     C                   END
      *(DSV sender ikke CNT+11 - se GID rutine (teller antall kolli-IDs)
     C     C6069         WHENEQ    '11 '
     C                   Z-ADD     ZNUM          HENT
     C     C6069         WHENEQ    '15 '                                         DMQ
     C     C6411         IFEQ      'DMQ'
     C     ZNUM          DIV(H)    1000          HEM3
     C                   ELSE
     C                   Z-ADD     ZNUM          HEM3
     C                   END
     C     C6069         WHENEQ    'ZLM'
     C                   Z-ADD     ZNUM          HELM
     C                   ENDSL
      *
     C  N51KEYMS0        READE     ECNT93A                                51
     C  N51              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * MEA19                                               MEA19 /
      *////////////////////////////////////////////////////////////
     C     MEA19         BEGSR
     C     *LIKE         DEFINE    HEVKT         MEVKT
     C     *LIKE         DEFINE    HEM3          MEM3
     C     *LIKE         DEFINE    HELM          MELM
     C                   MOVE      *ZEROS        MEVKT
     C                   MOVE      *ZEROS        MEM3
     C                   MOVE      *ZEROS        MELM
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     19            ZGN0
     C     KEYMS0        SETLL     EMEA93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     EMEA93A                                51
     C     *IN51         DOWEQ     '0'
      *
N08  C                   CLEAR                   A
     C                   MOVEA     M6314         A
     C                   EXSR      GETNUM
     C                   IF        ((M6311 = 'WT') AND (M6313 = 'G'))
     C                   EVAL      MEVKT = MEVKT + ZNUM
     C                   END
     C                   IF        ((M6311 = 'VOL') AND (M6411 = 'MTQ'))
     C                   EVAL      MEM3 = MEM3 + ZNUM
     C                   END
     C                   IF        ((M6311 = 'VOL') AND (M6411 = 'DMQ'))
     C     ZNUM          DIV       1000          TMPM3             9 5
     C                   EVAL      MEM3 = MEM3 + tmpm3
     C                   END
     C                   IF        M6311 = 'LMT'
     C                   EVAL      MELM = MELM + ZNUM
     C                   END
      *
     C  N51KEYMS0        READE     EMEA93A                                51
     C  N51              ENDDO
     C                   ENDIF
      *
      * DERSOM 0 FRA CNT OPPDATER MED DET SOM FANTES I MEA
     C     HEVKT         IFEQ      *ZEROS
     C                   eval      HEVKT = MEVKT
     C                   end
     C     HEM3          IFEQ      *ZEROS
     C                   eval      HEM3  = MEM3
     C                   end
     C     HELM          IFEQ      *ZEROS
     C                   eval      HELM  = MELM
     C                   end
      *
     C                   ENDSR
N03   *////////////////////////////////////////////////////////////
N03   * TSR00                                               TSR00 /
N03   *////////////////////////////////////////////////////////////
N03  C     TSR00         BEGSR
N03   *
N03  C                   MOVE      *BLANKS       HENKOD            3
N03  C                   MOVE      '0'           *IN51
N03  C                   Z-ADD     0             ZGN0
N03  C     KEYMS0        SETLL     ETSR93A                                20
N03  C     *IN20         IFEQ      '1'
N03  C     KEYMS0        READE     ETSR93A                                51
N03  C     *IN51         DOWEQ     '0'
N03   *
N03  C                   SELECT
NXX  C     T7085         WHENEQ    'ZHE'                                        *HENTING(TERM)
NXX  C     T7085         OREQ      'ZHU'                                        *HENTING(T)/UTKJ.
NXX  C     T7085         OREQ      'ZHD'                                        *HENT./DIREKTEKJ.
N03  C                   MOVEL     T7085         HENKOD
N03  C     T4065         WHENEQ    'ZHE'
N03  C     T4065         OREQ      'ZHU'
N03  C     T4065         OREQ      'ZHD'
N03  C                   MOVEL     T4065         HENKOD
N03  C     T7085         WHENEQ    'RMD'
N03  C     T4065         OREQ      'RMD'
N03  C                   MOVEL     'X'           TRFA21                         *FARLIG
N03  C     T7085         WHENEQ    'ZHO'
N03  C     T4065         OREQ      'ZHO'
N03  C                   MOVEL     'X'           TRFA11                         *VARME
N03  C     T7085         WHENEQ    'ZPL'
N03  C     T4065         OREQ      'ZPL'
N03  C                   MOVEL     'P'           HEKDPL                         *PALL PRISET
N03  C     T7085         WHENEQ    'ZHP'
N03  C     T4065         OREQ      'ZHP'
N03  C                   MOVEL     'H'           HEKDPL                         *Halv-PALL PRISET
N03  C     T7085         WHENEQ    'ZKL'
N03  C     T4065         OREQ      'ZKL'
N03  C                   MOVEL     'K'           HEKDPL                         *KOLLIPRISET
N03  C     T7085         WHENEQ    'ZPG'
N03  C     T4065         OREQ      'ZPG'
N03  C                   MOVEL     'D'           HEKDPL                         *Partigods/direkte
N03  C                   ENDSL
N03  C     KEYMS0        READE     ETSR93A                                51
N03  C  N51              ENDDO
N03  C                   ENDIF
N03   *
N03  C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * FTX00                                               FTX00 /
      *////////////////////////////////////////////////////////////
     C     FTX00         BEGSR
     C                   CLEAR                   FREETXTR
     C                   MOVE      HEAVD         FRTAVD
     C                   MOVE      HEOPD         FRTOPD
     C                   Z-ADD     MDT           FRTDT
N08  C     OPPRAVS       ifne      *blanks                                      (blank v/henting)
N08  C                   MOVE      'R'           FRTKOD
N08  C                   ADD       1             FRTLI
N08  C                   MOVEL     OPPRAVS       FRTTXT
N08  C                   WRITE     FREETXTR
N08  C                   ENDIF
     C                   CLEAR                   DOK29R
     C                   MOVE      HEAVD         D29AVD
     C                   MOVE      HEOPD         D29OPD
     C                   Z-ADD     1             D29FNR
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     0             ZGN0
     C     KEYMS0        SETLL     EFTX93A                                20
     C     KEYMS0        READE     EFTX93A                                51
     C     *IN51         DOWEQ     '0'
      *
     C                   SELECT
     C     F4451         WHENEQ    'SIC'
     C                   MOVE      'G'           FRTKOD
      *
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440A        FRTTXT
     C                   WRITE     FREETXTR
      *
     C     F4440B        IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440B        FRTTXT
     C                   WRITE     FREETXTR
     C                   ENDIF
     C     F4440C        IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440C        FRTTXT
     C                   WRITE     FREETXTR
     C                   ENDIF
     C     F4440D        IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440D        FRTTXT
     C                   WRITE     FREETXTR
     C                   ENDIF
     C     F4440E        IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440E        FRTTXT
     C                   WRITE     FREETXTR
     C                   ENDIF
      * UNDERRETNING TIL KUNDE LEGGES RETT UT I RUBR38-FIL FOR FR.BREV
     C     F4451         WHENEQ    'ICN'
     C                   MOVEL     F4440A        D29TXT
     C                   WRITE     DOK29R
      * Opprinnelig avsender.. C/O B.H Ramberg....
     C     F444A1        IFEQ      'Fakturas'
     C     F444A1        OREQ      'FAKTURAS'
N08  C                   CLEAR                   A
     C                   MOVEA     F444A2        A
     C                   Z-ADD     25            NX                2 0
     C     A(NX)         DOWEQ     ' '
     C                   SUB       1             NX
     C                   END
     C                   ADD       1             NX
     C                   MOVEA     ' C/O '       A(NX)
     C                   ADD       5             NX
     C                   MOVEA     HENAA         A(NX)
     C                   MOVEA     A             HENAS
     C                   END
      *
     C     F4440B        IFNE      *BLANKS
     C                   MOVEL     F4440B        D29TXT
     C                   WRITE     DOK29R
     C                   ENDIF
     C     F4440C        IFNE      *BLANKS
     C                   MOVEL     F4440C        D29TXT
     C                   WRITE     DOK29R
     C* KOMMENTARLINJE OM AWB-NR LEGGES OGSÅ UT PÅ GODSLISTE.
     C                   MOVEL     F4440C        F444C1            4
     C     F444C1        IFEQ      'AWB '
     C                   MOVE      'G'           FRTKOD
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440C        FRTTXT
     C                   WRITE     FREETXTR
     C                   ENDIF
     C                   ENDIF
     C     F4440D        IFNE      *BLANKS
     C                   MOVEL     F4440D        D29TXT
     C                   WRITE     DOK29R
     C                   ENDIF
     C     F4440E        IFNE      *BLANKS
     C                   MOVEL     F4440E        D29TXT
     C                   WRITE     DOK29R
     C                   ENDIF
      *
     C                   OTHER
     C                   END
     C     KEYMS0        READE     EFTX93A                                51
     C  N51              ENDDO
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * FTX16                                               FTX16 /
      *////////////////////////////////////////////////////////////
     C     FTX16         BEGSR
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     16            ZGN1
     C     KEYMS1        SETLL     EFTX93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     EFTX93A                                52
     C     *IN52         DOWEQ     '0'
      *
     C     F4451         IFEQ      'AAA'
     C     HEVS1         CAT       F4440A:1      HEVS1
     C                   ENDIF
      *
     C  N52KEYMS1        READE     EFTX93A                                52
     C  N52              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * PCI22                                               PCI22 /
      *////////////////////////////////////////////////////////////
     C     PCI22         BEGSR
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     22            ZGN1
     C                   MOVE      *ZEROS        FMMKNR
     C     KEYMS1        SETLL     EPCI93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     EPCI93A                                52
     C     *IN52         DOWEQ     '0'
      * 24 = GODSMERKING GENERELT
     C     P4233         IFEQ      '24'
     C                   MOVEL     P7102A        HEGM1
     C                   MOVEL     P7102B        HEGM2
     C                   ENDIF
      *
      * OPPDATER KUN KOLLI-ID-ER (TYPE 18)
     C     P4233         IFEQ      '18'
     C                   MOVE      'F'           FMRI
     C                   MOVE      HEAVD         FMAVD
     C                   MOVE      HEOPD         FMOPD
     C                   Z-ADD     1             FMFBNR
     C                   MOVE      'E'           FMST
     C                   ADD       1             FMMKNR
     C*                  MOVEL     P7102A        FMMRK1
N01  C                   MOVEL     P7102A        CLID
N01  c                   exsr      FixAI
     C                   WRITE     DOKUFMR

     C     P7102B        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
     C*                  MOVEL     P7102B        FMMRK1
N01  C                   MOVEL     P7102B        CLID
N01  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102C        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
     C*                  MOVEL     P7102C        FMMRK1
N01  C                   MOVEL     P7102C        CLID
N01  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102D        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
     C*                  MOVEL     P7102D        FMMRK1
N01  C                   MOVEL     P7102D        CLID
N01  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102E        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
     C*                  MOVEL     P7102E        FMMRK1
N01  C                   MOVEL     P7102E        CLID
N01  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102F        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
     C*                  MOVEL     P7102F        FMMRK1
N01  C                   MOVEL     P7102F        CLID
N01  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102G        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
     C*                  MOVEL     P7102G        FMMRK1
N01  C                   MOVEL     P7102G        CLID
N01  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102H        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
     C*                  MOVEL     P7102H        FMMRK1
N01  C                   MOVEL     P7102H        CLID
N01  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102I        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
     C*                  MOVEL     P7102I        FMMRK1
N01  C                   MOVEL     P7102I        CLID
N01  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102J        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
     C*                  MOVEL     P7102J        FMMRK1
N01  C                   MOVEL     P7102J        CLID
N01  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C                   END
      *
     C     KEYMS1        READE     EPCI93A                                52
     C  N52              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
N01   ************************************************************
N01  C     FixAI         BEGSR
N01   ************************************************************
N01  c     CLID20        ifeq      *blanks
N01  C                   eval      FMMRK1 = CLID                                18 første
N01  c                   else
N01  C                   eval      FMMRK1 = CLIDB                               3-20 (skipp 00)
N01  c                   end
N01  C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Get numerical value                               GETNUM /
      *////////////////////////////////////////////////////////////
     C     GETNUM        BEGSR
     C                   MOVE      *ZEROS        ZHEL
     C                   MOVE      *ZEROS        ZDEC
     C                   MOVE      *ZEROS        B
     C                   Z-ADD     1             AX                2 0
     C                   Z-ADD     1             BX                2 0
      * Get Integer
     C     A(AX)         DOWGE     '0'
     C     ZHEL          MULT      10            ZHEL
     C                   MOVE      A(AX)         ZHEL
     C                   ADD       1             AX
     C                   ENDDO
      * Decimal point ?
     C     A(AX)         IFEQ      '.'
     C     A(AX)         OREQ      ','
     C                   ADD       1             AX
     C     A(AX)         DOWGE     '0'
     C                   MOVE      A(AX)         B(BX)
     C                   ADD       1             AX
     C                   ADD       1             BX
     C                   ENDDO
     C                   MOVEA     B             ZDEC6
     C                   ENDIF
      * Concatenate
     C                   Z-ADD     ZHEL          ZNUM             18 6
     C                   ADD       ZDEC          ZNUM
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * GID16                                               GID16 /
      *////////////////////////////////////////////////////////////
     C     GID16         BEGSR
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     16            ZGN0
     C     KEYMS0        SETLL     EGID93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     EGID93A                                51
     C     *IN51         DOWEQ     '0'
      *
     C                   MOVEL     G7064A        HEVS1
      *
     C                   Z-ADD     GREP0         ZREPB0
     C                   EXSR      FTX16
     C                   EXSR      PCI22
      *
     C     KEYMS0        READE     EGID93A                                51
     C  N51              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *                                                      INIT /
      *////////////////////////////////////////////////////////////
     C     INIT          BEGSR
     C     KEYMS0        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN0
     C     KEYMS1        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN1
     C                   KFLD                    ZREPB0
     C     KODRIK        KLIST
     C                   KFLD                    XXTERM            4 0
     C                   KFLD                    NUMPNR            4 0
HARD C                   MOVE      1000          XXTERM
     C     STEDKE        KLIST
     C                   KFLD                    YYLAND            2
     C                   KFLD                    YYSTED            5
     C                   MOVE      'NO'          YYLAND
     C     KODTAK        KLIST
     C                   KFLD                    YYAUNI
     C                   KFLD                    YYAVD             4 0
     C                   MOVE      'A'           YYAUNI            1
     C     KUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C     VADRKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C                   KFLD                    VADRNR
     C                   Z-ADD     1             VADRNR
      *
     C     *LIKE         DEFINE    NMN           ZMN
     C     *LIKE         DEFINE    NGN           ZGN0
     C     *LIKE         DEFINE    NGN           ZGN1
     C     *LIKE         DEFINE    NREP0         ZREPB0
     C     *LIKE         DEFINE    HEAVD         AVDZER
     C                   MOVE      *ZEROS        AVDZER
     C                   MOVE      *ZEROS        XXVKT
     C                   MOVE      *ZEROS        XXFBV
     C                   MOVE      *ZEROS        XXM3
     C                   MOVE      *ZEROS        XXLM
     C                   MOVE      *ZEROS        XXNT
     C                   MOVE      *ZEROS        XXVERB
     C     AVDZER        CHAIN     FIRINL                             33
      *
     C     *ENTRY        PLIST
     C                   PARM                    WMN1              9
     C                   MOVEL     WMN1          WMN2
     C                   Z-ADD     WMN2          ZMN
      * Get msg and interchange values
     C     ZMN           CHAIN     EDIM                               51
     C     MSN           CHAIN     EDIS                               51
      *
HARD  * FINNER MOTTAGER EDI
HARD C                   MOVEL     M0010         MOTEDI            8
HARD C     MOTEDI        IFEQ      'RIKSGODS'
HARD C                   MOVE      1000          XXTERM
HARD C                   ELSE
HARD C                   MOVE      3000          XXTERM
HARD C                   END
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * NAD10                                               NAD10 /
      *////////////////////////////////////////////////////////////
     C     NAD10         BEGSR
      * NOEN (timpex) sender NAD+DP før NAD+CN, NADDP er flagg for at NADDP ER behandlet..
     c                   move      'N'           NADDP             1
     c                   move      'N'           NADSH             1
     c                   move      'N'           NADPW             1
     C                   Z-ADD     10            ZGN0
     C     KEYMS0        SETLL     ENAD93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ENAD93A                                51
     C     *IN51         DOWEQ     '0'
      *
     C                   SELECT
      *
NXX   * PW=Henteadresse - overstyrer oppdragsgivers adresse som avsender
NXX   *    (Antar at ingen benytter både PW og SH -  i så fall - siste teller :=)
NXX  C     N3035         WHENEQ    'PW'                                         Henteadresse
Nxx  c     HENKOD        ifne      *blanks
NXX  c                   move      'J'           NADPW
NXX  C                   MOVEL     N3036A        HENAS
NXX  C                   MOVEL     N3042A        HEADS1
NXX  C                   EVAL      HEADS3 = %trim(N3251)+' '                             PNR
NXX  C                              + %trim(N3164)+' '                                   STED
NXX  C                   IF        N3207<>' ' and N3207<>FILAND
NXX  C                   EVAL      HEADS3 = %trim(HEADS3)+' '+N3207                      land
NXX  C                   ENDIF
NXX  C                   ENDIF
      * Shipper oppgitt - overstyrer oppdragsgivers adresse som avsender
     C     N3035         WHENEQ    'SH'                                         Avsender
Nxx  c     HENKOD        ifeq      *blanks
sXX  C*    N3039         IFNE      *BLANKS
sXX  C*                  MOVEA     N3039         A
sXX  C*                  EXSR      GETNUM
sXX  C*                  END
NXX  c                   move      'J'           NADSH
     C                   MOVEL     N3036A        HENAS
     C                   MOVEL     N3042A        HEADS1
sXX  C*                  MOVEL     N3251         HEADS3
sXX  C*                  MOVEL     N3164         STED25           25
sXX  C*                  MOVE      STED25        HEADS3
NXX  C                   EVAL      HEADS3 = %trim(N3251)+' '                             PNR
NXX  C                              + %trim(N3164)+' '                                   STED
NXX  C                   IF        N3207<>' ' and N3207<>FILAND
NXX  C                   EVAL      HEADS3 = %trim(HEADS3)+' '+N3207                      land
NXX  C                   ENDIF
NXX  C                   ENDIF
      *
      *
      * Ved booking TG9BO  ligger avsender i CZ
     C     N3035         WHENEQ    'CZ'                                         Avsender
     C     M1001         ifeq      '335'
NXX  C     HENKOD        orne      *blanks
     C     N3039         IFNE      *BLANKS
N08  C                   CLEAR                   A
     C                   MOVEA     N3039         A
     C                   EXSR      GETNUM
     C                   END
NXX  c     NADSH         ifne      'J'
NXX  c     NADPW         andne     'J'
     C                   MOVEL     N3036A        HENAS
     C                   MOVEL     N3042A        HEADS1
     C                   MOVEL     N3251         HEADS3
     C                   MOVEL     N3251         HESDF
     C                   MOVEL     N3164         STED25           25
     C                   MOVE      STED25        HEADS3
NXX  c                   endif
     c                   end
      * LAR DET LIGGE OGSÅ FOR EVT ANDRE (BHR-SPESIAL)
     C     M0004         IFEQ      'FREJATRANS'
     C     HENKOD        andeq     *blanks
     c                   movel     'Avsender:'   OPPRAVS          70
     c                   eval      OpprAvs=%trim(OpprAvs) +' '
     c                             + %trim(N3036A)+', '                         NAVN
     c                             + %trim(N3042A)+', '                         ADR
     c                             + %trim(N3251)+' '                           PNR
     c                             + %trim(N3164)+', '                          STED
     c                             + %trim(N3207)                               LAND
     c                   endif
n02   * ved oppgitt kunenummer i CZ benytt det (når det f.eks sendeds fra AXIAFRAKT )
N08  C                   CLEAR                   A
n02  C                   MOVEA     N3039         A
n02  C                   EXSR      GETNUM
n02  C                   Z-ADD     ZNUM          TRKNFA                         KNR OPD.GIV
n02  C                   MOVE      TRKNFA        HEKNSF
n02  C                   Z-ADD     ZNUM          KUNDNR
n02  C     KUNKEY        CHAIN     CUNDL01                            33
n02  C     *IN33         IFEQ      '0'
n02  C                   MOVEL     KNAVN         HENAA                          NAVN OPD.GIV
NXX   * IKKE hente-adr far NAD+CZ dersom NAD+SH eller NAD+PW alt er behandlet
NXX  c     NADSH         ifne      'J'
NXX  c     NADPW         andne     'J'
NXX  c     HENKOD        andeq     *blanks
n02  C     VADRKE        CHAIN     VADR                               33
n02  C     *IN33         IFEQ      '0'
n02  C                   MOVE      VADRNA        HENAS
n02  C                   MOVE      VADRN1        HEADS1
n02  C                   MOVE      VADRN3        HEADS3
n02  C                   ELSE
n02  C                   MOVEL     KNAVN         HENAS
n02  C                   MOVEL     ADR1          HEADS1
n02  C                   MOVEL     POSTNR        HEADS3
n02  C                   MOVE      ADR3          HEADS3
n02  C                   END
n02  C                   END
n02  C                   END
      *
      * OS = Original Shipper
     C     N3035         WHENEQ    'OS'                                         MOTTAKER
     C     HENKOD        ifeq      *blanks
     c                   movel     'Avsender:'   OPPRAVS          70
     c                   eval      OpprAvs=%trim(OpprAvs) +' '
     c                             + %trim(N3036A)+', '                         NAVN
     c                             + %trim(N3042A)+', '                         ADR
     c                             + %trim(N3251)+' '                           PNR
     c                             + %trim(N3164)+', '                          STED
     c                             + %trim(N3207)                               LAND
     c                   endif
      *
     C     N3035         WHENEQ    'CN'                                         MOTTAKER
     C     N3039         IFNE      *BLANKS
N08  C                   CLEAR                   A
     C                   MOVEA     N3039         A
     C                   EXSR      GETNUM
     C                   END
      * IKKE lev-adr fra NAD+CN dersom NAD+DP alt er behandlet
     c     NADDP         ifne      'J'
     C                   MOVEL     N3036A        HENAK
     C                   MOVEL     N3042A        HEADK1
     C                   MOVEL     N3251         HEADK3
     C                   MOVEL     N3164         STED25           25
N01  C     STED25        IFEQ      *BLANKS
N01  C                   MOVEL     N3251         PONNR
N01  C     PONNR         CHAIN     PONRN                              33
N01  C  N33              MOVEL     PONNAV        STED25
N01  C                   ENDIF
     C                   MOVE      STED25        HEADK3
     c                   endif
      * avvikende leveringsadresse
     C     N3035         WHENEQ    'DP'                                         LEV.ADR
     c                   move      'J'           NADDP
     C                   MOVEL     N3036A        HENAK
     C                   MOVEL     N3042A        HEADK1
     C                   MOVEL     N3251         HEADK3
     C                   MOVEL     N3164         STED25
N01  C     STED25        IFEQ      *BLANKS
N01  C                   MOVEL     N3251         PONNR
N01  C     PONNR         CHAIN     PONRN                              33
N01  C  N33              MOVEL     PONNAV        STED25
N01  C                   ENDIF
     C                   MOVE      STED25        HEADK3
      *
     C                   ENDSL
      *
     C     KEYMS0        READE     ENAD93A                                51
     C  N51              ENDDO
     C                   ENDIF
      *
      *
      * FINN AVD. UTFRA MOTTAKERS POSTNR
     C                   MOVEL     HEADK3        TSTPNR            4
     C                   MOVEL     TSTPNR        HESDT
NXX  C     HENKOD        IFNE      *BLANKS
NXX  C                   MOVEL     HEADS3        TSTPNR            4
NXX  C                   ENDIF
     C                   TESTN                   TSTPNR               33
     C     *IN33         IFEQ      '1'
     C                   MOVE      TSTPNR        NUMPNR
      * FINN AVD
     C     KODRIK        CHAIN     NOPNR                              33
NXX   * HENTING
NXX  C     *IN33         IFEQ      *OFF
NXX  C     HENKOD        ANDne     *blanks
NXX  C     NOAVDI        ANDNE     *ZEROS
NXX  C                   MOVE      NOAVDI        HEAVD                          INNGÅENDE
NXX  C                   goto      AvdOK2
NXX  C                   END
     C* DISTRIBUSJON
     C     *IN33         IFEQ      *OFF
     C     NOAVDU        ANDNE     *ZEROS
     C                   MOVE      NOAVDU        RIAVDU
     C                   MOVE      NOAVDI        RIAVDI
     C                   MOVE      NOAVDH        RIAVDH
     C                   goto      AvdOK
     C                   END
     C     KODRIK        SETGT     KODTRI
     C     XXTERM        READPE    KODTRI                                 33
     C  N33NUMPNR        IFGE      RIPNRF
     C     NUMPNR        ANDLE     RIPNRT
     C     AvdOk         Tag
     C                   MOVE      RIAVDU        HEAVD
     C                   ELSE
     C                   MOVE      RIAVDU        HEAVD
     C                   MOVEL     'OBS AVD!'    HESDL
     C                   END
NXX  C     HENKOD        ifne      *blanks
NXX  C                   MOVE      RIAVDI        HEAVD                          INNGÅENDE
Nxx  c                   endif
     C                   END
      *
     C     HEAVD         IFEQ      *ZEROS
HARD C                   Z-ADD     1             HEAVD
HARD C     HENKOD        ifne      *blanks
HARD C                   MOVE      2             HEAVD                          INNGÅENDE
HARD c                   endif
     C                   MOVEL     'OBS AVD!'    HESDL
     C                   END
      * VIA...
     C     HESDL         IFNE      'OBS AVD!'
     C     HEAVD         CHAIN     KODTAG                             33
     C  N33AGTRNR        comp      *zeros                                 33
     C  N33              MOVE      'J'           TRTSTA
     C                   END
      *
     C     AVDOK2        TAG
     C     HEAVD         CHAIN     TELL                               33
     C   33AVDZER        CHAIN     TELL                               33
     C                   MOVE      TEOPDN        HEOPD
     C                   ADD       1             TEOPDN
     C                   UPDATE    TELLR
      *
     C                   ENDSR
N03
N03   *////////////////////////////////////////////////////////////
N03   * TDT08                                               TDT08 /
N03   *////////////////////////////////////////////////////////////
N03  C     TDT08         BEGSR
N03  C                   MOVEL     *blanks       FFBIL            10
N03  C                   MOVEL     *blanks       DIRBIL           10
N03  C                   MOVE      '0'           *IN51
N03  C                   Z-ADD     8             ZGN0
N03  C     KEYMS0        SETLL     ETDT93A                                20
N03  C     *IN20         IFEQ      '1'
N03  C     KEYMS0        READE     ETDT93A                                51
N03  C     *IN51         DOWEQ     '0'
N03   *
N03  C                   SELECT
N03  C     T8051         WHENEQ    '10'
N03  C                   MOVEL     T8212         FFBIL
N03  C     T8051         WHENEQ    '20'
N03  C                   MOVEL     T8212         DIRBIL
N03  C     T8051         WHENEQ    '22'
N03  C                   MOVEL     T8212         DIRBIL
N03  C                   ENDSL
N03   *
N03  C  N51KEYMS0        READE     ETDT93A                                51
N03  C  N51              END
N03  C                   END
N03   *
N03  C                   ENDSR
      ***********************************************
     C     RFF03SN       BEGSR
      ***********************************************
N10  c                   move      *blanks       TRDOCN           20
N10  c                   move      *blanks       AAM_OK            1
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     3             ZGN0
     C     KEYMS0        SETLL     ERFF93A                                20
     C     KEYMS0        READE     ERFF93A                                51
     C     *IN51         DOWEQ     '0'
N10  C     R1153         IFEQ      'AAM'
N10  c                   eval      SNDN20 = R1154                               AAM=Waybill number
N10  c                   eval      AAM_OK = 'J'
N10  C                   ENDIF
     C     R1153         IFEQ      'AAS'
S10  c*                  eval      SNDN20 = R1154
     c                   eval      TRDOCN = R1154                               AAS=Transport doc.No
     C                   ENDIF
     C     KEYMS0        READE     ERFF93A                                51
     C                   ENDDO
      *
N10  C                   if        TRDOCN<>*blanks and AAM_OK=' '
N10  c                   eval      SNDN20 = TRDOCN
N10  C                   endif
N10   * 17 langt?? - legg til 401
N10  C                   if        %subst(SNDN20:17:1)<>' '
N10  C                             and %subst(SNDN20:18:3)= '   '
N10  c                   eval      SNDN20 = '401'+SNDN20
N10  C                   endif
N10   *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * RFF03                                               RFF03 /
      *////////////////////////////////////////////////////////////
     C     RFF03         BEGSR
s09   * edi snd.nr for å BINDE sammen alle i samme mottak
s09   * (flyttet i bunnen for mer fleksiblet å kunne hentet verdien far en annen ref)
s09   * ingen merking forøvrig
N09  c*                  move      *blanks       XXTurRef         15
N09  c                   move      *blanks       XXTurRef         17
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     3             ZGN0
     C     KEYMS0        SETLL     ERFF93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ERFF93A                                51
     C     *IN51         DOWEQ     '0'
      *
     C     R1153         IFEQ      'CU '                                           TG
     C     R1153         OREQ      'CO '                                           LG
      * VIL VÆRE AVD/OPD/SG
     C                   MOVEL     R1154         HERFA
      * FOR ENHETS SKYLD(LIKT INTERN IFCSUM) LEGG I I FRISOK
      * (BURDE HELLER/I TILLEGG VÆRE SENDT FRA SYFA12TG/LG SOM "FF"
      *  SLIK AT CU KUNNE BEVARES TIL OPPRINNELIG AVSENDERS REF...)
     C                   MOVE      HEAVD         FSAVD
     C                   MOVE      HEOPD         FSOPD
     C                   MOVE      'FFR'         FSKODE
     C                   MOVEL     R1154         FSSOK
N03  C                   MOVE      *blanks       FSDOKK
     C                   WRITE     FRISOKR
     C                   ENDIF
      *
      * GODSNR PÅ LASTE-LISTE  (OGSÅ OPPDATERE HXLKOD (LAGERKODE)??)
     C     R1153         IFEQ      'XC '
     C                   MOVE      HEAVD         FSAVD
     C                   MOVE      HEOPD         FSOPD
     C                   MOVE      'GNR'         FSKODE
     C                   MOVEL     R1154         FSSOK
     C                   MOVEL     'LG'          FSDOKK
     C                   WRITE     FRISOKR
     C                   MOVEL     'TL'          HXLKOD
     C                   ENDIF
      * UTLEV.FORBEHOLD
     C     R1153         IFEQ      'ZUF'
     C                   MOVEL     R1154         HEKF
N07  C     HEKF          CHAIN     KODTU                              33
N07  C  N33              MOVEL     KUTX          HEFT1
     C                   ENDIF
      *
     C  N51KEYMS0        READE     ERFF93A                                51
     C  N51              ENDDO
     C                   ENDIF
      *
N02   * edi snd.nr for å BINDE sammen alle i samme mottak
N02  C                   MOVE      HEAVD         FSAVD
N02  C                   MOVE      HEOPD         FSOPD
N02  C                   MOVE      'EDS'         FSKODE
N02  C                   MOVE      MSN           MSNALFA           9
N02  c                   move      TRKNFA        AAKNFA            8
N02  c                   move      HEDTOP        AADTOP            8
N02  C                   EVAL      FSSOK =AAKNFA+' '+AADTOP+' '+MSNALFA
N02  c** Annet begrep for å binde - Bilnr/turnr ???
N09  c     xxTurRef      ifne      *blanks
N09  C                   EVAL      FSSOK =AAKNFA+' '+AADTOP+' '+xxTurRef
N09  c                   endif
N02  C                   WRITE     FRISOKR
N02   *
     C                   ENDSR
      *
N03
N03   *////////////////////////////////////////////////////////////
N03   * EQD34                                               EQD13 /
N03   *////////////////////////////////////////////////////////////
N03  C     EQD34         BEGSR
N03  C                   MOVE      *ZEROS        ANTPLL            3 0
N03  C                   Z-ADD     34            ZGN0
N03  C                   Z-ADD     34            ZGN1
N03   *
N03  C     KEYMS0        SETLL     EEQD93A                                20
N03  C     *IN20         IFEQ      '1'
N03  C     KEYMS0        READE     EEQD93A                                51
N03  C     *IN51         DOWEQ     '0'
N03   *
N03   * ETT ELLER 2 SEGMENT...
N03  C     E8053         IFEQ      'EFP'
N03  C                   Z-ADD     EREP0         ZREPB0
N03  C     KEYMS1        CHAIN     EEQN93A                            33
N03  C     *IN33         IFEQ      '0'
N03  C     E6350         ANDNE     *BLANKS
N03  C                   CLEAR                   A
N03  C                   MOVEA     E6350         A
N03  C                   EXSR      GETNUM
N03  C                   Z-ADD     ZNUM          ANTPLL
N03  C                   END
N03  C                   END
N03   *
N03  C  N51KEYMS0        READE     EEQD93A                                51
N03  C  N51              END
N03  C                   END
N03  C                   MOVE      ANTPLL        HXPALL
N03   *
N03   * SKRIV TIL PALL-LAGER-SYSTEM DERSOM DET IKKE ER FRA "RAMBERG"
N03  C     M0004         IFNE      'RAMBERG'
N03  C     ANTPLL        IFNE      *ZEROS
N03   * Midlertidig?? heller ikke ved leman/andre
N03  C     ANTPLL        ANDEQ     *ZEROS
N03   * 1. KUNDE AVGIR,    PALLAGERHOLDER MOTTAR
N03   * KODE: K=KUNDE, T=TRANSP. ' '= PALLEPARTS-NR
N03  C                   Z-ADD     TRKNFA        XXAVGI            8 0
N03  C                   MOVE      'K'           XXAVGK            1
N03  C                   Z-ADD     1             XXMOTT            8 0
N03  C                   MOVE      ' '           XXMOTK            1
N03  C                   MOVE      ' '           XXVIAA            1
N03  C                   Z-ADD     ANTPLL        XXANT             5 0
N03  C                   MOVE      *BLANKS       XXBILN           10
N03  C                   MOVE      ' '           XXBEIE            1
N03  C                   MOVEL     HXSNDN        XXTXT            20
N03  C                   MOVE      '0'           XXFLA             1
N03  C                   CALL      'SYPA11'
N03  C                   PARM                    XXAVGI
N03  C                   PARM                    XXAVGK
N03  C                   PARM                    XXMOTT
N03  C                   PARM                    XXMOTK
N03  C                   PARM                    XXVIAA                         X=VIA LAG.HO
N03  C                   PARM                    XXANT
N03  C                   PARM                    XXBILN
N03  C                   PARM                    XXBEIE
N03  C                   PARM                    XXTXT
N03  C                   PARM                    XXFLA
N03  C                   END
N03  C                   END
N03  C                   ENDSR
     C***********************************************
     C     TTSR          BEGSR
     C***********************************************
      * EDI-FIL klargjort hos avsender (hentet fra EUNB)
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C     MSN           CHAIN     EUNB                               33
     C   33              MOVE      *ZEROS        U0017
     C   33              MOVE      *ZEROS        U0019
     C   33              MOVE      *ZEROS        TTDATE
     C                   MOVE      'ED1'         TTACTI
     C                   MOVEL     U0017         TSTÅR             2
     C  N33TSTÅR         IFGT      '43'
     C                   MOVEL     '19'          TTDATE
     C                   ELSE
     C                   MOVEL     '20'          TTDATE
     C                   END
     C                   MOVE      U0017         TTDATE
     C                   MOVEL     U0019         TTTIME
     C                   MOVE      '00'          TTTIME
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      ULDT          TTDATL
     C                   MOVE      XULTM         TTTIML
     C                   MOVEL     U0004         TTUSER
     C                   MOVEL     TTXED1        TTTEXT
n04  C                   MOVEL     TTXED1L       TTTEXL
     C                   WRITE     TRACKFR
      * EDI-fil mottatt og logget i SYSPED/SYEDI (hentet fra EDIS)
     C                   MOVE      'ED2'         TTACTI
     C                   MOVEL     SDT           TTDATE
     C                   MOVEL     STM           TTTIME
     C                   MOVE      *BLANKS       TTUSER
     C                   MOVEL     'SY400USR'    TTUSER
     C                   MOVEL     TTXED2        TTTEXT
n04  C                   MOVEL     TTXED2L       TTTEXL
     C                   WRITE     TRACKFR
      * Registrert (SKREVET TIL HEADF...)
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      'STR'         TTACTI
     C                   MOVE      ULDT          TTDATE
     C                   MOVE      XULTM         TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
     C                   MOVEL     'SY400USR'    TTUSER
     C                   MOVEL     TTXSTR        TTTEXT
n04  C                   MOVEL     TTXSTRL       TTTEXL
     C                   WRITE     TRACKFR
     C                   ENDSR

     C***********************************************
     C     GETFRT        BEGSR
     C***********************************************
      * SR SOM HENTER VERDI FOR FRAKTTILLEGG (OLJE/VAL...)
     C                   MOVE      'H'           UUR
     C                   MOVE      *BLANKS       HEVALT
     C                   MOVE      *ZEROS        UVALP
     C                   CALL      'SYFA24B'
     C                   PARM                    UUR               1
     C                   PARM      HEAVD         UAVDOP            4 0
     C                   PARM      TRKNFA        UKNOP             8 0
     C                   PARM                    HEVALT
     C                   PARM                    UVALP             3 1
     C                   MOVE      UVALP         HEVALP
     C                   ENDSR
     C*
