********************************************************************
     ** RETTINGER I DETTE PROGRAM:
PTFnr *Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 OPSJON 8 = FULL MODULS
10XXX * 02 YBC PTF10 HENT MERK&NR FRA OPPDRAG VED FULL MODULS
10318 * 03 YBC PTF10 VEKT ER ENDRET FRA 5.0 TIL 12.3
      *              VAREBESKRIVELSE ER ØKT FRA 15A TIL 30A
11174 * 04 YBC PTF11 TILLEGGSLINJER MED SAMME POST
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
12XXX * 05 YBC PTF12 Test om FF-avgift < 100
12201 * 06 YBC PTF12 CONTAINER ER I EGEN FIL
12XXX * 07 YBC PTF12 Ikke summere slettet linje
12248 * 08 YBC PTF12 VEKT, KOLLI ER UTVIDET.
********************************************************************
      *
      ***********************************************************
      *** PROGRAM SKAL SPØRRE PÅ EKSPORT (TILLEGGSARK)        ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 02 04 06 07 09 10 13-24
      *** LEDIGE INDIKATORER 28 29 34-37 39-90 96 97
      ***********************************************************
      *
     FHEADF     IF   E           K DISK
     FFIRM      IF   E           K DISK
     FSAEH      IF   E           K DISK
     FSAEV      IF   E           K DISK
     FSAEV2     IF   E           K DISK    RENAME(SAEVR:SAEV2R)
     FSAEV4     IF   E           K DISK    RENAME(SAEVR:SAEV4R)
N06  FSAEVCN    IF   E           K DISK
     FSADAVGE   IF   E           K DISK
     FKODTVA    IF   E           K DISK
     FSAD023FB  CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
S03  D*                DS
S03  D* SVVT                   1     15
S03  D* SVVT2                  1     10
     D                 DS
     D  SVTOA                  1     22
     D  SVTOB                 23     45
     D  SVTOPL                 1     45
     D                 DS
S03  D* SVFT01                 1     17
S03  D* SVFT02                18     34
S03  D* SVFT03                35     51
S03  D* SVFT04                52     68
S03  D* SVFT05                69     85
S03  D* SVFT06                86    102
S03  D* SVFT07               103    119
S03  D* VFT                    1    136    DIM(8)
N03  D  SVFT01                 1     28
N03  D  SVFT02                29     56
N03  D  SVFT03                57     84
N03  D  SVFT04                85    112
N03  D  SVFT05               113    140
N03  D  SVFT06               141    168
N03  D  SVFT07               169    196
N03  D  VFT                    1    308    DIM(11)
N01  D                 DS
S08  D* SVNT01                 1      6  0
S08  D* SVNT02                 7     12  0
S08  D* SVNT03                13     18  0
S08  D* SVNT04                19     24  0
S08  D* SVNT05                25     30  0
S08  D* SVNT06                31     36  0
S08  D* SVNT07                37     42  0
S03  D* VNT                    1     48  0 DIM(8)
S08  D* VNT                    1     66  0 DIM(11)
N08  D  SVNT01                 1      9  0
N08  D  SVNT02                10     18  0
N08  D  SVNT03                19     27  0
N08  D  SVNT04                28     36  0
N08  D  SVNT05                37     45  0
N08  D  SVNT06                46     54  0
N08  D  SVNT07                55     63  0
N08  D  VNT                    1     99  0 DIM(11)
N01  D                 DS
N01  D  SVEH01                 1      4
N01  D  SVEH02                 5      8
N01  D  SVEH03                 9     12
N01  D  SVEH04                13     16
N01  D  SVEH05                17     20
N01  D  SVEH06                21     24
N01  D  SVEH07                25     28
S03  D* VEH                    1     32    DIM(8)
N03  D  VEH                    1     44    DIM(11)
N01  D                 DS
S03  D* SVVT01                 1     15
S03  D* SVVT02                16     30
S03  D* SVVT03                31     45
S03  D* SVVT04                46     60
S03  D* SVVT05                61     75
S03  D* SVVT06                76     90
S03  D* SVVT07                91    105
S03  D* VVT                    1    120    DIM(8)
N03  D  SVVT01                 1     30
N03  D  SVVT02                31     60
N03  D  SVVT03                61     90
N03  D  SVVT04                91    120
N03  D  SVVT05               121    150
N03  D* SVVT06               151    180
N03  D* SVVT07               181    210
N03  D  VVT                    1    330    DIM(11)
N01  D                 DS
N01  D  SVTOP1                 1     17
N01  D  SVTOP2                18     34
N01  D  SVTOP3                35     51
N01  D  SVTOP4                52     68
N01  D  SVTOP5                69     85
N03  D  SVTOP6                86    102
N03  D  SVTOP7               103    119
N03  D  SVTOP8               120    136
N03  D  SVTOP9               137    153
N03  D  SVTOP10              154    170
S03  D* TOP                    1    136    DIM(8)
N03  D  TOP                    1    187    DIM(11)
N01  D                 DS
N01  D  SVCRE1                 1      3
N01  D  SVCRE2                 4      6
N01  D  SVCRE3                 7      9
N01  D  SVCRE4                10     12
N01  D  SVCRE5                13     15
N03  D  SVCRE6                16     18
N03  D  SVCRE7                19     21
N03  D  SVCRE8                22     24
N03  D  SVCRE9                25     27
N03  D  SVCRE10               28     30
S03  D* TCR                    1     24    DIM(8)
N03  D  TCR                    1     33    DIM(11)
     C*
     C                   EXSR      INIT
     C*
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C  N31
     CANN32SAEV2K        SETLL     SAEV2
     C   31
     CANN32SAEV4K        SETLL     SAEV4
     C   32SAEV1K        SETLL     SAEV
     C     START1        TAG
     C  N31
     CANN32UAVD          READE     SAEV2                                  94
     C   31
     CANN32UAVD          READE     SAEV4                                  94
     C   32UAVD          READE     SAEV                                   94
     C  N94UTDN          COMP      SVTDN                              9494
     C   94              MOVE      *BLANKS       WSNR
      *
     C     START2        TAG
      *
     C  N94              DO
S03  C*                  DO        17
N03  C                   DO        20
     C                   ADD       1             ZRECNO
     C     SVVKTB        IFEQ      0
     C     SVBELT        ANDEQ     0
     C     SVNTM         ANDEQ     0
     C                   SETON                                        95
     C                   ELSE
     C                   SETOFF                                       95
     C                   END
     C  N32              MOVE      SVLN          WXLN
     C   32              MOVE      SVLI          WXLN
S03  C*                  IF        SVNTM < 0
S03  C*                  EVAL      XVNTM9 = SVNTM * -100
S03  C*                  EVAL      XVNTM7 = 9999999
S03  C*                  ELSE
S03  C*                  EVAL      XVNTM9 = SVNTM
S03  C*                  EVAL      XVNTM7 = SVNTM
S03  C*                  END
     C                   WRITE     SUBFIL
     C  N31
     CANN32UAVD          READE     SAEV2                                  94
     C   31
     CANN32UAVD          READE     SAEV4                                  94
     C   32UAVD          READE     SAEV                                   94
     C  N94UTDN          COMP      SVTDN                              9494
     C  N94              END
     C                   END
     C*
     C                   Z-ADD     ZRECNO        YRECNO            4 0
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   EXFMT     NYVARE
     C                   ELSE
     C                   WRITE     SUBCTL
     C                   EXFMT     BUNN
     C                   END
     C*
     C***
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   END
     C***
     C*
     C                   SETOFF                                       9830
     C*
     C*** F1  ---> BYTTE AVDELINGER
     C   01              Z-ADD     1             UFLAGG
     C*** F3  ---> AVSLUTTE SPØRRING
     C   03              Z-ADD     3             UFLAGG
     C*** F12 ---> AVBRYT OG GÅ TILBAKE TIL DEL-1
     C   12              Z-ADD     9             UFLAGG
     C   01
     COR 03
     COR 12              GOTO      SLUTT
     C*** F5  ---> VISE STARTEN AV SUBFIL
     C   05              GOTO      START
     C*** F8  ---> VELGE SORTERINGSMÅTE OG START POST FOR SUBFIL
     C   08              GOTO      START7
     C*** F11 ---> SE PÅ OPPDRAG
     C   11              DO
     C                   EXSR      SEOPPD
     C                   GOTO      START3
     C                   END
     C*** ROLL UP ---> BLA TIL NESTE SIDE
     C   25              DO
     C                   Z-ADD     YRECNO        ZRECNO
     C                   SETOFF                                       25
     C                   GOTO      START2
     C                   END
     C*
     C*** SJEKKE OM BRUKER HAR VALGT OPSJONER. HIVS SÅ,T UTFØRE DISSE.
     C     ZRECNO        IFNE      0
     C                   EXSR      VLHENT
     C                   END
     C*** 98 PÅ ---> BRUKER HAR IKKE VALGT OPSJON. VISE SAMME POSTER
     C***            I SUBFIL DVS. SAMME RECORDNR.
     C   98XRECNO        IFNE      0
     C                   Z-ADD     XRECNO        ZRECNO
     C                   END
     C                   GOTO      START3
     C*
     C*** VELGE SORTERINGSMÅTE OG START POST FOR SUBFIL
     C*** 31 PÅ    ---> SORTERE PÅ TARIFFNR. + LANDKODE     (SADV2)
     C*** 32 PÅ    ---> SORTERE PÅ REGISTRERINGS REKKEFØLGE (SADV)
     C*** 31,32 AV ---> SORTERE PÅ UTSKRIFTS REKKEFØLGE     (SADV4)
     C     START7        TAG
     C                   MOVE      *ZEROS        W3VNT
     C                   EXFMT     VAREL2
     C   12              GOTO      START3
     C     W3LI          COMP      0                                  3232
     C  N32              DO
     C     W3VNT         COMP      0                                      31
     C                   END
     C   32              SETOFF                                       31
     C                   GOTO      START
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     SEOPPD        BEGSR
     C***********************************************
     C*** SJEKKE OM OPPDRAG FINNES. HVIS IKKE VISE FEILMELDING.
     C*** ELLERS VISER OPPDRAGET.
     C     HEADFK        CHAIN     HEADF                              30
     C  N30              DO
     C                   Z-ADD     0             UFLAGG
     C                   CALL      'SYFM21A'
     C                   PARM                    FIFIRM
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    UFLAGG
     C     UFLAGG        IFEQ      0
     C                   CALL      'SYFM21B'
     C                   PARM                    FIFIRM
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    UFLAGG
     C                   END
     C                   END
     C*
     C   30              MOVE      'SPO0032'     MSGNR
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     VLHENT        BEGSR
     C***********************************************
     C*** SJEKKE OM BRUKER HAR VALGT NOEN OPSJONER. HVIS IKKE, SETTER
     C*** IND. 98 PÅ OG GIR FEILMELDING TIL BRUKER.
     C*** OPSJON 5 ---> VISE DETALJER AV POST.
     C*** LINNBR, POSNBR ---> RETUR POSISJON AV CURSOR
     C                   SETOFF                                       919299
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C   98              DO
     C   99              SETOFF                                       98
     C   98              MOVE      'DIV0012'     MSGNR
     C   98              SETON                                            30
     C                   Z-ADD     1             LINNBR
     C                   GOTO      SLHENT
     C                   END
     C     ZRECNO        DIV       17            LINNBR
     C                   MVR                     XLIN              2 0
     C     XLIN          IFEQ      0
     C                   Z-ADD     17            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
N01  C     WSNR          IFEQ      '8'
N04  C     WSNR          OREQ      '5'
N01  C                   MOVE      ' '           WSNR
N01  C                   UPDATE    SUBFIL
N01  C                   SETON                                        99
N01  C     SVVKTB        IFEQ      0
N01  C     SVBELT        ANDEQ     0
N01  C     SVNTM         ANDEQ     0
N01  C                   SETON                                        38
N01  C                   ELSE
N01  C                   SETOFF                                       38
N01  C                   END
N01  C                   EXSR      FULMOD
N01  C   12              GOTO      SLHENT
N01  C                   END
     C                   END
     C*
     C     SLHENT        TAG
     C                   ADD       4             LINNBR
     C                   Z-ADD     2             POSNBR
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     FINSUM        BEGSR
     C***********************************************
     C*** SUMMERE TOLLVERDIER PÅ HVER ENKEL POST OG REGNE DIFFERANSE.
     C                   MOVE      *ZEROS        W2VSUM
     C                   MOVE      *ZEROS        XAVGTT
     C     KODVAK        CHAIN     KODTVA                             34
     C     SEBEL1        MULT(H)   SEVKU         XWORK2           17 5
     C   34SEVAL1        IFEQ      'IEP'
     C                   Z-ADD     1             KVAOMR
     C                   ELSE
     C                   Z-ADD     100           KVAOMR
     C                   END
     C                   DIV(H)    KVAOMR        XWORK2
     C     SEFTG2        IFEQ      '-'
     C     SEFTG2        OREQ      'M'
     C                   SUB       SEBEL3        XWORK2
     C                   ELSE
     C                   ADD       SEBEL3        XWORK2
     C                   END
     C                   IF        SEBEL1 = 0
     C                   MOVE      *ZEROS        XWORK2
     C                   ELSE
     C                   DIV(H)    SEBEL1        XWORK2
     C                   END
     C     SAEVK         SETLL     SAEV
     C*
     C     STFS          TAG
     C     SAEVK         READE     SAEV                                   33
     C  N33              DO
N07  C                   IF        SVNYL <> 'S' AND SVNYL <> 'D'
     C                   ADD       SVBELT        W2VSUM
     C     SVAVT         IFEQ      'X'
     C     SVBELT        ANDNE     0
     C     SVBELT        MULT      SVAVTP        XWORK            15 2
     C     AVGEK2        SETLL     SADAVGE
     C     AVGEK         READPE    SADAVGE                                33
     C  N33AGDTT         COMP      SEDT                                 3333
     C     *IN33         IFEQ      '0'
     C     AGPP          ANDEQ     '%'
     C                   DIV(H)    100           XWORK
     C                   ELSE
     C                   DIV(H)    1000          XWORK
     C                   END
     C                   MULT(H)   XWORK2        XWORK
     C                   ADD(H)    XWORK         XAVGTT
     C                   END
N07  C                   END
     C                   GOTO      STFS
     C                   END
     C*
     C     UBEL1         SUB       W2VSUM        W2DIFF
N05  C                   IF        XAVGTT < 100
N05  C                   EVAL      XAVGTT = 0
N05  C                   END
     C     XAVGTT        COMP      0                                      27
     C*
     C                   ENDSR
     C*
N01   ***********************************************
N01  C     FULMOD        BEGSR
N01   ***********************************************
N01  C                   MOVE      *BLANKS       VFT
N01  C                   MOVE      *ZEROS        VNT
N01  C                   MOVE      *BLANKS       VEH
N01  C                   MOVE      *BLANKS       VVT
N01  C                   MOVE      *BLANKS       TOP
N01  C                   MOVE      *BLANKS       TCR
N01   *
N01  C                   MOVE      *ZEROS        XN                1 0
N01  C                   MOVE      *ZEROS        X2                3 0
N01  C                   MOVE      *ZEROS        X3                1 0
N01  C                   IF        SVREFL <= 0
N01  C                   MOVE      SVLI          XLI               5 0
N01  C                   ELSE
N01  C                   MOVE      SVREFL        XLI
N01  C                   END
N01  C     SAEVK1        CHAIN     SAEV                               33
N06   *
N06  C     SAEVK1        CHAIN     SAEVCN                             33
N06  C   33              MOVE      *BLANKS       X_SVCNR          17
N06  C  N33              EVAL      X_SVCNR = SVCNR
N06  C  N33SAEVK1        READE     SAEVCN                                 33
N06  C  N33              EVAL      *IN36 = *ON
N06  C   33              EVAL      *IN36 = *OFF
N06  C                   EVAL      SVCNR = X_SVCNR
S03  C*                  IF        SVNTM < 0
S03  C*                  EVAL      SVNTM = SVNTM * -100
S03  C*                  END
N01   *
N01  C     SLHENTSV      TAG
N02  C                   IF        VFT(1) = *BLANKS
N02  C     HEADFK        CHAIN     HEADF                              33
N02  C  N33              EVAL      VFT(1) = HEGM1
N02  C  N33              EVAL      VFT(2) = HEGM2
N02  C                   END
N01  C                   EXFMT     BILDE
N06  C                   IF        *IN18
N06  C                   MOVE      '0'           UTYPECN
N06  C                   CALL      'SAD058'
N06  C                   PARM      SVAVD         UAVDCN            4 0
N06  C                   PARM      SVTDN         UTDNCN            7 0
N06  C                   PARM      SVLI          ULICN             5 0
N06  C                   PARM                    UCNR             17
N06  C                   PARM                    UTYPECN           1
N06  C                   GOTO      SLHENTSV
N06  C                   END
N01   *
N01  C                   ENDSR
N01   *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     HEADFK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C     SAEVK         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
N01  C     SAEVK1        KLIST
N01  C                   KFLD                    UAVD
N01  C                   KFLD                    UTDN
     C                   KFLD                    XLI
     C     SAEV1K        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    W3LI
     C     SAEV2K        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    W3VNT
     C     SAEV4K        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    W3LN
     C     AVGEK         KLIST
     C                   KFLD                    SVVNT
     C                   KFLD                    AGAKD
     C                   KFLD                    SVAVTS
     C                   MOVE      'FF'          AGAKD
     C     AVGEK2        KLIST
     C                   KFLD                    SVVNT
     C                   KFLD                    AGAKD
     C                   KFLD                    SVAVTS
     C                   KFLD                    SEDT
     C     KODVAK        KLIST
     C                   KFLD                    KVAUNI
     C                   KFLD                    SEVAL1
     C                   MOVE      'VA'          KVAUNI
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UAVD              4 0
     C                   PARM                    UTDN              7 0
     C                   PARM                    UBEL1            13 2
     C                   PARM                    UFLAGG            1 0
     C*
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
     C                   SETOFF                                       33
     C     HEADFK        CHAIN     SAEH                               33
     C*
     C                   EXSR      FINSUM
     C*
     C                   ENDSR
     C*
