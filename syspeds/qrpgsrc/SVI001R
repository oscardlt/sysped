********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 CB  GODSNUMMER
11048 * 02 CB  TESTINDIKATOR
11071 * 03 CB  PTF11 Tlf till handlæggare
11073 * 04 CB  PTF11 Syntakssjekk på alle EORI-nr
11088 * 05 CB  PTF11 Ordnat upp i deklarant
11089 * 06 CB  PTF11 Ombud typ blev feil ved kopi fra SAD Eksport
11090 * 07 CB  PTF11 Fel posisjoner på side 2 ved feil
11103 * 08 CB  PTF11 Validering av Containernummer
11XXX * 09 CB  PTF11 Test av R.21 Landkod transportmedel
11XXX * 10 CB  PTF11 Fel position Lev.villkår
********************************************************************
     FSVI001D   CF   E             WORKSTN
     F                                     INFDS(FBAREA)
     FFRISOL01  IF   E           K DISK
     F                                     RENAME(FRISOKR:FRISOK1)
     FSVIH      UF A E           K DISK
     FSVIA      UF   E           K DISK
     FSVIF      IF A E           K DISK
     FSVIF2     IF   E           K DISK    PREFIX(X_)
     F                                     RENAME(SVIFR:SVIFRX)
     FSAEH      IF   E           K DISK
     FSAEV      IF   E           K DISK
S01  F*EADF     IF   E           K DISK
N01  FHEADF     UF   E           K DISK
     FSVTHA     IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FSVTFI     IF   E             DISK
     FSVTVK     IF   E           K DISK
     FSVTPRO    IF   E           K DISK
     FSVTLV     IF   E           K DISK
     FSVTX03F   IF   E           K DISK
     FFRISOK    UF A E           K DISK
     FKODFRI    IF   E           K DISK
KING FKUNDL01   IF   E           K DISK    PREFIX(X_)
KING F                                     RENAME(KUNDR:KUNDRX)
     FSVIV      UF   E           K DISK
     FSYPARL1   IF   E           K DISK
N01  FFIRM      IF   E           K DISK
     D P               S              5U 0
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  SYRG                   1     14
     D  SYO1                   1     10
     D  SYO2                  11     12
     D                UDS
     D  UFIRM                  1      2
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    UMODE             1
     C                   PARM                    UVIH_SYAV
     C                   PARM                    UVIH_SYOP
     C                   PARM                    UVIH_SYSG
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    SVIH_SYAV     UVIH_SYAV
     C     *LIKE         DEFINE    SVIH_SYOP     UVIH_SYOP
     C     *LIKE         DEFINE    SVIH_SYSG     UVIH_SYSG
     C     *LIKE         DEFINE    SVIH_TUID     UVIH_TUID
     C     *LIKE         DEFINE    SEAVD         Z_SEAVD
     C     *LIKE         DEFINE    SETDN         Z_SETDN
     C     *LIKE         DEFINE    SVIF_VAKD     ÅVIF_VAKD
     C     *LIKE         DEFINE    SVIF_VAKU     ÅVIF_VAKU
     C     *LIKE         DEFINE    SVIF_FABL     ÅVIF_FABL
     C     *LIKE         DEFINE    SVIH_FABL     ZVIH_FABL
     C     *LIKE         DEFINE    *IN03         WIN03
     C     *LIKE         DEFINE    *IN12         WIN12
     C     *LIKE         DEFINE    SVVK_KD       ZVVK_KD
     C     *LIKE         DEFINE    SVVK_DTS      ZVVK_DTS
     C     *LIKE         DEFINE    SVPR_IE       ZVPR_IE
     C     *LIKE         DEFINE    SVIH_VUFR     ZVIH_VUFR
     C     *LIKE         DEFINE    SVIH_AVPA     W_PADR
     C     *LIKE         DEFINE    FSAVD         WFSAVD
     C     *LIKE         DEFINE    FSOPD         WFSOPD
     C     *LIKE         DEFINE    FSKODE        WFSKODE
     C     *LIKE         DEFINE    SYKUNR        WSYKUNR
     C     *LIKE         DEFINE    SYPAID        WSYPAID
     C                   EVAL      ZVPR_IE='I'
     C                   EVAL      WFSKODE='TID'
     C                   EVAL      WSYPAID='SEMVA'
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     EXTREFK       KLIST
     C                   KFLD                    WSKODE            3
     C                   KFLD                    EXTREF
     C                   MOVEL     '*CR'         WSKODE
     C     ZKEY          KLIST
     C                   KFLD                    ZVIH_SYAV
     C                   KFLD                    ZVIH_SYOP
     C     XKEY          KLIST
     C                   KFLD                    XVIH_SYAV
     C                   KFLD                    XVIH_SYOP
     C     SADKEY        KLIST
     C                   KFLD                    Z_SEAVD
     C                   KFLD                    Z_SETDN
     C     CUNDL01K      KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    KUNDNR
     C     SVTVKKEY      KLIST
     C                   KFLD                    ZVVK_KD
     C                   KFLD                    ZVVK_DTS
     C     SVTPROKEY     KLIST
     C                   KFLD                    ZVPR_IE
     C                   KFLD                    XVIH_EUP1
     C     SVTX03K       KLIST
     C                   KFLD                    UIE
     C                   KFLD                    UTYP
     C                   KFLD                    UKD
     C     FRIKEY        KLIST
     C                   KFLD                    WFSAVD
     C                   KFLD                    WFSOPD
     C                   KFLD                    WFSKODE
     C     FRIKEY2       KLIST
     C                   KFLD                    ZVIH_SYAV
     C                   KFLD                    ZVIH_SYOP
     C                   KFLD                    WFSKODE2          3
     C                   MOVE      '*CR'         WFSKODE2
     C     SVIFKEY2      KLIST
     C                   KFLD                    ZVIH_SYAV
     C                   KFLD                    ZVIH_SYOP
     C                   KFLD                    WFATY2            4
     C     SYPARKEY      KLIST
     C                   KFLD                    WSYKUNR
     C                   KFLD                    WSYPAID
      *___________________
      * Dummy read av SVIF
      *"""""""""""""""""""
     C     *IN30         IFEQ      *OFF
     C     *IN30         ANDEQ     *ON
     C                   READ      SVIF
     C                   ENDIF
      *_________________________________
      * Hæmta dagens datum och klockslag
      *"""""""""""""""""""""""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVEL     WDT           ZVVK_DTS
      *________________________
      * Hæmta firmaupplysningar
      *""""""""""""""""""""""""
     C     1             CHAIN     SVTFI
N01  C     UFIRM         CHAIN     FIRM
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
     C                   EVAL      ZVIH_SYAV=UVIH_SYAV
     C                   EVAL      ZVIH_SYOP=UVIH_SYOP
     C                   EVAL      ZVIH_SYSG=UVIH_SYSG
     C                   EVAL      *IN30=*OFF
     C                   IF        UMODE='N'
     C                   EVAL      ZVIH_SYOP=0
     C                   ELSE
     C                   GOTO      SRB2
     C                   ENDIF

      *_______________
      * Behandle bilde
      *"""""""""""""""
     C     SRB1          TAG

     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     SVI001DØ
     C                   EXFMT     SVI001DA
      *_______________
      * F3,F12=Avlsutt
      *"""""""""""""""
     C                   IF         *IN03
     C                   GOTO      SRB9
     C                   ENDIF
     C                   IF         *IN12
     C                   GOTO      SRB9
     C                   ENDIF
      *_______
      * F4=Søk
      *"""""""
      *___________
      * Test input
      *"""""""""""
     C     SRB2          TAG
      * Avdeling får ikke vare 0 og må finnes
     C     ZVIH_SYAV     CHAIN(N)  SVIA                               30
     C                   IF        *IN30
     C                   EVAL      *IN31=*ON
     C                   MOVE      'SVI0001'     ZMSGNO
     C                   EVAL      LINNBR=6
     C                   EVAL      POSNBR=27
     C                   GOTO      SRB1
     C                   ENDIF
      * Signatur får ikke vare blank
     C     ZVIH_SYSG     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN32=*ON
     C                   MOVE      'SVI0002'     ZMSGNO
     C                   EVAL      LINNBR=8
     C                   EVAL      POSNBR=27
     C                   GOTO      SRB1
     C                   ENDIF
      * Signatur må finnes
     C     ZVIH_SYSG     CHAIN     SVTHA                              30
     C                   IF        *IN30
     C                   EVAL      *IN32=*ON
     C                   MOVE      'SVI0002'     ZMSGNO
     C                   EVAL      LINNBR=8
     C                   EVAL      POSNBR=27
     C                   GOTO      SRB1
     C                   ENDIF
      * F4 søk
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN04         IFEQ      '1'
     C     LINNBR        ANDEQ     9
     C                   CALL      'SYGE47R'
     C                   PARM      'A'           UHEUR             1
     C                   PARM                    EXTREF
     C                   EVAL      *IN04=*OFF
     C     EXTREF        IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   GOTO      SRB1
     C                   ENDIF
     C                   ENDIF
      *
      * HENT EKSTERNREF
      *
     C     EXTREF        IFNE      *BLANKS
     C     ZVIH_SYOP     ANDEQ     0
     C     EXTREFK       CHAIN     FRISOL01                           99
      * gjør forsøk på ny oppdatering
     C   99              DO
     c                   move      *zeros        nyopd             7 0
     c                   move      UVIH_SYAV     UAVD              4 0
     c                   move      ZVIH_SYSG     WSSG              3
     C                   CALL      'SADEXT'
     C                   PARM                    UAVD
     C                   PARM                    EXTREF
     C                   PARM                    nyopd
     C                   PARM                    WSSG
     C     EXTREFK       CHAIN     FRISOL01                           99
     C                   END
     C     *IN99         IFEQ      '0'
     C                   MOVE      FSAVD         ZVIH_SYAV
     C                   Z-ADD     FSOPD         ZVIH_SYOP
     C                   ELSE
     C                   MOVE      'SVI0048'     ZMSGNO
     C                   EVAL      LINNBR=9
     C                   EVAL      POSNBR=27
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN32=*ON
     C                   GOTO      SRB1
     C                   END
     C                   END
      * Hent tolldeklarasjon
     C     ZKEY          CHAIN(N)  SVIH                               51
      * Kombinasjon av å lage ny ikke lov med gammelt nummer.
      * switcher isteden til endringsmode
     C     *IN51         IFEQ      *OFF
     C     UMODE         IFNE      'D'
     C                   MOVE      'E'           UMODE
     C                   ENDIF
     C                   ENDIF
      *
      * HENT EKSTERNREF uansett
     C     FRIKEY2       CHAIN(N)  FRISOK                             99
     C  N99              MOVEL     FSSOK         EXTREF
      *
      * Hvis avdeling er utfyllt men ikke oppdrag, lag ny
      * Hvis dekl. finnes, gå videre for vedlikehold.
      * Hvis ikke, prøv i 2 steg.
      * 1. Hent fra Norsk SAD Eksport
      * 2. Hent fra Oppdrag
      *_______
      * Lag ny
      *"""""""
     C     *IN51         IFEQ      *ON
     C     ZVIH_SYOP     ANDEQ     0
     C                   CLEAR                   SVI001DB
     C                   CLEAR                   SVI001DC
     C     UMODE         COMP      'D'                                    27
      * Hent neste tolldeklarasjonsnummer
     C     ZVIH_SYAV     CHAIN     SVIA                               52
     C                   ADD       1             SVIA_SYOP
     C     UMODE         IFNE      'D'
     C                   UPDATE    SVIAR
     C                   ENDIF
     C                   MOVEL     EXTREF        EXTREF2
     C                   EVAL      ZVIH_SYOP=SVIA_SYOP
      * legg in ombudsupplysningar från avdelningsreg.
     C                   EVAL      XVIH_OMEO=SVIA_OMEO
     C                   EVAL      XVIH_OMHA=SVTH_NAMN
S03  C*                  EVAL      XVIH_OMTL=SVIA_OMTL
N03  C                   EVAL      XVIH_OMTL=SVTH_TLF
     C                   EVAL      XVIH_OMTY=SVIA_OMTY
N02  C                   EVAL      XVIH_0035=SVIA_0035
      * Andra defaultupplysningar
     C                   EVAL      XVIH_MTYP='DNU'
     C                   EVAL      XVIH_TART='1'
     C                   EVAL      XVIH_DEK1='EU'
     C                   EVAL      XVIH_UPPS=' '
     C                   EVAL      XVIH_EUP1='4000'
     C                   IF        SVTF_0035='1'
     C                   EVAL      XVIH_GOLK='AZZ'
     C                   ENDIF
      * Lag tullid
     C                   CALL      'SVG001R'
     C                   PARM                    XVIH_TUID
     C                   EVAL      UVIH_TUID=XVIH_TUID

     C                   EVAL      XVIH_SYAV=ZVIH_SYAV
     C                   EVAL      XVIH_SYOP=ZVIH_SYOP
     C                   EVAL      XVIH_SYSG=ZVIH_SYSG
     C                   GOTO      SRB3
     C                   ENDIF
      *_________________________
      * Deklarasjon fantes, vedl.
      *""""""""""""""""""""""""""
     C                   IF        *IN51=*off
     C                   CLEAR                   SVI001DB
     C                   CLEAR                   SVI001DC
     C     UMODE         COMP      'D'                                    27
     C                   MOVEL     EXTREF        EXTREF2
     C                   EVAL      XVIH_SYAV=SVIH_SYAV
     C                   EVAL      XVIH_SYOP=SVIH_SYOP
     C                   EVAL      XVIH_SYSG=SVIH_SYSG
     C                   EVAL      XVIH_TUID=SVIH_TUID
     C                   EVAL      XVIH_MTYP=SVIH_MTYP
     C                   EVAL      XVIH_TART=SVIH_TART
     C                   EVAL      XVIH_DEK1=SVIH_DEK1
     C                   EVAL      XVIH_DEK2=SVIH_DEK2
     C                   EVAL      XVIH_AVKN=SVIH_AVKN
     C                   EVAL      XVIH_AVEO=SVIH_AVEO
     C                   EVAL      XVIH_AVNA=SVIH_AVNA
     C                   EVAL      XVIH_AVA1=SVIH_AVA1
     C                   EVAL      XVIH_AVA2=SVIH_AVA2
     C                   EVAL      XVIH_AVPN=SVIH_AVPN
     C                   EVAL      XVIH_AVPA=SVIH_AVPA
     C                   EVAL      XVIH_AVLK=SVIH_AVLK
     C                   EVAL      XVIH_MOKN=SVIH_MOKN
     C                   EVAL      XVIH_MOEO=SVIH_MOEO
     C                   EVAL      XVIH_MONA=SVIH_MONA
     C                   EVAL      XVIH_MOA1=SVIH_MOA1
     C                   EVAL      XVIH_MOA2=SVIH_MOA2
     C                   EVAL      XVIH_MOPN=SVIH_MOPN
     C                   EVAL      XVIH_MOPA=SVIH_MOPA
     C                   EVAL      XVIH_MOLK=SVIH_MOLK
     C                   EVAL      XVIH_MOHA=SVIH_MOHA
     C                   EVAL      XVIH_MOTL=SVIH_MOTL
     C                   EVAL      XVIH_DKKN=SVIH_DKKN
     C                   EVAL      XVIH_DKEO=SVIH_DKEO
     C                   EVAL      XVIH_DKHA=SVIH_DKHA
     C                   EVAL      XVIH_DKNA=SVIH_DKNA
     C                   EVAL      XVIH_DKA1=SVIH_DKA1
     C                   EVAL      XVIH_DKA2=SVIH_DKA2
     C                   EVAL      XVIH_DKPN=SVIH_DKPN
     C                   EVAL      XVIH_DKPA=SVIH_DKPA
     C                   EVAL      XVIH_DKTL=SVIH_DKTL
     C                   EVAL      XVIH_DKLK=SVIH_DKLK
     C                   EVAL      XVIH_OMEO=SVIH_OMEO
     C                   EVAL      XVIH_OMHA=SVIH_OMHA
     C                   EVAL      XVIH_OMTL=SVIH_OMTL
     C                   EVAL      XVIH_OMTY=SVIH_OMTY
N02  C                   EVAL      XVIH_0035=SVIH_0035
     C                   EVAL      XVIH_VUFO=SVIH_VUFO
     C                   EVAL      XVIH_VUFR=SVIH_VUFR
     C                   EVAL      XVIH_VUVA=SVIH_VUVA
     C                   EVAL      XVIH_VUKU=SVIH_VUKU
     C                   EVAL      XVIH_VAKD=SVIH_VAKD
     C                   EVAL      XVIH_FABL=SVIH_FABL
     C                   EVAL      XVIH_VAKU=SVIH_VAKU
     C                   EVAL      XVIH_FATY=SVIH_FATY
     C                   EVAL      XVIH_FATX=SVIH_FATX
     C                   EVAL      XVIH_OVKO=SVIH_OVKO
     C                   EVAL      XVIH_KARA=SVIH_KARA
     C                   EVAL      XVIH_ANRA=SVIH_ANRA
     C                   EVAL      XVIH_UPPS=SVIH_UPPS
     C                   EVAL      XVIH_AVUT=SVIH_AVUT
     C                   EVAL      XVIH_TRAI=SVIH_TRAI
     C                   EVAL      XVIH_TRAL=SVIH_TRAL
     C                   EVAL      XVIH_TRGR=SVIH_TRGR
     C                   EVAL      XVIH_TRIN=SVIH_TRIN
     C                   EVAL      XVIH_CONT=SVIH_CONT
     C                   EVAL      XVIH_LEKD=SVIH_LEKD
     C                   EVAL      XVIH_LEOR=SVIH_LEOR
     C                   EVAL      XVIH_GOLK=SVIH_GOLK
     C                   EVAL      XVIH_EUP1=SVIH_EUP1
     C                   EVAL      XVIH_EUP2=SVIH_EUP2
     C                   EVAL      XVIH_KOTA=SVIH_KOTA
     C                   EVAL      XVIH_BRUT=SVIH_BRUT
     C                   EVAL      XVIH_KENH=SVIH_KENH
     C                   EVAL      XVIH_KLEO=SVIH_KLEO
     C                   EVAL      XVIH_TRNR=SVIH_TRNR
     C                   EVAL      XVIH_AUKD=SVIH_AUKD
     C                   EVAL      XVIH_RFAC=SVIH_RFAC
     C                   EVAL      XVIH_RFAC2=SVIH_RFAC2
     C                   EVAL      XVIH_KVAL=SVIH_KVAL
N01  C                   EVAL      XVIH_GODN=SVIH_GODN
      * Uppdatera status
     C     ZKEY          CHAIN     SVIH                               51
     C     *IN51         IFEQ      *OFF
     C     UMODE         IFNE      'D'
     C                   EVAL      SVIH_SYST='E'
     C                   ENDIF
     C                   UPDATE    SVIHR
     C                   ENDIF
     C                   GOTO      SRB3
     C                   ENDIF
      *_________________________________________________
      * Kopier fra SAD Eksport (og bitte lite fra HEADF)
      *"""""""""""""""""""""""""""""""""""""""""""""""""
     C     *IN51         IFEQ      *ON
     C     ZVIH_SYOP     ANDNE     0
     C                   EVAL      Z_SEAVD=ZVIH_SYAV
     C                   EVAL      Z_SETDN=ZVIH_SYOP
     C     SADKEY        CHAIN     SAEH                               52
     C     *IN52         IFEQ      *OFF

     C                   CLEAR                   SVI001DB
     C                   CLEAR                   SVI001DC
     C     UMODE         COMP      'D'                                    27
     C                   EVAL      XVIH_TUID=UVIH_TUID
     C                   EVAL      XVIH_SYAV=ZVIH_SYAV
     C                   EVAL      XVIH_SYOP=ZVIH_SYOP
     C                   EVAL      XVIH_SYSG=ZVIH_SYSG
      * Lag tullid
     C                   CALL      'SVG001R'
     C                   PARM                    XVIH_TUID
     C                   EVAL      UVIH_TUID=XVIH_TUID

     C                   EVAL      XVIH_MTYP='DNU'
     C                   EVAL      XVIH_TART='1'
     C                   EVAL      XVIH_DEK1='EU'
     C                   EVAL      XVIH_DEK2='A'
     C                   EVAL      XVIH_EUP1='4000'
     C                   EVAL      XVIH_UPPS=' '
     C                   IF        SVTF_0035='1'
     C                   EVAL      XVIH_GOLK='AZZ'
     C                   ENDIF
     C                   EVAL      XVIH_AVKN=SEKNK
     C                   EVAL      XVIH_AVNA=SENAK
     C                   EVAL      XVIH_AVA1=SEADK1
     C                   EVAL      XVIH_AVA2=SEADK2
     C                   EVAL      P = %SCAN (' ' : SEADK3)
     C                   EVAL      XVIH_AVPN=%SUBST(SEADK3:1:P)
     C                   EVAL      W_PADR=%SUBST(SEADK3:P+1)
     C                   EVAL      XVIH_AVPA=%triml(W_PADR)
     C                   EVAL      XVIH_AVLK='NO'
      * Spesial kingsrød, hent avs. oppl fra kundereg uansett
     C     XVIH_AVKN     IFNE      0
     C                   MOVE      XVIH_AVKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            35
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN35=*OFF
     C                   EVAL      XVIH_AVNA = KNAVN
     C                   EVAL      XVIH_AVA1 = ADR1
     C                   EVAL      XVIH_AVA2 = ADR2
     C                   IF        POSTNR = 0
      *
     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XVIH_AVPN=%SUBST(SYPOGE:P:Q)
      *
     C                   ELSE
     C                   EVAL      XVIH_AVPN = *BLANKS
     C                   MOVEL     POSTNR        XVIH_AVPN
     C                   ENDIF
     C                   MOVEL     ADR3          XVIH_AVPA
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XVIH_AVLK = SYLAND
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *
     C                   EVAL      XVIH_MOKN=SEKNS
     C                   EVAL      XVIH_MONA=SENAS
     C                   EVAL      XVIH_MOA1=SEADS1
     C                   EVAL      XVIH_MOA2=SEADS2
     C                   EVAL      P = %SCAN (' ' : SEADS3)
     C                   EVAL      XVIH_MOPN=%SUBST(SEADS3:1:P)
     C                   EVAL      W_PADR=%SUBST(SEADS3:P+1)
     C                   EVAL      XVIH_MOPA=%triml(W_PADR)
     C                   EVAL      XVIH_MOLK=SELKB
     C                   EVAL      XVIH_MOHA=*BLANKS
     C                   EVAL      XVIH_MOTL=' '
     C                   EVAL      XVIH_OMEO=SVIA_OMEO
     C                   EVAL      XVIH_OMHA=SVTH_NAMN
S03  C*                  EVAL      XVIH_OMTL=SVIA_OMTL
N03  C                   EVAL      XVIH_OMTL=SVTH_TLF
     C*                  EVAL      XVIH_OMTY='2'
N06  C                   EVAL      XVIH_OMTY=SVIA_OMTY
     C                   EVAL      XVIH_AVUT='NO'
     C                   EVAL      XVIH_VAKD=SEVAL1
     C                   EVAL      XVIH_FABL=SEBEL1
     C                   MOVEL     '3'           XVIH_TRGR
     C                   MOVEL     '3'           XVIH_TRIN
     C                   EVAL      XVIH_FATY='N380'
     C                   EVAL      XVIH_FATX=SEFIF
     C                   EVAL      XVIH_TRAI=SETRID
     C                   EVAL      XVIH_TRAL=SELKT
     C                   EVAL      XVIH_CONT=SEKDC
     C                   EVAL      XVIH_LEKD=SELV
     C     XVIH_LEKD     IFEQ      'DDP'
     C                   MOVEL     XVIH_MOPA     XVIH_LEOR
     C                   ENDIF
     C                   EVAL      XVIH_KOTA=SENTK
     C                   EVAL      XVIH_BRUT=SEVKB
     C     SADKEY        SETLL     SAEV
     C     SADKEY        READE     SAEV                                   40
      * hæmta kundinfo
     C     XVIH_MOKN     IFNE      0
     C                   MOVE      XVIH_MOKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            40
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN40=*OFF
     C     XVIH_MOEO     IFEQ      *BLANKS
     C     EORI          IFNE      *BLANKS
     C                   EVAL      XVIH_MOEO=EORI
     C                   ELSE
KING C*    SYLAND        IFNE      'NO'
KING C*                  MOVEL     X_RNRAKU      XVIH_MOEO
KING C*                  ELSE
     C                   MOVEL(P)  SYLAND        XVIH_MOEO
     C                   CAT       SYRG:0        XVIH_MOEO
     C                   CAT       '00':0        XVIH_MOEO
     C                   IF        SYRG=*BLANKS
     C                   MOVEL(P)  SYLAND        XVIH_MOEO
     C                   CAT       VATKKU:0      XVIH_MOEO
     C                   ENDIF
KING C*                  ENDIF
     C                   ENDIF
     C                   ENDIF
     C     XVIH_MOHA     IFEQ      *BLANKS
     C                   EVAL      XVIH_MOHA = KPERS
     C                   ENDIF
     C     XVIH_MOTL     IFEQ      *BLANKS
     C                   EVAL      XVIH_MOTL = TLF
     C                   ENDIF
     C     XVIH_MOLK     IFEQ      *BLANKS
     C                   EVAL      XVIH_MOLK = SYLAND
     C                   ENDIF
      * Spesial for Kingrød, hent mott.oppl fra kundereg uansett
     C                   EVAL      XVIH_MONA = KNAVN
     C                   EVAL      XVIH_MOA1 = ADR1
     C                   EVAL      XVIH_MOA2 = ADR2
     C                   IF        POSTNR = 0

     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XVIH_MOPN=%SUBST(SYPOGE:P:Q)

     C                   ELSE
     C                   EVAL      XVIH_MOPN = *BLANKS
     C                   MOVEL     POSTNR        XVIH_MOPN
     C                   ENDIF
     C                   EVAL      XVIH_MOPA = ADR3
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XVIH_MOLK = SYLAND
     C                   ENDIF
     C                   EVAL      XVIH_MOTL = TLF
      * Hent godslokalkode fra CUNDF
     C     XVIH_GOLK     IFEQ      *BLANKS
     C                   EVAL      XVIH_GOLK=GOLK
     C                   ENDIF

     C                   ENDIF
     C                   ENDIF
     C     XVIH_MOHA     IFEQ      *BLANKS
     C                   EVAL      XVIH_MOHA=SVTH_NAMN
S03  C*                  EVAL      XVIH_MOTL=SVIA_OMTL
N03  C                   EVAL      XVIH_OMTL=SVTH_TLF
     C                   ENDIF
      *Og bitte lite til fra HEADF
S01  C*    SADKEY        CHAIN     HEADF                              52
N01  C     SADKEY        CHAIN(N)  HEADF                              52
     C     *IN52         IFEQ      *OFF
     C                   EVAL      XVIH_TRAI=HEHAWB
N01  C                   IF        FILAND='SE'
N01  C                   EVAL      XVIH_GODN=HEGN
N01  C                   ENDIF
     C                   ENDIF
      * Førfarande
     C     XVIH_MOLK     IFNE      'SE'
     C                   EVAL      XVIH_EUP1='4200'
     C                   ENDIF
      * Kopier varelinjer
     C                   CALL      'SVI009R'
     C                   PARM                    ZVIH_SYAV
     C                   PARM                    ZVIH_SYOP
     C                   PARM                    XVIH_EUP1
      * Legg in standardtext i rubrik 44 om PROC=4200
     C                   IF        XVIH_EUP1='4200'

     C     XVIH_OMEO     IFNE      *BLANKS
     C                   CLEAR                   SVIFR
     C                   EVAL      SVIF_SYAV=ZVIH_SYAV
     C                   EVAL      SVIF_SYOP=ZVIH_SYOP
     C                   EVAL      SVIF_FATY='Y040'
     C                   EVAL      SVIF_FATX=XVIH_OMEO
     C                   EVAL      WSYKUNR=XVIH_AVKN
     C     SYPARKEY      CHAIN     SYPARL1                            40
     C     *IN40         IFEQ      *OFF
     C     SYVRDA        ANDNE     *BLANKS
     C                   MOVE      *BLANKS       SVIF_FATX
     C                   MOVEL     SYVRDA        SVIF_FATX
     C                   ENDIF
     C                   WRITE     SVIFR
     C                   ENDIF



     C     XVIH_MOEO     IFNE      *BLANKS
     C                   CLEAR                   SVIFR
     C                   EVAL      SVIF_SYAV=ZVIH_SYAV
     C                   EVAL      SVIF_SYOP=ZVIH_SYOP
     C                   EVAL      SVIF_FATY='Y041'
     C                   EVAL      SVIF_FATX=XVIH_MOEO
     C                   WRITE     SVIFR
     C                   ENDIF

     C                   ENDIF

     C                   GOTO      SRB3
     C                   ENDIF
     C                   ENDIF
      *___________________
      * Kopier fra oppdrag
      *"""""""""""""""""""
     C     *IN51         IFEQ      *ON
     C     ZVIH_SYOP     ANDNE     0
     C                   EVAL      Z_SEAVD=ZVIH_SYAV
     C                   EVAL      Z_SETDN=ZVIH_SYOP
S01  C*    SADKEY        CHAIN     HEADF                              52
N01  C     SADKEY        CHAIN(N)  HEADF                              52
     C     *IN52         IFEQ      *OFF

     C                   CLEAR                   SVI001DB
     C                   CLEAR                   SVI001DC
     C     UMODE         COMP      'D'                                    27
     C                   EVAL      XVIH_TUID=UVIH_TUID
     C                   EVAL      XVIH_SYAV=ZVIH_SYAV
     C                   EVAL      XVIH_SYOP=ZVIH_SYOP
     C                   EVAL      XVIH_SYSG=ZVIH_SYSG
      * Lag tullid
     C                   CALL      'SVG001R'
     C                   PARM                    XVIH_TUID
     C                   EVAL      UVIH_TUID=XVIH_TUID

     C                   EVAL      XVIH_MTYP='DNU'
     C                   EVAL      XVIH_TART='1'
     C                   EVAL      XVIH_DEK1='EU'
     C                   EVAL      XVIH_DEK2='A'
     C                   EVAL      XVIH_EUP1='4000'
     C                   EVAL      XVIH_UPPS=' '
     C                   IF        SVTF_0035='1'
     C                   EVAL      XVIH_GOLK='AZZ'
     C                   ENDIF
     C                   EVAL      XVIH_AVKN=HEKNS
     C                   EVAL      XVIH_AVNA=HENAS
     C                   EVAL      XVIH_AVA1=HEADS1
     C                   EVAL      XVIH_AVA2=HEADS2
     C                   EVAL      P = %SCAN (' ' : HEADS3)
     C                   EVAL      XVIH_AVPN=%SUBST(HEADS3:1:P)
     C                   EVAL      W_PADR=%SUBST(HEADS3:P+1)
     C                   EVAL      XVIH_AVPA=%triml(W_PADR)
     C                   EVAL      XVIH_AVLK=HELKS
      * Spesial kingsrød, hent avs. oppl fra kundereg uansett
     C     XVIH_AVKN     IFNE      0
     C                   MOVE      XVIH_AVKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            35
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN35=*OFF
     C                   EVAL      XVIH_AVNA = KNAVN
     C                   EVAL      XVIH_AVA1 = ADR1
     C                   EVAL      XVIH_AVA2 = ADR2
     C                   IF        POSTNR = 0
      *
     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XVIH_AVPN=%SUBST(SYPOGE:P:Q)
      *
     C                   ELSE
     C                   EVAL      XVIH_AVPN = *BLANKS
     C                   MOVEL     POSTNR        XVIH_AVPN
     C                   ENDIF
     C                   MOVEL     ADR3          XVIH_AVPA
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XVIH_AVLK = SYLAND
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *
     C                   EVAL      XVIH_MOKN=HEKNK
     C                   EVAL      XVIH_MONA=HENAK
     C                   EVAL      XVIH_MOA1=HEADK1
     C                   EVAL      XVIH_MOA2=HEADK2
     C                   EVAL      P = %SCAN (' ' : HEADK3)
     C                   EVAL      XVIH_MOPN=%SUBST(HEADK3:1:P)
     C                   EVAL      W_PADR=%SUBST(HEADK3:P+1)
     C                   EVAL      XVIH_MOPA=%triml(W_PADR)
     C                   EVAL      XVIH_MOLK='  '
     C                   EVAL      XVIH_OMEO=SVIA_OMEO
     C                   EVAL      XVIH_OMHA=SVTH_NAMN
S03  C*                  EVAL      XVIH_OMTL=SVIA_OMTL
N03  C                   EVAL      XVIH_OMTL=SVTH_TLF
     C*                  EVAL      XVIH_OMTY='2'
N06  C                   EVAL      XVIH_OMTY=SVIA_OMTY
     C                   EVAL      XVIH_AVUT=HELKA
     C                   EVAL      XVIH_KOTA=HENT
     C                   EVAL      XVIH_BRUT=HEVKT
     C                   MOVEL     HETRC         XVIH_CONT
     C                   MOVEL     '3'           XVIH_TRGR
     C                   MOVEL     '3'           XVIH_TRIN
     C                   EVAL      XVIH_TRAL=HETRI
     C                   EVAL      XVIH_LEKD=HEFR
     C     XVIH_LEKD     IFEQ      'DDP'
     C                   MOVEL     XVIH_MOPA     XVIH_LEOR
     C                   ENDIF
     C                   EVAL      XVIH_TRAI=HEHAWB
     C     XVIH_TRAI     IFEQ      *BLANKS
     C                   EVAL      XVIH_TRAI=HETRCN
     C                   ENDIF
     C                   EVAL      XVIH_FATY='N380'
N01  C                   IF        FILAND='SE'
N01  C                   EVAL      XVIH_GODN=HEGN
N01  C                   ENDIF
      * hæmta kundinfo
     C     XVIH_MOKN     IFNE      0
     C                   MOVE      XVIH_MOKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            40
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN40=*OFF
     C     XVIH_MOEO     IFEQ      *BLANKS
     C     EORI          IFNE      *BLANKS
     C                   EVAL      XVIH_MOEO=EORI
     C                   ELSE
KING C*    SYLAND        IFNE      'NO'
KING C*                  MOVEL     X_RNRAKU      XVIH_MOEO
KING C*                  ELSE
     C                   MOVEL(P)  SYLAND        XVIH_MOEO
     C                   CAT       SYRG:0        XVIH_MOEO
     C                   CAT       '00':0        XVIH_MOEO
     C                   IF        SYRG=*BLANKS
     C                   MOVEL(P)  SYLAND        XVIH_MOEO
     C                   CAT       VATKKU:0      XVIH_MOEO
     C                   ENDIF
KING C*                  ENDIF
     C                   ENDIF
     C                   ENDIF
     C     XVIH_MOHA     IFEQ      *BLANKS
     C                   EVAL      XVIH_MOHA = KPERS
     C                   ENDIF
     C     XVIH_MOTL     IFEQ      *BLANKS
     C                   EVAL      XVIH_MOTL = TLF
     C                   ENDIF
     C     XVIH_MOLK     IFEQ      *BLANKS
     C                   EVAL      XVIH_MOLK = SYLAND
     C                   ENDIF
      * Spesial for Kingrød, hent mott.oppl fra kundereg uansett
     C                   EVAL      XVIH_MONA = KNAVN
     C                   EVAL      XVIH_MOA1 = ADR1
     C                   EVAL      XVIH_MOA2 = ADR2
     C                   IF        POSTNR = 0
      *
     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XVIH_MOPN=%SUBST(SYPOGE:P:Q)
      *
     C                   ELSE
     C                   EVAL      XVIH_MOPN = *BLANKS
     C                   MOVEL     POSTNR        XVIH_MOPN
     C                   ENDIF
     C                   EVAL      XVIH_MOPA = ADR3
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XVIH_MOLK = SYLAND
     C                   ENDIF
     C                   EVAL      XVIH_MOTL = TLF
      * Hent godslokalkode fra CUNDF
     C     XVIH_GOLK     IFEQ      *BLANKS
     C                   EVAL      XVIH_GOLK=GOLK
     C                   ENDIF
      *
     C                   ENDIF
     C                   ENDIF
     C     XVIH_MOHA     IFEQ      *BLANKS
     C                   EVAL      XVIH_MOHA=SVTH_NAMN
S03  C*                  EVAL      XVIH_MOTL=SVIA_OMTL
N03  C                   EVAL      XVIH_MOTL=SVTH_TLF
     C                   ENDIF
      * Førfarande
     C     XVIH_MOLK     IFNE      'SE'
     C                   EVAL      XVIH_EUP1='4200'
     C                   ENDIF
      * Legg in standardtext i rubrik 44 om PROC=4200
     C                   IF        XVIH_EUP1='4200'

     C     XVIH_OMEO     IFNE      *BLANKS
     C                   CLEAR                   SVIFR
     C                   EVAL      SVIF_SYAV=ZVIH_SYAV
     C                   EVAL      SVIF_SYOP=ZVIH_SYOP
     C                   EVAL      SVIF_FATY='Y040'
     C                   EVAL      SVIF_FATX=XVIH_OMEO
     C                   EVAL      WSYKUNR=XVIH_AVKN
     C     SYPARKEY      CHAIN     SYPARL1                            40
     C     *IN40         IFEQ      *OFF
     C     SYVRDA        ANDNE     *BLANKS
     C                   MOVE      *BLANKS       SVIF_FATX
     C                   MOVEL     SYVRDA        SVIF_FATX
     C                   ENDIF
     C                   WRITE     SVIFR
N16  C                   ENDIF


     C     XVIH_MOEO     IFNE      *BLANKS
     C                   CLEAR                   SVIFR
     C                   EVAL      SVIF_SYAV=ZVIH_SYAV
     C                   EVAL      SVIF_SYOP=ZVIH_SYOP
     C                   EVAL      SVIF_FATY='Y041'
     C                   EVAL      SVIF_FATX=XVIH_MOEO
     C                   WRITE     SVIFR
     C                   ENDIF

     C                   ENDIF

     C                   GOTO      SRB3
     C                   ENDIF
     C                   ENDIF
      *____________
      * Vis bilde-B
      *""""""""""""
     C     SRB3          TAG
     C                   EXSR      SRBB
     C                   IF        *IN03
     C                   GOTO      SRB9
     C                   ENDIF
     C                   IF        *IN12
     C                   GOTO      SRB9
     C                   ENDIF
      *____________
      * Vis bilde-C
      *""""""""""""
     C                   EXSR      SRBC
     C                   IF        *IN03
     C                   GOTO      SRB9
     C                   ENDIF
     C                   IF        *IN12
     C                   GOTO      SRB3
     C                   ENDIF

      *_____________________
      * Oppdare og gå videre
      *"""""""""""""""""""""
     C     ZKEY          CHAIN     SVIH                               51

     C                   EVAL      SVIH_SYAV=XVIH_SYAV
     C                   EVAL      SVIH_SYOP=XVIH_SYOP
     C                   EVAL      SVIH_SYSG=XVIH_SYSG
     C                   EVAL      SVIH_TUID=XVIH_TUID
     C                   EVAL      SVIH_MTYP=XVIH_MTYP
     C                   EVAL      SVIH_TART=XVIH_TART
     C                   EVAL      SVIH_DEK1=XVIH_DEK1
     C                   EVAL      SVIH_DEK2=XVIH_DEK2
     C                   EVAL      SVIH_AVKN=XVIH_AVKN
     C                   EVAL      SVIH_AVEO=XVIH_AVEO
     C                   EVAL      SVIH_AVNA=XVIH_AVNA
     C                   EVAL      SVIH_AVA1=XVIH_AVA1
     C                   EVAL      SVIH_AVA2=XVIH_AVA2
     C                   EVAL      SVIH_AVPN=XVIH_AVPN
     C                   EVAL      SVIH_AVPA=XVIH_AVPA
     C                   EVAL      SVIH_AVLK=XVIH_AVLK
     C                   EVAL      SVIH_MOKN=XVIH_MOKN
     C                   EVAL      SVIH_MOEO=XVIH_MOEO
     C                   EVAL      SVIH_MONA=XVIH_MONA
     C                   EVAL      SVIH_MOA1=XVIH_MOA1
     C                   EVAL      SVIH_MOA2=XVIH_MOA2
     C                   EVAL      SVIH_MOPN=XVIH_MOPN
     C                   EVAL      SVIH_MOPA=XVIH_MOPA
     C                   EVAL      SVIH_MOLK=XVIH_MOLK
     C                   EVAL      SVIH_MOHA=XVIH_MOHA
     C                   EVAL      SVIH_MOTL=XVIH_MOTL
     C                   EVAL      SVIH_DKKN=XVIH_DKKN
     C                   EVAL      SVIH_DKEO=XVIH_DKEO
     C                   EVAL      SVIH_DKHA=XVIH_DKHA
     C                   EVAL      SVIH_DKNA=XVIH_DKNA
     C                   EVAL      SVIH_DKA1=XVIH_DKA1
     C                   EVAL      SVIH_DKA2=XVIH_DKA2
     C                   EVAL      SVIH_DKPN=XVIH_DKPN
     C                   EVAL      SVIH_DKPA=XVIH_DKPA
     C                   EVAL      SVIH_DKTL=XVIH_DKTL
     C                   EVAL      SVIH_DKLK=XVIH_DKLK
     C                   EVAL      SVIH_OMEO=XVIH_OMEO
     C                   EVAL      SVIH_OMHA=XVIH_OMHA
     C                   EVAL      SVIH_OMTL=XVIH_OMTL
     C                   EVAL      SVIH_OMTY=XVIH_OMTY
N02  C                   EVAL      SVIH_0035=XVIH_0035
     C                   EVAL      SVIH_VUFO=XVIH_VUFO
     C                   EVAL      SVIH_VUFR=XVIH_VUFR
     C                   EVAL      SVIH_VUVA=XVIH_VUVA
     C                   EVAL      SVIH_VUKU=XVIH_VUKU
     C                   EVAL      SVIH_VAKD=XVIH_VAKD
     C                   EVAL      SVIH_FABL=XVIH_FABL
     C                   EVAL      SVIH_VAKU=XVIH_VAKU
     C                   EVAL      SVIH_FATY=XVIH_FATY
     C                   EVAL      SVIH_FATX=XVIH_FATX
     C                   EVAL      SVIH_OVKO=XVIH_OVKO
     C                   EVAL      SVIH_KARA=XVIH_KARA
     C                   EVAL      SVIH_ANRA=XVIH_ANRA
     C                   EVAL      SVIH_UPPS=XVIH_UPPS
     C                   EVAL      SVIH_AVUT=XVIH_AVUT
     C                   EVAL      SVIH_TRAI=XVIH_TRAI
     C                   EVAL      SVIH_TRAL=XVIH_TRAL
     C                   EVAL      SVIH_TRGR=XVIH_TRGR
     C                   EVAL      SVIH_TRIN=XVIH_TRIN
     C                   EVAL      SVIH_CONT=XVIH_CONT
     C                   EVAL      SVIH_LEKD=XVIH_LEKD
     C                   EVAL      SVIH_LEOR=XVIH_LEOR
     C                   EVAL      SVIH_GOLK=XVIH_GOLK
     C                   EVAL      SVIH_EUP1=XVIH_EUP1
     C                   EVAL      SVIH_EUP2=XVIH_EUP2
     C                   EVAL      SVIH_KOTA=XVIH_KOTA
     C                   EVAL      SVIH_BRUT=XVIH_BRUT
     C                   EVAL      SVIH_KENH=XVIH_KENH
     C                   EVAL      SVIH_KLEO=XVIH_KLEO
     C                   EVAL      SVIH_TRNR=XVIH_TRNR
     C                   EVAL      SVIH_AUKD=XVIH_AUKD
     C                   EVAL      SVIH_RFAC=XVIH_RFAC
     C                   EVAL      SVIH_RFAC2=XVIH_RFAC2
     C                   EVAL      SVIH_KVAL=XVIH_KVAL
N01  C                   EVAL      SVIH_GODN=XVIH_GODN

     C     UMODE         IFNE      'D'
     C                   IF        *IN51
     C                   MOVE      WDT           SVIH_SYDT
     C                   EVAL      SVIH_SGME='SD'
     C                   MOVEL     SVTH_ANN      SVIH_SGID
     C                   MOVEL     SVIH_SYAV     XVIH_RFAB        11
     C                   MOVE      SVIH_SYOP     XVIH_RFAB
     C                   MOVEL     XVIH_RFAB     SVIH_RFAB
     C                   WRITE     SVIHR
     C                   ELSE
     C                   UPDATE    SVIHR
     C                   ENDIF
N01   * Oppdater oppdraget med godsnummer hvis blankt
N01  C                   IF        FILAND='SE'
N01  C     SADKEY        CHAIN     HEADF                              40
N01  C                   IF        *IN40=*OFF
N01  C                   IF        HEGN=*BLANKS
N01  C                   EVAL      HEGN=SVIH_GODN
N01  C                   UPDATE    HEADFR
N01  C                   ENDIF
N01  C                   ENDIF
N01  C                   ENDIF
      * legg in frie søkeveier
     C                   EVAL      WFSAVD=SVIH_SYAV
     C                   EVAL      WFSOPD=SVIH_SYOP
     C     FRIKEY        CHAIN(N)  FRISOK                             40
     C                   IF        *IN40
     C     FSKODE        CHAIN     KODFRI                             40
     C                   EVAL      FSAVD=SVIH_SYAV
     C                   EVAL      FSOPD=SVIH_SYOP
     C                   EVAL      FSKODE='TID'
     C                   EVAL      FSSOK=SVIH_TUID
     C                   EVAL      FSDTOP=SVIH_SYDT
     C                   EVAL      FSDOKK=KFSODK
     C                   MOVEL     'G'           FSDOKK
     C                   WRITE     FRISOKR
     C                   ENDIF
     C                   ENDIF

     C   30              GOTO      SRB3

      *  Øver till varuposter
     C                   EXSR      CHGFORF
     C                   CALL      'SVI003R'
     C                   PARM                    XVIH_SYAV
     C                   PARM                    XVIH_SYOP
     C                   PARM                    XVIH_SYSG
     C     *IN03         PARM                    WIN03
     C     *IN12         PARM                    WIN12
     C                   PARM                    UMODE
     C     *IN03         CABEQ     *ON           SRB9
     C     *IN12         CABEQ     *ON           SRB3
     C                   GOTO      SRB1

     C     SRB9          TAG
      * Oppdater ev. status på ærendet
     C     ZKEY          CHAIN     SVIH                               51
     C     *IN51         IFEQ      *OFF
     C     SVIH_SYST     ANDEQ     'E'
     C     UMODE         IFNE      'D'
     C                   EVAL      SVIH_SYST=' '
     C                   UPDATE    SVIHR
      * legg in frie søkeveier
     C                   EVAL      WFSAVD=SVIH_SYAV
     C                   EVAL      WFSOPD=SVIH_SYOP
     C     FRIKEY        CHAIN(N)  FRISOK                             40
     C                   IF        *IN40
     C     FSKODE        CHAIN     KODFRI                             40
     C                   EVAL      FSAVD=SVIH_SYAV
     C                   EVAL      FSOPD=SVIH_SYOP
     C                   EVAL      FSKODE='TID'
     C                   EVAL      FSSOK=SVIH_TUID
     C                   EVAL      FSDTOP=SVIH_SYDT
     C                   EVAL      FSDOKK=KFSODK
     C                   WRITE     FRISOKR
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater SVI001DB                         SRBB /
      *////////////////////////////////////////////////////////////
     C     SRBB          BEGSR
      *____________
      * Vis bilde-B
      *""""""""""""
     C                   EVAL      LINNBR=3
     C                   EVAL      POSNBR=67
     C     SRBB3         TAG
      * Är F16 anvænd ?
     C     XKEY          CHAIN     SVIF                               55
     C                   IF        *IN55
     C                   EVAL      *IN49=*OFF
     C                   ELSE
     C                   EVAL      *IN49=*ON
     C                   ENDIF
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     SVI001DØ
     C                   EXFMT     SVI001DB
     C                   EVAL      *IN30 = *OFF
     C                   EVAL      *IN31 = *OFF
     C                   EVAL      *IN32 = *OFF
     C                   EVAL      *IN33 = *OFF
     C                   EVAL      *IN35 = *OFF
     C                   EVAL      *IN36 = *OFF
     C                   EVAL      *IN39 = *OFF
     C                   EVAL      *IN40 = *OFF
     C                   EVAL      *IN41 = *OFF
     C                   EVAL      *IN49 = *OFF
     C                   EVAL      *IN50 = *OFF
     C                   EVAL      *IN64 = *OFF
     C                   EVAL      *IN66 = *OFF
     C                   EVAL      *IN69 = *OFF
     C                   EVAL      *IN72 = *OFF
     C                   EVAL      *IN74 = *OFF
     C                   EVAL      *IN75 = *OFF
     C                   EVAL      *IN76 = *OFF
     C                   EVAL      *IN77 = *OFF
     C                   EVAL      *IN78 = *OFF
     C                   EVAL      *IN79 = *OFF
     C                   EVAL      *IN80 = *OFF
     C                   EVAL      *IN83 = *OFF
     C                   EVAL      *IN84 = *OFF
     C                   EVAL      *IN85 = *OFF
     C                   EVAL      *IN86 = *OFF
     C                   EVAL      *IN87 = *OFF
     C                   EVAL      *IN88 = *OFF
     C                   EVAL      *IN89 = *OFF
      *_______________
      * F3,F12=Avlsutt
      *"""""""""""""""
     C                   IF        *IN03
     C                   GOTO      SRBB9
     C                   ENDIF
     C                   IF        *IN12
     C                   GOTO      SRBB9
     C                   ENDIF
      *_______
      * F4=Søk
      *"""""""
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN04         IFEQ      '1'
      * Rubrik 37, del-1 EU-procedur
     C     LINNBR        IFEQ      4
     C     POSNBR        ANDGE     17
     C     POSNBR        ANDLE     20
     C                   CALL      'SVT006R'
     C                   PARM      'I'           UIE
     C                   PARM                    UKD2              4
     C     UKD2          IFNE      *BLANKS
     C                   MOVEL     UKD2          XVIH_EUP1
     C                   ENDIF
     C                   ENDIF
      * Rubrik 2, avsændare
     C     LINNBR        IFEQ      6
     C     POSNBR        ANDGE     9
     C     POSNBR        ANDLE     16
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    XVIH_AVKN
     C                   PARM                    UFIRM
     C                   PARM                    USØKKN
     C                   ENDIF
      * Avsændare, landkod
     C     LINNBR        IFEQ      7
     C     POSNBR        ANDGE     91
     C     POSNBR        ANDLE     92
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'I'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVIH_AVLK=UKD
     C                   ENDIF
     C                   ENDIF
      * Rubrik 8, mottagare
     C     LINNBR        IFEQ      9
     C     POSNBR        ANDGE     9
     C     POSNBR        ANDLE     16
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    XVIH_MOKN
     C                   PARM                    UFIRM
     C                   PARM                    USØKKN
     C                   ENDIF
      * Mottagare, landkod
     C     LINNBR        IFEQ      10
     C     POSNBR        ANDGE     91
     C     POSNBR        ANDLE     92
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'I'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVIH_MOLK=UKD
     C                   ENDIF
     C                   ENDIF
      * Rubrik 22, valuta
     C     LINNBR        IFEQ      13
     C     POSNBR        ANDGE     17
     C     POSNBR        ANDLE     19
     C                   CALL      'SVT007R'
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVIH_VAKD=UKD
     C                   ENDIF
     C                   ENDIF
      * Rubrik 15, landkod
     C     LINNBR        IFEQ      14
     C     POSNBR        ANDGE     17
     C     POSNBR        ANDLE     19
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'I'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVIH_AVUT=UKD
     C                   ENDIF
     C                   ENDIF
      * Bilagda handlingar, kod
     C     LINNBR        IFEQ      13
     C     POSNBR        ANDGE     102
     C     POSNBR        ANDLE     105
     C                   CALL      'SVT003R'
     C                   PARM      'MCF'         UTYP              3
     C                   PARM      'A'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVIH_FATY=UKD
     C                   ENDIF
     C                   ENDIF
      * Rubrik 21, landkod
     C     LINNBR        IFEQ      14
     C     POSNBR        ANDGE     125
     C     POSNBR        ANDLE     126
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'I'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVIH_TRAL=UKD
     C                   ENDIF
     C                   ENDIF
      * Rubrik 20, Leveransvillkår, kod
     C     LINNBR        IFEQ      16
E10  C     POSNBR        ANDGE     74
E10  C     POSNBR        ANDLE     76
     C                   CALL      'SVT059R'
     C                   PARM      '   '         UVIH_LEKD         3
     C     UVIH_LEKD     IFNE      *BLANKS
     C                   EVAL      XVIH_LEKD=UVIH_LEKD
     C                   ENDIF
     C                   ENDIF
      * Transitnummer, landkod
     C     LINNBR        IFEQ      24
     C     POSNBR        ANDEQ     119
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'I'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVIH_AUKD=UKD
     C                   ENDIF
     C                   ENDIF
      * Rubrik 12, valuta
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     46
     C     POSNBR        ANDLE     47
     C                   CALL      'SVT007R'
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVIH_VUVA=UKD
     C                   ENDIF
     C                   ENDIF
     C                   GOTO      SRBB3
     C                   ENDIF
      * F13=Oppdater EORInummer i cundf
     C                   IF        *IN13 AND XVIH_MOEO>=*BLANKS AND XVIH_MOKN>0
     C                   CALL      'SYGE55'
     C                   PARM                    UFIRM
     C                   PARM                    XVIH_MOKN
     C                   parm                    XVIH_MOEO
     C                   GOTO      SRBB3
     C                   ENDIF
      * F16=Mer R44 (B.H)
     C                   IF        *IN16
     C                   CALL      'SVI002R'
     C                   PARM                    XVIH_SYAV
     C                   PARM                    XVIH_SYOP
     C                   PARM                    ÅVIF_VAKD
     C                   PARM                    ÅVIF_VAKU
     C                   PARM                    ÅVIF_FABL
     C     XVIH_VAKD     IFEQ      *BLANKS
     C     XVIH_VAKU     ANDEQ     0
     C     XVIH_FABL     ANDEQ     0
     C                   EVAL      XVIH_VAKD=ÅVIF_VAKD
     C                   EVAL      XVIH_VAKU=ÅVIF_VAKU
     C                   EVAL      XVIH_FABL=ÅVIF_FABL
     C                   ENDIF
     C                   ENDIF
      *___________
      * Test input
      *"""""""""""
      * Meddelandetyp
     C     XVIH_MTYP     COMP      'DNU'                                  20
     C  N20XVIH_MTYP     COMP      'DNK'                                  20
     C  N20XVIH_MTYP     COMP      'DRT'                                  20
     C  N20XVIH_MTYP     COMP      'DBK'                                  20
     C  N20XVIH_MTYP     COMP      'HNU'                                  20
     C  N20XVIH_MTYP     COMP      'HNK'                                  20
     C  N20XVIH_MTYP     COMP      'HRT'                                  20
     C  N20XVIH_MTYP     COMP      'HBK'                                  20
     C  N20XVIH_MTYP     COMP      'OMP'                                  20
     C  N20XVIH_MTYP     COMP      'TNU'                                  20
     C  N20XVIH_MTYP     COMP      'TRT'                                  20
     C     *IN20         IFEQ      *OFF
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN31=*ON
     C                   MOVE      'SVI0003'     ZMSGNO
     C                   EVAL      LINNBR=3
     C                   EVAL      POSNBR=67
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   MOVEL     XVIH_MTYP     XVIH_MTYP1        1
      * 1. Deklaration del-1
     C     XVIH_DEK1     COMP      'CO'                                   20
     C  N20XVIH_DEK1     COMP      'EU'                                   20
     C  N20XVIH_DEK1     COMP      'IM'                                   20
     C     *IN20         IFEQ      *OFF
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN32=*ON
     C                   MOVE      'SVI0005'     ZMSGNO
     C                   EVAL      LINNBR=3
     C                   EVAL      POSNBR=88
     C                   GOTO      SRBB3
     C                   ENDIF
      * 1. Deklaration del-2
     C     XVIH_DEK2     COMP      'A'                                    20
     C  N20XVIH_DEK2     COMP      'B'                                    20
     C  N20XVIH_DEK2     COMP      'C'                                    20
     C  N20XVIH_DEK2     COMP      'X'                                    20
     C  N20XVIH_DEK2     COMP      'Y'                                    20
     C  N20XVIH_DEK2     COMP      'Z'                                    20
     C     *IN20         IFEQ      *OFF
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN32=*ON
     C                   MOVE      'SVI0042'     ZMSGNO
     C                   EVAL      LINNBR=3
     C                   EVAL      POSNBR=91
     C                   GOTO      SRBB3
     C                   ENDIF
      * 37. Førfarande del-1
     C     SVTPROKEY     CHAIN     SVTPRO                             84
     C                   IF        *IN84
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0023'     ZMSGNO
     C                   EVAL      LINNBR=4
     C                   EVAL      POSNBR=17
     C                   GOTO      SRBB3
     C                   ENDIF
      * 2. Avsændar kundenr
     C     XVIH_AVKN     IFNE      0
     C                   MOVE      XVIH_AVKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            35
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN35=*ON
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SPK0001'     ZMSGNO
     C                   EVAL      LINNBR=6
     C                   EVAL      POSNBR=9
     C                   GOTO      SRBB3
     C                   ELSE
     C     XVIH_AVNA     IFEQ      *BLANKS
     C                   EVAL      XVIH_AVNA = KNAVN
     C                   EVAL      XVIH_AVA1 = ADR1
     C                   EVAL      XVIH_AVA2 = ADR2
     C                   IF        POSTNR = 0

     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XVIH_AVPN=%SUBST(SYPOGE:P:Q)

     C                   ELSE
     C                   EVAL      XVIH_AVPN = *BLANKS
     C                   MOVEL     POSTNR        XVIH_AVPN
     C                   ENDIF
     C                   MOVEL     ADR3          XVIH_AVPA
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XVIH_AVLK = SYLAND
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
N04   * 2. Avsændar EORI
N04  C     XVIH_AVEO     IFNE      *BLANKS
N04  C                   IF        %SUBST(XVIH_AVEO:3:1)= *BLANKS
N04  C                   EVAL      *IN30=*ON
N04  C                   MOVE      'SVI0013'     ZMSGNO
N04  C                   EVAL      LINNBR=6
N04  C                   EVAL      POSNBR=18
N04  C                   GOTO      SRBB3
N04  C                   ENDIF
N04  C                   ENDIF
      * 2. Avsændar namn
     C     XVIH_AVNA     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN36=*ON
     C                   MOVE      'SVI0010'     ZMSGNO
     C                   EVAL      LINNBR=6
     C                   EVAL      POSNBR=45
     C                   GOTO      SRBB3
     C                   ENDIF
      * 2. Avsændar postnummer
     C     XVIH_AVPN     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN39=*ON
     C                   MOVE      'SVI0043'     ZMSGNO
     C                   EVAL      LINNBR=7
     C                   EVAL      POSNBR=45
     C                   GOTO      SRBB3
     C                   ENDIF
      * 2. Avsændar postadress
     C     XVIH_AVPA     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN39=*ON
     C                   MOVE      'SVI0011'     ZMSGNO
     C                   EVAL      LINNBR=7
     C                   EVAL      POSNBR=55
     C                   GOTO      SRBB3
     C                   ENDIF
      * 2. Avsændar landkod
     C     XVIH_AVLK     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0009'     ZMSGNO
     C                   EVAL      LINNBR=7
     C                   EVAL      POSNBR=91
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   EVAL      UIE='A'
     C                   EVAL      UTYP='GCY'
     C                   EVAL      UKD=*BLANKS
     C                   EVAL      UKD=XVIH_AVLK
     C     SVTX03K       CHAIN     SVTX03F                            75
     C                   IF        *IN75
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0009'     ZMSGNO
     C                   EVAL      LINNBR=7
     C                   EVAL      POSNBR=91
     C                   GOTO      SRBB3
     C                   ENDIF
      * 8. Mottagare kundenr
     C     XVIH_MOKN     IFNE      0
     C                   MOVE      XVIH_MOKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            40
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN40=*ON
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SPK0001'     ZMSGNO
     C                   EVAL      LINNBR=9
     C                   EVAL      POSNBR=9
     C                   GOTO      SRBB3
     C                   ELSE
     C     XVIH_MOEO     IFEQ      *BLANKS
     C     EORI          IFNE      *BLANKS
     C                   EVAL      XVIH_MOEO=EORI
     C                   ELSE
KING C*    SYLAND        IFNE      'NO'
KING C*                  MOVEL     X_RNRAKU      XVIH_MOEO
KING C*                  ELSE
     C                   MOVEL     SYLAND        XVIH_MOEO
     C                   CAT       SYRG:0        XVIH_MOEO
     C                   CAT       '00':0        XVIH_MOEO
     C                   IF        SYRG=*BLANKS
     C                   MOVEL(P)  SYLAND        XVIH_MOEO
     C                   CAT       VATKKU:0      XVIH_MOEO
     C                   ENDIF
KING C*                  ENDIF
     C                   ENDIF
     C                   ENDIF
     C     XVIH_MOHA     IFEQ      *BLANKS
     C                   EVAL      XVIH_MOHA = KPERS
     C                   ENDIF
     C     XVIH_MOTL     IFEQ      *BLANKS
     C                   EVAL      XVIH_MOTL = TLF
     C                   ENDIF
     C     XVIH_MONA     IFEQ      *BLANKS
     C                   EVAL      XVIH_MONA = KNAVN
     C                   EVAL      XVIH_MOA1 = ADR1
     C                   EVAL      XVIH_MOA2 = ADR2
     C                   IF        POSTNR = 0
      *
     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XVIH_MOPN=%SUBST(SYPOGE:P:Q)
      *
     C                   ELSE
     C                   EVAL      XVIH_MOPN = *BLANKS
     C                   MOVEL     POSTNR        XVIH_MOPN
     C                   ENDIF
     C                   EVAL      XVIH_MOPA = ADR3
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XVIH_MOLK = SYLAND
     C                   ENDIF
     C                   EVAL      XVIH_MOTL = TLF
     C                   ENDIF
      * Hent Godslokalkode fra CUNDF
     C     XVIH_GOLK     IFEQ      *BLANKS
     C                   EVAL      XVIH_GOLK=GOLK
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      * 8. Mottagare, EORI
S04  C*    XVIH_MOEO     IFEQ      *BLANKS
N04  C                   IF        %SUBST(XVIH_MOEO:3:1)= *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN40=*ON
     C                   MOVE      'SVI0013'     ZMSGNO
     C                   EVAL      LINNBR=9
     C                   EVAL      POSNBR=18
     C                   GOTO      SRBB3
     C                   ENDIF
      * 8. Mottagare, handlæggare
     C     XVIH_MOHA     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN49=*ON
     C                   MOVE      'SVI0014'     ZMSGNO
     C                   EVAL      LINNBR=11
     C                   EVAL      POSNBR=9
     C                   GOTO      SRBB3
     C                   ENDIF
      * 8. Mottagare, telefonnummer
     C     XVIH_MOTL     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN50=*ON
     C                   MOVE      'SVI0031'     ZMSGNO
     C                   EVAL      LINNBR=11
     C                   EVAL      POSNBR=45
     C                   GOTO      SRBB3
     C                   ENDIF
      * 8. Mottagare, Postnummer
     C     XVIH_MOPN     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0043'     ZMSGNO
     C                   EVAL      LINNBR=10
     C                   EVAL      POSNBR=45
     C                   GOTO      SRBB3
     C                   ENDIF
      * 8. Mottagare, Postadress
     C     XVIH_MOPA     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0011'     ZMSGNO
     C                   EVAL      LINNBR=10
     C                   EVAL      POSNBR=55
     C                   GOTO      SRBB3
     C                   ENDIF
      * 8. Mottagare landkod
     C     XVIH_MOLK     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0009'     ZMSGNO
     C                   EVAL      LINNBR=10
     C                   EVAL      POSNBR=91
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   EVAL      UIE='A'
     C                   EVAL      UTYP='GCY'
     C                   EVAL      UKD=*BLANKS
     C                   EVAL      UKD=XVIH_MOLK
     C     SVTX03K       CHAIN     SVTX03F                            72
     C                   IF        *IN72
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0009'     ZMSGNO
     C                   EVAL      LINNBR=10
     C                   EVAL      POSNBR=91
     C                   GOTO      SRBB3
     C                   ENDIF
      * 22. Valutakod
     C     XVIH_MTYP1    IFNE      'H'
     C     XVIH_VAKD     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN66=*ON
     C                   MOVE      'SVI0008'     ZMSGNO
     C                   EVAL      LINNBR=13
     C                   EVAL      POSNBR=17
     C                   GOTO      SRBB3
     C                   ENDIF
     C     XVIH_VAKD     IFNE      *BLANKS
     C     XVIH_VAKD     CHAIN     SVTVK                              66
     C     *IN66         IFEQ      *ON
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0008'     ZMSGNO
     C                   EVAL      LINNBR=13
     C                   EVAL      POSNBR=17
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
     C     XVIH_VAKD     IFNE      *BLANKS
     C     XVIH_VAKU     ANDEQ     *ZEROS
     C                   EVAL      ZVVK_KD=XVIH_VAKD
     C     SVTVKKEY      SETGT     SVTVK
     C                   READP     SVTVK                                  64
     C     *IN64         IFEQ      *OFF
     C                   EVAL      XVIH_VAKU=SVVK_KRS
     C                   ENDIF
     C                   ENDIF
      * 28. Fakturanummer
     C     XVIH_MTYP     IFNE      'TNU'
     C     XVIH_FATX     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN69=*ON
     C                   MOVE      'SVI0018'     ZMSGNO
     C                   EVAL      LINNBR=13
     C                   EVAL      POSNBR=84
     C                   GOTO      SRBB3
     C                   ENDIF
     C     XVIH_FATY     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN69=*ON
     C                   MOVE      'SVI0018'     ZMSGNO
     C                   EVAL      LINNBR=13
     C                   EVAL      POSNBR=84
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      * 28. Fakturanummer om inte H*
     C     XVIH_FATX     IFEQ      *BLANKS
     C     XVIH_FATY     ANDNE     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN69=*ON
     C                   MOVE      'SVI0018'     ZMSGNO
     C                   EVAL      LINNBR=13
     C                   EVAL      POSNBR=84
     C                   GOTO      SRBB3
     C                   ENDIF
      * 48. Uppskjuten betalning
     C     XVIH_MTYP     IFNE      'HNU'
     C     XVIH_MTYP     ANDNE     'HNK'
     C     XVIH_MTYP     ANDNE     'HRT'
     C     XVIH_UPPS     COMP      'T'                                    20
     C  N20XVIH_UPPS     COMP      'O'                                    20
     C  N20XVIH_UPPS     COMP      'K'                                    20
     C     *IN20         IFEQ      *OFF
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN73=*ON
     C                   MOVE      'SVI0024'     ZMSGNO
     C                   EVAL      LINNBR=3
     C                   EVAL      POSNBR=111
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
      * 15. Landkod
     C     XVIH_AVUT     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN74=*ON
     C                   MOVE      'SVI0009'     ZMSGNO
     C                   EVAL      LINNBR=14
     C                   EVAL      POSNBR=17
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   EVAL      UIE='A'
     C                   EVAL      UTYP='GCY'
     C                   EVAL      UKD=*BLANKS
     C                   EVAL      UKD=XVIH_AVUT
     C     SVTX03K       CHAIN     SVTX03F                            74
     C                   IF        *IN74
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0009'     ZMSGNO
     C                   EVAL      LINNBR=14
     C                   EVAL      POSNBR=17
     C                   GOTO      SRBB3
     C                   ENDIF
      * 21. Landkod
     C     XVIH_MTYP     IFNE      'TNU'
S09  C*    XVIH_TRAL     IFNE      *BLANKS
N09  C     XVIH_TRIN     IFEQ      '1'
N09  C     XVIH_TRIN     OREQ      '3'
N09  C     XVIH_TRIN     OREQ      '4'
N09  C     XVIH_TRIN     OREQ      '8'
N09  C     XVIH_TRIN     OREQ      '9'
     C                   EVAL      UIE='A'
     C                   EVAL      UTYP='GCY'
     C                   EVAL      UKD=*BLANKS
     C                   EVAL      UKD=XVIH_TRAL
     C     SVTX03K       CHAIN     SVTX03F                            76
     C                   IF        *IN76
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0009'     ZMSGNO
     C                   EVAL      LINNBR=14
     C                   EVAL      POSNBR=125
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      * 49. Godslokalkod
     C     XVIH_MTYP     IFEQ      'DNK'
     C     XVIH_MTYP     OREQ      'HNK'
     C     XVIH_MTYP     OREQ      'OMP'
     C     XVIH_GOLK     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN87=*ON
     C                   MOVE      'SVI0028'     ZMSGNO
     C                   EVAL      LINNBR=13
     C                   EVAL      POSNBR=125
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
      * 25. Transportsætt vid græns
     C     XVIH_MTYP     IFEQ      'DNK'
     C     XVIH_MTYP     OREQ      'HNK'
     C     XVIH_MTYP     OREQ      'OMP'
     C     XVIH_TRGR     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN77=*ON
     C                   MOVE      'SVI0016'     ZMSGNO
     C                   EVAL      LINNBR=14
     C                   EVAL      POSNBR=84
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
      * 26. Transportsætt inrikes
     C     XVIH_MTYP     IFNE      'TNU'
     C     XVIH_TRIN     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN78=*ON
     C                   MOVE      'SVI0017'     ZMSGNO
     C                   EVAL      LINNBR=14
     C                   EVAL      POSNBR=35
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
     C     XVIH_MTYP     IFNE      'TNU'
      * 20. Leveransvillkår, kod
     C     XVIH_LEKD     IFEQ      *BLANKS
     C     XVIH_LEOR     ANDNE     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN79=*ON
     C                   MOVE      'SVI0025'     ZMSGNO
     C                   EVAL      LINNBR=16
E10  C                   EVAL      POSNBR=74
     C                   GOTO      SRBB3
     C                   ENDIF
      * 20. Leveransvillkår, plats hæmta från R.8 om DDP
     C     XVIH_LEOR     IFEQ      *BLANKS
     C     XVIH_LEKD     ANDEQ     'DDP'
     C                   MOVEL     XVIH_MOPA     XVIH_LEOR
     C                   ENDIF
      * 20. Leveransvillkår, plats
     C     XVIH_LEOR     IFEQ      *BLANKS
     C     XVIH_LEKD     ANDNE     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN80=*ON
     C                   MOVE      'SVI0026'     ZMSGNO
     C                   EVAL      LINNBR=16
E10  C                   EVAL      POSNBR=78
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
      * 6. Kollital
     C     XVIH_KOTA     IFEQ      *ZEROS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN83=*ON
     C                   MOVE      'SVI0012'     ZMSGNO
     C                   EVAL      LINNBR=16
     C                   EVAL      POSNBR=17
     C                   GOTO      SRBB3
     C                   ENDIF
      * Transitnummer, landkod
     C     XVIH_AUKD     IFEQ      *BLANKS
     C     XVIH_TRNR     ANDNE     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN92=*ON
     C                   MOVE      'SVI0009'     ZMSGNO
     C                   EVAL      LINNBR=24
     C                   EVAL      POSNBR=119
     C                   GOTO      SRBB3
     C                   ENDIF
      * 12. Valutakod
     C     XVIH_VUVA     IFEQ      *BLANKS
     C     XVIH_VUFR     ANDNE     *ZEROS
     C     XVIH_VUKU     ANDNE     *ZEROS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN64=*ON
     C                   MOVE      'SVI0008'     ZMSGNO
     C                   EVAL      LINNBR=20
     C                   EVAL      POSNBR=46
     C                   GOTO      SRBB3
     C                   ENDIF
     C     XVIH_VUVA     IFNE      *BLANKS
     C     XVIH_VUVA     CHAIN     SVTVK                              64
     C     *IN64         IFEQ      *ON
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0008'     ZMSGNO
     C                   EVAL      LINNBR=20
     C                   EVAL      POSNBR=46
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
     C     XVIH_VUVA     IFNE      *BLANKS
     C     XVIH_VUKU     ANDEQ     *ZEROS
     C                   EVAL      ZVVK_KD=XVIH_VUVA
     C     SVTVKKEY      SETGT     SVTVK
     C                   READP     SVTVK                                  64
     C     *IN64         IFEQ      *OFF
     C                   EVAL      XVIH_VUKU=SVVK_KRS
     C                   ENDIF
     C                   ENDIF
N08   * 19. Containerkod
N08  C     XVIH_CONT     IFLT      '0 '
N08  C     XVIH_CONT     ORGT      '1 '
N08  C                   EVAL      *IN30=*ON
N08  C                   MOVE      'SVE0046'     ZMSGNO
N08  C                   EVAL      LINNBR=16
N08  C                   EVAL      POSNBR=125
N08  C                   GOTO      SRBB3
N08  C                   ENDIF
      * Beräkna försäkringsbelopp ?
     C     XVIH_LEKD     CHAIN     SVTLV                              53
     C     *IN53         IFEQ      *OFF
     C     XVIH_VUFO     ANDEQ     0
     C     SVLV_FS       IFEQ      'P'
     C     SVLV_FS2      OREQ      'P'
     C                   EXSR      SRCIFTOT
     C                   EVAL      XVIH_VUFO = (ZCIFTOT * SVLV_FS2P) / 100
     C                   ENDIF
     C                   ENDIF
      * Legg in standardtext i rubrik 44 om PROC=4200
E02  C                   IF        XVIH_EUP1='4200'

     C     XVIH_OMEO     IFNE      *BLANKS
     C                   EVAL      WFATY2='Y040'
     C     SVIFKEY2      CHAIN     SVIF2                              99
     C                   IF        *IN99
     C                   CLEAR                   SVIFR
     C                   EVAL      SVIF_SYAV=ZVIH_SYAV
     C                   EVAL      SVIF_SYOP=ZVIH_SYOP
     C                   EVAL      SVIF_FATY='Y040'
     C                   EVAL      SVIF_FATX=XVIH_OMEO
     C                   EVAL      WSYKUNR=XVIH_AVKN
     C     SYPARKEY      CHAIN     SYPARL1                            40
     C     *IN40         IFEQ      *OFF
     C     SYVRDA        ANDNE     *BLANKS
     C                   MOVE      *BLANKS       SVIF_FATX
     C                   MOVEL     SYVRDA        SVIF_FATX
     C                   ENDIF
     C                   WRITE     SVIFR
     C                   ENDIF
     C                   ENDIF


     C     XVIH_MOEO     IFNE      *BLANKS
     C                   EVAL      WFATY2='Y041'
     C     SVIFKEY2      CHAIN     SVIF2                              99
     C                   IF        *IN99
     C                   CLEAR                   SVIFR
     C                   EVAL      SVIF_SYAV=ZVIH_SYAV
     C                   EVAL      SVIF_SYOP=ZVIH_SYOP
     C                   EVAL      SVIF_FATY='Y041'
     C                   EVAL      SVIF_FATX=XVIH_MOEO
     C                   WRITE     SVIFR
     C                   ENDIF
     C                   ENDIF

S02  C*                  ENDIF
     C                   ENDIF

     C     SRBB9         TAG

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater SVI001DC                         SRBC /
      *////////////////////////////////////////////////////////////
     C     SRBC          BEGSR
      *_____________________________________________________________________
      * Ny eller gammal, kopiera mottagaruppgifter till deklarant, om blankt
      *"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     XVIH_DKNA     IFEQ      *BLANKS
     C     XVIH_LEKD     IFEQ      'XXX'
     C                   EVAL      XVIH_DKKN=XVIH_AVKN
     C                   EVAL      XVIH_DKEO=XVIH_AVEO
     C                   EVAL      XVIH_DKNA=XVIH_AVNA
     C                   EVAL      XVIH_DKA1=XVIH_AVA1
     C                   EVAL      XVIH_DKA2=XVIH_AVA2
     C                   EVAL      XVIH_DKPN=XVIH_AVPN
     C                   EVAL      XVIH_DKPA=XVIH_AVPA
     C                   EVAL      XVIH_DKLK=XVIH_AVLK
     C                   EVAL      XVIH_DKHA=*BLANKS
     C                   EVAL      XVIH_DKTL=*BLANKS
     C                   ELSE
     C                   EVAL      XVIH_DKKN=XVIH_MOKN
     C                   EVAL      XVIH_DKEO=XVIH_MOEO
     C                   EVAL      XVIH_DKNA=XVIH_MONA
     C                   EVAL      XVIH_DKA1=XVIH_MOA1
     C                   EVAL      XVIH_DKA2=XVIH_MOA2
     C                   EVAL      XVIH_DKPN=XVIH_MOPN
     C                   EVAL      XVIH_DKPA=XVIH_MOPA
     C                   EVAL      XVIH_DKLK=XVIH_MOLK
     C                   EVAL      XVIH_DKHA=XVIH_MOHA
     C                   EVAL      XVIH_DKTL=XVIH_MOTL
     C                   ENDIF
     C                   ENDIF
     C     XVIH_DKHA     IFEQ      *BLANKS
     C                   EVAL      XVIH_DKHA=XVIH_OMHA
     C                   EVAL      XVIH_DKTL=XVIH_OMTL
     C                   ENDIF
      *____________
      * Vis bilde-C
      *""""""""""""
     C                   EVAL      LINNBR=5
     C                   EVAL      POSNBR=25
     C     SRBC3         TAG
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     SVI001DØ
     C                   EXFMT     SVI001DC
     C                   EVAL      *IN30 = *OFF
     C                   EVAL      *IN51 = *OFF
     C                   EVAL      *IN92 = *OFF
      *_______________
      * F3,F12=Avlsutt
      *"""""""""""""""
     C                   IF        *IN03
     C                   GOTO      SRBC9
     C                   ENDIF
     C                   IF        *IN12
     C                   GOTO      SRBC9
     C                   ENDIF
      *_______
      * F4=Søk
      *"""""""
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN04         IFEQ      '1'
      * Rubrik 14, deklarant
     C     LINNBR        IFEQ      5
E07  C     POSNBR        ANDGE     21
E07  C     POSNBR        ANDLE     28
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    XVIH_DKKN
     C                   PARM                    UFIRM
     C                   PARM                    USØKKN
     C                   ENDIF
      * Deklarant, landkod
E07  C     LINNBR        IFEQ      6
E07  C     POSNBR        ANDEQ     103
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'I'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVIH_DKLK=UKD
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *___________
      * Test input
      *"""""""""""
      * 14. Deklarant kundenr
     C     XVIH_DKKN     IFNE      0
     C                   MOVE      XVIH_DKKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            51
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN51=*ON
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SPK0001'     ZMSGNO
E07  C                   EVAL      LINNBR=5
E07  C                   EVAL      POSNBR=21
     C                   GOTO      SRBC3
     C                   ELSE
     C     XVIH_DKEO     IFEQ      *BLANKS
     C     EORI          IFNE      *BLANKS
     C                   EVAL      XVIH_DKEO=EORI
     C                   ELSE
KING C*    SYLAND        IFNE      'NO'
KING C*                  MOVEL     X_RNRAKU      XVIH_DKEO
KING C*                  ELSE
     C                   MOVEL(P)  SYLAND        XVIH_DKEO
     C                   CAT       SYRG:0        XVIH_DKEO
     C                   CAT       '00':0        SVIH_DKEO
     C                   IF        SYRG=*BLANKS
     C                   MOVEL(P)  SYLAND        XVIH_DKEO
     C                   CAT       VATKKU:0      XVIH_DKEO
     C                   ENDIF
KING C*                  ENDIF
     C                   ENDIF
     C                   ENDIF
S05  C*    XVIH_DKHA     IFEQ      *BLANKS
N05  C     XVIH_DKNA     IFEQ      *BLANKS
S05  C*                  EVAL      XVIH_DKHA = *BLANKS
N05  C                   EVAL      XVIH_DKNA = KNAVN
     C                   EVAL      XVIH_DKA1 = ADR1
     C                   EVAL      XVIH_DKA2 = ADR2
     C                   IF        POSTNR = 0
      *
     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XVIH_DKPN=%SUBST(SYPOGE:P:Q)
      *
     C                   ELSE
     C                   EVAL      XVIH_DKPN = *BLANKS
     C                   MOVEL     POSTNR        XVIH_DKPN
     C                   ENDIF
     C                   EVAL      XVIH_DKPA = ADR3
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XVIH_DKLK = SYLAND
     C                   ENDIF
     C                   EVAL      XVIH_DKTL = TLF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      * 14. Deklarant EORI
S04  C*                  IF        XVIH_DKEO=*BLANKS
N04  C                   IF        %SUBST(XVIH_DKEO:3:1)= *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0013'     ZMSGNO
     C                   EVAL      LINNBR=5
     C                   EVAL      POSNBR=30
     C                   GOTO      SRBC3
     C                   ENDIF
      * 14. Deklarant Handlæggare
     C                   IF        XVIH_DKHA=*BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0014'     ZMSGNO
E07  C                   EVAL      LINNBR=7
E07  C                   EVAL      POSNBR=21
     C                   GOTO      SRBC3
     C                   ENDIF
      * 14. Deklarant Telefon
     C                   IF        XVIH_DKTL=*BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0015'     ZMSGNO
E07  C                   EVAL      LINNBR=7
E07  C                   EVAL      POSNBR=57
     C                   GOTO      SRBC3
     C                   ENDIF
      * 14. Deklarant Adress-1
     C                   IF        XVIH_DKA1=*BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0051'     ZMSGNO
E07  C                   EVAL      LINNBR=5
E07  C                   EVAL      POSNBR=93
     C                   GOTO      SRBC3
     C                   ENDIF
      * 14. Deklarant landkod
     C     XVIH_DKLK     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0009'     ZMSGNO
E07  C                   EVAL      LINNBR=6
E07  C                   EVAL      POSNBR=103
     C                   GOTO      SRBC3
     C                   ENDIF

N04   * 14. Ombud EORI
N04  C                   IF        %SUBST(XVIH_OMEO:3:1)= *BLANKS
N04  C                   EVAL      *IN30=*ON
N04  C                   MOVE      'SVI0013'     ZMSGNO
N04  C                   EVAL      LINNBR=9
N04  C                   EVAL      POSNBR=21
N04  C                   GOTO      SRBC3
N04  C                   ENDIF
N04   * 14. Ombud typ
N04  C     XVIH_OMTY     IFEQ      *BLANKS
N04  C                   EVAL      *IN30=*ON
N04  C                   MOVE      'SVE0052'     ZMSGNO
N04  C                   EVAL      LINNBR=9
N04  C                   EVAL      POSNBR=39
N04  C                   GOTO      SRBC3
N04  C                   ENDIF
N04   * 14. Ombud, handlæggare
N04  C     XVIH_OMHA     IFEQ      *BLANKS
N04  C                   EVAL      *IN30=*ON
N04  C                   MOVE      'SVE0014'     ZMSGNO
N04  C                   EVAL      LINNBR=10
N04  C                   EVAL      POSNBR=21
N04  C                   GOTO      SRBC3
N04  C                   ENDIF
N04   * 14. Ombud, telefonnummer
N04  C     XVIH_OMTL     IFEQ      *BLANKS
N04  C                   EVAL      *IN30=*ON
N04  C                   EVAL      *IN50=*ON
N04  C                   MOVE      'SVE0015'     ZMSGNO
N04  C                   EVAL      LINNBR=10
N04  C                   EVAL      POSNBR=57
N04  C                   GOTO      SRBC3
N04  C                   ENDIF

     C     SRBC9         TAG

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Berækna førsækringskostnad                      SRCIFFOR /
      *////////////////////////////////////////////////////////////
     C     SRCIFFOR      BEGSR
     C                   EXSR      SRCIFTOT
      * Førsækring TULL
     C                   EVAL      XVIH_VUFO = (ZCIFTOT * SVLV_FS2P) / 100
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Berækna CIF totalt                              SRCIFTOT /
      *////////////////////////////////////////////////////////////
     C     SRCIFTOT      BEGSR
      *__________________________________
      * Summera alla kostnader och avdrag
      *""""""""""""""""""""""""""""""""""
     C                   EVAL      ZCIFTOT=0
      * Fakturabelopp i Svenska kronor
     C     XVIH_FABL     MULT      XVIH_VAKU     ZVIH_FABL
     C                   EVAL      ZVVK_KD=XVIH_VAKD
     C                   EVAL      ZVVK_DTS=99999999
     C     SVTVKKEY      SETGT     SVTVK
     C                   READP     SVTVK                                  64
     C     ZVIH_FABL     IFGT      0
     C     SVVK_OMR      ANDGT     0
     C     ZVIH_FABL     DIV       SVVK_OMR      ZVIH_FABL
     C                   EVAL      ZCIFTOT=ZVIH_FABL
     C                   ENDIF
      * Transport
     C                   IF        SVLV_TR2='J'
     C     XVIH_VUFR     MULT      XVIH_VUKU     ZVIH_VUFR
     C                   EVAL      ZVVK_KD=XVIH_VUVA
     C                   EVAL      ZVVK_DTS=99999999
     C     SVTVKKEY      SETGT     SVTVK
     C                   READP     SVTVK                                  64
     C     ZVIH_VUFR     IFGT      0
     C     SVVK_OMR      ANDGT     0
     C     ZVIH_VUFR     DIV       SVVK_OMR      ZVIH_VUFR
     C                   ENDIF
     C                   ADD       ZVIH_VUFR     ZCIFTOT          15 4
     C                   ENDIF
      * Øvriga kostnader
     C                   IF        SVLV_OK='J'
     C                   ADD       XVIH_OVKO     ZCIFTOT
     C                   ENDIF
      * Kassarabatt
     C                   IF        SVLV_KR='J'
     C                   SUB       XVIH_KARA     ZCIFTOT
     C                   ENDIF
      * Annan rabatt
     C                   IF        SVLV_AR='J'
     C                   SUB       XVIH_ANRA     ZCIFTOT
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Ændra førfarande på alla varulinjer              CHGFORF /
      *////////////////////////////////////////////////////////////
     C     CHGFORF       BEGSR
     C     UMODE         IFNE      'D'
     C                   EVAL      *IN54=*OFF
     C     ZKEY          SETLL     SVIV
     C     ZKEY          READE     SVIV                                   54
     C     *IN54         DOWEQ     *OFF
     C                   EVAL      SVIV_EUP1=XVIH_EUP1
     C*                  EVAL      SVIV_EUP2=XVIH_EUP2
     C                   UPDATE    SVIVR
     C     ZKEY          READE     SVIV                                   54
     C                   ENDDO
     C                   ENDIF
     C                   ENDSR
