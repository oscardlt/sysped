     H debug(*yes)
      *********************************************************************
      *  Henter SIGNATUR KVITTERING
      *********************************************************************
CRTPG+*  CRTPGM SYSPED/WSPOLNK MODULE(*LIBL/WSPOLNK
CRTPGM*         *LIBL/INCGI) ACTGRP(*NEW) AUT(*USE)
      *
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
********************************************************************
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
      *--------------------------------------------------------------------
     FFIRMARC   IF   E           K DISK    USROPN
     FTRACKL08  IF   E           K DISK    USROPN
     FDOKUF7    IF   E           K DISK    USROPN
     FEDII      IF   E           K DISK    USROPN
     FBRIDF     IF   E           K DISK    USROPN
     FARKIVL03  IF   E           K DISK    USROPN
     FARKTXT    IF   E           K DISK    USROPN
     FARKEXT    IF   E           K DISK    USROPN
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
     D WSUSER          S             10
     D XMLstring       S          32000
     D SNR             s             20A
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *--------------------------------------------------------------------
      *
      * Parse input
     C                   exsr      Parse
      * Initiering
     C                   EXSR      INIT
      *
      * Hent XML output-dok/ skriv top + linjer
      *
     c                   callp     gethtmlifs(
     C                             '/syspeddev/html/WS_XML.html':
     C                             '/CGITAG/')
      *
     C                   callp     wrtsection('top')
      *
      /free
        XMLstring=*blanks;
        XMLstring='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>';
      /end-free
     C                   callp     updHTMLvar('XMLstring':XMLstring)
     C                   callp     wrtsection('XMLlin')
      /free
        XMLstring=*blanks;
        XMLstring='<getPoLinks>';
      /end-free
     C                   callp     updHTMLvar('XMLstring':XMLstring)
     C                   callp     wrtsection('XMLlin')
      *
     c                   exsr      CrtBody
      * slutt
      /free
        XMLstring=*blanks;
        XMLstring='</getPoLinks>';
      /end-free
     C                   callp     updHTMLvar('XMLstring':XMLstring)
     C                   callp     wrtsection('XMLlin')
      *
     C     SLUTT         TAG
     C                   EXSR      EXIT
     C                   return
      ******************************************************************************
     C     Parse         begsr
      ******************************************************************************
      * Parse input   Bruker er fast NN + sndnr
      *
     C                   eval      WSUSER  = zhbgetvar('USER')
     c     WSUSER        ifeq      *blanks
     C                   eval      WSUSER  = 'NN'
     c                   endif
     C                   eval      SNR     = zhbgetvar('SNDNO')
     C                   endsr
      ******************************************************************************
     C     INIT          begsr
      ******************************************************************************
      *
     C                   OPEN      BRIDF
     C     WSUSER        CHAIN     BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
     C                   OPEN      FIRMARC
     C                   READ      FIRMARC                                33
      *
     C                   endsr
      *******************************************************************************
     C     EXIT          begsr
      *******************************************************************************
      *  AVSLUTT
     C                   callp     wrtsection('*fini')
     C                   close     BRIDF
     C                   CLOSE     FIRMARC
     C                   eval      *inlr = *on
      *
     C                   endsr
      * **************************************************
     C     CrtBody       begsr
      * **************************************************
      * hent bane til signatur
      *
     c                   exsr      getgif
      *
      /free
        XMLstring=*blanks;
        XMLstring='  <poLink>'+%trim(UBANE)+'</poLink>';
      /end-free
     C                   callp     updHTMLvar('XMLstring':XMLstring)
     C                   callp     wrtsection('XMLlin')
     C                   endsr
      *
      ****************************************************************************
     C     GETGIF        begsr
      ****************************************************************************
      *  Hent evt grafisk signatur
      *
     c                   MOVE      'N'           GIFOK             1
     c                   move      *blanks       ubane           256
     C                   movel     '/syspeddev/' ubane
     C     ubane         CAT       'signatur/':0 ubane
     C     ubane         CAT       SNR:0         ubane
     C     ubane         CAT       '.gif':0      ubane
     c                   CALL      'BHRURLCL'
     c                   Parm                    ubane
     c                   Parm                    GIFOK
      *
      * gif fantes ikke, prøv med bmp.
      *
     c     GIFOK         ifne      'J'
N04  c                   move      *blanks       ubane
     C                   movel     '/syspeddev/' ubane
     C     ubane         CAT       'signatur/':0 ubane
     C     ubane         CAT       SNR:0         ubane
     C     ubane         CAT       '.bmp':0      ubane
     c                   CALL      'BHRURLCL'
     c                   Parm                    ubane
     c                   Parm                    GIFOK
     c                   end
      *
N10   * bmp fantes ikke, prøv med jpg.
      *
N10  c     GIFOK         ifne      'J'
N10  c                   move      *blanks       ubane
N10  C                   movel     '/syspeddev/' ubane
N10  C     ubane         CAT       'signatur/':0 ubane
N10  C     ubane         CAT       SNR:0         ubane
N10  C     ubane         CAT       '.jpg':0      ubane
N10  c                   CALL      'BHRURLCL'
N10  c                   Parm                    ubane
N10  c                   Parm                    GIFOK
N10  c                   end
N10   * jpg fantes ikke, prøv med png.
N10  c     GIFOK         ifne      'J'
N10  c                   move      *blanks       ubane
N10  C                   movel     '/syspeddev/' ubane
N10  C     ubane         CAT       'signatur/':0 ubane
N10  C     ubane         CAT       SNR:0         ubane
N10  C     ubane         CAT       '.png':0      ubane
N10  c                   CALL      'BHRURLCL'
N10  c                   Parm                    ubane
N10  c                   Parm                    GIFOK
N10  c                   end
      *
      * legger på starten av ba
      *
N10  c     GIFOK         ifeq      'J'
     c                   move      ubane         ubaneny         256
     c
N10  C                   eval      ubane = 'http://'
N10  C     ubane         cat       arcpae:0      ubane
     C     ubane         CAT       ubaneny:0     ubane
     c                   end
      *
N09   * gif fantes ikke, prøv transportør
      *
N09  c     GIFOK         ifne      'J'
     c                   open      dokuf7
     c                   eval      df1004=snr
     c     df1004        chain     dokuf7                             33
     c                   close     dokuf7
     c     *in33         ifeq      '0'
      *
     c     keytr         klist
     c                   kfld                    dfavd
     c                   kfld                    dfopd
     c                   kfld                    dfpod
     c                   move      'POD'         dfpod             3
     c                   open      trackl08
     c     keytr         chain     trackl08                           33
     c                   close     trackl08
     c     *in33         ifeq      '0'
     c     ttdepo        andne     *blanks
N09  c                   eval      inid=TTDEPO
     c                   open      edii
N09  c     inid          CHAIN     EDII                               33
     c                   close     edii
N09  C     *in33         ifeq      '0'
N09  C     INPOD01       ANDNE     *BLANKS
N09  c                   CALL      'SYGE91'
N09  c                   parm                    ttdepo
N09  c                   parm                    snr
N09  c                   parm                    ttavd
N09  c                   parm                    ttopd
N09  c                   parm                    ubane
N09  c                   parm                    gifok
N09  c                   end
N09  c                   end
N09  c                   end
N09  c                   end
N09   *
N10  c     GIFOK         ifne      'J'
     c                   exsr      kvittsr
N10  c     GIFOK         ifne      'J'
     c                   eval      ubane = 'Not found'
     c                   end
     c                   end
     C                   endsr
      *
      ****************************************************************************
     C     KVITTSR       begsr
      ****************************************************************************
     C     arklagk       KLIST
     C                   KFLD                    arcfir
     C                   KFLD                    arklag
      *  Hent kvittert fraktbrev
      *
     c                   open      arktxt
     c     'ZP'          chain     arktxt                             33
     c                   close     arktxt
     c     *IN33         ifeq      '0'
     C     ARKLAG        IFNE      *blanks
     c                   open      arkext
     c     arklagk       chain     arkext                             33
     c                   close     arkext
     c                   end
      *
     c     keyar         klist
     c                   kfld                    artype
     c                   kfld                    dfavd
     c                   kfld                    dfopd
     c                   move      'ZP'          artype
     c                   open      arkivl03
     c     keyar         chain     arkivl03                           33
     c                   close     arkivl03
     c     *in33         ifeq      '0'
     c                   move      'J'           GIFOK
     C                   eval      ubane = 'http://'
     c     ubane         cat       arcpae:0      ubane
     c     ubane         cat       '//':0        ubane
     c     ubane         cat       arcane:0      ubane
     c     ubane         cat       '/':0         ubane
     c     ubane         cat       arlink:0      ubane
     c                   end
     c                   end
     c                   endsr
