********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 saspriser oppdatering ny logikk
********************************************************************
     F********************************************************************
     F* genererer flyfrakt export  for SAS
     f* sonepriser er tatt ut
     F********************************************************************
s01  F*astill   iF   E           k disk
     Fsted2d    iF a E           k disk
     Fsted2     iF   E           k disk
     F                                     RENAME(sted2r:ste2R)
     Fairlh     uF a E           k disk
     Fairld     uF a E           k disk
     Fairldwrk  uF a E           k disk
N01  Fnoflypj   IP   E           k DISK
     Fsasdesi   if   E           K disk
     F*asgro    if   E           k disk
     D UP              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZ')
     D LO              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyz')
     c     *entry        plist
     c                   parm                    ei                1
     c  n99              exsr      init
     c                   seton                                        99
     c                   exsr      lesfil
     clr                 exsr      opdhaw
     c*****************************************************
     c     init          begsr
     c*****************************************************
s01  c*    ei            ifeq      'E'
S01  c*    'B'           chain     sastill                            33
S01  c*                  z-add     tilleg        tillyr            5 2
S01  c*    'A'           chain     sastill                            33
S01  c*                  end
     c                   endsr
     c*****************************************************
     c     lesfil        begsr
     c*****************************************************
      * skjekk om sone >= 2
      * da gjelder tilleggsfil  ved >= enn 2
     c                   movel     flkode        flkod5            5
     c     flkod5        chain     sted2                              40
     C                   Z-ADD     ST2SON        TSTSON            1 0
S01  c* N40st2son        comp      1                                  40
S01  c*  40st2son        comp      4                                  404041
     c                   setoff                                       33
     c     *loval        setll     sasdesi
     c     *in(33)       doweq     '0'
     c                   read      sasdesi                                33
     c     *in(33)       ifeq      '0'
     c**** sasson        chain     sasgro                             34
     C     TSTSON        IFEQ      SASSON
     c                   exsr      oppdat
     C                   END
     c                   endif
     c                   enddo
     c                   endsr
     c*****************************************************
     c     oppdat        begsr
     c*****************************************************
     c*
     c* skjekker om stedet er i stedsregisteret
     c*
     c     keyste        klist
     c                   kfld                    st2lk
     c                   kfld                    st2kod
     c*
     c                   move      saslk         st2lk
     c                   movel     sasflp        st2kod
     c     keyste        chain     sted2d                             34
     c     *in(34)       ifeq      '1'
     c                   movel     sasste        st2nvn
     C     LO:UP         XLATE     st2nvn        st2nvn
     c                   write     sted2r
     c                   end
     c*
     c     keyhea        klist
     c                   kfld                    airlin
     c                   kfld                    airpfr
     c                   kfld                    airpto
     c                   move      flkode        airpfr
     c                   move      sasflp        airpto
     c*
     c* SAS
     c*
     c                   z-add     117           airlin
     c     keyhea        chain     airlh                              34
     c                   move      'NOK'         aircur
     c     *in(34)       ifeq      '1'
     c                   write     airlhr
     c                   else
     c                   update    airlhr
     c                   end
     c                   exsr      detsr
     c                   endsr
     c*
     c*******************************************************************
     c     detsr         begsr
     c*******************************************************************
     c     keydet        klist
     c                   kfld                    airlin
     c                   kfld                    airpfr
     c                   kfld                    airpto
     c                   kfld                    airccp
     c*
     c* priority cargo
     c*
     c     saspri        ifeq      'J'
     c                   move      'P'           airccp
     c*
     c*
     c*
     c* SAS sletter records
     c*
     c                   setoff                                       34
     c     keydet        setll     airld
     c     *in(34)       doweq     '0'
     c     keydet        reade     airld                                  34
     c  n34              delete    airldr
     c                   enddo
     c*
     c* skriver ny record N rate
     c*
     c                   z-add     spmini        airgrn
     c                   z-add     spNrat        airawb
     c                   z-add     44            airwei
     c                   move      'N'           aircod
S01  c*  40              add       tilleg        airawb
S01  c*  41              add       tillyr        airawb
     c                   write     airldr
     c*
     c*
     c* skriver ny record q rate
     c*
     c                   z-add     0             airgrn
     c                   z-add     spq045        airawb
     c                   z-add     99            airwei
     c                   move      'Q'           aircod
S01  c*  40              add       tilleg        airawb
S01  c*  41              add       tillyr        airawb
     c                   write     airldr
     c*
     c*
     c* skriver ny record q rate
     c*
     c                   z-add     0             airgrn
     c                   z-add     spq100        airawb
     c                   z-add     99999         airwei
     c                   move      'Q'           aircod
S01  c*  40              add       tilleg        airawb
S01  c*  41              add       tillyr        airawb
     c                   write     airldr
     c*
     c                   endif
     c*
     c* genraral cargo
     c*
     c     sasgen        ifeq      'J'
     c                   move      ' '           airccp
     c*
     c* SAS sletter records
     c*
     c                   setoff                                       34
     c     keydet        setll     airld
     c     *in(34)       doweq     '0'
     c     keydet        reade     airld                                  34
     c  n34              delete    airldr
     c                   enddo
     c*
     c* skriver ny record N rate
     c*
     c                   z-add     sgmini        airgrn
     c                   z-add     sgnrat        airawb
     c                   z-add     44            airwei
     c                   move      'N'           aircod
S01  c*  40              add       tilleg        airawb
S01  c*  41              add       tillyr        airawb
     c                   write     airldr
     c*
     c*
     c* skriver ny record q rate
     c*
     c                   z-add     0             airgrn
     c                   z-add     sgq045        airawb
     c                   z-add     99            airwei
     c                   move      'Q'           aircod
S01  c*  40              add       tilleg        airawb
S01  c*  41              add       tillyr        airawb
     c                   write     airldr
     c*
     c*
     c* skriver ny record q rate
     c*
     c                   z-add     0             airgrn
     c                   z-add     sgq100        airawb
     c     sgq500        ifeq      0
     c                   z-add     99999         airwei
     c                   else
     c                   z-add     499           airwei
     c                   end
     c                   move      'Q'           aircod
S01  c*  40              add       tilleg        airawb
S01  c*  41              add       tillyr        airawb
     c                   write     airldr
     c*
     c     sgq500        ifne      0
     c                   z-add     0             airgrn
     c                   z-add     sgq500        airawb
     c                   z-add     99999         airwei
     c                   move      'Q'           aircod
S01  c*  40              add       tilleg        airawb
S01  c*  41              add       tillyr        airawb
     c                   write     airldr
     c                   end
     c*
     c                   end
     c*
     c                   endsr
     c*
     c*******************************************************************
     c     opdhaw        begsr
     c*******************************************************************
     c* leger eventuelle HAWB data tilbake
     c*
     c     keyd          klist
     c                   kfld                    airlin
     c                   kfld                    airpfr
     c                   kfld                    airpto
     c                   kfld                    airccp
     c                   kfld                    aircod
     c                   kfld                    airwei
     c                   setoff                                       33
     c     *loval        setll     airldwrk
     c     *in(33)       doweq     '0'
     c                   read      airldwrk                               33
     c     *in(33)       ifeq      '0'
     c     airham        ifne      0
     c     airhaw        orne      0
     c                   move      airham        wirham           13 2
     c                   move      airhaw        wirhaw           13 2
     c     keyd          chain     airld                              34
     c     *in(34)       ifeq      '0'
     c                   move      wirham        airham
     c                   move      wirhaw        airhaw
     c                   update    airldr
     c                   endif
     c                   endif
     c                   endif
     c                   enddo
     c                   endsr
