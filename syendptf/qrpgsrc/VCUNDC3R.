********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 sh  PTF10 feil ved f6           ..
10XXX * 02 sh  PTF10 innført vedlegg avvik
10XXX * 03 sh  PTF10 fast emnerubrikk
10XXX * 03 sh  PTF10 kundenummer i lista
10XXX * 04 sh  PTF10 fast emnerubrikk
10XXX * 05 sh  PTF10 blank i alfa ved kunde
10XXX * 06 sh  PTF10 innført distribusjonsliste
10XXX * 07 sh  PTF10 søk kundenummer rekkefølge
10XXX * 08 sh  PTF10 avdelinger
10XXX * 09 sh  PTF10 oppdragstyper
10XXX * 10 sh  PTF10 sammenslåingskode
10XXX * 11 sh  PTF10 liten feil i kundvisning
10XXX * 12 sh  PTF10 melding ved 0 i epostadresse
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11XXX * 13 YBC PTF11 VIS ULIKE LEDERTEKST VED ULIKE BRUK
11XXX * 14 SH  PTF11 selekter orgno
11XXX * 15 SH  PTF11 default V=vedlegg N i printe også
11XXX * 16 YBC PTF11 F4 SØKING
11XXX * 17 SH  PTF11 ikke lenger tillatt med blank epost
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
12XXX * 18 YBC PTF12 SLETT POST I ARKVEDK VED SLETTING
12XXX * 19 SH  PTF12 ekstro obs ved kunsnummer 0
12XXX * 20 YBC PTF12 Hent org.nr ved kopiering eller ny
12XXX * 21 SH  PTF12 ikke mailto: i epostadreese (klipp/lim)
12XXX * 22 SH  PTF12 epostadresse må slutte med a-z eller A-Z
12XXX * 23 SH  PTF12 ikke 2 @ i epost
12XXX * 24 SH  PTF12 ikke æ ø å  i mailadresse
12XXX * 25 SH  PTF12 ikke , i mailadresse
12XXX * 26 SH  PTF12 @ GODTAS
12197 * 27 YBC PTF12 Proteria er på samme måte som EMMA
XXXXX * 28 SH  PTF12 epostadresse kan ikke begynne med blanktegn
XXXXX * 29 SH  PTF12 må ha . et sted etter @
********************************************************************
N02  FARKTXTL1  IF   E           K DISK
N02  FARKVEDK   UF A E           K DISK
     FCUNDC     UF A E             DISK
     F                                     INFDS(CUNDS)
N16  FCUNDC02   IF   E           K DISK    RENAME(CUNDCR:CUNDCR2)
N16  F                                     PREFIX(C2_)
     FCUNDC06   IF   E           K DISK
     F                                     INFDS(CUNDS1)
     F                                     RENAME(CUNDCR:CUNDCR1)
N07  FCUNDC03   IF   E           K DISK
N07  F                                     INFDS(CUNDS3)
N07  F                                     RENAME(CUNDCR:CUNDCR3)
     FCUNDL01   IF   E           K DISK
N14  FCUNDLFO   IF   E           K DISK
N14  F                                     RENAME(KUNDR:CUNDRFO)
     FVCUNDC3D  CF   E             WORKSTN
     F                                     SFILE(VCUNDCD4:ZRECNO)
     F                                     INFDS(FBAREA)
     D TXT             S             15    DIM(1) CTDATA PERRCD(1)
     D CUNDS           DS
     D  RRNP                 397    400B 0
     D CUNDS1          DS
     D  RRNP1                397    400B 0
N07  D CUNDS3          DS
N07  D  RRNP3                397    400B 0
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  CTYPE                  1     30
     D  CTYPE1                 1      1
     D                 DS
     D  USØKKN                 1     30
     D  USØKKO                 1      2
     D  URRNI                  3     12
N22  D                 DS
N22  D  CEMAIL                 1     70
N22  D  CE                     1     70
N22  D                                     DIM(70)
N23  D                 DS
N23  D  CEMAILN                1     70
N23  D  CEN                    1     70
N23  D                                     DIM(70)
N02  D                 DS
N02  D  V                      1     60
N02  D                                     DIM(30)
N02  D  AVKVED                 1     60
N02  D  V01                    1      2
N02  D  V02                    3      4
N02  D  V03                    5      6
N02  D  V04                    7      8
N02  D  V05                    9     10
N02  D  V06                   11     12
N02  D  V07                   13     14
N02  D  V08                   15     16
N02  D  V09                   17     18
N02  D  V10                   19     20
N02  D  V11                   21     22
N02  D  V12                   23     24
N02  D  V13                   25     26
N02  D  V14                   27     28
N02  D  V15                   29     30
N02  D  V16                   31     32
N02  D  V17                   33     34
N02  D  V18                   35     36
N02  D  V19                   37     38
N02  D  V20                   39     40
N02  D  V21                   41     42
N02  D  V22                   43     44
N02  D  V23                   45     46
N02  D  V24                   47     48
N02  D  V25                   49     50
N02  D  V26                   51     52
N02  D  V27                   53     54
N02  D  V28                   55     56
N02  D  V29                   57     58
N02  D  V30                   59     60
N02  D                 DS
N02  D  w                      1     60
N02  D                                     DIM(30)
N02  D  WSKVED                 1     60
N02  D  W01                    1      2
N02  D  W02                    3      4
N02  D  W03                    5      6
N02  D  W04                    7      8
N02  D  W05                    9     10
N02  D  W06                   11     12
N02  D  W07                   13     14
N02  D  W08                   15     16
N02  D  W09                   17     18
N02  D  W10                   19     20
N02  D  W11                   21     22
N02  D  W12                   23     24
N02  D  W13                   25     26
N02  D  W14                   27     28
N02  D  W15                   29     30
N02  D  W16                   31     32
N02  D  W17                   33     34
N02  D  W18                   35     36
N02  D  W19                   37     38
N02  D  W20                   39     40
N02  D  W21                   41     42
N02  D  W22                   43     44
N02  D  W23                   45     46
N02  D  W24                   47     48
N02  D  W25                   49     50
N02  D  W26                   51     52
N02  D  W27                   53     54
N02  D  W28                   55     56
N02  D  W29                   57     58
N02  D  W30                   59     60
N08  D                 DS
N08  D  a                      1     80
N08  D                                     DIM(20)
N08  D  CAVD                   1     80
N08  D  AVD001                 1      4  0
N08  D  AVD002                 5      8  0
N08  D  AVD003                 9     12  0
N08  D  AVD004                13     16  0
N08  D  AVD005                17     20  0
N08  D  AVD006                21     24  0
N08  D  AVD007                25     28  0
N08  D  AVD008                29     32  0
N08  D  AVD009                33     36  0
N08  D  AVD010                37     40  0
N08  D  AVD011                41     44  0
N08  D  AVD012                45     48  0
N08  D  AVD013                49     52  0
N08  D  AVD014                53     56  0
N08  D  AVD015                57     60  0
N08  D  AVD016                61     64  0
N08  D  AVD017                65     68  0
N08  D  AVD018                69     72  0
N08  D  AVD019                73     76  0
N08  D  AVD020                77     80  0
N09  D                 DS
S16  D* CO                     1     60
S16  D*                                    DIM(5)
N16  D  CO                     1     10    DIM(5)
N09  D  COPD                   1     10
N09  D  COPD01                 1      2
N09  D  COPD02                 3      4
N09  D  COPD03                 5      6
N09  D  COPD04                 7      8
N09  D  COPD05                 9     10
N09   *
     C                   EXSR      INIT
      *______________
      * Clear Subfile
      *""""""""""""""
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     VCUNDCD5
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
      *_____________
      * Fill Subfile
      *"""""""""""""
N07  C     alfa          ifne      *blanks
     C     CUNKY1        SETLL     CUNDC06                            77
N07  C                   else
N14  C     WSRG          IFNE      *BLANKS
N14  C     CUNKYRG       SETLL     CUNDLFO                            77
N14  C                   else
N07  C     CUNKY3        SETLL     CUNDC03                            77
N14  c                   end
N07  c                   end
      *
     C     START1        TAG
     C                   DO        13
N07  C     alfa          ifne      *blanks
     C     CUNKY1B       READE     CUNDC06                                94
N07  C                   else
N14  C     RG            TAG
N14  C     WSRG          IFNE      *BLANKS
N14  C     CUNKYRG       reade     CUNDLFO                                94
N14  C     *IN94         ifeq      '0'
N14  C  N94CUNKYRGC      CHAIN     CUNDC03                            33
N14  c   33              goto      rg
N14  c                   end
N14  C                   ELSE
N07  C     CUNKY3B       READE     CUNDC03                                94
N14  c                   end
N07  c                   end
     C  N94CTYPE1        COMP      '*'                                9494
     C     *IN94         IFEQ      '0'
     C     CUNKY2        CHAIN     CUNDL01                            51
N07  C     alfa          ifne      *blanks
     C                   MOVE      RRNP1         SFRRN
N07  C                   else
N07  C                   move      RRNP3         SFRRN                    94
N07  c                   end
     C                   MOVEL     CCONTA        SFCONT
N04  c                   move      kundnr        sfkund
N11  C   51              move      *zeros        sfkund
     C  N51              MOVEL     KNAVN         SFNAVN
N14  C  N51              MOVEL     SYRG          SFRG
     C   51              EVAL      SFNAVN='* mail til bruker selv *'
     C                   MOVEL     CEMAIL        SFMAIL
     C                   move      clive         sflive
     C                   move      clive         sfPRIN
     C                   ADD       1             ZRECNO
     C                   Z-ADD     ZRECNO        CURS1
     C                   WRITE     VCUNDCD4
     C                   END                                                    <*IN94
     C  N94              ENDDO
      *
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C     YRECNO        IFGT      0
     C     YRECNO        SUB       1             ZRECNO
     C     ZRECNO        DIV       13            ZRECNO
     C     ZRECNO        MULT      13            ZRECNO
     C                   ADD       1             ZRECNO
     C                   ELSE
s14  C*                  GOTO      START5
n14  C                   GOTO      nyrec
     C                   ENDIF
      *________________
      * Display Subfile
      *""""""""""""""""
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C                   MOVE      '0'           *IN31
     C                   WRITE     VCUNDCD5
     C                   Z-ADD     WSSUBN        XRECNO
     C                   EXFMT     VCUNDCD3
     C                   READ      VCUNDCD5                               66
      *
     C     FKEYS         TAG
      *
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   END
      *
     C                   SETOFF                                       999830
      *** F3=Exit
     C     *IN03         IFEQ      '1'
     C                   GOTO      ENDPGM
     C                   END                                                    <*IN03
      *** F5=Refresh
     C     *IN05         IFEQ      '1'
     C                   clear                   SFCONT
     C                   CLEAR                   SFNAVN
     C                   CLEAR                   SFMAIL
     C                   GOTO      START
     C                   END                                                    <*IN05
      *** F6=NY
     C     *IN06         IFEQ      '1'
N14  C     nyrec         tag
N19  c                   z-add     0             f23ant
     C                   MOVE      *ZEROS        CCOMPN
     C                   MOVE      *BLANKS       KNAVN
     C                   MOVE      *BLANKS       CCONTA
     C                   MOVE      *BLANKS       CPHONE
     C                   MOVE      *BLANKS       CMOBIL
     C                   MOVE      *BLANKS       CFAX
     C                   MOVE      *BLANKS       CEMAIL
s15  C*                  MOVE      *BLANKS       Clive
n15  C                   MOVE      'V'           Clive
s15  C*                  MOVE      *BLANKS       CPRINT
n15  C                   MOVE      'N'           CPRINT
n10  C                   MOVE      *BLANKS       CMERGE
n03  C                   MOVE      *BLANKS       CEMNE
n08  C                   MOVE      *zeros        CAVD
n09  C                   MOVE      *blanks       COPD
n01  c                   setoff                                       40
N16  C                   EVAL      *IN04 = *OFF
N16  C                   EVAL      *IN30 = *OFF
N16  C                   EVAL      XCCOMPN = 0
     C                   GOTO      START5
     C                   END                                                    <*IN03
      *** F8=SØK
     C     *IN08         IFEQ      '1'
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     15            POSNBR
N14  c     nysok         tag
     C                   EXFMT     VCUNDCD8
N14  c                   setoff                                       3033
     C     *IN12         IFEQ      '0'
     C                   MOVEL     WSSOK         ALFA
N14  C                   MOVEL     WSRG11        WSRG             14
N14  C     wsrg          ifne      *blanks
N14  C     CUNKYRG       chain     CUNDLFO                            33
N14  C     *in33         ifeq      '1'
N14  C                   SETON                                        30
N14  C                   MOVE      'SHU1506'     MSGNR
N14  c                   goto      nysok
N14  c                   end
N14  c                   end
     C                   END
N14  c                   move      *blanks       wsrg11
     C                   GOTO      START
     C                   END                                                    <*IN03
      *** F12=Cancel
     C     *IN12         IFEQ      '1'
     C                   clear                   SFCONT
     C                   CLEAR                   SFNAVN
     C                   CLEAR                   SFMAIL
     C                   CLEAR                   SFLIVE
     C                   CLEAR                   SFPRIN
N14  c                   move      *blanks       wsrg
N14  c                   move      *blanks       wsrg11
     C                   GOTO      START
     C                   END                                                    <*IN12
      *** Roll
     C     *IN25         IFEQ      '1'
     C                   Z-ADD     YRECNO        ZRECNO
     C                   MOVE      '0'           *IN25
     C     START4        TAG
     C     *IN94         IFEQ      '0'
     C                   GOTO      START1
     C                   END                                                    <*IN94
     C                   END                                                    <*IN25
      *** Get options from screen
     C     ZRECNO        IFNE      0
     C                   EXSR      GETOPT
      *** No option selected
     C     *IN97         IFEQ      '1'
     C                   EXFMT     VCUNDCD3
     C                   READ      VCUNDCD5                               66
     C                   MOVE      '0'           *IN97
     C                   GOTO      FKEYS
     C                   END                                                    <*IN12
      *** F3=Exit
     C     *IN03         IFEQ      '1'
     C                   GOTO      ENDPGM
     C                   END                                                    <*IN03
     C                   END                                                    <ZRECNO
     C     *IN98         IFEQ      '1'
     C     XRECNO        ANDNE     0
     C                   Z-ADD     XRECNO        ZRECNO
     C                   END                                                    <*IN98
     C                   GOTO      START3
      *** New record
     C     START5        TAG
     C                   MOVEL     'Ny      '    WMODE
N16  C                   IF        *IN04 = *OFF AND *IN30 = *OFF
N02  C                   MOVE      *BLANKS       WSKVED
N02  C     VEDKEY        CHAIN     ARKVEDK                            33
N02  C  N33              MOVE      AVKVED        WSKVED
N16  C                   EVAL      LINNBR = 4
N16  C                   EVAL      POSNBR = 9
N16  C                   END
N16  C     START5B       TAG
N13  C                   EVAL      *IN27 = *ON
S27  C*    CCONTA        COMP      'EMMA XML'                             28
N27  C     CCONTA        COMP      'EMMA-XML'                             28
N27  C  N28CCONTA        COMP      'PROTERIA-XML'                         28
N13  C  N28CLIVE         COMP      'X'                                    28
N13  C   28              EVAL      *IN27 = *OFF
     C                   EXFMT     VCUNDCD1
N16  C     WSCLOC        DIV       256           LINNBR            3 0
N16  C                   MVR                     POSNBR            3 0
     C                   MOVEA     '00000'       *IN(61)
     C                   MOVE      '0'           *IN(67)
     C                   MOVE      '0'           *IN30
      *** F3=Exit
      *** F12=Cancel
     C     *IN12         IFEQ      '1'
     C     *IN03         OREQ      '1'
N16  C   12              GOTO      START3
     C                   GOTO      ENDPGM
     C                   ELSE
      *
      * 04=SØKK KUNDE
      *
     C   04              DO
N16  C                   SELECT
N16  C                   WHEN      LINNBR = 4
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    CCOMPN            8 0
     C                   PARM                    UFIRMA
     C                   PARM                    USØKKN           30
     C* RETUR MED KONTAKTPERS
     C     USØKKO        IFEQ      'KP'
     C                   MOVE      URRNI         RRN              10 0
     C     RRN           CHAIN(N)  CUNDC                              31
     C  N31              MOVEL     USOK          CTYPE
     C  N31              goto      start5
     C                   END
N16  C                   WHEN      LINNBR = 18 OR LINNBR = 19
N16  C                   EXSR      SOKVEDL
N16  C                   WHEN      LINNBR = 22
N16  C                   EXSR      SOKOT
N16  C                   ENDSL
N16  C                   GOTO      START5
     C                   END
     C     CCOMPN        IFNE      0
     C     CUNKY2        CHAIN     CUNDL01                            70
     C   70              SETON                                        30
     C   70              MOVE      'SPK0001'     MSGNR
N16  C   70              EVAL      LINNBR = 4
N16  C   70              EVAL      POSNBR = 9
     C   70              GOTO      START5
     C                   END
      * melding ved 0 i epostadresse
N19  c                   setoff                                       69
N19  c                   eval      fare2=*blanks
s19  C* N23CCOMPN        IFeq      0
n19  c     ccompn        ifeq      0
n19  c     f23ant        andle     1
N19  c     CEMAIL        andne     *blanks
N19  c     CCONTA        andne     *blanks
n19  c     *in23         ifeq      '1'
N19  c                   add       1             F23ant            2 0
n19  c                   end
N12  C                   SETON                                        3070
N12  C                   MOVE      'SHU1454'     MSGNR
n19  C                   seton                                        69
N19  C                   eval      fare2=CEMAIL
N12  C                   GOTO      START5
N12  C                   end
N16   *
N16  C                   IF        CCONTA = 'EMMA-XML' OR CLIVE = 'X'
N27  C                             OR CCONTA = 'PROTERIA-XML'
N27  C                   IF        CCONTA <> 'PROTERIA-XML'
N16  C                   EVAL      CCONTA = 'EMMA-XML'
N27  C                   END
N16  C                   EVAL      CLIVE  = 'X'
N16  C                   EVAL      CMERGE = ' '
N16  C                   IF        CPHONE = *BLANKS OR CMOBIL = *BLANKS
N16  C     CUNDC02K      CHAIN     CUNDC02                            33
N16  C                   IF        *IN33 = *OFF
N16  C                   EVAL      XCCOMPN = C2_CCOMPN
N16  C                   EVAL      CPHONE = C2_CPHONE
N16  C                   EVAL      CMOBIL = C2_CMOBIL
N16  C                   EVAL      CFAX   = C2_CFAX
N16  C                   EVAL      CEMAIL = C2_CEMAIL
N16  C                   EVAL      LINNBR = 7
N16  C                   EVAL      POSNBR = 27
N16  C                   EVAL      *IN88  = *OFF
N16  C                   GOTO      START5B
N16  C                   END
N16  C                   END
N16  C                   END
N16   *
     C                   EXSR      TESTB1
     C     *IN30         IFEQ      '1'
     C                   GOTO      START5
     C                   END                                                    <*IN30
     C                   END                                                    <*IN12
s12  C*                  GOTO      START3
n12  C                   GOTO      START
      *
     C     ENDPGM        TAG
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C*
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
     C*          N40 = NEW
     C*           40 = CHANGE
     C***********************************************
     C                   EXSR      TSTSCR
     C     *IN30         IFEQ      '1'
     C                   GOTO      ENDTST
     C                   END                                                    <*IN30
     C     CUNKY2        CHAIN     CUNDL01                            51
     C     *IN40         IFEQ      '1'
     C                   UPDATE    CUNDCR
     C                   ELSE
     C                   MOVEL     UFIRMA        CFIRMA
N05  C     ccompn        ifeq      0
N05  c                   move      *blanks       sonavn
N05  c                   end
     C                   WRITE     CUNDCR
N09   *
N09  C                   IF        CLIVE = 'X' AND WSKVED = *BLANKS
N09  C     ARKVEDKK2     CHAIN(N)  ARKVEDK                            33
N09  C  N33              EVAL      WSKVED = AVKVED
N09  C                   END
N09   *
     C                   END                                                    <*IN40
      *
      * OPPDATERER VEDLEGG DOKUMENTKODE
      *
N02  C     VEDKEY        CHAIN     ARKVEDK                            33
N02  C     WSKVED        IFEQ      *BLANKS
N02  C  N33              DELETE    ARKVEDKR
N02  C                   ELSE
N02  C                   MOVE      WSKVED        AVKVED
N02  C  N33              UPDATE    ARKVEDKR
N02  C   33              MOVE      CCOMPN        AVKUND
N02  C   33              WRITE     ARKVEDKR
N02  C                   END
     C*
     C                   MOVEL     USOK          SFTYPE
     C                   MOVEL     CCONTA        SFCONT
     C  N51              MOVEL     KNAVN         SFNAVN
N20  C  N51              MOVEL     SYRG          SFRG
     C   51              EVAL      SFNAVN='* mail til bruker selv *'
N20  C   51              MOVE      *ZEROS        SFKUND
N20  C   51              MOVE      *BLANKS       SFRG
     C                   MOVEL     CEMAIL        SFMAIL
     C                   MOVEL     CLIVE         SFLIVE
     C                   MOVEL     CLIVE         SFPRIN
     C     *IN40         IFEQ      '1'
     C                   UPDATE    VCUNDCD4
     C                   ELSE
     C                   ADD       1             YRECNO
     C                   Z-ADD     YRECNO        ZRECNO
     C                   MOVE      RRNP          SFRRN
     C                   WRITE     VCUNDCD4
     C                   END                                                    <*IN40
     C                   EXSR      CLRSCR
      *
     C     ENDTST        ENDSR
      ***********************************************************
     C     TSTSCR        BEGSR
      ***********************************************************
     C                   MOVE      '0'           *IN30
     C                   MOVEA     '00000'       *IN(61)
     C                   MOVE      '0'           *IN(67)
     c                   call      'SYGE126'
     c                   parm                    cemail
     c                   parm                    umsgnr            7
     C*
     C     CCONTA        IFEQ      *BLANKS
     C                   MOVE      'CBA0130'     MSGNR
     C                   MOVE      '1'           *IN61
     C                   MOVE      '1'           *IN30
N16  C                   EVAL      LINNBR = 7
N16  C                   EVAL      POSNBR = 27
     C                   GOTO      TSTEND
     C                   END                                                    <CCONTA
      * ikke blank epostadresse når kunde ulik 0
     C     CEMAIL        IFEQ      *BLANKS
ssh  C*    CCOMPN        IFNE      0
     C                   MOVE      'SHU1128'     MSGNR
     C                   MOVE      '1'           *IN62
     C                   MOVE      '1'           *IN30
N16  C                   EVAL      LINNBR = 13
s19  C*                  EVAL      POSNBR = 6
n19  C                   EVAL      POSNBR = 27
     C                   GOTO      TSTEND
ssh  c*                  end
     C                   ELSE
N28   * ikke blank epostadresse
N28   *
N28   * ikke STARTE MED BLANK
N28  c     CE(1)         ifeq      ' '
N28  C                   SETON                                        3062
N28  C                   MOVE      'SHU2029'     MSGNR
N28  C                   z-add     13            LINNBR
N28  C                   z-add     27            POSNBR
N28  C                   GOTO      TSTEND
N28  C                   END
      * må finnes @ tegn i adressen
     C     '@'           SCAN      CEMAIL        nr                2 0    63
N23   * ikke 2 @ i en epostadresse
N23  c                   move      *blanks       cemailn          70
N23  C   63nr            add       1             nrn               2 0
N23  C   63              movea     ce(nrn)       cen
N23  c   63'@'           SCAN      CEMAILN                                64
N23  c     *in64         ifeq      '1'
N23  C                   SETON                                        3062
N23  C                   MOVE      'SHU1906'     MSGNR
s28  C*                  z-add     8             LINNBR
s28  C*                  z-add     10            POSNBR
N28  C                   z-add     13            LINNBR
N28  C                   z-add     27            POSNBR
N23  C                   GOTO      TSTEND
n23  C                   endif
N29   * må ha . etter @
N29  C   63              movea     ce(nrn)       cen
N29  c   63'.'           SCAN      CEMAILN                                64
N29  c     *in64         ifeq      '0'
N29  C                   SETON                                        3062
N29  C                   MOVE      'SHU2031'     MSGNR
N29  C                   z-add     13            LINNBR
N29  C                   z-add     27            POSNBR
N29  C                   GOTO      TSTEND
n29  C                   endif
N26  C     CEMAIL        IFEQ      '@'
N26  C                   GOTO      OK
N26  C                   END
n06  C  N63'*'           SCAN      CEMAIL                                 63
n06  C  N63'Ø'           SCAN      CEMAIL                                 63
N21  c                   setoff                                       64
N21  c   63'mailto:'     SCAN      cemail                                 64
N21  c   64              setoff                                       63
N21  c   63';'           SCAN      cemail                                 64
N21  c   64              setoff                                       63
N25  c   63','           SCAN      cemail                                 64
N25  c   64              setoff                                       63
N24  C   63'æ'           SCAN      cemail                                 64
N24  c   64              setoff                                       63
N24  C   63'ø'           SCAN      cemail                                 64
N24  c   64              setoff                                       63
N24  C   63'å'           SCAN      cemail                                 64
N24  c   64              setoff                                       63
N22  c     *in63         ifeq      '1'
N22  c                   z-add     70            nr                2 0
N22  c                   do        70
N22  c     CE(nr)        ifne      ' '
N22   *
N22  c     CE(nr)        IFGE      'a'
N22  c     CE(nr)        andle     'z'
N22  c                   goto      ok
N22  c                   end
N22  c     CE(nr)        IFGE      'A'
N22  c     CE(nr)        andle     'Z'
N22  c                   goto      ok
N22  c                   end
N22  C                   SETON                                        3062
N22  C                   MOVE      'SHU1905'     MSGNR
s28  C*                  z-add     8             LINNBR
s28  C*                  z-add     10            POSNBR
N28  C                   z-add     13            LINNBR
N28  C                   z-add     27            POSNBR
N22  C                   GOTO      TSTEND
n22  C                   endif
n22  c                   sub       1             nr
n22  C                   enddo
N22  C                   END
     c     *in(63)       ifeq      '0'
     C                   SETON                                        3062
     C                   MOVE      'SHU1128'     MSGNR
s28  C*                  z-add     8             LINNBR
s28  C*                  z-add     10            POSNBR
N28  C                   z-add     13            LINNBR
N28  C                   z-add     27            POSNBR
     C                   GOTO      TSTEND
     C                   END
     C                   END                                                    <CCONTA
N22  c     ok            tag
     C*
     C     TSTEND        ENDSR
     C*
      ***********************************************
     C     GETOPT        BEGSR
      ***********************************************
     C                   Z-ADD     0             OPTNBR            2 0
     C                   SETOFF                                       919299
     C                   MOVE      '1'           *IN97
     C     *IN98         DOWEQ     '0'
     C                   READC     VCUNDCD4                               98
     C     *IN98         IFEQ      '1'
     C     *IN99         IFEQ      '1'
     C                   MOVE      '0'           *IN98
     C                   END                                                    <*IN99
     C                   GOTO      ENDGET
     C                   END                                                    <*IN98
     C                   MOVE      '0'           *IN97
     C                   Z-ADD     CURS1         ZRECNO
      *** 1=PICK E=EPOST F=FAX
     C     WSNR          IFEQ      '1 '
     C     WSNR          OREQ      ' 1'
     C     WSNR          OREQ      '01'
     C     WSNR          OREQ      'E '
     C     WSNR          OREQ      ' E'
     C     WSNR          OREQ      'F '
     C     WSNR          OREQ      ' F'
     C                   MOVE      SFRRN         URRN
     C     WSNR          IFEQ      'F '
     C     WSNR          OREQ      ' F'
     C                   MOVE      'F'           EPOFAX
     C                   END
     C     WSNR          IFEQ      'E '
     C     WSNR          OREQ      ' E'
     C                   MOVE      'E'           EPOFAX
     C                   END
     C                   SETON                                        LR
     C                   RETURN
     C                   END                                                    <SFNAVN
      *** 2=Change
     C     WSNR          IFEQ      '2 '
     C     WSNR          OREQ      ' 2'
     C     WSNR          OREQ      '02'
     C                   ADD       1             OPTNBR
     C                   MOVE      ' '           WSNR
     C                   MOVEL     'Endre   '    WMODE
     C     SFNAVN        IFEQ      TXT(1)
     C                   MOVE      'CBA0120'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      ENDGET
     C                   END                                                    <SFNAVN
     C                   MOVE      '1'           *IN40
     C                   EXSR      CHGST
      *** F12=Cancel
     C     *IN12         IFEQ      '1'
     C                   GOTO      ENDGET
     C                   END                                                    <*IN12
     C                   MOVE      '0'           *IN40
     C                   END                                                    <WSNR=2
      *** 3=Copy
     C     WSNR          IFEQ      '3 '
     C     WSNR          OREQ      ' 3'
     C     WSNR          OREQ      '03'
     C                   ADD       1             OPTNBR
     C                   MOVE      ' '           WSNR
     C                   MOVEL     'Kopier  '    WMODE
     C     SFNAVN        IFEQ      TXT(1)
     C                   MOVE      'CBA0120'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      ENDGET
     C                   END                                                    <SFNAVN
     C                   EXSR      CPYST
      *** F12=Cancel
     C     *IN12         IFEQ      '1'
     C                   GOTO      ENDGET
     C                   END                                                    <*IN12
     C                   END                                                    <WSNR=3
      *** 4=Delete
     C     WSNR          IFEQ      '4 '
     C     WSNR          OREQ      ' 4'
     C     WSNR          OREQ      '04'
     C                   ADD       1             OPTNBR
     C                   MOVE      ' '           WSNR
     C                   MOVEL     'Slett   '    WMODE
     C     SFNAVN        IFEQ      TXT(1)
     C                   MOVE      'CBA0120'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      ENDGET
     C                   END                                                    <SFNAVN
     C                   EXSR      DLTST
      *** F12=Cancel
     C     *IN12         IFEQ      '1'
     C                   GOTO      ENDGET
     C                   END                                                    <*IN12
     C                   END                                                    <WSNR=4
      *** 5=Display
     C     WSNR          IFEQ      '5 '
     C     WSNR          OREQ      ' 5'
     C     WSNR          OREQ      '05'
     C                   ADD       1             OPTNBR
     C                   MOVE      ' '           WSNR
     C                   MOVEL     'Vise    '    WMODE
     C     SFNAVN        IFEQ      TXT(1)
     C                   MOVE      'CBA0120'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      ENDGET
     C                   END                                                    <SFNAVN
     C     SFRRN         CHAIN(N)  CUNDC                              77
     C  N77CUNKY2        CHAIN     CUNDL01                            51
     C                   MOVE      '1'           *IN88
     C   51              EVAL      KNAVN='* mail til bruker selv *'
N05  C                   MOVE      *BLANKS       WSKVED
N05  C     VEDKEY        CHAIN     ARKVEDK                            33
N05  C  N33              MOVE      AVKVED        WSKVED
N13  C                   EVAL      *IN27 = *ON
S27  C*    CCONTA        COMP      'EMMA XML'                             28
N27  C     CCONTA        COMP      'EMMA-XML'                             28
N27  C  N28CCONTA        COMP      'PROTERIA-XML'                         28
N27  C  N28CCONTA        COMP      'PROTERIA-XML'                         28
N13  C  N28CLIVE         COMP      'X'                                    28
N13  C   28              EVAL      *IN27 = *OFF
     C                   EXFMT     VCUNDCD1
      *** F12=Cancel
     C     *IN12         IFEQ      '1'
     C                   UPDATE    VCUNDCD4
     C                   GOTO      ENDGET
     C                   END                                                    <*IN12
     C                   MOVEA     '00000'       *IN(61)
     C                   MOVE      '0'           *IN(67)
     C                   MOVE      '0'           *IN88
     C                   UPDATE    VCUNDCD4
     C                   END                                                    <WSNR=5
     C                   ENDDO
      *
     C     ENDGET        TAG
      *
     C                   ENDSR
      ***********************************************
     C     CHGST         BEGSR
      ***********************************************
     C                   MOVE      '0'           *IN88
     C     SFRRN         CHAIN     CUNDC                              77
     C  N77CUNKY2        CHAIN     CUNDL01                            51
     C   51              EVAL      KNAVN='* mail til bruker selv *'
     C                   MOVE      '1'           *IN99
N02  C                   MOVE      *BLANKS       WSKVED
N02  C     VEDKEY        CHAIN     ARKVEDK                            33
N02  C  N33              MOVE      AVKVED        WSKVED
N16  C                   EVAL      LINNBR = 7
N16  C                   EVAL      POSNBR = 27
     C     STCHG         TAG
N13  C                   EVAL      *IN27 = *ON
S27  C*    CCONTA        COMP      'EMMA XML'                             28
N27  C     CCONTA        COMP      'EMMA-XML'                             28
N27  C  N28CCONTA        COMP      'PROTERIA-XML'                         28
N13  C  N28CLIVE         COMP      'X'                                    28
N13  C   28              EVAL      *IN27 = *OFF
     C                   EXFMT     VCUNDCD1
N16  C     WSCLOC        DIV       256           LINNBR            3 0
N16  C                   MVR                     POSNBR            3 0
     C                   MOVE      '0'           *IN30
     C                   MOVEA     '00000'       *IN(61)
     C                   MOVE      '0'           *IN(67)
     C     *IN12         IFEQ      '1'
     C     *IN03         OREQ      '1'
     C                   UPDATE    VCUNDCD4
     C                   GOTO      CHGEND
     C                   END                                                    <*IN12
N16   *
N16  C   04              DO
N16  C                   SELECT
N16  C                   WHEN      LINNBR = 4
N16  C                   MOVE      *BLANKS       USØKKN           30
N16  C                   CALL      'SOEKKUN'
N16  C                   PARM                    CCOMPN            8 0
N16  C                   PARM                    UFIRMA
N16  C                   PARM                    USØKKN           30
N16  C* RETUR MED KONTAKTPERS
N16  C     USØKKO        IFEQ      'KP'
N16  C                   MOVE      URRNI         RRN              10 0
N16  C     RRN           CHAIN(N)  CUNDC                              31
N16  C  N31              MOVEL     USOK          CTYPE
N16  C  N31              goto      STCHG
N16  C                   END
N16  C                   WHEN      LINNBR = 18 OR LINNBR = 19
N16  C                   EXSR      SOKVEDL
N16  C                   WHEN      LINNBR = 22
N16  C                   EXSR      SOKOT
N16  C                   ENDSL
N16  C                   GOTO      STCHG
N16  C                   END
N16   *
     C                   EXSR      TESTB1
     C     *IN30         IFEQ      '1'
     C                   GOTO      STCHG
     C                   END                                                    <*IN30
      *
     C     CHGEND        TAG
     C                   ENDSR
     C*
      ***********************************************
     C     CPYST         BEGSR
      ***********************************************
     C                   MOVE      '0'           *IN88
     C     SFRRN         CHAIN(N)  CUNDC                              77
     C  N77CUNKY2        CHAIN     CUNDL01                            51
     C   51              EVAL      KNAVN='* mail til bruker selv *'
     C                   MOVE      '1'           *IN99
     C                   UPDATE    VCUNDCD4
N16  C                   EVAL      LINNBR = 4
N16  C                   EVAL      POSNBR = 9
     C     STCPY         TAG
N13  C                   EVAL      *IN27 = *ON
S27  C*    CCONTA        COMP      'EMMA XML'                             28
N27  C     CCONTA        COMP      'EMMA-XML'                             28
N27  C  N28CCONTA        COMP      'PROTERIA-XML'                         28
N13  C  N28CLIVE         COMP      'X'                                    28
N13  C   28              EVAL      *IN27 = *OFF
     C                   EXFMT     VCUNDCD1
N16  C     WSCLOC        DIV       256           LINNBR            3 0
N16  C                   MVR                     POSNBR            3 0
     C                   MOVE      '0'           *IN30
     C                   MOVEA     '00000'       *IN(61)
     C                   MOVE      '0'           *IN(67)
     C     *IN12         IFEQ      '1'
     C     *IN03         OREQ      '1'
     C                   EXSR      CLRSCR
     C                   MOVEA     '00000'       *IN(61)
     C                   MOVE      '0'           *IN(67)
     C                   GOTO      CPYEND
     C                   END                                                    <*IN12
N16   *
N16  C   04              DO
N16  C                   SELECT
N16  C                   WHEN      LINNBR = 4
N16  C                   MOVE      *BLANKS       USØKKN           30
N16  C                   CALL      'SOEKKUN'
N16  C                   PARM                    CCOMPN            8 0
N16  C                   PARM                    UFIRMA
N16  C                   PARM                    USØKKN           30
N16  C* RETUR MED KONTAKTPERS
N16  C     USØKKO        IFEQ      'KP'
N16  C                   MOVE      URRNI         RRN              10 0
N16  C     RRN           CHAIN(N)  CUNDC                              31
N16  C  N31              MOVEL     USOK          CTYPE
N16  C  N31              goto      STCPY
N16  C                   END
N16  C                   WHEN      LINNBR = 18 OR LINNBR = 19
N16  C                   EXSR      SOKVEDL
N16  C                   WHEN      LINNBR = 22
N16  C                   EXSR      SOKOT
N16  C                   ENDSL
N16  C                   GOTO      STCPY
N16  C                   END
N16   *
     C                   MOVE      '0'           *IN40
     C                   EXSR      TESTB1
     C     *IN30         IFEQ      '1'
     C                   GOTO      STCPY
     C                   END                                                    <*IN30
      *
     C     CPYEND        TAG
     C                   ENDSR
     C*
      ***********************************************
     C     DLTST         BEGSR
      ***********************************************
     C                   MOVE      '1'           *IN99
     C                   MOVEA     '11'          *IN(88)
     C     SFRRN         CHAIN     CUNDC                              77
     C  N77CUNKY2        CHAIN     CUNDL01                            51
     C   51              EVAL      KNAVN='* mail til bruker selv *'
N13  C                   EVAL      *IN27 = *ON
S27  C*    CCONTA        COMP      'EMMA XML'                             28
N27  C     CCONTA        COMP      'EMMA-XML'                             28
N27  C  N28CCONTA        COMP      'PROTERIA-XML'                         28
N13  C  N28CLIVE         COMP      'X'                                    28
N13  C   28              EVAL      *IN27 = *OFF
     C                   EXFMT     VCUNDCD1
     C                   MOVEA     '00'          *IN(88)
     C     *IN11         IFEQ      '1'
     C     *IN77         IFEQ      '0'
N18  C     VEDKEY        CHAIN     ARKVEDK                            33
N18  C  N33              DELETE    ARKVEDKR
     C                   DELETE    CUNDCR
     C                   END                                                    <*IN77
     C                   MOVEL     CCONTA        SFCONT
     C                   MOVEL     TXT(1)        SFNAVN
     C                   END                                                    <*IN11
     C                   UPDATE    VCUNDCD4
      *
     C                   ENDSR
      ***********************************************
     C     CLRSCR        BEGSR
      ***********************************************
     C                   MOVE      '0'           *IN40
     C                   CLEAR                   CCONTA
     C                   CLEAR                   CPHONE
      *
     C                   ENDSR
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     *LIKE         DEFINE    CFIRMA        UFIRMA
N16  C     *LIKE         DEFINE    CCOMPN        XCCOMPN
     C     *ENTRY        PLIST
     C                   PARM                    UFIRMA
     C                   PARM                    USOK             30
     C                   PARM                    URRN             10 0
     C                   PARM                    EPOFAX            1
     C                   MOVEL     USOK          SFTYPE
n08  C                   MOVE      *zeros        CAVD
      *--------------------------------------------------------------
      * DEFINE KEY FOR CUNDC01
      *--------------------------------------------------------------
N14  C     CUNKYRG       KLIST
N14  C                   KFLD                    UFIRMA
N14  C                   KFLD                    WSRG
N14  C     CUNKYRGC      KLIST
N14  C                   KFLD                    UFIRMA
N07  C                   KFLD                    USOKK            30
N14  C                   KFLD                    KUNDNR
     C     ARKKEY        KLIST
     C                   KFLD                    USOKK15          15
N02  C     VEDKEY        KLIST
N02  C                   KFLD                    AVFIRM            2
N02  C                   KFLD                    CCOMPN
N02  C                   KFLD                    AVTYPE            2
N02  C                   MOVE      UFIRMA        AVFIRM
N16  C     ARKVEDKK2     KLIST
N16  C                   KFLD                    AVFIRM
N16  C                   KFLD                    XCCOMPN
N16  C                   KFLD                    AVTYPE
N16  C     CUNDC02K      KLIST
N16  C                   KFLD                    UFIRMA
N16  C                   KFLD                    CCONTA
     C     CUNKY1        KLIST
     C                   KFLD                    UFIRMA
     C                   KFLD                    USOKK            30
     C                   KFLD                    ALFa             10
     C     CUNKY1B       KLIST
     C                   KFLD                    UFIRMA
     C                   KFLD                    USOKK            30
     C     CUNKY2        KLIST
     C                   KFLD                    UFIRMA
     C                   KFLD                    CCOMPN
N07  C     CUNKY3        KLIST
N07  C                   KFLD                    UFIRMA
N07  C                   KFLD                    USOKK            30
N07  C                   KFLD                    WSKUND
N07  C     CUNKY3B       KLIST
N07  C                   KFLD                    UFIRMA
N07  C                   KFLD                    USOKK            30
      *
      *
     C                   MOVE      '1'           *IN50
      *
     C     USOK          IFEQ      *BLANKS
     C                   MOVEL     '*'           USOKK
     C                   ELSE
     C                   MOVEL     USOK          USOKK16          16
     C                   MOVE      USOKK16       USOKK15
N02  C     ARKKEY        CHAIN     ARKTXTL1                           33
N02  C  N33              MOVE      ARTYPE        AVTYPE
     C                   MOVE      USOK          USOKK
     C                   MOVE      USOK          CTYPE
     C                   END
     C                   ENDSR
      *
N16   ***********************************************
N16  C     SOKVEDL       BEGSR
N16   ***********************************************
N16  C     POSNBR        CABLT     6             SLSOKVEDL
N16  C     POSNBR        CABGT     49            SLSOKVEDL
N16  C                   MOVE      *ZEROS        XNR               3 0
N16  C                   EVAL      XNR = (POSNBR - 6) / 3
N16  C                   EVAL      XNR = XNR + 1
N16   *
N16  C                   IF        LINNBR = 19
N16  C                   EVAL      XNR = XNR + 15
N16  C                   END
N16  C                   EVAL      UTYP = 'FUNKSJON'
N16  c                   EVAL      UKOD = W(XNR)
N16  C                   CALL      'SYFAKDA'
N16  C                   PARM                    UTYP             10
N16  C                   PARM                    UUPDAT            1
N16  C                   PARM                    UKOD              5
N16  c                   IF        UKOD <> *BLANKS
N16  c                   EVAL      W(XNR) = UKOD
N16  c                   END
N16  C                   SELECT
N16  C                   WHEN      XNR = 15
N16  C                   EVAL      LINNBR = 19
N16  C                   EVAL      POSNBR = 6
N16  C                   WHEN      XNR < 30
N16  C                   EVAL      POSNBR = POSNBR + 3
N16  C                   ENDSL
N16   *
N16  C     SLSOKVEDL     ENDSR
N16   *
N16   ***********************************************
N16  C     SOKOT         BEGSR
N16   ***********************************************
N16  C     POSNBR        CABLT     27            SLSOKOT
N16  C     POSNBR        CABGT     48            SLSOKOT
N16  C                   EVAL      XNR = (POSNBR - 27) / 5
N16  C                   EVAL      XNR = XNR + 1
N16   *
N16  c                   EVAL      UOT = CO(XNR)
N16  C                   CALL      'SYFI10C'
N16  C                   PARM                    UOT               2
N16  c                   IF        UOT <> *BLANKS
N16  c                   EVAL      CO(XNR) = UOT
N16  c                   END
N16  C                   IF        XNR < 5
N16  C                   EVAL      POSNBR = POSNBR + 5
N16  C                   END
N16   *
N16  C     SLSOKOT       ENDSR
N16   *
**
*** SLETTET ***
