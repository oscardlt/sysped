********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX * 01 SH  PTF11 LEVERANDØR innført litt rå sletting i source
      *%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
11XXX * 02 JOV PTF12 Hvis IKKE treff returner feil=I,slik at SYKS02 kan sjekke navitroFirma-standard
      *              Burde være gjort HER men kun EN %sats i param men NAVITRO har avvikende + / -
********************************************************************
     H DECEDIT(',') debug(*yes)
      ************************************************************************
      *  budsjett feil
      ************************************************************************
     FKODTGE    IF   E           K DISK
     FFAKT      IF   E           K DISK
     FFIRM      IF   E           K DISK
     FHEADF     IF   E           K DISK
     FTRAPRAV   IF   E           K DISK
     D                 DS
     D  TRVK01                 1      5  0
     D  TRVK02                 6     10  0
     D  TRVK03                11     15  0
     D  TRVK04                16     20  0
     D  TRVK05                21     25  0
     D  TRVK06                26     30  0
     D  TRVK07                31     35  0
     D  TRVK08                36     40  0
     D  TRVK09                41     45  0
     D  TRVK10                46     50  0
     D  TRVK11                51     55  0
     D  TRVK12                56     60  0
     D  FV                     1     60  0
     D                                     DIM(12) ASCEND                       VEKTGR. AVTALE
     D                 DS
     D  TRPA01                 1      3  1
     D  TRPA02                 4      6  1
     D  TRPA03                 7      9  1
     D  TRPA04                10     12  1
     D  TRPA05                13     15  1
     D  TRPA06                16     18  1
     D  TRPA07                19     21  1
     D  TRPA08                22     24  1
     D  TRPA09                25     27  1
     D  TRPA10                28     30  1
     D  TRPA11                31     33  1
     D  TRPA12                34     36  1
     D  FP                     1     36  1
     D                                     DIM(12)                              VEKTGR. AVTALE
      *
     c                   exsr      init
      *
      *
s01  C*    dftran        chain     traprav                            33
n01  C     kalnr         chain     traprav                            33
     c     *in33         ifeq      '0'
     c                   z-add     hevkt         vekt5             5 0
     c                   z-add     1             xn                2 0
     C     vekt5         LOOKUP    FV(XN)                             76  76
     c     *in76         ifeq      '1'
     c                   z-add     FP(XN)        upros
     c                   z-sub     FP(XN)        uprosn            3 1
     c                   move      'N'           feil1
     c     kbdiff        ifgt      upros
     c                   move      'J'           feil1
     C                   end
     c     kbdiff        iflt      uprosn
     c                   move      'J'           feil1
     C                   end
     C                   end
n02  C                   else
n02  c                   move      'I'           feil1                          Ikke treff
     C                   END
     c                   seton                                        lr
     c                   return
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     *entry        plist
     C                   parm                    kbavd             4 0
     C                   parm                    kbopd             7 0
     C                   parm                    kbvk              3
     c                   parm                    kbblhb           13 2
     c                   parm                    kbbuds           13 2
     c                   parm                    kbblf            13 2
     c                   parm                    upros             3 1
     c                   parm                    kbdiff            5 2
N01  c                   parm                    KALNR             8 0
N01  c                   parm                    kbkdm             1 0
     C                   parm                    feil1             1
     C     headfk        KLIST
     C                   KFLD                    KBAVD
     C                   KFLD                    KBOPD
     C     kodtgek       KLIST
     C                   KFLD                    KODEGE            2
     C                   KFLD                    KBVK
     C                   move      'GE'          KODEGE
      *
      * hent utfakturert
      *
      *
     c                   read      firm                                   33
     c                   z-add     1             FITAXB            5 4
     C                   MOVE      FITAX         FITAXB
     c     kbkdm         ifeq      1
     c                   mult(h)   fitaxb        kbbuds
     c                   end
     C     HEADFK        CHAIN     HEADF                              33
     c                   exsr      srfakt
     c     KBBUDS        ifne      0
     C     KBBLHB        DIV(h)    KBBUDS        work             14 4
     C                   mult      100           work             14 4
     C                   sub       100           work
     C                   z-add     work          KBDIFF            5 2
     c                   else
     c                   z-add     100           KBDIFF
     c                   end
     C                   ENDSR
      *******************************************************************
     C     SRFAKT        BEGSR
      *******************************************************************
     C     kodtgek       chain     kodtge                             33
     C                   MOVE      *ZEROS        fasum
     C     HEADFK        SETLL     FAKT
     C     HEADFK        READE     FAKT                                   33
     C                   DOW       *IN33 = *OFF
     C                   IF        (((FAKDA <> 'K') AND
     C                               (FAKDA <> 'D')))
     C     FAVK          IFEQ      'FRA'
     C     FAVK          OREQ      'TGF'
     C     FAVK          OREQ      'TGI'
     C     FAVK          OREQ      'FR1'
     C     FAVK          OREQ      'FR2'
     C                   ADD       FABELN        FASUM            11 2
     C                   END
     C                   END
     C     HEADFK        READE     FAKT                                   33
     C                   ENDDO
      *
     c                   add       fasum         kbblf
     C                   ENDSR
