      *
      ***********************************************************
BL    *BL  Rettet av it Bring                                  **
BRI   * 01  HENT MVA-KODE KUN FRA amountIndicator
BRI   * 02  VED SAMME GODSNR+POS SKAL SJEKKE CMR-NR
BRI   * 03  VED TL IKKE KOMMER SETTER F PÅ SVPVA (TOLLFRI)
BRI   * 04  FINN GAMMEL AWR-NR VED SENDING AV FEILMELDING
BRI   * 05  LES KODTS8 MED SEKVENSNR
BRI   * 06  SAMME CMR, GODSNR+POSISJON --> SJEKK AWR FINNES.
BRI   *     JA  --> LAGE NY FORTOLLING MED NY AWR.
BRI   *     NEI --> BRUK DET OPPDRAGET SOM IKKE HAR AWR
BRI   * 07  INITIER KOLLI PÅ LINJE
BRI   * 08  <DateAndTime> med "MessageDate" for å vise dato til TVINN
BRI   * 09  HENT KUNDENR VIA ORGANISASJONSNR
BRI   * 10  HENT AVDELING KUN FRA CustomsBroker
BRI   *     HENT EKSPEDISJONSSTED FRA CustomsDepartment
BRI   * 11  HENT KUNDENR VIA ORGANISASJONSNR HVIS AN-KUNDENR IKKE
BRI   *     FINNES I SYSPED.
BRI   * 12  DOKUMENT BLE IKKE KONVERTERT NÅR ANTAL AVGIFTER ER FÆRRE
BRI   *     ENN ANTALL DOKUMENTER
BRI   * 13  TOLLSATS > 999,99 --> BEHANDLE SOM SÆRAVGIFT
BRI   * 14  BEARBEIDINGSKOSTNAD
BRI   * 15  TØM SÆRAVGIFT
BRI   * 16  HENT RETTELSE PÅ ENDRING 10
BRI   * 17  OMREGN FAKTURASUM OG CIF-VERDI PÅ ET SENERE TIDSPUNKT
BRI   * 18  FAKLE FLERE TOLLBEREGNINGSMÅTER I TOLLTAIFF
BRI   * 19  IKKE BLANKE SIBELR, SIVALR
BRI   * 20  RABATT PÅ FAKTURASUM
BRI   * 21  OPPDATER LEVERINGSSTED
BRI   * 22  T&T OPPDATERING
BRI   * 23  UPCASE FOR SIGNATUR
BRI   * 24  Andrekostnad med P/M fra An skal overses (Kari-Axia)
BRI   * 25  Oppdater kunde hvis kundenr ikke finnes
BRI   * 26  Opphev endring 25
BRI   * 27  Flere linjer for beskrivelse
BRI   * 28  TEST AKTKOD VED CHAIN MOT CUNDL01
BRI   * 29  SEND MELDING VED FOR MANGE AVGIFTER
BRI   * 30  BEHOLD GAMMEL DATO
BRI   * 31  <DocumentReference> med MRK skal inn rubr. 31 på linje
BRI   * 32  SVVT er utvidet fra 15A til 30A i versjon 11
BRI   * 33  Oppdater inaktiv AN-kunde i SYSPED ved kunde ikke finnes
BRI   * 34  TILLEGGSLINJER MED SAMME POST
BRI   * 48  Brexit
BRI   * XX YBC PTF12 4 SIFFER PROSEDYRE OG 2 SIFFER TRANSAKSJONSTYPE
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12053 * 901 YBC PTF12 FLERE FELTER ER UTVIDET.
********************************************************************
      *                                                        **
      *** PROGRAM SKAL KONVERTER XML-FIL TIL SAD-IMPORT       ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01 02 04 07 09-11 13-24          ***
      *** LEDIGE INDIKATORER 27-29 31 32 34-39 41-88 95-97    ***
      ***********************************************************
      *
     FXMLRCVF   IF   E           K DISK
     FXMLRCVF01 IF   E           K DISK    RENAME(XMLRCVFR:XMLRCVFR01)
     FXMLRCVF02 IF   E           K DISK    RENAME(XMLRCVFR:XMLRCVFR02)
     FXMLRCVF03 IF   E           K DISK    RENAME(XMLRCVFR:XMLRCVFR03)
     FXMLRCLF   IF   E           K DISK
     FXMLRCAF   IF   E           K DISK
     FXMLSADH   UF A E           K DISK
     FSADH      UF A E           K DISK
     FSADV      UF A E           K DISK
     FSADF      UF A E           K DISK
     FSTANDI    IF   E           K DISK
     FEDIM      O  A E             DISK
     FEDIM2     IF   E           K DISK    PREFIX(M2_)
     F                                     RENAME(EDIMR:EDIMR2)
     FEDIM4     IF   E           K DISK    PREFIX(M4_)
     F                                     RENAME(EDIMR:EDIMR4)
     FEDIC      UF   E             DISK
     FTVIND     UF A E           K DISK
N22  FTRACKF    O  A E             DISK
     FHEADF     UF A E           K DISK
     FHEAD18    IF   E           K DISK    RENAME(HEADFR:HEADFR18)
BI   FDISP      UF A E           K DISK
     FFRISOL01  IF A E           K DISK
     FFRISOK    UF   E           K DISK    RENAME(FRISOKR:FRISOKR0)
     FTELL      UF   E           K DISK
     FFIRM      IF   E           K DISK
S25  F*CUNDL01   IF   E           K DISK
N25  FCUNDL01   IF A E           K DISK
N25  FKUNDL01   O  A E             DISK    RENAME(KUNDR:KUNDRIBM)
N25  F                                     PREFIX(IBM_)
N09  FCUNDLFO   IF   E           K DISK    RENAME(KUNDR:KUNDRFO)
N09  F                                     PREFIX(FO_)
     FKODTA     IF   E           K DISK
     FKODTLB    IF   E           K DISK
     FKODTSI    IF   E           K DISK
     FKODTSD    IF   E           K DISK
     FKODTS2    IF   E           K DISK
     FKODTS8    IF   E           K DISK
     FKODTVAL2  IF   E           K DISK
     FTARI      IF   E           K DISK
      *
N23  D UC              C                   CONST('ABCDEFGHIJKLMNOPQRST-
N23  D                                     UVWXYZÆØÅ')
N23  D LC              C                   CONST('abcdefghijklmnopqrst-
N23  D                                     uvwxyzæøå')
S34  D*AVG1            S              2    DIM(7)
S34  D*AVG2            S              3    DIM(7)
S34  D*AVG3            S             11  2 DIM(7)
S34  D*AVG4            S              7  2 DIM(7)
S34  D*AVG5            S             11  2 DIM(7)
S34  D*CNT1            S             17    DIM(7)
S34  D*DOK1            S              3    DIM(7)
S34  D*DOK2            S             17    DIM(7)
     D REF1            S              3    DIM(10)
     D REF2            S             35    DIM(10)
N34  D                 DS
N34  D  SVAKD1                 1      2
N34  D  SVAKD2                 3      4
N34  D  SVAKD3                 5      6
N34  D  SVAKD4                 7      8
N34  D  SVAKD5                 9     10
N34  D  SVAKD6                11     12
N34  D  SVAKD7                13     14
N34  D  SVAKD8                15     16
N34  D  AVG1                   1     16    DIM(8)
N34  D                 DS
N34  D  SVASV1                 1      3
N34  D  SVASV2                 4      6
N34  D  SVASV3                 7      9
N34  D  SVASV4                10     12
N34  D  SVASV5                13     15
N34  D  SVASV6                16     18
N34  D  SVASV7                19     21
N34  D  SVASV8                22     24
N34  D  AVG2                   1     24    DIM(8)
N34  D                 DS
N34  D  SVASA1                 1      7  2
N34  D  SVASA2                 8     14  2
N34  D  SVASA3                15     21  2
N34  D  SVASA4                22     28  2
N34  D  SVASA5                29     35  2
N34  D  SVASA6                36     42  2
N34  D  SVASA7                43     49  2
N34  D  SVASA8                50     56  2
N34  D  AVG4                   1     56  2 DIM(8)
N34  D                 DS
E901 D  SVAGR1                 1     13  2
E901 D  SVAGR2                14     26  2
E901 D  SVAGR3                27     39  2
E901 D  SVAGR4                40     52  2
E901 D  SVAGR5                53     65  2
E901 D  SVAGR6                66     78  2
E901 D  SVAGR7                79     91  2
E901 D  SVAGR8                92    104  2
E901 D  AVG3                   1    104  2 DIM(8)
N34  D                 DS
E901 D  SVABL1                 1     13  2
E901 D  SVABL2                14     26  2
E901 D  SVABL3                27     39  2
E901 D  SVABL4                40     52  2
E901 D  SVABL5                53     65  2
E901 D  SVABL6                66     78  2
E901 D  SVABL7                79     91  2
E901 D  SVABL8                92    104  2
E901 D  AVG5                   1    104  2 DIM(8)
N34  D                 DS
N34  D  SVFT01                 1     28
N34  D  SVFT02                29     56
N34  D  SVFT03                57     84
N34  D  SVFT04                85    112
N34  D  SVFT05               113    140
N34  D  SVFT06               141    168
N34  D  SVFT07               169    196
N34  D  CNT1                   1    224    DIM(8)
N34  D                 DS
N34  D  SVTOP1                 1     17
N34  D  SVTOP2                18     34
N34  D  SVTOP3                35     51
N34  D  SVTOP4                52     68
N34  D  SVTOP5                69     85
N34  D  SVTOP6                86    102
N34  D  SVTOP7               103    119
N34  D  SVTOP8               120    136
N34  D  SVTOP9               137    153
N34  D  SVTOP10              154    170
N34  D  DOK2                   1    187    DIM(11)
N34  D                 DS
N34  D  SVCRE1                 1      3
N34  D  SVCRE2                 4      6
N34  D  SVCRE3                 7      9
N34  D  SVCRE4                10     12
N34  D  SVCRE5                13     15
N34  D  SVCRE6                16     18
N34  D  SVCRE7                19     21
N34  D  SVCRE8                22     24
N34  D  SVCRE9                25     27
N34  D  SVCRE10               28     30
N34  D  DOK1                   1     33    DIM(11)
N27  D                 DS
S32  D* VT1                    1    105    DIM(7)
S32  D* VT1ALL                 1    105
N32  D  VT1                    1    210    DIM(7)
N32  D  VT1ALL                 1    210
     D                 DS
     D  XTXT                   1     15
     D  XT                     1     15    DIM(15)
     D                 DS
     D  XTAL                   1     15  3
     D  XTALH                  1     12  0
     D  XTALD1                13     13
     D  XTALD2                14     14
     D  XTALD3                15     15
     D                 DS
     D  XAN08                  1      8
     D  XAN081                 1      7
     D  XAN082                 8      8
     D                 DS
     D  SIKTC                  1      1
     D  SIKTA                  2      6  0
     D  SIKTB                  7      8  0
     D  SIKT8                  1      8
     D  SIKT7                  2      8  0
     D                 DS
     D  XSIFID                 1     10
     D  XSIFIDÅ                1      4
     D  XSIFIDM                6      7
     D  XSIFIDD                9     10
     D                 DS
     D  SIFID                  1      8  0
     D  SIFIDÅ                 1      4  0
     D  SIFIDM                 5      6  0
     D  SIFIDD                 7      8  0
     D                 DS
     D  SFDT                   1      8  0
     D  SFDTÅ                  1      4  0
     D  SFDTM                  5      6  0
     D  SFDTD                  7      8  0
     D                 DS
     D  SIAVD                  1      4  0
     D  SVAVD                  1      4  0
     D  HEAVD                  1      4  0
BI   D  DIAVD                  1      4  0
     D  FSAVD                  1      4  0
     D  SITDN                  5     11  0
     D  SVTDN                  5     11  0
     D  HEOPD                  5     11  0
     D  FSOPD                  5     11  0
BI   D  DIOPD                  5     11  0
     D  SISG                  12     14
     D  HESG                  12     14
BI   D  DISG                  12     14
     D  X14S                   1     14
     D                 DS
     D  SIUR                   1      1
     D  HEUR                   1      1
     D                 DS
     D  SIDT                   1      8  0
     D  HEDTR                  1      8  0
     D  HEDTOP                 1      8  0
     D  FSDTOP                 1      8  0
     D                 DS
     D  SIKNS                  1      8  0
     D  HEKNS                  1      8  0
     D                 DS
     D  SINAS                  1     30
     D  HENAS                  1     30
     D                 DS
     D  SIADS1                 1     30
     D  HEADS1                 1     30
     D                 DS
     D  SIADS2                 1     30
     D  HEADS2                 1     30
     D                 DS
     D  SIADS3                 1     30
     D  HEADS3                 1     30
     D                 DS
     D  SIKNK                  1      8  0
     D  HEKNK                  1      8  0
     D                 DS
     D  SINAK                  1     30
     D  HENAK                  1     30
     D                 DS
     D  SIADK1                 1     30
     D  HEADK1                 1     30
     D                 DS
     D  SIADK2                 1     30
     D  HEADK2                 1     30
     D                 DS
     D  SIADK3                 1     30
     D  HEADK3                 1     30
     D                 DS
     D  SILKA                  1      2
     D  HELKA                  1      2
     D                 DS
     D  SILV                   1      3
     D  HEFR                   1      3
     D                 DS
     D  SINTK                  1      7  0
     D  HENT                   1      7  0
     D                 DS
     D  SIVKB                  1      9  0
     D  HEVKT                  1      9  0
     D                 DS
     D  SI27                   1     27
     D  SIBELC                 1     11  2
     D  SIRAB                 12     15  2
     D                 DS
     D  KLBXXX                 1     35
     D  KLBHAD                 1      1
     D                 DS
     D  SYRG                   1     14
     D  SYFORE                 1      9
     D                 DS
     D  X0068Æ                 1      9  0
     D  M0068A                10     17  0
     D  M0068B                18     23  0
     D  M0068C                24     25  0
     D  X0068Å                 1     25
     D                 DS
     D  KS8FTX                 1     52
     D  KS8MIL                52     52
     D  KS8ØRE                51     51
N22  D                SDS
N22  D  ZUSER                254    263
      *
     C                   EXSR      INIT
      *
     C                   EXSR      SRXML1
      *
     C                   EVAL      *INLR = *ON
     C                   RETURN
      *
      ***********************************************
     C     SRXML1        BEGSR
      ***********************************************
      *
      * HENT MELDINGS REFERANSE
     C                   Z-ADD     1             X001_XRLEV1
     C     STSRXML1      TAG
     C                   ADD       1             X001_XRLEV1
     C                   Z-ADD     1             X001_XRLEV2
     C                   Z-ADD     1             X001_XRLEV3
     C                   Z-ADD     0             X001_XRLEV4
     C                   Z-ADD     0             X001_XRLEV5
     C                   Z-ADD     0             X001_XRLEV6
     C                   Z-ADD     0             X001_XRLEV7
     C                   Z-ADD     0             X001_XRLEV8
     C                   Z-ADD     0             X001_XRLEV9
     C     XMLKEY01      CHAIN     XMLRCAF                            33
     C     *IN33         CABEQ     *ON           SLSRXML1
     C                   DOW       *IN33 = *OFF
     C                   IF        XRATN = 'consignmentId'
     C                   EVAL      FSSOK  = XRATV
     C                   MOVEL     XRATV         XORDREF          35
     C                   EXSR      SRXML2
     C                   GOTO      STSRXML1
     C                   END
     C     XMLKEY01      READE     XMLRCAF                                33
     C                   ENDDO
      *
     C     SLSRXML1      ENDSR
      *
      ***********************************************
     C     SRXML2        BEGSR
      ***********************************************
      *
     C                   EXSR      SRFINNAVD
      *
     C                   EXSR      SRFINNGN
      *
     C                   EXSR      SRHENTCN
      *
     C                   MOVE      'N'           XFLERVAL          1
     C                   MOVE      *BLANKS       XGMLVAL           3
     C                   Z-ADD     0             SIVKB
     C                   Z-ADD     0             XSIVKB
     C                   Z-ADD     0             XSINTK
N02  C                   EVAL      FS0_FSSOK = *BLANKS
     C                   EVAL      X002_XRLEV1 = XRLEV1
     C                   EVAL      X002_XRLEV2 = XRLEV2
     C                   EVAL      X002_XRLEV3 = 1
     C                   EVAL      X002_XRLEV4 = 0
      *
     C     XMLKEY02      CHAIN     XMLRCVF                            33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
      * HENT INFOR. FRA <Consignment>
     C                   WHEN      XRNV = 'Consignment'                          2<-B
     C                   EXSR      SRXML311
      * HENT INFOR. FRA <CustomsClearance>
     C                   WHEN      XRNV = 'CustomsClearance'                     2<-B
     C                   EXSR      SRXML301
     C     XSLUTT        CABEQ     'J'           SLXML2
      * HENT INFOR. FRA <CommercialInvoice>
     C                   WHEN      XRNV = 'CommercialInvoice'                    2<-B
     C                   EXSR      SRXML302
      * HENT INFOR. FRA <ConsignmentGoodsItemSet>
     C                   WHEN      XRNV = 'ConsignmentGoodsItemSet'              2
     C                   EXSR      SRXML303
      * HENT INFOR. FRA <Party>
     C                   WHEN      XRNV = 'Party'                                2
     C                   EXSR      SRXML304
      * HENT INFOR. FRA <TransportLeg>
     C                   WHEN      XRNV = 'TransportLeg'                         2
     C                   EXSR      SRXML305
      * HENT INFOR. FRA <TermsOfDelivery>
     C                   WHEN      XRNV = 'TermsOfDelivery'                      2
     C                   EXSR      SRXML306
N08   * HENT DATEO FRA <DateAndTime>
N08  C                   WHEN      XRNV = 'DateAndTimes'                         2
N08  C                   EXSR      SRXML307
     C                   EXSR      SROPDHEA
     C                   EXSR      SNDTVINN
     C                   LEAVE
      * TREFF <PartyStructure> ER DET SLUTT
     C                   WHEN      XRNV = 'PartyStructure'                       2
     C                   LEAVE
      * HENT CONTAINER INFO. FRA <Equipment> <--- GJORT PÅ EGEN RUTINER
     C                   WHEN      XRNV = 'Equipment'                            2
     C                   ENDSL                                                   2<-E
     C                   ADD       1             X002_XRLEV3
     C     XMLKEY02      CHAIN     XMLRCVF                            33
     C                   ENDDO                                                  1<-E
      *
     C     SLXML2        ENDSR
      *
      ***********************************************
     C     SRXML311      BEGSR
      ***********************************************
      * TOTAL VEKT OG KOLLI
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = 0
     C                   EVAL      X003_XRLEV5 = 0
     C                   EVAL      XM0068 = FSSOK
     C                   EVAL      XN1    = 0
      *
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'TotalGrossWeight'                     2
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          XSIVKB
     C                   WHEN      XRNV = 'NumberOfPackages'                     2
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          XSINTK
     C                   WHEN      XRNV = 'Reference'                            2
     C                   EXSR      SRXML311A
     C                   ENDSL                                                   2<-E
      *
     C                   EVAL      X003_XRLEV4 = X003_XRLEV4 + 1
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML311A     BEGSR
      ***********************************************
      * <Reference>
      *
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = XRLEV4
     C                   MOVE      *BLANKS       FSKODE
     C                   MOVE      *BLANKS       FSSOK
      *
     C     XMLKEY031     CHAIN     XMLRCVF02                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'ReferenceNo'                          2
     C                   EVAL      FSSOK  = XRVERD
     C                   WHEN      XRNV = 'ReferenceType'                        2
     C                   EVAL      FSKODE = XRVERD
     C                   ENDSL                                                   2<-E
      *
     C     XMLKEY031     READE     XMLRCVF02                              33
     C                   ENDDO                                                  1<-E
      *
     C                   IF        ((FSSOK <> *BLANKS) AND (FSKODE <> *BLANKS))
     C                   ADD       1             XN1
     C                   EVAL      REF1(XN1) = FSKODE
     C                   EVAL      REF2(XN1) = FSSOK
     C                   END
      *
S02  C*                  IF        FSKODE = 'AWR'
N02  C                   SELECT
N02  C                   WHEN      FSKODE = 'CMR'
N02  C                   EVAL      FS0_FSSOK = FSSOK
N02  C                   WHEN      FSKODE = 'AWR'
     C                   EVAL      XM0068 = FSSOK
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML301      BEGSR
      ***********************************************
     C                   MOVE      'N'           XSLUTT            1
     C                   MOVE      'N'           XINNSTIKK         1
     C                   MOVE      ' '           XSIMI             1
     C                   Z-ADD     0             XSITRT            1 0
      * SJEKK OM INNSTIKK
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = 0
     C                   EVAL      X003_XRLEV5 = 0
     C     XMLKEY03      CHAIN     XMLRCAF                            33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRATN = 'Status'                              2
     C                   WHEN      XRATN = 'lineMerge'                           2
     C                   IF        XRATV = 'No'                                   3<-B
     C                   Z-ADD     1             XSITRT            1 0
     C                   END                                                      3<-E
     C                   WHEN      XRATN = 'function'                            2
     C                   IF        XRATV = 'Temporary'                            3<-B
     C                   MOVE      'J'           XINNSTIKK
     C                   ELSE                                                     3
     C                   MOVE      'N'           XINNSTIKK
     C                   END                                                      3<-E
     C*                  LEAVE
     C                   ENDSL                                                   2<-E
     C     XMLKEY03      READE     XMLRCAF                                33
     C                   ENDDO                                                  1<-E
      *
     C                   EVAL      FSKODE = '*CR'
     C                   EVAL      FSSOK  = XM0068
     C     FRISOL01K     CHAIN     FRISOL01                           33
      *
     C   33              IF        ((HEGN <> *BLANKS) AND (HEPOS1 <> *BLANKS))
N06   *___________________________________________________________________________________
N06   * VED KUNDES REFERANSE (*CR OG AWR) IKKE FINNES SKAL PROGRAM GJØRE FØLGENDE:
N06   *    FINNE OPPDRAG MED SAMME GODSNR+POSISJON OG CMR-NR (FRISOKK INNEHOLDER CMR-NR)
N06   *    JA  --> SJEKK OM DEN ER FORTOLLET.
N06   *               JA  --> LETTE NESTE OPPDRAG
N06   *               NEI --> FORTOLLE DETTE OPPDRAGET                 <-- CASE 1
N06   *    NEI --> LAGE NY FORTOLLING                                  <-- CASE 2
N06   *-----------------------------------------------------------------------------------
N06   *
     C     HEAD18K       CHAIN     HEAD18                             33
N02  C                   EVAL      FS0_FSSOK1  = FSSOK
S06  C*                  EVAL      XGMLAWR = FSSOK
N02  C                   DOW       *IN33 = *OFF
N02  C     FRISOKK       CHAIN     FRISOK                             33
N02  C                   IF        *IN33 = *OFF
S06  C*                  DOW       *IN33 = *OFF AND FSKODE <> 'AWR'
S06  C*    FRISOKK2      READPE    FRISOK                                 33
S06  C*                  ENDDO
S06  C* N33              EVAL      XGMLAWR = FSSOK
S06  C*                  EVAL      *IN33 = *OFF
S06  C*                  LEAVE
N02   * SAMME GODSNR+POSISJON OG CMR-NR FINNES
N06  C     SADHK3        CHAIN(N)  SADH                               33
N06   * *IN33 PÅ --> OPPDRAG IKKE FORTOLLET --> BRUK DETTE OPPDRAGET
N06  C                   IF        *IN33
N06  C                   EVAL      FSAVD  = HEAVD
N06  C                   EVAL      FSOPD  = HEOPD
N06  C                   EVAL      *IN33 = *OFF
N06  C                   LEAVE
N06  C                   END
N02  C                   END
N02  C     HEAD18K       READE     HEAD18                                 33
N02  C                   ENDDO
N06   *
N06   * *IN33 AV --> UFORTOLLET OPPDRAG FINNES --> FORTOLLE DETTE OPPDRAGET       <-- CASE 1
N06   * *IN33 PÅ --> UFORTOLLET OPPDRAG IKKE FINNES --> LAGE NY FORTOLLING        <-- CASE 2
N02  C                   EVAL      FSKODE = '*CR'
N02  C                   EVAL      FSSOK  = FS0_FSSOK1
     C                   IF        *IN33 = *OFF
     C                   EVAL      FSAVD  = HEAVD
     C                   EVAL      FSOPD  = HEOPD
     C                   EVAL      FSDTOP = HEDTOP
     C                   WRITE     FRISOKR
     C                   END
     C                   END
      *
     C                   IF        *IN33                                        1<-B
N22  C                   EVAL      TTACTI = 'STR'
N22  C                   EVAL      TTTEXT = 'Order entrered by XML-'
N22  C                             + 'CustomsClearance IMPORT'
      * OPPDRAG FINNES IKKE FRA FØR
      * HENT AVDELINGSINFORAMSJON
     C     XXAVD         CHAIN     STANDI                             33
     C                   IF        *IN33 = *OFF                                  2<-B
     C     KODTAK        CHAIN     KODTA                              33
     C     CUNDL01K      CHAIN     CUNDL01                            33
     C                   MOVE      *OFF          *IN33
     C                   END                                                     2<-E
     C                   IF        WDT08 >= 20110217                             2<-B
     C                   Z-ADD     9501          SIAVD
     C                   ELSE                                                    2
     C                   Z-ADD     9910          SIAVD
     C                   END                                                     2<-E
     C                   IF        *IN33                                         2<-B
     C                   MOVE      SIAVD         XXAVD
      * AVDELING FRA XML-FIL FINNES IKKE. BRUKE INFORMASJON FRA AVD. 9501
     C     SIAVD         CHAIN     STANDI                             33
     C     KODTAK        CHAIN     KODTA                              33
     C     CUNDL01K      CHAIN     CUNDL01                            33
     C                   END                                                     2<-E
      * OPPDRAGSNR ALLTID TREKKES FRA 9501
     C     SIAVD         CHAIN     TELL                               33
     C                   MOVE      TEOPDN        SITDN
     C                   ADD       1             TEOPDN
     C                   UPDATE    TELLR
     C                   MOVE      WDT           HEDTR
     C                   MOVE      WDT           XDTVKU
     C                   WRITE     FRISOKR
     C*                  EVAL      FSKODE = 'CMR'
     C*                  WRITE     FRISOKR
      *
     C                   ELSE                                                   1
N22  C                   EVAL      TTACTI = 'CHG'
N22  C                   EVAL      TTTEXT = 'Order changed by XML-'
N22  C                             + 'CustomsClearance IMPORT'
      *
      * OPPDRAG FINNES FRA FØR.
     C                   MOVE      FSAVD         XAVD
     C                   MOVE      FSOPD         XTDN
     C     SADHK         CHAIN     SADH                               33
     C  N33              IF        ((SIST = ' ') OR (SIST = 'M'))                2<-B
     C                   DELETE    SADHR
     C     SADHK         CHAIN     XMLSADH                            33
     C  N33              DELETE    XMLSADHR
     C                   MOVE      SIMI          XSIMI
N30  C                   MOVE      SIDT          XSIDT             8 0
     C                   ELSE                                                    2
     C                   IF        SIST = 'P'                                     3<-B
     C     EDIM4K        SETLL     EDIM4
     C     EDIM4K2       READPE    EDIM4                                  33
     C                   DOW       *IN33 = *OFF                                    4<-B
     C                   IF        M4_M0065 = 'CUSDEC' OR M4_M0065 = 'CUSRES'       5<-B
     C                   IF        M4_MST <> 'D' AND M4_M1001 = '929'                6<-B
     C                   IF        M4_M1N07 = 'DUA' OR M4_M1N07 = 'DTK'              7<-B
     C                   LEAVE
     C                   END                                                         7<-E
     C                   END                                                        6<-E
     C                   END                                                       5<-E
     C     EDIM4K2       READPE    EDIM4                                  33
     C                   ENDDO                                                    4<-E
      * STATUS P + INGEN UA/TK --> LOV Å OPPDATERE PÅ NYTT
     C                   IF        *IN33                                          4<-B
     C                   DELETE    SADHR
     C     SADHK         CHAIN     XMLSADH                            33
     C  N33              DELETE    XMLSADHR
     C                   MOVE      SIMI          XSIMI
N30  C                   MOVE      SIDT          XSIDT
     C                   GOTO      STXML301
     C                   END                                                      4<-E
     C                   END                                                     3<-E
      * KAN IKKE TA NY VERSJON
     C                   UPDATE    SADHR
     C                   EVAL      XMSGTXT = 'Fortolling ('
N02  C                             + %TRIM(XM0068) + '/'
S04  C*                            + %TRIM(FSSOK) + '/'
S06  C*                            + %TRIM(XGMLAWR) + '/'
     C                             + %TRIM(%EDITC(FSAVD:'Z')) + '/'
     C                             + %TRIM(%EDITC(FSOPD:'Z')) + ')'
     C                             + 'kan ikke oppdateres pga. status='
     C                             + %TRIM(SIST)
     C*                            + %TRIM(SIST) + '.'
     C                   SELECT
     C                   WHEN      SIST = 'A'
     C                   EVAL      XMSGTXT = %TRIM(XMSGTXT)
     C                             + ' (ligger i en sending i påvente av å bli'
     C                             + ' sendt).'
     C                   WHEN      SIST = 'C'
     C                   EVAL      XMSGTXT = %TRIM(XMSGTXT)
     C                             + ' (er sendt til TVINN).'
     C                   WHEN      SIST = 'E'
     C                   EVAL      XMSGTXT = %TRIM(XMSGTXT)
     C                             + ' (blir endret av en saksbehandler).'
     C                   WHEN      SIST = 'D'
     C                   EVAL      XMSGTXT = %TRIM(XMSGTXT)
     C                             + ' (melding om dokumentkontroll).'
     C                   WHEN      SIST = 'K'
     C                   EVAL      XMSGTXT = %TRIM(XMSGTXT)
     C                             + ' (klar for utskrift men er ikke skrevet'
     C                             + ' ut).'
     C                   WHEN      SIST = 'P'
     C                   EVAL      XMSGTXT = %TRIM(XMSGTXT)
     C                             + ' (deklarasjonen er skrevet ut).'
     C                   WHEN      SIST = 'Q'
     C                   EVAL      XMSGTXT = %TRIM(XMSGTXT)
     C                             + ' (ligger i utg. postkasse, men er ikke'
     C                             + ' sendt).'
     C                   WHEN      SIST = 'T'
     C                   EVAL      XMSGTXT = %TRIM(XMSGTXT)
     C                             + ' (er lagt til manuell ekspedering).'
     C                   WHEN      SIST = 'V'
     C                   EVAL      XMSGTXT = %TRIM(XMSGTXT)
     C                             + ' (melding om varekontroll).'
     C                   WHEN      SIST = 'U'
     C                   EVAL      XMSGTXT = %TRIM(XMSGTXT)
     C                             + ' (utleveringsattest er mottatt).'
     C                   WHEN      SIST = 'Å'
     C                   EVAL      XMSGTXT = %TRIM(XMSGTXT)
     C                             + ' (klar for utskrift men er ikke skrevet'
     C                             + ' ut).'
     C                   ENDSL
     C                   EXSR      SRERROR
     C                   MOVE      'J'           XSLUTT
     C                   GOTO      SLXML301
     C                   END
      *
      * FINN DATO FOR VALUTAKURS
     C     STXML301      TAG
     C                   EXSR      FINDTVK
      *
     C     SADHK         CHAIN     HEADFR                             33
     C  N33              DELETE    HEADFR
     C     SADHK         CHAIN     DISP                               33
     C  N33              DELETE    DISPR
     C     SADHK         SETLL     SADV
     C     SADHK         READE     SADV                                   33
     C                   DOW       *IN33 = *OFF
     C                   DELETE    SADVR
     C     SADHK         READE     SADV                                   33
     C                   ENDDO
     C     SADHK         SETLL     SADF
     C     SADHK         READE     SADF                                   33
     C                   DOW       *IN33 = *OFF
     C                   DELETE    SADFR
     C     SADHK         READE     SADF                                   33
     C                   ENDDO
     C     SADHK         SETLL     FRISOK
     C     SADHK         READE     FRISOK                                 33
     C                   DOW       *IN33 = *OFF
     C*                  IF        FSKODE = 'CNT'
     C                   IF        FSKODE <> '*CR'
     C                   DELETE    FRISOKR0
     C                   ELSE
     C                   UPDATE    FRISOKR0
     C                   END
     C     SADHK         READE     FRISOK                                 33
     C                   ENDDO
      *
     C                   CLEAR                   SADHR
     C                   CLEAR                   SADVR
     C                   CLEAR                   HEADFR
     C                   CLEAR                   DISPR
      * HENT AVDELINGSDEFAULT VERDIER FRA OPPGITT AVDELING I XML-FIL
     C     XXAVD         CHAIN     STANDI                             33
     C                   IF        *IN33
      * HVIS IKKE, HENT AVDELINGSDEFAULT VERDIER FRA TIDLIGERE AVDELING
     C                   MOVE      XAVD          XXAVD
     C     XXAVD         CHAIN     STANDI                             33
     C                   END
     C     KODTAK        CHAIN     KODTA                              33
     C     CUNDL01K      CHAIN     CUNDL01                            33
     C                   MOVE      XAVD          FSAVD
     C                   MOVE      XTDN          FSOPD
     C*                  MOVE      WDT           HEDTR
     C                   MOVE      XDTVKU        HEDTR
      *
     C                   END
      *
      * OPPDATER REFERANSER PÅ FRISOK
     C     1             DO        10            XN1
     C                   IF        REF1(XN1) = *BLANKS
     C                   LEAVE
     C                   END
     C                   EVAL      FSKODE = REF1(XN1)
     C                   EVAL      FSSOK  = REF2(XN1)
     C                   WRITE     FRISOKR
     C                   ENDDO
      *
      * OPPDATER CONTAINERNR PÅ FRISOK
     C                   EVAL      FSKODE = 'CNT'
     C     1             DO        7             XN1
     C                   IF        CNT1(XN1) <> *BLANKS
     C                   EVAL      FSSOK  = CNT1(XN1)
     C                   WRITE     FRISOKR
     C                   END
     C                   ENDDO
      *
     C                   EVAL      SIKDDK = ' '
N20  C                   EVAL      SIBELC = *ZEROS
N20  C                   EVAL      SIRAB  = *ZEROS
      *
      * INFOR. FRA <CustomsClearance>
      *
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = 1
     C                   EVAL      X003_XRLEV5 = 0
      *
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'Declaration'                          2
     C                   EXSR      SRXML301A
     C                   WHEN      XRNV = 'TransactionType'                      2
SXX  C*                  MOVEL     XRVERD        SITST
NXX  C                   IF        %SUBST(XRVERD:2:1) = ' '
NXX  C                   MOVEL     XRVERD        XAN01             1
NXX  C                   MOVE      XAN01         SITST
NXX  C                   ELSE
NXX  C                   MOVEL     XRVERD        XAN02             2
NXX  C                   MOVE      XAN02         SITST
NXX  C                   END
     C                   WHEN      XRNV = 'Location'                             2
     C                   EXSR      SRXML301B
     C                   WHEN      XRNV = 'DutyCreditAccount'                    2
     C                   MOVEL     XRVERD        XAN08
     C                   IF        XAN082 = *BLANKS
     C                   EVAL      SIKTC  = *BLANKS
     C*                  MOVE      XAN081        SIKT7
     C                   MOVEL     XAN081        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          SIKT7
     C                   ELSE
     C                   MOVE      XAN08         SIKT8
     C                   END
     C***                EVAL      SIKDDK = 'M'
     C                   WHEN      XRNV = 'DutyPaymentIndicator'                 2
     C                   SELECT                                                   3<-B
     C                   WHEN      XRVERD = 'Cash'                                3
     C                   EVAL      SIKDDK = 'K'
     C                   WHEN      XRVERD = 'Credit'                              3
     C                   EVAL      SIKDDK = 'D'
     C                   WHEN      XRVERD = 'Account'                             3
     C                   EVAL      SIKDDK = ' '
     C                   ENDSL                                                    3<-E
      *
     C     XMLKEY032     CHAIN     XMLRCAF                            33
     C  N33              IF        XRATN = 'dutyPayer'                            3<-B
     C                   SELECT                                                    4<-B
     C                   WHEN      XRATV = 'Buyer'                                 4
     C                   EVAL      SISKI = 'K'
     C                   WHEN      XRATV = 'Seller'                                4
     C                   EVAL      SISKI = 'S'
     C                   OTHER
     C                   EVAL      SISKI = 'I'
     C                   ENDSL                                                     4<-E
     C                   END                                                      3<-E
      *
     C                   WHEN      XRNV = 'FreightChargeAmount'                  2
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          SIBEL1
     C     XMLKEY032     CHAIN     XMLRCAF                            33
     C  N33              IF        XRATN = 'currencyIdentificationCode'           3<-B
     C                   EVAL      SIVAL1 = XRATV
     C                   END                                                      3<-E
     C     KODTVAL2K1    SETGT     KODTVAL2
     C     SIVAL1        READPE    KODTVAL2                               33
     C  N33              MOVE      KVAOMR        XOMR1             3 0
     C  N33              MOVE      KVAKRS        XKRS1             7 3
N14   *
N14  C                   WHEN      XRNV = 'ProcessingCostAmount'                 2
N14  C                   MOVEL     XRVERD        XTXT
N14  C                   EXSR      KNVTAL
N14  C                   Z-ADD     XTAL          SIBELR
N14  C     XMLKEY032     CHAIN     XMLRCAF                            33
N14  C  N33              IF        XRATN = 'currencyIdentificationCode'           3<-B
N14  C                   EVAL      SIVALR = XRATV
N14  C                   END                                                      3<-E
N14  C     KODTVAL2KR    SETGT     KODTVAL2
N14  C     SIVALR        READPE    KODTVAL2                               33
N14  C  N33              MOVE      KVAOMR        XOMRR             3 0
N14  C  N33              MOVE      KVAKRS        XKRSR             7 3
N14   *
     C                   WHEN      XRNV = 'OtherChargesAmount'                   2
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          SIBEL2
     C                   MOVE      SIBEL2        XBEL2            11 2
     C     XMLKEY032     CHAIN     XMLRCAF                            33
     C  N33              IF        XRATN = 'currencyIdentificationCode'           3<-B
     C                   EVAL      SIVAL2 = XRATV
     C                   END                                                      3<-E
     C     KODTVAL2K2    SETGT     KODTVAL2
     C     SIVAL2        READPE    KODTVAL2                               33
     C  N33              MOVE      KVAOMR        XOMR2             3 0
     C  N33              MOVE      KVAKRS        XKRS2             7 3
     C                   WHEN      XRNV = 'OtherChargesStatus'                   2
     C                   MOVEL     XRVERD        SIFTG2
N24  C                   IF        SIFTG2 = 'P' OR SIFTG2 = 'M'                   3<-B
N24  C                   EVAL      SIVAL2 = *BLANKS
N24  C                   EVAL      SIBEL2 = 0
N24  C                   EVAL      SIFTG2 = *BLANKS
N24  C                   END                                                      3<-E
     C                   WHEN      XRNV = 'EntryNumber'                          2
     C                   MOVEL     XRVERD        SIGN
     C                   WHEN      XRNV = 'EntryPositionNumber'                  2
     C                   MOVEL     XRVERD        SIPOS
N20  C                   WHEN      XRNV = 'Invoice'                              2
N20  C                   EXSR      SRXML301C
     C                   ENDSL                                                   2<-E
      *
     C                   EVAL      X003_XRLEV4 = X003_XRLEV4 + 1
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   ENDDO                                                  1<-E
      *
     C     SLXML301      ENDSR
      *
      ***********************************************
     C     SRXML301A     BEGSR
      ***********************************************
      *
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = XRLEV4
      *
     C     XMLKEY031     CHAIN     XMLRCVF02                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'DeclarationType'                      2
     C                   EVAL      SIDTY  = XRVERD
     C                   WHEN      XRNV = 'Procedure'                            2
     C                   MOVEL     XRVERD        SIDP
     C                   ENDSL
     C     XMLKEY031     READE     XMLRCVF02                              33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML301B     BEGSR
      ***********************************************
      *
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = XRLEV4
      *
     C     XMLKEY031     CHAIN     XMLRCVF02                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'Location'                             2
     C                   MOVE      'N'           XKODEMOT          1
     C                   MOVE      ' '           XKODETYPE         1
     C     XMLKEY032     CHAIN     XMLRCAF                            33
      *
     C                   DOW       *IN33 = *OFF                                   3<-B
     C                   SELECT                                                    4<-B
     C                   WHEN      ((XRATN = 'subClass') AND                       4
     C                              (XRATV = 'StorageLocation'))
     C                   MOVE      'L'           XKODETYPE
N10  C                   WHEN      ((XRATN = 'subClass') AND                       4
N10  C                              (XRATV = 'CustomsDepartment'))
N10  C                   MOVE      'E'           XKODETYPE
     C                   WHEN      XRATN = 'locationId'                            4
     C                   SELECT                                                     5<-B
     C                   WHEN      XKODETYPE = 'L'                                  5
     C                   MOVEL     XRATV         SIKDLS
     C     SIKDLS        CHAIN     KODTSD                             33
     C  N33              MOVEL     KSDTXT        SILS
     C                   LEAVE
N10  C                   WHEN      XKODETYPE = 'E'                                  5
N10  C                   IF        %SUBST(XRATV:5:1) <> *BLANKS AND                  6<-B
N10  C                             %SUBST(XRATV:7:1) = *BLANKS
S16  C*                  MOVEL     XRATV         XS3039E
N10  C                   MOVEL     XRATV         XTXT
N10  C                   EXSR      KNVTAL
N10  C                   Z-ADD     XTAL          XS3039E
N10  C                   END                                                         6<-E
N10  C                   LEAVE
     C                   OTHER                                                      5
      * BEVARE KODE
     C*                  EVAL      XKODEMOT = 'J'
     C                   MOVEL     XRATV         XKODETXT         35
     C                   ENDSL                                                      5<-E
     C                   ENDSL                                                     4<-E
     C     XMLKEY032     READE     XMLRCAF                                33
     C                   ENDDO                                                    3<-E
      *
     C                   WHEN      XRNV = 'CountryCode'                          2
     C     XMLKEY032     CHAIN     XMLRCAF                            33
     C  N33              IF        ((XRATN = 'subClass') AND                      3<-B
     C                              (XRATV = 'StartLocation'))
     C                   MOVEL     XRVERD        SILKA
     C                   IF        SIDTY   = *BLANKS                               4<-B
     C     KODTS2K       CHAIN     KODTS2                             33
     C  N33              IF        (((KS2PRE = 'A') OR                              5<-B
     C                               (KS2PRE = 'B')) OR
     C                               (KS2PRE = 'C'))
     C                   MOVE      'EU'          SIDTY
     C                   ELSE                                                       5
     C                   MOVE      'IM'          SIDTY
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   WHEN      XRNV = 'LocationType'                         2
     C                   ENDSL
     C     XMLKEY031     READE     XMLRCVF02                              33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
N20   ***********************************************
N20  C     SRXML301C     BEGSR
N20   ***********************************************
N20   *
N20  C                   EVAL      X003_XRLEV1 = XRLEV1
N20  C                   EVAL      X003_XRLEV2 = XRLEV2
N20  C                   EVAL      X003_XRLEV3 = XRLEV3
N20  C                   EVAL      X003_XRLEV4 = XRLEV4
N20   *
N20  C     XMLKEY031     CHAIN     XMLRCVF02                          33
N20  C                   DOW       *IN33 = *OFF                                 1<-B
N20  C                   SELECT                                                  2<-B
N20  C                   WHEN      XRNV = 'Discount'                             2
N20  C                   MOVEL     XRVERD        XTXT
N20  C                   EXSR      KNVTAL
N20  C                   Z-ADD     XTAL          SIRAB
N20  C                   ENDSL
N20  C     XMLKEY031     READE     XMLRCVF02                              33
N20  C                   ENDDO                                                  1<-E
N20   *
N20  C                   ENDSR
N20   *
      ***********************************************
     C     SRXML302      BEGSR
      ***********************************************
      * INFOR. FRA <CommercialInvoice>
      *
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = 1
     C                   EVAL      X003_XRLEV5 = 0
      *
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'InvoiceNo'                            2
     C*                  EVAL      SIFIF  = XRVERD
     C                   EVAL      XSIFIF  = XRVERD
     C                   WHEN      XRNV = 'InvoiceDate'                          2
     C                   EVAL      XSIFID = XRVERD
     C*                  MOVE      XSIFIDÅ       SIFIDÅ
     C*                  MOVE      XSIFIDM       SIFIDM
     C*                  MOVE      XSIFIDD       SIFIDD
     C                   WHEN      XRNV = 'InvoiceAmount'                        2
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C*                  Z-ADD     XTAL          SIBEL3
     C                   Z-ADD     XTAL          XSIBEL3
     C     XMLKEY032     CHAIN     XMLRCAF                            33
     C  N33              IF        XRATN = 'currencyIdentificationCode'           3<-B
     C*                  EVAL      SIVAL3 = XRATV
     C                   EVAL      XSIVAL3 = XRATV
     C                   IF        (((XFLERVAL = 'N') AND
     C                               (XGMLVAL <> *BLANKS)) AND
     C                               (XGMLVAL <> XSIVAL3))
     C                   EVAL      XFLERVAL = 'J'
     C                   END
     C                   EVAL      XGMLVAL = XSIVAL3
     C     KODTVAL2K3    SETGT     KODTVAL2
     C*    SIVAL3        READPE    KODTVAL2                               33
     C     XSIVAL3       READPE    KODTVAL2                               33
     C  N33              MOVE      KVAOMR        XOMRF             3 0
     C* N33              IF        SIVKU = 0                                       4<-B
     C*                  MOVE      KVAKRS        SIVKU
     C* N33              IF        XSIVKU = 0                                      4<-B
     C                   MOVE      KVAKRS        XSIVKU
     C*                  END                                                       4<-E
     C                   IF        SFVK28 = *BLANKS                                4<-B
     C                   EVAL      SFVK28 = XSIVAL3
     C                   EVAL      SFKR28 = XSIVKU
     C                   EVAL      SFOM28 = XOMRF
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   ENDSL                                                   2<-E
      *
     C                   IF        (((XSIFIF <> *BLANKS) AND                     2<-B
     C                               (XSIFID <> *BLANKS)) AND
     C                               (XSIBEL3 <> 0))
     C                   IF        SIFIF = *BLANKS                                3<-B
     C                   EVAL      SIFIF  = XSIFIF
     C                   MOVE      XSIFIDÅ       SIFIDÅ
     C                   MOVE      XSIFIDM       SIFIDM
     C                   MOVE      XSIFIDD       SIFIDD
     C                   EVAL      SIBEL3  = XSIBEL3
     C                   EVAL      SIVAL3  = XSIVAL3
     C                   EVAL      SIVKU   = XSIVKU
     C                   EVAL      XSIOMR  = XOMRF
     C                   ELSE                                                     3
     C                   IF        SIFID <> 99999999                               4<-B
     C                   EVAL      SFAVD  = SIAVD
     C                   EVAL      SFOPDN = SITDN
     C                   EVAL      SFTXT  = SIFIF
     C                   EVAL      SFDT   = SIFID
     C                   EVAL      SFVK28 = SIVAL3
     C                   EVAL      SFKR28 = SIVKU
     C                   EVAL      SFOM28 = XSIOMR
     C                   EVAL      SFBL28 = SIBEL3
     C                   WRITE     SADFR
     C                   EVAL      SIFID  = 99999999
     C                   EVAL      SIFIF  = 'F15  ER  BENYTTET'
     C                   END                                                       4<-E
     C                   EVAL      SFTXT  = XSIFIF
     C                   MOVE      XSIFIDÅ       SFDTÅ
     C                   MOVE      XSIFIDM       SFDTM
     C                   MOVE      XSIFIDD       SFDTD
     C                   EVAL      SFBL28 = XSIBEL3
     C                   EVAL      SFVK28 = XSIVAL3
     C                   EVAL      SFKR28 = XSIVKU
     C                   EVAL      SFOM28 = XOMRF
     C                   WRITE     SADFR
     C                   EVAL      SIBEL3 = SIBEL3 + XSIBEL3
     C                   END                                                      3<-E
     C                   EVAL      XSIFIF  = *BLANKS
     C                   EVAL      XSIFID  = *BLANKS
     C                   EVAL      XSIBEL3 = 0
     C                   END                                                     2<-E
      *
     C                   EVAL      X003_XRLEV4 = X003_XRLEV4 + 1
     C                   EVAL      X003_XRLEV5 = 0
     C     XMLKEY03      READE     XMLRCVF01                              33
     C                   ENDDO                                                  1<-E
S17   *
S17  C*                  IF        XFLERVAL = 'J'
S17  C*                  EXSR      SRBYTTVAL
S17  C*                  END
S17   *
S17  C*                  EXSR      CIFSR
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML303      BEGSR
      ***********************************************
      * INFOR. FRA <ConsignmentGoodsItemSet>
      *
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = 1
     C                   EVAL      X003_XRLEV5 = 0
     C                   EVAL      SVLI   = 0
      *
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'GoodsItem'                            2
     C                   EXSR      SRXML303A
     C                   WHEN      XRNV = 'CustomsDetails'                       2
     C                   EXSR      SRXML303B
     C                   ENDSL                                                   2<-E
      *
     C                   EVAL      X003_XRLEV4 = X003_XRLEV4 + 1
     C                   EVAL      X003_XRLEV5 = 0
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   ENDDO                                                  1<-E
      *
     C                   EXSR      SROPDLIN
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML303A     BEGSR
      ***********************************************
      *
     C                   EVAL      X003_XRLEV4 = XRLEV4
      *
     C     XMLKEY031     CHAIN     XMLRCVF02                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'GoodsDescription'                     2
     C                   MOVEL     XRVERD        HEVS1
     C                   WHEN      XRNV = 'NumberOfPackages'                     2
     C*                  MOVEL     XRVERD        XTXT
     C*                  EXSR      KNVTAL
     C*                  Z-ADD     XTAL          SINTK
     C                   WHEN      XRNV = 'PackageTypeCode'                      2
     C                   WHEN      XRNV = 'GrossWeight'                          2
     C*                  MOVEL     XRVERD        XTXT
     C*                  EXSR      KNVTAL
     C*                  Z-ADD     XTAL          XSIVKB
     C                   ENDSL                                                   2<-E
      *
     C     XMLKEY031     READE     XMLRCVF02                              33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML303B     BEGSR
      ***********************************************
      *
     C                   EXSR      SROPDLIN
      *
     C                   EVAL      XSVAVD  = SVAVD
     C                   EVAL      XSVTDN  = SVTDN
     C                   EVAL      XSVLI   = SVLI
     C                   CLEAR                   SADVR
     C                   EVAL      SVAVD  = XSVAVD
     C                   EVAL      SVTDN  = XSVTDN
     C                   EVAL      SVLI   = XSVLI
     C                   EVAL      SVVF   = '1'
     C                   EVAL      SVLK   = SILKA
     C                   EVAL      SVPRE  = KS2PRE
     C                   EVAL      SVMFR  = 'F'
      *
     C                   EVAL      SVLI = SVLI + 1
     C                   MOVE      SVLI          SVLN
     C                   MOVE      *BLANKS       AVG1                           AVGIFTKODE
     C                   MOVE      *BLANKS       AVG2                           AVGIFT SEKVENS
     C                   MOVE      *ZEROS        AVG3                           AVGIFTSGRUNNLAG
     C                   MOVE      *ZEROS        AVG4                           AVGIFTSSATS
     C                   MOVE      *ZEROS        AVG5                           AVGIFTSBELØP
     C                   MOVE      *ZEROS        XN1               3 0
     C                   MOVE      *BLANKS       DOK1                           DOKUMENTKODE
     C                   MOVE      *BLANKS       DOK2                           DOKUMENTNR
N27  C                   MOVE      *BLANKS       VT1                            VAREBESKRIVELSE
     C                   MOVE      *ZEROS        XN2               3 0
     C                   EVAL      X003_XRLEV4 = XRLEV4
     C                   EVAL      X003_XRLEV5 = 1
     C                   EVAL      X003_XRLEV6 = 0
      *
     C     XMLKEY032     CHAIN     XMLRCVF02                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'GrossWeight'                          2
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD(H)  XTAL          SVVKTB
     C                   WHEN      XRNV = 'NetWeight'                            2
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD(H)  XTAL          SVVKTN
     C                   WHEN      XRNV = 'PlaceOfOrigin'                        2
     C     XMLKEY032     CHAIN     XMLRCAF                            33
     C                   DOW       *IN33 = *OFF                                   3<-B
     C                   IF        XRATV = 'Country'                               4<-B
     C                   EVAL      SVLK   = XRVERD
     C     KODTS2KV      CHAIN     KODTS2                             33
     C  N33              EVAL      SVPRE  = KS2PRE
     C                   LEAVE
     C                   END                                                       4<-E
     C     XMLKEY032     READE     XMLRCAF                                33
     C                   ENDDO                                                    3<-E
     C                   WHEN      XRNV = 'CustomsArticleNumber'                 2
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          SVVNT
     C                   WHEN      XRNV = 'TradePreference'                      2
     C     XMLKEY032     CHAIN     XMLRCAF                            33
     C  N33              IF        XRATN = 'tradeIndicator'                       3<-B
     C                   SELECT                                                    4<-B
     C                   WHEN      XRATV = 'Reduction'                             4
     C*                  EVAL      SVTN  = 'J'
     C                   MOVEL     XRVERD        SVTN
     C                   WHEN      XRATV = 'Preference'                            4
     C                   MOVEL     XRVERD        SVPRE
     C                   ENDSL                                                     4<-E
     C                   END                                                      3<-E
     C                   WHEN      XRNV = 'TarriffLineAmount'                    2
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          SVBELT
      * OMREGN TIL NOK VED FLERVALUTA
     C                   IF        XFLERVAL = 'J'
     C     XMLKEY032     CHAIN     XMLRCAF                            33
     C                   DOW       *IN33 = *OFF
     C                   IF        XRATN = 'currencyIdentificationCode'
     C                   IF        XRATV <> 'NOK'
     C     SADHK         SETLL     SADF
     C     SADHK         READE(N)  SADF                                   33
     C                   DOW       *IN33 = *OFF
     C                   IF        XRATV = SFVK28
     C                   EVAL(H)   SVBELT = SVBELT * SFKR28 / SFOM28
     C                   LEAVE
     C                   END
     C     SADHK         READE(N)  SADF                                   33
     C                   ENDDO
     C                   END
     C                   LEAVE
     C                   END
     C     XMLKEY032     READE     XMLRCAF                                33
     C                   ENDDO
     C                   END
      *
     C                   WHEN      XRNV = 'CustomsDuty'                          2
      * MOMSKODE F,1,2
     C     XMLKEY032     CHAIN     XMLRCAF                            33
     C                   DOW       *IN33 = *OFF                                   3<-B
     C                   IF        XRATN = 'amountIndicator'                       4<-B
     C                   EVAL      SVMFR = XRATV
     C                   END                                                       4<-E
     C     XMLKEY032     READE     XMLRCAF                                33
     C                   ENDDO                                                    3<-E
      *
     C                   IF        XRVERD <> *BLANKS
     C     TARIKM        SETLL     TARI
     C     TARIK         READPE(N) TARI                                   33
     C                   DOW       *IN33 = *OFF
     C     TADATO        IFLE      WDT08
     C*    TADTS         ANDEQ     0
     C*    TADATO        ORLE      WDT08
     C*    TADTS         ANDGE     WDT08
     C                   LEAVE
     C                   END
     C     TARIK         READPE(N) TARI                                   33
     C  N33              ENDDO
     C                   EXSR      TATEST
     C                   END
     C                   WHEN      XRNV = 'QuantityOtherUnit'                    2
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD(H)  XTAL          SVNTM
     C                   WHEN      XRNV = 'CustomsTax'                           2
     C                   EXSR      SRXML303B1
     C                   WHEN      XRNV = 'DocumentReference'                    2
N31  C     XMLKEY032     CHAIN     XMLRCAF                            33
N31  C  N33              IF        XRATN = 'referenceCode'                        3<-B
N31  C                   IF        XRATV = 'MRK'                                   4<-B
N31   * MERKE & NR TIL RUBR. 31
N31  C     1             DO        7             XN3               3 0              5<-B
N31  C                   IF        CNT1(XN3) = *BLANKS                               6<-B
N31  C                   EVAL      CNT1(XN3) = XRVERD
N31  C                   LEAVE
N31  C                   END                                                         6<-E
N31  C                   ENDDO                                                      5<-E
N31  C                   ELSE                                                      4
     C                   ADD       1             XN2
     C                   EVAL      DOK2(XN2) = XRVERD
S31  C*    XMLKEY032     CHAIN     XMLRCAF                            33
S31  C* N33              IF        XRATN = 'referenceCode'
     C                   EVAL      DOK1(XN2) = XRATV
N31  C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   WHEN      XRNV = 'NetWeight'                            2
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD(H)  XTAL          SVVKTN
     C                   WHEN      XRNV = 'GoodsDescription'                     2
S27  C*                  MOVEL     XRVERD        SVVT
N27  C                   EVAL      VT1ALL = XRVERD
     C                   WHEN      XRNV = 'ValuationCode'                        2
     C                   MOVEL     XRVERD        SVVF
     C                   ENDSL                                                   2<-E
      *
     C                   EVAL      X003_XRLEV5 = X003_XRLEV5 + 1
     C     XMLKEY032     CHAIN     XMLRCVF02                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML303B1    BEGSR
      ***********************************************
      *
     C     XMLKEY033     CHAIN     XMLRCVF03                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'TaxCode'                              2
     C                   IF        XRVERD = 'MV'                                  3<-B
     C                   MOVE      'J'           XMVA              1
     C                   ELSE                                                     3
     C                   MOVE      'N'           XMVA              1
     C                   ADD       1             XN1
BRI  C                   IF        XN1 > 7
BRI  C                   EXSR      SRERROR2
BRI  C                   END
     C                   EVAL      AVG1(XN1) = XRVERD
     C                   END                                                      3<-E
     C                   WHEN      XRNV = 'TaxRateSequence'                      2
     C                   IF        XMVA = 'N'                                     3<-B
     C                   EVAL      AVG2(XN1) = XRVERD
S01  C*                  ELSE                                                     3
S01  C*                  EVAL      SVMFR = XRVERD
     C                   END                                                      3<-E
     C                   WHEN      XRNV = 'TaxBasis'                             2
     C                   IF        XMVA = 'N'                                     3<-B
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          AVG3(XN1)
     C                   END                                                      3<-E
     C                   WHEN      XRNV = 'TaxRate'                              2
     C                   IF        XMVA = 'N'                                     3<-B
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          AVG4(XN1)
     C                   END                                                      3<-E
     C                   WHEN      XRNV = 'TaxAmount'                            2
     C                   IF        XMVA = 'N'                                     3<-B
     C                   MOVEL     XRVERD        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          AVG5(XN1)
     C                   END                                                      3<-E
     C                   ENDSL                                                   2<-E
     C     XMLKEY033     READE     XMLRCVF03                              33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML304      BEGSR
      ***********************************************
N25  C                   MOVE      *BLANKS       XXPOSTNR          9
      * INFOR. FRA <Party>
      *
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = 0
     C                   EVAL      X003_XRLEV5 = 0
      *
      * HENT PARAMETER FRA <Party>
     C                   MOVE      *BLANKS       XAVSMOT           8
     C                   MOVE      *ZEROS        XKNR              8 0
     C     XMLKEY03      SETLL     XMLRCAF
     C     XMLKEY03      READE     XMLRCAF                                33
     C                   DOW       *IN33 = *OFF
     C                   SELECT
     C                   WHEN      ((XRATN='subClass') AND (XRATV='Consignor'))
     C                   MOVE      'AVSENDER'    XAVSMOT           8
     C                   WHEN      ((XRATN='subClass') AND (XRATV='Consignee'))
     C                   MOVE      'MOTTAKER'    XAVSMOT           8
     C                   WHEN      ((XRATN='subClass') AND
     C                              (XRATV='CustomsBroker'))
     C                   MOVE      'ANSVARLI'    XAVSMOT           8
     C                   LEAVE
     C                   WHEN      XRATN = 'partyId'
     C                   MOVEL     XRATV         XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          XKNR              8 0
     C                   ENDSL
     C     XMLKEY03      READE     XMLRCAF                                33
     C                   ENDDO
      *
     C                   SELECT
     C                   WHEN      XAVSMOT = 'AVSENDER'
     C                   MOVE      XKNR          SIKNS
     C                   WHEN      XAVSMOT = 'MOTTAKER'
     C                   MOVE      XKNR          SIKNK
     C                   ENDSL
      *
     C                   EVAL      X003_XRLEV4 = 1
     C                   EVAL      X003_XRLEV5 = 0
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'Name'                                 2
     C                   SELECT                                                   3<-B
     C                   WHEN      XAVSMOT = 'AVSENDER'                           3
     C                   EVAL      SINAS   = XRVERD
     C                   WHEN      XAVSMOT = 'MOTTAKER'                           3
     C                   EVAL      SINAK   = XRVERD
     C                   ENDSL                                                    3<-E
     C                   WHEN      XRNV = 'Address'                              2
     C                   EXSR      SRXML304A
     C                   WHEN      XRNV = 'VATNo'                                2
     C                   EVAL      SIRG    = XRVERD
     C                   WHEN      XRNV = 'CustomsCreditNo'                      2
     C                   MOVEL     XRVERD        XAN08
     C                   IF        XAN082 = *BLANKS
     C                   EVAL      SIKTC  = *BLANKS
     C*                  MOVE      XAN081        SIKT7
     C                   MOVEL     XAN081        XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          SIKT7
     C                   ELSE
     C                   MOVE      XAN08         SIKT8
     C                   END
     C***                EVAL      SIKDDK = 'M'
     C                   WHEN      ((XRNV='Contact') AND (XAVSMOT='ANSVARLI'))   2
     C                   EXSR      SRXML304B
     C                   ENDSL                                                   2<-E
      *
     C                   EVAL      X003_XRLEV4 = X003_XRLEV4 + 1
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML304A     BEGSR
      ***********************************************
      *
     C                   EVAL      X003_XRLEV4 = XRLEV4
     C                   EVAL      X003_XRLEV5 = 1
     C                   EVAL      X003_XRLEV6 = 0
      *
     C     XMLKEY031     CHAIN     XMLRCVF02                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'Street'                               2
     C                   SELECT                                                   3<-B
     C                   WHEN      XAVSMOT = 'AVSENDER'                           3
     C                   EVAL      SIADS1  = XRVERD
     C                   WHEN      XAVSMOT = 'MOTTAKER'                           3
     C                   EVAL      SIADK1  = XRVERD
     C                   ENDSL                                                    3<-E
     C                   WHEN      XRNV = 'PostalCode'                           2
     C                   SELECT                                                   3<-B
     C                   WHEN      XAVSMOT = 'AVSENDER'                           3
     C                   EVAL      SIADS3  = XRVERD
     C                   WHEN      XAVSMOT = 'MOTTAKER'                           3
     C                   EVAL      SIADK3  = XRVERD
N25  C                   EVAL      XXPOSTNR = XRVERD
     C                   ENDSL                                                    3<-E
     C                   WHEN      XRNV = 'City'                                 2
     C                   SELECT                                                   3<-B
     C                   WHEN      XAVSMOT = 'AVSENDER'                           3
     C                   CAT       XRVERD:1      SIADS3
     C                   WHEN      XAVSMOT = 'MOTTAKER'                           3
     C                   CAT       XRVERD:1      SIADK3
     C                   ENDSL                                                    3<-E
     C                   ENDSL                                                   2<-E
      *
     C     XMLKEY031     READE     XMLRCVF02                              33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML304B     BEGSR
      ***********************************************
      *
     C                   EVAL      X003_XRLEV4 = XRLEV4
     C                   EVAL      X003_XRLEV5 = 1
     C                   EVAL      X003_XRLEV6 = 0
      *
     C     XMLKEY031     CHAIN     XMLRCVF02                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'ContactName'                          2
     C                   EVAL      SISG  = XRVERD
N23  C     LC:UC         XLATE     SISG          SISG
     C                   WHEN      XRNV = 'ContactFunction'                      2
     C                   EVAL      SITARF = XRVERD
     C                   ENDSL                                                   2<-E
      *
     C     XMLKEY031     READE     XMLRCVF02                              33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML305      BEGSR
      ***********************************************
      * INFOR. FRA <TransportLeg>
      *
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = 1
     C                   EVAL      X003_XRLEV5 = 0
      *
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'TransportLegType'                     2
     C                   WHEN      XRNV = 'TransportLegId'                       2
     C*                  EVAL      SITRID = XRVERD
     C                   WHEN      XRNV = 'Location'                             2
     C*                  EXSR      SRXML305A
     C                   WHEN      XRNV = 'ModeOfTransport'                      2
     C                   MOVEL     XRVERD        SITRM
     C                   WHEN      XRNV = 'MeansOfTransport'                     2
     C                   EXSR      SRXML305A
     C                   ENDSL
      *
     C                   EVAL      X003_XRLEV4 = X003_XRLEV4 + 1
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML305A     BEGSR
      ***********************************************
      *
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = XRLEV4
      *
     C     XMLKEY031     CHAIN     XMLRCVF02                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'MeansOfTransportId'                   2
     C                   EVAL      SITRID = XRVERD
     C                   WHEN      XRNV = 'CountryCode'                          2
     C                   EVAL      SILKT  = XRVERD
     C*                  WHEN      XRNV = 'MeansOfTransportType'                 2
     C*                  MOVEL     XRVERD        XTXT
     C*                  EXSR      KNVTAL
     C*                  Z-ADD     XTAL          SITRM
     C                   ENDSL
     C     XMLKEY031     READE     XMLRCVF02                              33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRXML306      BEGSR
      ***********************************************
      * INFOR. FRA <TermsOfDelivery>
      *
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = 1
     C                   EVAL      X003_XRLEV5 = 0
      *
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'TODConditionCode'                     2
     C                   EVAL      SILV   = XRVERD
     C     XMLKEY031     SETLL     XMLRCAF
     C     XMLKEY031     READE     XMLRCAF                                33
     C                   DOW       *IN33 = *OFF                                   3<-B
     C                   IF        XRATN = 'codeListAgencyIdentifier'              4<-B
     C                   MOVEL     XRATV         SILV
     C                   LEAVE
     C                   END                                                       4<-E
     C     XMLKEY031     READE     XMLRCAF                                33
     C                   ENDDO                                                    3<-E
      * FINN TEKST TIL LEVERINGSBETINGELSE
     C     KODTLBK       CHAIN     KODTLB                             33
     C  N33              MOVE      KLBKT         SILV2
     C  N33KLBHAD        IFEQ      'A'                                            3<-B
     C     SIADS3        IFNE      *BLANKS                                         4<-B
     C                   MOVEL     SIADS3        SILVT
     C                   ELSE                                                      4
     C     SIADS2        IFNE      *BLANKS                                          5<-B
     C                   MOVEL     SIADS2        SILVT
     C                   ELSE                                                       5
     C                   MOVEL     SIADS1        SILVT
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   ELSE                                                     3
      * KLBHAD = 'M'
     C     SIADK3        IFNE      *BLANKS                                         4<-B
     C                   MOVEL     SIADK3        SILVT
     C                   ELSE                                                      4
     C     SIADK2        IFNE      *BLANKS                                          5<-B
     C                   MOVEL     SIADK2        SILVT
     C                   ELSE                                                       5
     C                   MOVEL     SIADK1        SILVT
     C                   END                                                        5<-E
     C                   END                                                       4<-E
      *
     C                   END                                                     3<-E
N21   *
N21  C                   WHEN      XRNV = 'TODLocation'                          2
N21  C                   EVAL      SILVT  = XRVERD
      *
     C                   ENDSL                                                  2<-E
      *
     C                   EVAL      X003_XRLEV4 = X003_XRLEV4 + 1
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
N08   ***********************************************
N08  C     SRXML307      BEGSR
N08   ***********************************************
N08   * DATO FRA <DateAndTime>
N08   *
N08  C                   EVAL      X003_XRLEV1 = XRLEV1
N08  C                   EVAL      X003_XRLEV2 = XRLEV2
N08  C                   EVAL      X003_XRLEV3 = XRLEV3
N08  C                   EVAL      X003_XRLEV4 = 0
N08  C                   EVAL      X003_XRLEV5 = 0
N08   * HENT PARAMETER FRA <DateAndTime>
N08  C                   MOVE      *ZEROS        XDTMSG            8 0
N08  C     XMLKEY03      SETLL     XMLRCAF
N08  C     XMLKEY03      READE     XMLRCAF                                33
N08  C                   DOW       *IN33 = *OFF
N08  C                   IF        XRATN = 'subClass'
N08  C     XRATV         CABNE     'MessageDate' SLSRXML307
N08  C                   LEAVE
N08  C                   END
N08  C     XMLKEY03      READE     XMLRCAF                                33
N08  C                   ENDDO
N08   *
N08  C     XMLKEY03      CHAIN     XMLRCVF01                          33
N08  C                   DOW       *IN33 = *OFF                                 1<-B
N08  C                   SELECT                                                  2<-B
N08  C                   WHEN      XRNV = 'Year'                                 2
N08  C                   MOVEL     XRVERD        XTXT
N08  C                   EXSR      KNVTAL
N08  C                   EVAL      XDTMSG = XDTMSG + XTAL * 10000
N08  C                   WHEN      XRNV = 'Month'                                2
N08  C                   MOVEL     XRVERD        XTXT
N08  C                   EXSR      KNVTAL
N08  C                   EVAL      XDTMSG = XDTMSG + XTAL * 100
N08  C                   WHEN      XRNV = 'Day'                                  2
N08  C                   MOVEL     XRVERD        XTXT
N08  C                   EXSR      KNVTAL
N08  C                   EVAL      XDTMSG = XDTMSG + XTAL
N08  C                   ENDSL                                                   2<-E
N08   *
N08  C                   EVAL      X003_XRLEV4 = X003_XRLEV4 + 1
N08  C     XMLKEY03      CHAIN     XMLRCVF01                          33
N08  C                   ENDDO                                                  1<-E
N08   *
N08  C     SLSRXML307    ENDSR
N08   *
      ***********************************************
     C     SRHENTCN      BEGSR
      ***********************************************
      *
     C                   EVAL      X002_XRLEV1 = XRLEV1
     C                   EVAL      X002_XRLEV2 = XRLEV2
     C                   EVAL      X002_XRLEV3 = 1
     C                   EVAL      X002_XRLEV4 = 0
      * INFOR. FRA <Equipment>
      *
     C     XMLKEY02      CHAIN     XMLRCVF                            33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'Equipment'                            2
     C                   GOTO      STHENTCN01
     C                   ENDSL                                                   2<-E
     C                   ADD       1             X002_XRLEV3
     C     XMLKEY02      CHAIN     XMLRCVF                            33
     C                   ENDDO                                                  1<-E
     C                   GOTO      SLHENTCN
      *
     C     STHENTCN01    TAG
     C                   EVAL      X003_XRLEV1 = XRLEV1
     C                   EVAL      X003_XRLEV2 = XRLEV2
     C                   EVAL      X003_XRLEV3 = XRLEV3
     C                   EVAL      X003_XRLEV4 = 1
     C                   EVAL      X003_XRLEV5 = 0
     C                   MOVE      *ZEROS        CNT1
S34  C*                  MOVE      *ZEROS        SVNT
N34  C                   MOVE      *ZEROS        SVNT01
     C                   MOVE      *ZEROS        XN1
      *
     C     XMLKEY03      CHAIN     XMLRCVF01                          33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'EquipmentType'                        2
     C                   IF        XRVERD = 'CN'                                  3<-B
     C                   EVAL      SIKDC  = '1'
     C                   END                                                      3<-E
     C                   WHEN      XRNV = 'EquipmentId'                          2
S34  C*                  EVAL      SVNT   = SVNT + 1
S34  C*                  EVAL      CNT1(SVNT) = XRVERD
N34  C                   EVAL      SVNT01 = SVNT01 + 1
N34  C                   EVAL      CNT1(SVNT01) = XRVERD
     C                   WHEN      XRNV = 'Weight'                               2
     C                   WHEN      XRNV = 'Volume'                               2
     C                   ENDSL
      *
     C                   EVAL      X003_XRLEV4 = X003_XRLEV4 + 1
     C     XMLKEY03      READE     XMLRCVF01                              33
     C                   ENDDO                                                  1<-E
      *
     C     SLHENTCN      ENDSR
      *
      ***********************************************
     C     SROPDHEA      BEGSR
      ***********************************************
N17   *
N17  C                   IF        XFLERVAL = 'J'
N17  C                   EXSR      SRBYTTVAL
N17  C                   END
N17   *
N17  C                   EXSR      CIFSR
N17   *
     C                   MOVE      *ZEROS        SIKDH
     C                   MOVE      *BLANKS       SIKDTR
     C                   MOVE      *ZEROS        SIAS
S19  C*                  MOVE      *BLANKS       SIVALR
S19  C*                  MOVE      *ZEROS        SIBELR
S19  C*                  MOVE      *ZEROS        SIBELS
     C                   MOVE      *ZEROS        SIMP
     C                   MOVE      *BLANKS       SIDTØ
     C                   MOVE      *BLANKS       SI0035
     C                   MOVEL     XSITRT        SITRT
     C                   IF        XINNSTIKK = 'J'
     C                   MOVE      'I'           SIMI
     C                   ELSE
     C                   MOVE      XSIMI         SIMI
     C                   END
N30  C                   IF        SIDT = 0
N30  C                   IF        XSIDT = 0
N30  C                   MOVE      WDT           SIDT
N30  C                   ELSE
N30  C                   MOVE      XSIDT         SIDT
N30  C                   END
N30  C                   END
      *
     C                   IF        SISG = *BLANKS
BL   C*                  MOVE      'AMT'         SISG
BL   C                   MOVE      'AUT'         SISG
     C                   END
     C*                  IF        SITARF = *BLANKS
     C     KODTSIK       CHAIN     KODTSI                             33
     C  N33              EVAL      SITARF = KSINAV
     C*                  END
BL   C*                  MOVE      'A'           SIUR
BL   C                   MOVE      'H'           SIUR
     C                   MOVE      'Q'           SIST
     C                   MOVE      'F'           HEST
     C                   Z-ADD     3             SIMP
     C                   MOVE      XBEL4         SIBEL4
     C                   MOVE      XBEL8         SIBEL8
     C                   MOVE      XBEL9         SIBEL9
     C                   MOVE      XBELA         SIBELA
     C                   MOVE      SIVAL2        SIVALB
S19  C*                  IF        SIDP = 49
N19  C                   IF        SIDP = 49 OR SIDP = 64 OR
N19  C                             SIDP = 65 OR SIDP = 66
     C                   MOVE      XBELS         SIBELS
     C                   ELSE
     C                   MOVE      *ZEROS        SIBELS
     C                   END
N20  C                   MOVE      XBELC         SIBELC
S20  C*                  MOVE      *ZEROS        SIBELC
S20  C*                  MOVE      *ZEROS        SIRAB
N11  C                   IF        SIKNK = 0
N11  C                   EVAL      *IN33 = *ON
N11  C                   ELSE
N11   * BEVARE FORETAKS FRA AVDELINGS KUNDE
N11  C                   EVAL      FO_SYRG = SYRG
N11  C     CUNDL01KAN    CHAIN     CUNDL01                            33
N11  C                   EVAL      SYRG = FO_SYRG
S33  C* N33AKTKOD        COMP      'A'                                3333
S26  C*                  IF        *IN33
N26   * OPPHEV ENDRING 25.   TELEFON FRA ANNE 18.09.2014. KL. 08.40
S33  C*                  IF        *IN33 AND *IN33 = *OFF
N33  C                   IF        *IN33
N25  C                   CLEAR                   KUNDR
S33  C*                  EVAL      AKTKOD = 'A'
N33  C                   EVAL      AKTKOD = 'I'
N25  C                   EVAL      KPERS  = 'AN-KUNDE'
N25  C                   EVAL      FIRMA  = FIFIRM
N25  C                   EVAL      KUNDNR = SIKNK
N25  C                   EVAL      KNAVN  = SINAK
N25  C                   EVAL      SONAVN = SINAK
N25  C                   EVAL      ADR1   = SIADK1
N25  C                   EVAL      ADR2   = SIADK2
N25  C                   EVAL      ADR3   = SIADK3
N25  C                   MOVE      *BLANKS       XAN01             1
N25  C                   IF        %SUBST(XXPOSTNR:5:5) = *BLANKS
N25  C     1             DO        4             XN                3 0
N25  C                   MULT      10            POSTNR
N25  C                   EVAL      XAN01 = %SUBST(XXPOSTNR:XN:1)
N25  C                   IF        XAN01 >= '0' AND XAN01 <= '9'
N25  C                   MOVE      XAN01         POSTNR
N25  C                   END
N25  C                   ENDDO
N25  C                   ELSE
N25  C                   EVAL      SYPOGE = XXPOSTNR
N25  C                   END
N25  C                   EVAL      SYKONT = SIKT7
N25  C                   EVAL      SYFR02 = SIKTC
N25  C                   EVAL      SYRG   = SIRG
N25  C                   WRITE     KUNDR
N33  C                   IF        *IN33 AND *IN33 = *OFF
N25  C                   EVAL      IBM_AKTKOD = 'A'
N25  C                   EVAL      IBM_KPERS  = 'AN-KUNDE'
N25  C                   EVAL      IBM_FIRMA  = FIFIRM
N25  C                   EVAL      IBM_KUNDNR = SIKNK
N25  C                   EVAL      IBM_KNAVN  = SINAK
N25  C                   EVAL      IBM_SONAVN = SINAK
N25  C                   EVAL      IBM_ADR1   = SIADK1
N25  C                   EVAL      IBM_ADR2   = SIADK2
N25  C                   EVAL      IBM_ADR3   = SIADK3
N25  C                   EVAL      IBM_POSTNR = POSTNR
N25  C                   IF        SYRG = *BLANKS
N25  C                   MOVEL     *ZEROS        IBM_FORETN
N25  C                   ELSE
N25  C                   MOVEL     SYRG          IBM_FORETN
N25  C                   END
N25  C                   WRITE     KUNDRIBM
N33  C                   END
N25  C                   EVAL      SYRG = FO_SYRG
N25  C                   EVAL      *IN33 = *OFF
N25  C                   END
N11  C                   END
S11  C*                  IF        SIRG <> *BLANKS
N11  C   33              IF        SIRG <> *BLANKS
N09  C                   EVAL      FO_SYRG = SIRG
N09  C     CUNDLFOK      CHAIN     CUNDLFO                            33
N09  C                   DOW       *IN33 = *OFF
N09  C                   IF        FO_AKTKOD = 'A'
N09  C                   EVAL      SIKNK = FO_KUNDNR
N09  C                   LEAVE
N09  C                   END
N09  C     CUNDLFOK      READE     CUNDLFO                                33
N09  C                   ENDDO
N09  C                   END
      *
     C                   MOVE      'CC'          HEOT
     C                   EVAL      HEGN   = SIGN
     C                   EVAL      HEPOS1 = SIPOS
      *
     C                   WRITE     SADHR
     C                   WRITE     HEADFR
BI   C                   WRITE     DISPR
     C                   MOVE      XXAVD         XSAVD
     C                   WRITE     XMLSADHR
N22   *
N22  C                   EXSR      SROPDTT
      *
      * OPPDATER EDIM
     C                   MOVEL     WDT           M0068A
     C                   MOVE      *ZEROS        M0068B
     C                   MOVE      *ZEROS        M0068C
     C     1             CHAIN     EDIC                               33
     C                   ADD       1             CMN
     C                   UPDATE    EDICR
     C                   EVAL      M0004 = 'AMPHORA'
     C                   EVAL      M0010 = 'SYSPEDNO'
     C                   MOVE      S0035         M0035
     C                   EVAL      M0062 = X14S
     C                   MOVE      'XMLIMP'      M0065
     C                   EVAL      M0068 = XORDREF
     C                   MOVE      *ZEROS        M0068D
     C                   MOVE      *ZEROS        M0068E
     C                   MOVE      *ZEROS        M0068F
     C                   MOVE      '929'         M1001
     C                   EVAL      M1004 = X14S
     C                   MOVEL     'XML'         M1225
     C                   MOVE      *ZEROS        M5004D
     C                   MOVE      *BLANKS       M1N08
      *
     C                   MOVE      USN           MSN
     C                   Z-ADD     CMN           MMN
     C                   MOVE      'R'           MSR
     C                   MOVE      'C'           MST
     C                   MOVE      WDT           MDT
     C                   MOVE      WTM           MTM
     C                   MOVE      SIAVD         MAVD
     C                   MOVE      SITDN         MTDN
      *
     C                   WRITE     EDIMR
      *
     C                   ENDSR
      *
N22   ***********************************************
N22  C     SROPDTT       BEGSR
N22   ***********************************************
N22   *
N22  C                   EVAL      TTAVD  = SIAVD
N22  C                   EVAL      TTOPD  = SITDN
N22  C                   MOVE      WDT           TTDATE
N22  C                   MOVE      WTM           TTTIME
N22  C                   EVAL      TTUSER = ZUSER
N22  C                   MOVE      WDT           TTDATL
N22  C                   MOVE      WTM           TTTIML
N22  C                   EVAL      TTNAME = 'SYXML15'
N22  C                   WRITE     TRACKFR
N22   *
N22  C                   ENDSR
N22   *
      ***********************************************
     C     SNDTVINN      BEGSR
      ***********************************************
      * SEND TIL TVINN
     C*                  MOVE      'DFU'         M1N07
     C                   EXSR      FINMTY
      *
     C                   IF        XNYSKV = 'J'                                 1<-B
     C                   MOVEL     WDT           M0068A
     C     M0068A        CHAIN     TVIND                              32
     C   32              Z-ADD     M0068A        D0068A
     C   32              Z-ADD     0             D0068B
     C                   ADD       1             D0068B
     C   32              WRITE     TVINDF
     C  N32              UPDATE    TVINDF
     C                   MOVE      D0068B        M0068B
     C                   Z-ADD     1             M0068C
     C                   ELSE                                                   1
     C                   EVAL      M0068A = M2_M0068A
     C                   EVAL      M0068B = M2_M0068B
     C                   EVAL      M0068C = 0
     C                   MOVE      *ZEROS        Æ0068C            2 0
     C     EDIM4K        SETLL     EDIM4
     C     EDIM4K2       READPE    EDIM4                                  33
     C                   DOW       *IN33 = *OFF                                  2<-B
     C                   IF        M4_M0065 = 'CUSDEC' OR M4_M0065 = 'CUSRES'     3<-B
     C                   IF        M4_MST <> 'D' AND M4_M1001 = '929'              4<-B
     C                   IF        Æ0068C = 0                                       5<-B
     C                   EVAL      Æ0068C = M4_M0068C
     C                   END                                                        5<-E
     C*                  IF        M1N07 <> 'DFI' AND                               5<-B
     C*                            M1N07 <> 'DII' AND
     C*                            M1N07 <> 'DPU'
     C                   IF        M4_M1N07 <> 'DFI' AND                            5<-B
     C                             M4_M1N07 <> 'DII' AND
     C                             M4_M1N07 <> 'DPU'
     C                   EVAL      M0068C = Æ0068C + 1
     C                   LEAVE
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C     EDIM4K2       READPE    EDIM4                                  33
     C                   ENDDO                                                   2<-E
     C                   END                                                    1<-E
      *
     C     1             CHAIN     EDIC                               33
     C                   ADD       1             CMN
     C                   UPDATE    EDICR
     C                   MOVE      S0004         M0004
     C                   MOVE      S0010         M0010
     C                   MOVE      S0035         M0035
     C                   EVAL      M0062 = X14S
     C                   MOVE      'CUSDEC'      M0065
     C                   MOVE      *BLANKS       M0068
     C                   MOVE      SYFORE        X0068Æ
     C                   MOVEL     X0068Å        M0068
     C                   MOVE      *ZEROS        M0068D
     C                   MOVE      *ZEROS        M0068E
     C                   MOVE      *ZEROS        M0068F
     C                   MOVE      '929'         M1001
     C                   MOVE      *BLANKS       M1004
     C                   SELECT
     C     M1N07         WHENEQ    'DFU'
     C                   MOVEL     '9  '         M1225
     C     M1N07         WHENEQ    'DMA'
     C                   MOVEL     'ZZ '         M1225
     C     M1N07         WHENEQ    'DFO'
     C                   MOVEL     '14 '         M1225
     C     M1N07         WHENEQ    'DEN'
     C                   MOVEL     '2  '         M1225
     C     M1N07         WHENEQ    'DKO'
     C                   MOVEL     '4  '         M1225
     C     M1N07         WHENEQ    'DOM'
     C                   MOVEL     '18 '         M1225
     C                   ENDSL
N08  C                   IF        XDTMSG = 0
     C                   MOVE      SIDTØ         M2005B
N08  C                   ELSE
N08  C                   Z-SUB     XDTMSG        M2005B
N08  C                   END
     C                   MOVE      S3039D        M3039D
N10  C                   IF        XS3039E = 0
     C                   MOVE      S3039E        M3039E
N10  C                   ELSE
N10  C                   MOVE      XS3039E       M3039E
N10  C                   END
     C                   MOVE      *ZEROS        M5004D
     C                   MOVE      *BLANKS       M1N08
     C                   Z-ADD     3             M9N01
      *
     C                   MOVE      *ZEROS        MSN
     C                   Z-ADD     CMN           MMN
     C                   MOVE      'S'           MSR
     C                   MOVE      *BLANKS       MST
     C                   MOVE      *ZEROS        MDT
     C                   MOVE      *ZEROS        MTM
     C                   MOVE      SIAVD         MAVD
     C                   MOVE      SITDN         MTDN
      *
     C                   WRITE     EDIMR
      *
     C     SADHK2        CHAIN     SADH                               33
     C                   IF        XBMI = 'J'
     C                   MOVE      ' '           SIMI
     C                   END
     C                   IF        SIVKB = 0
     C                   MOVE      XSIVKB        SIVKB
     C                   END
     C                   MOVE      XSINTK        SINTK
     C                   MOVE      M1N07         SIMF
     C                   UPDATE    SADHR
     C     SADHK         CHAIN     HEADFR                             33
     C                   IF        HEVKT = 0
     C                   MOVE      XSIVKB        HEVKT
     C                   END
     C                   MOVE      XSINTK        HENT
     C  N33              UPDATE    HEADFR
      *
     C                   ENDSR
      *
      ***********************************************
     C     SROPDLIN      BEGSR
      ***********************************************
      *
     C                   IF        SVVNT <> 0                                   1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      ((SVVKTB = 0) AND (SVVKTN = 0))               2
     C                   EVAL      SVVKTB = 1
     C                   EVAL      SVVKTN = 1
     C                   WHEN      SVVKTB = 0                                    2
     C                   EVAL(H)   SVVKTB = SVVKTN * 1.1
     C                   WHEN      SVVKTN = 0                                    2
     C                   EVAL(H)   SVVKTN = SVVKTN * 0.9
     C                   ENDSL                                                   2<-E
     C                   Z-ADD(H)  SVVKTN        XSVVKTN           9 0
     C                   IF        XSVVKTN = 0                                   2<-B
     C                   EVAL      XSVVKTN = 1
     C                   END                                                     2<-E
     C                   MOVE      SVBELT        XSVBELT          11 2
     C                   MOVE      SVNTM         XSVNTM            7 0
     C                   ADD(H)    SVVKTB        SIVKB
      * TEST TOLL
N03  C                   MOVE      'N'           XTOLL             1
     C     1             DO        7             XN1                             2<-B
     C                   SELECT                                                   3<-B
     C                   WHEN      ((AVG1(XN1) = 'TL') AND (AVG4(XN1) = 0))       3
     C                   EVAL      SVPVA = 'F'
N03  C                   EVAL      SVAS  = 0
N03  C                   EVAL      XTOLL = 'J'
     C                   LEAVE
S13  C*                  WHEN      ((AVG1(XN1) = 'TL') AND (AVG4(XN1) <> 0))
N13  C                   WHEN      AVG1(XN1) = 'TL' AND AVG4(XN1) <> 0 AND        3
N13  C                             AVG4(XN1) < 1000
     C                   EVAL      SVAS  = AVG4(XN1)
N03  C                   EVAL      XTOLL = 'J'
N18   *
N18  C     TARIKM        SETLL     TARI
N18  C     TARIK         READPE(N) TARI                                   33
N18  C                   DOW       *IN33 = *OFF                                    4<-B
N18  C                   IF        TADATO <= WDT08                                  5<-B
N18  C                   IF        TAORDB = SVAS OR                                  6<-B
N18  C                             TAEØSB = SVAS OR
N18  C                             TAEFB  = SVAS OR
N18  C                             TAEFTB = SVAS OR
N18  C                             TATYRB = SVAS OR
N18  C                             TAISRB = SVAS OR
N18  C                             TAELLB = SVAS OR
N18  C                             TAPOLB = SVAS OR
N18  C                             TAROMB = SVAS OR
N18  C                             TAUNGB = SVAS OR
N18  C                             TAGRLB = SVAS OR
N18  C                             TAFÆRB = SVAS OR
N18  C                             TAISTB = SVAS OR
N18  C                             TAMARB = SVAS OR
N18  C                             TAMEXB = SVAS OR
N18  C                             TAVGAB = SVAS OR
N18  C                             TAN01B = SVAS OR
N18  C                             TAN03B = SVAS OR
N18  C                             TAN04B = SVAS OR
N18  C                             TAMULB = SVAS OR
N18  C                             TAOULB = SVAS
N18  C                   EVAL      SVPVA = TAORDK
N18  C                   LEAVE
N18  C                   END                                                         6<-E
N18  C                   END                                                        5<-E
N18  C     TARIK         READPE(N) TARI                                   33
N18  C  N33              ENDDO                                                     4<-E
N18   *
     C                   LEAVE
     C                   ENDSL                                                    3<-E
     C                   ENDDO                                                   2<-E
N03  C                   IF        XTOLL = 'N'                                   2<-B
N03  C                   EVAL      SVPVA = 'F'
N03  C                   EVAL      SVAS  = 0
N03  C                   END                                                     2<-E
      *
S13  C*                  IF        AVG1(1) <> 'TL'
S34  C*                  IF        AVG1(1) <> 'TL' OR AVG4(1) >= 1000            2<-B
S34  C*                  MOVE      AVG1(1)       SVKDAÆ
S34  C*                  MOVE      AVG2(1)       SVKDSÆ
S34  C*                  MOVE      AVG3(1)       SVBLGÆ
S34  C*                  MOVE      AVG4(1)       SVBLSÆ
S34  C*                  MOVE      AVG5(1)       SVBLÆ
N34  C     1             DO        7             XN1               3 0           2<-B
N34  C                   IF        AVG1(XN1) <> *BLANKS                           3<-B
N34  C                   IF        AVG1(XN1) <> 'TL' OR AVG4(XN1) >= 1000          4<-B
     C                   EXSR      SRAVG
     C                   END                                                       4<-E
N34  C                   END                                                      3<-E
N34  C                   ENDDO                                                   2<-E
S34  C*                  MOVE      CNT1(1)       SVFT
      *
      * UNDERSTELLSNR SKAL LIGGE PÅ HOVEDLINJE
     C     1             DO        7             XN1                             2<-B
     C                   IF        DOK1(XN1) = 'VI'                               3<-B
S34  C*                  EVAL      SVEH    = 'U.NR'
S34  C*                  EVAL      SVNT    = 1
S34  C*                  EVAL      SVFT    = DOK2(XN1)
N34  C                   EVAL      SVEH01  = 'U.NR'
N34  C                   EVAL      SVNT01  = 1
N34  C                   EVAL      SVFT01  = DOK2(XN1)
     C     XN1           DO        6             XN2                               4<-B
     C                   EVAL      DOK1(XN2) = DOK1(XN2+1)
     C                   EVAL      DOK2(XN2) = DOK2(XN2+1)
     C                   ENDDO                                                     4<-E
     C                   EVAL      DOK1(7) = *BLANKS
     C                   EVAL      DOK2(7) = *BLANKS
     C                   LEAVE
     C                   END                                                      3<-E
     C                   ENDDO                                                   2<-E
      *
S34  C*                  MOVE      VT1(1)        SVVT
S34  C*                  MOVE      DOK1(1)       SVCREF
S34  C*                  MOVEL     DOK2(1)       SVTOA
     C                   WRITE     SADVR
S34  C*                  MOVE      *ZEROS        SVVKTB
S34  C*                  MOVE      *ZEROS        SVVKTN
S34  C*                  MOVE      *ZEROS        SVBELT
S34  C*                  MOVE      *ZEROS        SVNTM
S34  C*                  MOVE      *BLANKS       SVVT
S34  C*                  MOVE      *BLANKS       SVKDAÆ
S34  C*                  MOVE      *BLANKS       SVKDSÆ
S34  C*                  MOVE      *ZEROS        SVBLGÆ
S34  C*                  MOVE      *ZEROS        SVBLSÆ
S34  C*                  MOVE      *ZEROS        SVBLÆ
S34  C*                  EVAL      SVEH    = *BLANKS
S34  C*                  EVAL      SVNT    = 0
S34  C*                  EVAL      SVFT    = *BLANKS
S34  C*                  MOVE      SVLI          SVREFL
S34  C*                  MOVE      SVLI          SVLN
S34  C*    2             DO        7             XN1
S34  C*                  IF        AVG1(XN1) = *BLANKS AND
S34  C*                            CNT1(XN1) = *BLANKS AND
S34  C*                            VT1(XN1) = *BLANKS AND
S34  C*                            DOK1(XN1) = *BLANKS
S34  C*                  LEAVE
S34  C*                  END
S34  C*                  IF        AVG1(XN1) <> 'TL' OR AVG4(XN1) >= 1000
S34  C*                  MOVE      AVG1(XN1)     SVKDAÆ
S34  C*                  MOVE      AVG2(XN1)     SVKDSÆ
S34  C*                  MOVE      AVG3(XN1)     SVBLGÆ
S34  C*                  MOVE      AVG4(XN1)     SVBLSÆ
S34  C*                  MOVE      AVG5(XN1)     SVBLÆ
S34  C*                  EXSR      SRAVG
S34  C*                  END
S34  C*                  MOVE      VT1(XN1)      SVVT
S34  C*                  MOVE      CNT1(XN1)     SVFT
S34  C*                  MOVE      DOK1(XN1)     SVCREF
S34  C*                  MOVEL     DOK2(XN1)     SVTOA
S34  C*                  IF        SVKDAÆ <> *BLANKS OR SVFT <> *BLANKS OR
S34  C*                            SVCREF <> *BLANKS
S34  C*                  ADD       1             SVLI
S34  C*                  WRITE     SADVR
S34  C*                  END
S34  C*                  MOVE      *BLANKS       SVKDAÆ
S34  C*                  MOVE      *BLANKS       SVKDSÆ
S34  C*                  MOVE      *ZEROS        SVBLGÆ
S34  C*                  MOVE      *ZEROS        SVBLSÆ
S34  C*                  MOVE      *ZEROS        SVBLÆ
S12  C*                  END
S34  C*                  ENDDO
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRFINNAVD     BEGSR
      ***********************************************
      *
     C                   EVAL      X002_XRLEV1 = XRLEV1
     C                   EVAL      X002_XRLEV2 = XRLEV2
     C                   EVAL      X002_XRLEV3 = 1
     C                   EVAL      X002_XRLEV4 = 0
      *
     C                   MOVE      'N'           XOKAVD            1
     C     XRSN          SETLL     XMLRCVF
     C     XRSN          READE     XMLRCVF                                33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
S10  C*                  WHEN      XRNV = 'Location'                             2
S10  C*    XMLKEYAVD     CHAIN     XMLRCAF                            33
S10  C*                  DOW       *IN33 = *OFF                                   3<-B
S10  C*                  SELECT                                                    4<-B
S10  C*                  WHEN      ((XRATN = 'subClass') AND                       4
S10  C*                             (XRATV = 'CustomsDepartment'))
S10  C*                  MOVE      'J'           XOKAVD            1
S10  C*                  WHEN      ((XRATN = 'locationId') AND (XOKAVD = 'J'))     4
S10  C*                  MOVEL     XRATV         XTXT
S10  C*                  EXSR      KNVTAL
S10  C*                  Z-ADD     XTAL          XXAVD             4 0
S10  C*                  GOTO      SLFAVD
S10  C*                  ENDSL                                                     4<-E
S10  C*    XMLKEYAVD     READE     XMLRCAF                                33
S10  C*                  ENDDO                                                    3<-E
S10  C*                  IF        XOKAVD = 'N'                                   3<-B
S10  C*                  Z-ADD     0             XXAVD             4 0
S10  C*                  END                                                      3<-E
     C                   WHEN      XRNV = 'Party'                                2
S10  C*    XRSN          READE     XMLRCVF                                33
     C     XMLKEYAVD     CHAIN     XMLRCAF                            33
     C                   DOW       *IN33 = *OFF                                   3<-B
     C                   SELECT                                                    4<-B
     C                   WHEN      ((XRATN = 'subClass') AND                       4
     C                              (XRATV = 'CustomsBroker'))
     C                   MOVE      'J'           XOKAVD            1
     C                   WHEN      ((XRATN = 'subPartyId') AND (XOKAVD = 'J'))     4
     C                   MOVEL     XRATV         XTXT
     C                   EXSR      KNVTAL
     C                   Z-ADD     XTAL          XXAVD             4 0
     C                   GOTO      SLFAVD
     C                   ENDSL                                                     4<-E
     C     XMLKEYAVD     READE     XMLRCAF                                33
     C                   ENDDO                                                    3<-E
     C                   ENDSL                                                   2<-E
     C     XRSN          READE     XMLRCVF                                33
     C                   ENDDO                                                  1<-E
      *
     C     SLFAVD        ENDSR
      *
      ***********************************************
     C     SRFINNGN      BEGSR
      ***********************************************
     C                   MOVE      *BLANKS       HEGN
     C                   MOVE      *BLANKS       HEPOS1
      *
     C     XRSN          SETLL     XMLRCVF
     C     XRSN          READE     XMLRCVF                                33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'EntryNumber'                          2
     C                   MOVEL     XRVERD        HEGN
     C                   IF        HEPOS1 <> *BLANKS                              3<-B
     C                   LEAVE
     C                   END                                                      3<-E
     C                   WHEN      XRNV = 'EntryPositionNumber'                  2
     C                   MOVEL     XRVERD        HEPOS1
     C                   IF        HEGN   <> *BLANKS                              3<-B
     C                   LEAVE
     C                   END                                                      3<-E
     C                   ENDSL                                                   2<-E
      *
     C     XRSN          READE     XMLRCVF                                33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRAVG         BEGSR
      ***********************************************
N34  C                   MOVE      AVG1(XN1)     X_AKD             2
N34  C                   MOVE      AVG2(XN1)     X_ASV             3
S05  C*    SVKDAÆ        CHAIN     KODTS8                             33
N05  C     KODTS8K       CHAIN     KODTS8                             33
S34  C*  33SVKDAÆ        CHAIN     KODTS8                             33
N34  C   33X_AKD         CHAIN     KODTS8                             33
     C   33              GOTO      SLSRAVG
      *
S34  C*                  IF        SVBLGÆ = 0                                   1<-B
N34  C                   IF        AVG3(XN1) = 0                                1<-B
     C                   IF        KS8STY = '%'                                  2<-B
     C     XSVBELT       MULT(H)   XTVFAK        XBEL9N            9 0
S34  C*                  Z-ADD     XBEL9N        SVBLGÆ
N34  C                   Z-ADD     XBEL9N        AVG3(XN1)
     C                   ELSE                                                    2
     C     KS8STY        IFEQ      'P'                                            3<-B
     C     KS8STY        OREQ      'H'
     C     KS8STY        OREQ      'K'
     C     KS8STY        OREQ      'G'
     C                   IF        KS8AVG <> 'FK'                                  4<-B
S34  C*                  Z-ADD     XSVVKTN       SVBLGÆ
N34  C                   Z-ADD     XSVVKTN       AVG3(XN1)
     C     KS8STY        IFEQ      'G'                                              5<-B
S34  C*                  MULT      1000          SVBLGÆ
N34  C                   MULT      1000          AVG3(XN1)
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   ELSE                                                     3
     C     KS8STY        IFEQ      'D'                                             4<-B
S34  C*                  EVAL(H)   SVBLGÆ = XSVNTM / 12 + 0.5
N34  C                   EVAL(H)   AVG3(XN1) = XSVNTM / 12 + 0.5
     C                   ELSE                                                      4
     C     KS8STY        IFEQ      'T'                                              5<-B
S34  C*                  EVAL(H)   SVBLGÆ = XSVVKTN / 1000 + 0.5
N34  C                   EVAL(H)   AVG3(XN1) = XSVVKTN / 1000 + 0.5
     C                   ELSE                                                       5
     C     KS8STY        IFNE      'M'                                               6<-B
     C     KS8STY        ANDNE     'A'
      * KS8STY = '*' ELLER ' '
S34  C*                  Z-ADD     XSVNTM        SVBLGÆ
N34  C                   Z-ADD     XSVNTM        AVG3(XN1)
     C                   END                                                         6<-E
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C                   SELECT
     C     KS8STY        WHENEQ    ' '
     C     KS8STY        OREQ      'K'
     C     KS8STY        OREQ      'G'
     C     KS8STY        OREQ      'M'
     C     KS8STY        OREQ      'D'
     C     KS8STY        OREQ      'T'
     C     KS8STY        OREQ      'L'
S34  C*                  EVAL      SVBLÆ = SVBLGÆ * SVBLSÆ
N34  C                   EVAL      AVG5(XN1) = AVG3(XN1) * AVG4(XN1)
     C     KS8STY        WHENEQ    '%'
     C     KS8STY        OREQ      'H'
     C     KS8STY        OREQ      '*'
S34  C*                  EVAL      SVBLÆ = SVBLGÆ * SVBLSÆ / 100
N34  C                   EVAL      AVG5(XN1) = AVG3(XN1) * AVG4(XN1) /100
     C     KS8STY        WHENEQ    'P'
S34  C*                  EVAL      SVBLÆ = SVBLGÆ * SVBLSÆ / 1000
N34  C                   EVAL      AVG5(XN1) = AVG3(XN1) * AVG4(XN1) /1000
     C                   ENDSL
     C     KS8ØRE        IFEQ      '*'
S34  C*                  DIV(H)    100           SVBLÆ
N34  C                   DIV(H)    100           AVG5(XN1)
     C                   END
      *
     C     SLSRAVG       ENDSR
      *
      ***********************************************
     C     KNVTAL        BEGSR
      ***********************************************
     C                   MOVE      *ZEROS        XTAL
     C     1             DO        15            XN                3 0          1<-B
     C                   IF        ((XT(XN) = *BLANKS) OR (XT(XN) = '.'))        2<-B
     C                   LEAVE
     C                   ENDIF                                                   2<-E
     C                   MULT      10            XTALH
     C                   MOVE      XT(XN)        XTALH
     C                   ENDDO                                                  1<-E
      *
     C                   IF        XT(XN) = '.'                                 1<-B
     C                   ADD       1             XN
     C                   MOVE      XT(XN)        XTALD1
     C                   ADD       1             XN
     C                   IF        XT(XN) <> ' '                                 2<-B
     C                   MOVE      XT(XN)        XTALD2
     C                   ADD       1             XN
     C                   IF        XT(XN) <> ' '                                  3<-B
     C                   MOVE      XT(XN)        XTALD3
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRBYTTVAL     BEGSR
      ***********************************************
     C                   EVAL      SIVAL3 = 'NOK'
     C                   EVAL      SIVKU  = 100
     C                   EVAL      SIBEL3 = 0
S17  C*    SADHK         SETLL     SADF
S17  C*    SADHK         READE(N)  SADF                                   33
N17  C     SADHK2        SETLL     SADF
N17  C     SADHK2        READE(N)  SADF                                   33
     C                   DOW       *IN33 = *OFF
     C                   EVAL(H)   SIBEL3 = SIBEL3 + SFBL28 * SFKR28 / SFOM28
S17  C*    SADHK         READE(N)  SADF                                   33
N17  C     SADHK2        READE(N)  SADF                                   33
     C                   ENDDO
      *
     C                   ENDSR
      *
      ***********************************************
     C     CIFSR         BEGSR
      ***********************************************
     C     SIVAL3        CHAIN     KODTVAL2                           33
     C  N33              MOVE      KVAOMR        XOMRF             3 0
      *
     C                   MOVE      *ZEROS        XBEL8            11 2
      *
      *** OMREGN FAKTURASUM TIL NORSK KRONE
      *** OG LEGG DETTE PÅ CIFSUM (XBEL4)
     C                   IF        XOMRF <> 0
     C     SIBEL3        MULT      SIVKU         XWORK            16 5
      *   AVRUND CIFSUM
     C     XWORK         DIV(H)    XOMRF         XFAKNO            9 0          DEF. BILDE05
     C                   Z-ADD     XFAKNO        XBEL4             9 0
     C                   END
N14   *** OMREGN BEARBEDINGSKOSTNAD TIL NORSK KRONE
N14  C     XOMRR         IFNE      0
N14  C     SIBELR        MULT      XKRSR         XWORK            16 5
N14  C     XWORK         DIV(H)    XOMRR         XFAKNO            9 0          DEF. BILDE05
N14  C                   Z-ADD     XFAKNO        XBELS             9 0
N14  C                   END
      *
     C                   MOVE      *ZEROS        XKOSTN           15 4
N20   *** EGET FELT FOR PROSENTRABATT I TILLEGG TIL ANDRE KOSTNAD
N20  C                   IF        SIRAB <> 0
N20  C     XBEL4         DIV       100           XWORK
N20  C     XWORK         MULT      SIRAB         XBELC            11 2
N20  C                   IF        SIDP = 49
N20  C                   MULT(H)   0.2           XBELC
N20  C                   END
N20  C                   SUB(H)    XBELC         XBEL4
N20  C                   ELSE
N20  C                   MOVE      *ZEROS        XBELC
N20  C                   END
      *
      *** OMREGN FRAKT TIL NORSK KRONE
      *** OG LEGG DETTE PÅ CIFSUM (XBEL4)
     C                   IF        SIBEL1 <> 0
     C     SIBEL1        MULT(H)   XKRS1         XKOSTN
     C     XKOSTN        DIV(H)    XOMR1         XKOSTN
     C                   Z-ADD     XKOSTN        XBEL8
     C                   ADD(H)    XKOSTN        XBEL4
     C                   IF        SIDP = 49
     C                   MULT(H)   0.2           XKOSTN
     C                   END
     C                   ADD(H)    XKOSTN        XBELS             9 0
     C                   END
     C                   MOVE      *ZEROS        XKOSTN
      *
      *** OMREGN ANDRE KOSTNAD TIL NORSK KRONE
      *** OG LEGG DETTE PÅ CIFSUM (XBEL4)
     C                   IF        XBEL2 <> 0
     C     XBEL2         MULT(H)   XKRS2         XKOSTN
     C     XKOSTN        DIV(H)    XOMR2         XKOSTN
     C                   IF        SIDP = 49
     C                   MULT(H)   0.2           XKOSTN
     C                   END
     C                   IF        ((SIFTG2 = '+') OR (SIFTG2 = 'P'))
     C                   ADD(H)    XKOSTN        XBEL4
     C                   ELSE
     C                   SUB(H)    XKOSTN        XBEL4
     C                   END
     C                   END
     C                   Z-ADD(H)  XKOSTN        XBEL9            11 2
      *
      *** SJEKK OM FORSIKRING SKAL BEREGNES
     C                   IF        KLBFOK = 'A'
     C     XBEL4         MULT      KLBPRM        XWORK
     C     XWORK         DIV(H)    1000          XBELA             7 0
     C                   IF        SIDP = 49
     C                   MULT(H)   0.2           XBELA
     C                   END
     C                   ELSE
     C                   MOVE      *ZEROS        XBELA
     C                   END
     C                   ADD       XBELA         XBEL4
     C                   ADD       XBELA         XBELS
      *
     C                   IF        SIBEL3 = 0
     C                   MOVE      *ZEROS        XTVFAK           17 9
     C                   ELSE
     C     XBEL4         DIV(H)    SIBEL3        XTVFAK
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     TATEST        BEGSR
      ***********************************************
     C     SIDP          IFGE      60
     C     SIDP          ANDLE     69
     C                   MOVE      'F'           SVPVA
      *
     C                   ELSE
      *
     C                   MOVE      TAORDK        SVPVA
     C                   MOVE      TAORDB        SVAS
     C                   SELECT
     C                   WHEN      SVPRE = 'A'
     C                   MOVE      TAEØSB        SVAS
     C                   WHEN      ((SVPRE = 'B') OR (SVPRE = 'F'))
     C                   MOVE      TAEFB         SVAS
     C                   WHEN      ((SVPRE = 'C') OR (SVPRE = 'E'))
     C                   MOVE      TAEFTB        SVAS
     C                   WHEN      ((SVPRE = 'J') OR (SVPRE = 'N'))
     C                   EXSR      TATES2
     C                   ENDSL
      *
     C                   IF        SVAS = 0
     C                   IF        SVPRE<>'J' AND SVPRE<>'N' AND SVPRE<>' '
     C                   MOVE      'F'           SVPVA
     C                   END
     C                   END
      *
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     TATES2        BEGSR
      ***********************************************
      * HELE SUBRUTINE ER OMSKREVET
     C                   SELECT
S48  C*    SVLK          WHENEQ    'HR'                                         KROATIA
N48  C     SVLK          WHENEQ    'SZ'                                         SWAZILAND
     C                   MOVE      TATSJB        SVAS
     C     SVLK          WHENEQ    'TR'                                         TYRKIA
     C                   MOVE      TATYRB        SVAS
     C     SVLK          WHENEQ    'IL'                                         ISRAEL
     C                   MOVE      TAISRB        SVAS
     C     SVLK          WHENEQ    'SG'                                         SINGAPORE
     C                   MOVE      TAELLB        SVAS
     C     SVLK          WHENEQ    'CL'                                         CHILE
     C                   MOVE      TABULB        SVAS
     C     SVLK          WHENEQ    'MK'                                         MAKEDONIA
     C                   MOVE      TAPOLB        SVAS
     C     SVLK          WHENEQ    'KR'                                         SØR KOREA
     C                   MOVE      TAROMB        SVAS
     C     SVLK          WHENEQ    'JO'                                         JORDAN
     C                   MOVE      TAUNGB        SVAS
     C     SVLK          WHENEQ    'TN'                                         TUNISIA
     C                   MOVE      TASLOB        SVAS
     C     SVLK          WHENEQ    'GL'                                         GRØNLAND
     C                   MOVE      TAGRLB        SVAS
     C     SVLK          WHENEQ    'FO'                                         FÆRØYENE
     C                   MOVE      TAFÆRB        SVAS
     C     SVLK          WHENEQ    'IN'                                         INDIA
     C     SVLK          OREQ      'LK'                                         SRI LANKA
     C     SVLK          OREQ      'TH'                                         THAILAND
     C                   MOVE      TAISTB        SVAS
     C     SVLK          WHENEQ    'MA'                                         MAROKKO
     C                   MOVE      TAMARB        SVAS
     C     SVLK          WHENEQ    'MX'                                         MEXICO
     C                   MOVE      TAMEXB        SVAS
     C     SVLK          WHENEQ    'PS'                                         VESTBREDDEN OG GAZA
     C                   MOVE      TAVGAB        SVAS
     C     SVLK          WHENEQ    'LN'                                         LIBANON
     C                   MOVE      TAN01B        SVAS
     C     SVLK          WHENEQ    'EG'                                         EGYPT
     C                   MOVE      TAN03B        SVAS
     C     SVLK          WHENEQ    'CA'                                         CANADA
     C                   MOVE      TAN04B        SVAS
N48  C     SVLK          WHENEQ    'RS'                                         SERBIA
N48  C                   MOVE      TAN05B        SVAS
N48  C     SVLK          WHENEQ    'AL'                                         ALBANIA
N48  C                   MOVE      TAN06B        SVAS
N48  C     SVLK          WHENEQ    'UA'                                         UKRAINA
N48  C                   MOVE      TAN07B        SVAS
N48  C     SVLK          WHENEQ    'PE'                                         PERU
N48  C                   MOVE      TAN08B        SVAS
N48  C     SVLK          WHENEQ    'ME'                                         MONTENEGRO
N48  C                   MOVE      TAN09B        SVAS
N48  C     SVLK          WHENEQ    'HK'                                         HONG KONG
N48  C                   MOVE      TAN10B        SVAS
N48  C     SVLK          WHENEQ    'AE'                                         FOREBEDE ARABISK EMI
N48  C     SVLK          OREQ      'BH'                                         BAHRAIN
N48  C     SVLK          OREQ      'SA'                                         SAUDI ARABIA
N48  C     SVLK          OREQ      'OM'                                         OMAN
N48  C     SVLK          OREQ      'QA'                                         QATAR
N48  C     SVLK          OREQ      'KW'                                         KUWAIT
N48  C                   MOVE      TAN13B        SVAS
N48  C     SVLK          WHENEQ    'PA'                                         PANAMA
N48  C                   MOVE      TAN14B        SVAS
N48  C     SVLK          WHENEQ    'CR'                                         COSTA RICA
N48  C                   MOVE      TAN15B        SVAS
N48  C     SVLK          WHENEQ    'CO'                                         COLOMBIA
N48  C                   MOVE      TAN16B        SVAS
N48  C     SVLK          WHENEQ    'GE'                                         GEORGIA
N48  C                   MOVE      TAN17B        SVAS
N48  C     SVLK          WHENEQ    'BA'                                         BOSNIA HERCEGOVINA
N48  C                   MOVE      TAN18B        SVAS
N48  C     SVLK          WHENEQ    'PH'                                         FILLIPINENE
N48  C                   MOVE      TAN19B        SVAS
N48  C     SVLK          WHENEQ    'GB'                                         STORBRITANIA
N48  C                   MOVE      TAN20B        SVAS
N48  C     SVLK          WHENEQ    'ID'                                         INDONESIA
N48  C                   MOVE      TAN22B        SVAS
N48  C     SVLK          WHENEQ    'EC'                                         ECUADOR
N48  C                   MOVE      TAN23B        SVAS
N48  C     SVLK          WHENEQ    'BW'                                         BOTSWANA
N48  C     SVLK          OREQ      'NA'                                         NAMIBIA
N48  C     SVLK          OREQ      'SZ'                                         SWAZILAND
N48  C                   MOVE      TAN11B        SVAS
     C     KS2MO         WHENEQ    'M'                                          MINST UTVIKLEDE LAND
     C                   MOVE      TAMULB        SVAS
     C     KS2MO         WHENEQ    'O'                                          ORDINÆRE UTV.LAND
     C                   MOVE      TAOULB        SVAS
     C     KS2MO         WHENEQ    'S'                                          SACU
     C                   MOVE      TAOULB        SVAS
N48  C     KS2MO         WHENEQ    'L'                                          LAVERE M.INNT.LAND
N48  C                   MOVE      TAN12B        SVAS
     C                   ENDSL
      *
     C                   ENDSR
      *
      ***********************************************
     C     FINMTY        BEGSR
      ***********************************************
     C                   MOVE      'N'           XBMI              1
     C                   MOVE      'N'           XINST             1
      *
      *** FINNER SANSYNLIG MELDINGSTYPE UTFRA LOGGELEMENT OG
      ***   FUNKSJONTASTER
     C                   Z-ADD     3             M9N01
      *
     C     EDIM2K1       SETLL     EDIM2                              33
     C     STFMTY        TAG
     C     EDIM2K2       READPE    EDIM2                                  33
     C  N33              SELECT                                                 1<-B
     C     M2_M1001      WHENNE    '929'
     C     M2_MST        OREQ      'D'
     C     M2_MSR        OREQ      'S'
     C     M2_M1N07      OREQ      'DFI'
     C     M2_M1N07      OREQ      'DII'
     C     M2_M1N07      OREQ      'DPU'
     C     M2_M1N07      OREQ      'DKO'
     C     M2_M0068C     OREQ      0
     C     M2_M0068C     CABEQ     0             STFMTY
     C     M2_MSR        IFEQ      'S'                                           2<-B
     C     XINST         ANDEQ     'N'
     C     M2_M1N07      IFEQ      'DMA'                                          3<-B
     C     M2_M1N07      OREQ      'DEN'
      * DENNE TOLLDEK. KAN VÆRE INNSTIKK HVIS MELDING FØR DENNE
      * ER EN 'DUA' FRA TOLLVESENET.
     C                   MOVE      'J'           XINST             1
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   GOTO      STFMTY
     C     M2_M1N07      WHENEQ    'DME'                                        1
     C     SIMI          IFEQ      'I'                                           2<-B
     C                   GOTO      STFMTY
     C                   ELSE                                                    2
     C                   MOVE      'DKO'         M1N07
     C                   END                                                     2<-E
     C     M2_M1N07      WHENEQ    'DUA'                                        1
     C     SIMI          IFEQ      'I'                                           2<-B
     C     XINST         OREQ      'J'
     C                   MOVE      'J'           XBMI
     C     SIDP          IFEQ      40                                             3<-B
     C     SIDP          OREQ      41
     C                   MOVE      'DEN'         M1N07
     C                   ELSE                                                     3
     C                   MOVE      'DMA'         M1N07
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C                   MOVE      'DKO'         M1N07
     C                   END                                                     2<-E
     C     M2_M1N07      WHENEQ    'DIU'                                        1
     C                   MOVE      '1'           *IN33
     C     M2_M1N07      WHENEQ    'DTK'                                        1
     C                   MOVE      'DOM'         M1N07
     C                   OTHER                                                  1
     C                   MOVE      '1'           *IN33
     C                   ENDSL                                                  1<-E
      *
     C  N33              MOVE      'N'           XNYSKV            1
     C   33              MOVE      'J'           XNYSKV            1
     C   33              SELECT                                                 1<-B
     C     SIMI          WHENEQ    'I'                                          1
     C                   MOVE      'DFO'         M1N07
     C     SIDP          WHENNE    40                                           1
     C     SIDP          ANDNE     41
     C     SIDP          ANDNE     49
     C                   MOVE      'DMA'         M1N07
     C                   OTHER                                                  1
     C                   MOVE      'DFU'         M1N07
     C                   ENDSL                                                  1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     FINDTVK       BEGSR
      ***********************************************
     C                   MOVE      'N'           XINST             1
      *
     C     EDIM2K1       SETLL     EDIM2                              33
     C     STFDTVK       TAG
     C     EDIM2K2       READPE    EDIM2                                  33
     C  N33              SELECT                                                 1<-B
     C     M2_M1001      WHENNE    '929'                                        1
     C     M2_MST        OREQ      'D'
     C     M2_MSR        OREQ      'S'
     C     M2_M1N07      OREQ      'DFI'
     C     M2_M1N07      OREQ      'DII'
     C     M2_M1N07      OREQ      'DPU'
     C     M2_M1N07      OREQ      'DKO'
     C     M2_M0068C     OREQ      0
     C     M2_M0068C     CABEQ     0             STFDTVK
     C     M2_MSR        IFEQ      'S'                                           2<-B
     C     XINST         ANDEQ     'N'
     C     M2_M1N07      IFEQ      'DMA'                                          3<-B
     C     M2_M1N07      OREQ      'DEN'
      * DENNE TOLLDEK. KAN VÆRE INNSTIKK HVIS MELDING FØR DENNE
      * ER EN 'DUA' FRA TOLLVESENET.
     C                   MOVE      'J'           XINST             1
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   GOTO      STFDTVK
     C     M2_M1N07      WHENEQ    'DME'                                        1
     C     SIMI          IFEQ      'I'                                           2<-B
     C                   GOTO      STFDTVK
     C                   END                                                     2<-E
N30  C                   IF        SIDT = 0
N30  C                   MOVE      M2_M0068A     SIDT
N30  C                   MOVE      M2_M0068A     XSIDT
N30  C                   END
     C     M2_M1N07      WHENEQ    'DUA'                                        1
     C     M2_M1N07      WHENEQ    'DIU'                                        1
     C                   MOVE      '1'           *IN33
     C     M2_M1N07      WHENEQ    'DTK'                                        1
     C                   OTHER                                                  1
     C                   MOVE      '1'           *IN33
     C                   ENDSL                                                  1<-E
      *
     C  N33              MOVE      SIDT          XDTVKU            8 0
     C   33              MOVE      WDT           XDTVKU
      *
     C                   ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    USN               9
      *
     C     HEAD18K       KLIST
     C                   KFLD                    HEGN
     C                   KFLD                    HEPOS1
     C     SADHK         KLIST
     C                   KFLD                    XAVD
     C                   KFLD                    XTDN
     C     SADHK2        KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
N06  C     SADHK3        KLIST
N06  C                   KFLD                    HEAVD
N06  C                   KFLD                    HEOPD
N02  C     FRISOKK       KLIST
N02  C                   KFLD                    HEAVD
N02  C                   KFLD                    HEOPD
N02  C                   KFLD                    FS0_FSKODE
N02  C                   KFLD                    FS0_FSSOK
N02  C     *LIKE         DEFINE    FSKODE        FS0_FSKODE
N02  C     *LIKE         DEFINE    FSSOK         FS0_FSSOK
N02  C     *LIKE         DEFINE    FSSOK         FS0_FSSOK1
S06  C*    *LIKE         DEFINE    FSSOK         XGMLAWR
N02  C                   MOVE      'CMR'         FS0_FSKODE
S06  C*    FRISOKK2      KLIST
S06  C*                  KFLD                    HEAVD
S06  C*                  KFLD                    HEOPD
     C     FRISOL01K     KLIST
     C                   KFLD                    FSKODE
     C                   KFLD                    FSSOK
     C     CUNDL01K      KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KOAKNR
N11  C     CUNDL01KAN    KLIST
N11  C                   KFLD                    FIFIRM
N11  C                   KFLD                    SIKNK
N09  C     CUNDLFOK      KLIST
N09  C                   KFLD                    FIFIRM
N09  C                   KFLD                    FO_SYRG
     C     KODTAK        KLIST
     C                   KFLD                    KOAUNI
     C                   KFLD                    SIAVD
     C     KODTLBK       KLIST
     C                   KFLD                    KLBUNI
     C                   KFLD                    SILV
     C     KODTSIK       KLIST
     C                   KFLD                    KSIUNI
     C                   KFLD                    SISG
     C     KODTS2K       KLIST
     C                   KFLD                    KS2UNI
     C                   KFLD                    SILKA
     C     KODTS2KV      KLIST
     C                   KFLD                    KS2UNI
     C                   KFLD                    SVLK
N05  C     KODTS8K       KLIST
S34  C*                  KFLD                    SVKDAÆ
S34  C*                  KFLD                    SVKDSÆ
N34  C                   KFLD                    X_AKD
N34  C                   KFLD                    X_ASV
     C     KODTVAL2K1    KLIST
     C                   KFLD                    SIVAL1
     C*                  KFLD                    WDT08
     C                   KFLD                    XDTVKU
     C     KODTVAL2K2    KLIST
     C                   KFLD                    SIVAL2
     C*                  KFLD                    WDT08
     C                   KFLD                    XDTVKU
     C     KODTVAL2K3    KLIST
     C*                  KFLD                    SIVAL3
     C                   KFLD                    XSIVAL3
     C*                  KFLD                    WDT08
     C                   KFLD                    XDTVKU
N14  C     KODTVAL2KR    KLIST
N14  C                   KFLD                    SIVALR
N14  C                   KFLD                    XDTVKU
     C     EDIM2K1       KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C                   KFLD                    MAX0A
     C                   KFLD                    MAX0B
     C                   KFLD                    MAX0C
     C     EDIM2K2       KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C     EDIM4K        KLIST
     C                   KFLD                    M4_MSR
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C                   KFLD                    MAX0A
     C                   KFLD                    MAX0B
     C                   KFLD                    MAX0C
     C     EDIM4K2       KLIST
     C                   KFLD                    M4_MSR
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C     XMLKEY01      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X001_XRLEV1
     C                   KFLD                    X001_XRLEV2
     C                   KFLD                    X001_XRLEV3
     C                   KFLD                    X001_XRLEV4
     C                   KFLD                    X001_XRLEV5
     C                   KFLD                    X001_XRLEV6
     C                   KFLD                    X001_XRLEV7
     C                   KFLD                    X001_XRLEV8
     C                   KFLD                    X001_XRLEV9
     C     XMLKEY02      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X002_XRLEV1
     C                   KFLD                    X002_XRLEV2
     C                   KFLD                    X002_XRLEV3
     C                   KFLD                    X002_XRLEV4
     C     XMLKEY03      KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X003_XRLEV1
     C                   KFLD                    X003_XRLEV2
     C                   KFLD                    X003_XRLEV3
     C                   KFLD                    X003_XRLEV4
     C                   KFLD                    X003_XRLEV5
     C     XMLKEY031     KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X003_XRLEV1
     C                   KFLD                    X003_XRLEV2
     C                   KFLD                    X003_XRLEV3
     C                   KFLD                    X003_XRLEV4
     C     XMLKEY032     KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X003_XRLEV1
     C                   KFLD                    X003_XRLEV2
     C                   KFLD                    X003_XRLEV3
     C                   KFLD                    X003_XRLEV4
     C                   KFLD                    X003_XRLEV5
     C                   KFLD                    X003_XRLEV6
     C     XMLKEY033     KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    X003_XRLEV1
     C                   KFLD                    X003_XRLEV2
     C                   KFLD                    X003_XRLEV3
     C                   KFLD                    X003_XRLEV4
     C                   KFLD                    X003_XRLEV5
     C     XMLKEYAVD     KLIST
     C                   KFLD                    XRSN
     C                   KFLD                    XRLEV1
     C                   KFLD                    XRLEV2
     C                   KFLD                    XRLEV3
     C                   KFLD                    XRLEV4
     C                   KFLD                    XRLEV5
     C                   KFLD                    XRLEV6
     C     TARIK         KLIST
     C                   KFLD                    SVVNT
     C     TARIKM        KLIST
     C                   KFLD                    SVVNT
     C                   KFLD                    TATAR
     C                   KFLD                    XTADATO
     C                   MOVE      99999999      XTADATO
      *
     C     *LIKE         DEFINE    SIAVD         XAVD
     C     *LIKE         DEFINE    SITDN         XTDN
     C     *LIKE         DEFINE    SIBEL3        XSIBEL3
     C     *LIKE         DEFINE    SIFIF         XSIFIF
     C     *LIKE         DEFINE    SIVAL3        XSIVAL3
     C     *LIKE         DEFINE    SIVKU         XSIVKU
     C     *LIKE         DEFINE    SFOM28        XSIOMR
     C     *LIKE         DEFINE    XRLEV1        X001_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X001_XRLEV2
     C     *LIKE         DEFINE    XRLEV3        X001_XRLEV3
     C     *LIKE         DEFINE    XRLEV4        X001_XRLEV4
     C     *LIKE         DEFINE    XRLEV5        X001_XRLEV5
     C     *LIKE         DEFINE    XRLEV6        X001_XRLEV6
     C     *LIKE         DEFINE    XRLEV7        X001_XRLEV7
     C     *LIKE         DEFINE    XRLEV8        X001_XRLEV8
     C     *LIKE         DEFINE    XRLEV9        X001_XRLEV9
     C     *LIKE         DEFINE    XRLEV1        X002_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X002_XRLEV2
     C     *LIKE         DEFINE    XRLEV3        X002_XRLEV3
     C     *LIKE         DEFINE    XRLEV4        X002_XRLEV4
     C     *LIKE         DEFINE    XRLEV1        X003_XRLEV1
     C     *LIKE         DEFINE    XRLEV2        X003_XRLEV2
     C     *LIKE         DEFINE    XRLEV3        X003_XRLEV3
     C     *LIKE         DEFINE    XRLEV4        X003_XRLEV4
     C     *LIKE         DEFINE    XRLEV5        X003_XRLEV5
     C     *LIKE         DEFINE    XRLEV6        X003_XRLEV6
     C     *LIKE         DEFINE    XRNV          X001_XRNV
     C     *LIKE         DEFINE    SIVKB         XSIVKB
     C     *LIKE         DEFINE    SINTK         XSINTK
     C     *LIKE         DEFINE    SVAVD         XSVAVD
     C     *LIKE         DEFINE    SVTDN         XSVTDN
     C     *LIKE         DEFINE    SVLI          XSVLI
     C     *LIKE         DEFINE    TADATO        XTADATO
N10  C     *LIKE         DEFINE    S3039E        XS3039E
     C     *LIKE         DEFINE    M0068         XM0068
     C     *LIKE         DEFINE    M0068A        MAX0A
     C     *LIKE         DEFINE    M0068B        MAX0B
     C     *LIKE         DEFINE    M0068C        MAX0C
      *
     C                   MOVE      USN           XRSN
     C                   MOVE      'A'           KOAUNI
     C                   MOVE      'LB'          KLBUNI
     C                   MOVE      'SI'          KSIUNI
     C                   MOVE      'S2 '         KS2UNI
     C                   MOVE      '99999999'    MAX0A
     C                   MOVE      '999999'      MAX0B
     C                   MOVE      '99'          MAX0C
     C                   MOVE      'R'           M4_MSR
     C                   MOVE      *BLANKS       XMSGTXT         200
      *
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           WDT08             8 0
      *
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for håndtering av feil                         SRERROR /
      *////////////////////////////////////////////////////////////
     C     SRERROR       BEGSR
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           XDT               8 0
     C                   MOVE      WTM           XTM               6 0
     C                   EVAL      XMSG = 'Feil ved SAD-import, '
     C                             + 'PROGRAM = SYXML15, '
     C                             + 'DATO = ' + %TRIM(%EDITW(XDT:'    .  .  '))
     C                             + ', '
     C                             + 'TID = ' + %TRIM(%EDITW(XTM:'  :  :  '))
     C                             + '. '
     C                             + %TRIM(XMSGTXT)
     C                   CALL      'EDIERRC'
     C                   PARM                    XMSG            256
      *
     C                   ENDSR
      *
BRI   *////////////////////////////////////////////////////////////
BRI   * SR for håndtering av feil                        SRERROR2 /
BRI   *////////////////////////////////////////////////////////////
BRI  C     SRERROR2      BEGSR
BRI  C                   CALL      'SYGE15C'
BRI  C                   PARM                    WDT               8
BRI  C                   PARM                    WTM               6
BRI  C                   MOVE      WDT           XDT               8 0
BRI  C                   MOVE      WTM           XTM               6 0
BRI  C                   EVAL      XMSGTXT = 'For mange avgifter på en linje '
BRI  C                             + '(ref:' + %TRIM(XM0068) + ')'
BRI  C                   EVAL      XMSG = 'Feil ved SAD-import, '
BRI  C                             + 'PROGRAM = SYXML15, '
BRI  C                             + 'DATO = ' + %TRIM(%EDITW(XDT:'    .  .  '))
BRI  C                             + ', '
BRI  C                             + 'TID = ' + %TRIM(%EDITW(XTM:'  :  :  '))
BRI  C                             + '. '
BRI  C                             + %TRIM(XMSGTXT)
BRI  C                   CALL      'EDIERRC'
BRI  C                   PARM                    XMSG            256
BRI   *
BRI  C                   EVAL      *INLR = *ON
BRI  C                   RETURN
BRI   *
BRI  C                   ENDSR
BRI   *
