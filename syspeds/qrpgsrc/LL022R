      *
      ***********************************************************
      *** PROGRAM SKAL ALLOKERE VARE PÅ LAGER                 ***
      ***********************************************************
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 feil flytt av LHpak etter utvidelse for lang tid siden..
********************************************************************
      *
     FLLAGJL01  UF   E           K DISK
     FLLAGJS03  IF   E           K DISK
     F                                     RENAME(LLAGJR:LLAGJRS3)
     FLLAGJS09  IF   E           K DISK
     F                                     RENAME(LLAGJR:LLAGJRS9)
     FLLKUNF    IF   E           K DISK
     FLLAGJD01  IF A E           K DISK
     FLLAGJD07  IF   E           K DISK    RENAME(LLAGJDR:LLAGJDR07)
     FLLSERL02  UF   E           K DISK
     FLLVARE01  UF   E           K DISK
     FLLHEAD    IF   E           K DISK
     FLLMRF     IF   E           K DISK
     FLLLSDF    IF   E           K DISK
     FHEADF     IF   E           K DISK
     FLL022D    CF   E             WORKSTN USROPN
     F                                     SFILE(SUBFIL:ZRECNO)
     D ANT             S              7  0 DIM(900)
     D AMN             S              7  0 DIM(900)
     D                SDS
     D  UUSER                254    263
     D                 DS
s01  D*XTXT01          C                   CONST('ALLOKERT P.L:')
N01  D XTXT01          C                   CONST('ALLOK.P.L:')
     D                 DS
     D  XTIME                  1     14  0
     D  XTID                   1      6  0
     D  XDTD                   7      8  0
     D  XDTM                   9     10  0
     D  XDTÅ                  11     14  0
     D                 DS
     D  VDBDAT                 1      8  0
     D  VDBDÅ                  1      4  0
     D  VDBDM                  5      6  0
     D  VDBDD                  7      8  0
     D                 DS
     D  XLOK                   1     25
     D  XLOK1                  1      5
     D  XLOK2                  6     25
     D                 DS
     D  VALLOK                 1     25
     D  VALOK1                 1      5
     D  VALOK2                 6     25
      *
     C                   EXSR      INIT
      *
      * MERK ALLE GAMLE ALLOKERTE VARER
     C                   MOVE      'MRK'         UTYPE             3
     C                   CALL      'LL019R'
     C                   PARM                    UGRP
     C                   PARM                    UPNR
     C                   PARM                    UANR
     C                   PARM                    UMN
     C                   PARM                    UVN
     C                   PARM                    UTYPE
     C     UTYPE         IFEQ      'ERR'
     C                   Z-ADD     9             UFLAGG
     C                   GOTO      SLUTT
     C                   END
      *
      *
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C     XBATCH        IFNE      'J'
     C                   WRITE     SUBCTL
     C                   END
     C                   MOVEA     '00'          *IN(93)
     C                   MOVE      '0'           *IN42
     C                   Z-ADD     *ZEROS        ZRECNO
     C                   MOVE      UWNT0         XWNT0D
     C                   MOVE      *ZEROS        XWNT0A
     C                   MOVE      *ZEROS        UNTLK
     C                   MOVE      *ZEROS        WXWNT0            7 0
     C                   IF        LHLSD = *BLANKS
     C                   MOVE      'J'           XPREST            1
     C                   ELSE
     C                   MOVE      'L'           XPREST            1
     C                   END
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     START0        TAG
     C                   SELECT
     C                   WHEN      XPLS = 'U'
     C     LLAF3K        SETLL     LLAGJS09
     C                   OTHER
     C     LLAF3K        SETLL     LLAGJS03
     C                   ENDSL
     C     START1        TAG
     C                   SELECT
     C                   WHEN      XPLS = 'U'
     C     LLAF3K        READE     LLAGJS09                               94
     C                   OTHER
     C     LLAF3K        READE     LLAGJS03                               94
     C                   ENDSL
     C  N94USENR         IFNE      *BLANKS
     C     USENR         ANDNE     VASENR
     C     XALOC         ANDNE     'J'
     C                   GOTO      START1
     C                   ELSE
     C     XPRDT         IFNE      0
     C     XPRDT         ANDNE     VAPRDT
     C     USENR         ANDNE     *BLANKS
     C     USENR         ANDEQ     VASENR
     C     XALOC         ANDNE     'J'
     C                   GOTO      START1
     C                   END
     C                   END
     C  N94              IF        ((LVPLOK <> *BLANKS) AND (LVPLOK <> VALLOK))
     C                   GOTO      START1
     C                   END
     C  N94XKUNSD        IFEQ      'J'
     C     XLOK1         ANDNE     VALOK1
     C                   GOTO      START1
     C                   END
     C  N94XKUNSD        IFEQ      'N'
     C     XLOK1         ANDEQ     VALOK1
     C                   GOTO      START1
     C                   END
     C  N94VADATO        IFEQ      99999999
     C                   GOTO      START1
     C                   END
     C  N94              IF        ((VAST2 <> ' ') AND (VAST2 <> 'A'))
     C                   GOTO      START1
     C                   END
     C                   IF        XKUNSD <> 'J'
     C                   IF        *IN94
     C                   SELECT
     C                   WHEN      XPREST = 'L'
     C                   MOVE      'J'           XPREST            1
     C                   SELECT
     C                   WHEN      XPLS = 'U'
     C     LLAF3K        SETLL     LLAGJS09
     C                   OTHER
     C     LLAF3K        SETLL     LLAGJS03
     C                   ENDSL
     C                   GOTO      START0
     C                   WHEN      XPREST = 'J'
     C                   MOVE      'N'           XPREST            1
     C                   SELECT
     C                   WHEN      XPLS = 'U'
     C     LLAF3K        SETLL     LLAGJS09
     C                   OTHER
     C     LLAF3K        SETLL     LLAGJS03
     C                   ENDSL
     C                   GOTO      START0
     C                   ENDSL
     C                   ELSE
     C                   IF        XPREST = 'L'
     C     VALOK1        CABNE     LHLSD         START1
     C                   ELSE
     C     VALOK1        CABEQ     LHLSD         START1
     C     VALOK1        CHAIN     LLLSDF                             33
     C                   IF        XPREST = 'J'
     C     LSPRE         CABNE     'J'           START1
     C                   ELSE
     C     LSPRE         CABEQ     'J'           START1
     C                   END
     C                   END
     C                   END
     C                   END
      *
     C     START2        TAG
      *
     C     *IN94         DOWEQ     '0'                                          1<-B
     C                   ADD       1             ZRECNO
     C                   EXSR      HALLOK
     C     XBATCH        IFEQ      'J'
     C                   ADD       1             XN                3 0
     C                   ADD       WSWNT0        WXWNT0
     C                   MOVE      WSWNT0        ANT(XN)
     C                   MOVE      VAMN          AMN(XN)
     C                   ELSE
     C                   ADD       WSWNT0        WXWNT0
     C                   WRITE     SUBFIL
     C                   END
     C     ST21          TAG
     C                   SELECT
     C                   WHEN      XPLS = 'U'
     C     LLAF3K        READE     LLAGJS09                               94
     C                   OTHER
     C     LLAF3K        READE     LLAGJS03                               94
     C                   ENDSL
     C  N94USENR         IFNE      *BLANKS                                       2<-B
     C     USENR         ANDNE     VASENR
     C     XALOC         ANDNE     'J'
     C                   GOTO      ST21
     C                   ELSE                                                    2
     C     XPRDT         IFNE      0                                              3<-B
     C     XPRDT         ANDNE     VAPRDT
     C     USENR         ANDNE     *BLANKS
     C     USENR         ANDEQ     VASENR
     C     XALOC         ANDNE     'J'
     C                   GOTO      ST21
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C  N94              IF        ((LVPLOK <> *BLANKS) AND (LVPLOK <> VALLOK))
     C                   GOTO      ST21
     C                   END
     C  N94XKUNSD        IFEQ      'J'                                           2<-B
     C     XLOK1         ANDNE     VALOK1
     C                   GOTO      ST21
     C                   END                                                     2<-E
     C  N94XKUNSD        IFEQ      'N'                                           2<-B
     C     XLOK1         ANDEQ     VALOK1
     C                   GOTO      ST21
     C                   END                                                     2<-E
     C  N94VADATO        IFEQ      99999999
     C                   GOTO      ST21
     C                   END
     C  N94              IF        ((VAST2 <> ' ') AND (VAST2 <> 'A'))
     C                   GOTO      ST21
     C                   END
     C                   IF        XKUNSD <> 'J'
     C                   IF        *IN94
     C                   SELECT
     C                   WHEN      XPREST = 'L'
     C                   MOVE      'J'           XPREST            1
     C                   SELECT
     C                   WHEN      XPLS = 'U'
     C     LLAF3K        SETLL     LLAGJS09
     C                   OTHER
     C     LLAF3K        SETLL     LLAGJS03
     C                   ENDSL
     C                   GOTO      ST21
     C                   WHEN      XPREST = 'J'
     C                   MOVE      'N'           XPREST            1
     C                   SELECT
     C                   WHEN      XPLS = 'U'
     C     LLAF3K        SETLL     LLAGJS09
     C                   OTHER
     C     LLAF3K        SETLL     LLAGJS03
     C                   ENDSL
     C                   GOTO      ST21
     C                   ENDSL
     C                   ELSE
     C                   IF        XPREST = 'L'
     C     VALOK1        CABNE     LHLSD         ST21
     C                   ELSE
     C     VALOK1        CABEQ     LHLSD         ST21
     C     VALOK1        CHAIN     LLLSDF                             33
     C                   IF        XPREST = 'J'
     C     LSPRE         CABNE     'J'           ST21
     C                   ELSE
     C     LSPRE         CABEQ     'J'           ST21
     C                   END
     C                   END
     C                   END
     C                   END
     C  N94              END                                                    1<-E
      *
     C  N27XBATCH        IFNE      'J'
     C                   Z-ADD     ZRECNO        YRECNO
     C                   EXSR      TESTSE
     C                   END
      *
     C     ZRECNO        IFNE      0
     C     WXWNT0        IFGE      UWNT0
     C     XBATCH        OREQ      'J'
     C  N27UNTLK         IFEQ      1
     C     XWNT0D        ANDEQ     0
     C     XBATCH        OREQ      'J'
     C                   IF        WXWNT0 >= UWNT0
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C                   ELSE
     C                   Z-ADD     0             XN
     C                   END
     C                   MOVE      '1'           *IN23
     C                   GOTO      START5
     C                   END
     C                   MOVE      '1'           *IN27
     C                   ELSE
     C     XKUNSD        IFEQ      'J'
     C                   MOVE      'N'           XKUNSD
     C     XNYLIN        IFEQ      'J'
     C                   GOTO      START0
     C                   END
     C                   END
     C                   END
     C                   END
      *
     C     ZRECNO        IFEQ      0
     C                   MOVE      'DMK'         UTYPE
     C                   CALL      'LL019R'
     C                   PARM                    UGRP
     C                   PARM                    UPNR
     C                   PARM                    UANR
     C                   PARM                    UMN
     C                   PARM                    UVN
     C                   PARM                    UTYPE
     C                   IF        UWNT0 <> 0
     C                   IF        LVPLOK <> *BLANKS
     C                   Z-ADD     4             UFLAGG
     C                   ELSE
     C                   Z-ADD     2             UFLAGG
     C                   END
     C                   END
     C                   GOTO      SLUTT
     C                   ELSE
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C                   Z-ADD     1             ZRECNO
     C                   END
      *
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C                   WRITE     BUNN
     C                   EXFMT     SUBCTL
      *
     C                   MOVEA     '00'          *IN(30)
      *
     C   03
     COR 12              DO
      * FJERN MERKE PÅ ALLE GAMLE ALLOKERTE VARER
     C                   MOVE      'DMK'         UTYPE
     C                   CALL      'LL019R'
     C                   PARM                    UGRP
     C                   PARM                    UPNR
     C                   PARM                    UANR
     C                   PARM                    UMN
     C                   PARM                    UVN
     C                   PARM                    UTYPE
     C                   Z-ADD     1             UFLAGG
     C                   GOTO      SLUTT
     C                   END
      *** FRISK OPP
     C   05              DO
     C     XKUNSD        IFEQ      'N'
     C                   MOVE      'J'           XKUNSD
     C                   END
     C     XIKKEF        IFEQ      'J'
     C                   MOVE      '1'           *IN07
     C                   END
     C                   GOTO      START
     C                   END
      * RE-ALLOKER
     C   07              DO
     C     XKUNSD        IFEQ      'N'
     C                   MOVE      'J'           XKUNSD
     C                   END
     C                   GOTO      START
     C                   END
      * SKIFT MODUS
     C   10              DO
     C                   SELECT
     C                   WHEN      *IN40
     C                   MOVEA     '00'          *IN(40)
     C                   WHEN      *IN41
     C                   MOVEA     '10'          *IN(40)
     C                   OTHER
     C                   MOVEA     '01'          *IN(40)
     C                   ENDSL
     C                   GOTO      START
     C                   END
      *
     C                   EXSR      SRHENT
     C     *IN30         CABEQ     '1'           START3
     C     START5        TAG
     C     *IN23         IFEQ      '1'
     C                   EXSR      OPDLAG
     C                   ELSE
     C                   Z-ADD     1             ZRECNO
     C                   GOTO      START3
     C                   END
      *
     C     SLUTT         TAG
     C     XBATCH        IFEQ      'J'
     C                   IF        ((UWNT0 = 0) AND (UFLAGG = 0))
     C                   Z-ADD     2             UFLAGG
     C                   END
     C                   CLOSE     LL022D
     C                   END
     C                   SETON                                        LR
     C                   RETURN
      *
     C***********************************************
     C     HALLOK        BEGSR
     C***********************************************
      * HIGHLIGHTE POSTEN HVIS MODUS=VIS LAGERPOS OG BATCHNR FINNES
     C  N40
     CANN41VASENR        COMP      *BLANKS                            4242
      *
     C     *IN07         IFEQ      '0'                                          1<-B
     C                   MOVE      'N'           XNYLIN
      * HENT TIDLIGERE ALLOKERTE
     C     LLAF1K        SETLL     LLAGJD01                           33
     C     STHAL         TAG
     C     LLAF1K        READE     LLAGJD01                               33
      * VDMNL/VDVNL ER LINJENR TIL UTTAKSLINJE
     C  N33UMN           IFNE      VDMNL
     C     UVN           ORNE      VDVNL
     C                   GOTO      STHAL
     C                   END
     C     *IN33         IFEQ      '0'                                           2<-B
     C                   SUB       VDLANT        XWNT0D
     C                   ADD       VDLANT        XWNT0A
     C                   MOVE      VDLANT        WSWNT0
     C                   MOVE      VDSAE0        WSWNTL
     C                   MOVE      VDSAE1        WSWNT1
     C                   MOVE      VDSAE2        WSWNT2
     C                   MOVE      VDSAE3        WSWNT3
     C                   ELSE                                                    2
     C                   MOVE      *ZEROS        WSWNT0
     C                   MOVE      *ZEROS        WSWNTL
     C                   MOVE      *ZEROS        WSWNT1
     C                   MOVE      *ZEROS        WSWNT2
     C                   MOVE      *ZEROS        WSWNT3
     C                   END                                                     2<-E
     C                   ELSE                                                   1
     C     XWNT0D        IFEQ      0                                             2<-B
     C                   MOVE      *ZEROS        WSWNT0
     C                   MOVE      *ZEROS        WSWNTL
     C                   MOVE      *ZEROS        WSWNT1
     C                   MOVE      *ZEROS        WSWNT2
     C                   MOVE      *ZEROS        WSWNT3
     C                   ELSE                                                    2
      * ULOK<>BLANK --> BRUKER ØNSKER Å PLUKKE VARE FRA DENNE LOKASJON
     C     ULOK          IFEQ      *BLANKS                                        3<-B
     C     ULOK          OREQ      VALLOK
     C                   ADD       1             UNTLK
     C                   END                                                      3<-E
     C                   EXSR      HALLO2
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C                   SELECT
     C                   WHEN      *IN40
     C     LLMRFK        CHAIN     LLMRF                              33
     C                   IF        MRGN = *BLANKS
     C     HEADFK        CHAIN     HEADF                              33
     C  N33              EVAL      MRGN = HEGN
     C                   END
     C                   EVAL      XXTXT = MRGN
     C                   WHEN      *IN41
     C                   EVAL      XXTXT = VASENR
     C                   OTHER
     C                   EVAL      XXTXT = VALLOK
     C                   ENDSL
      *
     C                   ENDSR
      *
     C***********************************************
     C     HALLO2        BEGSR
     C***********************************************
     C     XWNT0D        IFLE      VASALD                                       1<-B
      * TEST OM MINST SALGSENHET
     C                   MOVE      *ZEROS        XWNT3
     C                   MOVE      *ZEROS        XWNT2
     C                   MOVE      *ZEROS        XWNT1
     C     VAAN03        IFNE      0                                             2<-B
     C     XWNT0D        DIV       VAAN03        XWNT3
     C                   MVR                     XWNT0D
     C                   END                                                     2<-E
     C     VAAN02        IFNE      0                                             2<-B
     C     VAMIN         ANDLE     2
     C     XWNT0D        DIV       VAAN02        XWNT2
     C                   MVR                     XWNT0D
     C                   END                                                     2<-E
     C     VAAN01        IFNE      0                                             2<-B
     C     VAMIN         ANDLE     1
     C     XWNT0D        DIV       VAAN01        XWNT1
     C                   MVR                     XWNT0D
     C                   END                                                     2<-E
      *
     C                   MULT      VAAN03        XWNT3
     C                   MULT      VAAN02        XWNT2
     C                   MULT      VAAN01        XWNT1
     C     XWNT3         ADD       XWNT2         WSWNT0
     C                   ADD       XWNT1         WSWNT0
     C                   ADD       XWNT0D        WSWNT0
     C                   ADD       WSWNT0        XWNT0A
     C                   MOVE      *ZEROS        XWNT0D
     C                   ELSE                                                   1
     C                   MOVE      VASALD        WSWNT0
     C                   SUB       VASALD        XWNT0D
     C                   ADD       VASALD        XWNT0A
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
     C***********************************************
     C     SRHENT        BEGSR
     C***********************************************
     C                   MOVE      *ZEROS        XWNT0A
     C                   MOVE      UWNT0         XWNT0D
     C     1             DO        YRECNO        ZRECNO                         1<-B
     C     ZRECNO        CHAIN     SUBFIL                             33
     C     WSWNT0        IFEQ      0                                             2<-B
     C     WSNR          ANDEQ     '1'
     C                   MOVE      VASALD        WSWNT0
     C                   MOVE      ' '           WSNR
     C                   ELSE                                                    2
     C     WSWNT0        IFGT      VASALD                                         3<-B
     C                   MOVE      'YBC0595'     MSGNR
     C                   MOVEA     '11'          *IN(30)
     C                   MOVE      *ZEROS        XWNT0A
     C                   UPDATE    SUBFIL
     C                   GOTO      SLHENT
     C                   ELSE                                                     3
     C     VAMIN         IFGT      0                                               4<-B
     C     WSWNT0        ANDGT     0
     C                   MOVE      WSWNT0        XWNT0
     C     VAAN03        IFNE      0                                                5<-B
     C     XWNT0         DIV       VAAN03        XWNT3
     C                   MVR                     XWNT0
     C                   END                                                        5<-E
     C     VAAN02        IFNE      0                                                5<-B
     C     VAMIN         ANDGE     2
     C     XWNT0         DIV       VAAN02        XWNT2
     C                   MVR                     XWNT0
     C                   END                                                        5<-E
     C     VAAN01        IFNE      0                                                5<-B
     C     VAMIN         ANDGE     1
     C     XWNT0         DIV       VAAN01        XWNT1
     C                   MVR                     XWNT0
     C                   END                                                        5<-E
     C     XWNT0         IFGT      0                                                5<-B
     C                   MOVE      'YBC0843'     MSGNR
     C                   MOVEA     '11'          *IN(30)
     C                   MOVE      *ZEROS        XWNT0A
     C                   UPDATE    SUBFIL
     C                   GOTO      SLHENT
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   UPDATE    SUBFIL
     C                   ADD       WSWNT0        XWNT0A
     C                   END                                                    1<-E
      *
     C     UWNT0         SUB       XWNT0A        XWNT0D
     C     XWNT0D        IFNE      0
     C                   Z-ADD     1             ZRECNO
     C                   MOVE      'YBC0596'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
      *
     C     SLHENT        ENDSR
      *
      ***********************************************
     C     TESTSE        BEGSR
      ***********************************************
     C     XBATCH        CABEQ     'J'           SLTSE
     C     1             DO        YRECNO        ZRECNO                         1<-B
     C     ZRECNO        CHAIN     SUBFIL                             33
     C     WSWNT0        IFGT      0                                             2<-B
     C                   SELECT                                                   3<-B
     C     VAMIN         WHENEQ    1
     C     WSWNT0        DIV       VAAN01        XWNTL             7 0
     C                   MVR                     XWNTL
     C     XWNTL         IFGT      0                                               4<-B
     C                   Z-ADD     3             UFLAGG
     C                   LEAVE
     C                   END                                                       4<-E
     C     VAMIN         WHENEQ    2
     C     WSWNT0        DIV       VAAN02        XWNTL
     C                   MVR                     XWNTL
     C     XWNTL         IFGT      0                                               4<-B
     C                   Z-ADD     3             UFLAGG
     C                   LEAVE
     C                   END                                                       4<-E
     C     VAMIN         WHENEQ    3
     C     WSWNT0        DIV       VAAN03        XWNTL
     C                   MVR                     XWNTL
     C     XWNTL         IFGT      0                                               4<-B
     C                   Z-ADD     3             UFLAGG
     C                   LEAVE
     C                   END                                                       4<-E
     C                   ENDSL                                                    3<-E
     C                   END                                                     2<-E
     C                   UPDATE    SUBFIL
     C                   ENDDO                                                  1<-E
      *
     C     UFLAGG        IFEQ      3
     C                   MOVE      'DMK'         UTYPE
     C                   CALL      'LL019R'
     C                   PARM                    UGRP
     C                   PARM                    UPNR
     C                   PARM                    UANR
     C                   PARM                    UMN
     C                   PARM                    UVN
     C                   PARM                    UTYPE
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END
     C                   Z-ADD     YRECNO        ZRECNO
      *
     C     SLTSE         ENDSR
      *
     C***********************************************
     C     OPDLAG        BEGSR
     C***********************************************
     C                   EXSR      TESTSE
      * SLETT ALLE GAMLE ALLOKERTE VARER
     C                   MOVE      'DLT'         UTYPE
     C                   CALL      'LL019R'
     C                   PARM                    UGRP
     C                   PARM                    UPNR
     C                   PARM                    UANR
     C                   PARM                    UMN
     C                   PARM                    UVN
     C                   PARM                    UTYPE
      *
     C     LLVARK        CHAIN(N)  LLVARE01                           33
      * OPPDATER PÅ LAGER
     C                   MOVE      UGRP          VDGRUP
     C                   MOVE      UPNR          VDKJED
     C                   MOVE      *BLANKS       ULOK
     C                   MOVE      *ZEROS        UNTLK
     C                   MOVE      *BLANKS       USENR
      *
     C     XBATCH        IFEQ      'J'                                          1<-B
     C                   Z-ADD     XN            YRECNO
     C                   MOVE      *ZEROS        UWNT0
     C                   END                                                    1<-E
     C     1             DO        YRECNO        ZRECNO                         1<-B
      *
     C     XBATCH        IFEQ      'J'                                           2<-B
     C                   Z-ADD     ZRECNO        XN
     C                   MOVE      ANT(XN)       WSWNT0
     C                   ADD       ANT(XN)       UWNT0
     C                   MOVE      AMN(XN)       VAMN
     C                   ELSE                                                    2
     C     ZRECNO        CHAIN     SUBFIL                             33
     C                   END                                                     2<-E
     C     WSWNT0        IFNE      0                                             2<-B
     C     LLAF1K        CHAIN     LLAGJL01                           34
     C     USENR         IFEQ      *BLANKS                                        3<-B
     C                   MOVE      VASENR        USENR
     C                   END                                                      3<-E
      *
      * FINNE SISTE BRUKTE LINJENR I LLAGJD
     C                   MOVE      VAMN          VDMN
     C                   Z-ADD     999           VDVN
     C     LLAD1K        SETLL     LLAGJD01
     C     LLAD2K        READPE    LLAGJD01                               34
     C   34              MOVE      *ZEROS        VDVN
     C                   ADD       1             VDVN
      * OPPDATER PÅ LINJE PÅ LAGER
     C                   MOVE      UMN           VDMNL
     C                   MOVE      UVN           VDVNL
     C                   MOVE      WSWNT0        VDLANT
      *
      * BEREGN ANDRE ALT. ENHETER
     C                   MOVE      WSWNT0        WSWNTL
      * ALT. 3
     C     VAAN03        IFNE      0                                              3<-B
     C     WSWNTL        DIV       VAAN03        WSWNT3
     C                   MVR                     WSWNTL
     C     WSWNT3        IFGT      VASAE3                                          4<-B
     C     WSWNT3        SUB       VASAE3        XNT05             7 0
     C                   MULT      VAAN03        XNT05
     C                   ADD       XNT05         WSWNTL
     C                   Z-ADD     VASAE3        WSWNT3
     C                   MOVE      *ZEROS        VASAE3
     C                   ELSE                                                      4
     C                   SUB       WSWNT3        VASAE3
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C     WSWNT3        MULT      VAVKT3        XWVEK
     C     WSWNT3        MULT      VAKUB3        XWKUB
      * ALT. 2
     C     VAAN02        IFNE      0                                              3<-B
     C     WSWNTL        DIV       VAAN02        WSWNT2
     C                   MVR                     WSWNTL
      *
     C     STOL01        TAG
     C     WSWNT2        IFGT      VASAE2                                          4<-B
     C     WSWNT2        MULT      VAAN02        XNT05
     C                   ADD       WSWNTL        XNT05
     C     VASAE2        MULT      VAAN02        XNT052            7 0
     C     VASAE1        MULT      VAAN01        XNT053            7 0
     C                   ADD       XNT053        XNT052
     C                   ADD       VASAE0        XNT052
     C     XNT05         IFGT      XNT052                                           5<-B
     C     VASAE3        ANDNE     0
     C                   SUB       1             VASAE3
     C                   ADD       VAAN23        VASAE2
     C                   GOTO      STOL01
     C                   END                                                        5<-E
      *
     C     WSWNT2        SUB       VASAE2        XNT05
     C                   MULT      VAAN02        XNT05
     C                   ADD       XNT05         WSWNTL
     C                   Z-ADD     VASAE2        WSWNT2
     C                   MOVE      *ZEROS        VASAE2
     C                   ELSE                                                      4
     C                   SUB       WSWNT2        VASAE2
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C     WSWNT2        MULT      VAVKT2        XWVEK2
     C     WSWNT2        MULT      VAKUB2        XWKUB2
     C                   ADD       XWVEK2        XWVEK
     C                   ADD       XWKUB2        XWKUB
      * ALT. 1
     C     VAAN01        IFNE      0                                              3<-B
     C     WSWNTL        DIV       VAAN01        WSWNT1
     C                   MVR                     WSWNTL
      *
     C     STOL02        TAG
     C     WSWNT1        IFGT      VASAE1                                          4<-B
     C     WSWNT1        MULT      VAAN01        XNT05
     C                   ADD       WSWNTL        XNT05
     C     VASAE1        MULT      VAAN01        XNT052
     C                   ADD       VASAE0        XNT052
     C     XNT05         IFGT      XNT052                                           5<-B
     C     VASAE2        IFEQ      0                                                 6<-B
     C     VASAE3        ANDNE     0
     C                   SUB       1             VASAE3
     C                   ADD       VAAN23        VASAE2
     C                   END                                                         6<-E
     C     VASAE2        IFNE      0                                                 6<-B
     C     VAAN12        IFEQ      0                                                  7<-B
     C                   ADD       VASAE2        VASAE1
     C                   MOVE      *ZEROS        VASAE2
     C                   ELSE                                                         7
     C                   SUB       1             VASAE2
     C                   ADD       VAAN12        VASAE1
     C                   END                                                          7<-E
     C                   GOTO      STOL02
     C                   END                                                         6<-E
     C                   END                                                        5<-E
      *
     C     WSWNT1        SUB       VASAE1        XNT05
     C                   MULT      VAAN01        XNT05
     C                   ADD       XNT05         WSWNTL
     C                   Z-ADD     VASAE1        WSWNT1
     C                   MOVE      *ZEROS        VASAE1
     C                   ELSE                                                      4
     C                   SUB       WSWNT1        VASAE1
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C     WSWNT1        MULT      VAVKT1        XWVEK2
     C     WSWNT1        MULT      VAKUB1        XWKUB2
     C                   ADD       XWVEK2        XWVEK
     C                   ADD       XWKUB2        XWKUB
      * LØSE STYKK
     C     STOL03        TAG
     C     WSWNTL        IFGT      VASAE0                                         3<-B
     C     VASAE1        IFEQ      0                                               4<-B
     C     VASAE2        IFEQ      0                                                5<-B
     C     VASAE3        ANDNE     0
     C                   SUB       1             VASAE3
     C                   ADD       VAAN23        VASAE2
     C                   END                                                        5<-E
     C     VASAE2        IFNE      0                                                5<-B
     C     VAAN12        IFEQ      0                                                 6<-B
     C                   ADD       VASAE2        VASAE1
     C                   MOVE      *ZEROS        VASAE2
     C                   ELSE                                                        6
     C                   SUB       1             VASAE2
     C                   ADD       VAAN12        VASAE1
     C                   END                                                         6<-E
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C     VASAE1        IFNE      0                                               4<-B
     C     VAAN01        IFEQ      0                                                5<-B
     C                   ADD       VASAE1        VASAE0
     C                   MOVE      *ZEROS        VASAE1
     C                   ELSE                                                       5
     C                   SUB       1             VASAE1
     C                   ADD       VAAN01        VASAE0
     C                   END                                                        5<-E
     C                   GOTO      STOL03
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C     WSWNTL        MULT      VAVKT0        XWVEK2
     C     WSWNTL        MULT      VAKUB0        XWKUB2
     C                   ADD       XWVEK2        XWVEK
     C                   ADD       XWKUB2        XWKUB
      *
     C                   SUB       WSWNTL        VASAE0
      *
     C                   MOVE      WSWNTL        VDSAE0
     C                   MOVE      WSWNT1        VDSAE1
     C                   MOVE      WSWNT2        VDSAE2
     C                   MOVE      WSWNT3        VDSAE3
     C                   MOVE      99999999      VDLDAT
     C                   MOVE      *ZEROS        VDDAGE
     C                   MOVE      *ZEROS        VDAVD
     C                   MOVE      *ZEROS        VDOPD
     C                   MOVE      *ZEROS        VDFBNR
     C                   MOVE      *BLANKS       VDTEXT
     C                   MOVEL     XTXT01        VDTEXT
     C                   CAT       XHPAK:1       VDTEXT
     C                   MOVE      LHALN         VDTEXT
     C                   MOVE      'PLIST'       VDLTYP
     C                   MOVE      UUSER         VDBUSE
     C                   TIME                    XTIME
     C                   MOVE      XDTD          VDBDD
     C                   MOVE      XDTM          VDBDM
     C                   MOVE      XDTÅ          VDBDÅ
     C                   MOVE      XTID          VDBKL
     C                   WRITE     LLAGJDR
      *
      * SLETT FOR MANGE PLUKKET SERIENR
     C                   MOVE      VDLANT        XANT              7 0
     C     LLSERL02K     SETLL     LLSERL02
     C     LLSERL02K     READE     LLSERL02                               33
     C                   DOW       *IN33 = *OFF
     C                   SUB       1             XANT
     C                   IF        XANT < 0
     C                   MOVE      *ZEROS        SNMNU
     C                   MOVE      *ZEROS        SNVNU
     C                   MOVE      *ZEROS        SNVNI
     C                   END
     C                   UPDATE    LLSERR
     C     LLSERL02K     READE     LLSERL02                               33
     C                   ENDDO
      *
     C                   ADD       WSWNTL        UWNTL
     C                   ADD       WSWNT1        UWNT1
     C                   ADD       WSWNT2        UWNT2
     C                   ADD       WSWNT3        UWNT3
     C                   ADD       XWVEK         UWVEK
     C                   ADD       XWKUB         UWKUB
      *
     C                   MOVE      ' '           VASTAT
     C     LLVARK        CHAIN     LLVARE01                           33
     C                   SUB       WSWNT0        LVSALD
     C                   UPDATE    LLVARER
     C                   SUB       WSWNT0        VASALD
     C                   UPDATE    LLAGJR
     C     ULOK          IFEQ      *BLANKS                                        3<-B
     C                   MOVE      VALLOK        ULOK
     C                   END                                                      3<-E
     C                   ADD       1             UNTLK
     C                   END                                                     2<-E
      *
     C                   END                                                    1<-E
      *
      * SLETT FOR MANGE PLUKKET SERIENR
     C     UMN           SETLL     LLSERL02
     C     UMN           READE     LLSERL02                               33
     C                   DOW       *IN33 = *OFF
     C     LLAGJD07K     CHAIN     LLAGJD07                           33
     C                   IF        *IN33
     C                   MOVE      *ZEROS        SNMNU
     C                   MOVE      *ZEROS        SNVNU
     C                   MOVE      *ZEROS        SNVNI
     C                   END
     C                   UPDATE    LLSERR
     C     UMN           READE     LLSERL02                               33
     C                   ENDDO
      *
      * BLANKE STATUS PÅ ALLOKERTE VARER
     C                   MOVE      'DM2'         UTYPE
     C                   CALL      'LL019R'
     C                   PARM                    UGRP
     C                   PARM                    UPNR
     C                   PARM                    UANR
     C                   PARM                    UMN
     C                   PARM                    UVN
     C                   PARM                    UTYPE
      *
     C                   ENDSR
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     *LIKE         DEFINE    VAGRUP        UGRP
     C     *LIKE         DEFINE    VAKJED        UPNR
     C     *LIKE         DEFINE    VAANR         UANR
     C     *LIKE         DEFINE    VASENR        USENR
     C     *LIKE         DEFINE    VALLOK        ULOK
     C     *LIKE         DEFINE    VDMNL         UMN
     C     *LIKE         DEFINE    VDVNL         UVN
     C     *LIKE         DEFINE    UWNT0         UWNTL
     C     *LIKE         DEFINE    VASAE1        UWNT1
     C     *LIKE         DEFINE    VASAE2        UWNT2
     C     *LIKE         DEFINE    VASAE3        UWNT3
     C     *LIKE         DEFINE    UWNT0         XWNT0
     C     *LIKE         DEFINE    UWNT0         XWNT1
     C     *LIKE         DEFINE    UWNT0         XWNT2
     C     *LIKE         DEFINE    UWNT0         XWNT3
     C     *LIKE         DEFINE    VAVKT0        UWVEK
     C     *LIKE         DEFINE    VAKUB0        UWKUB
     C     *LIKE         DEFINE    VAVKT0        XWVEK
     C     *LIKE         DEFINE    VAKUB0        XWKUB
     C     *LIKE         DEFINE    VAVKT0        XWVEK2
     C     *LIKE         DEFINE    VAKUB0        XWKUB2
     C     LLAF1K        KLIST
     C                   KFLD                    UGRP
     C                   KFLD                    UPNR
     C                   KFLD                    VAMN
     C     LLAF3K        KLIST
     C                   KFLD                    UGRP
     C                   KFLD                    UPNR
     C                   KFLD                    UANR
     C     LLAD1K        KLIST
     C                   KFLD                    UGRP
     C                   KFLD                    UPNR
     C                   KFLD                    VDMN
     C                   KFLD                    VDVN
     C     LLAD2K        KLIST
     C                   KFLD                    UGRP
     C                   KFLD                    UPNR
     C                   KFLD                    VDMN
     C     LLAGJD07K     KLIST
     C                   KFLD                    SNMNI
     C                   KFLD                    SNVNI
     C     LLSERL02K     KLIST
     C                   KFLD                    VDMNL
     C                   KFLD                    VDVNL
     C     LLVARK        KLIST
     C                   KFLD                    UGRP
     C                   KFLD                    UPNR
     C                   KFLD                    UANR
     C     LLMRFK        KLIST
     C                   KFLD                    UGRP
     C                   KFLD                    UPNR
     C                   KFLD                    VAMRNR
     C     HEADFK        KLIST
     C                   KFLD                    VAAVD
     C                   KFLD                    VAOPD
      *
     C     *ENTRY        PLIST
     C                   PARM                    UGRP
     C                   PARM                    UPNR
     C                   PARM                    UANR
     C                   PARM                    USENR
     C                   PARM                    UPRDT             8
     C                   PARM                    UMN
     C                   PARM                    UVN
     C                   PARM                    UWNT0
     C                   PARM                    UWNTL
     C                   PARM                    UWNT1
     C                   PARM                    UWNT2
     C                   PARM                    UWNT3
     C                   PARM                    UWVEK
     C                   PARM                    UWKUB
     C                   PARM                    ULOK
     C                   PARM                    UNTLK             3 0
     C                   PARM                    UFLAGG            1 0
      *
      * Hent kunderef 1 (kundens pakkseddelnr)
      * Denne legges på i fritekst ved (i LLAGJD) "ALLOKERT PAKKSEDDEL"
     C     UMN           CHAIN     LLHEAD                             33
s01  C*                  MOVE      LHPAK         XHPAK            10
n01  C                   MOVEL     LHPAK         XHPAK            12
     C     LLVARK        CHAIN(N)  LLVARE01                           33
     C                   IF        (*IN33 OR (LVPLS = ' '))
     C     UPNR          CHAIN     LLKUNF                             33
     C                   IF        *IN33
     C                   MOVE      'I'           XPLS              1
     C                   ELSE
     C                   MOVE      KFPRF         XPLS
     C                   END
     C                   ELSE
     C                   MOVE      LVPLS         XPLS
     C                   END
      *
     C                   MOVE      ULOK          XLOK
     C                   MOVE      UPRDT         XPRDT             8 0
     C                   MOVE      'J'           XNYLIN            1
      *
      * UFLAGG = 9  -->  LIK UFLAGG=0 OG BATCH
      * UFLAGG = 0  -->  IKKE F7 OG IKKE ALLOKERT FØR
      *                  *IN07 PÅ, *IN23 AV, *IN27 AV
      * UFLAGG = 1  -->  IKKE F7 OG TIDLIGERE ALLOKERT
      *                  *IN07 AV, *IN23 AV, *IN27 AV
      * UFLAGG = 2  -->  F7 FRA LL012R ER TASTET OG IKKE ALLOKERT FØR
      *                  *IN07 PÅ, *IN23 PÅ, *IN27 PÅ
      * UFLAGG = 3  -->  F7 FRA LL012R ER TASTET OG TIDLIGERE ALLOKERT
      *                  *IN07 AV, *IN23 PÅ, *IN27 PÅ
      * *IN07 PÅ  -->  RE-ALLOKER
      * *IN23 PÅ  -->  IKKE RE-ALLOKER
      * *IN27 PÅ  -->  VIS ALLOKERTE LAGERPOSISJONER UANSETT HVOR MANGE
     C                   SELECT
     C     UFLAGG        WHENEQ    0
     C     UFLAGG        OREQ      9
     C     UFLAGG        IFEQ      9
     C                   MOVE      'J'           XBATCH            1
     C                   END
     C                   MOVE      '1'           *IN07
     C                   MOVE      'J'           XIKKEF            1
     C                   MOVE      '0'           *IN23
     C                   MOVE      '0'           *IN27
     C     XLOK1         IFNE      *BLANKS
     C     XLOK2         ANDEQ     *BLANKS
      * KUN PLUKKE ARTIKKEL FRA ETT LAGERSTED
     C                   MOVE      'J'           XKUNSD            1
     C                   MOVE      *BLANKS       ULOK
     C                   END
     C     UFLAGG        WHENEQ    1
     C                   MOVE      '0'           *IN07
     C                   MOVE      '0'           *IN23
     C                   MOVE      '0'           *IN27
     C                   MOVE      'J'           XALOC             1
     C     UFLAGG        WHENEQ    2
     C                   MOVE      '1'           *IN07
     C                   MOVE      'J'           XIKKEF            1
     C                   MOVE      '1'           *IN23
     C                   MOVE      '1'           *IN23
     C                   MOVE      '1'           *IN27
     C     XLOK1         IFNE      *BLANKS
     C     XLOK2         ANDEQ     *BLANKS
      * KUN PLUKKE ARTIKKEL FRA ETT LAGERSTED
     C                   MOVE      'J'           XKUNSD
     C                   MOVE      *BLANKS       ULOK
     C                   END
     C     UFLAGG        WHENEQ    3
     C                   MOVE      '0'           *IN07
     C                   MOVE      '1'           *IN23
     C                   MOVE      '1'           *IN27
     C                   MOVE      'J'           XALOC
     C                   ENDSL
      *
     C                   MOVE      *ZEROS        UFLAGG
     C                   MOVE      *ZEROS        UWNTL
     C                   MOVE      *ZEROS        UWNT1
     C                   MOVE      *ZEROS        UWNT2
     C                   MOVE      *ZEROS        UWNT3
     C                   MOVE      *ZEROS        UWVEK
     C                   MOVE      *ZEROS        UWKUB
     C     XBATCH        IFNE      'J'
     C                   OPEN      LL022D
     C                   WRITE     WINDOWSZ
     C                   END
      *
     C                   ENDSR
      *
