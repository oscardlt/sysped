TMP   * Test ikke send LK ved  1/91576
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 SLUTT DATO PÅ TOLLTARIFF
10XXX * 02 YBC PTF10 SYSPEDREF
10XXX * 03 YBC PTF10 JUSTERINGSBELØP
10XXX * 04 YBC PTF10 GRENSE FOR AVGIFT ER FRA OG MED 50
10XXX * 05 YBC PTF10 IKKE OPPDATER MVA VED LAVVERDI SENDING
10XXX * 06 YBC PTF10 LAV VERDI IMP. VIN MED UTB OG TR.TYPE=1
10214 * 07 YBC PTF10 IKKE SEND "SER" VED PREFERANSE = J/N
10XXX * 08 YBC PTF10 SJEKK FAKTURASUM PÅ 200,00
10XXX * 09 YBC PTF10 PROSEDYRE 49 BEHANDLES SAMME SOM 64-66
10262 * 10 YBC PTF10 SATS ER UTVIDERT TIL 7.2
10XXX * 11 YBC PTF10 FLYTT SVFT PÅ RIKTIG MÅTE
10286 * 12 YBC PTF10 VEKT ER ENDRET FRA 9.0 TIL 12.3
      *              VAREBESKRIVELSE ER ØKT FRA 15A TIL 30A
10XXX * 13 YBC PTF10 PROBLEM MED DOBBEL ØREAVRUNDING
10329 * 14 YBC PTF10 MENGDE I ANNEN ENHET ER ENDRET FRA 7.0 TIL 9.0
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11XXX * 15 YBC PTF11 TEST HELTALL PÅ 50-KR GRENSE
11016 * 16 YBC PTF11 OMBEREGNING
11XXX * 17 YBC PTF11 FEILRETTING PÅ ENDRING 06, ALKOHOL MÅ ALLTID BETALE MVA
11XXX * 18 YBC PTF11 UTVIDER 22 AVGIFTER PÅ TOTAL
11XXX * 19 YBC PTF11 BEREGN AVGIFT ALLTID PÅ NYTT
11XXX * 20 YBC PTF11 SEND FLERE DCR HVIS SIFT4 FYLLES MER ENN 17 TEGN
11XXX * 21 YBC PTF11 HELTALL PÅ GRUNNALG TIL AVGIFTER
11XXX * 22 SH  PTF11 200->350
11XXX * 23 YBC PTF11 RETTELSE PÅ ENDRING 22. OMBEREGNING KAN HA EN TIDLIG DATO
11XXX * 24 YBC PTF11 VIDERE ENDRING PÅ ENDRING 21
11XXX * 25 YBC PTF11 ENDRING 22. TIL OG MED KR 350, IKKE TIL 350
11XXX * 26 YBC PTF11 TEST DATO MOT OPPRINNELIG SENDINGSDATO
11XXX * 27 YBC PTF11 MELDINGS DATO HENTES FRA EDIM
11101 * 28 YBC PTF11 5. LINJE FOR BEGRUNNELSE AV OMBEREGING
11XXX * 29 YBC PTF11 TILLAT DESIMAL VED TL PÅ AVGIFTSFELT
11XXX * 30 YBC PTF11 ENDRING 25 TREKKES TILBAKE. MED MVA FRA OG MED KR 350
11XXX * 31 YBC PTF11 AVGIFTSGRUNNLAG MED DESIMALER
11174 * 32 YBC PTF11 TILLEGGSLINJER MED SAMME POST
11XXX * 33 YBC PTF11 PROSEDYRE 49 -> SÆRBEHANDLING
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
12001 * 34 YBC PTF12 MVA FRA OG MED 01.01.2017
12XXX * 35 YBC PTF12 GLEMT ETTER SAMSLÅING AV VARELINJER
12024 * 36 YBC PTF12 BEARBEIDINGSKOSTNAD SKAL VÆRE GRUNNLAG FOR TOLL
      *              NÅR DET ER VERDI FORTOLLING
12XXX * 37 YBC PTF12 IKKE SUMMERE SLETTET LINJE VED OMBEREGNING
12XXX * 38 YBC PTF12 ALKOHOLD, TOTAL AVG < 50, UTB OG MVA-REGISTRERT --> TOTAL AVG. SENDES
12053 * 39 YBC PTF12 FLERE FELTER ER ENDRET LENGDE
12056 * 40 YBC PTF12 FRA 01.04.2017 GODTAR TVINN BLANK PÅ BETALINGSKODE
12080 * 41 YBC PTF12 ALLE NYE LINJER FRA OMBEREGNING SKAL IKKE SLÅ SAMME
12XXX * 42 YBC PTF12 HENT/SEND CONTAINER FRA BL
12XXX * 43 YBC PTF12 Sett M på betalingskode ved motorvogn fortolling
12XXX * 44 YBC PTF12 IKKE ALKOHOLD/TOBAKK -> IKKE SEND TOTAL AVG. VED MINDRE ENN 50 KR
12XXX * 45 YBC PTF12 TILLEGG ENDRING PÅ ENDRING 40 PGA. TIDLIGERE FORTOLLING
12XXX * 46 YBC PTF12 SEND TALL 0 PÅ TAX+3, IKKE INGENTING
12XXX * 47 YBC PTF12 PROSEDYRE 76 ENDRES TIL 77 VED OPPRINNELSESLAND<>NO
12XXX * 48 YBC PTF12 BEREGN STATISTISK VERDI
12117 * 49 YBC PTF12 Bevare betalekode i SIKDH slik at koden kan hentes ved omberegning
12124 * 50 YBC PTF12 Send 0 i total kolli når alle linjene er slettet ved OMB
12108 * 51 YBC PTF12 Prosedyre på linje-nivå
12XXX * 52 YBC PTF12 RETTELSE PÅ ENDRING 38
12XXX * 53 YBC PTF12 Rettelse på endring 48. Omberegningsfaktor
12160 * 54 YBC PTF12 Rett feil ved 50 kr grense og alkohold/tobakk med
12162 * 55 YBC PTF12 Brukt oppgitt betalekode når opprinnelig M og omb. med tollkredit = 0
12XXX * 56 YBC PTF12 Sum av avgift må også gange med 20% ved prosedyre 49
12XXX * 57 TH  PTF12 enhetskode ligger nå i tariffen
12167 * 58 YBC PTF12 Enhetskode til særavgift
12184 * 59 YBC PTF12 Containernr sendes på egen måte fra 01.05.2019
12XXX * 60 YBC PTF12 Feil lengde på beløp ved bearbeiding. Rettelse på endring 39.
12199 * 61 YBC PTF12 Feil i omberegning. Linje blir ikke sendt ved første sammenslåtte
      *              er slettet og minst en av sammenslåtte linje ikke er slettet.
12200 * 62 YBC PTF12 CONTAINER ER I EGEN FIL
12160 * 63 YBC PTF12 Rettelse på endring 54
12207 * 64 YBC PTF12 350-kr grense fjernes for næringsmiddel import (både næringsliv og privat)
      *              50-kr grense fjernes KUN for privat med næringsmiddel
12XXX * 65 YBC PTF12 Test TO/BV på feil sted
12165 * 66 CB  Send status til CW1
12222 * 67 YBC PTF12 SYSPEDREF sendes ikke på omberegning hvis oppdrag er fortollet av andre
12223 * 68 YBC PTF12 Containernr i egen fil
12228 * 69 YBC PTF12 350-kronegrense fjernes for firmakunde fra og med 01.04.2020
12XXX * 70 YBC PTF12 Hent godkjenningsdato for omberegning
12232 * 71 YBC PTF12 Ved +/- frakt/andre kostnad er det KUN forsikring med justering
12XXX * 72 YBC PTF12 Hent meldingsdato KUN fra import (hvis nummerteller krysser)
12XXX * 73 YBC PTF12 Privat må også betale toll ved alkohol/tobakk selv om < 50 kr
12XXX * 74 YBC PTF12 Ikke les slettet linje på omberegning
12XXX * 75 YBC PTF12 Oppdater linjenr på omberegning pga. container
12238 * 76 YBC PTF12 Alkohol med 0 i sats
12XXX * 77 YBC PTF12 Alkohold skal ikke benytte 50-grense
12241 * 78 YBC PTF12 Endring 42 fjernes pga. containernr hentes i SAD061A og SAD061U
12XXX * 79 YBC PTF12 Rett feil i endring 50
12250 * 80 YBC PTF12 Takler midlertidig reg.nr/personnr på 10 siffer
12XXX * 81 YBC PTF12 Oppdaterer SVLN med SVLI hvis SVLN = 0
12XXX * 82 YBC PTF12 Avgift OL er alkohold avgift
12251 * 83 YBC PTF12 Endring fra midlertidig innførsel til ordinær
12252 * 84 YBC PTF12 Ny deklarasjonskategori SF for samlefortolling
12263 * 85 YBC PTF12 Send betalekode M ved omberegning (original D)
12XXX * 86 YBC PTF12 Rett feil i endring 74. SVPREÆ er fra neste linje. Test WFITRP.
12270 * 87 YBC PTF12 Ved DEN skal FOR og dokument i SIFT3 sendes på hver linje.
12XXX * 88 YBC PTF12 Reservert til OMB motorvogn
12281 * 89 YBC PTF12 4 SIFFER PROSEDYRE OG 2 SIFFER TRANSAKSJONSTYPE
12285 * 90 YBC PTF12 Rettelse på endring 89
12291 * 91 YBC PTF12 Kunst fortolling som tidligere 49
12XXX * 92 YBC PTF12 WFIPRO ble hentet fra feil variabel
12XXX * 93 YBC PTF12 Feilretting på endring 64. Ikke sett J på X_TOLLAVG ved 0098 (stat.opprett.)
12296 * 94 YBC PTF12 TL/RT med momsgrunnlag selv om TL/RT settes til 0 ved total TL/RT+MV < 50 kr
12315 * 95 CB  PTF12 Feil ved oppdatering av EDIMC, ikke chainet, lagt inn chain
********************************************************************
      *****************************************************************
      *** PROGRAM SKAL LAGE EDI-FACT FILE FOR IMPORT                ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER          ***
      *** LEDIGE INDIKATORER 01-26                                  ***
      *** LEDIGE INDIKATORER 27-32 35-37 39 40 44-50 54-80 84-89    ***
      ***                    91 95-99
      *****************************************************************
     FEDIS      UF   E           K DISK
     FEDIMC     UF   E           K DISK
     FEDIM4     IF   E           K DISK    RENAME(EDIMR:EDIMR4)
N67  FEDIM2     IF   E           K DISK    RENAME(EDIMR:EDIMR2)
N67  F                                     PREFIX(M2_)
N95  FEDIM      UF   E           K DISK    RENAME(EDIMR:EDIMRX)
N95  F                                     PREFIX(MX_)
     FSADH      UF   E           K DISK
N83  FSADHMO    IF   E           K DISK
N16  FSADHOM    IF   E           K DISK    RENAME(SADHR:SADHROM)
     FSADV2     UF   E           K DISK
S75  F*SADV4     IF   E           K DISK    RENAME(SADVR:SADV4R)
N75  FSADV4     UF   E           K DISK    RENAME(SADVR:SADV4R)
     FSADVJ     IF   E           K DISK
N43  FSADVAVG   IF   E           K DISK    PREFIX(AV_)
     FSADSD     IF   E           K DISK
     FWFILEIMP  UF A E           K DISK
     FSADW      IF   E           K DISK
     FEDIJ2     IF   E           K DISK
     FSADF      IF   E           K DISK
S48  F*KODTVA    IF   E           K DISK
N48  FKODTVAL2  IF   E           K DISK
     FKODTS2    IF   E           K DISK
     FKODTS8    IF   E           K DISK
N64  FKODTSN    IF   E           K DISK
N92  FKODTLB    IF   E           K DISK
     FSYPTFF    IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FKODTA     IF   E           K DISK
     FFIRM      IF   E           K DISK
     FTARI      IF   E           K DISK
N12  FSOKTARI2  IF   E           K DISK
     FEDII      IF   E           K DISK
     FEDISE     O  A E             DISK
N66  FHEADF     UF   E           K DISK
N66  FFRISOK    IF   E           K DISK
     D Y1              S              2    DIM(24)                              Avg.type
     D E1              S              3    DIM(24)                              Avg.SEKVENSE
E39  D G1              S             13  2 DIM(24)                              Avg.grunnlag
     D S1              S              7  2 DIM(24)                              Avg.sats
     D P1              S              1    DIM(24)                              Avg.type.sats
E39  D B1              S             11  0 DIM(24)                              Beløp
     D TR              S              2    DIM(24)                              Havnekode
S18  D*T1              S              2    DIM(20)
S18  D*T2              S              9  0 DIM(20)
S18  D*T3              S              2    DIM(20)
N18  D T1              S              2    DIM(40)
E39  D T2              S             11  0 DIM(40)
N18  D T3              S              2    DIM(40)
S78  D*MN              S             17    DIM(20)
S78  D*VS              S             25    DIM(20)
      *____________________
      * DS for BILFORTOLL  NUMERISK EDIT
      *""""""""""""""""""""
N62  D                 DS
N62  D  CNR50                  1    850
N62  D  CNR                    1    850    DIM(50)
     D                 DS
     D  BN                     1      6
     D                                     DIM(6)
     D  BILNUM                 1      6
      *____________________
      * DS for input string
      *""""""""""""""""""""
     D                 DS
     D  A                      1     70
     D                                     DIM(70)                              Input string
     D  ADS                    1     70
      *_____________________
      * DS for output string
      *"""""""""""""""""""""
     D                 DS
     D  B                      1     80
     D                                     DIM(80)                              Output string
     D  SDATA                  1     80
      *________________________________________
      * DS for å venstrestille numeriske felter
      *""""""""""""""""""""""""""""""""""""""""
     D                 DS
     D  ØN152                  1     15  2
     D  ØA152H                 1     13
     D  ØA152X                 5     13
     D  ØA152D                14     15
     D                 DS
     D  ØA12                   1     12
     D  Ø12                    1     12
     D                                     DIM(12)                              Num edit
N13  D                 DS
N13  D  KS8FTX                 1     52
N13  D  KS8MIL                52     52
N13  D  KS8ØRE                51     51
      *__________________
      * DS for Godsnummer
      *""""""""""""""""""
     D                 DS
     D  SIG014                 1      4
     D  SIG615                 6     15
     D  SIGN                   1     15
     D  SIGN91                 5      5
     D  SIGN9B                 6      6
     D  SIGN92                 5      6
     D  SIGN99                13     13
     D  SIGN71                 7      7
      *_________________
      * DS for FOReløbig
      *"""""""""""""""""
     D                 DS
     D  SIAVD                  1      4  0
     D  XSTREK                 5      5
     D  SITDN                  6     12  0
     D  XREF                   1     12
     D                 DS
     D  SIFT3                  1     45
     D  XFT3KD                 1      3
     D  XFT3VN                 5     12
     D  XFT3DK                14     45
     D  XFT3                   5     45
     D                 DS
     D  SIFT4                  1     45
     D  XFT4KD                 1      3
     D  XFT4                   5     45
     D                 DS
     D  WFIRNR                 1      5  0
     D  XN2                    2      5  0
N12  D                 DS
N12  D  WFIVKB                 1      9  0
N12  D  WFIVKB123              1     12  3
N12  D                 DS
N12  D  WFIVKN                 1      9  0
N12  D  WFIVKN123              1     12  3
     D                 DS
     D  WFITY1                 1      2
     D  WFITY2                 3      4
     D  WFITY3                 5      6
     D  WFITY4                 7      8
     D  WFITY5                 9     10
     D  WFITY6                11     12
     D  Y2                     1     14
     D                                     DIM(7)
     D                 DS
     D  WFISK1                 1      3
     D  WFISK2                 4      6
     D  WFISK3                 7      9
     D  WFISK4                10     12
     D  WFISK5                13     15
     D  WFISK6                16     18
     D  E2                     1     21
     D                                     DIM(7)
     D                 DS
E39  D  WFIGL1                 1     13  2
E39  D  WFIGL2                14     26  2
E39  D  WFIGL3                27     39  2
E39  D  WFIGL4                40     52  2
E39  D  WFIGL5                53     65  2
E39  D  WFIGL6                66     78  2
E39  D  G2                     1     91  2 DIM(7)
     D                 DS
     D  WFIST1                 1      7  2
     D  WFIST2                 8     14  2
     D  WFIST3                15     21  2
     D  WFIST4                22     28  2
     D  WFIST5                29     35  2
     D  WFIST6                36     42  2
     D  S2                     1     49  2 DIM(7)
     D                 DS
     D  WFIPR1                 1      1
     D  WFIPR2                 2      2
     D  WFIPR3                 3      3
     D  WFIPR4                 4      4
     D  WFIPR5                 5      5
     D  WFIPR6                 6      6
     D  P2                     1      7    DIM(7)
     D                 DS
E39  D  WFIBL1                 1     13  2
E39  D  WFIBL2                14     26  2
E39  D  WFIBL3                27     39  2
E39  D  WFIBL4                40     52  2
E39  D  WFIBL5                53     65  2
E39  D  WFIBL6                66     78  2
E39  D  B2                     1     91  2 DIM(7)
      * ARRAY MED SÆRAVGIFTER BILFORTOLLING
      * SWWTY1 = BEREGNET "MO" AVGIFT - SKAL IKKE SENDES (01.04.2001)
      * ØVRIGE AVGIFTER "RYKKER 1 PLASS OPP" UTEN YTTERLIGERE MERKING
      * 5. AVG.LINJE BLANKES
     D                 DS
     D  SWWTY2                 1      2
     D  SWWTY3                 3      4
     D  SWWTY4                 5      6
     D  SWWTY5                 7      8
     D  XXWTY5                 9     10
     D  Y2W                    1     10    DIM(5)
     D                 DS
     D  SWWSK2                 1      3
     D  SWWSK3                 4      6
     D  SWWSK4                 7      9
     D  SWWSK5                10     12
     D  XXWSK5                13     15
     D  E2W                    1     15    DIM(5)
     D                 DS
     D  SWWGL2                 1      9  2
     D  SWWGL3                10     18  2
     D  SWWGL4                19     27  2
     D  SWWGL5                28     36  2
     D  XXWGL5                37     45  2
     D  G2W                    1     45  2 DIM(5)
     D                 DS
     D  SWWST2                 1      7  2
     D  SWWST3                 8     14  2
     D  SWWST4                15     21  2
     D  SWWST5                22     28  2
     D  XXWST5                29     35  2
     D  S2W                    1     35  2 DIM(5)
     D                 DS
     D  SWWPR2                 1      1
     D  SWWPR3                 2      2
     D  SWWPR4                 3      3
     D  SWWPR5                 4      4
     D  XXWPR5                 5      5
     D  P2W                    1      5    DIM(5)
     D                 DS
     D  SWWBL2                 1      7  0
     D  SWWBL3                 8     14  0
     D  SWWBL4                15     21  0
     D  SWWBL5                22     28  0
     D  XXWBL5                29     35  0
     D  B2W                    1     35  0 DIM(5)
      *
     D                 DS
S12  D* WFIKN1                 1     17
S12  D* WFIKN2                18     34
S12  D* WFIKN3                35     51
S12  D* WFIKN4                52     68
S12  D* WFIKN5                69     85
S12  D* WFIKN6                86    102
S12  D* WFIKN7               103    119
S12  D* KN                     1    119    DIM(7) ASCEND                        Merke & nummer
N12  D  WFIKN1                 1     28
N12  D  WFIKN2                29     56
N12  D  WFIKN3                57     84
N12  D  WFIKN4                85    112
N12  D  WFIKN5               113    140
N12  D  WFIKN6               141    168
N12  D  WFIKN7               169    196
N12  D  KN                     1    196    DIM(7) ASCEND                        Merke & nummer
     D                 DS
S12  D* WFIVB1                 1     15
S12  D* WFIVB2                16     30
S12  D* WFIVB3                31     45
S12  D* WFIVB4                46     60
S12  D* WFIVB5                61     75
S12  D* WFIVB6                76     90
S12  D* WFIVB7                91    105
S12  D* VB                     1    105
S12  D*                                    DIM(7) ASCEND                        Varebeskr
N12  D  WFIVB1                 1     30
N12  D  WFIVB2                31     60
N12  D  WFIVB3                61     90
N12  D  WFIVB4                91    120
N12  D  WFIVB5               121    150
N12  D* WFIVB6               151    180
N12  D* WFIVB7               181    210
N12  D  VB                     1    210    DIM(7) ASCEND                        Varebeskr
     D                 DS
     D  WFITO1                 1     45
     D  WFITO2                46     90
     D  WFITO3                91    135
     D  WFITO4               136    180
     D  WFITO5               181    225
N12  D  WFITO6               226    270
N12  D  WFITO7               271    315
N12  D  WFITO8               316    360
N12  D  WFITO9               361    405
N12  D  WFITO10              406    450
N12  D  WFITO11              451    495
N12  D  WFITO12              496    540
N12  D  WFITO13              541    585
N12  D  WFITO14              586    630
N12  D  WFITO15              631    675
S12  D* TO                     1    225    DIM(5)                               Til.opl
N12  D  TO                     1    675    DIM(15)                              Til.opl
     D                 DS
     D  WFITC1                 1      3
     D  WFITC2                 4      6
     D  WFITC3                 7      9
     D  WFITC4                10     12
     D  WFITC5                13     15
N12  D  WFITC6                16     18
N12  D  WFITC7                19     21
N12  D  WFITC8                22     24
N12  D  WFITC9                25     27
N12  D  WFITC10               28     30
N12  D  WFITC11               31     33
N12  D  WFITC12               34     36
N12  D  WFITC13               37     39
N12  D  WFITC14               40     42
N12  D  WFITC15               43     45
S12  D* TC                     1     15    DIM(5)                               Cref ved komm.
N12  D  TC                     1     45    DIM(15)                              Cref ved komm.
     D                 DS
     D  XDP1                   1      1  0
     D  SIDP                   1      2  0
N89  D  SIDP2                  3      4  0
N89  D  SIDP_4                 1      4  0
N89  D                 DS
N89  D  WFIDP                  1      2  0
N89  D  WFIDP2                 3      4  0
N89  D  WFIDP_4                1      4  0
     D                 DS
E39  D  WFITOL                 1     11  0
E39  D  XWFTOL                 1     13  2
     D                 DS
E39  D  WFITLG                 1     11  0
E39  D  XWFTLG                 1     13  2
     D                 DS
     D  WFISTB                 1     13  0
     D  XWFSTB                 1     15  2
     D                 DS
     D  SVVNT                  1      8  0
     D  SVLK                   9     10
     D  SVTN                  11     11
     D  SVPRE                 12     12
S10  D* SVAS                  13     17  2
S10  D* SVPVA                 18     18
S10  D* SVMFR                 19     19
S10  D* SVVF                  20     20
S10  D* XBRUD1                 1     20
N10  D  SVAS                  13     19  2
N10  D  SVPVA                 20     20
N10  D  SVMFR                 21     21
N10  D  SVVF                  22     22
S51  D* XBRUD1                 1     22
N51  D  SVDP                  23     24  0
N89  D  SVDP2                 25     26  0
N91  D  SVDP_4                23     26  0
S89  D* XBRUD1                 1     24
N89  D  XBRUD1                 1     26
     D                 DS
     D  SITRT                  1      7  0
     D  SITRT1                 1      1  0
     D  SIDFVF                 2      2  0
N91  D  SIKUNS                 3      3  0
     D                 DS
     D  SVTOA                  1     22
     D  SVTOB                 23     45
     D  XTOPP                  1     45
     D                 DS
     D  SWTX1A                 1      6  1
     D  SWVK15                 1      5
     D  SWVK25                 2      5
     D  SWVK66                 6      6
     D                 DS
     D  SWTX2A                 1      6  2
     D  SWEF14                 1      4
     D  SWEF24                 2      4
     D  SWEF56                 5      6
     D  SWEF55                 5      5
     D  SWEF66                 6      6
     D                 DS
     D  DSFTXV                 1     26
     D  DSV                    1      1
     D  DSTX1A                 3      8
     D  DSTX1B                10     15
     D  SWTX1C                17     26
     D                 DS
     D  DSFTXE                 1     26
     D  DSE                    1      1
     D  DSTX2A                 3      8
     D  DSTX2B                10     15
     D  SWTX2C                17     26
     D                 DS
     D  DSFTXK                 1     26
     D  DSK                    1      1
     D  DSTX3A                 3      8
     D  DSTX3B                10     15
      *MIDLERTIDIG...
     D                 DS
     D  DSPCIC                 1     26
     D  DSC                    1      1
     D  DSPC1A                 3      8
     D  DSPC1B                10     15
     D  SWPC1C                17     17
     D  SWPC1D                19     20
     D                 DS
     D  DSPCI                  1     26
     D  DSPROS                 1      6
     D  DSPROT                 8      8
     D  DSPC2B                10     15
     D  DSPC2C                21     26
     D                 DS
     D  SYRG                   1     14
     D  SYFORE                 1      9
N16  D                 DS
N16  D  SIFT01                 1     70
N16  D  SIFT02                71    140
N16  D  SIFT03               141    210
N16  D  SIFT04               211    280
N28  D  SIFT05               281    350
S28  D* FT0                    1    280    DIM(4)
N28  D  FT0                    1    350    DIM(5)
N83  D                 DS
N83  D  SITXT1                 1     70
N83  D  SITXT2                71    140
N83  D  SITXT3               141    210
N83  D  SITXT4               211    280
N83  D  SITXT5               281    350
N83  D  FT0MO                  1    350    DIM(5)
     D                 DS
     D  SVAKD1                 1      2
     D  SVAKD2                 3      4
     D  SVAKD3                 5      6
     D  SVAKD4                 7      8
     D  SVAKD5                 9     10
     D  SVAKD6                11     12
     D  SVAKD7                13     14
     D  SVAKD8                15     16
     D  SVAKD                  1     16    DIM(8)
     D                 DS
     D  SVASV1                 1      3
     D  SVASV2                 4      6
     D  SVASV3                 7      9
     D  SVASV4                10     12
     D  SVASV5                13     15
     D  SVASV6                16     18
     D  SVASV7                19     21
     D  SVASV8                22     24
     D  SVASV                  1     24    DIM(8)
     D                 DS
     D  SVASA1                 1      7  2
     D  SVASA2                 8     14  2
     D  SVASA3                15     21  2
     D  SVASA4                22     28  2
     D  SVASA5                29     35  2
     D  SVASA6                36     42  2
     D  SVASA7                43     49  2
     D  SVASA8                50     56  2
     D  SVASA                  1     56  2 DIM(8)
     D                 DS
E39  D  SVAGR1                 1     13  2
E39  D  SVAGR2                14     26  2
E39  D  SVAGR3                27     39  2
E39  D  SVAGR4                40     52  2
E39  D  SVAGR5                53     65  2
E39  D  SVAGR6                66     78  2
E39  D  SVAGR7                79     91  2
E39  D  SVAGR8                92    104  2
E39  D  SVAGR                  1    104  2 DIM(8)
     D                 DS
E39  D  SVABL1                 1     13  2
E39  D  SVABL2                14     26  2
E39  D  SVABL3                27     39  2
E39  D  SVABL4                40     52  2
E39  D  SVABL5                53     65  2
E39  D  SVABL6                66     78  2
E39  D  SVABL7                79     91  2
E39  D  SVABL8                92    104  2
E39  D  SVABL                  1    104  2 DIM(8)
     D                 DS
     D  SVEH21                 1      1
     D  SVEH22                 2      2
     D  SVEH23                 3      3
     D  SVEH24                 4      4
     D  SVEH25                 5      5
     D  SVEH26                 6      6
     D  SVEH27                 7      7
     D  SVEH28                 8      8
     D  SVEH2                  1      8    DIM(8)
     D                 DS
     D  SVFT01                 1     28
     D  SVFT02                29     56
     D  SVFT03                57     84
     D  SVFT04                85    112
     D  SVFT05               113    140
     D  SVFT06               141    168
     D  SVFT07               169    196
     D  SVFT                   1    224    DIM(8)
     D                 DS
     D  SVNT01                 1      6  0
     D  SVNT02                 7     12  0
     D  SVNT03                13     18  0
     D  SVNT04                19     24  0
     D  SVNT05                25     30  0
     D  SVNT06                31     36  0
     D  SVNT07                37     42  0
     D  SVNT                   1     48  0 DIM(8)
     D                 DS
     D  SVEH01                 1      4
     D  SVEH02                 5      8
     D  SVEH03                 9     12
     D  SVEH04                13     16
     D  SVEH05                17     20
     D  SVEH06                21     24
     D  SVEH07                25     28
     D  SVEH                   1     32    DIM(8)
     D                 DS
     D  SVVT01                 1     30
     D  SVVT02                31     60
     D  SVVT03                61     90
     D  SVVT04                91    120
     D  SVVT05               121    150
     D  SVVT                   1    240    DIM(8)
     D                 DS
     D  SVTOP1                 1     17
     D  SVTOP2                18     34
     D  SVTOP3                35     51
     D  SVTOP4                52     68
     D  SVTOP5                69     85
     D  SVTOP6                86    102
     D  SVTOP7               103    119
     D  SVTOP8               120    136
     D  SVTOP9               137    153
     D  SVTOP10              154    170
     D  SVTOP                  1    187    DIM(11)
     D                 DS
     D  SVCRE1                 1      3
     D  SVCRE2                 4      6
     D  SVCRE3                 7      9
     D  SVCRE4                10     12
     D  SVCRE5                13     15
     D  SVCRE6                16     18
     D  SVCRE7                19     21
     D  SVCRE8                22     24
     D  SVCRE9                25     27
     D  SVCRE10               28     30
     D  SVTCR                  1     33    DIM(11)
     IEDIMR4
     I              M0004                       N0004
     I              M0010                       N0010
     I              M0035                       N0035
     I              M0062                       N0062
     I              M0065                       N0065
     I              M0068                       N0068
     I              M0068A                      N0068A
     I              M0068B                      N0068B
     I              M0068C                      N0068C
     I              M0068D                      N0068D
     I              M0068E                      N0068E
     I              M0068F                      N0068F
     I              M1001                       N1001
     I              M1004                       N1004
     I              M1225                       N1225
     I              M2005B                      N2005B
     I              M3039D                      N3039D
     I              M3039E                      N3039E
     I              M5004D                      N5004D
     I              M1N07                       N1N07
     I              M1N08                       N1N08
     I              M9N01                       N9N01
     I              MSN                         NSN
     I              MMN                         NMN
     I              MSR                         NSR
     I              MST                         NST
     I              MDT                         NDT
     I              MTM                         NTM
     I              MVEN                        NVEN
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   EXSR      SRC
     C                   EXSR      SRD
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    SSN           WSN
     C     *LIKE         DEFINE    S0036         W0036
     C     *LIKE         DEFINE    JCLFE         WCLFE
     C     *LIKE         DEFINE    MST           WST
     C     *LIKE         DEFINE    MVEN          WVEN
     C     *LIKE         DEFINE    SIBEL5        XBEL5
     C     *LIKE         DEFINE    SIBEL6        XBEL6
     C     *LIKE         DEFINE    SIBEL7        XBEL7
     C     *LIKE         DEFINE    SIBELT        XBELT
      *
     C                   Z-ADD     0             ØX                2 0
     C                   MOVE      *BLANKS       ØAN              12
     C                   Z-ADD     0             W0074             7 0
     C                   MOVE      *BLANKS       XTAR              3
S12  C*                  MOVE      *BLANKS       BLAN15           15
S12  C*                  MOVE      *BLANKS       BLAN17           17
N12  C                   MOVE      *BLANKS       BLAN30           30
N12  C                   MOVE      *BLANKS       BLAN28           28
     C                   MOVE      *ZEROS        T1X               2 0
      * INITIERE 5. SÆRAVGIFT....
     C                   MOVE      *BLANKS       XXWTY5
     C                   MOVE      *BLANKS       XXWSK5
     C                   MOVE      *ZEROS        XXWGL5
     C                   MOVE      *ZEROS        XXWST5
     C                   MOVE      *BLANKS       XXWPR5
     C                   MOVE      *ZEROS        XXWBL5
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYA          KLIST
     C                   KFLD                    WSN
     C     KEYB          KLIST
     C                   KFLD                    SSR
     C                   KFLD                    WST
     C                   KFLD                    WVEN
     C                   KFLD                    S0004
     C                   KFLD                    S0010
     C                   KFLD                    S0035
     C     KEYC          KLIST
     C                   KFLD                    S0004
     C                   KFLD                    S0010
     C                   KFLD                    WCLFE
     C     KEYD          KLIST
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     C     KEYE          KLIST
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     C     SADV2K        KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C     SADVJK        KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C                   KFLD                    SVLI
N43  C     SADVAVGK      KLIST
N43  C                   KFLD                    SIAVD
N43  C                   KFLD                    AV_WFTDN
     C     SADSDK        KLIST
     C                   KFLD                    WFIVNT
     C                   KFLD                    XDKDAÆ            2
     C                   KFLD                    WFISKV
     C                   MOVE      'MV'          XDKDAÆ
S63  C*    SADSDKBV      KLIST
S63  C*                  KFLD                    WFIVNT
S63  C*                  KFLD                    BV_SDKDAÆ         2
S63  C*                  MOVE      'BV'          BV_SDKDAÆ
S63  C*    SADSDKGB      KLIST
S63  C*                  KFLD                    WFIVNT
S63  C*                  KFLD                    GB_SDKDAÆ
S63  C*                  MOVE      'GB'          GB_SDKDAÆ         2
S63  C*    SADSDKMB      KLIST
S63  C*                  KFLD                    WFIVNT
S63  C*                  KFLD                    MB_SDKDAÆ
S63  C*                  MOVE      'MB'          MB_SDKDAÆ         2
S63  C*    SADSDKTO      KLIST
S63  C*                  KFLD                    WFIVNT
S63  C*                  KFLD                    TO_SDKDAÆ
S63  C*                  MOVE      'TO'          TO_SDKDAÆ         2
S48  C*    KODVAK        KLIST
S48  C*                  KFLD                    XVAUNI
S48  C*                  KFLD                    SIVAL3
N48  C     KODTVAL2K     KLIST
N48  C                   KFLD                    SIVAL3
N48  C                   KFLD                    X_M0068A
     C     KODS2K        KLIST
     C                   KFLD                    XS2UNI
     C                   KFLD                    SILKA
     C     KODS8K        KLIST
     C                   KFLD                    KS8AVG
     C                   KFLD                    KS8SKV
     C     TARIK         KLIST
     C                   KFLD                    WFIVNT
     C                   KFLD                    XTAR
     C     TARIKM        KLIST
     C                   KFLD                    WFIVNT
     C                   KFLD                    XTAR
     C                   KFLD                    XADATO
     C                   MOVE      99999999      XADATO            8 0
     C     TVIM4K        KLIST
     C                   KFLD                    XSR
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     C                   KFLD                    M0068A
     C                   KFLD                    M0068B
N23  C     TVIM4K2       KLIST
N23  C                   KFLD                    XSR
N23  C                   KFLD                    MAVD
N23  C                   KFLD                    MTDN
     C     WFKEY         KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C                   KFLD                    XNR
     C     *LIKE         DEFINE    MSR           XSR
     C                   MOVE      'R'           XSR
     C     KODTAK        KLIST
     C                   KFLD                    KOAUNI
     C                   KFLD                    SIAVD
     C                   MOVE      'A'           KOAUNI
     C     CUND1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KOAKNR
N66  C     FRIKEN66      KLIST
N66  C                   KFLD                    SIAVD
N66  C                   KFLD                    SITDN
N66  C                   KFLD                    FSKODN66          3
N66  C                   MOVE      'N66'         FSKODN66
      *_____________
      * Init av felt
      *"""""""""""""
      * Hente dagens dato og klokkeslett.
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           WDT80             8 0
N94  C     'TVI00012'    CHAIN     SYPTFF                             33
N94  C   33              Z-ADD     0             X_PP50KR          8 0
N94  C  N33              MOVE      PTFDT         X_PP50KR
N89  C     'TVI00011'    CHAIN     SYPTFF                             33
N89  C   33              Z-ADD     0             X_4SIFF           8 0
N89  C  N33              MOVE      PTFDT         X_4SIFF
N69  C     'TVI00009'    CHAIN     SYPTFF                             33
N69  C  N33              MOVE      PTFDT         X350_FIRMA        8 0
     C                   MOVE      '+'           WST
     C                   MOVE      *BLANKS       WVEN
     C                   MOVE      *BLANKS       WCLFE
     C                   MOVE      'VA'          XVAUNI            2
     C                   MOVE      'S2 '         XS2UNI            3
     C                   MOVE      '/'           XSTREK
      * Workfields for Array's
     C                   Z-ADD     0             AX                2 0          Index for A
     C                   Z-ADD     1             BX                2 0          Index for B
     C                   Z-ADD     0             AXV               2 0          Leftindx A
     C                   Z-ADD     0             AXH               2 0          Rightindx A
     C                   MOVE      'R'           WDIR              1            Search direction
     C                   MOVE      *BLANKS       WCHAR             1            Test character
     C                   MOVE      'Y'           WCHART            1            Test character
      * Workfields for separation character  '
     C                   BITON     '123457'      WAPSTR            1
     C                   BITOFF    '06'          WAPSTR
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C     WSN           PARM                    WSN
     C                   PARM                    WNETW             1
      *_______________________________
      * Hente momssats fra firmarecord
      *"""""""""""""""""""""""""""""""                     *Eksempel:*
     C                   READ      FIRM                                   33    FITAX=0.2200
S59  C*    'TVI00004'    CHAIN     SYPTFF                             33
S64  C*    'TVI00007'    CHAIN     SYPTFF                             33
S64  C*  33              MOVE      *ZEROS        PTFDT
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Start av file                                        SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
      *_____________________________
      * Hente data fra sendningslogg
      *"""""""""""""""""""""""""""""
     C     KEYA          CHAIN     EDIS                               81
     C                   MOVEL     SMBR          SEMBR
     C                   Z-ADD     0             W0036
      *_______________________________________________
      * Legg in JCL i starten av filen for Kommunedata
      *"""""""""""""""""""""""""""""""""""""""""""""""
     C                   SELECT
     C     WNETW         WHENEQ    '1'
      *
     C                   MOVE      'F'           WCLFE
     C     KEYC          CHAIN     EDIJ2                              81
     C     *IN81         DOWEQ     '0'
     C                   MOVE      JCLC          SDATA
     C                   WRITE     EDISER
     C     KEYC          READE     EDIJ2                                  81
     C  N81              END
     C                   ENDSL
      * Legg in UNB-segment (Sendningsstart)
     C                   EXSR      UNB0
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Les meldinger                                        SRC /
      *////////////////////////////////////////////////////////////
     C     SRC           BEGSR
     C     KEYB          CHAIN     EDIMC                              8182
     C     *IN81         DOWEQ     '0'                                          1<-B
     C  N82M0065         IFEQ      'CUSDEC'                                      2<-B
     C     M1001         ANDEQ     '929'
     C     M1N07         IFEQ      'DFU'                                          3<-B
     C     M1N07         OREQ      'DMA'
N84  C     M1N07         OREQ      'DSF'
     C     M1N07         OREQ      'DFO'
     C     M1N07         OREQ      'DEN'
     C     M1N07         OREQ      'DKO'
S16  C*    M1N07         OREQ      'DOM'
N16  C     M1N07         OREQ      'DEB'
N16  C     M1N07         OREQ      'DRE'
N16  C     M1N07         OREQ      'DSO'
N87   * Ved DEN skal FOR/dokument sendes på alle varelinjer
N87  C                   IF        M1N07 = 'DEN'
N87  C                   MOVE      'J'           X_DEN             1
N87  C                   ELSE
N87  C                   MOVE      'N'           X_DEN
N87  C                   END
N23   * HENT FORTOLLINGSDATO
N23  C                   MOVE      MTDN          X_MTDN            7 0
N23  C                   IF        MTDN < 0
N23  C                   EVAL      MTDN = MTDN * -1
N23  C                   END
N23  C                   MOVE      *ZEROS        X_M0068A          8 0
N23  C     TVIM4K2       SETLL     EDIM4
N23  C     TVIM4K2       READE     EDIM4                                  33
N23  C                   IF        *IN33
N70   * Hent godkjenningsdato fra orginal fortolling
N70  C     KEYD          CHAIN(N)  SADH                               33
N23  C                   MOVE      *ZEROS        XAN02             2
N23  C                   IF        %SUBST(SIDTG:1:2) = '20'
N23  C                   EVAL      XAN02 = %SUBST(SIDTG:3:2)
N23  C                   MOVE      XAN02         XAAR
N70  C                   IF        %SUBST(SIDTG:3:1) >= '0' AND
N70  C                             %SUBST(SIDTG:3:1) <= '9'
N70  C                   EVAL      XAN02 = %SUBST(SIDTG:5:2)
N70  C                   MOVE      XAN02         XMND
N70  C                   EVAL      XAN02 = %SUBST(SIDTG:7:2)
N70  C                   MOVE      XAN02         XDAG
N70  C                   ELSE
N23  C                   EVAL      XAN02 = %SUBST(SIDTG:7:2)
N23  C                   MOVE      XAN02         XMND
N23  C                   EVAL      XAN02 = %SUBST(SIDTG:9:2)
N23  C                   MOVE      XAN02         XDAG
N70  C                   END
N23  C                   CALL      'TESTDATO'
N23  C                   PARM                    XDAG              2 0
N23  C                   PARM                    XMND              2 0
N23  C                   PARM                    XAAR              2 0
N23  C                   PARM                    FLAGG             1 0
N23  C                   IF        FLAGG <> 1
N23  C                   MOVEL     SIDTG         X_M0068A
N23  C                   END
N23  C                   END
N23  C                   ELSE
N23  C                   DOW       *IN33 = *OFF
S72  C*                  IF        N1N07 = 'DTK' OR N1N07 = 'DUA'
N72  C                   IF        (N1N07 = 'DTK' OR N1N07 = 'DUA')
N72  C                             AND N1001 = '929'
N23  C                   MOVE      N0068A        X_M0068A
N23  C                   LEAVE
N23  C                   END
N23  C     TVIM4K2       READE     EDIM4                                  33
N23  C                   ENDDO
N23  C                   END
N23  C                   EVAL      MTDN = X_MTDN
N23   *
     C     KEYD          CHAIN(N)  SADH                               82
     C     *IN82         IFEQ      '0'                                             4<-B
N23  C                   IF        X_M0068A = 0
S27  C*                  MOVE      SIDT          X_M0068A
N27  C                   MOVE      M0068A        X_M0068A
N23  C                   END
     C                   Z-ADD     SSN           MSN
     C                   MOVE      'A'           MST
     C                   MOVEL     WDT           MDT
     C                   MOVEL     WTM           MTM
     C                   UPDATE    EDIMR
     C                   EXSR      PRINT
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C     KEYB          READE     EDIMC                                8281
     C  N81              END                                                    1<-E
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Slutt på file                                        SRD /
      *////////////////////////////////////////////////////////////
     C     SRD           BEGSR
      *_____________________________
      * Legg in UNZ (Slutt sendning)
      *"""""""""""""""""""""""""""""
     C                   EXSR      UNZ0
      *________________________
      * Oppdatere sendningslogg
      *""""""""""""""""""""""""
     C                   MOVE      'A'           SST
     C                   Z-ADD     W0036         S0036
     C                   UPDATE    EDISR
      *_______________________________________________
      * Legg in JCL i slutten av filen for Kommunedata
      *"""""""""""""""""""""""""""""""""""""""""""""""
     C     WNETW         IFEQ      '1'
     C                   MOVE      'E'           WCLFE
     C     KEYC          CHAIN     EDIJ2                              81
     C     *IN81         DOWEQ     '0'
     C                   MOVE      JCLC          SDATA
     C                   WRITE     EDISER
     C     KEYC          READE     EDIJ2                                  81
     C  N81              END
     C                   END
     C                   ENDSR
      */////////////////////////////////////////////////////////////
      * Skriv ut Tolldeklarasjon, denne delen er hentet fra SAD61P /
      */////////////////////////////////////////////////////////////
     C     PRINT         BEGSR
N49.2C                   EVAL      SITYPE = *BLANKS
N16  C                   IF        MTDN < 0
N16  C     KEYD          CHAIN     SADHOM                             33
N16  C                   END
N83   * Sjekk om oppdrag er relatert til midlertidig fortolling
N83  C     SIDP          COMP      40                                 3333
N83  C  N33KEYD          CHAIN     SADHMO                             33
N83  C  N33SISTMO        COMP      ' '                                3333
N83  C   33              EVAL      SITLE1 = *BLANKS
N64   *
N64  C                   EVAL      XNR08 = 0
N64  C                   IF        MTDN < 0
N64  C                   EVAL      MTDN = MTDN * -1
N64  C     KEYD          CHAIN(N)  SADH                               33
N64   * HENT OPPRINNELING FORTOLLINGSDATO
N64  C                   MOVEL     SIDTG         XNR08             8 0
N64  C                   EVAL      MTDN = MTDN * -1
N64  C     KEYD          CHAIN(N)  SADH                               33
N64  C                   END
N64   *
N64  C                   Z-ADD     99999999      X350_DT           8 0
N64   * NÆRINGSMIDDEL ER MED FORTOLLING. FINN DATO FOR OPPHEVING AV 350-KR GRENSE
N64  C     'TVI00008'    CHAIN     SYPTFF                             33
N64  C  N33              MOVE      PTFDT         X350_DT
N64  C                   MOVE      'N'           X_NMIDDEL         1
N64  C     SADV2K        SETLL     SADV2
N64  C     SADV2K        READE(N)  SADV2                                  33
N64  C                   DOW       *IN33 = *OFF
N64  C*                  IF        SVVNT >= 1000000 AND SVVNT <= 24999999
N64  C     SVVNT         CHAIN     KODTSN                             33
N64  C                   IF        *IN33 = *OFF                                 NÆRINGSMIDDEL
N64  C                             OR SVVNT >= 22030000 AND SVVNT <= 22089999   ALKOHOL
N64  C                             OR SVVNT >= 24010000 AND SVVNT <= 24039999   TOBAKK
N64  C                             OR SVVNT >= 48130000 AND SVVNT <= 48139999   SIGARETT
N64  C                   IF        X_M0068A >= X350_DT
N64   * Sett næringsmiddel fortolling til N etter 350-kr grense fjernes
N64  C                   EVAL      X_NMIDDEL = 'J'
N64  C                   END
N64  C                   IF        MTDN < 0 AND XNR08 < X350_DT
N64   * Opprinnelig fortolling er før opphevingsdato. Bevare 350-kr grense
N64  C                   EVAL      X350_DT = 99999999
N64   * Sett opprinnelig næringsmiddel fortolling til N før 350-kr grense fjernes
N64  C                   EVAL      X_NMIDDEL = 'N'
N64  C                   END
N64  C                   LEAVE
N64  C                   END
N64  C     SADV2K        READE(N)  SADV2                                  33
N64  C                   ENDDO
      *
     C                   CLEAR                   WFILEIR
S59  C*    PTFDT         IFLE      WDT80
     C     KODTAK        CHAIN     KODTA                              33
     C     CUND1K        CHAIN     CUNDL01                            33
S59  C*                  END
     C     SADV2K        CHAIN     SADW                               82
N16  C                   DOW       *IN82 = *OFF
N16  C                   IF        SVPREÆ = ' ' OR SVPREÆ = 'J'
N41  C                             OR SVPREÆ = 'N'
N16  C                   LEAVE
N16  C                   END
N16  C     SADV2K        READE     SADW                                   82
N16  C                   ENDDO
     C     *IN82         IFEQ      '0'
     C                   MOVE      'J'           MVOGN             1
     C                   ELSE
     C                   MOVE      'N'           MVOGN
     C                   END
      *
     C                   EXSR      UNH0
     C                   EXSR      BGM0
      *__________________________________
      * Sette nødvendige indkatorer på/av
      *""""""""""""""""""""""""""""""""""
     C                   EXSR      SETIN1
      *_____________________________________________________________
      * I SUMVAR gjøres nødvendige beregninger (summerer varelinjer)
      * og skriver ut på filen WFILEIMP
      *"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
N06  C                   MOVE      'N'           UTBTAX0S          1
     C  N41              EXSR      SUMVAR
      *___________________________________
      * Sette nødvendige indikatorer på/av
      *"""""""""""""""""""""""""""""""""""
     C                   EXSR      SETIN2
      *________________________________
      * Skrive tolldekl. til EDIFACT-fil
      *""""""""""""""""""""""""""""""""
     C                   EXSR      PRINT2
     C                   EXSR      UNT0
      *_________________________________
      * Oppdater toll, moms, ... på SADH
      *"""""""""""""""""""""""""""""""""
     C                   MOVE      SIBEL7        XBEL7
N34   *
N34   * MVA-REGISTRERT SKAL FJERNE MOMS I TOTAL
N34  C                   IF        SIMVA = 'J'
N34  C                   EVAL      XBEL6 = 0
N34  C                   END
N64  C                   IF        %SUBST(SIRG:11:1) <> ' ' AND SIBEL4 < 350
N80  C                             AND %SUBST(SIRG:11:1) <> 'B'                 PRIVAT
N64  C                             AND X_M0068A >= X350_DT
N64  C                             AND UTBTAX0S <> 'J' AND X_NMIDDEL <> 'J'
N64   * PRIVAT, < 350 KR, IKKE NÆRINGSMIDDEL OG ETTER 01.01.2020
N64  C                   EVAL      XBEL6 = 0
N64  C                   EVAL      XBEL7 = 0
N64  C                   END
N34   *
     C                   MOVE      SIBELT        XBELT
     C     KEYD          CHAIN     SADH                               82
     C     *IN82         IFEQ      '0'
     C                   MOVE      XBEL5         SIBEL5
S05  C*                  MOVE      XBEL6         SIBEL6
N05  C  N94              MOVE      XBEL6         SIBEL6
N05  C   94              MOVE      *ZEROS        SIBEL6
     C                   MOVE      XBEL7         SIBEL7
     C                   MOVE      XBELT         SIBELT
     C                   MOVE      'A'           SIST
     C                   EXCEPT    OPDSAD
N66  C                   IF        TRSTA3=*BLANKS
N66  C     FRIKEN66      CHAIN     FRISOK
N66  C                   IF        %FOUND(FRISOK)
N66  C                   EXSR      N66SR1
N66  C                   ENDIF
N66  C                   ENDIF
     C                   END
      *
     C                   ENDSR
      *
      */////////////////////////////////////////////////////////////
      * Sette nødvendige indikatorer på/av                         /
      */////////////////////////////////////////////////////////////
     C     SETIN1        BEGSR
N51   *
N51   * SJEKK OM PROSEDYRE 49 ER BLANK ANDRE 4x PROSEDYRE
N51  C                   EVAL      X_SIBEL3 = 0
N51  C                   MOVE      'N'           XPR49             1
N51  C                   IF        SIDP <> 49 AND XDP1 = 4
N91  C*                            AND SIDP_4 <> 4171
N51  C     *LIKE         DEFINE    SIBEL3        X_SIBEL3
N51  C     SADV2K        SETLL     SADV2
N51  C     SADV2K        READE(N)  SADV2                                  33
N51  C                   DOW       *IN33 = *OFF
N51  C                   IF        SVDP = 49
N91  C*                            OR SVDP_4 = 4171
N91  C                             OR SIKUNS = 1
N51  C                   EVAL      X_SIBEL3 = X_SIBEL3 + SVBELT * 0.2
N51  C                   MOVE      'J'           XPR49
N51  C                   ELSE
N51  C                   EVAL      X_SIBEL3 = X_SIBEL3 + SVBELT
N51  C                   END
N51  C     SADV2K        READE(N)  SADV2                                  33
N51  C                   ENDDO
N51  C                   ELSE
N51  C                   EVAL      X_SIBEL3 = SIBEL3
N51  C                   END
N51   *
      *___________________
      * Blanke ut workfile
      *"""""""""""""""""""
     C                   EXSR      MOVBWF
     C                   MOVE      *ZEROS        XTVF             17 9
     C                   MOVE      *ZEROS        XTVF2            17 9
      *______________________
      * Er dette et instikk ?
      *""""""""""""""""""""""
     C                   SETOFF                                       41        =Instikk
     C     SIMF          IFEQ      'DFO'
     C                   MOVE      '1'           *IN41
     C                   END
      *
     C  N41SIMF          IFEQ      'DKO'                                        1<-B
     C     SIMI          ANDEQ     'I'
     C     TVIM4K        SETLL     EDIM4                              33
     C     STSI1         TAG
     C     TVIM4K        READE     EDIM4                                  33
     C  N33NST           IFEQ      'D'                                           2<-B
     C     N1N07         ORNE      'DUA'
     C                   GOTO      STSI1
     C                   END                                                     2<-B
     C   33              MOVE      '1'           *IN41
     C                   END                                                    1<-B
      *
      * PROS.=47,70-77 ---> 90 PÅ
     C     SIDP          COMP      70                                 90  90
     C   90SIDP          COMP      77                                   9090
      *
     C   41              DO                                                     Ved instikk
     C     KODS2K        CHAIN     KODTS2                             42
     C  N42KS2PRE        COMP      *BLANKS                                42
     C                   END
      *__________________________
      * Finn faktor for varelinje
      *""""""""""""""""""""""""""
     C  N41SIBEL3        IFNE      0
N48  C     KODTVAL2K     SETGT     KODTVAL2
N48  C     SIVAL3        READPE    KODTVAL2                               33
N53  C   33SIVAL3        CHAIN     KODTVAL2                           33
N48  C     *LIKE         DEFINE    SIBEL4        X_SIBEL4
N48  C                   EVAL(H)   X_SIBEL4 = SIBEL3 * SIVKU / KVAOMR
N48  C                   IF        SIBEL4 = X_SIBEL4
N48  C                   EVAL(H)   XTVF = SIVKU / KVAOMR
N48  C                   ELSE
     C     SIBEL4        DIV(H)    SIBEL3        XTVF
N48  C                   END
S51  C*                  IF        SIDP = 49
N51  C                   SELECT
N51  C                   WHEN      SIDP = 49
N91  C*                            OR SIDP_4 = 4171
N91  C                             OR SIKUNS = 1
N33  C                   EVAL(H)   XTVF2 = SIBELS / (SIBEL3 * 0.2)
N51  C                   WHEN      XPR49 = 'J'
N51  C                   EVAL(H)   XTVF2 = SIBELS / X_SIBEL3
N33  C                   END
     C                   END
     C  N41SIBELR        IFNE      0
     C     SIBEL3        ANDNE     0
     C     SIBELS        DIV(H)    SIBEL3        XTVF2
     C                   END
      *
     C     SIVAL3        IFEQ      *BLANKS
     C                   MOVE      FICURR        SIVAL3
     C                   END
S48  C*    KODVAK        CHAIN     KODTVA                             33
N48  C     SIVAL3        CHAIN     KODTVAL2                           33
     C   33              MOVE      *ZEROS        KVAOMR
      *____________________________________________
      * Diverse tester for del-1 av tolldeklarasjon
      *""""""""""""""""""""""""""""""""""""""""""""
     C     SILV          COMP      'TFR'                                  38
      *
     C                   MOVE      *ZEROS        XNR               5 0
     C                   MOVE      *ZEROS        XN2               4 0
     C                   MOVE      *ZEROS        XN3               5 0
     C                   MOVE      *ZEROS        SIBELT
     C                   MOVE      *ZEROS        XBEL5
     C                   MOVE      *ZEROS        XBEL6
     C                   MOVE      *ZEROS        XTOT1            13 2
     C                   MOVE      *ZEROS        XTOT2            13 2
     C                   MOVE      *ZEROS        XTOTBV            9 0
     C                   MOVE      *ZEROS        XTVKTB            9 0
     C                   MOVE      *ZEROS        XTJUS            10 0
N64  C                   MOVE      *ZEROS        XTOTTOLL         11 0
      *
     C     *IN41         IFEQ      '1'
     C                   MOVE      '1'           *IN94
     C                   MOVE      *ZEROS        XIBEL3
     C                   ELSE
     C     SIBEL3        MULT      SIVKU         XIBEL3           15 2
     C                   DIV(H)    KVAOMR        XIBEL3
N64  C                   MOVE      *BLANKS       XAN01             1
N64  C                   EVAL      XAN01 = %SUBST(SIRG:11:1)
     C                   SELECT
S08  C*    XIBEL3        WHENGE    199.5
s22  C*    XIBEL3        WHENGE    200
S25  C*    SIBEL4        WHENGE    350
S30  C*    SIBEL4        WHENGT    350
N30  C     SIBEL4        WHENGE    350
N23  C     X_M0068A      ANDGE     20150101
N64  C     X_M0068A      ANDLT     X350_DT
N23  C     SIBEL3        ORGE      200
N23  C     X_M0068A      ANDLT     20150101
N64  C     X_M0068A      ORGE      X350_DT
N64  C     XAN01         ANDNE     ' '                                          PRIVAT PERSON
N80  C     XAN01         ANDNE     'B'                                          PRIVAT PERSON
N69  C     X_M0068A      ORGE      X350_FIRMA
N69  C     XAN01         ANDEQ     ' '                                          Firmakunde
N80  C     X_M0068A      ORGE      X350_FIRMA
N80  C     XAN01         ANDEQ     'B'                                          Firmakunde
      * VAREVERDI>=LAVVERDI GRENSE--> ALLTID KREVE AVGIFTER
     C                   MOVE      '0'           *IN94
     C                   OTHER
     C                   MOVE      '1'           *IN94
     C                   ENDSL
     C                   END
      *
     C                   MOVE      '1'           *IN92
      *
     C                   ENDSR
      *///////////////////////////////////////////////////////
      * Sammentrekkning av varelinjer                 SUMVAR /
      *///////////////////////////////////////////////////////
     C     SUMVAR        BEGSR
S78  C*                  IF        SIUR = 'F'
S78  C*                  CALL      'SAD61PBL'
S78  C*                  PARM      SIAVD         UAVD2             4 0
S78  C*                  PARM      SITDN         UOPD              7 0
S78  C*                  PARM                    UNR               2 0
S78  C*                  PARM                    MN
S78  C*                  PARM                    UN2               2 0
S78  C*                  PARM                    VS
S78  C*                  END
S78  C*
N81  C     SADV2K        SETLL     SADV4
N81  C     SADV2K        READE     SADV4                                  33
N81  C                   DOW       *IN33 = *OFF
N81  C                   IF        SVLN = 0
N81  C                   EVAL      SVLN = SVLI
N81  C                   END
N81  C                   UPDATE    SADV4R
N81  C     SADV2K        READE     SADV4                                  33
N81  C                   ENDDO
N81   * Oppdatere SVLN
N40  C                   IF        SIMVA <> 'J' AND SIBEL4 > 350                1<-B
N64  C                             OR SIMVA <> 'J' AND X_M0068A >= X350_DT
N69  C                             AND X_M0068A < X350_FIRMA
N69  C                             OR SIMVA <> 'J' AND X_M0068A >= X350_FIRMA   Firmakunde opphever
N69  C                             AND %SUBST(SIRG:11:1) = ' '                  350-kronegrense
N80  C                             OR SIMVA <> 'J' AND X_M0068A >= X350_FIRMA   Firmakunde opphever
N80  C                             AND %SUBST(SIRG:11:1) = 'B'                  350-kronegrense
N40  C                   MOVE      'J'           X_TOLLAVG
N40  C                   ELSE                                                   1
N43  C     SADV2K        CHAIN     SADW                               33
N43  C                   IF        *IN33                                         2<-B
N40  C                   MOVE      'N'           X_TOLLAVG         1
N43  C                   IF        SITDN < 0                                      3<-B
N43   * FINN ORIGNAL TOLL OG AVGIFTER
N43  C                   Z-SUB     SITDN         AV_WFTDN
N43  C     SADVAVGK      CHAIN     SADVAVG                            33
N43  C                   DOW       *IN33 = *OFF                                    4<-B
N43  C                   IF        AV_WFITOL <> 0                                   5<-B
N43  C                   EVAL      X_TOLLAVG = 'J'
N43  C                   LEAVE                                                      5
N43  C                   ELSE                                                        6<-B
N43  C                   IF        AV_WFIBL1 <> 0 OR AV_WFIBL2 <> 0 OR
N43  C                             AV_WFIBL3 <> 0 OR AV_WFIBL4 <> 0 OR
N43  C                             AV_WFIBL5 <> 0 OR AV_WFIBL6 <> 0
N43  C                   EVAL      X_TOLLAVG = 'J'
N43  C                   LEAVE
N43  C                   END                                                         6<-E
N43  C                   END                                                        5<-E
N43  C     SADVAVGK      READE     SADVAVG                                33
N43  C                   ENDDO                                                     4<-E
N43  C                   END                                                      3<-E
N43  C                   ELSE                                                    2
N43  C                   MOVE      'J'           X_TOLLAVG
N43  C                   END                                                     2<-E
N40  C                   END                                                    1<-E
N45   *
N45  C                   IF        MTDN < 0 AND X_TOLLAVG = 'N'
N45   * SJEKK OM ORIGINAL HAR TOLL OG AVGIFT
N45  C                   EVAL      MTDN = MTDN * -1
N45  C     KEYD          CHAIN(N)  SADH                               33
N45  C                   IF        SIBEL7 > 350
N64  C                             OR X_M0068A >= X350_DT
N93  C                             AND SITYPE <> '0098'
N45  C                   MOVE      'J'           X_TOLLAVG
N45  C                   END
N45  C                   EVAL      MTDN = MTDN * -1
N45  C     KEYD          CHAIN(N)  SADH                               33
N45  C                   END
N45   *
N16  C                   MOVE      'J'           XORI              1
     C     SITRT1        IFEQ      1
     C                   MOVE      *ZEROS        XVLN              5 0
     C     SADV2K        SETLL     SADV4
     C                   ELSE
S10  C*                  MOVE      *BLANKS       XBRUD2           20
S51  C*                  MOVE      *BLANKS       XBRUD2           22
S89  C*                  MOVE      *BLANKS       XBRUD2           24
N89  C                   MOVE      *BLANKS       XBRUD2           26
     C     SADV2K        SETLL     SADV2
     C                   END
     C                   SETOFF                                       33
N16  C                   MOVE      'J'           XTOTSLT           1
      *
     C     STSV          TAG
     C     SITRT1        IFEQ      1                                            1<-B
N41  C     XORI          ORNE      'J'
     C     SADV2K        READE     SADV4                                  33
N16  C  N33              IF        XORI = 'J'                                    2<-B
N16  C                   IF        SVPREÆ = 'J'                                   3<-B
N41  C                             OR SVPREÆ = 'N' OR SVPREÆ = 'D'
N75  C                   UPDATE    SADV4R
N16  C                   GOTO      STSV
N16  C                   END                                                      3<-E
N16  C                   ELSE                                                    2
N41  C                   IF        XORI = 'G'                                     3<-B TIDLIGERE OMB
N41  C                   IF        SVPREÆ <> 'N' AND SVPREÆ <> 'D'                 4<-B
N75  C                   UPDATE    SADV4R
N41  C                   GOTO      STSV
N41  C                   END                                                       4<-E
N41  C                   ELSE                                                     3
N16  C                   IF        SVPREÆ <> 'J'                                   4<-B
N75  C                   UPDATE    SADV4R
N16  C                   GOTO      STSV
N16  C                   END                                                       4<-E
N41  C                   END                                                      3<-E
N16  C                   END                                                     2<-E
N16  C   33              IF        SITDN < 0 AND XORI = 'J'                      2<-B
N41  C                             OR SITDN < 0 AND XORI = 'G'
N41  C                   IF        XORI = 'J'                                     3<-B
N41  C                   EVAL      XORI = 'G'
N41  C                   ELSE                                                     3
N16  C                   EVAL      XORI = 'N'
N41  C                   END                                                      3<-E
N16  C     SADV2K        SETLL     SADV4
N16  C                   GOTO      STSV
N16  C                   END                                                     2<-E
      * LAGT TIL SOM EN NØDLØSING FORDI SAD061A KAN LAGE TILLEGGSLINJER HVOR SVLN=0
      * SELVFØLGELIG SKAL DETTE RETTES I SAD061A, MEN P.G.A. AVANSERT LOGIKK
      * MÅ VI VENTE TIL CHANG ER TILBAKE FRA FERIE
     C  N33SVLN          IFEQ      0                                             2<-B
N75  C                   UPDATE    SADV4R
     C                   GOTO      STSV
     C                   ENDIF                                                   2<-E
     C   33XVLN          IFNE      0                                             2<-B
     C                   EXSR      REGN
     C                   END                                                     2<-E
     C                   ELSE                                                   1
     C     SADV2K        READE     SADV2                                  33
N16  C  N33              IF        XORI = 'J'                                    2<-B
N16  C                   IF        SVPREÆ = 'J'                                   3<-B
N7401C*                            OR SVPREÆ = 'S' <- Skal ikke være med pga. original linje
N41  C                             OR SVPREÆ = 'N' OR SVPREÆ = 'D'
N16  C                   GOTO      STSV
N16  C                   END                                                      3<-E
N16  C                   ELSE                                                    2
N16  C                   IF        SVPREÆ <> 'J'                                  3<-B
N16  C                   GOTO      STSV
N16  C                   END                                                      3<-E
N16  C                   END                                                     2<-E
     C   33XBRUD2        IFNE      *BLANKS                                       2<-B
     C                   EXSR      REGN
     C                   END                                                     2<-E
     C                   END                                                    1<-E
N16  C   33              IF        SITDN < 0 AND XORI = 'J'                     1<-B
N41  C                             OR SITDN < 0 AND XORI = 'G'
N41  C                   IF        XORI = 'J'                                    2<-B
N41  C                   EVAL      XORI = 'G'                                   LES TIDLIGERE OMB
N41  C                   ELSE                                                    2
N16  C                   EVAL      XORI = 'N'
N41  C                   END                                                     2<-E
N16  C                   MOVE      *BLANKS       XBRUD2
S41  C*    SADV2K        SETLL     SADV2
N41  C     SADV2K        SETLL     SADV4
N16  C                   GOTO      STSV
N16  C                   END                                                    1<-E
     C   33              GOTO      SLSV
N1601C                   IF        SVPREÆ <> 'S'
N41  C                             AND SVPREÆ <> 'D'
N16  C                   MOVE      'N'           XTOTSLT           1
N1601C                   END
      * STARTER LINJETELLER MED 1 VED 1. RECORD
     C     SITRT1        IFEQ      1
N41  C     XORI          ORNE      'J'
     C     XVLN          IFEQ      0
     C                   EXSR      FLYTT
     C                   ELSE
     C     XVLN          IFNE      SVLN
     C                   EXSR      REGN
     C                   EXSR      FLYTT
     C                   END
     C                   END
     C                   MOVE      SVLN          XVLN
N75  C                   IF        SVTDN < 0 AND SVPREÆ <> ' ' AND SVPREÆ <> 'S'
N86  C                             AND SVPREÆ <> 'D'
N75  C                   Z-ADD     XNR           SVLN
N75  C                   END
N75  C                   UPDATE    SADV4R
     C                   ELSE
     C     XBRUD2        IFEQ      *BLANKS
     C                   EXSR      FLYTT
     C                   ELSE
     C     XBRUD1        IFNE      XBRUD2
      * VED BRUDD OPPDATER VARELINJE PÅ WFILEIMP
     C                   EXSR      REGN
     C                   EXSR      FLYTT
     C                   END
     C                   END
      *
     C                   Z-ADD     XNR           SVLN
     C                   EXCEPT    SADVLN
      *
     C                   MOVE      XBRUD1        XBRUD2
     C                   END
N37   *
N37  C                   IF        SVPREÆ = 'S'
N41  C                             OR SVPREÆ = 'D'
N37  C                   GOTO      STSV
N37  C                   END
N61  C                   IF        WFITRP = 'S' AND SVPREÆ <> 'S'
N61  C                   MOVE      SVPREÆ        WFITRP
N61  C                   END
N37   *
E39  C     XTVF          MULT(H)   SVBELT        XTVRD            13 2
N33  C                   IF        SIDP = 49
N51  C                             OR SVDP = 49
N91  C*                            OR SIDP_4 = 4171
N91  C*                            OR SVDP_4 = 4171
N91  C                             OR SIKUNS = 1
N33  C                   EVAL(H)   XTVRD2 = XTVF2 * SVBELT * 0.2
N33  C                   END
S78   *** TEST OM DET SKAL HENTE MERKE & NR.
S78  C* N49SV01          COMP      'B'                                    49
      *
     C     1             DO        7             XN2                            1<-B
     C                   IF        SVFT(XN2) <> *BLANKS                          2<-B
     C     1             DO        7             XN4                              3<-B
     C                   SELECT                                                    4<-B
     C                   WHEN      KN(XN4) = *BLANKS                               4
     C                   EVAL      KN(XN4) = SVFT(XN2)
N59  C                   SELECT                                                     5<-B
S62  C*                  WHEN      SVEH(XN2) = 'CONT' OR SVEH(XN2) = 'C-'           5
S62  C*                            OR SVEH(XN2) = 'C.'
S62  C*                  MOVE      'CONT'        KN(XN4)
N59  C                   WHEN      SVEH(XN2) = 'U.NR' OR SVEH(XN2) = 'U-NR'         5
N59  C                             OR SVEH(XN2) = 'U.' OR SVEH(XN2) = 'U-'
N59  C                   MOVE      'U-NR'        KN(XN4)
N59  C                   ENDSL                                                      5<-E
     C                   LEAVE
     C                   WHEN      KN(XN4) = SVFT(XN2)                             4
     C                   LEAVE
N59  C                   WHEN      %SUBST(KN(XN4):1:17) = %SUBST(SVFT(XN2):1:17)   4
N59  C                             AND SIKDC = '1'
N59  C                   LEAVE
     C                   ENDSL                                                     4<-E
     C                   ENDDO                                                    3<-E
     C                   END                                                     2<-E
     C                   ENDDO                                                  1<-E
      *
     C     1             DO        7             XN2                            1<-B
     C                   IF        SVVT(XN2) <> *BLANKS                          2<-B
     C     1             DO        7             XN4                              3<-B
     C                   SELECT                                                    4<-B
     C                   WHEN      VB(XN4) = *BLANKS                               4
     C                   EVAL      VB(XN4) = SVVT(XN2)
     C                   LEAVE
     C                   WHEN      VB(XN4) = SVVT(XN2)                             4
     C                   LEAVE
     C                   ENDSL                                                     4<-E
     C                   ENDDO                                                    3<-E
     C                   END                                                     2<-E
     C                   ENDDO                                                  1<-E
      *
     C     STSV2         TAG
     C     WFIVT         IFEQ      *BLANKS
     C                   MOVE      SVEH01        WFIVT
     C                   END
N59  C     1             DO        7             XN2
N59  C     SVEH(XN2)     IFEQ      'U-NR'
N59  C     SVEH(XN2)     OREQ      'U.NR'
N59  C     SVEH(XN2)     OREQ      'U.'
N59  C     SVEH(XN2)     OREQ      'U-'
N59  C                   MOVE      SVEH(XN2)     WFIVT
N59  C                   LEAVE
N59  C                   END
N59  C                   ENDDO
N63   *
N63   * TEST OM ALKOHOL OG TOBAKK
S65  C*    1             DO        7             XN2                            1<-B
S65  C*                  IF        Y2(XN2) = 'BV' OR Y2(XN2) = 'GB' OR
S65  C*                            Y2(XN2) = 'MB' OR Y2(XN2) = 'TO'
S65  C*                  MOVE      'J'           UTBTAX0S
S65  C*                  LEAVE
S65  C*                  END
S65  C*                  ENDDO
      *
     C     1             DO        7             XN2                            1<-B
     C                   EVAL      WFIANT = WFIANT + SVNT(XN2)
     C                   ENDDO                                                  1<-E
      *
     C     1             DO        10            XN2                            1<-B
     C                   IF        SVTOP(XN2) <> *BLANKS                         2<-B
S54  C*                  IF        SVTCR(XN2) = 'UTB'
S63  C*    SADSDKBV      CHAIN     SADSD                              33
S63  C*  33SADSDKGB      CHAIN     SADSD                              33
S63  C*  33SADSDKMB      CHAIN     SADSD                              33
S63  C*  33SADSDKTO      CHAIN     SADSD                              33
S63  C*                  IF        *IN33 = *OFF
S63  C*                  MOVE      'J'           UTBTAX0S
S63  C*                  END
S54  C*                  END
     C     1             DO        10            XN4                              3<-B
     C                   SELECT                                                    4<-B
     C                   WHEN      TO(XN4) = *BLANKS                               4
     C                   EVAL      TO(XN4) = SVTOP(XN2)
     C                   EVAL      TC(XN4) = SVTCR(XN2)
     C                   LEAVE
     C                   WHEN      TO(XN4) = SVTOP(XN2) AND TC(XN4) = SVTCR(XN2)   4
     C                   LEAVE
     C                   ENDSL                                                     4<-E
     C                   ENDDO                                                    3<-E
     C                   END                                                     2<-E
     C                   ENDDO                                                  1<-E
      *
     C     STSV3         TAG
     C     SVPVA         COMP      'P'                                    51
     C     SVPVA         COMP      'V'                                    52
     C  N52SVPVA         COMP      'W'                                    52
     C     SVPVA         COMP      'A'                                    53
      *
S12  C*                  ADD       SVVKTB        WFIVKB
S12  C*                  ADD       SVVKTN        WFIVKN
N12  C                   ADD       SVVKTB        WFIVKB123
N12  C                   ADD       SVVKTN        WFIVKN123
     C   53              ADD       SVNTM         XNTM              9 0
     C     SVBELT        MULT      SIVKU         XWORK
     C                   DIV(H)    KVAOMR        XWORK
      * ADDER TIL DATASTRUKTURFELT MED DESIMAL
     C                   ADD(H)    XWORK         XWFSTB
N71  C                   ADD       SVBELT        XSAMLIN
     C     SIBELR        IFNE      0
E39  C     XTVF2         MULT(H)   SVBELT        XTVRD2           13 2
E39  C                   ADD       SVBELT        XBELR2           13 2
     C                   END
N33  C                   IF        SIDP = 49
N51  C                             OR SVDP = 49
N91  C*                            OR SIDP_4 = 4171
N91  C*                            OR SVDP_4 = 4171
N91  C                             OR SIKUNS = 1
N33  C                   EVAL(H)   XTVRD2 = XTVF2 * SVBELT * 0.2
E39  C                   ADD       SVBELT        XBELR2           13 2
N33  C                   EVAL(H)   X_XWFSTB = X_XWFSTB + XWORK
N33  C                   END
      * SUMMER EKSTRAAVGIFTER
     C     1             DO        8             XN2                            1<-B
     C                   IF        SVAKD(XN2) <> *BLANKS                         2<-B
     C     1             DO        8             XN4                              3<-B
     C                   SELECT                                                    4<-B
     C                   WHEN      Y2(XN4) = *BLANKS                               4
     C                   EVAL      Y2(XN4) = SVAKD(XN2)
     C                   EVAL      E2(XN4) = SVASV(XN2)
     C                   EVAL      S2(XN4) = SVASA(XN2)
     C*                  EVAL      P2(XN4) = SVEH2(XN2)
S58  C*                  EVAL      P2(XN4) = SVEH2Æ
N58  C                   EVAL      P2(XN4) = SVEH2(XN2)
     C                   EVAL      B2(XN4) = SVABL(XN2)
     C                   EVAL      G2(XN4) = SVAGR(XN2)
N65  C                   IF        Y2(XN2) = 'BV' OR Y2(XN2) = 'GB' OR
N82  C                             Y2(XN2) = 'OL' OR
N65  C                             Y2(XN2) = 'MB' OR Y2(XN2) = 'TO'
N76  C                   IF        B2(XN2) > 0
N65  C                   MOVE      'J'           UTBTAX0S
N76  C                   END
N65  C                   END
     C                   LEAVE
     C                   WHEN      Y2(XN4) = SVAKD(XN2) AND E2(XN4) = SVASV(XN2)   4
     C                   EVAL      B2(XN4) = B2(XN4) + SVABL(XN2)
     C                   EVAL      G2(XN4) = G2(XN4) + SVAGR(XN2)
     C                   LEAVE
     C                   ENDSL                                                     4<-E
     C                   ENDDO                                                    3<-E
     C                   END                                                     2<-E
     C                   ENDDO                                                  1<-E
      * FINN TOLLBELØP
     C                   MOVE      *ZEROS        XTBEL            13 2
     C   51SIBELR        IFEQ      0
N33  C     SIDP          ANDNE     49
N51  C     SVDP          ANDNE     49
N91  C*    SIDP_4        ANDNE     4171
N91  C*    SVDP_4        ANDNE     4171
N91  C     SIKUNS        ANDNE     1
     C     XTVRD         MULT      SVAS          XWORK
     C                   ELSE
     C     XTVRD2        MULT      SVAS          XWORK
     C                   END
     C   51XWORK         DIV(H)    100           XTBEL
     C   52SVVKTN        MULT      SVAS          XTBEL
     C   52SVPVA         IFEQ      'W'
     C                   DIV(H)    100           XTBEL
     C                   END
     C   53SVNTM         MULT      SVAS          XTBEL
     C                   ADD       XTBEL         XWFTOL
     C                   ADD       SVNTM         WFINTM
N33  C     SIDP          IFEQ      49
N51  C     SVDP          OREQ      49
N91  C*    SIDP_4        OREQ      4171
N91  C*    SVDP_4        OREQ      4171
N91  C     SIKUNS        OREQ      1
N33   * XWFTLG   = 20% AV FAKTURAVERDI
N33   * X_XWFTLG = FAKTURAVERDI
N33  C                   ADD       XTVRD2        XWFTLG
E39  C                   ADD       XTVRD         X_XWFTLG         13 2
N33  C                   ELSE
     C                   ADD       XTVRD         XWFTLG
N33  C                   END
      *
     C                   GOTO      STSV
      *
     C     SLSV          ENDSR
      *////////////////////////////////////////////////////////////
      * Sette nødvendige indikatorer på/av                        /
      *////////////////////////////////////////////////////////////
     C     SETIN2        BEGSR
     C     MVOGN         IFEQ      'J'
     C                   Z-ADD     SIBEL7        XTOT2                            TOTAL
     C     XTOT2         SUB       SIBELT        XTOT1                            UTEN TA
     C                   END
      *
     C                   MOVE      *ZEROS        XN2
     C                   MOVE      *ZEROS        XN4               2 0
     C                   MOVE      *BLANKS       T1
     C                   MOVE      *ZEROS        T2
     C                   MOVE      *BLANKS       T3
     C                   MOVE      *ZEROS        SIBEL7
      *
     C                   SETON                                        51
      * XTAVG = T0TAL TRAFIKKAVGIFT
     C     SIBELT        COMP      5                                    93
      * XTOT1 = TOTAL AVGIFTER UTEN TRAFIKKAVGIFT
S08  C*                  IF        XIBEL3 >= 199.5
S04  C*  93XTOT1         COMP      50                                   9494
S04  C* N93XTOT2         COMP      50                                   9494
S22  C*                  IF        XIBEL3 >= 200
S23  C*                  IF        SIBEL4 >= 350
S25  C*                  IF        (SIBEL4 >= 350 AND X_M0068A >= 20150101) OR
S30  C*                  IF        (SIBEL4 > 350 AND X_M0068A >= 20150101) OR
S64  C*                  IF        (SIBEL4 >= 350 AND X_M0068A >= 20150101) OR
S64  C*                            (SIBEL3 >= 200 AND X_M0068A < 20150101)
N64  C                   IF        SIBEL4 >= 350 AND X_M0068A >= 20150101 AND
N64  C                             X_M0068A < X350_DT OR
N64  C                             (SIBEL3 >= 200 AND X_M0068A < 20150101) OR
N64  C                             X_M0068A >= X350_DT
S15  C*  93XTOT1         COMP      50                                   94
S15  C* N93XTOT2         COMP      50                                   94
E39  C   93              Z-ADD(H)  XTOT1         XTOTHEL          13 0
E39  C  N93              Z-ADD(H)  XTOT2         XTOTHEL          13 0
N64  C                   IF        %SUBST(SIRG:10:2) = '  '                     IKKE PRIVATPERSON
N80  C                             OR %SUBST(SIRG:11:1) = 'B'                   IKKE PRIVATPERSON
N64  C*                            OR X_NMIDDEL = 'N'                           PRIVATPERSON
N64   * Test mot 50-kr grense
N15  C     XTOTHEL       COMP      50                                   94
N64  C                   ELSE
N64   * Privatperson og næringsmiddel -> 50-kr grense fjernes fra og med 01.01.2020
N64  C     XTOTHEL       COMP      0                                    94
N64  C                   END
     C                   END
      * "BV/TO" > 0  --->  ALLTID MED MOMOS
     C  N94              MOVE      '1'           *IN92
     C   94XTOTBV        COMP      0                                    9292
N06  C   94              IF        UTBTAX0S = 'J'
N06  C                   EVAL      *IN92 = *OFF
N06  C                   END
     C   94
     CANN92              MOVE      '0'           *IN94
S08  C*                  IF        UTBTAX0S='J' AND SITST = 1 AND XIBEL3 <= 199
s22  C*                  IF        UTBTAX0S='J' AND SITST = 1 AND XIBEL3 < 200
S23  C*                  IF        UTBTAX0S='J' AND SITST = 1 AND SIBEL4 < 350
N23  C                   IF        UTBTAX0S='J' AND SITST = 1
S25  C*                  IF        (SIBEL4 < 350 AND X_M0068A >= 20150101) OR
S30  C*                  IF        (SIBEL4 <= 350 AND X_M0068A >= 20150101) OR
S64  C*                  IF        (SIBEL4 < 350 AND X_M0068A >= 20150101) OR
S64  C*                            (SIBEL3 < 200 AND X_M0068A < 20150101)
N64  C                   IF        (SIBEL4 < 350 AND X_M0068A >= 20150101) AND
N64  C                             X_M0068A < X350_DT OR
N64  C                             (SIBEL3 < 200 AND X_M0068A < 20150101) OR
S80  C*                            X_M0068A >= X350_DT AND %SUBST(SIRG:11:1)=' '
N80  C                             X_M0068A >= X350_DT AND
N80  C                             (%SUBST(SIRG:11:1) = ' ' OR                  FIRMA
N80  C                              %SUBST(SIRG:11:1) = 'B')
N69  C                             AND X_M0068A < X350_FIRMA                    350 grense oppheves
S17  C*                  EVAL      *IN94 = *ON
N17  C                   EVAL      *IN94 = *OFF
N23  C                   END
N06  C                   END
      *
     C     SIVKU         IFNE      0
     C     SIVALB        IFEQ      'P  '
     C                   Z-ADD     0             XWORK            19 6
     C                   ELSE
     C     SIVALB        IFEQ      SIVAL3
     C                   Z-ADD     SIBEL2        XWORK
     C                   ELSE
     C     SIBEL9        MULT      KVAOMR        XWORK
     C     XWORK         DIV(H)    SIVKU         XWORK
     C                   END
     C                   END
     C                   END
     C     SIFTG2        IFNE      '-'                                          B1
     C     SIFTG2        ANDNE     '+'
     C                   Z-ADD     SIBEL3        XBEL3
     C                   ELSE                                                   X1
     C     SIFTG2        IFEQ      '+'                                           B2
     C     SIBEL3        ADD(H)    XWORK         XBEL3            12 2
     C                   ELSE                                                    X2
     C     SIFTG2        IFEQ      '-'                                            B3
     C     SIBEL3        SUB(H)    XWORK         XBEL3
     C                   END                                                      E3
     C                   END                                                     E2
     C                   END                                                    E1
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Skrive tolldekl. til EDIFACT-fil                          /
      *////////////////////////////////////////////////////////////
     C     PRINT2        BEGSR
      * Skrive ut meldingshode til EDIFACT-fil
     C                   EXSR      UTHODE
      * Seksjonskille
     C                   EXSR      UNSD
N16  C                   IF        MVOGN = 'J' OR XTOTSLT = 'N' OR *IN41
      * Skrive ut fakturainfomasjoner
     C                   EXSR      DMS0
      * Skrive ut meldingsvarelinjer til EDIFACT-fil
     C                   EXSR      UTVLIN
N16  C                   ELSE
N16  C                   EVAL      *IN90 = *OFF
N16  C                   END
      * Seksjonskille
     C                   EXSR      UNSS
      * Skrive ut meldingssumlinje til EDIFACT-fil
     C  N41              EXSR      UTSUML
      *
     C   41              EXSR      CNT0M
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Skrive meldingshode til EDIFACT-fil                       /
      *////////////////////////////////////////////////////////////
     C     UTHODE        BEGSR
      * Tollstatus for gods
     C                   EXSR      CST0
      * Referanser
     C                   EXSR      RFF0
      * Stedsangivelse
     C                   EXSR      LOC0
      * Ønsket behandlingsdato, ekspedisjonsdato og bokføringsdato
     C                   EXSR      DTM0
      * Transportdetaljer
     C     *IN41         IFEQ      '0'
     C                   EXSR      TDT0
      * Generell indikator
     C                   EXSR      GIS0
     C                   END
      * Eksportør, mottaker, deklaranten, ekspedisjonsenhet hvor
      * deklatasjonen skal ekspederes og toll-/avgiftsbetaler
     C                   EXSR      NAD0
      * Kontaktinformasjon
     C                   EXSR      CTA0
      * Leveringsbetingelse
     C  N41              EXSR      TOD0
N83   * Relatert til midlertidig fortolling
N83  C  N41              IF        SITLE1 <> *BLANKS
N83  C                   EXSR      FTX0MO
N83  C                   END
N16   * Omberegning
N16  C                   IF        MTDN < 0
N16  C                   EXSR      FTX0
N16  C                   END
      * Fakturasum
     C  N41              EXSR      MOA0
      * Valuta
     C  N41              EXSR      CUX0
      *
     C                   ENDSR
      */////////////////////////////////////////////////////////////
      *                                                       UTVLIN
      */////////////////////////////////////////////////////////////
     C     UTVLIN        BEGSR
      *________________
      * Skriv dataliste
      *""""""""""""""""
     C     *IN41         IFEQ      '0'                                          1<-B
      *
     C                   MOVE      *ZEROS        XN2
     C                   MOVE      *ZEROS        XN3
     C     MVOGN         IFEQ      'J'
     C                   MOVE      *ZEROS        XNR                            ANT.POSTER
     C     SADV2K        SETLL     SADW
     C     SADV2K        READE     SADW                                   33
N16  C                   DOW       *IN33 = *OFF
N16  C                   IF        SVPREÆ = ' ' OR SVPREÆ = 'J'
N41  C                             OR SVPREÆ = 'N'
N16  C                   LEAVE
N16  C                   END
N16  C     SADV2K        READE     SADW                                   33
N16  C                   ENDDO
     C  N33              EXSR      MOVSWW
     C                   ELSE
     C     SADV2K        SETLL     WFILEIMP                           33
     C     SADV2K        READE     WFILEIMP                               33
N16  C                   DOW       *IN33 = *OFF
N16  C                   IF        WFITRP <> 'S'
N41  C                             AND WFITRP <> 'D'
N16  C                   LEAVE
N16  C                   END
N16  C     SADV2K        READE     WFILEIMP                               33
N16  C                   ENDDO
     C* N33              DELETE    WFILEIR
     C                   END
     C     STUDD         TAG
     C                   Z-ADD     0             XN3
     C                   MOVE      *BLANKS       Y1
     C                   MOVE      *BLANKS       E1
     C                   EXSR      REGN2
      * Tollstatus for gods
     C                   EXSR      CST0V
      * Forpakning
     C     MVOGN         IFEQ      'J'
     C                   EXSR      PAC0VB
     C                   ELSE
     C                   EXSR      PAC0V
     C                   END
      * Forpakningsidentifikasjon
     C     MVOGN         IFEQ      'J'
     C                   EXSR      PCI0VB
     C                   ELSE
     C                   EXSR      PCI0V
     C                   END
      * Oppringelseslandkode
     C                   EXSR      LOC0V
      * Tollverdi
     C     XBEL3         IFNE      0
     C                   EXSR      MOA0V
     C                   END
      * Vekt og annen enhet
     C                   EXSR      MEA0V
      * Avgifter
     C  N90              EXSR      TAX0V
      * Nødvendige dokumenter
     C                   EXSR      DCR0V
      * Godsbeskrivelse (TAD-kode)
     C                   EXSR      GDS0V
      * Godsbeskrivelse
     C     MVOGN         IFEQ      'J'
     C                   EXSR      FTX0VB
     C                   ELSE
     C                   EXSR      FTX0V
     C                   END
      *
     C     MVOGN         IFEQ      'J'
     C     SADV2K        READE     SADW                                   33
N16  C                   DOW       *IN33 = *OFF
N16  C                   IF        SVPREÆ = ' ' OR SVPREÆ = 'J'
N41  C                             OR SVPREÆ = 'N'
N16  C                   LEAVE
N16  C                   END
N16  C     SADV2K        READE     SADW                                   33
N16  C                   ENDDO
     C  N33              EXSR      MOVSWW
     C                   ELSE
     C     SADV2K        READE     WFILEIMP                               33
N16  C                   DOW       *IN33 = *OFF
N16  C                   IF        WFITRP <> 'S'
N41  C                             AND WFITRP <> 'D'
N16  C                   LEAVE
N16  C                   END
N16  C     SADV2K        READE     WFILEIMP                               33
N16  C                   ENDDO
     C* N33              DELETE    WFILEIR
     C                   END
     C  N33              GOTO      STUDD
      *
     C                   Z-ADD     1             XN4
S18  C*    XN4           DOWLT     16                                            2<-B
N18  C     XN4           DOWLT     38                                            2<-B
     C     T1(XN4)       IFEQ      *BLANKS                                        3<-B
     C                   GOTO      STUDD3
     C                   END                                                      3<-E
     C                   ADD       1             XN4
     C                   END                                                     2<-E
      *
     C     STUDD3        TAG
      *
S18  C*    T1(20)        IFNE      *BLANKS                                       2<-B
N18  C     T1(40)        IFNE      *BLANKS                                       2<-B
     C                   MOVE      'MV'          T1(XN4)
S18  C*                  MOVE      T2(20)        T2(XN4)
N18  C                   MOVE      T2(40)        T2(XN4)
     C                   END                                                     2<-E
      *
     C                   ELSE                                                   1
      *________________________________________________________
      * Skriv ut til EDIfact-file isteden for Print ved instikk
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""
      * Tollstatus for gods
     C                   EXSR      CST0M
      * Oppringelseslandkode
     C                   EXSR      LOC0M
      * Vekt og annen enhet
     C                   EXSR      MEA0M
      * Nødvendige dokumenter
     C                   EXSR      DCR0M
      * Godsbeskrivelse (TAD-kode)
     C                   EXSR      GDS0M
      * Godsbeskrivelse
     C                   EXSR      FTX0M
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Skrive ut meldingssumlinje til EDIFACT-fil                /
      *////////////////////////////////////////////////////////////
     C     UTSUML        BEGSR
      * Sum avgifter
     C  N90              EXSR      TAX0S
      * Kontroll totaler
     C                   EXSR      CNT0S
      *
     C                   ENDSR
      */////////////////////////////////////////////////////////////
      *                                                        FLYTT
      */////////////////////////////////////////////////////////////
     C     FLYTT         BEGSR
      *
     C                   ADD       1             XNR
     C                   Z-ADD     1             XN2
     C                   Z-ADD     1             XN3
     C                   EXSR      MOVBWF
      *
     C                   MOVE      SVTN          WFITN
     C                   MOVE      SVVNT         WFIVNT
     C                   MOVE      SVLK          WFILK
N51  C                   MOVE      SVDP          WFIDP
N89  C                   MOVE      SVDP2         WFIDP2
     C                   MOVE      SVPRE         WFIPRE
     C                   MOVE      SVVF          WFIVF
     C                   MOVE      SVAS          WFISAT
S92  C*                  MOVE      SVEH21        WFIPRO
N92  C                   IF        SVPVA = 'P'
N92  C                   EVAL      WFIPRO = '%'
N92  C                   ELSE
N92  C                   EVAL      WFIPRO = ' '
N92  C                   END
N16  C                   MOVE      SVPREÆ        WFITRP
     C                   MOVE      SVPVA         XPVA1             1
     C     SVMFR         IFEQ      'F'
     C                   MOVE      '1'           *IN34
     C                   MOVE      *BLANKS       WFISKV
     C                   ELSE
     C                   MOVEL     SVMFR         WFISKV
     C     SADSDK        SETLL     SADSD
     C     SADSDK        READE     SADSD                                  34
     C     *IN34         DOWEQ     '0'
S23  C*    SDDTF         IFLE      M0068A
S23  C*    SDDTT         ANDGE     M0068A
N23  C                   IF        SDDTF <= X_M0068A AND SDDTT >= X_M0068A
     C                   LEAVE
     C                   END
     C     SADSDK        READE     SADSD                                  34
     C  N34              ENDDO
     C     *IN34         IFEQ      '1'
     C     SVMFR         ANDEQ     '1'
     C     FITAX         MULT      100           SDBLSÆ
     C                   MOVE      '0'           *IN34
     C                   END
     C                   END
     C     *IN34         IFEQ      '0'
     C                   MOVE      SDBLSÆ        WFIMVS
     C                   ELSE
     C                   MOVE      *ZEROS        WFIMVS
     C                   END
     C                   MOVE      *BLANKS       Y2
     C                   MOVE      *BLANKS       E2
     C                   MOVE      *ZEROS        G2
     C                   MOVE      *ZEROS        S2
     C                   MOVE      *BLANKS       P2
     C                   MOVE      *ZEROS        B2
     C                   MOVE      *BLANKS       KN
     C                   MOVE      *ZEROS        WFIANT
     C                   MOVE      *ZEROS        WFINTM
     C                   MOVE      *BLANKS       WFIVT
N71  C                   MOVE      *ZEROS        XSAMLIN          13 2
      *
     C                   SELECT
     C     SVVNT         WHENGE    22030000
     C     SVVNT         ANDLE     22089999
      * ALKOHOL --> ALLTID KREVE AVGIFTER
     C                   MOVE      '0'           *IN94
     C                   MOVE      '1'           *IN92
     C     SVVNT         WHENGE    24010000
     C     SVVNT         ANDLE     24039999
      * TOBAKK  --> ALLTID KREVE AVGIFTER
     C                   MOVE      '0'           *IN94
     C                   MOVE      '1'           *IN92
     C     SVVNT         WHENGE    48130000
     C     SVVNT         ANDLE     48139999
      * TOBAKK  --> ALLTID KREVE AVGIFTER
     C                   MOVE      '0'           *IN94
     C                   MOVE      '1'           *IN92
     C                   ENDSL
      * HENTE JUSTERINGSBELØP
     C     SADVJK        CHAIN     SADVJ                              34
     C   34              MOVE      *ZEROS        SJBELN
      *
     C                   ENDSR
      */////////////////////////////////////////////////////////////
      *                                                       FLYTT2
      */////////////////////////////////////////////////////////////
     C     FLYTT2        BEGSR
      *
     C                   ADD       1             XN3
     C     XN3           MULT      8             XN4
     C     XN4           SUB       7             XN4
     C                   MOVE      SIAS          XSIAS             5 1
     C     1             DO        6             XN6
     C     Y2(XN6)       IFEQ      'TA'
     C                   MOVE      *ZEROS        SIAS
     C                   MOVE      *ZEROS        WFITRA
     C                   END
N64  C                   IF        XTOTTOLL < 50 AND %SUBST(SIRG:11:1) <> ' '
N80  C                             AND %SUBST(SIRG:11:1) <> 'B'                 PRIVAT
N64  C                             AND Y2(XN6) = 'RT'
N77  C                             AND UTBTAX0S <> 'J'
N64  C                   EVAL      WFISUM = WFISUM - B2(XN6)
N94  C                   IF        X_M0068A < X_PP50KR
N64  C                   EVAL      WFIMVG = WFIMVG - B2(XN6)
N94  C                   END
N64  C                   END
     C                   END
      *
      * N93, 94, 92 ---> KUN "TA" AVGIFT
      * N93,N94,N92 ---> "TA", "BV/TO" AVGIFTER
      *  93,N94,N92 ---> KUN "BV/TO" AVGIFTER
     C   92
     CAN 94
     CANN93
     CORN92
     CANN94              DO                                                     1<-B
     C  N94SIBELR        IFEQ      0
     C                   Z-ADD     WFISTB        WFIMVG
     C                   ELSE
     C                   Z-ADD     WFIBBL        WFIMVG
     C                   END
     C                   MOVE      *ZEROS        WFISUM
     C     1             DO        6             XN6                             2<-B
     C  N93Y2(XN6)       CABEQ     'TA'          STF201
N06  C     UTBTAX0S      CABEQ     'J'           STF201
     C  N94XTOTBV        IFGT      0                                              3<-B
     C     Y2(XN6)       CABEQ     'BV'          STF201
     C     Y2(XN6)       CABEQ     'EB'          STF201
     C     Y2(XN6)       CABEQ     'TO'          STF201
N82  C     Y2(XN6)       CABEQ     'OL'          STF201
      * AVGIFTER FRITATT FRA MVA-GR.LAG
     C                   MOVE      E2(XN6)       KS8SKV
     C                   MOVE      Y2(XN6)       KS8AVG
     C     KODS8K        CHAIN     KODTS8                             31
     C  N31KS8STA        CABEQ     'N'           STF201
     C                   MOVE      *BLANKS       KS8SKV
     C     KODS8K        CHAIN     KODTS8                             31
     C  N31KS8STA        CABEQ     'N'           STF201
     C     Y2(XN6)       CABEQ     'NA'          STF201
     C                   END                                                      3<-E
     C                   MOVE      *BLANKS       Y2(XN6)
     C                   MOVE      *BLANKS       E2(XN6)
     C                   MOVE      *ZEROS        G2(XN6)
     C                   MOVE      *ZEROS        S2(XN6)
     C                   MOVE      *BLANKS       P2(XN6)
     C                   MOVE      *ZEROS        B2(XN6)
     C     STF201        TAG
     C     Y2(XN6)       IFNE      'TA'                                           3<-B
     C     Y2(XN6)       ANDNE     *BLANKS
S80  C*                  IF        XTOTTOLL >= 50 OR %SUBST(SIRG:11:1) = ' '
N80  C                   IF        XTOTTOLL >= 50 OR
N80  C                             (%SUBST(SIRG:11:1) = ' ' OR                  FIRMA
N80  C                              %SUBST(SIRG:11:1) = 'B')
N64  C                             OR Y2(XN6) = 'RT'
N77  C                             OR UTBTAX0S <> 'J' AND %SUBST(SIRG:11:1)<>' '
N80  C                             AND %SUBST(SIRG:11:1) <> 'B'                 PRIVAT
     C                   ADD       B2(XN6)       WFISUM
N64  C                   END                                                       4<-E
      * AVGIFTER FRITATT FRA MVA-GR.LAG
     C                   MOVE      E2(XN6)       KS8SKV
     C                   MOVE      Y2(XN6)       KS8AVG
     C     KODS8K        CHAIN     KODTS8                             31
     C     *IN31         IFEQ      *ON                                             4<-B
     C     KS8STA        ORNE      'N'
     C                   MOVE      *BLANKS       KS8SKV
     C     KODS8K        CHAIN     KODTS8                             31
     C                   END                                                       4<-E
     C     *IN31         IFEQ      *OFF                                            4<-B
     C     KS8STA        ANDNE     'N'
S80  C*                  IF        XTOTTOLL >= 50 OR %SUBST(SIRG:11:1) = ' '        5<-B
N80  C                   IF        XTOTTOLL >= 50 OR
N80  C                             (%SUBST(SIRG:11:1) = ' ' OR                  FIRMA
N80  C                              %SUBST(SIRG:11:1) = 'B')
N64  C                             OR Y2(XN6) = 'RT'
N77  C                             OR UTBTAX0S <> 'J' AND %SUBST(SIRG:11:1)<>' '
N80  C                             AND %SUBST(SIRG:11:1) <> 'B'                 PRIVAT
N94  C                   IF        X_M0068A < X_PP50KR
     C                   ADD       B2(XN6)       WFIMVG
N94  C                   END
N64  C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      * DEKLARER TOLL DERSOM PVA IKKE="F"
     C     WFPVA         IFNE      'F'
     C                   MOVE      'TL'          Y1(XN4)
     C                   MOVE      '1  '         E1(XN4)
N36  C                   IF        (SIDP = 64 OR SIDP = 65 OR SIDP = 66)
N36  C                             AND WFIPRO = '%'
N90  C                             AND X_4SIFF > X_M0068A
S92  C*                            OR SIDP_4 = 6021
N92  C                             OR SIDP_4 = 6021 AND WFIPRO = '%'
N36  C                   EVAL      WFISUM = WFISUM - WFITOL
N36  C                   EVAL      WFIMVG = WFIMVG - WFITOL
N36  C                   EVAL      WFITLG = WFIBBL
N36  C                   EVAL(H)   WFITOL = WFITLG * WFISAT / 100
N36  C                   EVAL      WFISUM = WFISUM + WFITOL
N36  C                   EVAL      WFIMVG = WFIMVG + WFITOL
N36  C                   END
     C                   Z-ADD     WFITLG        G1(XN4)
     C                   Z-ADD     WFISAT        S1(XN4)
     C                   MOVE      WFIPRO        P1(XN4)
     C                   MOVE      WFITOL        B1(XN4)
     C  N92
     CANN94              ADD       WFITOL        WFIMVG
     C                   MOVE      *BLANKS       TR(XN4)
     C                   ADD       1             XN4
     C                   END
N64  C     XTOTTOLL      IFLT      50
N64  C     XAN01         ANDNE     ' '
N80  C     XAN01         ANDNE     'B'
JOV  C**   X_M0068A      ANDGE     X350_DT
N64  C     wfivnt        iflt      22030000
N73  C     wfivnt        orgt      22089999
N73  C     wfivnt        andlt     24010000
N73  C     wfivnt        orgt      24039999
N73  C     wfivnt        andlt     28130000
N73  C     wfivnt        orgt      28139999
N77  C                   IF        UTBTAX0S <> 'J'
N94  C                   IF        X_M0068A < X_PP50KR
N64  C                   SUB       WFITOL        WFIMVG
N94  C                   END
N64  C                   SUB       WFITOL        WFISUM
N77  C                   END
N73' C                   END
N64  C                   END
      * Selv ved TA mindre enn 5 (93 ON) skal den oppgis på linjenivå
      * Det er sats > 0 som er avgjørende, IKKE beløp > 0
N33  C                   IF        SIDP = 49
N51  C                             OR WFIDP = 49
N91  C*                            OR SIDP_4 = 4171
N91  C*                            OR WFIDP_4 = 4171
N91  C                             OR SIKUNS = 1
N33   * WFIBBL = STATISTISK VERDI, WFITRA = FRAKT OG ANDREKOSTNAD
N33   * PROSEDYRE 49 --> BENYTTE 20% AV STATISTISK VERDI
N33  C                   EVAL(H)   VFIMVG = WFIBBL * 0.2
N33  C                   ELSE
E39  C                   Z-ADD     WFIMVG        VFIMVG           11 0
N33  C                   END
S16  C*    SIAS          IFGT      0
S16  C*                  MOVE      'TA'          Y1(XN4)
S16  C*                  MOVE      '1  '         E1(XN4)
S16  C*                  Z-ADD     WFITRG        G1(XN4)
S16  C*                  Z-ADD     SIAS          S1(XN4)
S16  C*                  MOVE      WFITRP        P1(XN4)
S16  C*                  MOVE      WFITRA        B1(XN4)
S16  C*                  ADD       1             XN4
S16   * VFIMVG er grunnlag uavhengig av TA < 5 (benyttes på linjenivå)
S16   * WFIMVG er justert for TA kun når TA > 5 (benyttes på totalnivå)
S16  C* N93              ADD       WFITRA        WFIMVG
S16  C* N93              ADD       WFITRA        WFISUM
S16  C*                  ADD       WFITRA        VFIMVG
S16  C*                  END
      *
     C                   Z-ADD     1             XN6               1 0
     C     XN6           DOWLE     6
     C     Y2(XN6)       IFNE      *BLANKS
     C     Y2(XN6)       IFEQ      'TA'
      * Trafikkavgift skal angis/inngå i Tollgrunnlag på enkeltlinjer
      * selv om TA er under 5 kr (VFIMVG=grl. detalj WFIMVG=grl. total)
     C                   ADD       B2(XN6)       VFIMVG
     C  N93
     CANN94              ADD       B2(XN6)       WFIMVG
     C  N93              ADD       B2(XN6)       WFISUM
     C                   ELSE
     C                   MOVE      *BLANKS       TR(XN4)
     C                   END
     C                   MOVE      Y2(XN6)       Y1(XN4)
     C                   MOVE      E2(XN6)       E1(XN4)
     C                   MOVE      G2(XN6)       G1(XN4)
     C                   MOVE      S2(XN6)       S1(XN4)
     C                   MOVE      P2(XN6)       P1(XN4)
     C                   Z-ADD     B2(XN6)       B1(XN4)
     C                   ADD       1             XN4
     C                   END
     C                   ADD       1             XN6
     C                   END
      *
     C     WFISKV        IFNE      *BLANKS
     C     WFIMVG        MULT(H)   WFIMVS        XWORK2
     C     XWORK2        DIV(H)    100           WFIMVA
E39  C     VFIMVG        MULT(H)   WFIMVS        XWORK2           13 0
E39  C     XWORK2        DIV(H)    100           VFIMVA           11 0
N33  C                   IF        SIDP = 49
N51  C                             OR WFIDP = 49
N91  C*                            OR SIDP_4 = 4171
N91  C*                            OR WFIDP_4 = 4171
N91  C                             OR SIKUNS = 1
N33  C                   EVAL      WFIMVA = VFIMVA
N33  C                   END
     C                   Z-ADD     WFIMVS        S1(XN4)
N64  C                   EVAL      XAN01 = %SUBST(SIRG:11:1)
     C   92
     CAN 94
     CANN93
     CORN92
     CANN94WFPVA         IFNE      'F'
     C                   ADD       WFITOL        WFISUM
     C                   END
     C  N94              ADD       WFIMVA        WFISUM
N64  C   94XAN01         IFNE      ' '
N80  C     XAN01         ANDNE     'B'                                          PRIVAT
N64  C     X_M0068A      ANDGE     X350_DT
N64  C                   ADD       WFIMVA        WFISUM
N64  C                   END
     C                   MOVE      'MV'          Y1(XN4)
     C                   MOVE      WFISKV        E1(XN4)
      * På detaljnivå er det Tolgrl ink evt TA<5 som benyttes
     C                   Z-ADD     VFIMVG        G1(XN4)
     C                   MOVE      '%'           P1(XN4)
      * På detaljnivå er det Toll med evt.TA<5 som grunnlag som brukes
     C                   MOVE      VFIMVA        B1(XN4)
     C                   MOVE      *BLANKS       TR(XN4)
     C                   END
      *
     C                   MOVE      XSIAS         SIAS
      *
     C                   ENDSR
N13   */////////////////////////////////////////////////////////////
N13   *                                                        REGN
N13   */////////////////////////////////////////////////////////////
N13  C     AVRUND        BEGSR
N13   *
N13  C                   EVAL      KS8AVG = Y2(XN4)
N13  C                   EVAL      KS8SKV = E2(XN4)
N29  C                   IF        KS8AVG <> 'TL'
N31  C                             AND KS8AVG = 'TL'
N31   * AVGIFTGRUNNLAG MED 2 DESIMALER GODTAS
E39  C                   Z-ADD(H)  G2(XN4)       XN09             11 0
N24  C                   IF        XN09 = 0
N21  C                   EVAL      G2(XN4) = 1
N24  C                   ELSE
N21  C                   EVAL      G2(XN4) = XN09
N24  C                   END
N29  C                   END
N13  C     KODS8K        CHAIN     KODTS8                             31
N13  C  N31              SELECT
N13  C                   WHEN      KS8STY = '%' OR
N13  C                             KS8STY = 'H' OR
N13  C                             KS8STY = '*'
N13  C                   IF        KS8ØRE = '*'
N13  C                   EVAL      XWORK = G2(XN4) * S2(XN4) / 10000
N13  C                   ELSE
N13  C                   EVAL      XWORK = G2(XN4) * S2(XN4) / 100
N13  C                   END
N13  C                   WHEN      KS8STY = 'P'
N13  C                   IF        KS8ØRE = '*'
N13  C                   EVAL      XWORK = G2(XN4) * S2(XN4) / 100000
N13  C                   ELSE
N13  C                   EVAL      XWORK = G2(XN4) * S2(XN4) / 1000
N13  C                   END
N13  C                   WHEN      KS8STY = ' ' OR
N13  C                             KS8STY = 'P' OR
N13  C                             KS8STY = 'K' OR
N13  C                             KS8STY = 'G' OR
N13  C                             KS8STY = 'M' OR
N13  C                             KS8STY = 'D' OR
N13  C                             KS8STY = 'T' OR
N13  C                             KS8STY = 'L' OR
N13  C                             KS8STY = 'A' OR
N13  C                             KS8STY = 'B'
N13  C                   IF        KS8ØRE = '*'
N13  C                   EVAL      XWORK = G2(XN4) * S2(XN4) / 100
N13  C                   ELSE
N13  C                   EVAL      XWORK = G2(XN4) * S2(XN4)
N13  C                   END
N13  C                   ENDSL
S19  C*                  MOVE      XWORK         XAN06             6
S19  C*                  IF        *IN31 = *OFF AND XAN06 < '500000'
S19  C*                  Z-ADD     B2(XN4)       XAVG              9 0
N19  C                   IF        *IN31 = *OFF
E39  C                   Z-ADD(H)  XWORK         XAVG             11 0
N13  C                   ELSE
N13  C                   Z-ADD(H)  B2(XN4)       XAVG
N13  C                   END
N13   *
N13  C                   ENDSR
N13   *
      */////////////////////////////////////////////////////////////
      *                                                        REGN
      */////////////////////////////////////////////////////////////
     C     REGN          BEGSR
N12  C                   IF        WFIVKB123 < 0.5
N12  C                   Z-ADD     1             WFIVKB
N12  C                   ELSE
N12  C                   ADD       0,5           WFIVKB123
N12  C                   END
N12  C                   IF        WFIVKN123 < 0.5
N12  C                   Z-ADD     1             WFIVKN
N12  C                   ELSE
N12  C                   ADD       0,5           WFIVKN123
N12  C                   END
N12   *
     C     SIBELR        IFNE      0
     C     XTVF2         MULT(H)   XBELR2        WFIBBL
     C                   END
      *
E39  C                   MOVE      *ZEROS        XECEI            11 0
     C                   ADD       0.5           XWFTLG
     C                   ADD       0.5           XWFSTB
      * AVRUNDING VIA DATASTRUKTUR
     C                   Z-ADD     1             XN4
     C     XN4           DOWLE     6
     C     B2(XN4)       IFNE      0
E39  C                   Z-ADD(H)  B2(XN4)       XAVG             11 0
S19  C*                  MOVE      B2(XN4)       XAN02             2
S19  C*                  IF        XAN02 = '50'
N13  C                   EXSR      AVRUND
S19  C*                  END
     C                   Z-ADD     XAVG          B2(XN4)
     C                   END
     C                   ADD       1             XN4
     C                   END
N03   * ADDERE JUSTERINGSBELØP
S48  C*                  ADD       SJBELN        WFITLG
     C                   MOVE      *ZEROS        XWFTOL
     C     XPVA1         IFEQ      'P'
     C     WFITLG        MULT      WFISAT        XWORK
     C     XWORK         DIV(H)    100           XWFTOL
     C                   END
     C     XPVA1         IFEQ      'V'
     C     WFIVKN        MULT      WFISAT        XWFTOL
     C                   END
     C     XPVA1         IFEQ      'W'
     C     WFIVKN        MULT      WFISAT        XWFTOL
     C                   DIV(H)    100           XWFTOL
     C                   END
     C     XPVA1         IFEQ      'A'
     C     WFINTM        MULT      WFISAT        XWFTOL
     C                   END
     C                   ADD       0.5           XWFTOL
N64  C                   ADD       WFITOL        XTOTTOLL
N64  C     1             DO        7             XN4
N64  C                   IF        Y2(XN4) = 'RT'
N64  C                   ADD       B2(XN4)       XTOTTOLL
N64  C                   END
N64  C                   ENDDO
S16   *
     C                   MOVE      *ZEROS        XTRAVG            9 0
S16  C*    SIKDTR        IFEQ      *BLANKS
S16  C*    WFIVKN        DIV       1000          XTRAV2           11 3
S16  C*                  MOVE      *BLANKS       WFITRP
S16  C*                  Z-ADD     WFIVKN        WFITRG
S16  C*                  ELSE
S16  C*    WFITLG        DIV       100           XTRAV2
S16  C*                  Z-ADD     WFITLG        WFITRG
S16  C*                  MOVE      '%'           WFITRP
S16  C*                  END
S16  C*    XTRAV2        MULT(H)   SIAS          WFITRA
      *
     C                   MOVE      *ZEROS        WFIMVG
     C                   Z-ADD     1             XN4
      *
     C     XN4           DOWLE     6
     C     Y2(XN4)       IFEQ      'TA'
     C                   Z-ADD     B2(XN4)       XTRAVG
     C                   MOVE      *ZEROS        WFITRA
     C                   ELSE
     C     Y2(XN4)       IFEQ      'BV'                                           3<-B
     C     Y2(XN4)       OREQ      'TO'
N82  C     Y2(XN4)       OREQ      'OL'
     C                   ADD       B2(XN4)       XTOTBV
     C                   END                                                      3<-E
      *
      * AVGIFTER FRITATT FRA MVA-GR.LAG
     C                   MOVE      E2(XN4)       KS8SKV
     C                   MOVE      Y2(XN4)       KS8AVG
     C     KODS8K        CHAIN     KODTS8                             31
     C     *IN31         IFEQ      *OFF
     C     KS8STA        ANDEQ     'N'
     C                   ADD       B2(XN4)       XECEI
     C                   ELSE
     C                   MOVE      *BLANKS       KS8SKV
     C     KODS8K        CHAIN     KODTS8                             31
     C     *IN31         IFEQ      *OFF
     C     KS8STA        ANDEQ     'N'
     C                   ADD       B2(XN4)       XECEI
     C                   END
     C                   END
     C                   ADD       B2(XN4)       WFIMVG
     C                   END
     C                   ADD       1             XN4
     C                   END
      *
S16  C*                  ADD       XTRAVG        WFITRA
S16  C*                  Z-ADD     WFITRA        XTRAVG
S16  C*                  ADD       WFITRA        SIBELT
      * 38 PÅ = TOLLFRANKO
     C   38              DO
     C     WFITLG        SUB       XTRAVG        XHELP             9 0
     C     WFITLG        SUB       WFISTB        WFIJUS
     C     WFIJUS        SUB       XTRAVG        WFIJUS
      *  WFISAT PÅ F.EKS 25,75  LEGGES I ARB.FELT SOM 1.2575
      *  FOR Å KUNNE TREKKE UT TOLL SOM ALT ER INNKALK. I HAND.FAKTURA.
      * VERDITOLL
     C  N52              MOVE      WFISAT        XTSATS            7 4
     C  N52              ADD       1             XTSATS
     C  N52XHELP         DIV(H)    XTSATS        WFITLG
     C  N52WFITLG        MULT(H)   WFISAT        WFITOL
     C  N52              DIV(H)    100           WFITOL
      * VEKTTOLL
     C   52WFIVKN        MULT(H)   WFISAT        WFITOL
     C   52XHELP         SUB       WFITOL        WFITLG
     C     WFIJUS        SUB       WFITOL        WFIJUS
     C     WFIJUS        IFLT      0
     C                   MULT      -1            WFIJUS
     C                   MOVE      '-'           WFIFTG
     C                   ELSE
     C                   MOVE      *BLANKS       WFIFTG
     C                   END
     C                   END
N33   *
N33  C  N38              IF        SIDP = 49
N51  C                             OR WFIDP = 49
N91  C*                            OR SIDP_4 = 4171
N91  C*                            OR WFIDP_4 = 4171
N91  C                             OR SIKUNS = 1
N33   * MIDLETIDIG LAGRING AV VERDIER
N33  C*                  ADD       X50           X_XWFTLG
N33  C*                  ADD       X50           X_XWFSTB
N48  C                   ADD       0.5           X_XWFTLG
N48  C                   ADD       0.5           X_XWFSTB
N33  C                   EVAL      WFITRA = X_XWFTLG - X_XWFSTB                 WFIJUS
N33  C                   Z-ADD     X_XWFTLG      WFIBBL                         WFISTB
N33  C                   Z-ADD     X_XWFTLG      XWFTLG
N33  C                   END
S03   * ADDERE JUSTERINGSBELØP
S03  C*                  ADD       SJBELN        WFITLG
N48  C                   ADD       SJBELN        WFITLG
      *
     C  N38WFITLG        IFGE      WFISTB
     C                   MOVE      *BLANKS       WFIFTG
     C     WFITLG        SUB       WFISTB        WFIJUS
     C                   ELSE
     C                   MOVE      '-'           WFIFTG
     C     WFISTB        SUB       WFITLG        WFIJUS
     C                   END
      *
     C                   Z-ADD     WFITLG        WFISTB
     C                   ADD       WFITOL        WFIMVG
     C                   Z-ADD     WFIMVG        WFISUM
     C     SIBELR        IFEQ      0
     C                   ADD       WFITLG        WFIMVG
     C                   ELSE
     C                   ADD       WFIBBL        WFIMVG
     C                   END
     C                   SUB       XECEI         WFIMVG
     C   52              Z-ADD     WFIVKN        WFITLG
     C   53              Z-ADD     XNTM          WFITLG
     C                   Z-ADD     SIAVD         WFAVD
     C                   Z-ADD     SITDN         WFTDN
     C                   MOVE      XNR           WFIRNR
     C                   MOVE      XPVA1         WFPVA
S78   *
S78  C*  49              IF        SIUR = 'F'
S78  C*                  EXSR      UTBL
S78  C*                  EVAL      *IN49 = *OFF
S78  C*                  END
      * Fyll ut default-verdier hvis blank.
     C                   MOVE      '0'           *IN34
S12  C*    BLAN17        LOOKUP    KN                                 34
N12  C     BLAN28        LOOKUP    KN                                 34
     C  N34              MOVEL     'ADR'         KN(1)
      *
     C     WFIVT         IFEQ      *BLANKS
     C                   MOVEL     'EX'          WFIVT
     C                   END
      *
     C                   MOVE      '0'           *IN34
S12  C*    BLAN15        LOOKUP    VB                                 34
S12  C* N34TARIK         CHAIN     TARI                               34
S12  C* N34              MOVEL     TAALFA        VB(1)
N12  C     BLAN30        LOOKUP    VB                                 34
N12  C                   IF        *IN34 = *OFF
N12  C     WFIVNT        CHAIN     SOKTARI2                           34
N12  C                   IF        *IN34
N12  C     TARIK         CHAIN     TARI                               34
N12  C  N34              EVAL      VB(1) = TAALFA
N12  C                   ELSE
N12  C                   EVAL      VB(1) = BESKR1
N12  C                   END
N12  C                   END
      * Ordne justering og vekt
S12  C*                  ADD       SVVKTB        XTVKTB
N12  C                   ADD       WFIVKB        XTVKTB
N71  C                   IF        SIDP <> 49 AND SIDP <> 64 AND SIDP <> 65
N71  C                             AND SIDP <> 66
N90  C                             AND SIDP_4 <> 6021
N91  C*                            AND SIDP_4 <> 4171
N91  C                             AND SIKUNS <> 1
N71  C                             AND (SIFTG2 = '+' OR SIFTG2 = '-')
N71   * KUN FORSIKRING ER JUSTERING. FRAKT OG ANDRE KOSTNAD ER ALLEREDE MED FAKTURASUM
N71  C                   EVAL(H)   WFIJUS = XSAMLIN * SIBELA / SIBEL3
N71  C                   MOVE      ' '           WFIFTG
N71  C                   ADD       WFIJUS        XTJUS
N71  C                   ELSE
N71   * ELLERS SOM FØR
     C     SIFTG2        IFEQ      '-'
     C     SIFTG2        OREQ      'M'
     C                   SUB       WFIJUS        XTJUS
     C                   ELSE
     C                   ADD       WFIJUS        XTJUS
     C                   END
N71  C                   END
N40   *
N40  C                   IF        WFITOL > 0
N40  C                   EVAL      X_TOLLAVG = 'J'
N40  C                   ELSE
N40  C     1             DO        7             XN4
N40  C                   IF        B2(XN4) <> 0
N40  C                   EVAL      X_TOLLAVG = 'J'
N40  C                   LEAVE
N40  C                   END
N40  C                   ENDDO
N40  C                   END
      *
     C     WFKEY         CHAIN     WFILEIMP                           34
     C   34              WRITE     WFILEIR
N94   *
N94  C                   IF        X_M0068A >= X_PP50KR
N94  C                   EVAL(H)   XTOTTOLL = XTOTTOLL + WFIMVG * WFIMVS / 100
N94  C                   END
N94   *
N81  C                   IF        WFIRNR = 9999
N81   * AVSLUTT PROGRAM PGA. FOR MANGE LINJER
N81  C                   EXSR      SRERROR
N95  C     MMN           CHAIN     EDIM
N95  C                   IF        %FOUND
S95  C*                  MOVE      'X'           MST
N95  C                   MOVE      'X'           MX_MST
S95  C*                  UPDATE    EDIMR
N95  C                   UPDATE    EDIMRX
N95  C                   ENDIF
N81  C                   MOVE      'X'           SST
N81  C                   UPDATE    EDISR
N81  C                   EVAL      *INLR = *ON
N81  C                   RETURN
N81  C                   END
      *
     C                   Z-ADD     WFIMVG        XTOT10           13 2
     C     WFIMVG        ADD       WFITRA        XTOT20           13 2
     C     WFISKV        IFNE      *BLANKS
N52  C     SIMVA         ANDEQ     'N'
N52  C     WFISKV        ORNE      *BLANKS
N52  C     SIMVA         ANDEQ     ' '
     C                   MULT(H)   WFIMVS        XTOT10
     C                   MULT(H)   WFIMVS        XTOT20
     C                   DIV(H)    100           XTOT10
     C                   DIV(H)    100           XTOT20
N56  C                   IF        SIDP = 49 OR SVDP = 49
N91  C*                            OR SIDP_4 = 4171 OR SVDP_4 = 4171
N91  C                             OR SIKUNS = 1
N56  C                   EVAL(H)   XTOT1 = XTOT1 + XTOT10 * 0,2
N56  C                   EVAL(H)   XTOT2 = XTOT2 + XTOT20 * 0,2
N56  C                   ELSE
     C                   ADD       XTOT10        XTOT1
     C                   ADD       XTOT20        XTOT2
N56  C                   END
     C                   END
S86  C*                  IF        SVPREÆ <> 'S'
N86  C                   IF        WFITRP <> 'S' AND WFITRP <> 'D'
     C                   ADD       WFITRA        XTOT2
     C                   ADD       WFISUM        XTOT1
     C                   ADD       WFISUM        XTOT2
N74  C                   END
      *
     C                   ENDSR
S78   ******************************************
S78  C*    UTBL          BEGSR
S78   ******************************************
S78  C*                  Z-ADD     1             XN2
S78  C*                  DOW       XN2 <= 7                                     1<-B
S78  C*                  IF        KN(XN2) = *BLANKS                             2<-B
S78  C*                  GOTO      STUBL1
S78  C*                  ELSE                                                    2
S78  C*                  ADD       1             XN2
S78  C*                  END                                                     2<-E
S78  C*                  END                                                    1<-E
S78  C*    STUBL1        TAG
S78  C*                  Z-ADD     1             XN3
S78  C*                  DOW       XN3 <= 10                                    1<-B
S78  C*                  IF        TO(XN3) = *BLANKS                             2<-B
S78  C*                  GOTO      STUBL2
S78  C*                  ELSE                                                    2
S78  C*                  ADD       1             XN3
S78  C*                  END                                                     2<-E
S78  C*                  END                                                    1<-E
S78   *
S78  C*    STUBL2        TAG
S78  C*                  Z-ADD     1             UN2               2 0
S78   *
S78  C*                  DOW       UN2 <= UNR                                   1<-B
S78  C*                  IF        XN2 <= 7                                      2<-B
S78  C*                  Z-ADD     1             XN4
S78  C*                  DOW       XN4 <= 7                                       3<-B
S78  C*                  IF        MN(UN2) = KN(XN4)                               4<-B
S78  C*                  GOTO      STUBL3
S78  C*                  END                                                       4<-E
S78  C*                  ADD       1             XN4
S78  C*                  END                                                      3<-E
S78  C*                  EVAL      KN(XN2) = MN(UN2)
S78  C*                  ADD       1             XN2
S78  C*                  ELSE                                                    2
S78  C*                  IF        XN3 <= 10                                      3<-B
S78  C*                  EVAL      TO(XN3) = MN(UN2)
S78  C*                  ADD       1             UN2
S78  C*                  IF        UN2 > UNR                                       4<-B
S78  C*                  GOTO      SLUBL
S78  C*                  END                                                       4<-E
S78  C*                  EVAL      TO(XN3) = MN(UN2)
S78  C*                  ADD       1             XN3
S78  C*                  ELSE                                                     3
S78  C*                  GOTO      SLUBL
S78  C*                  END                                                      3<-E
S78  C*                  END                                                     2<-E
S78  C*    STUBL3        TAG
S78  C*                  ADD       1             UN2
S78  C*                  END                                                    1<-E
S78   *
S78  C*    SLUBL         ENDSR
S78   *
      */////////////////////////////////////////////////////////////
      *                                                        REGN2
      */////////////////////////////////////////////////////////////
      * Summerer avgifter av samme type for SUM pr type
     C     REGN2         BEGSR
     C                   EXSR      FLYTT2
      *
S80  C*                  IF        %SUBST(SIRG:11:1) = ' ' AND SIBEL4 < 350
N80  C                   IF        (%SUBST(SIRG:11:1) = ' ' OR                  FIRMA
N80  C                              %SUBST(SIRG:11:1) = 'B')
N80  C                             AND SIBEL4 < 350
N64  C                             AND X_M0068A >= X350_DT
N69  C                             AND X_M0068A < X350_FIRMA
N64  C                             AND X_NMIDDEL = 'J' AND
N64  C                             XTOT2 < 50
S80  C*                            OR %SUBST(SIRG:11:1) = ' ' AND SIBEL4 < 350
N80  C                             OR (%SUBST(SIRG:11:1) = ' ' OR               FIRMA
N80  C                                 %SUBST(SIRG:11:1) = 'B')
N80  C                             AND SIBEL4 < 350
N64  C                             AND X_M0068A >= X350_DT
N69  C                             AND X_M0068A < X350_FIRMA
N64  C                             AND X_NMIDDEL <> 'J'
N64  C                   ELSE
     C                   ADD       WFISUM        SIBEL7
S18  C* N94              ADD       WFITOL        T2(19)
N18  C  N94              ADD       WFITOL        T2(39)
S77  C*                  IF        XTOTTOLL > 50 OR %SUBST(SIRG:11:1) = ' '
N77  C                   IF        XTOTTOLL > 50 AND X_NMIDDEL = 'N'
N94  C                             OR XTOTTOLL > 50 AND X_NMIDDEL = 'J'
N77  C                             OR %SUBST(SIRG:11:1) = ' '
N80  C                             OR %SUBST(SIRG:11:1) = 'B'                   FIRMA
     C                   ADD       WFITOL        XBEL5
N64  C                   END
      *
     C     WFIMVA        IFNE      0
S18  C* N94              ADD       WFIMVA        T2(20)
N18  C  N94              ADD       WFIMVA        T2(40)
N64  C   94XAN01         IFNE      ' '
N80  C     XAN01         ANDNE     'B'                                          PRIVAT
N64  C     X_M0068A      ANDGE     X350_DT
N64  C                   ADD       WFIMVA        T2(40)
N64  C                   END
     C                   ADD       WFIMVA        XBEL6
S18  C*                  MOVE      'MV'          T1(20)
N18  C                   MOVE      'MV'          T1(40)
     C                   END
N64  C                   END
      *
     C                   Z-ADD     7             XN6
     C     WFITOL        IFNE      0
     C  N94              Z-ADD     WFITOL        B2(XN6)
     C   94              MOVE      *ZEROS        B2(XN6)
     C                   MOVE      'TL'          Y2(XN6)
     C                   MOVE      '1  '         E2(XN6)
     C                   EXSR      TYPLIK
     C                   END
      *
     C  N93SIAS          IFGT      0
     C                   MOVE      'TA'          Y2(XN6)
     C                   MOVE      '1  '         E2(XN6)
     C                   Z-ADD     WFITRA        B2(XN6)
     C                   EXSR      TYPLIK
     C                   END
      *
     C                   Z-ADD     1             XN6
     C     XN6           DOWLE     6
     C     Y2(XN6)       IFEQ      *BLANKS
     C                   GOTO      SLREGN
     C                   END
     C     Y2(XN6)       IFEQ      'TA'
     C                   END
     C                   EXSR      TYPLIK
     C                   END
      *
     C     SLREGN        ENDSR
      */////////////////////////////////////////////////////////////
      *                                                       TYPLIK
      */////////////////////////////////////////////////////////////
     C     TYPLIK        BEGSR
      *
     C                   Z-ADD     1             XN4
S18  C*    XN4           DOWLE     16
N18  C     XN4           DOWLE     38
     C     T1(XN4)       IFEQ      *BLANKS
     C     T1(XN4)       OREQ      Y2(XN6)
     C                   GOTO      SLTYPL
     C                   END
     C                   ADD       1             XN4
     C                   END
      *
     C     SLTYPL        TAG
S18  C*    XN4           IFLE      15
N18  C     XN4           IFLE      37
N64  C                   IF        XTOTTOLL >= 50 OR %SUBST(SIRG:11:1) = ' '
N80  C                             OR %SUBST(SIRG:11:1) = 'B'
N64  C                             OR Y2(XN6) <> 'RT' AND Y2(XN6) <> 'TL'
N77  C                             OR XTOTTOLL < 50 AND UTBTAX0S = 'J'
     C                   MOVE      Y2(XN6)       T1(XN4)
     C                   ADD       B2(XN6)       T2(XN4)
N64  C                   END
     C                   END
     C                   ADD       1             XN6
      *
     C                   ENDSR
      */////////////////////////////////////////////////////////////
      *                                                       MOVSWW
      */////////////////////////////////////////////////////////////
     C     MOVSWW        BEGSR
     C                   ADD       1             XNR
      * TØM VARIABLER FOR WFILEIMP
     C                   EXSR      MOVBWF
      * FLYTTE FRA MOTORV.FORTOLLING TIL VARIABLER FOR WFILEIMP
     C                   MOVE      SWAVD         WFAVD
     C                   MOVE      SWTDN         WFTDN
     C                   MOVE      SWLI          WFIRNR
     C                   MOVE      SWVNT         WFIVNT
     C                   MOVE      SWTN          WFITN
     C                   MOVE      SWLK          WFILK
S12  C*                  MOVE      SWVKTB        WFIVKB
S12  C*                  MOVE      SWVKTN        WFIVKN
N12  C                   Z-ADD     SWVKTB        WFIVKB
N12  C                   Z-ADD     SWVKTN        WFIVKN
     C                   MOVE      SWPRE         WFIPRE
S14  C*                  MOVE      SWNTM         WFINTM
N14  C                   Z-ADD     SWNTM         WFINTM
     C                   MOVE      SWPVA         WFPVA
     C                   MOVE      *BLANKS       WFISKV
     C                   MOVE      *ZEROS        WFIMVS
     C     SWMFR         IFNE      'F'
     C                   MOVEL     SWMFR         WFISKV
     C     SADSDK        SETLL     SADSD
     C     SADSDK        READE     SADSD                                  34
     C     *IN34         DOWEQ     '0'
S23  C*    SDDTF         IFLE      M0068A
S23  C*    SDDTT         ANDGE     M0068A
N23  C                   IF        SDDTF <= X_M0068A AND SDDTT >= X_M0068A
     C                   LEAVE
     C                   END
     C     SADSDK        READE     SADSD                                  34
     C  N34              ENDDO
     C   34SWMFR         IFEQ      '1'
     C     FITAX         MULT      100           SDBLSÆ
     C                   MOVE      '0'           *IN34
     C                   END
     C  N34              MOVE      SDBLSÆ        WFIMVS
     C                   END
     C                   MOVE      SWVF          WFIVF
     C                   MOVE      SWWJUS        WFIJUS
     C                   MOVE      SWWFTG        WFIFTG
     C                   MOVE      SWBELS        WFISTB
     C                   MOVE      SWWMVA        WFIMVA
     C                   MOVE      SWWMVG        WFIMVG
     C                   MOVE      SWWTOL        WFITOL
     C                   MOVE      SWWTLG        WFITLG
     C     XTVF2         MULT(H)   SWBELT        WFIBBL
     C                   MOVE      SWWTRA        WFITRA
     C                   MOVE      SWWSAT        WFISAT
     C                   MOVE      SWWSUM        WFISUM
      * SIKRE AT SÆRAVGIFTENE LIGGER I TOPPEN AV ARRAYENE Y2,G2,S2....
     C                   MOVE      *ZEROS        W2                1 0
     C     1             DO        5             W1                1 0
     C     Y2W(W1)       IFNE      '  '
     C                   ADD       1             W2
     C                   MOVE      Y2W(W1)       Y2(W2)                           AVG.TYPE
     C                   MOVE      E2W(W1)       E2(W2)                           AVG.SEKVEN
     C                   Z-ADD     G2W(W1)       G2(W2)                           GRUNNLAG
     C                   Z-ADD     S2W(W1)       S2(W2)                           SATS
     C                   MOVE      P2W(W1)       P2(W2)                           SATSTYPE
     C                   Z-ADD     B2W(W1)       B2(W2)                           AVG.BELØP
     C                   END
     C                   END
      *
     C                   MOVE      SWWPRO        WFIPRO
     C*MERKE/NR - GÅR SOM PCI - KUN CIFVERDI.MM. HÅNDTERES I PCI0VB
     C*ANTAL/MERKE GÅR SOM PAC                   HÅNDTERES I PAC0VB
     C*VEKT/EFFEKT/KUB+++ GÅR SOM FTX            HÅNDTERES I FTX0VB
     C* CHASSISNR M.M. HÅNDTERES SOM VANLIG R.44.
     C                   MOVEL     SWR441        WFITO1
     C                   MOVEL     SWR442        WFITO2
     C                   MOVEL     SWR443        WFITO3
     C                   MOVEL     SWR444        WFITO4
     C                   MOVEL     SWR445        WFITO5
     C                   MOVE      SWREF1        WFITC1
     C                   MOVE      SWREF2        WFITC2
     C                   MOVE      SWREF3        WFITC3
     C                   MOVE      SWREF4        WFITC4
     C                   MOVE      SWREF5        WFITC5
     C* UDEF I SADW..      MOVE SWITRG    WFITRG
     C*  --- " ----        MOVE SWITRP    WFITRP
     C* DIV. FELT LEGGES I STRENGER VIA DATASTRUKTURER
     C                   MOVE      'V'           DSV
     C                   MOVE      'E'           DSE
     C                   MOVE      'K'           DSK
     C                   MOVE      'C'           DSC
     C                   MOVE      '%'           DSPROT
      *
     C                   MOVE      *ZEROS        BILNUM            6
     C     SWVK66        IFEQ      *ZEROS
     C                   MOVE      SWVK15        BILNUM
     C                   ELSE
     C                   MOVEL     SWVK25        BILNUM
     C                   MOVE      ','           BN(5)
     C                   MOVE      SWVK66        BILNUM
     C                   END
     C                   EXSR      BLANBI
     C                   MOVE      BILNUM        DSTX1A
     C                   MOVE      SWTX1B        BILNUM
     C                   EXSR      BLANBI
     C                   MOVE      BILNUM        DSTX1B
      *
     C                   MOVE      *ZEROS        BILNUM            6
     C     SWEF56        IFEQ      *ZEROS
     C                   MOVE      SWEF14        BILNUM
     C                   ELSE
     C     SWEF66        IFEQ      *ZEROS
     C                   MOVEL     SWEF14        BILNUM
     C                   MOVE      ','           BN(5)
     C                   MOVE      SWEF55        BILNUM
     C                   ELSE
     C                   MOVEL     SWEF24        BILNUM
     C                   MOVE      ','           BN(4)
     C                   MOVE      SWEF56        BILNUM
     C                   END
     C                   END
     C                   EXSR      BLANBI
     C                   MOVE      BILNUM        DSTX2A
     C                   MOVE      SWTX2B        BILNUM
     C                   EXSR      BLANBI
     C                   MOVE      BILNUM        DSTX2B
      *
     C                   MOVE      SWTX3A        BILNUM
     C                   EXSR      BLANBI
     C                   MOVE      BILNUM        DSTX3A
     C                   MOVE      SWTX3B        BILNUM
     C                   EXSR      BLANBI
     C                   MOVE      BILNUM        DSTX3B
      *
     C                   MOVE      SWPC1A        BILNUM
     C                   EXSR      BLANBI
     C                   MOVE      BILNUM        DSPC1A
     C                   MOVE      SWPC1B        BILNUM
     C                   EXSR      BLANBI
     C                   MOVE      BILNUM        DSPC1B
      *
     C                   MOVE      SWPC2B        BILNUM
     C                   EXSR      BLANBI
     C                   MOVE      BILNUM        DSPC2B
     C                   MOVE      SWPC2C        BILNUM
     C                   EXSR      BLANBI
     C                   MOVE      BILNUM        DSPC2C
      *
     C                   MOVE      '   ,  '      DSPROS
     C                   MOVEL     SWPC2A        PROHEL            3 0
     C                   MOVE      SWPC2A        PRODEC            2 0
     C                   MOVEL     PROHEL        DSPROS
     C                   MOVE      PRODEC        DSPROS
     C     PROHEL        IFLT      100
     C                   MOVEL     ' '           DSPROS
     C                   END
     C                   ENDSR
      */////////////////////////////////////////////////////////////
     C     BLANBI        BEGSR
      * BLANK FORANSTILTE NULLER I BILFORTOLLINGSDS...
     C                   Z-ADD     1             NN                1 0
     C     BN(NN)        DOWEQ     '0'
     C                   MOVE      ' '           BN(NN)
     C     NN            CABEQ     5             UTBLAN
     C                   ADD       1             NN
     C                   END
     C     UTBLAN        ENDSR
      *
      */////////////////////////////////////////////////////////////
      *                                                       MOVBWF
      */////////////////////////////////////////////////////////////
     C     MOVBWF        BEGSR
      *
     C                   MOVE      *BLANKS       VB
     C                   MOVE      *BLANKS       TO
     C                   MOVE      *BLANKS       TC
N87   *
N87   * Send FOR og andre dokunmenter fra DFO til DEN
N87  C                   IF        X_DEN = 'J' AND
N87  C                             XFT3KD <> '.' AND XFT3KD <> *BLANKS
N87  C                   EVAL      TC(1) = XFT3KD
N87  C                   EVAL      TO(1) = XFT3DK
N87  C                   IF        XFT4KD <> *BLANKS
N87  C                   EVAL      TC(2) = XFT4KD
N87  C                   EVAL      TO(2) = %SUBST(XFT4:1:17)
N87  C                   IF        %SUBST(XFT4:18:17) <> *BLANKS
N87  C                   EVAL      TC(3) = XFT4KD
N87  C                   EVAL      TO(3) = %SUBST(XFT4:18:17)
N87  C                   IF        %SUBST(XFT4:35:7) <> *BLANKS
N87  C                   EVAL      TC(4) = XFT4KD
N87  C                   EVAL      TO(4) = %SUBST(XFT4:35:7)
N87  C                   END
N87  C                   END
N87  C                   END
N87  C                   END
N87   *
     C                   MOVE      *ZEROS        WFIVNT
     C                   MOVE      *ZEROS        XNTM
     C                   MOVE      *BLANKS       WFITN
     C                   MOVE      *BLANKS       WFILK
S12  C*                  MOVE      *ZEROS        WFIVKB
S12  C*                  MOVE      *ZEROS        WFIVKN
N12  C                   MOVE      *ZEROS        WFIVKB123
N12  C                   MOVE      *ZEROS        WFIVKN123
     C                   MOVE      *BLANKS       WFIPRE
     C                   MOVE      *ZEROS        WFIANT
     C                   MOVE      *BLANKS       WFIVF
     C                   MOVE      *ZEROS        WFIJUS
     C                   MOVE      *ZEROS        XWFSTB
N33  C                   MOVE      *ZEROS        X_XWFSTB         15 2
     C                   MOVE      *ZEROS        XBELR2
     C                   MOVE      *ZEROS        WFIBBL
     C                   MOVE      *BLANKS       WFIFTG
     C                   MOVE      *ZEROS        WFIMVG
     C                   MOVE      *ZEROS        XWFTLG
N39_1C                   MOVE      *ZEROS        X_XWFTLG
     C                   MOVE      *ZEROS        XWFTOL
     C                   MOVE      *ZEROS        WFITRA
     C                   MOVE      *ZEROS        WFISUM
     C                   MOVE      *ZEROS        WFISAT
     C                   MOVE      *BLANKS       Y2
     C                   MOVE      *BLANKS       E2
     C                   MOVE      *ZEROS        B2
     C                   MOVE      *ZEROS        G2
     C                   MOVE      *ZEROS        S2
     C                   MOVE      *BLANKS       P2
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * SR for output string, read input from left              SRÅ
      *////////////////////////////////////////////////////////////
     C     SRÅ           BEGSR
      *_______________
      * Find positions
      *""""""""""""""""
      * Find first non-0 position
     C     WDIR          IFEQ      'L'                                          <-------------I
     C     AXV           DO        AXH           AXV                             <-----------II
     C     A(AXV)        COMP      '0'                                  8383                 II
     C   83              END                                                     <-----------II
      * Find last non-blank position                                     I
     C                   ELSE                                                   <-------------I
      *                                                                  I
     C     SRÅ01         TAG                                                                  I
      *                                                                  I
     C     AXH           IFGT      AXV                                           <-----------II
     C     A(AXH)        ANDEQ     *BLANKS                                                  III
     C                   SUB       1             AXH                                        III
     C                   GOTO      SRÅ01                                                    III
     C                   END                                                     <-----------II
     C                   END                                                    <-------------I
     C                   MOVE      'R'           WDIR
      *________________________________________________
      * Read input string and place it in output string
      *""""""""""""""""""""""""""""""""""""""""""""""""
     C     AXV           DO        AXH           AXV                            <-------------I
     C                   MOVE      A(AXV)        WCHAR                                        I
      * If invalid character (' + : ?) then replace with 'Ø'             I
     C     WCHART        IFEQ      'Y'                                           <-----------II
     C     WDIR          ANDEQ     'R'                                                      III
     C     WCHAR         IFEQ      ';'                                                      III
     C                   MOVE      ':'           WCHAR
     C                   ENDIF                                                    <---------III
     C     WCHAR         COMP      WAPSTR                                 83                III
     C  N83WCHAR         COMP      '+'                                    83                III
     C  N83WCHAR         COMP      ':'                                    83                III
     C  N83WCHAR         COMP      '?'                                    83                III
     C   83              EXSR      SRÅA                                                     III
     C                   END                                                     <-----------II
      * Move to output string                                            I
     C                   MOVE      WCHAR         B(BX)                                        I
     C                   ADD       1             BX                                           I
      * If arrayindex for output array is over 80 Then add a record      I
     C     BX            IFGT      80                                            <-----------II
     C                   WRITE     EDISER                                                    II
     C                   Z-ADD     1             BX                                          II
     C                   MOVE      *BLANKS       SDATA                                       II
     C                   END                                                     <-----------II
      *                                                                  I
     C                   END                                                    <-------------I
      *
     C                   MOVE      'Y'           WCHART
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * SR for replace control characters                      SRÅA
      *////////////////////////////////////////////////////////////
     C     SRÅA          BEGSR
      * Move '?' before the character
     C                   MOVE      '?'           B(BX)
     C                   ADD       1             BX
     C     BX            IFGT      80                                           <-------------I
     C                   WRITE     EDISER                                                     I
     C                   Z-ADD     1             BX                                           I
     C                   MOVE      *BLANKS       SDATA                                        I
     C                   END                                                    <-------------I
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Venstrestill numeriske verdier                      SRNE /
      *////////////////////////////////////////////////////////////
     C     SRNE          BEGSR
      * Flytte in rett verdi i Alfa 12-felt
     C                   MOVE      *ZEROS        ØA12
     C     ØA152D        IFEQ      '00'                                         <-------------I
     C                   MOVE      ØA152H        ØA12                                         I
     C                   ELSE                                                   <-------------I
     C                   MOVEL     ØA152X        ØA12                                         I
     C                   MOVE      ',  '         ØA12                                         I
     C                   MOVE      ØA152D        ØA12                                         I
     C     Ø12(12)       IFEQ      '0'
     C                   MOVE      ' '           Ø12(12)
     C     Ø12(11)       IFEQ      '0'
     C                   MOVE      ' '           Ø12(11)
     C                   END
     C                   END
     C                   END                                                    <-------------I
      * lete fra venstre og finn foerste siffer over 0
     C     1             DO        11            ØX                             <-------------I
     C     Ø12(ØX)       IFNE      '0'                                           <-----------II
     C                   GOTO      SRNE1                                                     II
     C                   END                                                     <-----------II
     C                   END                                                    <-------------I
     C     SRNE1         TAG
      * Venstrestill til et nytt felt
     C                   MOVE      *BLANKS       ØAN
     C                   MOVEA     Ø12(ØX)       ØAN
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Sendningsstart                                      UNB0 /
      *////////////////////////////////////////////////////////////
     C     UNB0          BEGSR
      *__________________________________________________________________________
      * UNA SEGMENT (HVIS VIA EDB FUNDATOR, FJERNES AV EDBF VED SENDN. TIL TOLLV)
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     S0010         CHAIN     EDII                               33
     C     INNETW        IFEQ      'A'
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNA'         ADS
     C     ADS           CAT       ':+,?':0      ADS
     C     ADS           CAT       WAPSTR:1      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   ENDIF
      *______________
      * START SEGMENT
      *""""""""""""""
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNB+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *______________________
      * SYNTAX IDENTIFIKASJON
      *""""""""""""""""""""""
      * Identifikasjon og versjon
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNOA:1+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *____________________
      * OVERFØRINGSAVSENDER
      *""""""""""""""""""""
      * Identifikasjon
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     S0004         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     35            AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C     S0004         CHAIN     EDII                               33
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     IN0007        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *____________________
      * OVERFØRINGSMOTTAKER
      *""""""""""""""""""""
      * Identifikasjon og Qualifier
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     S0010         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C     S0010         CHAIN     EDII                               33
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     IN0007        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *__________________________________________
      * DATO/TID FOR FREMSTILLING AV OVERFØRINGEN
      *""""""""""""""""""""""""""""""""""""""""""
      * Dato
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SDT           ADS
     C                   Z-ADD     3             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Tid
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     STM           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *________________________
      * OVERFØRINGENS REFERANSE
      *""""""""""""""""""""""""
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     S0020         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   EXSR      SRÅ
      *______________________________________________
      * APPLIKASJONSREFERANSE (Kun hvis nettverk=IBM)
      *""""""""""""""""""""""""""""""""""""""""""""""
     C     WNETW         IFEQ      '2'                                          <----------I
      *                                                               I
     C                   MOVE      *BLANKS       ADS                                       I
     C                   MOVEL     '++'          ADS                                       I
     C                   Z-ADD     1             AXV                                       I
     C                   Z-ADD     2             AXH                                       I
     C                   MOVE      'N'           WCHART                                    I
     C                   EXSR      SRÅ                                                     I
      *                                                               I
     C                   MOVE      *BLANKS       ADS                                       I
     C                   MOVEL     S0026         ADS                                       I
     C                   Z-ADD     1             AXV                                       I
     C                   Z-ADD     14            AXH                                       I
     C                   EXSR      SRÅ                                                     I
      *                                                               I
     C                   END                                                    <----------I
      *______________
      * TESTINDIKATOR
      *""""""""""""""
     C     S0035         IFGT      '0'                                          <----------I
     C                   MOVE      *BLANKS       ADS                                       I
     C                   SELECT
     C     WNETW         WHENEQ    '1'                                           <--------II
     C                   MOVEL     '++++++'      ADS                                      II
     C                   Z-ADD     1             AXV                                      II
     C                   Z-ADD     6             AXH                                      II
     C     WNETW         WHENEQ    '2'                                           <--------II
     C                   MOVEL     '++++'        ADS                                      II
     C                   Z-ADD     1             AXV                                      II
     C                   Z-ADD     4             AXH                                      II
     C                   OTHER                                                   <--------II
     C                   MOVEL     '++++++'      ADS                                      II
     C                   Z-ADD     1             AXV                                      II
     C                   Z-ADD     6             AXH                                      II
     C                   ENDSL                                                   <--------II
     C                   MOVE      'N'           WCHART                                    I
     C                   EXSR      SRÅ                                                     I
      *                                                               I
     C                   MOVE      *BLANKS       ADS                                       I
     C                   MOVEL     S0035         ADS                                       I
     C                   Z-ADD     1             AXV                                       I
     C                   Z-ADD     1             AXH                                       I
     C                   EXSR      SRÅ                                                     I
     C                   END                                                    <----------I
      *______________
      * SLUTT SEGMENT
      *""""""""""""""
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Meldingsstart                                       UNH0 /
      *////////////////////////////////////////////////////////////
     C     UNH0          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   Z-ADD     1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNH+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Meldingsreferanse
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M0062         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     14            AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Meldingstype  (= CUSDEC)
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M0065         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     ':1:902:U'    A(1)
     C                   MOVEA     'N:NEP-I+'    A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     17            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Felles referanse, deklarant-ID/dato/sekvensnr./versjonsnr.
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M0068         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     25            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Start på melding                                    BGM0 /
      *////////////////////////////////////////////////////////////
     C     BGM0          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'BGM+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M1001         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '++137:'      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Dato for documentutstedelse
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SDT           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':102+'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Meldingskode
     C                   MOVE      *BLANKS       ADS
     C                   Z-ADD     1             AXV
S16  C*    M1225         IFEQ      '18 '
S16  C*                  MOVEL     '18+ABE'      ADS
S16  C*                  Z-ADD     6             AXH
S16  C*                  MOVE      'N'           WCHART
S16  C*                  ELSE
     C                   MOVEL     M1225         ADS
     C                   Z-ADD     3             AXH
S16  C*                  END
     C                   EXSR      SRÅ
N16   * Omberegning
N16  C                   IF        MTDN < 0
N16  C                   EVAL      ADS = '+ABE:' + SITLE + SITLL
N16  C                   Z-ADD     1             AXV
N16  C                   Z-ADD     21            AXH
N16  C                   MOVE      'N'           WCHART
N16  C                   EXSR      SRÅ
N16  C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Tollstatus for gods                                 CST0 /
      *////////////////////////////////////////////////////////////
     C     CST0          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'CST++'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Deklarasjon (EU=EF/EFTA-land  EX=Ikke EF/EFTA-land)
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIDTY         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      * Deklarasjon (ekspedisjonstyep)
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     XDP1          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':104:1+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Transaksjonstype
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SITST         ADS
N89  C                   IF        SITST > 9
     C                   Z-ADD     1             AXV
N89  C                   ELSE
N89  C                   Z-ADD     2             AXV
N89  C                   END
S89  C*                  Z-ADD     1             AXH
N89  C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':112:NO1'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
N16   * Omberegning
N16  C                   IF        MTDN < 0
N16  C                   EVAL      ADS = '+' + SITYPE + ':110:NO1'
N16  C                   Z-ADD     1             AXV
N16  C                   Z-ADD     13            AXH
N16  C                   MOVE      'N'           WCHART
N16  C                   EXSR      SRÅ
N16  C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Referanser                                          RFF0 /
      *////////////////////////////////////////////////////////////
     C     RFF0          BEGSR
      *__________________________________________
      * Registreringnummer hos fylkesskattesjefen
      *""""""""""""""""""""""""""""""""""""""""""
      * Segmentnavn
S59  C*    PTFDT         IFLE      WDT80
     C     SIKTA         CABEQ     0             STRFF1
S59  C*                  END
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
S59  C*    PTFDT         IFGT      WDT80
S59  C*                  MOVEL     'RFF+VA:'     ADS
S59  C*                  ELSE
     C                   MOVEL     'RFF+CO:'     ADS
S59  C*                  END
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Referansenummer
     C                   MOVE      *BLANKS       ADS
S59  C*    PTFDT         IFGT      WDT80
S59  C*                  MOVEL     SIRG          ADS
S59  C*                  Z-ADD     1             AXV
S59  C*                  Z-ADD     9             AXH
S59  C*                  EXSR      SRÅ
      * Slutt segment
S59  C*                  ELSE
     C     SIKTC         IFNE      ' '
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIKTC         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
     C                   END
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIKTA         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   EXSR      SRÅ
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIKTB         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
S59  C*                  END
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C     STRFF1        TAG
      *___________
      * Godsnummer
      *"""""""""""
      * Segmentnavn
     C     SIDP          IFNE      47
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'RFF+XC:'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Referansenummer
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIGN          ADS
      * Hvis 1 er bokstav (A/F) og niende utfylt-de ar det AWB-nummer
      * (Da skal bare nummerdelen sendes - bokstaben legges i Konn.nr.)
     C     SIGN91        IFLT      '0'
     C     SIGN99        ANDNE     *BLANKS
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIG014        GODS14           14
     C                   MOVE      SIG615        GODS14
     C                   MOVEL     GODS14        ADS
     C                   END
     C                   Z-ADD     15            AXH
     C                   Z-ADD     1             AXV
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *____________
      * Konnosement
      *""""""""""""
      * Segmentnavn
     C     SIGN71        IFEQ      'P'
     C     SITRM         ANDEQ     50
     C                   GOTO      SLRFF
     C                   END
     C     SIGN71        IFEQ      'D'
     C                   GOTO      SLRFF
     C                   END
      *
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'RFF+LAR:'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Referansenummer
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIPOS         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   EXSR      SRÅ
      * Ved Braathen/SAS legg "prefixbokstav" umidd. etter kon.nr
     C     SIGN91        IFEQ      'A'
     C     SIGN91        OREQ      'F'
     C     SIGN9B        IFGE      '0'
     C     SIGN9B        ANDLE     '9'
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIGN91        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
     C                   END
     C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
N83   *___________
N83   * Relatert til midlertidig fortolling
N83   *"""""""""""
N83   * Segmentnavn
N83  C                   IF        SITLE1 <> *BLANKS
N83  C                   ADD       1             W0074
N83  C                   EVAL      ADS = 'RFF+AEI:'
N83  C                             + %TRIM(SITLE1) + %TRIM(SITLL1)
N83  C                   Z-ADD     1             AXV
N83  C                   Z-ADD     24            AXH
N83  C                   MOVE      'N'           WCHART
N83  C                   EXSR      SRÅ
N83   * Slutt segment
N83  C                   MOVE      *BLANKS       ADS
N83  C                   MOVEL     WAPSTR        ADS
N83  C                   Z-ADD     1             AXV
N83  C                   Z-ADD     1             AXH
N83  C                   MOVE      'N'           WCHART
N83  C                   EXSR      SRÅ
N83  C                   END
      *
     C     SLRFF         ENDSR
      *////////////////////////////////////////////////////////////
      *  Stedsangivelse                                      LOC0 /
      *////////////////////////////////////////////////////////////
     C     LOC0          BEGSR
      *___________________
      * Innførselslandkode
      *"""""""""""""""""""
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'LOC+35:'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SILKA         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *___________________
      * Innførselstollsted
      *"""""""""""""""""""
      *____________________
      * Varens lagringssted
      *""""""""""""""""""""
     C     SIKDLS        IFNE      *BLANKS
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'LOC+14:'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIKDLS        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Dato                                                DTM0 /
      *////////////////////////////////////////////////////////////
     C     DTM0          BEGSR
      *_______________________
      * Ønsket behandlingsdato
      *"""""""""""""""""""""""
      * Segmentnavn
     C     M2005B        IFNE      0
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'DTM+256:'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M2005B        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':102'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Transportdetljer                                    TDT0 /
      *////////////////////////////////////////////////////////////
     C     TDT0          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'TDT+11++'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SITRM         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      *
     C     SITRM         IFNE      50
TMP  C     SITDN         andne     91576
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+:::::'      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SILKT         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
     C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Generell indikator                                  GIS0 /
      *////////////////////////////////////////////////////////////
     C     GIS0          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
      * Container
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'GIS+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIKDC         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Navn og adresser                                    NAD0 /
      *////////////////////////////////////////////////////////////
     C     NAD0          BEGSR
      *_________
      * Importør
      *"""""""""
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'NAD+IM+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Tollkreditnr.
     C     SIKDDK        IFEQ      *BLANKS
S59  C*    SIKTA         ORNE      0
S59  C*    PTFDT         ANDGT     WDT80
     C     SIRG          ORNE      *BLANKS
S59  C*    PTFDT         ANDLE     WDT80
      * Kodeform
S59  C*    PTFDT         IFGT      WDT80
S59  C*    SIKTC         IFNE      ' '
S59  C*                  MOVE      *BLANKS       ADS
S59  C*                  MOVEL     SIKTC         ADS
S59  C*                  Z-ADD     1             AXV
S59  C*                  Z-ADD     1             AXH
S59  C*                  EXSR      SRÅ
S59  C*                  END
S59   *
S59  C*                  MOVE      *BLANKS       ADS
S59  C*                  MOVEL     SIKTA         ADS
S59  C*                  Z-ADD     1             AXV
S59  C*                  Z-ADD     5             AXH
S59  C*                  EXSR      SRÅ
S59   *
S59  C*                  MOVE      *BLANKS       ADS
S59  C*                  MOVEL     SIKTB         ADS
S59  C*                  Z-ADD     1             AXV
S59  C*                  Z-ADD     2             AXH
S59  C*                  EXSR      SRÅ
S59  C*                  ELSE
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIRG          ADS
     C                   Z-ADD     1             AXV
N80  C                   IF        XAN01 = 'P' OR XAN01 = 'B'
N80  C                   Z-ADD     10            AXH
N80  C                   ELSE
     C                   Z-ADD     11            AXH
N80  C                   END
     C                   EXSR      SRÅ
S59  C*                  END
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ELSE
      * Ikke kodeform
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Navn
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SINAK         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
      * Adresse-1
     C     SIADK1        IFEQ      *BLANKS
     C                   MOVEL     '.'           SIADK1
     C                   END
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIADK1        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
      * Adresse-2
     C     SIADK2        IFEQ      *BLANKS
     C                   MOVEL     '.'           SIADK2
     C                   END
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIADK2        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
      * Adresse-3
     C     SIADK3        IFEQ      *BLANKS
     C                   MOVEL     '.'           SIADK3
     C                   END
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIADK3        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     35            AXH
     C                   EXSR      SRÅ
      *
     C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *_________
      * Avsender
      *"""""""""
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'NAD+SE++'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Navn
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SINAS         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Adresse-1
     C                   MOVE      *BLANKS       ADS
     C     SIADS1        IFEQ      *BLANKS
     C                   MOVEL     '.'           ADS
     C                   ELSE
     C                   MOVEL     SIADS1        ADS
     C                   END
     C     SIKDDK        IFEQ      'D'
N67  C                   MOVE      'J'           X_SELVFORT        1
N16  C                   IF        MTDN < 0
N16  C                   EVAL      SITDN = MTDN * -1
N67   * VED OMBEREGNING SJEKK OM OPPRINNELIG ER FORTOLLET SELV (OM DUA/DTK FINNES)
N67  C     SADV2K        SETLL     EDIM2
N67  C     SADV2K        READE     EDIM2                                  33
N67  C                   MOVE      'N'           X_SELVFORT
N67  C                   DOW       *IN33 = *OFF
N67  C                   IF        M2_M1N07 = 'DUA' OR M2_M1N07 = 'DTK'
N67  C                   MOVE      'J'           X_SELVFORT
N67  C                   LEAVE
N67  C                   END
N67  C     SADV2K        READE     EDIM2                                  33
N67  C                   ENDDO
N16  C                   END
N67  C                   IF        X_SELVFORT = 'J'
N67   * ENTEN OPPRINNELIG FORTOLLET SELV ELLER IKKE OMBEREGNING SENDER SYSPEDREF (AVD/OPD)
S02  C*                  MOVEA     XREF          A(26)
N02  C                   MOVEA     XREF          A(24)
N67  C                   END
N16  C                   IF        MTDN < 0
N16  C                   EVAL      SITDN = MTDN
N16  C                   END
     C                   END
     C                   Z-ADD     1             AXV
S02  C*                  Z-ADD     37            AXH
N02  C                   Z-ADD     35            AXH
     C                   EXSR      SRÅ
      * Adresse-2
     C     SIADS2        IFNE      *BLANKS
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIADS2        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
     C                   END
      * Adresse-3
     C     SIADS3        IFNE      *BLANKS
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIADS3        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
     C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *__________
      * Deklarant
      *""""""""""
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'NAD+DT+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Kundenr. hos tollvesenet
     C                   MOVE      *BLANKS       ADS
S59  C*    PTFDT         IFGT      WDT80
S59  C*                  MOVEL     M3039D        ADS
S59  C*                  Z-ADD     1             AXV
S59  C*                  Z-ADD     8             AXH
S59  C*                  ELSE
     C                   MOVEL     SYFORE        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
S59  C*                  END
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *________________________
      * Toll- og avgiftsbetaler
      *""""""""""""""""""""""""
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'NAD+AA+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Måneds-/dags-/kontantoppgjør
     C                   MOVE      *BLANKS       ADS
     C     SIKDDK        IFEQ      ' '
N40  C     SIKTA         ANDNE     0
N40  C     X_TOLLAVG     ANDEQ     'J'
N40  C     SIKTA         ORNE      0
N40  C     X_M0068A      ANDLT     20170401
     C                   MOVEL     'M'           ADS
     C                   ELSE
     C                   MOVEL     SIKDDK        ADS
     C                   END
N49   *
N49  C                   SELECT
N49  C                   WHEN      SITDN > 0
N49   * Bevare betalekode i SIKDH
N49  C                   MOVE      SIBEL7        XBEL7
N49  C     KEYD          CHAIN     SADH                               33
N49  C  N33              SELECT
N49  C                   WHEN      A(1) = ' '
N49  C                   EVAL      SIKDH = 1
N49  C                   WHEN      A(1) = 'K'
N49  C                   EVAL      SIKDH = 2
N49  C                   WHEN      A(1) = 'D'
N49  C                   EVAL      SIKDH = 3
N49  C                   WHEN      A(1) = 'M'
N49  C                   EVAL      SIKDH = 4
N49  C                   OTHER
N49  C                   EVAL      SIKDH = 0
N49  C                   ENDSL
N49  C  N33              UPDATE    SADHR
N49  C                   MOVE      XBEL7         SIBEL7
N49  C                   WHEN      SITDN < 0
N49   * Hent betalekode ved omberegning
N49  C                   SELECT
N49  C                   WHEN      SIKDH = 1
N49.1C                   IF        X_TOLLAVG <> 'J'
N49.2C                             OR SITYPE = '0097' OR SITYPE = '0098'
N49  C                   EVAL      A(1) = ' '
N49.1C                   END
N49  C                   WHEN      SIKDH = 2
N49  C                   EVAL      A(1) = 'K'
N49  C                   WHEN      SIKDH = 3
N85  C                             AND SIKDDK <> 'M'
N49  C                   EVAL      A(1) = 'D'
S55  C*                  WHEN      SIKDH = 4
N55  C                   WHEN      SIKDH = 4 AND SIKTA <> 0
N49  C                   EVAL      A(1) = 'M'
N49  C                   ENDSL
N49  C                   ENDSL
N49   *
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *_____________________________________________________
      * Ekspedisjonsenhet hvor deklarasjonen skal ekspederes
      *"""""""""""""""""""""""""""""""""""""""""""""""""""""
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'NAD+EE+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Ekspedisjonsenhet
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M3039E        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '::NO1'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Kontaktinformasjon                                  CTA0 /
      *////////////////////////////////////////////////////////////
     C     CTA0          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'CTA++'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SISG          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Leveringsbetingelser                                TOD0 /
      *////////////////////////////////////////////////////////////
     C     TOD0          BEGSR
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'TOD+++'      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Levereingsbetingelser, kodet
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SILV2         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+1::::'      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Leveringsbetingelser
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SILVT         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     17            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
N16   *////////////////////////////////////////////////////////////
N16   *  Fritekster                                          FTX0 /
N16   *////////////////////////////////////////////////////////////
N16  C     FTX0          BEGSR
N16   * Segmentnavn
N16   * W0074  --->  Teller for antall segment
N16  C                   ADD       1             W0074
N16  C                   EVAL      ADS = 'FTX+AAH+++'
N16  C                   Z-ADD     1             AXV
N16  C                   Z-ADD     10            AXH
N16  C                   MOVE      'N'           WCHART
N16  C                   EXSR      SRÅ
N16   * Fritekst
N16  C                   EVAL      ADS = SIFT01
N16  C                   Z-ADD     1             AXV
N16  C                   Z-ADD     70            AXH
N16  C                   EXSR      SRÅ
N16   *
S28  C*    2             DO        4             XN3
N28  C     2             DO        5             XN3
N16  C                   IF        FT0(XN3) <> *BLANKS
N16  C                   ADD       1             W0074
N16  C                   EVAL      ADS = ':'
N16  C                   Z-ADD     1             AXV
N16  C                   Z-ADD     1             AXH
N16  C                   MOVE      'N'           WCHART
N16  C                   EXSR      SRÅ
N16  C                   EVAL      ADS = %TRIM(FT0(XN3))
N16  C                   Z-ADD     1             AXV
N16  C                   Z-ADD     70            AXH
N16  C*                  MOVE      'N'           WCHART
N16  C                   EXSR      SRÅ
N16  C                   END
N16  C                   ENDDO
N16   * Slutt segment
N16  C                   MOVE      *BLANKS       ADS
N16  C                   MOVEL     WAPSTR        ADS
N16  C                   Z-ADD     1             AXV
N16  C                   Z-ADD     1             AXH
N16  C                   MOVE      'N'           WCHART
N16  C                   EXSR      SRÅ
N16   *
N16  C                   ENDSR
N83   *////////////////////////////////////////////////////////////
N83   *  Fritekster                                        FTX0MO /
N83   *////////////////////////////////////////////////////////////
N83  C     FTX0MO        BEGSR
N83   * Segmentnavn
N83   * W0074  --->  Teller for antall segment
N83  C                   ADD       1             W0074
N83  C                   EVAL      ADS = 'FTX+AHZ+++'
N83  C                   Z-ADD     1             AXV
N83  C                   Z-ADD     10            AXH
N83  C                   MOVE      'N'           WCHART
N83  C                   EXSR      SRÅ
N83   * Fritekst
N83  C                   EVAL      ADS = SITXT1
N83  C                   Z-ADD     1             AXV
N83  C                   Z-ADD     70            AXH
N83  C                   EXSR      SRÅ
N83   *
N83  C     2             DO        5             XN3
N83  C                   IF        FT0MO(XN3) <> *BLANKS
N83  C                   ADD       1             W0074
N83  C                   EVAL      ADS = ':'
N83  C                   Z-ADD     1             AXV
N83  C                   Z-ADD     1             AXH
N83  C                   MOVE      'N'           WCHART
N83  C                   EXSR      SRÅ
N83  C                   EVAL      ADS = %TRIM(FT0MO(XN3))
N83  C                   Z-ADD     1             AXV
N83  C                   Z-ADD     70            AXH
N83  C                   EXSR      SRÅ
N83  C                   END
N83  C                   ENDDO
N83   * Slutt segment
N83  C                   MOVE      *BLANKS       ADS
N83  C                   MOVEL     WAPSTR        ADS
N83  C                   Z-ADD     1             AXV
N83  C                   Z-ADD     1             AXH
N83  C                   MOVE      'N'           WCHART
N83  C                   EXSR      SRÅ
N83   *
N83  C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Fakturasum / fraktbeløp                             MOA0 /
      *////////////////////////////////////////////////////////////
     C     MOA0          BEGSR
      *___________
      * Fakturasum
      *"""""""""""
      * Segmentnavn
     C     XBEL3         IFNE      0
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'MOA+4+39'    A(1)
     C                   MOVEA     ':'           A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Beløp
     C                   MOVE      *BLANKS       ADS
     C                   Z-ADD     XBEL3         ØN152
     C                   EXSR      SRNE
     C                   MOVEL     ØAN           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     12            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Valutakode
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIVAL3        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *___________
      * Fraktbeløp
      *"""""""""""
      * Segmentnavn
     C     SIBEL8        IFNE      0
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+144:'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Beløp
     C                   MOVE      *BLANKS       ADS
     C                   Z-ADD     SIBEL8        ØN152
     C                   EXSR      SRNE
     C                   MOVEL     ØAN           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     12            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Valuta                                              CUX0 /
      *////////////////////////////////////////////////////////////
     C     CUX0          BEGSR
      * Segmentnavn
     C     *IN41         IFNE      '1'
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'CUX+2++'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Valutakurs
     C                   MOVE      *BLANKS       ADS
     C                   Z-ADD     SIVKU         ØN152
     C                   EXSR      SRNE
     C                   MOVEL     ØAN           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Seksjonskille                                       UNSD /
      *////////////////////////////////////////////////////////////
     C     UNSD          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNS+D'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Fakturanummer og dato                               DMS0 /
      *////////////////////////////////////////////////////////////
     C     DMS0          BEGSR
      *
     C     SIFID         IFNE      0                                            1<-B
     C     SIFID         IFNE      99999999                                      2<-B
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'DMS+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Fakturanummer
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIFIF         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     17            AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+137:'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Dato/tid - qualifier
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIFID         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':102+380'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ELSE                                                    2
      *
     C     KEYE          SETLL     SADF                               33
     C     KEYE          READE     SADF                                   33
     C     *IN33         DOWEQ     '0'                                           3<-B
      * Segmentnavn
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'DMS+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Fakturanummer
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SFTXT         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     17            AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+137:'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Dato, kodet
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SFDT          ADS                            ÅR MND DAG
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':102+380'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C     KEYE          READE     SADF                                   33
      *
     C  N33              END                                                      3<-E
      *
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Tollstatus for gods                                CST0V /
      *////////////////////////////////////////////////////////////
     C     CST0V         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'CST+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Varepostnummer
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFIRNR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Varenummer
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFIVNT        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':122:NO1'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Prosedyre, kodet
     C                   MOVE      *BLANKS       ADS
S51  C*                  SELECT
S51  C*                  WHEN      SIDP = 76 AND WFILK <> 'NO'
S51  C*                  EVAL      ADS = '77'
S51  C*                  WHEN      SIDP = 77 AND WFILK = 'NO'
S51  C*                  EVAL      ADS = '76'
S51  C*                  OTHER
N89  C                   IF        X_M0068A < X_4SIFF
N51  C                   IF        WFIDP = 0
     C                   MOVEL     SIDP          ADS
N51  C                   ELSE
N51  C                   MOVEL     WFIDP         ADS
N51  C                   END
N89  C                   ELSE
N89  C                   IF        WFIDP_4 = 0
N89  C                   MOVEL     SIDP_4        ADS
N89  C                   ELSE
N89  C                   MOVEL     WFIDP_4       ADS
N89  C                   END
N89  C                   END
S51  C*                  ENDSL
     C                   Z-ADD     1             AXV
N89  C                   IF        X_M0068A < X_4SIFF
     C                   Z-ADD     2             AXH
N89  C                   ELSE
N89  C                   Z-ADD     4             AXH
N89  C                   END
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':117:1+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Preferansekode
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFIPRE        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     ':116:NO1'    A(1)
     C                   MOVEA     '+'           A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Verdifastsettelseskode
     C                   MOVE      *BLANKS       ADS
     C     WFIVF         IFLE      '0'
     C                   MOVEL     SIDFVF        ADS
     C                   ELSE
     C                   MOVEL     WFIVF         ADS
     C                   END
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':109:1'      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Tollnedsettelseskode
     C     WFITN         IFNE      *BLANKS
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFITN         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':110:NO1'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Forpakning                                         PAC0V /
      *////////////////////////////////////////////////////////////
     C     PAC0V         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'PAC+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Antall kolli
     C                   MOVE      *BLANKS       ADS
     C     WFIANT        IFEQ      0
     C                   MOVEL     '1'           ADS
     C                   Z-ADD     1             AXH
     C                   ELSE
     C                   MOVEL     WFIANT        ADS
     C                   Z-ADD     6             AXH
     C                   END
     C                   Z-ADD     1             AXV
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '++'          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Enhet
     C                   MOVE      *BLANKS       ADS
     C     WFIVT         IFEQ      'EX  '
     C     WFIVT         OREQ      'U.NR'
     C     WFIVT         OREQ      'U-NR'
N59  C     WFIVT         OREQ      'U.'                                         WEB-KODE
N59  C     WFIVT         OREQ      'U-'                                         WEB-KODE
S62  C*    WFIVT         OREQ      'CONT'
S62  C*    WFIVT         OREQ      'C.'
N62  C     SIKDC         OREQ      '1'
     C                   MOVEL     'PK  '        ADS
     C                   ELSE
     C     WFIVT         IFEQ      *BLANKS
     C                   MOVEL     'PK  '        ADS
     C                   ELSE
     C                   MOVEL     WFIVT         ADS
     C                   END
     C                   END
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Forpakningsidentifikasjon                          PCI0V /
      *////////////////////////////////////////////////////////////
     C     PCI0V         BEGSR
N62   *
N62  C                   IF        SIKDC = '1'
N62  C                   CALL      'SAD068A'
N62  C                   PARM      SIAVD         UAVDCN            4 0
N62  C                   PARM      SITDN         UOPDCN            7 0
N62  C                   PARM      WFIRNR        ULNCN             5 0
N62  C     CNR50         PARM                    UCNR            850
N62  C                   END
N62   *
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'PCI++'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   Z-ADD     1             XN3
      * Underst.nr til slutt
     C     WFIVT         IFEQ      'U.NR'
     C     WFIVT         OREQ      'U-NR'
N59  C     WFIVT         OREQ      'U.'                                         WEB-KODE
N59  C     WFIVT         OREQ      'U-'
N59  C*    SIKDC         OREQ      '1'
N59  C                   IF        %SUBST(KN(1):25:4) = 'U-NR'
     C                   ADD       1             XN3
N59  C                   end
     C                   END
      *
N59  C                   MOVE      'N'           XCONT             1
     C     XN3           DOWLE     5
     C     KN(XN3)       ANDNE     *BLANKS
      * Ordinært Merke & nr. legges i 7102
      *
S62  C*                  IF        %SUBST(KN(XN3):25:4) <> 'CONT'
S62  C*                            AND %SUBST(KN(XN3):25:4) <> 'U-NR'
N62  C                   IF        %SUBST(KN(XN3):25:4) <> 'U-NR'
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     KN(XN3)       ADS
     C                   Z-ADD     1             AXV
S12  C*                  Z-ADD     17            AXH
N12  C                   Z-ADD     28            AXH
     C                   EXSR      SRÅ
     C                   ADD       1             XN3
      * Semikolon mellom de ulike 7102-felt
S59  C*    KN(XN3)       IFNE      *BLANKS
N59  C                   IF        KN(XN3) <> *BLANKS
S62  C*                            AND %SUBST(KN(XN3):25:4) <> 'CONT'
S62  C*                            AND %SUBST(KN(XN3):25:4) <> 'U-NR'
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
N59  C                   ELSE
S62  C*                  IF        %SUBST(KN(XN3):25:4) = 'CONT'
S62  C*                  MOVE      'J'           XCONT
S62  C*                  END
N59  C                   ADD       1             XN3
N59  C                   END
     C                   END
      *
      * HVIS "KOLLI-TYPE" ER "U.NR" ELLER "U-NR" DA ER DET MOTORV.FORT.
      * QUALIF.1153 SKAL DA VÆRE "VT" OG 1154 SKAL INNEHOLDE UNDERST.NR
     C     WFIVT         IFEQ      'U.NR'
     C     WFIVT         OREQ      'U-NR'
N59  C     WFIVT         OREQ      'U.'                                         WEB-KODE
N59  C     WFIVT         OREQ      'U-'
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+VT:'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   MOVE      *BLANKS       ADS
S59  C*                  MOVEL     KN(1)         ADS
N59  C     1             DO        5             XN3
N59  C                   IF        %SUBST(KN(XN3):25:4) = 'U-NR'
N59  C                   EVAL      ADS = %SUBST(KN(XN3):1:17)
N59  C                   LEAVE
N59  C                   END
N59  C                   ENDDO
     C                   Z-ADD     1             AXV
S12  C*                  Z-ADD     17            AXH
N12  C                   Z-ADD     28            AXH
     C                   EXSR      SRÅ
S62  C*                  IF        SIKDC = '1' AND XCONT = 'J'
S62  C*                            AND PTFDT <= WDT80                           TEST PTF-STARTDATO
N62  C                   IF        SIKDC = '1'
N59  C                   MOVE      *BLANKS       ADS
N59  C                   MOVEL     WAPSTR        ADS
N59  C                   Z-ADD     1             AXV
N59  C                   Z-ADD     1             AXH
N59  C                   MOVE      'N'           WCHART
N59  C                   EXSR      SRÅ
N59   * NYTT SEGMENT FOR CONTAINER
N59  C                   ADD       1             W0074
N59  C                   EVAL      ADS = 'PCI++'
N59  C                   Z-ADD     1             AXV
N59  C                   Z-ADD     5             AXH
N59  C                   MOVE      'N'           WCHART
N59  C                   EXSR      SRÅ
N59  C                   END                                                IF SIKDC = '1'
     C                   END
N59   *
N59   * Container sending
S62  C*                  IF        SIKDC = '1' AND XCONT = 'J'
S62  C*                            AND PTFDT <= WDT80                           TEST PTF-STARTDATO
N62  C                   IF        SIKDC = '1'
N59  C                   EVAL      ADS = '+AAQ:'
N59  C                   Z-ADD     1             AXV
N59  C                   Z-ADD     5             AXH
N59  C                   MOVE      'N'           WCHART
N59  C                   EXSR      SRÅ
N59   *
S62  C*                  IF        WFIVT = 'U.NR' OR WFIVT = 'U-NR'
S62  C*                            OR WFIVT = 'U.' OR WFIVT = 'U-'
S62  C*    1             DO        7             XN3
S62  C*                  IF        %SUBST(KN(XN3):25:4) = 'CONT'
S62  C*                  EVAL      ADS = %SUBST(KN(XN3):1:17)
S62  C*                  LEAVE
S62  C*                  END
S62  C*                  ENDDO
S62  C*                  ELSE
S62  C*                  Z-ADD     1             XN3
S62  C*                  EVAL      ADS = KN(1)
S62  C*                  END
N62  C                   Z-ADD     2             XN3
N62  C                   EVAL      ADS = CNR(1)
N59  C                   Z-ADD     1             AXV
N59  C                   Z-ADD     17            AXH
N59  C                   EXSR      SRÅ
N59   *
N59  C                   END                                                IF SIKDC = '1'
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
N59   *
S62  C*                  IF        SIKDC = '1' AND XCONT = 'J'
S62  C*                  DOW       XN3 > 0 AND XN3 < 7
S62  C*                  EVAL      XN2 = XN3 + 1
S62  C*    XN2           DO        7             XN3
S62  C*                  IF        %SUBST(KN(XN3):25:4) = 'CONT'
S62  C*                  GOTO      NESTECONT
S62  C*                  END
S62  C*                  ENDDO
S62  C*                  GOTO      SLCONT
S62  C*    NESTECONT     TAG
N62  C                   IF        SIKDC = '1'
N62  C     XN3           DO        50            XN2
N62  C                   IF        CNR(XN2) = *BLANKS
N62  C                   LEAVE
N62  C                   END
N59  C                   ADD       1             W0074
N59  C                   EVAL      ADS = 'PCI+++AAQ:'
N59  C                   Z-ADD     1             AXV
N59  C                   Z-ADD     10            AXH
N59  C                   MOVE      'N'           WCHART
N59  C                   EXSR      SRÅ
N59   *
S62  C*                  EVAL      ADS = %SUBST(KN(XN3):1:17)
N62  C                   EVAL      ADS = CNR(XN2)
N59  C                   Z-ADD     1             AXV
N59  C                   Z-ADD     17            AXH
N59  C                   EXSR      SRÅ
N59   *
N59  C                   EVAL      ADS = WAPSTR
N59  C                   Z-ADD     1             AXV
N59  C                   Z-ADD     1             AXH
N59  C                   MOVE      'N'           WCHART
N59  C                   EXSR      SRÅ
N59  C                   ENDDO
S62  C*    SLCONT        TAG
N59  C                   END                                                IF SIKDC = '1'
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Fritekster   BILFORTOLLING                         FTX0VB/
      *////////////////////////////////////////////////////////////
     C     FTX0VB        BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'FTX+AAA+'    A(1)
     C                   MOVEA     '++'          A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * PRIMÆRT KJØRETØY-GRP, SEKUNDÆRT "MOTORVOGN"
     C                   MOVE      *BLANKS       ADS
     C     SWKTGR        IFNE      *BLANKS
     C                   MOVEL     SWKTGR        ADS
     C                   ELSE
     C                   MOVEL     'MOTORVOG'    XXMVOG            9
     C                   MOVE      'N'           XXMVOG
     C                   MOVEL     XXMVOG        ADS
     C                   END
     C                   Z-ADD     1             AXV
     C                   Z-ADD     26            AXH
     C                   EXSR      SRÅ
      *
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Forpakning   BILFORTOLLING                         PAC0VB/
      *////////////////////////////////////////////////////////////
     C     PAC0VB        BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'PAC+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Antall kolli
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SWPACA        ADS
     C                   Z-ADD     4             AXH
     C                   Z-ADD     1             AXV
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '++'          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *7065 TYPE OF PACKAGE ID(=BILMERKE)=IKKE I.H.T. STD-KODER
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SWPACB        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Forpakningsidentifikasjon  BILFORTOLLING           PCI0VB/
      *////////////////////////////////////////////////////////////
     C     PCI0VB        BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'PCI++'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * EVT ORINÆR GODSMERKE SKAL INN HER (FØR +VT)
      *....
      * UNDERST.NR MED KVALIFIKATOR VT
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+VT:'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SWUNNR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     17            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
N68   *
N68  C                   IF        SIKDC = '1'
N68  C                   CALL      'SAD068A'
N68  C                   PARM      SIAVD         UAVDCN            4 0
N68  C                   PARM      SITDN         UOPDCN            7 0
N68  C                   PARM      WFIRNR        ULNCN             5 0
N68  C     CNR50         PARM                    UCNR            850
N68   *
N68  C                   ADD       1             W0074
N68  C                   EVAL      ADS = 'PCI+++AAQ:'
N68  C                   Z-ADD     1             AXV
N68  C                   Z-ADD     10            AXH
N68  C                   MOVE      'N'           WCHART
N68  C                   EXSR      SRÅ
N68   *
N68  C                   EVAL      ADS = CNR(1)
N68  C                   Z-ADD     1             AXV
N68  C                   Z-ADD     17            AXH
N68  C                   EXSR      SRÅ
N68   *
N68  C                   EVAL      ADS = WAPSTR
N68  C                   Z-ADD     1             AXV
N68  C                   Z-ADD     1             AXH
N68  C                   MOVE      'N'           WCHART
N68  C                   EXSR      SRÅ
N68  C                   END                                                IF SIKDC = '1'
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Oppringelseslandkode                               LOC0V /
      *////////////////////////////////////////////////////////////
     C     LOC0V         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'LOC+27:'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFILK         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Tollverdi / justering                              MOA0V /
      *////////////////////////////////////////////////////////////
     C     MOA0V         BEGSR
      *----------
      * Tollverdi
      *""""""""""
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'MOA+14+1'    A(1)
     C                   MOVEA     '23:'         A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     11            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Beløp
     C                   MOVE      *BLANKS       ADS
     C     WFISTB        IFEQ      0
     C                   MOVEL     '0'           ADS
     C                   Z-ADD     1             AXH
     C                   ELSE
     C                   MOVEL     WFISTB        ADS
     C                   Z-ADD     13            AXH
     C                   MOVE      'L'           WDIR
     C                   END
     C                   Z-ADD     1             AXV
     C                   EXSR      SRÅ
      *----------
      * Justering
      *""""""""""
      * Segmentnavn
      * W0074  --->  Teller for antall segment
N92  C     SIDP          IFEQ      64
N92  C     X_4SIFF       ANDGT     X_M0068A
N92  C     SIDP          OREQ      65
N92  C     X_4SIFF       ANDGT     X_M0068A
N92  C     SIDP          OREQ      66
N92  C     X_4SIFF       ANDGT     X_M0068A
N92  C     SIDP_4        OREQ      6021
N92  C     KODTLBK       KLIST
N92  C                   KFLD                    KLBUNI
N92  C                   KFLD                    SILV
N92  C                   EVAL      KLBUNI = 'LB'
N92  C     KODTLBK       CHAIN     KODTLB                             33
N92  C                   IF        SIBEL1 > 0 OR KLBPRM > 0
N92  C                   Z-ADD     1             XXBEL
N92  C                   ELSE
N92  C                   Z-ADD     0             XXBEL
N92  C                   END
N92  C                   ELSE
N92  C                   EVAL      XXBEL = WFIJUS
N92  C                   END
S92  C*    WFIJUS        IFNE      0
N92  C     XXBEL         IFNE      0
     C                   MOVE      *BLANKS       ADS
     C     WFIFTG        IFEQ      '-'
     C                   MOVEL     '+21:'        ADS
     C                   Z-ADD     4             AXH
     C                   ELSE
     C                   MOVEL     '+160:'       ADS
     C                   Z-ADD     5             AXH
     C                   END
     C                   Z-ADD     1             AXV
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Beløp
     C                   MOVE      *BLANKS       ADS
     C     SIDP          IFEQ      64
N90  C     X_4SIFF       ANDGT     X_M0068A
     C     SIDP          OREQ      65
N90  C     X_4SIFF       ANDGT     X_M0068A
     C     SIDP          OREQ      66
N90  C     X_4SIFF       ANDGT     X_M0068A
N90  C     SIDP_4        OREQ      6021
S33  C*    SIDP          OREQ      49
      * WFIJUS = FRAKT/FORSIKR + ANDREKOSTNAD (OPPRINGELIG VERDI)
      * WFIBBL = FRAKT/FORSIKR + BEARB.KOSTNAD
      * WFISTB = FRAKT/FORSIKR + ANDREKOSTNAD + BEARB.KOSTNAD
      * WFIJUS + WFIBBL - WFISTB = FRAKT/FORSIKR
E39  C     WFIJUS        ADD       WFIBBL        XXBEL            13 0
     C                   SUB       WFISTB        XXBEL
     C                   MOVEL     XXBEL         ADS
N60  C                   Z-ADD     13            AXH
     C                   ELSE
     C                   MOVEL     WFIJUS        ADS
N60  C                   Z-ADD     11            AXH
     C                   END
     C                   Z-ADD     1             AXV
S60  C*                  Z-ADD     11            AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
     C                   END
      *--------------------
      * Bearbeidingskostand
      *""""""""""""""""""""
     C     SIBELR        IFNE      0
N33  C     SIDP          OREQ      49
N51  C     WFIDP         OREQ      49
N91  C*    SIDP_4        OREQ      4171
N91  C*    WFIDP_4       OREQ      4171
N91  C     SIKUNS        OREQ      1
     C                   MOVE      *BLANKS       ADS
     C     WFIJUS        IFEQ      0
     C                   MOVEL     '++40:'       ADS
     C                   Z-ADD     5             AXH
     C                   ELSE
     C                   MOVEL     '+40:'        ADS
     C                   Z-ADD     4             AXH
     C                   END
     C                   Z-ADD     1             AXV
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Beløp
     C                   MOVE      *BLANKS       ADS
N33  C                   IF        SIDP = 49
N51  C                             OR WFIDP = 49
N91  C*                            OR SIDP_4 = 4171
N91  C*                            OR WFIDP_4 = 4171
N91  C                             OR SIKUNS = 1
N33  C                   MOVEL     VFIMVG        ADS
E39  C                   Z-ADD     11            AXH
N33  C                   ELSE
     C                   MOVEL     WFIBBL        ADS
N33  C                   Z-ADD     13            AXH
N33  C                   END
     C                   Z-ADD     1             AXV
S33  C*                  Z-ADD     13            AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
     C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Mål                                                MEA0V /
      *////////////////////////////////////////////////////////////
     C     MEA0V         BEGSR
      *___________
      * Bruttovekt
      *"""""""""""
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'MEA+AAF+'    A(1)
     C                   MOVEA     'G+KGM:'      A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     14            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Bruttovekt
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFIVKB        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *__________
      * Nettovekt
      *""""""""""
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'MEA+AAF+'    A(1)
     C                   MOVEA     'N+KGM:'      A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     14            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Nettovekt
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFIVKN        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *_______
      * Mengde
      *"""""""
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C     TARIKM        SETLL     TARI
     C     TARIK         READPE    TARI                                   33
     C     *IN33         DOWEQ     '0'
S26  C*    TADATO        IFLE      M0068A
S26  C*    TADTS         ANDEQ     0
S26  C*    TADATO        ORLE      M0068A
S26  C*    TADTS         ANDGE     M0068A
N26  C     TADATO        IFLE      X_M0068A
N26  C     TADTS         ANDEQ     0
N26  C     TADATO        ORLE      X_M0068A
N26  C     TADTS         ANDGE     X_M0068A
     C                   LEAVE
     C                   END
     C     TARIK         READPE    TARI                                   33
     C  N33              ENDDO
N23   *
N23   * VED OMBEREGNING TAR DET SOM FINNES.
N23  C   33              IF        SITDN < 0
N23  C     TARIKM        SETLL     TARI
N23  C     TARIK         READPE    TARI                                   33
N23  C                   END
      *
     C  N33TAENHE        IFNE      *BLANKS
     C     WFINTM        ANDNE     0
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'MEA+AAF+'    A(1)
     C                   MOVEA     'ZZ+'         A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     11            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Enhet
s57  C*    TAENHE        IFEQ      'stk'
s57  C*    TAENHE        OREQ      'STK'
s57  C*                  MOVE      'NMB'         TAENHE
s57  C*                  END
s47  C*    TAENHE        IFEQ      'par'
s57  C*    TAENHE        OREQ      'PAR'
s57  C*                  MOVE      'NPR'         TAENHE
s57  C*                  END
s57  C*    TAENHE        IFEQ      'lit'
s57  C*    TAENHE        OREQ      'LIT'
s57  C*                  MOVE      'LTR'         TAENHE
s57  C*                  END
s57  C*    TAENHE        IFEQ      'm3 '
s57  C*    TAENHE        OREQ      'M3 '
s57  C*                  MOVE      'MTQ'         TAENHE
s57  C*                  END
s57  C*    TAENHE        IFEQ      'm2 '
s57  C*    TAENHE        OREQ      'M2 '
s57  C*                  MOVE      'MTK'         TAENHE
s57  C*                  END
s57  C*    TAENHE        IFEQ      'gra'
s57  C*    TAENHE        OREQ      'GRA'
s57  C*                  MOVE      'GRM'         TAENHE
s57  C*                  END
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     TAENHE        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Mengde
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WFINTM        ADS
     C                   Z-ADD     1             AXV
S04  C*                  Z-ADD     7             AXH
N04  C                   Z-ADD     9             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   END
     C                   SETOFF                                       33
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Avgifter                                           TAX0V /
      *////////////////////////////////////////////////////////////
     C     TAX0V         BEGSR
     C     1             DO        16            XN3
N34   * VED MVA-REGISTRERT --> IKKE BEREGNE MVA
N34  C                   IF        SIMVA = 'J' AND Y1(XN3) = 'MV'
S80  C*                            AND %SUBST(SIRG:11:1) = ' '
N80  C                             AND (%SUBST(SIRG:11:1) = ' '                 FIRMA
N80  C                             OR %SUBST(SIRG:11:1) = 'B')
SXX  C                   EVAL      Y1(XN3) = *BLANKS
N34  C                   END
     C     Y1(XN3)       IFNE      *BLANKS
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'TAX+1+16'    A(1)
     C                   MOVEA     '1:'          A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftsbeløp
     C                   MOVE      *BLANKS       ADS
     C                   Z-ADD     1             AXV
     C     B1(XN3)       IFEQ      0
     C                   MOVEL     '0'           ADS
     C                   Z-ADD     1             AXH
     C                   ELSE
     C                   MOVEL     B1(XN3)       ADS
E39  C                   Z-ADD     11            AXH
     C                   MOVE      'L'           WDIR
     C                   END
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftstype
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     Y1(XN3)       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     ':107:NO1'    A(1)
     C                   MOVEA     '+'           A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgifts sekvens
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     E1(XN3)       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     ':105:NO1'    A(1)
     C                   MOVEA     '+'           A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftsgrunnlag
     C                   MOVE      *BLANKS       ADS
     C                   MOVE      G1(XN3)       XFD02N            2 0
     C     XFD02N        IFEQ      0
     C                   MOVEL     G1(XN3)       ADS
     C                   Z-ADD     1             AXV
E39  C                   Z-ADD     11            AXH
     C                   MOVE      'L'           WDIR
     C                   ELSE
     C                   Z-ADD     G1(XN3)       ØN152
     C                   EXSR      SRNE
     C                   MOVEL     ØAN           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     12            AXH
     C                   MOVE      'N'           WCHART
     C                   END
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftsats
     C                   MOVE      *BLANKS       ADS
     C     S1(XN3)       IFEQ      0
     C                   MOVEL     '0'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   ELSE
     C                   Z-ADD     S1(XN3)       ØN152
     C                   EXSR      SRNE
     C                   MOVEL     ØAN           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     13            AXH
     C                   MOVE      'N'           WCHART
     C                   END
     C                   EXSR      SRÅ
      * Havnekasse, kodet
     C     Y1(XN3)       IFEQ      'TA'
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     TR(XN3)       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':139:NO1'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   END
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Nødvendige dokumenter                              DCR0V /
      *////////////////////////////////////////////////////////////
     C     DCR0V         BEGSR
S12  C*    1             DO        5             XN3
N12  C     1             DO        10            XN3
     C     TO(XN3)       IFNE      *BLANKS
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'DCR+811+'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Kode for dokument
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     TC(XN3)       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Dokument
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     TO(XN3)       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     17            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   END
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Godsbeskrivelse                                    GDS0V /
      *////////////////////////////////////////////////////////////
     C     GDS0V         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'GDS+2'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Fritekster                                         FTX0V /
      *////////////////////////////////////////////////////////////
     C     FTX0V         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'FTX+AAA+'    A(1)
     C                   MOVEA     '++'          A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Fritekst
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     VB(1)         ADS
     C                   Z-ADD     1             AXV
S12  C*                  Z-ADD     15            AXH
N12  C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
      *
     C     2             DO        5             XN3
     C     VB(XN3)       IFNE      *BLANKS
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Fritekst
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     VB(XN3)       ADS
     C                   Z-ADD     1             AXV
S12  C*                  Z-ADD     15            AXH
N12  C                   Z-ADD     30            AXH
     C                   EXSR      SRÅ
     C                   END
     C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Tollstatus for gods  DFO                           CST0M /
      *////////////////////////////////////////////////////////////
     C     CST0M         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   IF        XFT3VN = *BLANKS
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'CST+1+00'    A(1)
     C                   MOVEA     '000000:1'    A(9)
     C                   MOVEA     '22:NO1+'     A(17)
     C                   ELSE
     C                   EVAL      ADS = 'CST+1+'
     C                             + %TRIM(XFT3VN)
     C                             + ':122:NO1+'
     C                   END
     C                   Z-ADD     1             AXV
     C                   Z-ADD     23            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Prosedyre, kodet
     C                   MOVE      *BLANKS       ADS
N89  C                   IF        X_M0068A < X_4SIFF
     C                   MOVEL     SIDP          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
N89  C                   ELSE
N89  C                   MOVEL     SIDP_4        ADS
N89  C                   Z-ADD     1             AXV
N89  C                   Z-ADD     4             AXH
N89  C                   END
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':117:1+'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Preferansekode
     C                   MOVE      *BLANKS       ADS
     C     SIDP          IFEQ      70
     C     SIDP          OREQ      72
     C                   MOVEL     'N'           ADS
     C                   ELSE
     C  N42              MOVEL     'J'           ADS
     C   42              MOVEL     'N'           ADS
     C                   END
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     ':116:NO1'    A(1)
     C                   MOVE      '+'           A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Verdifastsettelseskode
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '1:109:1'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Oppringelseslandkode     DFO                       LOC0M /
      *////////////////////////////////////////////////////////////
     C     LOC0M         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'LOC+27:'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SILKA         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Mål          DFO                                   MEA0M /
      *////////////////////////////////////////////////////////////
     C     MEA0M         BEGSR
      *___________
      * Bruttovekt
      *"""""""""""
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'MEA+AAF+'    A(1)
     C                   MOVEA     'G+KGM:'      A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     14            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Bruttovekt
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIVKB         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     9             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *_______
      * Mengde
      *"""""""
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C     SINTK         IFNE      0
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'MEA+AAF+'    A(1)
     C                   MOVEA     'ZZ+'         A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     11            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Enhet
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'NMB'         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Mengde
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SINTK         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Nødvendige dokumenter  DFO                         DCR0M /
      *////////////////////////////////////////////////////////////
     C     DCR0M         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C     XFT3KD        IFNE      *BLANKS
     C     XFT3KD        ANDNE     '.  '
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'DCR+811+'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Kode for dokument
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     XFT3KD        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Dokument
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     XFT3DK        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     17            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C     XFT4KD        IFNE      *BLANKS
N20  C                   Z-ADD     1             XPOS              3 0
N20  C     STDCR0M1      TAG
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'DCR+811+'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Kode for dokument
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     XFT4KD        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Dokument
     C                   MOVE      *BLANKS       ADS
S20  C*                  MOVEL     XFT4          ADS
N20  C                   IF        XPOS < 35
N20  C                   EVAL      ADS = %SUBST(XFT4:XPOS:17)
N20  C                   ELSE
N20  C                   EVAL      ADS = %SUBST(XFT4:XPOS:7)
N20  C                   END
     C                   Z-ADD     1             AXV
     C                   Z-ADD     17            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
N20   *
N20  C                   SELECT
N20  C                   WHEN      XPOS = 1
N20  C                   ADD       17            XPOS
N20  C                   IF        %SUBST(XFT4:XPOS:17) <> *BLANKS
N20  C                   GOTO      STDCR0M1
N20  C                   END
N20  C                   WHEN      XPOS = 18
N20  C                   ADD       17            XPOS
N20  C                   IF        %SUBST(XFT4:XPOS:7) <> *BLANKS
N20  C                   GOTO      STDCR0M1
N20  C                   END
N20  C                   ENDSL
N20   *
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Godsbeskrivelse    DFO                             GDS0M /
      *////////////////////////////////////////////////////////////
     C     GDS0M         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'GDS+2'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Fritekster   DFO                                   FTX0M /
      *////////////////////////////////////////////////////////////
     C     FTX0M         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'FTX+AAA+'    A(1)
     C                   MOVEA     '++'          A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Fritekst
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIFT1         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     31            AXH
     C                   EXSR      SRÅ
      *
     C     SIFT2         IFNE      *BLANKS
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Fritekst
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIFT2         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     31            AXH
     C                   EXSR      SRÅ
     C                   END
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Seksjonskille                                       UNSS /
      *////////////////////////////////////////////////////////////
     C     UNSS          BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNS+S'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Sum avgifter                                       TAX0S /
      *////////////////////////////////////////////////////////////
     C     TAX0S         BEGSR
N34   *
N34   * VED MVA-REGISTRERT --> IKKE BEREGNE MVA
N34  C                   IF        SIMVA = 'J'
N34  C     1             DO        38            XN3
N34  C                   IF        T1(XN3) = 'MV'
N34  C                   EVAL      T1(XN3) = *BLANKS
N34  C                   EVAL      SIBEL7  = SIBEL7 - T2(XN3)
N34  C                   END
N34  C                   ENDDO
N34  C                   END
S52  C*                  IF        *IN92 = *OFF AND *IN94 = *OFF
N52  C                   IF        *IN92 AND *IN94 = *OFF
N63  C                             OR UTBTAX0S = 'J'
S63  C*                            OR *IN92 AND UTBTAX0S = 'J'
S52   * N94,N92 (KUN "BV/TO" AVGIFTER) --> SUM MÅ VÆRE MED
N52   * N94, 92 (KUN "BV/TO" AVGIFTER) --> SUM MÅ VÆRE MED
N64  C                   EVAL      XAN01 = %SUBST(SIRG:11:1)
S80  C*                  IF        XAN01 = ' ' AND XTOT2 < 50                   NÆRINGSLIV, < 50 KR
N80  C                   IF        (XAN01 = ' ' OR XAN01 = 'B')                 NÆRINGSLIV, < 50 KR
N80  C                             AND XTOT2 < 50
N64  C                             AND X_M0068A >= X350_DT
N64  C                             AND UTBTAX0S <> 'J'
N64   * NÆRINGSLIV OG MINDRE ENN 50 KR OG ETTER 01.01.2020
S80  C*                            OR XAN01 = ' ' AND SIBEL4 < 350              NÆRINGSLIV, < 350 KR
N80  C                             OR (XAN01 = ' ' OR XAN01 ='B')               NÆRINGSLIV, < 350 KR
N80  C                             AND SIBEL4 < 350
N64  C                             AND X_NMIDDEL = 'J' AND XTOT2 < 50           NÆRINGSMIDDEL, <50KR
N64  C                             AND X_M0068A >= X350_DT
N69  C                             AND X_M0068A < X350_FIRMA
N64  C                             AND UTBTAX0S <> 'J'
N64   * NÆRINGSLIV, MINDRE ENN 350 KR, NÆRINGSMIDDEL, TOLL/MOMS/AVGIFT < 50 ETTER 01.01.2020
S80  C*                            OR XAN01 = ' ' AND SIBEL4 < 350              NÆRINGSLIV, < 350 KR
N80  C                             OR (XAN01 = ' ' OR XAN01 ='B')               NÆRINGSLIV, < 350 KR
N80  C                             AND SIBEL4 < 350
N64  C                             AND X_NMIDDEL <> 'J'                         IKKE NÆRINGSMIDDEL
N64  C                             AND X_M0068A >= X350_DT
N69  C                             AND X_M0068A < X350_FIRMA
N64  C                             AND UTBTAX0S <> 'J'
N64   * NÆRINGSLIV, MINDRE ENN 350 KR, IKKE NÆRINGSMIDDEL ETTER 01.01.2020
N64  C                             OR XAN01 <> ' ' AND SIBEL4 < 350             PRIVAT, < 350
N80  C                             AND XAN01 <> 'B'                             PRIVAT, < 350
N6401C*                            AND X_M0068A >= X350_DT
N6401C                             AND X_M0068A < X350_DT
N64  C                             AND UTBTAX0S <> 'J' AND X_NMIDDEL <> 'J'
N64   * PRIVAT, < 350 KR, IKKE NÆRINGSMIDDEL OG ETTER 01.01.2020
N64  C                   GOTO      SLTAX0S
N64  C                   END
N38  C                   ELSE
N64  C                   EVAL      XAN01 = %SUBST(SIRG:11:1)
N64  C                   IF        XAN01 = ' '
N80  C                             OR XAN01 = 'B'
N34.1C     SIBEL7        CABLT     50            SLTAX0S
N64  C                   ELSE
N64  C     SIBEL7        CABLT     1             SLTAX0S
N64  C                   END
S80  C*                  IF        XAN01 = ' ' AND XTOT2 < 50
N80  C                   IF        (XAN01 = ' ' OR XAN01 = 'B')                 FIRMA
N80  C                             AND XTOT2 < 50
N64  C                             AND X_M0068A >= X350_DT
N64   * NÆRINGSLIV OG MINDRE ENN 50 KR OG ETTER 01.01.2020
S80  C*                            OR XAN01 = ' ' AND SIBEL4 < 350
N80  C                             OR (XAN01 = ' ' OR XAN01 = 'B')              FIRMA
N80  C                             AND SIBEL4 < 350
N64  C                             AND X_M0068A >= X350_DT
N64   * NÆRINGSLIV OG MINDRE ENN 350 KR OG ETTER 01.01.2020
N69  C                             AND X_M0068A < X350_FIRMA
N69   * NÆRINGSLIV 350-KRONEGRENSE FJERNES ETTER 01.04.2020
N64  C                             OR XAN01 <> ' ' AND SIBEL4 < 350
N80  C                             AND XAN01 <> 'B'                             PRIVAT
N64  C                             AND X_M0068A >= X350_DT AND X_NMIDDEL <> 'J'
N64   * PRIVAT OG MINDRE ENN 350 KR OG IKKE NÆRINGSMIDDEL OG ETTER 01.01.2020
N64  C                   GOTO      SLTAX0S
N64  C                   END
N38  C                   END
N34   *
     C  N93
     CORN94T1(1)         IFNE      *BLANKS
      *___________________
      * Sum av totalavgift
      *"""""""""""""""""""
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'TAX+4+16'    A(1)
     C                   MOVEA     '1:'          A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftsbeløp
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SIBEL7        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     11            AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END                                                    1<E
      *
      *___________________
      * Sum av delavgift
      *"""""""""""""""""""
     C                   Z-ADD     1             XN3
     C  N93
N18  CORN94XN3           DOWLE     38                                           1<B
S18  C*RN94XN3           DOWLE     16                                           1<B
      * VED TRAFIKKAVGIFT UNDER 5 KR. IKKE LEGGE UT SEGMENT
     C   93T1(XN3)       IFEQ      'TA'
     C                   MOVE      *BLANKS       T1(XN3)
     C                   END
     C     T1(XN3)       IFNE      *BLANKS                                       2<-B
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'TAX+3+16'    A(1)
     C                   MOVEA     '1:'          A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftsbeløp
     C                   MOVE      *BLANKS       ADS
N46  C                   IF        T2(XN3) = 0
N46  C                   MOVEL     '0'           ADS
N46  C                   Z-ADD     1             AXV
N46  C                   Z-ADD     1             AXH
N46  C                   ELSE
     C                   MOVEL     T2(XN3)       ADS
     C                   Z-ADD     1             AXV
E39  C                   Z-ADD     11            AXH
     C                   MOVE      'L'           WDIR
N46  C                   END
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Avgiftstype
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     T1(XN3)       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     2             AXH
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ':107:NO1'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   END                                                     2<-E
     C                   ADD       1             XN3
     C                   END                                                    1<-E
N34.1 *
N34.1C     SLTAX0S       TAG
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Kontrolltotaler                                    CNT0S /
      *////////////////////////////////////////////////////////////
     C     CNT0S         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'CNT+5:'      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     6             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Antall poster
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     XNR           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+11:'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Antall poster
     C                   MOVE      *BLANKS       ADS
N50  C                   IF        XTOTSLT = 'J' AND SITDN < 0
N79  C                             AND MVOGN = 'N'
N50  C                   EVAL      ADS = '0'
N50  C                   Z-ADD     1             AXV
N50  C                   Z-ADD     1             AXH
N50  C                   ELSE
     C                   MOVEL     SINTK         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'L'           WDIR
N50  C                   END
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Kontrolltotaler    SIDP = 70/72  or DFO            CNT0M /
      *////////////////////////////////////////////////////////////
     C     CNT0M         BEGSR
      * Segmentnavn
      * W0074  --->  Teller for antall segment
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEA     'CNT+5:1+'    A(1)
     C                   MOVEA     '11:'         A(9)
     C                   Z-ADD     1             AXV
     C                   Z-ADD     11            AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Antall poster
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     SINTK         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Meldingsslutt                                       UNT0 /
      *////////////////////////////////////////////////////////////
     C     UNT0          BEGSR
      * Segmentnavn
     C                   ADD       1             W0036
     C                   ADD       1             W0074
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNT+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Antall segmenter i meldingen (inkludert UNH og UNT)
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     W0074         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Meldingsreferanse
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     M0062         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     14            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Sendningsslutt                                      UNZ0 /
      *////////////////////////////////////////////////////////////
     C     UNZ0          BEGSR
      * Start segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'UNZ+'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     W0036         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   MOVE      'L'           WDIR
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '+'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      *
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     S0020         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     10            AXH
     C                   EXSR      SRÅ
      * Slutt segment
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
      * Legg in 3 blanke i slutten for IBM IN
     C     WNETW         IFEQ      '2'
     C     1             DO        3
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ' '           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   ENDDO
     C                   ENDIF
      *
     C     BX            IFGT      1
     C                   WRITE     EDISER
     C                   END
     C                   ENDSR
N66  C************************************************
N66  C     N66SR1        BEGSR
N66  C************************************************
N66  C                   SELECT
N66  C     HEUR          WHENEQ    'A'
N66  C                   MOVE      'XXX'         TSKODE            3
N66  C     HEUR          WHENEQ    'C'
N66  C                   MOVE      'CUS'         TSKODE
N66  C     HEUR          WHENEQ    'F'
N66  C                   MOVE      'A62'         TSKODE
N66  C                   ENDSL
N66
N66  C                   MOVE      SIAVD         TSAVD             4
N66  C                   MOVE      SITDN         TSOPD             7
N66  C                   MOVE      M0068A        U0068A            9
N66  C                   MOVE      M0068B        U0068B            6
N66  C                   MOVE      M0068C        U0068C            2
N66
N66  C                   CALL      'SYXML45NOI'
N66  C                   PARM                    TSAVD
N66  C                   PARM                    TSOPD
N66  C                   PARM                    TSKODE
N66  C                   PARM                    U0068A
N66  C                   PARM                    U0068B
N66  C                   PARM                    U0068C
N66
N66  C     KEYD          CHAIN     HEADF
N66  C                   IF        %FOUND(HEADF)
N66  C                   EVAL      TRSTA3='S'
N66  C                   UPDATE    HEADFR
N66  C                   ENDIF
N66  C                   ENDSR
N81   *////////////////////////////////////////////////////////////
N81   * SR for håndtering av feil                         SRERROR /
N81   *////////////////////////////////////////////////////////////
N81  C     SRERROR       BEGSR
N81  C                   CALL      'SYGE15C'
N81  C                   PARM                    WDT               8
N81  C                   PARM                    WTM               6
N81  C                   MOVE      WDT           XDT               8 0
N81  C                   MOVE      WTM           XTM               6 0
N81  C                   EVAL      XEMNE = 'For mange linjer i SAD-i'
N81  C                             + %TRIM(%EDITC(SIAVD:'Z')) + '/'
N81  C                             + %TRIM(%EDITC(SITDN:'Z'))
N81  C                   EVAL      XMSG = 'SAD-import '
N81  C                             + %TRIM(%EDITC(SIAVD:'Z')) + '/'
N81  C                             + %TRIM(%EDITC(SITDN:'Z'))
N81  C                             + ' har for mange linjer. '
N81  C                             + 'Firma: ' + %TRIM(FIFT) + ', '
N81  C                             + 'Dato: ' + %TRIM(%EDITW(XDT:'    .  .  '))
N81  C                             + ', '
N81  C                             + 'Tid: ' + %TRIM(%EDITW(XTM:'  :  :  '))
N81  C                             + '. '
N81  C                   CALL      'EDIERRCA'
N81  C                   PARM                    XEMNE            40
N81  C                   PARM                    XMSG            256
N81   *
N81  C                   ENDSR
N81   *
      *
     OSADVR     E            SADVLN
     O                       SVLN
     OSADHR     E            OPDSAD
     O                       SIST
     O                       SIBELT
     O                       SIBEL5
     O                       SIBEL6
     O                       SIBEL7
