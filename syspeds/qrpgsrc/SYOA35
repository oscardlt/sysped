     FSYOA35FM  CF   E             WORKSTN
     FTRAVH3    UF   E           K DISK
     FTRAVH1    UF A E           K DISK
     F                                     RENAME(TRAVHR:TRVH1R)
     FTRAVV6    UF   E           K DISK
      *
     C     *ENTRY        PLIST
     C                   PARM                    IN01              1
     C                   MOVE      '0'           IN01
      *
     C     TRAVKEY       KLIST
     C                   KFLD                    YYOPKO
     C                   KFLD                    wsfra
     C                   MOVE      'O'           YYOPKO            1
     C     Travh1K       KLIST
     C                   KFLD                    YYavd             4 0
     C                   KFLD                    GMTNR             8 0
     C*--------------------------------------------------------------
      * det kan ikke finnes turer klare for overføring ...
     c     'F'           chain     TRAVH3                             33
     c     *IN33         ifeq      '0'
     C                   MOVE      '1'           IN01
     C                   GOTO      SLUTT
     c                   end
      *
     C     START         TAG
     C                   EXFMT     BILDE01
     C* AVBRUDD ?? GI MELDING
     C   03              MOVE      '1'           IN01
     C   03              GOTO      SLUTT
     C* DERSOM MER ENN 1000 MERKET MÅ DET KVITTERES FOR MED F23
     C     WSTIL         SUB       WSFRA         ANTALL            7 0
     C     ANTALL        COMP      1000                               99
     C   99
     CANN23              GOTO      START
     C*
     C* OMKJØRING GJENNOMFØRES - MERK ALLE FRA/TIL NR
     C* a) Header-nivå = Turer transpportøren har kjørt...
     C     TRAVKEY       SETLL     TRAVH3
     C     'O'           READE     TRAVH3                                 30
     c     *in30         doweq     '0'
     C     THFAKT        IFGT      WSTIL
     C                   UPDATE    TRAVHR
     c                   goto      UtTravh
     C                   END
     C                   MOVE      'F'           THST
     C                   UPDATE    TRAVHR
     C     'O'           READE     TRAVH3                                 30
     C                   END
     c     UtTravh       tag
      *
     C* b) Linje-nivå = Oppdrag tanspportøren er godskrevet som agent / justeringer mm
     C     WSFRA         SETLL     TRAVV6
     C                   READ      TRAVV6                                 30
     c     *in30         doweq     '0'
     C     TVFAKT        IFGT      WSTIL
     C                   UPDATE    TRAVVR
     c                   goto      UtTravv
     C                   END
     c     TVFAKT        ifne      GMFAKT
     c     GMFAKT        andne     *zeros
     c                   exsr      GodskRcd
     c                   end
     C                   ADD       1             XXBUDA            7 0
     C                   ADD       TVBLL         XXTOT            13 2
     c                   move      TVfakt        GMfakt            7 0
     c                   move      TVTUNR        GMTNR
     C                   MOVE      'F'           TVST
     C                   UPDATE    TRAVVR
     C                   READ      TRAVV6                                 30
     C                   END
     c     UtTravv       tag
      *
      * legg ut sist akkumulerte
     c     GMFAKT        ifne      *zeros
     c                   exsr      GodskRcd
     c                   end
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
      **************************************************
     c     GodskRcd      begsr
      **************************************************
     c     Travh1K       chain     TRAVH1                             33
     c  N33              delete    TRVH1R
      *
     C                   MOVE      'F'           THST
     C                   Z-ADD     GMTNR         THTNR
     C                   Z-ADD     99999998      THRTNR
     C                   Z-ADD     0             THTAVD
     C                   Z-ADD     GMTNR         THTUNR
     C                   MOVE      ' '           THKDM
     C                   MOVE      *ZEROS        THAVT
     C                   MOVE      *ZEROS        THBRT
     C                   MOVE      *ZEROS        THINH
     C                   MOVE      *ZEROS        THUTK
     C                   MOVE      *ZEROS        THRKV
     C                   MOVE      *ZEROS        THBUD
     C                   MOVE      *ZEROS        THJUS
     C                   MOVE      *ZEROS        THTOT
     C* BLANKER TELLER FOR ANTALL AV ULIKE SUBPOSTER (A-G)
     C                   MOVE      *ZEROS        THAVTA
     C                   MOVE      *ZEROS        THBRTA
     C                   MOVE      *ZEROS        THINHA
     C                   MOVE      *ZEROS        THUTKA
     C                   MOVE      *ZEROS        THRKVA
     C                   MOVE      *ZEROS        THBUDA
     C                   MOVE      *ZEROS        THJUSA
     C                   MOVE      ' '           THSTAR
RAMBEC                   z-add     GMFAKT        THFAKT
RAMBEC                   z-add     XXBUDA        THBUDA
     c                   z-add     XXTOT         THBUD
     c                   z-add     XXTOT         THTOT
     c                   write     TRVH1R
     c                   endsr
