********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10001 * 01 YBC PTF10 KLARGJØR TIL EKSTERN REFERANSE
10XXX * 02 YBC PTF10 FEIL LANDKODE HENTET TIL TVLKK
10XXX * 03 SH  PTF10 videreutviklet extern referanse
10017 * 04 YBC PTF10 SKILLE TET-EKSPORT OG FORHÅNDSVARSLING IMPORT
10020 * 05 YBC PTF10 HENT LINJE FRA HEAD14 VED FORHÅNDSVARSLING
10021 * 06 YBC PTF10 HENT SAD-VARELINJER VED FORHÅNDSVARSLING
10XXX * 07 YBC PTF10 IKKE TEST GARANTIREF VED FORHÅNDSVARSLING
10025 * 08 YBC PTF10 NY BETINGELSE C547 ERSTATTER C567
10XXX * 09 YBC PTF10 TEST GRENSE PÅ FØLSOMME VARER
10171 * 10 YBC PTF10 RUNDSKRIV 2012/10167-3/7
10250 * 11 YBC PTF10 DOKUMENTKODE ER ENDRET FRA 3A TIL 4A
10253 * 12 YBC PTF10 NY PAKKETYPE VS, BEHANLES SAMME SOM VR
10XXX * 13 YBC PTF10 BEHANDLE NF PÅ SAMME MÅTE SOM NE
10318 * 14 YBC PTF10 VEKT ER ENDRET FRA 5.0 TIL 12.3
      *              VAREBESKRIVELSE ER ØKT FRA 15A TIL 30A
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11XXX * 15 YBC PTF11 FJERN TEST PÅ TET00004
11XXX * 16 YBC PTF11 BLANK NETTO VEKT VED HENTING FRA OPPDRAG
11XXX * 17 YBC PTF11 SLÅ SAD-LINJER SAMME FØR OPPDATERING PÅ TET
11XXX * 18 YBC PTF11 BRUK FORRIGE LINJES MERKING VED HENTING FRA SAD-EKSP
11115 * 19 YBC PTF11 THGBL INNEHOLDER NÅ TO DESIMALER
11128 * 20 YBC PTF11 VEKT ER ENDRET FRA 9.0 TIL 11.3, EGET FELT FOR GARANTI
11129 * 21 YBC PTF11 NYE KODER FOR FORHÅNDSVARSEL FRA JUNI 2016
********************************************************************
      *
      **************************************************************
      *** PROGRAM SKAL ARBEIDE MED EL.TRANSITTERING (LINJE)      ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER       ***
      *** LEDIGE INDIKATORER 01 02 09-11 13-16 18 20 23 24
      *** LEDIGE INDIKATORER 32 49-51 95-97
      *** ALLE VARIABLER SOM STARTER MED 'X' ER ARBERDSVAR.      ***
      ***   OG DEFINERES I PROGRAM                               ***
      **************************************************************
      *
N03  FTRXREF    UF A E           K DISK
N03  FFRISOL01  IF   E           K DISK
     FSYPTFF    IF   E           K DISK
     FTRUSTD    IF   E           K DISK    PREFIX(STD_)
     FTRUH      UF   E           K DISK
     FTRUHFV    IF   E           K DISK
     FTRUGH     UF   E           K DISK
     FKODTVAL2  IF   E           K DISK
     FTRUV      UF A E           K DISK
     FTRUVAM    UF A E           K DISK
     FTRUVFV    UF   E           K DISK
     FTRUV02    IF   E           K DISK    RENAME(TRUVR:TRUV02R)
     FTRUHL     IF   E           K DISK
     FTRUVCN    UF   E           K DISK
S06  F*TRUVDK    UF   E           K DISK
N06  FTRUVDK    UF A E           K DISK
     FTRUVFS    UF   E           K DISK
     FTRUVMN    UF   E           K DISK
     FTRUVTD    UF   E           K DISK
     FTRUVVT    UF   E           K DISK
     FTRKODL01  IF   E           K DISK
     FTRFKDF    IF   E           K DISK
     FKODTS2    IF   E           K DISK
     FFIRM      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FTARI      IF   E           K DISK
     FHEADF     UF   E           K DISK
N05  FHEAD14    IF   E           K DISK    RENAME(HEADFR:HEADFR14)
     FSAEH      IF   E           K DISK
     FSAEV      IF   E           K DISK
N01  FZTRUHL01  IF   E           K DISK    RENAME(TRUHR:TRUHRZ1)
N01  FZTRUHL03  IF   E           K DISK    RENAME(TRUHR:TRUHRZ3)
N01  FZTRUVL01  UF   E           K DISK    RENAME(TRUVR:TRUVRZ)
N01  FZTRUVAM1  UF   E           K DISK    RENAME(TRUVAMR:TRUVAMRZ)
     FTURER14   IF   E           K DISK
     FTR012D    CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     SFILE(SUBFIL2:ZRECN2)
     F                                     INFDS(FBAREA)
     D LI              S              5  0 DIM(200)
     D AV              S              4  0 DIM(200)
     D OP              S              7  0 DIM(200)
      *
     D FBAREA          DS
S20  D* WSCLOC               370    371B 0
N20  D  WSCLOC               382    383B 0
     D  WSSUBN               378    379B 0
S20  D*                DS
S20  D* TVDREF                 1     20
S20  D* WXDREF                 1     19
S20  D*                DS
S20  D* TVVT                   1     48
S20  D* T2VT                   1     15
     D                 DS
     D  W2VNT                  1      8  0
     D  W2VNT6                 1      6  0
     D                 DS
     D  SYRG                   1     14
     D  SYFOR9                 1      9
     D  SYFORE                 1     11
     D                 DS
     D  UAVD                   1      4  0
     D  UTDN                   5     11  0
     D  UUR                   12     12
     D  UWS                   13     22
     D  UTVIN                 23     23
     D  UIN27                 24     24
     D  UIN34                 25     25
     D  UIN36                 26     26
S20  D* UVKB                  27     35  0
N20  D  UVKB                  27     37  3
E20  D  U1N07                 38     40
E20  D  UDK                   41     45
E20  D  UKDC                  46     46
E20  D  UALK                  47     48
E20  D  UBLK                  49     50
E20  D  UPRO                  51     58  0
E20  D  ULSTL                 59     62  0
E20  D  UZREFF                63     79
E20  D  UZUNIK                80     88  0
      * OBS! HUSK INITIERE ALLE FELTER PÅ TR011R
     D  UPARM2                 1    128
      *
     C                   EXSR      INIT
      *
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     0             ZRECNO
     C                   MOVE      W3LIGM        W3LI
     C                   MOVE      *ZEROS        XLI
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C  N31TRV2K         SETLL     TRUV02
     C   31TRV1K         SETLL     TRUV
     C     START1        TAG
     C  N31TRHK          READE     TRUV02                                 94
     C   31TRHK          READE(N)  TRUV                                   94
     C  N94
     CAN 31              MOVE      TVLI          W3LI
     C   94              MOVE      *BLANKS       WSNR
      *
     C     START2        TAG
      *
     C  N94              DO
     C                   DO        99998
     C                   ADD       1             ZRECNO
     C     TVLI          IFGT      XLI
     C                   MOVE      TVLI          XLI               5 0
     C                   END
     C                   MOVE      TVLI          XLI2              5 0
     C                   MOVE      TVLN          WXLN
     C     TVNT          IFEQ      0
     C                   MOVE      TVNTEH        XVNTK
     C                   ELSE
     C                   MOVE      TVNT          XVNTK
     C                   END
N03  C     TRXREFK       CHAIN(N)  TRXREF                             33
N03  C   33              MOVE      *BLANKS       TRXEXT
     C                   WRITE     SUBFIL
     C  N31TRHK          READE     TRUV02                                 94
     C   31TRHK          READE(N)  TRUV                                   94
     C  N94
     CAN 31              MOVE      TVLI          W3LI
     C  N94              END
     C                   END
      *
     C     XHOPD         IFEQ      'J'
     C     ZRECNO        IFEQ      0
     C                   EXSR      HOPD
     C                   GOTO      START
     C                   ELSE
     C                   MOVE      'N'           XHOPD
     C                   END
     C                   END
      *
     C     XHOPD2        IFEQ      'J'
     C     ZRECNO        IFEQ      0
     C                   EXSR      HOPD2
     C                   GOTO      START
     C                   ELSE
     C                   MOVE      'N'           XHOPD2
     C                   END
     C                   END
      *
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C     ZRECNO        IFGT      1
     C                   Z-ADD     1             ZRECNO
     C                   END
     C                   Z-ADD     4             LINNBR
     C                   Z-ADD     2             POSNBR
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   EXFMT     NYWRK
     C                   ELSE
     C                   WRITE     SUBCTL
     C                   EXFMT     BUNN
     C                   END
      *
      ***
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   END
      ***
      *
     C                   SETOFF                                       989930
      *
      *** F03 OG 27 PÅ ---> AVBRYTTE SPØRRING
     C   03
     CAN 27              MOVE      *ZEROS        UFLAGG
     C   03
     CAN 27              GOTO      SLUTT
      *
     C   10              DO
     C                   EXSR      HOPD
     C                   GOTO      START
     C                   END
      *** F12 ---> AVBRYTTE REGISTRERING AV DETALJE LINJER
     C   12              Z-ADD     1             UFLAGG
     C   12              GOTO      SLUTT
      *  07 = SØKE OPPDRAG
     C   07              DO
     C                   MOVE      'S'           UTYPE             1
     C                   CALL      'SYFM21'
     C                   PARM                    UTYPE
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    USG               3
     C                   GOTO      START3
     C                   END
      *
     C   03
     COR 17              DO
     C                   EXSR      PRINT
      *** F12 ---> AVBRYTTE F3/F17
     C   12              Z-ADD     4             LINNBR
     C   12              Z-ADD     2             POSNBR
     C   12              GOTO      START3
     C                   GOTO      SLUTT
     C                   END
      *
      *** F5  ---> VISE 1. SIDE PÅ SUBFIL.
     C   05              GOTO      START
      *** F6  ---> LAGE NYE DETALJE LINJER
     C   06              GOTO      START5
      *** F8  ---> VELGE SORTERINGSMÅTE OG START POST FOR SUBFIL
     C   08              GOTO      START7
      *
      *** ROLL UP ---> BLA TIL NESTE SIDE
     C   25              DO
     C                   Z-ADD     YRECNO        ZRECNO
     C                   SETOFF                                       25
     C  N94
     CAN 31TRVK          SETLL     TRUV
     C  N94
     CAN 31TRHK          READE(N)  TRUV                                   94
     C                   GOTO      START2
     C                   END
      *
      *** SJEKKE OM BRUKER HAR VALGT OPSJONER. HIVS SÅ,T UTFØRE DISSE.
     C     ZRECNO        IFNE      0
     C                   EXSR      HENTSR
     C                   END
      *** 98 PÅ ---> BRUKER HAR IKKE VALGT OPSJON. VISE SAMME POSTER
      ***            I SUBFIL DVS. SAMME RECORDNR.
     C   98XRECNO        IFNE      0
     C                   Z-ADD     XRECNO        ZRECNO
     C                   END
      *** 41 AV ---> BRUKER HAR SLETTET NOEN DETALJE LINJER.
      ***            VISE 1. SIDE PÅ SUBFIL
     C  N41              GOTO      START
     C                   GOTO      START3
      *
      *** LAGE NYE DETALJE LINJER
     C     START5        TAG
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     10            POSNBR
     C                   EXSR      MOVB2
      *
     C     START6        TAG
     C  N30W2LI          IFGT      0
     C                   EXSR      TSTOPL
     C                   END
     C                   EXFMT     VARELI
     C                   MOVEA     '00000000'    *IN(83)
     C                   MOVEA     '00000000'    *IN(75)
     C                   MOVEA     '00000000'    *IN(67)
     C                   MOVEA     '000000'      *IN(61)
     C                   MOVEA     '000'         *IN(57)
     C                   MOVEA     '0000'        *IN(52)
     C                   MOVE      '0'           *IN30
      *  07 = SØKE OPPDRAG
     C   07              DO
     C                   MOVE      'S'           UTYPE             1
     C                   CALL      'SYFM21'
     C                   PARM                    UTYPE
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    USG               3
     C                   GOTO      START6
     C                   END
      *
      *** F4  ---> SØKE DATA FOR ET ELLER ANNET FELT.
     C   04              DO
     C                   EXSR      SØKDTA
     C                   GOTO      START6
     C                   END
      *
     C   12W2LI          IFGT      0
     C                   EXSR      DLTOPL
     C                   END
      *
      *** F12 --> AVBRYTTE REGISTRERING AV NYE DETALJE LINJER.
     C  N12              DO
      *** TESTE INNTASTEDE DATA. HVIS FEIL, SETTE IND. PÅ OG VISE
      *** FEILMELDING.
     C                   EXSR      TESTB1
     C   30              GOTO      START6
     C     XNYOPD        IFEQ      'J'
     C                   EXSR      HOPD2
     C                   GOTO      START
     C                   END
      *
     C     W2LI          IFEQ      0
     C                   ADD       1             XLI
     C                   MOVE      XLI           W2LI
     C                   END
      *
     C   15              DO
     C                   EXSR      TILKOD
     C                   GOTO      START6
     C                   END
      *
      *** HVIS IKKE FEIL, OPPDATERE FIL, SUBFIL OG VISE DEN PÅ SKJERMEN
     C                   EXSR      OPDTRV
     C                   MOVEA     '11'          *IN(91)
     C                   WRITE     SUBCTL
     C                   GOTO      START5
     C                   END
     C                   Z-ADD     4             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   GOTO      START3
      *
      *** VELGE SORTERINGSMÅTE OG START POST FOR SUBFIL
      *** 31 PÅ    ---> SORTERE PÅ TARIFFNR. + STATUS       (TRUV02)
      *** 31 AV    ---> SORTERE PÅ REGISTRERINGS REKKEFØLGE (TRUV)
     C     START7        TAG
     C                   MOVE      *ZEROS        W3VNT
     C                   EXFMT     VAREL2
     C   12              GOTO      START3
     C     W3VNT         COMP      0                                      31
     C                   MOVE      W3LI          W3LIGM            5 0
     C                   GOTO      START
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
     C***********************************************
     C     HOPD          BEGSR
     C***********************************************
     C     UPRO          IFEQ      0
     C                   MOVE      UPRO          WSPRO
     C     STPLUK        TAG
     C                   EXFMT     HENTPRO
     C                   MOVE      '0'           *IN30
     C   12              GOTO      SLPLUK
     C     WSPRO         CHAIN     TURER14                            30
N09  C   30              IF        THDK = 'SS'
N21  C                             OR THDK = 'ENTRY' OR THDK = 'EXIT'
N09  C     WSPRO         CHAIN     HEAD14                             30
N09  C                   END
     C   30              GOTO      STPLUK
     C                   MOVE      WSPRO         UPRO
     C                   END
      *
     C                   CALL      'TR019R'
     C                   PARM      UAVD          UAVD2             4 0
     C                   PARM      UTDN          UTDN2             7 0
     C     ULI2          PARM      XLI           ULI2              5 0
     C                   PARM      UDK           UDK2              5
     C     UPRO          PARM      UPRO          UPRO2             8 0
     C                   PARM      ULSTL         ULSTL2            4 0
     C                   PARM                    UFLAGG            1 0
      *
     C     ULI2          IFGT      XLI
     C                   MOVE      'J'           XHOPD
     C     TRHK          SETLL     TRUV
     C     TRHK          READE(N)  TRUV                                   33
     C     *IN33         DOWEQ     '0'
     C     TVLI          IFGT      XLI
     C                   EXSR      CHGTRV
     C   12              LEAVE
     C                   END
     C     TRHK          READE(N)  TRUV                                   33
     C  N33              ENDDO
     C                   MOVE      ULI2          XLI
     C                   END
      *
     C                   MOVE      'N'           XHOPD
      *
     C     SLPLUK        ENDSR
      *
     C***********************************************
     C     HOPD2         BEGSR
     C***********************************************
     C                   CLEAR                   SAEVR
     C                   MOVE      UAVD          TVAVD
     C                   MOVE      UTDN          TVTDN
     C     XNYOPD        IFEQ      'J'
     C                   MOVE      W2AVD2        TVAVD2
     C                   MOVE      W2TDN2        TVTDN2
     C                   MOVE      XLI           TVLI
     C                   MOVE      XLI           XLI3
     C                   ELSE
     C                   MOVE      UAVD          TVAVD2
     C                   MOVE      UTDN          TVTDN2
     C                   MOVE      *ZEROS        TVLI
     C                   MOVE      *ZEROS        XLI3              5 0
     C                   END
     C     HEDFK3        CHAIN     HEADF                              34
      * OPPDATER STATUS FOR Å VISE AT LISTE ER SKREVET
     C  N34UDK           IFEQ      'T1   '                                      1<-B
     C                   MOVE      'A'           TRTSTA
     C                   ELSE                                                   1
     C                   MOVE      'B'           TRTSTA
     C                   END                                                    1<-E
     C  N34              UPDATE    HEADFR
     C     HEDFK3        CHAIN     SAEH                               35
     C     *IN35         IFEQ      '1'                                          1<-B
     C     *IN34         IFEQ      '0'                                           2<-B
      * IKKE FINNE SAD-EKSPORT, BRUK OPPDRAGSOPPLYSNINGER
     C                   ADD       1             TVLI
S20  C*                  MOVE      HEVKT         TVVKTB
N20  C                   Z-ADD     HEVKT         TVVKTB
N16  C                   MOVE      *ZEROS        TVVKTN
     C                   MOVEL     HEGM1         TVMN
     C                   MOVE      HENT          TVNT
     C                   MOVE      HENT          TVNTEH
     C                   MOVE      *BLANKS       TVDTY
     C                   MOVE      *BLANKS       TVDREF
     C     HETLL         IFNE      *BLANKS
S11  C*                  MOVE      '830'         TVDTY
N11  C                   EVAL      TVDTY = '830'
     C                   MOVEL     HETLE         TVDREF
     C                   CAT       HETLL:1       TVDREF
     C                   END
     C                   EXSR      HADR11
     C                   WRITE     TRUVR
     C                   END                                                     2<-E
     C                   ELSE                                                   1
     C                   MOVE      SELKA         TVALK
     C                   MOVE      SELKB         TVBLK
     C                   MOVE      *BLANKS       TVDTY
     C                   MOVE      *BLANKS       TVDREF
     C     SETLL         IFNE      *BLANKS
S11  C*                  MOVE      '830'         TVDTY
N11  C                   EVAL      TVDTY = '830'
     C                   MOVEL     SETLE         TVDREF
     C                   CAT       SETLL:1       TVDREF
     C                   END
     C     HEDFK3        SETLL     SAEV
     C     HEDFK3        READE     SAEV                                   34
     C                   MOVE      *OFF          *IN33
     C  N34              DOW       *IN33 = *OFF                                  2<-B
     C     HEDFK3        READE     SAEV                                   33
S03  C* N33SVVNT         IFNE      0                                              3<-B
S03  C*    SVVKTB        ANDEQ     0
S03  C*                  ELSE                                                     3
N03  C     SVVKTB        IFNE      0                                              3<-B
     C                   LEAVE
     C                   END                                                      3<-E
     C                   ENDDO                                                   2<-E
      *
      * IKKE FINN SAD-EKSPORT (*IN34 PÅ) ELLER FLERE VARELINJER (*IN33 AV)
N06   * ELLER FORHÅNDSVARSLING
S06  C*                  IF        (*IN34 OR (*IN33 = *OFF))                     2<-B
N06  C                   IF        (*IN34 OR                                     2<-B
N06  C                             ((*IN33 = *OFF) AND (XFORHV <> 'J')))
     C   34              CLEAR                   SAEVR
     C                   ADD       1             TVLI
S20  C*                  MOVE      SEVKB         TVVKTB
N20  C                   Z-ADD     SEVKB         TVVKTB
N16  C                   MOVE      *ZEROS        TVVKTN
     C                   IF        (*IN34 OR (SVFT = *BLANKS))                    3<-B
     C                   MOVEL     HEGM1         TVMN
     C                   ELSE                                                     3
     C                   EVAL      TVMN   = SVFT
     C                   END                                                      3<-E
     C                   MOVE      SENTK         TVNT
     C                   MOVE      SENTK         TVNTEH
     C                   EXSR      HADR12
     C                   WRITE     TRUVR
     C                   ELSE                                                    2
N17  C                   IF        SETLL = *BLANKS
E06   * FINN KUN EN SAD-EKSPORT LINJE ELLER FORHÅNDSVARSLING
N18  C     *LIKE         DEFINE    TVMN          X_TVMN
N18  C                   EVAL      X_TVMN = *BLANKS                               3<-B
     C     HEDFK3        SETLL     SAEV
     C     HEDFK3        READE     SAEV                                   34
N06  C                   DOW       *IN34 = *OFF                                   3<-B
N06  C                   IF        SVVKTB <> 0                                     4<-B
     C                   ADD       1             TVLI
     C                   MOVE      SVVNT         TVVNT
S14  C*                  MOVE      SVVKTB        TVVKTB
S14  C*                  MOVE      SVVKTN        TVVKTN
S14  C*                  MOVE      SVNTM         TVNTEH
N14  C                   Z-ADD     SVVKTB        TVVKTB
N14  C                   Z-ADD     SVVKTN        TVVKTN
N14  C                   Z-ADD     SVNTM         TVNTEH
N18  C                   IF        TVNT = 0 AND SVFT = *BLANKS
N18  C                   EVAL      TVMN = X_TVMN
N18  C                   ELSE
     C                   MOVEL     SVFT          TVMN
N18  C                   END
     C                   MOVE      SVNT          TVNT
     C                   MOVEL     SVEH          TVEH
     C                   MOVEL     SVVT          TVVT
S11  C*                  MOVE      '830'         TVDTY
N11  C                   EVAL      TVDTY = '830'
N06  C                   EVAL      TVDREF = %TRIM(SETLE) + ' ' + %TRIM(SETLL)
N06  C                   IF        ((TVLI = 1) AND (XFORHV = 'J'))                  5<-B
N06  C                   IF        (((THSPOM = 'A') OR                               6<-B
N06  C                               (THSPOM = 'C')) OR
N06  C                               (THKREF = *BLANKS))
N06  C                   WRITE     TRUVDKR
S11  C*                  MOVE      '720'         TVDTY
N11  C                   EVAL      TVDTY = '720'
N06  C                   EVAL      TVDREF = *BLANKS
N06  C                   END                                                         6<-E
N06  C                   END                                                        5<-E
     C                   EXSR      HADR12
     C                   WRITE     TRUVR
N06  C                   END                                                       4<-E
N06  C     HEDFK3        READE     SAEV                                   34
N06  C                   ENDDO                                                    3<-E
N17  C                   ELSE
N17  C                   MOVE      TVAVD         U2AVD
N17  C                   MOVE      TVTDN         U2TDN
N17  C                   MOVE      TVAVD2        U2AVD2
N17  C                   MOVE      TVTDN2        U2TDN2
N17  C                   MOVE      TVLI          U2LI
N17  C                   CALL      'TR012RB'
N17  C                   PARM                    FIFIRM
N17  C                   PARM                    U2AVD             4
N17  C                   PARM                    U2TDN             7
N17  C                   PARM                    U2LI              5
N17  C                   PARM                    U2AVD2            4
N17  C                   PARM                    U2TDN2            7
N17  C                   END
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C                   MOVE      TVLI          XLI
     C                   MOVE      'J'           XHOPD2
     C                   MOVE      '1'           *IN40
      *
     C     TRHK          SETLL     TRUV
     C     TRHK          READE(N)  TRUV                                   33
     C     *IN33         DOWEQ     '0'
     C     TVLI          IFGT      XLI3
     C                   EXSR      CHGTRV
     C   12              LEAVE
     C                   END
     C     TRHK          READE(N)  TRUV                                   33
     C  N33              ENDDO
      *
     C                   MOVE      'N'           XHOPD2
      *
     C                   ENDSR
      *
     C***********************************************
     C     HADR11        BEGSR
     C***********************************************
     C                   MOVE      HEKNS         TVKNS
     C                   MOVE      HENAS         TVNAS
     C                   MOVE      HEADS1        TVADS1
     C                   MOVEL     HEADS3        TVPNS
     C                   MOVEL     HEADS3        TVPSS
     C                   MOVEL     'NO'          TVSKS
     C     HEUR          IFEQ      'B'                                          1<-B
     C     HEUR          OREQ      'D'
     C     HEUR          OREQ      'G'
     C                   MOVE      'NO'          TVLKS
     C                   ELSE                                                   1
     C                   MOVE      HELKA         TVLKS
     C                   END                                                    1<-E
      *
     C     HEKNS         IFEQ      0                                            1<-B
     C                   MOVE      *BLANKS       TVTINS
     C                   ELSE                                                   1
     C                   MOVE      HEKNS         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            34
     C                   EVAL      TVTINS = *BLANKS
     C  N34              SELECT                                                  2<-B
S15  C*                  WHEN      PTFDT > UIDAG                                 2
S15  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
S15  C*                  EVAL      TVTINS = SYFOR9
S15  C*                  END                                                      3<-B
     C                   WHEN      EORI = *BLANKS                                2
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
     C                   EVAL      TVTINS = TVLKS + SYFOR9
     C                   ELSE                                                     3
     C                   EVAL      TVTINS = *BLANKS
     C                   END                                                      3<-E
     C                   OTHER                                                   2
     C                   EVAL      TVTINS = EORI
     C                   ENDSL                                                   2<-E
     C                   END                                                    1<-E
      *
     C                   MOVE      HEKNK         TVKNK
     C                   MOVE      HENAK         TVNAK
     C                   MOVE      HEADK1        TVADK1
     C                   MOVEL     HEADK3        TVPNK
     C                   MOVEL     HEADK3        TVPSK
     C                   MOVEL     'NO'          TVSKK
     C     HEUR          IFEQ      'A'                                          1<-B
     C     HEUR          OREQ      'C'
     C     HEUR          OREQ      'F'
     C                   MOVEL     'NO'          TVLKK
     C                   ELSE                                                   1
     C                   MOVEL     HELKA         TVLKK
     C                   END                                                    1<-E
     C     HEKNK         IFEQ      0                                            1<-B
     C                   MOVE      *BLANKS       TVTINK
     C                   ELSE                                                   1
     C                   MOVE      HEKNK         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            34
     C                   EVAL      TVTINK = *BLANKS
     C  N34              SELECT                                                  2<-B
S15  C*                  WHEN      PTFDT > UIDAG                                 2
S15  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
S15  C*                  EVAL      TVTINK = SYFOR9
S15  C*                  END                                                      3<-B
     C                   WHEN      EORI = *BLANKS                                2
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
     C                   EVAL      TVTINK = TVLKK + SYFOR9
     C                   ELSE                                                     3
     C                   EVAL      TVTINK = *BLANKS
     C                   END                                                      3<-E
     C                   OTHER                                                   2
     C                   EVAL      TVTINK = EORI
     C                   ENDSL                                                   2<-E
     C                   END                                                    1<-E
      *
     C     TVADS1        IFEQ      *BLANKS                                      1<-B
     C                   MOVEL     '.'           TVADS1
     C                   END                                                    1<-E
     C     TVADK1        IFEQ      *BLANKS                                      1<-B
     C                   MOVEL     '.'           TVADK1
     C                   END                                                    1<-E
      *
     C                   WRITE     TRUVAMR
      *
     C                   ENDSR
      *
     C***********************************************
     C     HADR12        BEGSR
     C***********************************************
     C                   MOVE      SEKNK         TVKNS
     C                   MOVE      SENAK         TVNAS
     C                   MOVE      SEADK1        TVADS1
     C                   MOVEL     SEADK3        TVPNS
     C                   MOVEL     SEADK3        TVPSS
     C                   MOVEL     'NO'          TVSKS
     C                   MOVEL     'NO'          TVLKS
     C     SEKNK         IFEQ      0                                            1<-B
     C                   MOVE      *BLANKS       TVTINS
     C                   ELSE                                                   1
     C                   MOVE      SEKNK         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            34
     C                   EVAL      TVTINS = *BLANKS
     C  N34              SELECT                                                  2<-B
S15  C*                  WHEN      PTFDT > UIDAG                                 2
S15  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
S15  C*                  EVAL      TVTINS = SYFOR9
S15  C*                  END                                                      3<-B
     C                   WHEN      EORI = *BLANKS                                2
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
     C                   EVAL      TVTINS = TVLKS + SYFOR9
     C                   ELSE                                                     3
     C                   EVAL      TVTINS = *BLANKS
     C                   END                                                      3<-E
     C                   OTHER                                                   2
     C                   EVAL      TVTINS = EORI
     C                   ENDSL                                                   2<-E
     C                   END                                                    1<-E
      *
     C                   MOVE      SEKNS         TVKNK
     C                   MOVE      SENAS         TVNAK
     C                   MOVE      SEADS1        TVADK1
     C                   MOVEL     SEADS3        TVPNK
     C                   MOVEL     SEADS3        TVPSK
     C                   MOVEL     'NO'          TVSKK
S02  C*                  MOVEL     SELKA         TVLKK
N02  C                   MOVEL     SELKB         TVLKK
     C     SEKNS         IFEQ      0                                            1<-B
     C                   MOVE      *BLANKS       TVTINK
     C                   ELSE                                                   1
     C                   MOVE      SEKNS         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            34
     C                   EVAL      TVTINK = *BLANKS
     C  N34              SELECT                                                  2<-B
S15  C*                  WHEN      PTFDT > UIDAG                                 2
S15  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
S15  C*                  EVAL      TVTINK = SYFOR9
S15  C*                  END                                                      3<-B
     C                   WHEN      EORI = *BLANKS                                2
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
     C                   EVAL      TVTINK = TVLKK + SYFOR9
     C                   ELSE                                                     3
     C                   EVAL      TVTINK = *BLANKS
     C                   END                                                      3<-E
     C                   OTHER                                                   2
     C                   EVAL      TVTINK = EORI
     C                   ENDSL                                                   2<-E
     C                   END                                                    1<-E
      *
     C     TVADS1        IFEQ      *BLANKS                                      1<-B
     C                   MOVEL     '.'           TVADS1
     C                   END                                                    1<-E
     C     TVADK1        IFEQ      *BLANKS                                      1<-B
     C                   MOVEL     '.'           TVADK1
     C                   END                                                    1<-E
      *
     C                   WRITE     TRUVAMR
      *
     C                   ENDSR
      *
     C***********************************************
     C     HADR21        BEGSR
     C***********************************************
     C                   MOVE      HEKNS         W2KNS
     C                   MOVE      HENAS         W2NAS
     C                   MOVE      HEADS1        W2ADS1
     C                   MOVEL     HEADS3        W2PNS
     C                   MOVEL     HEADS3        W2PSS
     C                   MOVEL     'NO'          W2SKS
     C     HEUR          IFEQ      'B'                                          1<-B
     C     HEUR          OREQ      'D'
     C     HEUR          OREQ      'G'
     C                   MOVE      'NO'          W2LKS
     C                   ELSE                                                   1
     C                   MOVE      HELKA         W2LKS
     C                   END                                                    1<-E
     C     HEKNS         IFEQ      0                                            1<-B
     C                   MOVE      *BLANKS       W2TINS
     C                   ELSE                                                   1
     C                   MOVE      HEKNS         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            34
     C                   EVAL      W2TINS = *BLANKS
     C  N34              SELECT                                                  2<-B
S15  C*                  WHEN      PTFDT > UIDAG                                 2
S15  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
S15  C*                  EVAL      W2TINS = SYFOR9
S15  C*                  END                                                      3<-B
     C                   WHEN      EORI = *BLANKS                                2
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
     C                   EVAL      W2TINS = W2LKS + SYFOR9
     C                   ELSE                                                     3
     C                   EVAL      W2TINS = *BLANKS
     C                   END                                                      3<-E
     C                   OTHER                                                   2
     C                   EVAL      W2TINS = EORI
     C                   ENDSL                                                   2<-E
     C                   END                                                    1<-E
      *
     C                   MOVE      HEKNK         W2KNK
     C                   MOVE      HENAK         W2NAK
     C                   MOVE      HEADK1        W2ADK1
     C                   MOVEL     HEADK3        W2PNK
     C                   MOVEL     HEADK3        W2PSK
     C                   MOVEL     'NO'          W2SKK
     C     HEUR          IFEQ      'A'                                          1<-B
     C     HEUR          OREQ      'C'
     C     HEUR          OREQ      'F'
     C                   MOVEL     'NO'          W2LKK
     C                   ELSE                                                   1
     C                   MOVEL     HELKA         W2LKK
     C                   END                                                    1<-E
     C     HEKNK         IFEQ      0                                            1<-B
     C                   MOVE      *BLANKS       W2TINK
     C                   ELSE                                                   1
     C                   MOVE      HEKNK         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            34
     C                   EVAL      W2TINK = *BLANKS
     C  N34              SELECT                                                  2<-B
S15  C*                  WHEN      PTFDT > UIDAG                                 2
S15  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
S15  C*                  EVAL      W2TINK = SYFOR9
S15  C*                  END                                                      3<-B
     C                   WHEN      EORI = *BLANKS                                2
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
     C                   EVAL      W2TINK = W2LKK + SYFOR9
     C                   ELSE                                                     3
     C                   EVAL      W2TINK = *BLANKS
     C                   END                                                      3<-E
     C                   OTHER                                                   2
     C                   EVAL      W2TINK = EORI
     C                   ENDSL                                                   2<-E
     C                   END                                                    1<-E
      *
     C     W2ADS1        IFEQ      *BLANKS                                      1<-B
     C                   MOVEL     '.'           W2ADS1
     C                   END                                                    1<-E
     C     W2ADK1        IFEQ      *BLANKS                                      1<-B
     C                   MOVEL     '.'           W2ADK1
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
      ***********************************************
     C     HADR22        BEGSR
      ***********************************************
     C                   MOVE      SEKNK         W2KNS
     C                   MOVE      SENAK         W2NAS
     C                   MOVE      SEADK1        W2ADS1
     C                   MOVEL     SEADK3        W2PNS
     C                   MOVEL     SEADK3        W2PSS
     C                   MOVEL     'NO'          W2SKS
     C                   MOVEL     'NO'          W2LKS
     C     SEKNK         IFEQ      0                                            1<-B
     C                   MOVE      *BLANKS       W2TINS
     C                   ELSE                                                   1
     C                   MOVE      SEKNK         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            34
     C                   EVAL      W2TINS = *BLANKS
     C  N34              SELECT                                                  2<-B
S15  C*                  WHEN      PTFDT > UIDAG                                 2
S15  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
S15  C*                  EVAL      W2TINS = SYFOR9
S15  C*                  END                                                      3<-B
     C                   WHEN      EORI = *BLANKS                                2
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
     C                   EVAL      W2TINS = W2LKS + SYFOR9
     C                   ELSE                                                     3
     C                   EVAL      W2TINS = *BLANKS
     C                   END                                                      3<-E
     C                   OTHER                                                   2
     C                   EVAL      W2TINS = EORI
     C                   ENDSL                                                   2<-E
     C                   END                                                    1<-E
      *
     C                   MOVE      SEKNS         W2KNK
     C                   MOVE      SENAS         W2NAK
     C                   MOVE      SEADS1        W2ADK1
     C                   MOVEL     SEADS3        W2PNK
     C                   MOVEL     SEADS3        W2PSK
     C                   MOVEL     'NO'          W2SKK
     C                   MOVEL     SELKA         W2LKK
     C     SEKNS         IFEQ      0                                            1<-B
     C                   MOVE      *BLANKS       W2TINK
     C                   ELSE                                                   1
     C                   MOVE      SEKNS         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            34
     C                   EVAL      W2TINK = *BLANKS
     C  N34              SELECT                                                  2<-B
S15  C*                  WHEN      PTFDT > UIDAG                                 2
S15  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
S15  C*                  EVAL      W2TINK = SYFOR9
S15  C*                  END                                                      3<-B
     C                   WHEN      EORI = *BLANKS                                2
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))   3<-B
     C                   EVAL      W2TINK = W2LKK + SYFOR9
     C                   ELSE                                                     3
     C                   EVAL      W2TINK = *BLANKS
     C                   END                                                      3<-E
     C                   OTHER                                                   2
     C                   EVAL      W2TINK = EORI
     C                   ENDSL                                                   2<-E
     C                   END                                                    1<-E
      *
     C     W2ADS1        IFEQ      *BLANKS                                      1<-B
     C                   MOVEL     '.'           W2ADS1
     C                   END                                                    1<-E
     C     W2ADK1        IFEQ      *BLANKS                                      1<-B
     C                   MOVEL     '.'           W2ADK1
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
     C                   MOVE      'N'           XNYOPD            1
N03  C     W2XEXT        IFNE      *BLANKS
N03  C     FRIKEY1       CHAIN     FRISOL01                           90
N03  C   90FRIKEY2       CHAIN     FRISOL01                           90
N03  C     *IN90         IFEQ      '1'
N03  C                   Z-ADD     2             LINNBR
N03  C                   Z-ADD     40            POSNBR
N03  C                   MOVE      'SPO0001'     MSGNR
N03  C                   MOVE      '1'           *IN30
N03  C                   GOTO      SLTB1
N03  C                   ELSE
N03  C                   MOVE      FSAVD         W2AVD2
N03  C                   MOVE      FSOPD         W2TDN2
N03  C                   END
N03  C                   END
     C     W2AVD2        IFNE      0
     C     W2TDN2        ORNE      0
     C     HEDFK2        CHAIN(N)  HEADF                              90
     C   90HEDFK2        CHAIN     SAEH                               33
     C     *IN90         IFEQ      '1'
     C     *IN33         ANDEQ     '1'
     C                   Z-ADD     2             LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'YBC0818'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   ELSE
     C  N90HEDFK2        CHAIN     SAEH                               33
     C     *IN40         IFEQ      '0'
     C     *IN33         ANDEQ     '0'
     C                   MOVE      'J'           XNYOPD
     C                   GOTO      SLTB1
     C                   ELSE
     C     W2NAS         IFEQ      *BLANKS
     C  N90
     CAN 33              EXSR      HADR21
     C   90
     CANN33              EXSR      HADR22
     C                   END
     C     W2BLK         IFEQ      *BLANKS
     C     UBLK          ANDNE     HELKA
     C                   MOVE      HELKA         W2BLK
     C                   END
     C     W2VKTB        IFEQ      0
     C     W2VKTN        ANDEQ     0
     C                   Z-ADD     HEVKT         W2VKTB
     C     W2VKTB        MULT      0.9           W2VKTN
     C                   END
     C                   END
     C                   END
     C                   END
      *
     C                   TESTN                   W2VNTI               33
     C   33              MOVE      W2VNTI        W2VNT
     C  N33              MOVE      *ZEROS        W2VNT
      *
     C     W2KNS         IFNE      0
     C     W2NAS         ORNE      *BLANKS
     C                   EXSR      TESTSS
     C                   END
      *
     C     W2KNK         IFNE      0
     C     W2NAK         ORNE      *BLANKS
     C                   EXSR      TESTKK
     C                   END
      *
     C     W2VNT         IFNE      0
     C     W2FV          ORNE      *BLANKS
     C     THSIK         OREQ      1
     C     TARIK         CHAIN     TARI                               89
     C     *IN89         IFEQ      '1'
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'SPT0033'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   ELSE
S07  C*                  IF        TGGFV <> 'J'
N07  C                   IF        ((TGGFV <> 'J') AND (THDK <> 'SS'))
N21  C                             AND THDK <> 'ENTRY' AND THDK <> 'EXIT'
     C     W2VNT6        CHAIN     TRFKDF                             33
N09  C  N33W2FVNT        COMP      TFMNGD                               33
     C                   IF        *IN33 = *OFF
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'YBC1903'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN98
     C                   END
     C                   END
     C  N98W2VT          IFEQ      *BLANKS
     C                   MOVEL     TAALFA        W2VT
     C                   END
     C                   END
     C                   END
      *
     C     ULSTL         IFGT      0
     C     W2VT          ANDEQ     *BLANKS
     C                   MOVEL     'SE VEDLA'    W2VT
     C     W2VT          CAT       'GTE LA':0    W2VT
     C     W2VT          CAT       'STLIST':0    W2VT
     C     W2VT          CAT       'E':0         W2VT
     C                   END
      *
     C     W2DK          IFNE      *BLANKS
     C     UDK           OREQ      'T-'
     C                   MOVE      '031'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2DK          YKODE
     C     TRK01K        CHAIN     TRKODL01                           88
     C     *IN88         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     32            POSNBR
     C                   MOVE      'YBC0809'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     UALK          IFEQ      *BLANKS
     C                   MOVE      W2ALK         KS2LK
     C     KODS2K        CHAIN     KODTS2                             87
     C     *IN87         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     50            POSNBR
     C                   MOVE      'SPL0001'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   ELSE
     C                   MOVE      *BLANKS       W2ALK
     C                   END
      *
     C     UBLK          IFEQ      *BLANKS
     C                   MOVE      W2BLK         KS2LK
     C     KODS2K        CHAIN     KODTS2                             86
     C     *IN86         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     70            POSNBR
     C                   MOVE      'SPL0001'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   ELSE
     C                   MOVE      *BLANKS       W2ALK
     C                   END
      *
     C     W2VT          COMP      *BLANKS                                85
     C     *IN85         IFEQ      '1'
     C                   Z-ADD     10            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'YBC0840'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
      *
     C     W2VTSK        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2VTSK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           84
     C     *IN84         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     10            LINNBR
     C                   Z-ADD     70            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C                   SELECT
     C     W2VKTB        WHENNE    0
     C     W2VKTN        IFEQ      0
     C     W2VKTB        MULT(H)   0.9           W2VKTN
     C                   END
     C     W2VKTN        WHENNE    0
     C     W2VKTB        IFEQ      0
     C     W2VKTN        MULT(H)   1.1           W2VKTB
     C                   END
     C                   OTHER
     C                   MOVE      '1'           *IN83
     C     *IN30         IFEQ      '0'
     C                   Z-ADD     11            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'SPV0001'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   ENDSL
      *
     C     W2DK          IFEQ      *BLANKS
     C     UDK           ANDEQ     'T2'
N10  C     W2DK          OREQ      *BLANKS
N10  C     UDK           ANDEQ     'T2F'
     C     W2DK          OREQ      'T2'
N10  C     W2DK          OREQ      'T2F'
     C     W2TDR         ORNE      *BLANKS
     C                   MOVE      '014'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2TDT         YKODE
     C     TRK01K        CHAIN     TRKODL01                           82
     C     *IN82         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'YBC0823'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     W2TDT         IFNE      *BLANKS
     C     W2TDR         COMP      *BLANKS                                81
     C     *IN81         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     17            POSNBR
     C                   MOVE      'YBC0823'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     *IN81         IFEQ      '0'
     C     *IN47         ANDEQ     '1'
     C     W2TDT         ANDEQ     *BLANKS
     C                   MOVE      '1'           *IN82
     C     *IN30         IFEQ      '0'
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'YBC0836'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     W2TDSK        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2TDSK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           80
     C     *IN80         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     38            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     W2TDOS        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2TDOS        YKODE
     C     TRK01K        CHAIN     TRKODL01                           79
     C     *IN79         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     78            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     ULSTL         IFEQ      0
N08  C     THSIK         ANDEQ     0                                            IKKE FORH.VARESEL
     C     W2DTY         ORNE      *BLANKS
     C                   MOVE      '013'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2DTY         YKODE
     C     TRK01K        CHAIN     TRKODL01                           78
     C     *IN78         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'YBC0813'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
      *
     C     W2DREF        COMP      *BLANKS                                77
     C     *IN77         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     30            POSNBR
     C                   MOVE      'YBC0814'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     W2DSK         IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2DSK         YKODE
     C     TRK01K        CHAIN     TRKODL01                           76
     C     *IN76         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     60            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     W2DOSK        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2DOSK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           75
     C     *IN75         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     14            LINNBR
     C                   Z-ADD     50            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     W2TLO         IFNE      *BLANKS
     C                   MOVE      '039'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2TLO         YKODE
     C     TRK01K        CHAIN     TRKODL01                           74
     C     *IN74         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C*                    Z-ADD13        LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'YBC0815'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
     C  N75W2TLO         IFNE      'DG0'
     C     W2TLO         ANDNE     'DG1'
     C                   MOVE      *ZEROS        W2EXKD
     C                   MOVE      *BLANKS       W2EXLK
     C                   END
      *
     C     W2TLO         IFNE      *BLANKS
     C     W2EXLK        IFNE      *BLANKS
     C     W2EXKD        OREQ      0
     C                   MOVE      W2EXLK        KS2LK
     C     KODS2K        CHAIN     KODTS2                             73
     C     *IN73         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     16            LINNBR
     C                   Z-ADD     43            POSNBR
     C                   MOVE      'SPL0001'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
     C                   END
      *
     C     W2MSK         IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2MSK         YKODE
     C     TRK01K        CHAIN     TRKODL01                           72
     C     *IN72         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     17            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     W2EH          IFNE      *BLANKS
     C     W2EH          ANDNE     'NE'
N13  C     W2EH          ANDNE     'NF'
     C     W2EH          ANDNE     'VQ'
     C     W2EH          ANDNE     'VG'
     C     W2EH          ANDNE     'VL'
     C     W2EH          ANDNE     'VY'
     C     W2EH          ANDNE     'VR'
     C     W2EH          ANDNE     'VO'
N12  C     W2EH          ANDNE     'VS'
     C     W2MN          IFEQ      *BLANKS
     C                   MOVEL     'ADR.'        W2MN
     C                   END
     C                   END
      *
     C     *IN71         IFEQ      '0'
     C     *IN46         ANDEQ     '1'
     C     W2MN          ANDEQ     *BLANKS
     C                   MOVE      '1'           *IN71
     C     *IN30         IFEQ      '0'
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'YBC0835'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     W2MNSK        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2MNSK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           70
     C     *IN70         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     40            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     UKDC          IFEQ      '1'
     C     *IN28         OREQ      '1'
     C     W2CNR         COMP      *BLANKS                                69
     C     *IN69         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'YBC0828'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     ULSTL         IFEQ      0
     C     W2EH          ORNE      *BLANKS
     C                   MOVE      '017'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2EH          YKODE
     C     TRK01K        CHAIN     TRKODL01                           68
     C     *IN68         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'YBC0816'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C  N69W2EH          IFEQ      'NE'
N13  C     W2EH          OREQ      'NF'
     C     W2EH          OREQ      'VQ'
     C     W2EH          OREQ      'VG'
     C     W2EH          OREQ      'VL'
     C     W2EH          OREQ      'VY'
     C     W2EH          OREQ      'VR'
     C     W2EH          OREQ      'VO'
N12  C     W2EH          OREQ      'VS'
     C                   MOVE      *ZEROS        W2NT
     C                   END
      *
     C     W2EH          IFEQ      'NE'
N13  C     W2EH          OREQ      'NF'
     C     W2NTEH        COMP      0                                      66
     C     *IN66         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     50            POSNBR
     C                   MOVE      'YBC0825'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   ELSE
     C                   MOVE      *ZEROS        W2NTEH
     C                   END
      *
      *** TEST PÅ KODE FOR FØLSOMME VARE KOMMER SENERE
     C     *IN45         IFEQ      '1'
     C     W2FV          ANDEQ     *BLANKS
     C     W2FVNT        ANDEQ     0
     C                   MOVE      '1'           *IN65
     C     *IN30         IFEQ      '0'
     C                   Z-ADD     21            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      'YBC0834'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
      *
     C                   ELSE
      *
     C     W2VNT6        CHAIN     TRFKDF                             33
     C     *IN33         IFEQ      '1'
     C                   MOVE      *BLANKS       W2FV
     C                   MOVE      *ZEROS        W2FVNT
     C                   ELSE
     C                   MOVE      TFKODE        W2FV
     C     W2FVNT        COMP      0                                      64
     C     *IN64         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     21            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   MOVE      'YBC0817'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C                   END
      *
     C     SLTB1         ENDSR
      *
     C***********************************************
     C     TESTSS        BEGSR
     C***********************************************
     C     W2KNS         IFNE      0                                            1<-B
     C                   MOVE      W2KNS         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            63
     C     *IN63         IFEQ      '1'                                           2<-B
     C     *IN30         IFEQ      '0'                                            3<-B
     C                   MOVE      'SPK0001'     MSGNR
     C                   Z-ADD     3             LINNBR
     C                   Z-ADD     13            POSNBR
     C                   SETON                                        30
     C                   END                                                      3<-B
     C                   ELSE                                                    2
     C                   IF        W2NAS = *BLANKS                                3<-B
     C                   MOVE      KNAVN         W2NAS
     C                   MOVE      ADR1          W2ADS1
     C     SYPOGE        IFEQ      *BLANKS                                         4<-B
     C                   MOVE      *BLANKS       W2PNS
     C                   MOVEL     POSTNR        W2PNS
     C                   ELSE                                                      4
     C                   MOVEL     SYPOGE        W2PNS
     C                   END                                                       4<-E
     C                   MOVE      ADR3          W2PSS
     C     SYLAND        IFNE      *BLANKS                                         4<-B
     C                   MOVE      SYLAND        W2LKS
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C     W2TINS        IFEQ      *BLANKS                                        3<-B
     C                   SELECT                                                    4<-B
S15  C*                  WHEN      PTFDT > UIDAG                                   4
S15  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))     5<-B
S15  C*                  EVAL      W2TINS = SYFOR9
S15  C*                  END                                                        5<-B
     C                   WHEN      EORI = *BLANKS                                  4
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))     5<-B
     C                   EVAL      W2TINS = W2LKS + SYFOR9
     C                   ELSE                                                       5
     C                   EVAL      W2TINS = *BLANKS
     C                   END                                                        5<-E
     C                   OTHER                                                     4
     C                   EVAL      W2TINS = EORI
     C                   ENDSL                                                     4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C     W2PNS         COMP      *BLANKS                                55
     C  N30*IN55         IFEQ      '1'
     C                   MOVE      'YBC1878'     MSGNR
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   SETON                                        30
     C                   END
      *
     C     W2PSS         COMP      *BLANKS                                54
     C  N30*IN54         IFEQ      '1'
     C                   MOVE      'YBC1879'     MSGNR
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     12            POSNBR
     C                   SETON                                        30
     C                   END
      *
     C                   MOVE      W2LKS         KS2LK
     C     KODS2K        CHAIN     KODTS2                             61
     C     *IN61         IFEQ      '1'
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPL0001'     MSGNR
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     12            POSNBR
     C                   SETON                                        30
     C                   END
     C                   ELSE
     C     W2SKS         IFEQ      *BLANKS
     C                   MOVE      KS2NAS        W2SKS
     C                   END
     C                   END
      *
     C     W2SKS         IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2SKS         YKODE
     C     TRK01K        CHAIN     TRKODL01                           59
     C  N30*IN59         IFEQ      '1'
     C                   MOVE      'YBC0810'     MSGNR
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     32            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     TESTKK        BEGSR
     C***********************************************
     C     W2KNK         IFNE      0                                            1<-B
     C                   MOVE      W2KNK         KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            62
     C     *IN62         IFEQ      '1'                                           2<-B
     C     *IN30         IFEQ      '0'                                            3<-B
     C                   MOVE      'SPK0001'     MSGNR
     C                   Z-ADD     3             LINNBR
     C                   Z-ADD     53            POSNBR
     C                   SETON                                        30
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C                   IF        W2NAK = *BLANKS                                3<-B
     C                   MOVE      KNAVN         W2NAK
     C                   MOVE      ADR1          W2ADK1
     C     SYPOGE        IFEQ      *BLANKS                                         4<-B
     C                   MOVE      *BLANKS       W2PNK
     C                   MOVEL     POSTNR        W2PNK
     C                   ELSE                                                      4
     C                   MOVEL     SYPOGE        W2PNK
     C                   END                                                       4<-E
     C                   MOVE      ADR3          W2PSK
     C     SYLAND        IFNE      *BLANKS                                         4<-B
     C                   MOVE      SYLAND        W2LKK
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C     W2TINK        IFEQ      *BLANKS                                        3<-B
     C                   SELECT                                                    4<-B
S15  C*                  WHEN      PTFDT > UIDAG                                   4
S15  C*                  IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))     5<-B
S15  C*                  EVAL      W2TINK = SYFOR9
S15  C*                  END                                                        5<-B
     C                   WHEN      EORI = *BLANKS                                  4
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))     5<-B
     C                   EVAL      W2TINK = W2LKK + SYFOR9
     C                   ELSE                                                       5
     C                   EVAL      W2TINK = *BLANKS
     C                   END                                                        5<-E
     C                   OTHER                                                     4
     C                   EVAL      W2TINK = EORI
     C                   ENDSL                                                     4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C     W2PNK         COMP      *BLANKS                                53
     C  N30*IN53         IFEQ      '1'
     C                   MOVE      'YBC1878'     MSGNR
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     42            POSNBR
     C                   SETON                                        30
     C                   END
      *
     C     W2PSK         COMP      *BLANKS                                52
     C  N30*IN52         IFEQ      '1'
     C                   MOVE      'YBC1879'     MSGNR
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     52            POSNBR
     C                   SETON                                        30
     C                   END
      *
     C                   MOVE      W2LKK         KS2LK
     C     KODS2K        CHAIN     KODTS2                             58
     C     *IN58         IFEQ      '1'
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPL0001'     MSGNR
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     52            POSNBR
     C                   SETON                                        30
     C                   END
     C                   ELSE
     C     W2SKK         IFEQ      *BLANKS
     C                   MOVE      KS2NAS        W2SKK
     C                   END
     C                   END
      *
     C     W2SKK         IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     W2SKK         YKODE
     C     TRK01K        CHAIN     TRKODL01                           57
     C  N30*IN57         IFEQ      '1'
     C                   MOVE      'YBC0810'     MSGNR
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     72            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     HENTSR        BEGSR
     C***********************************************
      *** SJEKKE OM BRUKER HAR VALGT NOEN OPSJONER. HVIS IKKE, SETTER
      *** IND. 98 PÅ OG GIR FEILMELDING TIL BRUKER.
      *** OPSJON 2 ---> ENDRE DETALJE LINJE.
      *** OPSJON 4 ---> SLETTE DETALJE LINJE.
      *** OPSJON 5 ---> VISE DETALJE LINJE
      *** LINNBR, POSNBR ---> RETUR POSISJON AV CURSOR
     C                   SETON                                        41
     C                   SETOFF                                       919299
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C   98              DO
     C   99              SETOFF                                       98
     C   98              MOVE      'DIV0012'     MSGNR
     C   98              SETON                                            30
     C                   Z-ADD     1             LINNBR
     C                   GOTO      SLHENT
     C                   END
     C     ZRECNO        DIV       15            LINNBR
     C                   MVR                     XLIN              2 0
     C     XLIN          IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C  N27WSNR          IFEQ      '2'
     C                   MOVE      ' '           WSNR
     C                   EXSR      CHGTRV
     C   12              GOTO      SLHENT
     C                   END
     C  N27WSNR          IFEQ      '4'
     C                   EXSR      DLTTRV
     C                   GOTO      SLHENT
     C                   END
     C     WSNR          IFEQ      '5'
     C                   MOVE      ' '           WSNR
     C                   EXSR      VISTRV
     C   12              GOTO      SLHENT
     C                   END
     C                   END
      *
     C     SLHENT        TAG
     C                   ADD       3             LINNBR
     C                   Z-ADD     2             POSNBR
      *
     C                   ENDSR
      *
     C***********************************************
     C     VISTRV        BEGSR
     C***********************************************
     C                   SETON                                        99
      *
     C                   MOVE      TVLI          W2LI
     C                   MOVE      TVVT          W2VT
     C                   MOVE      TVVTSK        W2VTSK
     C                   MOVE      TVTDT         W2TDT
     C                   MOVE      TVTDR         W2TDR
     C                   MOVE      TVTDSK        W2TDSK
     C                   MOVE      TVTDO         W2TDO
     C                   MOVE      TVTDOS        W2TDOS
     C                   MOVE      TVDTY         W2DTY
     C                   MOVE      TVDREF        W2DREF
     C                   MOVE      TVDSK         W2DSK
     C                   MOVE      TVDO          W2DO
     C                   MOVE      TVDOSK        W2DOSK
     C                   MOVE      TVEXKD        W2EXKD
     C                   MOVE      TVEXLK        W2EXLK
     C                   MOVE      TVMTXT        W2MTXT
     C                   MOVE      TVMSK         W2MSK
     C                   MOVE      TVMN          W2MN
     C                   MOVE      TVMNSK        W2MNSK
     C                   MOVE      TVCNR         W2CNR
     C                   MOVE      TVFV          W2FV
     C                   MOVE      TVFVNT        W2FVNT
     C                   EXSR      TSTOPL
     C                   MOVE      W2VT          TVVT
     C                   MOVE      W2VTSK        TVVTSK
     C                   MOVE      W2TDT         TVTDT
     C                   MOVE      W2TDR         TVTDR
     C                   MOVE      W2TDSK        TVTDSK
     C                   MOVE      W2TDO         TVTDO
     C                   MOVE      W2TDOS        TVTDOS
     C                   MOVE      W2DTY         TVDTY
     C                   MOVE      W2DREF        TVDREF
     C                   MOVE      W2DSK         TVDSK
     C                   MOVE      W2DO          TVDO
     C                   MOVE      W2DOSK        TVDOSK
     C                   MOVE      W2EXKD        TVEXKD
     C                   MOVE      W2EXLK        TVEXLK
     C                   MOVE      W2MTXT        TVMTXT
     C                   MOVE      W2MSK         TVMSK
     C                   MOVE      W2MN          TVMN
     C                   MOVE      W2MNSK        TVMNSK
     C                   MOVE      W2CNR         TVCNR
     C                   MOVE      W2FV          TVFV
     C                   MOVE      W2FVNT        TVFVNT
     C     TRVK2         CHAIN(N)  TRUVAM                             33
     C     *IN33         IFEQ      '1'
     C                   MOVE      *ZEROS        TVKNS
     C                   MOVE      *BLANKS       TVNAS
     C                   MOVE      *BLANKS       TVADS1
     C                   MOVE      *BLANKS       TVPNS
     C                   MOVE      *BLANKS       TVPSS
     C                   MOVE      *BLANKS       TVLKS
     C                   MOVE      *BLANKS       TVSKS
     C                   MOVE      *BLANKS       TVTINS
     C                   MOVE      *ZEROS        TVKNK
     C                   MOVE      *BLANKS       TVNAK
     C                   MOVE      *BLANKS       TVADK1
     C                   MOVE      *BLANKS       TVPNK
     C                   MOVE      *BLANKS       TVPSK
     C                   MOVE      *BLANKS       TVLKK
     C                   MOVE      *BLANKS       TVSKK
     C                   MOVE      *BLANKS       TVTINK
     C                   END
     C     STVIS         TAG
     C                   EXFMT     VAREL3
      *
     C   15              DO
     C                   MOVE      '1'           UIN27
     C                   EXSR      TILKOD
     C                   MOVE      *IN27         UIN27
     C                   GOTO      STVIS
     C                   END
      *
     C                   IF        XFORHV = 'J'
     C                   CALL      'TR012RA'
     C                   PARM                    TVAVD
     C                   PARM                    TVTDN
     C                   PARM                    TVLI
     C                   PARM                    UIN27
     C                   PARM                    UFLAGG
     C                   END
      *
     C     XLIN          IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C                   UPDATE    SUBFIL
      *
     C                   ENDSR
      *
     C***********************************************
     C     DLTTRV        BEGSR
     C***********************************************
     C                   Z-ADD     ZRECNO        XRECN2            4 0
     C                   MOVE      *ZEROS        LI
      *** OPERASJON 1
     C                   MOVE      TVLI          LI(1)
     C                   Z-ADD     1             XN                3 0
     C     *IN98         DOWEQ     '0'                                          1<-B
     C     STDLT1        TAG
     C                   READC     SUBFIL                                 98
     C  N98WSNR          IFEQ      '4'                                           2<-B
     C                   MOVE      *ZEROS        XN2               3 0
     C     XN2           DOWLT     XN                                             3<-B
     C                   ADD       1             XN2
     C                   END                                                      3<-E
     C                   ADD       1             XN
     C                   MOVE      TVLI          LI(XN)
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
      *** OPERASJON 2
     C                   MOVE      '1'           *IN43
     C                   WRITE     SUBCTL2
     C                   MOVEA     '00'          *IN(43)
     C                   Z-ADD     *ZEROS        ZRECN2
     C                   MOVE      *ZEROS        XN2
     C     XN2           DOWLT     XN                                           1<-B
     C                   ADD       1             XN2
     C     TRV21         SETLL     TRUV02
     C                   SETOFF                                       44
     C     STDLT2        TAG
     C     TRV21         READE     TRUV02                                 44
     C  N44              DO                                                      2<-B
     C     LI(XN2)       IFEQ      TVLI                                           3<-B
     C                   ADD       1             ZRECN2
     C                   MOVE      TVLI          XLI2              5 0
     C                   WRITE     SUBFIL2
     C                   END                                                      3<-E
     C                   GOTO      STDLT2
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
      *** OPERASJON 3
     C                   Z-ADD     1             ZRECN2
     C     STDLT3        TAG
     C                   MOVEA     '11'          *IN(41)
     C                   WRITE     SUBCTL2
     C                   EXFMT     BUNN2
     C   25              GOTO      STDLT3
     C   12              Z-ADD     XRECN2        ZRECNO
     C  N12              DO                                                     1<-B
     C                   MOVE      *ZEROS        ZRECN2
     C     STDLT4        TAG
     C                   ADD       1             ZRECN2
     C     ZRECN2        CHAIN     SUBFIL2                            98
     C  N98              DO                                                      2<-B
     C     TRVK2         CHAIN     TRUV                               41
     C  N41              DO                                                       3<-B
     C                   DELETE    TRUVR
N03  C     TRXREFK       CHAIN     TRXREF                             33
N03  C  N33              DELETE    TRXREFR
     C     TRVK2         CHAIN     TRUVAM                             41
     C  N41              DELETE    TRUVAMR
     C     TRVK2         CHAIN     TRUVFV                             41
     C  N41              DELETE    TRUVFVR
     C                   MOVE      TVLI          W2LI
     C                   EXSR      DLTOPL
      *** TVREFL > 0 ==> DENNE ER EKSTRALINJE OG SENKE ANTALL EXTRA
      ***                LINJER HOVEDLINJE HAR MED EN.
     C     TVREFL        IFGT      0                                               4<-B
     C                   MOVE      TVREFL        W2LI
     C     TRVK          CHAIN     TRUV                               33
     C  N33              ADD       1             TVREFL
     C  N33              UPDATE    TRUVR
     C                   END                                                       4<-E
     C                   GOTO      STDLT4
     C                   END                                                     2<-E
     C                   END
     C                   EXSR      MOVB1
     C                   END                                                    1<-E
     C                   SETOFF                                       4198
      *
     C                   ENDSR
      *
     C***********************************************
     C     CHGTRV        BEGSR
     C***********************************************
      *** FLYTTE DATA FRA SUBFIL TIL ARBEIDSVARIABLER
     C                   EXSR      MOVTRW
      *
     C     STCHG         TAG
     C  N30              EXSR      TSTOPL
     C                   EXFMT     VARELI
     C                   MOVEA     '00000000'    *IN(83)
     C                   MOVEA     '00000000'    *IN(75)
     C                   MOVEA     '00000000'    *IN(67)
     C                   MOVEA     '000000'      *IN(61)
     C                   MOVEA     '000'         *IN(57)
     C                   MOVEA     '0000'        *IN(52)
     C                   MOVE      '0'           *IN30
     C   04              DO
     C                   EXSR      SØKDTA
     C                   GOTO      STCHG
     C                   END
      *  07 = SØKE OPPDRAG
     C   07              DO
     C                   MOVE      'S'           UTYPE             1
     C                   CALL      'SYFM21'
     C                   PARM                    UTYPE
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    USG               3
     C                   GOTO      STCHG
     C                   END
      *
     C   15              DO
     C                   EXSR      TILKOD
     C                   GOTO      STCHG
     C                   END
      *
     C     *IN12         IFEQ      '1'
      *** F12 ---> AVBRYTTE ENDRING
     C     XHOPD         IFNE      'J'
     C     XHOPD2        ANDNE     'J'
     C                   UPDATE    SUBFIL
     C                   END
     C                   ELSE
      *** TESTE INNTASTEDE TADA. HVIS IKKE NOE FEIL, OPPDRATERE PÅ FIL
     C                   EXSR      TESTB1
     C   30              GOTO      STCHG
     C                   EXSR      OPDTRV
     C                   END
      *
     C     XLIN          IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     OPDTRV        BEGSR
     C***********************************************
      *** 33 PÅ ---> NY LINJE.        33 AV ---> ENDRE EN LINJE
     C     TRVK          CHAIN     TRUV                               33
      *** FLYTTE INNTASTET DATA TIL FIL-VARIABLER OG OPPDATERE DEM.
     C                   EXSR      MOVWTR
     C     *IN33         IFEQ      '0'
     C                   UPDATE    TRUVR
N03  C     TRXREFK       CHAIN     TRXREF                             33
N03  C     *IN33         IFEQ      '0'
N03  C     W2XEXT        IFEQ      *BLANKS
N03  C                   DELETE    TRXREFR
N03  C                   ELSE
N03  C                   MOVE      W2XEXT        TRXEXT
N03  C                   UPDATE    TRXREFR
N03  C                   END
N03  C                   ELSE
N03  C                   MOVE      '0'           *IN33
N03  C                   END
     C                   ELSE
     C                   MOVE      *ZEROS        TVLN
     C                   MOVE      *ZEROS        YLN
     C                   WRITE     TRUVR
N03  C     W2XEXT        IFNE      *BLANKS
N03  C                   MOVE      TVAVD         TRXAVD
N03  C                   MOVE      TVTDN         TRXOPD
N03  C                   MOVE      TVLI          TRXLI
N03  C                   MOVE      W2XEXT        TRXEXT
N03  C                   WRITE     TRXREFR
N03  C                   END
     C                   END
      *
     C                   IF        XFORHV = 'J'
     C                   CALL      'TR012RA'
     C                   PARM                    TVAVD
     C                   PARM                    TVTDN
     C                   PARM                    TVLI
     C                   PARM                    UIN27
     C                   PARM                    UFLAGG
     C                   END
      *
      *** OPPDATERE PÅ SUBFIL
     C                   MOVE      TVLI          XLI2              5 0
     C                   MOVE      TVLN          WXLN
     C     TVNT          IFEQ      0
     C                   MOVE      TVNTEH        XVNTK
     C                   ELSE
     C                   MOVE      TVNT          XVNTK
     C                   END
      *
     C     XHOPD         IFNE      'J'
     C     XHOPD2        ANDNE     'J'
     C   40              UPDATE    SUBFIL
     C  N40              ADD       1             YRECNO
     C  N40              Z-ADD     YRECNO        ZRECNO
     C  N40              WRITE     SUBFIL
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     TILKOD        BEGSR
     C***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
     C     LINNBR        IFEQ      10
     C                   CALL      'TR024R'
     C                   PARM                    TVAVD
     C                   PARM                    TVTDN
     C                   PARM                    W2LI
     C                   PARM                    W2VT
     C                   PARM                    W2VTSK
     C                   PARM                    UIN27
     C                   END
      *
     C     LINNBR        IFEQ      12
     C                   CALL      'TR023R'
     C                   PARM                    TVAVD
     C                   PARM                    TVTDN
     C                   PARM                    W2LI
     C                   PARM                    W2TDT
     C                   PARM                    W2TDR
     C                   PARM                    W2TDSK
     C                   PARM                    W2TDO
     C                   PARM                    W2TDOS
     C                   PARM                    UIN27
     C                   END
      *
     C     LINNBR        IFGE      13
     C     LINNBR        ANDLE     17
     C                   CALL      'TR020R'
     C                   PARM                    TVAVD
     C                   PARM                    TVTDN
     C                   PARM                    W2LI
     C                   PARM                    W2DTY
     C                   PARM                    W2DREF
     C                   PARM                    W2DSK
     C                   PARM                    W2DO
     C                   PARM                    W2DOSK
     C                   PARM                    W2TLO
     C                   PARM                    W2EXKD
     C                   PARM                    W2EXLK
     C                   PARM                    W2MTXT
     C                   PARM                    W2MSK
     C                   PARM                    UIN27
     C                   END
      *
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     10
     C     POSNBR        ANDLE     27
     C                   CALL      'TR022R'
     C                   PARM                    TVAVD
     C                   PARM                    TVTDN
     C                   PARM                    W2LI
     C                   PARM                    W2MN
     C                   PARM                    W2MNSK
     C                   PARM                    UIN27
     C                   END
      *
     C     LINNBR        IFEQ      19
     C     POSNBR        ANDGE     10
     C     POSNBR        ANDLE     20
     C                   CALL      'TR018R'
     C                   PARM                    TVAVD
     C                   PARM                    TVTDN
     C                   PARM                    W2LI
     C                   PARM                    W2CNR
     C                   PARM                    UIN27
     C                   END
      *
     C     LINNBR        IFEQ      21
     C     POSNBR        ANDGE     10
     C     POSNBR        ANDLE     26
     C                   MOVEL     W2VNT         UVNT6             6 0
     C                   CALL      'TR021R'
     C                   PARM                    TVAVD
     C                   PARM                    TVTDN
     C                   PARM                    W2LI
     C                   PARM                    UVNT6
     C                   PARM                    W2FV
     C                   PARM                    W2FVNT
     C                   PARM                    UIN27
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVTRW        BEGSR
     C***********************************************
     C                   SETON                                        99
     C     XHOPD2        IFEQ      'J'
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   ELSE
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     10            POSNBR
     C                   END
     C                   SETON                                        40
      *
     C                   MOVE      TVLN          YLN               5 0
     C                   MOVE      TVLI          W2LI
     C                   MOVE      TVVNT         W2VNT
     C                   MOVE      TVVNT         W2VNTI
     C                   MOVE      TVDK          W2DK
     C                   MOVE      TVALK         W2ALK
     C                   MOVE      TVBLK         W2BLK
     C                   MOVE      TVVT          W2VT
     C                   MOVE      TVVTSK        W2VTSK
     C                   MOVE      TVVKTB        W2VKTB
     C                   MOVE      TVVKTN        W2VKTN
     C                   MOVE      TVCNR         W2CNR
     C                   MOVE      TVTDO         W2TDO
     C                   MOVE      TVTDOS        W2TDOS
     C                   MOVE      TVTDT         W2TDT
     C                   MOVE      TVTDR         W2TDR
     C                   MOVE      TVTDSK        W2TDSK
     C                   MOVE      TVDTY         W2DTY
     C                   MOVE      TVDREF        W2DREF
     C                   MOVE      TVDSK         W2DSK
     C                   MOVE      TVDO          W2DO
     C                   MOVE      TVDOSK        W2DOSK
     C                   MOVE      TVTLO         W2TLO
     C                   MOVE      TVEXKD        W2EXKD
     C                   MOVE      TVEXLK        W2EXLK
     C                   MOVE      TVMTXT        W2MTXT
     C                   MOVE      TVMSK         W2MSK
     C                   MOVE      TVMN          W2MN
     C                   MOVE      TVMNSK        W2MNSK
     C                   MOVE      TVEH          W2EH
     C                   MOVE      TVNT          W2NT
     C                   MOVE      TVNTEH        W2NTEH
     C                   MOVE      TVFV          W2FV
     C                   MOVE      TVFVNT        W2FVNT
     C                   MOVE      TVAVD2        W2AVD2
     C                   MOVE      TVTDN2        W2TDN2
     C     TRVK2         CHAIN(N)  TRUVAM                             33
     C     *IN33         IFEQ      '1'
     C                   MOVE      *ZEROS        W2KNS
     C                   MOVE      *BLANKS       W2NAS
     C                   MOVE      *BLANKS       W2ADS1
     C                   MOVE      *BLANKS       W2PNS
     C                   MOVE      *BLANKS       W2PSS
     C                   MOVE      *BLANKS       W2LKS
     C                   MOVE      *BLANKS       W2SKS
     C                   MOVE      *BLANKS       W2TINS
     C                   MOVE      *ZEROS        W2KNK
     C                   MOVE      *BLANKS       W2NAK
     C                   MOVE      *BLANKS       W2ADK1
     C                   MOVE      *BLANKS       W2PNK
     C                   MOVE      *BLANKS       W2PSK
     C                   MOVE      *BLANKS       W2LKK
     C                   MOVE      *BLANKS       W2SKK
     C                   MOVE      *BLANKS       W2TINK
     C                   ELSE
     C                   MOVE      TVKNS         W2KNS
     C                   MOVE      TVNAS         W2NAS
     C                   MOVE      TVADS1        W2ADS1
     C                   MOVE      TVPNS         W2PNS
     C                   MOVE      TVPSS         W2PSS
     C                   MOVE      TVLKS         W2LKS
     C                   MOVE      TVSKS         W2SKS
     C                   MOVE      TVTINS        W2TINS
     C                   MOVE      TVKNK         W2KNK
     C                   MOVE      TVNAK         W2NAK
     C                   MOVE      TVADK1        W2ADK1
     C                   MOVE      TVPNK         W2PNK
     C                   MOVE      TVPSK         W2PSK
     C                   MOVE      TVLKK         W2LKK
     C                   MOVE      TVSKK         W2SKK
     C                   MOVE      TVTINK        W2TINK
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVWTR        BEGSR
     C***********************************************
     C   33              MOVE      *ZEROS        TVREFL
     C                   MOVE      UAVD          TVAVD
     C                   MOVE      UTDN          TVTDN
     C                   MOVE      ' '           TV01
     C                   MOVE      W2LI          TVLI
     C                   MOVE      W2VNT         TVVNT
     C                   MOVE      W2DK          TVDK
     C                   MOVE      W2ALK         TVALK
     C                   MOVE      W2BLK         TVBLK
     C                   MOVE      W2VT          TVVT
     C                   MOVE      W2VTSK        TVVTSK
     C                   MOVE      W2VKTB        TVVKTB
     C                   MOVE      W2VKTN        TVVKTN
     C                   MOVE      W2CNR         TVCNR
     C                   MOVE      W2TDO         TVTDO
     C                   MOVE      W2TDOS        TVTDOS
     C                   MOVE      W2TDT         TVTDT
     C                   MOVE      W2TDR         TVTDR
     C                   MOVE      W2TDSK        TVTDSK
     C                   MOVE      W2DTY         TVDTY
     C                   MOVE      W2DREF        TVDREF
     C                   MOVE      W2DSK         TVDSK
     C                   MOVE      W2DO          TVDO
     C                   MOVE      W2DOSK        TVDOSK
     C                   MOVE      W2TLO         TVTLO
     C                   MOVE      W2EXKD        TVEXKD
     C                   MOVE      W2EXLK        TVEXLK
     C                   MOVE      W2MTXT        TVMTXT
     C                   MOVE      W2MSK         TVMSK
     C                   MOVE      W2MN          TVMN
     C                   MOVE      W2MNSK        TVMNSK
     C                   MOVE      W2EH          TVEH
     C                   MOVE      W2NT          TVNT
     C                   MOVE      W2NTEH        TVNTEH
     C                   MOVE      W2FV          TVFV
     C                   MOVE      W2FVNT        TVFVNT
     C                   MOVE      W2AVD2        TVAVD2
     C                   MOVE      W2TDN2        TVTDN2
     C                   MOVE      *IN33         XIN33             1
     C     TRVK2         CHAIN     TRUVAM                             33
     C                   MOVE      W2KNS         TVKNS
     C                   MOVE      W2NAS         TVNAS
     C                   IF        ((W2ADS1 = *BLANKS) AND (W2NAS <> *BLANKS))
     C                   EVAL      W2ADS1 = '.'
     C                   END
     C                   MOVE      W2ADS1        TVADS1
     C                   MOVE      W2PNS         TVPNS
     C                   MOVE      W2PSS         TVPSS
     C                   MOVE      W2LKS         TVLKS
     C                   MOVE      W2SKS         TVSKS
     C                   MOVE      W2TINS        TVTINS
     C                   MOVE      W2KNK         TVKNK
     C                   MOVE      W2NAK         TVNAK
     C                   IF        ((W2ADK1 = *BLANKS) AND (W2NAK <> *BLANKS))
     C                   EVAL      W2ADK1 = '.'
     C                   END
     C                   MOVE      W2ADK1        TVADK1
     C                   MOVE      W2PNK         TVPNK
     C                   MOVE      W2PSK         TVPSK
     C                   MOVE      W2LKK         TVLKK
     C                   MOVE      W2SKK         TVSKK
     C                   MOVE      W2TINK        TVTINK
     C     *IN33         IFEQ      '1'
     C     TVKNS         IFNE      0
     C     TVNAS         ORNE      *BLANKS
     C     TVKNK         ORNE      0
     C     TVNAK         ORNE      *BLANKS
     C                   WRITE     TRUVAMR
     C                   END
     C                   ELSE
     C     TVKNS         IFNE      0
     C     TVNAS         ORNE      *BLANKS
     C     TVKNK         ORNE      0
     C     TVNAK         ORNE      *BLANKS
     C                   UPDATE    TRUVAMR
     C                   ELSE
     C                   DELETE    TRUVAMR
     C                   END
     C                   END
     C                   MOVE      XIN33         *IN33
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVB1         BEGSR
     C***********************************************
     C                   MOVE      *BLANKS       TV01
     C                   MOVE      *ZEROS        TVLI
     C                   MOVE      *ZEROS        TVVNT
     C                   MOVE      *BLANKS       TVDK
     C                   MOVE      *BLANKS       TVALK
     C                   MOVE      *BLANKS       TVBLK
     C                   MOVE      *BLANKS       TVVT
     C                   MOVE      *BLANKS       TVVTSK
     C                   MOVE      *ZEROS        TVVKTB
     C                   MOVE      *ZEROS        TVVKTN
     C                   MOVE      *BLANKS       TVCNR
     C                   MOVE      *BLANKS       TVTDO
     C                   MOVE      *BLANKS       TVTDOS
     C                   MOVE      *BLANKS       TVTDT
     C                   MOVE      *BLANKS       TVTDR
     C                   MOVE      *BLANKS       TVTDSK
     C                   MOVE      *BLANKS       TVDTY
     C                   MOVE      *BLANKS       TVDREF
     C                   MOVE      *BLANKS       TVDSK
     C                   MOVE      *BLANKS       TVDO
     C                   MOVE      *BLANKS       TVDOSK
     C                   MOVE      *BLANKS       TVTLO
     C                   MOVE      *ZEROS        TVEXKD
     C                   MOVE      *BLANKS       TVEXLK
     C                   MOVE      *BLANKS       TVMTXT
     C                   MOVE      *BLANKS       TVMSK
     C                   MOVE      *BLANKS       TVMN
     C                   MOVE      *BLANKS       TVMNSK
     C                   MOVE      *BLANKS       TVEH
     C                   MOVE      *ZEROS        TVNT
     C                   MOVE      *ZEROS        TVNTEH
     C                   MOVE      *ZEROS        XVNTK
     C                   MOVE      *BLANKS       TVFV
     C                   MOVE      *ZEROS        TVFVNT
     C                   MOVE      *ZEROS        TVAVD2
     C                   MOVE      *ZEROS        TVTDN2
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVB2         BEGSR
     C***********************************************
     C                   SETOFF                                       40
     C                   MOVEA     '00'          *IN(28)
     C                   MOVEA     '0000'        *IN(45)
N03  C                   MOVE      *BLANKS       W2XEXT
     C                   MOVE      *ZEROS        W2LI
     C                   MOVE      *ZEROS        W2VNT
     C                   MOVE      *BLANKS       W2VNTI
     C                   MOVE      *BLANKS       W2DK
     C                   MOVE      *BLANKS       W2ALK
     C                   MOVE      *BLANKS       W2BLK
     C                   MOVE      *BLANKS       W2VT
     C                   MOVE      *BLANKS       W2VTSK
     C                   MOVE      *ZEROS        W2VKTB
     C                   MOVE      *ZEROS        W2VKTN
     C                   MOVE      *BLANKS       W2CNR
     C                   MOVE      *BLANKS       W2TDO
     C                   MOVE      *BLANKS       W2TDOS
     C                   MOVE      *BLANKS       W2TDT
     C                   MOVE      *BLANKS       W2TDR
     C                   MOVE      *BLANKS       W2TDSK
     C                   MOVE      *BLANKS       W2DTY
     C                   MOVE      *BLANKS       W2DREF
     C                   MOVE      *BLANKS       W2DSK
     C                   MOVE      *BLANKS       W2DO
     C                   MOVE      *BLANKS       W2DOSK
     C                   MOVE      *BLANKS       W2TLO
     C                   MOVE      *ZEROS        W2EXKD
     C                   MOVE      *BLANKS       W2EXLK
     C                   MOVE      *BLANKS       W2MTXT
     C                   MOVE      *BLANKS       W2MSK
     C                   MOVE      *BLANKS       W2MN
     C                   MOVE      *BLANKS       W2MNSK
     C                   MOVE      *BLANKS       W2EH
     C                   MOVE      *ZEROS        W2NT
     C                   MOVE      *ZEROS        W2NTEH
     C                   MOVE      *BLANKS       W2FV
     C                   MOVE      *ZEROS        W2FVNT
     C                   MOVE      *ZEROS        W2AVD2
     C                   MOVE      *ZEROS        W2TDN2
     C                   MOVE      *ZEROS        W2KNS
     C                   MOVE      *BLANKS       W2NAS
     C                   MOVE      *BLANKS       W2ADS1
     C                   MOVE      *BLANKS       W2PNS
     C                   MOVE      *BLANKS       W2PSS
     C                   MOVE      *BLANKS       W2LKS
     C                   MOVE      *BLANKS       W2SKS
     C                   MOVE      *BLANKS       W2TINS
     C                   MOVE      *ZEROS        W2KNK
     C                   MOVE      *BLANKS       W2NAK
     C                   MOVE      *BLANKS       W2ADK1
     C                   MOVE      *BLANKS       W2PNK
     C                   MOVE      *BLANKS       W2PSK
     C                   MOVE      *BLANKS       W2LKK
     C                   MOVE      *BLANKS       W2SKK
     C                   MOVE      *BLANKS       W2TINK
      *
     C                   ENDSR
      *
     C***********************************************
     C     PRINT         BEGSR
     C***********************************************
     C   17              Z-ADD     2             UFLAGG            1 0
     C   03              Z-ADD     3             UFLAGG            1 0
      *
     C                   MOVE      *ZEROS        AV
     C                   MOVE      *ZEROS        OP
     C                   MOVE      *ZEROS        WSTBL
     C                   MOVE      '0'           *IN99
      *
     C                   MOVE      'N'           XKOLLI            1
     C     TRHK          SETLL     TRUV
     C     TRHK          READE(N)  TRUV                                   33
     C     *IN33         IFEQ      '1'
     C                   MOVE      '1'           *IN12
     C                   MOVE      'YBC0841'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLPRT
     C                   ELSE
     C     W2EH          IFNE      'NE'
N13  C     W2EH          ANDNE     'NF'
     C     W2EH          ANDNE     'VQ'
     C     W2EH          ANDNE     'VG'
     C     W2EH          ANDNE     'VL'
     C     W2EH          ANDNE     'VY'
     C     W2EH          ANDNE     'VR'
     C     W2EH          ANDNE     'VO'
N12  C     W2EH          ANDNE     'VS'
     C                   MOVE      'J'           XKOLLI            1
     C     TVNT          IFEQ      0
     C                   Z-ADD     TVNTEH        XNTT              5 0
     C                   ELSE
     C                   Z-ADD     TVNT          XNTT
     C                   END
     C                   END
     C     *IN33         DOWEQ     '0'
      *
     C     HEDFK3        CHAIN     SAEH                               33
     C                   IF        (*IN33 OR
     C                             ((*IN33 = *OFF) AND (SEBEL1 = 0)))
     C                   MOVE      '1'           *IN99
     C                   ELSE
     C     1             DO        200           XNR3              3 0
     C                   IF        AV(XNR3) = 0
     C                   MOVE      TVAVD2        AV(XNR3)
     C                   MOVE      TVTDN2        OP(XNR3)
     C                   LEAVE
     C                   END
     C                   IF        ((AV(XNR3) = TVAVD2) AND (OP(XNR3) = TVTDN2))
     C                   LEAVE
     C                   END
     C                   ENDDO
     C                   END
      *
     C     TVVT          IFEQ      *BLANKS
     C                   MOVE      '1'           *IN12
     C                   MOVE      'YBC0833'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLPRT
     C                   END
     C     W2EH          IFNE      'NE'
N13  C     W2EH          ANDNE     'NF'
     C     W2EH          ANDNE     'VQ'
     C     W2EH          ANDNE     'VG'
     C     W2EH          ANDNE     'VL'
     C     W2EH          ANDNE     'VY'
     C     W2EH          ANDNE     'VR'
     C     W2EH          ANDNE     'VO'
N12  C     W2EH          ANDNE     'VS'
     C                   MOVE      'J'           XKOLLI            1
     C     TVNT          IFEQ      0
     C                   ADD       TVNTEH        XNTT
     C                   ELSE
     C                   ADD       TVNT          XNTT
     C                   END
     C                   END
     C     TRHK          READE(N)  TRUV                                   33
     C  N33              ENDDO
     C                   END
      *
     C     XNTT          IFEQ      0
     C     XKOLLI        ANDEQ     'J'
     C                   MOVE      '1'           *IN12
     C                   MOVE      'SPN0003'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLPRT
     C                   END
      *
     C     ULSTL         IFGT      0
     C     TRHK          SETLL     TRUHL
     C     TRHK          READE     TRUHL                                  33
     C     *IN33         IFEQ      '1'
     C                   MOVE      '1'           *IN12
     C                   MOVE      'YBC0842'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLPRT
     C                   END
     C                   END
      *
     C                   IF        XFORHV = 'J'
S08  C*                  IF        (((THSPOM = 'A') OR
S08  C*                              (THSPOM = 'C')) OR
S08  C*                              (THKREF = *BLANKS))
N08  C                   IF        ((THSPOM <> 'A') AND (THKREF = *BLANKS))
N08   * HVIS KOMM.REF. FINNES PÅ LINJE, DA KREVER IKKE FREMLAGT DOK.
N08  C     TRHK          SETLL     TRUVFV
N08  C     TRHK          READE(N)  TRUVFV                                 33
N08  C                   DOW       *IN33 = *OFF
N08  C     TVKREF        CABNE     *BLANKS       STPRT01
N08  C     TRHK          READE(N)  TRUVFV                                 33
N08  C                   ENDDO
N08   *
     C     TRHK          SETLL     TRUV
     C     TRHK          READE(N)  TRUV                                   33
     C                   DOW       *IN33 = *OFF
     C     TVDTY         CABEQ     '720'         STPRT01
     C     TRVK2         SETLL     TRUVDK
     C     TRVK2         READE(N)  TRUVDK                                 33
     C                   DOW       *IN33 = *OFF
     C     TVDTY         CABEQ     '720'         STPRT01
     C     TRVK2         READE(N)  TRUVDK                                 33
     C                   ENDDO
     C     TRHK          READE(N)  TRUV                                   33
     C                   ENDDO
     C                   MOVE      '1'           *IN12
     C                   IF        ((THSPOM = 'A') OR (THSPOM = 'C'))
     C                   MOVE      'YBC1952'     MSGNR
     C                   ELSE
     C                   MOVE      'YBC1951'     MSGNR
     C                   END
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLPRT
     C     STPRT01       TAG
     C                   END
     C                   END
      *
     C                   IF        THDK <> 'SS'
N21  C                             AND THDK <> 'ENTRY' AND THDK <> 'EXIT'
     C                   IF        (((THGKD <> 2) AND (THGKD <> 4)) OR
     C                               (THGBL = 0))
     C     UAVD          CHAIN     TRUSTD                             33
     C                   MOVE      *ZEROS        XBEL1            11 0
     C     1             DO        200           XNR3
     C                   IF        AV(XNR3) = 0
     C                   LEAVE
     C                   END
     C                   MOVE      AV(XNR3)      SEAVD
     C                   MOVE      OP(XNR3)      SETDN
     C     SAEHK         CHAIN     SAEH                               33
     C     SEVAL1        CHAIN     KODTVAL2                           33
     C                   EVAL(H)   XBEL1 = SEBEL1 * SEVKU / KVAOMR
     C                   ADD       XBEL1         WSTBL
     C                   ENDDO
     C                   IF        THGBL = 0
S19  C* N99              EVAL(H)   WSGBL = WSTBL * STD_THGBL / 100
S20  C* N99              EVAL(H)   WSGBL = WSTBL * STD_THGBL / 10000
N20  C  N99              EVAL(H)   WSGBL = WSTBL * STD_THGPR / 100
     C                   ELSE
     C                   MOVE      THGBL         WSGBL
     C                   END
      * OMREGN BELØP
     C                   IF        THGVK <> 'NOK'
     C     THGVK         SETLL     KODTVAL2
     C     THGVK         READE     KODTVAL2                               33
     C                   DOW       *IN33 = *OFF
     C     THGVK         READE     KODTVAL2                               33
     C                   ENDDO
     C                   EVAL(H)   WSTBL = WSTBL / KVAKRS * KVAOMR
     C                   END
      *
S20  C*                  IF        STD_THGBL = 0
N20  C                   IF        STD_THGPR = 0
     C                   Z-ADD     30            WSGPR
     C                   ELSE
S19  C*                  MOVE      STD_THGBL     WSGPR
S20  C*                  EVAL      WSGPR = STD_THGBL / 100
N20  C                   EVAL      WSGPR = STD_THGPR
     C                   END
     C     STPRT         TAG
     C                   MOVE      WSGBL         XSGBL            11 0
S19  C*                  MOVE      WSGPR         XSGPR             3 0
N19  C                   MOVE      WSGPR         XSGPR             5 2
     C                   EXFMT     TSTGRBL
     C   10              DO
     C                   CALL      'TR026R'
     C                   PARM                    WSTBL
     C                   PARM                    THGVK
     C                   PARM                    FICURR
     C                   PARM                    UFLAGG
     C                   EVAL(H)   WSGBL = WSTBL * WSGPR / 100
     C                   GOTO      STPRT
     C                   END
     C   12              GOTO      SLPRT
     C                   IF        ((WSGPR <> XSGPR) AND (WSGBL = XSGBL))
     C                   EVAL(H)   WSGBL = WSTBL * WSGPR / 100
     C                   GOTO      STPRT
     C                   END
     C                   IF        TGGBL <> 0
     C                   EVAL      XBEL1 = WSGBL + TGGBLB - THGBL
     C                   IF        XBEL1 > TGGBL
     C                   EXFMT     VARSLING
     C                   MOVE      '1'           *IN12
     C                   GOTO      SLPRT
     C                   END
     C     WSGBL         CABEQ     0             STPRT
     C     TRHK          CHAIN     TRUH                               33
     C                   EVAL      XBEL1 = WSGBL - THGBL
     C                   MOVE      WSGBL         THGBL
     C                   UPDATE    TRUHR
      * OPPDATER TOTAL PÅ NY GARANTI
     C  N33              IF        ((THGFT1 <> *BLANKS) AND
     C                             ((THGKD <= 1) OR
     C                               (THGKD >= 6)))
     C     THGFT1        CHAIN     TRUGH                              33
     C                   IF        *IN33 = *OFF
     C                   EVAL      TGGBLB = TGGBLB + XBEL1
     C                   UPDATE    TRUGHR
     C                   IF        TGGBLB > TGGBL
     C                   Z-ADD     100           XPRM
     C                   ELSE
     C     TGGBLB        DIV       TGGBL         XPRM              5 2
     C                   MULT      100           XPRM
     C                   END
     C                   IF        ((XPRM > TGPRM) AND (TGPRM <> 0))
     C                   EXFMT     VARSLING
     C                   END
     C                   END
     C                   END
     C                   ELSE
     C     TRHK          CHAIN     TRUH                               33
     C                   IF        *IN33 = *OFF
     C                   MOVE      WSGBL         THGBL
     C                   UPDATE    TRUHR
     C                   END
     C                   END
     C                   END
     C                   END
      *
     C                   IF        *IN27 = *OFF
     C     UIN34         IFEQ      '1'
     C                   MOVE      '015'         U1N07
     C                   ELSE
     C                   MOVE      '   '         U1N07
     C                   END
     C                   CALL      'TR013R'
     C                   PARM      UPARM2        UPARM1
     C                   PARM                    UFLAGG
      *
     C     UFLAGG        COMP      1                                      12
     C                   END
      *
     C     SLPRT         ENDSR
      *
     C***********************************************
     C     SØKDTA        BEGSR
     C***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
     C     LINNBR        IFEQ      3
     C     POSNBR        ANDGE     13
     C     POSNBR        ANDLE     20
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    W2KNS
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN
     C                   Z-ADD     53            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      3
     C     POSNBR        ANDGE     53
     C     POSNBR        ANDLE     60
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    W2KNK
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     10            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      9
     C     POSNBR        ANDGE     10
     C     POSNBR        ANDLE     17
     C                   CALL      'SAD010A'
     C                   PARM                    W2VNTI
     C                   PARM                    UIDAG
     C                   Z-ADD     32            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      9
     C     POSNBR        ANDGE     32
     C     POSNBR        ANDLE     33
     C                   MOVE      '031'         UUNIK             3
     C                   MOVE      *BLANKS       UKODE            10
     C                   MOVEL     W2DK          UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         W2DK
     C                   Z-ADD     50            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      9
     C     POSNBR        ANDGE     50
     C     POSNBR        ANDLE     51
     C                   CALL      'SYFI10L'
     C                   PARM                    W2ALK
     C                   PARM                    USPED
     C                   Z-ADD     70            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      9
     C     POSNBR        ANDGE     70
     C     POSNBR        ANDLE     71
     C                   CALL      'SYFI10L'
     C                   PARM                    W2BLK
     C                   PARM                    USPED
     C                   Z-ADD     10            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      10
     C     POSNBR        ANDGE     70
     C     POSNBR        ANDLE     71
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     W2VTSK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         W2VTSK
     C                   Z-ADD     11            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      12
     C     POSNBR        ANDGE     10
     C     POSNBR        ANDLE     15
     C                   MOVE      '014'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     W2TDT         UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         W2TDT
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      12
     C     POSNBR        ANDGE     38
     C     POSNBR        ANDLE     39
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     W2TDSK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         W2TDSK
     C                   Z-ADD     51            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      12
     C     POSNBR        ANDGE     77
     C     POSNBR        ANDLE     78
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     W2TDOS        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         W2TDOS
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      13
     C     POSNBR        ANDGE     10
     C     POSNBR        ANDLE     12
     C                   MOVE      '013'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     W2DTY         UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         W2DTY
     C                   Z-ADD     30            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      13
     C     POSNBR        ANDGE     60
     C     POSNBR        ANDLE     61
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     W2DSK         UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         W2DSK
     C                   Z-ADD     14            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      14
     C     POSNBR        ANDGE     50
     C     POSNBR        ANDLE     51
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     W2DOSK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         W2DOSK
     C                   Z-ADD     16            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      16
     C     POSNBR        ANDGE     10
     C     POSNBR        ANDLE     12
     C                   MOVE      '039'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     W2TLO         UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         W2TLO
     C                   Z-ADD     41            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      16
     C     POSNBR        ANDGE     43
     C     POSNBR        ANDLE     44
     C                   CALL      'SYFI10L'
     C                   PARM                    W2EXLK
     C                   PARM                    USPED
     C                   Z-ADD     17            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      17
     C     POSNBR        ANDGE     70
     C     POSNBR        ANDLE     71
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     W2MSK         UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         W2MSK
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     40
     C     POSNBR        ANDLE     41
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     W2MNSK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE            10
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         W2MNSK
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     10            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     10
     C     POSNBR        ANDLE     11
     C                   MOVE      '017'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     W2EH          UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         W2EH
     C                   Z-ADD     30            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
      *
     C     SLSØK         ENDSR
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
N03  C     FRIKEY1       KLIST
N03  C                   KFLD                    WSKODE            3
N03  C                   KFLD                    W2XEXT           35
N03  c                   move      '*CE'         wskode
N03  C     FRIKEY2       KLIST
N03  C                   KFLD                    WSKOD2            3
N03  C                   KFLD                    W2XEXT
N03  c                   move      '*CR'         wskod2
N03  C     TRXREFK       KLIST
N03  C                   KFLD                    TVAVD
N03  C                   KFLD                    TVTDN
N03  C                   KFLD                    TVLI
     C     HEDFK2        KLIST
     C                   KFLD                    W2AVD2
     C                   KFLD                    W2TDN2
     C     HEDFK3        KLIST
     C                   KFLD                    TVAVD2
     C                   KFLD                    TVTDN2
     C     TRHK          KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C     SAEHK         KLIST
     C                   KFLD                    SEAVD
     C                   KFLD                    SETDN
     C     TRVK          KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    W2LI
     C     TRV1K         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    W3LI
     C     TRVK1         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    XLI2
     C     TRVK2         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    TVLI
     C     TRV2K         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    W3VNT
     C     TRV21         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C     TRK01K        KLIST
     C                   KFLD                    YUNIK             3
     C                   KFLD                    YKODE            10
     C     TARIK         KLIST
     C                   KFLD                    W2VNT
     C                   KFLD                    X2TAR
     C     KODS2K        KLIST
     C                   KFLD                    KS2UNI
     C                   KFLD                    KS2LK
     C                   MOVE      'S2 '         KS2UNI
     C     CUND1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
N01  C     ZTRUHL01K     KLIST
N01  C                   KFLD                    UZREFF
N01  C                   KFLD                    UZUNIK
N01  C     ZTRUHL03K     KLIST
N01  C                   KFLD                    UAVD
N01  C                   KFLD                    UTDN
N01  C     ZTRUVL01K     KLIST
N01  C                   KFLD                    UZREFF
N01  C                   KFLD                    UZUNIK
N01  C                   KFLD                    XLI
N01  C     ZTRUVAM1K     KLIST
N01  C                   KFLD                    UZREFF
N01  C                   KFLD                    UZUNIK
N01  C                   KFLD                    TVLI
      *
     C     *ENTRY        PLIST
     C     UPARM2        PARM      UPARM2        UPARM1          128
     C                   PARM                    UFLAGG            1 0
      *
S15  C*    'TET00004'    CHAIN     SYPTFF                             33
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
     C                   MOVE      UIN27         *IN27
     C                   MOVE      UIN36         *IN36
     C                   MOVE      *ZEROS        XLI
      *** UUR = 'F' -> SJØSPEDISJON
     C     UUR           COMP      'F'                                    60
     C  N60UUR           COMP      'G'                                    60
      *
     C                   MOVE      *ZEROS        TVLI
     C                   MOVE      *BLANKS       X2TAR             3
     C                   MOVE      *ZEROS        W2VNT
     C                   MOVE      *ZEROS        TVVNT
     C                   MOVE      'N'           USPED             1
     C  N27UPRO          IFGT      0
     C     ULSTL         ORGT      0
     C     TRHK          CHAIN(N)  HEADF                              33
     C     *IN33         IFEQ      '1'
     C                   MOVE      'J'           XHOPD             1
     C                   MOVE      'N'           XHOPD2            1
     C                   ELSE
     C                   MOVE      'J'           XHOPD2
     C                   END
     C                   ELSE
     C                   MOVE      'J'           XHOPD2
     C                   END
     C                   MOVEA     '01'          *IN(31)
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVEL     WDT           UIDAG             8 0
N01   *
N01  C                   IF        UZREFF = *BLANKS
N01  C     ZTRUHL03K     CHAIN     ZTRUHL03                           33
N01  C  N33              MOVE      THUNIK        UZUNIK
N01  C  N33              MOVE      THREFF        UZREFF
N01  C                   END
N01   *
     C     TRHK          CHAIN(N)  TRUH                               33
     C     TRHK          CHAIN     TRUHFV                             33
     C  N33              MOVE      'J'           XFORHV            1
N04  C  N33              EVAL      *IN39 = *ON
     C     THGFT1        CHAIN(N)  TRUGH                              33
N01   *
N01  C                   IF        ((UZUNIK <> 0) AND (UZREFF <> *BLANKS))
N01   * UZUNIK<0 ---> HAR VÆRT PÅ EN ANNEN DEKLARASJON FØR.
N01   *               SETT PÅ REGENERERINGS MERKE.
N01   * UZUNIK>0 ---> FØRST GANG BLE PLUKKET. PLUKKE ALLE VARELINJER.
N01   *               I TILFELLE BRUDD PÅ FØRST PLUKKING, GJENTA JOBB
N01   *               DERFRA.
N01  C                   IF        UZUNIK < 0
N01  C                   Z-SUB     UZUNIK        UZUNIK
N01  C                   MOVE      'J'           XREGTV            1
N01  C                   ELSE
N01  C                   MOVE      'N'           XREGTV            1
N01  C                   END
N01  C                   EXSR      HZFIL
N01  C                   END
      *
     C                   ENDSR
      *
N01   ******************************************
N01  C     HZFIL         BEGSR
N01   ******************************************
N01  C                   MOVE      'J'           XGENTV            1
N01  C                   Z-ADD     99999         W2LI
N01  C     TRVK          SETGT     TRUV
N01  C     TRHK          READPE    TRUV                                   33
N01  C   33              MOVE      *ZEROS        XLI
N01  C  N33              MOVE      TVLI          XLI
N01   *
N01  C     ZTRUVL01K     SETLL     ZTRUVL01
N01  C     STHZF1        TAG
N01  C     ZTRUHL01K     READE     ZTRUVL01                               33
N01  C  N33              IF        ((TVAVD <> 0) AND (XREGTV = 'N'))
N01  C                   EXCEPT    DUMZTRV
N01  C                   GOTO      STHZF1
N01  C                   ELSE
N01  C                   MOVE      '1'           *IN93
N01  C                   WRITE     SUBCTL
N01  C                   MOVEA     '01'          *IN(93)
N01  C                   EXSR      MOVB2
N01  C                   WRITE     NYWRK
N01  C                   END
N01   *
N01  C                   DOW       *IN33 = *OFF
N01  C                   EXSR      MOVTRW
N01  C     ZTRUVAM1K     CHAIN(N)  ZTRUVAM1                           33
N01  C                   MOVE      TVLI          XTVLIAM           5 0
N01  C                   IF        *IN33 = *OFF
N01  C                   MOVE      TVKNS         W2KNS
N01  C                   MOVE      TVNAS         W2NAS
N01  C                   MOVE      TVADS1        W2ADS1
N01  C                   MOVE      TVPNS         W2PNS
N01  C                   MOVE      TVPSS         W2PSS
N01  C                   MOVE      TVLKS         W2LKS
N01  C                   MOVE      TVSKS         W2SKS
N01  C                   MOVE      TVTINS        W2TINS
N01  C                   MOVE      TVKNK         W2KNK
N01  C                   MOVE      TVNAK         W2NAK
N01  C                   MOVE      TVADK1        W2ADK1
N01  C                   MOVE      TVPNK         W2PNK
N01  C                   MOVE      TVPSK         W2PSK
N01  C                   MOVE      TVLKK         W2LKK
N01  C                   MOVE      TVSKK         W2SKK
N01  C                   MOVE      TVTINK        W2TINK
N01  C                   END
N01  C                   GOTO      STHZF3
N01  C     STHZF2        TAG
N01  C  N30              EXSR      TSTOPL
N01  C                   EXFMT     VARELI
N01  C                   MOVEA     '000000000000'*IN(79)
N01  C                   MOVEA     '000000000000'*IN(67)
N01  C                   MOVEA     '000000000000'*IN(55)
N01  C                   MOVEA     '000'         *IN(52)
N01  C   12              EXCEPT    DUMZTRV
N01  C   12              GOTO      SLHZF
N01  C   04              DO
N01  C                   EXSR      SØKDTA
N01  C                   GOTO      STHZF2
N01  C                   END
N01   *
N01  C     STHZF3        TAG
N01  C                   EXSR      TESTB1
N01  C   30              GOTO      STHZF2
N01  C                   ADD       1             XLI
N01  C                   MOVE      XLI           W2LI
N01  C                   EXSR      OPDTRV
N01   *
N01  C                   EXCEPT    OPDZTRV
N01  C                   MOVE      XTVLIAM       TVLI
N01  C     ZTRUVAM1K     CHAIN     ZTRUVAM1                           33
N01  C                   IF        *IN33 = *OFF
N01  C                   MOVE      UAVD          TVAVD
N01  C                   MOVE      UTDN          TVTDN
N01  C                   UPDATE    TRUVAMRZ
N01  C                   END
N01  C     STHZF4        TAG
N01  C     ZTRUHL01K     READE     ZTRUVL01                               33
N01  C  N33              IF        ((TVAVD <> 0) AND (XREGTV = 'N'))
N01  C                   EXCEPT    DUMZTRV
N01  C                   GOTO      STHZF4
N01  C                   END
N01  C  N33              END
N01   *
N01  C     SLHZF         TAG
N01  C                   MOVE      'N'           XGENTV            1
N01   *
N01  C                   ENDSR
N01   *
     C***********************************************
     C     TSTOPL        BEGSR
     C***********************************************
     C                   MOVEA     '00'          *IN(28)
     C                   MOVEA     '0000'        *IN(45)
      *** TEST OM FLERE CONTAINERNR (RUBR. 31) FINNES
     C     TRVK          SETLL     TRUVCN
     C     TRVK          READE(N)  TRUVCN                                 33
     C  N33              SETON                                        28
      *** TEST OM FLERE DOKUMENTER (RUBR. 44) FINNES
     C     TRVK          SETLL     TRUVDK
     C     TRVK          READE(N)  TRUVDK                                 33
     C  N33              SETON                                        29
      *** TEST OM FLERE FØLSOMME VARER FINNES
     C     TRVK          SETLL     TRUVFS
     C     TRVK          READE(N)  TRUVFS                                 33
     C  N33              SETON                                        45
      *** TEST OM FLERE MERKE & NR (RUBR. 31) FINNES
     C     TRVK          SETLL     TRUVMN
     C     TRVK          READE(N)  TRUVMN                                 33
     C  N33              SETON                                        46
      *** TEST OM FLERE TIDLIGERE DOKUMENTER (RUBR. 40) FINNES
     C     TRVK          SETLL     TRUVTD
     C     TRVK          READE(N)  TRUVTD                                 33
     C  N33              SETON                                        47
      *** TEST OM FLERE VAREBEKSRIVELSESLINJER (RUBR. 31) FINNES
     C     TRVK          SETLL     TRUVVT
     C     TRVK          READE(N)  TRUVVT                                 33
     C  N33              SETON                                        48
      *
     C                   ENDSR
      *
     C***********************************************
     C     DLTOPL        BEGSR
     C***********************************************
      *** SLETTE CONTAINERNR PGA. AVBRYT NY REGISTRERING
     C     TRVK          SETLL     TRUVCN
     C     TRVK          READE     TRUVCN                                 33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    TRUVCNR
     C     TRVK          READE     TRUVCN                                 33
     C  N33              ENDDO
      *** SLETTE DOKUMENTER PGA. AVBRYT NY REGISTRERING
     C     TRVK          SETLL     TRUVDK
     C     TRVK          READE     TRUVDK                                 33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    TRUVDKR
     C     TRVK          READE     TRUVDK                                 33
     C  N33              ENDDO
      *** SLETTE FØLSOMME VARER PGA. AVBRYT NY REGISTRERING
     C     TRVK          SETLL     TRUVFS
     C     TRVK          READE     TRUVFS                                 33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    TRUVFSR
     C     TRVK          READE     TRUVFS                                 33
     C  N33              ENDDO
      *** SLETTE MERKE & NR PGA. AVBRYT NY REGISTRERING
     C     TRVK          SETLL     TRUVMN
     C     TRVK          READE     TRUVMN                                 33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    TRUVMNR
     C     TRVK          READE     TRUVMN                                 33
     C  N33              ENDDO
      *** SLETTE TIDLIGERE DOKUMENTER PGA. AVBRYT NY REGISTRERING
     C     TRVK          SETLL     TRUVTD
     C     TRVK          READE     TRUVTD                                 33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    TRUVTDR
     C     TRVK          READE     TRUVTD                                 33
     C  N33              ENDDO
      *** SLETTE VAREBESKRIVELSER PGA. AVBRYT NY REGISTRERING
     C     TRVK          SETLL     TRUVVT
     C     TRVK          READE     TRUVVT                                 33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    TRUVVTR
     C     TRVK          READE     TRUVVT                                 33
     C  N33              ENDDO
      *
     C                   ENDSR
      *
N01  OTRUVRZ    E            OPDZTRV
N01  O                       TVAVD
N01  O                       TVTDN
N01  O          E            DUMZTRV
