     FLLMRF     UF   E           K DISK
     FLLAGJL07  UF   E           K DISK
     FLLAGJFEU  IF   E           K DISK
     FLLVARE01  IF   E           K DISK
     FLLLISF    IF   E           K DISK
     FLLTARF    IF   E           K DISK
     FFRISOL01  IF A E           K DISK
     FDKIA      UF   E           K DISK
     FDKIH      UF A E           K DISK
     FDKIV      O  A E             DISK
     FDKTVK     IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FFIRM      IF   E           K DISK
      *
     D                 DS
     D  DKIH_SYAV              1      4  0
     D  DKIH_SYOP              5     11  0
     D  DKIH_SYSG             12     14
     D  X14S                   1     14
     D                UDS
     D  UDSSG                 19     21
      *
     C                   EXSR      INIT
      *
     C                   EXSR      SRDKIH
     C                   EXSR      SRDKIV
     C                   EXSR      SRDKIHS
      *
     C                   EVAL      UFLAG = '0'
     C                   EVAL      *INLR = *ON
     C                   RETURN
      *
      ***********************************************
     C     SRDKIH        BEGSR
      ***********************************************
      *
     C     LLMRFK        CHAIN     LLMRF                              33
     C                   SELECT
     C                   WHEN      *IN33
     C                   EVAL      UFLAG = '1'
     C                   EVAL      *INLR = *ON
     C                   RETURN
     C                   WHEN      *IN33 = *OFF AND MRST <> ' '
     C                   EVAL      UFLAG = '1'
     C                   EVAL      *INLR = *ON
     C                   RETURN
     C                   ENDSL
     C                   EVAL      MRST = 'X'
     C                   UPDATE    LLMRFR
      *
     C                   EVAL      DKIH_SYAV = 1
     C     DKIH_SYAV     CHAIN     DKIA                               33
     C                   ADD       1             DKIA_SYOP
     C                   UPDATE    DKIAR
     C                   EVAL      DKIH_SYOP = DKIA_SYOP
      *
     C*                  EVAL      DKIH_SYSG = 'BOG'
     C                   EVAL      DKIH_SYSG = UDSSG
     C                   EVAL      DKIH_SYDT = WDT08
     C                   EVAL      DKIH_A    = '4700'
     C                   EVAL      DKIH_DTM1 = MRDT * 10000
     C                   EVAL      DKIH_AJOU = '1'
     C                   EVAL      DKIH_R011 = 'IM'
     C                   EVAL      DKIH_R012 = 'A'
     C                   EVAL      DKIH_AART = '04'
     C                   IF        MRLNA = *BLANKS OR MRLNA = 'Unknown'
     C                   EVAL      DKIH_02B  = 'KINGSLAND CHINA OFFICE'
     C                   EVAL      DKIH_02C  = 'ROOM 609'
     C                   EVAL      DKIH_02D  = '-'
     C                   EVAL      DKIH_02E  = 'WENHUI ROAD'
     C                   ELSE
     C                   EVAL      DKIH_02B  = MRLNA
     C                   EVAL      DKIH_02C  = MRLAD1
     C                   EVAL      DKIH_02D  = '-'
     C                   EVAL      DKIH_02E  = MRLAD3
     C                   END
     C                   EVAL      DKIH_02F  = %SUBST(MRTRNR:17:2)
     C     CUNDL01K      CHAIN     CUNDL01                            33
     C                   EVAL      DKIH_08A  = EORI
     C                   EVAL      DKIH_08B  = KNAVN
     C                   EVAL      DKIH_08C  = ADR1
     C                   IF        POSTNR = 0
     C                   EVAL      DKIH_08D  = SYPOGE
     C                   ELSE
     C                   MOVEL     POSTNR        DKIH_08D
     C                   END
     C                   EVAL      DKIH_08E  = ADR3
     C                   IF        SYLAND = *BLANKS
     C                   EVAL      DKIH_08F  = FILAND
     C                   ELSE
     C                   EVAL      DKIH_08F  = SYLAND
     C                   END
     C                   EVAL      DKIH_14A  = DKIA_14A
     C                   EVAL      DKIH_14B  = DKIA_14B
     C                   IF        %SUBST(MRTRNR:17:2) = *BLANKS
     C                   EVAL      DKIH_15   = 'CN'
     C                   ELSE
     C                   EVAL      DKIH_15   = %SUBST(MRTRNR:17:2)
     C                   END
     C                   EVAL      DKIH_25   = '1'
     C                   EVAL      DKIH_26   = '3'
     C                   EVAL      DKIH_49   = 'A470303DK'
     C                   EVAL      DKIH_28B  = 'N380'
     C                   EVAL      DKIH_GENB = '1'
     C                   EVAL      DKIH_S29  = 'H '
      *
     C                   WRITE     DKIHR
      *
     C                   EVAL      FSAVD  = DKIH_SYAV
     C                   EVAL      FSOPD  = DKIH_SYOP
     C                   EVAL      FSDTOP = MRDT
     C                   WRITE     FRISOKR
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRDKIV        BEGSR
      ***********************************************
     C                   EVAL      DKIV_SYAV = DKIH_SYAV
     C                   EVAL      DKIV_SYOP = DKIH_SYOP
     C                   EVAL      DKIV_SYLI = 0
      *
     C     LLAGJL07K     SETLL     LLAGJL07
     C     STSRDKIV1     TAG
     C     LLAGJL07K     READE     LLAGJL07                               33
     C                   IF        *IN33 = *OFF AND %SUBST(VALLOK:1:5) = 'KTTL'
     C                   EVAL      DKVK_KD   = VAFAR
     C     VAMN          CHAIN     LLLISF                             33
     C                   DOW       *IN33 = *OFF
     C                   IF        LIKD = 'FAK'
     C                   EVAL      XX_28B  = LITXT
     C                   IF        %SUBST(LITXT:28:8) = *BLANKS
     C                   EVAL      XX_28C  = WDT08
     C                   ELSE
     C                   MOVE      LITXT         XX_28C
     C                   END
     C                   LEAVE
     C                   END
     C     VAMN          READE     LLLISF                                 33
     C                   ENDDO
     C                   EVAL      *IN33 = *OFF
     C                   ELSE
     C                   GOTO      STSRDKIV1
     C                   END
      *
     C                   DOW       *IN33 = *OFF
     C                   IF        VASALD > 0 AND %SUBST(VALLOK:1:5) = 'KTTL'
     C     LLAGJFEUK     CHAIN     LLAGJFEU                           33
     C                   IF        *IN33
     C                   EVAL      VAOPLK = *BLANKS
     C                   EVAL      VAFVUE = *BLANKS
     C                   EVAL      VAFRUE = 0
     C                   EVAL      VAFVIE = *BLANKS
     C                   EVAL      VAFRIE = 0
     C                   END
      *
     C                   EVAL      VAAVD = DKIH_SYAV
     C                   EVAL      VAOPD = DKIH_SYOP
      *
     C                   EVAL      DKIV_SYLI = DKIV_SYLI + 1
     C                   EVAL      DKIV_311A = 'ADR.'
     C                   EVAL      DKIV_313A = VASALD
     C                   EVAL      DKIV_412  = VASALD
     C                   EVAL      DKIV_314A = 'PK'
     C*                  EVAL      DKIV_315A = VAVARE
     C                   EVAL      DKIV_315A = %trim(VAANR)+'/'+ VAVARE
     C                   EVAL      DKIV_32   = DKIV_SYLI
     C                   EVAL      DKIV_331  = *BLANKS
     C     VAMN          CHAIN     LLLISF                             33
     C                   DOW       *IN33 = *OFF
     C                   IF        LIKD = 'TAR'
     C                   EVAL      DKIV_331  = LITXT
     C                   LEAVE
     C                   END
     C     VAMN          READE     LLLISF                                 33
     C                   ENDDO
     C                   IF        DKIV_331 = *BLANKS
     C     LLTARFK       CHAIN     LLTARF                             33
     C  N33              EVAL      DKIV_331 = LTTANR
     C                   END
     C                   IF        %SUBST(MRTRNR:17:2) = *BLANKS
     C                   EVAL      DKIV_34   = 'CN'
     C                   ELSE
     C                   EVAL      DKIV_34   = %SUBST(MRTRNR:17:2)
     C                   END
     c                   IF        VAOPLK <> *blanks
     C                   EVAL      DKIV_34   = VAOPLK
     c                   endif
     C                   EVAL      DKIV_36   = '100'
     C                   EVAL      DKIV_37   = '7100099'
     C                   EVAL(H)   DKIV_38   = VAVKT0 * VASALD                  Netto vekt
     C                   IF        DKIV_38 < 1
     C                   EVAL      DKIV_38   = 1
     C                   endif
     C                   EVAL(H)   DKIV_35   = VAVKF0 * VASALD                  Brutto Vekt
     C                   IF        DKIV_35 < DKIV_38                            0/mindre enn Netto?
     C                   EVAL(H)   DKIV_35   = DKIV_38 * 1,1
     C                   END
      * HVOR KAN HENTE OPPLYSNING TIL RUBR. 40?
     C*                  EVAL      DKIV_401A = 'X'
     C*                  EVAL      DKIV_402A = '740'
     C*                  EVAL      DKIV_403A = '3558226722'
     C                   EVAL      DKIV_401A = 'Y'
     C                   EVAL      DKIV_402A = '380'
     C                   EVAL      DKIV_403A = XX_28B
     C                   EVAL      DKIV_411  = 'CEN'
     C                   IF        VAVERD = 0
     C     LLVARE01K     CHAIN     LLVARE01                           33
     C  N33              EVAL(H)   DKIV_42   = VASALD * LVPRI
     C                   ELSE
     C                   EVAL(H)   DKIV_42   = VASALD * VAVERD
     C                   END
      *
      * Beregn frakt
     C                   IF        VAFRUE = 0
     C                   EVAL      DKIV_T17A = 0
     C                   ELSE
     C                   MOVE      DKVK_KD       XX_KD
     C     DKTVKKUE      SETGT     DKTVK
     C     VAFVUE        READPE    DKTVK                                  33
     C                   EVAL(H)   DKIV_T17A=VAFRUE*VASALD*DKVK_KRS/DKVK_OMR
     C                   MOVE      XX_KD         DKVK_KD
     C                   END
     C                   EVAL      DKIV_T18  = DKIV_T17A
     C                   IF        VAFRIE = 0 OR
     C                             DKIH_201 = 'DDU' OR DKIH_201 = 'DDP'
     C                   EVAL      DKIV_T19  = 0
     C                   ELSE
     C                   MOVE      DKVK_KD       XX_KD
     C     DKTVKKIE      SETGT     DKTVK
     C     VAFVIE        READPE    DKTVK                                  33
     C                   EVAL(H)   DKIV_T19=VAFRIE*VASALD*DKVK_KRS/DKVK_OMR
     C                   MOVE      XX_KD         DKVK_KD
     C                   END
     C                   EVAL      DKIV_T23  = DKIV_T19
      * Beregn statistisk verdi
     C     DKTVKK        SETGT     DKTVK
     C     DKVK_KD       READPE    DKTVK                                  33
     C                   EVAL(H)   DKIV_T12  = DKIV_42 * DKVK_KRS / DKVK_OMR
     C                   EVAL(H)   DKIV_T24  = DKIV_T12 + DKIV_T18 - DKIV_T23
      *
     C                   EVAL(H)   DKIV_46 = DKIV_T24
     C                   EVAL      DKIV_28B  = MRLREF
     C                   WRITE     DKIVR
     C                   EVAL(H)   XX_222  = XX_222  + DKIV_42
     C                   EVAL(H)   XX_12   = XX_12   + DKIV_T23
     C                   EVAL(H)   XX_12E  = XX_12E  + DKIV_T18
     C                   EVAL      XX_06   = XX_06   + DKIV_313A
     C                   EVAL      XX_BRUT = XX_BRUT + DKIV_35
     C                   END
     C                   UPDATE    LLAGJR
      *
     C     LLAGJL07K     READE     LLAGJL07                               33
     C                   ENDDO
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRDKIHS       BEGSR
      ***********************************************
      *
     C     DKIHK         CHAIN     DKIH                               33
     C                   EVAL      DKIH_28A  = 'N380'
     C                   EVAL      DKIH_28B  = XX_28B
     C* blank ønskes     EVAL      DKIH_28C  = XX_28C
     C                   EVAL      DKIH_222  = XX_222
     C                   EVAL      DKIH_12   = XX_12
     C                   EVAL      DKIH_12E  = XX_12E
     C                   EVAL      DKIH_06   = XX_06
     C                   EVAL      DKIH_BRUT = XX_BRUT
     C                   EVAL      DKIH_221  = DKVK_KD
     C     DKTVKK        SETGT     DKTVK
     C     DKVK_KD       READPE    DKTVK                                  33
     C                   EVAL      DKIH_221B = DKVK_KRS
     C                   EVAL      DKIH_221C = DKVK_OMR
     C                   UPDATE    DKIHR
      *
     C                   ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    UKJED             8
     C                   PARM                    UPNR              8
     C                   PARM                    UMRNR             5
     C                   PARM                    UFLAG             1
      *
     C     LLMRFK        KLIST
     C                   KFLD                    MRGRUP
     C                   KFLD                    MRKJED
     C                   KFLD                    MRMRNR
     C     LLAGJL07K     KLIST
     C                   KFLD                    MRGRUP
     C                   KFLD                    MRKJED
     C                   KFLD                    MRMRNR
     C     LLAGJFEUK     KLIST
     C                   KFLD                    MRGRUP
     C                   KFLD                    MRKJED
     C                   KFLD                    VAMN
     C     LLVARE01K     KLIST
     C                   KFLD                    MRGRUP
     C                   KFLD                    MRKJED
     C                   KFLD                    VAANR
     C     LLTARFK       KLIST
     C                   KFLD                    MRGRUP
     C                   KFLD                    MRKJED
     C                   KFLD                    VAANR
     C                   KFLD                    LTLK
     C     FRISOL01K     KLIST
     C                   KFLD                    FSKODE
     C                   KFLD                    FSSOK
     C     DKIHK         KLIST
     C                   KFLD                    DKIH_SYAV
     C                   KFLD                    DKIH_SYOP
     C     DKTVKK        KLIST
     C                   KFLD                    DKVK_KD
     C                   KFLD                    MRDT
     C*                  KFLD                    XX_DTS
     C     DKTVKKUE      KLIST
     C                   KFLD                    VAFVUE
     C                   KFLD                    MRDT
     C*                  KFLD                    XX_DTS
     C     DKTVKKIE      KLIST
     C                   KFLD                    VAFVIE
     C                   KFLD                    MRDT
     C*                  KFLD                    XX_DTS
     C     CUNDL01K      KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    MRKJED
      *
     C     *LIKE         DEFINE    DKIH_28B      XX_28B
     C     *LIKE         DEFINE    DKIH_28C      XX_28C
     C     *LIKE         DEFINE    DKIH_222      XX_222
     C     *LIKE         DEFINE    DKIH_12       XX_12
     C     *LIKE         DEFINE    DKIH_12E      XX_12E
     C     *LIKE         DEFINE    DKIH_06       XX_06
     C     *LIKE         DEFINE    DKIH_BRUT     XX_BRUT
     C     *LIKE         DEFINE    DKVK_DTS      XX_DTS
     C     *LIKE         DEFINE    DKVK_KD       XX_KD
      *
     C                   MOVE      UKJED         MRGRUP
     C                   MOVE      UPNR          MRKJED
     C                   MOVE      UMRNR         MRMRNR
     C                   EVAL      LTLK      = 'DK'
     C                   MOVE      '*DI'         FSKODE
     C                   MOVEL     UMRNR         FSSOK
     C                   EVAL      XX_DTS = 99999999
      *
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           WDT08             8 0
      *
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
      *
     C                   ENDSR
      *
