      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/SYOPTT1 MODULE(*LIBL/SYOPTT1
CRTPGM*        *LIBL/CHECKUSR *LIBL/INCGI) ACTGRP(CGI) AUT(*USE)
      *
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX * 01 JOV PTF11 Vis tekst for OK-Uansett (priv/fors maj mm) også om den IKKE er levert
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
12025 * 02 JOV PTF12 Sender og senders ref i lista
12025 * 03 JOV PTF12 Ny versjon av datatables
********************************************************************
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
     FBRIDF     UF   E           K DISK    USROPN
     FBRPARF    IF   E           K DISK    USROPN
     FCUNDL01   IF   E           K DISK    USROPN
     FNOPNR     IF   E           K DISK    USROPN
     Fhead33    IF   E           K DISK    usropn                               Oppdr.giv/dato
     Fhead22    IF   E           K DISK    usropn                               Avd/dato
     F                                     RENAME(HEADFR:HEAD22R)
     FheadDT    IF   E           K DISK    usropn                               Dato
     F                                     RENAME(HEADFR:HEADDTR)
     FTURER14   IF   E           K DISK    usropn
     FTRACKl02  IF   E           K DISK    usropn
     FKalender1 IF   E           K DISK    usropn
     FDOKUF     IF   E           K DISK    usropn
      *--------------------------------------------------------------------
      * Prototype defintions and standard system API error structure
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      *--------------------------------------------------------------------
      * Variables common to CGI programs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
     D IfsMultIndicators...
     d                 ds
     D  NoErrors                       n
     D  NameTooLong                    n
     D  NotAccessible                  n
     D  NoFilesUsable                  n
     D  DupSections                    n
     D  FileIsEmpty                    n
      *
      * Variables received from the input string
     D lng             s              2
     D BckGnd          s             10
     D lstbrd          s              1
     D WSUSER          s             10
     D UsrSpcName      s             10
     D AVVKNR          S              8
     D AVVKNN          S              8  0
     D AVD             S              4
     D AVDN            S              4  0
     D TRANS           S              8
     D TRANSN          S              8  0
     D AGENT           S              8
     D AGENTN          S              8  0
     D AGENTG          S              8
     D AGENTGN         S              8  0
      * agentgruppe
     D AGG             S              8  0 DIM(999)
     D AGN             S              3  0
     D TUR             S              8
     D TURN            S              8  0
     D IED             S              1
     D IOLS            S              1
     D LS1             S             20
     D LS2             S             20
     D IOOT            S              1
     D OT1             S              2
     D OT2             S              2
     D OT3             S              2
     D OT4             S              2
     D OT5             S              2
     D IOTT            S              1
     D TT1             S              3
     D TT2             S              3
     D TT3             S              3
     D TT4             S              3
     D TT5             S              3
     D IOTTb           S              1
     D TT1b            S              3
     D TT2b            S              3
     D TT3b            S              3
     D TT4b            S              3
     D TT5b            S              3
     D LEVYN           S              1
     D POAYN           S              1
     D DATO            s             10
     D FraDT8          s              8  0
     D DATOT           s             10
     D TilDT8          s              8  0
     D AREF            s             15    VARYING
     D MottNavn        s             20    VARYING
     D MottPost        s             20    VARYING
     D VisKl           s              1
     D LevPros         s              5  2
     D AntOK           s              9  0
     D AntFeil         s              9  0
     D AntDef          s              9  0
     D AntUdef         s              9  0
     D LevProsA        s              5  2
     D AntOKA          s              9  0
     D AntFeilA        s              9  0
     D AntDefA         s              9  0
     D AntUdefA        s              9  0
     D TSTSCAN15       s             15
     D TSTSCAN30       s             30
     D l1              s              3s 0
     D l2              s              3s 0
     D zeros           s             15a   inz('000000000000000')
     D ANTSND          s              5  0
     D MaxSN           s              5
     D MaxSND          s              5  0
     D ANTRCD          s              5  0
     D MaxRC           s              5
     D MaxRCD          s              5  0
     D PGM             C                   CONST('SYSPED/CHECKUSR')
      * For xlate mellom Upper Case og Lower Case
     D UC              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZÆØÅ')
     D LC              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzæøå')
     D                 DS
     D TEIDATKL                1     12  0
     D  TEIDAT                 1      8  0
     D  TEITIM                 9     14  0
     D                 DS
     D TEUDATKL                1     12  0
     D  TEUDAT                 1      8  0
     D  TEUTIM                 9     14  0
     D                 DS
     D PODDATKL                1     12  0
     D  PODDAT                 1      8  0
     D  PODTIM                 9     14  0
     D                 DS
     D POADATKL                1     12  0
     D  POADAT                 1      8  0
     D  POATIM                 9     14  0
     D                 DS
     D VI1DATKL                1     12  0
     D  VI1DAT                 1      8  0
     D  VI1TIM                 9     14  0
     D                 DS
     D VI2DATKL                1     12  0
     D  VI2DAT                 1      8  0
     D  VI2TIM                 9     14  0
     D                 DS
     D OMXDATKL                1     12  0
     D  OMXDAT                 1      8  0
     D  OMXTIM                 9     14  0
     D                 DS
     D  DsAvdOpd               1     12
     D  DsAVD                  1      4
     D  DsSlash                5      5
     D  DsOPD                  6     12
     D                 DS
     D  HENAK                  1     30
     D    HENAKX               1     20
     D                 DS
     D  HEADK3                 1     30
     D    HEADK3A              1      4
     D    HEADK3B              6     15
     D                 DS
     D  NOAVGD                 1      7
     D  AV                     1      7
     D                                     DIM(7)
     D                 DS
     D  DGNAVN                 1     14    inz('MaTiOnToFrLøSø')
     D  DGN                    1     14
     D                                     DIM(7)
     D                 DS
     D  TRFA11                 1      7
     D  xxVARM                 1      1
     D                 DS
     D  TRFA21                 1      7
     D  xxFARL                 1      1
     D                 DS
     D  TRFA12                 1      4
     D  xxLENG                 1      1
     D                 DS
     D  TRFA22                 1      4
     D  xxADVI                 1      1
      *
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================******
      * MAIN PROCESS LINE
      *=====================================================================******
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input
     C                   exsr      Parse
      *
     C                   EXSR      INIT
      *
      * Set output skeleton html member name
     C                   exsr      LoadHtml
      *
      * 1-Section /$top
     C                   exsr      SetTop
     C                   callp     wrtsection('stdtop')
     C                   callp     wrtsection('top')
      *
     C                   Move      *zeros        AntSnd
     C                   Move      *zeros        AntRcd
     C     MaxSnd        IFEQ      *ZEROS
     C                   Z-add     1000          MaxSnd
     C                   END
     C     MaxRcd        IFEQ      *ZEROS
     C                   Z-add     5000          MaxRcd
     C                   END
      * ulike nøkler etter hva som er oppgitt
     C                   select
     C     BIKUNR        whenne    *zeros
     c     Hea33Key      setll     head33
     C     AVDN          whenne    *zeros
     c     Hea22Key      setll     head22
     c                   other
     c     FraDt8        setll     headDT
     c                   endsl
      *
     C                   select
     C     BIKUNR        whenne    *zeros
     c     BIKUNR        Reade     head33                                 35
     C     AVDN          whenne    *zeros
     c     AVDN          Reade     head22                                 35
     c                   other
     c                   Read      headDT                                 35
     c                   endsl
      *
     c     *IN35         doweq     '0'
     C                   Add       1             AntRcd
     C     HEDTOP        CabGt     TilDT8        Utles
     C     AntRcd        CabGe     MaxRcd        Utles
      * div filter
     c     HEST          CabEq     'S'           NextRec
     C     TRSLAG        CabEq     'FF'          NextRec
     C     TRSLAG        CabEq     'VF'          NextRec
     c     AVDN          Ifne      *zeros
     C     AVDN          CabNe     HEAVD         NextRec
     c                   end
      * Kun Turnr
     c     TURN          Ifne      *zeros
     C     TURN          CabNe     HEPRO         NextRec
     c                   end
      * Kun agent
     c     AGENTN        Ifne      *zeros
     C     AGENTN        CabNe     HEKNA         NextRec
     c                   end
      * Kun agentGruppe
     c     AGENTGN       Ifne      *zeros
     C     HEKNA         Cabeq     *zeros        NextRec
     c     HEKNA         lookup    AGG                                    33
     C     *in33         cabeq     '0'           NextRec
     c                   endif
      * Kun import / eksport / Domestic
      * (dersom det tar i bruk transportmodul på annet enn innland må tester endres)
     c     IED           Ifne      *blank
     c                   select
     c     IED           wheneq    'I'
     C     HEUR          CabNe     'A'           NextRec
     c     IED           wheneq    'E'
     C     HEUR          CabNe     'B'           NextRec
     c     IED           wheneq    'D'
     C     HEUR          CabNe     'H'           NextRec
     c                   endsl
     c                   endif
      * I/O Lossested - I = Inkluder hvis en av de oppgitte stemmer(test kun hvis ulik blank)
     c     IOLS          Ifeq      'I'
     c     HESDL         andne     *blanks
     c     LS1           Ifne      HESDL
     C     LS2           andne     HESDL
     C                   goto      NextRec
     c                   endif
     c                   endif
      * I/O Lossested - O = OVERSE hvis det stemmer med en av de oppgitte
     c     IOLS          Ifeq      'O'
      * forenkle tester ved å legge dummy nå HESDL er blank..
     c     HESDL         ifeq      *blanks
     c                   eval      HESDL='9999999999999999999'
     c                   end
     c     LS1           Ifeq      HESDL
     C     LS2           oreq      HESDL
     C                   goto      NextRec
     c                   endif
     c                   endif
      * I/O OppdrType - I = Inkluder hvis en av de oppgitte stemmer
     c     IOOT          Ifeq      'I'
     c     HEOT          andne     *blanks
     c     OT1           Ifne      HEOT
     C     OT2           andne     HEOT
     C     OT3           andne     HEOT
     C     OT4           andne     HEOT
     C     OT5           andne     HEOT
     C                   goto      NextRec
     c                   endif
     c                   endif
      * I/O Oppdr.Type- O = OVERSE hvis det stemmer med en av de oppgitte
     c     IOOT          Ifeq      'O'
     c     HEOT          andne     *blanks
     c     OT1           Ifeq      HEOT
     C     OT2           oreq      HEOT
     C     OT3           oreq      HEOT
     C     OT4           oreq      HEOT
     C     OT5           oreq      HEOT
     C                   goto      NextRec
     c                   endif
     c                   endif
      * I/O T&T-event - kun de som har/ikke har gitte T&T-koder (egen SR for bedret lesbarhet)
     c     IOTT          Ifne      *blanks
     c     IOTTb         orne      *blanks
     c                   exsr      IOTTSR
     c     Skipp         cabeq     'Y'           NextRec
     c                   endif
      * med tiden bør transp.nr inn i heknt så det blir unødig å chaine TURER
     c     TRANSN        Ifne      *zeros
     C     hepro         Cabeq     *zeros        NextRec
     c     hepro         chain     TURER14                            33
     C     *in33         Cabeq     '1'           NextRec
     C                   move      TUKNT2        HEKNT
      * SPEDISJON- TRANSPORTØRNR VIA DOKUF - TAR IKKE HØYDE FOR SPREDNING
     C     HEKNT         ifeq      *zeros
     C     DokuKey       chain     Dokuf                              33
     c  N33DFTRAN        ifne      *zeros
     C                   move      DFTRAN        HEKNT
     c                   endif
     c                   endif
     C     TRANSN        CabNe     HEKNT         NextRec
     c                   end
      *
     c     AREF          ifne      *BLANKS
     C     LC:UC         XLATE     HERFA         HERFA
     C                   eval      TSTSCAN15  = uppify(HERFA)
     C     AREF          SCAN      TSTSCAN15                              33
     c     *IN33         CaBEQ     *OFF          NextRec
     C                   end
      *
      *
     c     MottNavn      ifne      *BLANKS
     C     LC:UC         XLATE     HENAK         HENAK
     C                   eval      TSTSCAN30  = uppify(HENAK)
     C     MottNavn      SCAN      TSTSCAN30                              33
     c     *IN33         CaBEQ     *OFF          NextRec
     C                   end
      *
     c     MottPost      ifne      *BLANKS
     C     LC:UC         XLATE     HEADK3        HEADK3
     C                   eval      TSTSCAN30  = uppify(HEADK3)
     C     MottPost      SCAN      TSTSCAN30                              33
     c     *IN33         CaBEQ     *OFF          NextRec
     C                   end
      * Ok - skriv
     C                   exsr      Setrow
     c     Skipp         cabeq     'Y'           NextRec
     C                   callp     wrtsection('row')
     C                   Add       1             AntSnd
     C     AntSnd        CabGe     MaxSnd        Utles
      *
     c     NextRec       Tag
     C                   select
     C     BIKUNR        whenne    *zeros
     c     BIKUNR        Reade     head33                                 35
     C     AVDN          whenne    *zeros
     c     AVDN          Reade     head22                                 35
     c                   other
     c                   Read      headDT                                 35
     c                   endsl
     c                   enddo
      *
      *
     C     UTLES         TAG
     c                   eval      AntDef = AntOK + AntFeil
     c     AntDef        ifeq      0
     c                   eval      LevPros=0
     c                   else
     c                   eval      LevPros=AntOK  / AntDef * 100
     c                   end
NORxxc                   eval      AntDefA= AntOKA+ AntFeilA
     c     AntDefA       ifeq      0
     c                   eval      LevProsA=0
     c                   else
     c                   eval      LevProsA=AntOKA  / AntDefA * 100
     c                   end
     C                   callp     updHTMLvar('ANTOK ':
     C                             %trim(%editc(ANTOK:'3')))
     C                   callp     updHTMLvar('ANTDEF':
     C                             %trim(%editc(ANTDEF:'3')))
     C                   callp     updHTMLvar('ANTUDEF':
     C                             %trim(%editc(ANTUDEF:'3')))
     C                   callp     updHTMLvar('LEVPROS':
     C                             %trim(%editc(LEVPROS:'J')))
     C                   callp     updHTMLvar('ANTOKA':
     C                             %trim(%editc(ANTOKA:'3')))
     C                   callp     updHTMLvar('ANTDEFA':
     C                             %trim(%editc(ANTDEFA:'3')))
     C                   callp     updHTMLvar('ANTUDEFA':
     C                             %trim(%editc(ANTUDEFA:'3')))
     C                   callp     updHTMLvar('LEVPROSA':
     C                             %trim(%editc(LEVPROSA:'J')))
      *
     C                   callp     wrtsection('tableend')
     C                   callp     updHTMLvar('ANTSND':
     C                             %trim(%editc(ANTSND:'3')))
     C                   callp     updHTMLvar('MaxSnd':
     C                             %trim(%editc(MaxSnd:'3')))
     C                   callp     updHTMLvar('ANTRCD':
     C                             %trim(%editc(ANTRCD:'3')))
     C                   callp     updHTMLvar('MaxRcd':
     C                             %trim(%editc(MaxRcd:'3')))
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   callp     wrtsection('bot')
     C                   callp     wrtsection('stdbot')
     C                   callp     wrtsection('*fini')
     C     SLUTT         tag
     C                   EXSR      EXIT
     C                   return
      *
      *=====================================================================******
      * Parse input
      *=====================================================================******
     C     Parse         begsr
     C                   eval      lng     = zhbgetvar('lng')
     C                   eval      BckGnd  = zhbgetvar('bckgnd')
     C                   eval      lstbrd  = zhbgetvar('lstbrd')
     C                   eval      WSUSER  = zhbgetvar('USER')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
      *
     C                   eval      DATO     = zhbgetvar('DATO')
     C                   eval      Fradt8   = c2n2(DATO)
     C                   eval      DATOT    = zhbgetvar('DATOT')
     C                   eval      Tildt8   = c2n2(DATOT)
     C                   eval      MAXSN    = zhbgetvar('MaxSn')
     C                   eval      MaxSnd   = c2n2(MAXSN)
     C                   eval      MAXRC    = zhbgetvar('MaxRc')
     C                   eval      MaxRcd   = c2n2(MAXRC)
     C                   eval      AREF    = zhbgetvar('AREF')
     C     LC:UC         XLATE     AREF          AREF
     C                   eval      AREF    = uppify(AREF)
     C                   eval      MottNavn = zhbgetvar('MottNavn')
     C     LC:UC         XLATE     MottNavn      MottNavn
     C                   eval      MottNavn = uppify(MottNavn)
     C                   eval      MottPost = zhbgetvar('MottPost')
     C     LC:UC         XLATE     MottPost      MottPost
     C                   eval      MottPost = uppify(MottPost)
      *
     C                   eval      AVVKNR  = zhbgetvar('AVVKNR')
     C                   eval      AVVKNN  = c2n2(AVVKNR)
     C                   eval      AVD  = zhbgetvar('AVD')
     C                   eval      AVDN  = c2n2(AVD)
     C                   eval      TRANS  = zhbgetvar('TRANS')
     C                   eval      TRANSN = c2n2(TRANS)
     C                   eval      VisKl = zhbgetvar('VisKl')
      *
     C                   eval      AGENT  = zhbgetvar('AGENT')
     C                   eval      AGENTN = c2n2(AGENT)
     C                   eval      AGENTG = zhbgetvar('AGENTG')
     C                   eval      AGENTGN = c2n2(AGENTG)
     C                   eval      TUR    = zhbgetvar('TUR')
     C                   eval      TURN   = c2n2(TUR)
     C                   eval      IED    = zhbgetvar('IED')                    Imp/eksp/Domestic
     C                   eval      IOLS   = zhbgetvar('IOLS')                   I/O Lossested
     C                   eval      LS1    = zhbgetvar('LS1')
     C                   eval      LS2    = zhbgetvar('LS2')
     C                   eval      IOOT   = zhbgetvar('IOOT')                   I/O Oppdrtyper
     C                   eval      OT1    = zhbgetvar('OT1')
     C                   eval      OT2    = zhbgetvar('OT2')
     C                   eval      OT3    = zhbgetvar('OT3')
     C                   eval      OT4    = zhbgetvar('OT4')
     C                   eval      OT5    = zhbgetvar('OT5')
     C                   eval      IOTT   = zhbgetvar('IOTT')                   I/O T&T-hendelser
     C                   eval      TT1    = zhbgetvar('TT1')
     C                   eval      TT2    = zhbgetvar('TT2')
     C                   eval      TT3    = zhbgetvar('TT3')
     C                   eval      TT4    = zhbgetvar('TT4')
     C                   eval      TT5    = zhbgetvar('TT5')
     C                   eval      IOTTb  = zhbgetvar('IOTTb')                  I/O T&T-hendelser b
     C                   eval      TT1b   = zhbgetvar('TT1b')
     C                   eval      TT2b   = zhbgetvar('TT2b')
     C                   eval      TT3b   = zhbgetvar('TT3b')
     C                   eval      TT4b   = zhbgetvar('TT4b')
     C                   eval      TT5b   = zhbgetvar('TT5b')
     C                   eval      LEVYN  = zhbgetvar('LEVYN')                  Filter på lev-kvalit
     C                   eval      POAYN  = zhbgetvar('POAYN')                  på POD archived kval
      * UPPYFY EKSTRA NORTRAIL-PARAMETRE (HVIS ALFA)
     C                   eval      IED    = uppify(IED)
     C                   eval      IOLS   = uppify(IOLS)
     C                   eval      LS1    = uppify(LS1 )
     C                   eval      LS2    = uppify(LS2 )
     C                   eval      IOOT   = uppify(IOOT)
     C                   eval      OT1    = uppify(OT1 )
     C                   eval      OT2    = uppify(OT2 )
     C                   eval      OT3    = uppify(OT3 )
     C                   eval      OT4    = uppify(OT4 )
     C                   eval      OT5    = uppify(OT5 )
     C                   eval      IOTT   = uppify(IOTT)
     C                   eval      TT1    = uppify(TT1 )
     C                   eval      TT2    = uppify(TT2 )
     C                   eval      TT3    = uppify(TT3 )
     C                   eval      TT4    = uppify(TT4 )
     C                   eval      TT5    = uppify(TT5 )
     C                   eval      IOTTb  = uppify(IOTTb)
     C                   eval      TT1b   = uppify(TT1b)
     C                   eval      TT2b   = uppify(TT2b)
     C                   eval      TT3b   = uppify(TT3b)
     C                   eval      TT4b   = uppify(TT4b)
     C                   eval      TT5b   = uppify(TT5b)
     C                   eval      LEVYN  = uppify(LEVYN)
     C                   eval      POAYN  = uppify(POAYN)
      *
     C                   endsr
      *
      *=====================================================================******
      *  Set output variables for section /$top
      *  (search criteria)
      *=====================================================================******
     C     SetTop        begsr
OddEvC                   callp     updHTMLvar('LogoImg':LogoImg)
      * KUNDE
     C                   callp     updhtmlvar('TITLE':'Sending/leveringstid')
     C                   callp     updhtmlvar('WSNA':BIBESK)
     C                   callp     updhtmlvar('USER':WSUSER)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHTMLvar('sdato':
     C                             %trim(%editw(BIDTV:'    .  .  ')))
     C                   callp     updHTMLvar('stid':
     C                             %trim(%editw(BITIDV:'  .  .  ')))
     C                   MOVE      BIKUNR        XXKUNR            8
     C                   callp     updhtmlvar('KUNR':XXKUNR)
     C                   callp     updHtmlVar('KUNDE':
     C                             %trim(%editc(BIKUNR:'Z')))
      * Color for text, background, links, visited links, active links
     C                   callp     updhtmlvar('TXTCOLOR':'black')
     C                   callp     updhtmlvar('BOLD':' ')
     C                   callp     updhtmlvar('BGCOLOR':BIFARG)
     C                   callp     updhtmlvar('LINK':'0000FF')
     C                   callp     updhtmlvar('VLINK':'FF0000')
     C                   callp     updhtmlvar('ALINK':'00FF00')
      *
     C                   callp     updHtmlVar('AVVKNR':
     C                             %trim(%editc(AVVKNN:'Z')))
     C                   callp     updHTMLvar('KNAVN':KNAVN)
      * Søkeparam
     C                   callp     updHTMLvar('DATO':
     C                             %trim(%editw(Fradt8:'    .  .  ')))
     C                   callp     updHTMLvar('DATU':DATO)                      UNEDITED
     C                   callp     updHTMLvar('DATOT':
     C                             %trim(%editw(Tildt8:'    .  .  ')))
     C                   callp     updHTMLvar('DATUT':DATOT)                    UNEDITED
     c                   callp     updHtmlVar('AVD':
     C                             %trim(%editc(AVDN:'Z')))
     c                   callp     updHtmlVar('TRANS':
     C                             %trim(%editc(TRANSN:'Z')))
     C                   callp     updHTMLvar('AREF':AREF)
     C                   callp     updHTMLvar('MOTTNAVN':MOTTNAVN)
     C                   callp     updHTMLvar('MOTTPOST':MOTTPOST)
     C                   callp     updHTMLvar('VISKL':VISKL)
     C                   callp     updHtmlVar('AGENT':
     C                             %trim(%editc(AGENTN:'Z')))
     C                   callp     updHtmlVar('AGENTG':
     C                             %trim(%editc(AGENTGN:'Z')))
     C                   callp     updHtmlVar('TUR':
     C                             %trim(%editc(TURN:'Z')))
     C                   callp     updHTMLvar('IED':IED)
     C                   callp     updHTMLvar('IOLS':IOLS)
     C                   callp     updHTMLvar('LS1':LS1)
     C                   callp     updHTMLvar('LS2':LS2)
     C                   callp     updHTMLvar('IOOT':IOOT)
     C                   callp     updHTMLvar('OT1':OT1)
     C                   callp     updHTMLvar('OT2':OT2)
     C                   callp     updHTMLvar('OT3':OT3)
     C                   callp     updHTMLvar('OT4':OT4)
     C                   callp     updHTMLvar('OT5':OT5)
     C                   callp     updHTMLvar('IOTT':IOTT)
     C                   callp     updHTMLvar('TT1':TT1)
     C                   callp     updHTMLvar('TT2':TT2)
     C                   callp     updHTMLvar('TT3':TT3)
     C                   callp     updHTMLvar('TT4':TT4)
     C                   callp     updHTMLvar('TT5':TT5)
     C                   callp     updHTMLvar('IOTTb':IOTTb)
     C                   callp     updHTMLvar('TT1b':TT1b)
     C                   callp     updHTMLvar('TT2b':TT2b)
     C                   callp     updHTMLvar('TT3b':TT3b)
     C                   callp     updHTMLvar('TT4b':TT4b)
     C                   callp     updHTMLvar('TT5b':TT5b)
     C                   callp     updHTMLvar('LEVYN':LEVYN)
     C                   callp     updHTMLvar('POAYN':POAYN)
      *
     C                   endsr
      *
      *=====================================================================******
      *  Set output variables for section /$tablerow (table row)
      *=====================================================================******
     C     SetRow        begsr
     c                   move      *blanks       MERKN            70
      *
     c     HXSNDN        Ifeq      *blanks
     c                   MOVE      HEAVD         DsAvd
     c                   MOVE      '/'           DsSlash
     c                   MOVE      HEOPD         DsOpd
     c                   MOVEL     DsAvdOpd      HXSNDN
     c                   end
     C                   callp     updHTMLvar('HXSNDN':HXSNDN)
     C                   callp     updHTMLvar('HEAVD':
     C                             %trim(%editc(HEAVD:'Z')))
     C                   callp     updHTMLvar('HEPRO':
     C                             %trim(%editc(HEPRO:'Z')))
     C                   callp     updHTMLvar('HEKNA':
     C                             %trim(%editc(HEKNA:'Z')))
     C                   callp     updHTMLvar('TRKNFA':
     C                             %trim(%editc(TRKNFA:'Z')))
N02  C                   callp     updHTMLvar('HENAS':%subst(HENAS:1:10))
N02  C                   callp     updHTMLvar('HERFA':HERFA)
     C                   callp     updHTMLvar('HENAK':HENAKX)
     C                   callp     updHTMLvar('HEADK3A':HEADK3A)
     C                   callp     updHTMLvar('HEADK3B':HEADK3B)
     c                   move      *blanks       NOAVGD
     c                   move      *zeros        NOFRFT
     c                   testn                   headk3a              33
     C     *IN33         IFEQ      '1'
     C     HEAVD         ifgt      8000
     c                   move      1000          ZZTERM
     c                   else
     c                   move      3000          ZZTERM
     c                   end
     C                   move      headk3a       NOPONR
     C     InnlKey       CHAIN     NOPNR                              33
     C                   end
     C                   callp     updHTMLvar('NOAVGD':NOAVGD)
     C                   callp     updHTMLvar('NOFRFT':
     C                             %trim(%editc(NOFRFT:'Z')))
      *
     C                   callp     updHTMLvar('HENT':
     C                             %trim(%editc(HENT:'Z')))
     C                   callp     updHTMLvar('HEVKT':
     C                             %trim(%editc(HEVKT:'Z')))
     c                   exsr      GetDates
     c     VisKl         ifne      'Y'
     C                   callp     updHTMLvar('TEIDAT':
     C                             %trim(%editw(TEIDAT:'    .  .  ')))
     C                   callp     updHTMLvar('OMXDAT':
     C                             %trim(%editw(OMXDAT:'    .  .  ')))
     C                   callp     updHTMLvar('TEUDAT':
     C                             %trim(%editw(TEUDAT:'    .  .  ')))
     C                   callp     updHTMLvar('VI1DAT':
     C                             %trim(%editw(VI1DAT:'    .  .  ')))
     C                   callp     updHTMLvar('VI2DAT':
     C                             %trim(%editw(VI2DAT:'    .  .  ')))
     C                   callp     updHTMLvar('PODDAT':
     C                             %trim(%editw(PODDAT:'    .  .  ')))
     C                   callp     updHTMLvar('POADAT':
     C                             %trim(%editw(POADAT:'    .  .  ')))
     C                   else
     C                   callp     updHTMLvar('TEIDAT':
     C                             %trim(%editw(TEIDATKL:'    .  .  _  :  ')))
     C                   callp     updHTMLvar('OMXDAT':
     C                             %trim(%editw(OMXDATKL:'    .  .  _  :  ')))
     C                   callp     updHTMLvar('TEUDAT':
     C                             %trim(%editw(TEUDATKL:'    .  .  _  :  ')))
     C                   callp     updHTMLvar('VI1DAT':
     C                             %trim(%editw(VI1DATKL:'    .  .  _  :  ')))
     C                   callp     updHTMLvar('VI2DAT':
     C                             %trim(%editw(VI2DATKL:'    .  .  _  :  ')))
     C                   callp     updHTMLvar('PODDAT':
     C                             %trim(%editw(PODDATKL:'    .  .  _  :  ')))
     C                   callp     updHTMLvar('POADAT':
     C                             %trim(%editw(POADATKL:'    .  .  _  :  ')))
     C                   end
      * beregning av leveringskvalitet kun dersom...
     c                   movel     'N'           SKIPP
     c                   move      *zeros        AntDgr            5 0
     c                   move      *blanks       KvalTxt          10
     c     NOAVGD        ifne      *blanks
     c     NOFRFT        andne     *zeros
     c     TEIDAT        andne     *zeros
     c     PODDAT        andne     *zeros
     c     HESGM         andne     'LEVERT'
     c                   exsr      BerKval
     c                   end
N01   * diverse tilstander som gjør at ssendingen PR DEF regnes som OK
N01   * (flyttet fra slutten av BERKVAL-dvs regnes som ok (BLIR OK) selv om den ennå ikke er levert)
N01   * men disse særreglene benyttes/vises ikke dersom sendingen er OK etter normale regler
N01  C                   IF        KvalTxt <> 'Y'
N01  C                   select
N01  c     xxADVI        wheneq    'X'
N01  c                   eval      KvalTxt = 'Y'
N01  c                   eval      MERKN='Avisering'
N01  c     xxFARL        wheneq    'X'
N01  c                   eval      KvalTxt = 'Y'
N01  c                   eval      MERKN='Farlig gods'
N01  c     xxLENG        wheneq    'X'
N01  c                   eval      KvalTxt = 'Y'
N01  c                   eval      MERKN='Lengdegods'
N01  c     xxVARM        wheneq    'X'
N01  c                   eval      KvalTxt = 'Y'
N01  c                   eval      MERKN='Varmegods'
N01  c     HEOT          wheneq    'SP'
N01  c                   eval      KvalTxt = 'Y'
N01  c                   eval      MERKN='Privatlevering'
N01  c     HEOT          wheneq    'PG'
N01  c                   eval      KvalTxt = 'Y'
N01  c                   eval      MERKN='Partigods'
N01  c                   endsl
N01  C                   ENDIF
N01
      * skipp pga filter på Levkvalitet ?
     c     LEVYN         ifne      ' '
     c     KVALTXT       andne     LEVYN
     c                   movel     'Y'           SKIPP
     c                   goto      UtSetRow
     C                   endif
     C                   callp     updHTMLvar('ANTDGR':
     C                             %trim(%editc(ANTDGR:'Z')))
     C                   callp     updHTMLvar('KVALTXT':KVALTXT)
     C                   callp     updHTMLvar('MERKN':MERKN)
     c                   select
     c     KVALTXT       wheneq    'Y'
     c                   add       1             AntOK             9 0
     c     KVALTXT       wheneq    'N'
     c                   add       1             AntFEIL           9 0
     c                   other
     c                   add       1             AntUdef           9 0
     c                   endsl
      *
     c                   move      *zeros        AntDgr            5 0
     c                   move      *blanks       POATxt           10
      * skipp pga filter på POD-archived kvalitet ?
     c     POAYN         ifne      ' '
     c     POATXT        andne     POAYN
     c                   movel     'Y'           SKIPP
     c                   goto      UtSetRow
     C                   endif
     C                   callp     updHTMLvar('POATXT':POATXT)
     c                   select
     c     POAtxt        wheneq    'Y'
     c                   add       1             AntOKA            9 0
     c     POAtxt        wheneq    'N'
     c                   add       1             AntFEILA          9 0
     c                   other
     c                   add       1             AntUdefA          9 0
     c                   endsl
      *
     C     UtSetRow      endsr
      *
      *=====================================================================******
      * Set html output skeleton member before its read into memory
      *=====================================================================******
     C     LoadHtml      begsr
     C                   eval      IfsMultIndicators = gethtmlifsmult(
S03  C*                            '/syspeddev/html/Header/eSpedTop.html -
N03  C                             '/syspeddev/html/Header/eSpedTop_10.html -
     C                             /syspeddev/html/SYOPTT1.html -
     C                             /syspeddev/html/Footer/eSpedBot.html':
     C                             '/CGITAG/')
      *
     C                   endsr
      *=====================================================================******
     C*  Select a Recd
      *=====================================================================******
     C     RecordSlt     BEGSR
     C                   move      'N'           selected          1
      *  Recd is selected
     C                   move      'Y'           selected
      *
     C                   ENDSR
      *
      ******************************************************
     c     IOTTSR        Begsr
      ******************************************************
     c                   movel     'N'           SKIPP             1
      * I/O T&T-event - I = Inkluder hvis en av de oppgitte stemmer(test kun hvis ulik blank)
     c     IOTT          Ifeq      'I'
     c     TT1           Ifne      *blanks
     C                   move      TT1           TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTok
     c                   endif
     c     TT2           Ifne      *blanks
     C                   move      TT2           TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTok
     c                   endif
     c     TT3           Ifne      *blanks
     C                   move      TT3           TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTok
     c                   endif
     c     TT4           Ifne      *blanks
     C                   move      TT4           TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTok
     c                   endif
     c     TT5           Ifne      *blanks
     C                   move      TT5           TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTok
     c                   endif
      * OGSÅ I/O T&T-event LINJE 2 = I - sjekk alle 10 før en beslutter om uthopp
     c     IOTTb         Ifeq      'I'
     c     TT1b          Ifne      *blanks
     C                   move      TT1b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTok
     c                   endif
     c     TT2b          Ifne      *blanks
     C                   move      TT2b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTok
     c                   endif
     c     TT3b          Ifne      *blanks
     C                   move      TT3b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTok
     c                   endif
     c     TT4b          Ifne      *blanks
     C                   move      TT4b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTok
     c                   endif
     c     TT5b          Ifne      *blanks
     C                   move      TT5b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTok
     c                   endif
     c                   endif
      ** ingen stemte - hopp over
     c                   movel     'Y'           SKIPP
     C                   goto      NextRecTT
     c     ITTok         tag
     c                   endif
      * I/O T&T-event LINJE 2 = I når den er ULIK linje 1
      * I/O T&T-event - I = Inkluder hvis en av de oppgitte stemmer(test kun hvis ulik blank)
     c     IOTTb         Ifeq      'I'
     c     IOTT          andne     'I'
     c     TT1b          Ifne      *blanks
     C                   move      TT1b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTokb
     c                   endif
     c     TT2b          Ifne      *blanks
     C                   move      TT2b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTokb
     c                   endif
     c     TT3b          Ifne      *blanks
     C                   move      TT3b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTokb
     c                   endif
     c     TT4b          Ifne      *blanks
     C                   move      TT4b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTokb
     c                   endif
     c     TT5b          Ifne      *blanks
     C                   move      TT5b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         cabeq     *off          ITTokb
     c                   endif
      ** ingen stemte - hopp over
     c                   movel     'Y'           SKIPP
     C                   goto      NextRecTT
     c     ITTokb        tag
     c                   endif
      *
      * I/O T&T-event - O = OVERSE hvis det stemmer med en av de oppgitte
     c     IOTT          Ifeq      'O'
     c     TT1           Ifne      *blanks
     C                   move      TT1           TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   movel     'Y'           SKIPP
     C                   goto      NextRecTT
     c                   endif
     c                   endif
     c     TT2           Ifne      *blanks
     C                   move      TT2           TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   movel     'Y'           SKIPP
     C                   goto      NextRecTT
     c                   endif
     c                   endif
     c     TT3           Ifne      *blanks
     C                   move      TT3           TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   movel     'Y'           SKIPP
     C                   goto      NextRecTT
     c                   endif
     c                   endif
     c     TT4           Ifne      *blanks
     C                   move      TT4           TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   movel     'Y'           SKIPP
     C                   goto      NextRecTT
     c                   endif
     c                   endif
     c     TT5           Ifne      *blanks
     C                   move      TT5           TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   movel     'Y'           SKIPP
     C                   goto      NextRecTT
     c                   endif
     c                   endif
      ** ingen av de oppgitte stemte - oppdraget skal IKKE hoppes over
     c                   endif
      *
      * I/O T&T-event - O = OVERSE hvis det stemmer med en av de oppgitte
     c     IOTTb         Ifeq      'O'
     c     TT1b          Ifne      *blanks
     C                   move      TT1b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   movel     'Y'           SKIPP
     C                   goto      NextRecTT
     c                   endif
     c                   endif
     c     TT2b          Ifne      *blanks
     C                   move      TT2b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   movel     'Y'           SKIPP
     C                   goto      NextRecTT
     c                   endif
     c                   endif
     c     TT3b          Ifne      *blanks
     C                   move      TT3b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   movel     'Y'           SKIPP
     C                   goto      NextRecTT
     c                   endif
     c                   endif
     c     TT4b          Ifne      *blanks
     C                   move      TT4b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   movel     'Y'           SKIPP
     C                   goto      NextRecTT
     c                   endif
     c                   endif
     c     TT5b          Ifne      *blanks
     C                   move      TT5b          TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   movel     'Y'           SKIPP
     C                   goto      NextRecTT
     c                   endif
     c                   endif
      ** ingen av de oppgitte stemte - oppdraget skal IKKE hoppes over
     c                   endif
     C     NextRecTT     endsr
      ***************************************************************************
     C     BerKval       begsr
      ***************************************************************************
      * legg dagnavn for framføringsdager ut i en streng..
     C                   Move      *blanks       AvDG             30
     C     1             DO        7             NR                1 0
     C     AV(NR)        IFGE      '1'
     C     AV(NR)        ANDLE     '7'
     C                   MOVE      AV(NR)        NN                1 0
     C                   CAT       DGN(NN):1     AVDG
     C                   END
     C                   END
      * Dato skannet inn = Avg.dato
     c                   z-add     TEIDAT        AvgDat            8 0
      * men ved levering etter xx.xx.xx legg til en dag
     c     TEIMAX        ifne      *zeros
     c     TEITIM        ifgt      TEIMAX
     C                   CALL      'SYGE20'
     C                   PARM      'ADD'         FUNK              3
     C                   PARM      AvgDat        innDat            8 0
     C                   PARM                    AvgDat            8 0
     C                   PARM      1             DAGER             5 0
     c                   eval      MERKN='Inn term. etter kl '
     c                             +%trim(%editw(TEIMAX4:'  :  '))
     c                   end
     c                   end
     c     AvgDat        setll     Kalender1
     c                   read      Kalender1                              33
     c     *in33         doweq     '0'
     c     KAUDG         scan      AvDG                                   33
     c     *IN33         cabeq     *On           AvgFunnet
     c                   read      Kalender1                              33
     c                   enddo
     c     AvgFunnet     tag
      * Avg.dato som hensyntar inn-klokkeslett/helligdager/avg.dag (ukedag) er funnet
     c                   read      Kalender1                              33
     c     *in33         doweq     '0'
     c                   add       1             AntDgr
     c     KADATE        cabge     PodDAT        PodFunnet
     c                   read      Kalender1                              33
     c                   enddo
     c     PodFunnet     tag
      *
     c*                  eval      KvalTxt = '1'
     c                   eval      KvalTxt = 'Y'
     c     AntDgr        ifgt      NOFRFT
     c*                  eval      KvalTxt = '0'
     c                   eval      KvalTxt = 'N'
     C                   end
      *
     C                   endsr
      ***************************************************************************
     C     BerKval2      begsr
      ***************************************************************************
      * Tid mellom POD og 091=POD Archived = Max 48 timer
      * KUN dersom begge finnes - hvis ikke er resultatet udefinert / blank
     c     PODDAT        ifeq      *zeros
     c     POADAT        oreq      *zeros
     c                   goto      UtKval2
     c                   endif
      * Dato POD=utg.pkt
     c                   z-add     PODDAT        AvgDat            8 0
     c     AvgDat        setll     Kalender1
     c                   read      Kalender1                              33
     c     *in33         doweq     '0'
     c                   add       1             AntDgr
     c     KADATE        cabge     POADAT        POAFunnet
     c                   read      Kalender1                              33
     c                   enddo
     c     PoAFunnet     tag
      *
     c                   eval      POAtxt = 'N'
     c                   select
     c     AntDgr        whenle    1
     c                   eval      POAtxt = 'Y'
     c     AntDgr        wheneq    2
     c     POATIM        ifle      PODTIM
     c                   eval      POAtxt = 'Y'
     c                   endif
     C                   endsl
      *
     C     UtKval2       endsr
      *
      ***************************************************************************
     C     GetDates      begsr
      ***************************************************************************
     c                   move      *zeros        TEIDAT            8 0
     c                   move      *zeros        OMXDAT            8 0
     c                   move      *zeros        TEUDAT            8 0
     c                   move      *zeros        VI1DAT            8 0
     c                   move      *zeros        VI2DAT            8 0
     c                   move      *zeros        PODDAT            8 0
     c                   move      *zeros        TEITIM            6 0
     c                   move      *zeros        OMXTIM            6 0
     c                   move      *zeros        TEUTIM            6 0
     c                   move      *zeros        VI1TIM            6 0
     c                   move      *zeros        VI2TIM            6 0
     c                   move      *zeros        PODTIM            6 0
     c                   move      *zeros        POADAT            8 0
     c                   move      *zeros        POATIM            6 0
      *
      * TEI
     C                   move      'TEI'         TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   move      TTDATE        TEIDAT
     c                   move      TTTIME        TEITIM
     c                   end
      *
      * OMX
      *    ...
      *
      * TEU
     C                   move      'TEU'         TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   move      TTDATE        TEUDAT
     c                   move      TTTIME        TEUTIM
     c                   end
      *
      * VIA1
     C                   move      'TE2'         TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   move      TTDATE        VI1DAT
     c                   move      TTTIME        VI1TIM
      * VIA2
     c     TrackKey      READE     TrackL02                               33
     c     *in33         ifeq      *off
     c                   move      TTDATE        VI2DAT
     c                   move      TTTIME        VI2TIM
     c                   end
     c                   end
      *
      *
      * POD
     C                   move      'POD'         TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   move      TTDATE        PODDAT
     c                   move      TTTIME        PODTIM
     c                   end
      * POD ARCHIVED
     C                   move      '091'         TTACTI
     c     TrackKey      Chain     TrackL02                           33
     c     *in33         ifeq      *off
     c                   move      TTDATE        POADAT
     c                   move      TTTIME        POATIM
     c                   end
      *
     c                   endsr
      *
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   OPEN      BRIDF
     C     WSUSER        CHAIN(N)  BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
      *
     C                   EXSR      TSTUSER
      *
      * hent Parametre som går igjen i mange prog:
      *      Odd/Even/Rowhead-farger,Logobilde,Språk,Intern/Ekstern bruker,  mm
     c                   call      'ESGETPAR'
     c                   parm                    BIBRID
     c                   parm                    BIFIRM
     c                   parm                    BIKUNR
     c                   parm                    BIKNG
     c                   parm                    RowHead          10
     c                   parm                    Odd              10
     c                   parm                    Even             10
     c                   parm                    LogoImg          50
     c                   parm                    XSPRÅK            2
     c                   parm                    XINTERN           1
     c                   parm                    ParmDS1        1024
     c                   parm                    ParmDS2        1024
     c                   parm                    ParmDS3        1024
      *
     C                   open      BRPARF                               50
     C                   OPEN      Cundl01
     C                   OPEN      head33
     C                   OPEN      head22
     C                   OPEN      headDT
     C                   OPEN      turer14
     C                   OPEN      trackl02
     C                   OPEN      NOPNR
     C                   OPEN      kalender1
     C                   OPEN      DOKUF
      *
     C     InnlKey       KLIST
     C                   KFLD                    ZZTERM            4 0
     C                   KFLD                    NOPONR
     C     TrackKey      KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    TTFBNR
     C                   KFLD                    TTACTI
     C     Hea33Key      KLIST
     C                   KFLD                    BIKUNR
     C                   KFLD                    FraDt8
     C     Hea22Key      KLIST
     C                   KFLD                    AVDN
     C                   KFLD                    FraDt8
     C     DokuKey       KLIST
     C                   KFLD                    DFRI
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   move      'F'           DFRI
     C     FORKEY        KLIST
     C                   KFLD                    HEPRO
     C                   KFLD                    HEKNA
     C                   if        (XINTERN = 'J')
     c     AVVKNN        ifne      *zeros
     C                   MOVE      AVVKNN        BIKUNR
     c                   else
     C                   MOVE      *Zeros        BIKUNR
     c                   end
     c                   end
     C     KunKey        KLIST
     C                   KFLD                    BIFIRM
     C                   KFLD                    BIKUNR
     C     BRPARFK       klist
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
      *
     C                   MOVEL     'LKTID'       PAID
     c                   Eval      PABRID = '*KUNDFT*'+BIFIRM
     c                   move      *zeros        TEIMAX            6 0
     C     BRPARFK       CHAIN     BRPARF                             33
     c  N33              z-add     PAVRDN        TEIMAX4           4 0
     c  N33              movel     TEIMAX4       TEIMAX
      *
     C     KunKey        CHAIN     Cundl01                            33
      *
     C* Kun agentgruppe..
     c     WSagGrKey     KLIST
     c                   KFLD                    BIFIRM
     c                   KFLD                    AGENTGN
     c                   clear                   AGG
     c                   clear                   AGN
     c     AGENTGN       Ifne      *zeros
     C                   sorta     AGG
     c                   endif
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
     C     TSTUSER       BEGSR
      *////////////////////////////////////////////////////////////
      /copy syspeds/qrpgsrcpy,tstuser
      *
     C                   endsr
      *
      *=====================================================================******
      *  AVSLUTT
      *=====================================================================******
     C     EXIT          begsr
     C                   close     BRPARF
     C                   close     BRIDF
     C                   CLOSE     cundl01
     C                   CLOSE     BRPARF
     C                   CLOSE     head33
     C                   CLOSE     head22
     C                   CLOSE     headDT
     C                   CLOSE     turer14
     C                   CLOSE     trackl02
     C                   CLOSE     NOPNR
     C                   CLOSE     kalender1
     C                   CLOSE     DOKUF
     C                   eval      *inlr = *on
      *
     C                   endsr
      *
