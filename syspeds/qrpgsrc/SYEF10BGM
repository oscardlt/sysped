      * RETTINGER I DETTE PROGRAM:
PTFnrF*Sek Sig Vers Beskrivelse...........................
"""""F*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
PXXXXF* 01 YBC PTF5 FLIGHTNR KAN BEGYNNE MED EN ALFA + EN SIFFER
P0501F* 02 SH  PTF5 NY RATELOGIKK
P0510F* 03 TR  PTF5 NY LOGIKK FOR FUEL SURCHARGE
PXXXXF* 04 SH  PTF5 FLIGHTNR KAN BEGYNNE MED EN NUMERISK
PXXXXF* 05 SH  PTF5 FAR STED I ANBEFALT ROUTING
PXXXXF* 06 SH  PTF5 FJERNET GAMMEL FRAKTBEREGNING  FELT: KOAPOS
PXXXXF* 07 SH  PTF4 SPØRRING PÅ FLYFRAKT RATER (NETTO)
PXXXXF* 08 SH  PTF4 OPPDATERER NETTOBELØP
PXXXXF* 09 SH  PTF4 LEGGER SUPERLABEL SOM STANDARD
PXXXXF* 10 SH  PTF4 RYDDER I PROGRAMMET ETTER TIDLIGERE LOGIKKENDRING
      *
      ***************************************************************
      *** PROGRAM SKAL VEDL./SPØRRE FLYFRAKTBREV (EKSPORT)        ***
      *** INDIKATOR 27 PÅ = SPØRRING                              ***
      *** INDIKATOR 27 AV = VEDLIKEHOLD                           ***
      ***********************************************************
     FTRACKF    O  A E           K DISK
     FDOKEF     UF A E           K DISK
     FDOKEQ     UF A E           K DISK
     FHEADF     IF   E           K DISK
     FKODTFR    IF   E           K DISK
     FKODTFFR   IF   E           K DISK
     FKODTFT    IF   E           K DISK
     FKODTAR    IF   E           K DISK
S06  F*ODTPB  IF  E           K        DISK
S06  F*ODTPF  IF  E           K        DISK
     FSAMLB     IF   E           K DISK
     FFIRM      IF   E           K DISK
     FLOCL01    IF   E           K DISK    USROPN
     FFFR01L    IF   E           K DISK    USROPN
     FFFA01L    IF   E           K DISK    USROPN
     FKODTA     IF   E           K DISK
     FAIRLDL1   IF   E           K DISK
     FISUL01    IF   E           K DISK    USROPN
     FLOGL05    IF   E           K DISK    USROPN
     FRATCDF    IF   E           K DISK
     FDIMM      UF A E           K DISK
     FKODTFS    IF   E           K DISK
N03  FKODTFC    IF   E           K DISK
     FKODTDIS   IF   E           K DISK
     FMCAWF     UF A E           K DISK
     FSYEF10FB  CF   E             WORKSTN
     F                                     INFDS(FBAREA)
S08  D*                   VG      1   6  6 0A
     D HØ              S              3  2 DIM(12)
     D LE              S              3  2 DIM(12)
     D BR              S              3  2 DIM(12)
     D AN              S              3  0 DIM(12)
S10  D*                   IA          6  5 2
S10  D*                   SA          6  5 2
S08  D*                   NE          6  5 2
S08  D*                   NK          6  1
     D NAV             S              3    DIM(12) CTDATA PERRCD(1)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  HESAML                 1      6
     D  YSD                    1      3
     D  XLNR                   4      6
     D                 DS
S08  D*                                       1  30 NE
S08  D*                                       1   52KPFFN
S08  D*                                       6  102KPFF45
S08  D*                                      11  152KPFF10
S08  D*                                      16  202KPFF30
S08  D*                                      21  252KPFF50
S08  D*                                      26  302KPFF1
S08  D*           DS
S08  D*                                       1   6 NK
S08  D*                                       1   1 KPFFK2
S08  D*                                       2   2 KPFFK3
S08  D*                                       3   3 KPFFK4
S08  D*                                       4   4 KPFFK5
S08  D*                                       5   5 KPFFK6
S08  D*                                       6   6 KPFFK7
S10  D*           DS
S10  D*                                       1  30 IA
S10  D*                                       1   52KPFIN
S10  D*                                       6  102KPFI45
S10  D*                                      11  152KPFI10
S10  D*                                      16  202KPFI30
S10  D*                                      21  252KPFI50
S10  D*                                      26  302KPFI1
S10  D*           DS
S10  D*                                       1  30 SA
S10  D*                                       1   52KPFSN
S10  D*                                       6  102KPFS45
S10  D*                                      11  152KPFS10
S10  D*                                      16  202KPFS30
S10  D*                                      21  252KPFS50
S10  D*                                      26  302KPFS1
     D                 DS
     D  XVS                    1     25
     D  XAN                    1      3  0
     D  XTG1                   4      4
     D  XLE                    5      7  0
     D  XTG2                   8      8
     D  XBR                    9     11  0
     D  XTG3                  12     12
     D  XHØ                   13     15  0
     D  XCM                   17     18
     D                 DS
     D  WSINFA                 1     71
     D  XINFA1                 1      2
     D  XINFA2                 3     71
     D                 DS
     D  KA                     1     24
     D                                     DIM(6)
     D  WSNT1                  1      4
     D  WSNT2                  5      8
     D  WSNT3                  9     12
     D  WSNT4                 13     16
     D  WSNT5                 17     20
     D  WSNT6                 21     24
     D                 DS
     D  KA1                    1     24
     D                                     DIM(6)
     D  DFNT1                  1      4
     D  DFNT2                  5      8
     D  DFNT3                  9     12
     D  DFNT4                 13     16
     D  DFNT5                 17     20
     D  DFNT6                 21     24
     D                 DS
     D  VE                     1     42  1
     D                                     DIM(6)
     D  WSVKT1                 1      7  1
     D  WSVKT2                 8     14  1
     D  WSVKT3                15     21  1
     D  WSVKT4                22     28  1
     D  WSVKT5                29     35  1
     D  WSVKT6                36     42  1
     D                 DS
     D  VE1                    1     42  1
     D                                     DIM(6)
     D  DFVKT1                 1      7  1
     D  DFVKT2                 8     14  1
     D  DFVKT3                15     21  1
     D  DFVKT4                22     28  1
     D  DFVKT5                29     35  1
     D  DFVKT6                36     42  1
     D                 DS
     D  RA                     1      6
     D                                     DIM(6)
     D  WSRC1                  1      1
     D  WSRC2                  2      2
     D  WSRC3                  3      3
     D  WSRC4                  4      4
     D  WSRC5                  5      5
     D  WSRC6                  6      6
     D                 DS
     D  RA1                    1      6
     D                                     DIM(6)
     D  DFRC1                  1      1
     D  DFRC2                  2      2
     D  DFRC3                  3      3
     D  DFRC4                  4      4
     D  DFRC5                  5      5
     D  DFRC6                  6      6
     D                 DS
     D  IT                     1     24
     D                                     DIM(6)
     D  WSCOM1                 1      4
     D  WSCOM2                 5      8
     D  WSCOM3                 9     12
     D  WSCOM4                13     16
     D  WSCOM5                17     20
     D  WSCOM6                21     24
     D                 DS
     D  IT1                    1     24
     D                                     DIM(6)
     D  DFCOM1                 1      4
     D  DFCOM2                 5      8
     D  DFCOM3                 9     12
     D  DFCOM4                13     16
     D  DFCOM5                17     20
     D  DFCOM6                21     24
     D                 DS
     D  FV                     1     42  1
     D                                     DIM(6)
     D  WSFBV1                 1      7  1
     D  WSFBV2                 8     14  1
     D  WSFBV3                15     21  1
     D  WSFBV4                22     28  1
     D  WSFBV5                29     35  1
     D  WSFBV6                36     42  1
     D                 DS
     D  FV1                    1     42  1
     D                                     DIM(6)
     D  DFFBV1                 1      7  1
     D  DFFBV2                 8     14  1
     D  DFFBV3                15     21  1
     D  DFFBV4                22     28  1
     D  DFFBV5                29     35  1
     D  DFFBV6                36     42  1
     D                 DS
     D  MI                     1      6
     D                                     DIM(6)
     D  WSRK1                  1      1
     D  WSRK2                  2      2
     D  WSRK3                  3      3
     D  WSRK4                  4      4
     D  WSRK5                  5      5
     D  WSRK6                  6      6
     D                 DS
     D  MI1                    1      6
     D                                     DIM(6)
     D  DFRK1                  1      1
     D  DFRK2                  2      2
     D  DFRK3                  3      3
     D  DFRK4                  4      4
     D  DFRK5                  5      5
     D  DFRK6                  6      6
     D                 DS
     D  PR                     1     48  2
     D                                     DIM(6)
     D  WSRPR1                 1      8  2
     D  WSRPR2                 9     16  2
     D  WSRPR3                17     24  2
     D  WSRPR4                25     32  2
     D  WSRPR5                33     40  2
     D  WSRPR6                41     48  2
     D                 DS
     D  PR1                    1     48  2
     D                                     DIM(6)
     D  DFRPR1                 1      8  2
     D  DFRPR2                 9     16  2
     D  DFRPR3                17     24  2
     D  DFRPR4                25     32  2
     D  DFRPR5                33     40  2
     D  DFRPR6                41     48  2
     D                 DS
     D  BE                     1     60  2
     D                                     DIM(6)
     D  WSBLT1                 1     10  2
     D  WSBLT2                11     20  2
     D  WSBLT3                21     30  2
     D  WSBLT4                31     40  2
     D  WSBLT5                41     50  2
     D  WSBLT6                51     60  2
     D                 DS
     D  BE1                    1     60  2
     D                                     DIM(6)
     D  DFBLT1                 1     10  2
     D  DFBLT2                11     20  2
     D  DFBLT3                21     30  2
     D  DFBLT4                31     40  2
     D  DFBLT5                41     50  2
     D  DFBLT6                51     60  2
     D                 DS
     D  VA                     1    250
     D                                     DIM(10)
     D  WSVS1                  1     25
     D  WSVS2                 26     50
     D  WSVS3                 51     75
     D  WSVS4                 76    100
     D  WSVS5                101    125
     D  WSVS6                126    150
     D  WSVS7                151    175
     D  WSVS8                176    200
     D  WSVS9                201    225
     D  WSVS10               226    250
     D                 DS
     D  VA1                    1    250
     D                                     DIM(10)
     D  DFVS1                  1     25
     D  DFVS2                 26     50
     D  DFVS3                 51     75
     D  DFVS4                 76    100
     D  DFVS5                101    125
     D  DFVS6                126    150
     D  DFVS7                151    175
     D  DFVS8                176    200
     D  DFVS9                201    225
     D  DFVS10               226    250
     D                 DS
     D  HESDF                  1      5
     D  WSSDF                  1      3
     D                 DS
     D  HESDT                  1      5
     D  WSSDT                  1      3
     D                 DS
     D  HEKNT                  1      8  0
     D  HEKNF                  6      8  0
     D                 DS
     D  M3TXT                  1     12
     D  M3FAS1                 1      3
     D  M3FAS2                 5      8
     D  M3FAS3                 9      9
     D  M3FAS4                10     12
     D                 DS
     D  WSGM12                 1     71
     D  MARKNO                 1      9
     D  HEGM1                 11     25
     D  HEGM2                 27     41
N03  D                 DS
N03  D  DSDAT                  1      8  0
N03  D  DSAAR                  1      4  0
N03  D  DSMND                  5      6  0
N03  D  DSDAG                  7      8  0
N03  D                 DS
N03  D  DSFUEL                 1      9
N03  D  DSF1                   1      1
N03  D  DSF2                   2      2
N03  D  DSF3                   3      3
N03  D  DSF4                   4      4
N03  D  DSF5                   5      5
N03  D  DSF6                   6      6
N03  D  DSF7                   7      7
N03  D  DSF8                   8      8
N03  D  DSF9                   9      9
N03  D  DSFHEL                 1      7
N03  D  DSFDES                 8      9
      *____________________________________________________________
      * Definisjon av parameterlisten som brukes ved kall av SM220R
      * (automatisk booking via linje). TdV IS må være installert
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     D                 DS
      * AUTTRM = '1' ---> automatisk sending uten å se ekstra bildet
      * AUTTRM = annet ---> visning av ekstra bildet med opplysninger
      * OBS. Finnes det syntax feil vises ekstra bildet uansett
     D  AUTTRM                 1      1
     D  AUTPID                 2     18
     D  AUTALN                19     21  0
     D  AUTAWB                22     29  0
     D  AUTORI                30     32
     D  AUTDES                33     35
     D  AUTSDC                36     36
     D  AUTNPI                37     40  0
     D  AUTWCD                41     41
     D  AUTWGH                42     50  1
     D  AUTTPI                51     54  0
     D  AUTMAN                55     69
     D  AUTPAR                70     72
     D  AUTPCD                73     89
     D  AUTPAI                90     92
     D  AUTOFD                93     94
     D  AUTCOD                95     96
     D  AUTRAI                97     99
      * First Flight Detail
     D  AUTCAR               100    101
     D  AUTFLN               102    106
     D  AUTDAY               107    108  0
     D  AUTMND               109    111
     D  AUTDEP               112    114
     D  AUTARR               115    117
     D  AUTSPC               118    119
     D  AUTAID               120    133
      * Second Flight Detail
     D  AU2CAR               134    135
     D  AU2FLN               136    140
     D  AU2DAY               141    142  0
     D  AU2MND               143    145
     D  AU2DEP               146    148
     D  AU2ARR               149    151
     D  AU2SPC               152    153
     D  AU2AID               154    167
     D  AU2                  134    167
      * Third Flight Detail
     D  AU3CAR               168    169
     D  AU3FLN               170    174
     D  AU3DAY               175    176  0
     D  AU3MND               177    179
     D  AU3DEP               180    182
     D  AU3ARR               183    185
     D  AU3SPC               186    187
     D  AU3AID               188    201
     D  AU3                  168    201
      * Special Handling codes (parameter values)
     D  AUSPE1               202    204
     D  AUSP11               202    202
     D  AUSP12               203    203
     D  AUSP13               204    204
     D  AUSPE2               205    207
     D  AUSP21               205    205
     D  AUSP22               206    206
     D  AUSP23               207    207
      * Future Dimensions Information
N12BB * Instead used to Volume
     D  AUDIM                208    240
N12BB * Volume and Volume Measurements
N12BBD  AUVOL                208    218
N12BBD  AUVOLM               219    220
      *
     D  AUTINF                 1    240
      *
     D                 DS
     D  WHØ                    1     55  0
     D                                     DIM(11)
     D  WHØ01                  1      5  0
     D  WHØ02                  6     10  0
     D  WHØ03                 11     15  0
     D  WHØ04                 16     20  0
     D  WHØ05                 21     25  0
     D  WHØ06                 26     30  0
     D  WHØ07                 31     35  0
     D  WHØ08                 36     40  0
     D  WHØ09                 41     45  0
     D  WHØ10                 46     50  0
     D  WHØ11                 51     55  0
     D                 DS
     D  WLE                    1     55  0
     D                                     DIM(11)
     D  WLE01                  1      5  0
     D  WLE02                  6     10  0
     D  WLE03                 11     15  0
     D  WLE04                 16     20  0
     D  WLE05                 21     25  0
     D  WLE06                 26     30  0
     D  WLE07                 31     35  0
     D  WLE08                 36     40  0
     D  WLE09                 41     45  0
     D  WLE10                 46     50  0
     D  WLE11                 51     55  0
     D                 DS
     D  WBR                    1     55  0
     D                                     DIM(11)
     D  WBR01                  1      5  0
     D  WBR02                  6     10  0
     D  WBR03                 11     15  0
     D  WBR04                 16     20  0
     D  WBR05                 21     25  0
     D  WBR06                 26     30  0
     D  WBR07                 31     35  0
     D  WBR08                 36     40  0
     D  WBR09                 41     45  0
     D  WBR10                 46     50  0
     D  WBR11                 51     55  0
     D                 DS
     D  WAN                    1     55  0
     D                                     DIM(11)
     D  WAN01                  1      5  0
     D  WAN02                  6     10  0
     D  WAN03                 11     15  0
     D  WAN04                 16     20  0
     D  WAN05                 21     25  0
     D  WAN06                 26     30  0
     D  WAN07                 31     35  0
     D  WAN08                 36     40  0
     D  WAN09                 41     45  0
     D  WAN10                 46     50  0
     D  WAN11                 51     55  0
     D                 DS
     D  HEGN                   1     15
     D  WHEGN3                 5      7
     D  WHEGN8                 8     15
     D                 DS
     D  WSROB1                 1      6
     D  WSRO21                 1      2
     D  WSRO41                 3      6
     D                 DS
     D  WSROB2                 1      6
     D  WSRO22                 1      2
     D  WSRO42                 3      6
     D                 DS
     D  WSROB3                 1      6
     D  WSRO23                 1      2
     D  WSRO43                 3      6
      *____________________________________________________________
      * Definisjon av parameterlisten som brukes ved kall av TDV51C
      * (Schedule Request). TdV IS må være installert
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     D                 DS
     D  BUTTRM                 1      1
     D  BUTAOR                 2      4
     D  BUTADE                 5      7
     D  BUTDA1                 8      9  0
     D  BUTMN1                10     12
     D  BUTPID                13     29
     D  BUTRA1                30     32
     D  BUTRB1                33     39
     D  BUTRC1                40     41  0
     D  BUTRA2                42     44
     D  BUTRB2                45     51
     D  BUTRC2                52     53  0
     D  BUTRA3                54     56
     D  BUTRB3                57     63
     D  BUTRC3                64     65  0
     D  BUTYKL                66     69  0
     D  BUTYAI                70     72
     D  BUTINF                 1     72
      *____________________________________________________________
      * Definition of the parameter CUTINF
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     D                 DS
     D  CUTTRM                 1      1
     D  CUTAOR                 2      4
     D  CUTADE                 5      7
     D  CUTDA1                 8      9
     D  CUTMN1                10     12
     D  CUTYE1                13     14
     D  CUTPID                15     31
     D  CUTINF                 1     31
     D                 DS
     D  WREF2                  1     12
     D  WREF2A                 1      3
     D  WREF2B                 4      4
     D  WREF2C                 5     12
     D                 DS
     D  FLIG                   1      6
     D  FAA                    1      1
     D  FAB                    2      2
     D  FBA                    3      3
     D  FBB                    4      4
     D  FBC                    5      5
     D  FCC                    6      6
     D                 DS
     D  WW112                  1     11  2
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     D                 DS            11
     D NUM             C                   CONST(' 0123456789')
     D LDADS          UDS
     D  DSTINF               801    872
      *___________________
      * DS for System Data
      *"""""""""""""""""""
     D                SDS
     D  WUSER                254    263
      *
     C                   EXSR      INIT
     C                   EXSR      UTCMDL
      *
     C     START         TAG
S07  C* N30                Z-ADD2         LINNBR
S07  C* N30                Z-ADD9         POSNBR
     C  N30
N07  CANN04              Z-ADD     2             LINNBR
     C  N30
N07  CANN04              Z-ADD     9             POSNBR
     C     WWWRK1        IFEQ      'A'
     C                   MOVE      'A'           WSRK1
     C                   ENDIF
N03  C     DFFUEL        IFEQ      0
N03  C                   EXSR      FSC
N03  C                   ENDIF
     C                   EXFMT     BILDE01
     C     FITDVI        IFEQ      'J'
     C     WDFCMN        ANDEQ     'J'
     C     HEGN          ANDNE     *BLANKS
     C     *IN27         ANDEQ     *OFF
     C     *IN03         IFEQ      *ON
     C     *IN05         OREQ      *ON
      * SJEKK OM AWB NUMMERET ER BOOKET VIA TDV IS.
     C                   MOVEL     'FFR'         WWMSID           17
     C                   MOVEL     WHEGN3        WREF2A
     C                   MOVEL     '-'           WREF2B
     C                   MOVEL     WHEGN8        WREF2C
     C     LOGKY         SETLL     LOGL05                                 90
     C     *IN90         IFEQ      *OFF                                         <IKKE FUNNET
     C                   EXSR      SFFR
     C                   ENDIF                                                  <*IN90
     C                   ENDIF                                                  <*IN03
     C                   ENDIF                                                  <FITDVI
     C                   MOVE      *BLANKS       WREF2
     C                   SETOFF                                       30
     C     *IN27         IFEQ      *OFF
     C     *IN03         IFEQ      *ON
     C     *IN05         OREQ      *ON
      * Tar vare på evt. endrede verdier
     C                   Z-ADD     MCMCFE        MCMCF2
     C                   Z-ADD     MCAWFE        MCAWF2
     C     HEADFK        CHAIN     MCAWF                              33
     C     *IN33         IFEQ      *ON
     C                   Z-ADD     HEAVD         MCAVD
     C                   Z-ADD     HEOPD         MCOPD
     C                   WRITE     MCAWR
     C                   ELSE
     C                   Z-ADD     MCMCF2        MCMCFE
     C                   Z-ADD     MCAWF2        MCAWFE
     C                   UPDATE    MCAWR
     C                   ENDIF                                                  <*IN33
     C                   ENDIF                                                  <*IN03
     C                   ENDIF                                                  <*IN27
     C   03              Z-ADD     3             UFLAGG
     C   03
     CAN 27              GOTO      SLUTT
N07   *
N07   * SHOWS AIRFREIGHT RATES (NETTO)
N07   *
N07  C   09              DO
N07  C                   MOVE      'F'           UMOD              1
N07  C                   CALL      'SYEF63R'
N07  C                   PARM      WSSDF         USDF              3
N07  C                   PARM      WSSDT         USDT              3
N07  C                   PARM                    WSFSN             3 0
N07  C                   PARM      HEKNS         UKN               8 0
N07  C                   PARM                    WSRC1             1
N07  C                   PARM                    WSCOM1            4
N07  C     WSFBV1        PARM      WSFBV1        UFBV              5 0
N07  C                   PARM                    WSRK1             1
N07  C     WSRPR1        PARM      WSRPR1        URATE            13 2
N07  C                   PARM                    UMOD
N07  C                   GOTO      START
N07  C                   END
      *
      * MORE INFORMATIONS
      *
     C   10              DO
     C                   EXFMT     BILDE02
     C  N12              EXSR      OPDDOQ
     C                   GOTO      START
     C                   END
      *
     C   12              Z-ADD     1             UFLAGG
     C   12              GOTO      SLUTT
      *
      * WORK WITH MAWB
      *
     C   14              DO
     C     YSD           IFNE      *BLANKS
     C                   CALL      'SYEF15'
     C                   PARM                    YSD
     C                   PARM                    XLNR
     C                   GOTO      START
     C                   END
     C                   END
     C     *IN19         IFEQ      '1'
     C     *IN20         OREQ      '1'
     C     *IN21         OREQ      '1'
     C     *IN22         OREQ      '1'
     C     *IN23         OREQ      '1'
     C     *IN18         OREQ      '1'
     C     FITDVI        IFNE      'J'
     C                   MOVEL     'BBA0035'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   GOTO      START
     C                   ENDIF
     C                   ENDIF
      *
      * KALL PÅ TDVIS RATE FORESPØRSEL
      *
     C     *IN19         IFEQ      '1'
     C                   EXSR      SFTR
     C                   GOTO      START
     C                   END
      *
      * SEND BOOKING VIA TDV IS
      *
     C     *IN20         IFEQ      '1'
     C     *IN21         OREQ      '1'
     C                   EXSR      SFFR
     C                   GOTO      START
     C                   END
      *
      * KALL PÅ TDVIS LOGGFUNKSJON (SM040C)
      *
     C     *IN22         IFEQ      '1'
     C                   EXSR      VLOG
     C                   GOTO      START
     C                   END
      *
      * KALL PÅ TDVIS SCHEDUEL REQUEST
      *
     C     *IN23         IFEQ      '1'
     C                   EXSR      SFIR
     C                   GOTO      START
     C                   END
      *
      * F24=FLERE TASTER
      *
     C     *IN24         IFEQ      '1'
     C                   EXSR      UTCMDL
     C                   GOTO      START
     C                   END
      *
      * GETS CURSORPOSITION
      *
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
      *_______________
      * Prompt Routing
      *"""""""""""""""
N07   *
N07   * SØKING  (ALLE SØKINGER ER FLYTTET TIL SUBRUTINE SØKDTA)
N07   *
N07  C     *IN04         IFEQ      '1'
N07  C                   EXSR      SØKDTA
N07  C     LINNBR        CABNE     9             START
N07  C                   END
      *
S07   * Prompt Routing
S07   *"""""""""""""""
S07  C*          *IN04     IFEQ '1'
S07  C*          LINNBR    ANDEQ6
S07  C*          POSNBR    ANDGE25
S07  C*          POSNBR    ANDLE73
S07  C*                    EXSR SRF4
S07  C*                    GOTO START
S07  C*                    END
S07   *
S07  C*          *IN04     IFEQ '1'
S07  C*          LINNBR    ANDEQ9
S07  C*                    Z-ADD1         PAREN   10
S07  C*                    CALL 'SYFA25'
S07  C*                    PARM           PAREN
S07  C*                    CALL 'SYFI10I'
S07  C*                    PARM           XINFA1
S07  C*          XINFA1    IFNE *BLANKS
S07  C*                    MOVE *BLANKS   XINFA2
S07  C*                    END
S07  C*                    END
S07   *
S07  C*          *IN04     IFEQ '1'
S07  C*          POSNBR    ANDEQ15
S07  C*          LINNBR    ANDGE13
S07  C*          POSNBR    ANDLE18
S07  C*                    EXSR SRF4RC
S07  C*                    GOTO START
S07  C*                    END
      *
     C                   EXSR      TESTB
     C   30
     CORN03
     CANN05
     CANN18              GOTO      START
      *
     C     *IN27         IFEQ      *OFF
     C                   EXSR      OPDDOK
     C                   ENDIF
     C   05              Z-ADD     5             UFLAGG
      *
      * KALL PÅ TDVIS POWER COMM AGENT OVERFØRING
      *
     C     *IN18         IFEQ      '1'
     C                   EXSR      SCOMM
     C                   GOTO      START
     C                   END
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
      ******************************************
     C     TESTB         BEGSR
      ******************************************
      *
      * TESTER BILDE NUMMER 1
      *
      * Hvis HWB og WSRK1=A --> utskrift av 'AS AGREED'
      * WSRK1=A bare tillatt for HWB
     C     WSRK1         IFEQ      'A'
     C     HEHAWB        ANDEQ     *ZEROS
     C                   SETON                                        30
     C                   MOVE      'BBA0111'     MSGNR
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     31            POSNBR
     C                   GOTO      SLFB
     C                   END
      * WSRK1=D bare tillatt for SINGEL
     C     WSRK1         IFEQ      'D'
     C     HEHAWB        ANDNE     *ZEROS
     C                   SETON                                        30
     C                   MOVE      'BBA0150'     MSGNR
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     31            POSNBR
     C                   GOTO      SLFB
     C                   END
      *
      * HVIS AS AGREAD LEGGER ' ' I WSRK1 I KEY RUBRIKK
      *
     C     WSRK1         IFEQ      'A'
     C                   MOVE      'A'           WWWRK1            1
     C                   MOVE      *BLANK        WSRK1
     C                   ELSE
     C                   MOVE      *BLANK        WWWRK1
     C                   END
     C                   MOVE      *ZEROS        WSBLT
     C                   MOVE      *ZEROS        WSNTT
     C                   MOVE      *ZEROS        WSVKTT
     C                   MOVE      *ZEROS        WSFTOT
      *
      * Sjekker om det finnes rater innlagt på gjeldende strekning.
S10  C*                    Z-ADDWSFSN     WSFLY
S10  C*          AIRRAT    SETLLAIRLDL1                  96
S10  C*          *IN96     IFEQ *OFF
S10   * Prøver så med flyselskap 0
S10  C*                    Z-ADD0         WSFLY
S10  C*          AIRRAT    SETLLAIRLDL1                  96
S10  C*                    ENDIF
S10  C*          *IN96     IFEQ *ON                        <RATE FUNNET
S10  C*          WWPR1     ANDEQPR,1
S10  C*          WWBE1     ANDEQBE,1
S10  C*          WWRA1     IFEQ 'B'
S10  C*          RA,1      ANDNE'B'
S10  C*          WSRK1     ORNE WWRK1
S10  C*          RA,1      OREQ 'B'
S10  C*          WWRA1     ANDNE'B'
S10  C*                    MOVE *BLANKS   IT,1
S10  C*                    Z-ADD0         PR,1
S10  C*                    Z-ADD0         BE,1
S10  C*                    Z-ADD2         XN      20
S02  C*          RA,1      IFNE 'B'
S02  C*                    MOVE *BLANKS   WSRK1
S02  C*                    ENDIF
S10  C*                    DO   5
S10  C*                    EXSR NULLVA
S10  C*                    ADD  1         XN
S10  C*                    ENDDO
S10  C*                    ENDIF
S10  C*                    ENDIF
      *
      * FYLLER WORKFELTER
      *
S10  C*                    MOVE RA,1      WWRA1   1
S10  C*                    MOVE WSRK1     WWRK1   1
S10  C*                    Z-ADDPR,1      WWPR1   82
S10  C*                    Z-ADDBE,1      WWBE1  102
     C                   Z-ADD     1             XN                2 0
     C     XN            DOWLE     6
     C                   EXSR      TESTVA
     C                   ADD       1             XN
     C   30              GOTO      SLFB
     C                   ENDDO                                                  <XN
      *
     C     XINFA2        IFEQ      *BLANKS
     C     XINFA1        IFNE      *BLANKS
     C                   Z-ADD     3             YLN               1 0
     C     KODFTK        CHAIN     KODTFT                             39
     C                   MOVE      *BLANKS       WSINFC
     C  N39              DO
     C                   MOVEL     KFTFTX        WSINFC
     C                   END
     C                   SUB       1             YLN
     C     KODFTK        CHAIN     KODTFT                             39
     C                   MOVE      *BLANKS       WSINFB
     C  N39              DO
     C                   MOVEL     KFTFTX        WSINFB
     C                   END
     C                   SUB       1             YLN
     C     KODFTK        CHAIN     KODTFT                             39
     C                   MOVE      *BLANKS       WSINFA
     C  N39              DO
     C                   MOVEL     KFTFTX        WSINFA
     C                   END
     C                   END
     C                   END
      *
      * TESTER OM SKAL HA MERKLAPPER
      *
     C     WSKDME        IFEQ      ' '
S09  C*                    MOVE 'N'       WSKDME
N09  C                   MOVE      'S'           WSKDME
     C                   END
      *
S06  C*                    Z-ADD1         XWW
N06  C                   Z-ADD     1             XWW               2 0
S06  C*                    Z-ADDWSFTOT    XVKTBR
N06  C                   Z-ADD     WSFTOT        XVKTBR            6 0
S08   *
S08   * KOMMENDE LINJER HADDE MED GAMMEL FIL Å GJØRE
S08   *
S08  C*          XVKTBR    LOKUPVG,XWW               39
S08  C*          NK,XWW    IFEQ 'N'
S08  C*          XVKTBR    MULT NE,XWW    WSNETB    H
S08  C*                    ELSE
S08  C*          100       SUB  NE,XWW    XWORK
S08  C*                    DIV  100       XWORK
S08  C*          WSBLT     MULT XWORK     WSNETB    H
S08  C*                    END
      *
     C                   MOVEA     '000'         *IN(92)
     C     WDFCMN        IFEQ      'J'
     C     WSROB1        IFEQ      *BLANKS
     C                   MOVE      *ON           *IN92
     C                   MOVE      *ON           *IN30
     C                   MOVE      'BBA0062'     MSGNR
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     25            POSNBR
     C                   ENDIF
     C     WSROA2        IFNE      *BLANKS
     C     WSROB2        ORNE      *BLANKS
     C     WSROC2        ORNE      *ZEROS
     C     WSROA2        IFEQ      *BLANKS
     C                   MOVE      *ON           *IN93
     C                   MOVE      *ON           *IN30
     C                   MOVE      'BBA0062'     MSGNR
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     43            POSNBR
     C                   ENDIF
     C                   ENDIF
     C     WSROA3        IFNE      *BLANKS
     C     WSROB3        ORNE      *BLANKS
     C     WSROC3        ORNE      *ZEROS
     C     WSROA3        IFEQ      *BLANKS
     C                   MOVE      *ON           *IN94
     C                   MOVE      *ON           *IN30
     C                   MOVE      'BBA0062'     MSGNR
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     61            POSNBR
     C                   ENDIF
     C                   ENDIF
     C     WSROB1        IFNE      *BLANKS
     C                   MOVEL     WSROB1        FLIG
     C                   Z-ADD     1             FLIGNR            1 0
     C                   EXSR      FLIGTS
     C                   ENDIF
     C     WSROB2        IFNE      *BLANKS
     C                   MOVEL     WSROB2        FLIG
     C                   Z-ADD     2             FLIGNR
     C                   EXSR      FLIGTS
     C                   ENDIF
     C     WSROB3        IFNE      *BLANKS
     C                   MOVEL     WSROB3        FLIG
     C                   Z-ADD     3             FLIGNR
     C                   EXSR      FLIGTS
     C                   ENDIF
     C                   ENDIF                                                  <WDFCMN
     C                   MOVE      UMSG          WSMSG
      *
     C     SLFB          ENDSR
      *
      ******************************************
     C     TESTVA        BEGSR
      ******************************************
      *
      * FLYTTER VEKT TIL FRAKTBEREGNINGSVEKT
      * IKKE VED RATECLASS X
      *
     C     FV(XN)        IFEQ      0
     C                   Z-ADD     VE(XN)        FV(XN)
     C                   END
      *
      * SJEKKER KUNDEAVTALER
      *
     C     BE(XN)        IFEQ      0
     C     PR(XN)        ANDEQ     0
     C     XN            ANDEQ     1
     C                   EXSR      TSTKU
     C                   END
      *
     C     STTV          TAG
     C                   MOVEL     KA(XN)        XKA               1
      *
      * TESTER VARELINJENE PÅ BILDET
      *
      * PRØVER Å TA UT NESTE LONJER DA IKKE B TASTES I RUBRUKK 1 LENGER
      *
S10  C*          XN        IFEQ 1
S10  C*          PR,XN     IFEQ 0
S06  C*          KOAPOS    ANDEQ'J'
S10  C*          RA,1      IFEQ 'B'
S10  C*                    MOVE WSFSN     WSFSNQ
S10  C*                    EXSR FINNRP
S10  C*          PR,XN     IFEQ *ZEROS
S10  C*          BE,XN     ANDEQ*ZEROS
S10  C*                    MOVE *ZEROS    WSFSNQ
S10  C*                    EXSR FINNRP
S10  C*                    END
S10  C* N34                GOTO STTV2
S10  C*                    END
S10  C*                    END
S10  C*                    ENDIF
      *
      * SKJEKKER AT RATEKLASSE FINNES I FIL
      *
     C     RA(XN)        IFNE      *BLANKS
     C     RA(XN)        SETLL     RATCDF                                 90
     C     *IN90         IFEQ      *OFF                                         <IKKE FUNNET
     C                   MOVE      *ON           *IN30
     C                   MOVE      'BBA0098'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   END
     C                   END
      *
      *   --------------------------------------------------
      *
      * FINNER RATER HVIS IKKE NOEN KODE ER TASTET
      *
      * KUN VED LINJE 1  KODENE M Q N
      *
     C     PR(XN)        IFEQ      0                                             2<-B
S06  C*          KOAPOS    ANDEQ'J'
S02  C*          WSRK1     ANDEQ' '
     C     XN            ANDEQ     1
     C     RA(XN)        IFEQ      'M'                                            3<-B
     C     RA(XN)        OREQ      'Q'
     C     RA(XN)        OREQ      'N'
     C     RA(XN)        OREQ      ' '
     C                   MOVE      WSFSN         WSFSNQ
     C                   EXSR      FINNRP
      *
      * HVIS IKKE FUNNET PRØVER FLYSELSKAP 0
      *
     C     PR(XN)        IFEQ      *ZEROS
     C     BE(XN)        ANDEQ     *ZEROS
     C                   MOVE      *ZEROS        WSFSNQ
     C                   EXSR      FINNRP
     C                   END
     C  N34              GOTO      STTV2
     C                   END                                                      3<-E
     C                   END                                                     2<-E
      * Bruker gammelt ratesystem hvis ikke funnet noe på det nye.
S06  C*          PR,1      IFEQ 0
S06  C*          BE,1      ANDEQ0
S06  C*          RA,1      ANDNE'B'
S06  C*                    EXSR PFSR
S06  C*                    END
      *
      * Regner ut totalen på hver enkelt ratelinje
      *
     C     PR(XN)        IFGT      0
     C     FV(XN)        ANDGT     0
     C     BE(XN)        ANDEQ     *ZEROS
     C     RA(XN)        IFEQ      'N'
     C     RA(XN)        OREQ      'Q'
     C     RA(XN)        OREQ      'K'
     C     RA(XN)        OREQ      'C'
     C     FV(XN)        MULT      PR(XN)        XWORK
     C                   Z-ADD(H)  XWORK         BE(XN)
     C                   ENDIF
      *
      * B TATT UT   MINIMUMSLOGIKK
      *
S10  C*          RA,XN     IFEQ 'B'
S10  C*          RA,XN     OREQ 'M'
N10  C     RA(XN)        IFEQ      'M'
     C                   Z-ADD     PR(XN)        XWORK
     C                   Z-ADD(H)  XWORK         BE(XN)
     C                   ENDIF
      *
      * SPESIAL VED R S
      *
     C     RA(XN)        IFEQ      'R'
     C     RA(XN)        OREQ      'S'
     C     FV(XN)        MULT      PR(XN)        XWORK
     C                   Z-ADD(H)  XWORK         BE(XN)
      *
      * SPESIAL VED X E U Y
      *
     C                   ENDIF
     C     RA(XN)        IFEQ      'X'
     C     RA(XN)        OREQ      'E'
     C     RA(XN)        OREQ      'U'
     C     RA(XN)        OREQ      'Y'
     C                   Z-ADD     BE(XN)        XWORK
     C                   ENDIF
     C                   ELSE
     C                   Z-ADD     BE(XN)        XWORK
     C                   ENDIF
     C     WSVAL         COMP      FICURR                                 36
     C   36FIDECI        IFEQ      0
     C     XWORK         ADD       0.50          BE(XN)
     C                   MOVE      '00'          BE(XN)
     C                   ELSE
     C     FIDECI        IFEQ      1
     C     XWORK         ADD       0.05          BE(XN)
     C                   MOVE      '0'           BE(XN)
     C                   END
     C                   END
      *
      *   --------------------------------------------------
      * HVIS HAWB OG RATE CODE = A (AGREEMENT) HOPPES DET OVER
      * RESTEN AV TESTENE
      * RATE COMBINATION POINT OG TEKSTLINJER ER SPESIELLE LINJER SOM
      * ER LOVLIGE PÅ LINJENE 2 -6 SJEKKES HER. ER DET EN AV DISSE TO
      * TYPER LINJER HOPPES DET OVER RESTEN AV DISSE TESTENE.
     C     XN            IFGT      1
     C     KA(XN)        IFEQ      *BLANKS
     C     VE(XN)        ANDEQ     *ZEROS
     C     RA(XN)        ANDEQ     *BLANKS
     C     FV(XN)        ANDEQ     *ZEROS
     C     PR(XN)        ANDEQ     *ZEROS
     C     BE(XN)        ANDEQ     *ZEROS
     C     VA(XN)        ANDNE     *BLANKS
     C                   GOTO      STTV2
     C                   ENDIF
     C     KA(XN)        IFNE      *BLANKS
     C     NUM           CHECK     KA(XN)        NUMCHK            1 0
     C     NUMCHK        IFGT      0
      * Da er det IKKE bare tall og blanke i dette feltet.
      * Hvis gross weight er null skal dette tolkes som
      * Rate Combination Point linje.
     C     VE(XN)        IFEQ      0
     C                   GOTO      STTV2
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      * Alle andre typer skal ha med rate class code.
     C     KA(XN)        IFNE      *BLANKS
     C     VE(XN)        ORNE      *ZEROS
     C     IT(XN)        ORNE      *BLANKS
     C     FV(XN)        ORNE      *ZEROS
     C     PR(XN)        ORNE      *ZEROS
     C     BE(XN)        ORNE      *ZEROS
     C     RA(XN)        SETLL     RATCDF                                 90
     C     *IN90         IFEQ      *OFF                                         <IKKE FUNNET
     C                   SETON                                        30
     C                   MOVE      'BBA0106'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF
      * TESTER INNHOLDET AV RATELINJE 1. DET ER SPESIELLE REGLER FOR
      * DENNE LINJEN.
     C     XN            IFEQ      1
     C     RA(XN)        IFEQ      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'DIV1127'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   END
      * FØRSTE RATELINJE MÅ VÆRE EN AV DISSE
     C     RA(XN)        IFNE      'M'
     C     RA(XN)        ANDNE     'N'
     C     RA(XN)        ANDNE     'Q'
     C     RA(XN)        ANDNE     'B'
     C     RA(XN)        ANDNE     'C'
     C     RA(XN)        ANDNE     'R'
     C     RA(XN)        ANDNE     'S'
     C     RA(XN)        ANDNE     'U'
     C                   SETON                                        30
     C                   MOVE      'BBA0099'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   END
     C     RA(XN)        IFEQ      'M'
     C     RA(XN)        OREQ      'N'
     C     RA(XN)        OREQ      'Q'
     C     RA(XN)        OREQ      'B'
     C     KA(XN)        IFEQ      *BLANKS
     C     VE(XN)        OREQ      *ZEROS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C     VA(XN)        OREQ      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0100'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C     IT(XN)        IFNE      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0101'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
     C     RA(XN)        IFEQ      'C'
     C     KA(XN)        IFEQ      *BLANKS
     C     VE(XN)        OREQ      *ZEROS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C     VA(XN)        OREQ      *BLANKS
     C     IT(XN)        OREQ      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0102'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
     C     RA(XN)        IFEQ      'U'
     C     KA(XN)        IFEQ      *BLANKS
     C     VE(XN)        OREQ      *ZEROS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C     VA(XN)        OREQ      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0100'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
     C                   ENDIF                                                  <XN
      * GENERELLE TESTER FOR RATELINJENE 1 - 6.
     C     RA(XN)        IFEQ      'N'
     C     RA(XN)        OREQ      'Q'
     C     VE(XN)        IFEQ      *ZEROS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C                   SETON                                        30
     C                   MOVE      'BBA0109'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C     IT(XN)        IFNE      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0101'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
     C     RA(XN)        IFEQ      'M'
     C     RA(XN)        OREQ      'C'
     C     RA(XN)        OREQ      'U'
     C     VE(XN)        IFEQ      *ZEROS
     C     KA(XN)        OREQ      *BLANKS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C                   SETON                                        30
     C                   MOVE      'BBA0100'     MSGNR
     C     RA(XN)        IFEQ      'C'
     C                   MOVE      'BBA0102'     MSGNR
     C                   ENDIF
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C     RA(XN)        IFEQ      'M'
     C     IT(XN)        ANDNE     *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0101'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C     RA(XN)        IFEQ      'C'
     C     IT(XN)        ANDEQ     *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0107'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
     C     RA(XN)        IFEQ      'B'
     C     VE(XN)        IFEQ      *ZEROS
     C     KA(XN)        OREQ      *BLANKS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C     VA(XN)        OREQ      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0100'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C     IT(XN)        IFNE      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0101'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
     C     RA(1)         IFEQ      'B'
     C     RA(2)         ANDNE     'K'
     C                   SETON                                        30
     C                   MOVE      'BBA0108'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C     RA(XN)        IFEQ      'K'
     C     RA(XN)        OREQ      'E'
     C     VE(XN)        IFNE      *ZEROS
     C     KA(XN)        ORNE      *BLANKS
     C     IT(XN)        ORNE      *BLANKS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C                   SETON                                        30
     C                   MOVE      'BBA0103'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
     C     RA(XN)        IFEQ      'X'
     C     VA(XN)        IFEQ      *BLANKS
     C     KA(XN)        ORNE      *BLANKS
     C     PR(XN)        ORNE      *ZEROS
     C     BE(XN)        ORNE      *ZEROS
     C                   SETON                                        30
     C                   MOVE      'BBA0104'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
     C     RA(XN)        IFEQ      'Y'
     C     FV(XN)        IFEQ      *ZEROS
     C     KA(XN)        ORNE      *BLANKS
     C     VE(XN)        ORNE      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C     IT(XN)        ORNE      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0105'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
      *
     C     STTV2         TAG
     C                   ADD       BE(XN)        WSBLT
     C     XKA           IFNE      'R'
     C     NUM           CHECK     KA(XN)        NUMCHK
     C     NUMCHK        IFEQ      0
     C                   MOVE      KA(XN)        XKAKA             4 0
     C                   ADD       XKAKA         WSNTT
     C                   ENDIF
     C                   END
      *
     C                   ADD       VE(XN)        WSVKTT
     C                   ADD       FV(XN)        WSFTOT
      *
     C     SLTV          ENDSR
      *
      ******************************************
S10  C*          NULLVA    BEGSR
      ******************************************
      *
      * BLANKER UT VARELINJENE
      *
S10  C*                    MOVE *ZEROS    VE,XN
S10  C*                    MOVE *BLANKS   RA,XN
S10  C*                    MOVE *ZEROS    FV,XN
S10  C*                    MOVE *ZEROS    PR,XN
S10  C*                    MOVE *ZEROS    BE,XN
S10  C*                    MOVE *BLANKS   IT,XN
S10  C*                    MOVE *BLANKS   MI,XN
      *
S10  C*                    ENDSR
      *
      ******************************************
S06  C*          PFSR      BEGSR
      ******************************************
S06  C*                    MOVE WSFSN     YFSN    30
S06  C*          KODPFK    CHAINKODTPF               34
      *
S06  C*  34                DO
      * SJEKKER DERETTER OM PRIS ER INNE PÅ 000
S06  C*                    MOVE *ZEROS    YFSN
S06  C*          KODPFK    CHAINKODTPF               34
S06  C*                    END
S06  C*  34                GOTO SLPF
      *
S06  C*                    Z-ADD1         XWW     20
S06  C*                    Z-ADDFV,XN     XVKTBR  60H
S06  C*          XVKTBR    LOKUPVG,XWW               34  34
S06  C*          XWW       ADD  1         XWX     20
S06  C*                    MOVE XWX       XWX2    20
      *
S06  C*          XWW       IFLT 2
S06  C*                    MOVE 'N'       RA,XN
S06  C*                    ELSE
S06  C*                    MOVE 'Q'       RA,XN
S06  C*                    END
      *
S06  C*          XWX       IFGT 6
S06  C*                    Z-ADD6         XWX
S06  C*                    END
S06  C*          HEHAWB    IFEQ *ZEROS
S06  C*                    Z-ADDIA,XWW    PR,XN
S06  C*                    Z-ADDIA,XWX    XPRNES  82
S06  C*                    Z-ADDKPFIM     XPFMIN  50
S06  C*                    ELSE
S06  C*                    Z-ADDSA,XWW    PR,XN
S06  C*                    Z-ADDSA,XWX    XPRNES
S06  C*                    Z-ADDKPFSM     XPFMIN
S06  C*                    END
S06  C*                    Z-ADDFV,XN     XVKTBR    H
S06  C*          XVKTBR    MULT PR,XN     XPFMI2  50H
S06  C*
      * SJEKKER PRIS I NESTE VEKTGRUPPE
      *
S06  C*          XWX2      IFLT 7
S06  C*          VG,XWW    ADD  1         XVENES  71
S06  C*          XVENES    MULT XPRNES    XPFMA2  50H
S06  C*          XPFMA2    IFLT XPFMI2
S06  C*                    MOVE 'Q'       RA,XN
S06  C*                    Z-ADDXPRNES    PR,XN
S06  C*                    Z-ADDXVENES    FV,XN
S06  C*                    END
S06  C*                    END
      *
S06  C*          XPFMI2    IFLT XPFMIN
S06  C*                    Z-ADDXPFMIN    BE,XN
S06  C*                    MOVE 'M'       RA,XN
S06  C*                    MOVE *ZEROS    PR,XN
S06  C*                    Z-ADDBE,XN     PR,XN
S06  C*                    END
      *
S06  C*          SLPF      ENDSR
      *
      ******************************************
     C     FINNRP        BEGSR
      ******************************************
      * Sjekker først om Priority eller B + K skal hentes fra
      * gammelt ratesystem.
S06  C*          *IN32     IFEQ *OFF                       <GAMMELT FINNS
S06  C*          *IN96     ANDEQ*OFF                       <IKKE NYTT
S06  C*          BE,1      IFEQ 0
S06  C*          PR,1      ANDEQ0
S06  C*          RA,1      ANDEQ'B'
S02  C*          WSRK1     IFEQ 'P'
S02  C*          WSRK1     OREQ 'D'
S06  C*          WSRK1     IFEQ 'D'
      * PRIORITY RATE
S06  C*                    Z-ADDKPBBPR    PR,1
S06  C*                    Z-ADDKPBBPR    BE,1
S06  C*                    MOVE 'K'       RA,2
S06  C*                    Z-ADDKPBRPR    PR,2
S06  C*                    Z-ADDFV,1      FV,2
S06  C*          KPBRPR    MULT FV,2      XWORK
S06  C*                    Z-ADDXWORK     BE,2
S06  C*                    ELSE
      * B+K RATE
S06  C*                    Z-ADDKPBBAN    PR,1
S06  C*                    Z-ADDKPBBAN    BE,1
S06  C*                    MOVE 'K'       RA,2
S06  C*                    Z-ADDKPBRAN    PR,2
S06  C*                    Z-ADDFV,1      FV,2
S06  C*          KPBRAN    MULT FV,2      XWORK
S06  C*                    Z-ADDXWORK     BE,2
S06  C*                    ENDIF                           <WSRK1
S06  C*                    ENDIF                           <BE,1
S06  C*                    ENDIF                           <*IN32
      *
      * VED B/P I RATE HENTES BASIC/PRIORITY-PRIS
      * KODEN GÅR TIL NØKKELBEGREP
      * HVIS IKKE GÅR RC TIL NØKKELBEGREP
      * YRCOD ER FELTET I KEYBEGREPET
      * DETTE SKAL KUNNE VÆRE Q M N
      *
     C                   MOVE      RA(1)         YRCOD             1
S02  C*          WSRK1     IFEQ 'P'
S02  C*          WSRK1     OREQ 'D'
S10  C*          WSRK1     IFEQ 'D'
S10  C*                    MOVE 'P'       YRCOD   1
S10  C*                    ENDIF
      * NORMALT GÅR FRAKTBEREGNINGSVEKT INN I NØKKELBEGREP
      * VED B/P I RATE LIGGER PRIS PÅ 99999 KILO
     C                   Z-ADD(H)  FV(XN)        YRWEI
S10  C*          YRCOD     IFEQ 'B'
S10  C*          YRCOD     OREQ 'P'
S10  C*                    Z-ADD99999     YRWEI
S10  C*                    END
      *
     C     STFIRP        TAG
     C     AIRL1K        SETLL     AIRLDL1                            34
     C     STFIR2        TAG
     C     AIR1K1        READE     AIRLDL1                                34
      *
      * GJELDER HAWB VED SAMLAST
      *
      * AIRCOD KAN KUN VÆRE N Q K
      *
S10  C*          *IN41     IFEQ *ON
S10  C*          *IN34     ANDEQ*OFF
S10  C*          AIRCOD    IFEQ 'B'
S10  C*          AIRCOD    OREQ 'P'
S10  C*                    GOTO STFIR2
S10  C*                    ENDIF
S10  C*                    ENDIF
     C  N34
     CAN 41              Z-ADD     AIRHAW        AIRAWB
     C  N34
     CAN 41              Z-ADD     AIRHAM        AIRGRN
      *
      * VED B/P MÅ SAMME KODE VÆRE FUNNET I PRISTABELL
      *
S10  C* N34      YRCOD     IFEQ 'B'
S10  C*          YRCOD     OREQ 'P'
S10  C*          YRCOD     IFNE AIRCOD
S10  C*          XN        IFEQ 1
S10  C*                    MOVE *BLANK    RA,2
S10  C*                    ENDIF
S10  C*                    GOTO STFIR2
S10  C*                    END
S10  C*                    END
      *
      * VED N/Q MÅ SAMME KODE VÆRE FUNNET I PRISTABELL
      * LES NESTE HVIS IKKE KLASSE N OG Q SAMSVARER
      *
     C  N34YRCOD         IFEQ      'N'
     C     YRCOD         OREQ      'Q'
     C     AIRCOD        IFNE      'N'
     C     AIRCOD        ANDNE     'Q'
     C                   GOTO      STFIR2
     C                   END
     C                   END
      *
      * VED KODE M BENYTTES MINIMUMSPRIS UANSETT
      *
     C  N34YRCOD         IFEQ      'M'                                          1<-B
     C                   MOVE      *ZEROS        PR(XN)
     C                   Z-ADD(H)  AIRGRN        BE(XN)
     C                   MOVE      'M'           RA(XN)
     C                   Z-ADD     AIRGRN        PR(XN)
     C                   GOTO      UTFRA
     C                   ELSE                                                   1
      *
      * ELLERS BENYTTES FUNNET KILOPRIS
      *
S10  C*          YRCOD     IFEQ 'B'
S10  C*          AIRCOD    ANDEQ'B'
S10  C*          YRCOD     OREQ 'P'
S10  C*          AIRCOD    ANDEQ'P'
S10  C*                    Z-ADDAIRAWB    PR,2
S10  C*                    ELSE
     C     YRCOD         IFEQ      'N'
     C     YRCOD         OREQ      'Q'
     C     YRCOD         OREQ      *BLANK
     C     AIRCOD        IFEQ      'N'
     C     AIRCOD        OREQ      'Q'
     C                   Z-ADD     AIRAWB        PR(1)
     C                   MOVE      AIRCOD        RA(1)
     C                   ENDIF
     C                   ENDIF
S10  C*                    ENDIF
     C     AIRAWB        MULT      FV(XN)        XWORK
S02  C*                    DIV  AIRPRP    XWORK     H
      *
      * VED B/P PLUSSES PÅ GRUNNLAG
      *
S10  C*          YRCOD     IFEQ ' '
S10  C*          AIRCOD    IFEQ 'B'
S10  C*          AIRCOD    OREQ 'P'
S10  C*                    MOVE AIRCOD    YRCOD
S10  C*          AIRCOD    IFEQ 'P'
S10  C*                    MOVE 'P'       MI,1
S10  C*                    ENDIF
S10  C*                    END
S10  C*                    END
      *
S10  C*          YRCOD     IFEQ 'P'                         2<-B
S10  C*          YRCOD     OREQ 'B'
S10  C*                    Z-ADDXWORK     BE,2      H
S10  C*                    Z-ADDAIRGRN    BE,1      H
S10  C*                    Z-ADDAIRGRN    PR,1      H
S10  C*                    Z-ADDFV,1      FV,2
S10  C*                    MOVE 'K'       RA,2
S10  C*                    MOVE 'B'       RA,1
S10  C*                    Z-ADDAIRAWB    PR,2
S10  C*          XWORK     ADD  AIRGRN    ÆBELØP 132H
S10  C*                    ELSE                             2
      *
      * SJEKKES OM MINDRE ENN MINIMUMSPRIS
      *
     C     XN            IFEQ      1
     C     YRCOD         IFEQ      *BLANK
     C     YRCOD         OREQ      'N'
     C     YRCOD         OREQ      'Q'
     C     AIRCOD        IFEQ      'N'
     C     AIRCOD        OREQ      'Q'
     C     XWORK         IFLT      AIRGRN                                         3<-B
     C                   Z-ADD(H)  AIRGRN        BE(XN)
     C                   MOVE      'M'           RA(XN)
     C                   Z-ADD(H)  AIRGRN        PR(XN)
     C                   GOTO      UTFRA
     C                   ELSE                                                     3
     C     YRCOD         IFEQ      ' '                                             4<-B
     C                   MOVE      AIRCOD        RA(XN)
     C                   END                                                       4<-E
     C                   Z-ADD(H)  XWORK         BE(XN)
     C                   Z-ADD(H)  XWORK         ÆBELØP           13 2
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END
     C                   END
S10  C*                    END
      *
      * HVIS IKKE VEKTGRUPPE ER 99999  SJEKKER PRIS I NESTE VEKTINT
      *
     C     AIRWEI        IFNE      99999                                         2<-B
     C     AIRWEI        ADD       1             YRWEI
S10  C*          LESQ      TAG
     C     AIR1K1        READE     AIRLDL1                                34
     C     *IN34         IFEQ      *OFF
S10  C*          AIRCOD    IFEQ 'B'
S10  C*          AIRCOD    OREQ 'P'
S10  C*                    GOTO LESQ
S10  C*                    ENDIF
     C                   ENDIF
      * GJELDER HAWB
     C  N34
     CAN 41              Z-ADD     AIRHAW        AIRAWB
     C  N34
     CAN 41              Z-ADD     AIRHAM        AIRGRN
     C  N34AIRCOD        IFNE      'M'                                            3<-B
     C     AIRAWB        MULT      YRWEI         XWORK
S02  C*                    DIV  AIRPRP    XWORK     H
S10  C*          YRCOD     IFEQ 'P'                           4<-B
S10  C*          YRCOD     OREQ 'B'
S10  C*          XWORK     ADD  AIRGRN    XBELØP 132H
S10  C*                    ELSE                               4
     C     XWORK         IFLT      AIRGRN                                           5<-B
     C                   Z-ADD(H)  AIRGRN        XBELØP           13 2
     C                   ELSE                                                       5
     C                   Z-ADD(H)  XWORK         XBELØP
     C                   END                                                        5<-E
S10  C*                    END                                4<-E
     C     XBELØP        IFLT      ÆBELØP                                          4<-B
     C                   MOVE      AIRCOD        RA(1)
     C     XN            IFEQ      1
     C                   Z-ADD     YRWEI         FV(XN)
     C                   Z-ADD     XBELØP        BE(XN)
     C                   Z-ADD     AIRAWB        PR(XN)
     C                   ENDIF
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C     WSVAL         COMP      FICURR                                 34
     C   34FIDECI        IFEQ      0                                             2<-B
     C                   ADD       0.50          BE(XN)
     C                   MOVE      '00'          BE(XN)
     C                   ELSE                                                    2
     C     FIDECI        IFEQ      1                                              3<-B
     C                   ADD       0.05          BE(XN)
     C                   MOVE      '0'           BE(XN)
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   SETOFF                                       34
     C                   END                                                    1<-E
      *
     C     UTFRA         ENDSR
      *
      ***********************************************
     C     MOVDFW        BEGSR
      ***********************************************
     C     HEGN          IFEQ      *ZEROS
     C     HEGN          OREQ      *BLANKS
     C                   MOVE      *ZEROS        WSFSN
     C                   ELSE
     C                   MOVEL     WHEGN3        WSFSN
     C                   END
      *
     C                   MOVE      KFRCP         WSCCPP
     C  N33              DO
     C                   MOVE      DFTLFS        WSTLFS
     C                   MOVE      DFTLFK        WSTLFK
     C                   MOVE      DFINF1        WSINF1
     C                   MOVE      DFINF2        WSINF2
     C                   MOVE      DFROA1        WSROA1
     C                   MOVE      DFROB1        WSROB1
     C                   MOVE      DFROC1        WSROC1
     C                   MOVE      DFROA2        WSROA2
     C                   MOVE      DFROB2        WSROB2
     C                   MOVE      DFROC2        WSROC2
     C                   MOVE      DFROA3        WSROA3
     C                   MOVE      DFROB3        WSROB3
     C                   MOVE      DFROC3        WSROC3
     C                   MOVE      DFVAL         WSVAL
     C                   MOVE      DFDVCA        WSDVCA
     C                   MOVE      DFDVCU        WSDVCU
     C                   MOVE      DFBELF        WSBELF
     C                   MOVE      DFINFA        WSINFA
     C                   MOVE      DFINFB        WSINFB
     C                   MOVEL     DFINFC        WSINFC
     C                   MOVE      KA1           KA
     C                   MOVE      VE1           VE
     C                   MOVE      RA1           RA
     C                   MOVE      IT1           IT
     C                   MOVE      FV1           FV
     C                   MOVE      MI1           MI
     C                   MOVE      PR1           PR
     C                   MOVE      BE1           BE
     C                   MOVE      VA1           VA
     C                   MOVE      DFNTT         WSNTT
     C                   MOVE      DFVKTT        WSVKTT
     C                   MOVE      DFBLT         WSBLT
N08  C                   MOVE      DFNETT        WSNETB
     C                   MOVE      DFKDDC        WSKDDC
     C                   MOVE      DFBLDC        WSBLDC
     C                   MOVE      DFBLA         WSBLA
     C                   MOVE      DFKDME        WSKDME
     C                   MOVE      DFBLAV        WSBLAV
     C                   MOVE      DFFT          WSFT
N03  C                   MOVE      DFFUEL        WSFUEL
     C                   MOVE      UMSG          WSMSG
     C                   MOVE      DFCMN         WDFCMN
     C     HEHAWB        IFEQ      *ZEROS
     C                   MOVE      'J'           WDFCMN
     C                   ELSE
     C                   MOVE      'N'           WDFCMN
     C                   ENDIF
S10  C*                    MOVE DFRC1     WWRA1
S10  C*                    MOVE DFRK1     WWRK1
     C                   MOVE      DFTOLS        WSTOLS
     C                   Z-ADD     DFETD1        WFETD1
     C                   Z-ADD     DFETA1        WFETA1
     C                   Z-ADD     DFEDA1        WFEDA1
     C                   Z-ADD     DFETD2        WFETD2
     C                   Z-ADD     DFETA2        WFETA2
     C                   Z-ADD     DFEDA2        WFEDA2
     C                   Z-ADD     DFETD3        WFETD3
     C                   Z-ADD     DFETA3        WFETA3
     C                   Z-ADD     DFEDA3        WFEDA3
     C                   END
      *
      *
     C   33              DO
     C                   MOVE      *BLANKS       KA
     C                   MOVE      *ZEROS        VE
     C                   MOVE      *BLANKS       RA
     C                   MOVE      *BLANKS       IT
     C                   MOVE      *ZEROS        FV
     C                   MOVE      *BLANKS       MI
     C                   MOVE      *ZEROS        PR
     C                   MOVE      *ZEROS        BE
     C                   MOVE      *BLANKS       VA
     C     FITDVI        IFEQ      'J'
     C     HEHAWB        ANDEQ     *ZEROS
     C                   MOVE      'J'           WDFCMN
     C                   ELSE
     C                   MOVE      'N'           WDFCMN
     C                   ENDIF
     C     UFLYTM        COMP      'J'                                    35
     C   35              DO
     C                   MOVE      HØ(1)         XHØ
     C                   MOVE      LE(1)         XLE
     C                   MOVE      BR(1)         XBR
     C                   MOVE      AN(1)         XAN
     C                   MOVE      XVS           VA(3)
     C     AN(2)         IFNE      0
     C                   MOVE      HØ(2)         XHØ
     C                   MOVE      LE(2)         XLE
     C                   MOVE      BR(2)         XBR
     C                   MOVE      AN(2)         XAN
     C                   MOVE      XVS           VA(4)
     C                   END
     C     AN(3)         IFNE      0
     C                   MOVE      HØ(3)         XHØ
     C                   MOVE      LE(3)         XLE
     C                   MOVE      BR(3)         XBR
     C                   MOVE      AN(3)         XAN
     C                   MOVE      XVS           VA(5)
     C                   END
     C     AN(4)         IFNE      0
     C                   MOVE      HØ(4)         XHØ
     C                   MOVE      LE(4)         XLE
     C                   MOVE      BR(4)         XBR
     C                   MOVE      AN(4)         XAN
     C                   MOVE      XVS           VA(6)
     C                   END
     C     AN(5)         IFNE      0
     C                   MOVE      HØ(5)         XHØ
     C                   MOVE      LE(5)         XLE
     C                   MOVE      BR(5)         XBR
     C                   MOVE      AN(5)         XAN
     C                   MOVE      XVS           VA(7)
     C                   END
     C     AN(6)         IFNE      0
     C                   MOVE      HØ(6)         XHØ
     C                   MOVE      LE(6)         XLE
     C                   MOVE      BR(6)         XBR
     C                   MOVE      AN(6)         XAN
     C                   MOVE      XVS           VA(8)
     C                   END
     C     AN(7)         IFNE      0
     C                   MOVE      HØ(7)         XHØ
     C                   MOVE      LE(7)         XLE
     C                   MOVE      BR(7)         XBR
     C                   MOVE      AN(7)         XAN
     C                   MOVE      XVS           VA(9)
     C                   END
     C     AN(8)         IFNE      0
     C                   MOVE      HØ(8)         XHØ
     C                   MOVE      LE(8)         XLE
     C                   MOVE      BR(8)         XBR
     C                   MOVE      AN(8)         XAN
     C                   MOVE      XVS           VA(10)
     C                   END
     C     AN(9)         IFNE      0
     C                   MOVE      HØ(9)         XHØ
     C                   MOVE      LE(9)         XLE
     C                   MOVE      BR(9)         XBR
     C                   MOVE      AN(9)         XAN
     C                   MOVE      XVS           WSVS11
     C                   END
     C     AN(10)        IFNE      0
     C                   MOVE      HØ(10)        XHØ
     C                   MOVE      LE(10)        XLE
     C                   MOVE      BR(10)        XBR
     C                   MOVE      AN(10)        XAN
     C                   MOVE      XVS           WSVS12
     C                   END
     C     AN(11)        IFNE      0
     C                   MOVE      HØ(11)        XHØ
     C                   MOVE      LE(11)        XLE
     C                   MOVE      BR(11)        XBR
     C                   MOVE      AN(11)        XAN
     C                   MOVE      XVS           WSVS13
     C                   END
     C                   END
     C  N35              DO
     C     HEM3          IFNE      *ZEROS
     C                   MOVEL     M3TXT         VA(3)
     C                   END
     C                   END
      *
      * TAR ROUTING FRA SAMLAST HVIS SATT PÅ SAMLAST
     C     HEHAWB        COMP      *ZEROS                             4141
      *
      * TAR ELLERS ANBEFALT ROUTING
     C     UANRUT        COMP      'J'                                    42
     C     KODFRK        CHAIN     KODTFR                             39
     C  N41
     CAN 42KODARK        CHAIN     KODTAR                             39
      *
     C                   MOVE      USTLF         WSTLFS
     C                   MOVE      UKTLF         WSTLFK
     C  N41
     CAN 42              DO
     C                   MOVE      KARRA1        WSROA1
     C                   MOVE      KARRB1        WSROB1
     C                   MOVE      KARRA2        WSROA2
     C                   MOVE      KARRB2        WSROB2
     C                   MOVE      KARRA3        WSROA3
     C                   MOVE      KARRB3        WSROB3
     C                   END
     C   41              DO
     C                   MOVE      SMROA1        WSROA1
     C                   MOVE      SMROB1        WSROB1
     C                   MOVE      SMROC1        WSROC1
     C                   MOVE      SMROA2        WSROA2
     C                   MOVE      SMROB2        WSROB2
     C                   MOVE      SMROC2        WSROC2
     C                   MOVE      SMROA3        WSROA3
     C                   MOVE      SMROB3        WSROB3
     C                   MOVE      SMROC3        WSROC3
     C                   MOVE      SMETD1        WFETD1
     C                   MOVE      SMETA1        WFETA1
     C                   MOVE      SMEDA1        WFEDA1
     C                   MOVE      SMETD2        WFETD2
     C                   MOVE      SMETA2        WFETA2
     C                   MOVE      SMEDA2        WFEDA2
     C                   MOVE      SMETD3        WFETD3
     C                   MOVE      SMETA3        WFETA3
     C                   MOVE      SMEDA3        WFEDA3
     C                   END
     C                   MOVE      FICURR        WSVAL
     C                   MOVEL     'NVD'         WSDVCA
     C                   MOVEL     'NVD'         WSDVCU
     C                   MOVE      HENT          KA(1)
     C                   Z-ADD     HEVKT         VE(1)
     C                   Z-ADD     HEFBV         FV(1)
     C                   MOVE      HEVS1         VA(1)
     C                   MOVE      HEVS2         VA(2)
     C     HEGM1         IFNE      *BLANKS
     C     HEGM2         ORNE      *BLANKS
     C                   MOVE      WSGM12        WSINFA
     C                   END
     C     HEKNSF        IFEQ      0
     C                   MOVE      KARTXT        WSMSG
     C                   ELSE
     C                   MOVE      UMSG          WSMSG
     C                   END
     C                   END
      *
     C     KODFSK        KLIST
     C                   KFLD                    YFSUNI
     C                   KFLD                    WFLY
     C                   MOVE      'FS'          YFSUNI            2
     C     *LIKE         DEFINE    MCMCFE        MCMCF2
     C     *LIKE         DEFINE    MCAWFE        MCAWF2
      * Sjekker om verdi finnes fra før
     C     HEADFK        CHAIN(N)  MCAWF                              33
     C     *IN33         IFEQ      *ON
      * Henter AWB Fee
     C     'DISPU'       CHAIN     KODTDIS                            33
     C     *IN33         IFEQ      *OFF
     C                   Z-ADD     KDSBL4        MCAWFE
     C                   ENDIF
      * Henter MC Fee
     C                   Z-ADD     HEKNT         WFLY              3 0
     C     WFLY          IFGT      0
     C     KODFSK        CHAIN     KODTFS                             33
     C     *IN33         IFEQ      *OFF
     C                   Z-ADD     KFSMC         MCMCFE
     C                   ENDIF
     C                   ENDIF
      *
     C                   ENDIF
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVDQW        BEGSR
      ***********************************************
     C                   MOVE      DQNA          WSNA
     C                   MOVE      DQAD1         WSAD1
     C                   MOVE      DQAD2         WSAD2
     C                   MOVE      DQAD3         WSAD3
     C                   MOVE      DQAD4         WSAD4
     C                   MOVEL     DQINFD        WSINFD
     C                   MOVE      DQINF3        WSINF3
     C                   MOVE      DQINF4        WSINF4
     C                   MOVE      DQINF5        WSINF5
     C                   MOVE      DQINF6        WSINF6
     C                   MOVE      DQINF7        WSINF7
     C                   MOVE      DQINF8        WSINF8
     C                   MOVE      DQINF9        WSINF9
     C                   MOVE      DQVS11        WSVS11
     C                   MOVE      DQVS12        WSVS12
     C                   MOVE      DQVS13        WSVS13
      *
     C                   ENDSR
      *
      ***********************************************
     C     OPDDOK        BEGSR
      ***********************************************
     C     DOKEFK        CHAIN     DOKEF                              33
      *
     C   33              DO
     C                   MOVE      YRI           DFRI
     C                   MOVE      UAVD          DFAVD
     C                   MOVE      UOPD          DFOPD
     C                   END
      *
     C                   MOVE      ' '           DFST
     C                   MOVE      HESG          DFSG
     C                   MOVE      WSTLFS        DFTLFS
     C                   MOVE      WSTLFK        DFTLFK
     C                   MOVE      WSINF1        DFINF1
     C                   MOVE      WSINF2        DFINF2
     C                   MOVE      WSCCPP        DFCCPP
     C                   MOVE      WSFSN         DFFSN
     C                   MOVE      WSROA1        DFROA1
     C                   MOVE      WSROB1        DFROB1
     C                   MOVE      WSROC1        DFROC1
     C                   MOVE      WSROA2        DFROA2
     C                   MOVE      WSROB2        DFROB2
     C                   MOVE      WSROC2        DFROC2
     C                   MOVE      WSROA3        DFROA3
     C                   MOVE      WSROB3        DFROB3
     C                   MOVE      WSROC3        DFROC3
     C                   MOVE      WSVAL         DFVAL
     C                   MOVE      WSDVCA        DFDVCA
     C                   MOVE      WSDVCU        DFDVCU
     C                   MOVE      WSBELF        DFBELF
     C                   MOVE      WSINFA        DFINFA
     C                   MOVE      WSINFB        DFINFB
     C                   MOVEL     WSINFC        DFINFC
     C                   MOVE      KA            KA1
     C                   MOVE      VE            VE1
     C                   MOVE      RA            RA1
     C                   MOVE      IT            IT1
     C                   MOVE      FV            FV1
     C                   MOVE      MI            MI1
     C                   MOVE      PR            PR1
     C                   MOVE      BE            BE1
     C                   MOVE      VA            VA1
     C                   MOVE      WSNTT         DFNTT
     C                   MOVE      WSVKTT        DFVKTT
     C                   MOVE      WSBLT         DFBLT
N08  C                   MOVE      WSNETB        DFNETT
     C                   MOVE      WSKDDC        DFKDDC
     C                   MOVE      WSBLDC        DFBLDC
     C                   MOVE      WSBLA         DFBLA
     C                   MOVE      WSKDME        DFKDME
     C                   MOVE      WSBLAV        DFBLAV
     C                   MOVE      WSFT          DFFT
N03  C                   MOVE      WSFUEL        DFFUEL
     C                   MOVE      WDFCMN        DFCMN
     C                   MOVE      WSTOLS        DFTOLS
     C                   Z-ADD     WFETD1        DFETD1
     C                   Z-ADD     WFETA1        DFETA1
     C                   Z-ADD     WFEDA1        DFEDA1
     C                   Z-ADD     WFETD2        DFETD2
     C                   Z-ADD     WFETA2        DFETA2
     C                   Z-ADD     WFEDA2        DFEDA2
     C                   Z-ADD     WFETD3        DFETD3
     C                   Z-ADD     WFETA3        DFETA3
     C                   Z-ADD     WFEDA3        DFEDA3
      *
     C     WWWRK1        IFEQ      'A'
     C     HEHAWB        ANDNE     *ZEROS
     C                   MOVE      'A'           DFRK1
     C                   ENDIF
      *
     C   33              WRITE     DOKEFR
     C   33FIURBL        IFEQ      'J'
     C                   EXSR      TTSR
     C                   END
     C  N33              UPDATE    DOKEFR
      *
     C                   ENDSR
      *
      ***********************************************
     C     OPDDOQ        BEGSR
      ***********************************************
     C     DOKEQK        CHAIN     DOKEQ                              33
      *
     C   33              DO
     C                   MOVE      YRIQ          DQRI
     C                   MOVE      UAVD          DQAVD
     C                   MOVE      UOPD          DQOPD
     C                   END
      *
     C                   MOVE      ' '           DQST
     C                   MOVE      WSNA          DQNA
     C                   MOVE      WSAD1         DQAD1
     C                   MOVE      WSAD2         DQAD2
     C                   MOVE      WSAD3         DQAD3
     C                   MOVE      WSAD4         DQAD4
     C                   MOVEL     WSINFD        DQINFD
     C                   MOVE      WSINF3        DQINF3
     C                   MOVE      WSINF4        DQINF4
     C                   MOVE      WSINF5        DQINF5
     C                   MOVE      WSINF6        DQINF6
     C                   MOVE      WSINF7        DQINF7
     C                   MOVE      WSINF8        DQINF8
     C                   MOVE      WSINF9        DQINF9
     C                   MOVE      WSVS11        DQVS11
     C                   MOVE      WSVS12        DQVS12
     C                   MOVE      WSVS13        DQVS13
      *
     C   33              WRITE     DOKEQR
     C  N33              UPDATE    DOKEQR
      *
     C                   ENDSR
      *
      ***********************************************
     C     TSTKU         BEGSR
      ***********************************************
      * TEST IF CUSTOMER HAVE SPESIAL AGREEMENT
      *
     C                   Z-ADD(H)  FV(XN)        XVKT
     C     HEHAWB        IFNE      *ZEROS
     C                   MOVE      'H'           YFFKD
     C                   ELSE
     C                   MOVE      'S'           YFFKD
     C                   END
      *
     C     KUAVKE        SETLL     KODTFFR
     C                   READ      KODTFFR                                87
     C  N87HEKNSF        IFEQ      KFFKN
     C     HESDF         IFEQ      KFFSDF
     C     HESDT         IFEQ      KFFSDT
      *
     C     HEHAWB        IFNE      *ZEROS
     C     KFFKD         IFEQ      'H'
     C     KFFBL2        IFEQ      0
     C                   Z-ADD     KFFBL         BE(XN)
     C                   MOVE      'M'           RA(XN)
     C                   Z-ADD     BE(XN)        PR(XN)
     C                   ELSE
     C                   Z-ADD     KFFBL         PR(XN)
     C     XVKT          IFLT      45
     C                   MOVE      'N'           RA(XN)
     C                   ELSE
     C                   MOVE      'Q'           RA(XN)
     C                   ENDIF
     C                   EXSR      TSTKU2
     C                   END
     C                   END
     C                   ELSE
     C     KFFKD         IFEQ      'S'
     C     KFFBL2        IFEQ      0
     C                   Z-ADD     KFFBL         BE(XN)
     C                   MOVE      'M'           RA(XN)
     C                   Z-ADD     BE(XN)        PR(XN)
     C                   ELSE
     C                   Z-ADD     KFFBL         PR(XN)
     C     XVKT          IFLT      45
     C                   MOVE      'N'           RA(XN)
     C                   ELSE
     C                   MOVE      'Q'           RA(XN)
     C                   ENDIF
     C                   EXSR      TSTKU2
     C                   END
     C                   END
     C                   END
      *
     C                   END
     C                   END
     C                   END
     C                   ENDSR
      ***********************************************
     C     TSTKU2        BEGSR
      ***********************************************
      * TEST IF LOWER PRICE IN NEXT RATECLASS
      *
     C     KFFTVK        ADD       1             KFFTV2            5 0
     C                   READ      KODTFFR                                87
     C  N87HEKNSF        IFEQ      KFFKN
     C     HESDF         IFEQ      KFFSDF
     C     HESDT         IFEQ      KFFSDT
     C                   Z-ADD(H)  FV(XN)        XVKTBR
     C     PR(XN)        MULT      XVKTBR        PRICE1           13 2
     C     KFFBL         MULT      KFFTV2        PRICE2           13 2
     C     PRICE2        IFLT      PRICE1
     C                   Z-ADD     KFFBL         PR(XN)
     C                   Z-ADD     KFFTV2        FV(XN)
     C                   END
     C                   END
     C                   END
     C                   END
     C                   ENDSR
      ***********************************************
     C     SFFR          BEGSR
      ***********************************************
     C                   OPEN      LOCL01                               91
     C  N91              OPEN      FFR01L                               91
     C  N91              OPEN      FFA01L                               91
     C     *IN91         IFEQ      '1'
     C                   MOVEL     'BBA0035'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   GOTO      SFFR99
     C                   ENDIF
      * Blanker hele parameterstrengen
     C                   MOVEL     *BLANKS       AUTINF                         <AUTOMATISK
     C     *IN20         IFEQ      '1'                                          <AUTOMATISK
     C                   MOVE      '1'           AUTTRM
     C                   ELSE                                                   <MED BILDE
     C                   MOVE      ' '           AUTTRM
     C                   ENDIF
     C     WREF2         IFNE      *BLANKS
     C                   MOVE      '3'           AUTTRM
     C                   ENDIF
     C                   MOVEL     *BLANKS       AUTPID                         <ADRESSE
     C                   Z-ADD     WSFSN         AUTALN                         <AIRLINE
     C     HEGN          IFNE      *BLANKS
     C                   MOVEL     WHEGN8        AUTAWB                         <AWB
     C                   ENDIF
     C                   MOVEL     WSSDF         AUTORI                         <ORIGIN AIRPORT
     C                   MOVEL     WSSDT         AUTDES                         <DEST. AIRPORT
     C                   MOVE      'T'           AUTSDC                         <SHIP.DESC.CODE
     C                   Z-ADD     WSNTT         AUTNPI                         <NO. OF PIECES
     C                   MOVE      'K'           AUTWCD                         <WEIGHT CODE
     C                   Z-ADD     WSVKTT        AUTWGH                         <WEIGHT
     C                   Z-ADD     0             AUTTPI                         <T.NO.PIECES
     C     HEM3          IFNE      *ZEROS
     C                   Z-ADD(H)  HEM3          WW112
     C                   MOVEL     WW112         AUVOL
     C                   ELSE
     C                   MOVEL     *BLANKS       AUVOL
     C                   ENDIF
     C                   MOVEL     WSVS1         AUTMAN                         <MANIFEST DESC
     C                   MOVEL     *BLANKS       AUTPAR                         <PART ID
     C                   MOVEL     *BLANKS       AUTPCD                         <PART CODE
     C                   MOVEL     *BLANKS       AUTPAI                         <PART AIRPORT
     C                   MOVEL     *BLANKS       AUTRAI                         <REQ.AIRPORT
     C                   MOVEL     *BLANKS       AUTOFD                         <REQ.OFFICE
     C                   MOVEL     *BLANKS       AUTCOD                         <REQ.COMPANY
      *
     C                   MOVE      WSRO21        AUTCAR                         <CARRIER
     C                   MOVEL     WSRO41        AUTFLN                         <FLIGHT NO.
     C                   Z-ADD     WSROC1        AUTDAY                         <FLIGHT DAY
     C                   Z-ADD     UMONTH        ZZ                2 0
     C     AUTDAY        IFLT      UDAY
     C                   ADD       1             ZZ
     C     ZZ            IFGT      12
     C                   Z-ADD     1             ZZ
     C                   ENDIF
     C                   ENDIF
     C                   MOVEA     NAV(ZZ)       AUTMND
     C                   MOVEL     WSSDF         AUTDEP                         <DEP.AIRPORT
     C                   MOVEL     WSROA1        AUTARR                         <ARR.AIRPORT
     C                   MOVE      'NN'          AUTSPC                         <SPACE ALL.CODE
     C                   MOVEL     *BLANKS       AUTAID                         <ALLOTMENT ID.
      *
     C     WSROB2        IFNE      *BLANKS
     C                   MOVE      WSRO22        AU2CAR                         <CARRIER
     C                   MOVEL     WSRO42        AU2FLN                         <FLIGHT NO.
     C                   Z-ADD     WSROC2        AU2DAY                         <FLIGHT DAY
     C                   Z-ADD     UMONTH        ZZ
     C     AU2DAY        IFLT      UDAY
     C                   ADD       1             ZZ
     C     ZZ            IFGT      12
     C                   Z-ADD     1             ZZ
     C                   ENDIF
     C                   ENDIF
     C                   MOVEA     NAV(ZZ)       AU2MND
     C                   MOVEL     WSROA1        AU2DEP                         <DEP.AIRPORT
     C                   MOVEL     WSROA2        AU2ARR                         <ARR.AIRPORT
     C                   MOVE      'NN'          AU2SPC                         <SPACE ALL.CODE
     C                   MOVEL     *BLANKS       AU2AID                         <ALLOTMENT ID.
     C                   ENDIF
      *
     C     WSROB3        IFNE      *BLANKS
     C                   MOVE      WSRO23        AU3CAR                         <CARRIER
     C                   MOVEL     WSRO43        AU3FLN                         <FLIGHT NO.
     C                   Z-ADD     WSROC3        AU3DAY                         <FLIGHT DAY
     C                   Z-ADD     UMONTH        ZZ
     C     AU3DAY        IFLT      UDAY
     C                   ADD       1             ZZ
     C     ZZ            IFGT      12
     C                   Z-ADD     1             ZZ
     C                   ENDIF
     C                   ENDIF
     C                   MOVEA     NAV(ZZ)       AU3MND
     C                   MOVEL     WSROA2        AU3DEP                         <DEP.AIRPORT
     C                   MOVEL     WSROA3        AU3ARR                         <ARR.AIRPORT
     C                   MOVE      'NN'          AU3SPC                         <SPACE ALL.CODE
     C                   MOVEL     *BLANKS       AU3AID                         <ALLOTMENT ID.
     C                   ENDIF
     C     WSRK1         IFEQ      'P'
     C                   MOVEL     'P  '         AUSPE1
     C                   ENDIF
     C     WSRK1         IFEQ      'D'
     C                   MOVEL     'PAD'         AUSPE1
     C                   ENDIF
      * Sjekker om det finnes dimmension info som skal sendes over
     C     HEADFK        SETLL     DIMM
     C     HEADFK        READE(N)  DIMM                                   90
     C                   Z-ADD     0             X
     C                   MOVEA     *ZEROS        WAN
     C                   MOVEA     *ZEROS        WBR
     C                   MOVEA     *ZEROS        WLE
     C                   MOVEA     *ZEROS        WHØ
     C     *IN90         DOWEQ     *OFF
     C                   ADD       1             X
     C     X             IFGT      11
     C                   LEAVE
     C                   ENDIF
     C                   Z-ADD     DIMANT        WAN(X)
     C                   Z-ADD     DIMBRE        WBR(X)
     C                   Z-ADD     DIMLEN        WLE(X)
     C                   Z-ADD     DIMHOY        WHØ(X)
     C     HEADFK        READE(N)  DIMM                                   90
     C                   ENDDO
      * Programmet venter på svar i et vist antall sekunder.
      * Kommer ikke svaret fortsetter man uten å vite det.
     C                   CALL      'SM220C2'
     C                   PARM                    AUTINF
     C                   PARM                    AUTREC            9 0
     C                   PARM                    WAN
     C                   PARM                    WBR
     C                   PARM                    WLE
     C                   PARM                    WHØ
      *
      * Routingen på fraktbrevbildet skal oppdateres hvis flyselskapet
      * svarer med en annen routing enn det som var ønsket.
      *
     C                   Z-ADD     0             ZZ
     C     AUTREC        SETLL     FFR03R
     C     AUTREC        READE     FFR03R                                 90
     C     *IN90         DOWEQ     '0'
     C     ZZ            ANDLE     3
     C                   ADD       1             ZZ
      * F035 = 'NA' --> Godtar alternativ flight om nødvendig
     C     F035          IFEQ      'NA'
      *
      * Hvis svaret ikke har kommet finnes det ingen poster i FFA03R
      *
     C                   Z-ADD     0             YY                1 0
     C     AUTREC        SETLL     FFA03R
     C     AUTREC        READE     FFA03R                                 90
     C     *IN90         DOWEQ     '0'
     C     YY            ANDLE     3
     C                   ADD       1             YY
     C     B0331         IFEQ      F0331
     C     B0331         ANDEQ     F0331
      *
      * Har funnet det tilhørende svaret til den forespurte
      * "Flight Detail". Oppdaterer fraktbrevbildet hvis "Consigment"
      * er booket på en annen flight enn det som var ønsket.
      *
      * B035 = 'KK' --> Booking er bekreftet
      *
     C     B035          IFEQ      'KK'
     C                   MOVEL     'BBA0036'     MSGNR
     C                   MOVE      *ON           *IN30
     C     ZZ            IFEQ      1
     C                   MOVEL     B0332         WSROA1
     C                   MOVEL     B0311         WSRO21
     C                   MOVEL     B0312         WSRO41
     C                   Z-ADD     B0314         WSROC1
     C                   ENDIF                                                  <ZZ=1
     C     ZZ            IFEQ      2
     C                   MOVEL     B0332         WSROA2
     C                   MOVEL     B0311         WSRO22
     C                   MOVEL     B0312         WSRO42
     C                   Z-ADD     B0314         WSROC2
     C                   ENDIF                                                  <ZZ=2
     C     ZZ            IFEQ      3
     C                   MOVEL     B0332         WSROA3
     C                   MOVEL     B0311         WSRO23
     C                   MOVEL     B0312         WSRO43
     C                   Z-ADD     B0314         WSROC3
     C                   ENDIF                                                  <ZZ=2
     C                   ENDIF                                                  <B035
     C                   ENDIF                                                  <B0331
     C     AUTREC        READE     FFA03R                                 90
     C                   ENDDO                                                  <READE,FFA03R
      *
     C                   ENDIF
     C     AUTREC        READE     FFR03R                                 90
     C                   ENDDO                                                  <READE,FFR03R
      *
     C     SFFR99        TAG
     C                   CLOSE     LOCL01                               91
     C                   CLOSE     FFR01L                               91
     C                   CLOSE     FFA01L                               91
      *
     C                   ENDSR
      *
      ***********************************************
     C     VLOG          BEGSR
      ***********************************************
     C                   OPEN      LOCL01                               91
     C     *IN91         IFEQ      '1'
     C                   MOVEL     'BBA0035'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   GOTO      VLOG99
     C                   ENDIF
     C                   CLOSE     LOCL01                               91
      *
     C                   CALL      'SM040C'
      *
     C     VLOG99        ENDSR
      ***********************************************
     C     UTCMDL        BEGSR
      ***********************************************
     C                   SELECT
     C     XCMD          WHENEQ    0
     C                   MOVE      'DIV0020'     MSGLN1
     C  N27              MOVE      'DIV0032'     MSGLN2
     C   27              MOVE      'DIV0000'     MSGLN2
     C                   MOVE      'DIV0030'     MSGLN3
     C                   MOVE      'DIV0029'     MSGLN4
     C                   ADD       1             XCMD
     C     XCMD          WHENEQ    1
     C                   MOVE      'DIV2131'     MSGLN1
     C                   MOVE      'DIV0024'     MSGLN2
     C  N27              MOVE      'DIV2077'     MSGLN3
     C   27              MOVE      'DIV0000'     MSGLN3
     C                   MOVE      'DIV0029'     MSGLN4
     C                   ADD       1             XCMD
     C     XCMD          WHENEQ    2
     C                   MOVE      'BBA0117'     MSGLN1                         18
     C                   MOVE      'BBA0045'     MSGLN2                         19
     C                   MOVE      'BBA0033'     MSGLN3                         20
     C                   MOVE      'DIV0029'     MSGLN4
     C                   ADD       1             XCMD
S07  C*                    OTHER
N07  C     XCMD          WHENEQ    3
     C                   MOVE      'BBA0034'     MSGLN1                         21
     C                   MOVE      'BBA0040'     MSGLN2                         22
     C                   MOVE      'BBA0042'     MSGLN3                         23
     C                   MOVE      'DIV0029'     MSGLN4
S07  C*                    Z-ADD0         XCMD    10
N07  C                   ADD       1             XCMD              1 0
N07  C                   OTHER
N07  C                   MOVE      'SHU0633'     MSGLN1                         21
N07  C                   MOVE      'DIV0000'     MSGLN2                         22
N07  C                   MOVE      'DIV0000'     MSGLN3                         23
N07  C                   MOVE      'DIV0029'     MSGLN4
     C                   ENDSL
      *
     C                   ENDSR
      *
      ***********************************************
     C     SFIR          BEGSR
      ***********************************************
     C                   OPEN      LOCL01                               91
     C  N91              OPEN      ISUL01                               91
     C     *IN91         IFEQ      '1'
     C                   MOVEL     'BBA0035'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   GOTO      SFIR99
     C                   ENDIF
      * Blanker hele parameterstrengen
     C                   MOVEL     *BLANKS       BUTINF
     C     WSFSN         CHAIN     ISUL01                             90
     C     *IN90         IFEQ      '0'
     C                   MOVEL     ISPART        BUTPID
     C                   ELSE
     C     WWUSER        CHAIN     LOCL01                             90
     C     *IN90         IFEQ      '0'
     C                   MOVEL     LODEFA        BUTPID                         <ADRESSE
     C                   ELSE
     C                   MOVEL     *BLANKS       BUTPID                         <ADRESSE
     C                   ENDIF
     C                   ENDIF                                                  <*IN90
     C                   MOVEL     WSSDF         BUTAOR                         <ORIGIN AIRPORT
     C                   MOVEL     WSSDT         BUTADE                         <DEST. AIRPORT
     C                   Z-ADD     UDAY          BUTDA1
     C                   Z-ADD     UMONTH        ZZ
     C     BUTDA1        IFLT      UDAY
     C                   ADD       1             ZZ
     C     ZZ            IFGT      12
     C                   Z-ADD     1             ZZ
     C                   ENDIF
     C                   ENDIF
     C                   MOVEA     NAV(ZZ)       BUTMN1                         <FLIGHT MND
     C                   Z-ADD     0             BUTYKL
      * Kaller på program for å sende og motta Schedule Request
      * Parameter inneholder routing hvis plukket av bruker
     C                   CALL      'TDV51C'
     C                   PARM                    BUTINF
      *
      * Routingen på fraktbrevbildet skal oppdateres etter den
      * routing som bruker har valgt i TDV51R
      *
     C     BUTRA1        IFNE      *BLANKS
     C     BUTRA2        ORNE      *BLANKS
     C     BUTRA3        ORNE      *BLANKS
     C                   MOVEL     'BBA0036'     MSGNR
     C                   MOVE      *ON           *IN30
     C     BUTRA1        IFNE      *BLANKS
     C                   MOVEL     BUTRA1        WSROA1
     C                   MOVEL     BUTRB1        WSROB1
     C                   Z-ADD     BUTRC1        WSROC1
     C                   ENDIF                                                  <BUTRA1
     C     BUTRA2        IFNE      *BLANKS
     C                   MOVEL     BUTRA2        WSROA2
     C                   MOVEL     BUTRB2        WSROB2
     C                   Z-ADD     BUTRC2        WSROC2
     C                   ENDIF                                                  <BUTRA2
     C     BUTRA3        IFNE      *BLANKS
     C                   MOVEL     BUTRA3        WSROA3
     C                   MOVEL     BUTRB3        WSROB3
     C                   Z-ADD     BUTRC3        WSROC3
     C                   ENDIF                                                  <BUTRA3
     C                   ENDIF                                                  <BUTRA1
      *
     C     SFIR99        TAG
     C                   CLOSE     LOCL01                               91
     C                   CLOSE     ISUL01                               91
      *
     C                   ENDSR
      *
      ***********************************************
     C     SFTR          BEGSR
      ***********************************************
     C                   OPEN      LOCL01                               91
     C  N91              OPEN      ISUL01                               91
     C     *IN91         IFEQ      '1'
     C                   MOVEL     'BBA0035'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   GOTO      SFTR99
     C                   ENDIF
      * Blanker hele parameterstrengen
     C                   MOVEL     *BLANKS       CUTINF
     C     WSFSN         CHAIN     ISUL01                             90
     C     *IN90         IFEQ      '0'
     C                   MOVEL     ISPART        CUTPID
     C                   ENDIF
     C     WWUSER        CHAIN     LOCL01                             90
     C     *IN90         IFEQ      *OFF
     C                   MOVEL     LODEFA        CUTPID                         <ADRESSE
     C                   ENDIF
     C                   MOVEL     WSSDF         CUTAOR                         <ORIGIN AIRPORT
     C                   MOVEL     WSSDT         CUTADE                         <DEST. AIRPORT
     C     WSROC1        IFNE      *ZEROS
     C                   MOVE      WSROC1        CUTDA1
     C                   ELSE
     C                   MOVE      UDAY          CUTDA1
     C                   ENDIF
     C                   Z-ADD     UMONTH        ZZ
     C                   MOVE      CUTDA1        WRKDAY            2 0
     C     WRKDAY        IFLT      UDAY
     C                   ADD       1             ZZ
     C     ZZ            IFGT      12
     C                   Z-ADD     1             ZZ
     C                   ENDIF
     C                   ENDIF
     C                   MOVEA     NAV(ZZ)       CUTMN1                         <FLIGHT MND
     C                   MOVE      UYEAR         CUTYE1
     C                   CLOSE     LOCL01                               91
     C                   CLOSE     ISUL01                               91
      *
     C                   CALL      'SM240C2'
     C                   PARM                    CUTINF           31
      *
     C     SFTR99        ENDSR
      ***********************************************
     C     SCOMM         BEGSR
      ***********************************************
      * Sending av singel fraktbrev som FWB til agent/kunde
      * sending av house AWB som AZB til agent/kunde
     C                   CALL      'TDV20R'
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    WDUM1             3
     C                   PARM                    WDUM2             3 0
     C                   ENDSR
      ******************************************
     C     FLIGTS        BEGSR
      ******************************************
      *
      * SJEKKER FLIGHT NUMMERETS SYNTAX
      *
     C     FLIGNR        IFEQ      1
      * Carrier code must exist but flight number may be blank
S04  C*          FAA       IFGE 'A'
S04  C*          FAA       ANDLE'Z'
N04  C     FAA           IFNE      *BLANKS
S01  C*          FAB       ANDGE'A'
S01  C*          FAB       ANDLE'Z'
     C     FBA           ANDEQ     *BLANK
     C     FBB           ANDEQ     *BLANK
     C     FBC           ANDEQ     *BLANK
     C     FCC           ANDEQ     *BLANK
     C                   GOTO      FLIG99
     C                   ENDIF
     C                   ELSE
      * Carrier code and flight number may be blank
     C     FLIG          IFEQ      *BLANKS
S04  C*          FAA       ORGE 'A'
S04  C*          FAA       ANDLE'Z'
N04  C     FAA           ORNE      ' '
S01  C*          FAB       ANDGE'A'
S01  C*          FAB       ANDLE'Z'
     C     FBA           ANDEQ     *BLANK
     C     FBB           ANDEQ     *BLANK
     C     FBC           ANDEQ     *BLANK
     C     FCC           ANDEQ     *BLANK
     C                   GOTO      FLIG99
     C                   ENDIF
     C                   ENDIF
      *
S04  C*                    MOVE '0'       FLIERR
N04  C                   MOVE      '0'           FLIERR            1
     C                   SELECT
S04  C*          FAA       WHLT 'A'
S04  C*          FAA       ORGT 'Z'
S04  C*                    MOVE '1'       FLIERR  1
S01  C*          FAB       WHLT 'A'
S01  C*          FAB       ORGT 'Z'
S01  C*                    MOVE '1'       FLIERR
     C     FBA           WHENLT    '0'
     C     FBA           ORGT      '9'
     C                   MOVE      '1'           FLIERR
     C     FBB           WHENLT    '0'
     C     FBB           ORGT      '9'
     C                   MOVE      '1'           FLIERR
     C     FBC           WHENLT    '0'
     C     FBC           ORGT      '9'
     C                   MOVE      '1'           FLIERR
     C     FCC           WHENLT    'A'
     C     FCC           ORGT      'Z'
     C     FCC           IFLT      '0'
     C     FCC           ORGT      '9'
     C     FCC           IFNE      *BLANKS
     C                   MOVE      '1'           FLIERR
     C                   ENDIF
     C                   ENDIF
     C                   ENDSL
     C     FLIERR        IFEQ      '1'
     C                   MOVE      *ON           *IN30
     C                   MOVE      'BBA0094'     MSGNR
     C                   Z-ADD     6             LINNBR
     C                   SELECT
     C     FLIGNR        WHENEQ    1
     C                   Z-ADD     29            POSNBR
     C     FLIGNR        WHENEQ    2
     C                   Z-ADD     47            POSNBR
     C     FLIGNR        WHENEQ    3
     C                   Z-ADD     65            POSNBR
     C                   ENDSL
     C                   ENDIF
      *
     C     FLIG99        TAG
     C                   ENDSR
      ***********************************************
     C     UPDDIM        BEGSR
      ***********************************************
      * Oppdaterer dimmensjoner på fraktbrevet.
      * Oppdatering skjer både ved ny og endring.
     C     AN(1)         IFGT      0
     C     HØ(1)         ANDGT     0
     C     LE(1)         ANDGT     0
     C     BR(1)         ANDGT     0
      * Sletter først de linjer som ligger inne
     C     HEADFK        SETLL     DIMM
     C     HEADFK        READE     DIMM                                   90
     C     *IN90         DOWEQ     *OFF
     C                   DELETE    DIMMR
     C     HEADFK        READE     DIMM                                   90
     C                   ENDDO
      * Skriver så de nye linjer. Satt en praktisk begrensing på 11 linjer
     C                   Z-ADD     UAVD          DIMAVD
     C                   Z-ADD     UOPD          DIMOPD
     C                   Z-ADD     AN(1)         DIMANT
     C     HØ(1)         MULT      100           DIMHOY
     C     LE(1)         MULT      100           DIMLEN
     C     BR(1)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(2)         IFGT      0
     C     HØ(2)         ANDGT     0
     C     LE(2)         ANDGT     0
     C     BR(2)         ANDGT     0
     C                   Z-ADD     AN(2)         DIMANT
     C     HØ(2)         MULT      100           DIMHOY
     C     LE(2)         MULT      100           DIMLEN
     C     BR(2)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(3)         IFGT      0
     C     HØ(3)         ANDGT     0
     C     LE(3)         ANDGT     0
     C     BR(3)         ANDGT     0
     C                   Z-ADD     AN(3)         DIMANT
     C     HØ(3)         MULT      100           DIMHOY
     C     LE(3)         MULT      100           DIMLEN
     C     BR(3)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(4)         IFGT      0
     C     HØ(4)         ANDGT     0
     C     LE(4)         ANDGT     0
     C     BR(4)         ANDGT     0
     C                   Z-ADD     AN(4)         DIMANT
     C     HØ(4)         MULT      100           DIMHOY
     C     LE(4)         MULT      100           DIMLEN
     C     BR(4)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(5)         IFGT      0
     C     HØ(5)         ANDGT     0
     C     LE(5)         ANDGT     0
     C     BR(5)         ANDGT     0
     C                   Z-ADD     AN(5)         DIMANT
     C     HØ(5)         MULT      100           DIMHOY
     C     LE(5)         MULT      100           DIMLEN
     C     BR(5)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(6)         IFGT      0
     C     HØ(6)         ANDGT     0
     C     LE(6)         ANDGT     0
     C     BR(6)         ANDGT     0
     C                   Z-ADD     AN(6)         DIMANT
     C     HØ(6)         MULT      100           DIMHOY
     C     LE(6)         MULT      100           DIMLEN
     C     BR(6)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(7)         IFGT      0
     C     HØ(7)         ANDGT     0
     C     LE(7)         ANDGT     0
     C     BR(7)         ANDGT     0
     C                   Z-ADD     AN(7)         DIMANT
     C     HØ(7)         MULT      100           DIMHOY
     C     LE(7)         MULT      100           DIMLEN
     C     BR(7)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(8)         IFGT      0
     C     HØ(8)         ANDGT     0
     C     LE(8)         ANDGT     0
     C     BR(8)         ANDGT     0
     C                   Z-ADD     AN(8)         DIMANT
     C     HØ(8)         MULT      100           DIMHOY
     C     LE(8)         MULT      100           DIMLEN
     C     BR(8)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(9)         IFGT      0
     C     HØ(9)         ANDGT     0
     C     LE(9)         ANDGT     0
     C     BR(9)         ANDGT     0
     C                   Z-ADD     AN(9)         DIMANT
     C     HØ(9)         MULT      100           DIMHOY
     C     LE(9)         MULT      100           DIMLEN
     C     BR(9)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(10)        IFGT      0
     C     HØ(10)        ANDGT     0
     C     LE(10)        ANDGT     0
     C     BR(10)        ANDGT     0
     C                   Z-ADD     AN(10)        DIMANT
     C     HØ(10)        MULT      100           DIMHOY
     C     LE(10)        MULT      100           DIMLEN
     C     BR(10)        MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(11)        IFGT      0
     C     HØ(11)        ANDGT     0
     C     LE(11)        ANDGT     0
     C     BR(11)        ANDGT     0
     C                   Z-ADD     AN(11)        DIMANT
     C     HØ(11)        MULT      100           DIMHOY
     C     LE(11)        MULT      100           DIMLEN
     C     BR(11)        MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
N07   ***********************************************
N07  C     SØKDTA        BEGSR
N07   ***********************************************
N07  C     LINNBR        IFEQ      6
N07  C     POSNBR        ANDGE     25
N07  C     POSNBR        ANDLE     27
N07  C                   MOVE      *BLANKS       UNVN             30
N07  C                   MOVE      *BLANKS       ULK               2
N07  C                   MOVE      *BLANKS       USD               5
N07  C                   MOVEL     WSROA1        USD
N07  C                   CALL      'SYFI10F'
N07  C                   PARM                    USD
N07  C                   PARM                    UNVN
N07  C                   PARM                    ULK
N07  C     USD           IFNE      *BLANKS
N07  C                   MOVEL     USD           WSROA1
N07  C                   END
N07  C                   Z-ADD     29            POSNBR
N07  C                   GOTO      SLSØK
N07  C                   END
N07   *
N07  C     LINNBR        IFEQ      6
N07  C     POSNBR        ANDGE     43
N07  C     POSNBR        ANDLE     45
N07  C                   MOVE      *BLANKS       UNVN             30
N07  C                   MOVE      *BLANKS       ULK               2
N07  C                   MOVE      *BLANKS       USD               5
N07  C                   MOVEL     WSROA2        USD
N07  C                   CALL      'SYFI10F'
N07  C                   PARM                    USD
N07  C                   PARM                    UNVN
N07  C                   PARM                    ULK
N07  C     USD           IFNE      *BLANKS
N07  C                   MOVEL     USD           WSROA2
N07  C                   END
N07  C                   Z-ADD     47            POSNBR
N07  C                   GOTO      SLSØK
N07  C                   END
N07   *
N07  C     LINNBR        IFEQ      6
N07  C     POSNBR        ANDGE     61
N07  C     POSNBR        ANDLE     63
N07  C                   MOVE      *BLANKS       UNVN             30
N07  C                   MOVE      *BLANKS       ULK               2
N07  C                   MOVE      *BLANKS       USD               5
N07  C                   MOVEL     WSROA3        USD
N07  C                   CALL      'SYFI10F'
N07  C                   PARM                    USD
N07  C                   PARM                    UNVN
N07  C                   PARM                    ULK
N07  C     USD           IFNE      *BLANKS
N07  C                   MOVEL     USD           WSROA3
N07  C                   END
N07  C                   Z-ADD     65            POSNBR
N07  C                   GOTO      SLSØK
N07  C                   END
N07   *
N07  C     LINNBR        IFEQ      9
N07  C                   CALL      'SYFI10I'
N07  C                   PARM                    XINFA1
N07  C     XINFA1        IFNE      *BLANKS
N07  C                   MOVE      *BLANKS       XINFA2
N07  C                   END
N07  C                   GOTO      SLSØK
N07  C                   END
N07   *
N07  C     LINNBR        IFGE      13
N07  C     LINNBR        ANDLE     18
N07  C     POSNBR        ANDEQ     15
N07  C     POSNBR        ANDLE     18
N07  C                   CALL      'SYFA74A'
N07  C                   PARM                    WRCCDE            1
N07  C     WRCCDE        IFNE      *BLANKS
N07  C                   SELECT
N07  C     LINNBR        WHENEQ    13
N07  C                   MOVE      WRCCDE        RA(1)
N07  C     LINNBR        WHENEQ    14
N07  C                   MOVE      WRCCDE        RA(2)
N07  C     LINNBR        WHENEQ    15
N07  C                   MOVE      WRCCDE        RA(3)
N07  C     LINNBR        WHENEQ    16
N07  C                   MOVE      WRCCDE        RA(4)
N07  C     LINNBR        WHENEQ    17
N07  C                   MOVE      WRCCDE        RA(5)
N07  C     LINNBR        WHENEQ    18
N07  C                   MOVE      WRCCDE        RA(6)
N07  C                   ENDSL
N07  C                   ENDIF
N07  C                   GOTO      SLSØK
N07  C                   END
N07   *
N07  C                   MOVE      'DIV1037'     MSGNR
N07  C                   SETON                                        30
N07   *
N07  C     SLSØK         ENDSR
N07   *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     KUAVKE        KLIST
     C                   KFLD                    HEKNSF
     C                   KFLD                    HESDF
     C                   KFLD                    HESDT
     C                   KFLD                    YFFKD
     C                   KFLD                    XVKT              5 0
     C                   MOVE      'H'           YFFKD             1
     C     DOKEFK        KLIST
     C                   KFLD                    YRI
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     DOKEQK        KLIST
     C                   KFLD                    YRIQ
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     HEADFK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     KODFRK        KLIST
     C                   KFLD                    YFRUNI
     C                   KFLD                    HEFR
     C     KODFTK        KLIST
     C                   KFLD                    XINFA1
     C                   KFLD                    YLN
     C     KODARK        KLIST
     C                   KFLD                    YARUNI
N01  C                   KFLD                    WSSDF
     C                   KFLD                    WSSDT
S06  C*          KODPBK    KLIST
S06  C*                    KFLD           YPBUNI
S06  C*                    KFLD           WSSDT
S06  C*          KODPFK    KLIST
S06  C*                    KFLD           YPFUNI
S06  C*                    KFLD           WSSDF
S06  C*                    KFLD           WSSDT
S06  C*                    KFLD           YFSN
     C     SAMLBK        KLIST
     C                   KFLD                    YSD
     C                   KFLD                    YLNR
     C     KODTAK        KLIST
     C                   KFLD                    YAUNI
     C                   KFLD                    UAVD
     C     AIRL1K        KLIST
     C                   KFLD                    WSFSNQ
     C                   KFLD                    WSSDF
     C                   KFLD                    WSSDT
E02  C                   KFLD                    WSRK1
      *                    KFLD           WSRK1   1
     C                   KFLD                    YRWEI             5 0
     C     AIR1K1        KLIST
     C                   KFLD                    WSFSNQ            3 0
     C                   KFLD                    WSSDF
     C                   KFLD                    WSSDT
E02  C                   KFLD                    WSRK1
      *                    KFLD           YRCOD
     C     LOGKY         KLIST
     C                   KFLD                    WREF2
     C                   KFLD                    WWMSID
S10  C*          AIRRAT    KLIST
S10  C*                    KFLD           WSFLY   30
S10  C*                    KFLD           WSSDF
S10  C*                    KFLD           WSSDT
S10  C*                    KFLD           WSRK1
      *
     C     *ENTRY        PLIST
     C                   PARM                    UFIRM             2
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD              5 0
     C                   PARM                    USTLF            15
     C                   PARM                    UKTLF            15
     C                   PARM                    UANRUT            1
     C                   PARM                    UFLYTM            1
     C                   PARM                    HØ
     C                   PARM                    LE
     C                   PARM                    BR
     C                   PARM                    AN
     C                   PARM                    UMSG             62
      *   (UFLAGG = 0)  =  KALLE FRA SYEF10 (REG. OPPDRAG)
      *   (UFLAGG = 1)  =  KALLE FRA SYFM21 (SPØRRING PÅ OPPDRAG)
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      27
      *
     C                   MOVE      'F'           YRI               1
     C                   MOVE      'Q'           YRIQ              1
S08  C*                    MOVE *ZEROS    NE
      *
     C     DOKEFK        CHAIN     DOKEF                              33
     C  N33              UPDATE    DOKEFR
      *
      * HVEN QUESTIONING RETURNS IF NOT FOUND
      *
     C   27
     CAN 33              MOVE      0             UFLAGG
     C   27
     CAN 33              SETON                                        LR
     C   27
     CAN 33              RETURN
      *
      *
     C                   MOVE      'FR'          YFRUNI            2
     C                   MOVE      'AR'          YARUNI            2
S06  C*                    MOVE 'PB'      YPBUNI  2
S06  C*                    MOVE 'PF'      YPFUNI  2
     C                   MOVE      'A'           YAUNI             1
     C                   MOVE      '/'           XTG1
     C                   MOVE      'x'           XTG2
     C                   MOVE      'x'           XTG3
     C                   MOVE      'CM'          XCM
     C                   Z-ADD     0             WSNTT
     C                   Z-ADD     0             WSVKTT
     C                   Z-ADD     0             WSFTOT            7 1
     C                   Z-ADD     0             WSBLT
     C                   Z-ADD     0             XWORK            15 4
     C     UFIRM         CHAIN     FIRM                               33
     C     HEADFK        CHAIN     HEADF                              33
     C     KODTAK        CHAIN     KODTA                              32
S06  C*          KODPBK    CHAINKODTPB               32
      * TAR ROUTING FRA SAMLAST HVIS SATT PÅ SAMLAST
     C     HEHAWB        COMP      *ZEROS                             4141
      * TAR ELLERS ANBEFALT ROUTING
     C     UANRUT        COMP      'J'                                    42
     C     KODFRK        CHAIN     KODTFR                             39
     C  N41
     CAN 42KODARK        CHAIN     KODTAR                             39
      *
     C                   MOVE      'M3='         M3FAS1
     C                   MOVEL     HEM3          M3FAS2
     C     M3FAS2        IFEQ      '0000'
     C                   MOVE      *BLANKS       M3FAS2
     C                   END
     C                   MOVE      ','           M3FAS3
     C                   MOVE      HEM3          M3FAS4
      *
      * CONSOLLIDATION   41
      *
     C   41XLNR          IFGT      '000'
     C     XLNR          ANDLE     '999'
     C                   MOVE      XLNR          YLNR              3 0
     C     SAMLBK        CHAIN     SAMLB                              33
     C                   END
     C     DOKEFK        CHAIN     DOKEF                              33
     C  N33              UPDATE    DOKEFR
     C                   MOVE      *IN33         *IN90
     C                   EXSR      MOVDFW
     C                   EXSR      UPDDIM
     C     DOKEQK        CHAIN     DOKEQ                              33
     C  N33              UPDATE    DOKEQR
     C  N33              EXSR      MOVDQW
     C   33              DO
     C                   MOVE      HENAK         WSNA
     C                   MOVE      HEADK1        WSAD1
     C                   MOVE      HEADK2        WSAD2
     C                   MOVE      HEADK3        WSAD3
     C                   END
     C                   MOVEL     WUSER         WWUSER           17
S10  C*                    MOVE 'B'       YRCCP   1
     C                   Z-ADD     0             X                 3 0
     C     *DTAARA       DEFINE    *LDA          LDADS
     C                   IN        LDADS
     C     UFLAGG        IFEQ      0
     C     DSTINF        ANDNE     *BLANKS
     C     *IN90         ANDEQ     '1'                                          <NY DOKEFR
     C                   MOVE      *OFF          *IN90
     C                   MOVEL     DSTINF        BUTINF
     C     BUTRA1        IFNE      *BLANKS
     C                   MOVEL     BUTRA1        WSROA1
     C                   MOVEL     BUTRB1        WSROB1
     C                   Z-ADD     BUTRC1        WSROC1
     C                   ENDIF                                                  <BUTRA1
     C     BUTRA2        IFNE      *BLANKS
     C                   MOVEL     BUTRA2        WSROA2
     C                   MOVEL     BUTRB2        WSROB2
     C                   Z-ADD     BUTRC2        WSROC2
     C                   ENDIF                                                  <BUTRA2
     C     BUTRA3        IFNE      *BLANKS
     C                   MOVEL     BUTRA3        WSROA3
     C                   MOVEL     BUTRB3        WSROB3
     C                   Z-ADD     BUTRC3        WSROC3
     C                   ENDIF                                                  <BUTRA3
     C                   ENDIF                                                  <UFLAGG
     C                   MOVEL     *BLANKS       BUTINF
     C                   MOVEL     *BLANKS       DSTINF
     C                   OUT       LDADS
     C     FITDVI        IFEQ      'J'
     C                   OPEN      LOGL05                               99
     C                   ENDIF
      *
     C                   MOVEL     'Marks/no'    MARKNO
     C                   MOVE      ':'           MARKNO
     C                   ENDSR
      *
N07   *////////////////////////////////////////////////////////////
N07   *////////////////////////////////////////////////////////////
N07   *  Prompt routing                                      SRF4 /
N07   *////////////////////////////////////////////////////////////
N07  C*          SRF4      BEGSR
N07   * Call to searchprogram
N07  C*                    CALL 'ABC01R'
N07  C*                    PARM           WIN03   1
N07  C*          WRESP     PARM           WRESP   1
N07  C*                    PARM WSSDF     WSSDF
N07  C*                    PARM WSSDT     WSSDT
N07  C*          WSROA1    PARM           WSROA1
N07  C*          WSROB1    PARM           WSROB1
N07  C*          WSROC1    PARM           WSROC1
N07  C*          WSROA2    PARM           WSROA2
N07  C*          WSROB2    PARM           WSROB2
N07  C*          WSROC2    PARM           WSROC2
N07  C*          WSROA3    PARM           WSROA3
N07  C*          WSROB3    PARM           WSROB3
N07  C*          WSROC3    PARM           WSROC3
N07  C*          POSNBR    IFGE 25
N07  C*          POSNBR    ANDLE27
N07  C*                    MOVE *BLANKS   UNVN   30
N07  C*                    MOVE *BLANKS   ULK     2
N07  C*                    MOVE *BLANKS   USD     5
N07  C*                    MOVELWSROA1    USD
N07  C*                    CALL 'SYFI10F'
N07  C*                    PARM           USD
N07  C*                    PARM           UNVN
N07  C*                    PARM           ULK
N07  C*          USD       IFNE *BLANKS
N07  C*                    MOVELUSD       WSROA1
N07  C*                    END
N07  C*                    Z-ADD29        POSNBR
N07  C*                    GOTO SLSRF4
N07  C*                    END
N07  C*          POSNBR    IFGE 43
N07  C*          POSNBR    ANDLE45
N07  C*                    MOVE *BLANKS   UNVN   30
N07  C*                    MOVE *BLANKS   ULK     2
N07  C*                    MOVE *BLANKS   USD     5
N07  C*                    MOVELWSROA2    USD
N07  C*                    CALL 'SYFI10F'
N07  C*                    PARM           USD
N07  C*                    PARM           UNVN
N07  C*                    PARM           ULK
N07  C*          USD       IFNE *BLANKS
N07  C*                    MOVELUSD       WSROA2
N07  C*                    END
N07  C*                    Z-ADD47        POSNBR
N07  C*                    GOTO SLSRF4
N07  C*                    END
N07  C*          POSNBR    IFGE 61
N07  C*          POSNBR    ANDLE63
N07  C*                    MOVE *BLANKS   UNVN   30
N07  C*                    MOVE *BLANKS   ULK     2
N07  C*                    MOVE *BLANKS   USD     5
N07  C*                    MOVELWSROA3    USD
N07  C*                    CALL 'SYFI10F'
N07  C*                    PARM           USD
N07  C*                    PARM           UNVN
N07  C*                    PARM           ULK
N07  C*          USD       IFNE *BLANKS
N07  C*                    MOVELUSD       WSROA3
N07  C*                    END
N07  C*                    Z-ADD65        POSNBR
N07  C*                    GOTO SLSRF4
N07  C*                    END
N07   *
N07  C*          SLSRF4    TAG
N07  C*                    ENDSR
N07   *////////////////////////////////////////////////////////////
N07   *  Prompt Rate Class Codes                                  /
N07   *////////////////////////////////////////////////////////////
N07  C*          SRF4RC    BEGSR
N07   * Call to searchprogram
N07  C*                    MOVE 'P'       PLUKK
N07  C*                    CALL 'SYFA74'
N07  C*                    PARM           PLUKK   1
N07  C*                    CALL 'SYFA74A'
N07  C*                    PARM           WRCCDE  1
N07  C*          WRCCDE    IFNE *BLANKS
N07  C*                    SELEC
N07  C*          LINNBR    WHEQ 13
N07  C*                    MOVE WRCCDE    RA,1
N07  C*          LINNBR    WHEQ 14
N07  C*                    MOVE WRCCDE    RA,2
N07  C*          LINNBR    WHEQ 15
N07  C*                    MOVE WRCCDE    RA,3
N07  C*          LINNBR    WHEQ 16
N07  C*                    MOVE WRCCDE    RA,4
N07  C*          LINNBR    WHEQ 17
N07  C*                    MOVE WRCCDE    RA,5
N07  C*          LINNBR    WHEQ 18
N07  C*                    MOVE WRCCDE    RA,6
N07  C*                    ENDSL
N07  C*                    ENDIF
N07  C*                    ENDSR
N07  C***********************************************
     C     TTSR          BEGSR
     C***********************************************
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      'STA'         TTACTI
     C                   MOVE      ULDT          TTDATE
     C                   MOVE      XULTM         TTTIME
     C                   MOVE      WUSER         TTUSER
     C                   MOVEL     'Airwaybi'    XXTE16           16
     C                   MOVE      'll enter'    XXTE16
     C                   MOVEL     XXTE16        XXTE32           32
     C                   MOVEL     'ed (int)'    XXTE16
     C                   MOVE      '        '    XXTE16
     C                   MOVE      XXTE16        XXTE32
     C                   MOVEL     XXTE32        TTTEXT
     C                   MOVEL     HEGN          TTTEXT
     C                   WRITE     TRACKFR
     C                   ENDSR
N03  C***********************************************
N03  C     FSC           BEGSR
N03  C***********************************************
N03   *
N03   * AUTOMATISK BEREGNING AV FUEL SURCHARGE
N03   *
N03  C                   Z-ADD     WSFUEL        WXFUEL            9 2
N03  C                   CLEAR                   DSDAT
N03  C                   MOVE      UYEAR         DSAAR
N03  C                   MOVEL     '20'          DSAAR
N03  C                   MOVE      UMONTH        DSMND
N03  C                   MOVE      UDAY          DSDAG
N03  C     KODFCK        KLIST
N03  C                   KFLD                    YFCUNI
N03  C                   KFLD                    WSFSN
N03  C                   MOVE      'FC'          YFCUNI            2
N03  C     KODFCK        CHAIN     KODTFC                             66
N03  C     *IN66         IFEQ      *OFF
N03   * SJEKK MINIMUMSVEKT
N03  C     KFCVKT        IFEQ      'A'
N03  C     WSVKT1        ANDLT     KFCMIN
N03  C                   SUB       WSFUEL        WSBLDC
N03  C                   Z-ADD     0             WSFUEL
N03  C                   MOVEL     *BLANKS       WSFT
N03  C                   MOVEL     *BLANKS       WYFT
N03  C                   GOTO      FSCSL
N03  C                   ENDIF                                                  <KFCVKT
N03  C     KFCVKT        IFEQ      'C'
N03  C     WSFBV1        ANDLT     KFCMIN
N03  C                   SUB       WSFUEL        WSBLDC
N03  C                   Z-ADD     0             WSFUEL
N03  C                   MOVEL     *BLANKS       WSFT
N03  C                   MOVEL     *BLANKS       WYFT
N03  C                   GOTO      FSCSL
N03  C                   ENDIF                                                  <KFCVKT
N03   * SJEKK LANDKODE - INCLUDE
N03  C     KFCIO1        IFEQ      'I'
N03  C     HELKA         IFNE      KFCLK1
N03  C     HELKA         ANDNE     KFCLK2
N03  C     HELKA         ANDNE     KFCLK3
N03  C     HELKA         ANDNE     KFCLK4
N03  C     HELKA         ANDNE     KFCLK5
N03  C                   GOTO      FSCSL
N03  C                   ENDIF                                                  <HELKA
N03  C                   ENDIF                                                  <KFCIO1
N03   * SJEKK LANDKODE - OMIT
N03  C     KFCIO1        IFEQ      'O'
N03  C     HELKA         IFEQ      KFCLK1
N03  C     HELKA         OREQ      KFCLK2
N03  C     HELKA         OREQ      KFCLK3
N03  C     HELKA         OREQ      KFCLK4
N03  C     HELKA         OREQ      KFCLK5
N03  C                   GOTO      FSCSL
N03  C                   ENDIF                                                  <HELKA
N03  C                   ENDIF                                                  <KFCIO1
N03   * SJEKK GYLDIGHETSDATO
N03  C     KFCTIL        IFEQ      *ZEROS
N03  C                   MOVE      99999999      KFCTIL
N03  C                   END
N03  C     DSDAT         IFLE      KFCTIL
N03  C     DSDAT         ANDGE     KFCFRA
N03   * SJEKK FRAKTBEREGNINGSVEKT ELLER AKTUELL VEKT
N03  C     KFCVKT        IFEQ      'A'
N03  C     WSVKT1        MULT      KFCAVG        WSFUEL            9 2
N03  C                   ELSE
N03  C     WSFBV1        MULT      KFCAVG        WSFUEL
N03  C                   ENDIF                                                  <DFCVKT
N03  C                   MOVE      WSFUEL        DSFUEL
N03  C                   MOVE      WSFUEL        DSFUEL
N03  C     DSF1          IFEQ      '0'
N03  C                   MOVE      ' '           DSF1
N03  C     DSF2          IFEQ      '0'
N03  C                   MOVE      ' '           DSF2
N03  C     DSF3          IFEQ      '0'
N03  C                   MOVE      ' '           DSF3
N03  C     DSF4          IFEQ      '0'
N03  C                   MOVE      ' '           DSF4
N03  C     DSF5          IFEQ      '0'
N03  C                   MOVE      ' '           DSF5
N03  C     DSF6          IFEQ      '0'
N03  C                   MOVE      ' '           DSF6
N03  C                   ENDIF                                                  <DSF6
N03  C                   ENDIF                                                  <DSF5
N03  C                   ENDIF                                                  <DSF4
N03  C                   ENDIF                                                  <DSF3
N03  C                   ENDIF                                                  <DSF2
N03  C                   ENDIF                                                  <DSF1
N03  C     WSCCPP        IFEQ      'CC'
N03  C                   MOVE      'C'           WSKDDC
N03  C                   ENDIF                                                  <WSCCPP
N03  C     WSCCPP        IFEQ      'PP'
N03  C                   MOVE      'P'           WSKDDC
N03  C                   ENDIF                                                  <WSCCPP
N03  C     WYFT          IFEQ      WSFT
N03  C     DSFHEL        CAT       ',':0         WSFT14           14
N03  C     WSFT14        CAT       DSFDES:0      WSFT14
N03  C     WSFT14        CAT       'NOK':1       WSFT14
N03  C     KFCFTX        CAT       WSFT14:1      WSFTNY           41
N03  C                   MOVEL     WSFTNY        WSFT
N03  C                   MOVEL     WSFTNY        WXFT             41
N03  C                   ENDIF                                                  <WYFT
N03  C                   MOVEL     WSFT          WYFT             41
N03  C                   SUB       WXFUEL        WSBLDC
N03  C                   ADD       WSFUEL        WSBLDC
N03  C                   Z-ADD     WSFUEL        WSFUEL
N03  C                   ENDIF                                                  <DSDAT
N03  C                   ENDIF                                                  <*IN66
N03  C     FSCSL         ENDSR
      ***    TABELL  (VG)
      *000044
      *000099
      *000299
      *000499
      *000999
      *099999
**    TABELL  (NAV)  ENDRING 03
JAN
FEB
MAR
APR
MAY
JUN
JUL
AUG
SEP
OCT
NOV
DEC
