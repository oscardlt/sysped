      *********************************************************************
CRTPG+*  CRTPGM SYSPED/TDKI002R MODULE(*LIBL/TDKI002R *LIBL/INCGI)
CRTPGM*        ACTGRP(*NEW) AUT(*USE)
      *********************************************************************
      /copy SYSPEDS/qrpgsrcpy,hspecs
      /copy SYSPEDS/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
     FDKIH      UF A E           K DISK    USROPN
     F                                     PREFIX(X)
     FDKIV1     IF A E           K DISK    USROPN
     FDKIA      UF   E           K DISK    USROPN
     FDKIF      O    E             DISK    USROPN
     FDKTHA2    IF   E           K DISK    USROPN
     FSAEH      IF   E           K DISK    USROPN
     FHEADF     UF   E           K DISK    USROPN
     FCUNDL01   IF   E           K DISK    USROPN
KING FKUNDL01   IF   E           K DISK    PREFIX(X_)
KING F                                     RENAME(KUNDR:KUNDRX)
     F                                     USROPN
     FFIRM      IF   E             DISK    USROPN
     FSYPARL1   IF   E           K DISK    USROPN
     FEDIC      UF   E             DISK    USROPN
     FDKTFI     IF   E             DISK    USROPN
     FEDIM      O  A E             DISK    USROPN
     FFRISOK    UF A E           K DISK    USROPN
     FFRISOL01  IF   E           K DISK    USROPN
     F                                     RENAME(FRISOKR:FRISOKRL)
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy SYSPEDS/qrpgsrcpy,prototypeb
      /copy SYSPEDS/qrpgsrcpy,usec
      /copy SYSPEDS/qrpgsrcpy,variables3
      *
      * Varible for
     D P               S              5U 0
     D WSUSER          S             10
     D DKIH_SYAVA      S              4
     D DKIH_SYAV       S              4  0
     D NEWSYAVA        S              4
     D NEWAVD          S              4  0
     D DKIH_SYOPA      S              7
     D DKIH_SYOP       S              7  0
     D NEWOPD          S              7  0
     D WMODE           S              2
     D WSIGN           S              3
     D NEWSIGN         S              3
     D DKIH_SYSG       S              3
     D DKIH_SYST       S              2
     D DKIH_0035       S              1
     D DKIH_1004       S             20
     D DKIH_XREF       S             35
     D DKIH_A          S              4
     D DKIH_DTM1       S             12S 0
     D DKIH_DTM2       S             12S 0
     D DKIH_AJOU       S              1
     D DKIH_ENSF       S              1
     D DKIH_BEGA       S             70
     D DKIH_BEGB       S             70
     D DKIH_BEGC       S             70
     D DKIH_BEGD       S             45
     D DKIH_R011       S              2
     D DKIH_R012       S              1
     D DKIH_AART       S              2
     D DKIH_AVKN       S              8S 0
     D DKIH_02A        S             18
     D DKIH_02B        S             35
     D DKIH_02C        S             35
     D DKIH_02D        S             35
     D DKIH_02E        S             35
     D DKIH_02F        S             35
     D DKIH_06         S              6S 0
     D DKIH_07A        S             13
     D DKIH_07B        S             13
     D DKIH_07C        S             13
     D DKIH_07D        S             35
     D DKIH_MOKN       S              8S 0
     D DKIH_08A        S             18
     D DKIH_08B        S             35
     D DKIH_08C        S             35
     D DKIH_08D        S             35
     D DKIH_08E        S             35
     D DKIH_08F        S             35
     D DKIH_REKN       S              8S 0
     D DKIH_REEO       S             18
     D DKIH_TRKN       S              8S 0
     D DKIH_TREO       S             18
     D DKIH_TRNA       S             35
     D DKIH_TRGA       S             35
     D DKIH_TRPO       S             35
     D DKIH_TRBY       S             35
     D DKIH_TRLK       S             35
     D DKIH_NIKN       S              8S 0
     D DKIH_NIEO       S             18
     D DKIH_NINA       S             35
     D DKIH_NIGA       S             35
     D DKIH_NIPO       S             35
     D DKIH_NIBY       S             35
     D DKIH_NILK       S             35
     D DKIH_12         S             15S 0
     D DKIH_12E        S             15S 0
     D DKIH_14A        S             18
     D DKIH_14B        S              1
     D DKIH_15         S              2
     D DKIH_S17        S             35
     D DKIH_S18        S             35
     D DKIH_S28        S             35
     D DKIH_S32        S              1
     D DKIH_181        S             20
N01  D DKIH_18A        S             17
     D DKIH_201        S              3
     D DKIH_202        S             35
     D DKIH_211        S              2
     D DKIH_221        S              3
     D DKIH_221B       S              7S 4
     D DKIH_221C       S              7S 0
     D DKIH_222        S             15S 0
     D DKIH_25         S              1
     D DKIH_26         S              1
     D DKIH_28A        S              4
     D DKIH_28B        S             17
     D DKIH_28C        S              8S 0
     D DKIH_S29        S              2
     D DKIH_301        S              2
     D DKIH_302        S             16
     D DKIH_303        S              3
     D DKIH_304        S              3
     D DKIH_49         S             17
     D DKIH_GENB       S              1
     D DKIH_BRUT       S             11S 0
     D DKIH_T04A       S             35
     D DKIH_T04B       S              8S 0
     D DKIH_T05A       S             35
     D DKIH_T05B       S              8S 0
     D DKIH_T06A       S             35
     D DKIH_T06B       S              8S 0
     D DKIH_T07A       S              1
     D DKIH_T07B       S              1
     D DKIH_T07C       S              1
     D DKIH_T07D       S             70
     D DKIH_T08A       S              1
     D DKIH_T08B       S              1
     D DKIH_T08C       S             70
     D DKIH_T09A       S              1
     D DKIH_T09B       S              1
     D WA              S             15
     D JSONstring      S          32000
     D Error           S            150

      *get input-string
      /copy syspeds/qrpgsrcpy,prolog3

      * Parse input
     C                   EXSR      Parse
      * Open files etc
     C                   EXSR      INIT
      *
     c                   callp     gethtmlifs(
     C                             '/syspeddev/html/JSON.html':
     C                             '/CGITAG/')
     C                   callp     wrtsection('top')
      * Teste input og utfør
     C  N50              EXSR      TEST

      * ............................................................................................
      * skriv JSON-Object start..(alltid '{' + x ant param. m/komma mellom (IKKE komma etter siste))
      * ............................................................................................
      *
      /free
        JSONstring='{'
        +'¬user¬ : ¬'+%trim(WSUSER)+'¬, '
        +'¬dkih_syav¬ : ¬'+%trim(%editc(DKIH_SYAV:'Z'))+'¬, '
        +'¬newavd¬ : ¬'+%trim(%editc(NEWAVD:'Z'))+'¬, '
        +'¬dkih_syop¬ : ¬'+%trim(%editc(DKIH_SYOP:'Z'))+'¬, '
        +'¬newopd¬ : ¬'+%trim(%editc(NEWOPD:'Z'))+'¬, '
        +'¬sign¬ : ¬'+%trim(WSIGN)+'¬, '
        +'¬newsign¬ : ¬'+%trim(NEWSIGN)+'¬, '
        +'¬mode¬ : ¬'+%trim(WMODE)+'¬, '
        +'¬errMsg¬ : ¬'+%trim(Error)+'¬, '
        +'¬dkih_14a¬ : ¬'+%trim(DKIA_14A)+'¬, '
        +'¬dkih_14b¬ : ¬'+%trim(DKIA_14B)+'¬, '
        +'¬dkia_0035¬ : ¬'+%trim(DKIA_0035)+'¬, ';
      /end-free
      * JSONfix escaper " i tekst,  for deretter å bytte ¬->"
     c                   call      'JSONFIX'
     c                   parm                    JSONstring
     C                   callp     updHTMLvar('JSONstring':JSONstring)
     C                   callp     wrtsection('JSONlin')
      *
      * ............................................................................................
      * Skriv JSON-LISTE Start (en liste er EN parameter(fra [ til   )
      * ............................................................................................
     c                   eval      JSONstring ='"orderupdate" : ['
     C                   callp     updHTMLvar('JSONstring':JSONstring)
     C                   callp     wrtsection('JSONlin')
      * ............................................................................................
      * Skriv JSON-Liste/Array  Avslutning
      * ............................................................................................
     c                   eval      JSONstring =']'
     C                   callp     updHTMLvar('JSONstring':JSONstring)
     C                   callp     wrtsection('JSONlin')
      * ............................................................................................
      * Skriv JSON-string Avsluttning
      * ............................................................................................
     c                   eval      JSONstring ='}'
     C                   callp     updHTMLvar('JSONstring':JSONstring)
     C                   callp     wrtsection('JSONlin')
      *
      * Quit
     C                   exsr      Exit


      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Lukk fil
     C                   CLOSE     BRIDF
     C  N50              CLOSE     DKIH
     C  N50              CLOSE     DKIV1
     C  N50              CLOSE     DKIA
     C  N50              CLOSE     DKTHA2
     C  N50              CLOSE     SAEH
     C  N50              CLOSE     HEADF
     C  N50              CLOSE     CUNDL01
     C  N50              CLOSE     KUNDL01
     C  N50              CLOSE     FIRM
     C  N50              CLOSE     DKIF
     C  N50              CLOSE     SYPARL1
     C  N50              CLOSE     EDIC
     C  N50              CLOSE     DKTFI
     C  N50              CLOSE     EDIM
     C  N50              CLOSE     FRISOK
     C  N50              CLOSE     FRISOL01

      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      * Quit
     C                   MOVE      *ON           *INLR
     C                   return
     C                   endsr
      *
      *********************************************************
     C     Parse         Begsr
      *********************************************************
      * Get input
     C                   EVAL      WSUSER  = zhbgetvar('USER')
     C                   EVAL      DKIH_SYAVA = zhbgetvar('AVD')
     C                   EVAL      DKIH_SYAV  = c2n2(DKIH_SYAVA)
     C                   EVAL      NEWSYAVA = zhbgetvar('NEWAVD')
     C                   EVAL      NEWAVD  = c2n2(NEWSYAVA)
     C                   EVAL      DKIH_SYOPA = zhbgetvar('OPD')
     C                   EVAL      DKIH_SYOP  = c2n2(DKIH_SYOPA)
     C                   EVAL      WMODE  = zhbgetvar('MODE')
     C                   EVAL      DKIH_SYSG  = zhbgetvar('DKIH_SYSG')
     C                   EVAL      WSIGN      = zhbgetvar('SIGN')
     C                   EVAL      NEWSIGN      = zhbgetvar('NEWSIGN')
     C                   EVAL      DKIH_SYST  = zhbgetvar('DKIH_SYST')
     C                   EVAL      DKIH_0035  = zhbgetvar('DKIH_0035')
     C                   EVAL      DKIH_1004  = zhbgetvar('DKIH_1004')
     C                   EVAL      DKIH_XREF  = zhbgetvar('DKIH_XREF')
     C                   EVAL      DKIH_A     = zhbgetvar('DKIH_A')
     C                   EVAL      WA         = zhbgetvar('DKIH_DTM1')
     C                   EVAL      DKIH_DTM1  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKIH_DTM2')
     C                   EVAL      DKIH_DTM2  = c2n2(WA)
     C                   EVAL      DKIH_AJOU  = zhbgetvar('DKIH_AJOU')
     C                   EVAL      DKIH_ENSF  = zhbgetvar('DKIH_ENSF')
     C                   EVAL      DKIH_BEGA  = zhbgetvar('DKIH_BEGA')
     C                   EVAL      DKIH_BEGB  = zhbgetvar('DKIH_BEGB')
     C                   EVAL      DKIH_BEGC  = zhbgetvar('DKIH_BEGC')
     C                   EVAL      DKIH_BEGD  = zhbgetvar('DKIH_BEGD')
     C                   EVAL      DKIH_R011  = zhbgetvar('DKIH_R011')
     C                   EVAL      DKIH_R012  = zhbgetvar('DKIH_R012')
     C                   EVAL      DKIH_AART  = zhbgetvar('DKIH_AART')
     C                   EVAL      WA         = zhbgetvar('DKIH_AVKN')
     C                   EVAL      DKIH_AVKN  = c2n2(WA)
     C                   EVAL      DKIH_02A   = zhbgetvar('DKIH_02A')
     C                   EVAL      DKIH_02B   = zhbgetvar('DKIH_02B')
     C                   EVAL      DKIH_02C   = zhbgetvar('DKIH_02C')
     C                   EVAL      DKIH_02D   = zhbgetvar('DKIH_02D')
     C                   EVAL      DKIH_02E   = zhbgetvar('DKIH_02E')
     C                   EVAL      DKIH_02F   = zhbgetvar('DKIH_02F')
     C                   EVAL      WA         = zhbgetvar('DKIH_06')
     C                   EVAL      DKIH_06    = c2n2(WA)
     C                   EVAL      DKIH_07A   = zhbgetvar('DKIH_07A')
     C                   EVAL      DKIH_07B   = zhbgetvar('DKIH_07B')
     C                   EVAL      DKIH_07C   = zhbgetvar('DKIH_07C')
     C                   EVAL      DKIH_07D   = zhbgetvar('DKIH_07D')
     C                   EVAL      WA         = zhbgetvar('DKIH_MOKN')
     C                   EVAL      DKIH_MOKN  = c2n2(WA)
     C                   EVAL      DKIH_08A   = zhbgetvar('DKIH_08A')
     C                   EVAL      DKIH_08B   = zhbgetvar('DKIH_08B')
     C                   EVAL      DKIH_08C   = zhbgetvar('DKIH_08C')
     C                   EVAL      DKIH_08D   = zhbgetvar('DKIH_08D')
     C                   EVAL      DKIH_08E   = zhbgetvar('DKIH_08E')
     C                   EVAL      DKIH_08F   = zhbgetvar('DKIH_08F')
     C                   EVAL      WA         = zhbgetvar('DKIH_REKN')
     C                   EVAL      DKIH_REKN  = c2n2(WA)
     C                   EVAL      DKIH_REEO  = zhbgetvar('DKIH_REEO')
     C                   EVAL      WA         = zhbgetvar('DKIH_TRKN')
     C                   EVAL      DKIH_TRKN  = c2n2(WA)
     C                   EVAL      DKIH_TREO  = zhbgetvar('DKIH_TREO')
     C                   EVAL      DKIH_TRNA  = zhbgetvar('DKIH_TRNA')
     C                   EVAL      DKIH_TRGA  = zhbgetvar('DKIH_TRGA')
     C                   EVAL      DKIH_TRPO  = zhbgetvar('DKIH_TRPO')
     C                   EVAL      DKIH_TRBY  = zhbgetvar('DKIH_TRBY')
     C                   EVAL      DKIH_TRLK  = zhbgetvar('DKIH_TRLK')
     C                   EVAL      WA         = zhbgetvar('DKIH_NIKN')
     C                   EVAL      DKIH_NIKN  = c2n2(WA)
     C                   EVAL      DKIH_NIEO  = zhbgetvar('DKIH_NIEO')
     C                   EVAL      DKIH_NINA  = zhbgetvar('DKIH_NINA')
     C                   EVAL      DKIH_NIGA  = zhbgetvar('DKIH_NIGA')
     C                   EVAL      DKIH_NIPO  = zhbgetvar('DKIH_NIPO')
     C                   EVAL      DKIH_NIBY  = zhbgetvar('DKIH_NIBY')
     C                   EVAL      DKIH_NILK  = zhbgetvar('DKIH_NILK')
     C                   EVAL      WA         = zhbgetvar('DKIH_12')
     C                   EVAL      DKIH_12    = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKIH_12E')
     C                   EVAL      DKIH_12E   = c2n2(WA)
     C                   EVAL      DKIH_14A   = zhbgetvar('DKIH_14A')
     C                   EVAL      DKIH_14B   = zhbgetvar('DKIH_14B')
     C                   EVAL      DKIH_15    = zhbgetvar('DKIH_15')
     C                   EVAL      DKIH_S17   = zhbgetvar('DKIH_S17')
     C                   EVAL      DKIH_S18   = zhbgetvar('DKIH_S18')
     C                   EVAL      DKIH_S28   = zhbgetvar('DKIH_S28')
     C                   EVAL      DKIH_S32   = zhbgetvar('DKIH_S32')
     C                   EVAL      DKIH_181   = zhbgetvar('DKIH_181')
N01  C                   EVAL      DKIH_18A   = zhbgetvar('DKIH_18A')
     C                   EVAL      DKIH_201   = zhbgetvar('DKIH_201')
     C                   EVAL      DKIH_202   = zhbgetvar('DKIH_202')
     C                   EVAL      DKIH_211   = zhbgetvar('DKIH_211')
     C                   EVAL      DKIH_221   = zhbgetvar('DKIH_221')
     C                   EVAL      WA         = zhbgetvar('DKIH_221B')
     C                   EVAL      DKIH_221B  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKIH_221C')
     C                   EVAL      DKIH_221C  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKIH_222')
     C                   EVAL      DKIH_222   = c2n2(WA)
     C                   EVAL      DKIH_25    = zhbgetvar('DKIH_25')
     C                   EVAL      DKIH_26    = zhbgetvar('DKIH_26')
     C                   EVAL      DKIH_28A   = zhbgetvar('DKIH_28A')
     C                   EVAL      DKIH_28B   = zhbgetvar('DKIH_28B')
     C                   EVAL      WA         = zhbgetvar('DKIH_28C')
     C                   EVAL      DKIH_28C   = c2n2(WA)
     C                   EVAL      DKIH_S29   = zhbgetvar('DKIH_S29')
     C                   EVAL      DKIH_301   = zhbgetvar('DKIH_301')
     C                   EVAL      DKIH_302   = zhbgetvar('DKIH_302')
     C                   EVAL      DKIH_303   = zhbgetvar('DKIH_303')
     C                   EVAL      DKIH_304   = zhbgetvar('DKIH_304')
     C                   EVAL      DKIH_49    = zhbgetvar('DKIH_49')
     C                   EVAL      WA         = zhbgetvar('DKIH_BRUT')
     C                   EVAL      DKIH_GENB  = zhbgetvar('DKIH_GENB')
     C                   EVAL      DKIH_BRUT  = c2n2(WA)
     C                   EVAL      DKIH_T04A  = zhbgetvar('DKIH_T04A')
     C                   EVAL      WA         = zhbgetvar('DKIH_T04B')
     C                   EVAL      DKIH_T04B  = c2n2(WA)
     C                   EVAL      DKIH_T05A  = zhbgetvar('DKIH_T05A')
     C                   EVAL      WA         = zhbgetvar('DKIH_T05B')
     C                   EVAL      DKIH_T05B  = c2n2(WA)
     C                   EVAL      DKIH_T06A  = zhbgetvar('DKIH_T06A')
     C                   EVAL      WA         = zhbgetvar('DKIH_T06B')
     C                   EVAL      DKIH_T06B  = c2n2(WA)
     C                   EVAL      DKIH_T07A  = zhbgetvar('DKIH_T07A')
     C                   EVAL      DKIH_T07B  = zhbgetvar('DKIH_T07B')
     C                   EVAL      DKIH_T07C  = zhbgetvar('DKIH_T07C')
     C                   EVAL      DKIH_T07D  = zhbgetvar('DKIH_T07D')
     C                   EVAL      DKIH_T08A  = zhbgetvar('DKIH_T08A')
     C                   EVAL      DKIH_T08B  = zhbgetvar('DKIH_T08B')
     C                   EVAL      DKIH_T08C  = zhbgetvar('DKIH_T08C')
     C                   EVAL      DKIH_T09A  = zhbgetvar('DKIH_T09A')
     C                   EVAL      DKIH_T09B  = zhbgetvar('DKIH_T09B')
     C                   ENDSR
      *********************************************************
     C     INIT          Begsr
      *********************************************************
     C                   OPEN      BRIDF
      * Test innlogging
     C     WSUSER        CHAIN     BRIDF                              50
     C  N50BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C                   call      BILIBL
     C                   end
      *
     C     DKIHKey       klist
     C                   kfld                    DKIH_SYAV
     C                   kfld                    DKIH_SYOP
     C     FRIKEY        klist
     C                   kfld                    DKIH_SYAV
     C                   kfld                    DKIH_SYOP
     C                   KFLD                    WFSKODE           3
     C     FRIKEY01      KLIST
     C                   KFLD                    WFSKODE
     C                   KFLD                    DKIH_XREF
     C     CUNDL01K      KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C     SYPARKEY      KLIST
     C                   KFLD                    WSYKUNR
     C                   KFLD                    WSYPAID
     C     *LIKE         DEFINE    DKIH_08E      W_PADR
     C     *LIKE         DEFINE    SYKUNR        WSYKUNR
     C     *LIKE         DEFINE    SYPAID        WSYPAID
     C                   EVAL      WSYPAID='DKMVA'
     C                   EVAL      WFSKODE='*CR'
      *
     C   50              eval      Error = 'Invalid userID'
     C  N50              OPEN      DKIH
     C  N50              OPEN      DKIV1
     C  N50              OPEN      DKIA
     C  N50              OPEN      DKTHA2
     C  N50              OPEN      SAEH
     C  N50              OPEN      HEADF
     C  N50              OPEN      CUNDL01
     C  N50              OPEN      KUNDL01
     C  N50              OPEN      FIRM
     C  N50              OPEN      DKIF
     C  N50              OPEN      SYPARL1
     C  N50              OPEN      EDIC
     C  N50              OPEN      DKTFI
     C  N50              OPEN      EDIM
     C  N50              OPEN      FRISOK
     C  N50              OPEN      FRISOL01
      *_________________________________
      * Hæmta dagens datum och klockslag
      *"""""""""""""""""""""""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
      * Hæmta firmaopplysninger
     C  N50              READ      FIRM
      * MODE=GS
     C     WMODE         IFEQ      'GS'
     C     DKIH_XREF     ANDNE     *BLANKS
     C     *IN50         ANDEQ     *OFF
     C     FRIKEY01      CHAIN     FRISOL01                           56
     C                   IF        *IN56=*OFF
     C                   EVAL      DKIH_SYAV=FSAVD
     C                   EVAL      DKIH_SYOP=FSOPD
     C                   ENDIF
     C                   ENDIF

     c                   endsr
      *
      *______________________________________________________
      * TEST                                             TEST
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     TEST          BEGSR
      * Hæmta userid
     C     WSUSER        CHAIN     DKTHA2
      * Hæmta ærende
     C     WMODE         IFNE      'A'
     C     DKIHKey       CHAIN     DKIH                               55
     C                   ENDIF
      * MODE A=Add  D=Delete  U=Update  S=Skicka  C=Copy  GS=Hæmta från SYSPED
     C                   SELECT
     C     WMODE         WHENEQ    'A'
     C                   eval      Error = *blanks
     C                   EXSR      SRA
     C     WMODE         WHENEQ    'GS'
     C                   eval      Error = *blanks
     C  N55              eval      Error = 'Fel, finns redan'
     C   55              EXSR      SRGS
     C     WMODE         WHENEQ    'C'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   UPDATE    DKIHR
     C                   eval      Error = *blanks
     C                   EXSR      SRC
     C                   ENDIF
     C     WMODE         WHENEQ    'D'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   eval      Error = *blanks
     C                   EXSR      SRD
     C                   ENDIF
     C     WMODE         WHENEQ    'S'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   eval      Error = *blanks
     C                   EXSR      SRS
     C                   ENDIF
     C     WMODE         WHENEQ    'U'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   eval      Error = *blanks
     C                   EXSR      SRU
     C                   ENDIF
     C                   OTHER
     C                   eval      Error = 'Wrong mode'
     C                   ENDSL
     C                   ENDSR
      *______________________________________________________
      * Add                                               SRA
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRA           BEGSR
     C                   CLEAR                   DKIHR
      * Hæmta uppdragsnummer
     C     DKIH_SYAV     CHAIN     DKIA                               52
     C                   ADD       1             DKIA_SYOP
     C                   UPDATE    DKIAR
     C                   EVAL      XDKIH_SYAV=DKIH_SYAV
     C                   EVAL      DKIH_SYOP=DKIA_SYOP
     C                   EVAL      XDKIH_SYOP=DKIH_SYOP
     C                   EVAL      XDKIH_SYSG=WSIGN
     C                   EVAL      XDKIH_GENB='1'
     C                   MOVEL     WDT           XDKIH_SYDT
      * Write
     C                   WRITE     DKIHR
     C                   ENDSR
      *______________________________________________________
      * Delete                                            SRD
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRD           BEGSR
     C                   EVAL      XDKIH_SYST='D '
     C                   UPDATE    DKIHR
     C                   ENDSR
      *______________________________________________________
      * Skicka                                            SRS
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRS           BEGSR
     C                   eval      Error = *blanks
      * Tvungen testindikator ?
     C     XDKIH_0035    IFEQ      *BLANKS
     C     XDKIH_SYAV    CHAIN(N)  DKIA
     C     DKIA_0035     IFNE      *BLANKS
     C                   EVAL      XDKIH_0035=DKIA_0035
     C                   ENDIF
     C                   ENDIF
      * Ændra status
     C                   EVAL      XDKIH_SYST='A '
     C                   UPDATE    DKIHR
      * Hæmta firmaupplysningar
     C     1             CHAIN     DKTFI                              51
      * Hæmta næsta meddelandenummer
     C     1             CHAIN     EDIC                               51
     C                   ADD       1             CMN
     C                   UPDATE    EDICR
      * Hæmta dagens datum och klockslag
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
      * Skriv til EDIM
     C                   CLEAR                   EDIMR
     C                   EVAL      M0004=DKTF_0004T
     C                   EVAL      M0010=DKTF_0010T
     C                   EVAL      M0035=XDKIH_0035
     C                   MOVEL     DKIH_SYAV     W0062            11
     C                   MOVE      DKIH_SYOP     W0062
     C                   EVAL      M0062=W0062
     C                   EVAL      M0065='CUSDEC'
     C                   EVAL      M1001=XDKIH_AART
     C                   EVAL      M1004=XDKIH_1004
     C                   EVAL      M1225=XDKIH_AART
     C                   EVAL      M1N07='DKI'
     C                   EVAL      MMN=CMN
     C                   EVAL      MSR='S'
     C                   MOVEL     WDT           MDT
     C                   MOVEL     WTM           MTM
     C                   EVAL      MAVD=DKIH_SYAV
     C                   EVAL      MTDN=DKIH_SYOP

     C                   WRITE     EDIMR
     C                   ENDSR
      *______________________________________________________
      * Update                                            SRU
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRU           BEGSR
     C                   EVAL      XDKIH_SYST = DKIH_SYST
     C                   EVAL      XDKIH_0035 = DKIH_0035
     C                   EVAL      XDKIH_1004 = DKIH_1004
     C                   EVAL      XDKIH_A    = DKIH_A
     C                   EVAL      XDKIH_DTM1 = DKIH_DTM1
     C                   EVAL      XDKIH_DTM2 = DKIH_DTM2
     C                   EVAL      XDKIH_AJOU = DKIH_AJOU
     C                   EVAL      XDKIH_ENSF = DKIH_ENSF
     C                   EVAL      XDKIH_BEGA = DKIH_BEGA
     C                   EVAL      XDKIH_BEGB = DKIH_BEGB
     C                   EVAL      XDKIH_BEGC = DKIH_BEGC
     C                   EVAL      XDKIH_BEGD = DKIH_BEGD
     C                   EVAL      XDKIH_R011 = DKIH_R011
     C                   EVAL      XDKIH_R012 = DKIH_R012
     C                   EVAL      XDKIH_AART = DKIH_AART
     C                   EVAL      XDKIH_AVKN = DKIH_AVKN
     C                   EVAL      XDKIH_02A  = DKIH_02A
     C                   EVAL      XDKIH_02B  = DKIH_02B
     C                   EVAL      XDKIH_02C  = DKIH_02C
     C                   EVAL      XDKIH_02D  = DKIH_02D
     C                   EVAL      XDKIH_02E  = DKIH_02E
     C                   EVAL      XDKIH_02F  = DKIH_02F
     C                   EVAL      XDKIH_06   = DKIH_06
     C                   EVAL      XDKIH_07A  = DKIH_07A
     C                   EVAL      XDKIH_07B  = DKIH_07B
     C                   EVAL      XDKIH_07C  = DKIH_07C
     C                   EVAL      XDKIH_07D  = DKIH_07D
     C                   EVAL      XDKIH_MOKN = DKIH_MOKN
     C                   EVAL      XDKIH_08A  = DKIH_08A
     C                   EVAL      XDKIH_08B  = DKIH_08B
     C                   EVAL      XDKIH_08C  = DKIH_08C
     C                   EVAL      XDKIH_08D  = DKIH_08D
     C                   EVAL      XDKIH_08E  = DKIH_08E
     C                   EVAL      XDKIH_08F  = DKIH_08F
     C                   EVAL      XDKIH_REKN = DKIH_REKN
     C                   EVAL      XDKIH_REEO = DKIH_REEO
     C                   EVAL      XDKIH_TRKN = DKIH_TRKN
     C                   EVAL      XDKIH_TREO = DKIH_TREO
     C                   EVAL      XDKIH_TRNA = DKIH_TRNA
     C                   EVAL      XDKIH_TRGA = DKIH_TRGA
     C                   EVAL      XDKIH_TRPO = DKIH_TRPO
     C                   EVAL      XDKIH_TRBY = DKIH_TRBY
     C                   EVAL      XDKIH_TRLK = DKIH_TRLK
     C                   EVAL      XDKIH_NIKN = DKIH_NIKN
     C                   EVAL      XDKIH_NIEO = DKIH_NIEO
     C                   EVAL      XDKIH_NINA = DKIH_NINA
     C                   EVAL      XDKIH_NIGA = DKIH_NIGA
     C                   EVAL      XDKIH_NIPO = DKIH_NIPO
     C                   EVAL      XDKIH_NIBY = DKIH_NIBY
     C                   EVAL      XDKIH_NILK = DKIH_NILK
     C                   EVAL      XDKIH_12   = DKIH_12
     C                   EVAL      XDKIH_12E  = DKIH_12E
     C                   EVAL      XDKIH_14A  = DKIH_14A
     C                   EVAL      XDKIH_14B  = DKIH_14B
     C                   EVAL      XDKIH_15   = DKIH_15
     C                   EVAL      XDKIH_S17  = DKIH_S17
     C                   EVAL      XDKIH_S18  = DKIH_S18
     C                   EVAL      XDKIH_S28  = DKIH_S28
     C                   EVAL      XDKIH_S32  = DKIH_S32
     C                   EVAL      XDKIH_181  = DKIH_181
N01  C                   EVAL      XDKIH_18A  = DKIH_18A
     C                   EVAL      XDKIH_201  = DKIH_201
     C                   EVAL      XDKIH_202  = DKIH_202
     C                   EVAL      XDKIH_211  = DKIH_211
     C                   EVAL      XDKIH_221  = DKIH_221
     C                   EVAL      XDKIH_221B = DKIH_221B
     C                   EVAL      XDKIH_221C = DKIH_221C
     C                   EVAL      XDKIH_222  = DKIH_222
     C                   EVAL      XDKIH_25   = DKIH_25
     C                   EVAL      XDKIH_26   = DKIH_26
     C                   EVAL      XDKIH_28A  = DKIH_28A
     C                   EVAL      XDKIH_28B  = DKIH_28B
     C                   EVAL      XDKIH_28C  = DKIH_28C
     C                   EVAL      XDKIH_S29  = DKIH_S29
     C                   EVAL      XDKIH_301  = DKIH_301
     C                   EVAL      XDKIH_302  = DKIH_302
     C                   EVAL      XDKIH_303  = DKIH_303
     C                   EVAL      XDKIH_304  = DKIH_304
     C                   EVAL      XDKIH_49   = DKIH_49
     C                   EVAL      XDKIH_BRUT = DKIH_BRUT
     C                   EVAL      XDKIH_GENB = DKIH_GENB
     C                   EVAL      XDKIH_T04A = DKIH_T04A
     C                   EVAL      XDKIH_T04B = DKIH_T04B
     C                   EVAL      XDKIH_T05A = DKIH_T05A
     C                   EVAL      XDKIH_T05B = DKIH_T05B
     C                   EVAL      XDKIH_T06A = DKIH_T06A
     C                   EVAL      XDKIH_T06B = DKIH_T06B
     C                   EVAL      XDKIH_T07A = DKIH_T07A
     C                   EVAL      XDKIH_T07B = DKIH_T07B
     C                   EVAL      XDKIH_T07C = DKIH_T07C
     C                   EVAL      XDKIH_T07D = DKIH_T07D
     C                   EVAL      XDKIH_T08A = DKIH_T08A
     C                   EVAL      XDKIH_T08B = DKIH_T08B
     C                   EVAL      XDKIH_T08C = DKIH_T08C
     C                   EVAL      XDKIH_T09A = DKIH_T09A
     C                   EVAL      XDKIH_T09B = DKIH_T09B
     C                   UPDATE    DKIHR
      * Omberegn alle vareposter med hensyn til statistisk værdi + tv
      * Fjernet 6/10.-2014 og erstattet med manuell knapp fra WEB
     C                   MOVE      DKIH_SYAV     DKIH_SYAVA
     C                   MOVE      DKIH_SYOP     DKIH_SYOPA
     C*                  CALL      'DKI071R'
     C*                  PARM                    DKIH_SYAVA
     C*                  PARM                    DKIH_SYOPA
      * Legg ut frie søkeveier
     C     FRIKEY        DELETE    FRISOK                             56
     C     DKIH_XREF     IFNE      *BLANKS
     C                   CLEAR                   FRISOKR
     C                   EVAL      FSAVD=DKIH_SYAV
     C                   EVAL      FSOPD=DKIH_SYOP
     C                   EVAL      FSKODE='*CR'
     C                   EVAL      FSSOK=DKIH_XREF
     C                   MOVE      WDT           FSDTOP
     C                   WRITE     FRISOKR
     C                   ENDIF
     C                   ENDSR
      *______________________________________________________
      * Copy                                              SRC
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRC           BEGSR
     C                   EVAL      WSIGN=DKIH_SYSG
     C* Hæmta uppdragsnummer
     C     NEWAVD        CHAIN     DKIA                               52
     C                   ADD       1             DKIA_SYOP
     C                   UPDATE    DKIAR
     C                   EVAL      XDKIH_SYAV=NEWAVD
     C                   EVAL      XDKIH_SYOP=DKIA_SYOP
     C                   EVAL      NEWOPD=DKIA_SYOP
     C                   EVAL      XDKIH_SYSG=NEWSIGN
     C                   MOVEL     WDT           XDKIH_SYDT
     C                   EVAL      XDKIH_14A=DKIA_14A
     C                   EVAL      XDKIH_14B=DKIA_14B
     C                   EVAL      XDKIH_SYST=*BLANKS
     C                   EVAL      XDKIH_DTM1=*ZEROS
     C                   EVAL      XDKIH_DTM2=*ZEROS
     C                   EVAL      XDKIH_AJOU=*BLANKS
     C                   EVAL      XDKIH_07=*BLANKS
     C                   EVAL      XDKIH_T04A=*BLANKS
     C                   EVAL      XDKIH_T04B=*ZEROS
     C                   EVAL      XDKIH_T05A=*BLANKS
     C                   EVAL      XDKIH_T05B=*ZEROS
     C                   EVAL      XDKIH_T06A=*BLANKS
     C                   EVAL      XDKIH_T06B=*ZEROS
     C                   EVAL      XDKIH_T07A=*BLANKS
     C                   EVAL      XDKIH_T07B=*BLANKS
     C                   EVAL      XDKIH_T07C=*BLANKS
     C                   EVAL      XDKIH_T07D=*BLANKS
     C                   EVAL      XDKIH_T08A=*BLANKS
     C                   EVAL      XDKIH_T08B=*BLANKS
     C                   EVAL      XDKIH_T08C=*BLANKS
     C                   EVAL      XDKIH_T09A=*BLANKS
     C                   EVAL      XDKIH_T09B=*BLANKS
     C                   EVAL      XDKIH_1004=*BLANKS
     C                   EVAL      XDKIH_07C=*BLANKS
     C                   EVAL      XDKIH_GENB='1'
      * Write
     C                   WRITE     DKIHR
      * Kopiera också varuposter
     C                   EVAL      *IN52=*OFF
     C     DKIHKey       SETLL     DKIV1
     C     DKIHKey       READE     DKIV1                                  52
     C     *IN52         DOWEQ     *OFF

     C                   EVAL      DKIV_SYAV=NEWAVD
     C                   EVAL      DKIV_SYOP=NEWOPD
     C                   WRITE     DKIVR

     C     DKIHKey       READE     DKIV1                                  52
     C                   ENDDO
     C                   ENDSR
      *______________________________________________________
      * Hæmta från SAD Export, SYSPED op, eller DKI      SRGS
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRGS          BEGSR
      * Finnes SAD Export ?
     C     DKihKey       CHAIN     SAEH                               53
      * Finnes SYSPED Oppdrag ?
     C     DKihKey       CHAIN(N)  HEADF                              54
      * Fel, finns inte varken sad eksport eller sysped uppdrag
     C                   IF        *IN53
     C                   IF        *IN54
     C                   eval      Error = 'Order not found'
     C                   GOTO      SRGS9
     C                   ENDIF
     C                   ENDIF
      * Skapa gemensam information
     C     DKIH_SYAV     CHAIN(N)  DKIA                               52
     C                   EVAL      XDKIH_SYAV=DKIH_SYAV
     C                   EVAL      XDKIH_SYOP=DKIH_SYOP
     C                   EVAL      XDKIH_SYSG=WSIGN
     C                   MOVEL     WDT           XDKIH_SYDT
     C                   EVAL      XDKIH_14A=DKIA_14A
     C                   EVAL      XDKIH_14B=DKIA_14B

     C                   EVAL      XDKIH_AART='04'
     C                   EVAL      XDKIH_R011='EU'
     C                   EVAL      XDKIH_R012='A'
     C                   EVAL      XDKIH_GENB='1'
     C                   EVAL      XDKIH_A='5600'
     C                   EVAL      XDKIH_S29='Y'
     C                   EVAL      XDKIH_28A='N380'
      * Hæmta från SAD Export
     C  N53              EXSR      SRGSS
      * Hæmta från SYSPED oppdrag
     C   53              EXSR      SRGSO
      * Write
     C                   WRITE     DKIHR
     C     SRGS9         ENDSR
      *______________________________________________________
      * Hæmta från SAD Export                           SRGSS
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRGSS         BEGSR
     C                   EVAL      XDKIH_AVKN=SEKNK
     C                   EVAL      XDKIH_02B=SENAK
     C                   EVAL      XDKIH_02C=SEADK1
     C                   EVAL      P = %SCAN (' ' : SEADK3)
     C                   EVAL      XDKIH_02D=%SUBST(SEADK3:1:P)
     C                   EVAL      W_PADR=%SUBST(SEADK3:P+1)
     C                   EVAL      XDKIH_02E=%triml(W_PADR)
     C                   EVAL      XDKIH_02F='NO'
      * Spesial kingsrød, hent avs. oppl fra kundereg uansett
     C     XDKIH_AVKN    IFNE      0
     C                   MOVE      XDKIH_AVKN    KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            35
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN35=*OFF
     C                   EVAL      XDKIH_02B = KNAVN
     C                   EVAL      XDKIH_02C = ADR1
     C                   IF        POSTNR = 0

     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XDKIH_02D=%SUBST(SYPOGE:P:Q)

     C                   ELSE
     C                   EVAL      XDKIH_02D = *BLANKS
     C                   MOVEL     POSTNR        XDKIH_02D
     C                   ENDIF
     C                   MOVEL     ADR3          XDKIH_02E
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XDKIH_02F = SYLAND
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C                   EVAL      XDKIH_MOKN=SEKNS
     C                   EVAL      XDKIH_08B=SENAS
     C                   EVAL      XDKIH_08C=SEADS1
     C                   EVAL      P = %SCAN (' ' : SEADS3)
     C                   EVAL      XDKIH_08D=%SUBST(SEADS3:1:P)
     C                   EVAL      W_PADR=%SUBST(SEADS3:P+1)
     C                   EVAL      XDKIH_08E=%triml(W_PADR)
     C                   EVAL      XDKIH_08F=SELKB
     C                   EVAL      XDKIH_14A=DKIA_14A
     C                   EVAL      XDKIH_14B=DKIA_14B
     C                   EVAL      XDKIH_15='NO'
     C                   EVAL      XDKIH_221=SEVAL1
     C                   EVAL      XDKIH_222=SEBEL1
     C                   MOVEL     '3'           XDKIH_25
     C                   MOVEL     '3'           XDKIH_26
     C                   EVAL      XDKIH_181=SETRID
     C                   EVAL      XDKIH_201=SELV
     C                   EVAL      XDKIH_211=SELKT
     C                   EVAL      XDKIH_06=SENTK
     C                   EVAL      XDKIH_BRUT=SEVKB
      * hæmta kundinfo
     C     XDKIH_MOKN    IFNE      0
     C                   MOVE      XDKIH_MOKN    KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            40
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN40=*OFF
     C     XDKIH_08A     IFEQ      *BLANKS
     C     EORI          IFNE      *BLANKS
     C                   EVAL      XDKIH_08A=EORI
     C                   ELSE
     C                   MOVEL(P)  SYLAND        XDKIH_08A
     C                   CAT       SYRG:0        XDKIH_08A
     C                   CAT       '00':0        XDKIH_08A
     C                   IF        SYRG=*BLANKS
     C                   MOVEL(P)  SYLAND        XDKIH_08A
     C                   CAT       VATKKU:0      XDKIH_08A
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C     XDKIH_08F     IFEQ      *BLANKS
     C                   EVAL      XDKIH_08F = SYLAND
     C                   ENDIF
      * Spesial for Kingrød, hent mott.oppl fra kundereg uansett
     C                   EVAL      XDKIH_08B = KNAVN
     C                   EVAL      XDKIH_08C = ADR1
     C                   IF        POSTNR = 0

     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XDKIH_08D=%SUBST(SYPOGE:P:Q)

     C                   ELSE
     C                   EVAL      XDKIH_08D = *BLANKS
     C                   MOVEL     POSTNR        XDKIH_08D
     C                   ENDIF
     C                   EVAL      XDKIH_08E = ADR3
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XDKIH_08F = SYLAND
     C                   ENDIF
      * Hent godslokalkode fra CUNDF
     C     XDKIH_49      IFEQ      *BLANKS
     C                   EVAL      XDKIH_49=GOLK
     C                   ENDIF

     C                   ENDIF
     C                   ENDIF
      *Og bitte lite til fra HEADF
     C     DKIHKEY       CHAIN(N)  HEADF                              52
     C     *IN52         IFEQ      *OFF
     C                   EVAL      XDKIH_181=HEHAWB
     C                   EVAL      XDKIH_201=HEFR
     C                   ENDIF
      * Kopier varelinjer
     C                   CALL      'DKI009R'
     C                   PARM                    XDKIH_SYAV
     C                   PARM                    XDKIH_SYOP
     C*                  PARM                    XDKIH_EUP1
     C                   ENDSR
      *______________________________________________________
      * Hæmta från SYSPED Oppdrag                       SRGSO
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRGSO         BEGSR
     C                   EVAL      XDKIH_AVKN=HEKNS
     C                   EVAL      XDKIH_02B=HENAS
     C                   EVAL      XDKIH_02C=HEADS1
     C                   EVAL      P = %SCAN (' ' : HEADS3)
     C                   EVAL      XDKIH_02D=%SUBST(HEADS3:1:P)
     C                   EVAL      W_PADR=%SUBST(HEADS3:P+1)
     C                   EVAL      XDKIH_02E=%triml(W_PADR)
     C                   EVAL      XDKIH_02F=HELKS
      * Spesial kingsrød, hent avs. oppl fra kundereg uansett
     C     XDKIH_AVKN    IFNE      0
     C                   MOVE      XDKIH_AVKN    KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            35
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN35=*OFF
     C                   EVAL      XDKIH_02B = KNAVN
     C                   EVAL      XDKIH_02C = ADR1
     C                   IF        POSTNR = 0

     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XDKIH_02D=%SUBST(SYPOGE:P:Q)

     C                   ELSE
     C                   EVAL      XDKIH_02D = *BLANKS
     C                   MOVEL     POSTNR        XDKIH_02D
     C                   ENDIF
     C                   MOVEL     ADR3          XDKIH_02E
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XDKIH_02F = SYLAND
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C                   EVAL      XDKIH_MOKN=HEKNK
     C                   EVAL      XDKIH_08B=HENAK
     C                   EVAL      XDKIH_08C=HEADK1
     C                   EVAL      P = %SCAN (' ' : HEADK3)
     C                   EVAL      XDKIH_08D=%SUBST(HEADK3:1:P)
     C                   EVAL      W_PADR=%SUBST(HEADK3:P+1)
     C                   EVAL      XDKIH_08E=%triml(W_PADR)
     C                   EVAL      XDKIH_08F='  '
     C                   EVAL      XDKIH_14A=DKIA_14A
     C                   EVAL      XDKIH_14B=DKIA_14B
     C                   EVAL      XDKIH_15=HELKA
     C                   EVAL      XDKIH_06=HENT
     C                   MOVEL     '3'           XDKIH_25
     C                   MOVEL     '3'           XDKIH_26
     C                   EVAL      XDKIH_181=HEHAWB
     C                   EVAL      XDKIH_211=HELKA
     C                   EVAL      XDKIH_201=HEFR
     C                   EVAL      XDKIH_BRUT=HEVKT
      * hæmta kundinfo
     C     XDKIH_MOKN    IFNE      0
     C                   MOVE      XDKIH_MOKN    KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            40
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN40=*OFF
     C     XDKIH_08A     IFEQ      *BLANKS
     C     EORI          IFNE      *BLANKS
     C                   EVAL      XDKIH_08A=EORI
     C                   ELSE
     C                   MOVEL(P)  SYLAND        XDKIH_08A
     C                   CAT       SYRG:0        XDKIH_08A
     C                   CAT       '00':0        XDKIH_08A
     C                   IF        SYRG=*BLANKS
     C                   MOVEL(P)  SYLAND        XDKIH_08A
     C                   CAT       VATKKU:0      XDKIH_08A
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C     XDKIH_08F     IFEQ      *BLANKS
     C                   EVAL      XDKIH_08F = SYLAND
     C                   ENDIF
      * Spesial for Kingrød, hent mott.oppl fra kundereg uansett
     C                   EVAL      XDKIH_08B = KNAVN
     C                   EVAL      XDKIH_08C = ADR1
     C                   IF        POSTNR = 0

     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XDKIH_08D=%SUBST(SYPOGE:P:Q)

     C                   ELSE
     C                   EVAL      XDKIH_08D = *BLANKS
     C                   MOVEL     POSTNR        XDKIH_08D
     C                   ENDIF
     C                   EVAL      XDKIH_08E = ADR3
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XDKIH_08F = SYLAND
     C                   ENDIF
      * Hent godslokalkode fra CUNDF
     C     XDKIH_49      IFEQ      *BLANKS
     C                   EVAL      XDKIH_49=GOLK
     C                   ENDIF

     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
