********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 SH  PTF12 regenerer hvis finnes fra før
12XXX * 02 SH  PTF12 kaller arc002
12332 * 03 CB  PTF12 Skriv og ut ved godsnummer som slutter på: 'DT'
12336 * 04 CB  PTF12 Oppdater digitoll med dato+sekv.nr
12374 * 05 CB  PTF12 Forbedret oppdateringen av digitoll.
********************************************************************
********************************************************************
      *
     FARKIVL03  UF A E           K DISK
     FSADH      IF   E           K DISK
N04  FSADMOHL1  UF   E           K DISK
N05  FSADMOHL3  UF   E           K DISK
N05  F                                     RENAME(SADMOHFR:SADMOHFR3)
S05  F*DIM1     IF   E           K DISK
S05  FEDIM2     IF   E           K DISK
N05  FFRISOK    IF   E           K DISK
N05  FKODTA     IF   E           K DISK
N05  FFIRM      IF   E           K DISK
N05  FCUNDL01   IF   E           K DISK
     D                SDS
     D  ZUSER                254    263
     C     *entry        plist
     C                   PARM                    ARFIRM            2
     c                   parm                    ARAVD             4 0
     c                   parm                    AROPD             7 0
     C     ARKIVK        KLIST
     C                   KFLD                    ARTYPE
     C                   KFLD                    ARAVD
     C                   KFLD                    AROPD
     C                   EVAL      ARTYPE = 'sl'
      *
     c     key           klist
     c                   kfld                    ARAVD
     c                   kfld                    AROPD
N04  c     edim1key      klist
N04  c                   kfld                    WST               1
N04  c                   kfld                    ARAVD
N04  c                   kfld                    AROPD
N05  c     edim2key      klist
N05  c                   kfld                    ARAVD
N05  c                   kfld                    AROPD
N05  C                   KFLD                    MAX0B
N05  C                   KFLD                    MAX0C
N05  C                   KFLD                    MAX0D
N05  C     FRIKEY        KLIST
N05  C                   KFLD                    ARAVD
N05  C                   KFLD                    AROPD
N05  C                   KFLD                    WFSKODE
N05  C     KODTA2        KLIST
N05  C                   KFLD                    WSAUNI
N05  C                   KFLD                    ARAVD
N05  C     KUNDFK        KLIST
N05  C                   KFLD                    FIFIRM
N05  C                   KFLD                    KOAKNR
N05  C     *LIKE         DEFINE    FSKODE        WFSKODE
N05  C     *LIKE         DEFINE    M0068A        MAX0B
N05  C     *LIKE         DEFINE    M0068B        MAX0C
N05  C     *LIKE         DEFINE    M0068C        MAX0D
N05  c                   EVAL      WFSKODE='*CR'
N04  c                   EVAL      WST='C'
N05  C                   MOVE      'A'           WSAUNI            1
N05  C                   MOVE      '99999999'    MAX0B
N05  C                   MOVE      '999999'      MAX0C
N05  C                   MOVE      '99'          MAX0D
N05  C     FIFIRM        SETLL     FIRM
N05  C                   READ      FIRM
N05  C     KODTA2        CHAIN     KODTA
N05  C     KUNDfK        CHAIN     CUNDL01

N05  C     EDIM2KEY      SETLL     EDIM2                              71
N05  C     KEY           READPE    EDIM2                                  71
N05  C     *IN71         DOWEQ     *OFF
N05  C                   IF        M0065='CUSRES'
N05  C                   IF        MSR='R'
N05  C                   IF        M1N07='DME'
N05  C                   LEAVE
N05  C                   ENDIF
N05  C                   ENDIF
N05  C                   ENDIF
N05  C     KEY           READPE    EDIM2                                  71
N05  C                   ENDDO
      *
     c     key           chain     sadh                               33
     C  N33              EXSR      ARKIVSR
     C                   SETON                                        LR        wrkqry
     C                   RETURN
      **********************************************************************************
     C     ARKIVSR       BEGSR
      **********************************************************************************
      * Lag forhåndssendt arkivdokument ved direktefortolling
     C                   IF        %SUBST(SIGN:5:2) >= '01' AND
S03  C*                            %SUBST(SIGN:5:2) <= '12' AND
     C                             %SUBST(SIGN:5:2) <= '12'
S03  C*                            %SUBST(SIGN:8:8) = *BLANKS AND
S03  C*                            %SUBST(SIGN:7:1) = 'D'
N03  C                   IF        %SUBST(SIGN:7:2) = 'D ' OR
N03  C                             %SUBST(SIGN:7:2) = 'DT'
     C                   EVAL      ARUSER = ZUSER
     C                   MOVE      SIKNK         ARKUND
     C     ARKIVK        CHAIN     ARKIVL03                           33
     C                   IF        *IN33
     C                   WRITE     ARKIVR
n01  c                   else
n01  c                   move      ' '           arstat
n01  c                   update    arkivr
n01  c                   move      'N'           nei
N02  C                   CALL      'ARC002CL'
N02  C                   PARM                    ARTYPE
N02  C                   PARM                    ZUSER
N02  C                   PARM                    NEI               1
N03  C                   ENDIF
N05   * Helt omskrevet kommentarer fjernet
      * Opddater digitoll med org.nr+dato+sekv.nr
     C     FRIKEY        CHAIN     FRISOK
     C                   IF        FSSOK=*BLANKS
     C                   EVAL      FSSOK='Denne skal det ikke bli treff på'
     C                   ENDIF
     C                   IF        *IN71=*OFF
     C     KEY           CHAIN     SADMOHL1                           35
     C     FSSOK         CHAIN     SADMOHL3                           36
     C                   IF        FSSOK=*BLANKS
     C                   EVAL      *IN36=*ON
     C                   ENDIF
     C     *IN35         IFEQ      *OFF
     C     *IN36         OREQ      *OFF
     C     EHST2         IFEQ      *BLANKS
     C     EHST2         OREQ      'Z'
     C                   IF        EH0068A=*ZEROS
     C                   EVAL      EH0068A=M0068A
     C                   ENDIF
     C                   IF        EH0068B=*ZEROS
     C                   EVAL      EH0068B=M0068B
     C                   ENDIF
     C     EHRG          IFEQ      *BLANKS
     C                   MOVEL     SYRG          EHRG
     C                   ENDIF
     C     EHVKB         IFEQ      *ZEROS
     C                   EVAL      EHVKB=SIVKB
     C                   ENDIF
     C     EHNTK         IFEQ      *ZEROS
     C                   EVAL      EHNTK=SINTK
     C                   ENDIF
     C     *IN35         IFEQ      *OFF
     C                   UPDATE    SADMOHFR
     C                   ENDIF
     C     *IN35         IFEQ      *ON
     C     *IN36         ANDEQ     *OFF
     C                   UPDATE    SADMOHFR3
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   END
     C                   END
      *
     C                   ENDSR
      *
