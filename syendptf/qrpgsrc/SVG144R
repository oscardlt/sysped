********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 sh  PTF12 tatt bort oppdatering
********************************************************************
      *****************************************************************
      *** PROGRAM SKAL ET KOPI AV SYG141R. KVT ER BYTTET TIL IMF    ***
      *****************************************************************
     FEDIM      IF   E           K DISK
s01  F*VIH      UF   E           K DISK
s01  F*VEH      UF   E           K DISK
n01  FSVIH      IF   E           K DISK
n01  FSVEH      IF   E           K DISK
     FSVIHH     O  A E             DISK
     FSVEHH     O  A E             DISK
     FFRISOK    IF A E           K DISK
      *________________________
      * DS for decimal handling
      *""""""""""""""""""""""""
     D                 DS
     D  WMN2                   1      9  0
      */////////////
      * MAIN LOGIC /
      */////////////
      *___________
      * Initiering
      *"""""""""""
     C                   EXSR      INIT
      *________
      * CONVERT
      *""""""""
     C  N51              EXSR      SRA

     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *                                                      INIT /
      *////////////////////////////////////////////////////////////
     C     INIT          BEGSR
     C     *LIKE         DEFINE    MMN           ZMN
     C     *LIKE         DEFINE    SVIH_SYAV     WVIH_SYAV
     C     *LIKE         DEFINE    SVIH_SYOP     WVIH_SYOP
     C     *LIKE         DEFINE    FSSOK         WFSSOK
     C     *LIKE         DEFINE    FSKODE        WFSKODE
     C                   EVAL      WFSKODE='TID'
      * INIT WORKFIELDS

     C     *ENTRY        PLIST
     C                   PARM                    WMN1              9
     C                   MOVEL     WMN1          WMN2
     C                   Z-ADD     WMN2          ZMN
      * Definiere Nøkkler
     C     SVIH_KEY      KLIST
     C                   KFLD                    WVIH_SYAV
     C                   KFLD                    WVIH_SYOP
     C     FRIKEY        KLIST
     C                   KFLD                    WVIH_SYAV
     C                   KFLD                    WVIH_SYOP
     C                   KFLD                    WFSKODE
     C                   KFLD                    WFSSOK
      * Get msg and interchange values
     C     ZMN           CHAIN     EDIM                               51

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Vilken typ av svar ?                                  SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *_________________
      * Finnes ærendet ?
      *"""""""""""""""""
     C                   MOVEL     M0062         WVIH_SYAV
     C     7             SUBST     M0062:5       M0062B            7
     C                   MOVE      M0062B        WVIH_SYOP
     C                   CLEAR                   FRISOKR
     C                   EVAL      FSAVD=WVIH_SYAV
     C                   EVAL      FSOPD=WVIH_SYOP
     C                   EVAL      FSKODE='TID'
     C                   MOVEL     MDT           FSDTOP
     C                   EVAL      FSDOKK='G'
     C     SVIH_KEY      CHAIN(N)  SVIH                               51
     C                   IF        *IN51 = *OFF
     C                   EXSR      SRAI
     C                   EVAL      WATYPE='SI'
     C                   EVAL      WUSER=SVIH_SGID
     C                   MOVEL     SVIH_TUID     WFSSOK
     C     FRIKEY        CHAIN     FRISOK                             59
     C                   IF        *IN59
     C                   MOVEL     SVIH_TUID     FSSOK
     C     FSSOK         CAT       SVIH_MTYP:1   FSSOK
     C                   WRITE     FRISOKR
     C                   ENDIF
     C                   ELSE
     C     SVIH_KEY      CHAIN(N)  SVEH                               51
     C                   IF        *IN51 = *OFF
     C                   EXSR      SRAE
     C                   EVAL      WATYPE='SE'
     C                   EVAL      WUSER=SVEH_SGID
     C                   MOVEL     SVEH_TUID     WFSSOK
     C     FRIKEY        CHAIN     FRISOK                             59
     C                   IF        *IN59
     C                   MOVEL     SVEH_TUID     FSSOK
     C     FSSOK         CAT       SVEH_MTYP:1   FSSOK
     C                   WRITE     FRISOKR
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *_________________________
      * Aktivera arkivfunktionen
      *"""""""""""""""""""""""""
     C                   CALL      'ARC002CLB'
     C                   PARM                    WATYPE            2
     C                   PARM                    WUSER            10
     C
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Import                                               SRAI /
      *////////////////////////////////////////////////////////////
     C     SRAI          BEGSR
      *______________________
      * Skriv til historikfil
      *""""""""""""""""""""""
     C                   CLEAR                   SVIHHR
     C                   EVAL      SVIHH_SYA = SVIH_SYAV
     C                   EVAL      SVIHH_SYO = SVIH_SYOP
     C                   MOVEL     MDT           SVIHH_DTH
     C                   MOVEL     MTM           SVIHH_TMH
     C                   EVAL      SVIHH_SR  = 'R'
     C                   EVAL      SVIHH_TXH  = 'CUSRESU-IEMD IMF'
     C                   WRITE     SVIHHR
      *__________________
      * Uppdatera ærendet
      *""""""""""""""""""
     C     SVIH_KEY      CHAIN     SVIH                               61
s01  C*                  IF        *IN61 = *OFF
s01  C*                  IF        SVIH_SYST <> 'G'
s01  C*                  EVAL      SVIH_SYST='O'
s01  C*                  UPDATE    SVIHR
s01  C*                  ENDIF
s01  C*                  ENDIF
      *_________________
      * Skriv ut ærendet
      *"""""""""""""""""
     C                   MOVE      'C'           CALLTYP
     C                   MOVE      SVIH_SYAV     SVIHASYAV         4
     C                   MOVE      SVIH_SYOP     SVIHASYOP         7
     C                   CALL      'SVI006R'
     C                   PARM                    SVIHASYAV
     C                   PARM                    SVIHASYOP
     C                   PARM                    CALLTYP           1

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Export                                               SRAE /
      *////////////////////////////////////////////////////////////
     C     SRAE          BEGSR
      *______________________
      * Skriv til historikfil
      *""""""""""""""""""""""
     C                   CLEAR                   SVEHHR
     C                   EVAL      SVEHH_SYA = SVEH_SYAV
     C                   EVAL      SVEHH_SYO = SVEH_SYOP
     C                   MOVEL     MDT           SVEHH_DTH
     C                   MOVEL     MTM           SVEHH_TMH
     C                   EVAL      SVEHH_SR  = 'R'
     C                   EVAL      SVEHH_TXH  = 'CUSRESU-IEMD IMF'
     C                   WRITE     SVEHHR
      *__________________
      * Uppdatera ærendet
      *""""""""""""""""""
     C     SVIH_KEY      CHAIN     SVEH                               61
s01  C*                  IF        *IN61 = *OFF
s01  C*                  IF        SVEH_SYST <> 'G'
s01  C*                  EVAL      SVEH_SYST='O'
s01  C*                  UPDATE    SVEHR
s01  C*                  ENDIF
s01  C*                  ENDIF
      *_________________
      * Skriv ut ærendet (ikke intill videre, kan sleppes ved behov)
      *"""""""""""""""""
     C                   MOVE      'C'           CALLTYP
     C                   MOVE      SVEH_SYAV     SVIHASYAV
     C                   MOVE      SVEH_SYOP     SVIHASYOP
     C                   CALL      'SVE006R'
     C                   PARM                    SVIHASYAV
     C                   PARM                    SVIHASYOP
     C                   PARM                    CALLTYP           1
     C                   ENDSR
