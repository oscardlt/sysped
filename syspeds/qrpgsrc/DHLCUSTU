N43  H Option( *SrcStmt ) DftActGrp( *No ) BndDir( 'QC2LE' )
      *
     FEDISE1K   O  A E           K DISK
     FFIRM      IF   E           K DISK
N43  FEDIS      O  A E             DISK
     FEDIC      UF   E             DISK
     FDHLCUSORD UF   E           K DISK
N43   *
N43  D FILE_o          s               *
N43  D String          s            512a
N43  D rc              s             10i 0
N43  D Data            s             80a   Varying
N43  D Codepage        s              5a   Varying
N43  D CmdLine         S            512
N43  D CmdLen          S             15  5
N43  D LF              c                   x'25'
N43  Dopen             Pr              *   ExtProc( '_C_IFS_fopen' )
N43  D                                 *   Value Options( *String )
N43  D                                 *   Value Options( *String )
N43  Dfputs            Pr            10i 0 ExtProc( '_C_IFS_fputs' )
N43  D                                 *   Value Options( *String )
N43  D                                 *   Value
N43  Dclose            Pr            10i 0 ExtProc( '_C_IFS_fclose' )
N43  D                                 *   Value
      *
      *
      *
      *
      *
      *
      *
      *    CUSORD_ID                      EVO Order id             EVO ORDRE
      *    TRIP_FILE_ID                   EVO Trip No              EVO TRIP
      *    REQUEST_NO                     Request number           EVO REQUEST NO
      *    DOC_TYPE                       Customs document type    EX/IM4
      *    DECLARATION_STATUS             DECLARATION_STATUS       DONE
      *    DECLARATION_NO                 DECLARATION_NO           MRN
      *    REGISTRATION_NO                Goods Nr/Inventory Nr    GODSNUMMER
      *    DECLARATION_DATE               DECLARATION DATE         DEC DATO
      *    CLEARING_OFFICE_ID             Customs office           Ekspedisjonssted
      *    CLEARED_ITEMS                  Number of lines          ANTALL LINJER
      *    TOTAL_TARIFF_CODES             number of c (HS) codes   ANTALL ULIKE TARIFFNUMMER
      *    CLEARED_HU_QTY                 Cleared Quantities       ANTALL STYKK
      *    CLEARED_GROSS_WEIGHT           Cleared Gross weight     TOTALVEKT
      *    CUSTOMS_ACCESS_CODE            Those fields are received ONLY incase of CH Import
      *    "                              Those fields are received ONLY incase of CH Import
      *    CUSTOMS_PASSWORD_REFERENCES"
      *
      *
N43  D                 DS
N43  D  WMBR                   1     14
N43  D  WMBRA                  1      1
N43  D  WMBRB                  2     10  0
     D                 DS
     D  HEGN                   1     15
     D  HEAWB                  5     15
N43  D                 DS
N43  D  dsdate                 1      8
N43  D  dsaar                  1      4
N43  D  dsmnd                  5      6
N43  D  dsdag                  7      8
N43  D                 DS
N43  D  dstime                 1      6
N43  D  dstim                  1      2
N43  D  dsmin                  3      4
N43  D  dssek                  5      6
N43  D                 DS
N43  D  dfroc1                 1      2  0
N43  D  xfroc1                 1      2
N43  D  dfroc2                 3      4  0
N43  D  xfroc2                 3      4
N43  D  dfroc3                 5      6  0
N43  D  xfroc3                 5      6
      *
     c                   exsr      init
     c                   exsr      lesordre
     c                   exsr      EDISSR
      *
     c                   seton                                        lr
     c                   return
N43   *
N43   ***************************************************************
N43  C     lesordre      BEGSR
N43   ***************************************************************
     c                   setoff                                       33
N43   *
     c     key           setll     DHLcusord
     c     *in33         doweq     '0'
     c     key           reade     DHLcusord                              33
     c     *in33         ifeq      '0'
     c                   exsr      xmlsr
     C                   MOVE      'O'           PRSTATUS
     C                   MOVE      WDT           PR_DATE
     C                   MOVE      WTM           PR_TIME
     C                   UPDATE    DHLCUSORDR
     c                   endif
     c                   enddo
     c                   endsr
N43   ***************************************************************
N43  C     XMLSR         BEGSR
N43   ***************************************************************
      *
N43   * Lag fil og set codepage (pc)
      *
N43  C                   MOVE      *BLANKS       WFilNam         256
N43  C                   EVAL      WFilNam= '/syspedfx/EVO/EDISE1K/'
N43  C                             +  %TRIM(WMBR) + '.xml'
      *
N43   * Lag fil2 for backup  og set codepage (pc)
      *
N43  C                   MOVE      *BLANKS       WFilNam2        256
N43  C                   EVAL      WFilNam2 = '/syspedfx/EVO/EDISE1K/'
N43  C                             + 'BACKUP/'
N43  C                             + %TRIM(WMBR) + '.xml'
      *
      **
      **  skriver xmlfilen først til backup katalogen
      **
N43  C                   MOVE      *BLANKS       WFilback        256
N43  C                   eval      wfilback = WFilNam2
     c                   exsr      skrivxml
      *
N43  C                   ENDSR
N43   *
      *********************************************************************
     c     edissr        begsr
      *********************************************************************
N43  C                   CLEAR                   EDISR
N43  C                   EVAL      S0004  = 'DHL'
      *-----------------------
      * kundenummer UTKILEN
      *-----------------------
N43  C                   EVAL      S0010  = 'EVO'
      *
N43  C                   EVAL      S0020  = WMBR
N43  C                   EVAL      SSN    = CSN
N43  C                   EVAL      SSR    = 'S'
N43  C                   EVAL      SST    = 'A'
N43  C                   EVAL      SST    = 'C'
N43  C                   EVAL      S0036  = 1
N43  C                   MOVEL     WDT           SDT
N43  C                   MOVEL     WTM           STM
N43  C                   EVAL      SFILE  = '*IFS'
N43  C                   EVAL      SMBR   = WMBR
N43  C                   EVAL      SLIB   = '*LIBL'
N43  C                   EVAL      SIFS   = WFILBACK
N43  C                   WRITE     EDISR
N43   *
N43  C                   ENDSR
N43   *
N43   ***************************************************************
N43  C     init          BEGSR
N43   ***************************************************************
     c     *entry        plist
     c                   parm                    cusordid         25
      *
     c                   move      *blanks       xdata           500
      *
     c                   read      firm                                   33
      *
      * henter neste sendingsnummwer
      *
N43  C     1             CHAIN     EDIC                               36
N43  C                   ADD       1             CSN
N43  C                   ADD       1             CMN
N43  C                   UPDATE    EDICR
      *
      * fikser membernummer
      *
N43  C                   EVAL      WMBRA = 'S'
N43  C                   EVAL      WMBRB = CSN
     c                   eval      sembr=WMBR
      *
     c     key           klist
     c                   kfld                    STATUS            1
N43   *
N43  C                   CALL      'SYGE15C'
N43  C                   PARM                    WDT               8
N43  C                   PARM                    WTM               6
     c                   move      WDT           dsdate
     c                   move      WTM           dstime
      *
     c                   endsr
N43   *
N43   ***************************************************************
N43  C     skrivxml      BEGSR
N43   ***************************************************************
N43  C                   EVAL      FILE_o = open( %TrimR( WFilNam2 )
N43  C                             : 'w, codepage=819' )
N43  C                   EVAL      rc = close( FILE_o )
      *
N43  C                   EVAL      FILE_o = open( %TrimR( WFilNam2 )
N43  C                             : 'w' )
N43   *
      * linje 1 i xml
      *
N43  C                   EVAL      XDATA = '<?xml version="1.0" '
N43  C                             + 'encoding="UTF-7"?>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      * linje 2 i xml
      *
N43  C                   EVAL      XDATA = '<CMS_CUSTOMS_UPDATE>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      * linje 3 i xml  CUSORD_ID
      *
N43  C                   EVAL      XDATA = '<CUSORD_ID>'
N43  C                             + %TRIM(CUSORD_ID) + '</CUSORD_ID>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      *
      * linje 4 i xml  TRIP_F_ID
      *
N43  C                   EVAL      XDATA = '<TRIP_F_ID>'
N43  C                             + %TRIM(TRIP_F_ID) + '</TRIP_F_ID>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      *
      * linje 5 i xml  REQUEST_NO
      *
N43  C                   EVAL      XDATA = '<REQUEST_NO>'
N43  C                             + %TRIM(REQUEST_NO) + '</REQUEST_NO>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      * linje 6 i xml  DOC_TYPE
      *
N43  C                   EVAL      XDATA = '<DOC_TYPE>'
N43  C                             + %TRIM(DOC_TYPE) + '</DOC_TYPE>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      * linje 7 i xml  DEC_STATUS
      *
N43  C                   EVAL      XDATA = '<DEC_STATUS>'
N43  C                             + %TRIM(DEC_STATUS) + '</DEC_STATUS>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      * linje 8 i xml  DEC_NO
      *
N43  C                   EVAL      XDATA = '<DEC_NO>'
N43  C                             + %TRIM(DEC_NO) + '</DEC_NO>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      * linje 9 i xml  DECL_DATE
      *
     c                   move      DECL_DATE     DECL_DATA         8
N43  C                   EVAL      XDATA = '<DECL_DATE>'
N43  C                             + %TRIM(DECL_DATA) + '</DECL_DATE>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      * linje 10 i xml  CL_OFF_ID
      *
N43  C                   EVAL      XDATA = '<CL_OFF_ID>'
N43  C                             + %TRIM(CL_OFF_ID) + '</CL_OFF_ID>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      * linje 11 i xml  TOT_TAR_CD
      *
N43  C                   EVAL      XDATA = '<TOT_TAR_CD>'
     c                             + %trim(%editc(TOT_TAR_CD:'Z'))
     c                             + '</TOT_TAR_CD>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      * linje 12 i xml  TOT_TAR_CD
      *
N43  C                   EVAL      XDATA = '<CLEARED_TC>'
     c                             + %trim(%editc(CLEARED_TC:'Z'))
     c                             + '</CLEARED_TC>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      * linje 13 i xml  CLEARED_QT
      *
N43  C                   EVAL      XDATA = '<CLEARED_QT>'
     c                             + %trim(%editc(CLEARED_QT:'Z'))
     c                             + '</CLEARED_QT>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      * linje 14 i xml  CLEARED_WG
      *
N43  C                   EVAL      XDATA = '<CLEARED_WG>'
     c                             + %trim(%editc(CLEARED_WG:'Z'))
     c                             + '</0LEARED_WG>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      * linje 15 i xml  CUST_ACD
      *
N43  C                   EVAL      XDATA = '<CUST_ACD>'
N43  C                             + %TRIM(CUST_ACD) + '</CUST_ACD>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      * linje 16 i xml  CUST_PW
      *
N43  C                   EVAL      XDATA = '<CUST_PW>'
N43  C                             + %TRIM(CUST_PW) + '</CUST_PW>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
      *
N43  C                   EVAL      XDATA = '</CMS_CUSTOMS_UPDATE>'
N43  C                   EVAL      rc = fputs(%trimr(XDATA) + LF: File_o)
     c                   eval      sdata=Xdata
     c                   write     ediser
      *
N43   * ifs stenge filen
N43   *
N43  C                   EVAL      rc = close( FILE_o )
N43   *
     c                   endsr
