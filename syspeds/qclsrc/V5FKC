             PGM
             DCL        VAR(&FRALIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&TILLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&HIST) TYPE(*CHAR) LEN(1)
             DCL        VAR(&SAD) TYPE(*CHAR) LEN(1)
             DCL        VAR(&TOMME) TYPE(*CHAR) LEN(1)
             DCL        VAR(&BEHAN) TYPE(*CHAR) LEN(1)
             DCL        VAR(&JOBQ) TYPE(*CHAR) LEN(1)
             DCL        VAR(&FLAGG) TYPE(*CHAR) LEN(1)
             DCLF       FILE(V5FKD00) RCDFMT(BILDE01)
             CHGJOB     JOB(*) LOG(4 00 *SECLVL) LOGCLPGM(*YES)

LOOP1:
             SNDRCVF    DEV(*FILE) RCDFMT(*FILE)
             IF         COND(&IN03 = '1') THEN(GOTO CMDLBL(SLUTT))
             CHGVAR     VAR(&IN30) VALUE('0')
             CHGVAR     VAR(&IN31) VALUE('0')

             CHKOBJ     OBJ(QSYS/&FRALIB) OBJTYPE(*LIB)
             MONMSG     MSGID(CPF9801 CPF9810) EXEC(CHGVAR +
                          VAR(&IN30) VALUE('1'))
             CHKOBJ     OBJ(QSYS/&TILLIB) OBJTYPE(*LIB)
             MONMSG     MSGID(CPF9801 CPF9810) EXEC(CHGVAR +
                          VAR(&IN31) VALUE('1'))

             IF         COND(&IN30 = '1' *OR &IN31 = '1') THEN(GOTO +
                          CMDLBL(LOOP1))

             IF         COND(&IN03 = '1') THEN(GOTO CMDLBL(SLUTT))
             IF         COND(&IN10 = '1') THEN(CHGVAR VAR(&JOBQ) +
                          VALUE('J'))

             CALL       PGM(V5FKR) PARM(&HIST &SAD &FLAGG)
             IF         COND(&FLAGG = '1') THEN(GOTO CMDLBL(SLUTT))

             IF         COND(&BEHAN = 'J') THEN(CALL PGM(V5FBC) +
                          PARM(&FRALIB &TILLIB))
             IF         COND(&JOBQ = 'J') THEN(SBMJOB CMD(CALL +
                          PGM(V5FKR2) PARM(&HIST &SAD &FRALIB +
                          &TILLIB &TOMME &JOBQ)))
             ELSE       CMD(DO)
             CHGDSPF    FILE(V5FKD2) WAITRCD(*IMMED)
             CALL       PGM(V5FKR2) PARM(&HIST &SAD &FRALIB &TILLIB +
                          &TOMME &JOBQ)
             ENDDO

             IF         COND((&HIST = 'N') *AND (&SAD = 'N')) +
                          THEN(CHGVAR VAR(&BEHAN) VALUE('J'))
             IF         COND(&BEHAN = 'J') THEN(CALL PGM(V5EBC) +
                          PARM(&FRALIB &TILLIB))

 SLUTT:      RCLRSC
             ENDPGM
