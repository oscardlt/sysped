      *
      ***********************************************************
      *** PROGRAM SKAL SKRIVE UT FORTLØPENDE KOPI AV FAKTURA  ***
      ***         FRA - TIL FAKTURANUMRE                      ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01 02 04-26                      ***
      *** LEDIGE INDIKATORER 27-29 31 38-40 47 49-70 73-97    ***
      *** INNDIKATOR 99 PÅ = OVERFLOW AV SYFA99PF             ***
      ***********************************************************
      *
     FFIRM      IF   E           K DISK
     FFAK3      IF   E           K DISK
     FSORT      UF A E           K DISK
     FFAIN      IF   E           K DISK
     FHEADF     IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FKODTGE    IF   E           K DISK
     FSYFA99FM  CF   E             WORKSTN
     FSYFA99PF  O    E             PRINTER OFLIND(*IN99)
     D                 DS
     D  XVAL                   1      3
     D  XVAL2                  1      3
     D                 DS
     D  SOAVD                  4      7  0
     D  FAAVD                  4      7  0
     D  SOOPD                  8     14  0
     D  FAOPD                  8     14  0
     D  SOSK                  15     15
     D  FASK                  15     15
     D  SOVK                  16     18
     D  FAVK                  16     18
     D  SOVT                  19     38
     D  FAVT                  19     38
     D  XFAVT1                19     19
     D  XFAVT2                20     38
     D  SOVAL                 39     41
     D  FAVAL                 39     41
     D  SOBELV                42     54  2
     D  FABELV                42     54  2
     D  SOKDM                 55     55
     D  FAKDM                 55     55
     D  SOBELN                56     68  2
     D  FABELN                56     68  2
     D  SOLNR                105    107  0
     D  FALI                 103    107  0
     D                 DS
     D  FADATO                 1      8  0
     D  FACC                   1      2  0
     D  FAAA                   3      4  0
     D  FAMM                   5      6  0
     D  FADD                   7      8  0
     D                 DS
     D  FADAFF                 1      8  0
     D  FACCFF                 1      2  0
     D  FAAAFF                 3      4  0
     D  FAMMFF                 5      6  0
     D  FADDFF                 7      8  0
     D                 DS
     D  YSOLNR                 1      3  0
     D  YSOAVD                 4      7  0
     D  YSOOPD                 8     14  0
     D                UDS
     D  UFIRM                  1      2
     C*
     C                   EXSR      INIT
     C*
     C     START         TAG
     C                   EXFMT     BILDE01
     C   03              GOTO      SLUTT
     C     WSFNF         COMP      WSFNT                              30
     C   30              MOVE      'SPF0005'     MSGNR
     C   30              GOTO      START
     C                   EXSR      PRINT1
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     PRINT1        BEGSR
     C***********************************************
     C                   WRITE     HEADER
     C                   WRITE     NEWP
     C                   SETOFF                                       99
     C                   MOVE      WSFNF         WSFN
     C     WSFN          DOWLE     WSFNT
     C     WSFN          CHAIN     FAIN                               34
     C  N34FAK3K         CHAIN     FAK3                               34
     C   99              WRITE     NEWP
     C   99              SETOFF                                       99
     C   34              WRITE     FEILFA
     C  N34HEADFK        CHAIN     HEADF                              35
     C  N34
     CAN 35              WRITE     FEILOP
     C  N34
     CANN35              EXSR      PRINT
     C                   WRITE     BILDE02
     C                   ADD       1             WSFN
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     PRINT         BEGSR
     C***********************************************
     C*
     C* FAKTURANR PEKER PÅ ORIGINAL AV ET OPPDRAG SOM SENERE ER KREDITERT.
     C* SKRIV ORIGINALFAKTURA (MED SNUDDE BELØP.... 32 ON)
     C                   MOVE      *ZEROS        XFN               7 0                         SYFA2
     C                   MOVE      *BLANKS       XFATXT            8                           SYFA2
     C     WSFN          COMP      HEFNGK                                 32
     C   32              DO
     C                   MOVE      FAFAKT        XFN                                           SYFA2
     C                   MOVE      XTXT1         XFATXT
     C                   END
     C*
     C*
     C* SELGER
     C*
     C* FAKTURANR PEKER PÅ ORIGINAL EV ET OPPDRAG SOM SENERE ER KREDITERT.
     C* SKRIV ORIGINALFAKTURA (MED SNUDDE BELØP ... 32 ON)
     C     WSFN          COMP      HEFNGS                                 32
     C   32              DO
     C                   MOVE      FAFAKT        XFN                                           SYFA2
     C                   MOVE      XTXT1         XFATXT
     C                   END
     C*
     C* KALLER PRINTPROGRAM
     C                   EXSR      KJØPER
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KJØPER        BEGSR
     C***********************************************
     C     FASK          IFEQ      'K'
     C                   MOVE      HEVALK        XVAL
     C                   END
     C     FASK          IFEQ      'S'
     C                   MOVE      HEVALS        XVAL
     C                   END
     C     FASK          IFEQ      'X'
     C                   MOVE      FAVAL         XVAL
     C                   END
     C                   MOVE      FAKUNR        YKN
     C     KUND1K        CHAIN     CUNDL01                            33
     C     POSTNR        COMP      *ZEROS                                 37
     C     DKUND         IFEQ      'D'
     C     FASK          IFEQ      'K'
     C                   MOVE      HENAK         XNAD             30
     C                   MOVE      HEADK1        XAD1D            30
     C                   MOVE      HEADK2        XAD2D            30
     C                   MOVE      HEADK3        XAD3D            30
     C                   END
     C     FASK          IFEQ      'S'
     C                   MOVE      HENAS         XNAD
     C                   MOVE      HEADS1        XAD1D
     C                   MOVE      HEADS2        XAD2D
     C                   MOVE      HEADS3        XAD3D
     C                   END
     C                   END
     C*
     C                   EXSR      VALI
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     VALI          BEGSR
     C***********************************************
     C     DKUND         COMP      'D'                                    48
     C                   EXSR      SORTER
     C     XVAL          COMP      XTXT3                              7171
     C     SORTK         SETLL     SORT
     C                   SETOFF                                       3346
     C                   MOVE      *ZEROS        XTOTAL            9 2
     C                   MOVE      *ZEROS        XMVAGR
     C                   MOVE      *ZEROS        XANT              2 0
     C*
     C     STVALI        TAG
     C                   READ      SORT                                   33
     C*---------------------------------------------------
     C  N33              DO
     C     FAKDM         COMP      'J'                                    34
     C     KODGEK        CHAIN     KODTGE                             35
     C*  VED UTSKRIFT AV ORIGINAL PÅ GRUNNLAG AV KREDITNOTA SNU BELØP
     C   32FABELN        MULT      -1            FABELN
     C   32FABELV        MULT      -1            FABELV
     C   34
     CANN71              ADD       FABELN        XMVAGR
     C   34
     CAN 71              ADD       FABELV        XMVAGR
     C  N71              Z-ADD     FABELN        XPFNOK            9 2
     C   71              Z-ADD     FABELV        XPFNOK
     C                   ADD       XPFNOK        XTOTAL
     C     XPFNOK        COMP      *ZEROS                             3636
     C   36              DO
     C* sett indikatore for å styre info på foerste del av linjene
     C                   ADD       1             XANT
     C     XANT          COMP      1                                      41
     C     XANT          COMP      2                                      42
     C     XANT          COMP      3                                      43
     C     XANT          COMP      4                                      44
     C     XANT          COMP      5                                      45
     C   99              WRITE     NEWP
     C   99              SETOFF                                       99
     C                   WRITE     DET
     C                   DELETE    SORTR
     C                   END
     C                   GOTO      STVALI
     C                   END
     C*
     C     XANT          DOWLT     5
     C* indikator 46 viser at varelinjeopplysninger IKKE finnes
     C                   SETON                                            46
     C* sett indikatore for å styre info på foerste del av linjene
     C                   ADD       1             XANT
     C     XANT          COMP      1                                      41
     C     XANT          COMP      2                                      42
     C     XANT          COMP      3                                      43
     C     XANT          COMP      4                                      44
     C     XANT          COMP      5                                      45
     C   99              WRITE     NEWP
     C   99              SETOFF                                       99
     C                   WRITE     DET
     C                   END
     C*
     C* VARIABLE VAT
     C                   MOVE      FITAX         FITAXN
     C     FITAXD        IFNE      *ZEROS
     C     FITAX2        ANDNE     *ZEROS
     C     FADATO        ANDLT     FITAXD
     C                   MOVE      FITAX2        FITAXN
     C                   END
     C     XMVAGR        MULT(H)   FITAXN        XMOMS             8 1
     C                   Z-ADD     XMOMS         XPMOMS            8 2
     C     XTOTAL        ADD       XMOMS         XBRUTT            9 2
     C     XPMOMS        COMP      *ZEROS                             7272
     C   99              WRITE     NEWP
     C   99              SETOFF                                       99
     C                   WRITE     TOT
     C                   MOVE      *ZEROS        XBRUTT
     C                   MOVE      *ZEROS        XMVAGR
     C                   MOVE      *ZEROS        XPMOMS
     C*
     C                   ENDSR
     C*
     C******************************************
     C     SORTER        BEGSR
     C******************************************
     C     FAK3K         SETLL     FAK3
     C                   SETOFF                                       33
     C                   Z-ADD     0             SOLNR
     C*
     C     STSORT        TAG
     C     FAK3K         READE     FAK3                                   33
     C  N33              DO
     C                   ADD       1             SOLNR
     C                   WRITE     SORTR
     C                   GOTO      STSORT
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     FAK3K         KLIST
     C                   KFLD                    XXOPKO
     C                   KFLD                    FIFN
     C                   MOVE      'O'           XXOPKO            1
     C     SORTK         KLIST
     C                   KFLD                    YSOLNR
     C                   KFLD                    YSOSAM
     C                   KFLD                    YSOAVD
     C                   KFLD                    YSOOPD
     C                   KFLD                    YSOSK
     C     HEADFK        KLIST
     C                   KFLD                    FIAVD
     C                   KFLD                    FIOPD
     C     KODGEK        KLIST
     C                   KFLD                    YGEUNI
     C                   KFLD                    FAVK
     C     KUND1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    YKN
     C*
     C                   MOVE      ' '           YSK               1
     C                   MOVE      *ZEROS        YSOLNR
     C                   MOVE      *ZEROS        YSOAVD
     C                   MOVE      *ZEROS        YSOOPD
     C                   MOVE      ' '           YSOSK             1
     C                   MOVE      ' '           YSOSAM            1
     C                   MOVE      'GE'          YGEUNI            2
     C                   MOVE      *ZEROS        YKN               8 0
     C                   MOVE      *ZEROS        FADATO
     C                   MOVE      *ZEROS        FADAFF
     C*
     C                   EXSR      HMSG
     C                   READ      FIRM                                   33
     C     *LIKE         DEFINE    FITAX         FITAXN
     C                   MOVE      FITAX         FITAXN
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     HMSG          BEGSR
     C***********************************************
     C                   MOVE      'DIV0403'     XMSGNR            7
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          XTXT1             8
     C                   MOVE      'DIV0404'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          XTXT2             8
     C                   MOVE      'DIV0420'     XMSGNR
     C* HENTE VALUTAKODE ('NOK' I NORGE)
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          XTXT3             3
     C*
     C                   MOVE      'DIV0405'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG01
     C                   MOVE      'DIV0394'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG02
     C                   MOVE      'DIV0395'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG03
     C                   MOVE      'DIV0406'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG04
     C                   MOVE      'DIV0407'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG05
     C                   MOVE      'DIV0408'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG06
     C                   MOVE      'DIV0409'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG07
     C                   MOVE      'DIV0410'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG08
     C                   MOVE      'DIV0411'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG09
     C                   MOVE      'DIV0412'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG10
     C                   MOVE      'DIV0413'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG11
     C                   MOVE      'DIV0414'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG12
     C                   MOVE      'DIV0415'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG13
     C                   MOVE      'DIV0416'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG14
     C                   MOVE      'DIV0417'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG15
     C                   MOVE      'DIV0418'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG16
     C                   MOVE      'DIV0419'     XMSGNR
     C                   EXSR      HMSG2
     C                   MOVEL     XMSG          MSG17
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     HMSG2         BEGSR
     C***********************************************
     C                   Z-ADD     3             XLEVEL            1 0          NIVÅ
     C                   Z-ADD     0             XRETUR            1 0          RETURKODE
     C                   Z-ADD     120           XMSGL             4 0          LENGDE PÅ MELDING
     C                   CALL      'SUBR23R3'
     C                   PARM                    XMSGNR
     C                   PARM                    XMSG            120
     C                   PARM                    XLEVEL
     C                   PARM                    XRETUR
     C                   PARM                    XMSGL
     C*
     C                   ENDSR
     C*
