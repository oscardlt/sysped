      ***********************************************************
      *** PROGRAM FOR DETALJLINJER PÅ HENTEOPPDRAG            ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      ***********************************************************
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 8 = SE MELD TIL TRANSP - VAR ALDRI FULLFØRT.. :=) NÅ OK.
10XXX * 02 sh  PTF10 logikk ved HEKNT
10XXX * 03 JOV PTF10 myye BHR-logikk innhentet som standard
10XXX * 04 JOV PTF10 logikk ved HEKNT - skal være TRANSPNR
10XXX * 05 JOV PTF10 kall på CARGOSCR4 etter overføring til oppdrag (T&T mm)
10XXX * 06 JOV PTF10 henter fritekst fra HENOF (foreløpig i tillegg til EFTX..)
10172 * 07 SH  PTF10 norsk text til Track and trace
      * 08 JOV PTF10 Melding til transp dupliseres IKKE til dok29 (takles gjennom G=Gods/OG fr.br)
      * 09 sh  PTF10 ny parameter syge13
      * 10 JOV PTF10 FINN FORD-NØKK FOR HENTEFRAKT KUN BLANT ÅPNE LINJER (KAN VÆRE DELOVERFØRT)
      * 11 JOV PTF10 PTF 10 reversert
      * 12 JOV PTF10 NÅR deloverført må det tyllates ny F11 selv når dupbeløp er 0
      * 13 JOV PTF10 Sett TTMANU = S på TRACKF-poster
10XXX * 14 YBC PTF10 FEIL LENGDE PÅ QDA04
10XXX * 15 JOV PTF10 Loggfør ZVK ved overføring til oppdr dersom vekt er endret
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
10XXX * 16 JOV PTF10 minimum hent i ulike vegtgr fjernes fysisk(inaktiv i lang tid..)
10XXX * 17 JOV PTF11 Varme/farlig-%-sats kan være overstyrt på kunde
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
10XXX * 18 JOV PTF11 Lagre EDI sendingsnr i T&T TTDEPO
      * 19 JOV PTF11 Opt D = Direkte = fjerne fra Hentinger/legge inn på utgående avd
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * 20 JOV PTF12 stygg feil i ptf 19   )F12 funket ikke hvis avd var ok)
      * 21 JOV PTF12 unngå å få med grums fra foregående i TTtext
********************************************************************
      *
     FHENOS     UF A E           K DISK
     FHENOS01   IF   E           K DISK
     F                                     RENAME(HENOSR:HENOS01R)
     FHENOP     UF   E           K DISK
     FHENOK     UF A E           K DISK
N06  FHENOF     IF   E           K DISK
     FFIRM      IF   E           K DISK
     FFIRINL    IF   E           K DISK
     FCUTRAN    IF   E           K DISK
     FEDIM      IF   E           K DISK
     FEDIS      IF   E           K DISK
     FEUNB      IF   E           K DISK
     FEFTX93A   IF   E           K DISK
N03  FENAD93A   IF   E           K DISK
N03  FKUNKO2    IF A E           K DISK
     FCUNDL01   IF   E           K DISK
     FVADR      IF   E           K DISK
     FTRAN      IF   E           K DISK
     FTELL      UF   E           K DISK
     FHEADF     O  A E           K DISK
     FFAKT      O  A E           K DISK
     FDISP      O  A E           K DISK
     FHESTED    O  A E             DISK
     FKOSTT     UF A E           K DISK
     FKOSBU     O  A E             DISK
     FHETRIU    O  A E             DISK
     FFREETXT   O  A E             DISK
     FDOK29     O  A E             DISK
     FTURER14   UF   E           K DISK
     FHEAD11    IF   E           K DISK
     F                                     RENAME(HEADFR:HEA11R)
     FSTED2D    IF   E           K DISK
     FKODTA     IF   E           K DISK
     FKODTAG    IF   E           K DISK
     FKODTV     IF   E           K DISK
     FKODTFR    IF   E           K DISK
     FKODTRI    IF   E           K DISK
N03  FNOPNR     IF   E           K DISK
N03  FAVFRHL01  IF   E           K DISK
     FUSRDFT    IF   E           K DISK
     FKUFAST    IF   E           K DISK
     FKODTU     IF   E           K DISK
     FTRACKF    O  A E             DISK
     FSYPROD    IF   E           K DISK
     FKAVT      IF   E           K DISK
N15  FCARGOO1   IF   E           K DISK
     FSYTR34FB  CF   E             WORKSTN USROPN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
      *___________________________
      * Finner username
      *"""""""""""""""""""""""""""
     D                SDS
     D  ZJOB                 244    253
     D  ZUSER                254    263
     D  ZJOBNR               264    269  0
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
      * DIVERSE FORKORTEDE FELT I SUBFIL..
     D                 DS
     D  HSNAK                  1     30
     D  HXNAK                  1     19
     D  XDLT                   1      7
     D                 DS
     D  HSSNDN                 1     20
     D  HSSN17                 4     20
     D  HSSND1                 1     10
     D  HSSND2                11     20
     D                 DS
     D  HSDS                   1     30
     D  HSDSUS                 1     10
     D  HSDSDT                11     18
     D  HSDSTI                19     22
     D  HSDSDM                23     23
     D  HSDSMOTP              24     26
     D  HSDS29                29     29
     D  HSDSCS                30     30
     D                 DS
     D  ANTTOA                 1      3
     D  ANTTOA1                1      1
     D  ANTTOA2                2      2
     D                 DS
     D  ANTMAA                 1      3
     D  ANTMAA1                1      1
     D  ANTMAA2                2      2
     D                 DS
     D  WSSNDN                 1     20
     D  WSSNEA                 1      3
     D  WSSN17                 4     20
     D  WSSN20                20     20
     D  WSSN10                 1     10
     D  WSSN9A                 1      9
     D  WSSN9B                10     10
     D  WSSN9C                11     20
     D                 DS
     D  HSBELH                 1      7  0
     D  HXBELH                 3      7  0
     D                 DS
     D  HSBELM                 1      7  0
     D  HXBELM                 4      7  0
     D                 DS
     D  HSBEL                  1      7  0
     D  HXBEL                  4      7  0
      *
      * DATO
     D                 DS
     D  HODTÅ                  1      4  0
     D  HODTM                  5      6  0
     D  HODTD                  7      8  0
     D  HODT                   1      8  0
     D                 DS
     D  HSDTÅ                  1      4  0
     D  HSDTM                  5      6  0
     D  HSDTD                  7      8  0
     D  HSDT                   1      8  0
     D                 DS
     D  WSDTD                  1      2  0
     D  WSDTM                  3      4  0
     D  WSDTÅ                  5      6  0
     D  WSDT                   1      6  0
     D                 DS
     D  HEDTÅ                  1      4  0
     D  HEDTM                  5      6  0
     D  HEDTD                  7      8  0
     D  HEDTOP                 1      8  0
     D                 DS
     D  HEFT1                  1     51
     D  HEFT1A                 1     30
     D  HEFT1B                31     45
N03  D UP              C                   CONST('ABCDEFGHIJKLMNOPQRST-
N03  D                                     UVWXYZÆØÅ')
N03  D LO              C                   CONST('abcdefghijklmnopqrst-
N03  D                                     uvwxyzæøå')
      *
     D CVT1            C                   CONST('UTKJØRING ')
     D CVT2            C                   CONST('->')
      * UTKJ.
     D                 DS
     D  DSVFTX                 1     35
     D  DSVT1                  1     10
     D  HSPNRT                12     15  0
     D  DSVT2                 23     24
     D  HSPNRK                26     29  0
     D                 DS
     D  HXHEAD                 1    256
     D  XXUR                   1      1
     D  XXFR                   2      4
     D  XXKDPL                 5      5
     D  XXLKA                  6      7
     D  XXSDF                  8     12
     D  XXTRI                 13     14
     D  XXSDT                 15     19
     D  XXLKS                 20     21
     D  XXSDFF                22     26
     D  XXLKK                 27     28
     D  XXSDVT                29     33
     D  XXVKT                 34     42  0
     D  XXFBV                 43     51  0
     D  XXM3                  52     58  3
     D  XXLM                  59     62  2
     D  XXNT                  63     69  0
     D  XXVERV                70     72
     D  XXVERB                73     75  2
      *
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0

     D                 DS
     D  QDATA                  1    109
     D  QDA01                  1      2
     D  QDA02                  3      6
     D  QDA03                  7     13
S14  D* QDA04                 14     14
N14  D  QDA04                 14     15
     D  QDA05                 16     16
     D  QDA06                 17     20
     D  QDA07                 21     24
     D  QDA08                 25     26
     D  QDA09                 27     28
     D  QDA10                 29     29
     D  QDA11                 30     30
     D  QDA12                 31     37
     D  QDA13                 38     38
     D  QDA14                 39    100
     D  QDA15                101    101
     D  QDA16                102    102
     D  QDA17                103    103
     D  QDA18                104    109
      * Track/Trace-tekster
     D TTXED1          C                   CONST('Incoming EDI prepar-
     D                                     ed from sender      ')
      *
     D TTXED2          C                   CONST('Incoming EDI reciev-
     D                                     ed                  ')
      *
     D TTXSTR          C                   CONST('Order entered (proc-
     D                                     . from COLLECT ord.)')
n07  D TTXED1L         C                   CONST('Innkommende EDI forb-
n07  D                                     eredt av avsender   ')
      *
n07  D TTXED2L         C                   CONST('Innkommende EDI mot-
n07  D                                     tatt                ')
      *
n07  D TTXSTRL         C                   CONST('Ordre opprettet (gene-
n07  D                                     rert fra COLLECT ord.)')
      *
     D                UDS
     D  UDSFIR                 1      2
     D  UDSAVD                15     18  0
     D  UDSSG                 19     21
      *
     C                   EXSR      INIT
     c     UAuto         ifne      'J'
     c                   open      SYTR34FB
     c                   else
      * Auto = henteprising+overføring  av oppdrag (som er klare)
     C                   EXSR      SAMTAX
     C                   EXSR      LAGOPD
     C                   GOTO      SLUTT
     c                   end
      *
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   MOVE      *ZEROS        ZRECNO
     C                   MOVE      *ZEROS        SUMBEH
     C                   MOVE      *ZEROS        SUMBEM
     C                   MOVE      *ZEROS        SUMBEL
     C                   MOVE      *ZEROS        SOMBEH            7 0
     C                   MOVE      *ZEROS        SOMBEM            7 0
     C                   MOVE      *ZEROS        SOMBEL            7 0
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     ULNR          SETLL     HENOS
     C     ULNR          READE(N)  HENOS                                  94
      *
     C     START2        TAG
      * TELLER FOR ANTALL ALLEREDE OVERFØRT
     C                   MOVE      *ZEROS        ANTOVF            3 0
      *
     C     *IN94         DOWEQ     '0'
     C     HSSND2        IFNE      *BLANKS
     C                   MOVE      HSSND2        HXSNDN10
     C                   ELSE
     C                   MOVE      HSSND1        HXSNDN10
     C                   END
     C                   ADD       HSBELH        SUMBEH
     C                   ADD       HSBELM        SUMBEM
     C                   ADD       HSBEL         SUMBEL
     C     HSDS29        COMP      'E'                                    52
     C     IFSCIN        IFEQ      'J'
     C     HSSTIN        COMP      ' '                                    59
     C                   END
     C     HSST          IFNE      'O'
     C                   SETOFF                                       57
     C     HOEDSN        IFNE      *ZEROS
     C                   EXSR      TSTTXT
     C                   END
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C                   ELSE
     C                   ADD       1             ANTOVF
     C                   ADD       HSBELH        SOMBEH
     C                   ADD       HSBELM        SOMBEM
     C                   ADD       HSBEL         SOMBEL
     C                   END
     C     ULNR          READE(N)  HENOS                                  94
     C  N94              ENDDO
      *
      * 56 ON, IKKE LOV Å LEGGE TIL NYE / SAMTAKSERE INNHENTING.
     C     ANTOVF        COMP      *ZEROS                             56
      *
     C                   Z-ADD     ZRECNO        YRECNO            4 0
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
     C     ZRECNO        IFGT      0
     C                   Z-ADD     1             ZRECNO
     C                   END
      *
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
      * Ingen poster/ER IKKE nettopp avbrutt vareli -> NYREG-IND PÅ
     C     *IN12         IFEQ      '0'
     C                   WRITE     NYVARE
     C                   MOVE      *ON           *IN06
     C                   ELSE
     C                   EXFMT     NYVARE
     C                   END
     C                   ELSE
     C                   WRITE     BUNN
     C                   EXFMT     SUBCTL
     C                   END
      *
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
      *
     C                   SETOFF                                       9998
     C                   SETOFF                                       30
N19  c                   move      'N'           OptDirekte        1
      *** AVSLUTT
     C   03              GOTO      SLUTT
     C   12              GOTO      SLUTT
      *** VIS MANKO TALL
     C     *IN02         IFEQ      '1'
     C     IFSCIN        ANDEQ     'J'
     C     MANMOD        IFEQ      'J'
     C                   MOVE      ' '           MANMOD            1
     C                   MOVE      *OFF          *IN58
     C                   ELSE
     C                   MOVE      *ON           *IN58
     C                   MOVE      'J'           MANMOD            1
     C                   END
     C                   GOTO      START
     C                   END
      *** FRISK OPP
     C   05              GOTO      START
      *** LAGE NY
     C     START4        TAG
     C   06              DO
     C                   EXSR      MOVB2
     C                   GOTO      START5
     C                   END
      *
      *** TIL TURPLANLEGGING
     C   09              DO
     C                   EXSR      TSTOV2
     C   30              GOTO      START
     C                   MOVE      HODAVD        XAVD              4 0
     C                   MOVE      *ZEROS        XOPD              7 0
     C                   MOVE      *ZEROS        XPRO              8 0
     C                   MOVE      *ZEROS        XRUND             8 0
     C                   MOVE      'P'           USPØR             1
     C                   CALL      'SYTR88'
     C                   PARM                    XPRO
     C                   PARM                    XRUND
     C                   PARM                    XAVD
     C                   PARM                    XOPD
     C                   PARM                    USPØR
     C                   PARM                    UFLAGG
     C     XPRO          IFNE      *ZEROS
     C     XPRO          CHAIN(N)  TURER14                            33
     C     *IN33         IFEQ      '0'
     C     ULNR          CHAIN     HENOP                              33
     C                   MOVE      XPRO          HOPRO
     C                   MOVEL     TUBILN        HOBILN
     C                   UPDATE    HENOPR
     C                   END
     C                   END
     C                   GOTO      START
     C                   END
      *
      *** SAMTAKSERING/FORDELING
     C   10              DO
     C                   EXSR      TSTOV2
     C   30              GOTO      START
     C                   EXSR      SAMTAX
     C   10              GOTO      START
     C   12              GOTO      START2
     C                   END
      *
      *** LAG OPPDRAG
     C   11              DO
     C                   MOVE      '0'           *IN30
     C                   MOVE      *ZEROS        ANTSEN            3 0
     C                   MOVE      *ZEROS        IKKEKV            3 0
     C                   MOVE      *ZEROS        ANTPLL            3 0
     C     HOPRO         IFEQ      *ZEROS
     C                   MOVE      'JOV1166'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      START
     C                   END
     C     *IN30         IFEQ      '0'
     C     ULNR          SETLL     HENOS
     C     ULNR          READE(N)  HENOS                                  33
     C     *IN33         DOWEQ     '0'
     C     HSBEL         IFEQ      *ZEROS
N12  C     HOMOPD        ANDNE     9999999                                      tillat når DEL-overf
     C                   MOVE      'JOV1167'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      START
     C                   END
      * TELL OPP ANT SENDINGER, ANTALL IKKE SKUTT INN/ ANT PALLER
     C     *IN55         IFEQ      '1'
     C                   ADD       1             ANTSEN
     C                   ADD       HSANTP        ANTPLL
     C     HSSTIN        IFEQ      ' '
     C                   ADD       1             IKKEKV
     C                   END
     C                   END
      *
     C     ULNR          READE(N)  HENOS                                  33
     C                   END
     C                   END
      * WARNING-VINDU VED EDI OG MANGLEDE INNSJEKK, MANGLENDE PALLANT.
     C     *IN55         IFEQ      '1'
     C     IKKEKV        IFNE      0
     C                   EXFMT     MANKOW2
     C     *IN11         CABEQ     '0'           START
     C                   END
     C     ANTPLL        IFLT      HOPLL2
     C                   EXFMT     PALLW
     C     *IN11         CABEQ     '0'           START
     C                   END
     C                   END
      *
     C* KLART FOR Å LAGE OPPDR.
     C                   EXSR      LAGOPD
     C                   GOTO      SLUTT
     C                   END
      *
      *** BLA VIDERE
     C   25              DO
     C                   Z-ADD     YRECNO        ZRECNO
     C                   SETOFF                                       25
     C                   GOTO      START2
     C                   END
      *
     C     ZRECNO        IFNE      0
     C                   EXSR      HENTSR
     C     REFRESH       IFEQ      'J'
     C                   GOTO      START
     C                   END
     C                   END
     C   98XRECNO        IFNE      0
     C                   Z-ADD     XRECNO        ZRECNO
     C                   END
     C                   GOTO      START3
      *
     C     START5        TAG
     C                   MOVE      'N'           NYENDR            1
     C                   MOVE      '0'           *IN40
     C                   MOVE      '0'           *IN60
     C                   EXSR      KDTFMT
     C                   EXFMT     VARELI
     C                   EXSR      KDTFMT
     C                   MOVEA     '00'          *IN(73)
     C                   MOVEA     '00000000'    *IN(75)
     C                   MOVEA     '00000000'    *IN(82)
     C                   MOVE      '0'           *IN30
      *
N03   * Se/koble avvikende fraktbetaler
N03  C     *IN02         IFEQ      '1'
N03  C                   EXSR      FRAKTBET
N03  C                   GOTO      START5
N03  C                   END
      *
     C     *IN04         IFEQ      '1'
     C                   EXSR      SØK
     C                   GOTO      START5
     C                   END
      * ENDRE TESTE-MODUS
     C     *IN10         IFEQ      '1'
     C     *IN41         IFEQ      '1'
     C                   MOVE      '0'           *IN41
     C                   ELSE
     C                   MOVE      '1'           *IN41
     C                   END
     C                   GOTO      START5
     C                   END
      *
      * HVIS IKKE AVBRUDD VED F12, VIS VARELI PÅ NY FOR NY RECORD
     C     *IN12         IFEQ      '1'
     C                   EXSR      MOVB2
     C                   ELSE
     C                   EXSR      TESTB
      * Har tastet/scannet nr som finnes fra før PÅ SAMME HENOP->ENDRE
     C     *IN30         IFEQ      '1'
     C     NYENDR        ANDEQ     'J'
     C                   EXSR      CHGTK
     C                   END
      * Testb har skrevet til fil/subfil hvis 30 OFF. Blank/vis NY
     C     *IN30         IFEQ      '0'
     C                   EXSR      MOVB2
     C                   END
      *
     C                   GOTO      START5
     C                   END
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   GOTO      START3
      *
     C     SLUTT         TAG
     C* - OPPDATER PÅ HEADER-FIL
     C                   EXSR      FINSUM
     C     ULNR          CHAIN     HENOP                              33
     C                   Z-ADD     SUMVKT        HOVKT
     C                   Z-ADD     SUMFBV        HOFBV
     C                   Z-ADD     SUMM3         HOM3
     C                   Z-ADD     SUMLM         HOLM
     C                   UPDATE    HENOPR
     C*
     c     UAuto         ifne      'J'
     c                   close     SYTR34FB
     c                   end
     C*
     C                   SETON                                        LR
     C                   RETURN
      *
     C***********************************************
     C     TESTB         BEGSR
     C***********************************************
      * IND 75 - 89 RESERV SOM FEIL-INDIKATORE (STARTET FRA TOP)
      * TESTE-MODUS 41 0FF BARE VISSE FELT, 41 ON - FULLTEST MODUS
      * SENDINGSNR
     C     WSSNDN        IFEQ      '*'
     C                   CALL      'SYGE15'
     C                   PARM                    WSSNDN
     C                   END
     C     WSSNDN        COMP      *BLANKS                                85
     C     *IN85         IFEQ      '1'
     C                   MOVE      'JOV1209'     MSGNR
     C                   Z-ADD     17            LINNBR
     C                   Z-ADD     28            POSNBR
     C                   SETON                                        30
     C                   END
      * ved ny-må ikke være brukt før...
     C     *IN85         IFEQ      '0'
     C     *IN40         ANDEQ     '0'
     C     WSSNDN        CHAIN     HENOS01                            33
     C     *IN33         IFEQ      '0'
     C                   Z-ADD     17            LINNBR
     C                   Z-ADD     28            POSNBR
     C                   SETON                                        3085
     C     HSLNR         IFNE      ULNR
     C                   MOVE      'JOV1190'     MSGNR
     C                   ELSE
     C                   EXSR      TSTOVF
      * FINNES FRA FØR- PÅ SAMME NR,STATUS ER ÅPEN => SWITCH TIL ENDRE
     C     *IN30         IFEQ      '0'
     C                   SETON                                        3085
     C                   MOVE      'JOV1191'     MSGNR
     C                   MOVE      'J'           NYENDR
     C                   GOTO      SLTB
     C                   END
     C                   END
     C                   END
     C                   END
      * UTVIDEDE TESTER SENDINGSNR...
     C     *IN85         IFEQ      '0'
     C                   EXSR      TSTSND
     C   85              SETON                                        30
     C                   Z-ADD     17            LINNBR
     C                   Z-ADD     28            POSNBR
     C                   MOVE      'JOV1209'     MSGNR
     C     SNFLAG        IFEQ      '1'
     C                   MOVE      'JOV1220'     MSGNR
     C                   END
     C                   END
      *
      * Kan ikke lage ny når ALLE/NOEN linjer er overført..
     C     *IN40         IFEQ      '0'
     C                   EXSR      TSTOV2
     C                   END
      *
      * FRANKATUR=HVEM BETALER - PP/S=SENDER CC/M=MOTTAKER ANNET=ANNEN
S03  C*    WSFR          IFEQ      *BLANKS
S03  C*                  MOVEL     IFFRHO        WSFR
S03  C*                  END
     C     KODFRK        CHAIN     KODTFR                             79
     C     *IN79         IFEQ      '1'
     C     *IN30         IFEQ      '0'
     C                   MOVE      'JOV1098'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     45            POSNBR
     C                   SETON                                        30
     C                   END
     C                   ELSE
     C                   SELECT
     C     KFRCP         WHENEQ    'PP'
     C     KFRCP         OREQ      'S '
     C                   MOVEL     'S'           BETAL             1
     C     KFRCP         WHENEQ    'CC'
     C     KFRCP         OREQ      'M '
     C                   MOVEL     'M'           BETAL
     C                   OTHER
     C                   MOVEL     'A'           BETAL
     C                   END
     C                   END
      *
      * KUNDE (HENTES TIDLIG PGA PNR..) - KRAV HVIS MOTTAK-BETALB.
     C     WSKNK         IFNE      *ZEROS
     C     KUNKEY        CHAIN     CUNDL01                            86
N03  C     HOEDSN        IFNE      *ZEROS
N03  C  N86DKUND         COMP      'D'                                    86
N03  C                   END
     C                   ELSE
     C   41BETAL         COMP      'M'                                    86
     C                   END
     C     *IN86         IFEQ      '0'
     C     WSKNK         ANDNE     *ZEROS
     C     WSNAK         ANDEQ     *BLANKS
     C                   EXSR      GETNAV
     C                   END
      *
      * POSTNR TIL(MÅ VÆRE GYLDIG/MÅ SAMSVARE MED EVT GITT LEV-ADRESSE)
      * FØRST - HVIS ETT AV DE ER BLANK KOPIER FRA DET ANDRE..
     C     WSTILP        IFEQ      *ZEROS
     C                   MOVE      WSPNRK        WSTILP
     C                   ELSE
     C     WSPNRK        IFEQ      *ZEROS
     C                   MOVE      WSTILP        WSPNRK
     C                   END
     C                   END
     C     WSTILP        COMP      *ZEROS                                 89
     C  N89              MOVEL     WSTILP        YYSTED
     C  N89STEDKE        CHAIN     STED2D                             89
     C     *IN89         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      'SPS0013'     MSGNR
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     13            POSNBR
     C                   SETON                                        30
     C                   END
      *
     C  N89WSTILP        COMP      WSPNRK                             8989
     C     *IN89         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      'JOV1171'     MSGNR
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     13            POSNBR
     C                   SETON                                        30
     C                   ELSE
     C                   MOVE      WSTILP        WSPNRK
     C                   MOVEL     WSPNRK        YYSTED
     C     STEDKE        CHAIN     STED2D                             33
     C  N33              MOVEL     ST2NVN        WSSTDK
     C                   END
      * ANT.
     C     WSANT         COMP      *ZEROS                                 81
     C     *IN81         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      '1'           *IN30
     C                   MOVE      'SPN0003'     MSGNR
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     22            POSNBR
     C                   END
      * VEKT
     C     WSVKT         COMP      *ZEROS                                 80
     C     *IN80         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      '1'           *IN30
     C                   MOVE      'SPV0002'     MSGNR
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     32            POSNBR
     C                   END
      * PRODUKTKODE
     C                   MOVEL     WSPROD        KFKOD
     C     KUFASK        CHAIN     KUFAST                             73
     C     *IN73         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      '1'           *IN30
     C                   MOVE      'YBC0360'     MSGNR
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     70            POSNBR
     C                   END
      *
      * ANNEN FRAKTBETALER
      * .. AUTOSØK??
     C     WSKNA         IFEQ      *ZEROS
     C     WXANAV        ANDNE     *BLANKS
     C                   MOVEL     WXANAV        UUSNAV           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    WSKNA
     C                   PARM                    FIFIRM
     C                   PARM                    UUSNAV
     C                   END
      *
     C     BETAL         IFEQ      'A'
     C     WSKNA         ORNE      *ZEROS
     C     KUNKE2        CHAIN     CUNDL01                            78
N03   * Edi-mottatte sendinger tillater ikke diverskunde
N03  C     HOEDSN        IFNE      *ZEROS
N03  C  N78DKUND         COMP      'D'                                    78
N03  C                   end
      * Kundenr 0 tilates ved "halv-modus"
     c     *in78         IFEQ      '1'
     c     *in41         andeq     '0'
     c     WSKNA         andeq     *zeros
     c                   move      *OFF          *IN78
     c                   end
     C     *IN78         IFEQ      '1'
     C     *IN30         IFEQ      '0'
     C                   MOVE      '1'           *IN30
     C                   MOVE      'JOV1198'     MSGNR
N03   * Edi-mottatt, - annen melding.
N03  C     HOEDSN        IFNE      *ZEROS
N03  C                   MOVE      'KUN0009'     MSGNR
N03  c                   end
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     57            POSNBR
     C                   END
     C                   ELSE
     C                   MOVEL     KNAVN         WXANAV
     C                   END
     C                   ELSE
     C                   MOVE      *BLANKS       WXANAV
     C                   END
      *
      * FORESLÅ AVDELING FOR HOVED-OPPDRAG (GJØRES HER - KAN!
      * (GJØRES HER - KAN.. VÆRE VIKTIG FOR FRAKT-BEREGNING.)
      * HOVED-OPD ER FRA-TERM. TIL MOTTAKERS POSTN, ALTSÅ UTGÅENDE!
      * DET ER EN EGEN TABELL PR TERMINAL (HOPNRT DEL 1 AV KEY)
N03  C                   MOVE      *Blanks       NOATAB
     C                   MOVE      *ZEROS        XXAVD             4 0
     C     WSPNRK        IFNE      *ZEROS
     C     HOPNRT        ANDNE     *ZEROS
N03  C     KODRIK        CHAIN     NOPNR                              33
N03  C     *IN33         IFEQ      *OFF
N03  C     NOAVDU        ANDNE     *ZEROS
N03  C                   MOVE      NOAVDU        RIAVDU
N03  C                   MOVE      NOAVDI        RIAVDI
N03  C                   MOVE      NOAVDH        RIAVDH
N03  C                   goto      AvdOK
N03  C                   END
     C     KODRIK        SETGT     KODTRI
     C     HOPNRT        READPE    KODTRI                                 33
     C  N33WSPNRK        IFGE      RIPNRF
     C     WSPNRK        ANDLE     RIPNRT
N03  C     AvdOk         Tag
     C                   MOVE      RIAVDU        XXAVD
     C                   ENDIF
     C                   END
      *
     C     WSAVD         IFEQ      *ZEROS
     C                   MOVE      XXAVD         WSAVD
     C                   END
      *
      **** BEREGN FRAKT
N03  C                   MOVE      *ZEROS        UAVNR
     C     WSKODH        IFNE      'A'
     C     WSKODH        ANDNE     'N'
     C                   SELECT
     C     BETAL         WHENEQ    'A'
     C                   MOVE      'K'           USKA              1
     C                   Z-ADD     WSKNA         UUKN              8 0
     C     BETAL         WHENEQ    'M'
     C                   MOVE      'K'           USKA              1
     C                   Z-ADD     WSKNK         UUKN              8 0
     C                   OTHER
     C                   MOVE      'S'           USKA              1
     C                   Z-ADD     HOKNS         UUKN              8 0
     C                   ENDSL
      *
     C                   Z-ADD     1             BYLOOP            1 0
     C     BYTTAG        TAG
     C                   MOVE      WSAVD         UAVD
     C                   MOVE      IFFRHO        XXFR
     C                   MOVE      WSPROD        XXKDPL
     C                   MOVEL     HOPNRS        XXSDF
     C                   MOVEL     WSPNRK        XXSDT
     C                   Z-ADD     WSM3          XXM3
     C                   Z-ADD     WSLM          XXLM
     C                   Z-ADD     WSANT         XXNT
     C                   Z-ADD     WSVKT         XXVKT
     C                   Z-ADD     WSVKT         XXFBV
     C     WSLM          IFNE      *ZEROS
     C     WSM3          ORNE      *ZEROS
     C     WSLM          MULT      KOVLKG        XFBV1             5 0
     C     WSM3          MULT      KOVKKG        XFBV2             5 0
     C     WSVKT         IFGE      XFBV1
     C                   Z-ADD     WSVKT         XXFBV
     C                   ELSE
     C                   Z-ADD     XFBV1         XXFBV
     C                   END
     C     XXFBV         IFLT      XFBV2
     C                   Z-ADD     XFBV2         XXFBV
     C                   END
     C                   END
     C                   MOVE      'N'           AGENT             1
      * KNR kan være 0 ved mottakerbetalt/annen komb med "halv-modus"
     C     UUKN          IFNE      *zeros
     C                   EXSR      BERFRP
     c                   else
     c                   move      'B'           XKDA
     c                   end
      * HVIS MASKINELL BEREGNING(POSTAL) OG AVTALE IKKE ER FUNNET...
      * DERSOM KODE FOR BYTT AVTALE ER SATT/VILKÅR OK- PRØV PÅ NY.....
      * KODE E=EGEN AVTALE (F.EKS IKKE SELGERS F.MOT MEN SELGER..)
     C     BYLOOP        IFEQ      1
     C     USKA          ANDEQ     'K'                                          MOTTAK/ANNEN
     C     XKDA          ANDNE     'A'                                          IKKE EGEN AV
     C                   ADD       1             BYLOOP
     C                   EXSR      BYTTAV
     C                   GOTO      BYTTAG
     C                   END
     C                   MOVE      'M'           WSKODH
     C                   Z-ADD     UUBELØ        WSBELH
     C                   Move      IFFARP        XXFARP            4 3
     C                   Move      IFVARP        XXVARP            4 3
     C                   clear                   cutranr
     C     UUKN          CHAIN     CUTRAN                             33
     C     *in33         Ifeq      *OFF
     C     CTIKFA        Ifeq      'X'
     C                   Move      *ZEROS        XXFARP
N17  C                   else
N17  C     CTAVFA        Ifne      *zeros
N17  C                   Move      CTAVFA        XXFARP
N17  C                   end
     C                   end
     C     CTIKVA        Ifeq      'X'
     C                   Move      *ZEROS        XXVARP
N17  C                   else
N17  C     CTAVVA        Ifne      *zeros
N17  C                   Move      CTAVVA        XXVARP
N17  C                   end
     C                   end
     C                   end
     C     UUBELØ        IFNE      *ZEROS
     C     WSVARM        IFNE      *BLANKS
     C     XXVARP        ANDNE     *ZEROS
     C     UUBELØ        MULT(H)   XXVARP        XXTILL            7 0
     C                   ADD       XXTILL        WSBELH
     C                   END
     C     WSFARL        IFNE      *BLANKS
     C     XXFARP        ANDNE     *ZEROS
     C     UUBELØ        MULT(H)   XXFARP        XXTILL            7 0
     C                   ADD       XXTILL        WSBELH
     C                   END
      * Minstefrakt på hoved-oppdrag
      * egne felt for fjerntrafikk  (men ved fjern så dyttes det inn i eksisterend kundefelt..)
     c     IFFJKO        ifne      ' '
     c                   movel     USONE         TstFjK            1
     c     TstFjK        ifeq      IFFJKO
     C                   move      CTAFMF        CTAVFM                         Kunde avv min fjer
     C                   move      CTIFMF        CTIKFM                         Kunde ikke min fje
     C     CTAVFM        IFEQ      *ZEROS
     C                   z-add     IFMIFF        CTAVFM                         Firma Minste fjern
     C                   END
     C                   END
     C                   END
     C     CTAVFM        IFEQ      *ZEROS
     C                   z-add     IFMIFR        CTAVFM
     C                   END
     C     CTAVFM        ifne      *zeros
     C     CTIKFM        andne     'X'
     C     wsprod        andeq     ' '
     C     wsbelh        andlt     CTAVFM
     C                   z-add     CTAVFM        WSbelh
     C                   END
     C                   END
     C                   END
      * PARAMETER I FIRMA/AVD-SETTING INNLAND AVGJØR KRAV...
     C     IFFRAK        IFEQ      'J'
     C     WSBELH        COMP      *ZEROS                                 82
     C   82WSKODH        COMP      'N'                                8282
     C     *IN82         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      'JOV1165'     MSGNR
      * mer pressis melding når manglende fraktbeløp kan skyldes at det
      * er angitt avvik. betaler og sender avtale IKKE tillates "lånt"
     c     BETAL         IFEQ      'M'
     c     WSKNK         ANDEQ     *ZEROS
     C                   MOVE      'JOV1317'     MSGNR
     C                   ELSE
     c     BETAL         IFEQ      'A'
     c     WSKNA         ANDEQ     *ZEROS
     C                   MOVE      'JOV1318'     MSGNR
     C                   END
     C                   END
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     62            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
     C* VARE-BESKR
     C     *IN41         IFEQ      '1'                                            *FULLMODUS
     C     WSVB          ANDEQ     *BLANKS
     C                   MOVEL     'KLL '        WSVB
     C                   END
      *
      * FEIL-MELDING PÅ KUNDE (86 ON=FEIL/MANGLENDE NR-CHAIN GJORT FØR)
     C     *IN86         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      '1'           *IN30
     C                   MOVE      'JOV1198'     MSGNR
N03  C     HOEDSN        IFNE      *ZEROS
N03  C                   MOVE      'KUN0009'     MSGNR
N03  c                   end
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     9             POSNBR
     C                   END
      *  NAVN MOTTAKER
     C     *IN41         IFEQ      '1'                                            *FULLMODUS
     C     WSNAK         COMP      *BLANKS                                84
     C     *IN84         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      'JOV1157'     MSGNR
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     18            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
      * GATEADRESSE.
     C     *IN41         IFEQ      '1'                                            *FULLMODUS
     C     WSADK1        COMP      *BLANKS                                88
     C     *IN88         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      'JOV1175'     MSGNR
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     49            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
      *
     C     *IN41         IFEQ      '1'                                            *FULLMODUS
     C     WSRFA         COMP      *BLANKS                                76
     C     *IN76         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      'JOV0861'     MSGNR
     C                   Z-ADD     21            LINNBR
     C                   Z-ADD     9             POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
      * DATO
     C     WSDT          IFNE      *ZEROS
     C                   MOVE      WSDTÅ         UÅÅ               2 0
     C                   MOVE      WSDTM         UMM               2 0
     C                   MOVE      WSDTD         UDD               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      87
     C     *IN87         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      'SPD0001'     MSGNR
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     62            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
      *
     C*** HENTE UTLEVERINGSFORBEHOLD
     C                   MOVE      *BLANKS       WXUTKT
     C     WSUTKO        IFNE      '  '
     C     WSUTKO        CHAIN     KODTU                              74
     C  N74              MOVEL     KUTX          WXUTKT
     C     *IN74         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      'YBC0487'     MSGNR
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     29            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
      *
     C     WSTRJN        IFEQ      'N'
     C                   MOVE      *ZEROS        WSPNRT
     C                   MOVE      *ZEROS        WSAGTR
     C                   MOVE      *BLANKS       WXTNAV
     C                   MOVE      *ZEROS        WSBELA
     C                   END
      * POSTNR TERMINAL  (VIA2-STED)
     C     *IN41         IFEQ      '1'                                            *FULLMODUS
     C     WSPNRT        IFNE      *ZEROS
     C     WSPNRT        ANDNE     9999
     C                   MOVEL     WSPNRT        YYSTED
     C     STEDKE        CHAIN     STED2D                             75
     C     *IN75         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      'JOV1204'     MSGNR
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     09            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
     C                   END
      * TRANSPORTØR/AGENT VIA2
     C                   MOVE      *BLANKS       WXTNAV
     C     WSAGTR        IFNE      *ZEROS
     C     TRAKEY        CHAIN     TRAN                               77
     C  N77              MOVEL     VMNAVN        WXTNAV
     C     *IN77         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      'JOV1202'     MSGNR
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     18            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
      *
      * AVD-NR FOR HOVED-OPPDRAGENE
     C                   MOVE      WSAVD         YYAVD
     C     KODTAK        CHAIN     KODTA                              83
     C  N83KODTVK        CHAIN     KODTV                              83
     C     *IN83         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      'SPA0001'     MSGNR
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     75            POSNBR
     C                   SETON                                        30
     C                   END
      *
      * MISMATCH AVD.
     C     WSAVD         IFNE      XXAVD
     C     XXAVD         ANDNE     *ZEROS
     C     *IN30         ANDEQ     '0'
     C     MELDTA        ANDEQ     'N'
     C                   MOVE      'J'           MELDTA            1
     C                   MOVE      'JOV1203'     MSGNR
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     75            POSNBR
     C                   SETON                                        30
     C                   END
      *
      **** HENT "VIASTED/AGENT" BASERT PÅ AVDELING
     C     *IN30         IFEQ      '0'
     C     WSAGTR        ANDEQ     *ZEROS
     C     WSPNRT        ANDNE     9999
     C     WSTRJN        ANDNE     'N'
     C     WSAVD         CHAIN     KODTAG                             33
     C     *IN33         IFEQ      '0'
     C     AGTRNR        andne     *zeros
     C                   MOVEL     AGPNRT        WSPNRT
     C                   MOVEL     AGTRNR        WSAGTR
     C     TRAKEY        CHAIN     TRAN                               77
     C  N77              MOVEL     VMNAVN        WXTNAV
     C                   END
     C                   END
      *
      **** BEREGN FRAKT MOT AGENT
     C     *IN30         IFEQ      '0'
     C     WSAGTR        ANDNE     *ZEROS
     C     WSBELA        ANDEQ     *ZEROS
     C                   Z-ADD     VMTRKU        UUKN              8 0
     C                   MOVE      WSAVD         UAVD
     C                   MOVE      IFFRHO        XXFR
     C                   MOVE      WSPROD        XXKDPL
     C                   MOVEL     WSPNRT        XXSDF
     C                   MOVEL     WSPNRK        XXSDT
     C                   Z-ADD     WSM3          XXM3
     C                   Z-ADD     WSLM          XXLM
     C                   Z-ADD     WSANT         XXNT
     C                   Z-ADD     WSVKT         XXVKT
     C                   Z-ADD     WSVKT         XXFBV
     C     WSLM          IFNE      *ZEROS
     C     WSM3          ORNE      *ZEROS
     C     WSLM          MULT      KOVLKG        XFBV1             5 0
     C     WSM3          MULT      KOVKKG        XFBV2             5 0
     C     WSVKT         IFGE      XFBV1
     C                   Z-ADD     WSVKT         XXFBV
     C                   ELSE
     C                   Z-ADD     XFBV1         XXFBV
     C                   END
     C     XXFBV         IFLT      XFBV2
     C                   Z-ADD     XFBV2         XXFBV
     C                   END
     C                   END
      *
N03  C     UAVNR         IFEQ      *ZEROS
N03  C     KUNKAV        CHAIN     CUNDL01                            33
N03  C     *IN33         IFEQ      '0'
N03  C                   TESTN                   SYSTAT               33
N03  C     *IN33         IFEQ      '1'
N03  C                   MOVE      SYSTAT        XXM3IN            3 0
N03  C     XXM3IN        IFGE      100
N03  C                   Z-ADD     XXM3IN        AFOMRM
N03  C                   Z-ADD     99            UAVNR
N03  C                   END
N03  C                   END
N03  C                   END
N03  C                   END
N03  C*
N03  C     UAVNR         IFNE      *ZEROS
N03  C     WSM3          ANDNE     *ZEROS
N03  C     UAVNR         CHAIN     AVFRHL01                           33
N03  C     *IN33         IFEQ      '0'
N03  C                   MOVE      *ZEROS        XXM3
N03  C                   MOVE      *ZEROS        XXLM
N03  C                   Z-ADD     WSVKT         XXFBV
N03  C     WSM3          MULT      AFOMRM        XFBV2             5 0
N03  C     XXFBV         IFLT      XFBV2
N03  C                   Z-ADD     XFBV2         XXFBV
N03  C                   Z-ADD     XFBV2         XXVKT
N03  C                   END
N03  C                   END
N03  C                   END
      *
     C                   MOVE      'J'           AGENT             1
     C                   EXSR      BERFRP
     C*                    MOVE 'M'       WSKODA
     C                   Z-ADD     UUBELØ        WSBELA
     C                   END
      *
      * HOPP UT VED FEIL
     C     *IN30         CABEQ     '1'           SLTB
      *
      *** OPPDATERE PÅ REGISTER OG SUBFIL
     C     WSLNR2        IFNE      *ZEROS
     C     LNRKEY        CHAIN     HENOS                              44
     c     *in44         Ifeq      *off
     c     GMVKT         Ifne      HSVKT
     c     GMM3          orne      HSM3
     c                   exfmt     ENDRET
     c                   move      HSVKT         WSVKT
     c                   move      HSM3          WSM3
     c                   move      HEVKT         GMVKT
     c                   move      HEM3          GMM3
     c                   end
     c                   end
     C                   ELSE
     C                   EXSR      GETLNR
     C                   SETON                                        44
     C                   END
      *
     C                   EXSR      MOVWTK
      *
     C     *IN44         IFEQ      '0'
     C                   UPDATE    HENOSR
     C     NYENDR        IFNE      'J'
     C     IFSCIN        IFEQ      'J'
     C     HSSTIN        COMP      ' '                                    59
     C                   END
     C     HOEDSN        IFNE      *ZEROS
     C                   EXSR      TSTTXT
     C                   END
     C     HSDS29        COMP      'E'                                    52
     C                   UPDATE    SUBFIL
     C                   END
     C                   ELSE
     C                   WRITE     HENOSR
     C     NYENDR        IFNE      'J'
     C                   ADD       1             YRECNO
     C                   Z-ADD     YRECNO        ZRECNO
     C     HSDS29        COMP      'E'                                    52
     C                   WRITE     SUBFIL
     C                   WRITE     SUBCTL
     C                   END
     C                   END
     C                   EXSR      MOVB2
      *
     C     SLTB          ENDSR
      *
     C***********************************************
     C     BYTTAV        BEGSR
     C***********************************************
      * MOTTAKER/ANNEN ER FRAKTBETALER - TILLATER AVSENDER BYTT AVTALE?
     C     HSVKT         IFLE      IFOTVG
     C                   MOVEL     IFOTFF        HEOT
     C                   ELSE
     C                   MOVEL     IFO2FF        HEOT
     C                   END
     C                   MOVE      IFFRFF        HEFR
     C     KAVTS         CHAIN     KAVT                               33
     C  N33              MOVE      HOKNS         UUKN
     C                   ENDSR
     C***********************************************
     C     TSTSND        BEGSR
     C***********************************************
      * 9 SIFFER ER GITT - BEREGN KONTR.SIFFER
     C     WSSN9A        IFNE      *BLANKS
     C     WSSN9B        ANDEQ     *BLANKS
     C     WSSN9C        ANDEQ     *BLANKS
     C                   TESTN                   WSSN9A               33
     C     *IN33         IFEQ      '1'
     C                   MOVE      *ZEROS        XBAK              1 0
     C                   MOVE      *ZEROS        UPAR21           21
     C                   MOVE      WSSN9A        UPAR21
     C                   CALL      'SYGE09'
     C                   PARM                    UPAR21
     C                   PARM                    XBAK
     C                   MOVE      XBAK          WSSN9B
     C                   END
     C                   END
     C                   MOVE      '0'           SNFLAG
      * OPD = 0 ELLER SENDNR ER ENDRET.. TEST.
     C     WSSNDN        COMP      *BLANKS                                85
      * KORT NR - TEST MODULUS 10.
     C     *IN85         IFEQ      *OFF
     C     WSSN9C        ANDEQ     *BLANKS
     C                   TESTN                   WSSN9A               33
     C     *IN33         IFEQ      '0'
     C                   SETON                                            85
     C                   ELSE
     C                   MOVE      *ZEROS        XBAK              1 0
     C                   MOVE      *ZEROS        UPAR21           21
     C                   MOVE      WSSN9A        UPAR21
     C                   CALL      'SYGE09'
     C                   PARM                    UPAR21
     C                   PARM                    XBAK
     C                   MOVE      XBAK          XBAKA             1
     C     WSSN9B        COMP      XBAKA                              8585
     C                   END
     C                   END
      * LANGT NR - TEST EAN KTRL-SIFFER (3 FØRSTE KAN VÆRE 401/402)
     C     *IN85         IFEQ      *OFF
     C     WSSN9C        ANDNE     *BLANKS
     C                   TESTN                   WSSNDN               33
     C     *IN33         IFEQ      '0'
     C                   SETON                                            85
     C                   ELSE
     C                   MOVE      *ZEROS        UAN22            22
     C                   MOVE      WSSN17        UAN22            22
     C                   MOVE      '0'           UAN22
     C                   CALL      'SYGE08'
     C                   PARM                    UAN22
     C                   MOVE      UAN22         UFN17            17
     C                   MOVE      UFN17         XBAKA
     C     WSSN20        COMP      XBAKA                              8585
     C     *IN85         IFEQ      '0'
     C     WSSNEA        COMP      '401'                              8585
     C                   END
     C                   END
     C                   END
      * SKAL IKKE VÆRE BRUKT FØR...
     C     *IN85         IFEQ      '0'
     C                   MOVE      WSSNDN        SNSNDN           20
     C                   MOVE      *ZEROS        SNDAVD            4 0
     C                   MOVE      *ZEROS        SNDOPD            7 0
     C                   MOVE      'H'           SNFLAG            1
     C                   CALL      'SYTR10C'
     C                   PARM                    SNSNDN
     C                   PARM                    SNDAVD
     C                   PARM                    SNDOPD
     C                   PARM                    SNFLAG
     C     SNFLAG        COMP      '1'                                    85
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     SØK           BEGSR
     C***********************************************
      *
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
      * POSTNR FRA
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     13
     C     POSNBR        ANDLE     16
     C                   MOVE      FILAND        XXLAND            2
     C                   MOVEL     WSTILP        XXPNR             5
     C                   MOVE      *BLANKS       USØKPN           30
     C                   CALL      'SYFI10F'
     C                   PARM                    XXPNR
     C                   PARM                    USØKPN
     C                   PARM                    XXLAND
     C                   MOVEL     XXPNR         XXPNR4            4
     C                   TESTN                   XXPNR4               33
     C   33              MOVE      XXPNR4        WSTILP
     C                   Z-ADD     22            POSNBR
     C                   GOTO      SLTSØK
     C                   END
      *
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDEQ     70
     C                   MOVEL     WSPROD        KFKOD
     C                   CALL      'SYKUKD'
     C                   PARM                    YKFTYP
     C                   PARM                    UUPDAT
     C                   PARM                    KFKOD
     C                   MOVEL     KFKOD         WSPROD
     C                   Z-ADD     75            POSNBR
     C                   GOTO      SLTSØK
     C                   END
      *
      * ANNEN FRAKTBETALER
     C     LINNBR        IFEQ      19
     C     POSNBR        ANDGE     57
     C     POSNBR        ANDLE     64
     C                   MOVEL     WXANAV        UUSNAV           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    WSKNA
     C                   PARM                    FIFIRM
     C                   PARM                    UUSNAV
     C     WSKNA         IFNE      *ZEROS
     C     KUNKE2        CHAIN     CUNDL01                            78
     C  N78              MOVEL     KNAVN         WXANAV
     C                   END
     C                   GOTO      SLTSØK
     C                   END
      *
      * KUNDENR MOTTAKER
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     09
     C     POSNBR        ANDLE     16
     C                   CALL      'SOEKKUN'
     C                   PARM                    WSKNK
     C                   PARM                    FIFIRM
     C                   PARM                    WSNAK
     C     WSKNK         IFNE      *ZEROS
     C     KUNKEY        CHAIN     CUNDL01                            86
     C     *IN86         IFEQ      '0'
     C                   EXSR      GETNAV
     C                   END
     C                   END
     C                   GOTO      SLTSØK
     C                   END
     C* FRANKATUR / BETALER
     C     LINNBR        IFEQ      19
     C     POSNBR        ANDGE     45
     C     POSNBR        ANDLE     47
     C                   MOVE      'J'           USPED             1
     C                   CALL      'SYFI10G'
     C                   PARM                    WSFR
     C                   PARM                    USPED
     C                   Z-ADD     57            POSNBR
     C                   GOTO      SLTSØK
     C                   END
      *
      * SØK VAREADRESSE (PRIMÆRT PÅ GITT KUNDE SEK. PÅ AVSENDER)
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     18
     C     POSNBR        ANDLE     47
     C     WSKNK         IFNE      *ZEROS
     C                   MOVE      WSKNK         XKN
     C                   ELSE
     C                   MOVE      HOKNS         XKN
     C                   END
     C                   MOVE      *BLANKS       XNAVN
     C                   CALL      'SOEKVADR'
     C                   PARM                    FIFIRM
     C                   PARM                    XKN               8 0
     C                   PARM                    XNAVN            30
     C                   PARM                    XADR1            30
     C                   PARM                    XADR2            30
     C                   PARM                    XADR3            30
     C                   PARM                    XLK               2
     C                   PARM                    XADRNR            5
     C     XNAVN         IFNE      *BLANKS
     C                   MOVEL     XNAVN         WSNAK
     C                   MOVEL     XADR1         WSADK1
     C                   MOVEL     XADR2         WSADK2
     C                   MOVEL     XADR3         TMPPNR            4
     C                   TESTN                   TMPPNR               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      TMPPNR        WSPNRK                          POSTNR
     C                   MOVE      XADR3         TMPAD3           25
     C                   MOVEL     TMPAD3        WSSTDK                          STED
     C                   ELSE
     C                   MOVE      *ZEROS        WSPNRK
     C                   MOVEL     XADR3         WSSTDK
     C                   END
     C                   END
     C                   GOTO      SLTSØK
     C                   END
      * POSTNR VIA-TERMINAL
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDGE     09
     C     POSNBR        ANDLE     12
     C                   MOVE      FILAND        XXLAND            2
     C                   MOVEL     WSPNRT        XXPNR             5
     C                   MOVE      *BLANKS       USØKPN           30
     C                   CALL      'SYFI10F'
     C                   PARM                    XXPNR
     C                   PARM                    USØKPN
     C                   PARM                    XXLAND
     C                   MOVEL     XXPNR         XXPNR4            4
     C                   TESTN                   XXPNR4               33
     C   33              MOVE      XXPNR4        WSPNRT
     C                   Z-ADD     20            POSNBR
     C                   GOTO      SLTSØK
     C                   END
      *
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDGE     20
     C     POSNBR        ANDLE     27
     C                   CALL      'SYTR04A'
     C                   PARM                    WSAGTR
     C     TRAKEY        CHAIN     TRAN                               77
     C  N77              MOVEL     VMNAVN        WXTNAV
     C  N77              Z-ADD     49            POSNBR
     C                   GOTO      SLTSØK
     C                   END
      * AVDELING
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDGE     75
     C     POSNBR        ANDLE     78
     C                   CALL      'SYFA14B'
     C                   PARM                    WSAVD
     C                   GOTO      SLTSØK
     C                   END
      * UTLEV.FORBEHOLD
     C     LINNBR        IFEQ      23
     C     POSNBR        ANDGE     29
     C     POSNBR        ANDLE     30
     C                   CALL      'SYFA71A'
     C                   PARM                    WSUTKO
     C                   Z-ADD     46            POSNBR
     C                   GOTO      SLTSØK
     C                   END
      *
     C     SLTSØK        ENDSR
      *
     C***********************************************
     C     GETNAV        BEGSR
     C***********************************************
      *
     C                   MOVEL     KNAVN         WSNAK
     C                   MOVEL     ADR1          WSADK1
     C                   MOVEL     ADR2          WSADK2
     C                   MOVE      POSTNR        WSPNRK
     C                   MOVEL     ADR3          WSSTDK
      *
     C     VADRKE        CHAIN     VADR                               34
     C     *IN34         IFEQ      '0'
     C                   MOVE      VADRNA        WSNAK
     C                   MOVE      VADRN1        WSADK1
     C                   MOVE      VADRN2        WSADK2
     C                   MOVEL     VADRN3        TMPPNR
     C                   TESTN                   TMPPNR               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      TMPPNR        WSPNRK                          POSTNR
     C                   MOVE      VADRN3        TMPAD3           25
     C                   MOVEL     TMPAD3        WSSTDK                          STED
     C                   ELSE
     C                   MOVE      *ZEROS        WSPNRK
     C                   MOVEL     VADRN3        WSSTDK
     C                   END
     C                   END
     C                   ENDSR
     C***********************************************
     C     HENTSR        BEGSR
     C***********************************************
      * initier hjelpevariabler for evt MankoVindu (v/valg 9)
     C                   MOVE      'J'           MANWIN            1
     C                   MOVE      'N'           WSVPaHver         1
      * Skal Subfil fullstendig refreshes etter utført valg..
     C                   MOVE      'N'           REFRESH           1
     C                   Z-ADD     0             LINNBR
     C                   SETOFF                                       919299
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C   98              DO
     C   99              SETOFF                                       98
     C                   Z-ADD     1             LINNBR
     C                   GOTO      SLHENT
     C                   END
      *
     C     ZRECNO        DIV       15            LINNBR
     C                   MVR                     XLIN              2 0
     C     XLIN          IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
      * SIKRE AT ALLE HENOSDATA ER TILGJENGELIGE
     C     HENOSK        CHAIN(N)  HENOS                              33
      *
     C     WSNR          IFEQ      '2'
     C                   MOVE      ' '           WSNR
     C     XDLT          COMP      '*DELETE'                              98
     C   98              GOTO      SLHENT
     C                   EXSR      TSTOVF
     C   30              GOTO      SLHENT
     C                   MOVE      'N'           NYENDR            1
     C                   EXSR      CHGTK
     C   12              GOTO      SLHENT
     C                   END
      *
     C     WSNR          IFEQ      '4'
     C                   MOVE      ' '           WSNR
     C     XDLT          COMP      '*DELETE'                              98
     C   98              GOTO      SLHENT
     C                   EXSR      TSTOVF
     C   30              GOTO      SLHENT
     C                   EXSR      DLTTK
     C   12              GOTO      SLHENT
     C                   END
N19   *
N19  C     WSNR          IFEQ      'D'                                          Overfør som DIREKTE
N19  C                   MOVE      ' '           WSNR
N19  C     XDLT          COMP      '*DELETE'                              98
N19  C   98              GOTO      SLHENT
N19  C                   EXSR      TSTOVF
N19  C   30              GOTO      SLHENT
N19  C                   EXSR      DIROPPD
N19  C   12              GOTO      SLHENT
N12  C                   END
      *
     C     WSNR          IFEQ      '8'
     C                   MOVE      ' '           WSNR
     C     XDLT          COMP      '*DELETE'                              98
     C   98              GOTO      SLHENT
     C     IFSCIN        IFEQ      'J'
     C     HSSTIN        COMP      ' '                                    59
     C                   END
     C     HOEDSN        IFNE      *ZEROS
     C                   EXSR      TSTTXT
     C                   END
     C     HSDS29        COMP      'E'                                    52
     C                   UPDATE    SUBFIL
s01  C* påbegynt men aldri fullført SYFI10Z - kopiert annet steds fra
s01  C*                  CALL      'SYFI10Z'
N01  C                   CALL      'SYTR34ZF'
     C                   PARM                    HOEDSN
     C                   PARM                    HSLNR2
     C                   END
      *
     C* MANUELT SETTE SKUTT-STATUS (KUN VED EDI-MOTTATTE)
     C     WSNR          IFEQ      '9'
     C     IFSCIN        ANDEQ     'J'
     C     *IN55         ANDEQ     '1'
     C                   MOVE      ' '           WSNR
     C     XDLT          COMP      '*DELETE'                              98
     C   98              GOTO      SLHENT
     C                   EXSR      TSTOVF
     C   30              GOTO      SLHENT
     C     MANWIN        IFEQ      'J'
     C                   EXFMT     MANKOW
     C     HSDS29        COMP      'E'                                    52
     C   12              UPDATE    SUBFIL
     C   12              GOTO      SLHENT
     C                   END
     C                   EXSR      MANKO
     C                   END
      *
     C                   END
      *
     C     SLHENT        TAG
     C                   ADD       4             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   SETOFF                                       99
     C   98              DO
     C                   MOVE      'DIV0012'     MSGNR
     C                   SETON                                            30
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     MANKO         BEGSR
     C***********************************************
     C                   MOVE      'J'           REFRESH
      * MANKOVINDU trengs ikke vises på neste subfilpost.
     C     WSVPaHver     IFNE      'J'
     C                   MOVE      'N'           MANWIN
     C                   END
      ** Valg 2 Aksepter manko - kjør videre som om komplett..
     C     WSMANK        IFEQ      '2'
     C     LNRKEY        CHAIN     HENOS                              33
     C     *IN33         IFEQ      '0'
     C     HSSTIN        ANDEQ     ' '
     C                   MOVE      '9'           HSSTIN
     C                   MOVEL     ZUSER         HSDSUS
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      ULDT          HSDSDT
     C                   MOVEL     XULTM         HSDSTI
     C                   MOVEL     '9'           HSDSDM
     C                   END
     C  N33              UPDATE    HENOSR
      *
      ** Valg 1 Splitt / bevar rest
     C                   ELSE
      * SPLITT UT DE SOM IKKE ER SKUTT (ER MANKO) I EGEN SENDING.
      * SJEKK AT MINST EN, MEN IKKE ALLE ER SKUTT FOR Å TILLATE SPLITT
     C                   MOVE      *ZEROS        ANTTOT            3 0
     C                   MOVE      *ZEROS        ANTMAN            3 0
     C     HENOSK        SETLL     HENOK
     C     HENOSK        READE(N)  HENOK                                  33
     C     *IN33         DOWEQ     *OFF
     C                   ADD       1             ANTTOT
     C     HKSTIN        IFEQ      ' '
     C                   ADD       1             ANTMAN
     C                   END
     C     HENOSK        READE(N)  HENOK                                  33
     C                   END
      * Kjør splitt hvis minst en, men ikke alle er skutt
      * Bruk forholdstallene for å redusere ant/vekt frakt..
      *(På sikt kan en her forbedre med at en velger å vise valgbilde
      * for hver enkelt post og evt MANUELT kan sette beløp/forh.tall)
     C     ANTTOT        IFGT      0
     C     ANTMAN        andgt     0
     C     ANTMAN        andne     ANTTOT
      *
     C     ANTMAN        DIV       ANTTOT        MANFAKTOR         9 6
     C     HSVKT         MULT(H)   MANFAKTOR     MAVKT
     C     HSFBV         MULT(H)   MANFAKTOR     MAFBV
     C     HSM3          MULT(H)   MANFAKTOR     MAM3
     C     HSLM          MULT(H)   MANFAKTOR     MALM
     C     HSBELA        MULT(H)   MANFAKTOR     MABELA
     C     HSBELH        MULT(H)   MANFAKTOR     MABELH
     C     HSBEL         MULT(H)   MANFAKTOR     MABEL
      * REDUSER verdiene på originalt sendingsnr
      *  (HSKODH->A LÅS PRIS ???)
     C     HENOSK        CHAIN     HENOS                              33
     C     ANTTOT        sub       ANTMAN        HSANT
     C                   sub       MAVKT         HSVKT
     C                   sub       MAFBV         HSFBV
     C                   sub       MAM3          HSM3
     C                   sub       MALM          HSLM
     C                   sub       MABELA        HSBELA
     C                   sub       MABELH        HSBELH
     C                   sub       MABEL         HSBEL
      * Lager heldelsen i DS... (men betrakes nå som ferdig skutt)
     C                   MOVE      'X'           HSSTIN
     C                   MOVEL     ZUSER         HSDSUS
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      ULDT          HSDSDT
     C                   MOVEL     XULTM         HSDSTI
     C                   MOVEL     'O'           HSDSDM
     C                   UPDATE    HENOSR
      * Bevar originals sekv.nr for x-ref
     C                   MOVE      HSLNR2        ORLNR2
      *
      * MANKOEN / RESTEN..
      * Hent nytt løpenr / nytt sendingsnr / lagre rest som åpen.
      * flytt over i WS-variabler (GETLNR ØDELEGGER HS-VARIABLE)
     C                   EXSR      MOVTKW
     C                   EXSR      GETLNR
     C                   MOVE      *BLANKS       WSSNDN
     C                   CALL      'SYGE15'
     C                   PARM                    WSSNDN
     C                   MOVE      *ON           *IN44
     C                   EXSR      MOVWTK
      * Bevar "mankopostens" løpenr for x-ref
     C                   MOVE      HSLNR2        MALNR2
     C                   Z-ADD     ANTMAN        HSANT
     C                   Z-ADD     MAVKT         HSVKT
     C                   Z-ADD     MAFBV         HSFBV
     C                   Z-ADD     MAM3          HSM3
     C                   Z-ADD     MALM          HSLM
     C                   Z-ADD     MABELA        HSBELA
     C                   Z-ADD     MABELH        HSBELH
     C                   Z-ADD     MABEL         HSBEL
      * lagre hendelsen i DS (staus er nå åpen)  - Peke på originalen..
     C                   MOVE      ' '           HSSTIN
     C                   MOVEL     ZUSER         HSDSUS
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      ULDT          HSDSDT
     C                   MOVEL     XULTM         HSDSTI
     C                   MOVEL     'R'           HSDSDM
     C                   MOVE      ORLNR2        HSDSMOTP
     C                   WRITE     HENOSR
      *
      * Legg x-ref til ny post ("manko-posten") på originalen
     C                   MOVE      ORLNR2        HSLNR2
     C     HENOSK        CHAIN     HENOS                              33
     C                   MOVE      MALNR2        HSDSMOTP
     C                   UPDATE    HENOSR
      *
      * flytt de manko-kolliene over på den nye posten
     C     HENOSK        SETLL     HENOK
     C     HENOSK        READE     HENOK                                  33
     C     *IN33         DOWEQ     *OFF
     C     HKSTIN        IFEQ      ' '
     c                   DELETE    HENOKR
     C                   MOVE      MALNR2        HKLNR2
     c                   WRITE     HENOKR
     C                   ELSE
     c                   UPDATE    HENOKR
     C                   END
     C     HENOSK        READE     HENOK                                  33
     C                   END
     C                   END
     C                   END
      *
      *
     C                   ENDSR
      *
      *
     C***********************************************
     C     TSTOVF        BEGSR
     C***********************************************
     C                   MOVE      HSLNR2        WSLNR2
     C     LNRKEY        CHAIN(N)  HENOS                              33
     C     HSST          COMP      'O'                                    30
     C   30              MOVE      'JOV1211'     MSGNR
     C                   ENDSR
      *
     C***********************************************
     C     TSTOV2        BEGSR
     C***********************************************
     C     ULNR          CHAIN(N)  HENOP                              33
     C     HOST          COMP      'O'                                    30
     C  N30HOMOPD        COMP      9999999                                30
     C   30              MOVE      'JOV1212'     MSGNR
     C                   ENDSR
     C***********************************************
     C     CHGTK         BEGSR
     C***********************************************
      *
     C                   EXSR      MOVTKW
     C                   MOVE      '1'           *IN40
      * ENDRING - CURSOR VED KUNDENR - DFT TESTMODUS = FULL
     C                   MOVE      '1'           *IN41                             FULL TEST
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     09            POSNBR
     C     STCHG         TAG
     C                   EXSR      KDTFMT
     C                   EXFMT     VARELI
     C                   EXSR      KDTFMT
     C                   MOVEA     '00000000'    *IN(75)
     C                   MOVEA     '00000000'    *IN(82)
     C                   MOVE      '0'           *IN30
N03   * Se/koble avvikende fraktbetaler
N03  C     *IN02         IFEQ      '1'
N03  C                   EXSR      FRAKTBET
N03  C                   GOTO      STCHG
N03  C                   END
      * SØK
     C     *IN04         IFEQ      '1'
     C                   EXSR      SØK
     C                   GOTO      STCHG
     C                   END
      * ENDRE TESTE-MODUS
     C     *IN10         IFEQ      '1'
     C     *IN41         IFEQ      '1'
     C                   MOVE      '0'           *IN41
     C                   ELSE
     C                   MOVE      '1'           *IN41
     C                   END
     C                   GOTO      STCHG
     C                   END
      *
     C   12              DO
     C     NYENDR        IFNE      'J'
     C     IFSCIN        IFEQ      'J'
     C     HSSTIN        COMP      ' '                                    59
     C                   END
     C     HOEDSN        IFNE      *ZEROS
     C                   EXSR      TSTTXT
     C                   END
     C     HSDS29        COMP      'E'                                    52
     C                   UPDATE    SUBFIL
     C                   END
     C                   EXSR      MOVB2
     C                   END
     C  N12              EXSR      TESTB
     C  N12
     CAN 30              GOTO      STCHG
     C     XLIN          IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
      *
     C                   ENDSR
      *
N03
N03  C***********************************************
N03  C     FRAKTBET      BEGSR
N03  C***********************************************
N03  C     WSCLOC        DIV       256           LINNBR
N03  C                   MVR                     POSNBR
N03   *
N03   * Cursor i Annen Fraktbetaler
N03  C     LINNBR        IFEQ      19
N03  C     POSNBR        ANDGE     57
N03  C     POSNBR        ANDLE     64
N03  c                   move      'A'           MOTANN            1
N03  c                   movel     ' "Annen"    'MOTANNTX
N03  c                   move      wskna         INTKNR
N03  C                   else
N03   * Cursor i Mottaker betaler
N03  C     LINNBR        IFEQ      20
N03  C     POSNBR        ANDGE     09
N03  C     POSNBR        ANDLE     16
N03  c                   move      'M'           MOTANN
N03  c                   movel     ' Mottaker   'MOTANNTX
N03  c                   move      wsknk         INTKNR
N03  C                   else
N03   * Cursor feilplassert
N03  C                   MOVE      'KUN0010'     MSGNR
N03  c                   MOVE      *on           *in30
N03  c                   goto      UtFbet
N03  c                   end
N03  c                   end
N03   *
N03  C                   clear                   EDIKNR
N03  C                   clear                   EDINAV
N03  C                   clear                   EDIAD1
N03  C                   clear                   EDIAD2
N03  C                   clear                   EDIAD3
N03   *
N03  C                   Z-add     25            NGN
N03  C                   z-add     HSLNR2        NREP0
N03  C                   MOVE      '0'           *IN30
N03   * Hent rett part.
N03  C     FBetKey       SETLL     ENAD93A
N03  C     FBetKey       READE     ENAD93A                                33
N03  C     *IN33         DOWEQ     '0'
N03   * F2 fra mottaker-feltet..      finn NAD+CN
N03  C     MOTANN        IFEQ      'M'
N03  C     N3035         CABNE     'CN'          NextNAD
N03  C                   END
N03   * F2 fra Annen f.bet. feltet..  finn NAD+IV
N03  C     MOTANN        IFEQ      'A'
N03  C     N3035         CABNE     'IV'          NextNAD
N03  C                   END
N03   * Kundes kundenr
N03  C     N3055         IFEQ      '91'
N03  C     N3039         ANDNE     '0'
N03  C                   MOVEL     N3039         EDIKNR
N03  C                   END
N03  C                   MOVEL     N3036A        EDINAV
N03  C                   MOVEL     N3042A        EDIAD1
N03  C                   MOVEL     N3251         EDIAD3
N03  C                   MOVEL     N3164         EDIAD3STD        25
N03  C                   MOVE      EDIAD3STD     EDIAD3
N03  C     NextNAD       Tag
N03  C     FBetKey       READE     ENAD93A                                33
N03  C                   END
N03  C     UtNAD         Tag
N03  c     EDINAV        Ifeq      *BLANKS
N03  C                   MOVE      '1'           *IN30
N03  C                   MOVE      'KUN0011'     MSGNR
N03  C                   END
N03  c                   move      *blanks       INTNAV
N03  c     INTKNR        IFEQ      *zeros
N03  c                   movel     EDINAV        TMPNAV5           5
N03  C     LO:UP         XLATE     TMPNAV5       TMPNAV5
N03  c                   movel     TMPNAV5       INTNAV
N03  c                   else
N03  C     INTKunKey     Chain     Cundl01                            33
N03  c  N33              movel     Knavn         INTNAV
N03  c                   end
N03  C*
N03  C     StrFBet       TAG
N03  c                   exfmt     ANNENW
N03  c                   Move      *OFF          *IN30
N03  c     *in12         CABEQ     '1'           UtFbet
N03   *
N03  c     INTKNR        IFEQ      *zeros
N03  c     INTNAV        ANDNE     *Blanks
N03  c     *in04         Oreq      '1'
N03  C                   MOVEL     INTNAV        UUSNAV
N03  C                   CALL      'SOEKKUN'
N03  C                   PARM                    INTKNR
N03  C                   PARM                    FIFIRM
N03  C                   PARM                    UUSNAV
N03  c                   move      *blanks       INTNAV
N03  C     INTKunKey     Chain     Cundl01                            33
N03  c  N33              movel     Knavn         INTNAV
N03  c                   goto      strFbet
N03  c                   end
N03   * Kunde mår være ok...
N03  C     INTKunKey     Chain     Cundl01                            30
N03  c     *in30         Ifeq      '1'
N03  C                   MOVE      'SPK0001'     MSGNR
N03  c                   move      *blanks       INTNAV
N03  c                   goto      strFbet
N03  c                   end
N03   * diversekunde ikke tillatt som Annen fraktbetaler
N03  c     DKUND         Ifeq      'D'
N03  c*    hverken som Mottaker eller anne er 1000 tillatt
N03  c*    MOTANN        ANDEQ     'A'
N03  C                   MOVE      'KUN0012'     MSGNR
N03  c                   move      '1'           *IN30
N03  c                   goto      strFbet
N03  c                   end
N03   * Om både kundes kundenr og INTKNR ok - oppdater X-ref
N03  c     EDIKNR        IFNE      *BLANKS
N03  C     INTKNR        ANDNE     *ZEROS
N03  c     DKUND         Andne     'D'
N03  c                   MOVE      HOKNS         KUKUN1
N03  c                   MOVEL     EDIKNR        KUINTN
N03  C     KUNKOKey      Chain     KUNKO2                             33
N03  C     *in33         IFEQ      '1'
N03  c                   MOVE      INTKNR        KUKUN2
N03  c                   MOVE      SONAVN        KUALFA
N03  c                   MOVE      *ZEROS        KUVADR
N03  C                   WRITE     KUNKOR
N03  C                   end
N03  C                   end
N03  c     MOTANN        IFEQ      'M'
N03  c                   move      INTKNR        WSKNK
N03  c                   end
N03  c     MOTANN        IFEQ      'A'
N03  c                   move      INTKNR        WSKNA
N03  c                   end
N03  c*
N03  C     UtFbet        ENDSR
      *
     C***********************************************
     C     DLTTK         BEGSR
     C***********************************************
     C                   SETON                                        99
     C                   EXFMT     VAREL3
     C  N12              DO
     C     LNRKEY        CHAIN     HENOS                              33
     C  N33              DELETE    HENOSR
     C* Slettemerk også Kolli-ID..
     C     LNRKEY        SETLL     HENOK
     C     LNRKEY        READE     HENOK                                  33
     C     *IN33         DOWEQ     '0'
     C                   MOVEL     '*D*'         HKID
     C                   UPDATE    HENOKR
     C     LNRKEY        READE     HENOK                                  33
     C                   END
     C                   CLEAR                   HENOSR
     C                   MOVE      '*DELETE'     XDLT
     C                   END
     C     XLIN          IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C     IFSCIN        IFEQ      'J'
     C     HSSTIN        COMP      ' '                                    59
     C                   END
     C     HOEDSN        IFNE      *ZEROS
     C                   EXSR      TSTTXT
     C                   END
     C     HSDS29        COMP      'E'                                    52
     C                   UPDATE    SUBFIL
      *
     C                   ENDSR
      *
N19  C***********************************************
N19  C     DIROPPD       BEGSR
N19  C***********************************************
N19  C                   SETON                                        99
N19  C                   MOVE      *BLANKS       AVD0TXT          50
N19  C     HSAVDH        IFEQ      *ZEROS
N19  C                   EVAL      AVD0TXT='Oppdrag må ha avdeling! '
N19  C                                    +'Endre/prise først!  F12..'
N19  C                   ENDIF
N19  C*
N19  C                   EXFMT     DIRBEKR
N19  C*
s20  C*    HSAVDH        COMP      *ZEROS                                 12
N20  C     HSAVDH        ifeq      *ZEROS
N20  C                   move      *on           *in12
N20  C                   endif
N19  C  N12              DO
N19   * overfør - men kun til utgående avd  (LagHO - ikke LagFF)
N19  c                   move      'J'           OptDirekte        1
N19  C     ULNR          CHAIN(N)  HENOP                              33
N19  C                   EXSR      LAGFEL                                        FELLES
N19  C                   EXSR      LAGHO                                         HO-OPPDRAG
N19   * slettemerk i hentingen
N19  C     LNRKEY        CHAIN     HENOS                              33
N19  C  N33              DELETE    HENOSR
      * selv om record fysisk deletes kan en likevel lage oppdrag basert på data fra den..
N19  C* Slettemerk også Kolli-ID..
N19  C     LNRKEY        SETLL     HENOK
N19  C     LNRKEY        READE     HENOK                                  33
N19  C     *IN33         DOWEQ     '0'
N19  C                   MOVEL     '*D*'         HKID
N19  C                   UPDATE    HENOKR
N19  C     LNRKEY        READE     HENOK                                  33
N19  C                   END
N19  C                   CLEAR                   HENOSR
N19  C                   MOVE      '*DELETE'     XDLT
N19  C                   END
N19   **
N19  C     XLIN          IFEQ      0
N19  C                   Z-ADD     15            LINNBR
N19  C                   ELSE
N19  C                   Z-ADD     XLIN          LINNBR
N19  C                   END
N19  C     IFSCIN        IFEQ      'J'
N19  C     HSSTIN        COMP      ' '                                    59
N19  C                   END
N19  C     HOEDSN        IFNE      *ZEROS
N19  C                   EXSR      TSTTXT
N19  C                   END
N19  C     HSDS29        COMP      'E'                                    52
N19  C                   UPDATE    SUBFIL
N19   *
N19  C                   ENDSR
     C***********************************************
     C     MOVWTK        BEGSR
     C***********************************************
     C   44              CLEAR                   HENOSR
     C                   MOVE      ULNR          HSLNR
     C                   MOVE      WSLNR2        HSLNR2
     C                   MOVE      WSSNDN        HSSNDN
      * I SUBFIL
     C     HSSND2        IFNE      *BLANKS
     C                   MOVE      HSSND2        HXSNDN10
     C                   ELSE
     C                   MOVE      HSSND1        HXSNDN10
     C                   END
     C                   MOVE      WSKNK         HSKNK
     C                   MOVE      WSNAK         HSNAK
     C                   MOVE      WSADK1        HSADK1
     C                   MOVE      WSPNRK        HSPNRK
     C                   MOVE      WSSTDK        HSSTDK
     C                   MOVE      WSRFA         HSRFA
     C     WSDT          IFEQ      *ZEROS
     C                   MOVE      *ZEROS        HSDT
     C                   ELSE
     C                   MOVE      WSDTD         HSDTD
     C                   MOVE      WSDTM         HSDTM
     C     WSDTÅ         IFGT      50
     C     WSDTÅ         ADD       1900          HSDTÅ
     C                   ELSE
     C     WSDTÅ         ADD       2000          HSDTÅ
     C                   END
     C                   END
     C                   MOVE      WSPNRT        HSPNRT
     C                   MOVE      WSAVD         HSAVDH
     C                   Z-ADD     WSANTP        HSANTP
     C                   Z-ADD     WSANT         HSANT
     C                   MOVE      WSVB          HSVB
     C                   Z-ADD     WSVKT         HSVKT
     C                   Z-ADD     WSM3          HSM3
     C                   Z-ADD     WSLM          HSLM
     C                   Z-ADD     HSVKT         HSFBV
     C     HSLM          IFNE      *ZEROS
     C     HSM3          ORNE      *ZEROS
     C     HSLM          MULT      KOVLKG        XFBV1             5 0
N03   **** FINN EVT AVVIKENDE M3FAKTOR   (egentlifd BHR-spesial)
N03  C                   MOVE      *ZEROS        KOVM3KUN          3 0
N03  C     HSM3          IFNE      *ZEROS
N03  C                   SELECT
N03  C     BETAL         WHENEQ    'A'
N03  C                   Z-ADD     WSKNA         UUKN              8 0
N03  C     BETAL         WHENEQ    'M'
N03  C                   Z-ADD     WSKNK         UUKN              8 0
N03  C                   OTHER
N03  C                   Z-ADD     HOKNS         UUKN              8 0
N03  C                   ENDSL
N03  C     KUNKAV        CHAIN     CUNDL01                            33
N03  C     *IN33         IFEQ      '0'
N03  C                   TESTN                   SYSTAT               33
N03  C     *IN33         IFEQ      '1'
N03  C                   MOVE      SYSTAT        XXM3IN            3 0
N03  C     XXM3IN        IFGE      100
N03  C                   Z-ADD     XXM3IN        KOVM3KUN          3 0
N03  C                   END
N03  C                   END
N03  C                   END
N03  C                   END
N03  C     KOVM3KUN      IFNE      *ZEROS
N03  C     HSM3          MULT      KOVM3KUN      XFBV2             5 0
N03  C                   ELSE
     C     HSM3          MULT      KOVKKG        XFBV2             5 0
N03  C                   END
     C     HSVKT         IFGE      XFBV1
     C                   Z-ADD     HSVKT         HSFBV
     C                   ELSE
     C                   Z-ADD     XFBV1         HSFBV
     C                   END
     C     HSFBV         IFLT      XFBV2
     C                   Z-ADD     XFBV2         HSFBV
     C                   END
     C                   END
     C                   MOVE      WSKODH        HSKODH
     C                   MOVE      WSBELH        HSBELH
     C                   MOVE      WSFR          HSFR
     C                   MOVE      WSKNA         HSKNA
     C                   MOVE      WSAGTR        HSAGTR
     C                   MOVE      WSBELA        HSBELA
     C                   MOVE      WSPROD        HSPROD
     C                   MOVE      WSVARM        HSVARM
     C                   MOVE      WSFARL        HSFARL
     C                   MOVE      WSUTKO        HSUTKO
     C                   MOVE      WSUTTX        HSUTTX
     C                   MOVE      WSEKBL        HSEKBL
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVTKW        BEGSR
     C***********************************************
     C                   SETON                                        99
     C                   MOVE      'N'           MELDTA            1
      *
     C                   MOVE      HSLNR2        WSLNR2
     C                   MOVE      HSSNDN        WSSNDN
     C                   MOVE      HSKNK         WSKNK
     C                   MOVE      HSNAK         WSNAK
     C                   MOVE      HSADK1        WSADK1
     C                   MOVE      HSPNRK        WSPNRK
     C                   MOVE      HSPNRK        WSTILP
     C                   MOVE      HSSTDK        WSSTDK
     C                   MOVE      HSRFA         WSRFA
     C                   MOVE      HSDTD         WSDTD
     C                   MOVE      HSDTM         WSDTM
     C                   MOVE      HSDTÅ         WSDTÅ
     C                   MOVE      HSPNRT        WSPNRT
     C                   MOVE      HSAVDH        WSAVD
     C                   Z-ADD     HSANTP        WSANTP
     C                   Z-ADD     HSANT         WSANT
     C                   MOVE      HSVB          WSVB
     C                   Z-ADD     HSVKT         WSVKT
     C                   Z-ADD     HSM3          WSM3
     C                   Z-ADD     HSVKT         GMVKT
     C                   Z-ADD     HSM3          GMM3
     C                   Z-ADD     HSLM          WSLM
     C                   MOVE      HSKODH        WSKODH
     C                   MOVE      HSBELH        WSBELH
     C                   MOVE      HSFR          WSFR
     C                   MOVE      HSKNA         WSKNA
     C                   MOVE      *BLANKS       WXANAV
     C     KUNKE2        CHAIN     CUNDL01                            33
     C  N33              MOVEL     KNAVN         WXANAV
     C                   MOVE      HSAGTR        WSAGTR
     C                   MOVE      *BLANKS       WXTNAV
     C     TRAKEY        CHAIN     TRAN                               33
     C  N33              MOVEL     VMNAVN        WXTNAV
     C                   MOVE      HSBELA        WSBELA
     C                   MOVE      HSPROD        WSPROD
     C                   MOVE      HSVARM        WSVARM
     C                   MOVE      HSFARL        WSFARL
     C                   MOVE      HSUTKO        WSUTKO
     C                   MOVE      *BLANKS       WXUTKT
     C     HSUTKO        CHAIN     KODTU                              33
     C  N33              MOVEL     KUTX          WXUTKT
     C                   MOVE      HSUTTX        WSUTTX
     C                   MOVE      HSEKBL        WSEKBL
      * manuell skytestatus...
     c     HSDSDM        comp      *BLANKS                            6060
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVB2         BEGSR
     C***********************************************
     C                   MOVE      '0'           *IN41                             HALV TEST
     C                   MOVE      'N'           MELDTA            1
      * NY - CURSOR VED SNDNR-
     C                   Z-ADD     17            LINNBR
     C                   Z-ADD     28            POSNBR
     C                   MOVE      *ZEROS        WSLNR2
     C                   MOVE      *BLANKS       WSSNDN
     C                   MOVE      *BLANKS       WSKNK
     C                   MOVE      *BLANKS       WSNAK
     C                   MOVE      *BLANKS       WSADK1
     C                   MOVE      *BLANKS       WSADK2
     C                   MOVE      *ZEROS        WSPNRK
     C                   MOVE      *ZEROS        WSTILP
     C                   MOVE      *BLANKS       WSSTDK
     C                   MOVE      *BLANKS       WSRFA
     C                   MOVE      *ZEROS        WSDT
     C                   MOVE      *ZEROS        WSPNRT
     C                   MOVE      *ZEROS        WSAVD
     C                   MOVE      *ZEROS        WSANTP
     C                   MOVE      *ZEROS        WSANT
     C                   MOVE      *BLANKS       WSVB
     C                   MOVE      *ZEROS        WSVKT
     C                   MOVE      *ZEROS        WSM3
     C                   MOVE      *ZEROS        GMVKT
     C                   MOVE      *ZEROS        GMM3
     C                   MOVE      *ZEROS        WSLM
     C                   MOVE      *BLANKS       WSKODH
     C                   MOVE      *ZEROS        WSBELH
     C                   MOVE      *BLANKS       WSFR
     C                   MOVE      *ZEROS        WSKNA
     C                   MOVE      *BLANKS       WXANAV
     C                   MOVE      *ZEROS        WSAGTR
     C                   MOVE      *ZEROS        WSBELA
     C                   MOVE      *BLANKS       WSPROD
     C                   MOVE      *BLANKS       WSVARM
     C                   MOVE      *BLANKS       WSFARL
     C                   MOVE      *BLANKS       WSUTKO
     C                   MOVE      *BLANKS       WXUTKT
     C                   MOVE      *BLANKS       WSUTTX
     C                   MOVE      *ZEROS        WSEKBL
     c                   clear                   HSDS
      *
     C                   ENDSR
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
      *
     C     *ENTRY        PLIST
     C                   PARM                    ULNR              7 0
     C                   PARM                    UAUTO             1
      *
     C                   MOVE      *BLANKS       WSADK2           30             INTERN-DEF
      * NUMERISK I DS-ER
     C                   MOVE      *ZEROS        HSBELH
     C                   MOVE      *ZEROS        HSBELM
     C                   MOVE      *ZEROS        HSBEL
     C                   MOVE      *ZEROS        HODT
     C                   MOVE      *ZEROS        HSDT
     C                   MOVE      *ZEROS        WSDT
     C                   MOVE      *ZEROS        HSPNRT
     C                   MOVE      *ZEROS        HSPNRK
      * KONSTANTER TIL DS-ER
     C                   MOVE      CVT1          DSVT1
     C                   MOVE      CVT2          DSVT2
      *
     C     *LIKE         DEFINE    HEAVD         AVDZER
     C                   MOVE      *ZEROS        HODT
     C     *LIKE         DEFINE    HSVKT         MAVKT
     C     *LIKE         DEFINE    HSFBV         MAFBV
     C     *LIKE         DEFINE    HSM3          MAM3
     C     *LIKE         DEFINE    HSLM          MALM
     C     *LIKE         DEFINE    HSBELA        MABELA
     C     *LIKE         DEFINE    HSBELH        MABELH
     C     *LIKE         DEFINE    HSBEL         MABEL
     C     *LIKE         DEFINE    HSLNR2        MALNR2
     C     *LIKE         DEFINE    HSLNR2        ORLNR2
     C                   MOVE      '1'           WSMANK
     C     *LIKE         DEFINE    HSVKT         GMVKT
     C     *LIKE         DEFINE    HSM3          GMM3
      *
     C     ULNR          CHAIN(N)  HENOP                              33
     C     HOEDSN        COMP      *ZEROS                             5555
     C                   MOVEL     HODTD         HODT4
     C                   MOVE      HODTM         HODT4
      *
     C     LNRKEY        KLIST
     C                   KFLD                    ULNR
     C                   KFLD                    WSLNR2
     C     HENOSK        KLIST
     C                   KFLD                    HSLNR
     C                   KFLD                    HSLNR2
      *
     C     MAXKEY        KLIST
     C                   KFLD                    ULNR
     C                   KFLD                    YYLNR2            3 0
     C                   MOVE      999           YYLNR2
      *
     C     KUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSKNK
     C     VADRKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSKNK
     C                   KFLD                    A1
     C                   Z-ADD     1             A1                5 0
      *
     C     KUNKE2        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSKNA
      *
N03  C     KUNKAV        KLIST
N03  C                   KFLD                    FIFIRM
N03  C                   KFLD                    UUKN
N03  C     KUNKEM        KLIST
N03  C                   KFLD                    FIFIRM
N03  C                   KFLD                    HOKNS
N03  c     INTKunKey     KLIST
N03  C                   KFLD                    FIFIRM
N03  C                   KFLD                    INTKNR
N03  c     FBetKey       KLIST
N03  C                   KFLD                    HOEDSN
N03  C                   KFLD                    NGN
N03  C                   KFLD                    NREP0
N03  c     KUNKOKey      KLIST
N03  C                   KFLD                    KUKUN1
N03  C                   KFLD                    KUINTN
     C     TRAKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSAGTR
s04  C*    TRAKEY2       KLIST
s04  C*                  KFLD                    FIFIRM
s04  C*                  KFLD                    TUKNT2
      *
     C     STEDKE        KLIST
     C                   KFLD                    FILAND
     C                   KFLD                    YYSTED            5
      *
     C     KODFRK        KLIST
     C                   KFLD                    KFRUNI
     C                   KFLD                    WSFR
     C                   MOVE      'FR'          KFRUNI
     C     KODTAK        KLIST
     C                   KFLD                    YYAUNI
     C                   KFLD                    YYAVD             4 0
     C                   MOVE      'A'           YYAUNI            1
     C     KODTVK        KLIST
     C                   KFLD                    YYVUNI
     C                   KFLD                    YYAVD             4 0
     C                   MOVE      'V'           YYVUNI            1
     C     KODRIK        KLIST
     C                   KFLD                    HOPNRT
     C                   KFLD                    WSPNRK
      * NØKKEL FOR AVTALEBYTE - SELGER SOM TILLATER KJØPER Å LÅNE AVT
     C     KAVTS         KLIST
     C                   KFLD                    HOKNS
     C                   KFLD                    XXSK
     C                   KFLD                    HEOT
     C                   KFLD                    HEFR
     C                   MOVE      'K'           XXSK              1
      *
     C     KUFASK        KLIST
     C                   KFLD                    YKFTYP
     C                   KFLD                    KFKOD
     C                   MOVEL     'PRODTYPE'    YKFTYP
     C     *LIKE         DEFINE    KFTYP         YKFTYP
     C                   MOVE      'N'           UUPDAT            1
      *
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
     C                   MOVE      *ZEROS        FIRAVD            4 0
     C     FIRAVD        CHAIN     FIRINL                             33
     C     ZUSER         CHAIN     USRDFT                             33
      * KODE FOR OM EN BENYTTER SKANNING INN TERMINAL (V.EDI)
      * FORELØPIG HARDKODET - MÅ INN I FIRINL
     C                   MOVE      'J'           IFSCIN            1
      * KUNDE FOR DUPFRAKT
     C                   MOVE      *ZEROS        DUPKNR            8 0
     C                   MOVE      HODAVD        YYAVD
     C     KODTAK        CHAIN     KODTA                              33
     C  N33              MOVE      KOAKNR        DUPKNR
      *
     C                   ENDSR
      *
      *
     C***********************************************
     C     GETLNR        BEGSR
     C***********************************************
      * Hent neste løpenr
     C                   MOVE      *ZEROS        HSLNR2
     C     MAXKEY        SETGT     HENOS
     C     ULNR          READPE(N) HENOS                                  33
     C     HSLNR2        ADD       1             WSLNR2
      *
     C                   ENDSR
      *
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
     C                   MOVE      WSDTD         UDT1              2 0
     C                   MOVE      WSDTM         UDT2              2 0
     C                   MOVE      WSDTÅ         UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          WSDTD
     C                   MOVE      UDT2          WSDTM
     C                   MOVE      UDT3          WSDTÅ
     C*
     C                   ENDSR
     C*
      *
     C***********************************************
     C     SAMTAX        BEGSR
     C***********************************************
     C                   MOVE      IFFNØK        WSNØKK
     C                   EXSR      FINSUM
      * PARAMETERE FOR FRAKT-BEREGNINGEN...
     C                   MOVE      HOPNRS        WSFPNR
     C                   MOVE      HOPNRT        WSTPNR
     C                   MOVE      HOSTIK        WSFRAK
     C                   Z-ADD     HOSTIN        WSBEL
     C                   MOVE      HOMIKK        WSMIKK
     C     WSMIKK        IFEQ      'A'
     C                   Z-ADD     HOMINK        WSMINK
     C                   ELSE
     C                   MOVE      *ZEROS        WSMINK
     C                   END
S16  C*                  MOVE      ' '           CTIKMI
     C     HOKNS         CHAIN     CUTRAN                             33
S16  C*    CTIKMI        IFEQ      ' '
S16  C*    KUNKEM        CHAIN     CUNDL01                            33
S16  C* N33DKUND         IFEQ      'D'
S16  C*                  MOVE      'X'           CTIKMI
S16  C*                  END
S16  C*                  END
      *  INNH.BELØP I % AV HOVEDFRAKT??
     C     IFIPRP        IFNE      *ZEROS
     C                   MOVE      *ON           *IN75
     C     SUMHFR        MULT      IFIPRP        XUMHFP            9 2
     C     XUMHFP        DIV(H)    100           SUMHFP
     C     WSFRAK        IFNE      'A'
     C     WSFRAK        ANDNE     'N'
     C                   MOVE      'P'           WSFRAK
     C                   Z-ADD     SUMHFP        WSBEL
     C                   END
     C                   END
     C                   MOVE      IFFRFF        WSFRAN
      * VIS SAMTAKSERINGSDATA I VINDU...
     C     SAMTAG        TAG
      **** BEREGN FRAKT
     C     WSFRAK        IFNE      'A'
     C     WSFRAK        ANDNE     'N'
     C     WSFRAK        ANDNE     'P'
     C                   MOVE      'S'           USKA              1
     C                   Z-ADD     DUPKNR        UUKN              8 0
     C                   MOVE      HODAVD        UAVD
     C                   MOVE      WSFRAN        XXFR
     C                   MOVE      WSPRO2        XXKDPL
     C                   MOVEL     WSFPNR        XXSDF
     C                   MOVEL     WSTPNR        XXSDT
     C                   Z-ADD     SUMM3         XXM3
     C                   Z-ADD     SUMLM         XXLM
     C                   Z-ADD     1             XXNT
     C                   Z-ADD     SUMVKT        XXVKT
     C                   Z-ADD     SUMFBV        XXFBV
     C                   MOVE      'N'           AGENT             1
     C                   EXSR      BERFRP
     C                   MOVE      'M'           WSFRAK
     C                   Z-ADD     UUBELØ        WSBEL
     C                   END
      * MINIMUM MOT KUNDE./ TIL TRANSPORTØR
S16   *
S16  C*    CTIKMI        IFNE      ' '
S16  C*                  MOVE      'N'           WSMIKK
S16  C*                  END
S16  C*    WSMIKK        IFEQ      'N'
S16  C*                  MOVE      *ZEROS        WSMINK
S16  C*                  END
S16  C*    WSMIKK        IFEQ      ' '
S16  C*                  MOVE      *ZEROS        WSMINK
S16  C*                  SELECT
S16   * VEKT MINDRE ENN LAVESTE GRP
S16  C*    SUMFBV        WHENLT    IFMG1
S16  C*    WSMIKK        IFEQ      ' '
S16  C*                  Z-ADD     IFMG1S        WSMINK
S16  C*                  END
S16   * VEKT MINDRE ENN  GRP2
S16  C*    SUMFBV        WHENLT    IFMG2
S16  C*    WSMIKK        IFEQ      ' '
S16  C*                  Z-ADD     IFMG2S        WSMINK
S16  C*                  END
S16   * VEKT MINDRE ENN  GRP 3
S16  C*    SUMFBV        WHENLT    IFMG3
S16  C*    WSMIKK        IFEQ      ' '
S16  C*                  Z-ADD     IFMG3S        WSMINK
S16  C*                  END
S16   * VEKT MINDRE ENN GRP 4
S16  C*    SUMFBV        WHENLT    IFMG4
S16  C*    WSMIKK        IFEQ      ' '
S16  C*                  Z-ADD     IFMG4S        WSMINK
S16  C*                  END
S16  C*                  ENDSL
N03  C     WSMIKK        IFEQ      ' '
N03  C     IFHBU         ANDNE     *ZEROS
N03  C     CTIKHU        ANDEQ     ' '
N03  C     CTAVHU        IFNE      *ZEROS
N03  C                   ADD       CTAVHU        WSMINK
N03  C                   ELSE
N03  C                   ADD       IFHBU         WSMINK
N03  C                   END
N03  C                   END
S16  C*                  END
      *
     c     UAuto         ifne      'J'
     C                   EXFMT     WINDOW
      *
     C   12              GOTO      UTSAMT
      *
      * VIS BILDE PÅ NY HVIS IKKE F10 / F12 ER BENYTTET
     C  N10              GOTO      SAMTAG
     c                   end
      *
      * SAMTAKSERING / FORDELING ETTER NØKKEL
     C     *IN10         IFEQ      '1'
     c     UAuto         oreq      'J'
      * VED UGYLDIG BEL (NEGATIV,MEN FORTEGN SYNS IKKE) BLANK/VIS PÅ NY
     C     WSBEL         IFLT      0
     c     UAuto         andne     'J'
     C                   MOVE      *ZEROS        WSBEL
     C                   GOTO      SAMTAG
     C                   END
     C     WSMINK        IFLT      0
     c     UAuto         andne     'J'
     C                   MOVE      *ZEROS        WSMINK
     C                   GOTO      SAMTAG
     C                   END
     C     WSNØKK        IFNE      '1'
     C     WSNØKK        ANDNE     '2'
     C     WSNØKK        ANDNE     '3'
     C     WSNØKK        ANDNE     '4'
     c     UAuto         Ifeq      'J'
     C                   move      '4'           WSNØKK
     C                   ELSE
     C                   GOTO      SAMTAG
     C                   END
     C                   END
     C     WSNØKK        IFEQ      '1'
     C     *IN71         ANDEQ     *ON
     c     UAuto         cabeq     'J'           UTSAMT
     C                   GOTO      SAMTAG
     C                   END
     C     WSNØKK        IFEQ      '2'
     C     *IN72         ANDEQ     *ON
     c     UAuto         cabeq     'J'           UTSAMT
     C                   GOTO      SAMTAG
     C                   END
     C     WSNØKK        IFEQ      '3'
     C     *IN73         ANDEQ     *ON
     c     UAuto         cabeq     'J'           UTSAMT
     C                   GOTO      SAMTAG
     C                   END
     C     WSNØKK        IFEQ      '4'
     C     *IN74         ANDEQ     *ON
     c     UAuto         cabeq     'J'           UTSAMT
     C                   GOTO      SAMTAG
     C                   END
     C     ULNR          CHAIN     HENOP                              33
     C                   MOVE      WSFRAK        HOSTIK
     C                   Z-ADD     WSBEL         HOSTIN
     C                   MOVE      WSMIKK        HOMIKK
     C                   MOVE      WSMINK        HOMINK
     C                   UPDATE    HENOPR
      *
     C                   MOVE      *ZEROS        SUMBEH            7 0
     C                   MOVE      *ZEROS        SUMBEM            7 0
     C                   MOVE      *ZEROS        SUMBEL            7 0
     C     ULNR          SETLL     HENOS
     C     ULNR          READE     HENOS                                  33
     C     *IN33         DOWEQ     '0'
     C                   SELECT
     C     WSNØKK        WHENEQ    '1'
     C     HSFBV         DIV(H)    SUMFBV        FAKTOR           15 9
     C     WSNØKK        WHENEQ    '2'
     C     HSM3          DIV(H)    SUMM3         FAKTOR           15 9
     C     WSNØKK        WHENEQ    '3'
     C     HSLM          DIV(H)    SUMLM         FAKTOR           15 9
     C     WSNØKK        WHENEQ    '4'
     C     HSBELH        DIV(H)    SUMHFR        FAKTOR           15 9
     C                   ENDSL
      *
     C     WSBEL         MULT(H)   FAKTOR        HSBEL
     C     WSMINK        MULT(H)   FAKTOR        HSBELM
     C                   UPDATE    HENOSR
     C                   ADD       HSBELH        SUMBEH
     C                   ADD       HSBELM        SUMBEM
     C                   ADD       HSBEL         SUMBEL
     C     ULNR          READE     HENOS                                  33
     C                   END
      * FERDIG - HVIS FORDELINGS-DIFF, LEGG PÅ SISTE.
     C     WSBEL         SUB       SUMBEL        DIFF              7 0
     C     WSMINK        SUB       SUMBEM        DIFFM             7 0
     C     DIFF          IFNE      *ZEROS
     C     DIFFM         ORNE      *ZEROS
     C     ULNR          SETGT     HENOS
     C     ULNR          READPE    HENOS                                  33
     C  N33              ADD       DIFF          HSBEL
     C  N33              ADD       DIFFM         HSBELM
     C  N33              UPDATE    HENOSR
     C                   END
      *
     C                   GOTO      UTSAMT
     C                   END
      *
      *
      *
     C     UTSAMT        ENDSR
      *
     C***********************************************
     C     FINSUM        BEGSR
     C***********************************************
      *
     C                   MOVEA     '00000'       *IN(71)
      * FINN SUM VEKT M.M.
     C                   MOVE      *ZEROS        SUMVKT            6 0
     C                   MOVE      *ZEROS        SUMFBV            6 0
     C                   MOVE      *ZEROS        SUMM3             5 3
     C                   MOVE      *ZEROS        SUMLM             4 2
     C                   MOVE      *ZEROS        SUMHFR            7 0
     C                   MOVE      *ZEROS        SUMHFP            7 0
     C     ULNR          SETLL     HENOS
     C     ULNR          READE(N)  HENOS                                  33
     C     *IN33         DOWEQ     '0'
N11  C*    HSST          IFNE      'O'
     C                   ADD       HSVKT         SUMVKT
     C                   ADD       HSFBV         SUMFBV
     C                   ADD       HSM3          SUMM3
     C                   ADD       HSLM          SUMLM
     C                   ADD       HSBELH        SUMHFR
     C  N71HSFBV         COMP      *ZEROS                                 71
     C  N72HSM3          COMP      *ZEROS                                 72
     C  N73HSLM          COMP      *ZEROS                                 73
     C  N74HSBELH        COMP      *ZEROS                                 74
N11  C*                  ENDIF
     C     ULNR          READE(N)  HENOS                                  33
     C                   END
      *
     C                   ENDSR
      *
     C******************************************
     C     BERFRP        BEGSR
     C******************************************
N03  C                   MOVE      *ZEROS        UAVNR
     C* POSTNUMMERBASERT KALKULASJON
     C                   MOVE      'H'           XXUR
     C                   MOVE      'NO'          XXLKA
     C                   MOVE      'NO'          XXTRI
     C                   MOVE      *BLANKS       XXLKS
     C                   MOVE      *BLANKS       XXSDFF
     C                   MOVE      *BLANKS       XXLKK
     C                   MOVE      *BLANKS       XXSDVT
     C                   MOVE      *BLANKS       XXVERV
     C                   MOVE      *ZEROS        XXVERB
     C                   MOVE      *ZEROS        N5                5 0
     C                   MOVE      *ZEROS        NOPD              7 0
      * Finn frakt i kundersfraktavtale
     C                   MOVE      'A'           XKDA              1
     C                   MOVE      *BLANKS       UUVAL             3
     C                   MOVE      'FRA'         UGEB              3
     C                   MOVE      'FRA'         UGEBKO            3
     C                   MOVE      *ZEROS        UUBELØ           13 2
     C                   MOVE      HXHEAD        UHEAD           256
N03  C     AGENT         IFEQ      'J'
N03  C     NOATAB        andne     *blanks
N03  C                   MOVE      *BLANKS       UUVAL
N03  C                   MOVE      *ZEROS        URABAT
N03  C                   CALL      'SYGE13'
N03  C                   PARM                    UGEBKO
N03  C                   PARM                    UAVD
N03  C                   PARM                    NOPD
N03  C                   PARM                    UUVAL
N03  C                   PARM                    UUBELØ
N03  C                   PARM                    NOATAB
N03  C                   PARM                    URABAT            5 2
N03  C                   PARM                    xxOMRL            5 0
N03  C                   PARM                    XXOMRM            5 0
N03  C                   PARM                    XXOMR1            5 0
N03  C                   PARM                    XXOMR2            5 0
N03  C                   PARM                    UUKN
N03  C                   PARM                    UHEAD           256
N09  C                   PARM                    atdum             1
N03  C     UUBELØ        cabne     *ZEROS        skip14
N03  C                   end
     C                   CALL      'SYGE14'
     C                   PARM                    UGEBKO
     C                   PARM                    UGEB
     C                   PARM                    UAVD              4 0
     C                   PARM                    NOPD
     C                   PARM                    UUKN
     C                   PARM                    UUVAL
     C                   PARM                    UUBELØ
     C                   PARM                    UAVNR             9 0
     C                   PARM                    UAVMSG           50
     C                   PARM                    USKA
     C                   PARM                    UHEAD
N03  C     Skip14        tag
      * VED AGENT-BEREGNING, IKKE SLÅ OPP I BRUTTO.
     C     UUBELØ        IFEQ      0
     C     AGENT         ANDNE     'J'
     C                   MOVE      'B'           XKDA              1
     C                   MOVE      *BLANKS       USONE
     C                   MOVE      *BLANKS       UUVAL
     C                   MOVE      *ZEROS        URABAT
     C                   MOVE      HXHEAD        UHEAD           256
     C                   CALL      'SYGE13'
     C                   PARM                    UGEB
     C                   PARM                    UAVD
     C                   PARM                    NOPD
     C                   PARM                    UUVAL
     C                   PARM                    UUBELØ
     C                   PARM                    USONE             5
     C                   PARM                    URABAT            5 2
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    UUKN
     C                   PARM                    UHEAD
n09  C                   PARM                    atdum             1
     C     UUBELØ        IFNE      *ZEROS
     C     URABAT        ANDNE     *ZEROS
     C                   MOVE      'A'           XKDA              1
     C                   END
     C                   END
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     LAGOPD        BEGSR
     C***********************************************
     C     ULNR          CHAIN(N)  HENOP                              33
     C     HOST          CABEQ     'O'           UTLAG
      * STATUS PÅ HEADER OPPDATERES KUN DERSOM ALLE ER FERDIGE
     C                   MOVE      'J'           ALLEOK            1
      *
      * FOR HVER LINJE, LAG DUP + HOVED, OPPDATER LINJE-FIL
     C     ULNR          SETLL     HENOS
     C     ULNR          READE     HENOS                                  33
     C     *IN33         DOWEQ     '0'
     C     HSST          IFNE      'O'
     C     HSNAK         IFEQ      *BLANKS
     C     HSVB          OREQ      *BLANKS
     C     HSRFA         OREQ      *BLANKS
     C                   MOVE      'N'           ALLEOK
     C                   ELSE
      * VED EDI-MOTATT HENTE-OPPDRAG MÅ DET VÆRE SKUTT/manu.kvittert
     C     *IN55         IFEQ      '1'
     C     HSSTIN        IFEQ      ' '
     C                   MOVE      'N'           ALLEOK
     C                   GOTO      UTOK
     C                   END
     C                   END
     C                   EXSR      LAGFEL                                        FELLES
     C                   EXSR      LAGHO                                         HO-OPPDRAG
     C                   EXSR      LAGFF                                         FF-OPPDRAG
     C                   MOVE      'O'           HSST
     C                   MOVE      HEAVDH        HSAVDH
     C                   MOVE      HEOPDH        HSOPDH
     C                   MOVE      HEAVDD        HSAVDD
     C                   MOVE      HEOPDD        HSOPDD
     C     UTOK          TAG
     C                   END
     C                   END
     C                   UPDATE    HENOSR
     C     ULNR          READE     HENOS                                  33
     C                   END
      *
      * OPPDATER HEADER-FIL
     C     ULNR          CHAIN     HENOP                              33
     C     ALLEOK        IFEQ      'J'
     C                   MOVE      'O'           HOST
     C                   EXSR      PALLER
     C                   ELSE
      * Ledig felt HOMOPD lånes for å indikere deloppgradert
     C                   MOVE      9999999       HOMOPD                          *"LÅNER"
     C                   END
     C                   UPDATE    HENOPR
      *
      *
      * OPPDATER TUR-RECORD
     C     HOPRO         CHAIN     TURER14                            33
     C     *IN33         IFEQ      '0'
     C                   MOVE      *ZEROS        TUAO
     C                   MOVE      *ZEROS        TUTS
     C                   MOVE      *ZEROS        TUTVKT
     C                   MOVE      *ZEROS        TUTLM
     C                   MOVE      *ZEROS        TUTM3
     C     HOPRO         SETLL     HEAD11
     C     HOPRO         READE     HEAD11                                 33
     C     *IN33         DOWEQ     *ZEROS
     C                   ADD       1             TUAO
     C                   ADD       HENT          TUTS
     C                   ADD       HEVKT         TUTVKT
     C                   ADD       HELM          TUTLM
     C                   ADD       HEM3          TUTM3
     C     TUDT          IFEQ      *ZEROS
     C                   MOVE      TRSDFD        TUDT
     C                   END
     C     TUDTT         IFEQ      *ZEROS
     C                   MOVE      TRSDTD        TUDTT
     C                   END
     C     HOPRO         READE     HEAD11                                 33
     C                   END
     C                   UPDATE    TURERR
     C                   END
      *
     C*                    ENDSR
     C     UTLAG         ENDSR
      *
     C*
     C***********************************************
     C     LAGFEL        BEGSR
     C***********************************************
      *
      * INFO FELLES FOR BÅDE HOVDEOPPDRAG / INNHENTINGS-DUP
     C                   CLEAR                   HEADFR
     C                   MOVE      'H'           HEUR
     C                   MOVEL     'S'           TRKDAK
     C                   MOVEL     'NO'          HELKA
     C                   MOVEL     HOPNRS        HESDF
     C                   MOVE      HODT          HEDTOP
     C                   MOVE      HODT          HEDTR
     C                   MOVE      HODT          TRSDFD
      *
     C                   MOVE      HOKNS         TRKNFA                         KNR OPD.GIV
     C                   MOVEL     HONAS         HENAA                          NAVN OPD.GIV
     C                   MOVE      HOKNS         HEKNS
     C                   MOVEL     HONAS         HENAS
     C                   MOVEL     HOADS1        HEADS1
     C                   MOVEL     HOPNRS        HEADS3
     C                   MOVE      HOSTDS        HEADS3
     C                   MOVEL     'NOK'         TRFRAV
     C                   MOVE      UDSSG         HESG
     C                   MOVEL     HSVB          HEVS1
     C                   MOVEL     HSRFA         HERFA
     C                   MOVE      HSKNK         HEKNK
     C                   MOVEL     HSNAK         HENAK
     C                   MOVEL     HSADK1        HEADK1
     C                   MOVEL     HSPNRK        HEADK3
     C                   MOVE      HSSTDK        HEADK3
     C                   Z-ADD     HSVKT         HEVKT
     C                   Z-ADD     HSFBV         HEFBV
     C                   Z-ADD     HSANT         HENT
     C                   Z-ADD     HSM3          HEM3
     C                   Z-ADD     HSLM          HELM
      * Edi-kode... (K=Kundeløsning, I=InternEDI, E=Ekstern EDI)
     C     HOEDSN        IFNE      *ZEROS
     C                   MOVE      'K'           HXEDIK
     C                   END
      * Skytestaus inn terminal - dersom via CS har det prio
     C                   MOVE      HSSTIN        HXTERI
     C     HSSTIN        IFNE      *blanks
     C     HSDSCS        Andne     *blanks
     C                   MOVE      HSDSCS        HXTERI
     C                   end
      *
     C                   ENDSR
      *
     C*
     C***********************************************
     C     LAGHO         BEGSR
     C***********************************************
      *
      * HOVEDOPPDRAGET...
     C*
     C                   MOVEL     HSSNDN        HXSNDN
     C                   MOVE      HSANTP        HXPALL
     C     HEVKT         IFLE      IFOTVG
     C                   MOVEL     IFOTHO        HEOT
     C                   ELSE
     C                   MOVEL     IFO2HO        HEOT
     C                   END
     C                   MOVE      HSFR          HEFR
     C                   MOVE      HSPROD        HEKDPL
     C                   MOVEL     HSVARM        TRFA11
     C                   MOVEL     HSFARL        TRFA21
     C     HSUTKO        IFNE      *BLANKS
     C                   MOVE      HSUTKO        HEKF
     C     HSUTKO        CHAIN     KODTU                              33
     C  N33              MOVEL     KUTX          HEFT1A
     C                   END
     C     HSEKBL        IFNE      *ZEROS
     C                   MOVEL     'Kr'          XXEK9             9
     C                   MOVE      HSEKBL        XXEK9
     C                   MOVE      XXEK9         HEFT1A
     C                   END
     C                   MOVEL     HSUTTX        HEFT1B
     C                   MOVE      'J'           TRMVA
     C                   MOVEL     'M'           TRFRAK
      * HVEM BETALER...
     C                   MOVEL     HSFR          WSFR
     C     KODFRK        CHAIN     KODTFR                             79
     C                   SELECT
     C     KFRCP         WHENEQ    'PP'
     C     KFRCP         OREQ      'S '
     C                   MOVE      HOKNS         XXFAMO            8 0
     C                   MOVE      'S'           XXFASK            1
     C                   MOVE      HOKNS         HEKNSF
     C                   MOVEL     'X'           HEKDFK
     C                   MOVEL     'S'           TRKDFF
     C     KFRCP         WHENEQ    'CC'
     C     KFRCP         OREQ      'M '
     C                   MOVE      HSKNK         XXFAMO
     C                   MOVE      'K'           XXFASK
     C                   MOVE      HSKNK         HEKNKF
     C                   MOVEL     'X'           HEKDFS
     C                   MOVEL     'K'           TRKDFF
     C                   OTHER
     C                   MOVE      HSKNA         XXFAMO
     C                   MOVE      'S'           XXFASK
     C                   MOVE      HSKNA         HEKNSF
     C                   MOVEL     'X'           HEKDFK
     C                   MOVEL     'S'           TRKDFF
     C                   ENDSL
     C                   MOVE      XXFAMO        WSKNK
     C     KUNKEY        CHAIN     CUNDL01                            33
N12  C  N33SYLAND        ifne      '  '
N12  C     SYLAND        ANDNE     'NO'
N12  C                   MOVE      'N'           TRMVA
N12  C                   END
     C     TRKDFF        IFEQ      'S'
     C                   MOVEL     KNAVN         HENASF
     C                   ELSE
     C                   MOVEL     KNAVN         HENAKF
     C                   END
N03  C                   EXSR      GETFRT
      * Innhenting! Indiker at VIA på fraside (DUP) ER utført
N19  C                   IF        OptDirekte <> 'J'
     C                   MOVE      'O'           TRSTAF
     C                   MOVEL     'NO'          HELKS
     C                   MOVEL     HOPNRT        HESDFF
     C                   MOVE      HODT          TRSFFD
N19  C                   ENDIF
     C                   MOVEL     'NO'          HETRI
     C                   MOVEL     HSPNRK        HESDT
     C     HSDT          IFNE      *ZEROS
     C                   MOVE      HSDT          TRSDTD
     C                   ELSE
     C                   MOVE      HODT          TRSDTD
     C                   END
      * Hovedfrakt-beløp
     C                   MOVE      HSKODH        TRFRAK
     C                   Z-ADD     HSBELH        TRFRAB
S12  C**                 MOVE      'J'           TRMVA
     C*
     C                   Z-ADD     HSAVDH        HEAVDH            4 0
     C     HEAVDH        CHAIN     TELL                               33
     C   33AVDZER        CHAIN     TELL                               33
     C                   MOVE      TEOPDN        HEOPDH            7 0
     C                   ADD       1             TEOPDN
     C                   UPDATE    TELLR
      * Hoved-oppd må referere til Duppens avd/opd (nedadgående ref)
N19  C                   IF        OptDirekte <> 'J'
     C                   Z-ADD     HODAVD        HEAVDD            4 0
     C     HEAVDD        CHAIN     TELL                               33
     C   33AVDZER        CHAIN     TELL                               33
     C                   MOVE      TEOPDN        HEOPDD            7 0
     C                   ADD       1             TEOPDN
     C                   UPDATE    TELLR
N19  C                   ENDIF
     C                   MOVE      HEAVDH        HEAVD
     C                   MOVE      HEOPDH        HEOPD
     C                   MOVEL     'HO'          TRSLAG
     C                   MOVE      *ZEROS        TRAVD0
     C                   MOVE      *ZEROS        TROPD0
N19  C                   IF        OptDirekte <> 'J'
     C                   MOVE      HEAVDD        TRAVD1
     C                   MOVE      HEOPDD        TROPD1
N19  C                   else
N19  C                   MOVE      *ZEROS        TRAVD1
N19  C                   MOVE      *ZEROS        TROPD1
N19  C                   ENDIF
     C                   MOVE      *ZEROS        TRAVD2
     C                   MOVE      *ZEROS        TROPD2
      * Utkjøring?? VIA på TIL-sted - HVIS AGENT ER FYLT UT, LAG REKV.
     C     HSPNRT        IFNE      *ZEROS
     C     HSPNRT        ANDNE     9999
     C                   MOVEL     'NO'          HELKK
     C                   MOVEL     HSPNRT        HESDVT
     C                   MOVE      TRSDTD        TRSVTD
     C                   MOVE      'A'           TRSTAE
     C     HSAGTR        IFNE      *ZEROS
     C                   MOVE      HSAGTR        WSAGTR
     C     TRAKEY        CHAIN     TRAN                               33
     C     *IN33         IFEQ      '0'
     C                   EXSR      REKVIS
     C                   END
     C                   END
     C                   END
      * Foreløpig ?? (indikere at fraktbrev skal skrives)
     C     HOEDSN        IFNE      *ZEROS
     C                   MOVE      'J'           HEPK1
     C                   END
N03   * oljetillegg??
N03  C                   EXSR      GETFRT
     C                   WRITE     HEADFR
      * Faktura-post
     C     TRFRAK        IFNE      'N'
     C                   CLEAR                   FAKTR
     C                   MOVE      *ZEROS        FALI
     C                   MOVE      HEAVD         FAAVD
     C                   MOVE      HEOPD         FAOPD
     C                   Z-ADD     TRFRAB        FABELV
     C                   Z-ADD     TRFRAB        FABELN
     C                   MOVE      'FRA'         FAVK
     C                   MOVE      FICURR        FAVAL
     C                   MOVE      TRMVA         FAKDM
     C                   MOVE      'M'           FAKDA
     C                   MOVE      XXFAMO        FAKUNR
     C                   MOVE      XXFASK        FASK
     C                   WRITE     FAKTR
N03  C     HEVALT        IFNE      *BLANKS
N03  C     HEVALP        ANDNE     *ZEROS
N03  C                   Z-ADD     1             FALI
N03  C                   MOVE      HEVALT        FAVK
N03  C                   MULT(H)   HEVALP        FABELN
N03  C                   ADD       0.50          FABELN
N03  C                   MOVE      00            FABELN
N03  C                   MULT(H)   HEVALP        FABELV
N03  C                   WRITE     FAKTR
N03  C                   END
     C                   END
N03  C                   MOVE      *BLANKS       HEVALT
N03  C                   MOVE      *ZEROS        HEVALP
      * Stedsnavn i egen fil
     C                   MOVE      *BLANKS       XHSONF            5
     C                   MOVE      *BLANKS       XHSONT            5
     C                   MOVE      *BLANKS       XDSONF            5             (D=DUP=FF)
     C                   MOVE      *BLANKS       XDSONT            5             (D=DUP=FF)
     C                   CLEAR                   HESTEDR
     C                   MOVE      HEAVD         HSAVD
     C                   MOVE      HEOPD         HSOPD
     C                   MOVE      HESDF         YYSTED
     C     STEDKE        CHAIN     STED2D                             35
     C  N35              MOVEL     ST2NVN        HSFROM
     C  N35              MOVEL     ST2LK         XDSONF
     C  N35              MOVE      ST2SOL        XDSONF
     C   35              MOVEL     FILAND        XDSONF
N19  C                   IF        OptDirekte <> 'J'
     C                   MOVE      HESDFF        YYSTED
     C     STEDKE        CHAIN     STED2D                             35
     C  N35              MOVEL     ST2NVN        HSVIA1
     C  N35              MOVEL     ST2LK         XDSONT
     C  N35              MOVE      ST2SOL        XDSONT
     C  N35              MOVEL     ST2LK         XHSONF
     C  N35              MOVE      ST2SOL        XHSONF
     C   35              MOVEL     FILAND        XDSONT
     C   35              MOVEL     FILAND        XHSONF
N19  C                   ENDIF
     C                   MOVE      HESDT         YYSTED
     C     STEDKE        CHAIN     STED2D                             35
     C  N35              MOVEL     ST2NVN        HSTO
     C  N35              MOVEL     ST2LK         XHSONT
     C  N35              MOVE      ST2SOL        XHSONT
     C   35              MOVEL     FILAND        XHSONT
     C     HESDVT        IFNE      *BLANKS
     C                   MOVE      HESDVT        YYSTED
     C     STEDKE        CHAIN     STED2D                             35
     C  N35              MOVEL     ST2NVN        HSVIA2
     C  N35              MOVEL     ST2LK         XHSONT
     C  N35              MOVE      ST2SOL        XHSONT
     C   35              MOVEL     FILAND        XHSONT
     C                   END
     C                   WRITE     HESTEDR
      *
      *
     C                   CLEAR                   DISPR
     C                   MOVE      HEOPD         DIOPD
     C                   MOVE      HEAVD         DIAVD
     C                   MOVE      HEOT          DIOT
     C                   MOVE      HESG          DISIGN
N19  C                   IF        OptDirekte <> 'J'
     C                   MOVE      HESDFF        DISTEF
     C                   MOVE      TRSFFD        DIDATF
     C                   MOVE      TRSFFK        DITIMF
N19  C                   ELSE
N19  C                   MOVE      HESDF         DISTEF
N19  C                   MOVE      TRSDFD        DIDATF
N19  C                   MOVE      TRSDFK        DITIMF
N19  C                   ENDIF
     C                   MOVE      HESDT         DISTET
     C                   MOVE      TRSDTD        DIDATT
     C                   MOVE      TRSDTK        DITIMT
     C                   MOVE      XHSONF        DISONF
     C                   MOVE      XHSONT        DISONT
     C                   MOVE      ' '           DISTA1
      *
     C                   WRITE     DISPR
      *
N06  C                   MOVE      *ZEROS        FRTLI
     C     HOEDSN        IFNE      *ZEROS
     C                   EXSR      FTX15
     C                   END
N06   * FRITEKST FRA HENOF
N06  C                   EXSR      HENOFSR
      * OPPDATER EVT. KOLLI-IDENTER
      * Sytr34C - plukker fra HENOK (EDI-mottatt)
     C                   Z-ADD     1             FBNR              3 0
     C                   CALL      'SYTR34C'
     C                   PARM                    HSLNR
     C                   PARM                    HSLNR2
     C                   PARM                    HEAVDH
     C                   PARM                    HEOPDH
     C                   PARM                    FBNR
N05  C                   PARM                    KOTERM
      * UTGÅR
      * Sytr34D - fra WSNRCLI (eksterne mappet via PDA /Nyutskrevne)
     C*                  CALL      'SYTR34D'
     C*                  PARM                    HSSN17
     C*                  PARM                    HEAVDH
     C*                  PARM                    HEOPDH
     C*                  PARM                    FBNR
     C*                  PARM                    TRKDFF
     C*                  PARM                    XXXKLI            3 0
N03  C*    XXXKLI        IFEQ      -1
N03  C*                  MOVE      'E'           HSDS29
N03  C*                  END
bhr   * Enkolli Cargoscan ?(Enten kolli i henok eller i wsnrcli )
N19  C                   IF        OptDirekte <> 'J'
bhr  C*                  MOVE      'X'           WOK               1
bhr  C*                  Z-ADD     0             WTUR              8 0
bhr  C*    HSDS29        IFEQ      'E'
bhr  C*                  MOVE      HEAVDH        UUAVDH            4 0
bhr  C*                  MOVE      HEOPDH        UUOPDH            7 0
bhr  C*                  CALL      'CSSORTH'
bhr  C*                  PARM                    UUAVDH
bhr  C*                  PARM                    UUOPDH
bhr  C*                  PARM                    WTUR              8 0
bhr  C*                  PARM                    WOK
bhr  C*                  ENDIF
N19  C                   ENDIF
      *
     C     FIURBL        IFEQ      'J'
     c                   MOVE      'J'           HOVOPD            1
     C                   EXSR      TTSR
     C                   END
      * øvrige spesiajonelle gebyrer??
     c     HEOT          ifne      *blanks
     c     HEFR          andne     *blanks
     C                   MOVE      'NY'          XNYGML            2
     C                   MOVE      ' '           XO2UTL            1
     C                   MOVE      ' '           XO2MVK            1
     C                   MOVE      ' '           XO2MVS            1
     C                   MOVE      ' '           XOVAVR            1
     C                   MOVE      *ZEROS        XKUTL             4 2
     C                   MOVE      *ZEROS        XSUTL             4 2
     C                   MOVE      *ZEROS        XKUMIN            2 0
     C                   MOVE      *ZEROS        XSUMIN            2 0
     C                   MOVE      *ZEROS        UKFRA             7 0
     C                   MOVE      3             XFLAGG            1 0
      *
     C                   MOVEL     FIFIRM        QDA01
     C                   MOVEL     HEAVD         QDA02
     C                   MOVEL     HEOPD         QDA03
     C                   MOVEL     XNYGML        QDA04
     C                   MOVEL     XO2UTL        QDA05
     C                   MOVEL     XKUTL         QDA06
     C                   MOVEL     XSUTL         QDA07
     C                   MOVEL     XKUMIN        QDA08
     C                   MOVEL     XSUMIN        QDA09
     C                   MOVEL     XO2MVK        QDA10
     C                   MOVEL     XO2MVS        QDA11
     C                   MOVEL     UKFRA         QDA12
     C                   MOVEL     XOVAVR        QDA13
     C                   MOVEL     *BLANKS       QDA14
     C                   MOVEL     *BLANKS       QDA15
     C                   MOVEL     XFLAGG        QDA16
     C                   MOVEL     *BLANKS       QDA17
     C                   MOVEL     *BLANKS       QDA18
     C                   MOVEL     'SYFI10XQ'    QDTAQ            10
     C                   MOVEL     '*LIBL'       QLIB             10
     C                   Z-ADD     109           QRLEN             5 0
     C                   CALL      'QSNDDTAQ'
     C                   PARM                    QDTAQ
     C                   PARM                    QLIB
     C                   PARM                    QRLEN
     C                   PARM                    QDATA
     C                   END
      *
N05   * om minst ett kolli via CS - få logget T&T mm..
N05  c     KOTERM        ifne      *blanks
N19  c     OptDirekte    ANDNE     'J'
N05  C                   call      'CARGOSCR4'
N05  C                   PARM                    HEAVDH
N05  C                   PARM                    HEOPDH
N05  C                   PARM                    KOTERM           20
N05  c                   endif
     C                   ENDSR
      *
     C*
     C***********************************************
     C     LAGFF         BEGSR
     C***********************************************
      * INNHENTINGS DUP-OPPDRAGET, ENDRE VISSE DATA
     C                   MOVE      ' '           TRSTAE
     C                   MOVE      *ZEROS        HEKNA                           AGENT
     c                   Move      ' '           TRTSTA
      * VIA-data fra hovedoppdraget blankes - Tilsted=terminal
     C                   MOVEL     HOSNDN        HXSNDN
     C                   MOVE      *ZEROS        HXPALL
     C     HEVKT         IFLE      IFOTVG
     C                   MOVEL     IFOTFF        HEOT
     C                   ELSE
     C                   MOVEL     IFO2FF        HEOT
     C                   END
     C                   MOVE      IFFRFF        HEFR
     C                   MOVE      *ZEROS        HEKNKF
     C                   MOVEL     'X'           HEKDFK
     C                   MOVEL     ' '           HEKDFS
     C                   MOVEL     'S'           TRKDFF
     C                   MOVE      DUPKNR        HEKNSF
     C                   MOVE      DUPKNR        WSKNK
     C     KUNKEY        CHAIN     CUNDL01                            33
     C  N33              MOVE      KNAVN         HENASF
     C                   MOVE      *ZEROS        WSKNK
      *
     C                   MOVE      *BLANKS       TRSTAF
     C                   MOVE      *BLANKS       HELKS
     C                   MOVE      *BLANKS       HESDFF
     C                   MOVE      *ZEROS        TRSFFD
     C                   MOVEL     'NO'          HETRI
     C                   MOVEL     HOPNRT        HESDT
     C                   MOVE      HODT          TRSDTD
     C                   MOVEL     'A'           TRFRAK
     C                   Z-ADD     HSBEL         TRFRAB
     C                   MOVE      'N'           TRMVA
     C                   MOVE      HEAVDD        HEAVD
     C                   MOVE      HEOPDD        HEOPD
     C                   MOVEL     'FF'          TRSLAG
     C                   MOVE      HEAVDH        TRAVD0
     C                   MOVE      HEOPDH        TROPD0
     C                   MOVE      *ZEROS        TRAVD1
     C                   MOVE      *ZEROS        TROPD1
     C                   MOVE      *ZEROS        TRAVD2
     C                   MOVE      *ZEROS        TROPD2
      *
     C     HOPRO         CHAIN(N)  TURER14                            33
     C                   MOVE      TUPRO         HEPRO
     C                   MOVEL     TUBILN        HEHAWB
s04  C*    TRAKEY2       CHAIN     TRAN                               34
s04  c* N34              move      VMTRKU        HEKNT
N04  c                   move      TUKNT2        HEKNT
     C                   MOVE      TURUND        TRRUND
     C                   MOVE      TUTRMA        HETRM
     C     TUCON1        IFNE      *BLANKS                                       2<-B
     C                   MOVE      1             HETRC
     C                   MOVEL     TUCON1        HETRCN
     C                   END                                                     2<-E
     C                   MOVE      ' '           HEPK1
     C                   WRITE     HEADFR
      * Faktura-post
     C                   CLEAR                   FAKTR
     C                   MOVE      *ZEROS        FALI
     C                   MOVE      HEAVD         FAAVD
     C                   MOVE      HEOPD         FAOPD
     C                   Z-ADD     TRFRAB        FABELV
     C                   Z-ADD     TRFRAB        FABELN
     C                   MOVE      'FRA'         FAVK
     C                   MOVE      FICURR        FAVAL
     C                   MOVE      TRMVA         FAKDM
     C                   MOVE      'M'           FAKDA
     C                   Z-ADD     TRAVD0        FAAVDR                          *DUP AV..
     C                   MOVE      HEKNSF        FAKUNR
     C                   MOVE      'I'           FASK
     C                   WRITE     FAKTR
      *
      * OGSÅ MINIMUM MOT KUNDE (PART X)
     C     HSBELM        IFNE      *ZEROS
     C                   CLEAR                   FAKTR
     C                   Z-ADD     1             FALI
     C                   MOVE      HEAVD         FAAVD
     C                   MOVE      HEOPD         FAOPD
     C                   Z-ADD     HSBELM        FABELV
     C                   Z-ADD     HSBELM        FABELN
     C                   MOVE      'FRA'         FAVK
     C                   MOVE      FICURR        FAVAL
     C                   MOVE      'J'           FAKDM
     C                   MOVE      'M'           FAKDA
     C                   MOVE      *ZEROS        FAAVDR
     C                   MOVE      HEKNS         FAKUNR
     C                   MOVE      'X'           FASK
     C                   WRITE     FAKTR
     C                   END
      * Stedsnavn i egen fil
     C                   CLEAR                   HESTEDR
     C                   MOVE      HEAVD         HSAVD
     C                   MOVE      HEOPD         HSOPD
     C                   MOVEL     HSVIA1        HSTO
     C                   MOVE      *BLANKS       HSVIA1
     C                   WRITE     HESTEDR
      *
     C                   CLEAR                   DISPR
     C                   MOVE      HEOPD         DIOPD
     C                   MOVE      HEAVD         DIAVD
     C                   MOVE      TUAVD         DITUAV
     C                   MOVE      HEPRO         DITUR
     C                   MOVE      TRRUND        DIRUND
     C                   MOVE      HEOT          DIOT
     C                   MOVE      HESG          DISIGN
     C                   MOVE      HESDF         DISTEF
     C                   MOVE      TRSDFD        DIDATF
     C                   MOVE      TRSDFK        DITIMF
     C                   MOVE      HESDT         DISTET
     C                   MOVE      TRSDTD        DIDATT
     C                   MOVE      TRSDTK        DITIMT
     C                   MOVE      XDSONF        DISONF
     C                   MOVE      XDSONT        DISONT
     C                   MOVE      ' '           DISTA1
      *
     C                   WRITE     DISPR
      *
     C     FIURBL        IFEQ      'J'
     c                   MOVE      'N'           HOVOPD            1
     C                   EXSR      TTSR
     C                   END
      *
     C                   ENDSR
      *
      *
     C*
     C***********************************************
     C     REKVIS        BEGSR
     C***********************************************
     C                   MOVE      'F'           TRSTAE
     C                   MOVE      VMTRKU        HEKNA                           AGENT
     c                   Move      'J'           TRTSTA
     c     HSDSCS        ifeq      'J'                                           CS-justert
     c                   Move      'R'           TRTSTA                          Reklakuler
     c                   end
      * TILDEL REKV.NR
     C     'Å'           CHAIN     KOSTT                              34
     C   34              MOVE      'Å'           KTTYP
     C   34              Z-ADD     1000000       KTNR
     C   34              WRITE     KOSTTR
     C  N34              ADD       1             KTNR
     C  N34              UPDATE    KOSTTR
     C* LEGG UT REKVISISJON
     C                   CLEAR                   KOSBUR
     C                   MOVE      KTNR          BUBNR
     C                   MOVEL     HEDTÅ         BUPCC
     C                   MOVE      HEDTÅ         BUPÅR
     C                   MOVE      HEDTM         BUPMN
     C                   MOVEL     'XX'          BUBILN
     C                   MOVE      HSAGTR        BUTNR
     C                   MOVE      VMTRLE        BULNR
     C                   Z-ADD     HSBELA        BUBL
     C                   MOVE      'A'           BUTYPE
     C                   MOVE      DSVFTX        BUTXT
     C                   MOVE      FICURR        BUVAL
     C                   MOVE      'FRA'         BUVK
     C                   MOVE      UDSSG         BUSG
     C                   MOVE      HEAVD         BUOAVD
     C                   MOVE      HEOPD         BUOPD
     C                   MOVE      'T'           BUBLST
     C                   MOVE      HEDTOP        BUFEDT
     C                   MOVE      'O'           BUFER                          *AUTOM. FRA TUR/FERG
     C                   WRITE     KOSBUR
      *
      * OPPDATER LINK MELLOM OPPDRAG OG REKVISISJON...
     C                   CLEAR                   HETRIUR
     C                   MOVE      HEAVD         TIAVD
     C                   MOVE      HEOPD         TIOPD
     C                   MOVE      'VF'          TISLAG
     C                   MOVE      KTNR          TIBURF
     C                   WRITE     HETRIUR
      *
     C                   ENDSR
      *
     C***********************************************
     C     TTSR          BEGSR
     C***********************************************
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
      *
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
      * EDI-FIL klargjort hos avsender (hentet fra EUNB)
     C     HOEDSN        IFNE      *ZEROS
     C     HOEDSN        CHAIN     EDIM                               33
     C     MSN           CHAIN     EUNB                               33
     C   33              MOVE      *ZEROS        U0017
     C   33              MOVE      *ZEROS        U0019
     C   33              MOVE      *ZEROS        TTDATE
     C                   MOVE      'ED1'         TTACTI
     C                   MOVEL     U0017         TSTÅR             2
     C  N33TSTÅR         IFGT      '43'
     C                   MOVEL     '19'          TTDATE
     C                   ELSE
     C                   MOVEL     '20'          TTDATE
     C                   END
     C                   MOVE      U0017         TTDATE
     C                   MOVEL     U0019         TTTIME
     C                   MOVE      '00'          TTTIME
     C                   MOVE      ULDT          TTDATL
     C                   MOVE      XULTM         TTTIML
     C                   MOVEL     U0004         TTUSER
s21  C*                  MOVEL     TTXED1        TTTEXT
s21  C*                  MOVEL     TTXED1L       TTTEXL
n21  C                   eval      TTTEXT  =  TTXED1
n21  C                   eval      TTTEXL  =  TTXED1L
N13  C                   MOVE      'S'           TTMANU
     C                   WRITE     TRACKFR
      * EDI-fil mottatt og logget i SYSPED/SYEDI (hentet fra EDIS)
     C     MSN           CHAIN     EDIS                               33
     C                   MOVE      'ED2'         TTACTI
     C                   MOVEL     SDT           TTDATE
     C                   MOVEL     STM           TTTIME
     C                   MOVE      ULDT          TTDATL
     C                   MOVE      XULTM         TTTIML
     C                   MOVE      *BLANKS       TTUSER
     C                   MOVEL     'SY400USR'    TTUSER
s21  C*                  MOVEL     TTXED2        TTTEXT
s21  C*                  MOVEL     TTXED2L       TTTEXL
n21  C                   eval      TTTEXT = TTXED2
n21  C                   eval      TTTEXL = TTXED2L
N13  C                   MOVE      'S'           TTMANU
N18  c                   movel     HOEDSN        TTDEPO
     C                   WRITE     TRACKFR
N18  c                   move      *blanks       TTDEPO
     C                   END
      * Registrert (SKREVET TIL HEADF...)
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      'STR'         TTACTI
     C                   MOVE      ULDT          TTDATE
     C                   MOVE      XULTM         TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
     C                   MOVEL     ZUSER         TTUSER
s21  C*                  MOVEL     TTXSTR        TTTEXT
s21  C*                  MOVEL     TTXSTRL       TTTEXL
n21  C                   eval      TTTEXT = TTXSTR
n21  C                   eval      TTTEXL = TTXSTRL
N13  C                   MOVE      'S'           TTMANU
     C                   WRITE     TRACKFR
      * hvis det er scannet inn via mottate EDI-kolliID da ligger
      * slutttid lagret i DS i HENOS - sendingsposten
      * OBS! Ved manko er det tiden der noe har "løst opp mankoen"
      * KODE TEI - Terminal INN
      *      som er lagret!!!
     c     HOVOPD        IFEQ      'J'
     c     HSDSDT        ANDNE     *BLANKS
     c     HSDSDT        ANDNE     *ZEROS
N19  c     OptDirekte    ANDNE     'J'
     C                   MOVE      'TEI'         TTACTI
     C                   MOVE      HSDSDT        TTDATE
     C                   MOVE      *zeros        TTTIME
     C                   MOVEL     HSDSTI        TTTIME
     C                   MOVEL     HSDSUS        TTUSER
     C*                  EVAL      TTTEXT = 'Arrived on terminal ' + FIKRTN
N07  C*                  EVAL      TTTEXL = 'Ankommet til terminal ' + FIKRTN
N15  C                   MOVEL     *blanks       TERM              3
BHR  C*    TTAVD         IFGT      8000
BHR  C*                  MOVEL     'OSL'         TERM
BHR  C*                  ELSE
BHR  C*                  MOVEL     'DRA'         TERM
BHR  C*                  ENDIF
n13  C                   EVAL      TTTEXT = 'Arrived terminal ' + FIKRTN
N13  C                   EVAL      TTTEXL = 'Ankommet terminal ' + FIKRTN
N15  C                   CAT       TERM:1        TTTEXT
N15  C                   CAT       TERM:1        TTTEXL
S15  C*                  MOVEL     FIKRTN        TTDEPO
N15  C                   MOVEL     FIKRTN        TTDEPO6           6
N15  C                   MOVEL     TTDEPO6       TTDEPO
N15  C                   CAT       TERM:1        TTDEPO
N13  C                   MOVE      'S'           TTMANU
     C                   WRITE     TRACKFR
N15   ** Loggføre vektendring via cargoscan
N15  C                   MOVE      HSLNR2        WSLNR2
N15  C     LNRKEY        CHAIN     CARGOO1                            33
N15  C     *IN33         IFEQ      '0'
N15  c                   if        HEVKT<>COGVKT or HEM3<>COGM3 or HELM<>COGLM
N15  C                   MOVE      'ZVK'         TTACTI
N15  C                   eval      TTtext = 'Wt/Vol adj:'
N15  C                             +%trimR(%editc(HEVKT:'Z'))+' Kg'
N15  C                             +%trimR(%editw(HEM3:'  0 ,   '))+' M3 '
N15  C                             +%trimR(%editw(HELM:'0 ,  '))+' LM '
N15  c                             +'BY '+%trim(FIKRTN)+' '+%trim(TERM)
N15  C                   MOVEL     'CARGOSCAN'   TTUSER
N15  C                   WRITE     TRACKFR
N15  c                   endif
N15  C                   ENDIF
     c                   end
      *
     C                   ENDSR
      *
     C***********************************************
     C     PALLER        BEGSR
     C***********************************************
      *
     C                   MOVE      'N'           PALLJN            1
     C                   MOVEL     'SYPALL  '    PRODNA           15
     C     PRODNA        CHAIN     SYPROD                             33
     C  N33PRINST        IFEQ      'J'
     C                   MOVE      'J'           PALLJN            1
     C                   END
     C     PALLJN        CABEQ     'N'           UTPALL
      *
     C     HOPRO         CHAIN(N)  TURER14                            33
      * TIL TRANSPORTØR
     C     HOPLL2        IFNE      *ZEROS
      * 1. KUNDE AVGIR   TRANSPORTØR MOTTAR
      * (VED XXVIA=X FØRES SLIK AT TRANS GÅR VIA PALLAGER-HOLDER)
      * KODE: K=KUNDE, T=TRANSP.
     C                   Z-ADD     HOKNS         XXAVGI            8 0
     C                   MOVE      'K'           XXAVGK            1
     C                   Z-ADD     TUKNT2        XXMOTT            8 0
     C                   MOVE      'T'           XXMOTK            1
     C                   MOVE      ' '           XXVIA             1
     C                   Z-ADD     HOPLL2        XXANT             5 0
     C                   MOVEL     HOBILN        XXBILN           10
     C                   MOVE      'B'           XXBEIE            1
     C                   MOVEL     HOSNDN        XXTXT            20
     C                   MOVE      '0'           XXFLAG            1
     C                   CALL      'SYPA11'
     C                   PARM                    XXAVGI
     C                   PARM                    XXAVGK
     C                   PARM                    XXMOTT
     C                   PARM                    XXMOTK
     C                   PARM                    XXVIA                          X=VIA LAG.HO
     C                   PARM                    XXANT
     C                   PARM                    XXBILN
     C                   PARM                    XXBEIE
     C                   PARM                    XXTXT
     C                   PARM                    XXFLAG
     C                   END
      *
      * FRA TRANSPORTØR
     C     HOPLL1        IFNE      *ZEROS
      * 1. KUNDE AVGIR   TRANSPORTØR MOTTAR
      * (VED XXVIA=X FØRES SLIK AT TRANS GÅR VIA PALLAGER-HOLDER)
      * KODE: K=KUNDE, T=TRANSP.
     C                   Z-ADD     TUKNT2        XXAVGI            8 0
     C                   MOVE      'T'           XXAVGK            1
     C                   Z-ADD     HOKNS         XXMOTT            8 0
     C                   MOVE      'K'           XXMOTK            1
     C                   MOVE      ' '           XXVIA             1
     C                   Z-ADD     HOPLL1        XXANT             5 0
     C                   MOVEL     HOBILN        XXBILN           10
     C                   MOVE      'A'           XXBEIE            1
     C                   MOVEL     HOSNDN        XXTXT            20
     C                   MOVE      '0'           XXFLAG            1
     C                   CALL      'SYPA11'
     C                   PARM                    XXAVGI
     C                   PARM                    XXAVGK
     C                   PARM                    XXMOTT
     C                   PARM                    XXMOTK
     C                   PARM                    XXVIA                          X=VIA LAG.HO
     C                   PARM                    XXANT
     C                   PARM                    XXBILN
     C                   PARM                    XXBEIE
     C                   PARM                    XXTXT
     C                   PARM                    XXFLAG
     C                   END
      *
     C     UTPALL        ENDSR
      *
      *////////////////////////////////////////////////////////////
      * FTX15                                               FTX15 /
      *////////////////////////////////////////////////////////////
     C     FTX15         BEGSR
     C     KEYMS1        KLIST
     C                   KFLD                    HOEDSN
     C                   KFLD                    FGN
     C                   KFLD                    FREP0
     C                   CLEAR                   FREETXTR
     C                   MOVE      HEAVD         FRTAVD
     C                   MOVE      HEOPD         FRTOPD
     C                   Z-ADD     HEDTR         FRTDT
     C                   CLEAR                   DOK29R
     C                   MOVE      HEAVD         D29AVD
     C                   MOVE      HEOPD         D29OPD
     C                   Z-ADD     1             D29FNR
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     15            FGN
     C                   Z-ADD     HSLNR2        FREP0
     C     KEYMS1        SETLL     EFTX93A                                20
     C     KEYMS1        READE     EFTX93A                                51
     C     *IN51         DOWEQ     '0'
      *
     C                   SELECT
     C     F4451         WHENEQ    'SIC'
     C                   MOVE      'G'           FRTKOD
      *
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440A        FRTTXT
     C                   WRITE     FREETXTR
S08   *     - også på fraktbrev..
S08  C*                  MOVEL     F4440A        D29TXT
S08  C*                  WRITE     DOK29R
      *
     C     F4440B        IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440B        FRTTXT
     C                   WRITE     FREETXTR
S08   *     - også på fraktbrev..
S08  C*                  MOVEL     F4440B        D29TXT
S08  C*                  WRITE     DOK29R
     C                   ENDIF
     C     F4440C        IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440C        FRTTXT
     C                   WRITE     FREETXTR
S08   *     - også på fraktbrev..
S08  C*                  MOVEL     F4440C        D29TXT
S08  C*                  WRITE     DOK29R
     C                   ENDIF
     C     F4440D        IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440D        FRTTXT
     C                   WRITE     FREETXTR
S08   *     - også på fraktbrev..
S08  C*                  MOVEL     F4440D        D29TXT
S08  C*                  WRITE     DOK29R
     C                   ENDIF
     C     F4440E        IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440E        FRTTXT
     C                   WRITE     FREETXTR
S08   *     - også på fraktbrev..
S08  C*                  MOVEL     F4440E        D29TXT
S08  C*                  WRITE     DOK29R
     C                   ENDIF
      * UNDERRETNING TIL KUNDE LEGGES RETT UT I RUBR38-FIL FOR FR.BREV
     C     F4451         WHENEQ    'ICN'
     C                   MOVEL     F4440A        D29TXT
     C                   WRITE     DOK29R
      *
     C     F4440B        IFNE      *BLANKS
     C                   MOVEL     F4440B        D29TXT
     C                   WRITE     DOK29R
     C                   ENDIF
     C     F4440C        IFNE      *BLANKS
     C                   MOVEL     F4440C        D29TXT
     C                   WRITE     DOK29R
     C                   ENDIF
     C     F4440D        IFNE      *BLANKS
     C                   MOVEL     F4440D        D29TXT
     C                   WRITE     DOK29R
     C                   ENDIF
     C     F4440E        IFNE      *BLANKS
     C                   MOVEL     F4440E        D29TXT
     C                   WRITE     DOK29R
     C                   ENDIF
     C*
     C                   OTHER
     C                   END
      *
     C     KEYMS1        READE     EFTX93A                                51
     C  N51              ENDDO
      *
     C                   ENDSR
N06
N06   *****************************************************
N06  C     HENOFSR       BEGSR
N06   *****************************************************
N06  c     *like         define    FRTLI         XXXLI
N06  c                   move      FRTLI         XXXLI
N06  C                   CLEAR                   FREETXTR
N06  c                   move      xxxLI         FRTLI
N06  C                   MOVE      HEAVD         FRTAVD
N06  C                   MOVE      HEOPD         FRTOPD
N06  C                   Z-ADD     HEDTR         FRTDT
N06  C                   CLEAR                   DOK29R
N06  C                   MOVE      HEAVD         D29AVD
N06  C                   MOVE      HEOPD         D29OPD
N06  C                   Z-ADD     1             D29FNR
N06   *
N06  C     HENOSK        SETLL     HENOF
N06  C     HENOSK        READE     HENOF                                  51
N06  C     *IN51         DOWEQ     '0'
N06   * G=GODLISTE OG FRAKTBREV - M=MOTTAKER/KUNDE - BARE PÅ FRAKTBREV
N06  C     HFKODE        ifeq      'G'
N06  C                   MOVE      'G'           FRTKOD
N06  C                   ADD       1             FRTLI
N06  C                   eval      FRTTXT = HFTXT
N06  C                   WRITE     FREETXTR
N06  c                   endif
N06   * FRAKTBREV (fra juni 2012 - kun melding til mottaker ti DOK29, til transp takles av Frit/G)
N08  C     HFKODE        ifeq      'M'
N06  C                   eval      D29TXT = HFTXT
N06  C                   WRITE     DOK29R
N08  C                   endif
N06   *
N06  C     HENOSK        READE     HENOF                                  51
N06  C  N51              ENDDO
N06   *
N06  C                   ENDSR
      *******************************************
     C     TSTTXT        BEGSR
      *******************************************
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     15            FGN
     C                   Z-ADD     HSLNR2        FREP0
     C     KEYMS1        SETLL     EFTX93A                                20
     C     KEYMS1        READE     EFTX93A                                51
     C     *IN51         DOWEQ     '0'
     C     F4451         IFEQ      'SIC'
     C                   MOVE      '1'           *IN57
     C                   GOTO      UTTSTT
     C                   END
     C     KEYMS1        READE     EFTX93A                                51
     C  N51              ENDDO
      * HVIS MANKO-MODE = J VIS MAKO I STEDET FOR SENDNR
     C     MANMOD        IFEQ      'J'
     C                   MOVE      *ZEROS        ANTTOT            3 0
     C                   MOVE      *ZEROS        ANTMAN            3 0
     C     HENOSK        SETLL     HENOK
     C     HENOSK        READE(N)  HENOK                                  33
     C     *IN33         DOWEQ     *OFF
     C                   ADD       1             ANTTOT
     C     HKSTIN        IFEQ      ' '
     C                   ADD       1             ANTMAN
     C                   END
     C     HENOSK        READE(N)  HENOK                                  33
     C                   END
      * FJERN FORANSTILTE NULLER
     C                   MOVE      ANTTOT        ANTTOA            3
     C                   MOVE      ANTMAN        ANTMAA            3
     C     ANTTOA1       IFEQ      '0'
     C                   MOVE      ' '           ANTTOA1
     C     ANTTOA2       IFEQ      '0'
     C                   MOVE      ' '           ANTTOA2
     C                   END
     C                   END
     C     ANTMAA1       IFEQ      '0'
     C                   MOVE      ' '           ANTMAA1
     C     ANTMAA2       IFEQ      '0'
     C                   MOVE      ' '           ANTMAA2
     C                   END
     C                   END
     C                   EVAL      HXSNDN10 = 'Ma:'+ANTMAA+'/'+ANTTOA
      *
     C                   END
      *
     C     UTTSTT        ENDSR
N03  C***********************************************
N03  C     GETFRT        BEGSR
N03  C***********************************************
N03   * SR SOM HENTER VERDI FOR FRAKTTILLEGG (OLJE/VAL...)
N03  C                   MOVE      'H'           UUR
N03  C                   MOVE      *BLANKS       HEVALT
N03  C                   MOVE      *ZEROS        UVALP
N03  C                   CALL      'SYFA24B'
N03  C                   PARM                    UUR               1
N03  C                   PARM      HEAVD         UAVDOP            4 0
N03  C                   PARM      XXFAMO        UKNOP             8 0
N03  C                   PARM                    HEVALT
N03  C                   PARM                    UVALP             3 1
N03  C                   MOVE      UVALP         HEVALP
N03  C                   ENDSR
