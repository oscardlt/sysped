CB    * Fel nær man inte hittar transiteringen.
     FTRACKF    O  A E           K DISK
     FFRISOK    IF A E           K DISK
     FKODFRI    IF   E           K DISK
     FDKXERR    UF A E           K DISK
     FHEADF     IF   E           K DISK
     FFIRM      IF   E           K DISK
     FEDIRE     IF   E           K DISK
     FDKXH      UF   E           K DISK
     FDKXH05    IF   E           K DISK
     F                                     RENAME(DKXHR:DKXHR05)
     FDKXH12    IF   E           K DISK
     F                                     RENAME(DKXHR:DKXHR12)
     FDKXHK     UF A E           K DISK
     FDKXHFR    UF   E           K DISK
     FDKXHFS    UF A E           K DISK
     FDKXGH     UF   E           K DISK
     FDKXKODL01 IF   E           K DISK
     FEDIM2     IF   E           K DISK
     F                                     RENAME(EDIMR:EDIMR2)
     FEDIM4     IF   E           K DISK    RENAME(EDIMR:EDIMR4)
     F                                     PREFIX(M4_)
     FEDIM5     IF   E           K DISK
     F                                     RENAME(EDIMR:EDIMR5)
     FEDIM6     IF   E           K DISK
     F                                     RENAME(EDIMR:EDIMR6)
     FEDIS4     IF   E           K DISK
     F                                     RENAME(EDISR:EDISR4)
     FEDIC      UF   E             DISK
     FTVINF     O  A E             DISK
     FEDIM      O  A E             DISK
     FEDIS      O  A E             DISK
     D FT              S             70    DIM(900)
     D S1              S              2    DIM(10)
     D S2              S             20    DIM(10)
     D                 DS
     D  FE                     1    256    DIM(256)
     D  FELT                   1    256
     D                 DS
     D  AA                     1     80    DIM(80)
     D  AADS                   1     80
     D                 DS
     D  AB                     1     80    DIM(80)
     D  ABDS                   1     80
     D                 DS
     D  XTRDT                  1      8  0
     D  XTRDTÅ                 1      4
     D  XTRDTM                 5      6
     D  XTRDTD                 7      8
     D                 DS
     D  W0068                  1     16  0
     D  W0068A                 1      8  0
     D  W0068B                 9     14  0
     D                 DS
     D  Æ0068                  1     24
     D  Æ00683                 9     24
     D                 DS
     D  WMBR                   1     10
     D  WMBRA                  1      1
     D  WMBRB                  2     10S 0
     IEDIMR2
     I              M0004                       X0004
     I              M0010                       X0010
     I              M0035                       X0035
     I              M0062                       X0062
     I              M0065                       X0065
     I              M0068                       X0068
     I              M0068A                      X0068A
     I              M0068B                      X0068B
     I              M0068C                      X0068C
     I              M0068D                      X0068D
     I              M0068E                      X0068E
     I              M0068F                      X0068F
     I              M1001                       X1001
     I              M1004                       X1004
     I              M1225                       X1225
     I              M2005B                      X2005B
     I              M3039D                      X3039D
     I              M3039E                      X3039E
     I              M5004D                      X5004D
     I              M1N07                       X1N07
     I              M1N08                       X1N08
     I              M9N01                       X9N01
     I              MSN                         XSN
     I              MMN                         XMN
     I              MSR                         XSR
     I              MST                         XST
     I              MDT                         XDT
     I              MTM                         XTM
     I              MVEN                        XVEN
     IEDIMR5
     I              M0004                       X0004
     I              M0010                       X0010
     I              M0035                       X0035
     I              M0062                       X0062
     I              M0065                       X0065
     I              M0068                       X0068
     I              M0068A                      X0068A
     I              M0068B                      X0068B
     I              M0068C                      X0068C
     I              M0068D                      X0068D
     I              M0068E                      X0068E
     I              M0068F                      X0068F
     I              M1001                       X1001
     I              M1004                       X1004
     I              M1225                       X1225
     I              M2005B                      X2005B
     I              M3039D                      X3039D
     I              M3039E                      X3039E
     I              M5004D                      X5004D
     I              M1N07                       X1N07
     I              M1N08                       X1N08
     I              M9N01                       X9N01
     I              MSN                         XSN
     I              MMN                         XMN
     I              MSR                         XSR
     I              MST                         XST
     I              MDT                         XDT
     I              MTM                         XTM
     I              MVEN                        XVEN
     IEDIMR6
     I              M0004                       X0004
     I              M0010                       X0010
     I              M0035                       X0035
     I              M0062                       X0062
     I              M0065                       X0065
     I              M0068                       X0068
     I              M0068A                      X0068A
     I              M0068B                      X0068B
     I              M0068C                      X0068C
     I              M0068D                      X0068D
     I              M0068E                      X0068E
     I              M0068F                      X0068F
     I              M1001                       X1001
     I              M1004                       X1004
     I              M1225                       X1225
     I              M2005B                      X2005B
     I              M3039D                      X3039D
     I              M3039E                      X3039E
     I              M5004D                      X5004D
     I              M1N07                       X1N07
     I              M1N08                       X1N08
     I              M9N01                       X9N01
     I              MSN                         XSN
     I              MMN                         XMN
     I              MSR                         XSR
     I              MST                         XST
     I              MDT                         XDT
     I              MTM                         XTM
     I              MVEN                        XVEN
     IEDISR4
     I              S0004                       XS0004
     I              S0010                       XS0010
     I              S0020                       XS0020
     I              S0026                       XS0026
     I              S0035                       XS0035
     I              S0036                       XS0036
     I              SSN                         XSSN
     I              SSR                         XSSR
     I              SST                         XSST
     I              SDT                         XSDT
     I              STM                         XSTM
     I              SLIB                        XSLIB
     I              SFILE                       XSFILE
     I              SMBR                        XSMBR
     I              SMBRS                       XSMBRS
      *___________
      * HODELOGIKK
      *"""""""""""
     C                   EXSR      SRINIT
     C     SEGSTA        TAG
     C  NLR              EXSR      GETSEG
     C   LR              GOTO      SLUTT
     C                   SELECT
     C                   WHEN      SEGNAM = 'UNB'
     C                   EXSR      SRUNB
     C                   WHEN      SEGNAM = 'UNH'
     C                   IF        XFERDIG <> 'J'
     C                   EXSR      SRUNH
     C                   END
     C                   WHEN      SEGNAM = 'UNZ'
     C                   EXSR      SRUNZ
     C                   END
     C                   IF        SEGNAM = 'UNT'
     C                   MOVE      'J'           XFERDIG           1
     C                   END
     C                   GOTO      SEGSTA
     C     SLUTT         TAG
      *__________________________________________________________
      * SR for initiering                                  SRINIT
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRINIT        BEGSR
     C                   READ      FIRM                                   33
     C* HENTE DAGENS DATO OG TID
     C                   CALL      'SYGE15C'
     C                   PARM                    WDATO             8
     C                   PARM                    WTID              6
     C* Parametre fra CL= fil/library/member for fil som behandles
     C     *ENTRY        PLIST
     C                   PARM                    SLIB
     C                   PARM                    SFILE
     C                   PARM                    SMBR
     C                   PARM                    WS               10            (=TVINR)
     C* Returnerer J i OK dersom data er konvertert, N dersom ikke.
     C                   PARM                    OK                1
     C     FRIKEY        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    FSKODE            3
     C                   KFLD                    FSSOK
      * DEFINER NØKKELFELT FOR DKXH
     C     DKXHKEY       KLIST
     C                   KFLD                    THAVD
     C                   KFLD                    THTDN
     C     HEADFK        KLIST
     C                   KFLD                    THAVD
     C                   KFLD                    THTDN
      * DEFINER NØKKELFELT FOR DKXKODL01
     C     DKXKODK       KLIST
     C                   KFLD                    TKUNIK
     C                   KFLD                    TKKODE
      * DEFINER NØKKELFELT FOR TRKODL01
     C     DKXKD2K       KLIST
     C                   KFLD                    T2UNIK
     C                   KFLD                    TKKODE
      * DEFINER NØKKELFELT FOR DKXKODL01
     C     DKXKD3K       KLIST
     C                   KFLD                    T3UNIK
     C                   KFLD                    TKKODE
      * DEFINER NØKKELFELT FOR DKXERR
     C     DKXERK        KLIST
     C                   KFLD                    YEST
     C                   KFLD                    XTRNR
     C                   MOVE      ' '           YEST              1
      * DEFINER NØKKELFELT FOR EDIM2
     C     KEYM2         KLIST
     C                   KFLD                    THAVD
     C                   KFLD                    THTDN
     C                   KFLD                    X0068A
     C     KEYM4         KLIST
     C                   KFLD                    M4_MSR
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
      * DEFINER NØKKELFELT FOR EDIM5
     C     KEYM5         KLIST
     C                   KFLD                    M0068
      * INIT AV ARBEIDSFELT
     C                   MOVE      'N'           OK                             UNB--> J    elt.
     C                   MOVE      *ZEROS        NUMVRD           15 0          Gener. num felt.
     C                   MOVE      *ZEROS        NUTEGN            1 0          "TEGN" numerisk rep.
     C                   MOVE      *BLANKS       SEGNAM            3            Segment navn
     C* De meldingstyper vi mottar i dag inneholder IKKE omberegning
     C                   MOVE      *ZEROS        M0068D                         Dek.dato.OMB/TDENR)
     C                   MOVE      *ZEROS        M0068E                         Dek.sekv.OMB/TDENR)
     C                   MOVE      *ZEROS        M0068F                         Dek.vers.OMB/TDENR)
     C* Enkelte felt i loggen benyttes ikke ved recieve
     C                   MOVE      *ZEROS        M2005B                         Ønsk.be.dat./TDENR)
     C                   MOVE      *ZEROS        M3039D                         Dek.referan./TDENR)
     C                   MOVE      *ZEROS        M3039E                         Eksp.enhet  /TDENR)
     C                   MOVE      *ZEROS        M5004D                         Depositum   /TDENR)
     C                   MOVE      *ZEROS        M9N01                          Eksp.priori./TDENR)
     C                   MOVE      *BLANKS       M1N08                          Meld.id.korr/TDENR)
     C                   MOVE      *BLANKS       MVEN                           Ventekode   /TDENR)
     C* Enkelte felt er faste ved recieve
     C                   MOVE      'R'           SSR                            Send/rec.sen
     C                   MOVE      'C'           SST                            Status sendi
     C                   MOVE      WDATO         SDT                            Dato inn sen
     C                   MOVE      WTID          STM                            Tid inn  sen
     C                   MOVE      'R'           MSR                            Send/rec.mel/TDENR)
     C                   MOVE      'C'           MST                            Status meld./TDENR)
     C                   MOVE      WDATO         MDT                            Dato inn mel
     C                   MOVE      WTID          MTM                            Tid inn  mel
     C                   MOVE      'S'           M4_MSR
     C                   MOVE      '023'         TKUNIK                         Unikkode for kodereg
     C                   MOVE      '149'         T2UNIK            3            Unikkode for kodereg
     C                   MOVE      '209'         T3UNIK            3            Unikkode for kodereg
     C* Datafelt AB i EDIRE (80 lang) går rett inn i array AB ved READ
     C* TN=81 soerger for automatisk overflyt array AB->AA ved kall av GETCH
      * HVIS NETTVERK=KOMMUNEDATA ER FØRSTE RECORD=3 (VED ORIGINAL)
      * DA ER FØRSTE KARAKTER 'ø' I LINJE 1 (LINJE 2 ER BLANK)
      * VED RETRANSMITT FÅR VI IKKE INN "RUSK I LINJE" 1 OG 2
     C     SMBR          SETLL     EDIRE
     C     SMBR          READE     EDIRE                                  LR
     C   LR              GOTO      ENDINI
     C                   MOVE      RDATA         ABDS
     C     AB(1)         IFEQ      'ø'
     C     1             DO        2
     C     SMBR          READE     EDIRE                                  LR
     C   LR              GOTO      ENDINI
     C                   END
     C                   END
     C*
     C                   MOVE      RDATA         ABDS
     C                   Z-ADD     81            TN                2 0
     C                   MOVE      'NO '         EOF               3             * FLAGG FOR EOF
     C                   MOVE      ' '           TEGN              1
     C                   MOVE      ' '           LOKAHE            1
     C*
     C* Spesielt reserverte tegn defineres her med både grafisk verdi og
     C* med en logisk verdi. Den grafiske verdien testes det mot i rutinen
     C* som henter tegn. Finner denne rutinen at at tegnet er ment som en
     C* spesialverdi (ikke ? foran), byttes tegnet med tilsvarende LOGISK VERDI
     C* (De logiske verdiene er ikke lesbre tegn,og vil aldri forekomme i den
     C* innkommende datastroemmen). '?' når brukt som opphevelse foran annet
     C* spesialtegn vil bli "spist" av henterutinen (GETCH) og en vil derfor
     C* kunne betrakte spoersmålstegn som grafisk tegn i resten av programmet.
     C*
     C* Ved andre standarder for spesialtegn er det bare å bytte verdiene til
     C* de GRAFISKE tegnene her. (Programmet arbeider da med riktige verdier).
     C                   MOVE      '?'           GRASPØ            1
     C                   MOVE      '+'           GRAPLU            1
     C                   MOVE      ':'           GRAKOL            1
     C                   BITON     '123457'      GRAAPP            1
     C                   BITOFF    '06'          GRAAPP
     C* Logiske verdier for spesialtegn
     C* LOGAPP = slutt på segmentet. I NODI er tegnet "'".
     C                   BITON     '17'          LOGAPP            1
     C                   BITOFF    '023456'      LOGAPP
     C* HVIS KOMMUNEDATA, INITIERE MED LOGAPP (GÅ RETT PÅ UNB)
     C                   MOVE      LOGAPP        TEGN
     C* LOGPLU = sparasjonstegn for Tag/dataelement. I NODI er tegnet "+".
     C                   BITON     '16'          LOGPLU            1
     C                   BITOFF    '023457'      LOGPLU
     C* LOGKOL = sparasjonstegn for delelement. I NODI er tegnet ":".
     C                   BITON     '167'         LOGKOL            1
     C                   BITOFF    '02345'       LOGKOL
     C* LOGBLA = utenlandske måten å vise blank.
     C                   BITON     '01234567'    LOGBLA            1
     C*
     C     ENDINI        ENDSR
     C*__________________________________________________________
     C* SR for å hente UNBdata - (NodiID.)                 SRUNB
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRUNB         BEGSR
     C* Når UNB-segm er funnet sett 'J' i OK-param.(retur til CL-prog)
     C                   MOVE      'J'           OK                             UNB-->OK=J  elt.
     C* Sendingsnr fra fil
     C                   EVAL      WMBR=SMBR
     C                   EVAL      SSN=WMBRB
     C*
     C* Står nå på + i     'UNB+   -  nå foelger: UNOC:3+
     C                   DO        7
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C                   END
     C* TEGN er nå '+' forran Avsenders Nodi-ID
     C                   MOVE      *BLANKS       FE
     C     1             DO        35            NR                3 0
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C     TEGN          IFEQ      LOGPLU
     C     TEGN          OREQ      LOGAPP
     C     TEGN          OREQ      LOGKOL
     C                   GOTO      UNB001
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     UNB001        TAG
     C                   MOVEL     FELT          S0004                          Avsenders NODI-ID
      *
     C                   MOVE      *BLANKS       UM0007            4
     C                   MOVE      *BLANKS       UM0008           14
     C                   IF        TEGN = LOGKOL
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C     TEGN          IFEQ      LOGPLU
     C     TEGN          OREQ      LOGAPP
     C     TEGN          OREQ      LOGKOL
     C                   GOTO      UNB0011
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     UNB0011       TAG
     C                   MOVEL     FELT          UM0007
     C                   IF        TEGN = LOGKOL
     C                   MOVE      *BLANKS       FE
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C     TEGN          IFEQ      LOGPLU
     C     TEGN          OREQ      LOGAPP
     C     TEGN          OREQ      LOGKOL
     C                   GOTO      UNB0012
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     UNB0012       TAG
     C                   MOVEL     FELT          UM0008
     C                   END
     C                   END
     C* Possisjoner til '+' forran mottagers Nodi-ID
     C     TEGN          DOWNE     LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C                   END
     C* Hent mottakers Nodi-ID
     C                   MOVE      *BLANKS       FE
     C     1             DO        35            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C     TEGN          IFEQ      LOGPLU
     C     TEGN          OREQ      LOGAPP
     C     TEGN          OREQ      LOGKOL
     C                   GOTO      UNB002
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     UNB002        TAG
     C                   MOVEL     FELT          S0010                          Mottakers NODI-ID
      *
     C                   MOVE      *BLANKS       UA0007            4
     C                   MOVE      *BLANKS       UA0008           14
     C                   IF        TEGN = LOGKOL
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C     TEGN          IFEQ      LOGPLU
     C     TEGN          OREQ      LOGAPP
     C     TEGN          OREQ      LOGKOL
     C                   GOTO      UNB0021
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     UNB0021       TAG
     C                   MOVEL     FELT          UA0007
     C                   IF        TEGN = LOGKOL
     C                   MOVE      *BLANKS       FE
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C     TEGN          IFEQ      LOGPLU
     C     TEGN          OREQ      LOGAPP
     C     TEGN          OREQ      LOGKOL
     C                   GOTO      UNB0022
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     UNB0022       TAG
     C                   MOVEL     FELT          UA0008
     C                   END
     C                   END
      *
     C* Possisjoner til '+' forran dato tidsfelt (mandatory)
     C     TEGN          DOWNE     LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C                   END
     C* Possisjoner til '+' forran sendingsref (mandatory)
     C     TEGN          DOUEQ     LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C                   END
     C* Hent sendingsreferanse
     C                   MOVE      *BLANKS       FE
     C     1             DO        256           NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C     TEGN          IFEQ      LOGPLU
     C     TEGN          OREQ      LOGAPP
     C                   GOTO      UNB010
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     UNB010        TAG
     C                   MOVEL     FELT          S0020                          Meldingsref.DI-ID
     C     ENDUNB        ENDSR
      *
     C*__________________________________________________________
     C* SR for å hente UNZdata(oppdatere sendingslogg)     SRUNZ
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRUNZ         BEGSR
     C* TEGN er nå '+' forran Antall meldinger i sendingen(numerisk)
     C                   MOVE      *ZEROS        NUMVRD
     C     1             DO        7             NR                             *max 7 foer '+'
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNZ
     C     TEGN          IFEQ      LOGPLU
     C                   GOTO      UNZT01
     C                   END
     C     TEGN          IFLT      '0'
     C     TEGN          ORGT      '9'
     C                   GOTO      UNZT01
     C                   END
     C                   MULT      10            NUMVRD
     C                   MOVE      TEGN          NUTEGN
     C                   ADD       NUTEGN        NUMVRD
     C                   END
     C     UNZT01        TAG
     C                   Z-ADD     NUMVRD        S0036
     C*
     C* Oppdater sendingsloggen
     C                   WRITE     EDISR
     C*
     C     ENDUNZ        ENDSR
     C*__________________________________________________________
     C* SR for å hente neste tegn i datastroem             GETCH
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     GETCH         BEGSR
     C* Rutinen henter "TEGN" fra array AA. Ved slutten av AA "toemmes" AB inn
     C* i AA. (AB benyttes kun for alltid å kunne ha "lookahead-tegn" - LOKAHE)
     C* LR settes når en ved "Toemming" finner at AB-arrayet er tomt.
     C*
     C* "?" spises av SR når "?" kun varsler grafisk betydning av spesialtegn.
     C*Når tegn ved utgang av SR er ',+ eller :  er betydningen av ind. 98 :
     C*    98 ON -> kun grafisk betydning (uforandret)
     C*    98 OFF-> spesialtegn (Bytt tegn mot ikke lesbar logisk verdi LOG???)
     C                   SETOFF                                           98
     C     STACH         TAG
     C* Må ny record hentes inn i array AA (fra AB)?????
     C     TN            IFEQ      81
     C     EOF           IFEQ      'YES'
     C                   SETON                                            LR
     C                   GOTO      ENDCH
     C                   END
     C                   MOVE      ABDS          AADS
     C  N99SMBR          READE     EDIRE                                  99     *hent ny til AB
     C  N99              MOVE      RDATA         ABDS
     C   99              MOVE      *BLANKS       ABDS
     C   99              MOVE      'YES'         EOF                             * FLAGG FOR EOF
     C                   Z-ADD     1             TN                              * Tegn-index-nr
     C                   END
     C* Hent det tegn som TN peker på - Tegnet etter er "Lookahead"
     C                   MOVE      AA(TN)        TEGN
     C                   ADD       1             TN
     C     TN            IFLE      80
     C                   MOVE      AA(TN)        LOKAHE            1
     C                   ELSE
     C                   MOVE      AB(1)         LOKAHE
     C                   END
     C* Dersom TEGN er "?" og LOKAHE er spes.tegn - "spis" spoersmålstegnet
     C* Når 98 er on her betyr det at "?" foran spesialtegn alt er "spist"
     C*        evt. nytt "?" er da grafisk tegn - LOKAHE skal da IKKE testes.
     C  N98TEGN          IFEQ      GRASPØ
     C     LOKAHE        COMP      GRAAPP                                 98
     C  N98LOKAHE        COMP      GRAPLU                                 98
     C  N98LOKAHE        COMP      GRAKOL                                 98
     C  N98LOKAHE        COMP      GRASPØ                                 98
     C   98              GOTO      STACH
     C                   END
     C* Ved N98 og ',+ eller : i TEGN betyr det at det IKKE var opphevelsestegn
     C* foran. Vi har med andre ord et LOGISK SPESIALTEN INNE
     C  N98TEGN          IFEQ      GRAAPP
     C                   MOVE      LOGAPP        TEGN
     C                   ELSE
     C     TEGN          IFEQ      GRAPLU
     C                   MOVE      LOGPLU        TEGN
     C                   ELSE
     C     TEGN          IFEQ      GRAKOL
     C                   MOVE      LOGKOL        TEGN
     C                   ELSE
     C     TEGN          IFEQ      LOGBLA
     C                   MOVE      ' '           TEGN
     C                   END
     C                   END
     C                   END
     C                   END
     C*
     C     ENDCH         ENDSR
     C*__________________________________________________________
     C* SR for å hente neste Segment                       GETSEG
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     GETSEG        BEGSR
     C* "Spis tegn" til appostrof er lest
     C     TEGN          DOWNE     LOGAPP
     C                   EXSR      GETCH
     C   LR              GOTO      ENDSEG
     C                   END
     C* Har nå lest appostrof - de 3 neste vil være SEGMENTNAVN
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR                3 0
     C                   EXSR      GETCH
     C   LR              GOTO      ENDSEG
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          SEGNAM
     C* La TEGN være '+' etter segmentnavnet ved utgang av SR
     C                   EXSR      GETCH
     C* Segmentnavn returneres nå i variabel 'SEGNAM'
     C     ENDSEG        ENDSR
     C*__________________________________________________________
     C* SR for å behandle UNH-segmentet                    SRUNH
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRUNH         BEGSR
     C* Felt fra sendingsloggen - som også legge på meldingsnivå
     C                   MOVE      SSN           MSN                            Sendingsnr
     C                   MOVEL     S0004         M0004                          Nodiid-avs.
     C                   MOVEL     S0010         M0010                          Nodiid-mot.
     C                   MOVE      'DTE'         M1001                          Meldingsnavn
     C* Om hele sendingen er test- da er den enkelte melding også test
     C     S0035         IFEQ      '1'
     C                   MOVE      '1'           M0035                          Test-indik.
     C                   END
     C* Hente meldingsnr fra fil (EDIC) og legge det inn MMN
     C     1             CHAIN     EDIC                               33
     C  N33              ADD       1             CMN
     C  N33              UPDATE    EDICR
     C  N33              MOVE      CMN           MMN                            Nr. i meld-
     C   33              Z-ADD     1             MMN                            ingsloggen
     C*
     C* Egen referanse inneholder DKXHKEY+sign
     C* Her bør vi for IBM-nettet heller lese I EDIM for å finne key  ngde)
     C* via avsendt. (samme dato/sekv/med S i Send/Recieve-kode)       ngde)
     C* maxlengde i NODI for ref er 14-senest innen 15. steg skal + påtreffes.
     C                   MOVE      *BLANKS       FE
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNH
     C     TEGN          IFEQ      LOGPLU
     C                   GOTO      UNH010
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     UNH010        TAG
     C                   MOVEL     FELT          M0062
      *
     C* Hent meldings-ID (fra tollvesenet)  inn i felt M0065
     C                   MOVE      *BLANKS       FE
     C     1             DO        6             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNH
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          M0065
      *
      * Les forbi :D:96B:UN:
     C     1             DO        4
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNH
     C                   END
     C                   END
      *
      * Les meldingstype (=CCxxxA)
     C                   EXSR      GETCH                                        Les forbi C
     C                   EXSR      GETCH                                        Les forbi C
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNH
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          M1N07
      *
     C                   IF        M1N07 = '917'
     C                   EXSR      SR917
     C                   GOTO      ENDUNH
     C                   END
      *
     C* Hent BGM-segment for meldingstype
     C     SEGNAM        DOWNE     'BGM'
     C     SEGNAM        ANDNE     'UCI'
     C                   EXSR      GETSEG
     C   LR              GOTO      ENDUNH
     C                   END
      *
      * SEGNAM = UCI --> TJENESTEMELING  CONTROLL
     C     SEGNAM        IFEQ      'UCI'
     C                   EXSR      SRCTL
     C                   GOTO      ENDUNH
     C                   END
      *
     C                   MOVE      *BLANKS       XDK               5
     C                   MOVE      *BLANKS       XTRNR            18
     C                   MOVE      *ZEROS        XTRDT             8 0
     C                   MOVE      *BLANKS       XTRNR            18
     C                   MOVE      *BLANKS       FT
     C                   MOVE      *BLANKS       XGIS1             1
     C                   MOVE      *BLANKS       XGIS2             1
     C                   MOVE      *BLANKS       XDATS             8
     C                   MOVE      *BLANKS       XTSSD             8
     C                   MOVE      *BLANKS       XTSN1            35
     C                   MOVE      *BLANKS       XTSN2            35
     C                   MOVE      *BLANKS       XTSPN             9
     C                   MOVE      *BLANKS       XTSPS            24
     C                   MOVE      *BLANKS       XTSLK             2
     C                   MOVE      *BLANKS       XTSSK             2
     C                   MOVE      *ZEROS        XDDT              8 0
     C                   MOVE      *ZEROS        XDDTK             8 0
     C                   MOVE      *BLANKS       XDKAV            35
     C                   MOVE      *BLANKS       XDKSK             2
     C                   MOVE      *ZEROS        XOMD              1 0
     C                   MOVE      *BLANKS       XBIND           140
     C                   MOVE      *BLANKS       XDKR              3
     C                   MOVE      *BLANKS       S1
     C                   MOVE      *BLANKS       S2
     C                   MOVE      *BLANKS       XN5               3 0
     C                   MOVE      *ZEROS        XDANT             4 0
     C                   MOVE      *BLANKS       XHGFT            35
      *
     C                   EXSR      GETCH
     C     TEGN          IFEQ      LOGKOL
      * LES FORBI ::
     C                   EXSR      GETCH
     C                   EXSR      GETCH
      * HENT STATUS
     C                   MOVE      *BLANKS       FE
     C     1             DO        10            NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGPLU        BGM010
     C     TEGN          CABEQ     LOGAPP        BGM010
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     BGM010        TAG
     C                   MOVEL     FELT          XDK
     C                   END
      *
     C     TEGN          IFNE      LOGAPP
      * Les MRN
     C                   MOVE      *BLANKS       FE
     C     1             DO        20            NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGAPP        BGM020
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     BGM020        TAG
     C                   MOVEL     FELT          XTRNR
     C                   END
      *
     C     XTRNR         CHAIN     DKXH05                             33
     C     *IN33         IFEQ      '1'
     C                   MOVE      *ZEROS        THAVD
     C                   MOVE      *ZEROS        THTDN
     C                   MOVE      '1'           *IN27
     C                   ELSE
     C                   MOVE      '0'           *IN27
     C                   MOVE      99999999      X0068A
     C     KEYM2         SETLL     EDIM2
     C     HEADFK        READPE    EDIM2                                  33
     C     *IN33         IFEQ      '0'
     C                   EVAL      M0068 = THTUID
     C                   MOVE      X0068A        M0068A
     C                   MOVE      X0068B        M0068B
     C                   ELSE
     C                   MOVE      *ZEROS        MAVD
     C                   MOVE      *ZEROS        MTDN
     C                   END
     C                   END
     C                   MOVE      *ZEROS        XN                3 0
      *
     C     DTM010        TAG
     C                   MOVE      *BLANKS       SEGNAM
     C* Hent segment for meldingstype
     C     SEGNAM        DOWNE     'DTM'
     C     SEGNAM        ANDNE     'GIS'
     C     SEGNAM        ANDNE     'FTX'
     C     SEGNAM        ANDNE     'RFF'
     C     SEGNAM        ANDNE     'LOC'
     C     SEGNAM        ANDNE     'NAD'
     C     SEGNAM        ANDNE     'PAC'
     C     SEGNAM        ANDNE     'SEL'
     C     SEGNAM        ANDNE     'CNT'
     C     SEGNAM        ANDNE     'UNT'
     C                   EXSR      GETSEG
     C   LR              GOTO      ENDUNH
     C                   END
      *
     C     SEGNAM        CABEQ     'GIS'         GIS010
     C     SEGNAM        CABEQ     'FTX'         FTX010
     C     SEGNAM        CABEQ     'RFF'         RFF010
     C     SEGNAM        CABEQ     'LOC'         LOC010
     C     SEGNAM        IFEQ      'NAD'
     C                   SELECT
     C     M1N07         WHENEQ    '028'
     C                   GOTO      DTM010
     C     M1N07         WHENEQ    '029'
     C                   GOTO      NAD010
     C                   OTHER
     C                   GOTO      ENDUNH
     C                   ENDSL
     C                   END
     C     SEGNAM        CABEQ     'PAC'         PAC010
     C     SEGNAM        CABEQ     'SEL'         SEL010
     C     SEGNAM        CABEQ     'CNT'         CNT010
     C     SEGNAM        CABEQ     'UNT'         ENDUNH
      *
      * Hent kode til dato
     C                   MOVE      *BLANKS       FE
     C     1             DO        4             NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGKOL        DTM020
     C     TEGN          CABEQ     LOGPLU        DTM010
     C     TEGN          CABEQ     LOGAPP        DTM010
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     DTM020        TAG
     C                   MOVEL     FELT          XKODE             3
     C     XKODE         IFNE      '9  '
     C     XKODE         ANDNE     '46 '
     C     XKODE         ANDNE     '137'
     C     XKODE         ANDNE     '148'
     C     XKODE         ANDNE     '184'
     C     XKODE         ANDNE     '193'
     C     XKODE         ANDNE     '204'
     C     XKODE         ANDNE     '268'
     C                   GOTO      DTM010
     C                   END
      * Hent dato
     C                   MOVE      *BLANKS       FE
     C     1             DO        10            NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGAPP        DTM030
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     DTM030        TAG
     C                   SELECT
     C     XKODE         WHENEQ    '9  '
     C                   MOVEL     FELT          XDDTK
     C     XKODE         WHENEQ    '268'
     C                   MOVEL     FELT          XDDT
     C                   OTHER
     C                   MOVEL     FELT          XTRDT
     C                   ENDSL
     C                   GOTO      DTM010
      *
     C     GIS010        TAG
      *
      * Hent verdi
     C                   MOVE      *BLANKS       FE
     C     1             DO        4             NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGKOL        GIS020
     C     TEGN          CABEQ     LOGPLU        GIS020
     C     TEGN          CABEQ     LOGAPP        DTM010
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     GIS020        TAG
     C                   MOVEL     FELT          XAN03             3
      * Hent kode
     C                   MOVE      *BLANKS       FE
     C     1             DO        4             NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGAPP        GIS030
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     GIS030        TAG
     C                   MOVEL     FELT          XKODE             3
     C     XKODE         IFEQ      '70 '
     C     XKODE         OREQ      '109'
     C     XKODE         OREQ      '148'
     C                   MOVEL     XAN03         XGIS1
     C                   END
     C     XKODE         IFEQ      '117'
     C     XKODE         OREQ      '62 '
     C                   MOVEL     XAN03         XGIS2
     C                   END
     C                   GOTO      DTM010
      *
     C     FTX010        TAG
     C                   EXSR      SRFTX
     C   LR              GOTO      ENDUNH
     C                   GOTO      DTM010
      *
     C     RFF010        TAG
      *
      * IE16/IE28 ER INTERESANT
     C     M1N07         IFNE      '016'
     C     M1N07         ANDNE     '028'
     C                   GOTO      DTM010
     C                   END
      * Les kode
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGKOL        RFF020
     C     TEGN          CABEQ     LOGPLU        DTM020
     C     TEGN          CABEQ     LOGAPP        DTM020
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     RFF020        TAG
     C                   MOVEL     FELT          XKODE
     C     XKODE         CABNE     'ABE'         DTM010
      * Hent LRN
     C                   MOVE      *BLANKS       FE
     C     1             DO        35            NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGAPP        RFF030
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     RFF030        TAG
     C                   MOVEL     FELT          THTUID
     C                   MOVEL     FELT          M0068
     C                   MOVEL     FELT          Æ0068                          Via DS->M...
     C                   MOVE      Æ00683        W0068
     C                   Z-ADD     W0068A        M0068A
     C                   Z-ADD     W0068B        M0068B
      *
     C     THTUID        CHAIN     DKXH12                             33
     C     *IN33         IFEQ      '1'
     C                   MOVE      *ZEROS        THAVD
     C                   MOVE      *ZEROS        THTDN
     C                   MOVE      '1'           *IN27
     C                   ELSE
     C                   MOVE      '0'           *IN27
     C                   MOVE      99999999      X0068A
     C     KEYM2         SETLL     EDIM2
     C     HEADFK        READPE    EDIM2                                  33
     C     *IN33         IFEQ      '0'
     C                   EVAL      M0068 = THTUID
     C                   MOVE      X0068A        M0068A
     C                   MOVE      X0068B        M0068B
     C                   ELSE
     C                   MOVE      *ZEROS        MAVD
     C                   MOVE      *ZEROS        MTDN
     C                   END
     C                   END
     C                   GOTO      DTM010
      *
     C     LOC010        TAG
      *
      * KUN IE29/IE55/IE60 ER INTERESANT
     C     M1N07         IFNE      '029'
     C     M1N07         ANDNE     '055'
     C     M1N07         ANDNE     '060'
     C                   GOTO      DTM010
     C                   END
      * Les kode
     C                   MOVE      *BLANKS       FE
     C     1             DO        4             NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGPLU        LOC020
     C     TEGN          CABEQ     LOGAPP        DTM010
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     LOC020        TAG
     C                   MOVEL     FELT          XKODE
     C     XKODE         IFNE      '118'
     C     XKODE         ANDNE     '168'
     C                   GOTO      DTM010
     C                   END
      * Hent KONTROLL TOLLSTED (IE60) ELLER TOLLSTED RETUREKSEMPEL SENDES TIL (IE29)
      *      ELLER TOLLSTED FOR GARANTI (IE55)
     C                   MOVE      *BLANKS       FE
     C     1             DO        9             NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGKOL        LOC030
     C     TEGN          CABEQ     LOGAPP        LOC030
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     LOC030        TAG
     C     XKODE         IFEQ      '118'
     C                   MOVEL     FELT          XDATS             8
     C                   GOTO      DTM010
     C                   ELSE
     C                   MOVEL     FELT          XTSSD             8
     C                   END
      * Les forbi '::'
     C     1             DO        2
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGKOL
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGAPP        DTM010
     C   LR              GOTO      ENDUNH
     C                   ENDDO
     C                   ENDDO
      * Hent TOLLSTEDSNAVN
     C                   MOVE      *BLANKS       FE
     C     1             DO        36            NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGPLU        LOC040
     C     TEGN          CABEQ     LOGAPP        LOC040
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     LOC040        TAG
     C                   MOVEL     FELT          XTSN1            35
     C     TEGN          CABEQ     LOGAPP        DTM010
      * Hent TOLLSTEDS LANDKODE
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGKOL        LOC041
     C     TEGN          CABEQ     LOGAPP        LOC041
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     LOC041        TAG
     C                   MOVEL     FELT          XTSLK             2
     C     TEGN          CABEQ     LOGAPP        DTM010
      * Les forbi '::'
     C     1             DO        2
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGKOL
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGAPP        DTM010
     C   LR              GOTO      ENDUNH
     C                   ENDDO
     C                   ENDDO
      * Hent TOLLSTEDS GATEADRESSE OG NR
     C                   MOVE      *BLANKS       FE
     C     1             DO        36            NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGPLU        LOC042
     C     TEGN          CABEQ     LOGAPP        LOC042
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     LOC042        TAG
     C                   MOVEL     FELT          XTSN2            35
     C     TEGN          CABEQ     LOGAPP        DTM010
      * Hent TOLLSTEDS POSTNR
     C                   MOVE      *BLANKS       FE
     C     1             DO        10            NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGKOL        LOC043
     C     TEGN          CABEQ     LOGAPP        LOC043
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     LOC043        TAG
     C                   MOVEL     FELT          XTSPN             9
     C     TEGN          CABEQ     LOGAPP        DTM010
      * Les forbi '::'
     C     1             DO        2
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGKOL
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGAPP        DTM010
     C   LR              GOTO      ENDUNH
     C                   ENDDO
     C                   ENDDO
      * Hent TOLLSTEDS STED
     C                   MOVE      *BLANKS       FE
     C     1             DO        25            NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGPLU        LOC044
     C     TEGN          CABEQ     LOGAPP        LOC044
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     LOC044        TAG
     C                   MOVEL     FELT          XTSPS            24
     C     TEGN          CABEQ     LOGAPP        DTM010
      * Hent TOLLSTEDS SPRÅKKKODE
     C                   MOVE      *BLANKS       FE
     C     1             DO        2             NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGAPP        LOC045
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     LOC045        TAG
     C                   MOVEL     FELT          XTSSK             2
     C                   GOTO      DTM010
      *
     C     NAD010        TAG
      * Les kode
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGPLU        NAD020
     C     TEGN          CABEQ     LOGAPP        DTM010
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     NAD020        TAG
     C                   MOVEL     FELT          XKODE
     C     XKODE         CABNE     'EI '         DTM010
      * Hent KONTROLERT AV
     C                   MOVE      *BLANKS       FE
     C     1             DO        36            NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGPLU        NAD030
     C     TEGN          CABEQ     LOGAPP        NAD030
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     NAD030        TAG
     C                   MOVEL     FELT          XDKAV            35
     C     TEGN          CABEQ     LOGAPP        DTM010
      * Les forbi '++++++'
     C     1             DO        6
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGKOL
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGAPP        DTM010
     C   LR              GOTO      ENDUNH
     C                   ENDDO
     C                   ENDDO
      * Hent KONTROLL RESUTALT SPRÅK
     C                   MOVE      *BLANKS       FE
     C     1             DO        2             NR
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGAPP        NAD040
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     NAD040        TAG
     C                   MOVEL     FELT          XDKSK             2
     C                   GOTO      DTM010
      *
     C     SEL010        TAG
     C                   EXSR      SRSEL
     C   LR              GOTO      ENDUNH
     C                   GOTO      DTM010
      *
     C     PAC010        TAG
      * KUN IE29/IE55/IE60 ER INTERESANT
     C     M1N07         IFNE      '055'
     C                   GOTO      DTM010
     C                   END
     C                   EXSR      SRPAC
     C   LR              GOTO      ENDUNH
     C                   GOTO      DTM010
      *
     C     CNT010        TAG
     C                   EXSR      SRCNT
      *
     C     ENDUNH        TAG
     C                   EXSR      OPDFIL
      *
     C                   ENDSR
     C*__________________________________________________________
     C* SR for å konvertere IE917                         SR917 /
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SR917         BEGSR
      *
     C     ST9171        TAG
     C                   MOVE      *BLANKS       SEGNAM
     C     SEGNAM        DOWNE     'FTX'
     C     SEGNAM        ANDNE     'RFF'
     C     SEGNAM        ANDNE     'UNT'
     C                   EXSR      GETSEG
     C   LR              GOTO      SL917
     C                   END
      *
     C     SEGNAM        IFEQ      'FTX'
     C                   EXSR      SRFTX
     C                   GOTO      ST9171
     C                   END
      *
     C     SEGNAM        IFEQ      'RFF'
      *
     C     TEGN          DOWNE     LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      SL917
     C                   ENDDO
      *
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C   LR              GOTO      SL917
     C     TEGN          CABEQ     LOGKOL        ST9171
     C     TEGN          CABEQ     LOGPLU        ST9171
     C     TEGN          CABEQ     LOGAPP        ST9171
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   IF        ((FELT <> 'ABO') AND (FELT <> 'ABE'))
     C                   GOTO      ST9171
     C                   END
      *
     C     TEGN          DOWNE     LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      SL917
     C                   ENDDO
      *
     C                   IF        FELT = 'ABO'
     C                   MOVE      *BLANKS       FE
     C     1             DO        10            NR
     C                   EXSR      GETCH
     C   LR              GOTO      SL917
     C     TEGN          CABEQ     LOGAPP        ST9172
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     ST9172        TAG
     C                   MOVEL     FELT          XAN10            10
      *
     C     XAN10         CHAIN     EDIS4                              33
     C  N33XSSN          CHAIN     EDIM6                              33
     C                   ELSE
     C                   MOVE      *BLANKS       FE
     C     1             DO        22            NR
     C                   EXSR      GETCH
     C   LR              GOTO      SL917
     C     TEGN          CABEQ     LOGAPP        ST9173
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     ST9173        TAG
     C                   MOVEL     FELT          XAN35            35
      *
     C     XAN35         CHAIN     EDIM5                              33
     C                   END
      *
     C     *IN33         IFEQ      '0'
     C                   MOVE      MAVD          THAVD
     C                   EVAL      THTDN = MTDN
     C                   MOVE      X0068         M0068
     C                   MOVE      X0068A        M0068A
     C                   MOVE      X0068B        M0068B
     C                   MOVE      X1225         M1225
     C                   ELSE
     C                   MOVE      *ZEROS        THAVD
     C                   MOVE      *ZEROS        THTDN
     C                   MOVE      *BLANKS       M1225
     C                   END
     C                   END
      *
     C     SL917         ENDSR
     C*__________________________________________________________
     C* SR for å konvertere FTX-segment                   SRFTX /
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRFTX         BEGSR
      *
      * FTX ER UINTERSANT FOR IE29
     C     M1N07         IFEQ      '029'                                        1<-B
     C                   GOTO      FTX099
     C                   END                                                    1<-E
      * Hent kode
     C                   MOVE      *BLANKS       FE
     C     1             DO        4             NR                             1<-B
     C                   EXSR      GETCH
     C   LR              GOTO      FTX099
     C     TEGN          CABEQ     LOGPLU        FTX020
     C     TEGN          CABEQ     LOGAPP        FTX099
     C                   MOVEL     TEGN          FE(NR)
     C                   END                                                    1<-E
     C     FTX020        TAG
     C                   MOVEL     FELT          XKODE             3
     C     XKODE         IFNE      'ACD'                                        1<-B
     C     XKODE         ANDNE     'ABV'
     C     XKODE         ANDNE     'AAO'
     C     XKODE         ANDNE     'AAP'
     C     XKODE         ANDNE     'ABY'
     C     XKODE         ANDNE     'ABL'
     C     XKODE         ANDNE     'ABQ'
     C     XKODE         ANDNE     'ADO'
     C     XKODE         ANDNE     'DIN'
     C     XKODE         ANDNE     'AUT'
     C                   GOTO      FTX099
     C                   END                                                    1<-E
      * Les forbi '+'
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGPLU                                       1<-B
     C                   EXSR      GETCH
     C   LR              GOTO      FTX099
     C                   ENDDO                                                  1<-E
      *
     C     M1N07         IFEQ      '016'                                        1<-B
     C     XKODE         ANDEQ     'AAO'
     C                   MOVE      *BLANKS       FE
     C     1             DO        2             NR                              2<-B
     C                   EXSR      GETCH
     C   LR              GOTO      FTX099
     C     TEGN          CABEQ     LOGPLU        FTX030
     C     TEGN          CABEQ     LOGAPP        FTX099
     C                   MOVEL     TEGN          FE(NR)
     C                   ENDDO                                                   2<-E
     C     FTX030        TAG
     C                   MOVE      '049'         T2UNIK
     C                   MOVEL     FELT          TKKODE
     C     DKXKD2K       CHAIN     DKXKODL01                          33
     C                   ADD       1             XN
     C  N33              MOVEL     TKTXTN        FT(XN)
     C   33              MOVEL     TKKODE        FT(XN)
     C                   IF        FT(XN)=*BLANKS
     C                   EVAL      FT(XN)='.'
     C                   ENDIF
     C                   END                                                    1<-E
      * AVVIST TRANSITTERING
     C     M1N07         IFEQ      '051'                                        1<-B
     C     XKODE         ANDEQ     'ADO'
      * Feilkode ved garanti
     C     M1N07         OREQ      '055'
     C     XKODE         ANDEQ     'AUT'
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR                              2<-B
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGPLU        FTX040
     C     TEGN          CABEQ     LOGAPP        FTX040
     C   LR              GOTO      FTX099
     C                   MOVEL     TEGN          FE(NR)
     C                   END                                                     2<-E
     C     FTX040        TAG
     C                   MOVEL     FELT          XDKR
     C     M1N07         IFNE      '055'
     C                   GOTO      FTX099
     C                   END
     C                   END                                                    1<-E
      * Les forbi '+'
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGPLU                                       1<-B
     C                   EXSR      GETCH
     C   LR              GOTO      FTX099
     C                   ENDDO                                                  1<-E
      * Hent fritekst
     C     M1N07         IFEQ      '051'                                        1<-B
     C     XKODE         ANDEQ     'ABQ'
     C                   ADD       1             XN
     C                   MOVEL     'INGEN FR'    FT(XN)
     C                   CAT       'IGIVEL':0    FT(XN)
     C                   CAT       'SE FOR':0    FT(XN)
     C                   CAT       'TRANSI':1    FT(XN)
     C                   CAT       'TTERIN':0    FT(XN)
     C                   CAT       'G':0         FT(XN)
     C                   END                                                    1<-E
      *
     C                   MOVE      *ZEROS        XNR               1 0
     C                   MOVE      *BLANKS       XAN70            70
     C     FTX050        TAG
     C                   ADD       1             XNR
     C                   MOVE      *BLANKS       FE
     C     1             DO        100           NR                             1<-B
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGKOL        FTX060
     C     TEGN          CABEQ     LOGPLU        FTX060
     C     TEGN          CABEQ     LOGAPP        FTX060
     C   LR              GOTO      FTX099
     C                   MOVEL     TEGN          FE(NR)
     C                   END                                                    1<-E
      *
     C     FTX060        TAG
     C     FELT          IFNE      *BLANKS                                      1<-B
     C     M1N07         IFEQ      '016'                                         2<-B
     C     XKODE         ANDEQ     'AAO'
     C     XNR           IFLE      3                                              3<-B
     C                   MOVEL     FELT          XAN03             3
     C                   MOVE      '149'         T2UNIK
     C                   MOVE      *BLANKS       TKKODE
     C                   MOVEL     XAN03         TKKODE
     C     DKXKD2K       CHAIN     DKXKODL01                          33
     C                   ADD       1             XN
     C     *IN33         IFEQ      '0'                                             4<-B
     C                   MOVEL     TKTXTN        FT(XN)
     C                   IF        FT(XN)=*BLANKS
     C                   EVAL      FT(XN)='.'
     C                   ENDIF
     C     FE(4)         IFEQ      '('                                              5<-B
     C                   CAT       'POSTNR':1    FT(XN)
     C                   CAT       FE(5):1       FT(XN)
     C                   IF        FE(6) <> ')'
     C                   CAT       FE(6):0       FT(XN)
     C                   IF        FE(7) <> ')'
     C                   CAT       FE(7):0       FT(XN)
     C                   END
     C                   END
     C                   END                                                        5<-E
     C                   ADD       1             XN
      *
      * SJEKK NESTE KODE
     C                   EVAL      XAN03 = *BLANKS
     C     4             DO        100           XN3               3 0
     C                   IF        FE(XN3) = '.'
     C                   LEAVE
     C                   END
     C                   ENDDO
     C                   IF        ((FE(XN3) = '.') AND (XN3 <10))
     C                   ADD       1             XN3
     C                   EVAL      XAN03 = FE(XN3)
     C                   ADD       1             XN3
     C                   CAT       FE(XN3):0     XAN03
     C                   ADD       1             XN3
     C                   CAT       FE(XN3):0     XAN03
     C                   MOVEL     XAN03         TKKODE
     C     DKXKD2K       CHAIN     DKXKODL01                          33
     C   33              SUB       3             XN3
     C                   ELSE
     C                   MOVE      *ON           *IN33
     C                   END
      *
     C                   IF        *IN33                                            5<-B
     C                   IF        FE(XN3) = '.'
     C                   ADD       1             XN3
     C                   MOVEA     FE(XN3)       FT(XN)
     C                   IF        FT(XN)=*BLANKS
     C                   EVAL      FT(XN)='.'
     C                   ENDIF
     C                   END
      *
     C                   ELSE                                                       5
      *
     C                   MOVEL     TKTXTN        FT(XN)
     C                   IF        FT(XN)=*BLANKS
     C                   EVAL      FT(XN)='.'
     C                   ENDIF
     C                   ADD       1             XN3
     C                   IF        FE(XN3) = '('                                     6<-B
     C                   CAT       'POSTNR':1    FT(XN)
     C                   ADD       1             XN3
     C                   CAT       FE(XN3):1     FT(XN)
     C                   ADD       1             XN3
     C                   DOW       FE(XN3) <> ')'                                     7<-B
     C                   CAT       FE(XN3):0     FT(XN)
     C                   ADD       1             XN3
     C                   ENDDO                                                        7<-E
     C                   ADD       1             XN
     C                   MOVEA     FE(XN3)       FT(XN)
     C                   IF        FT(XN)=*BLANKS
     C                   EVAL      FT(XN)='.'
     C                   ENDIF
     C                   END                                                         6<-E
     C                   END                                                        5<-E
      *
     C                   ELSE                                                      4
     C                   MOVEL     FELT          FT(XN)
     C                   END                                                       4<-E
      *
     C                   ELSE                                                     3
      *
     C                   ADD       1             XN
     C                   MOVEL     FELT          XAN04             4
     C                   MOVEL     XAN04         XAN01             1
     C                   MOVE      XAN04         XAN03             3
     C     XAN01         IFEQ      'C'                                             4<-B
     C                   MOVEL     'BETINGEL'    FT(XN)
     C                   CAT       'SE:':0       FT(XN)
     C                   ELSE                                                      4
     C                   MOVEL     'REGEL:'      FT(XN)
     C                   END                                                       4<-E
     C                   CAT       XAN03:1       FT(XN)
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C                   ADD       1             XN
     C                   MOVEL     FELT          FT(XN)
     C                   IF        FT(XN)=*BLANKS
     C                   EVAL      FT(XN)='.'
     C                   ENDIF
     C                   END                                                     2<-E
      *
     C                   END                                                    1<-E
     C     TEGN          CABEQ     LOGKOL        FTX050
      *
     C     FTX099        ENDSR
     C*__________________________________________________________
     C* SR for å konvertere SEL-segment                   SRSEL /
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRSEL         BEGSR
      *
     C     M1N07         IFNE      '029'                                        1<-B
     C                   GOTO      SEL099
     C                   END                                                    1<-E
      * Les forbi ':::'
     C     1             DO        3                                            1<-B
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGKOL                                        2<-B
     C                   EXSR      GETCH
     C   LR              GOTO      SEL099
     C                   ENDDO                                                   2<-E
     C                   ENDDO                                                  1<-E
      * Hent fritekst
     C                   MOVE      *BLANKS       XAN70            70
     C                   MOVE      *BLANKS       FE
     C     1             DO        20            NR                             1<-B
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGAPP        SEL030
     C     TEGN          CABEQ     LOGPLU        SEL030
     C   LR              GOTO      SEL099
     C                   MOVEL     TEGN          FE(NR)
     C                   END                                                    1<-E
     C     SEL030        TAG
     C                   ADD       1             XN5
     C                   MOVEL     FELT          S2(XN5)
      * Hent språkkode
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR                             1<-B
     C                   EXSR      GETCH
     C   LR              GOTO      SEL099
     C     TEGN          CABEQ     LOGAPP        SEL040
     C                   MOVEL     TEGN          FE(NR)
     C                   END                                                    1<-E
     C     SEL040        TAG
     C                   MOVEL     FELT          S1(XN5)
      *
     C     SEL099        ENDSR
     C*__________________________________________________________
     C* SR for å konvertere garanti-segment               SRPAC /
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRPAC         BEGSR
      *
      * Les forbi '+++'
     C     1             DO        3                                            1<-B
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGPLU                                        2<-B
     C                   EXSR      GETCH
     C   LR              GOTO      PAC099
     C                   ENDDO                                                   2<-E
     C                   ENDDO                                                  1<-E
      *
      * Les forbi ':'
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGKOL                                       1<-B
     C                   EXSR      GETCH
     C   LR              GOTO      PAC099
     C                   ENDDO                                                  1<-E
      *
      * Les garantinr
     C                   MOVE      *BLANKS       FE
     C     1             DO        25            NR                             1<-B
     C                   EXSR      GETCH
     C   LR              GOTO      PAC099
     C     TEGN          CABEQ     LOGPLU        PAC020
     C     TEGN          CABEQ     LOGAPP        PAC020
     C                   MOVEL     TEGN          FE(NR)
     C                   END                                                    1<-E
     C     PAC020        TAG
     C                   MOVEL     FELT          XHGFT            35
      *
     C                   MOVE      *BLANKS       SEGNAM
     C* Hent segment for meldingstype
     C     SEGNAM        DOWNE     'FTX'
     C                   EXSR      GETSEG
     C   LR              GOTO      PAC099
     C                   END
      * Hent feilkode og tekster
     C                   EXSR      SRFTX
      *
     C     PAC099        ENDSR
     C*__________________________________________________________
     C* SR for å konvertere CNT-segment                   SRCNT /
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRCNT         BEGSR
      *
     C     M1N07         IFNE      '029'                                        1<-B
     C                   GOTO      CNT099
     C                   END                                                    1<-E
     C     CNT020        TAG
      * Hent kode
     C                   MOVE      *BLANKS       FE
     C     1             DO        4             NR                             1<-B
     C                   EXSR      GETCH
     C   LR              GOTO      CNT099
     C     TEGN          CABEQ     LOGKOL        CNT030
     C     TEGN          CABEQ     LOGAPP        CNT099
     C                   MOVEL     TEGN          FE(NR)
     C                   END                                                    1<-E
     C     CNT030        TAG
     C                   MOVEL     FELT          XAN02             2
     C     XAN02         CABNE     '16'          CNT098
      * Hent antall forseglinger
     C     1             DO        10            NR                             1<-B
     C                   EXSR      GETCH
     C     TEGN          CABEQ     LOGAPP        CNT098
     C   LR              GOTO      CNT099
     C                   MULT      10            XDANT
     C                   MOVE      TEGN          XDANT
     C                   ENDDO                                                  1<-E
     C                   GOTO      CNT099
      *
     C     CNT098        TAG
     C                   EXSR      GETSEG
     C     SEGNAM        CABEQ     'CNT'         CNT020
      *
     C     CNT099        ENDSR
     C*__________________________________________________________
     C* SR for å behandle tjenstemelding CONTRL           SRCTL /
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRCTL         BEGSR
     C                   MOVE      'CTL'         M1N07
     C                   MOVE      'OK '         M1225
     C                   MOVE      MMN           FMN
      * Behandle UCI-segment
     C                   EXSR      SRCTL2
      *
     C     CTL010        TAG
      *
      * Hent segment for meldingstype
     C                   EXSR      GETSEG
     C   LR              GOTO      ENDCTL
      *
     C                   SELECT
     C     SEGNAM        WHENEQ    'UCF'
     C                   EXSR      SRCTL6
     C     SEGNAM        WHENEQ    'UCM'
     C                   EXSR      SRCTL3
     C     SEGNAM        WHENEQ    'UCS'
     C                   EXSR      SRCTL4
     C     SEGNAM        WHENEQ    'UCD'
     C                   EXSR      SRCTL5
     C                   OTHER
     C                   GOTO      ENDCTL
     C                   ENDSL
     C                   MOVE      'ERR'         M1225
     C                   GOTO      CTL010
      *
     C     ENDCTL        TAG
      *
     C                   ENDSR
     C*__________________________________________________________
     C* SR for å behandle UCI OG UCF                     SRCTL2 /
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRCTL2        BEGSR
      *
      * Les referansenr
     C                   MOVE      *BLANKS       FELT
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL299
     C     TEGN          CABEQ     LOGPLU        CTL210
     C     TEGN          CABEQ     LOGAPP        CTL299
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     CTL210        TAG
     C                   ADD       1             FLN
     C                   MOVEL     'Filnamn:'    F0078A
     C                   CAT       FELT:1        F0078A
     C                   MOVEL     FELT          XSMBR
     C     XSMBR         CHAIN     EDIS4                              33
     C     XSSN          CHAIN     EDIM6                              33
     C                   MOVE      MAVD          THAVD
     C                   EVAL      THTDN = MTDN
     C                   MOVE      X0068         M0068
     C                   MOVE      X0068A        M0068A
     C                   MOVE      X0068B        M0068B
      *
      * Les avsenders NODI-id
     C                   MOVE      *BLANKS       FELT
     C     1             DO        35            NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL299
     C     TEGN          CABEQ     LOGKOL        CTL220
     C     TEGN          CABEQ     LOGPLU        CTL220
     C     TEGN          CABEQ     LOGAPP        CTL290
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     CTL220        TAG
     C                   MOVEL     'Avsændare'   F0078B
     C                   CAT       FELT:1        F0078B
      *
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      CTL299
     C                   ENDDO
      *
      * Les mottakers NODI-id
     C                   MOVE      *BLANKS       FELT
     C     1             DO        35            NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL299
     C     TEGN          CABEQ     LOGPLU        CTL230
     C     TEGN          CABEQ     LOGAPP        CTL290
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     CTL230        TAG
     C                   MOVEL     'Mottagare'   F0078C
     C                   CAT       FELT:1        F0078C
      * Les syntaks feil
     C                   MOVE      *BLANKS       FELT
     C     1             DO        4             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL299
     C     TEGN          CABEQ     LOGPLU        CTL240
     C     TEGN          CABEQ     LOGAPP        CTL240
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL240        TAG
     C                   MOVEL     FELT          TKKODE
     C     TKKODE        CABEQ     *BLANKS       CTL290
     C     DKXKODK       CHAIN     DKXKODL01                          33
     C                   MOVEL     TKKODE        F0077
     C  N33              MOVEL     TKTXTE        F0078D
      *
     C     CTL290        TAG
     C                   EXSR      OPDTNF
      *
     C     CTL299        ENDSR
     C*__________________________________________________________
     C* SR for å behandle UCM                            SRCTL3 /
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRCTL3        BEGSR
      *
      * Les referansenr
     C                   MOVE      *BLANKS       FELT
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL399
     C     TEGN          CABEQ     LOGPLU        CTL310
     C     TEGN          CABEQ     LOGAPP        CTL399
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     CTL310        TAG
     C                   ADD       1             FLN
     C                   MOVEL     FELT          F0078A
      *
      * Les meldings identifier
     C     CTL320        TAG
     C                   MOVE      *ZEROS        NR
     C                   MOVE      *BLANKS       FELT
     C     1             DO        15
     C                   EXSR      GETCH
     C   LR              GOTO      CTL399
     C     TEGN          IFEQ      LOGKOL
     C                   ADD       2             NR
     C                   GOTO      CTL320
     C                   END
     C     TEGN          CABEQ     LOGPLU        CTL330
     C     TEGN          CABEQ     LOGAPP        CTL330
     C                   ADD       1             NR
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     CTL330        TAG
     C                   MOVEL     FELT          F0078B
     C     TEGN          CABEQ     LOGAPP        CTL341
      *
      * Les forbi '+'
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      CTL399
     C     TEGN          CABEQ     LOGAPP        CTL341
     C                   END
      *
      * Les syntaks feil
     C                   MOVE      *BLANKS       FELT
     C     1             DO        4             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL399
     C     TEGN          CABEQ     LOGPLU        CTL340
     C     TEGN          CABEQ     LOGAPP        CTL340
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL340        TAG
     C                   MOVEL     FELT          TKKODE
     C     DKXKODK       CHAIN     DKXKODL01                          33
     C                   MOVEL     TKKODE        F0078C
     C  N33              MOVEL     TKTXTE        F0078C
     C     CTL341        TAG
     C                   EXSR      OPDTNF
     C     TEGN          CABEQ     LOGAPP        CTL399
      *
      * Les forbi '+'
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      CTL399
     C     TEGN          CABEQ     LOGAPP        CTL399
     C                   END
      *
      * Les dataelement identifikasjon
     C                   MOVE      *BLANKS       FELT
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL399
     C     TEGN          CABEQ     LOGKOL        CTL350
     C     TEGN          CABEQ     LOGAPP        CTL399
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL350        TAG
     C                   MOVEL     FELT          TKKODE
     C                   ADD       1             FLN
     C     DKXKODK       CHAIN     DKXKODL01                          33
     C                   MOVEL     TKKODE        F0077
     C  N33              MOVE      TKTXTE        F0078A
      *
      * Les posisjon
     C                   MOVE      *BLANKS       FELT
     C     1             DO        6             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL399
     C     TEGN          CABEQ     LOGKOL        CTL351
     C     TEGN          CABEQ     LOGPLU        CTL351
     C     TEGN          CABEQ     LOGAPP        CTL351
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL351        TAG
     C                   MOVEL     'Posisjon'    F0078B
     C                   CAT       FELT:1        F0078B
     C     TEGN          CABEQ     LOGPLU        CTL359
     C     TEGN          CABEQ     LOGAPP        CTL359
      *
      * Les antall feiler
     C                   MOVE      *BLANKS       FELT
     C     1             DO        6
     C                   EXSR      GETCH
     C   LR              GOTO      CTL399
     C     TEGN          CABEQ     LOGPLU        CTL252
     C     TEGN          CABEQ     LOGAPP        CTL252
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL252        TAG
     C                   MOVEL     'Antal   '    XAN16            16
     C                   MOVEL     FELT          XAN06             6
     C                   MOVE      XAN06         XAN16
     C                   MOVEL     XAN16         F0078C
      *
     C     CTL359        TAG
     C                   EXSR      OPDTNF
     C     TEGN          CABEQ     LOGAPP        CTL399
      *
      * Les pakkes referansenr
     C                   MOVE      *BLANKS       FELT
     C     1             DO        36            NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL399
     C     TEGN          CABEQ     LOGPLU        CTL360
     C     TEGN          CABEQ     LOGAPP        CTL360
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL360        TAG
     C     FELT          IFNE      *BLANKS
     C                   ADD       1             FLN
     C                   MOVEL     FELT          F0078A
     C                   EXSR      OPDTNF
     C                   END
     C     TEGN          CABEQ     LOGAPP        CTL399
      *
      * Les referanse identifikasjon
     C     CTL370        TAG
     C                   MOVE      *BLANKS       FELT
     C     1             DO        4             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL399
     C     TEGN          CABEQ     LOGKOL        CTL371
     C     TEGN          CABEQ     LOGPLU        CTL371
     C     TEGN          CABEQ     LOGAPP        CTL371
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL371        TAG
     C                   MOVEL     FELT          TKKODE
     C                   ADD       1             FLN
     C     DKXKODK       CHAIN     DKXKODL01                          33
     C                   MOVEL     TKKODE        F0077
     C  N33              MOVE      TKTXTE        F0078A
     C     TEGN          CABEQ     LOGAPP        CTL379
      *
     C                   MOVE      *BLANKS       FELT
     C     1             DO        36            NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL399
     C     TEGN          CABEQ     LOGPLU        CTL379
     C     TEGN          CABEQ     LOGAPP        CTL379
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL379        TAG
     C                   MOVEL     FELT          F0078B
     C                   EXSR      OPDTNF
     C     TEGN          CABNE     LOGAPP        CTL370
      *
     C     CTL399        ENDSR
     C*__________________________________________________________
     C* SR for å behandle UCS                            SRCTL4 /
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRCTL4        BEGSR
      *
      * Les segment posisjon
     C                   MOVE      *BLANKS       FELT
     C     1             DO        7             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL499
     C     TEGN          CABEQ     LOGPLU        CTL410
     C     TEGN          CABEQ     LOGAPP        CTL410
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     CTL410        TAG
     C                   ADD       1             FLN
     C                   MOVEL     'Position'    F0078A
     C                   CAT       FELT:1        F0078A
     C     TEGN          CABEQ     LOGAPP        CTL490
      *
      * Les syntaks feil
     C                   MOVE      *BLANKS       FELT
     C     1             DO        4             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL499
     C     TEGN          CABEQ     LOGAPP        CTL420
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL420        TAG
     C                   MOVEL     FELT          TKKODE
     C     DKXKODK       CHAIN     DKXKODL01                          33
     C                   MOVEL     FELT          F0078B
     C  N33              MOVE      TKTXTE        F0078B
      *
     C     CTL490        TAG
     C                   EXSR      OPDTNF
      *
     C     CTL499        ENDSR
     C*__________________________________________________________
     C* SR for å behandle UCD                            SRCTL5 /
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRCTL5        BEGSR
      *
      * Les syntaks feil
     C                   MOVE      *BLANKS       FELT
     C     1             DO        4             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL599
     C     TEGN          CABEQ     LOGPLU        CTL510
     C     TEGN          CABEQ     LOGAPP        CTL510
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     CTL510        TAG
     C                   ADD       1             FLN
     C                   MOVEL     FELT          TKKODE
     C     DKXKODK       CHAIN     DKXKODL01                          33
     C                   MOVEL     FELT          F0077
     C  N33              MOVEL     TKTXTE        F0078A
     C     TEGN          CABEQ     LOGAPP        CTL590
      *
      * Les data element posisjon
     C                   MOVE      *BLANKS       FELT
     C     1             DO        4             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL599
     C     TEGN          CABEQ     LOGKOL        CTL520
     C     TEGN          CABEQ     LOGAPP        CTL520
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL520        TAG
     C                   MOVEL     'Position'    F0078B
     C                   CAT       FELT:1        F0078B
     C     TEGN          CABEQ     LOGAPP        CTL590
      *
      * Les data komponent posisjon
     C                   MOVE      *BLANKS       FELT
     C     1             DO        4             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL599
     C     TEGN          CABEQ     LOGAPP        CTL530
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL530        TAG
     C                   MOVEL     FELT          TKKODE
     C     DKXKODK       CHAIN     DKXKODL01                          33
     C                   MOVEL     FELT          F0078C
     C  N33              MOVE      TKTXTE        F0078C
     C     TEGN          CABEQ     LOGAPP        CTL590
      *
      * Les antall elementer
     C                   MOVE      *BLANKS       FELT
     C     1             DO        7             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL599
     C     TEGN          CABEQ     LOGAPP        CTL540
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL540        TAG
     C                   MOVEL     FELT          F0078D
      *
     C     CTL590        TAG
     C                   EXSR      OPDTNF
      *
     C     CTL599        ENDSR
     C*__________________________________________________________
     C* SR for å behandle UCF                            SRCTL6 /
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRCTL6        BEGSR
      *
      * Les referansenr
     C                   MOVE      *BLANKS       FELT
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL699
     C     TEGN          CABEQ     LOGPLU        CTL610
     C     TEGN          CABEQ     LOGAPP        CTL699
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     CTL610        TAG
     C                   ADD       1             FLN
     C                   MOVEL     FELT          F0078A
      *
      * Les forbi 3 '+'
     C     1             DO        3
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      CTL699
     C     TEGN          CABEQ     LOGAPP        CTL690
     C                   END
     C                   END
      * Les syntaks feil
     C                   MOVE      *BLANKS       FELT
     C     1             DO        4             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL699
     C     TEGN          CABEQ     LOGPLU        CTL620
     C     TEGN          CABEQ     LOGAPP        CTL620
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL620        TAG
     C                   MOVEL     FELT          TKKODE
     C     TKKODE        CABEQ     *BLANKS       CTL690
     C     DKXKODK       CHAIN     DKXKODL01                          33
     C                   MOVEL     TKKODE        F0077
     C  N33              MOVEL     TKTXTE        F0078B
     C     TEGN          CABEQ     LOGAPP        CTL690
      * Les forbi '+'.
     C                   MOVE      *BLANKS       TEGN
     C     TEGN          DOWNE     LOGAPP
     C                   EXSR      GETCH
     C   LR              GOTO      CTL699
     C     TEGN          CABEQ     LOGAPP        CTL690
     C                   END
      *
      * Les feilkode
     C                   MOVE      *BLANKS       FELT
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL699
     C     TEGN          CABEQ     LOGKOL        CTL630
     C     TEGN          CABEQ     LOGAPP        CTL630
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL630        TAG
     C                   MOVEL     FELT          TKKODE
     C     DKXKODK       CHAIN     DKXKODL01                          33
     C                   MOVEL     TKKODE        F0078C
     C  N33              MOVE      TKTXTE        F0078C
     C     TEGN          CABEQ     LOGAPP        CTL690
      *
      * Les posisjon
     C                   MOVE      *BLANKS       FELT
     C     1             DO        6             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL699
     C     TEGN          CABEQ     LOGKOL        CTL640
     C     TEGN          CABEQ     LOGAPP        CTL640
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL640        TAG
     C                   MOVEL     'Position'    XAN16            16
     C                   MOVEL     FELT          XAN06             6
     C                   MOVE      XAN06         XAN16
     C                   MOVEL     XAN16         F0078D
     C     TEGN          CABEQ     LOGAPP        CTL690
      *
      * Les antall feiler
     C                   MOVE      *BLANKS       FELT
     C     1             DO        6             NR
     C                   EXSR      GETCH
     C   LR              GOTO      CTL699
     C     TEGN          CABEQ     LOGAPP        CTL650
     C                   MOVE      TEGN          FE(NR)
     C                   END
      *
     C     CTL650        TAG
     C                   MOVEL     'Antall  '    XAN16            16
     C                   MOVEL     FELT          XAN06             6
     C                   MOVE      XAN06         XAN16
     C                   MOVEL     XAN16         F0078E
      *
     C     CTL690        TAG
     C                   EXSR      OPDTNF
      *
     C     CTL699        ENDSR
     C*__________________________________________________________
     C* Oppdater på filer                                OPDFIL /
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     OPDFIL        BEGSR
      *
      * SEND KVITTERING TIL TULLVERKET
     C     KEYM4         SETGT     EDIM4
     C                   MOVE      *ZEROS        UTDN              7
     C     STLES         TAG
     C     KEYM4         READPE    EDIM4                                  33
     C  N33              SELECT
     C                   WHEN      M4_M1225 = '015'
      * KVITTERING PÅ MOTTATT IE016 ELLER IE028 ELLER CONTRL
     C                   MOVE      MAVD          UAVD              4
     C                   MOVE      MTDN          UTDN              7
     C                   CALL      'DKX109R'
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    THSG
     C                   PARM                    M0010
     C                   PARM                    UA0007
     C                   PARM                    UA0008
     C                   PARM                    M0004
     C                   PARM                    UM0007
     C                   PARM                    UM0008
     C                   PARM                    S0020
     C                   PARM                    U0022            14
     C                   PARM                    S0035
     C                   PARM                    M1N07
     C                   WHEN      (((M4_M1225 = '028') AND
     C*                  WHEN      (((M4_M1225 = '029') AND
     C                               (M4_M1N07 = 'C02')) AND
     C                               (M1N07 = '029'))
      * KVITTERING PÅ MOTTATT IE029
     C                   MOVE      MAVD          UAVD              4
     C                   MOVE      MTDN          UTDN              7
     C                   CALL      'DKX109R'
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    THSG
     C                   PARM                    M0010
     C                   PARM                    UA0007
     C                   PARM                    UA0008
     C                   PARM                    M0004
     C                   PARM                    UM0007
     C                   PARM                    UM0008
     C                   PARM                    S0020
     C                   PARM                    U0022
     C                   PARM                    S0035
     C                   PARM                    M1N07
     C                   WHEN      (((M4_M1225 = '029') AND
     C                               (M4_M1N07 = 'C02')) AND
     C                               (M1N07 = '045'))
      * KVITTERING PÅ MOTTATT IE045
     C                   MOVE      MAVD          UAVD              4
     C                   MOVE      MTDN          UTDN              7
     C                   CALL      'DKX109R'
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    THSG
     C                   PARM                    M0010
     C                   PARM                    UA0007
     C                   PARM                    UA0008
     C                   PARM                    M0004
     C                   PARM                    UM0007
     C                   PARM                    UM0008
     C                   PARM                    S0020
     C                   PARM                    U0022
     C                   PARM                    S0035
     C                   PARM                    M1N07
     C                   WHEN      (((M4_M1225 = '028') AND
     C                               (M4_M1N07 = 'C02')) AND
     C                               (M1N07 = '055'))
      * KVITTERING PÅ MOTTATT IE029
     C                   MOVE      MAVD          UAVD              4
     C                   MOVE      MTDN          UTDN              7
     C                   CALL      'DKX109R'
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    THSG
     C                   PARM                    M0010
     C                   PARM                    UA0007
     C                   PARM                    UA0008
     C                   PARM                    M0004
     C                   PARM                    UM0007
     C                   PARM                    UM0008
     C                   PARM                    S0020
     C                   PARM                    U0022
     C                   PARM                    S0035
     C                   PARM                    M1N07
     C                   WHEN      (((M4_M1225 = '055') AND
     C                               (M4_M1N07 = 'C02')) AND
     C                               (M1N07 = '051'))
      * KVITTERING PÅ MOTTATT IE029
     C                   MOVE      MAVD          UAVD              4
     C                   MOVE      MTDN          UTDN              7
     C                   CALL      'DKX109R'
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    THSG
     C                   PARM                    M0010
     C                   PARM                    UA0007
     C                   PARM                    UA0008
     C                   PARM                    M0004
     C                   PARM                    UM0007
     C                   PARM                    UM0008
     C                   PARM                    S0020
     C                   PARM                    U0022
     C                   PARM                    S0035
     C                   PARM                    M1N07
     C                   WHEN      ((M4_M1225 = 'C02') AND
     C                               (M1N07 = 'C02'))
     C                   GOTO      STLES
     C                   WHEN      ((M4_M1225 = 'C01') AND
     C                               (M1N07 = 'C01'))
     C                   GOTO      STLES
     C                   ENDSL
      *
     C   27M1N07         IFNE      '016'                                        Avvist deklarasjon
     C     M1N07         ANDNE     '028'                                        Tildel MRN
     C     M1N07         ANDNE     '917'
     C     DKXERK        SETLL     DKXERR
     C     DKXERK        READE(N)  DKXERR                                 33
     C     *IN33         DOWEQ     '0'
     C     M1N07         IFEQ      TEMF
     C                   LEAVE
     C                   ENDIF
     C     DKXERK        READE(N)  DKXERR                                 33
     C  N33              ENDDO
     C     *IN33         IFEQ      '1'
     C                   MOVE      ' '           TEST
     C                   MOVE      M1N07         TEMF
     C                   MOVE      XTRNR         TETRNR
     C                   MOVE      SLIB          TELIBR
     C                   MOVE      SFILE         TEFILE
     C                   MOVE      SMBR          TEMEMB
     C                   WRITE     DKXERRR
     C                   END
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END
      *
     C*                    MOVELM0068     M3039D
     C     M1N07         IFNE      'CTL'
     C     M1N07         ANDNE     '917'
     C                   MOVE      M1N07         M1225
     C                   END
     C                   WRITE     EDIMR
      *
     C     DKXHKEY       CHAIN     DKXH                               33
      *
      * Tjeneste melding  --> Gogkjent/feil ved inputkontroll
     C     M1N07         IFEQ      'CTL'
     C     M1225         IFEQ      'ERR'
     C                   MOVE      'Å'           THST
     C                   MOVE      WS            THWS
     C                   ELSE
     C                   MOVE      'T'           THST
     C                   END
     C  N33              UPDATE    DKXHR
     C                   END
      * IE45 (Transitt avslutt)
     C     M1N07         IFEQ      '045'                                        Transitt avslutt
     C                   IF        ((THGKD <= 1) OR (THGKD >= 6))
     C                   IF        THGBL > 0
     C     THGFT1        CHAIN     DKXGH                              34
     C                   IF        *IN34 = *OFF
     C                   SUB       THGBL         TGGBLB
     C                   UPDATE    DKXGHR
     C                   END
     C                   END
     C                   END
     C                   MOVE      'Z'           THST
     C                   IF        THGBL > 0
     C                   Z-SUB     THGBL         THGBL
     C                   END
     C  N33              UPDATE    DKXHR
     C                   END
      *
      * IE09 (Kansellering)
      * IE16 (Avvist dekl.)
      * IE51 (Ingen frigivelse)
      * IE62 (Avvsit frigivelse)
     C     M1N07         IFEQ      '009'                                        Kansellering
     C     M1N07         OREQ      '016'                                        Avvist deklarasjon
     C     M1N07         OREQ      '051'                                        Ingen frigivelse
     C     M1N07         OREQ      '055'                                        Ugyldig garanti
     C     M1N07         OREQ      '060'                                        Varekontroll
     C     M1N07         OREQ      '062'                                        Avvist anmodning om
     C     M1N07         OREQ      '917'                                        Feilmelding
     C                   MOVE      MMN           FMN
     C                   MOVE      *ZEROS        FLN
     C                   MOVE      *ZEROS        XN2               3 0
     C     M1N07         IFEQ      '060'                                        Varekontroll
     C                   MOVE      XTRDT         THDDTK
     C                   MOVE      XDATS         THDATS
     C                   MOVEL     'VARUKONT'    F0078A
     C     F0078A        CAT       'TROLL':0     F0078A
     C     F0078A        CAT       'DATUM:':5    F0078A
     C     F0078A        CAT       XTRDTÅ:1      F0078A
     C     F0078A        CAT       '.':0         F0078A
     C     F0078A        CAT       XTRDTM:0      F0078A
     C     F0078A        CAT       '.':0         F0078A
     C     F0078A        CAT       XTRDTD:0      F0078A
     C     F0078A        CAT       'TULL':5      F0078A
     C     F0078A        CAT       'KONT:':0     F0078A
     C     F0078A        CAT       XDATS:1       F0078A
     C                   EXSR      OPDTNF
     C                   ELSE
     C     M1N07         IFEQ      '055'                                        Ugyldig garanti
     C                   MOVE      M1N07         F0077
     C                   MOVEL     'TOLLKONT:'   F0078A
     C                   CAT       XDATS:1       F0078A
     C                   CAT       'GARANTINR:':5F0078A
     C                   CAT       XHGFT:1       F0078A
     C                   MOVEL     'FELKOD:'     F0078B
     C                   CAT       XDKR:1        F0078B
     C                   CAT       'NU ÆR KL.':10F0078B
     C                   MOVEL     WTID          XAN02
     C                   CAT       XAN02:1       F0078B
     C                   MOVE      WTID          XAN04
     C                   MOVEL     XAN04         XAN02
     C                   CAT       ':':0         F0078B
     C                   CAT       XAN02:0       F0078B
     C                   CAT       'VÆNTA 15':10 F0078B
     C                   CAT       'MIN.':1      F0078B
     C                   EVAL      TKKODE = XDKR
     C     DKXKD3K       CHAIN     DKXKODL01                          33
     C                   EVAL      F0078C = TKTXTN
     C                   IF        TKTXTE <> '.'
     C                   CAT       TKTXTE:1      F0078C
     C                   END
     C                   EXSR      OPDTNF
     C                   END
     C     XN            DIV       5             XN
     C                   ADD       1             XN
     C     1             DO        XN
     C                   ADD       1             XN2
     C     FT(XN2)       IFEQ      *BLANKS
     C                   LEAVE
     C                   ELSE
     C                   ADD       1             FLN
     C                   MOVE      M1N07         F0077
     C                   MOVE      FT(XN2)       F0078A
     C                   ADD       1             XN2
     C                   MOVE      FT(XN2)       F0078B
     C                   ADD       1             XN2
     C                   MOVE      FT(XN2)       F0078C
     C                   ADD       1             XN2
     C                   MOVE      FT(XN2)       F0078D
     C                   ADD       1             XN2
     C                   MOVE      FT(XN2)       F0078E
     C                   EXSR      OPDTNF
     C                   END
     C                   ENDDO
     C     M1N07         IFEQ      '009'
     C                   ADD       1             FLN
     C                   MOVE      M1N07         F0077
     C                   MOVE      *BLANKS       F0078A
     C                   MOVE      *BLANKS       F0078B
     C                   MOVE      *BLANKS       F0078C
     C                   MOVE      *BLANKS       F0078D
     C                   MOVE      *BLANKS       F0078E
     C                   MOVEL     'KANSELLE'    F0078A
     C                   CAT       'RING':0      F0078A
     C     XGIS1         IFEQ      '0'
     C                   CAT       'AVSLAG':1    F0078A
     C                   CAT       'EN AV':0     F0078A
     C                   ELSE
     C                   CAT       'GODKÆN':1    F0078A
     C                   CAT       'D AV':0      F0078A
     C                   IF        ((THGKD <= 1) OR (THGKD >= 6))
     C                   IF        THGBL > 0
     C     THGFT1        CHAIN     DKXGH                              33
     C                   IF        *IN33 = *OFF
     C                   SUB       THGBL         TGGBLB
     C                   UPDATE    DKXGHR
     C                   Z-SUB     THGBL         THGBL
     C                   END
     C                   END
     C                   END
     C                   END
     C                   CAT       'TULLVE':1    F0078A
     C                   CAT       'RKET':0      F0078A
     C                   EXSR      OPDTNF
     C                   END
     C                   END
      *
     C     M1N07         IFEQ      '009'
     C     XGIS2         IFEQ      '1'
     C                   MOVE      '1'           TH0035
     C                   ELSE
     C                   MOVE      XGIS1         TH0035
     C                   END
     C                   ELSE
     C                   MOVE      *BLANKS       TH0035
     C                   END
      *
     C     M1N07         IFEQ      '051'
     C     XDKR          IFNE      *BLANKS
     C                   MOVEL     XDKR          THDKR
     C                   END
     C     XDDTK         IFNE      0
     C                   MOVE      XDDTK         THDDTK
     C                   END
      *
     C                   IF        ((THGKD <= 1) OR (THGKD >= 6))
     C                   IF        THGBL > 0
     C     THGFT1        CHAIN     DKXGH                              33
     C                   IF        *IN33 = *OFF
     C                   SUB       THGBL         TGGBLB
     C                   UPDATE    DKXGHR
     C                   Z-SUB     THGBL         THGBL
     C                   END
     C                   END
     C                   END
      *
     C                   END
     C     M1N07         IFEQ      '055'                                        Ugyldig garanti
     C                   MOVE      THST          THKDV
N01  C                   MOVE      *BLANKS       THTUID
     C                   END
     C                   MOVE      'Å'           THST
     C                   MOVE      WS            THWS
     C  N33              UPDATE    DKXHR
     C                   END
      *
     C     M1N07         IFEQ      '028'                                        Tildel MRN
     C     THENKL        IFEQ      'J'
     C                   MOVE      'U'           THST
     C                   ELSE
      * FORHÅNDSVARSLING
     C                   IF        THDK = 'SS'
     C                   MOVE      ' '           XTYPE             1
     C                   MOVE      THAVD         UAVD
     C                   MOVE      THTDN         UTDN
     C                   CALL      'DKX008R'
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    XTRNR
     C                   PARM                    XTYPE
     C                   MOVE      'U'           THST
     C                   ELSE
     C                   MOVE      'K'           THST
     C                   MOVE      'J'           THPKL
     C                   MOVE      WS            THWS
     C                   END
     C                   END
     C                   MOVE      XTRNR         THTRNR
     C                   MOVE      XTRDT         THTRDT
     C                   EXCEPT    DKXHUT
     C     DKXERK        SETLL     DKXERR
     C     DKXERK        READE     DKXERR                                 33
     C     *IN33         DOWEQ     '0'
     C                   CALL      'DKX107C'
     C                   PARM                    TELIBR
     C                   PARM                    TEFILE
     C                   PARM                    TEMEMB
     C                   MOVE      'O'           TEST
     C                   UPDATE    DKXERRR
     C     DKXERK        READE     DKXERR                                 33
     C  N33              ENDDO
     C     HEADFK        CHAIN     HEADF                              33
     C     *IN33         IFEQ      '0'
     C                   MOVE      THAVD         FSAVD
     C                   MOVE      THTDN         FSOPD
     C                   MOVE      'TET'         FSKODE
     C                   MOVEL     XTRNR         FSSOK
     C                   MOVE      HEDTOP        FSDTOP
     C     FRIKEY        CHAIN     FRISOK                             33
     C                   IF        *IN33
     C     FSKODE        CHAIN     KODFRI                             33
     C  N33              MOVE      KFSODK        FSDOKK
     C   33              MOVE      *BLANKS       FSDOKK
     C                   WRITE     FRISOKR
     C                   END
     C                   END
     C                   END
      *
     C     M1N07         IFEQ      '029'                                        Frigivelse
     C     THENKL        IFEQ      'J'
     C                   MOVE      'K'           THST
     C                   MOVE      'J'           THPKL
     C                   MOVE      WS            THWS
     C                   ELSE
     C                   MOVE      'P'           THST
     C                   END
     C                   MOVE      XDDT          THDDT
     C                   MOVE      XDDTK         THDDTK
     C                   MOVE      XDATS         THDATS
     C                   MOVE      XDKAV         THDKAV
     C                   MOVE      XDKSK         THDKSK
     C                   MOVE      XTSSD         THTSSD
     C                   MOVE      XTSN1         THTSN1
     C                   MOVE      XTSN2         THTSN2
     C                   MOVE      XTSPN         THTSPN
     C                   MOVE      XTSPS         THTSPS
     C                   MOVE      XTSLK         THTSLK
     C                   MOVE      XTSSK         THTSSK
     C                   MOVE      XGIS2         THTET
     C                   MOVE      XOMD          THOMD
     C                   MOVE      XBIND         THBIND
     C     XN5           IFGT      0
     C                   MOVE      S1(1)         THDFSK
     C                   MOVE      S2(1)         THDFKD
     C                   Z-ADD     XDANT         THDANT
     C     DKXHKEY       SETLL     DKXHFS
     C     DKXHKEY       READE     DKXHFS                                 33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    DKXHFSR
     C     DKXHKEY       READE     DKXHFS                                 33
     C  N33              ENDDO
     C     2             DO        XN5           XN
     C                   MOVE      THAVD         TFAVD
     C                   MOVE      THTDN         TFTDN
     C                   MOVE      S1(XN)        TFDFSK
     C                   MOVE      S2(XN)        TFDFKD
     C                   WRITE     DKXHFSR
     C                   ENDDO
     C                   END
     C                   EXCEPT    DKXHUT
     C                   END
      *
     C     M1N07         IFEQ      '009'                                        Kansellering
     C     DKXHKEY       CHAIN     DKXHK                              33
     C                   MOVE      XTRDT         TKDTA
     C                   MOVE      XGIS1         TKKD1A
     C                   MOVE      XGIS2         TKKD2A
     C                   MOVE      FT(1)         TKFT1A
     C                   MOVE      FT(2)         TKFT2A
     C                   MOVE      FT(3)         TKFT3A
     C                   MOVE      FT(4)         TKFT4A
     C                   MOVE      FT(5)         TKFT5A
     C     *IN33         IFEQ      '1'
     C                   MOVE      THAVD         TKAVD
     C                   MOVE      THTDN         TKTDN
     C                   WRITE     DKXHKR
     C                   ELSE
     C                   UPDATE    DKXHKR
     C                   END
     C                   END
      *
     C     M1N07         IFEQ      '062'                                        Avvist anmodning om
     C     DKXHKEY       CHAIN     DKXHFR                             33
     C                   MOVE      XTRDT         TFDTA
     C                   MOVE      FT(1)         TFFT1A
     C                   MOVE      FT(2)         TFFT2A
     C                   MOVE      FT(3)         TFFT3A
     C                   MOVE      FT(4)         TFFT4A
     C                   MOVE      FT(5)         TFFT5A
     C                   UPDATE    DKXHFRR
     C                   END
      *
     C     M1N07         IFEQ      '009'                                        Kansellering
     C     M1N07         OREQ      '016'                                        Avvist deklarasjon
     C     M1N07         OREQ      '028'                                        Tildel MRN
     C     M1N07         OREQ      '029'                                        Frigivelse
     C     M1N07         OREQ      '045'                                        Transitt avslutt
     C     M1N07         OREQ      '051'                                        Ingen frigivelse
     C     M1N07         OREQ      '055'                                        Feil ved garanti
     C     M1N07         OREQ      '917'                                        Feilmelding
     C                   EXSR      TTSR
     C                   END
      *
     C                   ENDSR
     C***********************************************
     C     TTSR          BEGSR
     C***********************************************
     C                   MOVE      THAVD         TTAVD
     C                   MOVE      THTDN         TTOPD
     C                   MOVE      M1N07         TTACTI
     C                   MOVEL     'T'           TTACTI
     C                   CALL      'SYGE15C'
     C                   PARM                    ULDT              8
     C                   PARM                    XULTM             6
     C                   MOVE      ULDT          TTDATE
     C                   MOVE      XULTM         TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
     C                   MOVEL     'SY400USR'    TTUSER
     C                   MOVEL     'Accept c'    XXTEXT           16
     C                   MOVE      'ustoms  '    XXTEXT
     C                   MOVEL     XXTEXT        XXTEXB           20
     C                   MOVE      'TET'         XXTEXB           20
     C                   MOVEL     XXTEXB        TTTEXT
     C                   MOVEL     THTRDT        XXTEX2           27
     C                   MOVE      THTRNR        XXTEX2
     C                   MOVE      XXTEX2        TTTEXT
N02  C                   MOVEL     'Godkænd'     XXTEXT           16
n02  C                   MOVE      'tullnr  '    XXTEXT
n02  C                   MOVEL     XXTEXT        XXTEXB           20
n02  C                   MOVE      'TET'         XXTEXB           20
n02  C                   MOVEL     XXTEXB        TTTEXL
n02  C                   MOVEL     THTRDT        XXTEX2           27
n02  C                   MOVE      THTRNR        XXTEX2
n02  C                   MOVE      XXTEX2        TTTEXL
     C                   WRITE     TRACKFR
      *
     C                   ENDSR
     C***********************************************
     C     OPDTNF        BEGSR
     C***********************************************
     C                   MOVE      'JA'          F4815
     C                   WRITE     TVINFF
     C                   MOVE      *BLANKS       F0077
     C                   MOVE      *BLANKS       F0078A
     C                   MOVE      *BLANKS       F0078B
     C                   MOVE      *BLANKS       F0078C
     C                   MOVE      *BLANKS       F0078D
     C                   MOVE      *BLANKS       F0078E
      *
     C                   ENDSR
     ODKXHR     E            DKXHUT
     O                       THST
     O                       THTRNR
     O                       THTRDT
     O                       THWS
     O                       THPKL
     O                       THDDT
     O                       THDFKD
     O                       THDFSK
     O                       THDANT
     O                       THDDTK
     O                       THDATS
     O                       THDKAV
     O                       THDKSK
     O                       THTSSD
     O                       THTSN1
     O                       THTSN2
     O                       THTSPN
     O                       THTSPS
     O                       THTSLK
     O                       THTSSK
     O                       THTET
     O                       TH0035
