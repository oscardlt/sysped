      *********************************************************************
      * ARBEID MED ISO-SAK
      * PROGRAM BEHANDLER INPUT FRA EISO12
      *
CRTPG+*  CRTPGM SYSPED/EISO12 MODULE(*LIBL/EISO12
CRTPGM*        *LIBL/CHECKUSR *LIBL/INCGI) ACTGRP(CGI) AUT(*USE)
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 BIAKT=L ER ENDRET TIL ≈ TESTE AUTORISASJON
10XXX * 02 YBC PTF10 OPPDATER KUNDENR TIL FAKTURA
10XXX * 03 YBC PTF10 POSTTYPE FÿR ENME-TEKST
10XXX * 04 YBC PTF10 OPPDATER KREHF HVIS BILAG IKKE I KRESF
10XXX * 05 YBC PTF10 VIS TRACK & TRACE
10XXX * 06 YBC PTF10 OPPDATER TRACK & TRACE VED ENDRING AV "≈RSAK"/"TILTAK"
10XXX * 07 YBC PTF10 BRPARF SKAL IKKE HA OPPDATERINGS MULIGHET
10035 * 08 YBC PTF10 MYE ENDRINGER. SE PTF-REGISTER
10190 * 09 YBC PTF10 KUN VISE BRUKER-ID MED SAMME FIRMAKODE
10XXX * 10 YBC PTF10 HENT FAKTURA/KREDINOTA SOM TILHÿRER AKTUELL OPPDRAG
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
12203 * 11 YBC PTF12 Test vekt og kubikk
********************************************************************
      *
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
      * Boats for sale data base file (LF on BOATSALE by boat serial number)
     FBRIDF     UF   E           K DISK    USROPN
S07  F*BRPARF    UF   E           K DISK    USROPN
N07  FBRPARF    IF   E           K DISK    USROPN
     FISOFL1    IF   E           K DISK    USROPN
     F                                     RENAME(ISOFR:ISOFR1)
     F                                     PREFIX(I1_)
     FISOFL7    IF   E           K DISK    USROPN
     F                                     RENAME(ISOFR:ISOFR7)
     F                                     PREFIX(I7_)
     FISOFL8    UF A E           K DISK    USROPN
     FISOSAKF   UF A E           K DISK    USROPN
     FTELLGE    UF A E           K DISK    USROPN
     FISOLOGF   O  A E             DISK    USROPN
N05  FISOLOGL1  IF   E           K DISK    USROPN
N05  F                                     RENAME(ISOLOGFR:ISOLOGFR1)
     FKODTA     IF   E           K DISK    USROPN
     FFAIN      IF   E           K DISK    USROPN
     FFAK9      IF   E           K DISK    USROPN
     FHEADF     IF   E           K DISK    USROPN
     FTURER14   IF   E           K DISK    USROPN
     FTRAN      IF   E           K DISK    USROPN
     FCUNDL01   IF   E           K DISK    USROPN
     FDISP      IF   E           K DISK    USROPN
     F*UNITL01   IF   E           K DISK    USROPN
     FISOKDA    IF   E           K DISK    USROPN
     FISOKDT    IF   E           K DISK    USROPN
     FISOKDP    IF   E           K DISK    USROPN
     FISOKDP1   IF   E           K DISK    USROPN
     F                                     RENAME(ISKDPR:ISKDPR1)
     FISOKDR    IF   E           K DISK    USROPN
     FISOKDS    IF   E           K DISK    USROPN
N08  FISOKDM    IF   E           K DISK    USROPN
     FVALUL01   IF   E           K DISK    USROPN
     FKOFAST    IF   E           K DISK    USROPN
     FKODTFT    IF   E           K DISK    USROPN
     FARKIVL06  IF   E           K DISK    USROPN
     FTRACKL01  IF   E           K DISK    USROPN
     FKRESL13   UF   E           K DISK    USROPN
N04  FKREHL05   UF   E           K DISK    USROPN
N04  F                                     RENAME(KRESR:KREHR05)
      *--------------------------------------------------------------------
      * Prototype definitions and standard system API error structure
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      * Variables common to CGI programs
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
      * VARIABLES SPECIFIC TO THIS PROGRAM
      *--------------------------------------------------------------------
      * Variables received from the input string
N05  D OddEven         s             10
     D SubmPressed     s              1
     D lng             s              2
     D BckGnd          s             10
     D UsrSpcName      s             10
     D WSUSER          S             10
     D WSNA            S             30
     D XXENDRE         S              1
     D XXNY            S              1
     D WSSAKN          S              7
     D BSSAKN          S              7  0
     D WSFRDA          S             10
     D BSFRDA          S              8  0
     D WSSDT           S             10
     D BSSDT           S              8  0
     D WSFTUN          S              8
     D BSFTUN          S              8  0
     D WSKNA           S              8
     D BSKNA           S              8  0
N08  D WSKP            S             30
N08  D WSKPEM          S             50
N08  D WSKPEMS         S              1
     D WSFAVD          S              4
     D BSFAVD          S              4  0
N08  D XTRAVD1         S              4  0
N08  D XTRAVD2         S              4  0
     D WSFOPD          S              7
     D BSFOPD          S              7  0
N08  D XTROPD1         S              7  0
N08  D XTROPD2         S              7  0
     D WSFN            S              7
     D BSFN            S              7  0
     D WSSTPU          S              1
     D WSNYFN          S              7
     D BSNYFN          S              7  0
     D WSKRNO          S              7
     D BSKRNO          S              7  0
     D WSFNIN          S             17
     D WSFINV          S             30
     D WSFTRF          S              8
     D BSFTRF          S              8  0
     D WSFBIL          S             10
     D WSFADA          S             10
     D BSFADA          S              8  0
     D WSFADK          S              5
     D BSFADK          S              4  0
     D WSFAND          S             10
     D BSFAND          S              8  0
     D WSFANK          S              5
     D BSFANK          S              4  0
     D WSFPFO          S              5
     D WSRTYP          S              2
     D WSFAVA          S              5
     D WSFANS          S              5
     D WSFSKL          S              7
     D BSFSKL          S              7  0
     D WSFSKG          S              9
     D BSFSKG          S              9  0
     D WSFSLM          S              5
S11  D*BSFSLM          S              4  2
N11  D BSFSLM          S              7  2
     D WSFSM3          S              8
S11  D*BSFSM3          S              7  3
N11  D BSFSM3          S             11  3
     D WSFMDA          S             10
     D BSFMDA          S              8  0
     D WSFMKL          S              5
     D BSFMKL          S              4  0
     D WSFLDA          S             10
     D BSFLDA          S              8  0
     D WSFLKL          S              5
     D BSFLKL          S              4  0
     D WSFAV1          S             75
     D WSFAV2          S             75
     D WSFAV3          S             75
N06  D FAV             S             75    DIM(3)
     D WSFKO1          S             75
     D WSFKO2          S             75
     D WSFKO3          S             75
     D WSFKO4          S             75
N06  D FKO             S             75    DIM(4)
     D WSFGDA          S             10
     D BSFGDA          S              8  0
     D WSFGSI          S             10
     D WSFFDA          S             10
     D BSFFDA          S              8  0
     D WSFFSI          S             10
     D WSFUDA          S             10
     D BSFUDA          S              8  0
     D WSFUSI          S             10
     D WSVAL           S              3
     D WSKRAU          S             10
     D BSKRAU          S              9  2
     D BSKRAV          S              9  2
     D WSFORV          S             10
     D BSFORV          S              9  2
     D WSFKOS          S             10
     D BSFKOS          S              9  2
     D BSINT           S              9  2
     D BSRES           S              9  2
     D WSKTR           S              1
     D WSST            S              1
     D WSUSRS          S             10
     D WSUSRR          S             10
N08  D WSKDMT          S              5
     D WSTINFO         S              1
     D WSLEDET1        S             15
     D WSLEDET2        S             15
     D WSLEDET3        S             15
     D WSLEDET4        S             15
     D WKKEY           S            512
      *
     D BSFAVS          S              8  0
     D BSFMOT          S              8  0
     D WSFOPT          S              2
     D BSFTUA          S              4  0
     D WSFFLA          S              2
     D WSFTLA          S              2
     D WSFHEN          S             10
     D BSFS1N          S              8  0
     D WSFS1T          S             30
     D BSFS2N          S              8  0
     D WSFS2T          S             30
      *Array for fri-tekster
     D TX              S             70    DIM(10)
     D PGM             C                   CONST('SYSPED/CHECKUSR')
      * Variables used to load the external html source member
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
      * FOR KORT STRENG, 120->200  INGEN MERKING.
     D                 DS
     D  updf1                  1    400
     D  updf2                401    800
     D  updf3                801   1200
     D  updf4               1201   1600
     D  updf5               1601   2000
     D  updf6               2001   2400
     D  updf7               2401   2800
     D  updf8               2801   3200
     D  updf9               3201   3600
     D  updf10              3601   4000
     D  updf11              4001   4400
     D  updf12              4401   4800
     D  updf13              4801   5200
     D  updf14              5201   5600
     D  updf15              5601   6000
     D  updf16              6001   6400
     D  updf17              6401   6800
     D  updf18              6801   7200
     D  updf19              7201   7600
     D  updf20              7601   8000
     D  updf21              8001   8400
     D  updf22              8401   8800
     D  updf23              8801   9200
     D  updf24              9201   9600
     D  updf25              9601  10000
     D  updf26             10001  10400
     D  updf27             10401  10800
     D  updf28             10801  11200
     D  updf29             11201  11600
     D  updf30             11601  12000
     D  updf31             12001  12400
     D  updf32             12401  12800
     D  updf33             12801  13200
     D  updf34             13201  13600
     D  updf35             13601  14000
     D  updf36             14001  14400
     D  updf37             14401  14800
     D  updf38             14801  15200
     D  updf39             15201  15600
     D  updf40             15601  16000
     D  updf                   1  16000    DIM(40)
      *
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
     D FMELDNR         S              2
     D FEILMELDING     S             80

     D                 DS
     D WSDT≈≈                  1      4
     D WSDTMM                  5      6
     D WSDTDD                  7      8
     D WSDT                    1      8
N04  D                 DS
N04  D FACC                    1      2  0
N04  D FA≈R                    3      4  0
N04  D REGNSKAPAR              1      4  0
N04  D                 DS
N04  D DA3AAR                  1      4  0
N04  D DA3MND                  5      6  0
N04  D DA3DAG                  7      8  0
N04  D REKSTRDT                1      8  0
N04  D                 DS
N04  D DA4AAR                  1      4  0
N04  D DA4MND                  5      6  0
N04  D DA4DAG                  7      8  0
N04  D REKSLTDT                1      8  0
      *
     D FEIL01          C                   CONST('Oppgitt turnr er ugyldig.')
     D FEIL02          C                   CONST('Oppgitt avdeling er ugyldig.')
     D FEIL03          C                   CONST('Oppgitt oppdragsnr er -
     D                                     ugyldig.')
     D FEIL04          C                   CONST('Oppgitt fakturanr er -
     D                                     ugyldig.')
     D FEIL05          C                   CONST('Oppgitt transport¯rnr er -
     D                                     ugyldig.')
     D FEIL06          C                   CONST('Oppgitt avgangsdato er -
     D                                     ugyldig (ÂÂÂÂmmdd).')
     D FEIL07          C                   CONST('Oppgitt avgangstid er -
     D                                     ugyldig.')
     D FEIL08          C                   CONST('Oppgitt ankomstdato er -
     D                                     ugyldig (ÂÂÂÂmmdd).')
     D FEIL09          C                   CONST('Oppgitt ankomsttid er -
     D                                     ugyldig.')
     D FEIL10          C                   CONST('Posttype mÂ velges.')
     D FEIL11          C                   CONST('Avvikets art mÂ velges.')
     D FEIL12          C                   CONST('Ansvarlig part mÂ velges.')
     D FEIL13          C                   CONST('Oppgitt mottaksdato er -
     D                                     ugyldig (ÂÂÂÂmmdd).')
     D FEIL14          C                   CONST('Oppgitt mottakstid er -
     D                                     ugyldig.')
     D FEIL15          C                   CONST('Oppgitt leveringsdato er -
     D                                     ugyldig (ÂÂÂÂmmdd).')
     D FEIL16          C                   CONST('Oppgitt leveringstid er -
     D                                     ugyldig.')
     D FEIL17          C                   CONST('Beksrivelse av avvik mÂ -
     D                                     oppgis.')
     D FEIL18          C                   CONST('Dato for tiltak godkjent -
     D                                     er ugyldig (ÂÂÂÂmmdd).')
     D FEIL19          C                   CONST('Dato for tiltak frist -
     D                                     er ugyldig (ÂÂÂÂmmdd).')
     D FEIL20          C                   CONST('Dato for tiltak utf¯rt -
     D                                     er ugyldig (ÂÂÂÂmmdd).')
     D FEIL21          C                   CONST('Bruker-id er ugyldig.')
     D FEIL22          C                   CONST('Valutakode er ugyldig.')
     D FEIL23          C                   CONST('Oppgitt kreditnota er -
     D                                     ugyldig.')
     D FEIL24          C                   CONST('Anmeldersnr er ugyldig.')
     D FEIL25          C                   CONST('Navn til innsender mÂ -
     D                                     oppgis.')
     D FEIL26          C                   CONST('Oppgitt saksdato er -
     D                                     ugyldig (ÂÂÂÂmmdd).')
     D FEIL27          C                   CONST('Dato/signatur til "sak -
     D                                     behandlet mÂ oppgis.')
     D FEIL28          C                   CONST('Oppgitt nytt fakturanr er -
     D                                     ugyldig.')
     D FEIL29          C                   CONST('Mangler kreditnota. Har du-
     D                                      kontrollert?')
N08  D FEIL30          C                   CONST('Anmeld og kontaktperson kan-
N08  D                                      ikke vÊre blank sammentidig.')
N08  D FEIL31          C                   CONST('E-postadr. til kontakt person-
N08  D                                      er ugyldig.')
N11  D FEIL32          C                   CONST('Lastemeter for stor. Max 99,9-
N11  D                                     9.')
N11  D FEIL33          C                   CONST('Kubikkmeter for stor. Max 999-
N11  D                                     9,999.')
      * For xlate mellom Upper Case og Lower Case
     D UC              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZ∆ÿ≈')
     D LC              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzÊ¯Â')
     D                 DS
      *
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================
      * MAIN PROCESSING LINE
      *=====================================================================
      * Parse input string
     C                   exsr      Parse
      *
     C                   EXSR      INIT
      *
      * Hvis f¯rste kall OG en...
     c     SubmPressed   IFNE      'Y'
     C     XXENDRE       ANDEQ     ' '
     c     BSSAKN        IFNE      0
      *      kommer inn med n¯kkel - hent data fra fil, klar for vedlikehold
     c                   exsr      GetData
     C                   MOVE      'N'           XXNY
     c                   else
      *      kommer inn uten n¯kkel - Blankt bilde, klar for ny post
     c                   exsr      GetDft
     C                   MOVE      'Y'           XXNY
     c                   end
     C                   ELSE
     C                   IF        XXENDRE = 'S'
     C     BSSAKN        CHAIN(N)  ISOFL8                             33
     C                   IF        *IN33 = *OFF
     C                   MOVE      ISKRAV        BSKRAV
     C                   MOVE      ISINT         BSINT
     C                   END
     C                   END
     c                   end
      *
      * Avslutt = V - "passiv vis bilde pÂ ny" etter Âpning/lukking felt..
     c     AVSLUTT       IFEQ      'V'
     c                   move      ' '           AVSLUTT
     C                   else
      *Om en har tastet submit fra vedlikeholdsbilde, test evt lagre/avslutt
      * (Test-sr setter AVSLUTT=Y hvis feilfritt -> automatisk close...)
     c     SubmPressed   IFEQ      'Y'
     C     XXENDRE       OREQ      'Y'
     C                   EXSR      TESTB
     c                   end
     C                   end
      *
     C     AVSLUTT       IFEQ      'Y'
     C     AVSLUTT       OREQ      'J'
     C                   EXSR      OPDORDRE
     C                   End
      *
      * Vis skjermbidet pÂ ny
      * (hvis AVSLUTT=Y sÂ autocloses vinduet umiddelbart ved load..)
      * Set output skeleton html member name
     C                   exsr      SetSkl
      * Read skeleton output html into core
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
      * Issue html section /$top
     C                   exsr      SetTop
     C                   EXSR      HENTDOK
     C                   callp     wrtsection('top')
      *
     C                   exsr      DSPPT
     C                   exsr      DSPAV
     C                   exsr      DSPRE
     C                   exsr      DSPAP
     C                   exsr      DSPST
     C                   exsr      DSPUSR
N08  C                   exsr      DSPMT
N05  C                   EXSR      DSPTT
     C                   callp     wrtsection('BUNN')

      *
     C                   exsr      SetEnd
     C                   callp     wrtsection('end')
      *
      * Send output buffer and quit
     C     SLUTT         TAG
     C                   exsr      Exit
      *
      *
      *
      *=====================================================================
      * Parse input string
      *=====================================================================
     C     Parse         begsr
     C                   eval      SubmPressed = zhbgetvar('SubmPressed')
     C                   eval      lng     = zhbgetvar('lng')
     C                   eval      BckGnd  = zhbgetvar('bckgnd')

     C                   eval      WSUSER  = zhbgetvar('USER')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   EVAL      XXENDRE = zhbgetvar('XENDRE')
     C                   eval      WSNA    = zhbgetvar('WSNA')
     C                   eval      XXNY    = zhbgetvar('XXNY')
     C                   EVAL      WKKEY   = zhbgetvar('WKEY')
      *
     C                   eval      WSSAKN  = zhbgetvar('WSSAKN')
     C                   eval      BSSAKN  = c2n2(WSSAKN)
     C                   eval      WSFRDA  = zhbgetvar('WSFRDA')
     C                   eval      BSFRDA  = c2n2(WSFRDA)
     C                   eval      WSSDT   = zhbgetvar('WSSDT')
     C                   eval      BSSDT   = c2n2(WSSDT)
     C                   eval      WSFTUN  = zhbgetvar('WSFTUN')
     C                   eval      BSFTUN  = c2n2(WSFTUN)
     C                   eval      WSKNA   = zhbgetvar('WSKNA')
     C                   eval      BSKNA   = c2n2(WSKNA)
N08  C                   eval      WSKP    = zhbgetvar('WSKP')
N08  C                   eval      WSKPEM  = zhbgetvar('WSKPEM')
N08  C                   eval      WSKPEMS = zhbgetvar('WSKPEMS')
N08  C     LC:UC         XLATE     WSKPEMS       WSKPEMS
     C                   eval      WSFAVD  = zhbgetvar('WSFAVD')
     C                   eval      BSFAVD  = c2n2(WSFAVD)
     C                   eval      WSFOPD  = zhbgetvar('WSFOPD')
     C                   eval      BSFOPD  = c2n2(WSFOPD)
     C                   eval      WSFN    = zhbgetvar('WSFN')
     C                   eval      BSFN    = c2n2(WSFN)
     C                   eval      WSSTPU  = zhbgetvar('WSSTPU')
N04  C     LC:UC         XLATE     WSSTPU        WSSTPU
     C                   eval      WSNYFN  = zhbgetvar('WSNYFN')
     C                   eval      BSNYFN  = c2n2(WSNYFN)
     C                   eval      WSKRNO  = zhbgetvar('WSKRNO')
     C                   eval      BSKRNO  = c2n2(WSKRNO)
     C                   eval      WSFNIN  = zhbgetvar('WSFNIN')
     C     LC:UC         XLATE     WSFNIN        WSFNIN
     C                   eval      WSFINV  = zhbgetvar('WSFINV')
     C     LC:UC         XLATE     WSFINV        WSFINV
     C                   eval      WSFTRF  = zhbgetvar('WSFTRF')
     C                   eval      BSFTRF  = c2n2(WSFTRF)
     C                   eval      WSFBIL  = zhbgetvar('WSFBIL')
     C     LC:UC         XLATE     WSFBIL        WSFBIL
     C                   eval      WSFADA  = zhbgetvar('WSFADA')
     C                   eval      BSFADA  = c2n2(WSFADA)
     C                   eval      WSFADK  = zhbgetvar('WSFADK')
     C                   eval      BSFADK  = c2n2(WSFADK)
     C                   eval      WSFAND  = zhbgetvar('WSFAND')
     C                   eval      BSFAND  = c2n2(WSFAND)
     C                   eval      WSFANK  = zhbgetvar('WSFANK')
     C                   eval      BSFANK  = c2n2(WSFANK)
     C                   eval      WSFPFO  = zhbgetvar('WSFPFO')
     C                   eval      WSRTYP  = zhbgetvar('WSRTYP')
     C                   eval      WSFAVA  = zhbgetvar('WSFAVA')
     C                   eval      WSFANS  = zhbgetvar('WSFANS')
     C                   eval      WSFSKL  = zhbgetvar('WSFSKL')
     C                   eval      BSFSKL  = c2n2(WSFSKL)
     C                   eval      WSFSKG  = zhbgetvar('WSFSKG')
     C                   eval      BSFSKG  = c2n2(WSFSKG)
     C                   eval      WSFSLM  = zhbgetvar('WSFSLM')
     C                   eval      BSFSLM  = c2n2(WSFSLM)
     C                   eval      WSFSM3  = zhbgetvar('WSFSM3')
     C                   eval      BSFSM3  = c2n2(WSFSM3)
     C                   eval      WSFMDA  = zhbgetvar('WSFMDA')
     C                   eval      BSFMDA  = c2n2(WSFMDA)
     C                   eval      WSFMKL  = zhbgetvar('WSFMKL')
     C                   eval      BSFMKL  = c2n2(WSFMKL)
     C                   eval      WSFLDA  = zhbgetvar('WSFLDA')
     C                   eval      BSFLDA  = c2n2(WSFLDA)
     C                   eval      WSFLKL  = zhbgetvar('WSFLKL')
     C                   eval      BSFLKL  = c2n2(WSFLKL)
     C                   eval      WSFAV1  = zhbgetvar('WSFAV1')
     C                   eval      WSFAV2  = zhbgetvar('WSFAV2')
     C                   eval      WSFAV3  = zhbgetvar('WSFAV3')
     C                   eval      WSFKO1  = zhbgetvar('WSFKO1')
     C                   eval      WSFKO2  = zhbgetvar('WSFKO2')
     C                   eval      WSFKO3  = zhbgetvar('WSFKO3')
     C                   eval      WSFKO4  = zhbgetvar('WSFKO4')
     C                   eval      WSFGDA  = zhbgetvar('WSFGDA')
     C                   eval      BSFGDA  = c2n2(WSFGDA)
     C                   eval      WSFGSI  = zhbgetvar('WSFGSI')
     C                   eval      WSFFDA  = zhbgetvar('WSFFDA')
     C                   eval      BSFFDA  = c2n2(WSFFDA)
     C                   eval      WSFFSI  = zhbgetvar('WSFFSI')
     C                   eval      WSFUDA  = zhbgetvar('WSFUDA')
     C                   eval      BSFUDA  = c2n2(WSFUDA)
     C                   eval      WSFUSI  = zhbgetvar('WSFUSI')
     C                   eval      WSVAL   = zhbgetvar('WSVAL')
     C     LC:UC         XLATE     WSVAL         WSVAL
     C                   eval      WSKRAU  = zhbgetvar('WSKRAU')
     C                   eval      BSKRAU  = c2n2(WSKRAU)
     C                   eval      WSFORV  = zhbgetvar('WSFORV')
     C                   eval      BSFORV  = c2n2(WSFORV)
     C                   eval      WSFKOS  = zhbgetvar('WSFKOS')
     C                   eval      BSFKOS  = c2n2(WSFKOS)
     C                   eval      WSKTR   = zhbgetvar('WSKTR')
     C     LC:UC         XLATE     WSKTR         WSKTR
     C                   eval      WSST    = zhbgetvar('WSST')
     C                   eval      WSUSRS  = zhbgetvar('WSUSRS')
     C     LC:UC         XLATE     WSUSRS        WSUSRS
N08  C                   eval      WSKDMT  = zhbgetvar('WSKDMT')
     C                   eval      WSTINFO = zhbgetvar('WSTINFO')

     C                   endsr
      *=====================================================================
      * Set html output skeleton VED FEIL
      *=====================================================================
     C     SetSkl        begsr
     C                   eval      lng = uppify(lng)
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC' + lng
     C                   eval      Mbr = 'EISO12'
     C*                  CAT       XSPR≈K:0      MBR
     C                   endsr
      *=====================================================================
      * Set html output variables for section /$top
      *=====================================================================
     C     SetTop        begsr
      * Repeat national language for the next invocation
     C                   callp     updhtmlvar('LNG':lng:
     C                             InitHTMLVars)
      * Repeat background color for the next invocation
     C                   callp     updhtmlvar('TXTCOLOR':'black')
     C                   callp     updhtmlvar('BOLD':' ')
     C                   callp     updhtmlvar('BGCOLOR':BIFARG)
     C                   callp     updhtmlvar('LINK':'0000FF')
     C                   callp     updhtmlvar('VLINK':'FF0000')
     C                   callp     updhtmlvar('ALINK':'00FF00')
      * KUNDE
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updHtmlVar('USER':WSUSER)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHtmlVar('WSNA':WSNA)
     C                   callp     updHtmlVar('KUNDE':
     C                             %trim(%editc(BIKUNR:'Z')))
     C                   callp     updHTMLvar('sdato':
     C                             %trim(%editw(BIDTV:'    .  .  ')))
     C                   callp     updHTMLvar('stid':
     C                             %trim(%editw(BITIDV:'  .  .  ')))
      *
     C                   callp     updHtmlVar('XXNY':XXNY)
     C                   callp     updhtmlvar('WKEY':WKKEY)
     C                   callp     updhtmlvar('WSSAKN':
     C                             %trim(%editc(BSSAKN:'Z')))
     C                   callp     updHTMLvar('WSFRDA':
     C                             %trim(%editw(BSFRDA:'    .  .  ')))
     C                   callp     updHTMLvar('WSSDT':
     C                             %trim(%editw(BSSDT:'    .  .  ')))
     C                   callp     updhtmlvar('WSFTUN':
     C                             %trim(%editc(BSFTUN:'Z')))
     C                   callp     updhtmlvar('WSKNA':
     C                             %trim(%editc(BSKNA:'Z')))
     C     CUNDL01K      CHAIN     CUNDL01                            33
     C                   IF        *IN33
     C                   MOVE      *BLANKS       XNAVNA           30
     C                   ELSE
     C                   MOVE      KNAVN         XNAVNA
     C                   END
     C                   callp     updHtmlVar('XNAVNA':XNAVNA)
N08  C                   callp     updHtmlVar('WSKP':WSKP)
N08  C                   callp     updHtmlVar('WSKPEM':WSKPEM)
N08  C                   callp     updHtmlVar('WSKPEMS':WSKPEMS)
     C                   callp     updhtmlvar('WSFAVD':
     C                             %trim(%editc(BSFAVD:'Z')))
     C                   callp     updhtmlvar('WSFOPD':
     C                             %trim(%editc(BSFOPD:'Z')))
N08  C                   callp     updhtmlvar('TRAVD1':
N08  C                             %trim(%editc(XTRAVD1:'Z')))
N08  C                   callp     updhtmlvar('TROPD1':
N08  C                             %trim(%editc(XTROPD1:'Z')))
N08  C                   callp     updhtmlvar('TRAVD2':
N08  C                             %trim(%editc(XTRAVD2:'Z')))
N08  C                   callp     updhtmlvar('TROPD2':
N08  C                             %trim(%editc(XTROPD2:'Z')))
     C                   callp     updhtmlvar('WSFN':
     C                             %trim(%editc(BSFN:'Z')))
     C                   callp     updHtmlVar('WSSTPU':WSSTPU)
     C                   callp     updhtmlvar('WSNYFN':
     C                             %trim(%editc(BSNYFN:'Z')))
     C                   callp     updhtmlvar('WSKRNO':
     C                             %trim(%editc(BSKRNO:'Z')))
     C                   callp     updHtmlVar('WSFNIN':WSFNIN)
     C                   callp     updHtmlVar('WSFINV':WSFINV)
     C                   callp     updhtmlvar('WSFTRF':
     C                             %trim(%editc(BSFTRF:'Z')))
     C     TRANK         CHAIN     TRAN                               33
     C                   IF        *IN33
     C     TRANK         CHAIN     CUNDL01                            33
     C                   IF        *IN33
     C                   callp     updHtmlVar('XTRNV':'')
     C                   ELSE
     C                   callp     updHtmlVar('XTRNV':KNAVN)
     C                   END
     C                   ELSE
     C                   callp     updHtmlVar('XTRNV':VMNAVN)
     C                   END
N08   *
N08  C                   IF        BSSAKN = 0
N08  C                   callp     updHtmlVar('SYEPOS':'')
N08  C                   ELSE
N08  C     TRANK         CHAIN     TRAN                               33
N08  C                   IF        *IN33
N08  C                   callp     updHtmlVar('SYEPOS':'')
N08  C                   ELSE
N08  C     CUNDL01KT     CHAIN     CUNDL01                            33
N08  C  N33              callp     updHtmlVar('SYEPOS':SYEPOS)
N08  C   33              callp     updHtmlVar('SYEPOS':'')
N08  C                   END
N08  C                   END
N08   *
     C                   callp     updHtmlVar('WSFBIL':WSFBIL)
     C                   callp     updHTMLvar('WSFADA':
     C                             %trim(%editw(BSFADA:'    .  .  ')))
     C                   callp     updHTMLvar('WSFADK':
     C                             %trim(%editw(BSFADK:'  :  ')))
     C                   callp     updHTMLvar('WSFAND':
     C                             %trim(%editw(BSFAND:'    .  .  ')))
     C                   callp     updHTMLvar('WSFANK':
     C                             %trim(%editw(BSFANK:'  :  ')))
      *
     C                   callp     updhtmlvar('WSFSKL':
     C                             %trim(%editc(BSFSKL:'Z')))
     C                   callp     updhtmlvar('WSFSKG':
     C                             %trim(%editc(BSFSKG:'Z')))
     C                   callp     updhtmlvar('WSFSLM':
     C                             %trim(%editc(BSFSLM:'4')))
     C                   callp     updhtmlvar('WSFSM3':
     C                             %trim(%editc(BSFSM3:'4')))
     C                   callp     updHTMLvar('WSFMDA':
     C                             %trim(%editw(BSFMDA:'    .  .  ')))
     C                   callp     updHTMLvar('WSFMKL':
     C                             %trim(%editw(BSFMKL:'  :  ')))
     C                   callp     updHTMLvar('WSFLDA':
     C                             %trim(%editw(BSFLDA:'    .  .  ')))
     C                   callp     updHTMLvar('WSFLKL':
     C                             %trim(%editw(BSFLKL:'  :  ')))
     C                   callp     updHtmlVar('WSFAV1':WSFAV1)
     C                   callp     updHtmlVar('WSFAV2':WSFAV2)
     C                   callp     updHtmlVar('WSFAV3':WSFAV3)
     C                   callp     updHtmlVar('WSFKO1':WSFKO1)
     C                   callp     updHtmlVar('WSFKO2':WSFKO2)
     C                   callp     updHtmlVar('WSFKO3':WSFKO3)
     C                   callp     updHtmlVar('WSFKO4':WSFKO4)
     C                   callp     updHTMLvar('WSFGDA':
     C                             %trim(%editw(BSFGDA:'    .  .  ')))
     C                   callp     updHtmlVar('WSFGSI':WSFGSI)
     C                   callp     updHTMLvar('WSFFDA':
     C                             %trim(%editw(BSFFDA:'    .  .  ')))
     C                   callp     updHtmlVar('WSFFSI':WSFFSI)
     C                   callp     updHTMLvar('WSFUDA':
     C                             %trim(%editw(BSFUDA:'    .  .  ')))
     C                   callp     updHtmlVar('WSFUSI':WSFUSI)
     C                   callp     updHtmlVar('WSVAL':WSVAL)
     C                   callp     updhtmlvar('WSKRAU':
     C                             %trim(%editc(BSKRAU:'4')))
     C                   callp     updhtmlvar('WSKRAV':
     C                             %trim(%editc(BSKRAV:'L')))
     C                   callp     updhtmlvar('WSFORV':
     C                             %trim(%editc(BSFORV:'4')))
     C                   callp     updhtmlvar('WSFKOS':
     C                             %trim(%editc(BSFKOS:'4')))
     C                   callp     updhtmlvar('WSINT':
     C                             %trim(%editc(BSINT:'L')))
     C                   EVAL      BSRES = 0 - BSFKOS + BSINT
     C                   callp     updhtmlvar('WSRES':
     C                             %trim(%editc(BSRES:'L')))
     C                   callp     updHtmlVar('WSKTR':WSKTR)
     C                   callp     updHtmlVar('WSUSRS':WSUSRS)
     C                   callp     updHtmlVar('WSUSRR':WSUSRR)
      *
     C                   callp     updhtmlvar('FEILMELDING':
     C                             FEILMELDING)
     C                   callp     updhtmlvar('FMELDNR':FMELDNR)
     C                   callp     updhtmlvar('AVSLUTT':AVSLUTT)
      *
     C                   endsr
      *
      *=====================================================================******
      *  Set output variables for section /$end
      *=====================================================================******
     C     SetEnd        begsr
      * Compute run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   endsr
      *
      *////////////////////////////////////////////////////////////
     C     TESTB         BEGSR
      *////////////////////////////////////////////////////////////
      *
      * TEST REGISTERINGSDATO
     C                   MOVE      BSSDT         WSDT
     C                   MOVE      WSDTDD        UDD               2 0
     C                   MOVE      WSDTMM        UMM               2 0
     C                   MOVE      WSDT≈≈        U≈≈               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    U≈≈
     C                   PARM                    UFLAGG            1 0
     C                   IF        ((UFLAGG <> 1) AND (BSSDT > XIDAG))
     C                   Z-ADD     1             UFLAGG
     C                   END
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL26        FEILMELDING
     C                   MOVE      '26'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
N08   * TEST ANMELDER OG KONTAKTPEROSN
N08  C                   IF        BSKNA = 0 AND WSKP = *BLANKS
N08  C                   MOVEL     FEIL30        FEILMELDING
N08  C                   MOVE      '30'          FMELDNR
N08  C                   GOTO      SLTBDT
N08  C                   END
      * TEST ANMELDER
S08  C*                  IF        ((BSKNA <> 0) OR (BSFN = 0))
N08  C                   IF        BSKNA <> 0 OR (BSFN = 0 AND WSKP = *BLANKS)
     C     CUNDL01K      CHAIN     CUNDL01                            33
     C                   IF        *IN33
     C                   MOVEL     FEIL24        FEILMELDING
     C                   MOVE      '24'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     C                   END
N08   * TEST ANMELDERS E-POSTADR
N08  C                   IF        WSKPEM <> *BLANKS
N08  C     '@'           SCAN      WSKPEM                                 33
N08  C                   IF        *IN33 = *OFF
N08  C                   MOVEL     FEIL31        FEILMELDING
N08  C                   MOVE      '31'          FMELDNR
N08  C                   GOTO      SLTBDT
N08  C                   END
N08  C                   END
      * TEST TURNR
     C                   IF        ((BSFTUN <> 0) AND (BSFAVD = 0))
     C     BSFTUN        CHAIN     TURER14                            33
     C                   IF        *IN33
     C                   MOVEL     FEIL01        FEILMELDING
     C                   MOVE      '01'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     C                   END
      * TEST AVDELING
     C                   IF        BSFAVD <> 0
     C     KODTAK        CHAIN     KODTA                              33
     C                   IF        *IN33
     C                   MOVEL     FEIL02        FEILMELDING
     C                   MOVE      '02'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     C                   END
      * TEST OPPDRAGSNR
     C                   IF        ((BSFAVD <> 0) OR (BSFOPD <> 0))
     C     HEADFK        CHAIN     HEADF                              33
     C                   IF        *IN33
     C                   MOVEL     FEIL03        FEILMELDING
     C                   MOVE      '03'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     C                   IF        BSFLDA = 0
     C     HEADFK        SETLL     TRACKL01
     C     HEADFK        READE     TRACKL01                               33
     C                   DOW       *IN33 = *OFF
     C                   IF        TTACTI = 'POD'
     C                   MOVE      TTDATE        BSFLDA
     C                   MOVEL     TTTIME        BSFLKL
     C                   LEAVE
     C                   END
     C     HEADFK        READE     TRACKL01                               33
     C                   ENDDO
     C                   END
     C                   END
      *
     C                   EXSR      GETINFO
      *
      * TEST FAKTURANR
     C                   MOVE      *ZEROS        BSKRAV
     C                   IF        BSFN <> 0
     C     BSFN          CHAIN     FAIN                               33
     C                   IF        *IN33
     C                   MOVEL     FEIL04        FEILMELDING
     C                   MOVE      '04'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     C                   IF        BSKNA = 0
     C     BSFN          CHAIN     FAK9                               33
     C                   MOVE      FAKUNR        BSKNA
     C                   END
     C     BSFN          SETLL     FAK9
     C     BSFN          READE     FAK9                                   33
     C                   DOW       *IN33 = *OFF
N10  C                   SELECT
N10  C                   WHEN      BSFAVD = 0 AND BSFOPD = 0
     C                   ADD       FABELN        BSKRAV
N10  C                   WHEN      BSFAVD = FAAVD AND BSFOPD = FAOPD
N10  C                   ADD       FABELN        BSKRAV
N10  C                   ENDSL
     C     BSFN          READE     FAK9                                   33
     C                   ENDDO
     C                   END
      * TEST KREDITNOTA
     C                   MOVE      *ZEROS        XBSFKOS           9 2
     C                   IF        BSKRNO <> 0
     C     BSKRNO        CHAIN     FAIN                               33
     C                   IF        *IN33
     C                   MOVEL     FEIL23        FEILMELDING
     C                   MOVE      '23'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ELSE
     C     BSKRNO        SETLL     FAK9
     C     BSKRNO        READE     FAK9                                   33
     C                   DOW       *IN33 = *OFF
N10  C                   SELECT
N10  C                   WHEN      BSFAVD = 0 AND BSFOPD = 0
     C                   ADD       FABELN        XBSFKOS
N10  C                   WHEN      BSFAVD = FAAVD AND BSFOPD = FAOPD
N10  C                   ADD       FABELN        XBSFKOS
N10  C                   ENDSL
     C     BSKRNO        READE     FAK9                                   33
     C                   ENDDO
     C                   Z-SUB     XBSFKOS       XBSFKOS
     C                   END
     C                   END
      * TEST NY FAKTURA
     C                   MOVE      *ZEROS        BSINT
     C                   IF        BSNYFN <> 0
     C     BSNYFN        CHAIN     FAIN                               33
     C                   IF        *IN33
     C                   MOVEL     FEIL28        FEILMELDING
     C                   MOVE      '28'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     C     BSNYFN        SETLL     FAK9
     C     BSNYFN        READE     FAK9                                   33
     C                   DOW       *IN33 = *OFF
N10  C                   SELECT
N10  C                   WHEN      BSFAVD = 0 AND BSFOPD = 0
     C                   ADD       FABELN        BSINT
N10  C                   WHEN      BSFAVD = FAAVD AND BSFOPD = FAOPD
N10  C                   ADD       FABELN        BSINT
N10  C                   ENDSL
     C     BSNYFN        READE     FAK9                                   33
     C                   ENDDO
     C                   END
      *
      * TEST SENDER AV INNG≈ENDE FAKTURA
     C                   IF        ((WSFNIN <> *BLANKS) AND (WSFINV = *BLANKS))
     C                   MOVEL     FEIL25        FEILMELDING
     C                   MOVE      '25'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
      *
      * TEST TRANSPORTÿR
     C                   IF        BSFTRF <> 0
     C     TRANK         CHAIN     TRAN                               33
     C   33TRANK         CHAIN     CUNDL01                            33
     C                   IF        *IN33
     C                   MOVEL     FEIL05        FEILMELDING
     C                   MOVE      '05'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     C                   END
      * TEST AVGANGSDATO
     C                   MOVE      BSFADA        WSDT
     C                   MOVE      WSDTDD        UDD               2 0
     C                   MOVE      WSDTMM        UMM               2 0
     C                   MOVE      WSDT≈≈        U≈≈               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    U≈≈
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL06        FEILMELDING
     C                   MOVE      '06'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
      * TEST AVGANGSTID
     C                   IF        BSFADK <> 0
     C                   MOVEL     BSFADK        XNR02             2 0
     C                   IF        XNR02 > 23
     C                   MOVEL     FEIL07        FEILMELDING
     C                   MOVE      '07'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   MOVE      BSFADK        XNR02
     C                   IF        XNR02 > 59
     C                   MOVEL     FEIL07        FEILMELDING
     C                   MOVE      '07'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   ENDIF
      * TEST ANKOMSTDATO
     C                   MOVE      BSFAND        WSDT
     C                   MOVE      WSDTDD        UDD               2 0
     C                   MOVE      WSDTMM        UMM               2 0
     C                   MOVE      WSDT≈≈        U≈≈               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    U≈≈
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL08        FEILMELDING
     C                   MOVE      '08'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
      * TEST ANKOMSTTID
     C                   IF        BSFANK <> 0
     C                   MOVEL     BSFANK        XNR02
     C                   IF        XNR02 > 23
     C                   MOVEL     FEIL09        FEILMELDING
     C                   MOVE      '09'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   MOVE      BSFANK        XNR02
     C                   IF        XNR02 > 59
     C                   MOVEL     FEIL09        FEILMELDING
     C                   MOVE      '09'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   ENDIF
      * TEST POSTTYPE
     C                   IF        WSFPFO = *BLANKS
     C                   MOVEL     FEIL10        FEILMELDING
     C                   MOVE      '10'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
      * TEST AVVIKETS ART
     C                   IF        WSFAVA = *BLANKS
     C                   MOVEL     FEIL11        FEILMELDING
     C                   MOVE      '11'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
      * TEST ANSVARLIG PART
     C                   IF        WSFANS = *BLANKS
     C                   MOVEL     FEIL12        FEILMELDING
     C                   MOVE      '12'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
N11   * TEST LASTEMER
N11  C                   IF        BSFSLM > 99.99
N11  C                   MOVEL     FEIL32        FEILMELDING
N11  C                   MOVE      '32'          FMELDNR
N11  C                   GOTO      SLTBDT
N11  C                   ENDIF
N11   * TEST KUBIKK
N11  C                   IF        BSFSM3 > 9999.999
N11  C                   MOVEL     FEIL33        FEILMELDING
N11  C                   MOVE      '33'          FMELDNR
N11  C                   GOTO      SLTBDT
N11  C                   ENDIF
      * TEST MOTAKSDATO
     C                   IF        BSFMDA <> 0
     C                   MOVE      BSFMDA        WSDT
     C                   MOVE      WSDTDD        UDD               2 0
     C                   MOVE      WSDTMM        UMM               2 0
     C                   MOVE      WSDT≈≈        U≈≈               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    U≈≈
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL13        FEILMELDING
     C                   MOVE      '13'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   ENDIF
      * TEST MOTTAKSTID
     C                   IF        BSFMKL <> 0
     C                   MOVEL     BSFMKL        XNR02
     C                   IF        XNR02 > 23
     C                   MOVEL     FEIL14        FEILMELDING
     C                   MOVE      '14'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   MOVE      BSFMKL        XNR02
     C                   IF        XNR02 > 59
     C                   MOVEL     FEIL14        FEILMELDING
     C                   MOVE      '14'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   ENDIF
      * TEST LEVERINGSDATO
     C                   IF        BSFLDA <> 0
     C                   MOVE      BSFLDA        WSDT
     C                   MOVE      WSDTDD        UDD               2 0
     C                   MOVE      WSDTMM        UMM               2 0
     C                   MOVE      WSDT≈≈        U≈≈               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    U≈≈
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL15        FEILMELDING
     C                   MOVE      '15'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   ENDIF
      * TEST LEVERINGSTID
     C                   IF        BSFLKL <> 0
     C                   MOVEL     BSFLKL        XNR02
     C                   IF        XNR02 > 23
     C                   MOVEL     FEIL16        FEILMELDING
     C                   MOVE      '16'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   MOVE      BSFLKL        XNR02
     C                   IF        XNR02 > 59
     C                   MOVEL     FEIL16        FEILMELDING
     C                   MOVE      '16'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   ENDIF
      * TEST BESKRIVELSE AV AVVIK
     C                   IF        WSFAV1 = *BLANKS
     C                   MOVEL     FEIL17        FEILMELDING
     C                   MOVE      '17'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
      * TEST SAK BEHANDLET
     C     WSST          CHAIN     ISOKDS                             33
     C  N33              IF        SSLUTT = 'J'
     C                   IF        ((BSFGDA = 0) OR (WSFGSI = *BLANKS))
     C                   MOVEL     FEIL27        FEILMELDING
     C                   MOVE      '27'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     C                   END
      * TEST TILTAK GODKJENNINGSDATO
     C                   IF        BSFGDA <> 0
     C                   MOVE      BSFGDA        WSDT
     C                   MOVE      WSDTDD        UDD               2 0
     C                   MOVE      WSDTMM        UMM               2 0
     C                   MOVE      WSDT≈≈        U≈≈               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    U≈≈
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL18        FEILMELDING
     C                   MOVE      '18'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   ENDIF
      * TEST TILTAK FRIST
     C                   IF        BSFFDA <> 0
     C                   MOVE      BSFFDA        WSDT
     C                   MOVE      WSDTDD        UDD               2 0
     C                   MOVE      WSDTMM        UMM               2 0
     C                   MOVE      WSDT≈≈        U≈≈               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    U≈≈
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL19        FEILMELDING
     C                   MOVE      '19'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   ENDIF
      * TEST TILTAK UTFÿRTDATO
     C                   IF        BSFUDA <> 0
     C                   MOVE      BSFUDA        WSDT
     C                   MOVE      WSDTDD        UDD               2 0
     C                   MOVE      WSDTMM        UMM               2 0
     C                   MOVE      WSDT≈≈        U≈≈               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    U≈≈
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL20        FEILMELDING
     C                   MOVE      '20'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   ENDIF
      *
     C     WSUSRS        CHAIN(N)  BRIDF                              33
     C                   IF        *IN33
     C                   MOVEL     FEIL21        FEILMELDING
     C                   MOVE      '21'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
      *
     C                   IF        WSVAL <> *BLANKS
     C     VALUL01K      CHAIN     VALUL01                            33
     C                   IF        *IN33
     C                   MOVEL     FEIL22        FEILMELDING
     C                   MOVE      '22'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C*                  EVAL(H)   BSKRAV = BSKRAU * VALKU1 / OMRFAK
     C                   ENDIF
      *
     C                   MOVEL     WSFAV1        XAN02             2
     C                   MOVE      WSFAV1        XAN73            73
     C                   IF        ((XAN02 <> *BLANKS) AND (XAN73 = *BLANKS))
     C     LC:UC         XLATE     XAN02         XAN02
     C     XAN02         SETLL     KODTFT
     C     XAN02         READE     KODTFT                                 33
     C   33              GOTO      STTB2
     C  N33              EVAL      WSFAV1 = KFTFTX
     C  N33XAN02         READE     KODTFT                                 33
     C  N33              EVAL      WSFAV2 = KFTFTX
     C  N33XAN02         READE     KODTFT                                 33
     C  N33              EVAL      WSFAV3 = KFTFTX
     C                   GOTO      SLTBDT
     C                   ELSE
     C                   MOVEL     WSFAV2        XAN02             2
     C                   MOVE      WSFAV2        XAN73            73
     C                   IF        ((XAN02 <> *BLANKS) AND (XAN73 = *BLANKS))
     C     LC:UC         XLATE     XAN02         XAN02
     C     XAN02         SETLL     KODTFT
     C     XAN02         READE     KODTFT                                 33
     C   33              GOTO      STTB2
     C  N33              EVAL      WSFAV2 = KFTFTX
     C  N33XAN02         READE     KODTFT                                 33
     C  N33              EVAL      WSFAV3 = KFTFTX
     C                   GOTO      SLTBDT
     C                   ELSE
     C                   MOVEL     WSFAV3        XAN02             2
     C                   MOVE      WSFAV3        XAN73            73
     C                   IF        ((XAN02 <> *BLANKS) AND (XAN73 = *BLANKS))
     C     LC:UC         XLATE     XAN02         XAN02
     C     XAN02         SETLL     KODTFT
     C     XAN02         READE     KODTFT                                 33
     C   33              GOTO      STTB2
     C  N33              EVAL      WSFAV3 = KFTFTX
     C                   GOTO      SLTBDT
     C                   END
     C                   END
     C                   END
      *
     C     STTB2         TAG
     C                   MOVEL     WSFKO1        XAN02             2
     C                   MOVE      WSFKO1        XAN73            73
     C                   IF        ((XAN02 <> *BLANKS) AND (XAN73 = *BLANKS))
     C     LC:UC         XLATE     XAN02         XAN02
     C     XAN02         SETLL     KODTFT
     C     XAN02         READE     KODTFT                                 33
     C   33              GOTO      STTB3
     C  N33              EVAL      WSFKO1 = KFTFTX
     C  N33XAN02         READE     KODTFT                                 33
     C  N33              EVAL      WSFKO2 = KFTFTX
     C  N33XAN02         READE     KODTFT                                 33
     C  N33              EVAL      WSFKO3 = KFTFTX
     C  N33XAN02         READE     KODTFT                                 33
     C  N33              EVAL      WSFKO4 = KFTFTX
     C                   GOTO      SLTBDT
     C                   ELSE
     C                   MOVEL     WSFKO2        XAN02             2
     C                   MOVE      WSFKO2        XAN73            73
     C                   IF        ((XAN02 <> *BLANKS) AND (XAN73 = *BLANKS))
     C     LC:UC         XLATE     XAN02         XAN02
     C     XAN02         SETLL     KODTFT
     C     XAN02         READE     KODTFT                                 33
     C   33              GOTO      STTB3
     C  N33              EVAL      WSFKO2 = KFTFTX
     C  N33XAN02         READE     KODTFT                                 33
     C  N33              EVAL      WSFKO3 = KFTFTX
     C  N33XAN02         READE     KODTFT                                 33
     C  N33              EVAL      WSFKO4 = KFTFTX
     C                   GOTO      SLTBDT
     C                   ELSE
     C                   MOVEL     WSFKO3        XAN02             2
     C                   MOVE      WSFKO3        XAN73            73
     C                   IF        ((XAN02 <> *BLANKS) AND (XAN73 = *BLANKS))
     C     LC:UC         XLATE     XAN02         XAN02
     C     XAN02         SETLL     KODTFT
     C     XAN02         READE     KODTFT                                 33
     C   33              GOTO      STTB3
     C  N33              EVAL      WSFKO3 = KFTFTX
     C  N33XAN02         READE     KODTFT                                 33
     C  N33              EVAL      WSFKO4 = KFTFTX
     C                   GOTO      SLTBDT
     C                   ELSE
     C                   MOVEL     WSFKO4        XAN02             2
     C                   MOVE      WSFKO4        XAN73            73
     C                   IF        ((XAN02 <> *BLANKS) AND (XAN73 = *BLANKS))
     C     LC:UC         XLATE     XAN02         XAN02
     C     XAN02         SETLL     KODTFT
     C     XAN02         READE     KODTFT                                 33
     C   33              GOTO      STTB3
     C  N33              EVAL      WSFKO4 = KFTFTX
     C                   GOTO      SLTBDT
     C                   END
     C                   END
     C                   END
     C                   END
      *
     C     STTB3         TAG
     C                   IF        FEILMELDING = *BLANKS
     C                   IF        ((SSLUTT = 'K') AND (WSKTR <> 'J'))
     C                   IF        ((BSKRNO = 0) AND (BSFKOS = 0))
     C                   MOVEL     FEIL29        FEILMELDING
     C                   MOVE      '29'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *
     C                   IF        WSTINFO = 'Y'
     C                   MOVE      'J'           AVSLUTT
     C                   ELSE
     C                   MOVE      'Y'           AVSLUTT
     C                   END
      *
     C     SLTBDT        ENDSR
      *
      *=====================================================================
      *  Hent informasjon fra oppdrag-register
      *=====================================================================
     C     GETINFO       begsr
      *
     C                   MOVEL     HEOT          WSFOPT
      *
     C                   IF        ((BSFTUN = 0) OR (HEPRO <> 0))
     C                   MOVE      HEPRO         BSFTUN
     C                   END
     C                   IF        ((BSFTRF = 0) AND (BSFTUN = 0))
     C                   IF        HEUR = 'H'
     C                   MOVE      TRKNFA        BSFTRF
     C                   ELSE
     C                   MOVE      HEKNT         BSFTRF
     C                   END
     C                   END
     C                   IF        WSFBIL = *BLANKS
     C                   MOVEL     HEHAWB        WSFBIL
     C                   END
      *
     C     HEADFK        CHAIN     DISPR                              33
     C                   IF        *IN33 = *OFF
     C                   Z-ADD     DITUAV        BSFTUA
     C                   Z-ADD     DITUR         BSFTUN
     C                   MOVEL     DISONF        WSFFLA
     C                   MOVEL     DISONT        WSFTLA
     C                   END
      *
     C                   IF        BSFTUN <> 0
     C     BSFTUN        CHAIN     TURER14                            33
     C                   IF        *IN33 = *OFF
     C                   MOVEL     TUHENG        WSFHEN
     C                   IF        BSFTRF = 0
     C                   SELECT
     C                   WHEN      HEUR   = 'A'
     C                   IF        HEKNT  = 0
     C                   MOVEL     TUKNT         BSFTRF
     C                   ELSE
     C                   MOVEL     HEKNT         BSFTRF
     C                   END
     C                   WHEN      HEUR   = 'B'
     C                   MOVEL     TUKNT         BSFTRF
     C                   WHEN      HEUR   = 'H'
     C                   MOVEL     TUKNT2        BSFTRF
     C                   ENDSL
     C                   END
     C                   IF        WSFBIL = *BLANKS
     C                   MOVEL     TUBILN        WSFBIL
     C                   END
     C                   MOVE      TUSJA1        BSFS1N
     C                   MOVE      TUSJN1        WSFS1T
     C                   MOVE      TUSJA2        BSFS2N
     C                   MOVE      TUSJN2        WSFS2T
     C                   IF        BSFADA = 0
     C                   MOVE      TUDT          BSFADA
     C                   MOVE      TUTM          BSFADK
     C                   END
     C                   IF        BSFAND = 0
     C                   MOVE      TUDTT         BSFAND
     C                   MOVE      TUTMT         BSFANK
     C                   END
     C                   END
     C                   END
      *
     C                   ENDSR
      *
      *=====================================================================
      *  Oppdater heading
      *=====================================================================
     C     OPDORDRE      begsr
      *
     C     XXNY          IFEQ      'N'
     C     BSSAKN        CHAIN     ISOFL8                             33
     C     *in33         CABEQ     '1'           UtOppd
     c                   end
      *
     C                   EXSR      MOVEWSH
      *
     C     XXNY          IFEQ      'Y'
     C                   MOVE      'N'           AVSLUTT           1
      * Ny post
     C     'ISOSAKSN'    CHAIN     TELLGE                             33
     C                   IF        *IN33
     C                   MOVEL     'ISOSAKSN'    GECO
     C                   Z-ADD     10002         GENO
     C                   WRITE     TELLGER
     C                   Z-ADD     10001         ISSAKN
     C                   ELSE
     C                   MOVE      GENO          ISSAKN
     C                   ADD       1             GENO
     C                   UPDATE    TELLGER
     C                   END
      * HENT LÿPENR
     C                   SELECT
     C                   WHEN      BSFOPD <> 0
     C     HEADFK        SETLL     ISOFL1
     C     HEADFK        READE     ISOFL1                                 33
     C                   MOVE      *ZEROS        I1_ISFLOP
     C                   DOW       *IN33 = *OFF
     C     HEADFK        READE     ISOFL1                                 33
     C                   ENDDO
     C                   EVAL      ISFLOP = I1_ISFLOP + 1
     C                   WHEN      BSFTUN <> 0
     C     BSFTUN        SETLL     ISOFL7
     C     BSFTUN        READE     ISOFL7                                 33
     C                   MOVE      *ZEROS        I7_ISFLOP
     C                   DOW       *IN33 = *OFF
     C     BSFTUN        READE     ISOFL7                                 33
     C                   ENDDO
     C                   EVAL      ISFLOP = I7_ISFLOP + 1
     C                   OTHER
     C                   EVAL      ISFLOP = 1
     C                   ENDSL
      *
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WSUSER        ISUSRR
     C                   MOVE      WDT           ISFRDA
     C                   MOVE      WTM           ISFRTM
     C                   WRITE     ISOFR
     C                   MOVE      ISSAKN        BSSAKN
     C                   EXSR      SRLOG1
N08   *
N08  C                   IF        ISKPEM = *BLANKS
N08  C                   EVAL      ISKPEMS = 'N'
N08  C                   EVAL      WSKPEMS = 'N'
N08  C                   ELSE
N08  C                   EVAL      ISKPEMS = 'J'
N08  C                   EVAL      WSKPEMS = 'J'
N08  C                   END
N08   *
      *
     C                   ELSE
      * Endring
     C                   UPDATE    ISOFR
     C                   EXSR      SRLOG2
     C                   ENDIF
N08   * VARSLE TIL ANMELDER
N08  C                   IF        ISKPEMS = 'J'
N08  C                   MOVE      ISSAKN        WSSAKN
N08  C                   CALL      'EISO17C'
N08  C                   PARM                    BIFIRM
N08  C                   PARM                    WSSAKN
N08  C                   PARM                    ISFPFO
N08  C                   PARM                    ISUSRS
N08  C                   PARM                    ISUSRS
N08  C                   PARM                    ISKP
N08  C                   PARM                    ISKPEM
N08  C                   PARM                    TMTXT
N08  C     BSSAKN        CHAIN     ISOFL8                             33
N08  C                   EVAL      ISKPEMS = 'S'
N08  C                   EVAL      WSKPEMS = 'S'
N08  C  N33              UPDATE    ISOFR
N08  C                   END
N06   *
N06   * OPPDATER LOGG TIL ≈RSAK
N06  C                   EVAL      XTYPE = '*ARSA'
N06  C     1             DO        3             XN01              1 0
N06  C                   IF        FAV(XN01) <> *BLANKS
N06  C                   EVAL      XILTXT = FAV(XN01)
N06  C                   EXSR      SRLOG3
N06  C                   END
N06  C                   ENDDO
N06   * OPPDATER LOGG TIL TILTAK
N06  C                   EVAL      XTYPE = '*TILT'
N06  C     1             DO        4             XN01              1 0
N06  C                   IF        FKO(XN01) <> *BLANKS
N06  C                   EVAL      XILTXT = FKO(XN01)
N06  C                   EXSR      SRLOG3
N06  C                   END
N06  C                   ENDDO
      *
     C                   IF        BSFN <> 0
     C                   IF        ((WSSTPU = 'J') OR (WSSTPU = 'N'))
     C     KRESL13K      CHAIN     KRESL13                            33
     C  N33              IF        WSSTPU = 'J'
     C                   EVAL      STOPP = 'J'
     C                   MOVEL     ISSAKN        LEDI10
N04  C                   MOVE      ISST          LEDI10
N04  C                   MOVE      ISSDT         REKSTRDT
N04  C                   MOVE      *ZEROS        REKSLTDT
     C                   ELSE
     C                   EVAL      STOPP = ' '
     C*                  MOVE      *BLANKS       LEDI10
S05  C*                  MOVE      WDT           REKSLTDT
N05  C                   EXSR      HENTSLTDT
     C                   END
     C  N33              UPDATE    KRESR
N04   * IKKE I KRESF, PRÿV KREHF
N04  C                   IF        *IN33
N04  C     KREHL05K      CHAIN     KREHL05                            33
N04  C  N33              IF        WSSTPU = 'J'
N04  C                   EVAL      STOPP = 'J'
N04  C                   MOVEL     ISSAKN        LEDI10
N04  C                   MOVE      ISST          LEDI10
N04  C                   MOVE      ISSDT         REKSTRDT
N04  C                   MOVE      *ZEROS        REKSLTDT
N04  C                   ELSE
N04  C                   EVAL      STOPP = ' '
N04  C*                  MOVE      *BLANKS       LEDI10
N04  C                   CALL      'SYGE15C'
N04  C                   PARM                    WDT               8
N04  C                   PARM                    WTM               6
S05  C*                  MOVE      WDT           REKSLTDT
N05  C                   EXSR      HENTSLTDT
N04  C                   END
N04  C  N33              UPDATE    KREHR05
N04  C                   END
     C   33              MOVE      ' '           WSSTPU
     C                   END
     C                   END
      *
     C                   MOVE      'N'           XXNY
      *
     C     UtOppd        ENDSR
      *
      *=====================================================================
      *  OPPDATER FELTER I FIL
      *=====================================================================
     C     MOVEWSH       BEGSR
N06   *
N06  C                   EVAL      XILTXT = *BLANKS
N06  C                   IF        XXNY <> 'Y'
N06  C                   IF        BSSDT  <> ISSDT OR
N06  C                             BSFTUN <> ISFTUN OR
N06  C                             BSFAVD <> ISFAVD OR
N06  C                             BSFOPD <> ISFOPD OR
N06  C                             WSFFLA <> ISFFLA OR
N06  C                             WSFTLA <> ISFTLA OR
N06  C                             BSFN   <> ISFN   OR
N06  C                             BSNYFN <> ISNYFN OR
N06  C                             WSSTPU <> ISSTPU OR
N06  C                             BSKRNO <> ISKRNO OR
N06  C                             WSFNIN <> ISFNIN OR
N06  C                             WSFINV <> ISFINV
N06  C                   EVAL      XILTXT = 'ANDRE OPPLYSNINGER ER ENDRET.'
N06  C                   END
N06  C                   IF        BSFTRF <> ISFTRF OR
N06  C                             WSFBIL <> ISFBIL OR
N06  C                             BSFADA <> ISFADA OR
N06  C                             BSFADK <> ISFADK OR
N06  C                             BSFAND <> ISFAND OR
N06  C                             BSFANK <> ISFANK OR
N06  C                             WSFANS <> ISFANS OR
N06  C                             BSFSKL <> ISFSKL OR
N06  C                             BSFSKG <> ISFSKG OR
N06  C                             BSFSLM <> ISFSLM OR
N06  C                             BSFSM3 <> ISFSM3 OR
N06  C                             BSFMDA <> ISFMDA
N06  C                   EVAL      XILTXT = 'ANDRE OPPLYSNINGER ER ENDRET.'
N06  C                   END
N06  C                   IF        BSFMKL <> ISFMKL OR
N06  C                             BSFLDA <> ISFLDA OR
N06  C                             BSFLKL <> ISFLKL OR
N06  C                             BSFGDA <> ISFGDA OR
N06  C                             WSFGSI <> ISFGSI OR
N06  C                             BSFFDA <> ISFFDA OR
N06  C                             WSFFSI <> ISFFSI OR
N06  C                             BSFUDA <> ISFUDA OR
N06  C                             WSFUSI <> ISFUSI OR
N06  C                             WSVAL  <> ISVAL  OR
N06  C                             BSKRAU <> ISKRAU OR
N06  C                             BSKRAV <> ISKRAV
N06  C                   EVAL      XILTXT = 'ANDRE OPPLYSNINGER ER ENDRET.'
N06  C                   END
N06  C                   IF        BSFORV <> ISFORV OR
N06  C                             BSINT  <> ISINT  OR
N06  C                             WSFOPT <> ISFOPT OR
N06  C                             WSFHEN <> ISFHEN OR
N06  C                             BSFS1N <> ISFS1N OR
N06  C                             WSFS1T <> ISFS1T OR
N06  C                             BSFS2N <> ISFS2N OR
N06  C                             WSFS2T <> ISFS2T
N06  C                   EVAL      XILTXT = 'ANDRE OPPLYSNINGER ER ENDRET.'
N06  C                   END
N06  C                   END
N06   *
     C                   MOVE      BSKNA         ISKNA
N08  C                   MOVE      WSKP          ISKP
N08  C                   MOVE      WSKPEM        ISKPEM
N08  C                   MOVE      WSKPEMS       ISKPEMS
     C                   MOVE      ISSDT         GMISSDT           8 0
     C                   MOVE      BSSDT         ISSDT
     C                   MOVE      BSFTUN        ISFTUN
     C                   MOVE      BSFAVD        ISFAVD
     C                   MOVE      BSFOPD        ISFOPD
     C                   MOVE      BSFTUA        ISFTUA
     C                   MOVE      WSFFLA        ISFFLA
     C                   MOVE      WSFTLA        ISFTLA
     C                   MOVE      BSFN          ISFN
N02  C                   IF        BSFN = 0
N02  C                   EVAL      ISFKN = 0
N02  C                   ELSE
N02  C     BSFN          CHAIN     FAK9                               33
N02  C  N33              EVAL      ISFKN = FAKUNR
N02  C   33              EVAL      ISFKN = 0
N02  C                   END
     C                   MOVE      BSNYFN        ISNYFN
     C                   MOVE      WSSTPU        ISSTPU
     C                   SELECT
     C                   WHEN      ISKRNO = 0
     C                   IF        BSKRNO <> 0
     C                   MOVE      XBSFKOS       BSFKOS
     C                   END
     C                   WHEN      BSKRNO <> ISKRNO
     C                   IF        BSKRNO = 0
     C                   MOVE      *ZEROS        BSFKOS
     C                   ELSE
     C                   MOVE      XBSFKOS       BSFKOS
     C                   END
     C                   WHEN      BSKRNO = ISKRNO
     C                   IF        BSFKOS = 0
     C                   MOVE      XBSFKOS       BSFKOS
     C                   END
     C                   ENDSL
     C                   MOVE      BSKRNO        ISKRNO
     C                   MOVE      WSFNIN        ISFNIN
     C                   MOVE      WSFINV        ISFINV
     C                   MOVE      BSFTRF        ISFTRF
     C                   MOVE      WSFBIL        ISFBIL
     C                   MOVE      BSFADA        ISFADA
     C                   MOVE      BSFADK        ISFADK
     C                   MOVE      BSFAND        ISFAND
     C                   MOVE      BSFANK        ISFANK
     C                   MOVE      ISFPFO        GMISFPFO          5
     C                   MOVE      WSFPFO        ISFPFO
     C                   MOVE      ISRTYP        GMISRTYP          2
     C                   MOVE      WSRTYP        ISRTYP
     C                   MOVE      ISFAVA        GMISFAVA          5
     C                   MOVE      WSFAVA        ISFAVA
     C                   MOVE      ISFANS        GMISFANS          5
     C                   MOVE      WSFANS        ISFANS
     C                   MOVE      BSFSKL        ISFSKL
     C                   MOVE      BSFSKG        ISFSKG
     C                   MOVE      BSFSLM        ISFSLM
     C                   MOVE      BSFSM3        ISFSM3
     C                   MOVE      BSFMDA        ISFMDA
     C                   MOVE      BSFMKL        ISFMKL
     C                   MOVE      BSFLDA        ISFLDA
     C                   MOVE      BSFLKL        ISFLKL
N06  C                   MOVE      *BLANKS       FAV
N06  C                   SELECT
N06  C                   WHEN      ((WSFAV1 = *BLANKS) AND (ISFAV1 <> *BLANKS))
N06  C                   EVAL      FAV(1) = '≈RSAK (1) ER SLETTET.'
N06  C                   WHEN      WSFAV1 <> ISFAV1
N06  C                   EVAL      FAV(1) = WSFAV1
N06  C                   ENDSL
N06  C                   SELECT
N06  C                   WHEN      ((WSFAV2 = *BLANKS) AND (ISFAV2 <> *BLANKS))
N06  C                   EVAL      FAV(2) = '≈RSAK (2) ER SLETTET.'
N06  C                   WHEN      WSFAV2 <> ISFAV2
N06  C                   EVAL      FAV(2) = WSFAV2
N06  C                   ENDSL
N06  C                   SELECT
N06  C                   WHEN      ((WSFAV3 = *BLANKS) AND (ISFAV3 <> *BLANKS))
N06  C                   EVAL      FAV(3) = '≈RSAK (3) ER SLETTET.'
N06  C                   WHEN      WSFAV3 <> ISFAV3
N06  C                   EVAL      FAV(3) = WSFAV3
N06  C                   ENDSL
     C                   MOVE      WSFAV1        ISFAV1
     C                   MOVE      WSFAV2        ISFAV2
     C                   MOVE      WSFAV3        ISFAV3
N06  C                   SELECT
N06  C                   WHEN      ((WSFKO1 = *BLANKS) AND (ISFKO1 <> *BLANKS))
N06  C                   EVAL      FKO(1) = 'TILTAK (1) ER SLETTET.'
N06  C                   WHEN      WSFKO1 <> ISFKO1
N06  C                   EVAL      FKO(1) = WSFKO1
N06  C                   ENDSL
N06  C                   SELECT
N06  C                   WHEN      ((WSFKO2 = *BLANKS) AND (ISFKO2 <> *BLANKS))
N06  C                   EVAL      FKO(2) = 'TILTAK (2) ER SLETTET.'
N06  C                   WHEN      WSFKO2 <> ISFKO2
N06  C                   EVAL      FKO(2) = WSFKO2
N06  C                   ENDSL
N06  C                   SELECT
N06  C                   WHEN      ((WSFKO3 = *BLANKS) AND (ISFKO3 <> *BLANKS))
N06  C                   EVAL      FKO(3) = 'TILTAK (3) ER SLETTET.'
N06  C                   WHEN      WSFKO3 <> ISFKO3
N06  C                   EVAL      FKO(3) = WSFKO3
N06  C                   ENDSL
N06  C                   SELECT
N06  C                   WHEN      ((WSFKO4 = *BLANKS) AND (ISFKO4 <> *BLANKS))
N06  C                   EVAL      FKO(4) = 'TILTAK (4) ER SLETTET.'
N06  C                   WHEN      WSFKO4 <> ISFKO4
N06  C                   EVAL      FKO(4) = WSFKO4
N06  C                   ENDSL
     C                   MOVE      WSFKO1        ISFKO1
     C                   MOVE      WSFKO2        ISFKO2
     C                   MOVE      WSFKO3        ISFKO3
     C                   MOVE      WSFKO4        ISFKO4
     C                   MOVE      BSFGDA        ISFGDA
     C                   MOVE      WSFGSI        ISFGSI
     C                   MOVE      BSFFDA        ISFFDA
     C                   MOVE      WSFFSI        ISFFSI
     C                   MOVE      BSFUDA        ISFUDA
     C                   MOVE      WSFUSI        ISFUSI
     C                   MOVE      ISST          GMISST            1
     C                   MOVE      WSST          ISST
     C                   MOVE      WSVAL         ISVAL
     C                   MOVE      BSKRAU        ISKRAU
     C                   MOVE      BSKRAV        ISKRAV
     C                   MOVE      BSFORV        ISFORV
     C                   Z-SUB     BSFKOS        ISFKOS
     C                   MOVE      BSINT         ISINT
     C                   IF        ((WSUSRS <> ISUSRS) AND (ISUSRS <> *BLANKS))
     C                   MOVE      BSSAKN        WSSAKN
N08  C                   MOVE      *BLANKS       UKP
N08  C                   MOVE      *BLANKS       UEPOST
N08  C     WSKDMT        CHAIN     ISOKDM                             33
N08  C   33              EVAL      TMTXT = *BLANKS
     C                   CALL      'EISO17C'
     C                   PARM                    BIFIRM
     C                   PARM                    WSSAKN
N03  C                   PARM                    WSFPFO
     C                   PARM                    ISUSRS
     C                   PARM                    WSUSRS
N08  C                   PARM                    UKP              30
N08  C                   PARM                    UEPOST           50
N08  C                   PARM                    TMTXT
     C                   END
     C                   MOVE      ISUSRS        GMISUSRS         10
     C                   MOVE      WSUSRS        ISUSRS
     C                   MOVE      WSUSER        ISFSSI
N08  C                   MOVE      WSKDMT        ISKDMT
     C                   MOVE      WDT           ISFSDA
     C                   MOVE      WTM           ISFSTM
      *
     C                   MOVE      WSFOPT        ISFOPT
     C                   MOVE      WSFHEN        ISFHEN
     C                   MOVE      BSFS1N        ISFS1N
     C                   MOVE      WSFS1T        ISFS1T
     C                   MOVE      BSFS2N        ISFS2N
     C                   MOVE      WSFS2T        ISFS2T
      *
     C                   endsr
      *
      *=====================================================================
      *  Hent data fra fra fil ved f¯rst "syklus"  / endring av post
      *=====================================================================
     C     GetData       begsr
     C     BSSAKN        CHAIN(N)  ISOFL8                             33
     C     *IN33         CABEQ     '1'           UtGetData
      *
     C                   MOVE      ISKNA         BSKNA
N08  C                   MOVE      ISKP          WSKP
N08  C                   MOVE      ISKPEM        WSKPEM
N08  C                   MOVE      ISKPEMS       WSKPEMS
     C                   MOVE      ISFTUN        BSFTUN
     C                   MOVE      ISFRDA        BSFRDA
     C                   MOVE      ISSDT         BSSDT
     C                   MOVE      ISFAVD        BSFAVD
     C                   MOVE      ISFOPD        BSFOPD
N08  C     HEADFK        CHAIN     HEADF                              33
N08  C                   MOVE      TRAVD1        XTRAVD1
N08  C                   MOVE      TROPD1        XTROPD1
N08  C                   MOVE      TRAVD2        XTRAVD2
N08  C                   MOVE      TROPD2        XTROPD2
     C                   MOVE      ISFN          BSFN
     C                   MOVE      ISNYFN        BSNYFN
     C                   MOVE      ISSTPU        WSSTPU
     C                   MOVE      ISKRNO        BSKRNO
     C                   MOVE      ISFNIN        WSFNIN
     C                   MOVE      ISFINV        WSFINV
     C                   MOVE      ISFTRF        BSFTRF
     C                   MOVE      ISFBIL        WSFBIL
     C                   MOVE      ISFADA        BSFADA
     C                   MOVE      ISFADK        BSFADK
     C                   MOVE      ISFAND        BSFAND
     C                   MOVE      ISFANK        BSFANK
     C                   MOVE      ISFPFO        WSFPFO
     C                   MOVE      ISRTYP        WSRTYP
     C                   MOVE      ISFAVA        WSFAVA
     C                   MOVE      ISFANS        WSFANS
     C                   MOVE      ISFSKL        BSFSKL
     C                   MOVE      ISFSKG        BSFSKG
     C                   MOVE      ISFSLM        BSFSLM
     C                   MOVE      ISFSM3        BSFSM3
     C                   MOVE      ISFMDA        BSFMDA
     C                   MOVE      ISFMKL        BSFMKL
     C                   MOVE      ISFLDA        BSFLDA
     C                   MOVE      ISFLKL        BSFLKL
     C                   MOVE      ISFAV1        WSFAV1
     C                   MOVE      ISFAV2        WSFAV2
     C                   MOVE      ISFAV3        WSFAV3
     C                   MOVE      ISFKO1        WSFKO1
     C                   MOVE      ISFKO2        WSFKO2
     C                   MOVE      ISFKO3        WSFKO3
     C                   MOVE      ISFKO4        WSFKO4
     C                   MOVE      ISFGDA        BSFGDA
     C                   MOVE      ISFGSI        WSFGSI
     C                   MOVE      ISFFDA        BSFFDA
     C                   MOVE      ISFFSI        WSFFSI
     C                   MOVE      ISFUDA        BSFUDA
     C                   MOVE      ISFUSI        WSFUSI
     C                   MOVE      ISST          WSST
     C                   MOVE      ISUSRS        WSUSRS
     C                   MOVE      ISUSRR        WSUSRR
N08  C                   MOVE      ISKDMT        WSKDMT
     C                   MOVE      ISVAL         WSVAL
     C                   MOVE      ISKRAU        BSKRAU
     C                   MOVE      ISKRAV        BSKRAV
     C                   MOVE      ISFORV        BSFORV
     C                   Z-SUB     ISFKOS        BSFKOS
     C                   MOVE      ISINT         BSINT
      *
     C                   MOVE      ISFOPT        WSFOPT
     C                   MOVE      ISFTUA        BSFTUA
     C                   MOVE      ISFFLA        WSFFLA
     C                   MOVE      ISFTLA        WSFTLA
     C                   MOVE      ISFHEN        WSFHEN
     C                   MOVE      ISFS1N        BSFS1N
     C                   MOVE      ISFS1T        WSFS1T
     C                   MOVE      ISFS2N        BSFS2N
     C                   MOVE      ISFS2T        WSFS2T
      *
     C     UtgetData     endsr
      *
      *=====================================================================
      *  Hent data fra fra param.fil mm ved f¯rste "syklus"  / Ny post
      *=====================================================================
     C     GetDft        BEGSR
     C                   MOVE      *ZEROS        BSKNA
     C                   MOVE      *ZEROS        BSFTUN
     C                   MOVE      *ZEROS        BSFRDA
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           BSSDT
     C                   MOVE      *ZEROS        BSFAVD
     C                   MOVE      *ZEROS        BSFOPD
N08  C                   MOVE      *ZEROS        XTRAVD1
N08  C                   MOVE      *ZEROS        XTROPD1
N08  C                   MOVE      *ZEROS        XTRAVD2
N08  C                   MOVE      *ZEROS        XTROPD2
     C                   MOVE      *ZEROS        BSFN
     C                   MOVE      *ZEROS        BSNYFN
     C                   MOVE      *BLANKS       WSSTPU
     C                   MOVE      *ZEROS        BSKRNO
     C                   MOVE      *BLANKS       WSFNIN
     C                   MOVE      *BLANKS       WSFINV
     C                   MOVE      *ZEROS        BSFTRF
     C                   MOVE      *BLANKS       WSFBIL
     C                   MOVE      *ZEROS        BSFADA
     C                   MOVE      *ZEROS        BSFADK
     C                   MOVE      *ZEROS        BSFAND
     C                   MOVE      *ZEROS        BSFANK
     C                   MOVE      *BLANKS       WSFPFO
     C                   MOVE      *BLANKS       WSRTYP
     C                   MOVE      *BLANKS       WSFAVA
     C                   MOVE      *BLANKS       WSFANS
     C                   MOVE      *ZEROS        BSFSKL
     C                   MOVE      *ZEROS        BSFSKG
     C                   MOVE      *ZEROS        BSFSLM
     C                   MOVE      *ZEROS        BSFSM3
     C                   MOVE      *ZEROS        BSFMDA
     C                   MOVE      *ZEROS        BSFMKL
     C                   MOVE      *ZEROS        BSFLDA
     C                   MOVE      *ZEROS        BSFLKL
     C                   MOVE      *BLANKS       WSFAV1
     C                   MOVE      *BLANKS       WSFAV2
     C                   MOVE      *BLANKS       WSFAV3
     C                   MOVE      *BLANKS       WSFKO1
     C                   MOVE      *BLANKS       WSFKO2
     C                   MOVE      *BLANKS       WSFKO3
     C                   MOVE      *BLANKS       WSFKO4
     C                   MOVE      *ZEROS        BSFGDA
     C                   MOVE      *BLANKS       WSFGSI
     C                   MOVE      *ZEROS        BSFFDA
     C                   MOVE      *BLANKS       WSFFSI
     C                   MOVE      *ZEROS        BSFUDA
     C                   MOVE      *BLANKS       WSFUSI
     C                   MOVE      *BLANKS       WSST
     C                   MOVE      WSUSER        WSUSRS
     C                   MOVE      WSUSER        WSUSRR
     C                   MOVE      *ZEROS        BSKRAV
     C                   MOVE      *ZEROS        BSFORV
     C                   MOVE      *ZEROS        BSFKOS
     C                   MOVE      *ZEROS        BSINT
      *
     C                   MOVE      *BLANKS       WSFOPT
     C                   MOVE      *ZEROS        BSFTUA
     C                   MOVE      *BLANKS       WSFFLA
     C                   MOVE      *BLANKS       WSFTLA
     C                   MOVE      *BLANKS       WSFHEN
     C                   MOVE      *ZEROS        BSFS1N
     C                   MOVE      *BLANKS       WSFS1T
     C                   MOVE      *ZEROS        BSFS2N
     C                   MOVE      *BLANKS       WSFS2T
      *
     C     UtgetDft      ENDSR
      *
      *=====================================================================******
      *  Display POST TYPE to select from
      *=====================================================================******
     C     DspPT         BEGSR
      *
     C     KOFASTK1      CHAIN     KOFAST                             33
     C                   IF        *IN33
     C                   EVAL      WSLEDET1 = 'Posttype'
     C                   ELSE
     C                   EVAL      WSLEDET1 = KFTXT
     C                   END
     C                   callp     updHTMLvar('WSLEDET1':WSLEDET1)
      *
     C                   callp     wrtsection('PTSlt')
     C                   IF        WSFPFO = *BLANKS
     C                   EVAL      TKODE = *BLANKS
     C                   callp     updhtmlvar('WSFPFO1':TKODE)
     C                   callp     updhtmlvar('WSFPFO2':
     C                             '--- Velg posttype ---')
     C                   ELSE
     C     WSFPFO        CHAIN     ISOKDT                             33
     C                   callp     updhtmlvar('WSFPFO1':TKODE)
     C                   callp     updhtmlvar('WSFPFO2':TTEXT)
     C                   END
     C                   callp     wrtsection('PTRow')
      *
     C     *LOVAL        SETLL     ISOKDT
     C                   READ      ISOKDT                                 40
     C                   DOW       *IN40 = *OFF
     C                   IF        ((WSFPFO = *BLANKS) OR (WSFPFO <> TKODE))
     C                   callp     updhtmlvar('WSFPFO1':TKODE)
     C                   callp     updhtmlvar('WSFPFO2':TTEXT)
     C                   callp     wrtsection('PTRow')
     C                   END
     C                   READ      ISOKDT                                 40
     C                   ENDDO
      *
     C                   callp     wrtsection('PTBot')
      *
     C                   ENDSR
      *=====================================================================******
      *  Display REKAMASJONSTYPE to select from
      *=====================================================================******
     C     DspRE         BEGSR
      *
     C     KOFASTK2      CHAIN     KOFAST                             33
     C                   IF        *IN33
     C                   EVAL      WSLEDET2 = 'Rekl.type'
     C                   ELSE
     C                   EVAL      WSLEDET2 = KFTXT
     C                   END
     C                   callp     updHTMLvar('WSLEDET2':WSLEDET2)
      *
     C                   callp     wrtsection('RESlt')
     C                   IF        WSRTYP = *BLANKS
     C                   EVAL      RKODE = *BLANKS
     C                   callp     updhtmlvar('WSRTYP1':RKODE)
     C                   callp     updhtmlvar('WSRTYP2':
     C                             '--- Velg reklamasjonstype ---')
     C                   ELSE
     C     WSRTYP        CHAIN     ISOKDR                             33
     C                   callp     updhtmlvar('WSRTYP1':RKODE)
     C                   callp     updhtmlvar('WSRTYP2':RTEXT)
     C                   END
     C                   callp     wrtsection('RERow')
      *
     C     *LOVAL        SETLL     ISOKDR
     C                   READ      ISOKDR                                 40
     C                   DOW       *IN40 = *OFF
     C                   IF        ((WSRTYP = *BLANKS) OR (WSRTYP <> RKODE))
     C                   callp     updhtmlvar('WSRTYP1':RKODE)
     C                   callp     updhtmlvar('WSRTYP2':RTEXT)
     C                   callp     wrtsection('RERow')
     C                   END
     C                   READ      ISOKDR                                 40
     C                   ENDDO
      *
     C                   IF        WSRTYP <> *BLANKS
     C                   EVAL      RKODE = *BLANKS
     C                   EVAL      RTEXT = '--- Ingen ---'
     C                   callp     updhtmlvar('WSRTYP1':RKODE)
     C                   callp     updhtmlvar('WSRTYP2':RTEXT)
     C                   callp     wrtsection('RERow')
     C                   END
      *
     C                   callp     wrtsection('REBot')
      *
     C                   ENDSR
      *=====================================================================******
      *  Display AVVIKETS ART to select from
      *=====================================================================******
     C     DspAV         BEGSR
      *
     C     KOFASTK3      CHAIN     KOFAST                             33
     C                   IF        *IN33
     C                   EVAL      WSLEDET3 = 'Avvikets art'
     C                   ELSE
     C                   EVAL      WSLEDET3 = KFTXT
     C                   END
     C                   callp     updHTMLvar('WSLEDET3':WSLEDET3)
      *
     C                   callp     wrtsection('AVSlt')
     C                   IF        WSFAVA = *BLANKS
     C                   EVAL      AKODE = *BLANKS
     C                   callp     updhtmlvar('WSFAVA1':AKODE)
     C                   callp     updhtmlvar('WSFAVA2':
     C                             '--- Velg avvikets art ---')
     C                   ELSE
     C     ISOKDAK1      CHAIN     ISOKDA                             33
     C   33ISOKDAK2      CHAIN     ISOKDA                             33
     C                   callp     updhtmlvar('WSFAVA1':AKODE)
     C                   callp     updhtmlvar('WSFAVA2':ATEXT)
     C                   END
     C                   callp     wrtsection('AVRow')
      *
     C                   IF        WSFPFO <> *BLANKS
     C     WSFPFO        SETLL     ISOKDA
     C     WSFPFO        READE     ISOKDA                                 40
     C                   DOW       *IN40 = *OFF
     C                   IF        ((WSFAVA = *BLANKS) OR (WSFAVA <> AKODE))
     C                   callp     updhtmlvar('WSFAVA1':AKODE)
     C                   callp     updhtmlvar('WSFAVA2':ATEXT)
     C                   callp     wrtsection('AVRow')
     C                   END
     C     WSFPFO        READE     ISOKDA                                 40
     C                   ENDDO
     C                   END
      *
     C     '     '       SETLL     ISOKDA
     C     '     '       READE     ISOKDA                                 40
     C                   DOW       *IN40 = *OFF
     C                   IF        ((WSFAVA = *BLANKS) OR (WSFAVA <> AKODE))
     C                   callp     updhtmlvar('WSFAVA1':AKODE)
     C                   callp     updhtmlvar('WSFAVA2':ATEXT)
     C                   callp     wrtsection('AVRow')
     C                   END
     C     '     '       READE     ISOKDA                                 40
     C                   ENDDO
      *
     C                   callp     wrtsection('AVBot')
      *
     C                   ENDSR
      *=====================================================================******
      *  Display ANSVARLIG PART to select from
      *=====================================================================******
     C     DspAP         BEGSR
      *
     C     KOFASTK4      CHAIN     KOFAST                             33
     C                   IF        *IN33
     C                   EVAL      WSLEDET4 = 'Ansvarlig part'
     C                   ELSE
     C                   EVAL      WSLEDET4 = KFTXT
     C                   END
     C                   callp     updHTMLvar('WSLEDET4':WSLEDET4)
      *
     C                   callp     wrtsection('APSlt')
     C                   IF        WSFANS = *BLANKS
     C                   EVAL      PKODE = *BLANKS
     C                   callp     updhtmlvar('WSFANS1':PKODE)
     C                   callp     updhtmlvar('WSFANS2':
     C                             '--- velg ansvarlig part ---')
     C                   ELSE
     C     WSFANS        CHAIN     ISOKDP                             33
     C                   callp     updhtmlvar('WSFANS1':PKODE)
     C                   callp     updhtmlvar('WSFANS2':PTEXT)
     C                   END
     C                   callp     wrtsection('APRow')
      *
     C     *LOVAL        SETLL     ISOKDP1
     C                   READ      ISOKDP1                                40
     C                   DOW       *IN40 = *OFF
     C                   IF        ((WSFANS = *BLANKS) OR (WSFANS <> PKODE))
     C                   callp     updhtmlvar('WSFANS1':PKODE)
     C                   callp     updhtmlvar('WSFANS2':PTEXT)
     C                   callp     wrtsection('APRow')
     C                   END
     C                   READ      ISOKDP1                                40
     C                   ENDDO
      *
     C                   callp     wrtsection('APBot')
      *
     C                   ENDSR
      *=====================================================================******
      *  Display STATUS to select from
      *=====================================================================******
     C     DspST         BEGSR
      *
     C                   callp     wrtsection('STSlt')
     C                   IF        WSST = *BLANKS
     C                   EVAL      SKODE = *BLANKS
     C                   END
     C                   IF        WSST = ' '
     C                   MOVE      '1'           WSST
     C                   END
     C     WSST          CHAIN     ISOKDS                             33
     C                   callp     updhtmlvar('WSST1':SKODE)
     C                   callp     updhtmlvar('WSST2':STEXT)
     C                   callp     wrtsection('STRow')
      *
     C     *LOVAL        SETLL     ISOKDS
     C                   READ      ISOKDS                                 40
     C                   DOW       *IN40 = *OFF
     C                   IF        WSST <> SKODE
S01  C*                  IF        ((BIAKT = 'L') OR (SSLUTT <> 'J'))
N01  C                   IF        ((XAUT = 'L') OR (SSLUTT <> 'J'))
     C                   callp     updhtmlvar('WSST1':SKODE)
     C                   callp     updhtmlvar('WSST2':STEXT)
     C                   callp     wrtsection('STRow')
     C                   END
     C                   END
     C                   READ      ISOKDS                                 40
     C                   ENDDO
      *
     C                   callp     wrtsection('STBot')
      *
     C                   ENDSR
      *=====================================================================******
      *  Display ISO-BRUKERE to select from
      *=====================================================================******
     C     DspUSR        BEGSR
      *
N09  C                   EVAL      XBIFIRM = BIFIRM
     C                   EVAL      PAID = 'ISOW'
      *
     C                   callp     wrtsection('USRSlt')
     C                   IF        WSUSRS = *BLANKS
     C                   MOVE      WSUSER        WSUSRS
     C                   END
     C     WSUSRS        CHAIN(N)  BRIDF                              33
     C                   callp     updhtmlvar('WSUSRS1':BIBRID)
     C                   callp     updhtmlvar('WSUSRS2':BIBESK)
     C                   callp     wrtsection('USRRow')
      *
     C     *LOVAL        SETLL     BRIDF
     C                   READ(N)   BRIDF                                  40
     C                   DOW       *IN40 = *OFF
S09  C*                  IF        WSUSRS <> BIBRID
N09  C                   IF        WSUSRS <> BIBRID AND XBIFIRM = BIFIRM
     C     BrParKey2     Chain     BRPARF                             33
     C  N33              IF        ((PAVRDA = 'J') OR (PAVRDA = 'j'))
     C                   callp     updhtmlvar('WSUSRS1':BIBRID)
     C                   callp     updhtmlvar('WSUSRS2':BIBESK)
     C                   callp     wrtsection('USRRow')
     C                   END
     C                   END
     C                   READ(N)   BRIDF                                  40
     C                   ENDDO
      *
     C                   callp     wrtsection('USRBot')
N09  C                   EVAL      BIFIRM = XBIFIRM
      *
     C                   ENDSR
N08   *=====================================================================******
N08   *  Display MELDINGSTEKST to select from
N08   *=====================================================================******
N08  C     DspMT         BEGSR
N08   *
N08  C                   callp     wrtsection('MTSlt')
N08  C     WSKDMT        CHAIN     ISOKDM                             33
N08  C                   IF        *IN33
N08  C                   callp     updhtmlvar('WSKDMT1':'')
N08  C                   callp     updhtmlvar('WSKDMT2':'--- Ingen tilleggs -
N08  C                             melding ---')
N08  C                   ELSE
N08  C                   callp     updhtmlvar('WSKDMT1':TMKD)
N08  C                   callp     updhtmlvar('WSKDMT2':TMTXT)
N08  C                   END
N08  C                   callp     wrtsection('MTRow')
N08   *
N08  C     *LOVAL        SETLL     ISOKDM
N08  C                   READ      ISOKDM                                 40
N08  C                   DOW       *IN40 = *OFF
N08  C                   IF        WSKDMT <> TMKD
N08  C                   callp     updhtmlvar('WSKDMT1':TMKD)
N08  C                   callp     updhtmlvar('WSKDMT2':TMTXT)
N08  C                   callp     wrtsection('MTRow')
N08  C                   END
N08  C                   READ      ISOKDM                                 40
N08  C                   ENDDO
N08   *
N08  C                   IF        WSKDMT <> *BLANKS
N08  C                   callp     updhtmlvar('WSKDMT1':'')
N08  C                   callp     updhtmlvar('WSKDMT2':'--- Ingen tilleggs -
N08  C                             melding ---')
N08  C                   callp     wrtsection('MTRow')
N08  C                   END
N08   *
N08  C                   callp     wrtsection('MTBot')
N08   *
N08  C                   ENDSR
N05   *=====================================================================******
N05   * TRACK & TRACE
N05   *=====================================================================******
N05  C     DSPTT         BEGSR
N05   *
N08  C                   IF        BSSAKN = 0
N08  C                   EVAL      *IN33 = *ON
N08  C                   ELSE
N05  C     BSSAKN        SETLL     ISOLOGL1
N05  C     BSSAKN        READE     ISOLOGL1                               33
N08  C                   END
N05  C                   callp     wrtsection('tabTTstr')
N05  C                   DOW       *IN33 = *OFF
N05  C                   callp     updhtmlvar('ILDTL':
N05  C                             %trim(%editw(ILDTL:'    .  .  ')))
N05  C                   callp     updhtmlvar('ILTML':
N05  C                             %trim(%editw(ILTML:'  :  :  ')))
N06  C                   callp     updhtmlvar('ILUSR':ILUSR)
N05  C                   callp     updhtmlvar('ILUSR1':ILUSR1)
N05  C                   callp     updhtmlvar('ILST2':ILST2)
N05  C                   callp     updhtmlvar('ILUSR2':ILUSR2)
N05  C                   callp     updhtmlvar('ILTXT':ILTXT)
N05   * odde/partalls-linjer i alternativ skyggelegging/bakgrunnsfarge
N05  C     OddEven       IFEQ      ODD
N05  C                   eval      OddEven = EVEN
N05  C                   else
N05  C                   eval      OddEven = ODD
N05  C                   end
N05  C                   callp     updHTMLvar('ODDEVEN':OddEven)
N05   *
N05  C                   callp     wrtsection('tabTTrow')
N05  C     BSSAKN        READE     ISOLOGL1                               33
N05  C                   ENDDO
N05  C                   callp     wrtsection('tabTTend')
N05   *
N05  C                   ENDSR
N05   *
N05   *=====================================================================
N05   *  HENT SLUTT DATO
N05   *=====================================================================
N05  C     HENTSLTDT     BEGSR
N05  C                   MOVE      WDT           REKSLTDT
N05  C     BSSAKN        SETGT     ISOLOGL1
N05  C     BSSAKN        READPE    ISOLOGL1                               33
N05  C                   DOW       *IN33 = *OFF
N05  C                   IF        ILST2 = '5'
N05  C                   MOVE      ILDTL         REKSLTDT
N05  C                   LEAVE
N05  C                   END
N05  C     BSSAKN        READPE    ISOLOGL1                               33
N05  C                   ENDDO
N07  C                   EVAL      *IN33 = *OFF
N05   *
N05  C                   ENDSR
N05   *
      *=====================================================================
      *  HENT DOKUMENTER
      *=====================================================================
     C     HENTDOK       BEGSR
     C                   MOVE      BSSAKN        ARUNDE
      *
     C     ARKIVL06K     SETLL     ARKIVL06
     C     ARKIVL06K     READE     ARKIVL06                               33
     C                   MOVE      *BLANKS       UPDF
     C                   MOVE      *ZEROS        XN                3 0
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   EVAL      UPDF(XN) = '<a href="'
     C                   CAT       XBANE:0       UPDF(XN)
     C                   CAT       ARLINK:0      UPDF(XN)
     C                   CAT       '" target="':0UPDF(XN)
     C                   CAT       'SyPDFWind': 0UPDF(XN)
     C                   CAT       '">':0        UPDF(XN)
     C                   IF        ARRFK = *BLANKS
     C                   CAT       'DOC':0       UPDF(XN)
     C                   MOVE      XN            XAN               3
     C                   CAT       XAN:0         UPDF(XN)
     C                   ELSE
     C                   CAT       ARRFK:0       UPDF(XN)
     C                   END
     C                   CAT       '<img src="':0UPDF(XN)
     C                   CAT       '/syspeddev':0UPDF(XN)
     C                   CAT       '/PDF.gif"':0 UPDF(XN)
     C                   CAT       'ALT="':1     UPDF(XN)
     C                   CAT       'DOC':0       UPDF(XN)
     C                   CAT       XAN:0         UPDF(XN)
     C                   CAT       '"></a>':0    UPDF(XN)
      *
S01  C*                  IF        XBIAKT = 'L'
N01  C                   IF        XAUT = 'L'
     C                   EVAL      UPDF(XN) = %trim(UPDF(XN))
     C                             + ' <a href="#" OnClick="DltDoc('
     C                             + 'this.form,'
     C                             + %trim(XAPSTR)
     C                             + %trim(XBANE) + %trim(ARLINK)
     C                             + %trim(XAPSTR) + ',' + %trim(XAPSTR)
     C                             + %trim(ARRFK)
     C                             + %trim(XAPSTR)
     C                             + ')"> <img src="/syspeddev/DeleteX.gif"'
     C                             + ' width=13 height=13 border=0>'
     C                   END
      *
     C     XN            COMP      40                                 33  33
     C  N33ARKIVL06K     READE     ARKIVL06                               33
     C                   ENDDO
      *
     C                   callp     updHTMLvar('UPDF1':UPDF1)
     C                   callp     updHTMLvar('UPDF2':UPDF2)
     C                   callp     updHTMLvar('UPDF3':UPDF3)
     C                   callp     updHTMLvar('UPDF4':UPDF4)
     C                   callp     updHTMLvar('UPDF5':UPDF5)
     C                   callp     updHTMLvar('UPDF6':UPDF6)
     C                   callp     updHTMLvar('UPDF7':UPDF7)
     C                   callp     updHTMLvar('UPDF8':UPDF8)
     C                   callp     updHTMLvar('UPDF9':UPDF9)
     C                   callp     updHTMLvar('UPDF10':UPDF10)
     C                   callp     updHTMLvar('UPDF11':UPDF11)
     C                   callp     updHTMLvar('UPDF12':UPDF12)
     C                   callp     updHTMLvar('UPDF13':UPDF13)
     C                   callp     updHTMLvar('UPDF14':UPDF14)
     C                   callp     updHTMLvar('UPDF15':UPDF15)
     C                   callp     updHTMLvar('UPDF16':UPDF16)
     C                   callp     updHTMLvar('UPDF17':UPDF17)
     C                   callp     updHTMLvar('UPDF18':UPDF18)
     C                   callp     updHTMLvar('UPDF19':UPDF19)
     C                   callp     updHTMLvar('UPDF20':UPDF20)
     C                   callp     updHTMLvar('UPDF21':UPDF21)
     C                   callp     updHTMLvar('UPDF22':UPDF22)
     C                   callp     updHTMLvar('UPDF23':UPDF23)
     C                   callp     updHTMLvar('UPDF24':UPDF24)
     C                   callp     updHTMLvar('UPDF25':UPDF25)
     C                   callp     updHTMLvar('UPDF26':UPDF26)
     C                   callp     updHTMLvar('UPDF27':UPDF27)
     C                   callp     updHTMLvar('UPDF28':UPDF28)
     C                   callp     updHTMLvar('UPDF29':UPDF29)
     C                   callp     updHTMLvar('UPDF30':UPDF30)
     C                   callp     updHTMLvar('UPDF31':UPDF31)
     C                   callp     updHTMLvar('UPDF32':UPDF32)
     C                   callp     updHTMLvar('UPDF33':UPDF33)
     C                   callp     updHTMLvar('UPDF34':UPDF34)
     C                   callp     updHTMLvar('UPDF35':UPDF35)
     C                   callp     updHTMLvar('UPDF36':UPDF36)
     C                   callp     updHTMLvar('UPDF37':UPDF37)
     C                   callp     updHTMLvar('UPDF38':UPDF38)
     C                   callp     updHTMLvar('UPDF39':UPDF39)
     C                   callp     updHTMLvar('UPDF40':UPDF40)
      *
     C                   ENDSR
      *
      *=====================================================================
      *  LOGG HENDELSE (NY SAK)
      *=====================================================================
     C     SRLOG1        BEGSR
     C                   CLEAR                   ISOLOGFR
     C                   MOVE      BSSAKN        ILSAKN
     C                   MOVE      WDT           ILDTL
     C                   MOVE      WTM           ILTML
S06  C*                  MOVE      ISUSRR        ILUSR
N06  C                   MOVE      WSUSER        ILUSR
     C                   MOVE      'W'           ILMOD
     C                   MOVE      ISFPFO        ILFPFO2
     C                   MOVE      ISFAVA        ILFAVA2
     C                   MOVE      ISFANS        ILFANS2
     C                   MOVE      ISRTYP        ILRTYP2
     C                   MOVE      ISST          ILST2
     C                   MOVE      ISSDT         ILSDT2
     C                   MOVE      ISUSRS        ILUSR2
     C                   EVAL      ILTXT = 'NY REGISTRERT SAK.'
     C                   WRITE     ISOLOGFR
      *
     C                   ENDSR
      *
      *=====================================================================
      *  LOGG HENDELSE (ENDRET SAK)
      *=====================================================================
     C     SRLOG2        BEGSR
     C                   CLEAR                   ISOLOGFR
     C                   MOVE      ISSAKN        ILSAKN
     C                   MOVE      WDT           ILDTL
     C                   MOVE      WTM           ILTML
S06  C*                  MOVE      ISUSRR        ILUSR
N06  C                   MOVE      WSUSER        ILUSR
     C                   MOVE      'W'           ILMOD
     C                   MOVE      GMISFPFO      ILFPFO1
     C                   MOVE      ISFPFO        ILFPFO2
     C                   MOVE      GMISFAVA      ILFAVA1
     C                   MOVE      ISFAVA        ILFAVA2
     C                   MOVE      GMISFANS      ILFANS1
     C                   MOVE      ISFANS        ILFANS2
     C                   MOVE      GMISRTYP      ILRTYP1
     C                   MOVE      ISRTYP        ILRTYP2
     C                   MOVE      GMISST        ILST1
     C                   MOVE      ISST          ILST2
     C                   MOVE      GMISSDT       ILSDT1
     C                   MOVE      ISSDT         ILSDT2
     C                   MOVE      GMISUSRS      ILUSR1
     C                   MOVE      ISUSRS        ILUSR2
     C                   SELECT
     C                   WHEN      ILUSR1  <> ILUSR2
     C                   EVAL      ILTXT = 'SAKEN ER SENDT TIL EN ANNEN '
     C                             + 'SAKSBEHANDLER.'
     C                   WHEN      ILFPFO1 <> ILFPFO2
     C                   EVAL      ILTXT = 'POSTERINGSTYPE ER ENDRET.'
     C                   WHEN      ILFAVA1 <> ILFAVA2
     C                   EVAL      ILTXT = 'AVVIKETSART ER ENDRET.'
     C                   WHEN      ILFANS1 <> ILFANS2
     C                   EVAL      ILTXT = 'ANSVARLIGPART ER ENDRET.'
     C                   WHEN      ILRTYP1 <> ILRTYP2
     C                   EVAL      ILTXT = 'REKLAMASJONSTYPE ER ENDRET.'
     C                   WHEN      ILST1   <> ILST2
     C                   EVAL      ILTXT = 'STATUS ER ENDRET.'
     C                   WHEN      ILSDT1  <> ILSDT2
     C                   EVAL      ILTXT = 'SAKSDATO ER ENDRET.'
N06  C                   WHEN      XILTXT  <> *BLANKS
N06  C                   EVAL      ILTXT = XILTXT
     C                   OTHER
S06  C*                  EVAL      ILTXT = 'ANDRE OPPLYSNINGER ER ENDRET.'
N06  C                   GOTO      SLSRLOG2
     C                   ENDSL
     C                   WRITE     ISOLOGFR
      *
N06  C     SLSRLOG2      TAG
     C                   ENDSR
      *
N06   *=====================================================================
N06   *  LOGG ≈RSAK OG TILTAK
N06   *=====================================================================
N06  C     SRLOG3        BEGSR
N06   *
N06  C                   CLEAR                   ISOLOGFR
N06  C                   MOVE      ISSAKN        ILSAKN
N06  C                   MOVE      WDT           ILDTL
N06  C                   MOVE      WTM           ILTML
N06  C                   MOVE      WSUSER        ILUSR
N06  C                   MOVE      'W'           ILMOD
N06  C                   MOVE      XTYPE         ILFPFO2
N06  C                   IF        XXNY = 'Y'
N06  C                   EVAL      ILFAVA2 = 'CRT'
N06  C                   ELSE
N06  C                   EVAL      ILFAVA2 = 'CHG'
N06  C                   MOVE      GMISST        ILST1
N06  C                   MOVE      GMISUSRS      ILUSR1
N06  C                   END
N06  C                   MOVEL     XN01          ILFANS2
N06  C                   MOVE      ISST          ILST2
N06  C                   SELECT
N06  C                   WHEN      XTYPE = '*ARSA'
N06  C                   EVAL      ILUSR2 = '*≈RSAK('
N06  C                             + %TRIM(%EDITC(XN01:'Z')) + ')'
N06  C                   WHEN      XTYPE = '*TILT'
N06  C                   EVAL      ILUSR2 = '*TILTAK('
N06  C                             + %TRIM(%EDITC(XN01:'Z')) + ')'
N06  C                   ENDSL
N06  C                   EVAL      ILTXT = XILTXT
N06  C                   WRITE     ISOLOGFR
N06   *
N06  C                   ENDSR
N06   *
      *=====================================================================
      *  Initier
      *=====================================================================
     C     INIT          begsr
      * Get program start time for calculating execution time
     C                   time                    timedata1
      *
     C                   open      BRIDF                                50
     C     WSUSER        CHAIN(N)  BRIDF                              50
S01  C*                  MOVE      BIAKT         XBIAKT            1
      *
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt pÂ user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
      *
     C                   EXSR      TSTUSER
OddEv * hent Parametre som gÂr igjen i mange prog:
OddEv *      Odd/Even/Rowhead-farger,Logobilde,SprÂk,Intern/Ekstern bruker,  mm
OddEvc                   call      'ESGETPAR'
OddEvc                   parm                    BIBRID
OddEvc                   parm                    BIFIRM
OddEvc                   parm                    BIKUNR
OddEvc                   parm                    BIKNG
OddEvc                   parm                    RowHead          10
OddEvc                   parm                    Odd              10
OddEvc                   parm                    Even             10
OddEvc                   parm                    LogoImg          50
OddEvc                   parm                    XSPR≈K            2
OddEvc                   parm                    XINTERN           1
OddEvc                   parm                    ParmDS1        1024
OddEvc                   parm                    ParmDS2        1024
OddEvc                   parm                    ParmDS3        1024
      *
     C                   open      ISOLOGF                              50
N05  C                   open      ISOLOGL1                             50
     C                   open      ISOFL1                               50
     C                   open      ISOFL7                               50
     C                   open      ISOFL8                               50
     C                   open      ISOSAKF                              50
     C                   open      TELLGE                               50
     C                   open      KODTA                                50
     C                   open      FAIN                                 50
     C                   open      FAK9                                 50
     C                   open      HEADF                                50
     C                   open      TURER14                              50
     C                   open      TRAN                                 50
     C                   open      CUNDL01                              50
     C                   open      DISP                                 50
     C*                  open      UNITL01                              50
     C                   open      ISOKDA                               50
     C                   open      ISOKDT                               50
     C                   open      ISOKDP                               50
     C                   open      ISOKDP1                              50
     C                   open      ISOKDR                               50
     C                   open      ISOKDS                               50
N08  C                   open      ISOKDM                               50
     C                   OPEN      VALUL01                              50
     C                   OPEN      KOFAST                               50
     C                   OPEN      KODTFT                               50
     C                   open      BRPARF                               50
     C                   OPEN      ARKIVL06                             50
     C                   OPEN      TRACKL01                             50
     C                   OPEN      KRESL13                              50
N04  C                   OPEN      KREHL05                              50
      *
     C     KOFASTK1      klist
     C                   kfld                    KFTYP
     C                   kfld                    X1KFKOD           5
     C     KOFASTK2      klist
     C                   kfld                    KFTYP
     C                   kfld                    X2KFKOD           5
     C     KOFASTK3      klist
     C                   kfld                    KFTYP
     C                   kfld                    X3KFKOD           5
     C     KOFASTK4      klist
     C                   kfld                    KFTYP
     C                   kfld                    X4KFKOD           5
     C     ISOKDAK1      klist
     C                   kfld                    WSFPFO
     C                   kfld                    WSFAVA
     C     ISOKDAK2      klist
     C                   kfld                    X_ISFPFO          5
     C                   kfld                    WSFAVA
     C     HEADFK        klist
     C                   kfld                    BSFAVD
     C                   kfld                    BSFOPD
     C     TRANK         klist
     C                   kfld                    BIFIRM
     C                   kfld                    BSFTRF
N08  C     CUNDL01KT     klist
N08  C                   kfld                    BIFIRM
N08  C                   kfld                    VMTRKU
     C     CUNDL01K      klist
     C                   kfld                    BIFIRM
     C                   kfld                    BSKNA
     C     VALUL01K      KLIST
     C                   KFLD                    BIFIRM
     C                   KFLD                    WSVAL
     C     KODTAK        klist
     C                   kfld                    KOAUNI
     C                   kfld                    BSFAVD
     C                   MOVE      'A'           KOAUNI
     C     ARKIVL06K     klist
     C                   kfld                    BIFIRM
     C                   kfld                    ARTYPE
     C                   kfld                    ARUNDE
     C     KRESL13K      klist
     C                   kfld                    BIFIRM
     C                   kfld                    BSFN
N04  C     KREHL05K      klist
N04  C                   kfld                    BIFIRM
N04  C                   kfld                    REGNSKAPAR
N04  C                   kfld                    BSFN
     C     BrParKey      klist
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
     C     BrParKey2     klist
     C                   kfld                    BIBRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
N06   *
N06  C     *LIKE         DEFINE    ILTXT         XILTXT
N06  C     *LIKE         DEFINE    ILFPFO2       XTYPE
N09  C     *LIKE         DEFINE    BIFIRM        XBIFIRM
      *
     C                   EVAL      KFTYP   = 'AVLETEKST'
     C                   EVAL      X1KFKOD = 'ISTYP'
     C                   EVAL      X2KFKOD = 'ISREK'
     C                   EVAL      X3KFKOD = 'ISAVA'
     C                   EVAL      X4KFKOD = 'ISANS'
     C                   EVAL      ARTYPE  = 'ZO'
     C                   EVAL      ARUNDE  = 'ISO'
     C                   MOVE      BIBRID        PABRID
     C                   MOVE      *zeros        PAKUNR
      * HENT SPR≈KKODE
     C                   MOVEL     'SPR≈K'       PAID
     C     BrParKey      Chain     BRPARF                             33
     C                   IF        (*IN33 OR (PAVRDA <> 'EN'))
     C                   MOVE      *BLANKS       XSPR≈K            2
     C                   ELSE
     C                   MOVE      'EN'          XSPR≈K            2
     C                   END
N01   *
N01  C                   MOVEL     'AUTOR'       PAID
N01  C     BrParKey      Chain     BRPARF                             33
N01  C                   IF        *IN33
N01  C                   MOVE      'N'           XAUT              1
N01  C                   ELSE
N01  C                   MOVEL     PAVRDA        XAUT
N01  C                   END
      *
     C                   MOVE      'OLBAN'       PAID
     C     BrParKey      Chain     BRPARF                             33
     C  N33              MOVEL     PAVRDA        XBANE            50
      *
     C                   MOVE      'N'           AVSLUTT           1
     c                   move      *blanks       feilmelding
     c                   move      *blanks       fmeldnr
     C                   BITON     '123457'      XAPSTR            1
     C                   BITOFF    '06'          XAPSTR
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           XIDAG             8 0
      *
     C                   endsr
      *////////////////////////////////////////////////////////////
     C     TSTUSER       BEGSR
      *////////////////////////////////////////////////////////////
      /copy syspeds/qrpgsrcpy,tstuser
      *
     C                   endsr
      *=====================================================================
      * Send output buffer and quit
      *=====================================================================
     C     Exit          begsr
      * Compute and display run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
     C                   callp     wrtsection('endhtml')
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      *
     C                   close     BRIDF
     C                   close     ISOLOGF
N05  C                   close     ISOLOGL1
     C                   close     ISOFL1
     C                   close     ISOFL7
     C                   close     ISOFL8
     C                   close     ISOSAKF
     C                   close     TELLGE
     C                   close     KODTA
     C                   close     FAIN
     C                   close     FAK9
     C                   close     HEADF
     C                   close     TURER14
     C                   close     TRAN
     C                   close     CUNDL01
     C                   close     DISP
     C*                  close     UNITL01
     C                   close     ISOKDA
     C                   close     ISOKDT
     C                   close     ISOKDP
     C                   close     ISOKDP1
     C                   close     ISOKDR
     C                   close     ISOKDS
N08  C                   close     ISOKDM
     C                   close     VALUL01
     C                   close     KOFAST
     C                   close     KODTFT
     C                   close     BRPARF
     C                   close     ARKIVL06
     C                   close     TRACKL01
     C                   close     KRESL13
N04  C                   close     KREHL05
     C                   eval      *inlr = *on
     C                   return
     C                   endsr
