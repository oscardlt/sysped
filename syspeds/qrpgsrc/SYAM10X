      ***************************************************************
      *** PROGRAM SKAL VEDLIKEHOLDE FAKTURA                       ***
      * DETTE PROGRAM ER LAG UT FRA SYFI10X. FOR Å REKALKULERE AGENT-
      * LINJER PÅ ET OPPDRAG
      ***************************************************************
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER        ***
      *** LEDIGE INDIKATORER 01 02 09 11 13-15 17-23              ***
      *** LEDIGE INDIKATORER 27    53-72                          ***
      *** INDIKATOR 37-39 BRUKES FOR KALLE FRA SYFF10 (ENDRE FAKT)***
      ***           36 PÅ OG 39 AV = KALLE FRA SYIN10             ***
      ***           99 = 50 I S-36                                ***
      ***           41 PÅ = LAND-IMPORT                           ***
      ***           42 PÅ = LAND-EKSPORT                          ***
      ***           43 PÅ = FLY-IMPORT                            ***
      ***           44 PÅ = FLY-EKSPORT                           ***
      ***           45 PÅ = INNENLANDS-FLY                        ***
      ***           46 PÅ = TRANSPORTOPPDRAG                      ***
      ***           47 PÅ = TRANSPORTOPPDRAG/DUPLIKAT/FORFRAKT    ***
      ***           48 PÅ = TRANSPORTOPPDRAG/DUPLIKAT/VIDEREFRAKT ***
      ***           49 PÅ = SJØ-IMPORT                            ***
      ***           50 PÅ = SJØ-EKSPORT                           ***
      ***************************************************************
     FFAKT      UF A E           K DISK
     FFAK4      IF   E           K DISK
     F                                     RENAME(FAKTR:FAKTR2)
     FHEADF     UF   E           K DISK
     FKODSAM    IF   E           K DISK
     FFERDL01   UF A E           K DISK
     FDOKUI     IF   E           K DISK
     FDOKEF     IF   E           K DISK
     FVALUL01   IF   E           K DISK
     FVAIAL01   IF   E           K DISK
     F                                     RENAME(VALUR:VAIAR)
     FLEVEL01   IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FPRIK      IF   E           K DISK
     FPRIK1D    IF   E           K DISK
     FAVFRHL01  IF   E           K DISK
     FPRIK1     IF   E           K DISK
     F                                     RENAME(PRIKR:PRIKR1)
     FPRJOIN    IF   E           K DISK
     FPRIS      IF   E           K DISK
     FMULTKODT  IF   E           K DISK
     FKODTCC    IF   E           K DISK
     FBILLOF    IF   E           K DISK
     FSTED2D    IF   E           K DISK
     F                                     RENAME(STED2R:STED2DR)
     FSTED2     IF   E           K DISK
     FFRATN     IF   E           K DISK
     FFRAV      IF   E           K DISK
     FCFRAT     IF   E           K DISK
     FBLV1LF    IF   E           K DISK
     FCDCON4    IF   E           K DISK
     FFIRM      IF   E           K DISK
     FKOSBU     UF A E           K DISK
     FKOSTT     UF A E           K DISK
     FFRSTTG    IF   E           K DISK
     FSYFI10FX  CF   E             WORKSTN USROPN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
     F*
     D*  Include/omit arrays for gebyravtaler
     D GNT             S              3    DIM(20)
     D                 DS
     D  LOKUPF                 1      9  0
     D  LOKUP2                 5      9  0
     D                 DS
     D  HEFBV                  1      9  0
     D  HEFBVN                 5      9  0
     D                 DS
     D  HEM3                   1      7  3
     D  HEM3N                  2      6  2
     D                 DS
     D  UR                     1     10
     D                                     DIM(10)                              I/O. ursp.kode
     D  PKUR01                 1      1
     D  PKUR02                 2      2
     D  PKUR03                 3      3
     D  PKUR04                 4      4
     D  PKUR05                 5      5
     D  PKUR06                 6      6
     D  PKUR07                 7      7
     D  PKUR08                 8      8
     D  PKUR09                 9      9
     D  PKUR10                10     10
     D                 DS
     D  FR                     1     30
     D                                     DIM(10)                              I/O. frankatur
     D  PKFR01                 1      3
     D  PKFR02                 4      6
     D  PKFR03                 7      9
     D  PKFR04                10     12
     D  PKFR05                13     15
     D  PKFR06                16     18
     D  PKFR07                19     21
     D  PKFR08                22     24
     D  PKFR09                25     27
     D  PKFR10                28     30
     D                 DS
     D  GNA                    1     30
     D                                     DIM(10)
     D  GNAT                   1     30
     D  AFGE01                 1      3
     D  AFGE02                 4      6
     D  AFGE03                 7      9
     D  AFGE04                10     12
     D  AFGE05                13     15
     D  AFGE06                16     18
     D  AFGE07                19     21
     D  AFGE08                22     24
     D  AFGE09                25     27
     D  AFGE10                28     30
     D                 DS
     D  OT                     1     20
     D                                     DIM(10)                              I/O. oppd.type
     D  PKOT01                 1      2
     D  PKOT02                 3      4
     D  PKOT03                 5      6
     D  PKOT04                 7      8
     D  PKOT05                 9     10
     D  PKOT06                11     12
     D  PKOT07                13     14
     D  PKOT08                15     16
     D  PKOT09                17     18
     D  PKOT10                19     20
     D                 DS
     D  LK                     1     20
     D                                     DIM(10)                              I/O. landkode
     D  PKLK01                 1      2
     D  PKLK02                 3      4
     D  PKLK03                 5      6
     D  PKLK04                 7      8
     D  PKLK05                 9     10
     D  PKLK06                11     12
     D  PKLK07                13     14
     D  PKLK08                15     16
     D  PKLK09                17     18
     D  PKLK10                19     20
     D FBAREA          DS
     D  WSID                 197    206
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  FS                     1     50
     D                                     DIM(10)                              I/O. frasted
     D  PKFS01                 1      5
     D  PKFS02                 6     10
     D  PKFS03                11     15
     D  PKFS04                16     20
     D  PKFS05                21     25
     D  PKFS06                26     30
     D  PKFS07                31     35
     D  PKFS08                36     40
     D  PKFS09                41     45
     D  PKFS10                46     50
     D                 DS
     D  TS                     1     50
     D                                     DIM(10)                              I/O. tilsted
     D  PKTS01                 1      5
     D  PKTS02                 6     10
     D  PKTS03                11     15
     D  PKTS04                16     20
     D  PKTS05                21     25
     D  PKTS06                26     30
     D  PKTS07                31     35
     D  PKTS08                36     40
     D  PKTS09                41     45
     D  PKTS10                46     50
     D                 DS
     D  LS                     1     60
     D                                     DIM(3)                               I/O. last/loss
     D  PKLS01                 1     20
     D  PKLS02                21     40
     D  PKLS03                41     60
      *** KG2XX I KODETGE ER TATT I BRUK        23/11-89
      *** 4 FØRSTE POSISJON PÅ KG2LEV I KODETGE ER TATT I BRUK
      *** SOM PROSENT SATS MEN KG2LEV ER IKKE I BRUK NÅ
     D                 DS
     D  KG2LEV                 1      8  0
     D  KG2PRO                 1      4  4
     D                 DS
     D  KLKPRO                 1      3  0
     D  XPRO                   1      3  3
     D                 DS
     D  HEKNT                  1      8  0
     D  XKNF                   6      8  0
     D                 DS
     D  WSDTD                  1      2  0
     D  WSDTM                  3      4  0
     D  WSDTÅ                  5      6  0
     D  WSDT                   1      6  0
     D                 DS
     D  HEDTÅ                  1      4  0
     D  HEDTM                  5      6  0
     D  HEDTD                  7      8  0
     D  HEDTOP                 1      8  0
     D                 DS
     D  KDIBL1                 1      4  2
     D  XBL1                   1      4  4
     D                 DS
     D  DICCPP                 1      2
     D  XCCPP1                 1      1
     D                 DS
     D  X01B                   1      1
     D  PRKOLL                 1      1
     D  PKKOLL                 1      1
     D  PRINT                  2      6  0
     D  PKINT                  2      6  0
     D  PRANT                  7     11  0
     D  PKPPR                  7     11  0
     D  PRTEGN                12     12
     D  PKTEGN                12     12
     D  PRJUST                13     22  3
     D  PKJUST                13     22  3
     D                 DS
     D  FTKODE                 1      1
     D  PKAVTT                 1      1
     D                 DS
     D  KOVK1                  1      5  0
     D  KOVK2                  6     10  0
     D  KOVK3                 11     15  0
     D  KOVK4                 16     20  0
     D  KOVK5                 21     25  0
     D  KOVK6                 26     30  0
     D  KOVK7                 31     35  0
     D  KOVK8                 36     40  0
     D  KOVK9                 41     45  0
     D  KOVK10                46     50  0
     D  KOVK11                51     55  0
     D  KOVK12                56     60  0
     D  FF                     1     60  0
     D                                     DIM(12) ASCEND                       VEKTGR.AVD(STD)
     D                 DS
     D  FRVK1                  1      5  0
     D  FRVK2                  6     10  0
     D  FRVK3                 11     15  0
     D  FRVK4                 16     20  0
     D  FRVK5                 21     25  0
     D  FRVK6                 26     30  0
     D  FRVK7                 31     35  0
     D  FRVK8                 36     40  0
     D  FRVK9                 41     45  0
     D  FRVK10                46     50  0
     D  FRVK11                51     55  0
     D  FRVK12                56     60  0
     D  FV                     1     60  0
     D                                     DIM(12) ASCEND                       VEKTGR. AVTALE
     D                 DS
     D  KOWF1                  1      1
     D  KOWF2                  2      2
     D  KOWF3                  3      3
     D  KOWF4                  4      4
     D  KOWF5                  5      5
     D  KOWF6                  6      6
     D  KOWF7                  7      7
     D  KOWF8                  8      8
     D  KOWF9                  9      9
     D  KOWF10                10     10
     D  KOWF11                11     11
     D  KOWF12                12     12
     D  FP                     1     12
     D                                     DIM(12)
     D                 DS
     D  FTBFT                  1     36
     D  FB                     1     36P 0
     D                                     DIM(12)
     D  FTMFT                 37     72
     D  FM                    37     72P 0
     D                                     DIM(12)
     D                 DS
     D  FTMAX1                 1      5  0
     D  FTMAX2                 6     10  0
     D  FTMAX3                11     15  0
     D  AX                     1     15  0
     D                                     DIM(3)
      *
      *
     IKUNDR
     I              BANKG                       SYBAGI
     I              POSTG                       SYPOGI
     IPRIKRD
     I              PKKNR                       XXX01
     I              PKAVTN                      XXX02
     I              PKFR01                      XXX03
     I              PKOT01                      XXX04
     I              PKGEBY                      XXX05
      *
     C                   EXSR      INIT
      *
     C     UNYGML        IFEQ      'NY'
     C                   EXSR      DELFAK
     C                   END
     C     UFLAGG        IFEQ      3
     C     UFLAGG        OREQ      6
     C                   EXSR      KUNFRA
     C                   GOTO      SLUTT2
     C                   END
      *
     C                   OPEN      SYFI10FX
     C     START         TAG
     C                   MOVE      '1'           *IN83
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(83)
     C                   Z-ADD     *ZEROS        ZRECNO
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     FAK2K         SETLL     FAK4
     C                   EXSR      SUMBL
     C     START1        TAG
     C     UAVD          READE     FAK4                                   84
     C  N84UOPD          COMP      FAOPD                              8484
     C  N84FASK          IFEQ      'A'
     C                   GOTO      START1
     C                   END
     C   84              MOVE      *BLANKS       KGENOT
     C   84              MOVE      *BLANKS       WSNR
      *
     C     START2        TAG
      *
     C  N84              DO
     C                   DO        10
      *                    DO   5
     C                   ADD       1             ZRECNO
     C                   MOVE      FAVK          WSVK
     C     KODGEK        CHAIN     KOGER                              32
     C   32              MOVE      ' '           XKDUL
     C  N32              MOVE      KGEUTL        XKDUL
     C  N32FAVT          IFNE      *BLANKS
     C                   MOVE      FAVT          KGENOT
     C                   END
     C     FASK          COMP      'E'                                    51
     C                   WRITE     SUBFIL
     C     NESTEA        TAG
     C     UAVD          READE     FAK4                                   84
     C  N84UOPD          COMP      FAOPD                              8484
     C  N84FASK          IFEQ      'A'
     C                   GOTO      NESTEA
     C                   END
     C  N84              END
     C                   END
      * Remember last line data. (If more than one page, this is 1.
      * first line on page 2. Screen data for roll will be lost i a
      * line on page 1. is updated before roll to page 2.
     C  N84              EXSR      MOVFAZ
      *
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C     START3        TAG
     C                   MOVEA     '11'          *IN(81)
     C   79UMSG          COMP      *BLANKS                                79
     C                   EXSR      KDTFMT
     C     ZRECNO        IFEQ      0
     C                   EXFMT     NYWRK
     C                   ELSE
     C                   SETOFF                                       8889
     C                   WRITE     SUBCTL
     C                   EXFMT     BUNN
     C                   END
     C                   EXSR      KDTFMT
      *
      * FREETEXT
      *
     C   18              DO
     C                   EXSR      VISFRE
     C                   GOTO      START
     C                   END
     C   24              DO
     C                   EXSR      CMDLIN
     C                   GOTO      START3
     C                   END
      *
      * F11 = LOOK AT REQUISITIONS./BUDGETED COSTS
      *
     C   11              DO
     C                   MOVE      *ZEROS        XTAVD             4 0
     C                   MOVE      *ZEROS        XPROSJ            8 0
     C                   MOVE      UAVD          XAVD              4 0
     C                   MOVE      UOPD          XOPD              7 0
     C                   MOVE      'O'           XKOSTN            1
     C                   CALL      'SYKS12'
     C                   PARM                    XTAVD
     C                   PARM                    XPROSJ
     C                   PARM                    XAVD
     C                   PARM                    XOPD
     C                   PARM                    XKOSTN
     C                   GOTO      START
     C                   END
      *
      * F14 = LOOK AT INVOICES
      *
     C   14              DO
     C                   CALL      'SYFM21B'
     C                   PARM                    UFIRM
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    FMDUM             1 0
     C                   GOTO      START
     C                   END
      *
      *** FRISK OPP - VIS OGSÅ UTL.PROVISJON
      *
     C   05KO2UTL        IFNE      'N'
     C                   EXSR      UTLSR
     C                   END
     C   05              GOTO      START
      *
      *** MAKE NEW INVOICELINE
      * NOT IF SECURED
      *
     C   06USECUR        IFNE      '*SECUR'
     C                   EXSR      MOVW
     C                   GOTO      START5
     C                   END
     C   07              DO
     C                   MOVEA     *BLANKS       GNT
     C                   MOVE      *ZEROS        GN
     C                   EXSR      DELFAK
     C                   GOTO      START
     C                   END
      * FERDIGMELDING
      * IKKE VED SAMLAST FLY EKSPORT
      *
     C   10              DO
     C     UMELD         IFEQ      ' '
     C     HERFA         IFEQ      *BLANKS
      *
      * KAN IKKE FERDIGMELDE SAMLASTER I ARBEID
      *
     C                   MOVE      'J'           UMELD
     C                   END
     C  N44              MOVE      'J'           UMELD
     C                   ELSE
     C                   MOVE      ' '           UMELD
     C                   END
     C     UMELD         COMP      'J'                                    90
     C                   EXSR      OPDFER
     C                   GOTO      START3
     C                   END
      *
      * KALLER ENDRE FERDIGMELDTE
      *
     C   20              DO
     C                   CALL      'SYFA58CL'
     C                   GOTO      START3
     C                   END
     C   03
     COR 16
     COR 08
     COR 12              DO
     C                   EXSR      KUNFRA
     C     KO2UTL        IFNE      'N'
     C                   EXSR      UTLSR
     C                   END
     C   03              Z-ADD     3             UFLAGG
     C   16              Z-ADD     6             UFLAGG
     C   08              DO
      *
     C     HEUR          IFEQ      'A'
     C     HEUR          OREQ      'C'
     C     HEUR          OREQ      'F'
     C                   CALL      'SAD61CLD'
     C                   PARM                    UAVDAN
     C                   PARM                    UOPDAN
     C                   GOTO      START3
     C                   END
      *
      *
     C     HEUR          IFEQ      'B'
     C     HEUR          OREQ      'D'
     C     HEUR          OREQ      'G'
     C                   CALL      'SAD52CLD'
     C                   PARM                    UAVDAN
     C                   PARM                    UOPDAN
     C                   PARM                    HESG
     C                   GOTO      START3
     C                   END
      *
     C                   Z-ADD     8             UFLAGG
     C                   END
     C   12              Z-ADD     1             UFLAGG
     C   12              MOVE      'GM'          UNYGML
     C   12              MOVE      ' '           UMELD
     C                   CLOSE     SYFI10FX
     C                   GOTO      SLUTT
     C                   END
      *
      *** BLA VIDERE
      *
     C   25              DO
     C                   SETOFF                                       25
     C                   Z-ADD     YRECNO        ZRECNO
      *
      * First line on next is allways read earlier -
      * get back remembered fields (preserved i Z-fields by MOVFAZ)
      *
     C                   EXSR      MOVZFA
     C                   GOTO      START2
     C                   END
      *
     C     ZRECNO        IFEQ      0
     C                   GOTO      START3
     C                   ELSE
     C                   EXSR      HENTFA
     C   88              GOTO      START3
     C                   END
      *
      *** SLETT FAKTURALINJE
      *
     C     WSNR          IFEQ      '4'                                          4=SLETTE
     C                   MOVE      ' '           WSNR
     C                   EXFMT     VAREL3
     C  N12              DO
     C     FAKTK         CHAIN     FAKT                               33
     C  N33              DELETE    FAKTR
     C                   EXSR      MOVF
     C                   MOVEL     '*DLT'        KGENOT
      *
      * SLETT OGSÅ EVT. BUDSJETTERT KOSTNAD
      *
     C     FAJOUR        IFNE      *ZEROS
     C     FAJOUR        CHAIN     KOSBU                              33
     C  N33              DELETE    KOSBUR
     C                   END
      *
      * OPPDATER OGSÅ EVT. FRAKTBELØP I TRANSPORTMODUL
      *
     C     HEUR          IFEQ      'H'
     C     FALI          ANDEQ     0
     C     HEADFK        CHAIN     HEADF                              33
     C     *IN33         IFEQ      *OFF
     C                   Z-ADD     0             TRFRAB
     C                   UPDATE    HEADFR
     C                   ENDIF
     C                   ENDIF
     C                   END
     C   12              Z-ADD     1             XTOTSG
     C   12              EXSR      TOTSR
     C     FASK          COMP      'E'                                51
     C                   UPDATE    SUBFIL
     C                   GOTO      START3
     C                   END
      *
      * SE PÅ KUNDENS AVTALE
      *
     C     WSNR          IFEQ      '9'
     C                   MOVE      *ZEROS        UUUKUN
     C     FAAGRN        IFEQ      *ZEROS
     C     FASK          IFEQ      'K'
     C                   MOVE      HEKNKF        UUUKUN
     C                   ELSE
     C     FASK          IFEQ      'S'
     C                   MOVE      HEKNSF        UUUKUN
     C                   ELSE
     C     FASK          IFEQ      'X'
     C                   MOVE      FAKUNR        UUUKUN
     C                   ELSE
     C                   GOTO      TAG09
     C                   END
     C                   END
     C                   END
     C                   END
      *
      *
     C                   Z-ADD     1             UFLAGG
     C                   CALL      'SYPO09'
     C                   PARM                    FAAGRN
     C                   PARM                    UUUKUN            8 0
     C                   PARM                    UFLAGG
     C     TAG09         TAG
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   GOTO      START
     C                   END
      *
      *** VISE FAKTURALINJE
      *
     C     WSNR          IFEQ      '5'                                          5=VISE
     C                   MOVE      ' '           WSNR
     C     VALUK2        CHAIN     VALUL01                            33
     C     FABELV        IFNE      0
     C     FABELN        DIV(H)    FABELV        XWORK
     C     XWORK         MULT      OMRFAK        WSKURS
     C                   ENDIF
     C                   EXFMT     VAREL3
     C                   MOVE      *ZEROS        WSKURS
     C     FASK          COMP      'E'                                51
     C                   UPDATE    SUBFIL
     C                   GOTO      START3
     C                   END
      *
      *** LAGE/ENDRE FAKTURALINJE
      *
     C     START5        TAG
     C  N30
     CANN04              Z-ADD     20            LINNBR
     C  N30
     CANN04WSSK          IFEQ      *BLANKS
     C                   Z-ADD     2             POSNBR
     C                   ELSE
     C                   Z-ADD     5             POSNBR
     C                   END
     C                   EXFMT     VARELI
     C                   SETOFF                                       309274
     C                   SETOFF                                       73
     C                   MOVEA     '00000'       *IN(94)                        *IN94-*IN98
     C   04              DO
     C                   EXSR      SØKDTA
     C                   GOTO      START5
     C                   END
     C   12              DO
     C   91FASK          COMP      'E'                                    51
     C   91              UPDATE    SUBFIL
     C                   SETOFF                                       91
     C                   Z-ADD     1             XTOTSG
     C                   EXSR      TOTSR
      *
     C                   GOTO      START3
     C                   END
     C                   EXSR      TESTB1
     C   30              GOTO      START5
     C                   EXSR      MOVWSF
     C                   EXSR      TOTSR
     C                   EXSR      VALUTA
     C                   MOVE      WSSAMM        PKSAMM
     C   33              EXSR      NYFAK
     C  N33              MOVE      'E'           FAKDA
     C  N33              EXSR      UPFAK
     C   91FASK          COMP      'E'                                    51
      *
      * OPPDATER OGSÅ EVT. FRAKTBELØP I TRANSPORTMODUL
      *
     C     HEUR          IFEQ      'H'
     C     FALI          ANDEQ     0
     C     HEADFK        CHAIN     HEADF                              33
     C     *IN33         IFEQ      *OFF
     C                   Z-ADD     WSBELV        TRFRAB
     C                   UPDATE    HEADFR
     C                   ENDIF
     C                   ENDIF
     C   91              UPDATE    SUBFIL
     C  N91              ADD       1             YRECNO
     C  N91              Z-ADD     YRECNO        ZRECNO
     C  N91FASK          COMP      'E'                                    51
     C  N91              WRITE     SUBFIL
     C                   EXSR      KDTFMT
     C                   WRITE     SUBCTL
     C                   EXSR      KDTFMT
     C                   SETOFF                                       91
     C                   EXSR      MOVW
     C                   GOTO      START3
      *
     C     SLUTT         TAG
     C     SLUTT2        TAG
     C                   MOVE      *BLANK        UMELD
     C                   SETON                                        LR
     C                   RETURN
      *
      ***********************************************
     C     OPDFER        BEGSR
      ***********************************************
      *OPPDATERER FERDIGMELDTE
      *
     C     HEADFK        CHAIN     FERDL01                            33
     C     UMELD         IFEQ      'J'
      *
      * SKJEKKER OM OPPDRAG LIGGER I FILE FOR FERDIGMELDTE
      *
     C   33              MOVE      UAVD          FEAVD
     C   33              MOVE      UOPD          FEOPD
     C   33              MOVE      WSID          FEWS
     C   33              WRITE     FERDR
     C  N33              MOVE      WSID          FEWS
     C  N33              UPDATE    FERDR
     C                   ELSE
     C  N33              DELETE    FERDR
     C                   END
     C                   ENDSR
      *
      ***********************************************
     C     HENTFA        BEGSR
      ***********************************************
     C                   MOVEA     '00'          *IN(81)
     C     *IN88         DOWEQ     '0'
     C                   READC     SUBFIL                                 88
     C  N88WSNR          IFEQ      '2'
     C                   MOVEL     KGENOT        XNOT              4
     C     XNOT          COMP      '*DLT'                                 88
     C   88              GOTO      SLHENT
      *
      *** USK <> ' ' KALLE FRA SYFF10 (ENDRE FAKTURA)
      *
     C     USK           IFNE      ' '
     C   37FASK          COMP      'S'                                8888
     C   38FASK          COMP      'K'                                8888
     C   88              GOTO      SLHENT
     C                   END
     C                   Z-SUB     1             XTOTSG            1 0
     C                   EXSR      TOTSR
     C                   EXSR      MOVFWS
      *
     C                   MOVE      ' '           WSNR
     C                   SETON                                        91
     C                   GOTO      SLHENT
     C                   END
     C  N88WSNR          IFEQ      '4'
     C                   MOVEL     KGENOT        XNOT
     C     XNOT          COMP      '*DLT'                                 88
     C  N88              Z-SUB     1             XTOTSG            1 0
     C  N88              EXSR      TOTSR
     C                   GOTO      SLHENT
     C                   END
     C  N88WSNR          IFEQ      '5'
     C                   MOVEL     KGENOT        XNOT
     C     XNOT          COMP      '*DLT'                                 88
     C                   GOTO      SLHENT
     C                   END
     C  N88WSNR          IFEQ      '9'
     C                   MOVEL     KGENOT        XNOT
     C     XNOT          COMP      '*DLT'                                 88
     C                   GOTO      SLHENT
     C                   END
     C                   END
      *
     C     SLHENT        ENDSR
      *
      ***********************************************
     C     SØKDTA        BEGSR
      ***********************************************
      *
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
      *
     C                   Z-ADD     1             UFLAGG
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     5
     C     POSNBR        ANDLE     7
     C                   CALL      'SYFI10D'
     C                   PARM                    WSVK
     C                   Z-ADD     9             POSNBR
     C                   GOTO      SLSØK
     C                   END
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     30
     C     POSNBR        ANDLE     32
     C                   MOVE      'J'           USØK              1
     C                   CALL      'V200SY'
     C                   PARM                    USØK
     C                   PARM                    WSVAL
     C                   Z-ADD     37            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      21
     C     POSNBR        ANDGE     10
     C     POSNBR        ANDLE     17
     C                   Z-ADD     1             SOANTK
     C                   CALL      'SOELEV'
     C                   PARM                    FIFIRM
     C                   PARM                    SOANTK            1 0
     C                   PARM                    SOTXT1            8
     C                   PARM                    WSLEVN
     C                   PARM                    SOTXT2            8
     C                   PARM                    SOKNR2            8 0
     C                   PARM                    SOTXT3            8
     C                   PARM                    SOKNR3            8 0
     C                   PARM                    SOTXT4            8
     C                   PARM                    SOKNR4            8 0
     C                   PARM                    SOTXT5            8
     C                   PARM                    SOKNR5            8 0
     C                   PARM                    SOTXT6            8
     C                   PARM                    SOKNR6            8 0
     C                   PARM                    SOTXT7            8
     C                   PARM                    SOKNR7            8 0
     C                   PARM                    SOTXT8            8
     C                   PARM                    SOKNR8            8 0
     C                   Z-ADD     28            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDGE     10
     C     POSNBR        ANDLE     17
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    WSKUNR
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN           30
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDEQ     43
     C                   MOVE      'J'           SAMSOK            1
     C                   CALL      'SYFA06'
     C                   PARM                    SAMSOK
     C                   PARM                    WSSAMM
     C                   GOTO      SLSØK
     C                   END
      *
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
      *
     C     SLSØK         TAG
     C                   MOVEA     '11'          *IN(81)
     C                   EXSR      KDTFMT
     C     ZRECNO        IFEQ      0
     C                   WRITE     NYWRK
     C                   ELSE
     C                   WRITE     SUBCTL
     C                   END
     C                   EXSR      KDTFMT
     C   91              DO
     C     ZRECNO        CHAIN     SUBFIL                             91
     C                   SETON                                        91
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     TESTB1        BEGSR
      ***********************************************
     C     WSVAL         IFEQ      *BLANKS
     C                   MOVE      FICURR        WSVAL
     C                   END
      *
      *** TEST KODE SK  HVEM BELASTES
      *
     C     WSSK          COMP      ' '                                    98
     C  N98
     CAN 41
     CORN98
     CAN 42
     CORN98
     CAN 46WSSK          COMP      'F'                                    98
     C  N98
     CANN41
     CANN42
     CANN46
     CANN49
     CANN50WSSK          COMP      'A'                                    98
     C  N98
     CANN41
     CANN42
     CANN46
     CANN49
     CANN50WSSK          COMP      'T'                                    98
      *
      *** USK <> ' ' KALLE FRA SYFF10 (ENDRE FAKTURA)
      *
     C  N98USK           IFNE      ' '
     C     USK           ANDNE     'O'
     C     USK           COMP      WSSK                               9898
     C                   END
      *
     C                   MOVE      WSSK          XSK1              1
     C     WSSK          COMP      'S'                                    40
     C  N40WSSK          COMP      'K'                                    40
     C  N40WSSK          COMP      'X'                                    40
     C  N40WSSK          IFEQ      'I'
     C     KOKEY1        CHAIN     KOAR                               74
     C   74              SETON                                        30
     C   74              MOVE      'SPA0029'     MSGNR
     C   74              GOTO      SLT1
     C  N74              SETON                                        40
     C                   END
     C   40WSBELV        COMP      *ZEROS                                 40
     C   40              EXSR      BFAKT0
     C                   MOVE      XSK1          WSSK
     C                   MOVE      'M'           XKDA              1
     C  N40              MOVE      ' '           X01B
      *
     C  N98
     CAN 43WSSK          IFEQ      'F'
     C     HEPK5         COMP      'N'                                    98
     C                   END
     C   98              MOVE      'SPS0020'     MSGNR
     C   98              SETON                                        30
     C   98              GOTO      SLT1
      *
     C     WSSK          IFEQ      'S'
     C     HEKDFS        COMP      'X'                                    98
     C                   END
     C  N98HEKDFK        IFEQ      'X'
     C     WSSK          COMP      'K'                                    98
     C  N98
     CAN 43WSSK          COMP      'F'                                    98
     C                   END
     C  N98
     CAN 41
     CORN98
     CAN 42
     CORN98
     CAN 49
     CORN98
     CAN 50
     CORN98
     CAN 46WSSK          IFEQ      'A'
     C     HEKNA         COMP      0                                      98
     C                   END
     C  N98
     CAN 49
     CORN98
     CAN 50
     CORN98
     CAN 41WSSK          IFEQ      'T'
     C     HEKNT         COMP      0                                      98
     C                   END
     C   98              MOVE      'SPS0021'     MSGNR
     C   98              SETON                                        30
     C   98              GOTO      SLT1
      *
      *** TEST GEBYRKODE
      *
     C     KODGEK        CHAIN     KOGER                              97
     C   97              MOVE      'SPG0002'     MSGNR
     C   97              SETON                                        30
     C   97              GOTO      SLT1
     C                   MOVE      KGEUTL        XKDUL
     C     KODG2K        CHAIN     KOG2R                              33
     C     WSVT          IFNE      *BLANKS
     C                   MOVE      WSVT          KGENOT
     C                   END
      *
      *** TEST VALUTAKODE
      *
     C     WSVAL         IFEQ      *BLANKS
     C                   MOVE      FICURR        WSVAL
     C                   ELSE
     C     VALU1K        CHAIN     VALUL01                            96
     C   96              MOVE      'SPV0001'     MSGNR
     C   96              SETON                                        30
     C   96              GOTO      SLT1
     C                   END
      *
      *** TASTET FAKTURA LINJE ER GODKJENT NÅ
      *
     C     WSANT         IFNE      0
     C     WSBELV        ANDNE     *ZEROS
     C                   MULT      WSANT         WSBELV
     C                   MOVE      *ZEROS        WSANT
     C                   END
     C                   EXSR      VALUT2
     C                   Z-ADD     1             XTOTSG
      *
      *** START ENDRING FOR <SPLITT>     23/11-89
      *** TEST MOMS
      *
     C     WSSK          IFNE      'I'                                          1<-B
     C     WSKDM         IFEQ      ' '                                           2<-B
     C     KGEKON        IFEQ      99999                                          3<-B
     C                   MOVE      'N'           WSKDM
     C                   ELSE                                                     3
     C     KG2KON        IFEQ      99999                                           4<-B
     C                   MOVE      'J'           WSKDM
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
      *
     C     WSKDM         IFEQ      'J'                                           2<-B
     C     KGEKON        IFEQ      99999                                          3<-B
     C                   SETON                                        9530
     C                   END                                                      3<-E
     C                   ELSE                                                    2
      *
     C     WSKDM         IFEQ      'N'                                            3<-B
     C     KG2KON        IFEQ      99999                                           4<-B
     C                   SETON                                        9530
     C                   END                                                       4<-E
     C                   ELSE                                                     3
     C                   SETON                                        9530
     C                   END                                                      3<-E
      *
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C   95              MOVE      'SPM0004'     MSGNR
     C   95              GOTO      SLT1
      *
      *** SPLITT ?
      *
     C     KG2XXX        IFEQ      'J'                                          1<-B
     C     WSKDUK        IFNE      'N'                                           2<-B
     C                   MOVE      'S'           WSKDUK
     C     WSBELU        IFEQ      0                                              3<-B
     C     KG2PRO        ANDGT     0
     C     XBELN         MULT(H)   KG2PRO        WSBELU
     C     XBELN         SUB       WSBELU        WSBELU
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C                   MOVE      *ZEROS        WSBELU
     C                   END                                                     2<-E
     C                   ELSE                                                   1
     C     KG2XXX        IFEQ      'H'                                           2B
     C     WSKDUK        IFNE      'N'                                            3B
     C                   MOVE      'H'           WSKDUK
     C     WSBELU        IFEQ      *ZEROS                                          4B
     C                   Z-ADD     XBELN         WSBELU
     C                   END                                                       4E
      *
     C                   ELSE                                                     3
     C                   MOVE      *ZEROS        WSBELU
      *
     C                   END                                                      3E
     C                   ELSE                                                    2
      *
     C     KG2XXX        IFEQ      'L'                                            3B
     C     WSKDUK        IFNE      'N'                                             4B
     C                   MOVE      'L'           WSKDUK
     C     WSBELU        IFEQ      *ZEROS                                           5B
     C     KG2PRO        ANDGT     0
     C     XBELN         MULT(H)   KG2PRO        WSBELU
     C     XBELN         SUB       WSBELU        WSBELU
     C                   END                                                        5E
     C                   ELSE                                                      4
     C                   MOVE      *ZEROS        WSBELU
     C                   END                                                       4E
     C                   ELSE                                                     3
      *
      *
     C     KG2XXX        IFEQ      'B'                                            4B
     C     WSKDUK        IFNE      'N'                                             5B
     C                   MOVE      'B'           WSKDUK
     C     WSBELU        IFEQ      *ZEROS                                           6B
     C     KG2PRO        ANDGT     0
     C     XBELN         MULT(H)   KG2PRO        WSBELU
     C     XBELN         SUB       WSBELU        WSBELU
     C                   END                                                        6E
     C                   ELSE                                                      5
     C                   MOVE      *ZEROS        WSBELU
     C                   END                                                       5E
     C                   ELSE                                                     4
      *
     C                   MOVE      *BLANKS       WSKDUK
     C                   MOVE      *ZEROS        WSBELU
     C                   END                                                      4E
     C                   END                                                      3E
     C                   END                                                     2E
      *
     C                   END                                                    1E
      * VED SPLITT/HOV.B./LEV. MÅ WSBELU FINNES /IKKE STØRRE ENN XBELN
      *
     C                   SETOFF                                       93
     C     WSKDUK        IFNE      ' '
     C     WSKDUK        ANDNE     'N'
     C     XBELN         IFGT      *ZEROS
     C     WSBELU        COMP      *ZEROS                               9393
     C  N93WSBELU        COMP      XBELN                              93
     C                   END
     C   93              SETON                                        30
     C   93              MOVE      'SPK0021'     MSGNR
     C   93              GOTO      SLT1
     C                   END
      *
      * TESTER LEVERANDØR
      *
     C     WSLEVN        IFNE      *ZEROS
     C     LEVE1K        CHAIN     LEVEL01                            92
     C   92              SETON                                        30
     C   92              MOVE      'SPM0007'     MSGNR
     C   92              GOTO      SLT1
     C                   END
      *
      * LEVERANDØR MÅ GIS DERSOM "L"-GEBYR
      *
     C     WSKDUK        IFEQ      'L'
     C     WSLEVN        COMP      *ZEROS                                 92
     C   92              SETON                                        30
     C   92              MOVE      'SPM0007'     MSGNR
     C   92              GOTO      SLT1
     C                   END
      *
      * TESTER KUNDE
      *
     C     WSKUNR        IFNE      *ZEROS
     C     KUND1K        CHAIN     CUNDL01                            73
     C   73              SETON                                        30
     C   73              MOVE      'SPK0052'     MSGNR
     C   73              GOTO      SLT1
     C                   END
      *
      * LEVERANDØR MÅ GIS DERSOM "L"-GEBYR
      *
     C     WSSK          IFEQ      'X'
     C     WSKUNR        COMP      *ZEROS                                 73
     C   73              SETON                                        30
     C   73              MOVE      'SPK0052'     MSGNR
     C   73              GOTO      SLT1
     C                   END
      *
      *
     C   41
     COR 42
     COR 49
     COR 50
     COR 46WSKOM         IFLT      0
     C     WSKOM         ORGT      3
     C                   SETON                                        9430
      *
     C*                    MOVE 'SPK0021' MSGNR
     C                   MOVE      'SPK0034'     MSGNR
      *
     C                   END
      *
     C     WSSK          IFEQ      'I'
     C     KOKEY1        CHAIN     KOAR                               74
     C   74              SETON                                        30
     C   74              MOVE      'SPA0029'     MSGNR
     C                   ELSE
     C     WSAVDR        COMP      *ZEROS                             74
     C   74              SETON                                        30
     C   74              MOVE      'SPA0030'     MSGNR
     C                   END
      *
      * TESTER SAMMENSLÅINGSKODE
      *
     C  N30WSSAMM        IFNE      ' '
     C     WSSAMM        CHAIN     KODSAM                             30
     C   30              MOVE      'SHU0309'     MSGNR
     C                   END
      *
     C  N30WSSK          IFEQ      'K'
     C     WSSK          OREQ      'S'
     C     WSSK          OREQ      'X'
     C                   EXSR      KGSR
     C                   END
     C     SLT1          TAG
     C   30              DO
     C*
     C* START LINJENUMMER
     C*
     C   73
     COR 94              Z-ADD     22            LINNBR
     C   74
     COR 92              Z-ADD     21            LINNBR
     C   93
     COR 95
     COR 96
     COR 97
     COR 98              Z-ADD     20            LINNBR
      *
      * START POSISJONERING
      *
     C   73
     COR 92              Z-ADD     10            POSNBR
     C   74              Z-ADD     41            POSNBR
     C   93              Z-ADD     63            POSNBR
     C   94              Z-ADD     22            POSNBR
     C   95              Z-ADD     37            POSNBR
     C   96              Z-ADD     30            POSNBR
     C   97              Z-ADD     5             POSNBR
     C   98              Z-ADD     2             POSNBR
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     DELFAK        BEGSR
     C***********************************************
     C                   SETOFF                                       3340
     C     FAK2K         SETLL     FAK4
     C                   MOVE      *ZEROS        WSTOTS
     C                   MOVE      *ZEROS        WSTOTK
     C     STDELF        TAG
     C     UAVD          READE     FAK4                                   33
     C  N33UOPD          COMP      FAOPD                              3333
     C   33              GOTO      SLDELF
     C     FAOPKO        IFNE      ' '
     C                   GOTO      STDELF
     C                   END
      *
     C     FAKTK         CHAIN     FAKT                               32
     C   32              GOTO      STDELF
     C     FASK          IFEQ      'A'
     C                   DELETE    FAKTR
     C                   END
      *
     C                   GOTO      STDELF
      *
     C     SLDELF        TAG
     C                   EXSR      BFAKT0
      *
     C                   ENDSR
      *
      ***********************************************
     C     KGSR          BEGSR
      ***********************************************
     C     UUKUKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    UUKUNR
      *
     C     WSSK          IFEQ      'X'
     C                   MOVE      WSKUNR        UUKUNR            8 0
     C                   END
     C     WSSK          IFEQ      'K'
     C                   MOVE      HEKNKF        UUKUNR
     C     UUKUKE        CHAIN     CUNDL01                            33
     C                   END
     C     WSSK          IFEQ      'S'
     C                   MOVE      HEKNSF        UUKUNR
     C     UUKUKE        CHAIN     CUNDL01                            33
     C                   END
     C     KGRENS        IFGT      0
     C     KGRENS        MULT      1000          XKOVER           13 2
     C                   CALL      'SYGE07CL'
     C                   PARM                    FIFIRM
     C                   PARM                    UUKUNR
     C                   PARM                    KSALDO           13 2
     C                   ADD       XBELN         KSALDO
     C     KSALDO        COMP      XKOVER                             30
     C   30              SETON                                        9846
     C   30              MOVE      'SHU0311'     MSGNR
     C                   END
     C                   ENDSR
      ***********************************************
     C     KUNFRA        BEGSR
      ***********************************************
     C                   MOVE      'K'           XSK
     C     FAK2K         SETLL     FAK4
     C                   MOVE      *ZEROS        UKFRA
     C                   SETOFF                                       33
     C     STKFRA        TAG
     C     FAK2K         READE     FAK4                                   33
     C   33              GOTO      SLKFRA
      *
     C  N42
     CANN44
     CANN50              DO
     C                   MOVE      FAVK          WSVK
     C     KODGEK        CHAIN     KOGER                              32
     C   32              MOVE      ' '           XKDUL
     C  N32              MOVE      KGEUTL        XKDUL
     C  N32KGESAD        IFEQ      'J'
     C                   ADD       FABELN        UKFRA
     C                   END
     C                   END
     C   42KGETYP        IFEQ      'FRA'
     C                   ADD       FABELN        UKFRA
     C                   END
     C   44FAVK          IFEQ      'FFE'
     C                   ADD       FABELN        UKFRA
     C                   END
     C   50KGETYP        IFEQ      'SEA'
     C                   ADD       FABELN        UKFRA
     C                   END
     C                   GOTO      STKFRA
      *
     C     SLKFRA        TAG
     C                   MOVE      ' '           XSK
      *
     C     HEADFK        CHAIN     HEADF                              33
     C  N33              MOVE      UKFRA         HEFBK
     C  N33              MOVE      ' '           HEST
     C  N33              UPDATE    HEADFR
     C                   ENDSR
      *
      ***********************************************
     C     SUMBL         BEGSR
      ***********************************************
     C                   MOVE      *ZEROS        WSUTLS
     C                   MOVE      *ZEROS        WSUTLK
     C                   MOVE      *ZEROS        WSTOTS
     C                   MOVE      *ZEROS        WSTOTK
      *
     C     STSUMB        TAG
     C                   SETOFF                                       33
     C     UAVD          READE     FAK4                                   33
     C  N33UOPD          COMP      FAOPD                              3333
     C   33FAK2K         SETLL     FAK4
     C   33              GOTO      SLSUMB
     C                   MOVE      FAVK          WSVK
     C     KODGEK        CHAIN     KOGER                              32
     C   32              MOVE      ' '           XKDUL
     C  N32              MOVE      KGEUTL        XKDUL
     C  N32FAVT          IFNE      *BLANKS
     C                   MOVE      FAVT          KGENOT
     C                   END
      *
     C                   Z-ADD     1             XTOTSG
     C                   MOVE      FASK          WSSK
     C                   EXSR      TOTSR
     C                   GOTO      STSUMB
      *
     C     SLSUMB        TAG
     C                   MOVE      *BLANKS       WSSK
     C                   MOVE      *BLANKS       WSVK
      *
     C                   ENDSR
      *
      ***********************************************
     C     TOTSR         BEGSR
      ***********************************************
     C     FABELN        MULT      XTOTSG        XBELN            13 2
     C     FASK          IFEQ      'S'
     C                   ADD       XBELN         WSTOTS
     C     FAKDUL        IFEQ      'J'
     C                   ADD       XBELN         WSUTLS
     C                   END
     C                   END
      *
     C     FASK          IFEQ      'K'
     C                   ADD       XBELN         WSTOTK
     C     FAKDUL        IFEQ      'J'
     C                   ADD       XBELN         WSUTLK
     C                   END
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     UTLSR         BEGSR
      ***********************************************
      *TOTALT OMSKREVET
     C                   MOVE      'J'           XKMOMS            1
     C                   MOVE      'N'           XSMOMS            1
     C                   MOVE      'J'           XXMOMS            1
      *
     C     KO2MVK        IFNE      ' '
     C                   MOVE      KO2MVK        XKMOMS
     C                   END
      *
     C     KO2MVS        IFNE      ' '
     C                   MOVE      KO2MVS        XSMOMS
     C                   END
      *
      *
      * NULLSTILLER UTLEGGSGRUNNLAGENE
      *
     C                   MOVE      *ZEROS        WSUTLS
     C                   MOVE      *ZEROS        WSUTLK
     C                   MOVE      *ZEROS        WSUTLX           10 2
     C     FAK2K         SETLL     FAK4
     C                   SETOFF                                       33
      *
      * RUTINE FOR Å SLETTE UTL-POSTER
      *
     C     STUTL1        TAG
     C     UAVD          READE     FAK4                                   33
     C  N33UOPD          COMP      FAOPD                              3333
     C   33              GOTO      KJØUTL
      *
      *
      *
     C     FAVK          IFEQ      'UTL'                                        1<-B
      *
     C     FAKTK         CHAIN     FAKT                               32
     C  N32              DELETE    FAKTR
      *
      *
      * TAR VARE PÅ MOMSKODE PÅ DEN AKTUELLE SIDE
      *
      *
     C  N32FASK          IFEQ      'K'                                           2<-B
     C                   MOVE      FAKDM         XKMOMS
     C                   ELSE                                                    2
     C     FASK          IFEQ      'S'                                            3<-B
     C                   MOVE      FAKDM         XSMOMS
     C                   ELSE                                                    2
     C     FASK          IFEQ      'X'                                            3<-B
     C                   MOVE      FAKDM         XXMOMS
     C                   END                                                      3<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   GOTO      STUTL1
     C                   END                                                    1<-E
      *
      * SLUTT PÅ LEST LINJE MED KODE 'UTL'
      *
      *
      * FAKDUL = J SKAL VÆRE MED I GRUNNLAG
      *
     C     FAKDUL        IFEQ      'J'                                          1<-B
     C     FASK          IFEQ      'S'                                           2<-B
     C                   ADD       FABELN        WSUTLS
     C                   ELSE                                                    2
     C     FASK          IFEQ      'K'                                            3<-B
     C                   ADD       FABELN        WSUTLK
     C                   END                                                      3<-E
     C     FASK          IFEQ      'X'                                            3<-B
     C                   ADD       FABELN        WSUTLX
     C                   MOVE      FAKUNR        XXXKUN            8 0
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C                   GOTO      STUTL1
      *
      * FØRST KJØPERSIDEN  'K'
      *
      *
     C     KJØUTL        TAG
      *
      * HVIS GRUNNLAG ER NULL HOPPES OVER
      *
     C     WSUTLK        IFEQ      *ZEROS
     C                   GOTO      SELUTL
     C                   END
      *
      * INITIERER FELTER HENTER VERDI FRA KUNDE
      *
     C                   MOVE      HEKNKF        WSKUNR
     C     KUND1K        CHAIN     CUNDL01                            33
      *
     C     SYUTLP        IFEQ      99.99
     C                   GOTO      SELUTL
     C                   END
      *
      * FINNER AKTUELL SATS
      *
     C                   Z-ADD     FIUPS         UPROSE            4 2
     C                   Z-ADD     FIUPMN        UMINIM            4 0
     C     SYUTLP        IFNE      0
     C                   Z-ADD     SYUTLP        UPROSE
     C                   END
     C     SYMINU        IFNE      *ZEROS
     C                   Z-ADD     SYMINU        UMINIM
     C                   END
      *
      *
     C                   MOVE      *BLANKS       X01B
     C                   MOVE      *BLANKS       WSKDUK
     C                   MOVE      *ZEROS        WSBELU
     C                   MOVE      'K'           WSSK
     C                   MOVE      'UTL'         WSVK
     C                   MOVE      *ZEROS        WSAGRN            9 0
     C                   MOVE      *BLANKS       WSVT
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      ' '           WSKDUK
     C                   MOVE      *ZEROS        WSBELU
     C     WSUTLK        MULT      UPROSE        WSBELV
     C     WSBELV        DIV(H)    100           XBEL11           11 0
     C                   Z-ADD     XBEL11        WSBELV
     C                   Z-ADD     WSBELV        XBELN
      *
      *
      *
      * BELØP MINDRE ENN MINIMUM VED POSITIV
      *
     C     WSUTLK        IFGT      *ZEROS
     C     XBELN         IFLT      UMINIM                                          4<-B
     C                   Z-ADD     UMINIM        XBELN
     C                   Z-ADD     UMINIM        WSBELV
     C                   END                                                       4<-E
     C                   ELSE                                                     3
      *
      * BELØP STØRRE ENN MINIMUM VED NEGATIV
      *
     C                   Z-SUB     UMINIM        UMINIM
     C     XBELN         IFGT      UMINIM                                          4<-B
     C                   Z-ADD     UMINIM        XBELN
     C                   Z-ADD     UMINIM        WSBELV
     C                   END                                                       4<-E
     C                   Z-SUB     UMINIM        UMINIM
     C                   END                                                      3<-E
      *
     C                   MOVE      XKMOMS        WSKDM
     C   46
     COR 47
     COR 48              MOVE      TRMVA         WSKDM
     C                   MOVE      ' '           XKDUL             1
      *
      *
     C                   EXSR      MOVWSF
     C                   EXSR      VALUTA
     C     SYUTLP        IFEQ      *ZEROS                                        2<-B
     C                   MOVE      'B'           XKDA
     C                   ELSE                                                    2
     C                   MOVE      'A'           XKDA
     C                   END                                                     2<-E
     C                   MOVE      XKDA          FAKDA
     C                   EXSR      NYFAK
      *
      *
      * UTLEGGSPROVISJON PÅ SELGERSIDEN
      *
     C     SELUTL        TAG
      *
      *
      * HVIS GRUNNLAG ER NULL HOPPES OVER
      *
     C     WSUTLS        IFEQ      *ZEROS
     C                   GOTO      FRIUTL
     C                   END
      *
      * INITIERER FELTER HENTER VERDI FRA KUNDE
      *
     C                   MOVE      HEKNSF        WSKUNR
     C     KUND1K        CHAIN     CUNDL01                            33
      *
     C     SYUTLP        IFEQ      99.99
     C                   GOTO      FRIUTL
     C                   END
      *
      * FINNER AKTUELL SATS
      *
     C                   Z-ADD     FIUPS         UPROSE            4 2
     C                   Z-ADD     FIUPMN        UMINIM            4 0
     C     SYUTLP        IFNE      0
     C                   Z-ADD     SYUTLP        UPROSE
     C                   END
     C     SYMINU        IFNE      *ZEROS
     C                   Z-ADD     SYMINU        UMINIM
     C                   END
     C                   MOVE      'S'           WSSK
     C                   MOVE      'UTL'         WSVK
     C                   MOVE      *BLANKS       WSVT
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      ' '           WSKDUK
     C                   MOVE      *ZEROS        WSBELU
     C     WSUTLS        MULT      UPROSE        WSBELV
     C     WSBELV        DIV(H)    100           XBEL11           11 0
     C                   Z-ADD     XBEL11        WSBELV
     C                   Z-ADD     WSBELV        XBELN
      *
     C     WSUTLS        IFGT      0                                              3<-B
     C     XBELN         IFLT      UMINIM                                          4<-B
     C                   Z-ADD     UMINIM        XBELN
     C                   Z-ADD     UMINIM        WSBELV
     C                   END                                                       4<-E
     C                   ELSE                                                     3
     C                   Z-SUB     UMINIM        UMINIM
     C     XBELN         IFGT      UMINIM                                          4<-B
     C                   Z-ADD     UMINIM        XBELN
     C                   Z-ADD     UMINIM        WSBELV
     C                   END                                                       4<-E
     C                   Z-SUB     UMINIM        UMINIM
     C                   END                                                      3<-E
      *
     C                   MOVE      XSMOMS        WSKDM
     C   46
     COR 47
     COR 48              MOVE      TRMVA         WSKDM
     C                   MOVE      ' '           XKDUL             1
      *
      *
     C                   EXSR      MOVWSF
     C                   EXSR      VALUTA
     C     SYUTLP        IFEQ      *ZEROS                                        2<-B
     C                   MOVE      'B'           XKDA
     C                   ELSE                                                    2
     C                   MOVE      'A'           XKDA
     C                   END                                                     2<-E
     C                   MOVE      XKDA          FAKDA
     C                   EXSR      NYFAK
      *
      *
      *
      * UTLEGGSPROVISJON PÅ FRIE PARTER
      *
      *
      *
     C     FRIUTL        TAG
      *
      *
      * HVIS GRUNNLAG ER NULL HOPPES OVER
      *
     C     WSUTLX        IFEQ      *ZEROS
     C                   GOTO      ENDUTL
     C                   END
      *
      * INITIERER FELTER HENTER VERDI FRA KUNDE
      *
     C                   MOVE      XXXKUN        WSKUNR
     C     KUND1K        CHAIN     CUNDL01                            33
      *
     C     SYUTLP        IFEQ      99.99
     C                   GOTO      ENDUTL
     C                   END
      *
      * FINNER AKTUELL SATS
      *
     C                   Z-ADD     FIUPS         UPROSE            4 2
     C                   Z-ADD     FIUPMN        UMINIM            4 0
     C     SYUTLP        IFNE      0
     C                   Z-ADD     SYUTLP        UPROSE
     C                   END
     C     SYMINU        IFNE      *ZEROS
     C                   Z-ADD     SYMINU        UMINIM
     C                   END
     C                   MOVE      'X'           WSSK
     C                   MOVE      'UTL'         WSVK
     C                   MOVE      *BLANKS       WSVT
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      ' '           WSKDUK
     C                   MOVE      *ZEROS        WSBELU
     C     WSUTLX        MULT      UPROSE        WSBELV
     C     WSBELV        DIV(H)    100           XBEL11           11 0
     C                   Z-ADD     XBEL11        WSBELV
     C                   Z-ADD     WSBELV        XBELN
      *
     C     WSUTLX        IFGT      0                                              3<-B
     C     XBELN         IFLT      UMINIM                                          4<-B
     C                   Z-ADD     UMINIM        XBELN
     C                   Z-ADD     UMINIM        WSBELV
     C                   END                                                       4<-E
     C                   ELSE                                                     3
     C                   Z-SUB     UMINIM        UMINIM
     C     XBELN         IFGT      UMINIM                                          4<-B
     C                   Z-ADD     UMINIM        XBELN
     C                   Z-ADD     UMINIM        WSBELV
     C                   END                                                       4<-E
     C                   Z-SUB     UMINIM        UMINIM
     C                   END                                                      3<-E
      *
     C                   MOVE      XXMOMS        WSKDM
     C   46
     COR 47
     COR 48              MOVE      TRMVA         WSKDM
     C                   MOVE      ' '           XKDUL             1
      *
      *
     C                   EXSR      MOVWSF
     C                   EXSR      VALUTA
     C     SYUTLP        IFEQ      0                                             2<-B
     C                   MOVE      'B'           XKDA
     C                   ELSE                                                    2
     C                   MOVE      'A'           XKDA
     C                   END                                                     2<-E
     C                   MOVE      XKDA          FAKDA
     C                   EXSR      NYFAK
      *
      *
      *
     C     ENDUTL        ENDSR
      *
      ***********************************************
     C     VALUTA        BEGSR
      ***********************************************
      * Converts from local currency to whatever currency that is
      * to be used on the invoice.
      * If the invoice is to be written in local currency or the line
      * already is in the right currency, nothing is done.
      *
     C                   SETOFF                                       3435
     C     FASK          IFNE      'I'
     C     FASK          COMP      'S'                                353534
     C   34HEVALS        COMP      *BLANKS                                31
     C   34
     CANN31HEVALS        COMP      FICURR                                 31
     C   35HEVALK        COMP      *BLANKS                                31
     C   35
     CANN31HEVALK        COMP      FICURR                                 31
     C   31              GOTO      SLVAL
      *
     C   34FAVAL         COMP      HEVALS                                 31
     C   35FAVAL         COMP      HEVALK                                 31
     C   31              GOTO      SLVAL
      *
     C   34              MOVE      HEVALS        WSVAL
     C   35              MOVE      HEVALK        WSVAL
     C                   ELSE
     C                   MOVE      FAVAL         WSVAL
     C                   END
      *
     C     VALU1K        CHAIN     VALUL01                            31
     C  N31VALKU2        IFNE      0
     C                   Z-ADD     VALKU2        VALKU1
     C                   END
     C  N31WSKURS        IFNE      0
     C                   Z-ADD     WSKURS        VALKU1
     C                   END
      *
     C     FABELN        MULT      OMRFAK        XWORK            15 4
     C     XWORK         DIV(H)    VALKU1        FABELV
     C   34              MOVE      HEVALS        FAVAL
     C   35              MOVE      HEVALK        FAVAL
      *
     C     SLVAL         ENDSR
      *
      ***********************************************
     C     VALUT2        BEGSR
      ***********************************************
      * Converts from currency on entered line or on line in price
      * agreement to local currency (FICURR in file FIRM)
      * The amount i local currency is then stored in "XBELN" (later
      * moved into fiel FABELN) This is the amount for the econ.system.
      * This amount may later be converted into the currency that is
      * to be used on the invoice (By subr. VALUTA) if the invoice
      * currency is not identical with the local currency (FICURR)
      *
      *
      * VED FFI TESTES OM KURS FINNES I IATAREGISTER
     C     KGETYP        IFEQ      'FFI'
     C     VALU1K        CHAIN     VAIAL01                            95
     C   95VALU1K        CHAIN     VALUL01                            95
     C                   ELSE
     C     VALU1K        CHAIN     VALUL01                            95
     C                   END
     C  N95VALKU2        IFNE      0
     C                   MOVE      VALKU2        VALKU1
     C                   END
     C  N95WSKURS        IFNE      0
     C                   MOVE      WSKURS        VALKU1
     C                   END
      *                    END
      *
     C  N95              DO
     C     WSBELV        MULT      VALKU1        XWORK
     C     XWORK         DIV(H)    OMRFAK        XBELN
      *
      *** ØKER MED TILLEGGS BANKKURS
      *
     C   43WSKURS        IFEQ      0
     C     WSVAL         ANDNE     FICURR
      * IKKE TILLEGG BANKKURS VED UTENLANDSK VALUTA
     C     WSSK          IFEQ      'S'
     C     HEVALS        ANDNE     FICURR
     C                   GOTO      UTVALT
     C                   END
     C     WSSK          IFEQ      'K'
     C     HEVALK        ANDNE     FICURR
     C                   GOTO      UTVALT
     C                   END
      *
      *
      * CHECKS IF CUSTOMER HAVE OWN AGREEMENT
      *
     C     WSSK          IFEQ      'S'
     C     CCK1          CHAIN     KODTCC                             33
     C                   ELSE
     C     CCK2          CHAIN     KODTCC                             33
     C                   END
      *
     C   33              MULT(H)   XTILBA        XBELN
     C  N33KCCVA         DIV       100           YTILBA            5 4
     C  N33              ADD       1             YTILBA
     C  N33              MULT(H)   YTILBA        XBELN
     C                   END
      *
      *** ØKER FRAKT MED CCFEE
      *
     C   43KGETYP        IFEQ      'FFI'
     C     WSVAL         ANDNE     FICURR
     C     WSCCF         IFEQ      'J'
     C                   EXSR      CCFEE
     C                   END
     C                   END
      *
     C                   END
      *
      *
     C     UTVALT        TAG
      *
     C                   SETOFF                                       33
     C                   ENDSR
      *
      ***********************************************
     C     BFAKT0        BEGSR
      ***********************************************
      * IND 86 ON I RUTINE BERFRA BETYR DIREKTEFRAKT ER BEREGNET
      *
     C                   MOVE      *ZEROS        XPROS            10 3
     C                   MOVE      *ZEROS        UUAVNR
     C                   MOVE      WSSK          WSSKIN            1
     C   41
     COR 42
     COR 49
     COR 50
     COR 46              SETOFF                                           86
     C                   MOVE      *BLANKS       X01B
     C   40              MOVE      WSVK          XGEBY
     C  N40              MOVE      *ZEROS        WSKURS
      *
      *
      * "A-LINJER" FOR AGENT/AMETA KUN NÅR IKKE S/K LINJE MOT AGENTSIDE
      * (S VED IMP. / K VED EKSP.) HVIS S/K FINNES -->"N" I "AGAVRE"
      *
     C                   MOVE      'J'           AGAVRE            1
      *
      ***   H A R   S E L G E R   A V T A L E
      *
      *
      *** A G E N T        F A K T U R E R I N G
      * KUN LAND IMPORT/LAND EKSPORT
      *
     C     STBFAG        TAG
     C*
     C     HEKNA         IFEQ      0
     C                   GOTO      SLBF0
     C                   END
      *
      *
     C                   MOVE      *ZEROS        XPROS
      *
     C     HEFBV         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEFBV         XINT
     C                   END
      *
     C  N40              MOVE      'A'           WSSK
     C  N40              MOVE      'A'           XTSK
     C  N40              MOVE      *BLANKS       WSVT
     C  N40              MOVE      *BLANKS       XGEBY
     C                   MOVE      *BLANKS       XAVTT
      *
      ***   H A R   A G E N T     A V T A L E
      *
     C                   MOVE      HEKNA         XKNR
     C                   MOVE      HEKNA         XTKNR
     C                   MOVE      '0'           XAVTN
      *
     C                   EXSR      AVTSR
      *
      *** SJEKK BRUTTOTARIFF FOR AGENT
      *
     C   33              MOVE      'A'           XAVTN
     C   33              EXSR      BRUTAR
      *
     C     SLBF0         ENDSR
      *
      ***********************************************
     C     CCFEE         BEGSR
      ***********************************************
      *
      * CHECKS IF CUSTOMER HAVE OWN AGREEMENT
      *
     C     WSSK          IFEQ      'S'
     C     CCK1          CHAIN     KODTCC                             33
     C                   ELSE
     C     CCK2          CHAIN     KODTCC                             33
     C                   END
      *
     C   33XBELN         MULT      XBL1          XCCBEL            7 0
     C   33XCCBEL        IFLT      KDIBL2
     C                   Z-ADD     KDIBL2        XCCBEL
     C                   END
     C  N33XBELN         MULT      KCCCC         XCCBEL            7 0
     C  N33              DIV       100           XCCBEL            7 0
     C  N33XCCBEL        IFLT      KCCMI
     C                   Z-ADD     KCCMI         XCCBEL
     C                   END
     C                   ADD       XCCBEL        XBELN
      *
     C                   ENDSR
      *
      ***********************************************
     C     AVTSR         BEGSR
      ***********************************************
     C                   MOVE      HEFR          XFRAN
     C   41
     COR 42
     COR 49
     COR 50
     COR 46              MOVE      HEFR          XTFRAN
     C                   MOVE      HEOT          XOPDT
     C   41
     COR 42
     COR 49
     COR 50
     COR 46              MOVE      HEOT          XTOT
      * Indic. for 1 or more outdatede price agreement lines
     C                   SETOFF                                       79
     C                   MOVE      'N'           AVTALE            1
     C                   EXSR      BFAKT
      *
     C   33              GOTO      SLAVT
      * At least 1 valid price agreement line is found by BFAKT
     C     STAVT         TAG
     C                   EXSR      FBELØ2
     C                   SETOFF                                       32
     C     INOM01        TAG
     C     XKNR          READE     PRIK                                   32
     C  N32XAVTN         COMP      PKAVTN                             3232
     C  N32              EXSR      TSTGIO
      * This line was omitted - are there more lines??
     C  N32
     CAN 78              GOTO      INOM01
     C  N32              DO
     C                   MOVE      PKTNR         WSTNR
     C  N40              MOVE      PKMVA         WSKDM
     C  N40              GOTO      STAVT
     C                   END
      *
      *
      * Hvis BARE G/H-LINJER funnet-skal brutto gebyrfordeling brukes
      * (33 ON=Gå i brutto gebyrfordeling/"Hvem belastes hva" )
      * (G/H er AVVIK FRA STANDARDPRISER i "Hvem belstes hva.")
      *
     C     AVTALE        IFEQ      'N'
     C                   SETON                                        33
     C                   ELSE
      * Kundeavtale (utenom G/H linjer) foreligger......
      * G/H linjer alt laget- (ARRAY GNT SORTERT/ULIK BLANK)- slett de
      * (G/H linjer har ofte INGEN begrensninger da det styres av
      *  "Hvem belastes hva - systemet" om de skal med eller ikke)
     C     GNT(20)       IFNE      *BLANKS
     C                   EXSR      DELGH
     C                   END
     C                   END
     C     SLAVT         ENDSR
      *
      ***********************************************
     C     BRUTAR        BEGSR
      ***********************************************
     C  N40              MOVE      *BLANKS       XGEBY
     C                   MOVE      '    ALLE'    XKNR
     C   40              GOTO      STBRUT
      *
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      HEFR          XFRAN
     C                   MOVE      HEOT          XOPDT
      *
     C                   EXSR      BFAKT
     C   33              GOTO      SLBRUT
      *
     C     STBRUT        TAG
     C  N40PKAVTT        COMP      'X'                                    33
     C  N40
     CAN 33              GOTO      STBRU2
      *
     C   41
     COR 42
     COR 49
     COR 50
     COR 46              DO
      *
      * HENT GEBYRKODE INFO
      *
     C   40KODGEK        CHAIN     KOGER                              99
     C  N40KODGEA        CHAIN     KOGER                              99
     C  N41
     CANN42
     CANN46KGETYP        COMP      'SEA'                                  99
     C  N49
     CANN50KGETYP        COMP      'FRA'                                  99
     C  N99KGETYP        COMP      'FR1'                                  99
     C  N99KGETYP        COMP      'FR2'                                  99
     C  N99KGETYP        COMP      'FRI'                                  99
     C  N99KGETYP        COMP      'TGI'                                  99
     C  N99KGETYP        COMP      'TGF'                                  99
     C                   END
      *
     C                   EXSR      FBELØ
      * JOV 05.02.91 - HOPP UT ETTER EN LEST PRIK/PRIS VED MANUELL
      * TASTING (FOR IKKE Å MISTE EVT. D/L I X01B (ANNEN ENHET) )
     C   40              GOTO      SLBRUT
      *
     C     STBRU2        TAG
     C                   SETOFF                                       32
     C     XKNR          READE     PRIK1                                  32
     C  N32XFRAN         COMP      PKFR01                             3232
     C  N32XOPDT         COMP      PKOT01                             3232
     C  N32XAVTN         COMP      PKAVTN                             3232
     C  N32              EXSR      TSTGIO
      * This price line was omitted - are there more lines??
     C  N32
     CAN 78              GOTO      STBRU2
     C  N32              DO
     C                   MOVE      PKTNR         WSTNR
     C  N40              MOVE      PKMVA         WSKDM
     C  N40              GOTO      STBRUT
     C                   END
      *
     C     SLBRUT        ENDSR
      *
      ***********************************************
     C     BFAKT         BEGSR
      ***********************************************
      *  Tests that there is at least one valid price line in the price
      *  agreement system (for a client (AVTSR) or for "ALLE" (BRUTAR))
      *  33 OFF after this subroutine - at least one valid line found.
      *  79 ON  one (or more) line(s) had elapsed datelimit.
      *
      *                    MOVE HEFBV     XINT
     C     HEFBV         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEFBV         XINT
     C                   END
      *
      *  OBS OBS**** INGEN LESING FRA PRIK/PRIS ER FORETATT ENNÅ
      *  OBS OBS**** (I BFAKT0 - AVTSR  /  BFAKT0 - BRUTAR)
      *  OBS OBS**** X01B ER VEL DERFOR UDEFINERT ENNÅ
      *  OBS OBS**** ER DE FØLGENDE 10-15 LINJER BARE TULL ????????
     C     X01B          IFEQ      'X'
     C                   Z-ADD     HENT          XINT
     C                   END
     C     X01B          IFEQ      'L'
     C                   Z-ADD     HENTF         XINT
     C                   END
     C     X01B          IFEQ      'B'
     C                   Z-ADD     HEVKT         XINT
     C                   END
     C     X01B          IFEQ      'M'
     C     HEM3          ADD(H)    0.499         XINT
     C                   END
     C     X01B          IFGE      '0'
     C     X01B          ANDLE     '9'
     C                   MOVE      'D'           X01B
     C                   END
     C     X01B          IFEQ      'D'
     C                   Z-ADD     0             XINT
     C                   END
      *
     C                   SETOFF                                       33
      **
     C     XKNR          IFEQ      '    ALLE'
     C     PRIK1K        SETLL     PRIK1
     C                   ELSE
     C     PRIKK         SETLL     PRIK
     C                   END
      **
     C     INOM02        TAG
      **
     C     XKNR          IFEQ      '    ALLE'
     C     XKNR          READE     PRIK1                                  33
     C  N33XFRAN         COMP      PKFR01                             3333
     C  N33XOPDT         COMP      PKOT01                             3333
     C                   ELSE
     C     XKNR          READE     PRIK                                   33
     C                   END
     C  N33XAVTN         COMP      PKAVTN                             3333
     C  N33
     CAN 40XGEBY         COMP      PKGEBY                             3333
     C  N33              EXSR      TSTGIO
      * This line was omitted - are there more ??
     C  N33
     CAN 78              GOTO      INOM02
     C  N33              DO
     C                   MOVE      PKTNR         WSTNR
     C  N40              MOVE      PKMVA         WSKDM
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     FBELØ2        BEGSR
      ***********************************************
      *
      *** KALLES HVIS KUNDEN HAR AVTALE
      *
     C   41
     COR 42
     COR 49
     COR 50
     COR 46              DO
     C     KODGEA        CHAIN     KOGER                              99
     C  N41
     CANN42
     CANN46KGETYP        COMP      'SEA'                                  99
     C  N49
     CANN50KGETYP        COMP      'FRA'                                  99
     C  N99KGETYP        COMP      'FR1'                                  99
     C  N99KGETYP        COMP      'FR2'                                  99
     C  N99KGETYP        COMP      'FRI'                                  99
     C  N99KGETYP        COMP      'TGI'                                  99
     C  N99KGETYP        COMP      'TGF'                                  99
     C                   END
      *
      * HENTER PRIS I BRUTTOTARIFF VED KODE P OG B OG X H
      *
     C                   MOVE      *ZEROS        XPROS
     C     PKAVTT        COMP      'P'                                    32
     C  N32
     CAN 40PKAVTT        COMP      'X'                                    32
     C  N32PKAVTT        COMP      'H'                                    32
     C   32              Z-ADD     PKBELØ        XPROS
     C  N32PKAVTT        COMP      'B'                                    32
     C   99
     COR 32              EXSR      FBELØ
     C     PKAVTT        COMP      'B'                                    32
     C  N32PKAVTT        COMP      'P'                                    32
     C  N32
     CAN 40PKAVTT        COMP      'X'                                    32
     C  N32PKAVTT        COMP      'H'                                    32
     C  N32
     CAN 99              SETON                                        32
     C   32              EXSR      FYLARR
     C   32              GOTO      SLFBL2
      *
      * BEHANDLER ANDRE KODER ENN B P OG X H
      *
     C                   MOVE      PKGEBY        XGEBY
     C                   MOVE      PKAVTT        XAVTT
      *
      *                    MOVE HEFBV     XINT
     C     HEFBV         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEFBV         XINT
     C                   END
      *
     C     X01B          IFEQ      'X'
     C                   MOVE      HENT          XINT
     C                   END
     C     X01B          IFEQ      'L'
     C                   Z-ADD     HENTF         XINT
     C                   END
     C     X01B          IFEQ      'B'
     C                   Z-ADD     HEVKT         XINT
     C                   END
     C     X01B          IFEQ      'M'
     C     HEM3          ADD(H)    0.499         XINT
     C                   END
     C     X01B          IFGE      '0'
     C     X01B          ANDLE     '9'
     C                   MOVE      'D'           X01B
     C                   END
      *
     C     X01B          IFEQ      'D'
     C                   Z-ADD     0             XINT
     C                   END
      *
      *** START BEHANDLING AV T Y OG G
      *
     C     PKAVTT        COMP      'T'                                3232
     C   32PKAVTT        COMP      'G'                                3232
     C   32
     CAN 40PKAVTT        COMP      'Y'                                3232
     C   32              GOTO      STFBL2
      *
     C     PRIKK         SETLL     PRIK
      **
     C     INOM03        TAG
      **
      *   TESTER INCLUDE OMITBEGREPER
      *
     C     XKNR          READE     PRIK                                   32
     C  N32XAVTN         COMP      PKAVTN                             3232
     C  N32              EXSR      TSTGIO
     C  N32
     CAN 78              GOTO      INOM03
     C  N32
     CAN 41
     CORN32
     CAN 49
     CORN32
     CAN 43XGEBY         COMP      PKGEBY                             3232
     C   32              GOTO      STFBL2
      *
     C                   MOVE      PKBELØ        PRBELØ
     C  N40              MOVE      PKGEBY        WSVK
     C                   MOVE      PKFVAL        WSVAL
     C                   EXSR      SRTAB
     C  N40
     CANN99PKAVTT        IFEQ      'B'
     C                   MOVE      'B'           XKDA
     C                   ELSE
     C                   MOVE      'A'           XKDA
     C                   END
     C  N40              DO
     C                   MOVE      'J'           NYPXX             1
     C   41              EXSR      NYPA
     C   42              EXSR      NYPB
     C   43              EXSR      NYPC
     C   44              EXSR      NYPD
     C   45              EXSR      NYPE
     C   46              EXSR      NYPH
     C   49              EXSR      NYPF
     C   50              EXSR      NYPG
     C                   MOVE      *ZEROS        WSAGRN
     C                   MOVE      ' '           NYPXX             1
     C                   END
      *
      * VED KODE = G   LATER SOM AVTALE IKKE ER FUNNET
      *
     C                   EXSR      FYLARR
      *
      *** SETTE PEKER TIL NESTE RECORD
     C     STFBL2        TAG
     C                   MOVE      'Z'           XAVTT
     C     PRIKK         SETLL     PRIK
      *
     C     SLFBL2        ENDSR
      *
      ***********************************************
     C     FBELØ         BEGSR
      ***********************************************
      *
      *** HENTE DATA FRA BRUTTOTARIFF      PRIK ER LEST
     C  N40              MOVE      PKGEBY        WSVK
     C                   MOVE      PKFVAL        WSVAL
      *
      *                    MOVE HEFBV     XINT
     C     HEFBV         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEFBV         XINT
     C                   END
      *
     C                   SETOFF                                       32
      *
      *** HENTE BRUTTO GEBYR
      *
     C  N99              DO
     C     PRISKK        SETLL     PRIS
     C     WSTNR         READE     PRIS                                   32
      *
      *** VED ANNEN ENHET MÅ SETTE LOWER LIMIT MED RIKTIG VERDI
      *
     C  N32X01B          IFNE      ' '
     C                   EXSR      PRSETL
     C                   END
     C  N32PRGEBY        COMP      WSVK                               3232
     C                   END
      *
     C                   MOVE      HEFBV         XXFBV             9 0
     C                   MOVE      'N'           XSJØ              1
     C   99              EXSR      BERFRA
     C     XSJØ          IFEQ      'N'
     C  N32              EXSR      SRTAB
     C                   MOVE      XXFBV         HEFBV
      *
     C  N40
     CANN99PKAVTT        IFEQ      'P'
     C     PKAVTT        OREQ      'H'
     C                   MOVE      'A'           XKDA
     C                   ELSE
     C                   MOVE      'B'           XKDA
     C                   END
     C                   END
      *
     C  N32
     CANN40              DO
     C                   MOVE      'J'           NYPXX             1
     C* FORDELINGSLINJER LEGGES UT I EGET PROGRAM
     C     KGETYP        IFNE      'TGF'
     C   41              EXSR      NYPA
     C   42              EXSR      NYPB
     C   43              EXSR      NYPC
     C   44              EXSR      NYPD
     C   45              EXSR      NYPE
     C   46              EXSR      NYPH
     C   49              EXSR      NYPF
     C   50              EXSR      NYPG
     C                   END
     C                   MOVE      *ZEROS        WSAGRN
     C                   MOVE      ' '           NYPXX             1
     C                   END
      *
     C                   ENDSR
      *
      *
      ***********************************************
     C     TSTGIO        BEGSR
      ***********************************************
      * Joinfile PRJOIN (= PRGE (Urspr/Franka/Opd.ty.) + PRLK (landk.)
      *                  + PRFS (FRASTED) + PRTS (Tilsted))
      *          contains all include/omit conditions possible for one
      *          priceline (max. include or omit per condition)
      *
     C                   SETOFF                                       78
      *
      * HOPPER OVER GENERELLE GEBYRER FRA BRUTTO VED AVTALE
      *
     C     PKGEBY        LOOKUP    GNT                                    80
     C   80              SETON                                            78
     C   78              GOTO      UTGIO
     C     PKAVTT        IFEQ      'G'
     C     PKAVTT        OREQ      'H'
     C     BRUKEY        CHAIN     PRIK1D                             80
     C   80              SETON                                        78
     C   78              GOTO      UTGIO
     C                   END
      *
      *
     C     PRJOIK        CHAIN     PRJOIN                             80
     C  N80              DO                                                     I
      * ______________________________
      * Ursprungskode - Include / Omit
      * """"""""""""""""""""""""""""""
     C     PKURIO        IFNE      ' '                                          II
     C     PKURIO        IFEQ      'I'                                          III
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HEUR          LOOKUP    UR                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit må begrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HEUR          LOOKUP    UR                                     80
     C   80              SETON                                        78
     C                   END                                                    III
     C                   END                                                    II
      * ___________________________________
      * Frankatur/Oppdt. er låst ved brutto
      * """""""""""""""""""""""""""""""""""
     C     XKNR          IFNE      '    ALLE'                                   II
      * ______________________________
      * Frankatur     - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKFRIO        IFNE      ' '                                          III
     C     PKFRIO        IFEQ      'I'                                          IIII
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HEFR          LOOKUP    FR                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HEFR          LOOKUP    FR                                     80
     C   80              SETON                                        78
     C                   END                                                    IIII
     C                   END                                                    III
      *
      * ______________________________
      * Oppdr.type    - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKOTIO        IFNE      ' '                                          III
     C     PKOTIO        IFEQ      'I'                                          IIII
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HEOT          LOOKUP    OT                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i-arrayet (->80 off)
     C                   SETOFF                                       80
     C     HEOT          LOOKUP    OT                                     80
     C   80              SETON                                        78
     C                   END                                                    IIII
     C                   END                                                    III
      *
     C                   END                                                    II
      *
      * ______________________________
      * Landkode     - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKLKIO        IFNE      ' '                                          II
     C     PKLKIO        IFEQ      'I'                                          III
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HELKA         LOOKUP    LK                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit må begrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HELKA         LOOKUP    LK                                     80
     C   80              SETON                                        78
     C                   END                                                    III
     C                   END                                                    II
      *
      *
      * ______________________________
      * Frasted      - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKFSIO        IFNE      ' '                                          II
     C     PKFSIO        IFEQ      'I'                                          III
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HESDF         LOOKUP    FS                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HESDF         LOOKUP    FS                                     80
     C   80              SETON                                        78
     C                   END                                                    III
     C                   END                                                    II
      *
      * ______________________________
      * Tilsted      - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKTSIO        IFNE      ' '                                          II
     C     PKTSIO        IFEQ      'I'                                          III
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HESDT         LOOKUP    TS                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HESDT         LOOKUP    TS                                     80
     C   80              SETON                                        78
     C                   END                                                    III
     C                   END                                                    II
      * ______________________________
      * Laste/lossested - Include / Omit
      *(Gebyrer som er betinget av valgfrie felt tas
      * aldri med dersom feltet i oppdraget er blankt)
      * """"""""""""""""""""""""""""""
     C  N78PKLSIO        IFNE      ' '                                          II
     C     HESDL         IFEQ      *BLANKS                                      III
     C                   SETON                                        78
     C                   ELSE
     C     PKLSIO        IFEQ      'I'                                          IIII
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HESDL         LOOKUP    LS                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HESDL         LOOKUP    LS                                     80
     C   80              SETON                                        78
     C                   END                                                    IIII
     C                   END                                                    III
     C                   END                                                    II
      *
     C                   END                                                    I
      *
      * _______________________________________________________________
      * UTLØPSDATO (indikator 79 varsler at minsten linje i avt utløpt)
      * """""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     PKDT          IFGT      0
     C  N78
     CANN79PKDT          COMP      HEDTR                                79
     C  N78PKDT          COMP      HEDTR                                78
     C                   END
      * Linjen ok? (indikator 78 varsler at denne linje ikke gjelder)
      *
     C     UTGIO         ENDSR
      *
      ***********************************************
     C     SRTAB         BEGSR
      ***********************************************
      *
      *** SLÅ OPP I BRUTTOPRIS-TABELL
     C     X01B          IFEQ      'X'                                          1<-B
     C                   MULT      HENT          PRBELØ
     C                   END                                                    1<-E
      *
     C     X01B          IFEQ      'V'                                          1<-B
     C                   MULT      TRVERB        PRBELØ
     C                   DIV       100           PRBELØ
     C                   MOVE      TRVERV        PKFVAL
     C                   MOVE      TRVERV        WSVAL
     C                   END                                                    1<-E
      *
     C     X01B          IFGE      '0'
     C     X01B          ANDLE     '9'
     C                   MOVE      'D'           X01B
     C                   END
      *
     C     X01B          IFEQ      'D'                                          1<-B
     C                   MOVE      *ZEROS        PRBELØ
     C                   END                                                    1<-E
      *
     C     X01B          IFEQ      'L'                                          1<-B
      *                    MULT HENTF     PRBELØ
     C                   MOVE      HENTF         XXNTF             4 0
     C     PRTEGN        IFEQ      ' '                                           2<-B
     C     PRJUST        ANDNE     *ZEROS
     C                   SUB       PRJUST        XXNTF
     C                   END                                                     2<-E
     C     XXNTF         IFLT      0                                             2<-B
     C                   MOVE      *ZEROS        XXNTF
     C                   END                                                     2<-E
     C                   MULT      XXNTF         PRBELØ
     C                   END                                                    1<-E
      *
     C     PRANT         IFGT      0
     C                   EXSR      OMREGN
     C                   END
      *
      * MINIMUM MAKSIMUM VED FRAKTAVTALE
      *
     C   99              DO                                                     1<-B
     C                   Z-ADD     PRBELØ        XBELØB            7 0
     C     XBELØB        IFLT      FTMIN                                         2<-B
     C                   Z-ADD     FTMIN         PRBELØ
     C                   END                                                     2<-E
     C     XFTMAX        IFNE      *ZEROS                                        2<-B
     C     XBELØB        ANDGT     XFTMAX
     C                   Z-ADD     XFTMAX        PRBELØ
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      * PROSENT AV FLYFRAKT
     C   44KODGEK        CHAIN     KOGER                              75
     C   44KGETYP        IFEQ      'FFE'
     C                   Z-ADD     DFBLT         PRBELØ
     C                   END
      *
      *** PROSENTAVTALE ?
      *
     C     XPROS         IFNE      0
     C     PRBELØ        DIV       100           XWORK
     C     XWORK         MULT(H)   XPROS         PRBELØ
     C                   END
      *
     C                   Z-ADD(H)  PRBELØ        WSBELV
     C                   Z-ADD(H)  PRBELØ        XBELN
      *
     C                   ENDSR
      *
      ******************************************
     C     BERFRP        BEGSR
      ******************************************
     C                   MOVE      *ZEROS        WSAGRN
      *
      * Finn frakt i kundersfraktavtale
      *
     C                   MOVE      *ZEROS        UUBELØ           13 2
     C                   MOVE      *BLANKS       WSVAL
     C                   MOVE      XTKNR         UKN               8 0
     C                   CALL      'SYGE04'
     C                   PARM                    KGEKOD
     C                   PARM                    KGETYP
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UKN
     C                   PARM                    WSVAL
     C                   PARM                    UUBELØ
     C                   PARM                    UAVNR             9 0
     C                   PARM                    UAVMSG           50
     C                   PARM                    WSSK
     C     UAVMSG        IFNE      *BLANKS                                      1<-B
     C     KGETYP        ANDEQ     'FRA'
     C     XTSK          IFNE      'A'
     C                   MOVEL     UAVMSG        UMSG
     C                   END
     C                   END                                                    1<-E
     C     UAVNR         IFNE      *ZEROS                                       1<-B
     C                   MOVE      UAVNR         UUAVNR            9 0
     C                   MOVE      UAVNR         WSAGRN
     C     UAVNR         CHAIN     AVFRHL01                           76
     C     AFBFR1        IFEQ      'N'                                           2<-B
     C                   ADD       1             GN                2 0
     C                   MOVE      'FR1'         GNT(GN)
     C                   END                                                     2<-E
     C     AFBFR2        IFEQ      'N'                                           2<-B
     C                   ADD       1             GN                2 0
     C                   MOVE      'FR2'         GNT(GN)
     C                   END                                                     2<-E
     C     GNAT          IFEQ      *BLANKS                                       2<-B
     C                   SORTA     GNT
     C                   ELSE                                                    2
     C     1             DO        10            GG                2 0            3<-B
     C     GNA(GG)       IFNE      *BLANKS                                         4<-B
     C                   ADD       1             GN                2 0
     C                   MOVE      GNA(GG)       GNT(GN)
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   SORTA     GNT
     C                   EXSR      DELLI
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C                   MOVE      'A'           XKDA
      *
     C     UUBELØ        IFEQ      0
     C     WSVAL         ANDEQ     *BLANKS
     C                   MOVE      'B'           XKDA
     C                   CALL      'SYGE03'
     C                   PARM                    KGETYP
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    WSVAL
     C                   PARM                    UUBELØ
     C                   PARM                    USONE             5
     C                   PARM                    URABAT            5 2
     C                   END
     C                   Z-ADD     UUBELØ        PRBELØ
      *
     C                   ENDSR
      *
      ******************************************
     C     DELLI         BEGSR
      ******************************************
     C                   SORTA     GNA
      *
     C                   MOVE      WSSK          XSK
     C     FAK2K         SETLL     FAK4
     C     STDELI        TAG
     C     FAK2K         READE     FAK4                                   76
     C   76              GOTO      SLDELI
     C     FAVK          LOOKUP    GNA                                    80
      *
     C   80FAKTK         CHAIN     FAKT                               76
     C   80
     CANN76              DELETE    FAKTR
     C                   GOTO      STDELI
      *
     C     SLDELI        TAG
      *
     C                   ENDSR
      *
      ******************************************
     C     DELGH         BEGSR
      ******************************************
     C                   SORTA     GNT
      *
     C                   MOVE      WSSK          XSK
     C     FAK2K         SETLL     FAK4
     C     FAK2K         READE     FAK4                                   76
      *
     C     *IN76         DOWEQ     '0'
     C     FAVK          LOOKUP    GNT                                    80
     C   80FAKTK         CHAIN     FAKT                               76
     C   80
     CANN76              DELETE    FAKTR
     C     FAK2K         READE     FAK4                                   76
     C                   END
      *
     C                   ENDSR
      *
      ******************************************
     C     BERFRA        BEGSR
      ******************************************
      *
      * BEREGNER TOLLPOST INLANDSFRAKT
      *
     C     KGETYP        IFEQ      'TGI'
     C     *LOVAL        SETLL     FRSTTG
     C                   READ      FRSTTG                                 33
     C  N33TGEK          COMP      *BLANKS                                33
     C                   IF        *IN33
     C                   EXSR      TGISR
     C                   ELSE
     C                   EXSR      TGIHTTP
     C                   END
     C                   MOVE      XTKNR         XTKNRG
     C                   GOTO      SLSHF
     C                   END
      *
      *
     C     KGETYP        IFEQ      'TGF'
     C                   CALL      'SYTGF1'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    PKMVA
     C                   PARM                    KGEUTL
     C                   PARM                    WSVK
     C                   GOTO      SLSHF
     C                   END
      *
     C     KOAPOS        IFEQ      'J'
     C                   EXSR      BERFRP
     C                   MOVE      XTKNR         XTKNRG
     C                   GOTO      SLSHF
     C                   END
     C                   MOVE      XTKNR         XTKNRG
      *
      * BEREGNER FRAKT
      *
      *
      * SPESIAL VED TRANSPORTOPPDRAG
      *
     C     HEUR          IFEQ      'H'
     C     TRFRAK        IFEQ      'E'
     C     TRFRAK        OREQ      'A'
     C     TRFRAB        IFNE      *ZEROS
     C                   Z-ADD     TRFRAB        PRBELØ
     C                   MOVE      TRFRAV        PKFVAL
     C                   MOVE      TRFRAV        WSVAL
     C                   MOVE      'M'           XKDA
     C                   GOTO      SLBFR
     C                   END
     C                   END
     C                   END
      * FORFRAKT
     C     KGETYP        IFEQ      'FR1'
     C                   MOVE      HESDFF        XTFRA
     C                   MOVE      HESDF         XTTIL
     C                   MOVE      SONEFF        XSONEF
     C                   MOVE      SONEF         XSONET
     C                   END
      * ETTERFRAKT
     C     KGETYP        IFEQ      'FR2'
     C                   MOVE      HESDT         XTFRA
     C                   MOVE      HESDVT        XTTIL
     C                   MOVE      SONET         XSONEF
     C                   MOVE      SONEVT        XSONET
     C                   END
      *
      * HENTER SONETABELL VED INNENLANDSFRAKT
      *
     C     KGETYP        IFEQ      'FRI'
     C     HESDVT        CHAIN     STED2                              32
     C     ST2SOI        IFNE      *ZEROS
     C                   MOVE      ST2SOI        XTTIL
     C                   MOVE      ST2SOI        XTFRA
     C                   MOVEL     'IS'          XTTIL
     C                   MOVEL     'IS'          XTFRA
     C                   MOVE      *BLANKS       XSONEF
     C                   MOVE      *BLANKS       XSONET
     C                   END
     C                   END
      *
      *
     C                   MOVE      HEFR          XTFRAN
     C                   MOVE      HEOT          XTOT
     C                   MOVE      *ZEROS        PRJUST
     C                   MOVE      *ZEROS        PRBELØ
     C                   MOVE      *ZEROS        FTMIN
     C                   MOVE      *BLANKS       X01B
     C                   Z-ADD     KOVOMR        PRANT
     C                   Z-ADD     1             XN                2 0          VGR.AVD
      *
      *          HEFBV     LOKUPFF,XN                32  32
     C     HEFBVN        LOOKUP    FF(XN)                             32  32
      *
      * FAST PRIS I INTERVALLET
      *
     C     FP(XN)        IFEQ      'F'
     C                   Z-ADD     0             PRANT
     C                   END
      *
      *  DERSOM FORFRAKT ALT ER INNKALK I HOVEDFRAKT (86) SKIPP BEREGNING
      *  AV SEPARAT FORFRAKT, MEN ..Bytt navn i heading på bilde (frakt fra)
      *
     C   86KGETYP        IFEQ      'FR1'
     C     HESDFF        CHAIN     STED2                              86
     C  N86              MOVEL     ST2NVN        WSFRA
     C                   SETOFF                                       86
     C                   GOTO      SLBFR
     C                   END
      *  DERSOM FORFRAKT IKKE INNKALK I HOVEDFRAKT (N86) BEREGN FORFRAKT
     C  N86HESDFF        IFNE      *BLANKS
     C     KGETYP        ANDEQ     'FR1'
     C                   MOVE      HEOT          XTOT
     C                   EXSR      CHAINF
     C                   END
      *  ORDINÆR HOVEDFRAKT:
      *  FORSØK FØRST  FRA FORFRAKTSTED TIL HOVEDFRAKTS ENDEDESTINASJON
     C     KGETYP        IFEQ      'FRA'
     C     KGETYP        OREQ      'SEA'
     C                   SETON                                        32
     C  N86
     CANN27HESDFF        IFNE      *BLANKS
     C                   MOVE      HESDFF        XTFRA
     C                   MOVE      SONEFF        XSONEF
     C                   MOVE      HESDT         XTTIL
     C                   MOVE      SONET         XSONET
     C                   MOVE      HEOT          XTOT
     C                   EXSR      CHAINF
     C  N32              SETON                                        86
     C                   END
     C                   END
      *
      * IKKE FORSØKT ELLER IKKE FUNNET FORFRAKT FRA - HOVED FRAKT ENDE
      * FORSØK ORDINÆR.
      *
     C   32
     CANN27KGETYP        IFEQ      'FRA'
     C     KGETYP        OREQ      'SEA'
     C                   MOVE      HESDF         XTFRA
     C                   MOVE      SONEF         XSONEF
     C                   MOVE      HESDT         XTTIL
     C                   MOVE      SONET         XSONET
     C                   MOVE      HEOT          XTOT
     C                   EXSR      CHAINF
     C                   END
     C*
     C* BEREGNER INNLANDSFRAKT
     C*
     C     KGETYP        IFEQ      'FRI'
     C                   EXSR      CHAINF
     C                   END
      *
      *
      * BEREGNER VIDEREFRAKT
      *
     C     KGETYP        IFEQ      'FR2'
     C                   EXSR      CHAINF
     C                   END
      *
      * 32 PÅ INGEN AVTALE
      * B=BRUTTODRATE / A=AVTALEPRIS
      *
     C  N32              MOVE      'A'           XKDA
     C   32              MOVE      'B'           XKDA
     C   32              Z-ADD     0             AX(3)
     C   32              GOTO      STBFR
      *
      * KOMMER HIT KUN VED KUNDEAVTALE
      *
      *
      * SKJEKKER OM AVVIKKENDE FRAKTBEREGNING
      *
     C     FTKOLL        IFNE      *BLANKS
     C                   EXSR      TSTAVV
     C     HOPP          IFEQ      'J'
     C                   GOTO      SLBFR
     C                   END
     C                   ELSE
     C                   MOVE      HEFBV         LOKUPF
      * SKJEKKER OM DIVERGERENDE OMREGNING
     C     FTM3OM        IFNE      *ZEROS
     C     FTLMOM        ORNE      *ZEROS
     C                   EXSR      BERFVK
     C                   END
     C                   END
      *
      * SJEKK OM KUNDEN HAR EGEN VEKTGR.INNDELING I FRAKTAVTALEN
      *
     C     FRATKV        CHAIN     FRAV                               76
     C                   Z-ADD     1             XN                2 0          VGR.AVD
     C   76LOKUP2        LOOKUP    FF(XN)                             76  76
     C  N76              DO
     C     LOKUP2        LOOKUP    FV(XN)                             76  76
     C                   SETOFF                                       76
     C                   END
      *
     C     PKAVTT        IFNE      'P'                                          1<-B
     C     PKAVTT        ANDNE     'H'                                          1<-B
     C                   Z-ADD     FB(XN)        PRBELØ
      * BENYTTER ALLTID AVTALENS FTPRPR
     C                   Z-ADD     FTPRPR        PRANT
      * SKJEKKER OM FAST PRIS TIL OG MED
     C     XN            IFLE      FTFAST                                         3<-B
     C                   Z-ADD     0             PRANT
     C                   END                                                      3<-E
      * PRIS PR KOLLI
     C  N76FTKOLL        IFEQ      'X'                                           2<-B
     C                   MULT      HENT          PRBELØ
     C                   Z-ADD     0             PRANT
     C                   END                                                     2<-E
      * PRIS VED VAREVERDI
     C  N76FTKOLL        IFEQ      'V'                                           2<-B
     C                   MULT      TRVERB        PRBELØ
     C                   DIV       10000         PRBELØ
     C                   Z-ADD     0             PRANT
     C                   END                                                     2<-E
      * PRIS MEN GRUNNPRISLOGIKK
     C  N76FTKOLL        IFEQ      'G'                                           2<-B
     C                   MULT      HEFBV         PRBELØ
     C                   DIV       100           PRBELØ
     C                   ADD       FTMIN         PRBELØ
     C                   Z-ADD     0             PRANT
     C                   END                                                     2<-E
      * PRIS PR KOLLI
     C  N76FTKOLL        IFEQ      'M'                                           2<-B
     C     FTKOLL        OREQ      'L'
     C     XN            IFGT      FTFAST                                         3<-B
     C                   MULT      LOKUPF        PRBELØ
     C                   DIV       100           PRBELØ
     C                   END                                                      3<-E
     C                   Z-ADD     0             PRANT
     C                   END                                                     2<-E
      *  HA AVTALE MEN IKKE PROSENTAVTALE
      *  KALL PÅ SRMIMA GJORT UAVHENGIG AV KOWMM
     C                   MOVE      FTMM          KOWMM
     C                   EXSR      SRMIMA
     C                   GOTO      SLBFR
     C                   END                                                    1<-E
      *
      * PROSENTAVTALE START
      *
     C     XPROS         IFEQ      *ZEROS
     C                   Z-ADD     FB(XN)        XPROS
     C                   ELSE
      * PROSENT AV PROSENTAVTALE
     C     FB(XN)        MULT      XPROS         XPROS
     C                   DIV       100           XPROS
     C                   END
     C                   Z-ADD     FTMIN         XFTMIN            5 0
      *
      * BEREGN SJØ-FRAKT UTFRA KUNDE-AVTALE
     C     STBFR         TAG
     C     KGETYP        IFEQ      'SEA'
     C     HEUR          IFEQ      'G'
     C     HEUR          OREQ      'F'
     C                   EXSR      BFRSJØ
     C     XSJØ          IFEQ      'J'
     C                   MOVE      'A'           XKDA
     C                   GOTO      SLBFR
     C                   END
     C                   END
     C                   END
      *    *******
      *     BRUTTO
      *    *******
      * HENTER FRAKTBELØP FRA BRUTTOTARIFF
     C                   MOVE      *ZEROS        XTKNR
     C                   MOVE      HEOT          XTOT
     C                   MOVE      HEFR          XTFRAN
      *
      *  DERSOM FORFRAKT ALT ER INNKALK I HOVEDFRAKT (86) SKIPP BEREGNING
      *  AV SEPARAT FORFRAKT, MEN ..Bytt navn i heading på bilde (frakt fra)
      *
     C   86KGETYP        IFEQ      'FR1'
     C     HESDFF        CHAIN     STED2                              86
     C  N86              MOVEL     ST2NVN        WSFRA
     C                   SETOFF                                       86
     C                   GOTO      SLBFR
     C                   END
      *  DERSOM FORFRAKT IKKE INNKALK I HOVEDFRAKT (N86) BEREGN FORFRAKT
     C  N86HESDFF        IFNE      *BLANKS
     C     KGETYP        ANDEQ     'FR1'
     C                   EXSR      CHAINF
     C                   END
      *  ORDINÆR HOVEDFRAKT:
      *  FORSØK FØRST  FRA FORFRAKTSTED TIL HOVEDFRAKTS ENDEDESTINASJON
     C     KGETYP        IFEQ      'FRA'
     C     KGETYP        OREQ      'SEA'
     C                   SETON                                        32
     C  N86
     CANN27HESDFF        IFNE      *BLANKS
     C                   MOVE      HESDFF        XTFRA
     C                   MOVE      SONEFF        XSONEF
     C                   MOVE      HESDT         XTTIL
     C                   MOVE      SONET         XSONET
     C                   MOVE      HEOT          XTOT
     C                   EXSR      CHAINF
     C  N32              SETON                                        86
     C                   END
     C                   END
     C*
      * IKKE FORSØKT ELLER IKKE FUNNET FORFRAKT FRA - HOVED FRAKT ENDE
      * FORSØK ORDINÆR.  HOVEDDESTINASJON FRA - HOVEDDEST. TIL
      *
     C   32
     CANN27KGETYP        IFEQ      'FRA'
     C     KGETYP        OREQ      'SEA'
     C                   MOVE      HESDF         XTFRA
     C                   MOVE      SONEF         XSONEF
     C                   MOVE      HESDT         XTTIL
     C                   MOVE      SONET         XSONET
     C                   MOVE      HEOT          XTOT
     C                   EXSR      CHAINF
     C                   END
      *
      * BEREGNER INNLANDSFRAKT
      *
     C     KGETYP        IFEQ      'FRI'
     C                   EXSR      CHAINF
     C                   END
      *
      * BEREGN SJØ-FRAKT UTFRA BRUTTO-AVTALE
     C   32KGETYP        IFEQ      'SEA'
     C     HEUR          IFEQ      'G'
     C     HEUR          OREQ      'F'
     C                   MOVE      XTKNR         XTKNR2            8 0
     C                   MOVE      *ZEROS        XTKNR
     C                   EXSR      BFRSJØ
     C                   MOVE      XTKNR2        XTKNR
     C     XSJØ          IFEQ      'J'
     C                   MOVE      'B'           XKDA
     C                   GOTO      SLBFR
     C                   END
     C                   END
     C                   END
      *
      * 32 BRUTTOTABELL FINNES IKKE
      *
     C   32              GOTO      SLBFR
     C     FTPRPR        IFNE      *ZEROS                                        2<-B
     C                   Z-ADD     FTPRPR        PRANT
     C                   END
      *
     C                   Z-ADD     FB(XN)        PRBELØ
      * PRIS MEN GRUNNPRISLOGIKK
     C     FTKOLL        IFEQ      'G'                                           2<-B
     C                   MULT      HEFBV         PRBELØ
     C                   DIV       100           PRBELØ
     C                   ADD       FTMIN         PRBELØ
     C                   Z-ADD     0             PRANT
     C                   END                                                     2<-E
      * PRIS PR KOLLI
     C     FTKOLL        IFEQ      'X'                                           2<-B
     C                   MULT      HENT          PRBELØ
     C                   Z-ADD     0             PRANT
     C                   END                                                     2<-E
      * PRIS VED VAREVERDI
     C     FTKOLL        IFEQ      'V'                                           2<-B
     C                   MULT      TRVERB        PRBELØ
     C                   DIV       10000         PRBELØ
     C                   Z-ADD     0             PRANT
     C                   END                                                     2<-E
      * PRIS PR KUBIKK
     C     FTKOLL        IFEQ      'M'                                           2<-B
     C                   MULT      HEM3          PRBELØ
     C                   Z-ADD     0             PRANT
     C                   END                                                      3<-E
      * PRIS PR LASTEMETER
     C     FTKOLL        IFEQ      'L'                                           2<-B
     C                   MULT      HELM          PRBELØ
     C                   Z-ADD     0             PRANT
     C                   END                                                      3<-E
      *
      * SKJEKKER OM FAST PRIS TIL OG MED
      *
     C     XN            IFLE      FTFAST
     C                   Z-ADD     0             PRANT
     C                   END
      *
     C                   EXSR      SRMIMA
      *
      * FLYTTER AVTALEAVHENGING  MIN OG MAX
      *
     C     XFTMIN        IFNE      *ZEROS
     C                   Z-ADD     XFTMIN        FTMIN
     C                   END
      *
     C     SLBFR         TAG
     C                   MOVE      XTKNRG        XTKNR
     C     SLSHF         TAG
     C                   SETOFF                                       32
      *
     C                   ENDSR
      *
      ******************************************
     C     BFRSJØ        BEGSR
      * BEREGNER SJØ-FRAKT UTFRA KUNDE-AVTALE
      ******************************************
     C     HEADFK        SETLL     BLV1LF                             75
     C     STBFRS        TAG
     C     HEADFK        READE     BLV1LF                                 75
     C  N75              DO
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              DO
     C     XSJØ          IFEQ      'N'
     C                   MOVE      *ZEROS        WSBELV
     C                   MOVE      *ZEROS        XBELN
     C                   MOVE      FTVAL         PKFVAL
     C                   MOVE      FTVAL         WSVAL
     C                   MOVE      'J'           XSJØ
     C                   END
     C     BVNT          MULT      FTPRIS        XWORK
     C                   ADD       XWORK         WSBELV
     C                   ADD       XWORK         XBELN
     C                   END
     C                   SETOFF                                       75
     C                   GOTO      STBFRS
     C                   END
      *
     C                   ENDSR
      *
      ******************************************
     C     SRMIMA        BEGSR
      ******************************************
      *
      * KOMPLETT LASS
     C   40WSKOM         IFGT      *ZEROS
     C     WSKOM         ANDLT     4
     C                   Z-ADD     AX(WSKOM)     PRBELØ
     C                   MOVE      *ZEROS        FTMIN
     C                   MOVE      *ZEROS        XFTMAX            5 0
     C                   MOVE      *ZEROS        PRANT
     C                   GOTO      SLMIMA
     C                   END
      *
     C     FTMIN         IFGT      *ZEROS                                       1<-B
     C     XN            ANDEQ     1
     C     KOWMM         IFEQ      2                                             2<-B
     C                   Z-ADD     FM(XN)        XFTMAX
     C                   END                                                     2<-E
     C                   ELSE                                                   1
     C     KOWMM         IFEQ      1                                             2<-B
     C                   Z-ADD     FM(XN)        FTMIN
     C                   ELSE                                                    2
     C     KOWMM         IFEQ      2                                              3<-B
     C                   Z-ADD     FM(XN)        XFTMAX
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
      * LEGGER UT KOMPLETT LASS I MAX HVIS FOREFINNES
      *
     C     AX(3)         IFNE      *ZEROS
     C     XFTMAX        IFGT      AX(3)
     C                   Z-ADD     AX(3)         XFTMAX
     C                   END
     C     XFTMAX        IFEQ      *ZEROS
     C                   Z-ADD     AX(3)         XFTMAX
     C                   END
     C                   END
     C     SLMIMA        ENDSR
      *
      ***********************************************
     C     CHAINF        BEGSR
      ***********************************************
      * CHAINER I FRAKTREGISTER   - HOVEDFRAKT ORDINÆR
      * (SETT INDIKATOR DERSOM IKKE BEHOV FOR Å CHAINE EVT. SONEFRAKT)
     C     XSONEF        COMP      *BLANKS                            2828
     C     XSONET        COMP      *BLANKS                            2929
      *
     C     FRATK         CHAIN     FRATN                              32        *RENE STEDSKODER
     C   32
     CAN 28FRATK2        CHAIN     FRATN                              32        *SONE FRA
     C   32
     CAN 29FRATK3        CHAIN     FRATN                              32        *SONE TIL
     C   32
     CAN 28
     CAN 29FRATK4        CHAIN     FRATN                              32        *SONE FRA/TIL
     C   32              MOVE      'GE'          XTOT
     C   32FRATK         CHAIN     FRATN                              32        *RENE STEDSKODER
     C   32
     CAN 28FRATK2        CHAIN     FRATN                              32        *SONE FRA
     C   32
     CAN 29FRATK3        CHAIN     FRATN                              32        *SONE TIL
     C   32
     CAN 28
     CAN 29FRATK4        CHAIN     FRATN                              32        *SONE FRA/TIL
      *
      * VALUTAKODE PÅ FRAKAVTALEN (ELLER BRUTTO)??
      *
     C     FTVAL         IFNE      *BLANKS
     C                   MOVE      FTVAL         PKFVAL
     C                   MOVE      FTVAL         WSVAL
     C                   END
     C                   ENDSR
      *
      *
      ***********************************************
     C     TSTAVV        BEGSR
      ***********************************************
      *
      * SKJEKKER AVVIKENDE BERGNINGSMETODE
      *
      * KUBIKKPRIS
      *
     C                   MOVE      *BLANKS       HOPP              1
     C                   MOVE      HEFBV         LOKUPF
      *                    MOVE TRM3      LOKUPF  50
     C     FTKOLL        IFEQ      'M'                                          1<-B
     C     HEM3          IFNE      *ZEROS                                        2<-B
     C                   MOVE      *ZEROS        LOKUPF
     C                   MOVE      HEM3N         LOKUPF
     C                   MOVE      0             FTPRPR
     C                   ELSE                                                    2
     C                   MOVE      'J'           HOPP
     C                   GOTO      SLBFRX
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      * LASTEMETERPRIS
     C     FTKOLL        IFEQ      'L'                                          1<-B
     C     HELM          IFNE      *ZEROS                                        2<-B
     C                   MOVE      *ZEROS        LOKUPF
     C                   MOVE      HELM          LOKUPF
     C                   MOVE      0             FTPRPR
     C                   ELSE                                                    2
     C                   MOVE      'J'           HOPP
     C                   GOTO      SLBFRX
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      * KOLLIPRIS
     C     FTKOLL        IFEQ      'X'                                          1<-B
     C     HENT          IFNE      *ZEROS                                        2<-B
     C                   Z-ADD     HENT          LOKUPF
     C                   ELSE                                                    2
     C                   MOVE      'J'           HOPP
     C                   GOTO      SLBFRX
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      * KILOPRIS
     C     FTKOLL        IFEQ      'B'                                          1<-B
     C     HEVKT         IFNE      *ZEROS                                        2<-B
     C                   MOVE      HEVKT         LOKUPF
     C                   MOVE      HEVKT         HEFBV
     C                   ELSE                                                    2
     C                   MOVE      'J'           HOPP
     C                   GOTO      SLBFRX
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      * SKJEKKER OM DIVERGERENDE OMREGNING
     C     FTKOLL        IFEQ      'G'                                          1<-B
     C     FTM3OM        IFNE      *ZEROS                                        2<-B
     C     FTLMOM        ORNE      *ZEROS
     C                   EXSR      BERFVK
     C                   MOVE      HEFBV         LOKUPF
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C                   MOVE      LOKUPF        HEFBV
     C     SLBFRX        ENDSR
      ******************************************
     C     BERFVK        BEGSR
      ******************************************
      *
      * FINNER FRAKTBEREGNINGSVEKT
      *
     C     HELM          MULT      FTLMOM        XFBV1             9 0
     C     HEM3          MULT      FTM3OM        XFBV2             9 0
     C     HEVKT         IFGE      XFBV1
     C                   MOVE      HEVKT         HEFBV
     C                   ELSE
     C                   MOVE      XFBV1         HEFBV
     C                   END
     C     HEFBV         IFLT      XFBV2
     C                   MOVE      XFBV2         HEFBV
     C                   END
      *
     C                   MOVE      HEFBV         LOKUPF
      *
     C                   ENDSR
      ***********************************************
     C     PRSETL        BEGSR
      ***********************************************
      *
      *** SETTER LOWER LIMIT MED ANNED VERDI ENN VEKTBEGREPENE
     C     X01B          IFEQ      'X'
     C                   MOVE      HENT          XINT
     C                   END
     C     X01B          IFEQ      'L'
     C                   MOVE      HENTF         XINT
     C                   END
     C     X01B          IFEQ      'B'
     C                   Z-ADD     HEVKT         XINT
     C                   END
     C     X01B          IFGE      '0'
     C     X01B          ANDLE     '9'
     C                   MOVE      'D'           X01B
     C                   END
     C     X01B          IFEQ      'D'
     C                   Z-ADD     0             XINT
     C                   END
     C  N99PRISKK        SETLL     PRIS
     C  N99WSTNR         READE     PRIS                                   32
      *
     C                   ENDSR
      *
      ***********************************************
     C     NYPA          BEGSR
      ***********************************************
      *
      *** LEGGE UT NY POST I FAKTURAREGISTER
      *
     C                   EXSR      MOVWSF
      *
     C     FAVAL         IFEQ      FICURR                                       1<-B
     C                   EXSR      VALUTA
     C                   ELSE                                                   1
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
     C     FAVK          IFEQ      'S'                                           2<-B
     C     HEVALS        IFNE      '   '                                          3<-B
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     HEVALK        IFNE      '   '                                          3<-B
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
      * HENT GEBYRKODE INFO
      *
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
      *
      *
      *
     C                   EXSR      SPLISR
      *
     C                   EXSR      NYFAK
      *
      * ADD A LINE DEPENDING ON FREIGHT AMOUNTH
      *
     C     KGETYP        IFEQ      'FRA'                                        1<-B
     C     HEVALT        ANDNE     *BLANKS
     C     HEVALP        ANDNE     *ZEROS
     C                   MOVE      HEVALT        FAVK
     C                   MULT(H)   HEVALP        FABELN
     C                   MULT(H)   HEVALP        FABELV
      *SH* LINJER TATT BORT 110692
      *
     C                   EXSR      SPLISR
      *
      *ALLTID + 1 TIL FALI VED VALUTATILLEGG ETC
      *DA IKKE MOVWSF KALLES
      *
     C                   ADD       1             FALI
     C                   EXSR      NYFAK
     C                   END                                                    1<-E
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ***********************************************
     C     NYPB          BEGSR
      ***********************************************
      *
      *** ADDS NEW RECORD TO INVOICE FILE
      *                    MOVE WSSK      XSK2    1
     C                   EXSR      MOVWSF
      *
     C     FAVAL         IFEQ      FICURR                                       1<-B
     C                   EXSR      VALUTA
     C                   ELSE                                                   1
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
     C     FASK          IFEQ      'S'                                           2<-B
     C     HEVALS        IFNE      '   '                                          3<-B
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     HEVALK        IFNE      '   '                                          3<-B
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
      *
      *
     C                   EXSR      SPLISR
      *
     C                   EXSR      NYFAK
      *
      * ADDS CURRENCYPERCENT TO THE AMOUNTH
      *
     C     KGETYP        IFEQ      'FRA'                                        1<-B
     C     HEVALT        ANDNE     *BLANKS
     C     HEVALP        ANDNE     *ZEROS
     C                   MOVE      HEVALT        FAVK
     C                   MULT(H)   HEVALP        FABELN
     C                   MULT(H)   HEVALP        FABELV
      *SH* LINJER TATT BORT 110692
      *
     C                   EXSR      SPLISR
      *
      *ALLTID + 1 TIL FALI VED VALUTATILLEGG ETC
      *DA IKKE MOVWSF KALLES
     C                   ADD       1             FALI
     C                   EXSR      NYFAK
     C                   END                                                    1<-E
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ***********************************************
     C     NYPC          BEGSR
      ***********************************************
      *
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
     C                   MOVE      FAKDUL        XKDUL
      *
      *** ADD NEW POST TO INVOICE FILE
      *                    MOVE WSSK      XSK2
     C     WSSK          IFEQ      'K'
     C     XCCPP1        ANDEQ     'C'
     C     HEPK5         ANDNE     'N'
     C                   MOVE      'F'           WSSK
     C                   MOVE      'F'           FASK
     C                   END
      *
     C                   EXSR      MOVWSF
      *
     C     FAVAL         IFEQ      FICURR                                       1<-B
     C                   EXSR      VALUTA
     C                   ELSE                                                   1
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
     C     FASK          IFEQ      'S'                                           2<-B
     C     HEVALS        IFNE      '   '                                          3<-B
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     HEVALK        IFNE      '   '                                          3<-B
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C     KGETYP        IFEQ      'FFN'
     C                   Z-ADD     DIFRAK        FABELN
     C                   ADD       DIFS          FABELN
     C                   Z-ADD     DIFRAK        FABELV
     C                   ADD       DIFS          FABELV
     C                   END
      *
      *** STARTS CHANGES SPLITT INCOMES  23/11-89
     C                   EXSR      SPLISR
      *** END OF SPLITT    23/11-89
      *
     C                   EXSR      NYFAK
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
      *                    MOVE XSK2      WSSK
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ******************************************
     C     NYPD          BEGSR
      ******************************************
      *
      *
     C     KODGEK        CHAIN     KOGER                              34
      *
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
     C                   MOVE      FAKDUL        XKDUL
      *
     C     WSSK          IFEQ      'S'
     C     WSVK          ANDEQ     'AW '
     C                   Z-ADD     XBELN         XAWBFE            5 0
     C                   MOVE      WSSK          FASK
     C                   GOTO      UTNYPO
     C                   END
      *
      * ADDS NEW RECORD TO INVOICE FILE
      * IF SINGLE AIR USES F IN STEAD OF K FOR CONSIGNEE
      *
     C     HEHAWB        IFEQ      *ZEROS
     C     WSSK          ANDEQ     'K'
     C                   MOVE      'F'           WSSK
     C                   MOVE      'F'           FASK
     C                   END
      *
      * ADDS      MC      TO THE FREIGHT AMOUNTH  AIR EXPORT
     C     WSSK          IFEQ      'S'
     C     WSVK          ANDEQ     'FFE'
     C                   ADD       XAWBFE        XBELN
     C                   ADD       XAWBFE        WSBELV
     C     KFSMC         IFNE      *ZEROS
     C     HEHAWB        ANDEQ     *ZEROS
     C                   ADD       KFSMC         XBELN
     C                   ADD       KFSMC         WSBELV
     C                   END
     C                   END
      *
     C                   EXSR      MOVWSF
      *
      * ADDS A NEW RECORD
      *
     C     FAVAL         IFEQ      FICURR
     C                   EXSR      VALUTA
     C                   ELSE
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
      *
     C     FASK          IFEQ      'S'
     C     HEVALS        IFNE      '   '
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END
     C                   ELSE
     C     HEVALK        IFNE      '   '
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END
     C                   END
      *
     C                   END
     C                   EXSR      SPLISR
      *
     C                   EXSR      NYFAK
      *
      * SPECIAL FOR FREIGHT EXPORT AIR (FFE)
      * GETS CCFEE FIRST
      *
     C     WSVK          IFEQ      'FFE'
     C                   MOVE      FAVK          FAVKW
     C     KODLKK        CHAIN     KODTLKR                            34
     C  N34XPRO          COMP      0                                      34
     C  N34FASK          COMP      'K'                                3434
     C   34              GOTO      STPROS
     C     FABELV        MULT      XPRO          FABELV
     C     FABELV        IFLT      KLKMIN
     C                   Z-ADD     KLKMIN        FABELV
     C                   END
     C                   Z-ADD     FABELV        FABELN
     C                   MOVE      'FC '         FAVK
     C                   MOVE      'FC '         WSVK
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
     C                   EXSR      SPLISR
      *
      *ALLTID + 1 TIL FALI VED VALUTATILLEGG ETC
      *DA IKKE MOVWSF KALLES
     C                   ADD       1             FALI
     C                   EXSR      NYFAK
      *
     C     STPROS        TAG
      *
      * AIR       MC-LINE  CARRIER
      *
     C     WSSK          IFNE      'S'
     C     KFSMC         ANDNE     *ZEROS
     C     HEHAWB        ANDEQ     *ZEROS
     C                   MOVE      'MC '         FAVK
     C                   MOVE      'MC '         WSVK
     C                   Z-ADD     KFSMC         FABELV
     C                   Z-ADD     KFSMC         FABELN
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
     C                   EXSR      SPLISR
      *ALLTID + 1 TIL FALI VED VALUTATILLEGG ETC
      *DA IKKE MOVWSF KALLES
     C                   ADD       1             FALI
     C                   EXSR      NYFAK
     C                   END
     C                   MOVE      FAVKW         FAVK
     C                   END
      *
     C     UTNYPO        TAG
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
      *
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ******************************************
     C     NYPE          BEGSR
      ******************************************
      *
      * ADDS NEW POST TO INVOICELINE-FILE
      *
     C     WSSK          IFEQ      'K'
     C     XCCPP1        ANDEQ     'C'
     C     HEPK5         ANDNE     'N'
     C                   MOVE      'F'           WSSK
     C                   MOVE      'F'           FASK
     C                   END
      *
     C                   EXSR      MOVWSF
      *
     C                   EXSR      VALUTA
     C     KODGEK        CHAIN     KOGER                              34
      *
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
     C     KGETYP        IFEQ      'FFN'
     C                   Z-ADD     DIFRAK        FABELN
     C                   ADD       DIFS          FABELN
     C                   Z-ADD     DIFRAK        FABELV
     C                   ADD       DIFS          FABELV
     C                   END
      *
     C                   EXSR      SPLISR
      *
     C                   EXSR      NYFAK
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ***********************************************
     C     NYPF          BEGSR
      ***********************************************
      *
      *** LEGGE UT NY POST I FAKTURAREGISTER
      *
     C                   EXSR      MOVWSF
      *
     C     FAVAL         IFEQ      FICURR                                       1<-B
     C                   EXSR      VALUTA
     C                   ELSE                                                   1
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
     C     FAVK          IFEQ      'S'                                           2<-B
     C     HEVALS        IFNE      '   '                                          3<-B
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     HEVALK        IFNE      '   '                                          3<-B
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
      * HENT GEBYRKODE INFO
      *
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
      *
      *
      *
      *
     C                   EXSR      SPLISR
      *
     C                   EXSR      NYFAK
      *
      * ADD A LINE DEPENDING ON FREIGHT AMOUNTH
      *
     C     KGETYP        IFEQ      'SEA'                                        1<-B
     C     HEVALT        ANDNE     *BLANKS
     C     HEVALP        ANDNE     *ZEROS
     C                   MOVE      HEVALT        FAVK
     C                   MULT(H)   HEVALP        FABELN
     C                   MULT(H)   HEVALP        FABELV
      *
     C                   EXSR      SPLISR
      *
      *ALLTID + 1 TIL FALI VED VALUTATILLEGG ETC
      *DA IKKE MOVWSF KALLES
     C                   ADD       1             FALI
     C                   EXSR      NYFAK
     C                   END                                                    1<-E
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ***********************************************
     C     NYPG          BEGSR
      ***********************************************
      *
      *** ADDS NEW RECORD TO INVOICE FILE
      *                    MOVE WSSK      XSK2    1
     C                   EXSR      MOVWSF
      *
     C     FAVAL         IFEQ      FICURR                                       1<-B
     C                   EXSR      VALUTA
     C                   ELSE                                                   1
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
     C     FASK          IFEQ      'S'                                           2<-B
     C     HEVALS        IFNE      '   '                                          3<-B
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     HEVALK        IFNE      '   '                                          3<-B
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
      *
      *
     C                   EXSR      SPLISR
      *
     C                   EXSR      NYFAK
      *
      * ADDS CURRENCYPERCENT TO THE AMOUNTH
     C     KGETYP        IFEQ      'SEA'                                        1<-B
     C     HEVALT        ANDNE     *BLANKS
     C     HEVALP        ANDNE     *ZEROS
     C                   MOVE      HEVALT        FAVK
     C                   MULT(H)   HEVALP        FABELN
     C                   MULT(H)   HEVALP        FABELV
      *
     C                   EXSR      SPLISR
      *
      *ALLTID + 1 TIL FALI VED VALUTATILLEGG ETC
      *DA IKKE MOVWSF KALLES
     C                   ADD       1             FALI
     C                   EXSR      NYFAK
     C                   END                                                    1<-E
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ***********************************************
     C     NYPH          BEGSR
      ***********************************************
      *
      *** ADDS NEW RECORD TO INVOICE FILE
      *
      * INTERFAKTURERING AV DUPLIKATOPPDRAG
      *
     C                   MOVE      *ZEROS        FAAVDR
     C   47              MOVE      TRAVD1        FAAVDR
     C   48              MOVE      TRAVD2        FAAVDR
      * MOMSKODE FRA OPPDRAG GJELDER
     C                   MOVE      TRMVA         WSKDM
     C   47
     COR 48              MOVE      'I'           WSSK
      *
     C                   EXSR      MOVWSF
      *
     C     FAVAL         IFEQ      FICURR                                       1<-B
     C                   EXSR      VALUTA
     C                   ELSE                                                   1
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
     C     FASK          IFEQ      'S'                                           2<-B
     C     HEVALS        IFNE      '   '                                          3<-B
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     HEVALK        IFNE      '   '                                          3<-B
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
      *
      *
     C                   EXSR      SPLISR
      *
      * LEGGER INN KODE E I FASK VED ESTIMAT
      *
     C     KGETYP        IFEQ      'FRA'
     C     TRFRAK        ANDEQ     'E'
     C                   MOVE      FASK          FASKFR            1
     C                   MOVE      'E'           FASK
     C                   END
      *
     C                   EXSR      NYFAK
      * FLYTTER TILBAKE KODE S/K
     C     KGETYP        IFEQ      'FRA'
     C     TRFRAK        ANDEQ     'E'
     C                   MOVE      FASKFR        FASK
     C                   END
      * SLUTT FLYTTER TILBAKE KODE S/K
      *
      * ADDS CURRENCYPERCENT TO THE AMOUNTH
     C     KGETYP        IFEQ      'FRA'                                        1<-B
     C     HEVALT        ANDNE     *BLANKS
     C     HEVALP        ANDNE     *ZEROS
     C                   MOVE      HEVALT        FAVK
     C                   MULT(H)   HEVALP        FABELN
     C                   MULT(H)   HEVALP        FABELV
      *
     C                   EXSR      SPLISR
      *
      *
      * LEGGER INN KODE E I FASK VED ESTIMAT
      *
     C     KGETYP        IFEQ      'FRA'
     C     TRFRAK        ANDEQ     'E'
     C                   MOVE      FASK          FASKFR            1
     C                   MOVE      'E'           FASK
     C                   END
      *
     C                   EXSR      NYFAK
      * FLYTTER TILBAKE KODE S/K
     C     KGETYP        IFEQ      'FRA'
     C     TRFRAK        ANDEQ     'E'
     C                   MOVE      FASKFR        FASK
     C                   END
     C                   END                                                    1<-E
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      FASK          WSSK
     C                   MOVE      *ZEROS        FAAVDR
      *
     C                   ENDSR
      *
      ******************************************
     C     SPLISR        BEGSR
      ******************************************
      * LINE TO SPLITT OR DIRECT TO GENERAL LEDGER
     C     KODG2K        CHAIN     KOG2R                              34
      *
     C     KG2XXX        IFEQ      'J'                                          1B
     C                   MOVE      'S'           WSKDUK
     C     XBELN         MULT(H)   KG2PRO        WSBELU
     C     XBELN         SUB       WSBELU        WSBELU
     C                   ELSE                                                   1
     C     KG2XXX        IFEQ      'H'                                           2B
     C                   MOVE      'H'           WSKDUK
     C     WSBELU        IFEQ      *ZEROS                                         3B
     C                   Z-ADD     XBELN         WSBELU
     C                   END                                                      3E
     C                   ELSE                                                    2
      *
     C     KG2XXX        IFEQ      'F'                                            3B
     C                   MOVE      'F'           WSKDUK
     C     XBELN         MULT(H)   KG2PRO        WSBELU
     C     XBELN         SUB       WSBELU        WSBELU
     C                   ELSE                                                     3
      *
     C                   MOVE      *BLANKS       WSKDUK
     C                   MOVE      *ZEROS        WSBELU
      *
     C                   END                                                      3E
      *
     C                   END                                                     2E
     C                   END                                                    1E
     C                   MOVE      WSBELU        FABELU
     C                   MOVE      WSKDUK        FAKDUK
      *
     C                   ENDSR
      *
      ***********************************************
     C     OMREGN        BEGSR
      ***********************************************
      *
      *** AJUSTING VEIGHT        - LESS THAN 1000 TO NEAREST  10 KILO
      *** ELSE TO NEAREST     100 KG, BUT IF PRICE IS GIVEN   PR. 2-10
      *** TO NEAREST  10 KG. NOT IF PRICE PR 1 KILO
      *
      *** IF FIRM HAVE DEFINED NO AJUSTMENT
      *** (INGAVR = 'J') NO AJUSTMENT IS PERFORMED
      *
     C     X01B          IFEQ      'B'
     C                   Z-ADD     HEVKT         XVEKT             5 0
     C                   MOVE      *BLANKS       X01B
     C                   ELSE
     C                   Z-ADD     HEFBV         XVEKT
     C                   END
      *
     C     X01B          IFEQ      ' '                                          NOT PR LINE/PIESES
      * 1
     C     UAVR          IFNE      'J'
      * 2
     C     KOWMM         IFNE      3
      * 2B
     C     PRANT         IFNE      1
      * 3
     C     XVEKT         IFLT      1000                                         WEIGHT <   1000 KG
     C     XVEKT         ADD       9             XVEKT2            5 0          AJUST TO NEARES
     C                   MOVE      '0'           XVEKT2                         10 KG
     C                   ELSE                                                   WEIGHT >=     1000 K
     C     PRANT         IFGT      10                                           PRICE IS GIVEN PR 10
     C     XVEKT         ADD       99            XVEKT2            5 0          KG OR MORE  , AJUST
     C                   MOVE      '00'          XVEKT2                         TO NEAREST   100 KG
     C                   ELSE
     C     XVEKT         ADD       9             XVEKT2                         PRICE GIVEN PR
     C                   MOVE      '0'           XVEKT2                         2-9 KG, AJUST TO
     C                   END                                                    NEAREST  10 KG
     C                   END
      * 3
     C                   ELSE                                                   NO AJUSTMENT
     C                   Z-ADD     XVEKT         XVEKT2
     C                   END
      * 2B
     C                   ELSE                                                   PRICE PR 1 AND NOT P
     C                   Z-ADD     XVEKT         XVEKT2                         LINEPRICE/PIESESPRIC
     C                   END
      * 2
     C                   ELSE                                                   PRICE PR 1 AND NOT P
     C                   Z-ADD     XVEKT         XVEKT2                         LINEPRICE/PIESESPRIC
     C                   END
      * 1
     C     PRBELØ        DIV       PRANT         XWORK
     C     XWORK         MULT(H)   XVEKT2        PRBELØ
     C                   END
     C  N99X01B          IFEQ      'M'
     C     PRANT         IFNE      *ZEROS
     C                   MULT(H)   HEM3          PRBELØ
     C                   DIV(H)    PRANT         PRBELØ
     C                   END
     C                   END
      *
     C     X01B          IFNE      'D'
     C     X01B          IFNE      'L'
     C     HENTF         ORGT      0
     C     PRTEGN        IFEQ      '-'
     C                   SUB       PRJUST        PRBELØ
     C                   ELSE
     C     PRTEGN        IFEQ      '+'
     C                   ADD       PRJUST        PRBELØ
     C                   ELSE
      * M = MINIMUM
      *SYOSLO* IKKE VED VAREVERDI DA VALUTAPROBLEMER
     C     PRTEGN        IFEQ      'M'
     C     X01B          IFNE      'V'
     C     PRBELØ        IFLT      PRJUST
     C                   Z-ADD     PRJUST        PRBELØ
     C                   END
     C                   ELSE
     C                   MOVE      'M'           KODEMM            1
     C                   END
     C                   END
      * N = MAXIMUM
     C     PRTEGN        IFEQ      'N'
     C     X01B          IFNE      'V'
     C     PRBELØ        IFGT      PRJUST
     C                   Z-ADD     PRJUST        PRBELØ
     C                   END
     C                   ELSE
     C                   MOVE      'N'           KODEMM            1
     C                   END
     C                   END
      *SYOSLO SLUTT
     C                   END
     C                   END
     C                   END
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVB1         BEGSR
      ***********************************************
     C                   MOVE      *BLANKS       WSSK
     C                   MOVE      *BLANKS       WSVK
     C                   MOVE      *BLANKS       WSTNR
     C                   MOVE      *ZEROS        WSBELV
     C                   MOVE      *BLANKS       WSVAL
     C                   MOVE      *BLANKS       WSKDM
     C                   MOVE      *BLANKS       WSVT
     C                   MOVE      *BLANKS       FAVT
     C                   MOVE      *BLANKS       WSKDUK
     C                   MOVE      *ZEROS        WSBELU
     C                   MOVE      *ZEROS        WSKURS
     C                   MOVE      *ZEROS        WSANT
     C                   MOVE      *ZEROS        WSLEVN
     C                   MOVE      *ZEROS        WSKUNR
     C                   MOVE      *BLANKS       WSSAMM
     C  N41
     CANN42
     CANN46
     CANN49
     CANN50              MOVE      'J'           WSCCF
     C  N43
     CANN44
     CANN45              MOVE      *ZEROS        WSKOM
     C                   MOVE      *ZEROS        WSAVDR
     C                   MOVE      *ZEROS        WSAGRN
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVFWS        BEGSR
      ***********************************************
     C                   MOVE      FASK          WSSK
     C                   MOVE      FAVK          WSVK
     C                   MOVE      FACD11        WSSAMM
     C                   MOVE      *BLANKS       WSTNR
     C                   MOVE      FABELV        WSBELV
     C                   MOVE      FAVAL         WSVAL
     C                   MOVE      FAKDM         WSKDM
     C                   MOVE      FAVT          WSVT
     C                   MOVE      FAKDUK        WSKDUK
     C                   MOVE      FABELU        WSBELU
     C                   MOVE      FALEVN        WSLEVN
     C                   MOVE      FAKUNR        WSKUNR
     C                   MOVE      *ZEROS        WSKURS
     C                   MOVE      *ZEROS        WSANT
     C  N41
     CANN42
     CANN46
     CANN49
     CANN50              MOVE      'J'           WSCCF
     C  N43
     CANN44
     CANN45              MOVE      *ZEROS        WSKOM
     C                   MOVE      FAAVDR        WSAVDR
     C                   MOVE      FAAGRN        WSAGRN
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVWSF        BEGSR
      ***********************************************
      *  91 ON=endring(da er FALI kjent) ) 91 OFF=ny(hent neste FALI)
      *  NYPXX ="J" - Kommer fra NYPA, NYPB.... skal ikke chaine opp
     C  N91              DO
     C                   CALL      'SYGE06'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    FALI
     C                   END
     C     NYPXX         IFNE      'J'
     C     FAKTK         CHAIN     FAKT                               33
     C                   END
     C                   MOVE      UAVD          FAAVD
     C                   MOVE      UOPD          FAOPD
     C                   MOVE      WSSK          FASK
     C                   MOVE      WSVK          FAVK
     C                   MOVE      WSVT          FAVT
     C     WSVAL         IFEQ      '   '                                        I
     C     WSSK          IFEQ      'S'                                          II
     C     HEVALS        IFEQ      '   '                                        IIII
     C                   MOVE      FICURR        FAVAL
     C                   ELSE
     C                   MOVE      HEVALS        FAVAL
     C                   END                                                    IIII
     C                   ELSE
     C     HEVALK        IFEQ      '   '                                        IIII
     C                   MOVE      FICURR        FAVAL
     C                   ELSE
     C                   MOVE      HEVALK        FAVAL
     C                   END                                                    IIII
     C                   END                                                    II
     C                   ELSE
     C                   MOVE      WSVAL         FAVAL
     C                   END                                                    I
     C                   MOVE      FAVAL         WSVAL
     C                   MOVE      WSBELV        FABELV
     C                   MOVE      WSKDM         FAKDM
     C                   MOVE      XBELN         FABELN
     C                   MOVE      XKDA          FAKDA
     C                   MOVE      XKDUL         FAKDUL
     C                   MOVE      X01B          FA01B
     C                   MOVE      WSKDUK        FAKDUK
     C                   MOVE      WSBELU        FABELU
     C                   MOVE      WSLEVN        FALEVN
     C                   MOVE      WSKUNR        FAKUNR
     C                   MOVE      WSAVDR        FAAVDR
     C                   MOVE      WSAGRN        FAAGRN
     C                   MOVE      WSSAMM        FACD11
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVF          BEGSR
      ***********************************************
     C                   MOVE      *ZEROS        FALI
     C                   MOVE      *BLANKS       FASK
     C                   MOVE      *BLANKS       FAVK
     C                   MOVE      *BLANKS       KGENOT
     C                   MOVE      *BLANKS       FAVAL
     C                   MOVE      *BLANKS       FAVT
     C                   MOVE      *ZEROS        FABELV
     C                   MOVE      *BLANKS       FAKDM
     C                   MOVE      *ZEROS        FABELN
     C                   MOVE      *BLANKS       FAKDA
     C                   MOVE      *BLANKS       FAKDUK
     C                   MOVE      *ZEROS        FABELU
     C                   MOVE      *ZEROS        FALEVN
     C                   MOVE      *ZEROS        WSKURS
     C                   MOVE      *ZEROS        WSANT
     C  N41
     CANN42
     CANN46
     CANN49
     CANN50              MOVE      'J'           WSCCF
     C  N43
     CANN44
     CANN45              MOVE      *ZEROS        WSKOM
     C                   MOVE      *ZEROS        FAAVDR
     C                   MOVE      *ZEROS        FAAGRN
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVW          BEGSR
      ***********************************************
     C                   MOVE      *BLANKS       WSSK
      *                    MOVE '0'       *IN85
      * JUST CONSIGNEE - K (AIR EXPORT (44 on) singel(ag.ref=blank)->F)
     C     HEKDFS        IFEQ      'X'
     C     HEKDFK        ANDNE     'X'
      *                    MOVE '1'       *IN85            Plasser cursor
     C                   MOVE      'K'           WSSK
     C   44HERFA         IFEQ      *BLANKS
     C                   MOVE      'F'           WSSK
     C                   END
     C                   END
      * Kun mot selger - K
     C     HEKDFK        IFEQ      'X'
     C     HEKDFS        ANDNE     'X'
     C                   MOVE      'S'           WSSK
     C                   END
     C                   MOVE      *BLANKS       WSVK
     C                   MOVE      *BLANKS       WSSAMM
     C                   MOVE      *BLANKS       WSTNR
     C                   MOVE      *BLANKS       WSVAL
     C                   MOVE      *ZEROS        WSBELV
     C                   MOVE      *BLANKS       WSKDM
     C                   MOVE      *BLANKS       WSVT
     C                   MOVE      *BLANKS       WSKDUK
     C                   MOVE      *ZEROS        WSBELU
     C                   MOVE      *ZEROS        WSLEVN
     C                   MOVE      *ZEROS        WSKUNR
     C                   MOVE      *ZEROS        WSKURS
     C                   MOVE      *ZEROS        WSANT
     C  N41
     CANN42
     CANN46
     CANN49
     CANN50              MOVE      'J'           WSCCF
     C  N43
     CANN44
     CANN45              MOVE      *ZEROS        WSKOM
     C                   MOVE      *ZEROS        WSAVDR
      *
      * SPESIAL TRANSPORTOPPDRAG
      *
     C   46
     COR 47
     COR 48              MOVE      TRMVA         WSKDM
     C   47
     COR 48              MOVE      'I'           WSSK
      * AVD. INTERNBELASTNING VED FOR/ETTERFRAKT=HOV.OPPDRAGETS AVD.
     C   47              MOVE      TRAVD1        WSAVDR
     C   48              MOVE      TRAVD2        WSAVDR
     C                   MOVE      *ZEROS        WSAGRN
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVFAZ        BEGSR
      ***********************************************
      *
     C                   MOVE      FALI          ZLI               5 0
     C                   MOVE      FAAVD         ZAVD              4 0
     C                   MOVE      FAOPD         ZOPD              7 0
     C                   MOVE      FASK          ZSK               1
     C                   MOVE      FAVK          ZVK               3
     C                   MOVE      FAVAL         ZVAL              3
     C                   MOVE      FABELV        ZBELV            13 2
     C                   MOVE      FABELN        ZBELN            13 2
     C                   MOVE      FAKDM         ZKDM              1
     C                   MOVE      FAKDUL        ZKDUL             1
     C                   MOVE      FABELU        ZBELU            13 2
     C                   MOVE      FALEVN        ZLEVN             8 0
     C                   MOVE      KGENOT        ZGENOT           20
     C                   MOVE      FAVT          ZAVT             20
     C                   MOVE      FAAVDR        ZAVDR             4 0
     C                   MOVE      FAAGRN        ZAGRN             9 0
     C                   ENDSR
      *
      ***********************************************
     C     MOVZFA        BEGSR
      ***********************************************
      *
     C                   MOVE      ZLI           FALI
     C                   MOVE      ZAVD          FAAVD
     C                   MOVE      ZOPD          FAOPD
     C                   MOVE      ZSK           FASK
     C                   MOVE      ZVK           FAVK
     C                   MOVE      ZVAL          FAVAL
     C                   MOVE      ZBELV         FABELV
     C                   MOVE      ZBELN         FABELN
     C                   MOVE      ZKDM          FAKDM
     C                   MOVE      ZKDUL         FAKDUL
     C                   MOVE      ZBELU         FABELU
     C                   MOVE      ZLEVN         FALEVN
     C                   MOVE      ZGENOT        KGENOT
     C                   MOVE      ZAVT          FAVT
     C                   MOVE      ZAVDR         FAAVDR
     C                   MOVE      ZAGRN         FAAGRN
     C                   ENDSR
      *
      ***********************************************
     C     CMDLIN        BEGSR
      ***********************************************
      * CHANGES SHOWING OF POSSIBLE KEYS ON SCREEN
      *
     C     XCMD          IFEQ      0
     C                   MOVE      'DIV0020'     MSGC1                          CMD-3
     C                   MOVE      'DIV0021'     MSGC2                          CMD-5
     C                   MOVE      'DIV1005'     MSGC3                          CMD-10
     C                   Z-ADD     1             XCMD              1 0
     C   36
     CAN 89              Z-ADD     2             XCMD
     C   36
     CAN 89
     CAN 39              Z-ADD     3             XCMD
     C                   ELSE
     C     XCMD          IFEQ      1
     C  N36              MOVE      'DIV1006'     MSGC1                          CMD-4
     C   36              MOVE      'DIV3572'     MSGC1                          CMD-4
     C  N89              MOVE      'DIV0022'     MSGC2                          CMD-6
     C   89              MOVE      'DIV3572'     MSGC2                          CMD-6
     C                   MOVE      'DIV2051'     MSGC3
     C                   ADD       1             XCMD
     C   39              Z-ADD     3             XCMD
     C                   ELSE
     C     XCMD          IFEQ      2
     C                   MOVE      'DIV1007'     MSGC1                          CMD-7
     C                   MOVE      'DIV1008'     MSGC2                          CMD-8
     C                   MOVE      'DIV0024'     MSGC3                          CMD-12
     C                   ADD       1             XCMD
     C                   ELSE
     C                   MOVE      'SHU0023'     MSGC1                          CMD-20
     C                   MOVE      'DIV4098'     MSGC2                          CMD-11
     C                   Z-ADD     0             XCMD
     C                   END
     C                   END
     C                   END
      *
     C                   ENDSR
      *
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
      * INITIALIZATION OF VARIABLES, KEYS ETC.
      *
     C     *LIKE         DEFINE    FAVK          FAVKW
     C     *LIKE         DEFINE    XTKNR         XTKNRG
      *
      * NØKKEL FOR AVTALEBYTE
      *
     C     KAVTK         KLIST
     C                   KFLD                    XAKNK
     C                   KFLD                    WSSK
     C                   KFLD                    HEOT
     C                   KFLD                    HEFR
      *
      * NØKKEL FOR BRUTTOPRIS
      *
     C     BRUKEY        KLIST
     C                   KFLD                    WSSK
     C                   KFLD                    HEFR
     C                   KFLD                    HEOT
     C                   KFLD                    PKGEBY
      *
      * NØKKEL FOR AVTALEBYTE
      *
     C     KAVTS         KLIST
     C                   KFLD                    XAKNS
     C                   KFLD                    WSSK
     C                   KFLD                    HEOT
     C                   KFLD                    HEFR
      *
      * NØKKEL FOR KUNDERS VEKTGRUPPE-INNDELING
      *
     C     FRATKV        KLIST
     C                   KFLD                    FTKNR
     C                   KFLD                    FTFRAN
     C                   KFLD                    FTOPDT
     C                   KFLD                    FTSK
     C                   KFLD                    FTFRA
     C                   KFLD                    FTTIL
     C                   KFLD                    FTAVTN
     C     FAKTK         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    FALI
     C     FAK2K         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    XSK
     C     HEADFK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     DOKEFK        KLIST
     C                   KFLD                    XRI
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     DOKUIK        KLIST
     C                   KFLD                    XDISTA
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    XFBNR
     C     VALU1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSVAL
     C     VALUK2        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    FAVAL
     C     CCK1          KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    HEKNSF
     C     CCK2          KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    HEKNKF
     C     LEVE1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSLEVN
     C     KUND1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSKUNR
     C     KODTVK        KLIST
     C                   KFLD                    XVUNI
     C                   KFLD                    HEAVD
     C     KOKEY1        KLIST
     C                   KFLD                    XAUNI
     C                   KFLD                    WSAVDR
     C     KOKEY2        KLIST
     C                   KFLD                    XAUNI
     C                   KFLD                    UAVD
     C     KODTWK        KLIST
     C                   KFLD                    XWUNI
     C                   KFLD                    HEAVD
     C     KODGEK        KLIST
     C                   KFLD                    XGEUNI
     C                   KFLD                    WSVK
     C     KODGEA        KLIST
     C                   KFLD                    XGEUNI
     C                   KFLD                    PKGEBY
     C     KODG2K        KLIST
     C                   KFLD                    XG2UNI
     C                   KFLD                    WSVK
     C     KODLKK        KLIST
     C                   KFLD                    XLKUNI
     C                   KFLD                    HELKA
     C     KODFSK        KLIST
     C                   KFLD                    XFSUNI
     C                   KFLD                    XKNF
     C     KODDIK        KLIST
     C                   KFLD                    XDIUNI
     C     PRISKK        KLIST
     C                   KFLD                    WSTNR
     C                   KFLD                    WSVK
     C                   KFLD                    XINT
     C     PRIKK         KLIST
     C                   KFLD                    XKNR
     C                   KFLD                    XAVTN
     C                   KFLD                    XGEBY
     C                   KFLD                    XAVTT
     C                   KFLD                    XINT
     C                   KFLD                    XLNR
     C     PRIK1K        KLIST
     C                   KFLD                    XKNR
     C                   KFLD                    XFRAN
     C                   KFLD                    XOPDT
     C                   KFLD                    XAVTN
     C                   KFLD                    XGEBY
     C                   KFLD                    XLNR
     C     PRJOIK        KLIST
     C                   KFLD                    PKKNR
     C                   KFLD                    PKAVTN
     C                   KFLD                    PKLNR
      * KEYS FOR FRAKT - HOVEDRELASJON
     C     FRATK         KLIST
     C                   KFLD                    XTKNR
     C                   KFLD                    XTFRAN
     C                   KFLD                    XTOT
     C                   KFLD                    XTSK
     C                   KFLD                    XTFRA
     C                   KFLD                    XTTIL
     C                   KFLD                    XTAVTN
     C     FRATK2        KLIST
     C                   KFLD                    XTKNR
     C                   KFLD                    XTFRAN
     C                   KFLD                    XTOT
     C                   KFLD                    XTSK
     C                   KFLD                    XSONEF
     C                   KFLD                    XTTIL
     C                   KFLD                    XTAVTN
     C     FRATK3        KLIST
     C                   KFLD                    XTKNR
     C                   KFLD                    XTFRAN
     C                   KFLD                    XTOT
     C                   KFLD                    XTSK
     C                   KFLD                    XTFRA
     C                   KFLD                    XSONET
     C                   KFLD                    XTAVTN
     C     FRATK4        KLIST
     C                   KFLD                    XTKNR
     C                   KFLD                    XTFRAN
     C                   KFLD                    XTOT
     C                   KFLD                    XTSK
     C                   KFLD                    XSONEF
     C                   KFLD                    XSONET
     C                   KFLD                    XTAVTN
     C     CFRATK        KLIST
     C                   KFLD                    XTKNR
     C                   KFLD                    BLTR
     C                   KFLD                    HEFR
     C                   KFLD                    HEOT
     C                   KFLD                    XTSK
     C                   KFLD                    HESDF
     C                   KFLD                    HESDT
     C                   KFLD                    BVKDC
     C     WSSDFK        KLIST
     C                   KFLD                    FIRLKF            2
     C                   KFLD                    HESDF
     C     KODO2K        KLIST
     C                   KFLD                    XO2UNI
     C                   KFLD                    HEOT
     C     WSSDTK        KLIST
     C                   KFLD                    FIRLKT            2
     C                   KFLD                    HESDT
      *
     C     *ENTRY        PLIST
     C                   PARM                    UFIRM             2
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD
     C                   PARM                    UNYGML            2
     C                   PARM                    XYZ0              1
     C                   PARM                    XYZ1              4 2
     C                   PARM                    XYZ2              4 2
     C                   PARM                    XYZ3              2 0
     C                   PARM                    XYZ4              2 0
     C                   PARM                    XYZ5              1
     C                   PARM                    XYZ6              1
     C                   PARM                    UKFRA             7 0
     C                   PARM                    UAVR              1
     C                   PARM                    UMSG
      * UMELD IS NOT IN USE
     C                   PARM                    UMELD             1
     C                   PARM                    UFLAGG            1 0
      *** USK = 'O' CALL FROM SYFF10CLO
      *** USK = 'S' CALL FROM SYFF10CLS
      *** USK = 'K' CALL FROM SYFF10CLK
      *** USK = 'A' CALL FROM ?????????
     C                   PARM                    USK               1
     C                   PARM                    USECUR            6
      *** (UFLAGG = 1)  =  CALL FROM SYIN10
      *
      * HVIS AVDELINGSNUMMER ER NEGATIVT SÅ ER DET ET KALL IFRA SPØRRIN
     C                   MOVEA     *ZEROS        *IN(1)
     C     UFLAGG        COMP      1                                      36
     C     USK           IFEQ      'A'
     C                   SETON                                        3738
     C                   ELSE
     C     USK           COMP      'K'                                    37    KUN KJØPER
     C     USK           COMP      'S'                                    38    KUN SELGER
     C                   END
     C     USK           IFNE      ' '
     C                   SETON                                        3639
     C                   END
      *
      * TESTS IF READYMARKED INVOICE
      *
     C     HEADFK        CHAIN(N)  FERDL01                            33
     C  N33              MOVE      'J'           UMELD
     C  N33              SETON                                        90
     C                   MOVE      ' '           XSK               1
      * INIT-TESTER DUPLIKATOPPDRAG SLUTT
      *
     C                   MOVE      'F'           XRI               1
     C                   MOVE      'V'           XVUNI             1
     C                   MOVE      'W'           XWUNI             1
     C                   MOVE      'A'           XAUNI             1
     C                   MOVE      'GE'          XGEUNI            2
     C                   MOVE      'G2'          XG2UNI            2
     C                   MOVE      'VA'          XVAUNI            2
     C                   MOVE      'FS'          XFSUNI            2
     C                   MOVE      'LK '         XLKUNI            3
     C                   MOVE      'DINNF'       XDIUNI            5
     C                   MOVE      'O2Y'         XO2UNI            3
     C                   MOVE      'I'           XDISTA            1
     C                   MOVE      '001'         XFBNR             3 0
     C                   MOVE      *ZEROS        XINT              5 0
     C                   MOVE      *BLANKS       XKNR              8
     C                   MOVE      *BLANKS       XFRAN             3
     C                   MOVE      *BLANKS       XOPDT             2
     C                   MOVE      *BLANKS       XAVTN             1
     C                   MOVE      *BLANKS       XGEBY             3
     C                   MOVE      *BLANKS       XAVTT             1
     C                   MOVE      *ZEROS        PRANT
     C                   MOVE      *ZEROS        XLNR              4 0
     C                   MOVE      *ZEROS        XTKNR             8 0
     C                   MOVE      '   '         XTFRAN            3
     C                   MOVE      '  '          XTOT              2
     C                   MOVE      ' '           XTSK              1
     C                   MOVE      '     '       XTFRA             5
     C                   MOVE      '     '       XTTIL             5
     C                   MOVE      *ZEROS        XTAVTN            1 0
     C                   MOVE      'DIV0029'     MSGC4                          CMD-24
     C                   EXSR      CMDLIN
     C                   MOVEL     'DIV1206'     SOTXT1                         SØK LEV
     C                   MOVE      *ZEROS        FF
     C                   MOVE      *ZEROS        AX
     C                   MOVE      *ZEROS        LOKUPF
     C                   MOVE      *ZEROS        HEM3
     C                   MOVE      *ZEROS        HEFBV
     C                   MOVE      UAVD          UAVDAN            4
     C                   MOVE      UOPD          UOPDAN            7
      *
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
     C                   SETOFF                                       33
     C     KOKEY2        CHAIN     KOAR                               33
     C     DOKUIK        CHAIN     DOKUI                              33
     C   33              Z-ADD     0             DIFRAK
     C   33              Z-ADD     0             DIFS
     C     KODDIK        CHAIN     KODTDINR                           33
     C     KDIPRO        DIV       100           XTILBA            5 4
     C                   ADD       1             XTILBA
     C     HEADFK        CHAIN(N)  HEADF                              33
     C                   MOVE      HEAVD         WSAVDR
     C                   MOVE      HEDTD         WSDTD
     C                   MOVE      HEDTM         WSDTM
     C                   MOVE      HEDTÅ         WSDTÅ
     C     KOKEY1        CHAIN     KOAR                               33
     C                   MOVE      *ZEROS        WSAVDR
     C     HEUR          COMP      'A'                                    41
     C     HEUR          COMP      'B'                                    42
     C     HEUR          COMP      'C'                                    43
     C     HEUR          COMP      'D'                                    44
     C     HEUR          COMP      'E'                                    45
     C     HEUR          COMP      'F'                                    49
     C     HEUR          COMP      'G'                                    50
     C   49              MOVE      FIURBI        XURB              1
     C   50              MOVE      FIURBE        XURB              1
      *
      *** INITIERER CCFEE VED IMPORT FLY
      *
     C   43              MOVE      'J'           WSCCF
      *
      *** HENTE VALUTAKURS VED SJØFRAKT
      *
     C     HEADFK        CHAIN     BILLOF                             33
      *
      * SPESIALTESTER TRANSPORTOPPDRAG
      *
     C                   MOVE      ' '           TRFRAK
     C                   MOVE      ' '           TRMVA
     C                   SETOFF                                       464748
     C                   SETOFF                                       33
     C  N33HEUR          COMP      'H'                                    46
     C  N33
     CAN 46TRSLAG        IFEQ      'FF'
     C                   SETON                                        47
     C                   END
     C  N33
     CAN 46TRSLAG        IFEQ      'VF'
     C                   SETON                                        48
     C                   END
      *****      HEUR      COMP 'H'  SETTES PÅ I INITRUTINE  46/47/48
     C   41
     COR 43
     COR 45
     COR 49              MOVE      HELKA         FIRLKF
     C   41
     COR 43
     COR 45
     COR 49KOAPOS        IFEQ      'J'
     C                   MOVE      FILAND        FIRLKT
     C                   ELSE
     C     HESDT         CHAIN     STED2                              33
     C                   MOVE      ST2LK         FIRLKT
     C                   END
     C   42
     COR 44
     COR 50KOAPOS        IFEQ      'J'
     C                   MOVE      FILAND        FIRLKF
     C                   ELSE
     C     HESDF         CHAIN     STED2                              33
     C                   MOVE      ST2LK         FIRLKF
     C                   END
     C   42
     COR 44
     COR 50              MOVE      HELKA         FIRLKT
      *
      * CHAINER I AVDELINGSREGISTER UANSETT PGA UTLEGGSPRVISJON
      *
      *** HENT OPPDRAGSTYPE
     C                   Z-ADD     FIUPM         FIUPMN
     C     KODO2K        CHAIN     KOOT2R                             33
     C   47
     COR 48              MOVE      'N'           KO2UTL
     C     KODTVK        CHAIN     KOVR                               33
     C     AVUTPR        IFNE      *ZEROS
     C                   Z-ADD     AVUTPR        FIUPS
     C                   Z-ADD     AVUTMI        FIUPMN            4 0
     C                   END
     C   41
     COR 42
     COR 49
     COR 50
     COR 46              DO
     C     KODTWK        CHAIN     KOWR                               33
     C                   MOVE      99999         KOVK12
     C                   MOVE      99999         FRVK12
     C                   END
     C   44
     COR 45KODFSK        CHAIN     KODTFSR                            33
     C   44KODDIK        CHAIN     KODTDINR                           33
     C     DOKEFK        CHAIN     DOKEF                              33
      * Fetch From/To name.   If destination codes have a  onblank
      * alternate dest.code for freightcalculation, use that code
      * for a second try (when chaining up surface freight prices)
      * Destination from:
     C     WSSDFK        CHAIN     STED2D                             33
     C  N33              MOVEL     ST2NVN        WSFRA
     C  N33              MOVE      ST2KO2        SONEF             5
      * Destination to:
     C     WSSDTK        CHAIN     STED2D                             33
     C  N33              MOVEL     ST2NVN        WSTIL
     C  N33              MOVE      ST2KO2        SONET             5
      * Destination pre freight from:
     C     HESDFF        CHAIN     STED2                              33
     C  N33              MOVE      ST2KO2        SONEFF            5
      * Destination post freight to:
     C     HESDVT        CHAIN     STED2                              33
     C  N33              MOVE      ST2KO2        SONEVT            5
     C                   MOVE      *BLANKS       XSONEF            5
     C                   MOVE      *BLANKS       XSONET            5
      * Priceagreement is done with invoice reciever (default) or
      * with goods owner. (Value "G" in FIAVTE  in fil FIRM ->goodsown.
     C     FIAVTE        IFEQ      'G'
      * Goodsowner (swapp values in workfields )
     C     HEKNS         IFNE      *ZEROS
     C                   MOVE      HEKNS         XAKNSF
     C                   ELSE
     C                   MOVE      HEKNSF        XAKNSF
     C                   END
     C     HEKNK         IFNE      *ZEROS
     C                   MOVE      HEKNK         XAKNKF
     C                   ELSE
     C                   MOVE      HEKNKF        XAKNKF
     C                   END
     C                   MOVE      HEKNSF        XAKNS
     C                   MOVE      HEKNKF        XAKNK
     C                   ELSE
      * Invoicereciever (default)
     C                   MOVE      HEKNS         XAKNS             8 0
     C                   MOVE      HEKNSF        XAKNSF            8 0
     C                   MOVE      HEKNK         XAKNK             8 0
     C                   MOVE      HEKNKF        XAKNKF            8 0
     C                   END
      *
      * IND. 27 AV  -->  STYKKGODS
      * IND. 27 PÅ  -->  CONTAINER
     C                   SETOFF                                       27
     C     HEUR          IFEQ      'F'
     C     HEUR          OREQ      'G'
     C     HEADFK        SETLL     BLV1LF                             33
     C     STINIT        TAG
     C     HEADFK        READE     BLV1LF                                 33
     C  N33              DO
     C     BVKDC         CHAIN     CDCON4                             33
     C   33              GOTO      STINIT
     C                   SETON                                        27
     C                   END
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     NYFAK         BEGSR
      ***********************************************
     C     KODEMM        IFEQ      'M'
     C     X01B          IFEQ      'V'
     C     FABELN        IFLT      PRJUST
     C                   Z-ADD     PRJUST        FABELN
     C                   END
     C                   END
     C                   END
      * N = MAXIMUM
     C     KODEMM        IFEQ      'N'
     C     X01B          IFEQ      'V'
     C     FABELN        IFGT      PRJUST
     C                   Z-ADD     PRJUST        FABELN
     C                   END
     C                   END
     C                   END
     C                   MOVE      *BLANKS       KODEMM
     C                   EXSR      DECI
      * DERSOM BUDSJETTERT KOSTNAD - LEGG UT NY OGSÅ I KOSBU
     C     FAKDUK        IFEQ      'B'
     C                   MOVE      *ZEROS        FAJOUR
     C                   EXSR      KOST
     C                   END
      *
     C   47
     COR 48              MOVE      'I'           FASK
     C  N47
     CANN48              MOVE      *ZEROS        FAAVDR
     C  N47
     CANN48FASK          IFEQ      'I'
     C                   Z-ADD     WSAVDR        FAAVDR
     C                   END
     C   47              MOVE      TRAVD1        FAAVDR
     C   48              MOVE      TRAVD2        FAAVDR
      *
     C   49
     COR 50KGETYP        IFEQ      'SEA'                                        1<-B
     C     FAVAL         ANDNE     FICURR
     C     BLOB          ANDNE     *BLANKS
     C     BLREIS        ANDNE     *BLANKS
     C     FAKDA         IFEQ      'A'                                           2<-B
     C     FAKDA         OREQ      'B'
     C     FASK          IFEQ      'S'                                            3<-B
     C     FASK          OREQ      'K'
     C     FASK          IFEQ      'S'                                             4<-B
     C                   MOVE      HEKNSF        UKN               8 0
     C                   ELSE                                                      4
     C                   MOVE      HEKNKF        UKN
     C                   END                                                       4<-E
     C                   MOVE      BLDTA         ULDTA             6 0
     C                   CALL      'SYSJ30B'
     C                   PARM                    BLOB
     C                   PARM                    BLREIS
     C                   PARM                    FAVAL
     C                   PARM                    ULDTA
     C                   PARM                    FASK
     C                   PARM                    UKN
     C                   PARM                    FABELV
     C                   PARM                    FABELN
     C                   PARM                    VALKU1
     C                   PARM                    OMRFAK
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C                   MOVE      PKSAMM        FACD11
     C                   EXCEPT    NYFAKU
     C                   MOVE      *BLANKS       PKSAMM
     C*
     C                   ENDSR
      *
      ***********************************************
     C     UPFAK         BEGSR
      ***********************************************
      * TEST NUBER OF DECIMALS
     C                   EXSR      DECI
      * DERSOM BUDSJETTERT KOSTNAD - LEGG UT/OPPDATER I KOSBU
     C     FAKDUK        IFEQ      'B'
     C                   EXSR      KOST
     C                   END
     C     FASK          IFEQ      'I'
     C                   Z-ADD     WSAVDR        FAAVDR
     C                   END
      * UPDATES INVOICELINES
     C                   MOVE      ' '           FAOPKO
     C                   EXCEPT    GMFAKU
      *
     C                   ENDSR
      *
      ***********************************************
     C     KOST          BEGSR
      ***********************************************
      *  BRUKER FAJOUR - TIL Å LAGRE X-REF TIL KOSBU
      *  FAJOUR ER "LEDIG" HELT TIL OVERFØRING TIL REGNSKAP.
      *
     C                   Z-ADD     FAJOUR        KTNR
      * TILDELER REFNUMMER
      *
     C     KTNR          CHAIN     KOSBU                              34
     C  N34              UPDATE    KOSBUR
     C   34              MOVE      *ZEROS        FAJOUR
     C     FAJOUR        IFEQ      *ZEROS
     C     'Å'           CHAIN     KOSTT                              34
     C   34              MOVE      'Å'           KTTYP
     C   34              Z-ADD     1000000       KTNR
     C   34              WRITE     KOSTTR
     C  N34              ADD       1             KTNR
     C  N34              UPDATE    KOSTTR
     C                   END
      *
     C     KTNR          CHAIN     KOSBU                              34
     C   34              MOVE      ' '           BUST
     C     BUST          IFEQ      ' '
     C                   MOVE      KTNR          BUBNR
     C                   MOVEL     HEDTÅ         BUPCC
     C                   MOVE      HEDTÅ         BUPÅR
     C                   MOVE      HEDTM         BUPMN
     C                   MOVE      *ZEROS        BUTNR
     C                   MOVE      FALEVN        BULNR
     C                   MOVE      FICURR        BUVAL
     C                   Z-ADD     FABELU        BUBL
     C                   MOVE      FAVK          BUVK
     C                   MOVE      HESG          BUSG
     C     HEPRO         IFNE      *ZEROS
     C                   MOVE      HEAVD         BUTAVD
     C                   MOVE      HEPRO         BUTUNR
     C                   ELSE
     C                   MOVE      *ZEROS        BUTAVD
     C                   MOVE      *ZEROS        BUTUNR
     C                   END
     C                   MOVE      HEAVD         BUOAVD
     C                   MOVE      HEOPD         BUOPD
     C                   MOVE      'E'           BUBLST
     C                   MOVE      'E'           BUTYPE
     C                   MOVE      *BLANKS       BUTXT
     C                   MOVE      *BLANKS       BUBILK                         *BILKODE
     C                   MOVE      *BLANKS       BUBILN                         *BILNUMMER
     C                   MOVE      *ZEROS        BUFEDT                         *FERJ/TURDTO
     C                   MOVE      'O'           BUFER                          *O = OPPDRAG
     C                   MOVE      *ZEROS        BUBNR2                         *FØRT BNR
     C                   MOVE      *ZEROS        BUBNR3                         *"SLAVE" AV.
     C                   MOVE      *ZEROS        BULNR3                         SLAVE-LØPENR
     C                   MOVE      *ZEROS        BUBLFD                         *FORDELT BEL
     C                   END
     C   34              WRITE     KOSBUR
     C  N34              UPDATE    KOSBUR
     C                   MOVE      KTNR          FAJOUR
     C                   ENDSR
      ***********************************************
     C     DECI          BEGSR
      ***********************************************
      * TEST FIRMS NUMBER OF DECIMALS
      *
      * NO DECIMALS
     C     FIDECI        IFEQ      0
     C                   Z-ADD(H)  FABELN        FABEL0           11 0
     C                   Z-ADD     FABEL0        FABELN
     C                   Z-ADD(H)  FABELU        FABEL0           11 0
     C                   Z-ADD     FABEL0        FABELU
     C                   ELSE
      * 1 DECIMAL
     C     FIDECI        IFEQ      1
     C                   Z-ADD(H)  FABELN        FABEL1           12 1
     C                   Z-ADD     FABEL1        FABELN
     C                   Z-ADD(H)  FABELU        FABEL1           12 1
     C                   Z-ADD     FABEL1        FABELU
     C                   END
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     KDTFMT        BEGSR
      ***********************************************
      * CHANGES DATE-FORMAT FROM FIRM TO INTERNAL
     C                   MOVE      HEDTD         UDT1              2 0
     C                   MOVE      HEDTM         UDT2              2 0
     C                   MOVE      HEDTÅ         UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          HEDTD
     C                   MOVE      UDT2          HEDTM
     C                   MOVE      UDT3          HEDTÅ
      *
     C                   ENDSR
      ***********************************************
     C     VISFRE        BEGSR
      ***********************************************
     C                   Z-ADD     0             UFLAGG
     C                   CALL      'SYFA31CL'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFLAGG
     C                   ENDSR
      *
      ***********************************************
     C     FYLARR        BEGSR
      ***********************************************
     C     PKAVTT        IFEQ      'G'
     C     PKAVTT        OREQ      'H'
     C                   SETON                                        32
     C                   ADD       1             GN                2 0
     C                   MOVE      PKGEBY        GNT(GN)
     C                   SORTA     GNT
     C                   ELSE
     C                   MOVE      'J'           AVTALE            1
     C                   END
     C                   ENDSR
      ***********************************************
     C     TGISR         BEGSR
      ***********************************************
     C                   MOVE      '0101'        FRAII             4 0
     C                   MOVEL     HESDVT        TILII             4 0
     C                   Z-ADD     HELM          IILM              7 3
     C                   Z-ADD     HEM3          IIM3              7 3
     C                   CALL      'SYFB03'
     C                   PARM                    FRAII
     C                   PARM                    TILII
     C                   PARM                    HEVKT
     C                   PARM                    IILM
     C                   PARM                    IIM3
     C                   PARM                    NULLTR            8 0
     C                   PARM                    INLFRA            9 0
     C                   PARM                    HEFBV
     C                   PARM                    IFLAGG            1 0
     C                   Z-ADD     INLFRA        PRBELØ
     C                   MOVE      FICURR        WSVAL
     C                   ENDSR
      ***********************************************
     C     TGIHTTP       BEGSR
      ***********************************************
     C                   MOVE      '0101'        UPNF              4
     C                   MOVEL     HESDVT        UPNT              4
     C                   MOVE      HEVKT         UVKT              9
     C                   MOVE      HENT          UNT               7
     C                   MOVE      HEM3          UDM3              7
     C                   MOVE      '2'           UFLAGG2           1
     C                   CALL      'SYFB05C'
     C                   PARM                    UPNF
     C                   PARM                    UPNT
     C                   PARM                    UNT
     C                   PARM                    UVKT
     C                   PARM                    UDM3
     C                   PARM                    UKNT              8
     C                   PARM                    UBRTBL            9
     C                   PARM                    UNETBL            9
     C                   PARM                    URAB              3
     C                   PARM                    UFLAGG2
     C                   MOVE      UBRTBL        PRBELØ
     C                   MOVE      FICURR        WSVAL
      *
     C                   ENDSR
      *
     OFAKTR     EADD         NYFAKU
     O                       FA01
     O                       FALI
     O                       FAAVD
     O                       FAOPD
     O                       FASK
     O                       FAVK
     O                       FAVT
     O                       FAVAL
     O                       FABELV
     O                       FAKDM
     O                       FABELN
     O                       FAKDA
     O                       FAKDUL
     O                       FA01B
     O                       FAKDUK
     O                       FA01B
     O                       FABELU
     O                       FALEVN
     O                       FAKUNR
     O                       FAAVDR
     O                       FAJOUR
     O                       FAAGRN
     O                       FACD11
     OFAKTR     E            GMFAKU
     O                       FA01
     O                       FALI
     O                       FAAVD
     O                       FAOPD
     O                       FASK
     O                       FAVK
     O                       FAVT
     O                       FAVAL
     O                       FABELV
     O                       FAKDM
     O                       FABELN
     O                       FAKDA
     O                       FAKDUL
     O                       FAOPKO
     O                       FA01B
     O                       FAKDUK
     O                       FA01B
     O                       FABELU
     O                       FALEVN
     O                       FAKUNR
     O                       FAAVDR
     O                       FAJOUR
     O                       FAAGRN
     O                       FACD11
