      *
      ***********************************************************
      *** PROGRAM SKAL plukke epostadresse                    ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01 02 04-26                      ***
      *** LEDIGE INDIKATORER 28 29 31 32 35 38 51-56 58-69    ***
      ***                    74-78 80-87 89-99                ***
      ***********************************************************
     FCUNDC     IF   E             DISK
     FDISTLH    IF   E           K DISK
     FFIRM      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FKUNDL01   IF   E           K DISK
     F                                     RENAME(KUNDR:KUNDR2)
     FMAIL03FM  CF   E             WORKSTN
     F                                     INFDS(FBAREA)
     D                SDS
     D  UUSER                254    263
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D F5              S             75    DIM(12)
     D                 DS
     D  USØKKN                 1     30
     D  USØKKO                 1      2
     D  URRN                   3     12
     D  epofax                13     13
     D                 DS
     D  F3                     1      6
     D                                     DIM(6)
     D UP              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZ')
     D LO              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyz')
     IKUNDR
     I              BANKG                       SYBAGI
     I              POSTG                       SYPOGI
     C*
     C                   EXSR      INIT
     C*
     C     START         TAG
     C                   EXFMT     BILDE
     c                   setoff                                       3031
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   SETOFF                                       30
     C   03              GOTO      SLUTT
     C   12              GOTO      SLUTT
      *
      * SØKING
      *
     C   04              DO
      *
     C     LINNBR        IFeq      4
     C     LO:UP         XLATE     EPOST         usok
     C                   EXSR      SOKEPO
     C                   EVAL      EPOST=USOK
     C                   GOTO      START
     C                   END
      *
     C     LINNBR        IFeq      5
     C     LO:UP         XLATE     EPOST2        usok
     C                   EXSR      SOKEPO
     C                   EVAL      EPOST2=USOK
     C                   GOTO      START
     C                   END
      *
     C     LINNBR        IFeq      6
     C     LO:UP         XLATE     EPOST3        usok
     C                   EXSR      SOKEPO
     C                   EVAL      EPOST3=USOK
     C                   GOTO      START
     C                   END
      *
     C     LINNBR        IFeq      7
     C     LO:UP         XLATE     EPOST4        usok
     C                   EXSR      SOKEPO
     C                   EVAL      EPOST4=USOK
     C                   GOTO      START
     C                   END
      *
     C     LINNBR        IFeq      8
     C     LO:UP         XLATE     EPOST5        usok
     C                   EXSR      SOKEPO
     C                   EVAL      EPOST5=USOK
     C                   GOTO      START
     C                   END
      *
     C     LINNBR        IFeq      9
     C                   EXSR      SOKKUN
     C                   GOTO      START
     C                   END
     C                   END
      *
     C                   EXSR      TEST
     C   30              GOTO      START
     C*
     C                   z-add     11            LINNBR
     C                   z-add     10            POSNBR
     C*
     C  N10              GOTO      START
     C*
     c                   move      'J'           sendt
     c                   move      epost         epostu           70
     c                   exsr      sndepost
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     TEST          BEGSR
     C***********************************************
     C
      *
      *
     c                   setoff                                       30
     c                   setoff                                       707172
     C
      *
     C     KUNDNR        IFNE      *ZEROS
     C     KUKEY         CHAIN     CUNDL01                            71
     C  N71EPOST         IFEQ      *BLANKS
     C                   MOVEl     syepos        epost
     C                   END
      *
     c     *in(71)       ifeq      '1'
     C                   SETON                                        30
     C                   MOVE      'SPK0001'     MSGNR
     C                   z-add     9             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
      *
      * IKKE EPOST-ADRESSE LAGT INN
      *
     C     EPOST         ifeq      *BLANKS
     C                   SETON                                        3072
     C                   MOVE      'SHU0835'     MSGNR
     C                   z-add     4             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
      *
      * adresse må inneholde @
      *
     c                   else
     c                   movel     epost         star              1
     c     star          ifeq      '*'
     c                   movel     epost         dis7              7
     c                   move      dis7          dis6              6
     c     dis6          chain     distlh                             72
     c     *in(72)       ifeq      '1'
     C                   SETON                                        3072
     C                   MOVE      'SHU0915'     MSGNR
     C                   z-add     4             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     c                   end
     c                   else
     C     '@'           SCAN      EPOST                                  62
     c     *in(62)       ifeq      '0'
     C                   SETON                                        3072
     C                   MOVE      'SHU0848'     MSGNR
     C                   z-add     4             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
     C                   END
      *
      * epostadresse2
      *
     c     epost2        ifne      *blanks
     c                   movel     epost2        star              1
     c     star          ifeq      '*'
     c                   movel     epost2        dis7              7
     c                   move      dis7          dis6              6
     c     dis6          chain     distlh                             72
     c     *in(72)       ifeq      '1'
     C                   SETON                                        3072
     C                   MOVE      'SHU0915'     MSGNR
     C                   z-add     5             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     c                   end
     c                   else
     C     '@'           SCAN      EPOST2                                 62
     c     *in(62)       ifeq      '0'
     C                   SETON                                        3072
     C                   MOVE      'SHU0848'     MSGNR
     C                   z-add     5             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
     C                   END
      *
      *
      * epostadresse3
      *
     c     epost3        ifne      *blanks
     c                   movel     epost3        star              1
     c     star          ifeq      '*'
     c                   movel     epost3        dis7              7
     c                   move      dis7          dis6              6
     c     dis6          chain     distlh                             72
     c     *in(72)       ifeq      '1'
     C                   SETON                                        3072
     C                   MOVE      'SHU0915'     MSGNR
     C                   z-add     6             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     c                   end
     c                   else
     C     '@'           SCAN      EPOST3                                 62
     c     *in(62)       ifeq      '0'
     C                   SETON                                        3072
     C                   MOVE      'SHU0848'     MSGNR
     C                   z-add     6             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
     C                   END
      *
      *
      * epostadresse4
      *
     c     epost4        ifne      *blanks
     c                   movel     epost4        star              1
     c     star          ifeq      '*'
     c                   movel     epost4        dis7              7
     c                   move      dis7          dis6              6
     c     dis6          chain     distlh                             72
     c     *in(72)       ifeq      '1'
     C                   SETON                                        3072
     C                   MOVE      'SHU0915'     MSGNR
     C                   z-add     7             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     c                   end
     c                   else
     C     '@'           SCAN      EPOST4                                 62
     c     *in(62)       ifeq      '0'
     C                   SETON                                        3072
     C                   MOVE      'SHU0848'     MSGNR
     C                   z-add     7             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
     C                   END
      *
      *
      * epostadresse5
      *
     c     epost5        ifne      *blanks
     c                   movel     epost5        star              1
     c     star          ifeq      '*'
     c                   movel     epost5        dis7              7
     c                   move      dis7          dis6              6
     c     dis6          chain     distlh                             72
     c     *in(72)       ifeq      '1'
     C                   SETON                                        3072
     C                   MOVE      'SHU0915'     MSGNR
     C                   z-add     8             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     c                   end
     c                   else
     C     '@'           SCAN      EPOST5                                 62
     c     *in(62)       ifeq      '0'
     C                   SETON                                        3072
     C                   MOVE      'SHU0848'     MSGNR
     C                   z-add     5             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
     C                   END
      *
     C*
     C     SLTB          ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     *ENTRY        PLIST
     c                   parm                    kundna            8
     c                   parm                    knavn            30
     C                   PARM                    XUSER            10
     C                   PARM                    XJOBNO            6
     C                   PARM                    XJOBNA           10
     C                   PARM                    XFILE            10
     C                   PARM                    XSNBRA            2
     C                   PARM                    EPOST            70
     C                   PARM                    EPOST2           70
     C                   PARM                    EPOST3           70
     C                   PARM                    EPOST4           70
     C                   PARM                    EPOST5           70
     C                   PARM                    EMNE             40
     C                   PARM                    CVP1             40
     C                   PARM                    CVP2             40
     C                   PARM                    cvp3             40
     C                   PARM                    cvp4             40
     C                   PARM                    cvp5             40
     C                   PARM                    cvp6             40
     C                   PARM                    cvp7             40
     C                   PARM                    cvp8             40
     C                   PARM                    PDF               4
     C                   PARM                    sendt             1
     c                   move      'N'           sendt
     c                   move      kundna        kundnr
     C     KUKEY         KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
      *
     C                   READ      FIRM                                   44
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     sndepost      BEGSR
     C***********************************************
     C*
     C     EPOST2        IFNE      *BLANKS
     C                   EVAL      EPOST2B=EPOST2
     C                   ELSE
     C                   EVAL      EPOST2B='*NONE'
     C                   END
     C     EPOST3        IFNE      *BLANKS
     C                   EVAL      EPOST3B=EPOST2
     C                   ELSE
     C                   EVAL      EPOST3B='*NONE'
     C                   END
     C     EPOST4        IFNE      *BLANKS
     C                   EVAL      EPOST4B=EPOST2
     C                   ELSE
     C                   EVAL      EPOST4B='*NONE'
     C                   END
     C     EPOST5        IFNE      *BLANKS
     C                   EVAL      EPOST5B=EPOST2
     C                   ELSE
     C                   EVAL      EPOST5B='*NONE'
     C                   END
     c                   move      xsnbra        xsnbrn            2 0
     C                   CALL      'MAILSND'
     C                   PARM                    XUSER
     C                   PARM                    XJOBNO
     C                   PARM                    XJOBNA
     C                   PARM                    XFILE
     C                   PARM                    XSNBRN
     C                   PARM                    EPOSTU
     C                   PARM                    EPOST2B          50
     C                   PARM                    EPOST3B          50
     C                   PARM                    EPOST4B          50
     C                   PARM                    EPOST5B          50
     C                   PARM                    EMNE
     C                   PARM                    wsCVP1
     C                   PARM                    wsCVP2
     C                   PARM                    wscvp3
     C                   PARM                    wscvp4
     C                   PARM                    wscvp5
     C                   PARM                    wscvp6
     C                   PARM                    wscvp7
     C                   PARM                    wscvp8
     C                   PARM                    PDF               4
     C                   CALL      'MAIL01T4'
     C                   PARM                    XJOBNO
     C                   PARM                    XUSER
     C                   PARM                    XJOBNA
     C                   PARM                    XFILE
     C                   PARM                    XSNBRN
     c                   endsr
     C***********************************************
     C     SOKEPO        BEGSR
     C***********************************************
     C                   MOVE      *BLANKS       USØKKN           30
     C*
     C                   CALL      'VCUNDC2R'
     C                   PARM                    FIFIRM
     C                   PARM                    USOK             30
     C                   PARM                    URRN2            10 0
     c                   parm                    epofax            1
     C     URRN2         IFNE      *ZEROS
     C                   MOVE      URRN2         URRN
     C                   MOVE      'KP'          USØKKO
     C                   END
     C* RETUR MED KONTAKTPERS
     C     USØKKO        IFEQ      'KP'
     C                   MOVE      URRN          RRN              10 0
     C     RRN           CHAIN     CUNDC                              31
     C  N31              EVAL      USOK=CEMAIL
     C  N31              MOVE      CCOMPN        KUNDNR
     C                   END
     C                   ADD       1             LINNBR
     C                   ENDSR
     C***********************************************
     C     SOKKUN        BEGSR
     C***********************************************
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    KUNDNR
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN           30
     C* RETUR MED KONTAKTPERS
     C     USØKKO        IFEQ      'KP'
     C                   MOVE      URRN          RRN              10 0
     C     RRN           CHAIN     CUNDC                              31
     C  N31              MOVEL     CEMAIL        EPOST
     C  N31              MOVE      CCOMPN        KUNDNR
     C                   END
     C                   ENDSR
