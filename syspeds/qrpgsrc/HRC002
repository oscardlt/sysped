********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10264 * 01 YBC PTF10 DATALIST ER BYTTET MED SAD61PFT
********************************************************************
     H DECEDIT(',') debug(*yes)
      ***********************************************************
      *** PROGRAM for arkivering
      ***********************************************************
     FARUSERL1  IF   E           K DISK
     FTRAVH3    IF   E           K DISK
     FTRUV      IF   E           K DISK
     FSVXV      IF   E           K DISK    PREFIX(SVX_)
     FDOKUF     IF   E           K DISK
     FDOKEC     IF   E           K DISK
     FDOKECe    IF   E           K DISK
     FTRAVV6    IF   E           K DISK
     Fcundl01   IF   E           K DISK
     FFAK9      IF   E           K DISK
     FFIRM      IF   E           K DISK
     FARKEPO    UF A E           K DISK
     FARKTXT    IF   E           K DISK
     FTURER14   IF   E           K DISK
     FCUNDC03   IF   E           K DISK
     FFain      IF   E           K DISK
     Fhead14    IF   E           K DISK
     F                                     RENAME(HEADFR:HEAD14r)
     Fhead19    IF   E           K DISK
     F                                     RENAME(HEADFR:HEAD19r)
     Fheadf     IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FARKIVL01  UF A E           K DISK
     FARKIVL02  IF   E           K DISK
     F                                     RENAME(arkivr:arkivr2)
     FARKIVL11  UF   E           K DISK
     F                                     RENAME(arkivr:arkivr11)
     D                SDS
     D  UUSR                 254    263
     D                 DS
     D  FADATO                 1      8  0
     D  FAAA                   3      4
     D  FAMM                   5      6
     D  FADG                   7      8
     D                 DS
     D  avdopd                 1     11
     D  aravd                  1      4  0
     D  aropd                  5     11  0
     D                 DS
     D  ag                     1    800  0
     D                                     DIM(100)
     D                 DS
     D  hegn                   1     15
     D  hegn11                 5     15
     D                 DS
     D  V                      1     60
     D                                     DIM(30)
     D  arkved                 1     60
     D  V01                    1      2
     D  V02                    3      4
     D  V03                    5      6
     D  V04                    7      8
     D  V05                    9     10
     D  V06                   11     12
     D  V07                   13     14
     D  V08                   15     16
     D  V09                   17     18
     D  V10                   19     20
     D  V11                   21     22
     D  V12                   23     24
     D  V13                   25     26
     D  V14                   27     28
     D  V15                   29     30
     D  V16                   31     32
     D  V17                   33     34
     D  V18                   35     36
     D  V19                   37     38
     D  V20                   39     40
     D  V21                   41     42
     D  V22                   43     44
     D  V23                   45     46
     D  V24                   47     48
     D  V25                   49     50
     D  V26                   51     52
     D  V27                   53     54
     D  V28                   55     56
     D  V29                   57     58
     D  V30                   59     60
     D vedlegglm       C                   CONST('Mottaksrapport er sendt -
     D                                     som PDF-vedlegg')
     D vedlegglm2      C                   CONST('Mottaksrapport er sendt -
     D                                     fra:')
     D vedleggf        C                   CONST('Fakturaen er sendt -
     D                                     som PDF-vedlegg')
     D vedlegga        C                   CONST('Avregning er sendt -
     D                                     som PDF-vedlegg')
     D vedleggg        C                   CONST('Godsliste er sendt -
     D                                     som PDF-vedlegg')
     D vedleggt        C                   CONST('Tolldeklarasjon er sendt -
     D                                     som PDF-vedlegg')
     D vedleggs        C                   CONST('Fraktbrevet er sendt -
     D                                     som PDF-vedlegg')
     D vedleggaw       C                   CONST('Flyfraktbrev er sendt -
     D                                     som PDF-vedlegg')
     D trykklm         C                   CONST('Trykk på link for å -
     D                                     se på Mottaksrapport')
     D trykkf          C                   CONST('Trykk på link for å -
     D                                     se på faktura')
     D trykka          C                   CONST('Trykk på link for å -
     D                                     se på avregning')
     D trykkg          C                   CONST('Trykk på link for å -
     D                                     se på godsliste')
     D trykkt          C                   CONST('Trykk på link for å -
     D                                     se på Tolldeklarasjon')
     D trykks          C                   CONST('Trykk på link for å -
     D                                     se på Fraktbrevet')
     D trykkaw         C                   CONST('Trykk på link for å -
     D                                     se på flyfraktbrev')
     D                 DS
     D  UPARM2                 1     64
     D  UKJED                  1      8
     D  UPNR                   9     16
     D  UMRNR                 17     21
     D  UOPT                  22     22
     D  UKOPI                 23     23
      *
     c                   exsr      init
      *
     c     key           setll     arkivl01
     c     *in34         doweq     '0'
     c     stny          tag
     c     key           reade     arkivl01                               34
     c                   add       1             runde             5 0
     c**n34runde         comp      5                                  34
     c     *in34         ifeq      '0'
      *
      *mottaksrapport lagersystem
      *
     c     artype        ifeq      'lm'
     c                   exsr      pdflm
     c                   end
      *
      *faktura singel
      *
     c     artype        ifeq      'fa'
      * xfri=x betyr at annen bestilling kjører avbryt jobb
     c                   move      'X'           arstat
     c                   move      arunde        xxunde           10
     c                   except    updark
     c                   exsr      pdfinv
      *
      *hent arkivpost
      *
     c                   move      arlink        xxlink           40
     c     keya11        chain     arkivl11                           33
     c     *in33         ifeq      '0'
     c     fins1         ifeq      'J'
     c                   move      xxlink        arlink
     c                   Move      'A'           arSTAT
     c                   update    arkivr11
     c                   else
     c     fafakt        chain     fak9                               34
     c                   Move      'E'           arSTAT
     c   34              move      'N'           arstat
     c                   update    arkivr11
     c                   end
     c                   end
     c                   seton                                        lr
     c                   return
     c                   end
      *
      *ferje faktura
      *
     c     artype        ifeq      'ff'
     c                   exsr      pdfff
     c                   end
      *
      *transportøravregning
      *
     c     artype        ifeq      'ta'
     c                   exsr      pdftran
     c                   end
      *
      *proformafaktura
      *
     c     artype        ifeq      'pf'
     c                   exsr      pdfpf
     c                   end
      *
      *Invoice basis
      *
     c     artype        ifeq      'ib'
     c                   exsr      pdfib
     c                   end
      *
      *Invoice basis
      *
     c     artype        ifeq      'te'
     c                   exsr      pdfte
     c                   end
      * SVENSK NCTS EXPORT
      *
     C                   IF        ARTYPE = 'ne'
     C                   EXSR      PDFNE
     C                   END
      *
      *samlefaktura
      *skriver alle refer til arkivfil
      *
     c     artype        ifeq      'fs'
     c                   delete    arkivr
     c                   exsr      pdfinvs
     c                   end
      *
      *CMR
      *
     c     artype        ifeq      'cm'
     c                   exsr      pdfcmr
     c                   end
      *
      *stykkgodsfraktbrev
      *
     c     artype        ifeq      'sb'
     c                   exsr      pdffb
     c                   end
      *
      *sad import/eksport
      *
     c     artype        ifeq      'si'
     c     artype        oreq      'se'
     c                   exsr      pdfsad
     c                   end
      *
      *AWB FLYFRAKTBREV SINGEL
      *
     c     artype        ifeq      'aw'
     c                   exsr      pdfawb
     c                   end
      *
      *AWB FLYFRAKTBREV SINGEL
      *
     c     artype        ifeq      'am'
     c                   delete    arkivr
     c                   exsr      pdfawbm
     c                   end
      *
      *Godsliste for land
     c     artype        ifeq      'go'
      * tur må ha oppdrag
     C                   MOVEL     ARUNDE        TUPRO             8 0
     c     tupro         chain     head14                             33
     c     *in33         ifeq      '1'
     c                   delete    arkivr
     c                   goto      stny
     c                   end
     c                   exsr      pdfgods
     c                   end
      *
      * MANIFEST FLY
     c     artype        ifeq      'mf'
     c                   delete    arkivr
     c                   exsr      pdfman
     c                   end
      *
      * svensk fortolling import
     c     artype        ifeq      'SI'
     c     artype        oreq      'SE'
     c     artype        oreq      'S1'
     c     artype        oreq      'S2'
     c     artype        oreq      'S3'
     c     artype        oreq      'S4'
     c                   exsr      pdfsve
     c                   end
      * svensk utlæmningssedel
     c     artype        ifeq      'UT'
     c                   exsr      pdfutl
     c                   end
      *
      * oppdaterer hvis ikke spesiallogikk på dokumentet
      *
     c     artype        ifne      'fs'
     c     artype        andne     'am'
     c     artype        andne     'te'
     c     artype        andne     'ne'
     c     artype        andne     'mf'
     c     artype        andne     'fa'
     c                   Move      'A'           arSTAT
     c                   except    updark
     c                   end
     c                   end
     c                   end
     c     slutt         tag
     c                   seton                                        lr
     c                   return
      *
     C***********************************************
     C     PDFCMR        BEGSR
     C***********************************************
      * CMR fraktbrev
      *
      * tester om norsk eller utenlandsk variant
      *
     c                   move      'NO'          cmrlan            2
     C     FILAND        COMP      *BLANKS                            2727
     C   27FILAND        COMP      'NO'                               2727
     c   27              move      'EU'          cmrlan
     c* ordner start av linken med forståelig info
     c*
     c     keyhea        chain     dokec                              33
     c   33keyhea        chain     dokece                             33
     c     *in33         ifeq      '0'
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     c*                  else
     C     arlink        CAT       avdopd:0      arlink
     c*                  end
     c                   exsr      genbane
     C                   CALL      'PDF004CL'
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    cmrlan
     C                   PARM                    ARCINF
     C*
     c                   end
      *
     C                   ENDSR
     C*
     C***********************************************
     C     PDFPF         BEGSR
     C***********************************************
      * Proforma faktura
      *
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   move      arunde        ucomm             1
     c                   movel     artype        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     c                   exsr      genbane
     C                   CALL      'PDF011CL'
     C                   PARM                    Avdopd
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     C                   PARM                    ARCINF
     c                   parm                    ucomm
     C*
      *
     C                   ENDSR
     C***********************************************
     C     PDFIB         BEGSR
     C***********************************************
      * Proforma faktura
      *
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     c                   exsr      genbane
     C                   CALL      'PDF012CL'
     C                   PARM                    Avdopd
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     C                   PARM                    ARCINF
     C*
      *
     C                   ENDSR
     C***********************************************
     C     PDFTE         BEGSR
     C***********************************************
      * Transittering eksport
      *
     c     truvk         klist
     c                   kfld                    aravdi
     c                   kfld                    aropdi
     c                   move      aravd         aravdi            4 0
     c                   move      aropd         aropdi            7 0
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     C                   MOVE      ARUNDE        TRETYP            1
     C                   MOVEl     ARUNDE        thPRO             8
     C                   MOVE      thpro         thPROn            8 0
     C                   z-add     thpron        hePRO
     c                   exsr      genbane
      *
      * fikser bane til vareliste = UBANEV
      *
     c                   move      arlink        arlinkv          40
     c                   movel     'tf'          arlinkv
     C                   move      *blanks       ubanev           50
     C                   movel     ubanesta      ubanev
     C     ubanev        CAT       arlinkv:0     ubanev
     C     ubanev        CAT       '.pdf':0      ubanev
     C                   CALL      'PDF013CL'
     C                   PARM                    ARAVD
     C                   PARM                    AROPD
     C                   PARM                    TRETYP
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    varel             1
     c                   parm                    ubanev
     C                   PARM                    ARCINF
     C*
     c                   Move      'A'           arSTAT
     c                   except    updark
     c     varel         ifeq      'J'
     c                   move      'tf'          artype
     c                   movel     'tf'          arlink
     c                   write     arkivr
      *tilbakestill
     c                   move      'te'          artype
     c                   movel     'te'          arlink
     c                   end
      *
      * hvis flere oppdrag inngår legges disse i arkivp
      *
     c*                  dump
      *oppdaterer mot alle eventuelle headingrecord
      *
     c                   setoff                                       35
     c     truvk         setll     truv
     c     *in35         doweq     '0'
     c     lesnyte       tag
     c     truvk         reade     truv                                   35
     c     *in35         ifeq      '0'
      *ikke skriv doble record
     c     tvavd2        ifeq      aravdi
     c     tvtdn2        andeq     aropdi
     c                   goto      lesnyte
     c                   end
      *ikke skriv 0 record
     c     tvavd2        ifeq      0
     c     tvtdn2        oreq      0
     c                   goto      lesnyte
     c                   end
     C                   MOVE      tvavd2        ARAVD
     C                   MOVE      tvtdn2        AROPD
     c                   move      'A'           arstat
     c                   write     arkivr
     c                   end
     c                   end
      *
      *oppdaterer vareliste  mot alle headingrecord
     c     varel         ifeq      'J'
     c                   movel     'tf'          arlink
     c                   move      'tf'          artype
      *
     c                   setoff                                       35
     c     truvk         setll     truv
     c     *in35         doweq     '0'
     c     lesnytev      tag
     c     truvk         reade     truv                                   35
     c     *in35         ifeq      '0'
      *ikke skriv doble record
     c     tvavd2        ifeq      aravdi
     c     tvtdn2        andeq     aropdi
     c                   goto      lesnytev
     c                   end
      *ikke skriv 0 record
     c     tvavd2        ifeq      0
     c     tvtdn2        oreq      0
     c                   goto      lesnytev
     c                   end
     C                   MOVE      tvavd2        ARAVD
     C                   MOVE      tvtdn2        AROPD
     c                   move      'A'           arstat
     c                   write     arkivr
     c                   end
     c                   end
      *tilbakestill
     c                   move      'te'          artype
     c                   movel     'te'          arlink
     c                   end
      *
     C                   ENDSR
     C*
     C***********************************************
     C     PDFNE         BEGSR
     C***********************************************
      * SVENSK NCTS EXPORT
      *
     C     SVXVK         klist
     C                   kfld                    xaravdi
     C                   kfld                    xaropdi
     C                   move      aravd         xaravdi           4 0
     C                   move      aropd         xaropdi           7 0
      * ordner start av linken med forståelig info
      *
     C                   move      *blanks       arlink
     C                   movel     artype        arlink
     C                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     C                   MOVE      ARUNDE        TRETYP            1
     C                   MOVEl     ARUNDE        thPRO             8
     C                   MOVE      thpro         thPROn            8 0
     C                   z-add     thpron        hePRO
     C                   exsr      genbane
      *
      * fikser bane til vareliste = UBANEV
      *
     C                   move      arlink        arlinkv          40
     C                   movel     'nv'          arlinkv
     C                   move      *blanks       ubanev           50
     C                   movel     ubanesta      ubanev
     C     ubanev        CAT       arlinkv:0     ubanev
     C     ubanev        CAT       '.pdf':0      ubanev
     C                   move      aravd         xaravdA           4
     C                   move      aropd         xaropdA           7
     C                   CALL      'PDF018CL'
     C                   PARM                    XARAVDA
     C                   PARM                    XAROPDA
     C                   PARM                    TRETYP
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     C                   parm                    varel             1
     C                   parm                    ubanev
     C                   PARM                    ARCINF
      *
     C                   Move      'A'           arSTAT
     C                   except    updark
     C     varel         ifeq      'J'
     C                   move      'nv'          artype
     C                   movel     'nv'          arlink
     C                   write     arkivr
      *tilbakestill
     C                   move      'ne'          artype
     C                   movel     'ne'          arlink
     C                   end
      *
      * hvis flere oppdrag inngår legges disse i arkivp
      *
     c*                  dump
      *oppdaterer mot alle eventuelle headingrecord
      *
     C                   setoff                                       35
     C     SVXVK         SETLL     SVXV
     C     *in35         doweq     '0'
     C     STPDFNE       TAG
     C     SVXVK         READE     SVXV                                   35
     C     *in35         ifeq      '0'
      *ikke skriv doble record
     c     tvavd2        ifeq      aravdi
     c     SVX_tvtdn2    andeq     aropdi
     c                   goto      STPDFNE
     c                   end
      *ikke skriv 0 record
     c     tvavd2        ifeq      0
     c     SVX_tvtdn2    oreq      0
     c                   goto      STPDFNE
     c                   end
     C                   MOVE      Tvavd2        ARAVD
     C                   MOVE      SVX_tvtdn2    AROPD
     c                   move      'A'           arstat
     c                   write     arkivr
     C                   end
     C                   end
      *
      *oppdaterer vareliste  mot alle headingrecord
     C     varel         ifeq      'J'
     C                   movel     'nv'          arlink
     C                   move      'nv'          artype
      *
     C                   setoff                                       35
     C     SVXVK         SETLL     SVXV
     C     *in35         doweq     '0'
     C     STPDFNE2      TAG
     C     SVXVK         READE     SVXV                                   35
     C     *in35         ifeq      '0'
      *ikke skriv doble record
     C     tvavd2        ifeq      aravdi
     C     SVX_tvtdn2    andeq     aropdi
     C                   goto      STPDFNE2
     C                   end
      *ikke skriv 0 record
     C     tvavd2        ifeq      0
     C     SVX_tvtdn2    oreq      0
     C                   goto      STPDFNE2
     C                   end
     C                   MOVE      tvavd2        ARAVD
     C                   MOVE      SVX_tvtdn2    AROPD
     C                   move      'A'           arstat
     C                   write     arkivr
     C                   end
     C                   end
      *tilbakestill
     C                   move      'ne'          artype
     C                   movel     'ne'          arlink
     C                   end
      *
     C                   ENDSR
      *
     C***********************************************
     C     PDFAWB        BEGSR
     C***********************************************
      * AWB flyfraktbrev
     c     keyhea        chain     headf                              33
     c     *in33         ifeq      '0'
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     ardate        aar               4
     c                   movel     arunde        uulope            3
     C     arlink        CAT       aar:0         arlink
     c     hegn11        ifne      *blanks
     c     hegn11        andne     *zeros
     C     arlink        CAT       hegn11:0      arlink
     c                   else
     C     arlink        CAT       avdopd:0      arlink
     c                   end
     c                   exsr      genbane
     C                   CALL      'PDF007CL'
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    uulope
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
      *
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     c  N33arkund        ifne      0
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
     C     KU0AWB        TAG
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     C                   movel     'AWB-nummer:' wstex2
     C     wstex2        CAT       hegn11:1      wstex2
     c     faktkk        CHAIN     CUNDL01                            33
     C  N33wstex2        cat       'Fra:':1      wstex2
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C                   movel     'Flyfraktbrev'wscvp1
     C     wscvp1        cat       'fra:':0      wscvp1
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C                   movel     trykkaw       wscvp2
     C                   else
     c                   movel     vedleggaw     wscvp2
     C                   end
     C     ARKVED        IFNE      *BLANKS
     C                   CALL      'ARC002V'
     C                   PARM                    ARTYPE
     C                   PARM                    Aavd
     C                   PARM                    Aopd
     C                   PARM                    ARKVED
     C                   PARM                    CLIVE
     C                   PARM                    arinek
     C                   END
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           40
     c                   parm                    wscvp2           40
     c                   parm                    wscvp3           40
     c                   parm                    wscvp4           40
     C                   parm                    wscvp5           40
     C                   parm                    wscvp6           40
     C                   parm                    wscvp7           40
     C                   parm                    wscvp8           40
     C                   parm                    inteks            1
     c                   end
     c                   end
      * eventuelt mail til seg selv
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     C                   MOVE      *BLANKS       INTADR
     C                   CALL      'EPOS04'
     C                   PARM                    UUSR
     C                   PARM                    DIRENA            8
     C                   PARM                    DIREAD            8
     C                   PARM                    INTADR           70
     C                   EVAL      CEMAIL=INTADR
     C                   GOTO      KU0AWB
     C                   END
     C                   END
     c                   end
     c                   end
     c                   end
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     PDFAWBM       BEGSR
     C***********************************************
      * samlast fly
     c                   Move      'A'           arSTAT
     C                   MOVEL     ARUNDE        samlnr            6
     c                   movel     samlnr        saml1             3
     c                   move      samlnr        saml2             3
     c                   move      aravd         xxavd             4
     c                   setoff                                       35
     c                   move      aravd         xxavd             4
     C                   MOVE      *zeros        ARAVD
     C                   MOVE      *zeros        AROPD
      *
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       samlnr:0      arlink
     c                   exsr      genbane
      *
     C                   CALL      'PDF008CL'
     C                   PARM                    XXavd
     C                   PARM                    saml1
     C                   PARM                    saml2
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
     C*
      *
      * skriver 1 record pr oppdrag ved Master samlast
      *
     c     samlnr        setll     head19
     c     *in35         doweq     '0'
     c     samlnr        reade     head19                                 35
     c     *in35         ifeq      '0'
     C                   MOVE      HEAVD         ARAVD
     C                   MOVE      HEOPD         AROPD
     c                   write     arkivr
     c                   end
     c                   end
      *
     C                   ENDSR
     C*
     C***********************************************
     C     PDFINV        BEGSR
     C***********************************************
     C                   MOVEL     ARUNDE        AFAK              7
     C                   MOVEL     ARUNDE        fafakt
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       afak:0        arlink
     c                   move      'J'           fins1             1
     c                   move      'N'           fins2             1
     C*
     C     faktkk        KLIST
     C                   KFLD                    fifirm
     C                   KFLD                    fakunr
     C*
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
      *
      * Singel faktura til arkiv
      *
     C                   exsr      genbane
     C                   CALL      'PDF006CL'
     C                   PARM                    AAVD
     C                   PARM                    AFAK
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    fins1
     c                   parm                    ubanes
     c                   parm                    fins2
     C                   PARM                    ARCINF
      *
      * faktura må finnes
      *
     C     fins1         ifeq      'J'
      *
      * skal kunde ha mail
      *
     c     fafakt        chain     fak9                               33
     c     *in(33)       ifeq      '0'
     c                   z-add     fakunr        tuknt
     C     ARKSND        IFEQ      'J'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     C                   movel     'Fakturanr:'  wstex2
     C     wstex2        CAT       afak:1        wstex2
     C     wstex2        CAT       'fakturada':1 wstex2
     C     wstex2        CAT       'to:':0       wstex2
     C     wstex2        CAT       fadg:1        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       famm:0        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       faaa:0        wstex2
     c     faktkk        CHAIN     CUNDL01                            33
     C  N33wstex2        cat       'Til:':1      wstex2
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c*                  movel     wsline        epline
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C                   movel     'Faktura fra:'wscvp1
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C                   movel     trykkf        wscvp2
     C                   else
     c                   movel     vedleggf      wscvp2
     C                   end
     C     ARKVED        IFNE      *BLANKS
     C                   CALL      'ARC002V'
     C                   PARM                    ARTYPE
     C                   PARM                    Aavd
     C                   PARM                    Aopd
     C                   PARM                    ARKVED
     C                   PARM                    CLIVE
     C                   PARM                    arinek
     C                   END
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           40
     c                   parm                    wscvp2           40
     c                   parm                    wscvp3           40
     c                   parm                    wscvp4           40
     C                   parm                    wscvp5           40
     C                   parm                    wscvp6           40
     C                   parm                    wscvp7           40
     C                   parm                    wscvp8           40
     C                   parm                    inteks            1
     c                   end
     c                   end
     c                   end
     c                   end
     c                   end
     c                   end
     C                   ENDSR
     C***********************************************
     C     PDFFF         BEGSR
     C***********************************************
     C                   movel     arunde        afak              7
     C                   MOVEl     '0'           fffak             8
     C                   MOVE      afak          fffak
     C                   MOVEL     ARUNDE        fafakt
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     ardate        aar               4
     c                   move      aar           ffaar             2
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       afak:0        arlink
     C*
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
      *
      * Singel faktura til arkiv
      *
     C                   exsr      genbane
     C                   CALL      'PDF015CL'
     C                   PARM                    fffak
     C                   PARM                    AAVD
     C                   PARM                    ffaar
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     C                   PARM                    ARCINF
     C*
     c                   end
     C                   ENDSR
     C***********************************************
     C     PDFINVS       BEGSR
     C***********************************************
      *
      * samlefaktura
     c                   move      aravd         xxavd
     c                   move      'J'           fins1             1
     c                   move      'J'           fins2             1
     c                   Move      'A'           arSTAT
     C                   MOVEL     ARUNDE        fifn
     C                   MOVEL     ARUNDE        AFAK              7
     C                   MOVEL     ARUNDE        fafakt
     c                   move      'A'           arstat
      * skal arkivering skje
      *
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
     c                   setoff                                       35
     c     fifn          chain     fain                               33
     c     xxavd         ifeq      *zeros
     c                   move      fiavd         xxavd             4
     c                   end
      *****************************************************************************
      * genererer bane til spesifikasjon
      *****************************************************************************
     C                   MOVE      *zeros        ARAVD
     C                   MOVE      *zeros        AROPD
      *
      * ordner start av linken med forståelig info
      *
     c                   move      *blanks       arlink
     c                   movel     'fx'          arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       afak:0        arlink
      *
     c                   exsr      genbane
     c                   move      *blanks       ubanes           50
     c                   movel     ubane         ubanes
     c                   move      *blanks       uhttpis          76
     c                   movel     uhttpi        uhttpis
     c                   move      *blanks       uhttpes          76
     c                   movel     uhttpe        uhttpes
     c                   movel     arlink        arlinks          40
      *
      * genererer bane til selve fakturaen
      *
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   movel     'fs'          arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       afak:0        arlink
      *
     c                   exsr      genbane
     c                   movel     arlink        arlinkf          40
      *
     C                   CALL      'PDF006CL'
     C                   PARM                    XXavd
     C                   PARM                    AFAK
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    fins1
     c                   parm                    ubanes
     c                   parm                    fins2
     C                   PARM                    ARCINF
     C*
      *
      * skriver 1 record pr oppdrag ved samlefaktura
      *
     c     fifn          setll     fain
     c     *in35         doweq     '0'
     c     fifn          reade     fain                                   35
     c     *in35         ifeq      '0'
     C                   MOVE      FIAVD         ARAVD
     C                   MOVE      FIOPD         AROPD
      * faktura fins
     c     fins1         ifeq      'J'
     c                   move      'fs'          ARTYPE
     c                   movel     arlinkf       arlink
     c                   write     arkivr
     c                   end
      * egen record hvis spesifikasjon
      * ved spesifikasjon skrives record
     c     fins2         ifeq      'J'
     c                   move      'fx'          ARTYPE
     c                   movel     arlinks       arlink
     c                   write     arkivr
     c                   move      'fs'          ARTYPE
     c                   end
     c                   end
     c                   end
      *
      * skal kunde ha mail av samlefaktura
      *
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
      *
      * SKAL skal ha en mail
      *
     c     fafakt        ifne      gmfakt
     c                   z-add     fafakt        gmfakt            7 0
     c     fafakt        chain     fak9                               33
     c     *in(33)       ifeq      '0'
     c                   z-add     fakunr        tuknt
     C     ARKSND        IFEQ      'J'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
     c* slett eventuellt gamle poster
     c                   exsr      delark
     c                   move      *blanks       wstex2
     C                   movel     'Fakturanr:'  wstex2
     C     wstex2        CAT       afak:1        wstex2
     C     wstex2        CAT       'fakturada':1 wstex2
     C     wstex2        CAT       'to:':0       wstex2
     C     wstex2        CAT       fadg:1        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       famm:0        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       faaa:0        wstex2
     c     faktkk        CHAIN     CUNDL01                            33
     C  N33wstex2        cat       'Til:':1      wstex2
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     C                   MOVE      *BLANKS       EPBANE
     c     fins1         ifeq      'J'
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      * skjekk om mailbruker  er intern
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     c                   end
      *
      *spesifikasjon
      *
     c     fins2         ifeq      'J'
      *
      * skjekk om mailbruker  er intern
      *
     c                   movel     uhttpis       eplink
     c                   movel     uhttpes       epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANES
     C                   END
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c     fins1         ifeq      'J'
     c                   move      *blanks       wstex1           30
     c                   moveL     'Spesifikasjo'wste13           13
     c                   move      'n'           wste13
     c                   moveL     wste13        wstex1           30
     c                   end
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     c                   end
     C                   move      *blanks       wscvp1
     C                   movel     'Faktura fra:'wscvp1
     C     wscvp1        cat       fift:1        wscvp1
     C                   move      *blanks       wscvp2
     C     CLIVE         IFNE      'V'
     C                   movel     trykkf        wscvp2
     C                   else
     c                   movel     vedleggf      wscvp2
     C                   end
      *
      * vedlegg til alle oppdrag
      *
     C     ARKVED        IFNE      *BLANKS
     c                   setoff                                       35
     c     fifn          setll     fain
     c     *in35         doweq     '0'
     c     fifn          reade     fain                                   35
     c     *in35         ifeq      '0'
     C                   MOVE      FIAVD         Aavd
     C                   MOVE      FIOPD         aopd
     C                   CALL      'ARC002V'
     C                   PARM                    ARTYPE
     C                   PARM                    Aavd
     C                   PARM                    Aopd
     C                   PARM                    ARKVED
     C                   PARM                    CLIVE
     C                   PARM                    arinek
     c                   end
     C                   END
     C                   END
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           40
     c                   parm                    wscvp2           40
     c                   parm                    wscvp3           40
     c                   parm                    wscvp4           40
     C                   parm                    wscvp5           40
     C                   parm                    wscvp6           40
     C                   parm                    wscvp7           40
     C                   parm                    wscvp8           40
     C                   parm                    inteks            1
     c                   end
     c                   end
     c                   end
     c                   end
     c                   end
     c                   end
     c                   end
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     PDFLM         BEGSR
     C***********************************************
      * lager mottaksrapport
      *
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     ardate        aar               4
     c                   z-add     arkund        fakunr
     c                   z-add     arkund        tuknt
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       arunde:0      arlink
     C*
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
      *
      * Mottaksrapport til arkiv
      *
     C                   exsr      genbane
      *
     C                   MOVE      'J'           ukopi
     c                   movel     arunde        umrnr
     c                   move      arkund        upnr
     c                   move      'E'           uopt
     c                   move      *zeros        ukjed
     c                   move      uparm2        uuparm           64
     C                   CALL      'PDF014CL'
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     C                   PARM                    ARCINF
     C                   PARM                    UPARM2
     C*
      *
      * skal kunde ha mail
      *
     C     ARKSND        IFEQ      'J'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     C                   movel     'Rapportnr:'  wstex2
     C     wstex2        CAT       arunde:1      wstex2
     c     faktkk        CHAIN     CUNDL01                            33
     C  N33wstex2        cat       'Til:':1      wstex2
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C                   movel     vedlegglm2    wscvp1
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C                   movel     trykklm       wscvp2
     C                   else
     c                   movel     vedlegglm     wscvp2
     C                   end
     C     ARKVED        IFNE      *BLANKS
     C                   CALL      'ARC002V'
     C                   PARM                    ARTYPE
     C                   PARM                    Aavd
     C                   PARM                    Aopd
     C                   PARM                    ARKVED
     C                   PARM                    CLIVE
     C                   PARM                    arinek
     C                   END
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           40
     c                   parm                    wscvp2           40
     c                   parm                    wscvp3           40
     c                   parm                    wscvp4           40
     C                   parm                    wscvp5           40
     C                   parm                    wscvp6           40
     C                   parm                    wscvp7           40
     C                   parm                    wscvp8           40
     C                   parm                    inteks            1
     c                   end
     c                   end
     c                   end
     c                   end
     C                   ENDSR
     C***********************************************
     C     PDFGODS       BEGSR
     C***********************************************
      * Godsliste
      *
      *
      * SKAL GODSLISTE ARKIVERES
      *
      *
     C                   MOVEL     ARUNDE        TUPRO             8 0
     C                   MOVE      *BLANKS       ATUR10A          10
     C                   MOVE      *BLANKS       ATUR10T          10
     c     artype        chain     ARKTXT                             33
      *
     C  N33ARKJN         IFEQ      'J'
      *
     c                   move      'N'           vise              1
     c                   move      'T'           abeljn            1
     c                   move      'N'           adrjn             1
     c                   move      '1'           uin03             1
     c     tupro         chain     turer14                            13
     c                   Movel     'GODSLIST'    PRTNA            10
     C                   MOVE      tuavd         xxavd             4
     C                   MOVEL     ARUNDE        Atur              8
     C                   MOVEL     ARUNDE        Atur9             9
     C                   MOVEL     ATUR9         ATUR10T          10
     C     ATUR10T       CAT       'T':0         ATUR10T
     C                   MOVEL     ATUR9         ATUR10A          10
     C     ATUR10A       CAT       'A':0         ATUR10A
      *
      * ordner start av linken med forståelig info
      * først eventuellt mot transportør
      *
     c                   exsr      gengods
     c                   move      *blanks       arlinktra
     c                   movel     arlink        arlinktra        40
     c                   move      ubane         ubanegotr        50
     c
      *
      *
      * skriver 1 record pr opppdrag
      * Finn samtidig ut om det er agent(er) turen
      * og om fraktbrev finnes
      *
     c                   exsr      skrivtur
      *
      * tester om agenter finnes på godslista
      * lager i så fall pdf
      *
     c     ag(1)         ifne      *zeros
     c                   move      'A'           abeljn            1
     c                   exsr      gengods
     c                   move      *blanks       arlinkage
     c                   movel     arlink        arlinkage        40
     c                   move      ubane         ubanegoag        50
     c                   end
      *
      *
      *
      * produserer samleliste  fraktbrev PDF hvis finnes
      *
     c     fbfins        ifeq      'J'
     c                   exsr      genfbpdf
     c                   end
      *
      * skal Transportør ha mail
      *
     c     mailk         klist
     c                   kfld                    fifirm
     c                   kfld                    mail30
     c                   kfld                    tuknt
     C     ARKSND        IFEQ      'J'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
      *
      * godsliste til transportør
      *
     c                   z-add     arkund        tuknt
     c                   move      'T'           gotype            1
     c                   exsr      godsmail
      *
      * Mail til agent?
      *
     c     1             do        99            nr                2 0
     c     ag(nr)        ifne      *zeros
     c                   move      'A'           gotype            1
     c                   z-add     ag(nr)        tuknt
     c                   exsr      skrivtur2
     c                   exsr      godsmail
     c                   else
     c                   goto      utag
     c                   end
     c                   end
     c     utag          tag
      *
      *
     c                   end
     c                   end
     c*
     C                   ENDSR
     C***********************************************
     C     PDFMAN        BEGSR
     C***********************************************
      * manifest fly
     c*
     c                   Move      'A'           arSTAT
     C                   MOVEL     ARUNDE        samlnr            6
     c                   movel     samlnr        saml1             3
     c                   move      samlnr        saml2             3
     c                   move      aravd         xxavd             4
     c                   setoff                                       35
     c                   move      aravd         xxavd             4
     C                   MOVE      *zeros        ARAVD
     C                   MOVE      *zeros        AROPD
      *
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       samlnr:0      arlink
     c                   exsr      genbane
      *
     C                   CALL      'PDF016CL'
     C                   PARM                    XXavd
     C                   PARM                    saml1
     C                   PARM                    saml2
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
     C*
      *
      * skriver 1 record pr oppdrag ved Master samlast
      *
     c     samlnr        setll     head19
     c     *in35         doweq     '0'
     c     samlnr        reade     head19                                 35
     c     *in35         ifeq      '0'
     C                   MOVE      HEAVD         ARAVD
     C                   MOVE      HEOPD         AROPD
     c                   write     arkivr
     c                   end
     c                   end
      *
     C                   ENDSR
     C***********************************************
     C     PDFSVE        BEGSR
     C***********************************************
      * SVENSK sad EKSPORT
     c     artype        ifeq      'SE'
     C                   MOVE      'E'           TDTYP             1
     c                   end
     c     artype        ifeq      'SI'
     C                   MOVE      'I'           TDTYP             1
     c                   end
     c     artype        ifeq      'S1'
     C                   MOVE      '1'           TDTYP             1
     c                   end
     c     artype        ifeq      'S2'
     C                   MOVE      '2'           TDTYP             1
     c                   end
     c     artype        ifeq      'S3'
     C                   MOVE      '3'           TDTYP             1
     c                   end
     c     artype        ifeq      'S4'
     C                   MOVE      '4'           TDTYP             1
     c                   end
      * svensk import
     c*
     c                   Move      'A'           arSTAT
     C                   MOVE      ARUNDE        sveopd            7
     c                   move      aravd         xxavd             4
     c                   setoff                                       35
      *
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       xxavd:0       arlink
     C     arlink        CAT       sveopd:0      arlink
     c                   exsr      genbane
      *
     C                   CALL      'PDF017CL'
     C                   PARM                    XXavd
     C                   PARM                    sveopd
     C                   PARM                    TDTYP
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
     C*
      *
      * HENT VERDIER
      *
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     C     ARKSND        IFEQ      'J'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c                   move      arkund        tuknt
     c                   move      arkund        fakunr
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     C                   movel     'Tolldeklaras'wstex2
     C     wstex2        CAT       'jon':0       wstex2
     c     faktkk        CHAIN     CUNDL01                            33
     C  N33wstex2        cat       'Til:':1      wstex2
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
      *
     C                   move      *blanks       wscvp1
     C                   movel     'Tolldeklara:'wscvp1
     C     wscvp1        cat       'jon fra:':0  wscvp1
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C                   movel     trykkf        wscvp2
     C                   else
     c                   movel     vedleggf      wscvp2
     C                   end
     C     ARKVED        IFNE      *BLANKS
     C                   CALL      'ARC002V'
     C                   PARM                    ARTYPE
     C                   PARM                    Aavd
     C                   PARM                    Aopd
     C                   PARM                    ARKVED
     C                   PARM                    CLIVE
     C                   PARM                    arinek
     C                   END
     C                   movel     'Ref:'        wscvp3
     C     wscvp3        cat       aavd:1        wscvp3
     C     wscvp3        cat       '/':0         wscvp3
     C     wscvp3        cat       aopd:0        wscvp3
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           40
     c                   parm                    wscvp2           40
     c                   parm                    wscvp3           40
     c                   parm                    wscvp4           40
     C                   parm                    wscvp5           40
     C                   parm                    wscvp6           40
     C                   parm                    wscvp7           40
     C                   parm                    wscvp8           40
     C                   parm                    inteks            1
     C                   END
     C                   END
     C                   END
      *
      *
     C                   ENDSR
     C***********************************************
     C     PDFUTL        BEGSR
     C***********************************************
      * Utlæmningssedel
     c*
     c                   Move      'A'           arSTAT
     C                   MOVE      ARUNDE        TULLID           10
     c                   setoff                                       35
      *
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       tullid:0      arlink
     c                   exsr      genbane
      *
     C                   CALL      'PDF019CL'
     C                   PARM                    TULLID
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
     C*
      *
      * HENT VERDIER
      *
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     C     ARKSND        IFEQ      'J'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c                   move      arkund        tuknt
     c                   move      arkund        fakunr
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     C                   movel     'Utlæmningsse'wstex2
     C     wstex2        CAT       'del':0       wstex2
     c     faktkk        CHAIN     CUNDL01                            33
     C  N33wstex2        cat       'Til:':1      wstex2
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
      *
     C                   move      *blanks       wscvp1
     C                   movel     'Utlæmningss:'wscvp1
     C     wscvp1        cat       'edel fra:':0 wscvp1
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C                   movel     trykkf        wscvp2
     C                   else
     c                   movel     vedleggf      wscvp2
     C                   end
     C     ARKVED        IFNE      *BLANKS
     C                   CALL      'ARC002V'
     C                   PARM                    ARTYPE
     C                   PARM                    Aavd
     C                   PARM                    Aopd
     C                   PARM                    ARKVED
     C                   PARM                    CLIVE
     C                   PARM                    arinek
     C                   END
     C                   movel     'Ref:'        wscvp3
     C     wscvp3        cat       aavd:1        wscvp3
     C     wscvp3        cat       '/':0         wscvp3
     C     wscvp3        cat       aopd:0        wscvp3
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           40
     c                   parm                    wscvp2           40
     c                   parm                    wscvp3           40
     c                   parm                    wscvp4           40
     C                   parm                    wscvp5           40
     C                   parm                    wscvp6           40
     C                   parm                    wscvp7           40
     C                   parm                    wscvp8           40
     C                   parm                    inteks            1
     C                   END
     C                   END
     C                   END
      *
      *
     C                   ENDSR
     C*****************************************************************
     c     gengods       begsr
     c*****************************************************************
     c                   move      *blanks       arlink
     c                   movel     ARTYPE        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       atur9:0       arlink
     C     arlink        CAT       abeljn:0      arlink
      *
     c                   exsr      genbane
      *
      *
      *genererer PDF til selve godslista
      *
     C                   CALL      'PDF009CL'
     c                   parm                    uin03
     c                   parm                    xxavd
     c                   parm                    atur
     c                   parm                    abeljn
     c                   parm                    adrjn
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     C                   PARM                    ARCINF
     c                   endsr
     C*
     c**********************************************************************
     c     skrivtur      begsr
     c**********************************************************************
     c                   move      arunde        arundeg          10
     c                   move      'N'           fbfins            1
      *
      * tømm array med agenter
      *
     c                   MOVEa     *ZEROS        ag
     c                   z-add     0             nra               2 0
     c                   setoff                                       35
      *
     c     tupro         setll     head14
     c     *in35         doweq     '0'
     c     tupro         reade     head14                                 35
     c     *in35         ifeq      '0'
     C                   z-add     1             ARFFBN
     C     KEYDOK2       CHAIN     DOKUF                              33
     c  N33              move      'J'           fbfins
     C                   MOVE      heAVD         ARAVD
     C                   MOVE      heOPD         AROPD
     c                   move      'A'           arstat
     c                   move      atur10t       arunde
     c                   write     arkivr
      *
      * legger benyttede agenter i array
      *
     C     hekna         ifne      *zeros
     C     hekna         lookup    ag                                     33
     c     *in(33)       ifeq      '0'
     c                   add       1             nra
     c                   move      hekna         ag(nra)
     c                   end
     c                   end
      *
     c                   end
     c                   end
     c                   move      arundeg       arunde
     c                   endsr
     c**********************************************************************
     c     skrivtur2     begsr
     c**********************************************************************
      * skriv agentrecords til loggfil på de oppdrag som er på agent
      *
     c     keytua        klist
     c                   kfld                    tupro
     c                   kfld                    tuknt
     c                   setoff                                       35
     c                   move      arunde        arundeg          10
      *
     c     keytua        setll     head14
     c     *in35         doweq     '0'
     c     keytua        reade     head14                                 35
     c     *in35         ifeq      '0'
     C                   MOVE      heAVD         ARAVD
     C                   MOVE      heOPD         AROPD
     c                   move      'A'           arstat
     c                   move      atur10a       arunde
     c                   move      tuknt         arkund
     c                   write     arkivr
     c                   end
     c                   end
     c                   move      arundeg       arunde
     c                   endsr
     C*
     C***********************************************
     C     godsmail      BEGSR
     C***********************************************
      *
      * sende godsliste på mail
      *
     C                   MOVE      *BLANKS       WSTEX1
     c                   setoff                                       3344
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
      *
      *Godsliste
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex1           30
     C                   movel     'Godsliste   'wstex1
     c                   move      *blanks       wstex2
     C                   movel     'Turnr:'      wstex2           60
     C     wstex2        CAT       ATUR:1        wstex2
     C     wstex2        CAT       'Fra:':1      wstex2
     C     wstex2        CAT       tusdf:1       wstex2
     C     wstex2        CAT       'Til:':1      wstex2
     C     wstex2        CAT       tusdt:1       wstex2
     c                   move      uusr          epuser
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     C                   MOVE      'E'           INTEKS
     C     CEMAIL        CHAIN     ARUSERL1                           35
     C  N35arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
      *
      * lager http for interne   brukere
      *
     C                   move      *blanks       uhttpi
      *
     c                   movel     uhttpista     uhttpi
      *
      * test transportør / agent
      *
     c     gotype        ifeq      'T'
     C     uhttpi        CAT       arlinktra:0   uhttpi
     c                   else
     C     uhttpi        CAT       arlinkage:0   uhttpi
     c                   end
     C     uhttpi        CAT       '.pdf':0      uhttpi
      * lager http for eksterne  brukere
     C                   move      *blanks       uhttpe
     c                   movel     uhttpesta     uhttpe
      *
      * test transportør / agent
      *
     c     gotype        ifeq      'T'
     C     uhttpe        CAT       arlinktra:0   uhttpe
     c                   else
     C     uhttpe        CAT       arlinkage:0   uhttpe
     c                   end
     C     uhttpe        CAT       '.pdf':0      uhttpe
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c     gotype        ifeq      'T'
     c                   eval      EPBANE = ubanegotr
     c                   else
     c                   eval      EPBANE = ubanegoag
     c                   end
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   movel     'Godsliste fr'wscvp1
     C     wscvp1        cat       'a:':0        wscvp1
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C                   movel     trykkg        wscvp2
     C                   else
     c                   movel     vedleggg      wscvp2
     C                   end
     c                   write     arkepor
      *
      * legg til link samlet fraktbrev pdf
      *
     c     fbfins        ifeq      'J'
     c                   exsr      addfbre
     c                   end
      *
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           40
     c                   parm                    wscvp2           40
     c                   parm                    wscvp3           40
     c                   parm                    wscvp4           40
     C                   parm                    wscvp5           40
     C                   parm                    wscvp6           40
     C                   parm                    wscvp7           40
     C                   parm                    wscvp8           40
     C                   parm                    inteks            1
     c                   end
     c                   end
     c                   endsr
     C***********************************************
     C     delark        BEGSR
     C***********************************************
     c                   move      *blanks       epbane
     c                   move      '0'           *in(39)
     c     uusr          setll     arkepo
     c     *in(39)       doweq     '0'
     c     uusr          reade     arkepo                                 39
     c     *in(39)       ifeq      '0'
     c                   delete    arkepor
     c                   end
     c                   end
     c                   endsr
      *stykkgods fraktbrev
     C*
     C***********************************************
     C     PDFFB         BEGSR
     C***********************************************
     C     KEYDOK        KLIST
     C                   KFLD                    ARFB              1
     C                   KFLD                    ARAVD
     C                   KFLD                    AROPD
     C                   KFLD                    ARFFBN
     C                   MOVEL     ARUNDE        ARFFBN            3 0
     C                   MOVE      'F'           ARFB
     C     KEYDOK        CHAIN     DOKUF                              33
      *
      * ordner start av linken med forståelig info
      *
     c                   move      *blanks       arlink
     c                   movel     ARTYPE        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C  N33arlink        CAT       DF1004:0      arlink
      *
      *stykkgods fraktbrev
     C                   MOVEL     ARUNDE        AFBN              3
     C                   MOVEL     ARUNDE        AFT04             4
     C                   MOVE      AFT04         Afrto             1
     c                   exsr      genbane
     C                   CALL      'PDF003CL'
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    AFBN
     c                   parm                    Afrto
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     C                   PARM                    ARCINF
     C*
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     c  N33arkund        ifne      0
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     C                   movel     'Sendingsnr:' wstex2
     C     wstex2        CAT       df1004:1      wstex2
     c     faktkk        CHAIN     CUNDL01                            33
     C  N33wstex2        cat       'Til:':1      wstex2
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C                   movel     'Fraktbrev fr'wscvp1
     C     wscvp1        cat       'a:':0        wscvp1
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C                   movel     trykks        wscvp2
     C                   else
     c                   movel     vedleggs      wscvp2
     C                   end
     C     ARKVED        IFNE      *BLANKS
     C                   CALL      'ARC002V'
     C                   PARM                    ARTYPE
     C                   PARM                    Aavd
     C                   PARM                    Aopd
     C                   PARM                    ARKVED
     C                   PARM                    CLIVE
     C                   PARM                    arinek
     C                   END
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           40
     c                   parm                    wscvp2           40
     c                   parm                    wscvp3           40
     c                   parm                    wscvp4           40
     C                   parm                    wscvp5           40
     C                   parm                    wscvp6           40
     C                   parm                    wscvp7           40
     C                   parm                    wscvp8           40
     C                   parm                    inteks            1
     c                   end
     c                   end
     c                   end
     c                   end
     C                   ENDSR
     C***********************************************
     C     PDFSad        BEGSR
     C***********************************************
      *sad import
     c     artype        ifeq      'si'
     C                   MOVE      'I'           TDTYP             1
     c                   end
      *sad EKSPORT
     c     artype        ifeq      'se'
     C                   MOVE      'E'           TDTYP             1
     c                   end
     C
      * SAD import/eksport
      *
      * ordner start av linken med forståelig info
      *
     c                   move      *blanks       arlink
     c                   movel     ARTYPE        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
      *
     c                   exsr      genbane
     C                   CALL      'PDF001CL'
     C                   PARM                    AAVD
     C                   PARM                    Aopd
     C                   PARM                    TDTYP
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     C                   PARM                    vise
     c                   parm                    finst             1
     c                   parm                    finsd             1
     c                   PARM                    ARCINF
     c                   move      arlink        arlinkft         40
     c                   move      artype        artypeft          2
     c                   movel     ubane         ubaneft          50
     c                   move      *blanks       uhttpift         76
     c                   movel     uhttpi        uhttpift
     c                   move      *blanks       uhttpeft         76
     c                   movel     uhttpe        uhttpeft
      *tilleggsark
     c     finst         ifeq      'J'
     c     tdtyp         ifeq      'I'
     C                   MOVE      'sj'          artype
     c                   else
     C                   MOVE      'sf'          artype
     c                   end
     c                   move      *blanks       arlink
     c                   movel     ARTYPE        arlink
     c                   Move      'A'           arSTAT
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     c                   exsr      genbane
     c                   movel     ubane         ubanet
     c                   move      *blanks       uhttpit          76
     c                   movel     uhttpi        uhttpit
     c                   move      *blanks       uhttpet          76
     c                   movel     uhttpe        uhttpet
     c                   write     arkivr
     c                   end
      *
      * dataliste
      *
     c     finsd         ifeq      'J'
     c     tdtyp         ifeq      'I'
     C                   MOVE      'sk'          artype
     c                   else
     C                   MOVE      'sg'          artype
     c                   end
     c                   move      *blanks       arlink
     c                   movel     ARTYPE        arlink
     c                   Move      'A'           arSTAT
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     c                   exsr      genbane
     c                   movel     ubane         ubaned
     c                   move      *blanks       uhttpid          76
     c                   movel     uhttpi        uhttpid
     c                   move      *blanks       uhttped          76
     c                   movel     uhttpe        uhttped
     c                   write     arkivr
     c                   end
     c     finsd         ifeq      'J'
     c     finst         oreq      'J'
N01  C                   IF        TDTYP = 'I'
N01  C                   EVAL      ULISTNV = 'SAD61PFT'
N01  C                   ELSE
N01  C                   EVAL      ULISTNV = 'SAD52PFT'
N01  C                   END
     C                   CALL      'PDF001CL2'
     C                   PARM                    ubanet           50
     C                   PARM                    ubaned           50
     c                   parm                    finst             1
     c                   parm                    finsd             1
     c                   PARM                    ARCINF
N01  c                   PARM                    ULISTNV          10
     c                   end
      *
      * HENT VERDIER
      *
     c     artypeft      chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     C     ARKSND        IFEQ      'J'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c                   move      arkund        tuknt
     c                   move      arkund        fakunr
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     C                   movel     'Tolldeklaras'wstex2
     C     wstex2        CAT       'jon':0       wstex2
     c     faktkk        CHAIN     CUNDL01                            33
     C  N33wstex2        cat       'Til:':1      wstex2
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpift      eplink
     c                   movel     uhttpeft      epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANEFT
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
      *
      * tilleggsark
      *
     c     finst         ifeq      'J'
      *
      * skjekk om mailbruker  er intern
      *
     c                   movel     uhttpit       eplink
     c                   movel     uhttpet       epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANET
     C                   END
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c     fins1         ifeq      'J'
     c                   move      *blanks       wstex1           30
     c                   moveL     'Spesifikasjo'wste13           13
     c                   move      'n'           wste13
     c                   moveL     wste13        wstex1           30
     c                   end
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     c                   end
      *
      * dataliste
      *
     c     finsd         ifeq      'J'
      *
      * skjekk om mailbruker  er intern
      *
     c                   movel     uhttpid       eplink
     c                   movel     uhttped       epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANED
     C                   END
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c     fins1         ifeq      'J'
     c                   move      *blanks       wstex1           30
     c                   moveL     'Spesifikasjo'wste13           13
     c                   move      'n'           wste13
     c                   moveL     wste13        wstex1           30
     c                   end
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     c                   end
      *
      * coverpage
      *
     C                   move      *blanks       wscvp1
     C                   movel     'Tolldeklaras'wscvp1
     C     wscvp1        cat       'jon fra:':0  wscvp1
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C                   movel     trykkt        wscvp2
     C                   else
     c                   movel     vedleggt      wscvp2
     C                   end
     C                   movel     'Ref:'        wscvp3
     C     wscvp3        cat       aavd:1        wscvp3
     C     wscvp3        cat       '/':0         wscvp3
     C     wscvp3        cat       aopd:0        wscvp3
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           40
     c                   parm                    wscvp2           40
     c                   parm                    wscvp3           40
     c                   parm                    wscvp4           40
     C                   parm                    wscvp5           40
     C                   parm                    wscvp6           40
     C                   parm                    wscvp7           40
     C                   parm                    wscvp8           40
     C                   parm                    inteks            1
     c                   eval      wscvp3 = '.'
     c                   end
     c                   end
     c                   end
      *
      * tilbakestiller verdier
      *
     c                   move      artypeft      artype
     c                   move      arlinkft      arlink
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     genbane       BEGSR
     C***********************************************
      * genererer bane for lagring
      *
      * henter  randomverdi
      *
     C                   call      'ARCRAN'
     C                   parm                    arli10           10
     C     arlink        cat       arli10:0      arlink
      *
     C                   MOVE      'N'           vise              1
     C                   MOVE      ARAVD         AAVD              4
     C                   MOVE      AROPD         AOPD              7
      *
      * lager http for interne brukere
      *
     C                   move      *blanks       uhttpi
     c                   movel     uhttpista     uhttpi           76
     C     uhttpi        CAT       arlink:0      uhttpi
     C     uhttpi        CAT       '.pdf':0      uhttpi
      * lager http for interne brukere
     C                   move      *blanks       uhttpe           76
     c                   movel     uhttpesta     uhttpe
     C     uhttpe        CAT       arlink:0      uhttpe
     C     uhttpe        CAT       '.pdf':0      uhttpe
      *
      * lager bane til IFS
      *
     C                   move      *blanks       ubane            50
     C                   movel     ubanesta      ubane
     C     ubane         CAT       arlink:0      ubane
     C     ubane         CAT       '.pdf':0      ubane
     c                   endsr
     C***********************************************
     C     PDFTRAN       BEGSR
     C***********************************************
     C*
     C     TRH3KE        KLIST
     C                   KFLD                    XXST              1
     C                   KFLD                    NFAK
     C*
     C     TRV6KE        KLIST
     C                   KFLD                    NFAK
     C*
     C                   MOVE      'F'           XXST
     C                   z-add     0             ntrans            8 0
     c                   move      *zeros        traavd            4
      *
     C*
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
     C                   MOVEL     ARUNDE        AFAK
     C                   MOVEL     ARUNDE        NFAK              7 0
     c                   move      ardate        fadato
     c                   move      'N'           finsspe
     C     TRH3KE        CHAIN     TRAVH3                             72
     C  N72              z-add     thtnr         ntrans            8 0
     c  N72              move      thtavd        traavd            4
     C   72              MOVE      'O'           XXST
     C   72TRH3KE        CHAIN     TRAVH3                             72
     C  N72              z-add     thtnr         ntrans
     c  N72              move      thtavd        traavd
     C     *IN(72)       IFEQ      '1'
     C     TRV6KE        CHAIN     TRAVV6                             72
     C  N72              Z-ADD     TVTUNR        NTRANS
     C  N72              move      TVoavd        traavd
     C                   END
      *
      * transportør 0 er feil -  går da ut av rutinen
      *
     c     ntrans        ifeq      0
     c                   goto      utta
     c                   end
      * lagrer avregning
      *
      * ordner start av linken med forståelig info
      *
     c                   move      *blanks       arlink
     c                   movel     ARTYPE        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       AFAK:0        arlink
      *
     C                   exsr      genbane
     C                   CALL      'PDF010CL'
     C                   PARM                    NFAK
     C                   PARM                    Ntrans
     C                   PARM                    traavd
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
     c                   end
      *
      * skal kunde ha mail
      *
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
      *
     c* slett eventuellt gamle poster
     c                   exsr      delark
     c                   move      *blanks       wstex2
     C                   movel     'Fakt:'       wstex2
     C     wstex2        CAT       afak:1        wstex2
     C     wstex2        CAT       'dato:':1     wstex2
     C     wstex2        CAT       fadg:1        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       famm:0        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       faaa:0        wstex2
     c     faktkk        CHAIN     CUNDL01                            33
     C  N33wstex2        cat       'Til:':1      wstex2
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      *blanks       epuser
     c                   movel     uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      * skjekk om mailbruker  er intern
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     C                   move      *blanks       wscvp1
     C                   movel     'Transportøra'wscv24           24
     C                   move      'vregning fra'wscv24           24
     c                   movel     wscv24        wscvp1
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C                   movel     trykka        wscvp2
     C                   else
     c                   movel     vedlegga      wscvp2
     C                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           40
     c                   parm                    wscvp2           40
     c                   parm                    wscvp3           40
     c                   parm                    wscvp4           40
     C                   parm                    wscvp5           40
     C                   parm                    wscvp6           40
     C                   parm                    wscvp7           40
     C                   parm                    wscvp8           40
     C                   parm                    inteks            1
     c                   end
     c                   end
     c                   end
     c     utta          endsr
      *
     C***********************************************
     C     init          BEGSR
     C***********************************************
     C*
     C     *ENTRY        PLIST
     c                   parm                    utype             2
     c                   parm                    UUSER            10
     c                   parm                    finsspe           1
     c                   move      utype         xxtype            2
     c                   move      uUSER         xxUSER           10
     C                   MOVE      'N'           vise              1
      *
     C     KEYDOK2       KLIST
     C                   KFLD                    ARFB
     C                   KFLD                    heAVD
     C                   KFLD                    heOPD
     C                   KFLD                    ARFFBN
     C                   MOVE      'F'           ARFB
      *
     C     KEYHEA        KLIST
     C                   KFLD                    ARAVD
     C                   KFLD                    AROPD
      *
     c     key           klist
     c                   kfld                    XXSTAT            1
     c                   kfld                    xxUSER
     c                   kfld                    xxtype
     C*
     c     keya11        klist
     c                   kfld                    YYSTAT            1
     c                   kfld                    xxunde
     c                   move      'X'           yystat
      *
     c                   read      firm                                   33
     c                   read      firmarc                                33
     c     *in33         ifeq      '1'
     c                   seton                                        lr
     c                   return
     c                   end
      *
      * med vennlig hilsen
      *
     c                   movel     '.'           wscvp3
     c                   movel     'Med vennlig 'wscvp4
     C     wscvp4        CAT       'hilsen':1    wscvp4
     C                   movel     fift          wscvp5
     c*
     c*
     c*
     C* lager starten på http og IFS-bane  intern ekstern
     c*
     c*
      * lager http for interne brukere
      *
      * intern
      *
     C                   move      *blanks       uhttpista        76
     c                   movel     'http://'     uhttpista
     C     uhttpista     CAT       arcpad:0      uhttpista
     C     uhttpista     CAT       '/':0         uhttpista
     C     uhttpista     CAT       arcane:0      uhttpista
     C     uhttpista     CAT       '/':0         uhttpista
      *
      * ekstern
      *
     C                   move      *blanks       uhttpesta        76
     c                   movel     'http://'     uhttpesta
     C     uhttpesta     CAT       arcpae:0      uhttpesta
     C     uhttpesta     CAT       '/':0         uhttpesta
     C     uhttpesta     CAT       arcane:0      uhttpesta
     C     uhttpesta     CAT       '/':0         uhttpesta
      *
      * lager bane til IFS
      *
     C                   movel     '/'           ubanesta         70
     C     ubanesta      CAT       arcane:0      ubanesta
     C     ubanesta      CAT       '/':0         ubanesta
     c                   endsr
     C***********************************************
     C     genfbpdf      BEGSR
     C***********************************************
      *
      *
     c                   move      'gf'          artype            2
     c                   move      arlink        arlinkg          40
      *
      * arlink kommer fra godsnummer   byttes bare til 'gf'
      *
      *
      * ordner start av linken med forståelig info
      *
     c                   move      *blanks       arlink
     c                   movel     ARTYPE        arlink
     c                   movel     ardate        aar               4
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       atur9:0       arlink
      *
      *
      *stykkgods fraktbrev på hel tur
      *
     C                   MOVE      'F'           Afrto             1
     c                   exsr      genbane
     C                   MOVE      atur          Afbn
     C                   MOVEl     atur          Aopd
     C                   MOVE      'F'           ARFB
     C                   CALL      'PDF003CL'
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    AFBN
     c                   parm                    Afrto
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     C                   PARM                    ARCINF
     C                   move      'A'           arstat
     c                   move      *zeros        aravd
     c                   move      *zeros        aropd
     C                   write     arkivr
      *
     c                   move      arlink        arlinkfb         40
     c                   move      'go'          artype            2
     c                   move      arlinkg       arlink           40
     C*
     c                   endsr
     C***********************************************
     C     addfbre       BEGSR
     C***********************************************
     c                   move      *blanks       wstex1
     c                   move      *blanks       wstex2
     C                   movel     'Fraktbrevene'wstex1
     c* skriver til mailfil
     C                   movel     'til turnr:'  wstex2
     C     wstex2        cat       atur:1        wstex2
     c                   move      uusr          epuser
      * lager http for interne   brukere
     C                   move      *blanks       uhttpi
     c                   movel     uhttpista     uhttpi
     C     uhttpi        CAT       arlinkfb:0    uhttpi
     C     uhttpi        CAT       '.pdf':0      uhttpi
      * lager http for eksterne  brukere
     C                   move      *blanks       uhttpe
     c                   movel     uhttpesta     uhttpe
     C     uhttpe        CAT       arlinkfb:0    uhttpe
     C     uhttpe        CAT       '.pdf':0      uhttpe
      *
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
     c                   write     arkepor
      *
     C                   ENDSR
     OARKIVR    E            UPDARK
     O                       ARSTAT
     O                       ARLINK
