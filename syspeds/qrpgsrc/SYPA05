     FSYPA05FM  CF   E             WORKSTN
     F                                     SFILE(RECB:ZRECNO)
     F                                     INFDS(STATDS)
     FPALLD     IF   E           K DISK
     FPALLDL02  IF   E           K DISK
     F                                     RENAME(PALLDR:PALLDL2R)
     FPALLDL06  IF   E           K DISK
     F                                     RENAME(PALLDR:PALLDL6R)
     FPALFIR    IF   E             DISK
     D STATDS          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  PAKVDT                 1      8  0
     D  WAKVDT                 3      8  0
     D                 DS
     D  PAPNVN                 1     30
     D  XXNAVN                 1     15
      *___________________________
      * Finner username
      *"""""""""""""""""""""""""""
     D                SDS
     D  ZJOB                 244    253
     D  ZUSER                254    263
     D  ZJOBNR               264    269  0
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      INIT
     C                   EXSR      HOVED
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     INIT          BEGSR
     C     *ENTRY        PLIST
     C                   PARM                    UAPPNR
     C                   PARM                    UAKVDT
     C                   PARM                    UAANT
     C                   PARM                    UBPPNR
     C                   PARM                    UABUNR
     C                   PARM                    UAKVNR
     C                   PARM                    UALØNR
     C                   PARM                    UIN23
      *___________________
      * Definiere WorKfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    PAPPNR        UAPPNR
     C     *LIKE         DEFINE    PAKVDT        UAKVDT          - 2
     C     *LIKE         DEFINE    PAANT         UAANT
     C     *LIKE         DEFINE    PAPPNR        UBPPNR
     C     *LIKE         DEFINE    PABUNR        UABUNR
     C     *LIKE         DEFINE    PAKVNR        UAKVNR
     C     *LIKE         DEFINE    PALØNR        UALØNR
     C     *LIKE         DEFINE    *IN23         UIN23
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
      * KEY FOR PALLEPOSTER
     C     PALLK         KLIST
     C                   KFLD                    XXLØNR            7 0
     C                   KFLD                    XXAB              1
      * KEY FOR SJEKK AV LIK POST FRA FØR...
     C     PALLK6        KLIST
     C                   KFLD                    UAPPNR
     C                   KFLD                    YYKVDT            8 0
     C                   KFLD                    UAANT
     C     UAKVDT        IFGT      501231
     C     UAKVDT        ADD       19000000      YYKVDT
     C                   ELSE
     C     UAKVDT        ADD       20000000      YYKVDT
     C                   END
      * KRAV OM KVITT-NR??
     C     1             CHAIN     PALFIR                             33
     C     PFPKKR        COMP      'J'                                    50
      *
     C                   WRITE     WINDOWSZ
     C*
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     HOVED         BEGSR
      *______________
      * Tømme Subfile
      *""""""""""""""
      *
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     RECC
     C                   MOVEA     '000'         *IN(93)
     C                   Z-ADD     *ZERO         ZRECNO
      * LES ALLE PÅ SIDE A
     C     PALLK6        SETLL     PALLDL06
      *_____________
      * Fyll Subfile (med alle poster uavhengig av linjer pr side)
      *"""""""""""""
     C     PALLK6        READE     PALLDL06                               94
     C     *IN94         DOWEQ     '0'
      *
     C     NESTE         TAG
     C                   EXSR      TSTLIK
     C     LIK           IFEQ      'N'
     C     PALLK6        READE     PALLDL06                               94
     C  N94              GOTO      NESTE
     C   94              GOTO      VISLIS
     C                   END
      * HENT OG VIS BEGGE SIDER AV MULIG DUPLIKAT-KVITTERING
     C                   MOVE      'A'           XXAB
     C     PALLK         CHAIN     PALLD                              33
     C                   ADD       1             ZRECNO
     C                   WRITE     RECB
     C                   MOVE      'B'           XXAB
     C     PALLK         CHAIN     PALLD                              33
     C                   ADD       1             ZRECNO
     C                   WRITE     RECB
      *
     C     PALLK6        READE     PALLDL06                               94
     C  N94              END
      *
      *
     C     VISLIS        TAG
      *
     C                   MOVE      'N'           KVIDUP            1
      *
      * HVIS INGEN DUPLIKATER BLE FUNNET PÅ INNHOLD, OG HVIS FIRMAET
      * HAR KRAV OM TASTING AV KVITT.NR,SJEKK OM BRUKT FØR
     C     ZRECNO        IFEQ      0
     C     *IN50         ANDEQ     '1'
     C     UAKVNR        SETLL     PALLDL02
     C     UAKVNR        READE     PALLDL02                               94
     C     *IN94         DOWEQ     '0'
     C     NESTE2        TAG
      * LES BARE A-SIDEN (FOR Å UNNGÅ Å HENTE SAMME BILAG 2 GANGER)
      * HOPP OVER BILAG MED SAMME LØPENR SOM DU ARBEIDER PÅ
     C     PAAB          IFEQ      'B'
     C     PALØNR        OREQ      UALØNR
     C     UAKVNR        READE     PALLDL02                               94
     C  N94              GOTO      NESTE2
     C   94              GOTO      VISLI2
     C                   END
      * HENT OG VIS BEGGE SIDER AV MULIG DUPLIKAT-KVITTERING
     C                   MOVE      'A'           XXAB
     C     PALLK         CHAIN     PALLD                              33
     C                   ADD       1             ZRECNO
     C                   WRITE     RECB
     C                   MOVE      'B'           XXAB
     C     PALLK         CHAIN     PALLD                              33
     C                   ADD       1             ZRECNO
     C                   WRITE     RECB
     C                   MOVE      'J'           KVIDUP
      *
     C     UAKVNR        READE     PALLDL02                               94
     C  N94              END
     C                   END
      *
      *
     C     VISLI2        TAG
      *
      * INGEN POSTER FANTES  - SETT FLAGG OK
     C     ZRECNO        IFEQ      0
     C                   MOVE      '1'           UIN23
     C                   SETON                                        LR
     C                   ELSE
      * POSTER FANTES
     C                   Z-ADD     1             ZRECNO
     C                   MOVEA     '11'          *IN(91)
     C                   SETON                                        30
     C     KVIDUP        IFEQ      'N'
     C                   MOVE      'JOV0629'     ZMSGNO                         PART/ANT..
     C                   ELSE
     C                   MOVE      'JOV0976'     ZMSGNO                         KVITT.NR.
     C                   END
     C                   WRITE     RECD
     C                   Z-ADD     2             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   EXFMT     RECC
     C                   MOVE      *IN23         UIN23
     C                   END
     C                   ENDSR
      *
     C***************************************************
     C     TSTLIK        BEGSR
     C***************************************************
     C                   MOVE      'N'           LIK               1
      * LEST SAMME KVITT SOM EN SKAL TESTE - SKIPP DEN..
     C     PALØNR        IFEQ      UALØNR
     C                   GOTO      UTTST
     C                   END
      *
     C*HENT MOTSATT SIDE. TEST MOT INNGÅENDE KVITT.
     C*   - DATO ER GARANTERT LIK
     C*   - ANTALLET ER GARANTERT LIKT (DVS."MOTSATT": PAANT MULT -1)
     C*   - MEN ER PARTEN DEN SAMME SOM MOTPARTEN PÅ INNGÅENDE KVITT..
     C     PAAB          IFEQ      'A'
     C                   MOVE      'B'           XXAB
     C                   ELSE
     C                   MOVE      'A'           XXAB
     C                   END
     C                   MOVE      PALØNR        XXLØNR
     C     PALLK         CHAIN     PALLD                              55
     C     *IN55         IFEQ      '0'
     C     PAPPNR        ANDEQ     UBPPNR
     C                   MOVE      'J'           LIK
     C                   END
      *
     C     UTTST         ENDSR
