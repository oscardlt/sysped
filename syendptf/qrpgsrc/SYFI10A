      ***************************************************************
      *** PROGRAM SKAL VEDLIKEHOLDE FRAKTBREV (KALLES FRA syfi10) ***
      ***************************************************************
      ***************************************************************
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER        ***
      *** LEDIGE INDIKATORER 01 02 06 14 15                       ***
      *** LEDIGE INDIKATORER 27-29 35-39 41-49 51-72              ***
      *** INDIKATOR 31 PÅ = KALL FRA RETTELSESPROGRAM (SYRE10)    ***
      ***           31 AV = KALL FRA REGISTRERINGSPROGRAM         ***
      ***************************************************************
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 ved krav om kundenr (avs/mot/anne) kan denne IKKE begynne på blank
10XXX * 02 YBC PTF10 TOLLSTEDSKODE ER ENDRET TIL 4.0
10XXX * 03 YBC PTF10 NYE PRODUKSJONSKODE STARTER MED P4
10XXX * 04 YBC PTF10 SØK KUN EGNE KODER VED FRBREVPRO
      *              TILLEGGS PRODUKTKODER
10XXX * 05 SH  PTF10 mypack-programmering
10XXX * 06 JOV PTF10 sjekk mot avdelingskode for å se om innland (ikke mot H/+NO-->NO)
10XXX * 07 SH  PTF10 tillegg call mypack
10XXX * 08 SH  PTF10 feil flytting vareadresse
10XXX * 09 JOV PTF10 test på mottaker kundenr V/mypack
10XXX * 10 JOV PTF10 Test mot kolliids (Mlapp ' ' -> P dersom de finne)
10XXX * 11 JOV PTF10 KUNNE SLETTE UTK-OPPDRAG RETT FRA FRAKTBREVSBILDET
10XXX * 12 JOV PTF10 posten D04 ekstarkoder flyttet/indikatorstyrt i DDS
10XXX * 13 YBC PTF10 FEIL POSISJON VED SØKING PÅ TOLLSTED
10XXX * 14 JOV PTF10 MyPack via Bring
      * 15 SH  PTF10 Sikrer at utstedelsesdato blir nullet ut
      * 16 JOV PTF10 Test SMS-nr ved Posten PO12
N17   * 17 SH  PTF10 litt søkeforskjeller bilde01 bilde02
      * 18 JOV PTF10 Test Mail/mob  ved TG9BO-booking / henting
      * 19 JOV PTF10 Senders navn/adr hentes fra kunde KUN ved blank-OpprAvs=Oppdragsgiv v/innland
      * 20 SH  PTF10 test verdi i IFB ordre
      * 21 JOV PTF10 INNFØRE LANDKODE/UTENLANDSK POSTNR OGSÅ PÅ AVSENDER  ('U-VISNING')
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * P T F   T I L  V11   START
11XXX * 22 SH  PTF11 sender kundenummer transportør til Prisofrespørsel
11XXX * 23 SH  PTF11 legger ut budsjett på oppdraget
11XXX * 24 JOV PTF11 cursor ved feil TRANSP / PRODUKT VED UTENLANDSVISN
11XXX * 25 JOV PTF11 Ennå mer cursor-sensitiv F7 = kpers...
11XXX * 26 SH  PTF11 Rettelser til annen fraktbetaler
11XXX * 27 YBC PTF11 SJEKK POSTNR FØR OPPDATERING PÅ LEV.ADR.
11XXX * 28 JOV PTF11 Quick & dirty - hindre F11-dup (bruk transporøt med DUP/internedi-kode)
11XXX * 29 JOV PTF11 Ved eksport - bruk oppdragets henteadresse foreslås som avsender
      *              Også noe logikk ved Sts=U=Utlandslayout endret..MEN OBS UFULLSTENDIG (se CC)
      * 30 JOV PTF11 Krav om transportyør droppet ved labelprint
      * 31 JOV PTF11 Flere parameter til SYFA10A (varelinjer) - BRINGTMS-prosjekt.
      * 32 SH  PTF11 Ikke lenger slette varelinjer  ved slett
      * 33 SH  PTF11 hentr budsjett andre transportører
      * 34 JOV PTF11 Høye antall labels må bekreftes
      * 35 SH  PTF11 oppkrav ved edi
11093 * 36 JOV PTF11 O i avsender = hent fra oppdraget
11093 * 37 SH  PTF11 legger rekvisisjopnsnummer på budsjettlinje
11093 * 38 JOV PTF11 Ramberg produktkode for henting + tillegsprod for adviserin innført i standard
      * 39 JOV PTF11 Feil i PTF38
      * 40 JOV PTF11 Cursor ved TGZHE/ZHU
      *%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
12033 * 41 JOV PTF12 Fr.brev 001 = OPPDRAGET. spredning=002,003../F9->merk 001 med O (unngå print)
12033 * 42 JOV PTF12 Ramberg TGZEX=Hentes til term for eksport(TGZLE=Avs. leverer til term for exp.)
      * 43 JOV PTF12 Ikke interaktiv test/vis bilde vedr SYTHSONEPRIS (ref PTF23)
      * 44 JOV PTF12 warning/info-vindu ved spredning - se ptf 41
      * 45 JOV PTF12 ZFD i WSPRO1 = Ramberg fixed delivery
      * 46 SH  PTF12 sjekk transportørbytte også ved F4
      * 46 SH  PTF12 flyttet til subrutine sjekkn
      * 47 JOV PTF12 ZFD i WSPRO1 = Ramberg fixed delivery også format  05.04.18
      * 48 JOV PTF12 TXZ12/TGZX1= Ramberg for Posten-Serv.Pk / expr.over natt - krav om Mob/sms/mail
      * 49 JOV PTF12 Varelinje-kontroll,EN linje: settes lik ws-verdier / flere: sum sjekkes/varsel
********************************************************************
      *
N37  FKOSTT     UF   E           K DISK
N23  FKOSBU12   UF A E           K DISK
N43  FSYPROD    IF   E           K DISK
     FDOK29     UF   E           K DISK
     FDOKUDGS   UF   E           K DISK
     FDOKUFV    UF   E           K DISK
     FDOKUFM    UF   E           K DISK
     FFRISOK    IF A E           K DISK
     FKODFRI    IF   E           K DISK
     FVADR      IF   E           K DISK
     FVADR3     IF   E           K DISK    RENAME(VADRR:VADRR3)
     FDOKUF     UF A E           K DISK
     FFAK13     UF A E           K DISK
     FVALUL01   IF   E           K DISK
     FKODTTR    IF   E           K DISK
     FHEADF     IF   E           K DISK
     FBILLOF    IF   E           K DISK
     FFIRM      IF   E             DISK
     FFIRFB     UF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FTRAN      UF   E           K DISK
     FPONRN     IF   E           K DISK
S22  F*RSTTG    IF   E           K DISK
N22  FTGUSER    IF   E           K DISK
     FKOFAST    IF   E           K DISK
     FFORDEL    IF A E           K DISK
     FMULTKODT  IF   E           K DISK    RENAME(KODTTRR:KODTT1)
     F                                     RENAME(KOTSTR:KOTST1)
     FDOKUFE    UF   E           K DISK
N34  FSYPARL1   IF   E           K DISK
     FSYFI10FA  CF   E             WORKSTN
     F                                     INFDS(FBAREA)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  UFN17A                 1      2
     D  UFN17B                 3      7
     D  UFN17C                 8     17
     D  UFN17                  1     17
     D                 DS
     D  WSSNDN                 1     10  0
     D  WSSND1                 1      9
     D  WSSND2                10     10  0
     D                 DS
     D  DF1004                 1     35
     D  DF1117                11     17
     D  DFLA                   1      2
     D  DFLE                   3      7
     D  DFSE                   8     17
     D                 DS
     D  HXSNDN                 1     20
     D  HERFK1                 1     10
     D  HERFK2                 4     20
     D  HERFKA                 4      5
     D  HERFKB                 6     10
     D  HERFKC                11     20
      *
     D                 DS
     D  WSNAVL                 1     30
     D  WSSTJL                 1      1
     D  WSKURL                 2     18
     D                 DS
     D  WSNAVM                 1     30
     D  WSSTJM                 1      1
     D  WSKURM                 2     18
     D                 DS
     D  WSNAVS                 1     30
     D  WSSTAR                30     30
     D                 DS
     D  WSADX2                 1     30
     D  WSADP4                 1      4
     D  WSAD24                 6     30
     D                 DS
     D  WAVT                   1     20
     D  WAVT01                 1      3
     D  WAVT02                 6     15
     D                 DS
     D  WNUM2                  1      2  0
     D                 DS
     D  KOVXXX                 1      8
     D  AVBELA                 1      1
     D                 DS
     D  WSDTUD                 1      2  0
     D  WSDTUM                 3      4  0
     D  WSDTUÅ                 5      6  0
     D  WSDTU                  1      6  0
     D                 DS
     D  DFDTUÅ                 1      4  0
     D  DFDTUM                 5      6  0
     D  DFDTUD                 7      8  0
     D  DFDTU                  1      8  0
     D                 DS
     D  WSAD3M                 1     30
     D  WSAU3M                 1     25
     D                 DS
     D  WSBREF                 1     17
     D  WSBRTX                 1      5
     D  WSBRAV                 6      9
     D  WSBRST                10     10
     D  WSBROP                11     17
     D                 DS
     D  TMPAD3                 1     25
     D  TMPAD3b                1      1
     D  TMPAD3c                2     25
n23  D                 DS
n23  D  HEDTÅ                  1      4  0
n23  D  HEDTM                  5      6  0
n23  D  HEDTD                  7      8  0
n23  D  HEDTOP                 1      8  0
N45  D                 DS
N45  D  UDDMMÅÅ                1      6  0
N45  D   UDD                   1      2  0
N45  D   UMM                   3      4  0
N45  D   UÅÅ                   5      6  0
     C*
     C                   EXSR      INIT
     C*
     C     START         TAG
     C                   EXSR      FRABER
     C  N30
     CANN04              Z-ADD     2             LINNBR
     C  N30
     CANN04              Z-ADD     09            POSNBR
N10   *
N10   * DIV tester før vising av skjermbilde  (samt bevar gml verdi for ....)
     C                   MOVE      WSTRAN        XXTRAN            8 0
N10   * finnes kolli-IDs
N10  c                   move      *off          *in51
N10  c     WSKDME        ifeq      *blanks
N10  c     WSKDME        oreq      'P'
N10  c                   exsr      TstCli
N10  c                   endif
N11  c                   move      *blanks       SlDUPTxt         16
N11   * test om det er tillatt å slette UTK-oppdrag
N11  c     WSBRTX        ifeq      'U.op:'
N11  c                   call      'SYFI10AS'
N11  c                   parm                    Ufirm
N11  C                   parm                    UAVD
N11  C                   parm                    UOPD
N11  C                   parm                    UFBNR
N11  c                   parm                    WSBRAV
N11  c                   parm                    WSBROP
N11  c                   parm      'T'           SlFlagg           1
N11  c     SlFlagg       ifeq      '0'
N11  c                   eval      SlDUPTxt='F2=Slett U.op..'
N11  c                   endif
N11  c                   endif
N12  C     VMLAYO        COMP      'P4'                                   52
      ***

     C     TEST          IFNE      '9'
     C     WSST          IFNE      'U'
     C     WSST          ANDNE     'V'
     C                   MOVE      WSKNSM        FORMOT            8 0
     C     WSBELE        COMP      *ZEROS                             50
n35  c  N50WSKDE         COMP      'X'                                    50
s05  C*    DOKUFEKEY     CHAIN     DOKUFE                             75
n05  C     DOKUFEKEY     CHAIN(N)  DOKUFE                             75
n05  C   75DOKUFEKEY2    CHAIN(N)  DOKUFE                             75
     C   75              EVAL      *IN76=*OFF
     C  N75              EVAL      *IN76=*ON
     C  N40              EXFMT     BILDE01
     C                   ELSE
     C                   MOVE      WSKNSM        FORMOT            8 0
     C  N40              EXFMT     BILDE02
     C                   END
     C                   ELSE
     C                   MOVE      *ON           *IN03
     C                   ENDIF                                                  <TEST
     C                   SETOFF                                       309998
     C                   SETOFF                                       9594
N12  c                   move      *blanks       VMLAYO
     C*
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
     C*
     C*
     C   24              DO
     C                   EXSR      UTCMDL
     C                   GOTO      START
     C                   END
     C*
     C   04              DO
     C                   EXSR      SØKDTA
n46  c                   exsr      sjekktr
     C                   GOTO      START
     C                   END
N11   * *in02 = slett utkj-oppdrag (kun tillatt hvis dispstat = E mm.)
N11  C     *IN02         IFEQ      *ON
N11  c     WSBRTX        andeq     'U.op:'
N11  c                   call      'SYFI10AS'
N11  c                   parm                    Ufirm
N11  C                   parm                    UAVD
N11  C                   parm                    UOPD
N11  C                   parm                    UFBNR
N11  c                   parm                    WSBRAV
N11  c                   parm                    WSBROP
N11  c                   parm      ' '           SlFlagg           1
N11  c     SlFlagg       ifeq      'F'                                          Ferdig slettet
N11  c                   eval      WSBREF=*blanks
N11  c                   eval      WSST  =*blanks
N11  c     WSKDME        ifeq      'P'
N11  c                   eval      WSKDME='S'
N11  c                   endif
N11  c                   else                                                   Kunne ikke slettes
N11  C                   MOVE      'JOV1523'     MSGNR                          pga status mm.
N11  C                   SETON                                        30
N11  c                   endif
N11  C                   GOTO      START
N11  C                   ENDIF
     C*
     C* VED STJERNE I NAVN ETTERFULGT AV KUNDES KUNDE HENT VADEADRESSE
     C*
     C     WSSTJL        IFEQ      '*'
     C     WSSTJM        OREQ      '*'
     C                   EXSR      SOKUKU
     C                   END
     C*
      * Kontaktopplysninger
N05  C                   MOVE      'DP '         UQAULIF           3
     C     *IN07         IFEQ      *ON
N05  C     *IN76         OREQ      '0'
N05  C     WSPROK        ANDEQ     'TG9M'
N05  C                   MOVE      *BLANK        UVIS
N05  C     WSPROK        IFEQ      'TG9M'
N05  C                   MOVE      'CN '         UQAULIF
N05  C                   CALL      'SYCTAMYR'
N05  C                   PARM                    UAVD
N05  C                   PARM                    UOPD
N05  C                   PARM                    UFBNR
n05  C                   PARM                    UQAULIF
N05  C                   PARM                    WSKNSM
N05  C                   PARM                    WSNAVM           30
N05  C                   PARM                    WSAD1M           30
n05  C                   PARM                    WSAD3M           30
N05  C                   PARM                    WSNAVL           30
N05  C                   PARM                    WSAD1L           30
n05  C                   PARM                    WSPOUL            4 0
N05  C                   PARM                    WSADUL           25
N07  C                   PARM                    WSKNM            12
N05  C                   else
N18  c                   if        LINNBR >=5 and LINNBR <=8                    avsender
N18  C                   MOVE      'CZ '         UQAULIF
N25  c                   else
N25  C                   MOVE      'DP '         UQAULIF
N25  c                   if        POSNBR < 40
N25  C                   MOVE      'CN '         UQAULIF
N25  c                   endif
N18  c                   endif
     C                   CALL      'SYCTA01R'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR
s05  C*                  PARM      'DP '         UQAULIF           3
n05  C                   PARM                    UQAULIF           3
     C                   PARM                    WSKNSM
N05  C                   end
     C                   GOTO      START
     C                   ENDIF
     C   08              DO
     C                   EXSR      BFRAKT
     C                   GOTO      START
     C                   END
     C*
     C* GÅ TIL VARELINJE VEDLIKEHOLD
     C*
     C   10              DO
N32  C     *like         define    HELMLA        WSLMLA
N32  C     *like         define    HEPOEN        WSPOEN
     C                   MOVE      *BLANK        UVIS              1
     C                   CALL      'SYFA10A'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR
     C                   PARM                    WSNT
     C                   PARM                    WSVKT
     C                   PARM                    WSLM
N31  C                   PARM                    WSLMLA
     C                   PARM                    WSM3
N31  C                   PARM                    WSPOEN
     C                   PARM                    WSGM
     C                   PARM                    WSGM2
     C                   PARM                    WSCMN
     C                   PARM                    WSVS
     C                   PARM                    UVIS
     C                   GOTO      START
     C                   END
      * GODS-MERKING PÅ FRAKTBREVS-NIVÅ (LINJENR 00) KOLLI-ID M.M.
     C     *IN13         IFEQ      *ON
     C                   MOVE      *ZEROS        ULINR             2 0
     C                   MOVE      *BLANK        UVIS              1
     C                   CALL      'SYFA10B'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR
     C                   PARM                    ULINR
     C                   PARM                    UVIS
     C                   GOTO      START
     C                   ENDIF
      *
     C     *IN17         IFEQ      *ON
     C                   MOVE      *BLANK        UVIS
     C                   CALL      'SYFI10V'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR
     C                   PARM                    UVIS
     C                   GOTO      START
     C                   ENDIF
     C     *IN18         IFEQ      *ON
     C                   MOVE      *BLANK        UVIS
     C                   CALL      'SYFI10U'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR
     C                   PARM                    UVIS
      * parm Uvis=T=F17-Transportørinfo er tastet inne fra Syfi10U
     C     UVIS          IFEQ      'T'
     C                   MOVE      *BLANK        UVIS
     C                   CALL      'SYFI10V'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR
     C                   PARM                    UVIS
     C                   END
     C                   GOTO      START
     C                   ENDIF
     C* Annen fraktbetaler
     C   20              DO
     C                   EXSR      ANNENF
     C                   GOTO      START
     C                   END
     C* FARLIG GODS
     C   21              DO
     C     *LIKE         DEFINE    WNUM2         WGSLIN
     C                   Z-ADD     99            WGSLIN
     C                   MOVE      *BLANK        UVIS
     C                   CALL      'SYFI10Y'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR
     C                   PARM                    WGSLIN
     C                   PARM                    UVIS
     C                   GOTO      START
     C                   END
      * F22= SE EDI-LOGG
     C     *IN22         IFEQ      *ON
     C                   MOVE      'IFTMIN'      EDITYP            6
     C                   MOVE      'S'           TSTSPØ            1
     C                   MOVE      ' '           IN29              1
     C                   CALL      'SYEDIL'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR
     C                   PARM                    EDITYP
     C                   PARM                    TSTSPØ
     C                   PARM                    IN29
     C                   GOTO      START
     C                   ENDIF
      *
     C                   Movel     *blanks       DUPINT           12
     C                   Movel     *blanks       DUPINT2          23
     C     WSTRAN        IFNE      0
     C     TRAKEY        CHAIN(N)  TRAN                               78
     C     *IN78         IFEQ      '0'
     C     VMLAYO        IFEQ      'DU'
     C                   Movel     '<-DUP/Intern'DUPINT
     C                   Movel     '<-DUP/Intern'DUPINT2
     C     VMRECM        ifne      *zeros
     C                   Move      VMRECM        DupIntx           9
     C                   Movel     'Term:'       DupIntx
     C                   move      DupIntx       DupInt2
     C                   end
     C     WSST          Ifeq      ' '
     C     TROPD2        IFNE      *zeros
     C                   MOVE      'JOV1359'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      START
     C                   END
     C                   MOVE      'Y'           WSCMN
     C                   END
     C                   END
     C                   END
     C                   END
     C   12              Z-ADD     1             UFLAGG
     C   12              GOTO      SLUTT
      *
      *
      *
n46  c                   exsr      sjekktr
n46   *linjer under er flyttet til egen subrutine
      *
      *
      *
     C  N40              EXSR      TESTB1
      *
     C     TEST          IFNE      '9'
     C   30              GOTO      START
     C                   END
      *
      * BILDE FOR ANNEN BETALER....
     C     WSBELA        IFEQ      'A'
     C     WSNAVX        IFEQ      *BLANKS
     C     TEST          IFNE      '9'
     C  N40              EXSR      ANNENF
     C                   GOTO      START
     C                   END
     C                   END
     C                   ELSE
     C                   MOVE      *ZEROS        WSKNSX
     C                   MOVE      *BLANKS       WSNAVX
     C                   MOVE      *BLANKS       WSAD1X
     C                   MOVE      *BLANKS       WSAD2X
     C                   MOVE      *BLANKS       WSAD3X
     C                   MOVE      *BLANKS       WSLKX
     C                   MOVE      *BLANKS       WSPNUX
     C                   MOVE      *BLANKS       WSKNX
     C                   END
      *
      * TILDEL SEND.NR ONLINE HVIS FIRMADEFN. TILSIER DET...
     C     WSSNDN        IFEQ      *ZEROS
     C*FR.BREV
     C     FIFBNR        IFEQ      'J'
      *
      * ETTERKRAV PÅ GIROFRAKTBREV ER ALLTID FORTRYKT - SKIPP TILDELING
      *
N35   * girofraktbrev utgår G ikke lenger tillatt
s35  C*    FILFB         IFEQ      'G'
s35  C*    WSKDE         ANDEQ     'X'
s35  C*                  GOTO      GIRTAG
s35  C*                  END
     C                   EXSR      GETSND
s35  C*    GIRTAG        TAG
     C                   END
     C*TOLLPASS..
     C     FITPNR        IFEQ      'J'
     C     WSSNDN        ANDEQ     *ZEROS
     C                   EXSR      GETSND
     C                   END
     C                   END
      *
      * LEGGE "GOTO START" TILBAKE SLIK AT MAN FÅR KONTROLLERE ETTER
      * MAN TRYKKER "ENTER". MAN KOMMER UT VED Å TASTE EN AV DE
      * FUNKSJONSTASTENE.
      *
     C  N03
     CANN05
     CANN16
     CANN09
     CANN31
     CANN19
     CANN11              GOTO      START
     C*
      *
     C     DOKUFK        CHAIN     DOKUF                              33
     C                   EXSR      MOVWSD
     C     *IN33         IFEQ      '1'
     C     *IN40         ANDEQ     '0'
     C                   WRITE     DOKUFR
     C                   END
     C     *IN40         IFEQ      '1'
     C     DOKUF2        SETGT     DOKUF
     C     DOKUF2        READPE    DOKUF                                  90
     C     *IN90         IFEQ      *OFF
     C                   Z-ADD     DFFBNR        UFBNR
     C                   ENDIF
     C                   END
     C  N33
     CANN40              UPDATE    DOKUFR
N23   *
N23  c                   exsr      budsr
n23   *
     C  N40              EXSR      FAKTSR
      *lag dup
     C   11              DO
N28   * quick & dirty - hindre ubetinget (fjern senere)
N28  C                   MOVE      'JOV1640'     MSGNR
N28  C                   SETON                                        30
N28  C                   Z-ADD     13            LINNBR
N28  C                   Z-ADD     12            POSNBR
N28  C                   GOTO      START
      * ikke tillatt dersom det er DUPPET på oppdr.nivå.
     C     TROPD2        IFNE      *zeros
     C                   MOVE      'JOV1359'     MSGNR
     C                   SETON                                        30
     C                   END
     C                   Move      'J'           XXVIS             1
     C                   CALL      'SYTR11'
     C                   PARM                    DFAVD
     C                   PARM                    DFOPD
     C                   PARM                    DFFBNR
     C                   PARM                    XXVIS
     C     DOKUFK        CHAIN(N)  DOKUF                              33
     C  n33              move      DFBREF        WSBREF
     C                   GOTO      START
     C                   END
      *SENDE FAX
     C*  11              DO
     C   19              DO
     C                   EXSR      FAXSR
     C                   GOTO      START
     C                   END
     C*
     C*
     C     *IN09         IFEQ      *ON
N41   * F9 fra oppdraget = lag spredning - nr 1 =OPPDRTAGET-merk den med O../2,3,4,.. SPREDN..
N41  c                   if        UFBNR = 1
S44  c*                            and WSST = ' '
N44  C                   EXFMT     SPREDWARN
N41  C     DOKUFK        CHAIN     DOKUF                              33
N41  C  N33              MOVE      'O'           DFST
N41  C  N33              UPDATE    DOKUFR
N41  c                   endif
     C     W2FBNR        IFEQ      *ZEROS
     C                   ADD       1             UFBNR
     C                   ELSE
     C                   MOVE      UFBNR         XFBNR             3 0
     C                   MOVE      W2FBNR        UFBNR
     C     DOKUFK        CHAIN     DOKUF                              33
     C   33              MOVE      XFBNR         UFBNR
     C  N33              UPDATE    DOKUFR
     C                   END
     C     DOKUFK        CHAIN     DOKUF                              33
     C     *IN33         IFEQ      '0'
     C   33              MOVE      XFBNR         UFBNR
     C                   EXSR      MOVDWS
     C                   ELSE
     C                   MOVE      *ZEROS        WSSNDN
     C                   MOVE      *ZEROS        WSSNDA
     C                   MOVE      *ZEROS        WSSNDB
     C                   MOVE      *ZEROS        WSDTU
N15  C                   MOVE      *ZEROS        DFDTU
     C     WSBRTX        IFEQ      'U.op:'
     C                   MOVE      *BLANKS       WSBREF
     C                   end
     C                   SETOFF                                       87
     C                   MOVE      *BLANKS       WSST
     C                   MOVE      FICURR        WSVALK
     C                   MOVE      *ZEROS        WSBELV
     C                   SETOFF                                       91
     C                   END
     C   40              SETOFF                                       40
     C                   GOTO      START
     C                   END
     C*
     C   03              Z-ADD     3             UFLAGG
     C   05              Z-ADD     5             UFLAGG
     C   16              Z-ADD     6             UFLAGG
      * TEST=9 LAGD AUTOMATISK FRA FORD.PROGRAM
      * .. IKKE DISTRIB. OPPDRAG LAGD BASERT PÅ FRAKTBREV DA....
     C     TEST          IFNE      '9'
     C     *IN03         IFEQ      '1'
     C     *IN05         OREQ      '1'
     C     *IN16         OREQ      '1'
     C                   EXSR      DOPPD
     C                   END
     C                   END
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      ***********************************************
     C     ANNENF        BEGSR
      ***********************************************
      *
     C     STRANN        TAG
      *
     C     WSST          IFNE      'U'
     C     WSST          ANDNE     'V'
     C                   EXFMT     ANNEN
     C                   ELSE
     C                   EXFMT     ANNEN2
     C                   END
     C                   MOVEA     '00'          *IN(85)
     C                   MOVE      'N'           VISPNY            1
      * AVBRYT
     C     *IN12         IFEQ      *ON
     C                   GOTO      SLTANN
     C                   END
      * SØK KUNDE
     C     *IN04         IFEQ      *ON
     C                   MOVE      *ZEROS        UKUNDN
     C                   MOVE      WSNAVX        USØKKN
     C                   CALL      'SOEKKUN'
     C                   PARM                    UKUNDN
     C                   PARM                    UFIRM
     C                   PARM                    USØKKN
     C     UKUNDN        IFNE      *ZEROS
     C                   MOVE      UKUNDN        WSKNSX
     C                   MOVE      *BLANKS       WSNAVX
     C                   END
     C                   END
      *
     C     WSKNSX        IFNE      0
     C                   MOVE      WSKNSX        YYKUND
     C     KUND1K        CHAIN     CUNDL01                            85
     C   85              DO
     C                   MOVE      'SPK0004'     MSGNR
     C                   SETON                                        30
     C                   GOTO      STRANN
     C                   END
     C     WSNAVX        IFEQ      *BLANKS
N26  C     VKANNE        chain     vadr                               33
N26  c     *in33         ifeq      '0'
N26  C                   MOVE      VADRNA        WSNAVX
N26  C                   MOVE      VADRN1        WSAD1X
N26  C                   MOVE      VADRN2        WSAD2X
N26  C                   MOVE      VADRN3        WSAD3X
N26  c                   else
     C                   MOVE      KNAVN         WSNAVX
     C                   MOVE      ADR1          WSAD1X
     C                   MOVE      ADR2          WSAD2X
     C                   MOVEL     POSTNR        WSAD3X
     C                   MOVE      ADR3          WSAD3X
n26  c                   end
     C                   MOVE      'J'           VISPNY
     C                   END
     C                   END
      *
      * ANNEN FRAKTBETALERS  KUNDENR HOS TRANSPORTØR
     C     WSKNX         IFEQ      *BLANKS
     C     WSKNSX        ANDNE     *ZEROS
     C     WSTRAN        ANDNE     *ZEROS
     C                   MOVE      WSKNSX        XXKNSY
     C     KOTRKE        CHAIN     KODTTR                             77
     C  N77              MOVEL     KTRAK3        WSKNX
     C  N77              MOVE      'J'           VISPNY
     C                   END
      *
     C     WSNAVX        IFEQ      *BLANKS
     C     WSBELA        ANDEQ     'A'
     C                   MOVE      'JOV1118'     MSGNR
     C                   SETON                                        3086
     C                   GOTO      STRANN
     C                   END
      * VED KOMMUNIKASJON MÅ kundenr hos transportør være fylt ut
     C     WSCMN         IFEQ      'Y'
     C     VMLAYO        ANDNE     'DU'
     C     WSKNX         COMP      *BLANKS                                77
     C     *IN77         IFEQ      *ON
     C                   MOVE      'JOV1345'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   GOTO      STRANN
     C                   ENDIF
     C                   ENDIF
      *
     C     VISPNY        CABEQ     'J'           STRANN
      *
     C     SLTANN        ENDSR
      *
     C*
      ***********************************************
     C     DOPPD         BEGSR
      ***********************************************
      * SJEKK OM DET SKAL LAGE DISTRIBUSJONSOPPDRAG. I SÅ FALL LAGE DET
     C     FORDK         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     TRANK         KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    DFTRAN
     C     DOKFK3        KLIST
     C                   KFLD                    YRI
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
      * IKKE NÅR  TYPE="FO"-FORD.OPPDR. ELLER "DI"-DISTR.OPPDRAG
     C     TRSLAG        IFEQ      'FO'
     C     TRSLAG        OREQ      'DI'
     C                   GOTO      UTDOPP
     C                   END
      * IKKE VED UOPPFYLT UTLEV.FORBEHOLD
     C     HEKF          IFNE      *BLANKS
     C     HEKFT1        ANDEQ     ' '
     C                   GOTO      UTDOPP
     C                   END
      *
      * LAG KUN HVIS POST I FIL FORDEL IKKE FINNES FRA FØR OG
      * DET ER ETT OG BARE ETT FRAKTBREV OG TRANSPORTØR PÅ DETTE
      * ER EN MED TYPE "D" - DISTRIBUSJONSTRANSP. I REGISTERET!!!
     C     FORDK         SETLL     FORDEL                                 33
      *(33 OFF = FANTES IKKE!!!! - VED BRUK AV SETLL)
     C     *IN33         IFEQ      '0'                                          1<-B
     C     DOKFK3        SETLL     DOKUF
     C     DOKFK3        READE(N)  DOKUF                                  33
     C     *IN33         IFEQ      '0'                                           2<-B
     C     DOKFK3        READE(N)  DOKUF                                  33
     C     *IN33         IFEQ      '1'                                            3<-B
     C     TRANK         CHAIN(N)  TRAN                               33
     C  N33VMTKAT        IFEQ      'D'                                             4<-B
     C                   MOVE      '1'           UIN10             3
      * ZEROS I FBNR BETYR AT ANT.VEKT.MM. HENTES FRA HEADF I SYFO02
     C                   MOVE      *ZEROS        XXXFBN            3 0
     C                   CALL      'SYFO02'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UAVDV             4 0
     C                   PARM                    UOPDV             7 0
     C                   PARM                    UIN10
     C                   PARM                    UKDPL             1
     C                   PARM                    FICURR
     C                   PARM                    XXXFBN
      *
     C                   MOVE      'G'           FOSTAT
     C                   MOVE      UAVD          FOAVD
     C                   MOVE      UOPD          FOOPD
     C                   Z-ADD     DFFBNR        FOLOP
     C                   Z-ADD     DFNT          FOKLL
     C                   MOVEL     DFVS          FOVSL
     C                   Z-ADD     DFVKTF        FOVKT
     C                   Z-ADD     DFM3          FOM3
     C                   MOVEL     DFGM          FOMRK
     C                   MOVE      'N'           FOSJN
     C                   MOVE      'N'           FOTJN
     C                   MOVE      '9999'        FOAVDI
     C                   MOVE      '9999999'     FOOPDI
     C                   MOVE      UAVDV         FOAVDV
     C                   MOVE      UOPDV         FOOPDV
     C                   MOVEL     DF1004        FO1004
     C                   WRITE     FORDR
      *
     C                   END                                                       4<-B
     C                   END                                                      3<-B
     C                   END                                                     2<-B
     C                   END                                                    1<-B
      *
     C     UTDOPP        ENDSR
      *
     C***********************************************
     C     BFRAKT        BEGSR
     C***********************************************
     C                   MOVE      WSPNLS        UPNF              4 0
     C                   MOVE      WSPOUL        UPNT              4 0
     C     HEKNKF        IFNE      *ZEROS
     C                   MOVE      HEKNKF        UKUNDE            8 0
     C                   ELSE
     C                   MOVE      HEKNK         UKUNDE
     C                   END
N22  C                   MOVE      WSKNS         U2KNS            12
N22  C                   MOVE      WSTRAN        U2TRAN            8
N22  C                   MOVE      WSPROK        U2PROK            5
     C                   CALL      'SYFB02'
     C                   PARM                    UPNF
     C                   PARM                    UPNT
     C                   PARM      WSVKT         UVKT              9 0
     C                   PARM      WSLM          ULM               7 3
     C                   PARM      WSM3          UM3               7 3
     C                   PARM                    UKNT              8 0
     C                   PARM                    UKUNDE            8 0
     C                   PARM      WSNT          UANT              7 0
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR
N22  C                   PARM                    U2KNS
N22  C                   PARM                    U2TRAN
N22  C                   PARM                    U2PROK
     C     UKNT          IFNE      0
     C                   MOVE      UKNT          WSTRAN
     C     TRAKEY        CHAIN(N)  TRAN                               77
     C  N77              MOVEL     VMNAVN        WSNAT
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     FRABER        BEGSR
     C***********************************************
     C*
     C* FINNER FRAKTBEREGNINGSVEKT
     C*
     C     WSTRAN        IFEQ      0
     C     WSLM          MULT      KOVLKG        XFBV1             9 0
     C     WSM3          MULT      KOVKKG        XFBV2             9 0
     C                   ELSE
     C     TRAKEY        CHAIN(N)  TRAN                               97
     C     WSLM          MULT      VMLMOM        XFBV1
     C     WSM3          MULT      VMM3OM        XFBV2
     C                   END
     C     WSVKT         IFGE      XFBV1
     C                   Z-ADD     WSVKT         WSVKTF
     C                   ELSE
     C                   Z-ADD     XFBV1         WSVKTF
     C                   END
     C     WSVKTF        IFLT      XFBV2
     C                   Z-ADD     XFBV2         WSVKTF
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
     C*
      * SET AV ET PAR INDIKATORER
     C                   MOVE      *OFF          *IN30
     C                   MOVE      *OFF          *IN92
     C                   MOVE      *OFF          *IN94
     C                   MOVE      *OFF          *IN89
     C                   MOVEA     '00000000'    *IN(77)
N04  C                   MOVEA     '00'          *IN(73)
     C* TESTER sletting
     C*
     c     wsst          ifeq      'S'
     c                   exfmt     f23
     c     *in23         ifeq      '1'
     c                   exsr      slett
     c                   end
     c                   goto      uttest
     c                   end
     C* TESTER MERKELAPP
     C*
     C                   MOVE      *BLANKS       KFKOD
     C                   MOVEL     WSKDME        KFKOD
     C                   MOVE      *BLANKS       KFTYP
     C                   MOVEL     'MLAPKOD'     KFTYP
     C     KOFASK        CHAIN     KOFAST                             94
     C   94              MOVE      'YBC0465'     MSGNR
     C   94              SETON                                        30
     C   94              GOTO      SLT1
     C*
     C* TESTER MERKELAPP-ANTALL
     C*
     C     WSMANT        COMP      WSNT                               89
     C   89              MOVE      'SHU0587'     MSGNR
     C   89              SETON                                        30
     C   89              GOTO      SLT1
S30   * SUPERLABEL ?, DA MÅ TRANSPORTØRNR. FYLLES UT.
S30   * dropprt krav - om transp=0/type udefinetret velg TG-variant
S30  C*    WSKDME        IFEQ      'S'
S30  C*    WSTRAN        ANDEQ     0
S30  C*                  MOVE      *ON           *IN30
S30  C*                  MOVE      *ON           *IN97
S30  C*                  MOVE      'CBA0250'     MSGNR
S30  C*                  GOTO      SLT1
S30  C*                  ENDIF
N34   * MerkalappsAntall må bekreftes om de er særs høye
N34  C                   if        WSKDME='S' and WSMANT>MAXANTLAB and WSST=' '
N34  C                             and WSMLJN <> 'J'
N34  C                   EXFMT     SJEKLAB
N34  C     WSMLJN        ifne      'J'
N34  C                   SETON                                        3089
N34  C   89              GOTO      SLT1
N34  C                   endif
N34  C                   endif
      *
      *SIGNATURKODE
      *
     C     KODSFK        CHAIN     KOSFR                              95
     C   95              MOVE      'SPS0011'     MSGNR
     C   95              SETON                                        30
     C   95              GOTO      SLT1
     C*
N36   * avsendersnavn O / resten blank = signal om å hente fra oppdraget
N36  c     WSNAVS        ifeq      'O'
N36  C                   MOVE      HENAS         WSNAVS
N36  C                   MOVE      HEADS1        WSAD1S
N36  C                   MOVE      *BLANKS       WSAD2S
N36  c                   if        WSST = 'U' or WSST = 'V'
N36  C                   MOVE      HEADS2        WSAD2S
N36  c                   endif
N36  C                   MOVEL     HEADS3        TMPPUL            4
N36  C                   TESTN                   TMPPUL               34
N36  C     *IN34         IFEQ      '1'
N36  C                   MOVE      TMPPUL        WSPNLS                          LASTESTED
N36  C                   MOVE      HEADS3        TMPAD3           25
N36  C                   MOVEL     TMPAD3        WSAD3S
N36  C                   ELSE
N36  C                   MOVE      *ZEROS        WSPNLS
N36  C                   MOVEL     HEADS3        WSAD3S
N36  C                   END
N36  c                   endif
     C* TEST Sender   (MEN BYTT NAVN KUN NÅR LINJE 1 BLANK)
     C     WSKNSS        IFNE      0
     c     wsstar        andne     '*'                                          hentet vareadr v/F4
     C                   MOVE      WSKNSS        YYKUND
     C     KUND1K        CHAIN     CUNDL01                            99
     C   99              DO
     C                   MOVE      'SPK0004'     MSGNR
     C                   SETON                                        30
     C                   GOTO      SLT1
     C                   END
N19  c     WSNAVS        ifeq      *blanks
     C                   MOVE      KNAVN         WSNAVS
     C                   MOVE      ADR1          WSAD1S
     C                   MOVE      ADR2          WSAD2S
     C                   MOVE      POSTNR        WSPNLS
     C                   MOVEL     ADR3          WSAD3S
      * BYTTER OGSÅ HENTEADRESSE
     C                   Z-ADD     1             WADRNR
     C     VADKSS        CHAIN     VADR                               33
     C     *IN33         IFEQ      '0'
     C                   MOVE      VADRNA        WSNAVS
     C                   MOVE      VADRN1        WSAD1S
     C                   MOVE      VADRN2        WSAD2S
     C                   MOVEL     VADRN3        WSAD3S
     C                   MOVEL     VADRN3        TMPPUL
     C                   TESTN                   TMPPUL               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      TMPPUL        WSPNLS                          UTL.POSTNR
     C                   MOVE      VADRN3        WSAD25           25
     C                   MOVE      *BLANKS       WSAD3S
     C                   MOVEL     WSAD25        WSAD3S
     C                   END
     C                   END
N19  C                   END
     C                   END
     C**** TEST MOTTAKER (MEN BYTT NAVN KUN NÅR LINJE 1 BLANK)
     C*
     C     WSKNSM        IFNE      0
     C                   MOVE      WSKNSM        YYKUND
     C     KUND1K        CHAIN     CUNDL01                            84
     C   84              DO
     C                   MOVE      'SPK0004'     MSGNR
     C                   SETON                                        30
     C                   GOTO      SLT1
     C                   END
     C     WSNAVM        IFEQ      *BLANKS
     C     WSKNSM        ORNE      FORMOT
      * BYTTER OGSÅ LEV-ADR
     C                   Z-ADD     1             WADRNR
     C     VADK          CHAIN     VADR                               33
     C     *IN33         IFEQ      '0'
     C     WSKNSM        IFEQ      FORMOT
     C                   MOVE      KNAVN         WSNAVM
     C                   MOVE      ADR1          WSAD1M
     C                   MOVE      ADR2          WSAD2M
     C                   MOVE      *BLANKS       WSAD3M
     C                   MOVEL     POSTNR        WSAD3M
     C                   MOVE      ADR3          WSAD3M
     C                   ELSE
     C                   EXSR      MOVVAD
     C                   EXSR      MOVVLM
     C                   END
     C                   ELSE
     C                   MOVE      KNAVN         WSNAVM
     C                   MOVE      ADR1          WSAD1M
     C                   MOVE      ADR2          WSAD2M
     C                   MOVE      *BLANKS       WSAD3M
     C                   MOVEL     POSTNR        WSAD3M
     C                   MOVE      ADR3          WSAD3M
      *
     C                   MOVE      *ZEROS        WSPOUL
     C                   MOVE      WSNAVM        WSNAVL
     C                   MOVE      WSAD1M        WSAD1L
     C                   MOVEL     WSAD3M        TMPPUL
     C                   TESTN                   TMPPUL               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      TMPPUL        WSPOUL                          UTL.POSTNR
     C                   MOVE      *blanks       wsadul
     C                   MOVE      WSAD3M        TMPAD3
     c     tmpad3b       ifeq      ' '
     C                   MOVEL     TMPAD3c       WSADUL                          UTL.STED
     c                   else
     C                   MOVEL     TMPAD3        WSADUL                          UTL.STED
     c                   end
     C                   ELSE
     C                   MOVE      *ZEROS        WSPOUL
     C                   MOVEL     WSAD3M        WSADUL
     C                   END
     C                   END
     C                   END
     C                   END
      *
      * FLYTTER MOTTAGER TIL AVVIKENDE HVIS IKKE UTFYLLT§
      *
     C     WSNAVL        IFEQ      *BLANKS
     C     WSAD1L        ANDEQ     *BLANKS
     C     WSPOUL        ANDEQ     *ZEROS
     C     WSADUL        ANDEQ     *BLANKS
     C                   MOVE      WSNAVM        WSNAVL
     C                   MOVE      WSAD1M        WSAD1L
     C                   MOVEL     WSAD3M        TMPPUL
     C                   TESTN                   TMPPUL               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      TMPPUL        WSPOUL                          UTL.POSTNR
     C                   MOVE      *blanks       wsadul
     C                   MOVE      WSAD3M        TMPAD3           25
     c     tmpad3b       ifeq      ' '
     C                   MOVEL     TMPAD3c       WSADUL                          UTL.STED
     c                   else
     C                   MOVEL     TMPAD3        WSADUL                          UTL.STED
     c                   end
     C                   ELSE
     C                   MOVE      *ZEROS        WSPOUL
     C                   MOVEL     WSAD3M        WSADUL
     C                   END
     C                   END
     C*
      * TRANSPORTØR
     C     WSTRAN        IFGT      0
     C     TRAKEY        CHAIN(N)  TRAN                               97
     C*
     C   97              DO
     C*                  MOVE      'SPT0134'     MSGNR
     C                   MOVE      'SPT0133'     MSGNR
     C                   SETON                                        30
     C                   END
      * TEST OM MAKS FRAKTBREVNR. ER NÅDD
     C     *IN97         IFEQ      '0'                                          1<-B
     C     WSSNDN        ANDEQ     0
     C     VMRECM        ANDNE     0
     C     WSTOLL        IFEQ      *ZEROS                                        2<-B
     C     FIFBNR        IFEQ      'J'                                            3<-B
S35  C*    FILFB         IFNE      'G'                                             4<-B
s35  C*    WSKDE         ORNE      'X'
     C     VMRECM        COMP      VMRECN                               9797
s35  C*                  END                                                       4<-E
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     FITPNR        IFEQ      'J'                                            3<-B
     C     VMRECM        COMP      VMRECN                               9797
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C     *IN97         IFEQ      '1'                                           2<-B
     C                   MOVE      'YBC0506'     MSGNR
     C                   SETON                                        30
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C     *IN97         IFEQ      '0'
     C                   MOVEL     VMNAVN        WSNAT
      * SENDERS KUNDENR HOS TRANSPORTØR
     C     WSKNS         IFEQ      *BLANKS
     C     WSKNSS        ANDNE     *ZEROS
     C                   MOVE      WSKNSS        XXKNSY
     C     KOTRKE        CHAIN     KODTTR                             77
     C  N77              MOVEL     KTRAK3        WSKNS
     C                   END
      * MOTTAKERS KUNDENR HOS TRANSPORTØR
     C     WSKNM         IFEQ      *BLANKS
     C     WSKNSM        ANDNE     *ZEROS
     C                   MOVE      WSKNSM        XXKNSY
     C     KOTRKE        CHAIN     KODTTR                             77
     C  N77              MOVEL     KTRAK3        WSKNM
     C                   END
     C                   END
      *
      *HVIS PÅ KOMM-LINJE MÅ TRANSPORTØR HA LAYOUTKODE
     C  N97WSCMN         IFEQ      'Y'
     C     VMLAYO        IFEQ      *BLANKS
     C                   MOVE      'SHU0146'     MSGNR
     C                   SETON                                        9730
     C                   END
     C                   END
     C                   END
      * EDIFACT ?
     C     WSCMN         IFEQ      'Y'
     C     WSTRAN        ANDLT     1
     C                   MOVE      'SPT0135'     MSGNR
     C                   SETON                                        30
     C                   END
      * SUPERLABEL, AV GAMMEL TYPE, DA MÅ TRANSPORTØR HA LAYOUTKODE
      * (MEN NÅR TELLEVERK KOLLIID FINNES VIL NY FELLES-LAYOUT BRUKES)
     C     WSKDME        IFEQ      'S'
     C     VMLAYO        ANDEQ     *BLANKS
     C     FIIDNR        ANDEQ     *ZEROS
     C                   MOVE      *ON           *IN30
     C                   MOVE      *ON           *IN97
     C                   MOVE      'CBA0260'     MSGNR
     C                   GOTO      SLT1
     C                   ENDIF
      *
     C     WSST          IFNE      'U'
     C     WSST          ANDNE     'V'
     C     WSBELA        ANDNE     'S'
     C     WSBELA        ANDNE     'M'
     C     WSBELA        ANDNE     'A'
     C                   MOVE      'JOV1098'     MSGNR
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   SETON                                        30
     C                   END
      * Kommunikasjon -  DA MÅ POSTNR RUBRIKK 7 FYLLES U               T
     C     WSCMN         IFEQ      'Y'
N29  C     WSST          andne     'U'
N29  C     WSST          andne     'V'
     C     WSPOUL        IFEQ      *ZEROS
     C     WSADUL        OREQ      *BLANKS
     C                   MOVE      *ON           *IN30
     C                   MOVE      *ON           *IN92
     C                   MOVE      'CBA0300'     MSGNR
     C                   GOTO      SLT1
     C                   ELSE
     C     TSTPONR       IFEQ      'J'
     C                   MOVE      ' '           TSTTYP            1
     C                   MOVE      WSPOUL        TSTPOUL           4
     C                   MOVE      '0'           TSTPORES          1
     C                   CALL      'TSTPNR'
     C                   PARM                    TSTTYP
     C                   PARM                    TSTPOUL
     C                   PARM                    TSTPORES
     C     TSTPORES      IFEQ      '1'
     C                   MOVE      *ON           *IN30
     C                   MOVE      *ON           *IN92
     C                   MOVE      'JOV1333'     MSGNR
     C                   GOTO      SLT1
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      * VED KOMMUNIKASJON MÅ PRODUKTKODE FYLLES UT
     C     WSCMN         IFEQ      'Y'
     C     VMLAYO        ANDNE     *BLANKS
     C     VMLAYO        ANDNE     'DU'
     C     WSPROK        ANDEQ     *BLANKS
     C                   MOVE      *ON           *IN30
     C                   MOVE      *ON           *IN82
     C                   MOVE      'CBA0340'     MSGNR
     C                   GOTO      SLT1
     C                   ENDIF
      * VED KOMMUNIKASJON MÅ PRODUKTKODE STEMME MED TRANSPORTØR
     C     WSCMN         IFEQ      'Y'
     C     VMLAYO        ANDNE     *BLANKS
     C     WSPROK        ANDNE     *BLANKS
     C     2             SUBST     WSPROK:1      WSPRK1            2
     C     WSPRK1        IFNE      VMLAYO
     C                   MOVE      *ON           *IN30
     C                   MOVE      *ON           *IN82
     C                   MOVE      'CBA0350'     MSGNR
     C                   GOTO      SLT1
     C                   ENDIF
      *SENDER TG9BO
     c     wsprok        ifeq      'TG9BO'
     C                   MOVE      HEKNS         WSKNSS
     C                   MOVE      HENAS         WSNAVS
     C                   MOVE      HEADS1        WSAD1S
     C                   MOVE      *BLANKS       WSAD2S
     C                   MOVEL     HEADS3        TMPPUL            4
     C                   TESTN                   TMPPUL               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      TMPPUL        WSPNLS                          LASTESTED
     C                   MOVE      HEADS3        TMPAD3           25
     C                   MOVEL     TMPAD3        WSAD3S
     C                   ELSE
     C                   MOVE      *ZEROS        WSPNLS
     C                   MOVEL     HEADS3        WSAD3S
     C                   END
     C                   MOVEL     HERFA         WSSREF
     C                   ENDIF
     C                   ENDIF
      *ORIGINAL / EDIFACT ? SJEKK OM SENDT FØR....
     C     WSCMN         IFEQ      'Y'
     C     WSST          ANDEQ     ' '
     C     *IN30         ANDEQ     '0'
     C     *IN23         ANDEQ     '0'
      * MEN SJEKK KUN NÅR EN VIL AVSLUTTE BILDET
     C     *IN03         IFEQ      '1'
     C     *IN05         OREQ      '1'
     C     *IN16         OREQ      '1'
     C     *IN09         OREQ      '1'
     C     *IN11         OREQ      '1'
     C     *IN31         OREQ      '1'
     C                   MOVE      'IFTMIN'      EDITYP
     C                   MOVE      'T'           TSTSPØ
     C                   MOVE      ' '           IN29
     C                   CALL      'SYEDIL'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR
     C                   PARM                    EDITYP
     C                   PARM                    TSTSPØ
     C                   PARM                    IN29
     C     TSTSPØ        IFEQ      '1'
     C                   MOVE      'JOV0729'     MSGNR
     C                   Z-ADD     3             LINNBR
     C                   Z-ADD     22            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
     C                   END
      *
      * BEREGNING ETTER TG-TABELL..
      * fakturabeløp eller budsjett
      *
n23  c                   move      ' '           tgbud             1
n23  c                   move      ' '           tgbru             1
n23  c                   move      ' '           tgpri             1
n23  c*
N22  C                   MOVEL     WSKNS         UKNS7             7
N22  C     TGUSERK       CHAIN     TGUSER                             33
N22  C   33TGUSERKD      CHAIN     TGUSER                             33
N22  C  N33              move      'J'           tgpri
      *
      * skal hente bruttobeløp
      *
     C     WSVALK        IFEQ      'TG '
     c                   move      'J'           tgbru             1
     C                   MOVE      FICURR        WSVALK
     c                   end
      *
      * kun hvis modul er innstallert
      *
     C     MODOK         IFEQ      'J'
      * bud eller bru skal beregnes
     C     TGBUD         IFEQ      'J'
     C     TGBRU         OREQ      'J'
     c     TGPRI         ifne      'J'
     C                   EXSR      TGISR
     C                   ELSE
     C                   EXSR      TGIHTTP
     C                   END
     C                   END
     C                   END
      *
      * budsjett på leverandørnivå
      *
N33  c     wsbudb        ifeq      0
n33  c                   call      'SYGE88CL'
n33  c                   parm                    dfavd
n33  c                   parm                    dfopd
n33  c                   parm                    ubud              9 2
n33  c                   z-add     ubud          wsbudb
n33  c                   end
      * TESTER VALUTAKODE
     C     WSBELV        IFNE      *ZEROS
     C     WSVALK        IFEQ      *BLANKS
     C                   MOVE      FICURR        WSVALK
     C                   END
     C     VALKFA        CHAIN     VALUL01                            93
     C   93              MOVE      'SPV0001'     MSGNR
     C   93              Z-ADD     18            LINNBR
     C   93              Z-ADD     23            POSNBR
     C   93              SETON                                        30
     c                   end
      *
     C* PRODUKTKODE - IKKE SPERRE PR DATO...
     C                   MOVE      *BLANKS       PRODNA
     C     WSPROK        IFNE      *BLANKS
     C     PROKEY        CHAIN     KOFAST                             82
     C  N82              MOVEL     KFTXT         PRODNA
     C  N82              IF        WSTRAN > 0
     C                   MOVEL     WSPROK        XAN02             2
     C                   SELECT
     C                   WHEN      ((VMLAYO = 'LG') AND (XAN02 <> 'LG'))
     C                   MOVE      *ON           *IN82
     C                   WHEN      ((VMLAYO = 'TG') AND (XAN02 <> 'TG'))
     C                   MOVE      *ON           *IN82
     C                   WHEN      ((VMLAYO = 'PO') AND (XAN02 <> 'PO'))
     C                   MOVE      *ON           *IN82
N03  C                   WHEN      ((VMLAYO = 'P4') AND (XAN02 <> 'P4'))
N03  C                   MOVE      *ON           *IN82
     C                   ENDSL
     C                   END
     C   82              SETON                                        30
     C   82              MOVE      'SHU0790'     MSGNR
     C                   END
N38   * Ramberg henting / krav om  mailadresse på avsender
N38  c  N82              if        WSPROK='TGZHE' or WSPROK='TGZHU'
N42  c                             or WSPROK='TGZEX'
N38  C                   MOVE      *BLANKS       FE_C3148E
N38  C     DOKUFEKEYCZ   CHAIN(N)  DOKUFE                             33
N38  c                   if        FE_C3148E=*blanks
N38  C                   SETON                                        3082
N38  C                   MOVE      'JOV1692'     MSGNR
N38  c                   endif
N38  c                   endif
N16   * Posten/Ramberg - krav om sms-nr på visse produkt
N16  c  N82              if        WSPROK='PO12'
N38  c*                            or %subst(DFPRO1:1:3) ='ZAD'                 Advisering Ramberg
N39  c                             or %subst(WSPRO1:1:3) ='ZAD'                 Advisering Ramberg
N16  C                   MOVE      *BLANKS       FE_C3148D
N16  C     DOKUFEKEY2    CHAIN(N)  DOKUFE                             33
N35  C   33DOKUFEKEY     CHAIN(N)  DOKUFE                             33
s38  c*                  if        FE_C3148D=*blanks and WSSNDN <> *zeros
N38  c                   if        FE_C3148D=*blanks
N16  C                   SETON                                        3082
N16  C                   MOVE      'JOV1590'     MSGNR
N16  c                   endif
N16  c                   endif
N48   * Ramberg - krav om mobil/SMS elelr mailadresse ved psoten småpakke-produkt
N48  c  N82              if        WSPROK='TGZ12' or                            Serv.pakke
N48  c                             WSPROK='TGZX1'                               Express over natten
N48  C                   MOVE      *BLANKS       FE_C3148B                      Mob
N48  C                   MOVE      *BLANKS       FE_C3148D                      Sms
N48  C                   MOVE      *BLANKS       FE_C3148E                      mail
N48  C     DOKUFEKEY2    CHAIN(N)  DOKUFE                             33
N48  C   33DOKUFEKEY     CHAIN(N)  DOKUFE                             33
N48  c                   if        FE_C3148B=*blanks and
N48  c                             FE_C3148D=*blanks and
N48  c                             FE_C3148E=*blanks
N48  C                   SETON                                        3082
N48  C                   MOVE      'JOV1781'     MSGNR
N48  c                   endif
N48  c                   endif
N45   *
N45   * FIXED DELIVERY DATE
N45  c  N82              if        %subst(WSPRO1:1:3) ='ZFD'                    Fixed De.DtRamberg
N45  C*** TEST DATO
N45   * ....+... 1 ...+...
N45   * ZFD 050418      lovlig input
N47   * ZFD 05.04.18    eller.. lovlig input
N45   * ZFD 05042018    eller.. lovlig input
N45   * ZFD 05.04.2018  eller.. lovlig input (endelig)
N45   * hvis editcodes - komprimer til 6 lang alfa for test
N45  c                   select
N45  c                   when      %subst(WSPRO1:7:1)='.'                       ZFD 05.04.2018
N47  c                             and %subst(WSPRO1:14:1)<>' '
N45  c                   eval      UDDMMÅÅa= %subst(WSPRO1:5:2)
N45  c                             + %subst(WSPRO1:8:2)
N45  c                             + %subst(WSPRO1:13:2)
N47  c                   when      %subst(WSPRO1:7:1)='.'                       ZFD 05.04.18
N47  c                             and %subst(WSPRO1:14:1)=' '
N47  c                   eval      UDDMMÅÅa= %subst(WSPRO1:5:2)
N47  c                             + %subst(WSPRO1:8:2)
N47  c                             + %subst(WSPRO1:11:2)
N45  c                   when      %subst(WSPRO1:11:1)<>' '                     ZFD 05042018
N45  c                   eval      UDDMMÅÅa= %subst(WSPRO1:5:4)
N45  c                             + %subst(WSPRO1:11:2)
N45  c                   other                                                  ZFD 050418
N45  c                   eval      UDDMMÅÅa= %subst(WSPRO1:5:6)
N45  c                   endsl
N45   *
N45  C                   monitor
N45  C                   eval      UDDMMÅÅ = %int(UDDMMÅÅa)
N45  C                   on-Error
N45  C                   eval      UDDMMÅÅ = *zeros
N45  C                   endmon
N45   *
N45  C                   MOVE      UDD           UDD2
N45  C                   MOVE      UMM           UMM2
N45  C                   MOVE      UÅÅ           UÅÅ2
N45  C                   CALL      'TESTDATO'
N45  C                   PARM                    UDD2              2 0
N45  C                   PARM                    UMM2              2 0
N45  C                   PARM                    UÅÅ2              2 0
N45  C                   PARM                    UFLAGG            1 0
N45   *
N45  c                   if        UFLAGG = 1
N45  C                   SETON                                        3082
N45  C                   MOVE      'JOV1765'     MSGNR
N45  c                   else
N45   * OK - legg ut dato i editert form  bak ZFD
N45  c                   eval      WSPRO1 = 'ZFD '
N45  c                             + %editc(UDD:'X')+'.'
N45  c                             + %editc(UMM:'X')+'.'
N45  c                             +'20'+ %editc(UÅÅ:'X')
N45  c                   endif
N45  c                   endif
      *
N18   * TG9BO -booking  mail/på NAD+CZ                                          FE_C3148A       Tel
N18  c  N82              if        WSPROK='TG9BO'                               FE_C3148B       Mob
N18  C                   MOVE      *BLANKS       FE_C3148E                      FE_C3148C       Fax
N18  C     DOKUFEKEYCZ   CHAIN(N)  DOKUFE                             33        FE_C3148D       Sms
N18  c                   if        FE_C3148E=*blanks and WSSNDN <> *zeros       FE_C3148E       Epos
N18  C                   SETON                                        3082
N18  C                   MOVE      'JOV1595'     MSGNR
N18  c                   endif
N18  c                   endif
      *
N14  c  N82WSPROK        ifeq      'TG9M'
N14  c     WSKNM         andeq     '0413898'
N14  c                   eval      Prodna=%trim(PRODNA)+' (via BRING)'
N14  c                   endif
      *
     C  N82PRODNA        IFEQ      *blanks
     C                   Movel     DUPINT2       PRODNA
     C                   end
N04   *
N04  C  N82              IF        ((WSPROK >= 'P4') AND (WSPROK <= 'P4999'))
N04  C                   IF        WSTPK1 <> *BLANKS
N04  C     TPROKDK1      CHAIN     KOFAST                             74
N04  C   74              SETON                                        30
N04  C   74              MOVE      'YBC1968'     MSGNR
N04  C                   END
N04  C                   IF        WSTPK2 <> *BLANKS
N04  C     TPROKDK2      CHAIN     KOFAST                             73
N04  C   73              SETON                                        30
N04  C   73              MOVE      'YBC1968'     MSGNR
N04  C                   END
N04  C                   ELSE
N04  C                   MOVE      *BLANKS       WSTPK1
N04  C                   MOVE      *BLANKS       WSTPK2
N04  C                   END
N04   *
      * VED KOMMUNIKASJON MÅ kundenr hos transportør være fylt ut
     C     WSCMN         IFEQ      'Y'
     C     VMLAYO        ANDNE     'DU'
     C     WSBELA        ANDNE     ' '
     C                   Select
     C     WSBELA        wheneq    'M'
     C     WSKNM         COMP      *BLANKS                                80
N01  c  N80              movel     WSKNM         TSTKN1            1
N01  c  N80TSTKN1        comp      ' '                                    80
     C     *IN80         IFEQ      *ON
     C                   MOVE      'JOV1345'     MSGNR
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     36            POSNBR
     C                   MOVE      *ON           *IN30
     C                   GOTO      SLT1
     C                   ENDIF
     c
     C     WSBELA        wheneq    'A'
     C     WSKNX         COMP      *BLANKS                                77
N01  c  N77              movel     WSKNX         TSTKN1            1
N01  c  N77TSTKN1        comp      ' '                                    77
     C     *IN77         IFEQ      *ON
     C                   MOVE      'JOV1346'     MSGNR
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   MOVE      *ON           *IN30
     C                   GOTO      SLT1
     C                   ENDIF
     C                   OTHER
     C     WSKNS         COMP      *BLANKS                                79
N01  c  N79              movel     WSKNS         TSTKN1            1
N01  c  N79TSTKN1        comp      ' '                                    79
     C     *IN79         IFEQ      *ON
     C                   MOVE      'JOV1345'     MSGNR
     C                   Z-ADD     4             LINNBR
     C                   Z-ADD     36            POSNBR
     C                   MOVE      *ON           *IN30
     C                   GOTO      SLT1
     C                   ENDIF
     C                   endsl
     C                   ENDIF
N09
N09   * Ved tollpost Mypack mp servispartnre (mm) være fylt ut
N09
N09  C     WSPROK        ifeq      'TG9M'
N09  C     WSKNM         COMP      *BLANKS                                80
N09  C     *IN80         IFEQ      *ON
N09  C                   MOVE      'JOV1515'     MSGNR
N09  C                   Z-ADD     8             LINNBR
N09  C                   Z-ADD     36            POSNBR
N09  C                   MOVE      *ON           *IN30
N09  C                   GOTO      SLT1
N09  C                   ENDIF
N09  C                   endif
      *
      * HVIS ETTERKRAV FYLT UT SÅ MÅ OGSÅ KONTONR / TELEFONNR OPPGIS.
      *
     C     WSBELE        COMP      *ZEROS                             50
N50  C     WSKDE         COMP      'X'                                    50
     C     *IN30         IFEQ      *OFF
     C     *IN50         ANDEQ     *ON
N35  c     wspro2        ifeq      *blanks
N35  c                   eval      wspro2 = fibank
N35  c                   end
     C     WSPRO2        COMP      *BLANKS                                81
N35  c     wslevi        ifeq      *blanks
N35  c     DOKUFEKEY2    chain     dokufe                             33
N35  c   33DOKUFEKEY     chain     dokufe                             33
N35  c  N33              eval      wslevi = FE_C3148D
N35  c                   end
     C     WSLEVI        COMP      *BLANKS                                83
     C     *in81         IFEQ      '1'
     C                   MOVE      'JOV1343'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     15            LINNBR
     C                   Z-ADD     51            POSNBR
     C                   Goto      SLT1
     C                   end
     C     *in83         IFEQ      '1'
     C                   MOVE      'JOV1344'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     17            LINNBR
s35  C*                  Z-ADD     51            POSNBR
N35  C                   Z-ADD     12            POSNBR
     C                   Goto      SLT1
     C                   end
     C                   end
N49   *
N49   * Hvis varelijer finnes må sum varelinjer stemme med det på bildet (F23=ignorerer)
N49  c                   if        *in30='0'
N49  c                   if        *in23='1'
N49  c                   move      *on           *in05                          F5 = Videre
N49  c                   goto      UtTest
N49  c                   else
N49  c                   move      *zeros        AntFvli           5 0
N49  c                   move      *zeros        SumVlNt           7 0
N49  c                   move      *zeros        SumVlVkt          9 0
N49  c                   move      *zeros        SumVlM3           7 3
N49  c                   move      *zeros        SumVlLM           4 2
N49  C     DOKUFK        SETLL     DOKUFV
N49  C     DOKUFK        READE(N)  DOKUFV
N49  C                   DOW       not %eof
N49  C                   eval      AntFvli = AntFvli+1
N49  C                   eval      SumVlNt = SumVlNt  + FVANT
N49  C                   eval      SumVlVkt= SumVlVkt + FVVKT
N49  C                   eval      SumVlM3 = SumVlM3  + FVVOL
N49  C                   eval      SumVlLM = SumVlLM  + FVLM
N49  C     DOKUFK        READE(N)  DOKUFV
N49  C                   ENDDO
N49   * hvis EN og bare EN linje oppdater etter DF/WS-verdier
N49  c                   if        AntFvli = 1
N49  C     DOKUFK        CHAIN     DOKUFV
N49  c                   if        %found
N49   * Også godsmerke / beskrivelse ??
N49  c                   eval      FVANT =  WSNT
N49  c                   eval      FVVKT =  WSVKT
N49  c                   eval      FVVOL =  WSM3
N49  c                   eval      FVLM  =  WSLM
N49  c                   update    DOKUFVR
N49  c                   endif
N49  c                   endif
N49   * hvis mer enn en linje je oppdater etter DF/WS-verdier
N49  c                   if        AntFvli > 1
N49  c                   if        SumVlNt <> WSNT  or
N49  c                             SumVlVkt<> WSVKT or
N49  c                             SumVlM3 <> WSM3  or
N49  c                             SumVlLM <> WSLM
N49  C                   MOVE      'JOV1793'     MSGNR
N49  C                   SETON                                        30
N49  C                   Z-ADD     20            LINNBR
N49  C                   Z-ADD     15            POSNBR
N49  C                   Goto      SLT1
N49  c                   endif
N49  c                   endif
N49   *
N49  c                   endif
N49  c                   endif
      *
     C* SET CURSOR
     C     SLT1          TAG
     C   82              Z-ADD     13            LINNBR
N18  C   82WSPROK        IFEQ      'TG9BO'
N40  C     WSPROK        OREQ      'TGZHE'
N42  C     WSPROK        OREQ      'TGZEX'
N40  C     WSPROK        OREQ      'TGZHU'
N18  C                   Z-ADD     5             LINNBR
N18  C                   ENDIF
N24  c                   if        WSST = 'U' or WSST='V'
N24  C   82              Z-ADD     15            LINNBR
N24  c                   endif
     C   97              Z-ADD     13            LINNBR
N24  c                   if        WSST = 'U' or WSST='V'
N24  C   97              Z-ADD     15            LINNBR
N24  c                   endif
s12  C*  73              Z-ADD     13            LINNBR
s12  C*  74              Z-ADD     13            LINNBR
N12  C   73              Z-ADD     14            LINNBR
N12  C   74              Z-ADD     14            LINNBR
     C   92              Z-ADD     11            LINNBR
     C   98              Z-ADD     9             LINNBR
     C   84              Z-ADD     8             LINNBR
     C   99              Z-ADD     4             LINNBR
     C   95              Z-ADD     2             LINNBR
     C   94              Z-ADD     2             LINNBR
     C   89              Z-ADD     2             LINNBR
      *
     C   82              Z-ADD     51            POSNBR
N18  C   82WSPROK        IFEQ      'TG9BO'
N40  C     WSPROK        OREQ      'TGZHE'
N42  C     WSPROK        OREQ      'TGZEX'
N40  C     WSPROK        OREQ      'TGZHU'
N18  C                   Z-ADD     2             POSNBR
N18  C                   ENDIF
N45  C   82MSGNR         IFEQ      'JOV1765'
N45  C                   Z-ADD     14            LINNBR
N45  C                   Z-ADD     55            POSNBR
N45  C                   ENDIF
     C   97              Z-ADD     12            POSNBR
s12  C*  73              Z-ADD     57            POSNBR
s12  C*  74              Z-ADD     51            POSNBR
N12  C   73              Z-ADD     39            POSNBR
N12  C   74              Z-ADD     45            POSNBR
     C   92              Z-ADD     51            POSNBR
     C   98              Z-ADD     15            POSNBR
     C   84              Z-ADD     12            POSNBR
     C   99              Z-ADD     12            POSNBR
     C   95              Z-ADD     55            POSNBR
     C   94              Z-ADD     22            POSNBR
     C   89              Z-ADD     24            POSNBR
     C*
     c     uttest        tag
N35  c                   move      *zeros        wsbele
N35   * hen ufakturerte k-linjer
N35  C  N30wskde         ifeq      'X'
N35  c     *in40         andeq     '0'
N35  c                   exsr      faktsr
N35  c                   move      'K'           part              1
N35  c                   call      'SYGE92'
N35  c                   parm                    uavd
N35  c                   parm                    uopd
n35  c                   parm                    part
n35  c                   parm                    wsbele
N35  c                   end
     C                   ENDSR
     C*
      ***********************************************
     C     TGISR         BEGSR
      ***********************************************
     C                   MOVE      '0101'        FRAII             4 0
     C                   MOVE      WSPOUL        TILII             4 0
     C                   Z-ADD     WSLM          IILM              7 3
     C                   Z-ADD     WSM3          IIM3              7 3
     C                   Z-ADD     WSNT          IIANT             7 0
     C                   Z-ADD     WSVKT         IIVKT             9 0
     C                   Z-ADD     WSVKTF        IIVKTF            9 0
     C     HEKNKF        IFNE      *ZEROS
     C                   MOVE      HEKNKF        IIKUND
     C                   ELSE
     C                   MOVE      HEKNK         IIKUND
     C                   END
     C*BURDE EN HATT 2 PARAM FOR OVERST?? 1 FOR STED, 1 FOR PRIS/RABATT
     C                   MOVE      'J'           UOVERS                          OVERST.STED
     C                   MOVE      *ZEROS        URAB
     C                   MOVE      WSTRAN        IITRAN
     C                   CALL      'SYFB03'
     C                   PARM                    FRAII
     C                   PARM                    TILII
     C                   PARM                    IIVKT
     C                   PARM                    IILM
     C                   PARM                    IIM3
     C                   PARM                    IITRAN            8 0
     C                   PARM                    INLFRA            9 0
     C                   PARM                    IIVKTF            9 0
     C                   PARM                    IFLAGG            1 0
     C                   PARM                    UOVERS            1
     C                   PARM                    IIKUND            8 0
     C                   PARM                    IIANT             7 0
     C                   PARM                    UTGSON            3
     C                   PARM                    UBL2              9 0           *BRUTTO
     C                   PARM                    URAB              3 1           *BEN. RAB
     C                   PARM                    UAVD
     C                   PARM                    UOPD                            IKKE I BR.
     C                   PARM                    UFBNR                           IKKE I BR.
     C                   Z-ADD     INLFRA        WSBELV
     C*
     C                   ENDSR
      ***********************************************
     C     TGIHTTP       BEGSR
      ***********************************************
     C                   MOVE      'N'           UOVERS
s23  C*                  MOVE      '0101'        U2PNF             4
s23  C                   MOVE      WSPNLS        U2PNF             4
     C                   MOVE      WSPOUL        U2PNT             4
     C                   MOVE      WSNT          U2NT              7
     C                   MOVE      WSVKT         U2VKT             9
     C                   MOVE      WSM3          U2DM3             7
     C                   MOVE      WSTRAN        U2KNT             8
     C                   MOVE      *ZEROS        U2RAB             3
s23  C*                  MOVE      '0'           U2FLAGG           1
n23  C                   MOVE      '2'           U2FLAGG           1
     C                   MOVE      UAVD          U2AVD             4
     C                   MOVE      UOPD          U2OPD             7
     C     HEKNKF        IFNE      *ZEROS
     C                   MOVE      HEKNKF        U2KN              8
     C                   ELSE
     C                   MOVE      HEKNK         U2KN
     C                   END
N22  C                   MOVE      WSKNS         U2KNS            12
N22  C                   MOVE      WSTRAN        U2TRAN            8
N22  C                   MOVE      WSPROK        U2PROK            5
     C                   CALL      'SYFB05C'
     C                   PARM                    U2PNF
     C                   PARM                    U2PNT
     C                   PARM                    U2NT
     C                   PARM                    U2VKT
     C                   PARM                    U2DM3
     C                   PARM                    U2KNT
     C                   PARM                    U2BRTBL           9
     C                   PARM                    U2NETBL           9
     C                   PARM                    U2RAB
     C                   PARM                    U2FLAGG
     C                   PARM                    U2AVD
     C                   PARM                    U2OPD
     C                   PARM                    U2KN
N22  C                   PARM                    U2KNS
N22  C                   PARM                    U2TRAN
N22  C                   PARM                    U2PROK
     C                   IF        U2FLAGG = '0'
N22  C     tgbru         IFEQ      'J'
     C                   MOVE      U2BRTBL       U2BRTBL2          9 0
     C                   Z-ADD     U2BRTBL2      WSBELV
n23  C                   END
N22  C     tgbud         IFEQ      'J'
N23  C                   MOVE      U2NETBL       U2NETBL2          9 0
N23  C                   Z-ADD     U2NETBL2      WSBUDB
n23  c                   move      ficurr        WSBUDV
N23  C                   END
n23  C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVUWS        BEGSR
     C***********************************************
      *
      *
     C                   MOVE      ' '           WSST
N29   * tar hensyn til bruk at fraktbrevsbilde utenfor NO (F.eks CC DK) dft = U=UTENLANDSLAYOUT
N29  c     FILAND        ifne      'NO'
N29  c                   move      'U'           WSST
N29  c                   endif
N29   *
     C     AVBELA        IFNE      *BLANKS
     C                   MOVE      AVBELA        WSBELA
     C                   ELSE
      * KAN INNEHOLDE 'J'/'N' FRA GAMMEL BRUK AV PARAMETEREN
     C     ULFB          IFEQ      'S'
     C     ULFB          OREQ      'M'
     C                   MOVE      ULFB          WSBELA
     C                   END
     C                   END
      *
     C     INNLAN        IFEQ      'J'
      *SENDER INNLAND
     C                   MOVE      HEKNS         WSKNSS
     C                   MOVE      HENAS         WSNAVS
     C                   MOVE      HEADS1        WSAD1S
     C                   MOVE      *BLANKS       WSAD2S
     C                   MOVEL     HEADS3        TMPPUL            4
     C                   TESTN                   TMPPUL               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      TMPPUL        WSPNLS                          LASTESTED
     C                   MOVE      HEADS3        TMPAD3           25
     C                   MOVEL     TMPAD3        WSAD3S
     C                   ELSE
     C                   MOVE      *ZEROS        WSPNLS
     C                   MOVEL     HEADS3        WSAD3S
     C                   END
     C                   MOVEL     HERFA         WSSREF
N31  C                   MOVEL     HERFK         WSMREF
     C                   ELSE
      *SENDER
S29  C*    HEUR          IFEQ      'B'
S29  C*    HEUR          OREQ      'D'
S29  C*    HEUR          OREQ      'G'
N29  C     EKSPORT       IFEQ      'J'
     C                   MOVE      HEKNS         WSKNSS
     C                   MOVE      HEKNK         WSKNSM
N29  C                   MOVE      HENAS         WSNAVS
N29  C                   MOVE      HEADS1        WSAD1S
N29  C                   MOVE      *BLANKS       WSAD2S
N29  c     WSST          ifeq      'U'                                           UTENLANDLAYOUT
N29  C                   MOVE      HEADS2        WSAD2S
N29  c                   endif
N29  C                   MOVEL     HEADS3        TMPPUL            4
N29  C                   TESTN                   TMPPUL               34
N29  C     *IN34         IFEQ      '1'
N29  C                   MOVE      TMPPUL        WSPNLS                          LASTESTED
N29  C                   MOVE      HEADS3        TMPAD3           25
N29  C                   MOVEL     TMPAD3        WSAD3S
N29  C                   ELSE
N29  C                   MOVE      *ZEROS        WSPNLS
N29  C                   MOVEL     HEADS3        WSAD3S
N29  C                   END
N29  c     WSST          ifeq      'U'
N29  C                   MOVEL     FILAND        WSLKS
N29  C                   MOVEL     *blanks       WSPNUS
N29  C                   MOVEL     HEADS3        WSAD3S
N29  c     ' '           scan      HEADS3        xPos              3 0
N29  c                   if        xPos > 3 and xPos < 11
N29  C                   eval      WSPNUS =%subst(HEADS3:1:xPos)
N29  C                   eval      WSAD3S =%subst(HEADS3:xPos+1)
N29  C                   endif
N29  C                   endif
     C                   ELSE
     C                   MOVE      UKNSS         WSKNSS
     C                   MOVE      HEKNK         WSKNSM
S29  C*                  END
      *
      * HENTER AVSENDER
      *
     C                   MOVE      WSKNSS        YYKUND
     C     KUND1K        CHAIN     CUNDL01                            34
     C   34              MOVE      *BLANKS       WSNAVS
     C   34              MOVE      *ZEROS        WSPNLS
     C  N34              MOVE      KNAVN         WSNAVS
     C  N34              MOVE      ADR1          WSAD1S
     C  N34              MOVE      ADR2          WSAD2S
     C  N34              MOVE      POSTNR        WSPNLS
     C  N34              MOVEL     ADR3          WSAD3S
N29  C                   END
     C                   END
      *
      * MOTTAGER KUNDENUMMER FLYTTET OPP + TESTB1 KJØRES SENERE
      *
     C                   MOVE      HEKNK         WSKNSM
     C                   MOVE      HENAK         WSNAVM
     C                   MOVE      HEADK1        WSAD1M
     C                   MOVE      *BLANKS       WSAD2M
     C                   MOVE      HEADK3        WSAD3M
N29  c     WSST          ifeq      'U'
N29  C                   MOVE      HEADK2        WSAD2M
N29  C                   MOVE      HELKA         WSLKM
N29  C                   if        HEUR = 'H'
N29  C                   MOVE      HETRI         WSLKM
N29  C                   endif
N29  C     ' '           scan      HEADK3        xPos
N29  C                   eval      WSPNUM = %subst(HEADK3:1:xPos)
N29  C                   eval      WSAD3M = %subst(HEADK3:xPos+1)
N29  C                   END
      * LEV.ADR
s29  C*    HEUR          IFNE      'B'
s29  C*    HEUR          ANDNE     'D'
s29  C*    HEUR          ANDNE     'G'
N29  c     Eksport       IFNE      'J'
     C                   MOVE      HENAK         WSNAVL
     C                   MOVE      HEADK1        WSAD1L
     C                   MOVE      *BLANKS       WSAD2L
N27  C                   IF        %SUBST(HEADK3:5:1) = *BLANKS
     C                   MOVEL     HEADK3        TMPPUL            4
     C                   TESTN                   TMPPUL               34
N27  C                   ELSE
N27  C                   EVAL      *IN34 = *OFF
N27  C                   END
     C     *IN34         IFEQ      '1'
     C                   MOVE      TMPPUL        WSPOUL                          UTL.POSTNR
     C                   MOVE      *blanks       wsadul
     C                   MOVE      HEADK3        TMPAD3           25
     c     tmpad3b       ifeq      ' '
     C                   MOVEL     TMPAD3c       WSADUL                          UTL.STED
     c                   else
     C                   MOVEL     TMPAD3        WSADUL                          UTL.STED
     c                   end
     C                   ELSE
     C                   MOVE      *ZEROS        WSPOUL
     C                   MOVEL     HEADK3        WSADUL
     C                   END
     C                   ELSE
      * eksport - lev-adr = egen terminal
     C                   MOVE      UKNSS         YYKUND
     C     VADKYY        CHAIN     VADR                               34
     C     *IN34         IFEQ      '0'
     C                   EXSR      MOVVAD
     C                   ELSE
     C     KUND1K        CHAIN     CUNDL01                            34
     C                   MOVE      KNAVN         WSNAVL
     C                   MOVE      ADR1          WSAD1L
     C                   MOVE      *BLANKS       WSAD2L
     C                   MOVEL     ADR3          WSADUL
     C                   MOVE      POSTNR        WSPOUL
N29  c     WSST          ifeq      'U'
N29  C                   MOVE      ADR2          WSAD2L
N29  C                   MOVE      FILAND        WSLKL
N29  C                   move      *blanks       WSPNUL
N29  C                   move      POSTNR        WSPNUL
N29  C                   if        SYPOGE <> *blanks
N29  C                   eval      WSPNUL = SYPOGE
N29  C                   endif
N29  C                   END
     C                   END
     C                   END
     c
N31   * ette ptf i sytr10 er HERFA gjort om til senders ref / HERFK = Mottakers ref
N31  C     HEUR          ifeq      'H'
N31  C                   MOVEL     HERFA         WSSREF
N31  C                   MOVEL     HERFK         WSMREF
N31  C                   endif
     C                   MOVE      HEKNT         WSTRAN
     C                   MOVEL     UNAT          WSNAT
     C                   MOVE      UKDME         WSKDME
     C                   MOVE      UKDE          WSKDE
     C                   MOVE      UTOLL         WSTOLL
     C                   MOVEL     HENAS         WSFASE
N19  C     INNLAN        IFEQ      'J'
N19  C                   MOVEL     HENAA         WSFASE                         Oppdragsgiver
N19  C                   endif
     C     HEADFK        CHAIN     BILLOF                             34
     C   34              DO
     C                   MOVE      HEVS1         WSVS
     C                   MOVE      HEVS2         WSVS2
     C                   MOVEL     HEGM1         WSGM
     C                   MOVEL     HEGM2         WSGM2
     C                   END
     C                   MOVE      HENT          WSNT
     C                   MOVE      HENT          WSMANT
     C                   MOVE      HEVKT         WSVKT
     C                   MOVE      HESG          WSSIGN
     C                   MOVE      HELM          WSLM
     C                   MOVE      HEM3          WSM3
     C                   MOVE      HEFBV         WSVKTF
     C*
     C                   MOVE      'N'           WSCMN
     C                   MOVE      *BLANKS       WSVEN
     C                   MOVE      *ZEROS        WSSNDN
     C                   MOVE      *ZEROS        WSRG
     C                   MOVE      *ZEROS        WSFORE
     C                   MOVE      *ZEROS        WSKTA
     C                   MOVE      *ZEROS        WSKTB
     C                   MOVE      FICURR        WSVALK
     C                   MOVE      *ZEROS        WSBELV
     C                   MOVE      *BLANKS       WSPROK
N04  C                   MOVE      *BLANKS       WSTPK1
N04  C                   MOVE      *BLANKS       WSTPK2
      *
      * Send-nr fra hoved-bildet ved Transp.innland
     C     HEUR          IFEQ      'H'
     c     HXSNDN        ANDNE     *BLANKS
      * Kort gammelt nr..???
     C     HERFKC        IFEQ      *BLANKS
     C                   TESTN                   HERFK1               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      HERFK1        WSSNDN
     C                   END
     C                   ELSE
      * Langt(EAN)nr  ???
     C                   TESTN                   HERFK2               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      HERFKA        WSSNDA
     C                   MOVE      HERFKB        WSSNDB
     C                   MOVE      HERFKC        WSSNDN
     C                   END
     C                   END
      * V.innland hent betalerkode fra oppdraget.
     C     TRKDFF        ifeq      'S'
     C                   MOVE      'S'           WSBELA
     c                   else
     C                   MOVE      'M'           WSBELA
     c                   end
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     MOVDWS        BEGSR
     C***********************************************
     C     DFDTU         IFEQ      *ZEROS
     C                   MOVE      *ZEROS        WSDTU
     C                   ELSE
     C                   EXSR      KDTFM1
     C                   END
     C                   MOVE      DFST          WSST
     C                   MOVE      DFTOLL        WSTOLL
     C                   MOVE      DFBREF        WSBREF
      *
     C                   MOVE      DFKNSS        WSKNSS
     C                   MOVE      DFNAVS        WSNAVS
     C                   MOVE      DFAD1S        WSAD1S
     C                   MOVE      DFAD2S        WSAD2S
     C                   MOVEL     DFAD3S        WSAD3S
N21  C                   MOVEL     DFLKS         WSLKS
N21  C                   MOVE      DFPNUS        WSPNUS
     C                   MOVE      DFKNS         WSKNS
     C                   MOVE      DFSREF        WSSREF
     C                   MOVE      DFPNLS        WSPNLS                         PN LASTESTED
     C                   MOVE      DFPNAT        WSPNAT            4 0          PN AVG.TERM.
      *
     C                   MOVE      DFKNSM        WSKNSM
     C                   MOVE      DFNAVM        WSNAVM
     C                   MOVE      DFAD1M        WSAD1M
     C                   MOVE      DFAD2M        WSAD2M
     C                   MOVE      DFAD3M        WSAD3M
     C                   MOVEL     DFLKM         WSLKM
     C                   MOVE      DFPNUM        WSPNUM
     C                   MOVE      DFKNM         WSKNM
     C                   MOVE      DFMREF        WSMREF
      *
     C                   MOVE      DFNAVL        WSNAVL
     C                   MOVE      DFAD1L        WSAD1L
     C                   MOVE      DFAD2L        WSAD2L
     C                   MOVE      DFPOUL        WSPOUL                         PNR. UTLEV.
     C                   MOVEL     DFADUL        WSADUL                         STED UTLEV
     C                   MOVE      DFLKL         WSLKL
     C                   MOVE      DFPNUL        WSPNUL
      *
     C                   MOVE      DFKNSX        WSKNSX
     C                   MOVE      DFNAVX        WSNAVX
     C                   MOVE      DFAD1X        WSAD1X
     C                   MOVE      DFAD2X        WSAD2X
     C                   MOVEL     DFAD3X        WSAD3X
     C                   MOVE      DFLKX         WSLKX
     C                   MOVE      DFPNUX        WSPNUX
     C                   MOVE      DFKNX         WSKNX
      *
     C                   MOVE      DFOVER        WSOVER
     C                   MOVE      DFBELE        WSBELE
     C                   MOVE      DFTRAN        WSTRAN
     C                   MOVE      DFNAT         WSNAT
     C                   MOVE      DFNTEU        WSNTEU
     C                   MOVE      DFNTAU        WSNTAU
     C                   MOVE      DFBELA        WSBELA
     C                   MOVE      DFKDE         WSKDE
     C                   MOVE      DFKDME        WSKDME
     C                   MOVE      DFFASE        WSFASE
     C                   MOVE      DFGM          WSGM
     C                   MOVE      DFNT          WSNT
     C                   MOVE      DFNTLA        WSMANT
     C                   MOVE      DFVS          WSVS
     C                   MOVE      DFVKT         WSVKT
     C                   MOVE      DFSG          WSSIGN
     C                   MOVE      DFLM          WSLM
     C                   MOVE      DFM3          WSM3
     C                   MOVE      DFGM2         WSGM2
     C                   MOVE      DFVS2         WSVS2
     C                   MOVE      DFVKTF        WSVKTF
     C                   MOVE      DFCMN         WSCMN
     C                   MOVE      DFVEN         WSVEN
     C                   Z-ADD     DFFVBL        WSFVBL
     C                   MOVE      DFFVCU        WSFVCU
     C                   MOVE      DFFKAT        WSFKAT
     C                   MOVE      DFPOLI        WSPOLI
     C                   MOVE      DFSKFO        WSSKFO
     C                   MOVE      DFLEVB        WSLEVB
     C                   MOVE      DFLEVT        WSLEVT
     C                   MOVE      DFLEVI        WSLEVI
     C                   MOVE      DFFRKU        WSFRKU
     C                   MOVEL     DFPROK        WSPROK
N04  C                   MOVEL     DFTPK1        WSTPK1
N04  C                   MOVEL     DFTPK2        WSTPK2
     C                   MOVE      *BLANKS       PRODNA
     C     WSPROK        IFNE      *BLANKS
     C     PROKEY        CHAIN     KOFAST                             77
     C  N77              MOVEL     KFTXT         PRODNA
N14  c  N77WSPROK        ifeq      'TG9M'
N14  c     WSKNM         andeq     '0413898'
N14  c                   eval      Prodna=%trim(PRODNA)+' (via BRING)'
N14  c                   endif
     C                   END
     C                   MOVE      DFPRO1        WSPRO1
     C                   MOVE      DFPRO2        WSPRO2
     C     DF1117        IFEQ      *BLANKS
     C                   MOVE      *ZEROS        WSSNDA
     C                   MOVE      *ZEROS        WSSNDB
     C                   MOVEL     DF1004        WSSNDN
     C                   ELSE
     C                   MOVE      DFLA          WSSNDA
     C                   MOVE      DFLE          WSSNDB
     C                   MOVE      DFSE          WSSNDN
     C                   END
     C     WSSNDN        COMP      *ZEROS                             8787
     C                   MOVE      DFRG          WSRG
     C                   MOVE      DFFORE        WSFORE
     C                   MOVE      DFKTA         WSKTA
     C                   MOVE      DFKTB         WSKTB
     C*
     C*
     C*  HENTER EVENTUELLT UTLEGG PÅ FAKTURA
     C*
     C     FAKTKE        CHAIN(N)  FAK13                              33
     C  N33              MOVE      FAVAL         WSVALK
     C  N33FAOPKO        COMP      'C'                                91
     C   33              MOVE      FICURR        WSVALK
     C  N33              MOVE      FABELV        WSBELV
      * hent budsjettbeløp fra kosbu
     c                   move      UFBNR         ufbnra            3
N23  C                   EVAL      utxt='*fb*'
n23  c                   CAT       UFBNRA:0      utxt
n23  c     kosbuk        chain     kosbu12                            33
n23  c  N33              move      buval         wsbudv
n23  c  N33              z-add     bubl          wsbudb
     C                   ENDSR
     C*
     C***********************************************
     C     MOVWSD        BEGSR
     C***********************************************
     C                   MOVE      WSST          DFST
     C                   MOVE      WSTOLL        DFTOLL
     C                   MOVE      WSBREF        DFBREF
      *
     C                   MOVE      WSKNSS        DFKNSS
     C                   MOVE      WSNAVS        DFNAVS
     C                   MOVE      WSAD1S        DFAD1S
     C                   MOVE      WSAD2S        DFAD2S
     C                   MOVEL     WSAD3S        DFAD3S
N21  C                   MOVEL     WSLKS         DFLKS
N21  C                   MOVE      WSPNUS        DFPNUS
     C                   MOVE      WSSREF        DFSREF
     C                   MOVE      WSPNLS        DFPNLS
     C                   MOVE      WSPNAT        DFPNAT
      *
     C                   MOVE      WSKNSM        DFKNSM
     C                   MOVE      WSNAVM        DFNAVM
     C                   MOVE      WSAD1M        DFAD1M
     C                   MOVE      WSAD2M        DFAD2M
     C                   MOVEL     WSAD3M        DFAD3M
     C                   MOVE      WSLKM         DFLKM
     C                   MOVE      WSPNUM        DFPNUM
     C                   MOVE      WSKNM         DFKNM
     C                   MOVE      WSMREF        DFMREF
      *
     C                   MOVE      WSNAVL        DFNAVL
     C                   MOVE      WSAD1L        DFAD1L
     C                   MOVE      WSAD2L        DFAD2L
     C                   MOVE      WSPOUL        DFPOUL                          PNR. UTLEV.
     C                   MOVEL     WSADUL        DFADUL                          STED UTLEV
     C                   MOVE      WSLKL         DFLKL
     C                   MOVE      WSPNUL        DFPNUL
      *
     C                   MOVE      WSKNSX        DFKNSX
     C                   MOVE      WSNAVX        DFNAVX
     C                   MOVE      WSAD1X        DFAD1X
     C                   MOVE      WSAD2X        DFAD2X
     C                   MOVEL     WSAD3X        DFAD3X
     C                   MOVE      WSLKL         DFLKX
     C                   MOVE      WSPNUL        DFPNUX
     C                   MOVE      WSKNX         DFKNX
      *
     C                   MOVE      WSBELE        DFBELE
     C                   MOVE      WSOVER        DFOVER
     C                   MOVE      WSTRAN        DFTRAN
     C                   MOVE      WSNAT         DFNAT
     C                   MOVE      WSNTEU        DFNTEU
     C                   MOVE      WSNTAU        DFNTAU
      *
     C                   MOVE      WSBELA        DFBELA
     C                   MOVE      WSKNS         DFKNS
     C                   MOVE      WSKDE         DFKDE
     C                   MOVE      WSKDME        DFKDME
     C                   MOVE      WSFASE        DFFASE
     C                   MOVE      WSGM          DFGM
     C                   MOVE      WSNT          DFNT
     C                   MOVE      WSMANT        DFNTLA
     C                   MOVE      WSVS          DFVS
     C                   MOVE      WSVKT         DFVKT
     C                   MOVE      WSSIGN        DFSG
     C                   MOVE      WSLM          DFLM
     C                   MOVE      WSM3          DFM3
     C                   MOVE      WSGM2         DFGM2
     C                   MOVE      WSVS2         DFVS2
     C                   MOVE      WSVKTF        DFVKTF
     C                   MOVE      WSCMN         DFCMN
     C                   MOVE      WSVEN         DFVEN
     C                   Z-ADD     WSFVBL        DFFVBL
     C                   MOVE      WSFVCU        DFFVCU
     C                   MOVE      WSFKAT        DFFKAT
     C                   MOVE      WSPOLI        DFPOLI
     C                   MOVE      WSSKFO        DFSKFO
     C                   MOVE      WSLEVB        DFLEVB
     C                   MOVE      WSLEVT        DFLEVT
     C                   MOVE      WSLEVI        DFLEVI
     C                   MOVE      WSFRKU        DFFRKU
     C                   MOVEL     WSPROK        DFPROK
N04  C                   MOVEL     WSTPK1        DFTPK1
N04  C                   MOVEL     WSTPK2        DFTPK2
     C                   MOVE      WSPRO1        DFPRO1
     C                   MOVE      WSPRO2        DFPRO2
     C     WSSNDA        IFEQ      *ZEROS
     C                   MOVEL     WSSNDN        DF1004
     C                   ELSE
     C                   MOVE      WSSNDA        DFLA
     C                   MOVE      WSSNDB        DFLE
     C                   MOVE      WSSNDN        DFSE
     C                   END
     C   33              DO
     C                   MOVE      WSRG          DFRG
     C                   MOVE      WSFORE        DFFORE
     C                   MOVE      WSKTA         DFKTA
     C                   MOVE      WSKTB         DFKTB
     C                   MOVE      ' '           DFST2
     C                   MOVE      'F'           DFRI
     C                   MOVE      UAVD          DFAVD
     C                   MOVE      UOPD          DFOPD
     C                   MOVE      UFBNR         DFFBNR
     C                   END
     C                   ENDSR
     C*
     C***********************************************
     C     GETSND        BEGSR
     C***********************************************
     C*  dersom det finne EN og bare en  IFB, så benytt dette
     C     UFBNR         IFEQ      1
     C     FRIKEYIFB     setll     FRISOK
     C     FRIKEYIFB     reade     FRISOK                                 33
     C     *in33         IFEQ      *OFF
     C     FRIKEYIFB     reade     FRISOK                                 33
     C     *in33         IFEQ      *ON
N20  C                   movel     FSSOK         FBR17            17
N20  C                   TESTN                   FBR17                34
N20   * tester om 10 langt nummer er OK
N20  C     *IN34         ifeq      '0'
N20  C                   movel     FSSOK         FBR10            10
N20  C                   TESTN                   FBR10                34
N20  C                   EVAL      FBR17=FBR10
n20  c                   end
N20  C     *IN34         ifeq      '1'
s20  C*                  MOVEL     FSSOK         DF1004
n20  C                   MOVEL     FBR17         DF1004
     C     DF1117        IFEQ      *BLANKS
     C                   MOVE      *ZEROS        WSSNDA
     C                   MOVE      *ZEROS        WSSNDB
     C                   MOVEL     DF1004        WSSNDN
     C                   ELSE
     C                   MOVE      DFLA          WSSNDA
     C                   MOVE      DFLE          WSSNDB
     C                   MOVE      DFSE          WSSNDN
     C                   END
     C                   goto      UtGetSnd
     C                   end
N20  C                   end
     C                   end
     C                   end
      * HENTER FRAKTBREVNUMMER VED KOMMUNIKASJON
      *  PRIMÆRT FRA AKTUELL TRANSPORTØR/SEKUNDÆRT FRA FIRMA
     C* DET MESTE AV SR OMSKREVET...
     C                   MOVE      *ZEROS        VMRECN
     C     TRAKEY        CHAIN     TRAN                               88
     C     *IN88         IFEQ      '0'
     C     VMRECN        IFNE      *ZEROS
     C                   ADD       1             VMRECN
     C                   END
     C                   UPDATE    TRANR
     C                   END
      *
      * FREMDELES 0 - SJEKK FIRMA...
     C     VMRECN        IFEQ      *ZEROS
     C     FIFIRM        CHAIN     FIRFB                              88
     C     *IN88         IFEQ      '0'
     C     FIRECN        IFNE      *ZEROS
     C                   ADD       1             FIRECN
     C                   MOVE      FIRECN        VMRECN
     C                   MOVE      FISNLA        VMSNLA
     C                   MOVE      FISNLE        VMSNLE
     C                   END
     C                   UPDATE    FIRFBR
     C                   END
     C                   END
      *
     C* OPPDATER KUN HVIS ULIK 0.
      *
     C     VMRECN        IFNE      *ZEROS
     C                   MOVE      VMSNLA        WSSNDA
     C                   MOVE      VMSNLE        WSSNDB
     C                   MOVE      VMRECN        WSSND1
     C                   MOVE      *ZEROS        XBAK              1 0
     C                   MOVE      *ZEROS        UPAR21           21
     C                   MOVE      WSSND1        UPAR21
     C*
     C     VMSNLA        IFEQ      0
     C                   CALL      'SYGE09'
     C                   PARM                    UPAR21
     C                   PARM                    XBAK
     C                   ELSE
     C                   MOVE      WSSNDA        UFN17A
     C                   MOVE      WSSNDB        UFN17B
     C                   MOVEL     WSSND1        UFN17C
     C                   MOVE      *ZEROS        UAN22            22
     C                   MOVE      UFN17         UAN22
     C                   CALL      'SYGE08'
     C                   PARM                    UAN22
     C                   MOVE      UAN22         UFN17
     C                   MOVE      UFN17         XBAK
     C                   END
     C*
     C                   MOVE      XBAK          WSSND2
      * OGSÅ FRI SØKEVEI..
     C                   MOVE      *BLANKS       FSSOK
     C     WSSNDA        IFEQ      *ZEROS
     C                   MOVEL     WSSNDN        FSSOK
     C                   ELSE
     C                   MOVE      WSSNDA        DFLA
     C                   MOVE      WSSNDB        DFLE
     C                   MOVE      WSSNDN        DFSE
     C                   MOVEL     DF1004        FSSOK
     C                   END
     C     FRIKEY        CHAIN     FRISOK                             88
     C   88FSKODE        CHAIN     KODFRI                             33
     C   88              IF        *IN33
     C                   MOVE      *BLANKS       FSDOKK
     C                   ELSE
     C                   MOVE      KFSODK        FSDOKK
     C                   END
     C   88              MOVE      HEDTOP        FSDTOP
     C   88              WRITE     FRISOKR
     C                   END
      *
     c     UtGetSnd      tag
     C                   ENDSR
     C***********************************************
     C     SØKVAD        BEGSR
     C***********************************************
     C                   CALL      'SOEKVADR'
     C                   PARM                    UFIRM
     C                   PARM                    WSKNSM
     C                   PARM                    WSXX30           30
     C                   PARM                    WSXY30           30
     C                   PARM                    XADM             30
     C                   PARM                    WSXZ30           30
     C                   PARM                    XLK               2
     C                   PARM                    UADRNR            5
     C                   MOVE      UADRNR        WADRNR
     C     VADK          KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSKNSM
     C                   KFLD                    WADRNR            5 0
     C     WADRNR        IFNE      0
     C     VADK          CHAIN     VADR                               33
     C  N33              EXSR      MOVVAD
     C     POSNBR        IFLE      32
     C                   EXSR      MOVVLM
     C                   END
     C                   END
     C                   ENDSR
     C***********************************************
     C     MOVVLM        BEGSR
     C***********************************************
     C                   MOVE      WSNAVL        WSNAVM
     C                   MOVE      WSAD1L        WSAD1M
     C                   MOVE      *BLANKS       WSAD3M
     C                   MOVEL     WSPOUL        WSAD3M
     C                   MOVEL     WSADUL        TMPAD3           25
     c     tmpad3b       ifeq      ' '
s08  C*                  MOVEL     TMPAD3c       WSAD3M                          UTL.STED
n08  C                   MOVE      TMPAD3c       WSAD3M                          UTL.STED
     c                   else
s08  C*                  MOVEL     TMPAD3        WSAD3M                          UTL.STED
n08  C                   MOVE      TMPAD3        WSAD3M                          UTL.STED
     c                   end
     C                   ENDSR
     C***********************************************
     C     MOVVAD        BEGSR
     C***********************************************
     C                   MOVE      VADRNA        WSNAVL
     C                   MOVE      VADRN1        WSAD1L
     C                   MOVEL     VADRN3        TMPPUL
     C                   MOVE      VALAND        XLK               2
     C     VAREGN        IFNE      0
     C                   MOVE      VAREGN        WSRG              8 0
     C                   END
     C     VARG          IFNE      *BLANKS
     C                   MOVEL     VARG          WSFORE            9 0
     C                   END
     C                   MOVE      VAKON1        WSKTA             5 0
     C                   MOVE      VAKON2        WSKTB             2 0
     C*
     C                   MOVE      *ZEROS        WSPOUL
     C                   TESTN                   TMPPUL               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      TMPPUL        WSPOUL                          UTL.POSTNR
     C                   MOVE      *blanks       wsadul
     C                   MOVE      VADRN3        TMPAD3
     c     tmpad3b       ifeq      ' '
     C                   MOVEL     TMPAD3c       WSADUL                          UTL.STED
     c                   else
     C                   MOVEL     TMPAD3        WSADUL                          UTL.STED
     c                   end
     C                   ELSE
     C                   MOVE      *ZEROS        WSPOUL
     C                   MOVEL     VADRN3        WSADUL
     C                   END
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     SOKUKU        BEGSR
     C***********************************************
     C     WSSTJL        IFEQ      '*'
     C                   MOVE      WSKURL        WSKURE           17
     C                   END
     C     WSSTJM        IFEQ      '*'
     C                   MOVE      WSKURM        WSKURE           17
     C                   END
     C     VADKEY        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSKNSM
     C                   KFLD                    WSKURE
     C     VADKEY        CHAIN     VADR3                              33
     C  N33              DO
     C                   MOVE      VADRNA        WSNAVM
     C                   MOVE      VADRN1        WSAD1M
     C                   MOVE      VADRN2        XADM             30
     C                   MOVE      VADRN3        WSAD3M
     C                   MOVE      VALAND        XLK               2
     C                   MOVE      VADRNR        UADRNR            5
     C                   MOVE      VAREGN        WSRG              8 0
     C     VARG          IFNE      *BLANKS
     C                   MOVEL     VARG          WSFORE            9 0
     C                   END
     C                   MOVE      VAKON1        WSKTA             5 0
     C                   MOVE      VAKON2        WSKTB             2 0
     C*
     C                   MOVE      *ZEROS        WSPOUL
     C                   MOVE      WSNAVM        WSNAVL
     C                   MOVE      WSAD1M        WSAD1L
     C                   MOVEL     WSAD3M        TMPPUL            4
     C                   TESTN                   TMPPUL               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      TMPPUL        WSPOUL                          UTL.POSTNR
     C                   MOVE      *blanks       wsadul
     C                   MOVE      WSAD3M        TMPAD3           25
     c     tmpad3b       ifeq      ' '
     C                   MOVEL     TMPAD3c       WSADUL                          UTL.STED
     c                   else
     C                   MOVEL     TMPAD3        WSADUL                          UTL.STED
     c                   end
     C                   ELSE
     C                   MOVE      *ZEROS        WSPOUL
     C                   MOVEL     WSAD3M        WSADUL
     C                   END
     C*
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     SØKDTA        BEGSR
     C***********************************************
     C     LINNBR        IFEQ      2
     C     POSNBR        ANDEQ     22
     C                   MOVE      *BLANKS       KFTYP
     C                   MOVEL     'MLAPKOD'     KFTYP
     C                   MOVE      *BLANKS       KFKOD
     C                   CALL      'SYFAKDA'
     C                   PARM                    KFTYP
     C                   PARM                    UUPDAT            1
     C                   PARM                    KFKOD
     C                   MOVEL     KFKOD         WSKDME
     C                   Z-ADD     24            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C*
     C     LINNBR        IFEQ      02
S02  C*    POSNBR        ANDGE     67
S02  C*    POSNBR        ANDLE     68
S13  C*    POSNBR        ANDGE     67
S13  C*    POSNBR        ANDLE     68
N13  C     POSNBR        ANDGE     66
N13  C     POSNBR        ANDLE     70
     C                   CALL      'SYFI10H'
     C                   PARM                    WSTOLL
     C                   Z-ADD     03            LINNBR
     C                   Z-ADD     22            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
      * KUNDENR SENDER
      *
     C     LINNBR        IFEQ      4
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     19
     C                   MOVE      *ZEROS        UKUNDN            8 0
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    UKUNDN
     C                   PARM                    UFIRM
     C                   PARM                    USØKKN
     C     UKUNDN        IFNE      *ZEROS
     C                   MOVE      UKUNDN        YYKUND
     C     KUND1K        CHAIN     CUNDL01                            99
     C  N99              DO
     C                   MOVE      UKUNDN        WSKNSS
     C                   MOVE      KNAVN         WSNAVS
     C                   MOVE      ADR1          WSAD1S
     C*                    MOVE ADR2      WSAD2S
     C                   MOVE      POSTNR        WSPNLS
     C                   MOVEL     ADR3          WSAD3S
     C                   END
     C                   END
     C*
     C                   Z-ADD     4             LINNBR
     C                   Z-ADD     36            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C*
     C     LINNBR        IFEQ      5
     C     POSNBR        ANDGE     2
     C     POSNBR        ANDLE     31
     C                   CALL      'SOEKVADR'
     C                   PARM                    FIFIRM
     C                   PARM                    WSKNSS
     C                   PARM                    WSNAVS
     C                   PARM                    WSAD1S
     C                   PARM                    WSADxx           30
     C                   PARM                    WSADx2           30
     C                   PARM                    WSLAND            2
     C                   PARM                    UADRNR            5
     c                   move      '*'           WSNAVS
     C                   TESTN                   WSADP4               34
     C     *IN34         IFEQ      '1'
     C                   movel     wsadp4        wspnls
     c                   movel     wsad24        wsad3s
     c                   else
     c                   movel     wsadx2        wsad3s
     c                   end
     C                   GOTO      SLSØK
     C                   END
     C*
      *
      * KUNDENR MOTTAKER
      *
     C     LINNBR        IFEQ      8
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     19
     C                   MOVE      *ZEROS        UKUNDN
     C                   MOVE      WSNAVM        USØKKN
     C                   CALL      'SOEKKUN'
     C                   PARM                    UKUNDN
     C                   PARM                    UFIRM
     C                   PARM                    USØKKN
     C     UKUNDN        IFNE      *ZEROS
     C                   MOVE      UKUNDN        YYKUND
     C     KUND1K        CHAIN     CUNDL01                            99
     C  N99              DO
     C                   MOVE      UKUNDN        WSKNSM
     C                   MOVE      KNAVN         WSNAVM
     C                   MOVE      ADR1          WSAD1M
     C                   MOVE      ADR2          WSAD2M
     C                   MOVE      *BLANKS       WSAD3M
     C                   MOVEL     POSTNR        WSAD3M
     C                   MOVE      ADR3          WSAD3M
      * BYTTER OGSÅ LEV-ADR
     C                   Z-ADD     1             WADRNR
     C     VADK          CHAIN     VADR                               33
     C     *IN33         IFEQ      '0'
     C                   EXSR      MOVVAD
     C                   EXSR      MOVVLM
     C                   ELSE
     C                   MOVE      *ZEROS        WSPOUL
     C                   MOVE      WSNAVM        WSNAVL
     C                   MOVE      WSAD1M        WSAD1L
     C                   MOVEL     WSAD3M        TMPPUL
     C                   TESTN                   TMPPUL               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      TMPPUL        WSPOUL                          UTL.POSTNR
     C                   MOVE      *blanks       wsadul
     C                   MOVE      WSAD3M        TMPAD3           25
     c     tmpad3b       ifeq      ' '
     C                   MOVEL     TMPAD3c       WSADUL                          UTL.STED
     c                   else
     C                   MOVEL     TMPAD3        WSADUL                          UTL.STED
     c                   end
     C                   ELSE
     C                   MOVE      *ZEROS        WSPOUL
     C                   MOVEL     WSAD3M        WSADUL
     C                   END
     C                   END
     C                   END
     C                   END
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     36            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C*
     C* SØK POSTNR POSTENS FIL...
     C     TSTPONR       IFEQ      'J'
     C     LINNBR        ANDEQ     11
     C     POSNBR        ANDGE     51
     C     POSNBR        IFLE      55
     C     wsadul        oreq      *blanks
     C                   MOVE      WSPOUL        XXPNR             4
     C                   MOVE      *BLANKS       XXNAV            30
     c                   else
     C                   MOVE      *blanks       XXPNR             4
     C                   MOVEl     WSADUL        XXNAV            30
     c                   end
     C                   CALL      'PONRNR'
     C                   PARM                    XXPNR
     C                   PARM                    XXNAV
     C     XXPNR         IFNE      *BLANKS
     c                   MOVE      XXPNR         WSPOUL
     c                   MOVEL     XXNAV         WSADUL
     C                   end
     C                   GOTO      SLSØK
     C                   END
     C*
     C* SØK LEVERINGSADRESSE
     C     LINNBR        IFGE      9
     C     LINNBR        ANDLE     11
     C     POSNBR        ANDGE     51
     C                   EXSR      SØKVAD
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C*
     C* SØK LEVERINGSADRESSE
     C     LINNBR        IFGE      9
     C     LINNBR        ANDLE     11
     C     POSNBR        ANDLT     32
     C                   EXSR      SØKVAD
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C*
N17  C     TEST          IFne      '9'
N17  C     WSST          andne     'U'
N17  C     WSST          andne     'V'
     C     LINNBR        IFEQ      13
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     19
     C                   CALL      'SYTR04A'
     C                   PARM                    WSTRAN
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     51            POSNBR
     C                   GOTO      SLSØK
     C                   END
N17  C                   ELSE
N17  C     LINNBR        IFEQ      15
N17  C     POSNBR        ANDGE     12
N17  C     POSNBR        ANDLE     19
N17  C                   CALL      'SYTR04A'
N17  C                   PARM                    WSTRAN
N17  C                   Z-ADD     13            LINNBR
N17  C                   Z-ADD     51            POSNBR
N17  C                   GOTO      SLSØK
N17  C                   END
N17  C                   END
      *
N17  C     TEST          IFne      '9'
N17  C     WSST          andne     'U'
N17  C     WSST          andne     'V'
     C     LINNBR        IFEQ      13
     C     POSNBR        ANDGE     51
     C     POSNBR        ANDLE     55
S12  C*                  MOVEL     'FRBREVPRO'   KFTYP
N12  C                   EVAL      KFTYP = 'FRBREVPRO'
     C                   MOVE      *BLANKS       KFKOD
N04  C     TRAKEY        CHAIN(N)  TRAN                               33
N04  C  N33              MOVEL     VMLAYO        KFKOD
     C                   CALL      'SYFAKDA'
     C                   PARM                    KFTYP
     C                   PARM                    UUPDAT
     C                   PARM                    KFKOD
N04  C                   IF        KFKOD <> *BLANKS
     C                   MOVEL     KFKOD         WSPROK
N04  C                   END
     C                   Z-ADD     14            LINNBR
     C                   Z-ADD     51            POSNBR
     C                   GOTO      SLSØK
     C                   END
N17  C                   ELSE
N17  C     LINNBR        IFEQ      15
N17  C     POSNBR        ANDGE     51
N17  C     POSNBR        ANDLE     55
N17  C*                  MOVEL     'FRBREVPRO'   KFTYP
N17  C                   EVAL      KFTYP = 'FRBREVPRO'
N17  C                   MOVE      *BLANKS       KFKOD
N17  C     TRAKEY        CHAIN(N)  TRAN                               33
N17  C  N33              MOVEL     VMLAYO        KFKOD
N17  C                   CALL      'SYFAKDA'
N17  C                   PARM                    KFTYP
N17  C                   PARM                    UUPDAT
N17  C                   PARM                    KFKOD
N17  C                   IF        KFKOD <> *BLANKS
N17  C                   MOVEL     KFKOD         WSPROK
N17  C                   END
NS4  C*                  Z-ADD     14            LINNBR
N24  C                   Z-ADD     16            LINNBR
N17  C                   Z-ADD     51            POSNBR
N17  C                   GOTO      SLSØK
N17  C                   END
N17  C                   END
N04   *
s12  C*    LINNBR        IFEQ      12
s12  C*    POSNBR        ANDGE     51
s12  C*    POSNBR        ANDLE     55
N12  C     LINNBR        IFEQ      14
N12  C     POSNBR        ANDGE     39
N12  C     POSNBR        ANDLE     43
N04  C                   MOVEL     'FRBREVPROT'  KFTYP
N04  C                   MOVE      *BLANKS       KFKOD
N04  C     TRAKEY        CHAIN(N)  TRAN                               33
N04  C  N33              MOVEL     VMLAYO        KFKOD
N04  C                   CALL      'SYFAKDA'
N04  C                   PARM                    KFTYP
N04  C                   PARM                    UUPDAT
N04  C                   PARM                    KFKOD
N04  C                   IF        KFKOD <> *BLANKS
N04  C                   MOVEL     KFKOD         WSTPK1
N04  C                   END
s12  C*                  Z-ADD     12            LINNBR
s12  C*                  Z-ADD     57            POSNBR
N12  C                   Z-ADD     14            LINNBR
N12  C                   Z-ADD     45            POSNBR
N04  C                   GOTO      SLSØK
N04  C                   END
N04   *
s12  C*    LINNBR        IFEQ      12
s12  C*    POSNBR        ANDGE     57
s12  C*    POSNBR        ANDLE     61
N12  C     LINNBR        IFEQ      14
N12  C     POSNBR        ANDGE     45
N12  C     POSNBR        ANDLE     49
N04  C                   MOVEL     'FRBREVPROT'  KFTYP
N04  C                   MOVE      *BLANKS       KFKOD
N04  C     TRAKEY        CHAIN(N)  TRAN                               33
N04  C  N33              MOVEL     VMLAYO        KFKOD
N04  C                   CALL      'SYFAKDA'
N04  C                   PARM                    KFTYP
N04  C                   PARM                    UUPDAT
N04  C                   PARM                    KFKOD
N04  C                   IF        KFKOD <> *BLANKS
N04  C                   MOVEL     KFKOD         WSTPK2
N04  C                   END
s12  C*                  Z-ADD     14            LINNBR
s12  C*                  Z-ADD     51            POSNBR
N04  C                   GOTO      SLSØK
N04  C                   END
N04   *
     C     TEST          IFEQ      '9'
     C     WSST          OREQ      'U'
     C     WSST          OREQ      'V'
     C     LINNBR        IFEQ      15
     C     POSNBR        ANDGE     51
     C     POSNBR        ANDLE     55
S12  C*                  MOVEL     'FRBREVPR'    KFTYP
N12  C                   EVAL      KFTYP = 'FRBREVPR'
     C                   MOVE      'O '          KFTYP
     C                   MOVE      *BLANKS       KFKOD
     C                   CALL      'SYFAKDA'
     C                   PARM                    KFTYP
     C                   PARM                    UUPDAT
     C                   PARM                    KFKOD
     C                   MOVEL     KFKOD         WSPROK
     C                   Z-ADD     16            LINNBR
     C                   Z-ADD     20            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C                   END
     C*
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
     C*
     C     SLSØK         ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    UFIRM             2
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFBNR
     C                   PARM                    UKNSS             8 0
     C                   PARM                    UNAT             30
     C                   PARM                    UKDME             1
     C                   PARM                    UKDE              1
S02  C*                  PARM                    UTOLL             2 0
N02  C                   PARM                    UTOLL             4 0
     C                   PARM                    ULFB              1
     C                   PARM                    ULTB              1
     C                   PARM                    UMSG             62
     C                   PARM                    UFLAGG            1 0
     C                   PARM                    TEST              1
N22  c     tguserk       klist
N22  C                   kfld                    wstran
N22  C                   kfld                    UKNS7             7
N22  c     tguserkd      klist
N22  C                   kfld                    wstran
N22  C                   kfld                    UKNS7D            7
N22  C                   MOVEL     *zeros        UKNS7D            7
     C     FRIKEY        KLIST
     C                   KFLD                    FSAVD
     C                   KFLD                    FSOPD
     C                   KFLD                    FSKODE
     C                   KFLD                    FSSOK
     C     FRIKEYIFB     KLIST
     C                   KFLD                    FSAVD
     C                   KFLD                    FSOPD
     C                   KFLD                    FSKODE
     C     DOKUFK        KLIST
     C                   KFLD                    YRI
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    UFBNR
N23  C     KOSBUK        KLIST
N23  C                   KFLD                    BUOAVD
N23  C                   KFLD                    BUOPD
N23  C                   KFLD                    UTXT             35
n23  c                   move      UAVD          BUOAVD
n23  c                   move      UOPD          BUOPD
     C     DOKUFKB       KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    UFBNR
     C     FAKTKE        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    UFBNR
     C     HEADFK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     KUND1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    YYKUND            8 0
     C     KOTRKE        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    XXKNSY            8 0
     C                   KFLD                    WSTRAN
     C     TRAKEY        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSTRAN
     C     KODTVK        KLIST
     C                   KFLD                    XVUNI
     C                   KFLD                    UAVD
      *
     C     KOFASK        KLIST
     C                   KFLD                    KFTYP
     C                   KFLD                    KFKOD
s12  C*                  MOVEL     'MLAPKOD'     KFTYP
N12  C                   eval      KFTYP = 'MLAPKOD'
     C     PROKEY        KLIST
     C                   KFLD                    PROTYP
     C                   KFLD                    WSPROK
     C                   MOVEL     'FRBREVPR'    PROTYP           10
     C                   MOVE      'O '          PROTYP
N04  C     TPROKDK1      KLIST
N04  C                   KFLD                    TPKTYP
N04  C                   KFLD                    WSTPK1
N04  C     TPROKDK2      KLIST
N04  C                   KFLD                    TPKTYP
N04  C                   KFLD                    WSTPK2
N04  C                   MOVEL     'FRBREVPROT'  TPKTYP           10
     C*
     C     KODSFK        KLIST
     C                   KFLD                    XSFUNI
     C                   KFLD                    WSSIGN
n06  C     KOARkey       KLIST
n06  C                   KFLD                    KOAUNI
n06  C                   KFLD                    UAVD
n06  C                   MOVE      'A'           KOAUNI
     C     DOKUF2        KLIST
     C                   KFLD                    YRI
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C*
     C     VADKSS        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSKNSS
     C                   KFLD                    WADRNR            5 0
N26  C     VKANNE        KLIST
N26  C                   KFLD                    UFIRM
N26  C                   KFLD                    WSKNSX
N26  C                   KFLD                    WADMIN            5 0
N26  C                   Z-sub     1             wadmin
     C     VADKYY        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    YYKUND
     C                   KFLD                    YYADR1            5 0
     C                   Z-ADD     1             YYADR1
     C     DOKUFEKEY     KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    UFBNR
     C                   KFLD                    WE_N3035
     C     *LIKE         DEFINE    FE_N3035      WE_N3035
     C                   EVAL      WE_N3035='DP '
N05  C     DOKUFEKEY2    KLIST
N05  C                   KFLD                    UAVD
N05  C                   KFLD                    UOPD
N05  C                   KFLD                    UFBNR
N05  C                   KFLD                    WE_N3035B
N05  C     *LIKE         DEFINE    FE_N3035      WE_N3035B
N05  C                   EVAL      WE_N3035B='CN '
N18  C     DOKUFEKEYCZ   KLIST
N18  C                   KFLD                    UAVD
N18  C                   KFLD                    UOPD
N18  C                   KFLD                    UFBNR
N18  C                   KFLD                    WE_N3035CZ
N18  C     *LIKE         DEFINE    FE_N3035      WE_N3035CZ
N18  C                   EVAL      WE_N3035CZ ='CZ '
N34  C     SyParKey      KLIST
N34  C                   KFLD                    SYKUNR
N34  C                   KFLD                    SYPAID
      ** flyttet entry i front av KEYER mm
     C*
     C     UFLAGG        COMP      9                                      31
     C     UFLAGG        IFEQ      7
     C                   SETON                                        0940
     C                   Z-ADD     0             UFLAGG
     C                   END
     C
      *
N45  C                   MOVE      *zeros        UDDMMÅÅ
N45  C                   MOVE      *zeros        UDDMMÅÅa          6
      *
N29  C*( chain av firm flyttet lenger opp)
N29  C                   READ      FIRM                                   90
N29  C     FIFIRM        CHAIN(N)  FIRFB                              90
     C                   MOVE      ' '           MODOK             1
     C                   MOVE      'SF'          XSFUNI            2
     C                   MOVE      'F'           YRI               1
     C                   MOVE      'J'           SØK               1
     C                   MOVE      'V'           XVUNI             1
     C                   MOVE      *ZEROS        WSDTU
     C                   MOVE      *ZEROS        DFDTU
     C*
     C                   MOVE      'IFB'         FSKODE
     C                   MOVE      UAVD          FSAVD
     C                   MOVE      UOPD          FSOPD
      * HENT OMR.FAKTOR + AVDELINGS DFT FOR BELAST (S/M)
     C     KODTVK        CHAIN     KOVR                               33
     C                   MOVE      *ZEROS        WSSNDN
     C     HEADFK        CHAIN     HEADF                              33
     C                   MOVE      'N'           INNLAN            1
s06  C*    HELKA         IFEQ      'NO'
s06  C*    HETRI         ANDEQ     'NO'
n06  C     KOARkey       CHAIN     KOAR                               33
n06  C     KOAIE         IFEQ      '1'
n06  C     KOAIE         oreq      '2'
     C                   MOVE      'J'           INNLAN
     C                   END
N35   * hent kontonummer
N35  c     keyavd        klist
N35  c                   kfld                    fifirm
N35  c                   kfld                    koaknr
N35  c     keyavd        chain     cundl01                            33
N35  c                   movel     bankg         fibank           15
N29   * eksport ??
N29  C                   MOVE      'N'           EKSPORT           1
N29  c     Heur          ifeq      'H'
N29  C     HELKA         ANDEQ     FILAND
N29  C     HETRI         ANDNE     FILAND
N29  C                   MOVE      'J'           EKSPORT
N29  C                   endif
N29  C     HEUR          IFEQ      'B'
N29  C     HEUR          OREQ      'D'
N29  C     HEUR          OREQ      'G'
N29  C                   MOVE      'J'           EKSPORT
N29  C                   endif
     C     DOKUFK        CHAIN(N)  DOKUF                              33
     C   33              EXSR      MOVUWS
     C  N33              EXSR      MOVDWS
     C                   MOVEL     UDAY          XDDMM             4 0
     C                   MOVE      UMONTH        XDDMM
     C                   MOVEL     XDDMM         XDDMMÅ            6 0
     C                   MOVE      UYEAR         XDDMMÅ
      *
s29  C*( chain av firm flyttet lenger opp)
s29  C*                  READ      FIRM                                   90
s29  C*    FIFIRM        CHAIN(N)  FIRFB                              90
     C*
     C* FRITT FELTFOR KUNDE-SPESIALER SOM KAN DEFINERES I DS
     C                   MOVE      *BLANKS       WSFRKU           30
     C* GETS CUSTOMERNUMBER AT TRANSPORTER
     C* SENDER
     C     WSKNS         IFEQ      *BLANKS
     C                   MOVE      WSKNSS        XXKNSY
     C     KOTRKE        CHAIN     KODTTR                             77
     C  N77              MOVEL     KTRAK3        WSKNS
     C                   END
     C* MOTTAKER
     C     WSKNM         IFEQ      *BLANKS
     C                   MOVE      WSKNSM        XXKNSY
     C     KOTRKE        CHAIN     KODTTR                             77
     C  N77              MOVEL     KTRAK3        WSKNM
     C                   END
     C                   EXSR      UTCMDL
     C*
     C*
     c                   Move      'N'           TSTPONR           1
     c     *loval        setll     PONRN
     c                   read      PONRN                                  33
     c  N33              Move      'J'           TSTPONR
      * test om tollpostpris er innstallert
n23  C                   exsr      tmodul
N34   *
N34   * Max ant labels før en må bekrefte det
N34  c                   z-add     100           MAXANTLAB         4 0
N34  c                   move      *zeros        SYKUNR
N34  c                   move      'MXLAB'       SYPAID
N34  c     SyparKey      chain     SYPARL1                            33
N34  c  N33SYVRDN        ifgt      0
N34  c                   z-add     SYVRDN        MAXANTLAB
N34  c                   endif
N34   *
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     UTCMDL        BEGSR
     C***********************************************
      * Rokkert om på meldingene uten videre merking...
     C                   SELECT
     C     XCMD          WHENEQ    0
     C  N31              MOVE      'DIV0020'     MSGLN1                         F3=Avslutt
     C                   MOVE      'DIV0032'     MSGLN2                         F4=Søking
     C  N31              MOVE      'DIV0030'     MSGLN3                         F5=Videre
     C                   MOVE      'DIV5078'     MSGLN4                         F8=Beregn fr
     C  N31              MOVE      'DIV0381'     MSGLN5                         F9=Neste fb.
     C                   MOVE      'TRO0001'     MSGLN6                         F10=Varelin
     C                   MOVE      'JOV0803'     MSGLN7                         F11=Lag dup
     C                   MOVE      'DIV0029'     MSGLN8                         F24=Flere
     C                   ADD       1             XCMD              1 0
     C     XCMD          WHENEQ    1
     C                   MOVE      'DIV0024'     MSGLN1                         F12=Forrige
     C                   MOVE      'JOV1014'     MSGLN2                         F13=Merke
     C  N31              MOVE      'DIV0031'     MSGLN3                         F16=Neste op
     C                   MOVE      'JOV1106'     MSGLN4                         F17=TR.INSTR(EDI)
     C                   MOVE      'JOV1105'     MSGLN5                         F18=R38 FRITEKST
     C                   MOVE      'JOV1117'     MSGLN6                         F20=Annen fr.bet
     C                   MOVE      'CBA0240'     MSGLN7                         F21=Farlig G
     C                   MOVE      'DIV0029'     MSGLN8                         F24=Flere
     C                   ADD       1             XCMD
     C     XCMD          WHENEQ    2
     C                   MOVE      'JOV0730'     MSGLN1                         F22=Se EDI l
     C                   MOVE      'JOV0731'     MSGLN2                         F23=Dropp ED
     C                   MOVE      'JOV1340'     MSGLN3                         F19=Send FAX
     C                   MOVE      'CBA0370'     MSGLN4
     C                   MOVE      *BLANKS       MSGLN5
     C                   MOVE      *BLANKS       MSGLN6
     C                   MOVE      *BLANKS       MSGLN7
     C                   MOVE      'DIV0029'     MSGLN8                         F24=Flere
     C                   Z-ADD     0             XCMD
     C                   ENDSL
     C*
     C                   ENDSR
     C***********************************************
     C     FAXSR         BEGSR
     C***********************************************
     C                   CALL      'FAX023B'
     C                   PARM                    DFRI
     C                   PARM                    DFAVD
     C                   PARM                    DFOPD
     C                   PARM                    DFFBNR
     C                   ENDSR
     C***********************************************
     C     FAKTSR        BEGSR
     C***********************************************
      * LEGGER UT FAKTURALINJE PÅ OPPDRAG
     C     FAKTKE        CHAIN     FAK13                              33
      *FIKSER VARETEKST
     C                   MOVE      *BLANKS       WAVT
     C                   MOVE      DFFBNR        WAVT01
     C     WSSNDN        IFNE      *ZEROS
     C                   MOVE      WSSNDN        WAVT02
     C                   END
     C                   MOVE      WAVT          FAVT
      *
      *BEHANDLING VED ENDRING AV FAKTURALINJE
      *
     C     *IN33         IFEQ      '0'
     C     FAOPKO        IFGT      'C'
     C                   GOTO      UTFAKT
     C                   END
     C     WSBELV        IFGT      *ZEROS
     C                   MOVE      WSVALK        FAVAL
     C                   Z-ADD     WSBELV        FABELV
     C                   Z-ADD     WSBELV        FABELN
     C                   Z-ADD     HEKNKF        FAKUNR
     C                   EXSR      TESTVA
     C                   EXSR      DECI
     C                   UPDATE    FAKTR
     C                   ELSE
     C                   DELETE    FAKTR
     C                   END
     C                   ELSE
      *
     C     WSBELV        IFNE      *ZEROS
      *BEHANDLING VED NY FAKTURALINJE
      *
     C                   CLEAR                   FAKTR
      *  HENT LINJENUMMER
     C                   CALL      'SYGE06'
     C                   PARM                    DFAVD
     C                   PARM                    DFOPD
     C                   PARM                    FALI
     C                   MOVE      DFAVD         FAAVD
     C                   MOVE      DFOPD         FAOPD
     C                   MOVE      WAVT          FAVT
     C                   Z-ADD     WSBELV        FABELV
     C                   Z-ADD     WSBELV        FABELN
     C                   MOVE      'FRA'         FAVK
     C                   MOVE      WSVALK        FAVAL
     C                   MOVE      'K'           FASK
     C                   MOVE      'J'           FAKDM
     C                   MOVE      'M'           FAKDA
     C                   MOVE      DFFBNR        FAFRBN
     C                   Z-ADD     HEKNKF        FAKUNR
     C                   EXSR      TESTVA
     C                   EXSR      DECI
     C                   WRITE     FAKTR
     C                   END
     C                   END
     C     UTFAKT        ENDSR
     C***********************************************
     C     TESTVA        BEGSR
     C***********************************************
     C     VALKFA        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSVALK
     C*
     C     WSVALK        IFNE      FICURR
     C     VALKFA        CHAIN     VALUL01                            33
     C  N33              DO
     C     VALKU2        IFNE      0
     C                   MOVE      VALKU2        VALKU1
     C                   END
     C     FABELV        MULT      VALKU1        XWORK            15 4
     C     XWORK         DIV(H)    OMRFAK        FABELN
     C                   END                                                    1<-E
     C                   END
     C                   ENDSR                                                  1<-E
     C*
     C***********************************************
     C     DECI          BEGSR
     C***********************************************
     C* TEST FIRMS NUMBER OF DECIMALS
     C*
     C* NO DECIMALS
     C     FIDECI        IFEQ      0
     C                   Z-ADD(H)  FABELN        FABEL0           11 0
     C                   Z-ADD     FABEL0        FABELN
     C                   ELSE
     C* 1 DECIMAL
     C     FIDECI        IFEQ      1
     C                   Z-ADD(H)  FABELN        FABEL1           12 1
     C                   Z-ADD     FABEL1        FABELN
     C                   END
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFM1        BEGSR
     C***********************************************
     C                   MOVE      DFDTUD        UDT1              2 0
     C                   MOVE      DFDTUM        UDT2              2 0
     C                   MOVE      DFDTUÅ        UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          WSDTUD
     C                   MOVE      UDT2          WSDTUM
     C                   MOVE      UDT3          WSDTUÅ
     C*
     C                   ENDSR
     C*
N10
N10  c**************************************************************************
N10  c     TSTCLI        begsr
N10  c**************************************************************************
N10  C     DOKUFK        SETLL     DOKUFM                                 32
N10  C                   IF        *IN(32)
N10  C     DOKUFK        READE(N)  DOKUFM                                 33
N10  C                   DOW       *IN(33) = *OFF
N10  C     FMST          Ifeq      'I'
N10  C                   move      'P'           WSKDME
N10  C                   endif
N10  C     FMST          Ifeq      'E'
N10  C                   move      'P'           WSKDME
N10  c                   move      *on           *in51
N10  C                   endif
N10  C     DOKUFK        READE(N)  DOKUFM                                 33
N10  C                   ENDDO
N10  C                   ENDIF
N10  C*
N10  C                   ENDSR
N10  C*
     c**************************************************************************
     c     slett         begsr
     c**************************************************************************
     C     DOKUFK        CHAIN     DOKUF                              32
     C  N32              DELETE    DOKUFR
      *
      * merking
      *
s32  C*    DOKUFK        SETLL     DOKUFM                                 32
s32  C*                  IF        *IN(32)
s32  C*    DOKUFK        READE     DOKUFM                                 33
s32  C*                  DOW       *IN(33) = *OFF
s32  C*                  DELETE    DOKUFMR
s32  C*    DOKUFK        READE     DOKUFM                                 33
s32  C*                  ENDDO
s32  C*                  ENDIF
      *
      * varelinjer
      *
      *
s32  C*    DOKUFK        SETLL     DOKUFV                                 32
s32  C*                  IF        *IN(32)
s32  C*    DOKUFK        READE     DOKUFV                                 33
s32  C*                  DOW       *IN(33) = *OFF
s32  C*                  DELETE    DOKUFVR
s32  C*    DOKUFK        READE     DOKUFV                                 33
s32  C*                  ENDDO
s32  C*                  ENDIF
      *
      * farlig gods
      *
      *
     C     DOKUFKB       SETLL     DOKUDGS                                32
     C                   IF        *IN(32)
     C     DOKUFKB       READE     DOKUDGS                                33
     C                   DOW       *IN(33) = *OFF
     C                   DELETE    DOKUDGSR
     C     DOKUFKB       READE     DOKUDGS                                33
     C                   ENDDO
     C                   ENDIF
      *
      * FRITEKST
      *
      *
     C     DOKUFKB       SETLL     DOK29                                  32
     C                   IF        *IN(32)
     C     DOKUFKB       READE     DOK29                                  33
     C                   DOW       *IN(33) = *OFF
     C                   DELETE    DOK29r
     C     DOKUFKB       READE     DOK29                                  33
     C                   ENDDO
     C                   ENDIF
      *
      * ekstra adresseopplysninger
      *
      *
     C     DOKUFKB       SETLL     DOKUFE                                 32
     C                   IF        *IN(32)
     C     DOKUFKB       READE     DOKUFE                                 33
     C                   DOW       *IN(33) = *OFF
     C                   DELETE    DOKUFER
     C     DOKUFKB       READE     DOKUFE                                 33
     C                   ENDDO
     C                   ENDIF
     c                   seton                                        lr
     c                   return
     C                   ENDSR
      *
n23  c**************************************************************************
n23  c     budsr         begsr
n23  c**************************************************************************
n23  c                   clear                   kosbur
n23  c                   move      UAVD          BUOAVD
n23  c                   move      UOPD          BUOPD
n23   * skal de busjetteres fra stykkgodsfraktbrev
N23  C                   EVAL      utxt='*fb*'
     c                   move      UFBNR         ufbnra            3
n23  c                   CAT       UFBNRA:0      utxt
n23  c     kosbuk        chain     kosbu12                            33
n23   *
n23   * hopp ut hvis budsjett er ført
n23   *
n23  c  n33bust          ifne      ' '
n23  c                   goto      utbud
n23  c                   end
n23   *
n23   * byttet fra budsjetttransportør til en som ikke har
n23   * slett det som ligger der og gå ut ved ikke budsjetttransportør
n23   *
n23  c     tgbud         ifne      'J'
n23  c     *in33         ifne      '1'
n23  c                   delete    kosbur
n23  c                   end
n23  c                   goto      utbud
n23  c                   end
n23   *
n23   * flytter data til budsjett record
n23   *
n23  c                   move      wsbudv        buval
n23  c                   z-add     wsbudb        bubl
n23  c                   z-add     wstran        butnr
n23  c                   z-add     vmtrle        bulnr
n23  C                   MOVEL     HEDTÅ         BUPCC
n23  C                   MOVE      HEDTÅ         BUPÅR
n23  C                   MOVE      HEDTM         BUPMN
n23  C                   MOVE      FAVK          BUVK
n23  C                   MOVE      HESG          BUSG
n23  C                   MOVE      'O'           BUFER                          *O = OPPDRAG
n23  C                   MOVE      'E'           BUBLST
n23  C                   MOVE      'E'           BUTYPE
n23  c                   move      utxt          butxt
n23   * endre gammelt budsjett
n23   *
n23  c     *in33         ifeq      '0'
n23  c                   update    kosbur
n23   * logikk ved skrive ny
n23  c                   else
N37  C                   MOVE      'Å'           YBNRT             1
N37  C     YBNRT         CHAIN     KOSTT                              34
N37  C  N34              ADD       1             KTNR
N37  C  N34              UPDATE    KOSTTR
N37  C  N34              MOVE      KTNR          BUBNR
n23  c                   write     kosbur
n23  c                   end
n23  c     utbud         endsr
n23  c**************************************************************************
n23  c     tmodul        begsr
n23  c**************************************************************************
n23  C                   MOVEL     'SYTGSONE'    UMODUL           15
n23  C                   MOVE      'PRIS   '     UMODUL
N43  c     UMODUL        CHAIN     SYPROD
N43  c                   move      PRINST        MODOK
S43  C*                  CALL      'SYPRODT'
S43  C*                  PARM                    UMODUL
S43  C*                  PARM                    UMFLAG            1 0
S43  C*    UMFLAG        IFEQ      1
S43  C*                  MOVE      'N'           MODOK
S43  C*                  ELSE
S43  C*                  MOVE      'J'           MODOK
S43  C*                  END
n23  C                   ENDsr
n46  c**************************************************************************
n46  c     sjekktr       begsr
n46  c**************************************************************************
n46  C  N40WSTRAN        IFNE      XXTRAN
n46  C     WSKNSS        ANDNE     0
n46  C     WSKNS         ANDNE     *BLANKS
n46  c                   MOVE      WSKNSS        XXKNSY
n46  c     KOTRKE        CHAIN     KODTTR                             33
n46  c  N33KTRAK3        IFNE      WSKNS
n46  c                   MOVE      ' '           WSJN
n46  c                   MOVEL     KTRAK3        XXKNS
n46  C     STSJEKKN      TAG
n46  C                   EXFMT     SJEKKN
n46  C     WSJN          CABEQ     ' '           STSJEKKN
n46  C     WSJN          IFEQ      'N'
n46  C                   MOVEL     XXKNS         WSKNS
n46  C                   END
n46  C                   END
n46  C                   END
n46  C                   ENDSR
n46   *
