     FSVTX15F   IF   E           K DISK
     FSVTX08F2  IF   E           K DISK
     FSVTX03F   IF   E           K DISK
     D  WT             S              4    DIM(9)
     D                 DS
     D  W                      1     10
     D  W9                     9     10
     D  W7                     7     10
     D  W5                     5     10
     D  W3                     3     10
     D                 DS
     D  WVKD_KD                1     10
     D  WT01                   1      1
     D  WT04                   1      4
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   EXSR      SRD
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *_________________
      * Input parametere
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    UVTA_IE           2
     C                   PARM                    UVTX15_01
     C                   PARM                    ULK               2
     C                   PARM                    UFOKD             3
     C                   PARM                    UYKOD1            4
     C                   PARM                    UYTXT1          100
     C                   PARM                    UYKOD2            4
     C                   PARM                    UYTXT2          100
     C                   PARM                    UYKOD3            4
     C                   PARM                    UYTXT3          100
     C                   PARM                    UYKOD4            4
     C                   PARM                    UYTXT4          100
     C                   PARM                    UYKOD5            4
     C                   PARM                    UYTXT5          100
     C                   PARM                    UYKOD6            4
     C                   PARM                    UYTXT6          100
     C                   PARM                    UYKOD7            4
     C                   PARM                    UYTXT7          100
     C                   PARM                    UYKOD8            4
     C                   PARM                    UYTXT8          100
     C                   PARM                    UYKOD9            4
     C                   PARM                    UYTXT9          100
      *________________
      * Arbetsvariablar
      *""""""""""""""""
     C     *LIKE         DEFINE    SVTX03_01     WVKD_IE
     C     *LIKE         DEFINE    SVTX03_02     WVKD_TYP
     C     *LIKE         DEFINE    SVTX03_03     WVKD_KD
     C     *LIKE         DEFINE    SVTX15_01     UVTX15_01
     C     *LIKE         DEFINE    SVTX15_01     WVTX15_01
     C                   EVAL      WVTX15_01=UVTX15_01
     C                   EVAL      WVKD_IE='A'
     C                   EVAL      WVKD_TYP='MCF'
     C                   Z-ADD     0             WTN               2 0
     C                   MOVEL     ULK           WULK              4
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     SVTLKKEY      KLIST
     C                   KFLD                    WULK
     C                   KFLD                    SVTX15_02
     C     SVTX03K       KLIST
     C                   KFLD                    WVKD_IE
     C                   KFLD                    WVKD_TYP
     C                   KFLD                    WVKD_KD
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Finnes x/y-koder ?                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
     C                   EVAL      W=UVTX15_01
     C                   EVAL      WVTX15_01=W
     C                   EXSR      SRC

     C                   EVAL      W=UVTX15_01
     C     W9            IFNE      '00'
     C                   EVAL      W9='00'
     C                   EVAL      WVTX15_01=W
     C                   EXSR      SRC
     C                   ENDIF

     C                   EVAL      W=UVTX15_01
     C     W7            IFNE      '0000'
     C                   EVAL      W7='0000'
     C                   EVAL      WVTX15_01=W
     C                   EXSR      SRC
     C                   ENDIF

     C                   EVAL      W=UVTX15_01
     C     W5            IFNE      '000000'
     C                   EVAL      W5='000000'
     C                   EVAL      WVTX15_01=W
     C                   EXSR      SRC
     C                   ENDIF

     C                   EVAL      W=UVTX15_01
     C     W3            IFNE      '00000000'
     C                   EVAL      W3='00000000'
     C                   EVAL      WVTX15_01=W
     C                   EXSR      SRC
     C                   ENDIF

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Finnes x/y-koder ?                                   SRC /
      *////////////////////////////////////////////////////////////
     C     SRC           BEGSR
     C                   EVAL      *IN55=*OFF
     C     WVTX15_01     SETLL     SVTX15F
     C     WVTX15_01     READE     SVTX15F                                55
     C     *IN55         DOWEQ     *OFF
      * Max 9 repetitioner
     C     WTN           CABEQ     9             SRC2
      * Import / Export ?
     C                   EVAL      WVKD_IE=UVTA_IE
     C                   EVAL      WVKD_TYP='MTT'
     C                   MOVEL     SVTX15_04     WVKD_KD
     C     SVTX03K       CHAIN     SVTX03F                            57
     C     *IN57         CABEQ     *ON           SRC2
      * x/Y-kod ?
     C     SVTX15_23A    CABNE     *BLANKS       SRC0
     C     SVTX15_23B    CABNE     *BLANKS       SRC0
     C     SVTX15_23C    CABNE     *BLANKS       SRC0
     C     SVTX15_23D    CABNE     *BLANKS       SRC0
     C     SVTX15_23E    CABNE     *BLANKS       SRC0
     C     SVTX15_23F    CABNE     *BLANKS       SRC0
     C     SVTX15_23G    CABNE     *BLANKS       SRC0
     C     SVTX15_23H    CABNE     *BLANKS       SRC0
     C     SVTX15_23I    CABNE     *BLANKS       SRC0
     C                   GOTO      SRC2
     C     SRC0          TAG
      * Er landkoden riktig ?
     C     SVTX15_02     CABEQ     WULK          SRC1
      * Eller stæmmer regionen ?
     C     SVTLKKEY      CHAIN     SVTX08F2                           56
     C     *IN56         CABEQ     *OFF          SRC1
     C                   GOTO      SRC2
     C     SRC1          TAG
      * Har nå funnet x/y-koder, legg inn i array
     C     SVTX15_22A    IFNE      *BLANKS
     C     SVTX15_23A    IFNE      *BLANKS
     C                   EVAL      WVKD_KD=SVTX15_23A + SVTX15_22A
     C     WT04          LOOKUP    WT                                     58
     C     *IN58         IFEQ      *OFF
     C                   ADD       1             WTN
     C                   MOVEA     WVKD_KD       WT(WTN)
     C     WTN           CABEQ     9             SRC2
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C     SVTX15_22B    IFNE      *BLANKS
     C     SVTX15_23B    IFNE      *BLANKS
     C                   EVAL      WVKD_KD=SVTX15_23B + SVTX15_22B
     C     WT04          LOOKUP    WT                                     58
     C     *IN58         IFEQ      *OFF
     C                   ADD       1             WTN
     C                   MOVEA     WVKD_KD       WT(WTN)
     C     WTN           CABEQ     9             SRC2
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C     SVTX15_22C    IFNE      *BLANKS
     C     SVTX15_23C    IFNE      *BLANKS
     C                   EVAL      WVKD_KD=SVTX15_23C + SVTX15_22C
     C     WT04          LOOKUP    WT                                     58
     C     *IN58         IFEQ      *OFF
     C                   ADD       1             WTN
     C                   MOVEA     WVKD_KD       WT(WTN)
     C     WTN           CABEQ     9             SRC2
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C     SVTX15_22D    IFNE      *BLANKS
     C     SVTX15_23D    IFNE      *BLANKS
     C                   EVAL      WVKD_KD=SVTX15_23D + SVTX15_22D
     C     WT04          LOOKUP    WT                                     58
     C     *IN58         IFEQ      *OFF
     C                   ADD       1             WTN
     C                   MOVEA     WVKD_KD       WT(WTN)
     C     WTN           CABEQ     9             SRC2
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C     SVTX15_22E    IFNE      *BLANKS
     C     SVTX15_23E    IFNE      *BLANKS
     C                   EVAL      WVKD_KD=SVTX15_23E + SVTX15_22E
     C     WT04          LOOKUP    WT                                     58
     C     *IN58         IFEQ      *OFF
     C                   ADD       1             WTN
     C                   MOVEA     WVKD_KD       WT(WTN)
     C     WTN           CABEQ     9             SRC2
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C     SVTX15_22F    IFNE      *BLANKS
     C     SVTX15_23F    IFNE      *BLANKS
     C                   EVAL      WVKD_KD=SVTX15_23F + SVTX15_22F
     C     WT04          LOOKUP    WT                                     58
     C     *IN58         IFEQ      *OFF
     C                   ADD       1             WTN
     C                   MOVEA     WVKD_KD       WT(WTN)
     C     WTN           CABEQ     9             SRC2
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C     SVTX15_22G    IFNE      *BLANKS
     C     SVTX15_23G    IFNE      *BLANKS
     C                   EVAL      WVKD_KD=SVTX15_23G + SVTX15_22G
     C     WT04          LOOKUP    WT                                     58
     C     *IN58         IFEQ      *OFF
     C                   ADD       1             WTN
     C                   MOVEA     WVKD_KD       WT(WTN)
     C     WTN           CABEQ     9             SRC2
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C     SVTX15_22H    IFNE      *BLANKS
     C     SVTX15_23H    IFNE      *BLANKS
     C                   EVAL      WVKD_KD=SVTX15_23H + SVTX15_22H
     C     WT04          LOOKUP    WT                                     58
     C     *IN58         IFEQ      *OFF
     C                   ADD       1             WTN
     C                   MOVEA     WVKD_KD       WT(WTN)
     C     WTN           CABEQ     9             SRC2
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C     SVTX15_22I    IFNE      *BLANKS
     C     SVTX15_23I    IFNE      *BLANKS
     C                   EVAL      WVKD_KD=SVTX15_23I + SVTX15_22I
     C     WT04          LOOKUP    WT                                     58
     C     *IN58         IFEQ      *OFF
     C                   ADD       1             WTN
     C                   MOVEA     WVKD_KD       WT(WTN)
     C     WTN           CABEQ     9             SRC2
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C     SRC2          TAG
     C     WVTX15_01     READE     SVTX15F                                55
     C                   ENDDO
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Avsluta med text till koder                          SRD /
      *////////////////////////////////////////////////////////////
     C     SRD           BEGSR

     C     1             DO        9             WTN
     C                   IF        WT(WTN)=*BLANKS
     C                   MOVE      '9999'        WT(WTN)
     C                   ENDIF
     C                   ENDDO

     C                   SORTA     WT

     C     1             DO        9             WTN
     C                   IF        WT(WTN)='9999'
     C                   MOVE      '    '        WT(WTN)
     C                   ENDIF
     C                   ENDDO


     C                   EVAL      WVKD_IE='A'
     C                   EVAL      WVKD_TYP='MCF'

     C     1             DO        9             WTN

     C                   EVAL      WVKD_KD=WT(WTN)
     C     SVTX03K       CHAIN     SVTX03F                            57
     C                   IF        *IN57=*ON
     C                   EVAL      SVTX03_04=*BLANKS
     C                   ENDIF
      * Får inte vara kombination Y021 och førmån=100
     C     WVKD_KD       IFEQ      'Y021'
     C     UFOKD         ANDEQ     '100'
     C                   GOTO      SRD2
     C                   ENDIF
      * Inga X-koder før import
     C     WT01          IFEQ      'X'
     C     WVKD_KD       ANDEQ     'I'
     C                   GOTO      SRD2
     C                   ENDIF
      * Inga A-koder alls
     C     WT01          IFEQ      'A'
     C                   GOTO      SRD2
     C                   ENDIF

     C                   SELECT
     C
     C     UYKOD1        WHENEQ    *BLANKS
     C                   EVAL      UYKOD1=WVKD_KD
     C                   EVAL      UYTXT1=SVTX03_04
     C
     C     UYKOD2        WHENEQ    *BLANKS
     C                   EVAL      UYKOD2=WVKD_KD
     C                   EVAL      UYTXT2=SVTX03_04
     C
     C     UYKOD3        WHENEQ    *BLANKS
     C                   EVAL      UYKOD3=WVKD_KD
     C                   EVAL      UYTXT3=SVTX03_04
     C
     C     UYKOD4        WHENEQ    *BLANKS
     C                   EVAL      UYKOD4=WVKD_KD
     C                   EVAL      UYTXT4=SVTX03_04
     C
     C     UYKOD5        WHENEQ    *BLANKS
     C                   EVAL      UYKOD5=WVKD_KD
     C                   EVAL      UYTXT5=SVTX03_04
     C
     C     UYKOD6        WHENEQ    *BLANKS
     C                   EVAL      UYKOD6=WVKD_KD
     C                   EVAL      UYTXT6=SVTX03_04
     C
     C     UYKOD7        WHENEQ    *BLANKS
     C                   EVAL      UYKOD7=WVKD_KD
     C                   EVAL      UYTXT7=SVTX03_04
     C
     C     UYKOD8        WHENEQ    *BLANKS
     C                   EVAL      UYKOD8=WVKD_KD
     C                   EVAL      UYTXT8=SVTX03_04
     C
     C     UYKOD9        WHENEQ    *BLANKS
     C                   EVAL      UYKOD9=WVKD_KD
     C                   EVAL      UYTXT9=SVTX03_04
     C
     C                   ENDSL
     C     SRD2          TAG
     C                   ENDDO
     C                   ENDSR
