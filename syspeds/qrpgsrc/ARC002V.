********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 kunde må stemme på vedlegg av faktura/sad
10XXX * 02 SH  PTF10 kundnivå  avvik
10XXX * 03 SH  PTF10 indikatorfeil
10XXX * 04 SH  PTF10 feil ved lenke
10XXX * 05 SH  PTF11 vedlegg ved clive=' '
      *----------------------------------------------------
      *      PTF  11
      *----------------------------------------------------
10XXX * 06 SH  PTF11 sjekker at vedlegg eksisterer
10XXX * 07 SH  PTF11 NYE FELT I WORKFIILE
10XXX * 08 SH  PTF11 spesial cs  CMR SAMLE kun 1 pr kunde
10XXX * 09 SH  PTF11 MERKER POSTER MED LE kun 1 pr kunde
10XXX * 10 SH  PTF11 endring epmain
      *
      *
     H DECEDIT(',') debug(*yes)
      ***********************************************************
      *** PROGRAM for arkivering
      ***********************************************************
N02  FARKVEDK   IF   E           K DISK
     Ffirm      IF   E           K DISK
     Ffirmarc   IF   E           K DISK
     FARKEXT    IF   E           K DISK
     FARKTXT    IF   E           K DISK
     FARUSERL1  IF   E           K DISK
     FARKEPO    UF A E           K DISK
     FARKEPOL1  IF   E           K DISK
     F                                     RENAME(arkepor:arkepor1)
s08  F*RKIVL02  IF   E           K DISK
n08  FARKIVL02  UF   E           K DISK
     D                SDS
     D  UUSR                 254    263
     D                 DS
     D  uuvedl                 1     60
     D  V01                    1      2
     D  V02                    3      4
     D  V03                    5      6
     D  V04                    7      8
     D  V05                    9     10
     D  V06                   11     12
     D  V07                   13     14
     D  V08                   15     16
     D  V09                   17     18
     D  V10                   19     20
     D  V11                   21     22
     D  V12                   23     24
     D  V13                   25     26
     D  V14                   27     28
     D  V15                   29     30
     D  V16                   31     32
     D  V17                   33     34
     D  V18                   35     36
     D  V19                   37     38
     D  V20                   39     40
     D  V21                   41     42
     D  V22                   43     44
     D  V23                   45     46
     D  V24                   47     48
     D  V25                   49     50
     D  V26                   51     52
     D  V27                   53     54
     D  V28                   55     56
     D  V29                   57     58
     D  V30                   59     60
     D  ako                    1     60
     D                                     DIM(30)
      *
     c                   exsr      init
     c                   exsr      les
     c                   seton                                        lr
     c                   return
     C***********************************************
     C     init          BEGSR
     C***********************************************
     C*
     C     *ENTRY        PLIST
     c                   parm                    utype             2
     c                   parm                    uavd              4
     c                   parm                    uopd              7
     c                   parm                    uved             60
     c                   parm                    clive             1
     c                   parm                    arinek            1
n01  c                   parm                    ukunde            8 0
     c*                  dump
N02  C     KEYVED        KLIST
N02  C                   KFLD                    FIFIRM
N02  C                   KFLD                    AVKUND
N02  C                   KFLD                    AVTYPE
N02  c                   read      firm                                   37
N02  C                   MOVE      UKUNDE        AVKUND
N02  C                   MOVE      UTYPE         AVTYPE
N02  C     KEYVED        CHAIN     ARKVEDK                            33
      *
      *
N02  C     *IN(33)       IFEQ      '1'
     c                   move      uved          uuvedl
N02  C                   ELSE
N02  c                   move      AVKVED        uuvedl
N02  C                   END
     c     key           klist
     c                   kfld                    ustat             1
     c                   kfld                    aravd
     c                   kfld                    aropd
     c                   move      'A'           ustat
N07  c                   move      'N'           EPMAIN
N07  c                   move      uavd          EPAVD
N07  c                   move      uopd          EPOPD
     c                   move      uavd          aravd
     c                   move      uopd          aropd
     c     key2          klist
     c                   kfld                    epuser
     c                   kfld                    eplink
     C*
     c     key3          klist
     c                   kfld                    epuser
     c                   kfld                    epbane
     C*
     C     arklagk       KLIST
     C                   KFLD                    fifirm
     C                   KFLD                    arklag
     C*
S02  c*                  read      firm                                   37
     c                   move      uusr          epuser
     c                   endsr
     C***********************************************
     C     les           BEGSR
     C***********************************************
N03  c                   setoff                                       33
     c     key           setll     arkivl02
     c     *in(33)       doweq     '0'
N08  c     lesny         tag
     c     key           reade     arkivl02                               33
     c     *in(33)       ifeq      '0'
N08  c     artype        ifeq      'cs'
N08  c     arfri         andne     'NY'
N08  c                   update    arkivr
N08  c                   goto      lesny
N08  c                   else
N08  c                   move      *blanks       arfri
N08  c                   update    arkivr
N08  c                   end
      * ikke skrive egen dokumenttype
     c     artype        ifne      utype
     c     utype         ifeq      'fs'
     c     artype        andne     'fx'
     c                   exsr      test
     c                   else
     c                   exsr      test
     c                   end
     c                   end
     c                   end
     c                   end
     c                   endsr
     C***********************************************
     C     test          BEGSR
     C***********************************************
n01   * ved faktura og sad må kundenr stemme og ved cs=CMRSAMLE
      *
n01  C     artype        ifeq      'fa'
n01  c     artype        oreq      'fs'
n01  c     artype        oreq      'fx'
n01  c     artype        oreq      'si'
n01  c     artype        oreq      'se'
n01  c     artype        oreq      'sf'
n01  c     artype        oreq      'sg'
n01  c     artype        oreq      'si'
n01  c     artype        oreq      'sj'
n01  c     artype        oreq      'sk'
n06  c     artype        oreq      'cs'
n01  c     ukunde        ifne      arkund
n01  c                   goto      avbryt
n01  c                   end
n01  c                   end
     c                   sorta     ako
     c                   setoff                                       30
     C     artype        LOOKUP    ako                                    30
     C  N30              DO
     C     ARTYPE        IFEQ      'sk'
     C     'si'          lookup    ako                                    30
     C                   end
     C     ARTYPE        IFEQ      'sg'
     C     'se'          lookup    ako                                    30
     C                   end
     C                   end
      *
     c     *in(30)       ifeq      '1'
      * finner bane
     c     artype        chain     ARKTXT                             35
      *
      * intern eksternlager
      *
     C     ARKLAG        IFNE      *blanks
     c     arklagk       chain     arkext
     c                   else
     c     fifirm        chain     firmarc                            35
     c                   end
      *
     c                   move      *blanks       ubane            50
     c                   move      *blanks       ubanel           76
      *
      * ved vedlegg
      *
     c     clive         ifeq      'V'
n05  c     clive         oreq      ' '
     c                   exsr      vedlegg
     c                   else
     c                   exsr      link
     c                   end
     c                   end
s01  c*                  endsr
n01  c     avbryt        endsr
     C***********************************************
     C     vedlegg       BEGSR
     C***********************************************
     c                   move      *blanks       ubane
     c                   movel     '/'           ubane
     c     arcane        ifne      *blanks
     C     ubane         CAT       arcane:0      ubane
     C     ubane         CAT       '/':0         ubane
     c                   end
     C     ubane         CAT       arlink:0      ubane
     C     ARKLAG        IFeq      *blanks
     c
     C     '.'           SCAN      ubane                                  44
     c  N44ubane         CAT       '.pdf':0      ubane
     c                   end
     c                   eval      epbane=ubane
      * ikke finnes fra før
     c     key3          chain     arkepol1                           31
     c     *in(31)       ifeq      '1'
      * tester om vedlegg finnes
n06  C                   move      *blanks       nyobj            50
n06  C                   move      *blanks       ubanet          256
n06  c                   eval      ubanet=ubane
n06  C                   eval      nyobj=arlink
n06  C     '.'           SCAN      nyobj                                  44
n06  c  N44nyobj         CAT       '.pdf':0      nyobj
N06  c                   call      'SYGE98CL'
N06  C                   PARM                    ubanet
N06  C                   PARM                    nyobj
N06  c                   parm                    fins              1
N06  c     fins          ifeq      'J'
n10  c                   move      'N'           epmain
N08  c     artype        ifeq      'cs'
N08  c                   move      'J'           epmain
N08  c                   end
     c                   write     arkepor
s10  c*                  move      'N'           epmain
n06  c                   end
     c                   end
      *
     c                   endsr
      *
     C***********************************************
     C     link          BEGSR
     C***********************************************
      *
      * intern
      *
     c                   move      *blanks       ubanel
     c     arinek        ifeq      'I'
     c     arinek        oreq      ' '
     c                   movel     'http://'     ubanel
     C     ubanel        CAT       arcpad:0      ubanel
     C     ubanel        CAT       '/':0         ubanel
     C     ubanel        CAT       arcane:0      ubanel
     C     ubanel        CAT       '/':0         ubanel
      *
      * ekstern
      *
     c                   else
     C                   move      *blanks       ubanel           76
     c                   movel     'http://'     ubanel
     C     ubanel        CAT       arcpae:0      ubanel
     C     ubanel        CAT       '/':0         ubanel
     C     ubanel        CAT       arcane:0      ubanel
     C     ubanel        CAT       '/':0         ubanel
      *
     c                   end
      *
      *
     C     ubanel        CAT       arlink:0      ubanel
     C     ARKLAG        IFeq      *blanks
N04  C     '.'           SCAN      ubanel                                 44
s04  C*    ubanel        CAT       '.pdf':0      ubanel
n04  C  N44ubanel        CAT       '.pdf':0      ubanel
     c                   end
     c                   movel     ubanel        eplink
     c                   movel     ubanel        epline
      * ikke finnes fra før
     c     key2          chain     arkepo                             31
     c     *in(31)       ifeq      '1'
n10  c                   move      'N'           epmain
N08  c     artype        ifeq      'cs'
N08  c                   move      'J'           epmain
N08  c                   end
N09  C     '.pdf'        SCAN      arlink                                 55
N09  C  N55'.PDF'        SCAN      arlink                                 55
N09  C  N55              MOVE      'Z'           epmain
     c                   write     arkepor
s10  c*                  move      'N'           epmain
     c                   end
     c                   endsr
