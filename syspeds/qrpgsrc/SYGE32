      ***************************************************************
      *** PROGRAM SKAL beregne flyfraktpris
      ***********************************************************
     FKODTFFR   IF   E           K DISK
      *
      *
     c     *ENTRY        plist
     c                   parm                    upt               1
     c                   parm                    ufly              3 0
     c                   parm                    ukunde            8 0
     c                   parm                    ufra              5
     c                   parm                    util              5
     c                   parm                    ukode             1
     c                   parm                    uvekt             5 0
     c                   parm                    UBELOP           13 2
     C                   PARM                    UVAL              3
      *
     C     KUAVKE0       KLIST
     C                   KFLD                    kunde             8 0
     C                   KFLD                    pt                1
     C                   KFLD                    fly               3 0
     C                   KFLD                    fra               5
     C                   KFLD                    til               5
     C                   KFLD                    kode              1
      *
     C     KUAVKE        KLIST
     C                   KFLD                    kunde             8 0
     C                   KFLD                    pt                1
     C                   KFLD                    fly               3 0
     C                   KFLD                    fra               5
     C                   KFLD                    til               5
     C                   KFLD                    kode              1
     C                   KFLD                    vekt              5 0
     C     KEYMIN        KLIST
     C                   KFLD                    kunde             8 0
     C                   KFLD                    pt                1
     C                   KFLD                    fly               3 0
     C                   KFLD                    fra               5
     C                   KFLD                    til               5
     C                   KFLD                    kode              1
     C                   KFLD                    vekt0             5 0
     c                   move      *zeros        vekt0
     C                   move      upt           pt
     C                   move      ufly          fly
     C                   move      ukunde        kunde
     C                   move      ufra          fra
     C                   move      util          til
     C                   move      ukode         kode
     C                   move      uvekt         vekt
     C                   move      *BLANKS       UVAL
      *
     c                   exsr      tstku
     c                   seton                                        lr
     c                   return
      ***********************************************
     C     TSTKU         BEGSR
      ***********************************************
      * TEST IF CUSTOMER HAVE SPESIAL AGREEMENT
      *
      * FINNES PÅ AKTUELL FLYSELSKAP
      *
     C     KUAVKE0       CHAIN     KODTFFR                            86
     C   86              MOVE      *ZEROS        FLY
     C   86KUAVKE0       CHAIN     KODTFFR                            86
      * PRØVER EVT PÅ PRODUKTKODE ' '
     C   86PT            IFNE      *BLANKS
     C                   MOVE      *BLANKS       PT
     C                   move      ufly          fly
     C     KUAVKE0       CHAIN     KODTFFR                            86
     C   86              MOVE      *ZEROS        FLY
     C   86KUAVKE0       CHAIN     KODTFFR                            86
     C                   END
      *
     C   86              GOTO      UTSR
      *
     C     KUAVKE        SETLL     KODTFFR
     C                   READ      KODTFFR                                87
     C  N87UKUNDE        IFEQ      KFFKN
     C     UFRA          ANDEQ     KFFSDF
     C     UTIL          ANDEQ     KFFSDT
     C     UKODE         ANDEQ     KFFKD
      * FAST PRINT
     C     KFFBL2        IFEQ      0
     C                   Z-ADD     KFFBL         UBELOP
     C                   MOVE      KFFVAL        UVAL
     C                   MOVE      'J'           FINNPRI
     C                   EXSR      TSTKU2
     C                   EXSR      TSTMI
     C                   ELSE
      * KILOPRIS
     C     UVEKT         MULT      KFFBL         UBELOP
     C                   MOVE      KFFVAL        UVAL
     C                   EXSR      TSTKU2
     C                   EXSR      TSTMI
     C                   END
     C                   END
     C     UTSR          ENDSR
      ***********************************************
     C     TSTKU2        BEGSR
      ***********************************************
     C                   MOVE      'J'           FINNPRI           1
      * TEST IF LOWER PRICE IN NEXT RATECLASS
      *
     C     KFFTVK        ADD       1             KFFTV2            5 0
     C                   READ      KODTFFR                                87
     C  N87UKUNDE        IFEQ      KFFKN
     C     PT            andeq     kffpt
     C     UFRA          ANDEQ     KFFSDF
     C     UTIL          ANDEQ     KFFSDT
     C     UKODE         ANDEQ     KFFKD
      * NYPRIS NESTE VEKTGRUPPE
     C     KFFBL         MULT      KFFTV2        PRICE2           13 2
     C     PRICE2        IFLT      UBELOP
     C                   Z-ADD     PRICE2        UBELOP
     C                   MOVE      'J'           FINNPRI
     C                   END
     C                   END
     C                   ENDSR
      ***********************************************
     C     TSTMI         BEGSR
      ***********************************************
     C     keymin        chain     kodtffr                            44
     C  N44kffbl         ifgt      UBELOP
     C                   z-add     kffbl         ubelop
     c                   end
     c                   endsr
