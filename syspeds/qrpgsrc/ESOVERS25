      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/ESOVERS25 MODULE(*LIBL/ESOVERS25 *LIBL/INCGI)
CRTPGM*        ACTGRP(CGI) AUT(*USE)
      *
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
     FBRIDF     IF   E           K DISK    USROPN
     FBRPARF    IF   E           K DISK    USROPN
     FTURER14   UF   E           K DISK    USROPN
     FHEAD14    IF   E           K DISK    USROPN
     FBILLOF    IF   E           K DISK    USROPN
     FBILLOFTU  UF A E           K DISK    USROPN
     FSTED2     IF   E           K DISK    USROPN
      *--------------------------------------------------------------------
      * Prototype defintions and standard system API error structure
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      *--------------------------------------------------------------------
      * Variables common to CGI programs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
      * Variables received from the input string
     D WSUSER          S             10
     D UsrSpcName      s             10
     D WSPRO           S              8
     D WSBLFORM        S              1
     D WSBLNR          S             17
     D WSNTBS          S             10
     D WSVESSEL        S             30
     D WSLAS           S             30
     D WSLASH          S             30
     D WSLOS           S             30
     D WSLOSH          S             30
     D WSNAA           S             30
     D WSAD1A          S             30
     D WSAD2A          S             30
     D WSAD3A          S             30
     D WSNAM           S             30
     D WSAD1M          S             30
     D WSAD2M          S             30
     D WSAD3M          S             30
     D WSNAN           S             30
     D WSAD1N          S             30
     D WSAD2N          S             30
     D WSAD3N          S             30
     D WSREFS          S             20
     D WSFD1           S             40
     D WSFD2           S             40
     D WSFD3           S             40
     D WSPLC           S             25
     D WSPDT           S             15
     D WSTXT1          S            100
     D WSTXT2          S            100
     D WSTXT3          S            100
     D WSTXT4          S            100
     D WSSIDE2         S              1
     D IFSFIL          S             50
     D Dialog          S              1
      * Number of records matching search criteria
      *
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
      *
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
      * For xlate mellom Upper Case og Lower Case
     D UC              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZÆØÅ')
     D LC              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzæøå')
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================******
      * MAIN PROCESS LINE
      *=====================================================================******
      * Parse input
     C                   exsr      Parse
      *
     C                   EXSR      INIT
      **
      ** Ved behov for dialog FØR spool kjøres legges den her...
     C     Dialog        IFeq      'J'
     C                   OPEN      TURER14
     C                   OPEN      HEAD14
     C                   OPEN      BILLOF
     C                   OPEN      BILLOFTU
     C                   OPEN      STED2
     C     TUPRO         CHAIN(N)  TURER14                            33
     C     TUPRO         CHAIN(N)  BILLOFTU                           33
     C                   IF        *IN33
     C     TUPRO         CHAIN     HEAD14                             33
     C     BILLOFK       CHAIN     BILLOF                             33
     C                   EVAL      TUSONF   = BLLSS
     C                   EVAL      TUSONT   = BLLOS
     C                   EVAL      BLKDP    = 'CDBLD'
     C                   END
     C*                  EVAL      WSBLFORM = BLKDP
     C                   SELECT
     C                   WHEN      BLKDP = 'CCBLC'
     C                   EVAL      WSBLFORM = 'C'
     C                   WHEN      BLKDP = 'CCBLD'
     C                   EVAL      WSBLFORM = 'D'
     C                   WHEN      BLKDP = 'CCBLO'
     C                   EVAL      WSBLFORM = 'O'
     C                   OTHER
     C                   EVAL      WSBLFORM = 'D'
     C                   ENDSL
     C                   EVAL      WSNTBS   = BLNTBS
     C                   EVAL      WSBLNR   = TUBLNR
     C                   EVAL      WSVESSEL = TUBNV
     C                   EVAL      WSNAA    = BLNAA
     C                   EVAL      WSAD1A   = BLAD1A
     C                   EVAL      WSAD2A   = BLAD2A
     C                   EVAL      WSAD3A   = BLAD3A
     C                   EVAL      WSNAM    = BLNAM
     C                   EVAL      WSAD1M   = BLAD1M
     C                   EVAL      WSAD2M   = BLAD2M
     C                   EVAL      WSAD3M   = BLAD3M
     C                   IF        BLNAN = *BLANKS
     C                   EVAL      WSNAN    = BLNAM
     C                   EVAL      WSAD1N   = BLAD1M
     C                   EVAL      WSAD2N   = BLAD2M
     C                   EVAL      WSAD3N   = BLAD3M
     C                   ELSE
     C                   EVAL      WSNAN    = BLNAN
     C                   EVAL      WSAD1N   = BLAD1N
     C                   EVAL      WSAD2N   = BLAD2N
     C                   EVAL      WSAD3N   = BLAD3N
     C                   END
     C                   EVAL      WSREFS   = BLREFS
      *
     C                   IF        BLFD1 = *BLANKS
     C                   EVAL      WSFD1   = HEFR
     C                   ELSE
     C                   EVAL      WSFD1   = BLFD1
     C                   END
     C                   EVAL      WSFD2   = BLFD2
     C                   EVAL      WSFD3   = BLFD3
      *
     C                   IF        TULASH = *BLANKS
     C     TUSTEF        CHAIN     STED2                              33
     C  N33              EVAL      WSLASH = ST2NVN
     C   33              EVAL      WSLASH = TUSTEF
     C                   ELSE
     C                   EVAL      WSLASH = TULASH
     C                   END
     C                   IF        TULAS = *BLANKS
     C     TUSONF        CHAIN     STED2                              33
     C  N33              EVAL      WSLAS = ST2NVN
     C   33              EVAL      WSLAS = TUSONF
     C                   ELSE
     C                   EVAL      WSLAS = TULAS
     C                   END
     C                   IF        TULOSH = *BLANKS
     C     TUSTET        CHAIN     STED2                              33
     C  N33              EVAL      WSLOSH = ST2NVN
     C   33              EVAL      WSLOSH = TUSTET
     C                   ELSE
     C                   EVAL      WSLOSH = TULOSH
     C                   END
     C                   IF        TULOS = *BLANKS
     C     TUSONT        CHAIN     STED2                              33
     C  N33              EVAL      WSLOS = ST2NVN
     C   33              EVAL      WSLOS = TUSONT
     C                   ELSE
     C                   EVAL      WSLOS = TULOS
     C                   END
      *
     C                   IF        BLPLC = *BLANKS
     C     TUSTET        CHAIN     STED2                              33
     C  N33              EVAL      WSPLC = ST2NVN
     C   33              EVAL      WSPLC = TUSTET
     C                   ELSE
     C                   EVAL      WSPLC = BLPLC
     C                   END
     C                   IF        BLPDT = *BLANKS
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   EVAL      WSPDT = %SUBST(WDT:7:2)
     C                   SELECT
     C                   WHEN      %SUBST(WDT:5:2) = '01'
     C                   EVAL      WSPDT = %TRIM(WSPDT) + '. JANUARY'
     C                   WHEN      %SUBST(WDT:5:2) = '02'
     C                   EVAL      WSPDT = %TRIM(WSPDT) + '. FEBRUARY'
     C                   WHEN      %SUBST(WDT:5:2) = '03'
     C                   EVAL      WSPDT = %TRIM(WSPDT) + '. MARCH'
     C                   WHEN      %SUBST(WDT:5:2) = '04'
     C                   EVAL      WSPDT = %TRIM(WSPDT) + '. APRIL'
     C                   WHEN      %SUBST(WDT:5:2) = '05'
     C                   EVAL      WSPDT = %TRIM(WSPDT) + '. MAY'
     C                   WHEN      %SUBST(WDT:5:2) = '06'
     C                   EVAL      WSPDT = %TRIM(WSPDT) + '. JUNE'
     C                   WHEN      %SUBST(WDT:5:2) = '07'
     C                   EVAL      WSPDT = %TRIM(WSPDT) + '. JULY'
     C                   WHEN      %SUBST(WDT:5:2) = '08'
     C                   EVAL      WSPDT = %TRIM(WSPDT) + '. AUGUST'
     C                   WHEN      %SUBST(WDT:5:2) = '09'
     C                   EVAL      WSPDT = %TRIM(WSPDT) + '. SEPTEMBER'
     C                   WHEN      %SUBST(WDT:5:2) = '10'
     C                   EVAL      WSPDT = %TRIM(WSPDT) + '. OCTOBER'
     C                   WHEN      %SUBST(WDT:5:2) = '11'
     C                   EVAL      WSPDT = %TRIM(WSPDT) + '. NOVEMBER'
     C                   WHEN      %SUBST(WDT:5:2) = '12'
     C                   EVAL      WSPDT = %TRIM(WSPDT) + '. DESEMBER'
     C                   ENDSL
     C                   EVAL      WSPDT = %TRIM(WSPDT) + ' ' + %SUBST(WDT:1:4)
     C                   ELSE
     C                   EVAL      WSPDT = BLPDT
     C                   END
      *
     C                   EVAL      WSTXT1 = BLTXT1
     C                   EVAL      WSTXT2 = BLTXT2
     C                   EVAL      WSTXT3 = BLTXT3
     C                   EVAL      WSTXT4 = BLTXT4
      *
     C                   close     TURER14
     C                   close     HEAD14
     C                   close     BILLOF
     C                   close     BILLOFTU
     C                   close     STED2
     C                   exsr      SetSklSpool1
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
     C                   callp     updhtmlvar('USER':WSUSER)
     C                   callp     updhtmlvar('UsrSpcName':UsrSpcName)
     C                   callp     updhtmlvar('WSPRO':WSPRO)
     C                   callp     updhtmlvar('WSBLFORM':WSBLFORM)
     C                   callp     updhtmlvar('WSBLNR':WSBLNR)
     C                   callp     updhtmlvar('WSNTBS':WSNTBS)
     C                   callp     updhtmlvar('WSVESSEL':WSVESSEL)
     C                   callp     updhtmlvar('WSLAS':WSLAS)
     C                   callp     updhtmlvar('WSLASH':WSLASH)
     C                   callp     updhtmlvar('WSLOS':WSLOS)
     C                   callp     updhtmlvar('WSLOSH':WSLOSH)
     C                   callp     updhtmlvar('WSNAA':WSNAA)
     C                   callp     updhtmlvar('WSAD1A':WSAD1A)
     C                   callp     updhtmlvar('WSAD2A':WSAD2A)
     C                   callp     updhtmlvar('WSAD3A':WSAD3A)
     C                   callp     updhtmlvar('WSNAM':WSNAM)
     C                   callp     updhtmlvar('WSAD1M':WSAD1M)
     C                   callp     updhtmlvar('WSAD2M':WSAD2M)
     C                   callp     updhtmlvar('WSAD3M':WSAD3M)
     C                   callp     updhtmlvar('WSNAN':WSNAN)
     C                   callp     updhtmlvar('WSAD1N':WSAD1N)
     C                   callp     updhtmlvar('WSAD2N':WSAD2N)
     C                   callp     updhtmlvar('WSAD3N':WSAD3N)
     C                   callp     updhtmlvar('WSREFS':WSREFS)
     C                   callp     updhtmlvar('WSFD1':WSFD1)
     C                   callp     updhtmlvar('WSFD2':WSFD2)
     C                   callp     updhtmlvar('WSFD3':WSFD3)
     C                   callp     updhtmlvar('WSPLC':WSPLC)
     C                   callp     updhtmlvar('WSPDT':WSPDT)
     C                   callp     updhtmlvar('WSTXT1':WSTXT1)
     C                   callp     updhtmlvar('WSTXT2':WSTXT2)
     C                   callp     updhtmlvar('WSTXT3':WSTXT3)
     C                   callp     updhtmlvar('WSTXT4':WSTXT4)
     C                   callp     wrtsection('top')
     C                   callp     wrtsection('endhtml')
     C                   else
     C                   OPEN      TURER14
     C                   OPEN      BILLOFTU
     C     TUPRO         CHAIN     TURER14                            33
     C                   IF        *IN33 = *OFF
     C                   IF        WSSIDE2 <> 'J'
     C                   EVAL      TUBLNR = WSBLNR
     C                   EVAL      TUBNV  = WSVESSEL
      *
     C     TUPRO         CHAIN     BILLOFTU                           33
     C                   EVAL      BLPRO  = TUPRO
     C                   SELECT
     C                   WHEN      WSBLFORM = 'D'
     C                   EVAL      BLKDP = 'CCBLD'
     C                   WHEN      WSBLFORM = 'C'
     C                   EVAL      BLKDP = 'CCBLC'
     C                   WHEN      WSBLFORM = 'O'
     C                   EVAL      BLKDP = 'CCBLO'
     C                   OTHER
     C                   EVAL      BLKDP = 'CCBLD'
     C                   ENDSL
     C*                  EVAL      BLKDP = 'CCBLB'
     C                   EVAL      BLREFS = WSREFS
     C                   EVAL      BLNTBS = WSNTBS
     C                   EVAL      TULAS  = WSLAS
     C                   EVAL      TULASH = WSLASH
     C                   EVAL      TULOS  = WSLOS
     C                   EVAL      TULOSH = WSLOSH
     C                   EVAL      BLNAA  = WSNAA
     C                   EVAL      BLAD1A = WSAD1A
     C                   EVAL      BLAD2A = WSAD2A
     C                   EVAL      BLAD3A = WSAD3A
     C                   EVAL      BLNAM  = WSNAM
     C                   EVAL      BLAD1M = WSAD1M
     C                   EVAL      BLAD2M = WSAD2M
     C                   EVAL      BLAD3M = WSAD3M
     C                   EVAL      BLNAN  = WSNAN
     C                   EVAL      BLAD1N = WSAD1N
     C                   EVAL      BLAD2N = WSAD2N
     C                   EVAL      BLAD3N = WSAD3N
     C                   EVAL      BLAD3G = WSREFS
     C                   EVAL      BLFD1  = WSFD1
     C                   EVAL      BLFD2  = WSFD2
     C                   EVAL      BLFD3  = WSFD3
     C                   EVAL      BLPLC  = WSPLC
     C                   EVAL      BLPDT  = WSPDT
     C                   EVAL      BLTXT1 = WSTXT1
     C                   EVAL      BLTXT2 = WSTXT2
     C                   EVAL      BLTXT3 = WSTXT3
     C                   EVAL      BLTXT4 = WSTXT4
     C  N33              UPDATE    BLTURR
     C   33              WRITE     BLTURR
      *
     C                   END
      *
     C                   UPDATE    TURERR
     C                   END
      *
     C                   close     TURER14
     C                   close     BILLOFTU
      *  Kall prog for å generere html-fil eller PDF-fil i IFS.
     C                   MOVE      TUPRO         WSPRO
     C                   SELECT
     C                   WHEN      WSBLFORM = 'C'
     C                   EVAL      XOVL = 'CCBLC'
     C                   WHEN      WSBLFORM = 'D'
     C                   EVAL      XOVL = 'CCBLD'
     C                   WHEN      WSBLFORM = 'O'
     C                   EVAL      XOVL = 'CCBLO'
     C                   OTHER
     C                   EVAL      XOVL = 'CCBLD'
     C                   ENDSL
     c                   IF        XOVERLAY = 'V'
     C                   SELECT
     C                   WHEN      WSBLFORM = 'C'
     C                   EVAL      XOVL = 'CCBBC'
     C                   WHEN      WSBLFORM = 'D'
     C                   EVAL      XOVL = 'CCBBD'
     C                   WHEN      WSBLFORM = 'O'
     C                   EVAL      XOVL = 'CCBBO'
     C                   OTHER
     C                   EVAL      XOVL = 'CCBBO'
     C                   ENDSL
     c                   eval      XOVERLAY='J'
     c                   ENDIF
     C                   EVAL      IFSFil = *BLANKS
     C                   call      'SYSJ21C'
     C                   parm                    WSPRO
     C                   parm                    WSSIDE2
     C                   parm                    XOVERLAY
     C                   parm                    XOVL              5
     C                   parm                    BIFIRM
     C                   PARM                    IFSFIL
      * Set output skeleton html member name
      *-dummy html for å få kjørt prog                                      ******
      * "bytter ut seg selv" med Html-fil i IFS umiddelbart                 ******
     C                   IF        IFSFIL = *BLANKS
     C                   exsr      SetSklSpool2
     C                   ELSE
     C                   exsr      SetSklSpool
     C                   END
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
     C                   callp     updhtmlvar('IFSFIL':IFSFIL)
     C                   callp     wrtsection('top')
     C                   end
      *------------------                                                   ******
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      *
     C                   close     BRIDF
     C                   close     BRPARF
     C                   eval      *inlr = *on
     C                   return
      *
      *=====================================================================******
      * Parse input
      *=====================================================================******
     C     Parse         begsr
     C                   EVAL      WSUSER  = zhbgetvar('USER')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   EVAL      WSPRO   = zhbgetvar('WSPRO')
     C                   EVAL      TUPRO   = c2n2(WSPRO)
     C                   EVAL      WSBLFORM= zhbgetvar('WSBLFORM')
     C     LC:UC         XLATE     WSBLFORM      WSBLFORM
     C                   EVAL      WSBLNR  = zhbgetvar('WSBLNR')
     C                   EVAL      WSNTBS  = zhbgetvar('WSNTBS')
     C                   EVAL      WSVESSEL= zhbgetvar('WSVESSEL')
     C                   EVAL      WSLAS   = zhbgetvar('WSLAS')
     C                   EVAL      WSLASH  = zhbgetvar('WSLASH')
     C                   EVAL      WSLOS   = zhbgetvar('WSLOS')
     C                   EVAL      WSLOSH  = zhbgetvar('WSLOSH')
     C                   EVAL      WSNAA   = zhbgetvar('WSNAA')
     C                   EVAL      WSAD1A  = zhbgetvar('WSAD1A')
     C                   EVAL      WSAD2A  = zhbgetvar('WSAD2A')
     C                   EVAL      WSAD3A  = zhbgetvar('WSAD3A')
     C                   EVAL      WSNAM   = zhbgetvar('WSNAM')
     C                   EVAL      WSAD1M  = zhbgetvar('WSAD1M')
     C                   EVAL      WSAD2M  = zhbgetvar('WSAD2M')
     C                   EVAL      WSAD3M  = zhbgetvar('WSAD3M')
     C                   EVAL      WSNAN   = zhbgetvar('WSNAN')
     C                   EVAL      WSAD1N  = zhbgetvar('WSAD1N')
     C                   EVAL      WSAD2N  = zhbgetvar('WSAD2N')
     C                   EVAL      WSAD3N  = zhbgetvar('WSAD3N')
     C                   EVAL      WSREFS  = zhbgetvar('WSREFS')
     C                   EVAL      WSFD1   = zhbgetvar('WSFD1')
     C                   EVAL      WSFD2   = zhbgetvar('WSFD2')
     C                   EVAL      WSFD3   = zhbgetvar('WSFD3')
     C                   EVAL      WSPLC   = zhbgetvar('WSPLC')
     C                   EVAL      WSPDT   = zhbgetvar('WSPDT')
     C                   EVAL      WSTXT1  = zhbgetvar('WSTXT1')
     C                   EVAL      WSTXT2  = zhbgetvar('WSTXT2')
     C                   EVAL      WSTXT3  = zhbgetvar('WSTXT3')
     C                   EVAL      WSTXT4  = zhbgetvar('WSTXT4')
     C                   EVAL      WSSIDE2 = zhbgetvar('WSSIDE2')
     C                   eval      Dialog  = zhbgetvar('Dialog')
      *
      *
     C                   endsr
      *=====================================================================******
      * Set html output skeleton member before its read into memory
      *=====================================================================******
     C     SetSklSpool   begsr
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC'
     C                   eval      Mbr = 'SPLHTMALL'
     C                   endsr
      *=====================================================================******
      * Set html output skeleton member before its read into memory
      *=====================================================================******
     C     SetSklSpool1  begsr
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC'
     C                   eval      Mbr = 'ESOVERS25A'
     C                   endsr
      *=====================================================================******
      * Set html output skeleton member before its read into memory
      *=====================================================================******
     C     SetSklSpool2  begsr
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC'
     C                   eval      Mbr = 'ESOVERS25'
     C                   endsr
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   OPEN      BRIDF
     C     WSUSER        CHAIN     BRIDF                              50
      * En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   CALLB     'INCGI'
     C                   PARM                    BISTDL
     C                   else
      * Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
     C                   OPEN      BRPARF
      *
     C     BRPARFK       klist
     C                   kfld                    BIBRID
     C                   kfld                    PAKUNR
     c                   kfld                    PAID
     C     BILLOFK       KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
      *
     c                   Eval      PAKUNR = 0
     c                   Eval      PAID   = 'OSOVL'
     C     BRPARFK       Chain     BRPARF                             33
     C                   SELECT
     C                   WHEN      *IN33
     C                   MOVE      'N'           XOVERLAY          1
     C                   WHEN      PAVRDA = 'J' OR PAVRDA = 'j'
     C                   MOVE      'J'           XOVERLAY
     C                   WHEN      PAVRDA = 'V' OR PAVRDA = 'v'                 Kun Vannmerke
     C                   MOVE      'V'           XOVERLAY
     C                   OTHER
     C                   MOVE      'N'           XOVERLAY
     C                   ENDSL
      *
     C                   endsr
      *
