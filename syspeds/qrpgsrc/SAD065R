CCNO  * Spesial
     FSVEH      IF A E           K DISK
     FSVEF      IF A E           K DISK
     FSVEV      IF A E           K DISK
     FFRISOK    IF A E           K DISK
     FTARIEU1   IF A E           K DISK
     FZADF      O  A E             DISK
     F                                     RENAME(SADFR:ZADFR)
     FZADV      IF A E             DISK
     FZTELL     UF   E           K DISK
     FFIRM      IF   E           K DISK
     FSADF      O  A E             DISK
     FKODTVAL2  IF   E           K DISK
     D                 DS
     D  FSSOK                  1     35
     D  FSSOK1                 1      5
     D  FSSOK2                 7     10
     D  FSSOK3                12     18
     D                 DS
     D  SVEV_VATA              1      8
     D  SVEV_VAT6              1      6
     ISADVR
     I              SVEH                        SSVEH
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C  N51              EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    UVEH_SYAV
     C                   PARM                    UVEH_SYOP
     C                   PARM                    UFIND             1
     C                   PARM                    USSLAA            1
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    SVEH_SYAV     UVEH_SYAV
     C     *LIKE         DEFINE    SVEH_SYAV     WVEH_SYAV
     C     *LIKE         DEFINE    SVEH_SYOP     UVEH_SYOP
     C     *LIKE         DEFINE    SVEH_SYOP     WVEH_SYOP
     C     *LIKE         DEFINE    FSKODE        WFSKODE
     C     *LIKE         DEFINE    SFUNIK        WSFUNIK
     C     *LIKE         DEFINE    SFREFF        WSFREFF
     C                   EVAL      WVEH_SYAV=UVEH_SYAV
     C                   EVAL      WVEH_SYOP=UVEH_SYOP
     C                   EVAL      WFSKODE='CCU'
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     SVEHKEY       KLIST
     C                   KFLD                    WVEH_SYAV
     C                   KFLD                    WVEH_SYOP
     C     FRIKEY        KLIST
     C                   KFLD                    WVEH_SYAV
     C                   KFLD                    WVEH_SYOP
     C                   KFLD                    WFSKODE
     C     KODVAK        KLIST
     C                   KFLD                    SFVK28
     C                   KFLD                    UDT               8 0
      *_________________________________
      * Hæmta dagens datum och klockslag
      *"""""""""""""""""""""""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           UDT
      *_______________________
      * Hent firmaopplysninger
      *"""""""""""""""""""""""
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   51
     C     *IN51         CABEQ     *ON           ENDINI
      *_________________
      * Hent unik teller
      *"""""""""""""""""
     C     FIFIRM        CHAIN     ZTELL                              51
     C     *IN51         CABEQ     *ON           ENDINI
     C                   Z-ADD     ZUNIK         WSFUNIK
     C                   ADD       1             ZUNIK
     C                   UPDATE    ZTELLR
      *__________________________
      * Hent fra annen database ?
      *""""""""""""""""""""""""""
     C     FRIKEY        CHAIN     FRISOK                             51
CCNO C     *IN51         CABEQ     *ON           ENDINI
     C                   IF        *IN51=*OFF
     C                   EVAL      *IN51=*ON
     C     FSSOK1        CABNE     'CC_SE'       ENDINI
     C     FSSOK2        CABLT     '0000'        ENDINI
     C     FSSOK2        CABGT     '9999'        ENDINI
     C     FSSOK3        CABLT     '0000000'     ENDINI
     C     FSSOK3        CABGT     '9999999'     ENDINI
     C                   MOVE      FSSOK2        WVEH_SYAV
     C                   MOVE      FSSOK3        WVEH_SYOP
     C                   EVAL      *IN51=*OFF
     C                   ENDIF
CCNO C     *IN51         CABEQ     *ON           ENDINI
      *____________________
      * Finnes TDS export ?
      *""""""""""""""""""""
     C     SVEHKEY       CHAIN     SVEH                               51
      *____________
      * Dummy chain
      *""""""""""""
     C                   READ      ZADV
     C     ENDINI        ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
     C                   MOVEL     SVEH_FATX     WSFREFF
      * Fakturar Z-fil
     C                   CLEAR                   ZADFR
     C                   MOVE      UVEH_SYAV     SFAVD
     C                   MOVE      UVEH_SYOP     SFOPDN
     C                   MOVEL     WSFREFF       SFTXT
     C                   EVAL      SFDT=SVEH_SYDT
     C                   EVAL      SFBL28=SVEH_FABL
     C                   EVAL      SFVK28=SVEH_VAKD
     C                   IF        SFVK28='EUC'
     C                   EVAL      SFVK28='EUR'
     C                   ENDIF
     C                   EVAL      SFUNIK=WSFUNIK
     C                   EVAL      SFREFF=WSFREFF
     C     KODVAK        SETGT     KODTVAL2
     C     SFVK28        READPE    KODTVAL2                               54
     C                   EVAL      SFKR28=KVAKRS
     C                   EVAL      SFOM28=KVAOMR
     C                   WRITE     ZADFR
      * Fakturar produksjonsfil hoved
     C                   WRITE     SADFR
      * Varuposter
     C     SVEHKEY       SETLL     SVEV
     C     SVEHKEY       READE     SVEV                                   53
     C     *IN53         DOWEQ     *OFF
     C                   CLEAR                   SADVR

      * De 6 första tecknen är lika i EU
     C                   MOVEL     SVEV_VAT6     SVVNT
      * Finne x-ref ?
     C     SVEV_VATA     CHAIN     TARIEU1                            54
     C     *IN54         IFEQ      *OFF
     C     TARIEUI       ANDNE     *BLANKS
     C                   MOVE      TARIEUN       SVVNT
     C                   ENDIF

     C                   EVAL      SVLI=SVEV_SYLI
     C                   EVAL      SVLK=SVEV_ULKD
     C*                  EVAL      SVTN=
     C                   EVAL      SVPRE='J'
     C*                  EVAL      SVPVA=
     C*                  EVAL      SVMFR=
     C                   EVAL      SVVF='1'
     C                   EVAL      SVVKTB=SVEV_BRUT
     C                   EVAL      SVNTM=SVEV_ANKV
     C                   EVAL      SVBELT=SVEV_FABL
     C                   EVAL      SVVKTN=SVEV_NETO
     C                   EVAL      SVNT=SVEV_KOTA

     C                   IF        SVEH_MOKN=1449
     C                   EVAL      SSVEH='U.NR'
     C                   EVAL      SVFT=SVEV_VAS2
     C                   EVAL      USSLAA='1'
     C                   ENDIF

     C                   EVAL      SVVT=SVEV_VASL
     C                   EVAL      SVUNIK=WSFUNIK
     C                   EVAL      SVREFF=WSFREFF

     C                   WRITE     SADVR
     C                   EVAL      UFIND='Y'

     C     SVEHKEY       READE     SVEV                                   53
     C                   ENDDO

     C                   ENDSR
