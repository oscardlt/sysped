     FFAX012FM  CF   E             WORKSTN
     F                                     INFDS(FBAREA)
     FFIRM      IF   E           K DISK
     FFAXSEN    IF   E           K DISK
     FFAXLK     IF   E           K DISK
     FCUNDL01   UF   E           K DISK
     FKUNDL01   UF   E           K DISK
     F                                     RENAME(KUNDR:KUNDR2)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  F1                     1     21
     D                                     DIM(21)
     D  FAXNRP                 1     21
     D                 DS
     D  F2                     1     15
     D                                     DIM(15)
     D  FAXNR                  1     15
     D  FAX05A                 1      4
     D                 DS
     D  F3                     1      6
     D                                     DIM(6)
     D  FAXRET                 1      6
     D  FAX05B                 1      4
     D UCMD            DS          1024
     D                 DS
     D XCMD01          C                   CONST('WRKFLR FLR(*ALL)')
     D XCMD02          C                   CONST('WRKDOC DOC(*ALL) -
     D                                     FLR(')
     IKUNDR
     I              BANKG                       SYBAGI
     I              POSTG                       SYPOGI
      *
     C                   EXSR      INIT
     C     FEIL          TAG
     C                   EXFMT     BILDE01
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
     C     FORT          TAG
     C*
     C   03              GOTO      SLUTT
     C*
     C*
     C* SØKING
     C*
     C   04              DO
     C                   EXSR      SØKDTA
     C   30              GOTO      FEIL
     C                   END
     C*
     C* TESTER BILDET
     C*
     C                   EXSR      TESTB1
     C   30              GOTO      FEIL
     C*
     C*
     C* SEND DOKUMENT
     C*
     C   10              DO
     C* TILDELER DOKUMENTNAVN
     C*
     C* SENDER AVGÅRDE FAXEN
     C*
     C     FAXRET        IFNE      *BLANKS
     C                   EXSR      FAXFIX
     C                   ELSE
     C                   MOVEL     FAXNR         FAXNRP
     C                   END
      *
     C     *IN27         IFEQ      '1'
     C                   MOVE      'N'           COVP
     C     WSCVP         IFEQ      'J'
     C     WSCVP         OREQ      'Y'
     C                   MOVE      'J'           COVP
     C                   MOVEL     FIFT          COV05
     C                   CALL      'SYGE12CL'
     C                   PARM                    USE              10
     C                   PARM                    NVN              40
     C                   MOVEL     NVN           COV06
     C                   MOVEL     KNAVN         COV02
     C                   MOVEL     ADR1          COV03
     C                   CALL      'FAXCVP'
     C                   PARM                    COV01            40
     C                   PARM                    COV02            40
     C                   PARM                    COV03            40
     C                   PARM                    COV04            40
     C                   PARM                    COV05            40
     C                   PARM                    COV06            40
     C                   PARM                    COV07            40
     C                   PARM                    COV08            40
     C                   PARM                    FUNK              1
     C     FUNK          IFEQ      'A'
     C                   GOTO      FEIL
     C                   END
     C                   END
     C                   CALL      'FAX008CL'
     C                   PARM                    DOKNA
     C                   PARM                    MAPPE
     C                   PARM                    FAXNRP
     C                   PARM                    PTIME
     C                   PARM                    PDATE
     C                   PARM                    KNAVN
     C                   PARM                    COV01            40
     C                   PARM                    COV02            40
     C                   PARM                    COV03            40
     C                   PARM                    COV04            40
     C                   PARM                    COV05            40
     C                   PARM                    COV06            40
     C                   PARM                    COV07            40
     C                   PARM                    COV08            40
     C                   PARM                    COVP              1
     C                   EXSR      BL
      *
     C                   ELSE
      *
     C     KUNDNR        IFEQ      0
     C                   MOVE      *BLANKS       UCNV
     C                   MOVE      *BLANKS       ADR1
     C                   MOVE      *BLANKS       ADR2
     C                   MOVE      *BLANKS       UCAD3
     C                   ELSE
     C                   MOVE      KNAVN         UCNV
     C                   MOVEL     POSTNR        UCAD3
     C                   MOVE      ADR3          UCAD3
     C                   END
     C                   CALL      'FAXCV4'
     C     KUNDNR        PARM                    UKN               8 0
     C                   PARM                    KNAVN
     C                   PARM                    FAXNRP
     C                   PARM                    UCNV             30
     C                   PARM                    ADR1
     C                   PARM                    ADR2
     C                   PARM                    UCAD3            30
     C                   PARM                    DOKNA
     C                   PARM                    MAPPE
     C                   PARM                    PTIME
     C                   PARM                    PDATE
     C                   PARM                    WSCVP
      *
     C                   END
      *
     C                   END
     C                   GOTO      FEIL
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C***********************************************
     C     BL            BEGSR
     C***********************************************
     C                   MOVE      *ZEROS        KUNDNR
     C                   MOVE      *BLANKS       KNAVN
     C                   MOVE      'SHU0171'     MSGNR
     C                   MOVE      *BLANKS       DOKNA
     C                   MOVE      *BLANKS       MAPPE
     C                   SETON                                        30
     C                   ENDSR
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
     C                   SETOFF                                       713073
     C     KUNDNR        IFNE      *ZEROS
     C     KUNKEY        CHAIN(N)  CUNDL01                            70
     C     *IN70         IFEQ      '1'
     C                   MOVE      'SPK0001'     MSGNR
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     30            POSNBR
     C                   SETON                                        30
     C                   END
     C  N70FAXNR         IFEQ      *BLANKS
     C                   MOVEL     TFAXNR        FAXNR
     C                   END
     C  N70WSLAND        IFEQ      *BLANKS
     C                   MOVE      SYLAND        WSLAND
     C                   END
     C                   END
     C*
     C*
     C     FAXNR         IFEQ      *BLANKS
     C                   SETON                                        71
     C     *IN71         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   MOVE      'SHU0169'     MSGNR
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     30            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
     C*
     C*
     C*
     C* OPPDATERER KUNDEREGISTER
     C*
     C  N30KUNDNR        IFNE      *ZEROS
     C     FAXNR         IFNE      *BLANKS
     C     TFAXNR        IFEQ      *BLANKS
     C     KUNKEY        CHAIN     CUNDL01                            33
     C  N33              MOVE      FAXNR         TFAXNR
     C  N33              EXCEPT    UPD
     C     KUNKEY        CHAIN     KUNDL01                            33
     C  N33              MOVE      FAXNR         TFAXNR
     C  N33              EXCEPT    UPD2
     C                   END
     C                   END
     C                   END
     C*
     C                   MOVE      '*CURRENT'    PTIME             8
     C                   MOVE      '*CURRENT'    PDATE             8
     C     WSTIME        IFNE      *ZEROS
     C     WSDATE        IFNE      *ZEROS
     C                   MOVE      *BLANKS       PTIME
     C                   MOVEL     *BLANKS       PDATE
     C                   MOVEL     WSTIME        PTIME
     C                   MOVEL     WSDATE        PDATE
     C                   END
     C                   END
     C  N30DOKNA         IFNE      *BLANKS
     C     MAPPE         IFNE      *BLANKS
     C                   MOVE      'J'           FINS
     C                   CALL      'FAXOBJ'
     C                   PARM                    DOKNA
     C                   PARM                    MAPPE
     C                   PARM                    FINS              1
     C                   ELSE
     C                   MOVE      'N'           FINS
     C                   END
     C     FINS          IFNE      'J'
     C                   SETON                                        3073
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     30            POSNBR
     C     *IN73         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C     FINS          IFEQ      'U'
     C                   MOVE      'SHU0213'     MSGNR
     C                   ELSE
     C                   MOVE      'SHU0196'     MSGNR
     C                   END
     C                   END
     C                   END
     C                   END
     C     WSLAND        IFNE      *BLANKS
     C     WSLAND        CHAIN     FAXLK                              33
     C     FAX05A        IFEQ      FAX05B
     C                   MOVE      *BLANKS       FAXRET
     C                   END
     C                   END
     C                   ENDSR
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     KUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C                   Z-ADD     1024          UCMDL            15 5
     C                   READ      FIRM                                   33
     C     FIFIRM        READE     FAXSEN                                 27
     C  N27FAXLIB        COMP      *BLANKS                                27
      *
     C                   ENDSR
     C*****************************************************
     C     FAXFIX        BEGSR
     C*****************************************************
     C                   Z-ADD     1             A1                2 0
     C                   Z-ADD     1             A2                2 0
     C                   Z-ADD     1             A3                2 0
     C                   DO        6
     C     F3(A3)        IFNE      *BLANKS
     C                   MOVEL     F3(A3)        F1(A1)
     C                   ADD       1             A1
     C                   END
     C                   ADD       1             A3
     C                   END
     C                   DO        15
     C     F2(A2)        IFNE      *BLANKS
     C                   MOVEL     F2(A2)        F1(A1)
     C                   ADD       1             A1
     C                   END
     C                   ADD       1             A2
     C                   END
     C                   ENDSR
      *
     C***********************************************
     C     SØKDTA        BEGSR
     C***********************************************
     C     LINNBR        IFEQ      6
     C     POSNBR        ANDGE     30
     C     POSNBR        ANDLE     37
     C                   MOVE      *BLANKS       USØKKN
     C                   CALL      'SOEKKUN'
     C                   PARM                    KUNDNR
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN           30
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     30            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      9
     C     POSNBR        ANDGE     30
     C     POSNBR        ANDLE     49
     C                   MOVE      *BLANKS       UCMD
     C                   MOVE      XCMD01        UCMD
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      10
     C     POSNBR        ANDGE     30
     C     POSNBR        ANDLE     41
     C                   MOVE      *BLANKS       UCMD
     C     XCMD02        CAT       MAPPE         UCMD
     C                   CAT       ')':0         UCMD
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     C                   GOTO      SLSØK
     C                   END
     C*
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
     C*
     C     SLSØK         ENDSR
     C*
     OKUNDR     E            UPD
     O                       TFAXNR
     OKUNDR2    E            UPD2
     O                       TFAXNR
