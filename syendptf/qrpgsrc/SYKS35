********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 tar med valuta på detaljer
10XXX * 02 SH  PTF10 samme som 01
10XXX * 03 JOV PTF10 Feil konto (pliktig/fri) ved avvikende momskode..
10XXX * 04 SH  PTF10 løsning for 1. gangsregistrering  2. gangs registrering
10XXX * 05 SH  PTF10 merke krediterte status 'K' for kreditert
10XXX * 06 SH  PTF10 eu-konteringer
      * 07 SH  PTF11 rettelser til kurs i hovedbok
      * 08 SH  PTF11 nullstiller budsjett og merker ført
      * 09 SH  PTF11 DIREKTE L1 BILLAG
      * 10 SH  PTF11 leverandørnavn i bilagstekst motposter
      * 11 SH  PTF11 rettlese 2. gangsregistrering
      * 12 SH  PTF11 -1 i avdeling arkivpost tat bort
      * 13 SH  PTF11 slettet key + rettelse dir l1
      * 14 SH  PTF11 feil ved arkivering
      * 15 SH  PTF11 TILBAKESTILT  11
      * 16 SH  PTF12 blanke valkod 1. gangsreg + ikke nullebudsjett
      * 17 SH  PTF12 ikke slett arkivpost med avd opd 0 subrutinen arkiv  ikke merket
      * 18 SH  PTF12 ikke spre ukomplett
      * 19 SH  PTF12 slettet ptf 10
      * 20 SH  PTF12 ikke 1. gang 2 gang ved kredit0ilag
      * 21 SH  PTF12 skjekker arkiv ytterligere
      * 22 SH  PTF12 rettelse forhøy forkort
      * 23 SH  PTF12 valutakurs faktura + netto posteringsbeløp
12XXX * 24 SH  PTF12 visma-endringer
12XXX * 25 SH  PTF12 blank tekst på L1 fakturaer + ny interimsløsning
12XXX * 26 SH  PTF12 feil linjenummer på bilag
12XXX * 27 SH  PTF12 skiller ut direktehovedboksbilag Visma
12XXX * 28 SH  PTF12 visma
12XXX * 29 SH  PTF12 logging kostnadsføring
12XXX * 30 SH  PTF12 tilbakeføring av 1. gangsregistrert bilag
12XXX * 31 SH  PTF12 blank bilagstekst
12XXX * 32 SH  PTF12 NETTO KUN VED VISMA
12XXX * 33 SH  PTF12 firml1 er nå parameter
      * 34 sh  PTF12 viser bruker som har ferdimneldt ordre i kostloggen
      * 35 sh  PTF12 skriver til trackf på ordrenivå
      * 36 sh  PTF12 oppdaterer journ i loggsr
********************************************************************
     H DATEDIT(*DMY) debug(*yes)
      ***********************************************************
      *** PROGRAM SKAL OVERFØRER REGISTRERTE KOSTNADER        ***
      *** TIL ØKONOMISYSTEM (VIA POSTFILER)                   ***
      *** LEGGER KOSTNADSLINJER INN PÅ OPPDRAG                ***
      *** LEGGER INNTEKTSLINJER TIL FAKTURA PÅ OPPDRAG DERSOM ***
      ***        DEN FUNKSJONEN ER VALGT                      ***
      ***********************************************************
      *OBS!!!!  FILA KOSTA14 CHAINES VED "KREDIT AV" .............
      *OBS!!!!  ALLE FELT ER RENAMET I INPUT, VED ENDRING AV FILLAYOUT
      *OBS!!!!  I KOSTA MÅ!!!! DETTE FØLGES OPP!!!!! .............
      *
N35  FTRACKF    O  A E             DISK
N29  FKOSTL     O  A E             DISK
N25  FFIRMINT   IF   E           K DISK
N08  FKOSBU12   UF   E           K DISK
N08  F                                     RENAME(KOSBUR:KOSBUR12)
N06  FKODTS2    IF   E           K DISK
N06  FKODTG3    IF   E           K DISK
N06  FSTED2     IF   E           K DISK
     FKODIL01   IF   E           K DISK
     FKODJL01   IF   E           K DISK
     FKOSTA15   UF   E           K DISK
     FKOSTA16   UF   E           K DISK
     F                                     RENAME(KOSTAR:KOST16R)
     FKOSTA14   IF   E           K DISK
     F                                     RENAME(KOSTAR:KOST14R)
     FKOSTB     UF   E           K DISK
     FKOSTB3    IF   E           K DISK
     F                                     RENAME(KOSTBR:KOSTB3R)
     FARKIVL10  UF A E           K DISK
     FKOSBL01   UF A E           K DISK
     FKOSAL01   UF A E           K DISK
     FKONTL01   IF   E           K DISK
     FKHEDL01   IF   E           K DISK
     FLEVEL01   IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     F                                     RENAME(KUNDR:CUNDR)
     FKUNDL01   IF   E           K DISK
     FKODTÅ     IF   E           K DISK
     FKODTV     IF   E           K DISK
     FKODTA     IF   E           K DISK
     FKODTGE    IF   E           K DISK
     FKODTG2    IF   E           K DISK
     FFIRM      IF   E           K DISK
s33  F*IRML1    IF   E           K DISK
     FFIRMKOS   IF   E           K DISK
     FHEADF     UF   E           K DISK
     FKOSBU5    IF   E           K DISK
     FDISP      IF   E           K DISK
     FTURER     IF   E           K DISK
     FFAI3      IF A E           K DISK
     FFAKT      UF A E           K DISK
     FFIRMTEL   UF A E           K DISK                                         X010
     FSYSRL01   UF   E           K DISK                                         X010
     FKODWL01   IF   E           K DISK
     FSYKS35P   O    F  132        PRINTER OFLIND(*INOF)
     D*
     D                SDS
     D  USERID               254    263
N09  D                 DS
N09  D  kbrefc                 1     35
N09  D  fastko                 1      3
N09  D  kbrefcko               4      8  0
N09  D  fastav                 9     11
N09  D  kbrefcav              12     15  0
N09  D  fastba                16     18
N09  D  kbrefcba              19     22  0
N09  D  fastpr                23     25
N09  D  kbrefcpr              26     33  0
      *
     D                 DS
     D  KATXT                  1     35
N25  D  KATX15                 1     15
     D  KATKU1                 1      5
     D  KATKU2                 6     13
     D  KATXt1                 1      1
     D  KATX34                 2     35
N13  D  KATXL1                32     35
     D                 DS
     D*
     D*--------------------------------------------------------------
     D* DEFINERER DATASTRUKTURER
     D*--------------------------------------------------------------
     D                 DS
     D  KBGEBY                 1      1  0
     D  KBNØKK                 2      2  0
     D  GEBNØK                 1      2
     D                 DS
     D  BILAAR                 1      4  0
     D  BILMND                 5      6  0
     D  BILDAG                 7      8  0
     D  KABDT                  1      8  0
     D                 DS
     D  XBDTD                  1      2  0
     D  XBDTM                  3      4  0
     D  XBDTÅ                  5      6  0
     D  XBDT                   1      6  0
     D                 DS
     D  KRDAAR                 1      4  0
     D  KRDMND                 5      6  0
     D  KRDDAG                 7      8  0
     D  DSFDT                  1      8  0
     D                 DS
     D  FFDAAR                 1      4  0
     D  FFDMND                 5      6  0
     D  FFDDAG                 7      8  0
     D  DSFFDT                 1      8  0
     D                 DS
     D  MINPER                 1      6  0
     D  KOÅCC                  1      2  0
     D  KOÅÅR                  3      4  0
     D  KOÅMND                 5      6  0
     D                 DS
     D  LNAVN                  1     30
     D  KNAV18                 1     18
     D                 DS
     D  SEKSPN                 1     11  0
     D  KBAVD                  1      4  0
     D  KBOPD                  5     11  0
V10  D* UTLREF                 4      9  0
     D                 DS
     D  KG2LEV                 1      8  0
     D  KG2PRO                 1      4  4
     D  KG2BÆR                 5      8  0
     D                UDS
     D  UFIRMA                 1      2
     ICUNDR
     I              BANKG                       SYBAGI
     I              POSTG                       SYPOGI
     IKOST14R
     I              KAST                        XAST
     I              KABNR                       XABNR
     I              KABDT                       XABDT
     I              KAPCC                       XAPCC
     I              KAPÅR                       XAPÅR
     I              KAPMN                       XAPMN
     I              KALNR                       XALNR
     I              KAVAL                       XAVAL
     I              KABL                        XABL
     I              KAVK                        XAVK
     I              KAVKU                       XAVKU
     I              KAOMRF                      XAOMRF
     I              KAFNR                       XAFNR
     I              KAFDT                       XAFDT
     I              KAFFDT                      XAFFDT
     I              KABB                        XABB
     I              KASG                        XASG
     I              KALKID                      XALKID
     I              KARNR                       XARNR
     I              KATAVD                      XATAVD
     I              KATUNR                      XATUNR
     I              KAOAVD                      XAOAVD
     I              KAOPD                       XAOPD
     I              KABLST                      XABLST
     I              KATXT                       XATXT
     I              KABNR2                      XABNR2
     I              KAMVA                       XAMVA
     I              KABLM                       XABLM
     I              KAUSER                      XAUSER
     I              KADTE                       XADTE
     I              KATME                       XATME
     I              KAJOUR                      XAJOUR
     I              KADTR                       XADTR
     I              KATDR                       XATDR
     C*
     C                   EXSR      INIT
     C     UFLAGG        IFEQ      'U'
     C     KOS16K        SETLL     KOSTA16
     C     KOS16K        READE     KOSTA16                                50
     C                   ELSE
     C     'G'           SETLL     KOSTA15
     C     'G'           READE     KOSTA15                                50
     C                   END
     C*
     C     *IN50         DOWEQ     '0'
      * Hvis REN omkjøring er valgt skal ikke NYE bilag medtas.
     C     UFLAGG        IFEQ      'O'
     C     KAJOUR        ANDEQ     *ZEROS
     C                   GOTO      NXTBIL
     C                   END
     C* Hvis bilag alt har journalnr er det en omkjøring (ikke stat!!)
     C                   MOVE      KAJOUR        GMJOUR            7 0          *TIDLIGERE
N04  c     Kablst        ifeq      '2'
N04  c     uflagg        andne     'O'
N04  c                   move      *zeros        gmjour
n04  c                   end
     C     GMJOUR        COMP      *ZEROS                             7676       OVERFØRT???
     C* Uppdate Accounts Payable (or direct cost in gen. ledger)
     C                   EXSR      MAIN
     C* Process splitted detailcosts(G.le./invoice&costlines to FAKT)
N04  C     KABLST        IFNE      '1'
     C                   EXSR      LINES
N04  C                   ELSE
N04  C                   EXSR      LINES1
N04  C                   end
     C                   MOVE      'O'           KAST
N04  C     KABLST        IFEQ      '1'
N04  C                   MOVE      ' '           KAST
N04  C                   END
N05  C     KASG          IFEQ      '*K*'
N05  C                   MOVE      'K'           KAST
N05  C                   END
N30  c                   if        katxt='*Tilbakeført*' and
N30  c                             kablst='1'
N30  c                   z-sub     kabl          kabl
N30  c                   move      '2'           kablst
n30  c                   move      'T'           kast
n30  c                   CALL      'SYKS35L'
n30  c                   parm                    FIRMA
n30  c                   parm                    BILNR
N30  c                   end
     C                   Z-ADD     FIJOU2        KAJOUR
N14  C     KATXL1        ifne      '*L1*'
E14  c  N76              EXSR      ARKIV
N14  c                   end
     C     NXTBIL        TAG
     C     UFLAGG        IFEQ      'U'
     C                   UPDATE    KOST16R
     C     KOS16K        READE     KOSTA16                                50
     C                   ELSE
     C                   UPDATE    KOSTAR
     C     'G'           READE     KOSTA15                                50
     C                   END
     C                   END
     C*
     C                   EXCEPT    TOTGRA
     C* Get/Write sum of all transactions to economy (DEBET/CREDIT)
     C                   EXSR      TOTSR
     C*
     C                   SETON                                        LR
     C                   RETURN
     C******************************************************************
     C     MAIN          BEGSR
     C******************************************************************
     C* tilbakeføring av billag
N30  c                   if        katxt='*Tilbakeført*' and
N30  c                             kablst='1'
N30  c                   z-sub     kabl          kabl
N30  c                   end
     C                   SETON                                        77        HEADER-post
     C                   MOVE      *ZEROS        PROSNR
     C                   MOVE      *ZEROS        PRIPRO
     C                   MOVE      ' '           UTLIND
     C* SKJEKKER OM PERIODE er åpen i regnskapet
     C* HVIS IKKE POSTER PÅ LAVESTE ÅPNE
     C* (ENDRET PERIODE OPPDATERES SÅ PÅ BILAGET!!!!)
     C                   MOVE      KAPCC         KOÅCC
     C                   MOVE      KAPÅR         KOÅÅR
     C                   MOVE      KAPMN         KOÅMND
     C     KODÅKE        CHAIN     KODTÅ                              33
     C   33              MOVE      MINPE2        KAPMN
     C   33              MOVEL     MINPE2        XNR4              4 0
     C   33              MOVE      XNR4          KAPÅR
     C   33              MOVEL     XNR4          KAPCC
     C                   Z-ADD     KABNR2        BILNR
     C* LEGG POST I HEADINGFILE (KOSAF = POSAF)
     C     KEYBI         CHAIN     KOSAL01                            44
     C                   MOVE      'A'           AKTKOD
     C                   MOVE      FIFIRM        FIRMA
     C                   MOVEL     KAPCC         PERAAR
     C                   MOVE      KAPÅR         PERAAR
     C                   MOVE      KAPÅR         PERAA2            2 0
     C                   MOVE      KAPMN         PERNR
     C                   MOVE      *BLANKS       VALKOD
     C                   EXSR      GETSUR
N23  C                   z-add     kavku         valku1
     C   44              WRITE     KOSAR
N29  c                   EXSR      LOGGSR
     C*
     C                   ADD       1             IBMPNR
     C                   Z-ADD     IBMPNR        POSNR
     C                   EXSR      GETSUR
     C     KATAVD        IFEQ      *ZEROS
     C                   MOVE      *ZEROS        KSTED
     C                   MOVE      *ZEROS        KBARER
     C                   ELSE
     C                   MOVE      KATAVD        KBAVD
     C     KODAKE        CHAIN     KODTA                              33
     C   33              MOVE      *ZEROS        KSTED
     C   33              MOVE      *ZEROS        KBARER
     C  N33              Z-ADD     KOAKON        KSTED
     C  N33              Z-ADD     KOABÆR        KBARER
     C                   END
     C                   MOVE      *ZEROS        MOMSK
     C                   MOVE      *ZEROS        KBOPD
     C     KAVAL         IFEQ      '   '
     C     KAVAL         OREQ      FICURR
     C                   MOVE      *BLANKS       VALKOX
     C                   MOVE      *ZEROS        BELOPV
     C                   Z-ADD     KABL          BBELOP
      *
      * HVIS "NOK" OPPGITT I LEV.REGISTER HÅNDTERES DETTE SOM FREMMED
      * OBS!! BLIR DETTE FEIL FOR KUNDER MED ANDRE ØKO-SYSTEM ENN L1???
      *
n27  C                   MOVE      ' '           OPKDPO
s27  C*    KALNR         IFNE      *ZEROS
n27  C     KALNR         IFEQ      *ZEROS
n25  c     L1kjor        ifeq      'V'
N27  C                   MOVE      'J'           OPKDPO            1
N27  c                   end
n27  C                   ELSE
     C                   Z-ADD     KALNR         ZLEVNR
     C     LEVKEY        CHAIN     LEVEL01                            33
     C     *IN33         IFEQ      '0'
     C     VALKOD        ANDEQ     'NOK'
     C     VALKOD        ANDEQ     FICURR
     C                   MOVE      KAVAL         VALKOX
     C                   Z-ADD     KABL          BELOPV
     C                   END
     C                   END
     C                   END
     C     KAVAL         IFNE      '   '
     C     KAVAL         ANDNE     FICURR
     C                   MOVE      KAVAL         VALKOX
     C                   Z-ADD     KABL          BELOPV
     C     KAVKU         DIV       KAOMRF        XFAKT             9 6
     C     KABL          MULT(H)   XFAKT         BBELOP
     C                   END
     C* FLYTTE I FELT FOR "EXCPTDET"
     C                   Z-ADD     BBELOP        KBBLHB
     C                   Z-ADD     KARNR         REFNR
     C* VED REF TIDLIGERE BILAG (KREDIT AV...) HENT FORFALLSDATO.
     C     KARNR         IFNE      *ZEROS
     C     KARNR         CHAIN     KOSTA14                            33
     C     *IN33         IFEQ      '0'
     C     XAFFDT        ANDNE     *ZEROS
     C                   MOVE      XAFFDT        KAFFDT
     C                   END
     C                   END
     C* FLYTT UTFYLT DEL AV FAKT.NR HØYRESTILT OVER I KRNR
     C                   MOVE      *BLANKS       KRNR
     C                   MOVEL     KAFNR         KRNR
     C                   MOVE      KABB          BETBET
     C                   MOVE      KASG          ATTEST
     C                   MOVE      ' '           INTKOD
      * kode 1. gangsregistrering
N04  C     KABLST        IFEQ      '1'
N04  C                   MOVE      '1'           INTKOD
n04  C                   END
N30  c                   if        katxt='*Tilbakeført*' and
N30  c                             kablst='1'
N30  C                   MOVE      '2'           INTKOD
N30  C                   Z-ADD     KABNR2        REFNR
N30  c                   end
     C                   MOVE      KALKID        LKID
     C                   MOVE      *BLANKS       HEOT
     C                   MOVE      *BLANKS       HESG
     C                   MOVE      KAFDT         DSFDT
     C                   MOVE      KAFFDT        DSFFDT
n04  C                   MOVE      ' '           KRYSS
      *
      * KREDITOR.START
      *
     C     KALNR         IFNE      *ZEROS
     C                   MOVE      'K'           TYPE
     C                   Z-ADD     KALNR         RESNR
     C
      *
      * START DEBET/KREDIT
      *
     C     KABL          IFLE      0
     C                   MOVE      ' '           KRNOKD
     C                   MOVEL     'Inng. fa'    BILTXT
     C                   MOVE      'ktura  '     BILTXT
     C                   ELSE
     C                   MOVE      'K'           KRNOKD
     C                   MOVEL     'Inng. kr'    BILTXT
     C                   MOVE      'ed.nota'     BILTXT
     C                   END
      *
      * SLUTT DEBET/KREDIT
      *
     C                   Z-ADD     KALNR         ZLEVNR
     C     LEVKEY        CHAIN     LEVEL01                            33
      *
      * START BILAGSTEKST TYSK ENGELSK
      *
     C     SPRAAK        IFEQ      'E'
     C     KABL          IFLE      0
     C                   MOVE      ' '           KRNOKD
     C                   MOVEL     'Inco. in'    BILTXT
     C                   MOVE      'voice  '     BILTXT
     C                   ELSE
     C                   MOVE      'K'           KRNOKD
     C                   MOVEL     'Inco. cr'    BILTXT
     C                   MOVE      'ed.note'     BILTXT
     C                   END
     C                   END
     C     SPRAAK        IFEQ      'T'
     C     KABL          IFLE      0
     C                   MOVE      ' '           KRNOKD
     C                   MOVEL     'Ein. rec'    BILTXT
     C                   MOVE      'hnung  '     BILTXT
     C                   ELSE
     C                   MOVE      'K'           KRNOKD
     C                   MOVEL     'Ein. gut'    BILTXT
     C                   MOVE      'schrift'     BILTXT
     C                   END
     C                   END
      *
      *BILAGSKOMMENTAR SOM BEGYNNER MED *. OVERFØRES TIL BIL.TEKST
      *
     C     KATXT1        IFeq      '*'
     C     KATKU1        ANDNE     '*KU*:'
     C                   MOVEL     KATX34        BILTXT
     C                   END
     C                   MOVEL     '**'          KGENOT
     C                   MOVE      KNAV18        KGENOT
     C                   MOVE      'F'           KHEKE2
     C                   MOVE      KHENV         KHEKE3
     C  N33KHEKEY        CHAIN     KHEDL01                            33
     C  N33              MOVE      KONTOH        KONTO
     C   33              MOVE      99999         KONTO
      * OVERSTYRING MOT KUNDERESKONTRO????
     C     KATKU1        IFEQ      '*KU*:'
     C                   TESTN                   KATKU2               33
     C     *IN33         IFEQ      '1'
     C                   MOVE      KATKU2        ZKUNDN
     C     KUNKEY        CHAIN     KUNDL01                            33
     C     *IN33         IFEQ      '0'
     C                   MOVE      'D'           KHEKE2
     C                   MOVE      KHENV         KHEKE3
     C  N33KHEKEY        CHAIN     KHEDL01                            33
     C  N33              MOVE      KONTOH        KONTO
     C   33              MOVE      99999         KONTO
     C                   MOVE      ZKUNDN        RESNR
     C                   MOVE      'D'           TYPE
     C*VIS PÅ JOURNAL AT DETTE ER EN FØRING DIREKTE MOT KUNDERESK
     C                   MOVE      '*KUNDE*'     KGENOT
     C*PÅ DEBITORRESKONTRO ER KODING AV KREDITNOTA MOTSATT..
     C     KABL          IFGE      0
     C                   MOVE      ' '           KRNOKD
     C                   ELSE
     C                   MOVE      'K'           KRNOKD
     C                   END
     C                   END
     C                   END
     C                   END
n04   * motpost ved 2. gangs registrering
n04  c     KABLST        ifeq      '2'
n04  C                   MOVE      KHENIT        KHEKE3
n04  C  N33KHEKEY        CHAIN     KHEDL01                            33
n04  C  N33              MOVE      KONTOH        KONTO
n04  C   33              MOVE      99999         KONTO
n04  c                   eval      biltxt='*interim'
n04  C                   MOVE      '0'           MOMSK
n04  C                   MOVE      '2'           INTKOD
S15  c*                  move      *zeros        resnr
S15  C*                  MOVE      'H'           TYPE
N15  c                   move      *zeros        resnr
N15  C                   MOVE      'H'           TYPE
n04  C                   MOVE      'A'           KRYSS
n04  c                   CALL      'SYKS35L'
n04  c                   parm                    FIRMA
n04  c                   parm                    BILNR
n04  c                   end
      *
      * KREDITOR.SLUTT
      *
      * ELLER DIREKTE HOVEDBOK (KASSE/BANK....)
      *
     C                   ELSE
     C                   MOVE      'H'           TYPE
     C                   MOVE      ' '           KRNOKD
     C                   MOVE      *ZEROS        RESNR
     C                   MOVE      KAVK          KGEKOD
     C     GEBKEY        CHAIN     KODTGE                             11
     C                   MOVE      KAVK          KG2KOD
     C     GEBKE2        CHAIN     KODTG2                             33
N06  C  N33EUKODE        IFNE      *BLANKS
N06  C     GEBKEYE       CHAIN     KODTG3                             33
N06  C                   SETOFF                                       33
N06  C                   END
     C  N33              MOVE      KG2HBO        KONTO
     C   33              Z-ADD     99999         KONTO
     C                   MOVEL     '**DIREKT'    XGENOT           16
     C                   MOVE      'E HOVEDB'    XGENOT
     C                   MOVEL     XGENOT        KGENOT
     C                   MOVE      'OK**'        KGENOT
     C                   MOVEL     KGENOT        LNAVN
      *
      *BILAGSKOMMENTAR SOM IKKE BEGYNNER MED X. OVERFØRES TIL BIL.TEKST
      *
     C     KATXT         IFNE      *BLANKS
     C                   MOVEL     KATXT         TESTX             1
     C     TESTX         IFNE      'X'
N25  C     KATX15        andne     *blanks
     C                   MOVEL     KATXT         BILTXT
     C                   END
     C                   END
      *
      * SLUTT BILAGSTEKST
      *
     C                   END
      *
      *SLUTT DEN ENE POSTERINGSSIDE
      *
      * LEGG I POSTFIL - aldri sammenslåing
      *
N27  C                   EXSR      netto
     C                   EXSR      STEBAR
     C                   EXCEPT    IBMNY
     C                   MOVE      *BLANKS       GRKOPO
     C                   MOVE      *BLANKS       GRKODE
     C* SKRIV KOSTNADSJOURNAL
     C* PRINTER HEADING - FØRSTE SIDE ELLER OVERFLOW
     C     *IN01         IFEQ      '0'
     C     FIFIRM        CHAIN     FIRMTEL                            61
     C                   ADD       1             FIJOU2
     C  N61              UPDATE    FIRMTR
     C   61              WRITE     FIRMTR
     C                   EXCEPT    PHEAD
     C                   SETON                                        01        EN POST FUNN
     C                   END
     C   OF              EXCEPT    PHEAD
     C   OF              SETOFF                                       OF
     C     BBELOP        COMP      *ZEROS                             66  66
     C                   Z-ADD     KALNR         LEVKUN            8 0
     C                   EXSR      KDTFMT
     C                   EXCEPT    DET
     C   66              ADD       BBELOP        TOTDEB           11 2
     C   66              ADD       BBELOP        GRADEB           11 2
     C  N66              ADD       BBELOP        TOTKRE           11 2
     C  N66              ADD       BBELOP        GRAKRE           11 2
     C     KALNR         IFNE      *ZEROS
     C                   ADD       BBELOP        KREDIT           11 2
     C                   END
     C*
     C                   ENDSR
     C***********************************************************************
     C     LINES         BEGSR
     C***********************************************************************
      *
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""
N04  c                   move      ' '           kryss
N04  c                   move      ' '           intkod
N04  C     KABLST        IFEQ      '2'
N04  c                   move      '2'           intkod
n04  c                   end
     C                   SETOFF                                       77        DETALJ-post
     C                   MOVE      *BLANKS       VALKOX
     C                   MOVE      *ZEROS        BELOPV
     C                   MOVE      *ZEROS        RESNR
     C                   MOVE      *BLANKS       KRNR
     C                   MOVE      *ZEROS        REFNR
     C                   MOVE      *ZEROS        PROSNR
     C                   MOVE      *ZEROS        PRIPRO
     C                   MOVE      ' '           UTLIND
     C                   MOVE      *ZEROS        DSFDT
     C                   MOVE      *ZEROS        DSFFDT
     C                   MOVE      *BLANKS       BETBET
     C                   MOVE      *BLANKS       ATTEST
     C                   MOVE      KALKID        LKID
     C                   MOVE      *ZEROS        GMHEAK
     C*
     C* BEHANDLE ALL KOSTB-LINJER PÅ DETTE BILAGET.
     C* (KABNR="TILDELT INNREG.NR"=UNIKT LØPENR.)
      *
      * TA VARE PÅ HOVEDPOSTENS PERIODE FRA KOSTA
      *
     C                   MOVE      PERAAR        PERAARF           4 0
     C                   MOVE      PERNR         PERNRF            2 0
     C     KABNR         SETLL     KOSTB
     C                   SETOFF                                           33
     C     STLINE        TAG
     C     KABNR         READE     KOSTB                                  33
     C   33              GOTO      UTLINE
      *
      * skjekk om budsjett skal nummstilles
      *
N08  C     KOSBUK        KLIST
N08  C                   KFLD                    KBAVD
N08  C                   KFLD                    KBOPD
N08  C                   KFLD                    UTXT             35
N08  C                   EVAL      utxt='*fb*001'
n08  c     kosbuk        chain     kosbu12                            88
n08  c     *in88         ifeq      '0'
n08  c                   move      'F'           bust
S16  c*                  z-add     0             bubl
N16  c                   z-add     kabnr         bubnr2
n08  c                   update    kosbur12
n08  c                   end
      *
      * LEGGER UT AVVIKENDE PERIODE
      * HVIS TILLATT FRA FIRMKOS-FILEN
      * IKKE AVVIK TAR KOSTAS VERDI
      *
     C     TILLAT        IFEQ      'J'
     C     KBPÅR         IFEQ      *ZEROS
     C                   UPDATE    KOSTBR
     C                   MOVE      PERAARF       PERAAR
     C                   MOVE      PERNRF        PERNR
      * AVVIK
     C                   ELSE
     C                   MOVE      KBPCC         KOÅCC
     C                   MOVE      KBPÅR         KOÅÅR
     C                   MOVE      KBPMN         KOÅMND
     C     KODÅKE        CHAIN     KODTÅ                              33
     C     *IN33         IFEQ      '1'
     C                   MOVE      MINPE2        KBPMN
     C                   MOVEL     MINPE2        XNR4              4 0
     C                   MOVE      XNR4          KBPÅR
     C                   MOVEL     XNR4          KBPCC
     C                   MOVEL     KAPCC         PERAAR
     C                   END
     C                   MOVE      KBPÅR         PERAAR
     C                   MOVE      KBPÅR         PERAA2            2 0
     C                   MOVE      KBPMN         PERNR
      *
      * HVIS DETTE BLE HOVEDPOSTENS VERDI SETT TILBAKE TIL 0
     C
     C     PERAAR        IFEQ      PERAARF
     C     PERNR         ANDEQ     PERNRF
     C                   MOVE      *ZEROS        KBPMN
     C                   MOVE      *ZEROS        KBPÅR
     C                   MOVE      *ZEROS        KBPCC
     C                   END
     C                   UPDATE    KOSTBR
     C                   END
     C                   END
     C*
      * KBKDM  - MOMSKODE 0/1
      * KBKDPF - MOMSKODE ALFA
     C     KBKDPF        IFEQ      'P'
     C     KBKDPF        OREQ      'F'
     C                   MOVE      KBKDM         MOMSK
     C                   ELSE
     C                   MOVE      KBKDPF        MOMSK
     C                   ENDIF
     C* Nytt oppdrag ?
     C     SEKSPN        IFNE      GMHEAK
     C                   Z-ADD     SEKSPN        GMHEAK           11 0
     C     HEAKEY        CHAIN(N)  HEADF                              33
N06  C  N33              EXSR      EUSR
     C   33              MOVE      *ZEROS        HEPRO
     C   33              MOVE      '  '          HEOT
     C   33              MOVE      '   '         HESG
     C   33              MOVE      *ZEROS        HESTD
     C* VED TRANSPORTOPPDRAG - RUNDTUR ER PROSJEKTNR - BILKODE=VAREKODE
     C                   MOVE      '   '         TUBILK
     C  N33HEUR          IFEQ      'H'
     C     HEAKEY        CHAIN     DISP                               33
     C  N33TURKEY        CHAIN     TURER                              33
     C  N33              MOVE      TURUND        HEPRO
     C* Hvis det ikke er krav om prosj på avd.nivå OK uten prosj.nr
     C* (simuler landsped. oppdrag for å få OK kontering..)
     C     *IN33         IFEQ      '1'
     C     KODVKE        CHAIN     KODTV                              33
     C     *IN33         IFEQ      '0'
     C     KOVPRO        ANDNE     'J'
     C                   MOVE      'A'           HEUR
     C                   END
     C                   END
     C                   END
     C                   END                                                    *NYTT OPPDRAG
     C* Ta vare på opprinnelig KBVK (i fall erstattet med bilkode)
     C                   MOVE      KBVK          XXKBVK            3
     C* AVREGNKOD. T: BYTT UT VAREKODE MED BILKODE
     C     HEUR          IFEQ      'H'
     C                   MOVE      KBVK          KGEKOD
     C     GEBKEY        CHAIN     KODTGE                             11
     C  N11KGEAVR        IFEQ      'T'
     C     TUBILK        ANDNE     '   '
     C                   MOVE      TUBILK        KBVK
     C                   END
     C                   END                                                    *NYTT OPPDRAG
     C* NEW DIVISION or new cost type -
      * Division
     C     KODAKE        CHAIN     KODTA                              33
     C   33              MOVE      *ZEROS        KSTED
     C   33              MOVE      *ZEROS        KBARER
     C  N33              Z-ADD     KOAKON        KSTED
     C  N33              Z-ADD     KOABÆR        KBARER
     C     KODVKE        CHAIN     KODTV                              33
     C   33              MOVE      'N'           KOVPRO
      * Cost type
     C                   MOVE      KBVK          KGEKOD
     C                   MOVE      KBVK          KG2KOD
     C     GEBKEY        CHAIN     KODTGE                             11
     C  N11GEBKE2        CHAIN     KODTG2                             11
N06  C  N11EUKODE        IFNE      *BLANKS
N06  C     GEBKEYE       CHAIN     KODTG3                             11
N06  C                   SETOFF                                       11
N06  C                   END
     C   11              Z-ADD     999999        KGEKON
     C   11              MOVE      *ZEROS        KGEUTK
     C   11              MOVE      'N'           KGEUTL
     C   11              MOVE      'N'           KGEFRA
     C   11              MOVE      'J'           KGEPR
     C   11              MOVE      *ZEROS        KG2AVD
     C   11              MOVE      *ZEROS        KG2BÆR
     C   11              Z-ADD     999999        KG2MOT
     C   11              MOVE      *ZEROS        KG2UTG
     C* Overstyre sted på gebyrnivå ?
     C     KG2AVD        IFNE      *ZEROS                                        B2
     C                   Z-ADD     KG2AVD        KSTED
     C                   END                                                     E2
     C* BÆRER OVERSTYRT PÅ OPPDRAGSNIVÅ?
     C     HESTD         IFEQ      9999
     C                   MOVE      *ZEROS        KBARER
     C                   ELSE
     C     HESTD         IFGT      *ZEROS
     C                   Z-ADD     HESTD         KBARER
     C                   END
     C                   END
     C* Overstyre bærer på gebyrnivå ?
     C     KG2BÆR        IFNE      *ZEROS                                        B2
     C                   Z-ADD     KG2BÆR        KBARER
     C                   END                                                     E2
     C* Kontere fri/pliktig på samme konto ?
     C     KG2UTG        IFEQ      *ZEROS                                        B2
     C                   Z-ADD     KG2MOT        KG2UTG
     C                   END                                                     E2
     C     KG2KON        IFEQ      *ZEROS                                        B2
     C                   Z-ADD     KGEKON        KG2KON
     C                   END                                                     E2
     C* Ved"splittkonto"ligger kostnadskto på linje 1. (KGEKON/KG2KON)
     C     KG2XXX        IFEQ      'J'                                           B2
S03  C*    KBKDPF        IFEQ      'P'                                            B3 *plikt.
N03  C     KBKDPF        IFNE      'F'                                            B3 *plikt.
     C                   Z-ADD     KGEKON        KONTO
     C                   ELSE
     C                   Z-ADD     KG2KON        KONTO                               *fri
     C                   END                                                      E3
     C                   ELSE
     C* Ikke splittkonto - kostnadskto på linje 2. (KG2MOT/KG2UTG)
S03  C*    KBKDPF        IFEQ      'P'                                            B3
N03  C     KBKDPF        IFNE      'F'                                            B3 *plikt.
     C                   Z-ADD     KG2MOT        KONTO
     C                   ELSE
     C                   Z-ADD     KG2UTG        KONTO
     C                   END                                                      E3
     C                   END                                                     E2
N25   * AVVIK INTERIMSFØRING
N25  C     INTERI        IFEQ      'J'
N25  c     KBNØKK        ANDEQ     4
N25  C     KBKDPF        IFNE      'F'                                            B3 *plikt.
N25  c                   Z-ADD     INKONM        KONTO
n25  C                   ELSE
N25  c                   Z-ADD     INKONU        KONTO
N25  C                   END
N25  C                   END
     C* Kontoplan - regler:
N09   *
N09   * SPESIAL DIREKTE LØSNING 1
N09   *
N09  C     fastko        IFEQ      '*K*'
N13  C     KATXL1        andeq     '*L1*'
N09  C                   MOVE      KBREFCKO      KONTO
N09  C                   MOVE      KBREFCAV      KSTED
N09  C                   MOVE      KBREFCBA      KBARER
N09  C                   MOVE      KBREFCPR      PROSNR
N13  C                   SETOFF                                       11
N09  C                   END
     C                   Z-ADD     KONTO         WKONTO
     C     KONTKE        CHAIN     KONTL01                            33
      * *IN70 ON = HVIS INNTEKT, SWITCH MOMSKODE.
     C* Hvis inntektskonto - momskode 0->4, 1->3
     C  N33
     CAN 70KONTY         IFEQ      'I'
     C     MOMSK         IFEQ      '0'
     C                   MOVE      '4'           MOMSK
     C                   END
     C     MOMSK         IFEQ      '1'
     C                   MOVE      '3'           MOMSK
     C                   END
     C                   END
     C* Ikke tillatt medsted
     C  N33STEDK         IFEQ      'N'                                           B1
     C                   MOVE      *ZEROS        KSTED
     C                   END                                                     E1
     C* Ikke tillatt med bærer
     C  N33BARERK        IFEQ      'N'                                           B1
     C                   MOVE      *ZEROS        KBARER
     C                   END                                                     E1
     C*
     C* IKKE PROSJEKT VED FERJEKOSTNADER
     C     KGEAVR        IFEQ      'F'
     C                   MOVE      *ZEROS        HEPRO
     C                   MOVE      '  '          HEOT
     C                   MOVE      '   '         HESG
     C                   END
      *
      * Via utleggskontroll (reskontro)
      *
     C     FIKDUL        IFEQ      'J'
     C     KGEUTK        ANDNE     *ZEROS
     C                   MOVE      'D'           TYPE
     C                   Z-ADD     KGEUTK        ZKUNDN
     C     KUNKEY        CHAIN     CUNDL01                            33
     C     KUNKEY        CHAIN     KUNDL01                            33
     C                   MOVE      'D'           KHEKE2
     C  N33              MOVE      KHENV         KHEKE3
     C  N33KHEKEY        CHAIN     KHEDL01                            33
     C  N33              MOVE      KONTOH        KONTO
     C                   MOVE      '0'           MOMSK
     C                   MOVE      *ZEROS        KBARER
     C                   Z-ADD     KGEUTK        PRIPRO
     C                   Z-ADD     *ZEROS        PROSNR
     C                   MOVE      'U'           UTLIND            1
     C                   Z-ADD     KGEUTK        RESNR
V10  C*                  Z-ADD     UTLREF        REFNR
V10  C                   Z-ADD     KBOPD         REFNR
     C*
     C                   MOVE      BILAAR        KRDAAR
     C                   MOVE      BILMND        KRDMND
     C                   MOVE      BILDAG        KRDDAG
     C                   MOVE      BILAAR        FFDAAR
     C                   MOVE      BILMND        FFDMND
     C                   MOVE      BILDAG        FFDDAG
      *
      * eller direkte på hovedbok
      *
      *
     C                   ELSE
     C                   MOVE      'H'           TYPE
     C                   MOVE      ' '           UTLIND
     C                   END
     C                   MOVE      ' '           KRNOKD
     C*BILAGSKOMMENTAR SOM IKKE BEGYNNER MED X. OVERFØRES TIL BIL.TEKST
     C     KATXT         IFNE      *BLANKS
     C                   MOVEL     KATXT         TESTX             1
     C     TESTX         IFNE      'X'
N31  C     KATX15        andne     *blanks
     C                   MOVEL     KATXT         BILTXT
     C                   END
     C                   END
     C     KBBILT        IFNE      *BLANKS
     C                   MOVE      KBBILT        BILTXT
     C                   END
     C* Posten er enten .......
     C* Post til utleggskontroll (ikke slås sammen)
     C* Poster via utl.kontroll går IKKE i prosj.regnskap. (Kun type H)
     C     TYPE          IFEQ      'D'
     C                   ADD       1             IBMPNR
     C                   Z-ADD     IBMPNR        POSNR
     C                   EXSR      GETSUR
     C                   Z-ADD     KBBLHB        BBELOP
s28  C*                  EXSR      NETTO
N01  C     KAVAL         IFNE      '   '
N01  C     KAVAL         ANDNE     FICURR
N01  C                   MOVE      KAVAL         VALKOX
N01  C                   Z-ADD     KBBLHB        BELOPV
N01  C     KAVKU         DIV       KAOMRF        XFAKT             9 6
N01  C                   DIV(H)    XFAKT         BELOPV
N01  C                   END
n28  C                   EXSR      NETTO
     C                   EXCEPT    IBMNY
     C                   GOTO      UTKOST
     C                   END
     C* .. eller så er det ......
     C* Vanlig kostnadspost - Sammenslåing
     C* I KREDITORRESKONTRO FINNES INGET EGET FELT FOR "BILAGSNR I RESKONTRO"
     C* (SOM FAKTURANR PÅ INNTEKSSIDEN KAN OPPFATTES SOM)
     C* DERFOR KAN EN ALDRI SLÅ SAMMEN KOSTNADENE FRA ULIKE LEVERANDØRER
     C* (MEN EN MÅ SLÅ SAMMEN INNEN SAMME BILNR- FOR Å UNNGÅ FULL OPPSPLITTING
     C*  PÅ ORDRENIVÅ - SLIK SOM DET LIGGER I KOSTB)
     C                   MOVE      *ZEROS        PROSNR
     C                   MOVE      *ZEROS        PRIPRO
     C     KOVPRO        IFEQ      'J'
     C     KGEPR         ANDNE     'N'
     C     HEPRO         ANDNE     *ZEROS
     C                   MOVE      HEPRO         PRIPRO
     C                   Z-ADD     HEPRO         PROSNR
     C                   END
N09   *
N09   * SPESIAL DIREKTE LØSNING 1
N09   *
N09  C     fastko        IFEQ      '*K*'
N13  C     KATXL1        andeq     '*L1*'
N09  C                   MOVE      KBREFCKO      KONTO
N09  C                   MOVE      KBREFCAV      KSTED
N09  C                   MOVE      KBREFCBA      KBARER
N09  C                   MOVE      KBREFCPR      PROSNR
N13  C                   SETOFF                                       11
N09  C                   END
      *
     C     KOSB1K        CHAIN     KOSBL01                            33
     C   33              DO
     C                   ADD       1             IBMPNR
     C                   Z-ADD     IBMPNR        POSNR
     C                   EXSR      GETSUR
     C                   Z-ADD     KBBLHB        BBELOP
s28  C*                  EXSR      NETTO
N01  C     KAVAL         IFNE      '   '
N01  C     KAVAL         ANDNE     FICURR
N01  C                   MOVE      KAVAL         VALKOX
N01  C                   Z-ADD     KBBLHB        BELOPV
N01  C     KAVKU         DIV       KAOMRF        XFAKT             9 6
N01  C                   DIV(H)    XFAKT         BELOPV
N01  C                   END
n28  C                   EXSR      NETTO
     C                   EXSR      STEBAR
S19  C*                  movel     lnavn         biltxt
     C                   EXCEPT    IBMNY
     C                   MOVE      *BLANKS       GRKOPO
     C                   MOVE      *BLANKS       GRKODE
     C                   END
N02  C  N33KAVAL         IFNE      '   '
N02  C     KAVAL         ANDNE     FICURR
N02  C                   MOVE      KAVAL         VALKOX
S07  C***                Z-ADD     KBBLHB        BELOPV
N02  C     KAVKU         DIV       KAOMRF        XFAKT             9 6
s07  C*                  DIV(H)    XFAKT         WELOPV           15 2
N07  C     KBBLHB        DIV(H)    XFAKT         WELOPV           15 2
N02  C                   ADD       welopv        belopv
N02  C                   END
     C  N33              ADD       KBBLHB        BBELOP
N23  C  N33              EXSR      NETTO
     C  N33              UPDATE    KOSBR
     C*
     C*
     C     UTKOST        TAG
     C*
     C* SKRIV KOSTNADSJOURNAL
     C   OF              EXCEPT    PHEAD
     C   OF              SETOFF                                       OF
     C     KBBLHB        COMP      *ZEROS                             66  66
     C                   Z-ADD     KBKN          LEVKUN
     C                   EXSR      KDTFMT
     C                   EXCEPT    DET
     C   66              ADD       KBBLHB        TOTDEB           11 2
     C   66              ADD       KBBLHB        GRADEB           11 2
     C  N66              ADD       KBBLHB        TOTKRE           11 2
     C  N66              ADD       KBBLHB        GRAKRE           11 2
     C* LIST EVENTUELLE RENE TRANSPORTØRUTLEGG (0 I TUR/OPD PÅ REKV)
     C* (KOSBU5 ER X-REF FRA KOSBU TIL AKT. KOSTN.BILAG - MANGE->EN)
     C     KBOPD         IFEQ      *ZEROS
     C     KABNR         SETLL     KOSBU5
     C     KABNR         READE     KOSBU5                                 33
     C     *IN33         DOWEQ     '0'
     C     BUTUNR        IFEQ      *ZEROS
     C     BUOPD         ANDEQ     *ZEROS
     C                   EXCEPT    TRADET
     C                   END
     C     KABNR         READE     KOSBU5                                 33
     C                   END
     C                   END
     C* DERSOM FERJE-KODE ELLER TAST F23 - IKKE FORDEL (AVD/OPD= 0/0)
     C* IKKE LINJER PÅ OPPDRAG
     C     KGEAVR        IFEQ      'F'
     C     KBOPD         OREQ      *ZEROS
     C                   SETOFF                                       33
     C                   GOTO      STLINE
     C                   END
     C*
     C* Lag kostnadslinje på spedisjonsoppdraget
     C* MEN kun hvis det er 1. gang bilaget overføres (ikke ved omkj.)
     C* HELLER IKKE VED DIREKTE ØKONOMIBILAG
N25  C* ikke ved interimsføring
     C     GMJOUR        IFEQ      *ZEROS
     C     fastko        ANDNE     '*K*'
N13  C     KATXL1        andne     '*L1*'
N25  C     KBNØKK        andne     4
     C                   EXSR      LINE2
     C*
     C* Legg X-ref mellom kostnadsbilag og oppdrag i FAIN(for spørring)
     C                   EXSR      XREF
     C*
     C* Lag evt. inntektslinje på spedisjonsoppdraget
     C     KBBLF         IFNE      *ZEROS
     C                   EXSR      LINE3
     C                   END
     C                   END
     C*
     C                   SETOFF                                       33
     C                   GOTO      STLINE
     C*
     C     UTLINE        ENDSR
     C*
n04  C******************************************
n04  C     LINES1        BEGSR
n04  C******************************************
n04  C                   MOVE      'H'           TYPE
n04  c                   move      *zeros        resnr
n04   * motpost ved 1. gangs registrering
n04  C                   MOVE      KHENIT        KHEKE3
n04  C  N33KHEKEY        CHAIN     KHEDL01                            33
n04  C  N33              MOVE      KONTOH        KONTO
n04  C   33              MOVE      99999         KONTO
n04  c                   z-sub     bbelop        bbelop
s28  C*                  EXSR      NETTO
n04  c                   z-sub     belopv        belopv
n04  c                   eval      biltxt='*interim'
n04  C                   MOVE      '0'           MOMSK
n04  C                   MOVE      ' '           INTKOD
N26  C                   ADD       1             IBMPNR
N26  C                   Z-ADD     IBMPNR        POSNR
n04  C                   EXSR      GETSUR
N16  C                   MOVE      *BLANKS       VALKOD
N20  C     KASG          IFEQ      '*K*'
N20  C                   move      ' '           kablst
N20  C                   end
N23  C                   z-add     kavku         valku1
n28  C                   EXSR      NETTO
n04  C                   WRITE     KOSBR
n04  c                   endsr
     C******************************************
     C     LINE2         BEGSR
     C******************************************
      * Hvis A_K -Avregn.kreditnota OG E=Estimert, slettemerk
     C     XXKBVK        IFEQ      'A_K'
     C     HeaKey        setll     fakt
     C     HeaKey        Reade     fakt                                   33
     C     *in33         doweq     '0'
     C     FAOPKO        IFEQ      ' '
     C     FASK          andeq     'E'
     C                   EVAL      FAVT='Se A_K Avr.Kreditno.'
     C                   Move      'D'           FAOPKO
     c     HEST          IFEQ      ' '
     C     HEAKEY        CHAIN     HEADF                              33
N06  c  N33              exsr      eusr
     C  N33              MOVE      'F'           HEST
     C  N33              Update    HEADFR
     C                   END
     C                   END
     C                   UPDATE    FAKTR
     C     HeaKey        Reade     fakt                                   33
     C                   END
     C                   END
      *
     c                   clear                   faktr
     C                   Z-ADD     KABDT         FADATO
     C                   Z-ADD     KAFFDT        FADAFF
     C                   MOVE      HEAVD         FAAVD
     C                   MOVE      HEOPD         FAOPD
     C                   MOVE      *ZEROS        FALI
     C                   CALL      'SYGE06'
     C                   PARM                    FAAVD
     C                   PARM                    FAOPD
     C                   PARM                    FALI
     C     KBKN          IFEQ      HEKNSF                                       1B
     C                   MOVE      'S'           FASK
     C                   ELSE
     C     KBKN          IFEQ      HEKNKF                                       2B
     C                   MOVE      'K'           FASK
     C     HEUR          IFEQ      'D'                                           3B
     C     HESAML        ANDEQ     *BLANKS
     C                   MOVE      'F'           FASK
     C                   END                                                     3E
     C                   ELSE
     C                   MOVE      'X'           FASK
     C                   END                                                    2E
     C                   END                                                    1E
     C* På fakturalinja skal det opprinnelig KBVK (ikke evt. bilkode)
     C                   MOVE      XXKBVK        FAVK
     C                   MOVEL     LNAVN         FAVT
     C     KBBILT        IFNE      *BLANKS
     C                   MOVEL     KBBILT        FAVT
     C                   END
     C                   MOVE      KBKKEY        TURAVR            7
     C     TURAVR        IFEQ      '*TURAVR'
     C                   MOVE      '*T*     '    FAVT
     C                   END
     C                   MOVEL     ' S:'         SPLKOD            5
     C                   MOVE      GEBNØK        SPLKOD
     C                   MOVE      SPLKOD        FAVT
     C                   MOVE      KAVAL         FAVAL
     C                   MOVE      KAVAL         FACURI
      * KBKDM  - MOMSKODE 0/1
      * KBKDPF - MOMSKODE ALFA
     C     KBKDM         IFEQ      1
     C     KBKDPF        IFEQ      'P'
     C                   MOVE      'J'           FAKDM
     C                   ELSE
     C                   MOVE      KBKDPF        FAKDM
     C                   ENDIF
     C                   ELSE
     C                   MOVE      'N'           FAKDM
     C                   END
     C     FAKDM         IFNE      'N'
     C* VARIABLE VAT
     C     FITAX         ADD       1             FITAXN            5 4
     C     FITAXD        IFNE      *ZEROS
     C     FITAX2        ANDNE     *ZEROS
     C     FADATO        ANDLT     FITAXD
     C     FITAX2        ADD       1             FITAXN
     C                   END
     C     FAKDM         IFNE      'J'
     C     FAKDM         ANDNE     'N'
     C     KODWKY        CHAIN     KODWL01                            31
     C     *IN31         IFEQ      *OFF
     C     MVAAVI        IFEQ      *ZERO
     C                   MOVE      *ON           *IN31
     C                   ELSE
     C     MVAAVI        DIV       100           FITAXN
     C                   ADD       1             FITAXN
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C     KBBLHB        DIV(H)    FITAXN        FABELV
     C                   ELSE
     C                   Z-ADD     KBBLHB        FABELV
     C                   END
     C* Snu beløp for kostnadslinje(kostnad ligger til kredit på oppd.)
     C                   MULT      -1            FABELV
     C                   Z-ADD     FABELV        FABELN
     C     KAVAL         IFNE      '   '
     C     KAVAL         ANDNE     FICURR
     C     FABELN        DIV       XFAKT         FABELV
     C                   END
     C                   MOVE      'K'           FAKDA
     C                   MOVE      *BLANKS       FA01
     C                   MOVE      ' '           FA01B
     C                   MOVE      ' '           FAKDUK
     C                   MOVE      ' '           FAKDUL
     C                   MOVE      *ZEROS        FABELU
     C                   MOVE      KABNR2        FAFAKT
     C                   MOVE      'T'           FAOPKO
     C                   Z-ADD     KBKN          FAKUNR
     C                   Z-ADD     KALNR         FALEVN
     C                   Z-ADD     KAPCC         FACC
     C                   Z-ADD     PERAAR        FAÅR
     C                   Z-ADD     PERNR         FAMND
     C                   Z-ADD     FIJOU2        FAJOUR
     C                   MOVE      *ZEROS        FAFRBN
     C                   MOVE      KSTED         FAAVDR
     C                   MOVE      KBARER        FABÆR
     C                   MOVE      KONTO         FAACCN
     C                   WRITE     FAKTR
N35  c                   exsr      tracksr
      *
     C                   ENDSR
     C*
     C******************************************
     C     XREF          BEGSR
     C******************************************
     C*
     C* LIGGER X-REF - BILAGSNR/OPPDRAG FOR SPØRRING FRA FØR ?(34 ON)
     C     FAINK         CHAIN     FAI3                               33
     C   33              Z-ADD     FAFAKT        FIFN
     C   33              Z-ADD     FAAVD         FIAVD
     C   33              Z-ADD     FAOPD         FIOPD
     C   33              WRITE     FAINR
     C*
     C                   ENDSR
     C*
     C******************************************
     C     LINE3         BEGSR
     C******************************************
     C*  Inntektslinje legges som åpen fakturalinje
     C                   MOVE      KBKDMV        FAKDM
     C     FAKDM         IFNE      'N'
     C* VARIABLE VAT
     C     FITAX         ADD       1             FITAXN            5 4
     C     FITAXD        IFNE      *ZEROS
     C     FITAX2        ANDNE     *ZEROS
     C     FADATO        ANDLT     FITAXD
     C     FITAX2        ADD       1             FITAXN
     C                   END
     C     FAKDM         IFNE      'J'
     C                   MOVE      *BLANKS       WMVAKD
     C     KODWKY        CHAIN     KODWL01                            31
     C     *IN31         IFEQ      *OFF
     C     MVAAVI        IFEQ      *ZERO
     C                   MOVE      *ON           *IN31
     C                   ELSE
     C     MVAAVI        DIV       100           FITAXN
     C                   ADD       1             FITAXN
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C     KBBLF         DIV(H)    FITAXN        FABELV
     C                   ELSE
     C                   Z-ADD     KBBLF         FABELV
     C                   END
     C                   Z-ADD     FABELV        FABELN
     C     FAVAL         IFNE      FICURR
     C     FABELN        DIV       XFAKT         FABELV
S22  C*                  END
     C                   ADD       0.99          FABELN
     C                   MOVE      00            FABELN
N22  C                   END
     C                   MOVE      *BLANKS       FAVT
     C     KBBILT        IFNE      *BLANKS
     C                   MOVEL     KBBILT        FAVT
     C                   END
     C                   MOVE      FICURR        FACURI
     C*
     C                   MOVE      *ZEROS        FALI
     C                   CALL      'SYGE06'
     C                   PARM                    FAAVD
     C                   PARM                    FAOPD
     C                   PARM                    FALI
     C                   MOVE      ' '           FAOPKO
     C                   MOVE      'M'           FAKDA
     C                   MOVE      KGEUTL        FAKDUL
     C                   MOVE      *ZEROS        FAFAKT
     C                   Z-ADD     *ZEROS        FALEVN
     C                   Z-ADD     *ZEROS        FAKUNR
     C                   Z-ADD     *ZEROS        FADATO
     C                   Z-ADD     *ZEROS        FADAFF
     C                   Z-ADD     *ZEROS        FAJOUR
     C                   Z-ADD     *ZEROS        FAAVDR
     C                   Z-ADD     *ZEROS        FACC
     C                   Z-ADD     *ZEROS        FAÅR
     C                   Z-ADD     *ZEROS        FAMND
     C                   MOVE      *ZEROS        FAACCN
     C                   WRITE     FAKTR
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
     C                   MOVE      BILDAG        UDT1              2 0
     C                   MOVE      BILMND        UDT2              2 0
     C                   MOVE      BILAAR        UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          XBDTD
     C                   MOVE      UDT2          XBDTM
     C                   MOVE      UDT3          XBDTÅ
     C*
     C                   ENDSR
     C*
     C******************************************
     C     GETSUR        BEGSR
     C******************************************
     C*
     C* HENT NYTT SURRUGATNR - FRA SYSRF LEGG I "POSLNR"
     C*
     C*
     C     SYSRKE        CHAIN     SYSRL01                            30
     C  N30              ADD       1             SISSGT
     C  N30              UPDATE    SYSRR
     C                   Z-ADD     SISSGT        POSLNR
     C                   ENDSR
     C*
     C******************************************
     C     INIT          BEGSR
     C******************************************
     C* VED OMKJØRING: UFLAGG=O ->BARE BILAG SOM HAR 00000 I KAJOUR
     C     *ENTRY        PLIST
     C                   PARM                    UFLAGG            1
N33  C                   PARM                    L1KJOR            1
     C     UFLAGG        COMP      'O'                                    75
     C     *LIKE         DEFINE    KAST          YKAST
     C     KOS16K        KLIST
     C                   KFLD                    YKAST
     C                   KFLD                    YUSER
     C                   MOVE      'G'           YKAST
     C                   MOVE      USERID        YUSER            10
N06  C     GEBKEYE       KLIST
N06  C                   KFLD                    EUKODE
N06  C                   KFLD                    KGEKOD
s13  C*    GEBKEY3E      KLIST
s13  C*                  KFLD                    EUKODE
s13  C*                  KFLD                    TUBILK
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KOSTB
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    KBBNR         YKBBNR
     C     *LIKE         DEFINE    KBAVD         YKBAVD
     C     *LIKE         DEFINE    KBOPD         YKBOPD
     C     *LIKE         DEFINE    KBKN          YKBKN
     C     KEYKOB        KLIST
     C                   KFLD                    YKBBNR
     C                   KFLD                    YKBAVD
     C                   KFLD                    YKBOPD
     C                   KFLD                    YKBKN
     C                   MOVE      *ZEROS        YKBAVD
     C                   MOVE      *ZEROS        YKBOPD
     C                   MOVE      *ZEROS        YKBKN
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL POST2
     C*--------------------------------------------------------------
     C     KEYBI         KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    BILNR
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL POSTERINGSREGISTER KOSBL01
     C*--------------------------------------------------------------
     C     KOSB1K        KLIST
     C                   KFLD                    PERNR
     C                   KFLD                    PERAAR
     C                   KFLD                    KONTO
     C                   KFLD                    KSTED
     C                   KFLD                    KBARER
     C                   KFLD                    MOMSK
     C                   KFLD                    PROSNR
     C                   KFLD                    BILNR
     C*
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KUNDL01
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    KUNDNR        ZKUNDN
     C     KUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    ZKUNDN
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL LEVEL01
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    LEVNR         ZLEVNR
     C     LEVKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    ZLEVNR
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODTÅ   ÅPNE PERIODER
     C*--------------------------------------------------------------
     C     KODÅKE        KLIST
     C                   KFLD                    KOÅUNI
     C                   KFLD                    KOÅCC
     C                   KFLD                    KOÅÅR
     C                   KFLD                    KOÅMND
     C                   MOVE      'K'           KOÅUNI
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODE-TEKST-FIL TYPE V
     C*--------------------------------------------------------------
     C     KODVKE        KLIST
     C                   KFLD                    KOVUNI
     C                   KFLD                    KBAVD
     C                   MOVE      'V'           KOVUNI
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODE-TEKST-FIL TYPE A
     C*--------------------------------------------------------------
     C     KODAKE        KLIST
     C                   KFLD                    KOAUNI
     C                   KFLD                    KBAVD
     C                   MOVE      'A'           KOAUNI
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODE-TEKST-FIL TYPE GE (GEBYRKODER)
     C*--------------------------------------------------------------
     C     GEBKEY        KLIST
     C                   KFLD                    KGEUNI
     C                   KFLD                    KGEKOD
     C                   MOVE      'GE'          KGEUNI
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODE-TEKST-FIL TYPE G2 (GEBYRKODER)
     C*--------------------------------------------------------------
     C     GEBKE2        KLIST
     C                   KFLD                    KG2UNI
     C                   KFLD                    KG2KOD
     C                   MOVE      'G2'          KG2UNI
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KONTL01
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    KONTO         WKONTO
     C     KONTKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WKONTO
     C*
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KHEDL01
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    RECTYP        KHEKE2
     C     *LIKE         DEFINE    KHENV         KHEKE3
     C     KHEKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KHEKE2
     C                   KFLD                    KHEKE3
     C*
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL HEADINGREGISTER  HEAD
     C*--------------------------------------------------------------
     C     HEAKEY        KLIST
     C                   KFLD                    KBAVD
     C                   KFLD                    KBOPD
     C*
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL XREF-REGISTER  FAIN
     C*--------------------------------------------------------------
     C     FAINK         KLIST
     C                   KFLD                    FAFAKT
     C                   KFLD                    FAAVD
     C                   KFLD                    FAOPD
     C*
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL TURER
     C*--------------------------------------------------------------
     C     TURKEY        KLIST
     C                   KFLD                    DITUAV
     C                   KFLD                    DITUR
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL SYSRL01
     C*--------------------------------------------------------------
     C     SYSRKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    REGNA
     C                   MOVE      'SYS   '      REGNA             6
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODWL01
     C*--------------------------------------------------------------
     C     KODWKY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WMVAKD
     C                   KFLD                    FAKDM
     C                   MOVE      *BLANKS       WMVAKD            2
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL ARKIVL10
     C*--------------------------------------------------------------
     C     Ark10Key      KLIST
     C                   KFLD                    ARSTAT
     C                   KFLD                    NULLAvd
     C                   KFLD                    NULLOPD
     C                   KFLD                    ARUNDE
     c     *like         define    ARAVD         NULLAvd
S12  C*                  Z-SUB     1             NULLAVD
     c     *like         define    AROPD         NULLOPD
     c     *like         define    KBAVD         gmavd
     c     *like         define    KBOPD         gmopd
     C*
     C* HENTE SYSTEMDATO OG TID
     C     *LIKE         DEFINE    HEPRO         PRIPRO
     C* INITIER NUMERISKE FELT I DS
     C                   MOVE      *ZEROS        BILNR
     C                   MOVE      *ZEROS        KABDT
     C                   MOVE      *ZEROS        DSFDT
     C                   MOVE      *ZEROS        DSFFDT
     C                   MOVE      *ZEROS        KOÅMND
     C                   MOVE      *ZEROS        KOÅÅR
     C                   MOVE      *ZEROS        KOÅCC
     C*
     C* KODE FOR "OPPDATER KJØP" SETTES FAST TIL "J"
     C* (GJELDER BARE RESKONTROPOSTER, MEN GJØR INGEN SKADE VED HBOK)
     C*
     C                   MOVE      'J'           OPDKOD
     C*
     C* HENTER MINSTE ÅPNE PERIODE
     C*
     C     KODÅKE        SETLL     KODTÅ
     C     'K'           READE     KODTÅ                                  33
     C     *IN33         IFEQ      '1'
     C     UYEAR         IFGT      50
     C     UYEAR         ADD       1900          MINPE2            6 0
     C                   ELSE
     C     UYEAR         ADD       2000          MINPE2
     C                   END
     C                   MULT      100           MINPE2
     C                   MOVE      UMONTH        MINPE2
     C                   ELSE
     C                   MOVE      MINPER        MINPE2
     C                   END
     C*
     C                   MOVE      *ZEROS        IBMPNR            5 0
     C*
     C                   SETOFF                                       33
     C                   MOVE      *BLANKS       FIFIRM
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
     C                   MOVE      FIFIRM        UFIRMA            2
s33  c*    fifirm        chain     firml1                             33
     C     FIFIRM        CHAIN     FIRMKOS                            33
      * *IN70 ON = HVIS INNTEKT, SWITCH MOMSKODE.
     C     FILE41        COMP      'J'                                    70
     C     FITAX         ADD       1             FITAXN            5 4
      * interrimskonto
N25  C     FIFIRM        CHAIN     FIRMINT                            33
N25  C  N33              MOVE      'J'           INTERI            1
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     TOTSR         BEGSR
     C***********************************************
     C* Hvis pgm returnerer med '1' i UFLAGG er det ingen poster å
     C* overføre-CL vil avbryte- Minst en post->UFLAGG blir ' '.
     C                   MOVE      '1'           UFLAGG
     C     *LOVAL        SETLL     KOSBL01                            33
     C*
     C                   READ(N)   KOSBL01                                33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      ' '           UFLAGG
     C     BBELOP        IFGT      *ZEROS
     C                   ADD       BBELOP        DEBTOT           13 2
     C                   ELSE
     C                   ADD       BBELOP        KRETOT           13 2
     C                   END
     C                   READ(N)   KOSBL01                                33
     C                   END
     C*
     C                   EXCEPT    DEBKRE
     C                   ENDSR
     C*
     C***********************************************
     C     STEBAR        BEGSR
     C***********************************************
     C     KODIKE        KLIST
     C                   KFLD                    FIRMA
     C                   KFLD                    KBARER
     C     KODJKE        KLIST
     C                   KFLD                    FIRMA
     C                   KFLD                    KSTED
     C                   MOVE      *BLANKS       GRKOPO
     C                   MOVE      *BLANKS       GRKODE
     C     KBARER        IFNE      *ZEROS
     C     KODIKE        CHAIN     KODIL01                            22
     C  N22              MOVE      GRKOTI        GRKOPO
     C                   END
     C     KSTED         IFNE      *ZEROS
     C     KODJKE        CHAIN     KODJL01                            22
     C                   END
     C                   ENDSR
     C*
      *////////////////////////////////////////////////////////////
      *  For evt ARKIV-post(er) legg ut en ref pr oppdrag   ARKIV /
      *////////////////////////////////////////////////////////////
     C     ARKIV         BEGSR
     c                   MOVE      'A'           ARSTAT
     C                   Move      *blanks       ARUNDE
     C                   Movel     'KL:'         ARUNDE
     C                   Move      KABNR         ARUNDE
      *
      * hopp ut hvis ingen konteriingslinjer
      *
     C     KABNR         chain     KOSTB3                             33
     c   33              goto      utarkiv
N21  C                   Z-SUB     1             NULLAVD
N21  C     ARK10Key      chain     Arkivl10                           33
N21  C   33              Z-add     0             NULLAVD
N21  C   33ARK10Key      chain     Arkivl10                           33
N21  c   33              goto      utarkiv
      *
      * leser og sprer alle arkivdokumenter på denne
      *
     c                   setoff                                       33
     C     ARK10Key      setll     Arkivl10
     C     *in33         doweq     *OFF
     C     ARK10key      reade     Arkivl10                               33
N18  c     *in33         ifeq      '0'
n18  c     arfirm        andne     '  '
n18  c     artype        andne     '  '
     c                   move      9999          gmavd
     c                   move      9999999       gmopd
      *
      *Det skal legges ut en arkivpost pr avd oppdrag som er berørt
      *
     c                   setoff                                       34
     C     KABNR         setll     KOSTB3
     C     *in34         doweq     *OFF
     C     KABNR         reade     KOSTB3                                 34
     c     *in34         ifeq      '0'
     C     KBAVD         IFNE      GMAVD
     C     KBOPD         ORNE      GMOPD
     c     kbavd         ifne      0
     c     kbopd         andne     0
     C                   EVAL      ARAVD  = KBAVD
     C                   EVAL      AROPD  = KBOPD
     C                   WRITE     ARKIVR
     C                   end
     C                   end
     c                   end
     c                   eval      GMAVD = KBAVD
     c                   eval      GMOPD = KBOPD
S18  C*    KABNR         reade     KOSTB3                                 34
n18  C                   END
     C                   END
      *
     C     ARK10key      reade     Arkivl10                               33
     c                   end
     C     utarkiv       ENDSR
N06  C***********************************************
N06  C     EUSR          BEGSR
N06  C***********************************************
N06  C                   MOVE      *BLANKS       EUKODE            1
N06   * SPESIALKONTERING EU
N06  C     KODTS2K       KLIST
N06  C                   KFLD                    KS2UNI
N06  C                   KFLD                    KS2LK
N06  C                   MOVEL     'S2'          KS2UNI
N06  C
N06   *
N06   * unntak for eu (KS2PRE=B)
N06   *
N06  C                   MOVE      FILAND        KS2LK
N06  C     KODTS2K       CHAIN     KODTS2                             33
N06   *
N06   * EGET LAND ER EU
N06   *
N06  C  N33KS2PRE        IFEQ      'B'
N06   *
N06   *   IMPORT
N06   *
N06  C     HEUR          IFEQ      'A'
N06  C     HEUR          OREQ      'C'
N06  C     HEUR          OREQ      'F'
N06  C                   MOVE      HELKA         FIRLKF
N06  C     KOAPOS        IFEQ      'J'
N06  C                   MOVE      FILAND        FIRLKT
N06  C                   ELSE
N06  C     HESDT         CHAIN     STED2                              33
N06  C                   MOVE      ST2LK         FIRLKT
N06  C                   END
N06  C                   END
N06   *
N06   *   EKSPORT
N06   *
N06  C     HEUR          IFEQ      'B'
N06  C     HEUR          OREQ      'D'
N06  C     HEUR          OREQ      'G'
N06  C                   MOVE      HELKA         FIRLKT
N06  C     KOAPOS        IFEQ      'J'
N06  C                   MOVE      FILAND        FIRLKF
N06  C                   ELSE
N06  C     HESDT         CHAIN     STED2                              33
N06  C                   MOVE      ST2LK         FIRLKF
N06  C                   END
N06  C                   END
N06   *
N06   * TRANSPORTDISPONERING
N06   *
N06  C     HEUR          IFEQ      'H'
N06  C                   MOVE      HELKA         FIRLKF            2
N06  C                   MOVE      HETRI         FIRLKT            2
N06  C                   END
N06   *
N06   * DOMESTIC
N06   *
N06  C     FILAND        IFEQ      FIRLKF
N06  C     FILAND        ANDEQ     FIRLKT
N06  C                   MOVE      'D'           EUKODE
N06  C                   END
N06   *
N06   *
N06   * TRANSIT  BEGGE LAND I EU
N06   *
N06  C     FIRLKF        IFNE      FIRLKT
N06  C                   MOVE      FIRLKF        KS2LK
N06  C     KODTS2K       CHAIN     KODTS2                             33
N06  C  N33KS2PRE        IFEQ      'B'
N06  C                   MOVE      FIRLKT        KS2LK
N06  C     KODTS2K       CHAIN     KODTS2                             33
N06  C  N33KS2PRE        IFEQ      'B'
N06  C                   MOVE      'T'           EUKODE
N06  C                   END
N06  C                   END
N06  C                   END
N06   *
N06  C                   END
N06  C                   SETOFF                                       33
N06  C                   ENDSR
N23  C***********************************************
N23  C     NETTO         BEGSR
N23  C***********************************************
      * KUN VISMA
n32  C     l1KJOR        IFEQ      'V'
N23   * BBELOP TIL NBELPO
N23  c                   z-add     bbelop        nbelpo
N23  c     valkox        ifne      *blanks
N23  c     belopv        andne     *zeros
N23  c                   z-add     BELOPV        nbelpo
N23  c                   end
     c     momsk         ifeq      '1'
s28  C*    BBELOP        DIV(H)    FITAXN        NBELpo
n28  C     nbelpo        DIV(H)    FITAXN        NBELpo
     c                   end
n32  c                   end
N23  C                   ENDSR
N29  C***********************************************
N29  C     LOGGSR        BEGSR
N29  C***********************************************
n36  C* SKRIV KOSTNADSJOURNAL
n36  C* PRINTER HEADING - FØRSTE SIDE ELLER OVERFLOW
n36  C     *IN01         IFEQ      '0'
n36  C     FIFIRM        CHAIN     FIRMTEL                            61
n36  C                   ADD       1             FIJOU2
n36  C  N61              UPDATE    FIRMTR
n36  C   61              WRITE     FIRMTR
n36  C                   EXCEPT    PHEAD
n36  C                   SETON                                        01        EN POST FUNN
n36  C                   END
N29  C                   CALL      'SYGE15C'
N29  C                   PARM                    WDT               8
N29  C                   PARM                    WTM               6
N29  c                   move      wdt           LODATO
N29  c                   move      wtm           loklok
n34  c                   move      kauser        louser
N29  c                   move      kabnr         lounik
N29  c                   move      kabnr2        lobila
n29  c                   move      kablst        lofoan
n29  c                   move      fijou2        lojour
n29  c                   move      kasg          losg
n29  C                   eval      lotxt='Oppdatering'
n29  c                             +' av regnskap'
n36  c                   move      kapÅr         loaar
n36  c                   move      kapmn         lomnd
n29  c                   write     kostlr
n29  c                   endsr
     C*
N35  C***********************************************
N35  C     TRACKSR       BEGSR
N35  C***********************************************
N35   * mottak kostnad
N35  C                   MOVE      FAAVD         TTAVD
N35  C                   MOVE      FAOPD         TTOPD
N35  C                   MOVE      'EDI'         TTACTI
N35  C                   MOVE      wdt           TTDATE
N35  C                   MOVE      wTM           TTTIME
N35  C                   MOVE      wdt           TTDATL
N35  C                   MOVE      wTM           TTTIML
N35  C                   EVAL      TTUSER=KAUSER
N35   *
N35  C                   eval      TTTEXT = 'Received costs from: ' +
N35  C                             %trim(LNAVN) +
N35  C                             %trim(%editc(FABELN:'J'))
N35  C                   eval      TTTEXL = 'Mottatt kostnader' +
N35  C                             %trim(LNAVN) +
N35  C                             %trim(%editc(FABELN:'J'))
N35   *
N35   *
N35  C                   WRITE     TRACKFR
N35  C                   ENDSR
     C*
     O*********
     O* TIL IBM REGNSKAP    RESKONTO / hovedbok
     O***********'
     OKOSBR     EADD         IBMNY
     O                       AKTKOD
     O                       FIRMA
     O                       BILNR
     O                       POSNR
     O                       BILAAR
     O                       BILMND
     O                       BILDAG
     O                       PERAAR
     O                       PERNR
     O                       TYPE
     O                       RESNR
     O                       BILTXT
     O                       KONTO
     O                       KSTED
     O                       KBARER
     O                       MOMSK
     O                       BBELOP
     O                       VALKOX
     O                       BELOPV
     O                       REFNR
     O                       KRNR
     O                       KRDAAR
     O                       KRDMND
     O                       KRDDAG
     O                       FFDAAR
     O                       FFDMND
     O                       FFDDAG
     O                       BETBET
     O                       PROSNR
     O                       OPDKOD
     O                       POSLNR
     O                       KRNOKD
     O                       LKID
     O                       GRKOPO
     O                       GRKODE
     O                       ATTEST
     O                       INTKOD
N04  O                       KRYSS
N23  O                       VALKU1
N23  O                       NBELPO
N27  O                       OPKDPO
     OSYKS35P   E            PHEAD            01
     O                       FIFIRM               2
     O                       FIFT                48
     O                                           90 'JOURNALNR:'
     O                       FIJOU2        Z     97
     O                                          105 'SIDE:'
     O                       PAGE          Z    111
     OSYKS35P   E            PHEAD            02
     O                                           24 'K O S T N A D S J O U R '
     O                                           40 'N A L   D A T O:'
     O                       UDATE         Y     50
     O               75                         120 '** OMKJØRING **'
     OSYKS35P   E            PHEAD            03
     O                                           24 '------------------------'
     O                       *PLACE              48
     O                       *PLACE              72
     O                       *PLACE              96
     O                       *PLACE             120
     O                                          132 '------------'
     O          E            PHEAD            04
     O                                            6 'BIL.NR'
     O                                           15 'BIL.DATO'
     O                                           23 'OPD.NR.'
     O                                           31 'STE/BÆR'
     O                                           36 'KTO'
     O                                           39 'MK'
     O                                           57 'D  E  B  E  T'
     O                                           74 'K R E D I T'
     O                                           95 'G E B Y R T E K S T'
     O                                          100 'TYPE'
     O                                          110 'PROS/UTLK'
     O                                          118 'LEV/KUN'
     O                                          122 'REF'
     O                                          132 'PER'
     OSYKS35P   E            PHEAD          1 05
     O                                           24 '------------------------'
     O                       *PLACE              48
     O                       *PLACE              72
     O                       *PLACE              96
     O                       *PLACE             120
     O                                          132 '------------'
     OSYKS35P   E            DET            1
     O                       BILNR         Z      7
     O                       XBDT                15
     O                       KBOPD         Z     23
     O                       KSTED         Z     27
     O                       KBARER        Z     31
     O                       KONTO               37
     O                       MOMSK               39
     O               66      KBBLHB        L     57
     O              N66      KBBLHB        J     74
     O                       KGENOT              95
     O               11                          95 '*** SLETTET KODE  **'
     O                       HEOT               100
     O                       PRIPRO        Z    109
     O                       UTLIND             110
     O                       LEVKUN        Z    118
     O                       HESG               122
      * 75= Full omkjøring, 76=Dette bilag=omkj. 77=Header-posten bilag
     O               76    77                   103 '  GML JOU:'
     O               76    77GMJOUR        Z    110
     O               76N75 77                   127 '*OMKJ.!*'
     O                       PERNR         Z    129
     O                                          130 '/'
     O                       PERAA2             132
     OSYKS35P   E            TRADET         1
     O                                           35 '*****'
     O                       BUBL          J     57
     O                       BUVAL               61
     O                                           95 'Lagt ut for transp.:'
     O                       BUTNR         Z    103
     O                                          110 '*****'
     OSYKS35P   E            TOTGRA      2
     O                                           24 '** DEBET KREDIT KOLONNE-'
     O                                           34 'TOTAL   **'
     O                       GRADEB        JB    57
     O                       GRAKRE        JB    74
     OSYKS35P   E            TOTGRA      2  2
     O                                           24 '** TOTAL KREDITORER   **'
     O                       KREDIT        JB    74
     OSYKS35P   E            DEBKRE      2
     O                                           24 '** DEB/KRED POSTTOTAL (T'
     O                                           34 'IL ØKO) **'
     O                       DEBTOT        JB    52
     O                       KRETOT        JB    77
