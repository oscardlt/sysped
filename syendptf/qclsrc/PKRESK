             PGM
      /* */
      /*     PROGRAMMET LAGER RIKTIG BIBLIOTEKSLISTE, OG LEGGER   */
      /*     UT DATA I LOCAL DATA AREA                            */
      /*     STANDARD DATA FOR UTSKRIFTER LEGGES INN              */
      /*     DERSOM FIRMA IKKE FINNES KAN DETTE LEGGES INN VIA VR010 */
      /*     POSISJONENE 451 - 482 I LDA BRUKES I PROGRAMMET      */
      /* */
/* ***************************************************************** */
/* *   5797-AWD    IBM NORWAY 1988                                 * */
/* *   5797-AWD    COPYRIGHT IBM CORP 1988                         * */
/* *   REFER TO INSTRUCTIONS ON COPYRIGHT NOTICE NO. D120-2083     * */
/* ***************************************************************** */
             DCL        VAR(&MSG) TYPE(*CHAR) LEN(80)
             DCL        VAR(&ERRCNT) TYPE(*DEC) LEN(1) VALUE(0)
             DCL        VAR(&JOBB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&WSID) TYPE(*CHAR) LEN(10)
             DCL        VAR(&USER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&JOBNR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&DATOF) TYPE(*DEC) LEN(1) VALUE(2)
             DCL        VAR(&SKID) TYPE(*CHAR) LEN(10)
             DCL        VAR(&GRP) TYPE(*CHAR) LEN(10)
             DCL        VAR(&GRPANT) TYPE(*DEC) LEN(3 0)
             DCL        VAR(&DATF) TYPE(*CHAR) LEN(3)
             DCL        VAR(&STOPP) TYPE(*DEC) LEN(1)
             DCL        VAR(&SECURITY) TYPE(*CHAR) LEN(2)
             DCL        VAR(&BIBLPROG) TYPE(*CHAR) LEN(10)
             DCL        VAR(&BIBLDATA) TYPE(*CHAR) LEN(10)
             DCL        VAR(&GMLBIBL) TYPE(*CHAR) LEN(10)
             DCL        VAR(&BIBLEND) TYPE(*CHAR) LEN(10)
             DCL        VAR(&BIBLEN2) TYPE(*CHAR) LEN(10)
             DCL        VAR(&BIBLEN3) TYPE(*CHAR) LEN(10)
             DCL        VAR(&BIBLEN4) TYPE(*CHAR) LEN(10)
             DCL        VAR(&BIBLEN5) TYPE(*CHAR) LEN(10)
/*N55*/      DCL        VAR(&BIBLEN6) TYPE(*CHAR) LEN(10)
/*N55*/      DCL        VAR(&BIBLEN7) TYPE(*CHAR) LEN(10)
/*N55*/      DCL        VAR(&BIBLEN8) TYPE(*CHAR) LEN(10)
/*N55*/      DCL        VAR(&BIBLEN9) TYPE(*CHAR) LEN(10)
             DCL        VAR(&GMLEND) TYPE(*CHAR) LEN(10)
             DCL        VAR(&GMLEN2) TYPE(*CHAR) LEN(10)
             DCL        VAR(&GMLEN3) TYPE(*CHAR) LEN(10)
             DCL        VAR(&GMLEN4) TYPE(*CHAR) LEN(10)
             DCL        VAR(&GMLEN5) TYPE(*CHAR) LEN(10)
/*N55*/      DCL        VAR(&GMLEN6) TYPE(*CHAR) LEN(10)
/*N55*/      DCL        VAR(&GMLEN7) TYPE(*CHAR) LEN(10)
/*N55*/      DCL        VAR(&GMLEN8) TYPE(*CHAR) LEN(10)
/*N55*/      DCL        VAR(&GMLEN9) TYPE(*CHAR) LEN(10)
             DCL        VAR(&BLANK) TYPE(*CHAR) LEN(30) VALUE(' ')
             DCL        VAR(&START) TYPE(*CHAR) LEN(1) VALUE(' ')
/*______________*/
/* LES FIRMAFIL */
/*""""""""""""""*/
             DCLF       FILE(FIRML1) RCDFMT(*ALL)
             RCVF       DEV(*FILE) RCDFMT(*FILE)
             MONMSG     MSGID(CPF2100)
             MONMSG     MSGID(CPF2113) EXEC(GOTO CMDLBL(SLUTT))
             CHGDTAARA  DTAARA(*LDA *ALL) VALUE('                     -
         ') /* Tøm LDA */
     /**/
     /*  START AV APPLIKASJONEN:  START SETTES TIL '1'  */
     /*  START ER BLANK VED SKIFTE AV FIRMA             */
     /**/
             ADDLIBLE   LIB(L1STD) POSITION(*LAST)
             MONMSG     MSGID(CPF0000)
             ADDLIBLE   LIB(IBMSTD) POSITION(*LAST)
             MONMSG     MSGID(CPF0000)
             RTVDTAARA  DTAARA(STARTSTOPP) RTNVAR(&STOPP)
             IF         COND(&STOPP *EQ 1) THEN(DO)
             SNDPGMMSG  MSG('Programmene er foreløpig sperret. Prøv +
                          igjen senere') TOPGMQ(*EXT)
             GOTO       CMDLBL(SLUTT)
             ENDDO
     /**/
             RTVSYSVAL  SYSVAL(QSECURITY) RTNVAR(&SECURITY)
             IF         COND(&SECURITY *LT '20') THEN(DO)
             SNDPGMMSG  MSG('Det er for lav sikkerhet på systemet.  +
                          Må være 20 eller høyere.') TOPGMQ(*EXT)
             GOTO       CMDLBL(SLUTT)
             ENDDO
     /**/
             SETATNPGM  PGM(VCATTN)
     /*      RTVGRPA    GRPJOB(&GRP) GRPJOBCNT(&GRPANT)    */
     /*      IF         COND(&GRPANT *EQ 0) THEN(DO)       */
     /*      CHGGRPA    GRPJOB(MENY1)                      */
     /*      CHGDTAARA *GDA ' '                            */
     /*      ENDDO                                         */
             IF         COND(%SST(*LDA 45 10) *EQ ' ') THEN(CHGVAR +
                          VAR(&START) VALUE('1'))
             RTVJOBA    JOB(&WSID) USER(&USER) NBR(&JOBNR)
             RTVUSRPRF  PRTDEV(&SKID)
             IF         COND(&SKID *EQ '*SYSVAL') THEN(RTVSYSVAL +
                          SYSVAL(QPRTDEV) RTNVAR(&SKID))
             RTVSYSVAL  SYSVAL(QDATFMT) RTNVAR(&DATF)
             IF         COND(&DATF *EQ 'DMY') THEN(DO)
                        CHGVAR VAR(&DATOF) VALUE(0)
                        ENDDO
     /**/
             IF         COND(&DATF *EQ 'YMD') THEN(DO)
                        CHGVAR VAR(&DATOF) VALUE(1)
                        ENDDO
     /**/
             CHGVAR     VAR(%SST(*LDA 35 10)) VALUE(&WSID)
             CHGVAR     VAR(%SST(*LDA 45 10)) VALUE(&USER)
             CHGVAR     VAR(%SST(*LDA 55 6)) VALUE(&JOBNR)
             CHGVAR     VAR(%SST(*LDA 61 1)) VALUE(&DATOF)
             CHGVAR     VAR(%SST(*LDA 64 10)) VALUE(&SKID)
             CHGVAR     VAR(%SST(*LDA 472 1)) VALUE(&START)
             CHGVAR     VAR(%SST(*LDA 473 10)) VALUE(' ')
             MONMSG     MSGID(CPF0000)
             CALL       PGM(VR005)
             IF         COND(%SST(*LDA 471 1) *EQ '1') +
                               THEN(GOTO TEST)
             IF         COND(%SST(*LDA 1 2) *EQ '  ') +
                               THEN(GOTO SLUTT)
             IF         COND(%SST(*LDA 451 10) *EQ '          ') +
                          THEN(GOTO SLUTT)
             CHGVAR     VAR(&BIBLPROG) VALUE(%SST(*LDA 451 10))
             CHGVAR     VAR(&BIBLDATA) VALUE(%SST(*LDA 461 10))
             CHGVAR     VAR(&BIBLEND) VALUE(%SST(*LDA 483 10))
             CHGVAR     VAR(&BIBLEN2) VALUE(%SST(*LDA 503 10))
             CHGVAR     VAR(&BIBLEN3) VALUE(%SST(*LDA 523 10))
             CHGVAR     VAR(&BIBLEN4) VALUE(%SST(*LDA 543 10))
             CHGVAR     VAR(&BIBLEN5) VALUE(%SST(*LDA 563 10))
/*N55*/      CHGVAR     VAR(&BIBLEN6) VALUE(%SST(*LDA 583 10))
/*N55*/      CHGVAR     VAR(&BIBLEN7) VALUE(%SST(*LDA 603 10))
/*N55*/      CHGVAR     VAR(&BIBLEN8) VALUE(%SST(*LDA 623 10))
/*N55*/      CHGVAR     VAR(&BIBLEN9) VALUE(%SST(*LDA 643 10))
             IF         COND(&START *EQ ' ') THEN(DO)
             CHGVAR     VAR(&GMLBIBL) VALUE(%SST(*LDA 473 10))
             RMVLIBLE   LIB(&GMLBIBL)
             MONMSG     MSGID(CPF0000)
             ADDLIBLE   LIB(&BIBLPROG)
             CHGVAR     VAR(&GMLEND) VALUE(%SST(*LDA 493 10))
             RMVLIBLE   LIB(&GMLEND)
             MONMSG     MSGID(CPF0000)
             CHGVAR     VAR(&GMLEN2) VALUE(%SST(*LDA 513 10))
             RMVLIBLE   LIB(&GMLEN2)
             MONMSG     MSGID(CPF0000)
             CHGVAR     VAR(&GMLEN3) VALUE(%SST(*LDA 533 10))
             RMVLIBLE   LIB(&GMLEN3)
             MONMSG     MSGID(CPF0000)
             CHGVAR     VAR(&GMLEN4) VALUE(%SST(*LDA 553 10))
             RMVLIBLE   LIB(&GMLEN4)
             MONMSG     MSGID(CPF0000)
             CHGVAR     VAR(&GMLEN5) VALUE(%SST(*LDA 573 10))
             RMVLIBLE   LIB(&GMLEN5)
             MONMSG     MSGID(CPF0000)
/*N55*/      CHGVAR     VAR(&GMLEN6) VALUE(%SST(*LDA 593 10))
/*N55*/      RMVLIBLE   LIB(&GMLEN6)
/*N55*/      MONMSG     MSGID(CPF0000)
/*N55*/      CHGVAR     VAR(&GMLEN7) VALUE(%SST(*LDA 613 10))
/*N55*/      RMVLIBLE   LIB(&GMLEN7)
/*N55*/      MONMSG     MSGID(CPF0000)
/*N55*/      CHGVAR     VAR(&GMLEN8) VALUE(%SST(*LDA 633 10))
/*N55*/      RMVLIBLE   LIB(&GMLEN8)
/*N55*/      MONMSG     MSGID(CPF0000)
/*N55*/      CHGVAR     VAR(&GMLEN9) VALUE(%SST(*LDA 653 10))
/*N55*/      RMVLIBLE   LIB(&GMLEN9)
/*N55*/      MONMSG     MSGID(CPF0000)
             ENDDO
     /**/
/*N55P*/     RMVLIBLE   LIB(&BIBLPROG)
/*N55P*/     MONMSG     MSGID(CPF0000)
             ADDLIBLE   LIB(&BIBLPROG)
             MONMSG     MSGID(CPF0000)

/*N55P*/     RMVLIBLE   LIB(&BIBLEN9)
/*N55P*/     MONMSG     MSGID(CPF0000)
/*N55*/      ADDLIBLE   LIB(&BIBLEN9)
/*N55*/      MONMSG     MSGID(CPF0000)

/*N55P*/     RMVLIBLE   LIB(&BIBLEN8)
/*N55P*/     MONMSG     MSGID(CPF0000)
/*N55*/      ADDLIBLE   LIB(&BIBLEN8)
/*N55*/      MONMSG     MSGID(CPF0000)

/*N55P*/     RMVLIBLE   LIB(&BIBLEN7)
/*N55P*/     MONMSG     MSGID(CPF0000)
/*N55*/      ADDLIBLE   LIB(&BIBLEN7)
/*N55*/      MONMSG     MSGID(CPF0000)

/*N55P*/     RMVLIBLE   LIB(&BIBLEN6)
/*N55P*/     MONMSG     MSGID(CPF0000)
/*N55*/      ADDLIBLE   LIB(&BIBLEN6)
/*N55*/      MONMSG     MSGID(CPF0000)

/*N55P*/     RMVLIBLE   LIB(&BIBLEN5)
/*N55P*/     MONMSG     MSGID(CPF0000)
             ADDLIBLE   LIB(&BIBLEN5)
             MONMSG     MSGID(CPF0000)

/*N55P*/     RMVLIBLE   LIB(&BIBLEN4)
/*N55P*/     MONMSG     MSGID(CPF0000)
             ADDLIBLE   LIB(&BIBLEN4)
             MONMSG     MSGID(CPF0000)

/*N55P*/     RMVLIBLE   LIB(&BIBLEN3)
/*N55P*/     MONMSG     MSGID(CPF0000)
             ADDLIBLE   LIB(&BIBLEN3)
             MONMSG     MSGID(CPF0000)

/*N55P*/     RMVLIBLE   LIB(&BIBLEN2)
/*N55P*/     MONMSG     MSGID(CPF0000)
             ADDLIBLE   LIB(&BIBLEN2)
             MONMSG     MSGID(CPF0000)

/*N55P*/     RMVLIBLE   LIB(&BIBLEND)
/*N55P*/     MONMSG     MSGID(CPF0000)
             ADDLIBLE   LIB(&BIBLEND)
             MONMSG     MSGID(CPF0000)
             IF         COND(%SST(*LDA 461 10) *EQ '          ') +
                        THEN(CHGCURLIB  CURLIB(&BIBLPROG))
             IF         COND(%SST(*LDA 461 10) *NE '          ') +
                        THEN(CHGCURLIB  CURLIB(&BIBLDATA))
             CALL       PGM(VR006)
             IF         COND(%SST(*LDA 5 30) *EQ &BLANK) +
                          THEN(DO)
                        CALL       PGM(VR010)
                        CALL       PGM(VR005)
                        IF COND(%SST(*LDA 471 1) *EQ '1') THEN(GOTO +
                          CMDLBL(TEST))
                        CALL       PGM(VR006)
                        IF COND(%SST(*LDA 5 30) *EQ &BLANK) THEN(GOTO +
                          CMDLBL(SLUTT))
             ENDDO
     /**/
     /*     Blank ut posisjoner i LDA som brukes i VR005           */
     /*     Test om det er valgt nytt firma i fellesregistreringen */
     /*                    pos. 315 = 'A'                          */
             CHGVAR     VAR(%SST(*LDA 451 32)) VALUE(' ')
             IF         COND(%SST(*LDA 315 1) *EQ 'A') THEN(GOTO +
                          CMDLBL(TEST))
             GOTO       CMDLBL(VIDERE)
 TEST:       IF         COND(%SST(*LDA 315 1) *EQ 'A') THEN(DO)
             CHGVAR     VAR(%SST(*LDA 301 1)) VALUE('1')
             CHGVAR     VAR(%SST(*LDA 315 1)) VALUE(' ')
             GOTO       CMDLBL(VIDERE)
             ENDDO
     /**/
             IF         COND(&START *EQ ' ') THEN(GOTO CMDLBL(VIDERE))
 SLUTT:      IF         COND(&GRPANT *EQ 1) THEN(DO)
             CHGGRPA    GRPJOB(*NONE)
             RETURN
             ENDDO
             IF         COND(&GRPANT *GT 1) THEN(DO)
             ENDGRPJOB
             ENDDO
             RETURN
 VIDERE:     RTVJOBA USER(&JOBB)
             CALL       PGM(KC030) PARM(' ')
             CALL       PGM(INLIBL)
             CHGDTAARA  DTAARA(*LDA *ALL) VALUE('                     -
         ') /* Tøm LDA */
             ENDPGM
