      *
      ****************************************************************
      *** PROGRAM SKAL PLUKKE ORDRE TIL CMR                        ***
      ****************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX * 01 SH  PTF11
********************************************************************
      *
      *
     FCUNDL01   UF A E           K DISK
     FSAMCMRH   UF A E           K DISK
     FSAMCMRH1  IF   E           K DISK
     F                                     RENAME(SAMCMRHR:SAMCMRHR1)
     FSAMCMRD   UF A E           K DISK
     FTELLGE    UF A E           K DISK
     FFIRM      IF   E           K DISK
     FTURER14   IF   E           K DISK
     FHEAD14    IF   E           K DISK
     F                                     RENAME(HEADFR:HEAD9R)
     FSYEX88FS  CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     D                 DS
     D  DSSOK                  1     35
     D  DSAVD                  1      4  0
     D  DSOPD                  5     11  0
     D  DSREST                12     35
     D                 DS
     D  DSNAAD                 1     30
     D  DSNAVN                 1     15
     D  DSSK                  16     16
     D  DSSTPO                17     30
     D                 DS
     D  TUBILN                 1     10
     D  TUBIL9                 1      9
     D                 DS
     D  HEVKT                  1      9  0
     D  W2VKT                  5      9  0
     D                 DS
     D  HEM3                   1      7  3
     D  W2M3                   3      6  2
     D                 DS
     D  KU1                    1      8  0
     D  KU2                    9     16  0
     D  KU3                   17     24  0
     D  KU4                   25     32  0
     D  KU5                   33     40  0
     D  KU                     1     40  0
     D                                     DIM(5)
     D                 DS
     D  WS1                    1      1
     D  WS2                    2      2
     D  WS3                    3      3
     D  WS4                    4      4
     D  WS5                    5      5
     D  WS                     1      5
     D                                     DIM(5)
     D                 DS
     D  KN1                    1     30
     D  KN2                   31     60
     D  KN3                   61     90
     D  KN4                   91    120
     D  KN5                  121    150
     D  KN                     1    150
     D                                     DIM(5)
     D                UDS
     D  UDSFIR                 1      2
     D  UDSAVD                15     18  0
     D  USG                   19     21
     C*
     C                   EXSR      INIT
     C*
     c     visbilde      tag
     c                   exfmt     BILDECMR
      *
     c   03              goto      slutt
     C   12              GOTO      visbilde
     C     *in04         ifeq      '1'
     c                   exsr      sokkun
     c                   end
      * sjekk om plukket
     c                   exsr      tstplusr
     c     pluonl        ifeq      'J'
     c                   goto      visbilde
     c                   end
     c     kunkey        chain     cundl01                            70
     c   70              goto      visbilde
     c   04              goto      visbilde
     C                   setoff                                       33
     c     samlop        ifeq      *zeros
     C     SAMCMRHK1     CHAIN     SAMCMRH1                           33
     C  N33              exsr      movefw
     c  N33              goto      visbilde
     c                   end
     C   33              EXSR      HENTNYSR
     C     SAMCMRHK      CHAIN     SAMCMRH                            33
     C                   exsr      movewf
     C   33              WRITE     SAMCMRHR
     C  N33              UPDATE    SAMCMRHR
     C*
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '000'         *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
      *
     C                   EXSR      CALTOT
      *_____________
      * Fyll Subfile
      *"""""""""""""
      *
     C     HEAD14K       SETLL     HEAD14
     C     HEAD14K       READE     HEAD14                                 94
      *
     C     START2        TAG
      *
     C  N94              DO                                                     1<-B
     C                   DO        19                                            2<-B
     C                   ADD       1             ZRECNO
     C*
     C     SAMCMRDKH     CHAIN     SAMCMRD                            33
     C*
     C                   WRITE     SUBFIL
     C     HEAD14K       READE     HEAD14                                 94
     C  N94              END                                                      3<-E
     C                   END                                                     2<-E
     C*
     C                   MOVE      ZRECNO        XRECNO            5 0
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   EXFMT     NYWRK
     C                   ELSE
     C                   WRITE     SUBCTL
     C                   EXFMT     BUNN
     C                   END
     C*
     C                   SETOFF                                       9830
      * avslutt
     c     *IN03         IFEQ      '1'
     c                   move      usg           usgp              3
     c                   move      *zeros        samlop8           8
     c                   move      samlop        samlop8
     c                   call      'SYFA55CMR'
     c                   parm                    tuavd
     c                   parm                    usgp
     c                   parm                    tupro
     c                   parm                    samlop8
     C                   Z-ADD     1             UFLAGG
     C                   GOTO      SLUTT
     c                   end
     C   12              GOTO      visbilde
     C*
     C*** 16 plukk alle evt på agent
     C*
     C     *IN16         IFEQ      '1'
     C     *IN18         OREQ      '1'
     C                   EXSR      PLUKKA
     C                   GOTO      START
     C                   END
     C*
     C*** BLA VIDERE
     C*
     C   25              DO
     C                   Z-ADD     XRECNO        ZRECNO
     C                   SETOFF                                       25
     C                   GOTO      START2
     C                   END
     C*
     C     ZRECNO        IFNE      0
     C                   EXSR      TESTIN
     C                   END
      *
     C                   GOTO      START
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     CALTOT        BEGSR
     C***********************************************
     C                   move      *zeros        WSNT
     C                   move      *zeros        WSVKT
     C                   move      *zeros        WSM3
     C                   move      *zeros        WSLM
     C                   move      *zeros        WSNTO
     C     HEAD14K       SETLL     HEAD14
     C                   SETOFF                                       33
     C     *IN33         DOWEQ     '0'
     C     HEAD14K       READE     HEAD14                                 33
     C     *IN33         IFEQ      '0'
     C     SAMCMRDKH     CHAIN(N)  SAMCMRD                            34
     c     *in34         ifeq      '0'
     C* skip i telling dersom spørring / aktuell type ikke med
     C                   ADD       HENT          WSNT
     C                   ADD       HEVKT         WSVKT
     C                   ADD(H)    HEM3          WSM3
     C                   ADD       HELM          WSLM
     C                   ADD       1             WSNTO
     C                   END
     C                   END
     C                   END
     C*
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     TESTIN        BEGSR
     C***********************************************
     C                   MOVEA     '00'          *IN(91)
     C                   MOVEA     '00'          *IN(98)
     C     *IN98         DOWEQ     '0'                                          1<-B
     C                   READC     SUBFIL                                 98
     C     *IN98         IFEQ      '0'
     C     WSNR          IFEQ      '4'                                           2<-B
     C                   EXSR      SLETT
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   SETON                                        99
     C                   END                                                     2<-E
     C     WSNR          IFEQ      '1'                                           2<-B
     C                   EXSR      PLUKK
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   SETON                                        99
     C                   END                                                     2<-E
     C*
     C     WSNR          IFEQ      '5'                                           2<-B
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   EXSR      VISOPD
     C                   SETON                                        99
     C                   END                                                     2<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C*
     C   99              setoff                                       98
     C   98              DO
     C                   MOVE      'DIV0012'     MSGNR
     C                   SETON                                            30
     C                   END
     C*
     C     SLTST         ENDSR
     C*
     C***********************************************
     C     SLETT         BEGSR
     C***********************************************
     C*
     C                   MOVE      HEAVD         SAMAVD
     C                   MOVE      HEOPD         SAMOPD
     C     SAMCMRDK      CHAIN     SAMCMRD                            33
     C  N33              DELETE    SAMCMRDR
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     VISOPD        BEGSR
     C***********************************************
     C                   MOVE      9             UFLAGG            1 0
     C                   CALL      'SYFM21A'
     C                   PARM                    FIFIRM
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    UFLAGG
     C                   MOVE      *ZEROS        UFLAGG
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     PLUKK         BEGSR
     C***********************************************
     C                   MOVE      HEAVD         SAMAVD
     C                   MOVE      HEOPD         SAMOPD
     C     SAMCMRDK      CHAIN     SAMCMRD                            35
     C   35              WRITE     SAMCMRDR
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     SAMCMRDK      KLIST
     C                   KFLD                    SAMLOP
     C                   KFLD                    SAMAVD
     C                   KFLD                    SAMOPD
     C     SAMCMRDKH     KLIST
     C                   KFLD                    SAMLOP
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     SAMCMRHK      KLIST
     C                   KFLD                    SAMPRO
     C                   KFLD                    SAMLOP
     C     SAMCMRHK1     KLIST
     C                   KFLD                    SAMPRO
     C                   KFLD                    SAMKUNW
     C     KUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    SAMKUNW
     C     TURERK        KLIST
     C                   KFLD                    UPRON
     C     HEADFK        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     HEAD14K       KLIST
     C                   KFLD                    UPRON
     C*                  KFLD                    YKNA
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UPRO              8
     C                   MOVE      UPRO          UPRON             8 0
     C                   MOVE      UPRON         SAMPRO            8 0
     C*
     C                   Z-ADD     1             YAVD              4 0
     C                   MOVE      *BLANKS       YPOS1             8
     C                   MOVE      *ZEROS        YKNA              8 0
     C                   MOVE      *ZEROS        HEVKT
     C                   MOVE      *ZEROS        HEM3
     C                   MOVE      *ZEROS        KU
     C*
     C                   MOVE      'DIV0698'     XMSGNR            7            MELDING-ID
     C                   Z-ADD     3             XLEVEL            1 0          NIVÅ
     C                   Z-ADD     0             XRETUR            1 0          RETURKODE
     C                   Z-ADD     30            XMSGL             4 0          LENGDE PÅ MELDING
     C                   CALL      'SUBR23R3'
     C                   PARM                    XMSGNR
     C                   PARM                    XSLETT           30
     C                   PARM                    XLEVEL
     C                   PARM                    XRETUR
     C                   PARM                    XMSGL
     C*
     C                   READ      FIRM                                   33
     C     TURERK        CHAIN     TURER14                            33
     C*
     c                   exsr      regensr
     C                   ENDSR
     C*
     C***********************************************
     C     SOKKUN        BEGSR
     C***********************************************
N01   *
N01  C                   MOVE      *BLANKS       UKNAVN           30
N01  C                   CALL      'SOEKKUN'
N01  C                   PARM                    SAMKUNW
N01  C                   PARM                    FIFIRM
N01  C                   PARM                    UKNAVN
     C                   ENDSR
N01   *
     C*
     C***********************************************
     C     MOVEFW        BEGSR
     C***********************************************
     c                   MOVE      SAMKUN        SAMKUNW
     c                   MOVE      VED1          VED1W
     c                   MOVE      INS1          INS1W
     c                   MOVE      VED2          VED2W
     c                   MOVE      INS2          INS2W
     c                   MOVE      VED3          VED3W
     c                   MOVE      INS3          INS3W
     c                   MOVE      INS4          INS4W
     c                   MOVE      LEV1          LEV1W
     c                   MOVE      LEV2          LEV2W
     c                   MOVE      CFRANK        CFRANKW
     c                   MOVE      CSTED         CSTEDW
     c                   MOVE      LEV3          LEV3W
     c                   MOVE      CDATO         CDATOW
     c                   MOVE      LEV4          LEV4W
     c                   endsr
N01   *
     C*
     C***********************************************
     C     MOVEWF        BEGSR
     C***********************************************
     c                   MOVE      SAMKUNW       SAMKUN
     c                   MOVE      VED1W         VED1
     c                   MOVE      INS1W         INS1
     c                   MOVE      VED2W         VED2
     c                   MOVE      INS2W         INS2
     c                   MOVE      VED3W         VED3
     c                   MOVE      INS3W         INS3
     c                   MOVE      INS4W         INS4
     c                   MOVE      LEV1W         LEV1
     c                   MOVE      LEV2W         LEV2
     c                   MOVE      CFRANKW       CFRANK
     c                   MOVE      CSTEDW        CSTED
     c                   MOVE      LEV3W         LEV3
     c                   MOVE      CDATOW        CDATO
     c                   MOVE      LEV4W         LEV4
     c                   endsr
     C*
     C***********************************************
     C     PLUKKA        BEGSR
     C***********************************************
     C* plukker alle
     C                   move      *zeros        WSNT
     C                   move      *zeros        WSVKT
     C                   move      *zeros        WSM3
     C                   move      *zeros        WSLM
     C                   move      *zeros        WSNTO
     C     HEAD14K       SETLL     HEAD14
     C                   SETOFF                                       33
     C     *IN33         DOWEQ     '0'
     c     neste         tag
     C     HEAD14K       READE     HEAD14                                 33
     C     *IN33         IFEQ      '0'
     C     SAMCMRDKH     CHAIN(N)  SAMCMRD                            34
     c     *in18         ifeq      '1'
     c     hekna         andne     samkun
     c                   goto      neste
     c                   end
     C   34              EXSR      PLUKK
     C* skip i telling dersom spørring / aktuell type ikke med
     C                   ADD       HENT          WSNT
     C                   ADD       HEVKT         WSVKT
     C                   ADD(H)    HEM3          WSM3
     C                   ADD       HELM          WSLM
     C                   ADD       1             WSNTO
     C                   END
     C                   END
     C*
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     REGENSR       BEGSR
     C***********************************************
     C* ser etter tidligere cmr
     c                   z-add     0             nr
     C                   SETOFF                                       33
     C     TURERK        SETLL     SAMCMRH
     C     *IN33         DOWEQ     '0'
     C     turerk        READE     samcmrh                                33
     C     *IN33         IFEQ      '0'
     c                   MOVE      SAMKUN        SAMKUNW
     c     kunkey        chain     cundl01                            34
     c     nr            iflt      5
     c                   add       1             nr
     c                   MOVE      SAMKUN        ku(nr)
     C                   move      knavn         kn(nr)
     c                   end
     C                   ENDIF
     C                   ENDDO
     C*
     c                   move      *zeros        samkunw
     c                   move      *blanks       knavn
     c                   move      *zeros        samlop
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     HENTNYSR      BEGSR
     C***********************************************
     c                   move      'SAMLECMR'    GECO
     c     geco          chain     TELLGE                             33
     c   33              z-add     1             geno
     c                   z-add     geno          SAMLOP            7 0
     c                   add       1             geno
     c   33              write     tellger
     c  N33              update    tellger
     C                   ENDSR
     C*
     C***********************************************
     C     TSTPLUSR      BEGSR
     C***********************************************
     C* ser etter tidligere cmr
     c                   move      'N'           pluonl            1
     c
     c     1             do        5             nr                2 0
     C     ws(nr)        ifeq      '1'
     C     ku(nr)        andne     0
     c                   move      'J'           pluonl
     c                   move      ku(nr)        samkunw
     C     SAMCMRHK1     CHAIN     SAMCMRH1                           34
     C  N34              exsr      movefw
     C                   ENDIF
     C                   ENDDO
     C                   ENDSR
     C*
