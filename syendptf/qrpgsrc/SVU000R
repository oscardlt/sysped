********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12266 * 01 YBC PTF12 DOC_1001 er endret fra 3A til 5A OG NYTT FELT MRN
********************************************************************
     FSVU000D   CF   E             WORKSTN SFILE(SVU000DA:ZRECNO)
     F                                     INFDS(FBAREA)
     FSVUH      IF   E           K DISK
     FSVUH1     IF   E           K DISK    RENAME(SVUHR:SVUHR1)
N01  FSVUH2     IF   E           K DISK    RENAME(SVUHR:SVUHR2)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
N01  D                 DS
N01  D  MRN                    1     35
N01  D  MRN_20                 1     20
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *________________
      * Arbetsvariablar
      *""""""""""""""""
     C     *LIKE         DEFINE    ZRECNO        WRECNO
     C     *LIKE         DEFINE    *IN03         WIN03
     C     *LIKE         DEFINE    *IN03         WIN03
     C     *LIKE         DEFINE    *IN12         WIN12
     C                   MOVEA     '000010000'   *IN(41)

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR

     C     SRB1          TAG
      *______________
      * Tømme Subfile
      *""""""""""""""
     C                   EVAL      *IN93=*ON
     C                   WRITE     SVU000DB
     C                   MOVEA     '000'         *IN(93)
     C                   Z-ADD     *ZERO         ZRECNO
     C                   Z-ADD     *ZERO         WRECNO
      *_____________
      * Fyll Subfile
      *"""""""""""""

N01  C                   SELECT
N01  C                   WHEN      ZS_1004 <> *BLANKS
N01  C     ZS_1004       SETLL     SVUH
N01  C                   READ      SVUH                                   94
N01  C                   WHEN      ZS_MRN <> *BLANKS
N01  C     ZS_MRN        SETLL     SVUH2
N01  C                   READ      SVUH2                                  94
N01  C                   OTHER
     C     *HIVAL        SETLL     SVUH1
     C                   READP     SVUH1                                  94
N01  C                   ENDSL

     C     SRB2          TAG
     C  N94              DO
     C                   DO        256
     C                   ADD       1             ZRECNO
     C                   WRITE     SVU000DA
     C                   MOVE      ZRECNO        XRECN2            5 0
N01  C                   SELECT
N01  C                   WHEN      ZS_1004 <> *BLANKS
N01  C                   READ      SVUH                                   94
N01  C                   WHEN      ZS_MRN <> *BLANKS
N01  C                   READ      SVUH2                                  94
N01  C                   OTHER
     C                   READP     SVUH1                                  94
N01  C                   ENDSL
     C  N94              ENDDO
     C                   ENDDO
     C                   MOVE      ZRECNO        XRECNO            5 0

     C     ZRECNO        IFEQ      0
     C                   CLEAR                   SVU000DA
     C                   ADD       1             ZRECNO
     C                   WRITE     SVU000DA
     C                   ENDIF
     C                   EVAL      WRECNO=ZRECNO
     C                   EVAL      ZRECNO=1
      *_______________
      * Behandle bilde
      *"""""""""""""""
     C     SRB3          TAG

     C                   MOVEA     '11'          *IN(91)
     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     SVU000DØ
     C                   WRITE     SVU000DC
     C                   EXFMT     SVU000DB
     C                   EVAL      *IN30=*OFF
     C                   EVAL      *IN31=*OFF

     C     *IN03         IFEQ      '0'
     C     *IN08         ANDEQ     '0'
     C     *IN12         ANDEQ     '0'

     C                   MOVEA     '00'          *IN(91)
      *_____________
      * F5=Frisk opp
      *"""""""""""""
     C     *IN05         CABEQ     '1'           SRB1
      *_____________
      * F25=Bla frem
      *"""""""""""""
     C   25              DO
     C                   Z-ADD     XRECNO        ZRECNO
KING C     DOC_1004      CHAIN     SVUH                               33
     C                   SETOFF                                       25
     C                   GOTO      SRB2
     C                   END
      *_______
      * Valg ?
      *"""""""
     C                   EVAL      *IN52=*OFF
     C                   EVAL      *IN95=*OFF
     C     *IN52         DOWEQ     '0'

     C                   READC     SVU000DA                               52
     C     *IN52         IFEQ      '0'
     C     ZOP           IFNE      *BLANKS
     C     ZOP           ANDNE     '5'
     C     ZOP           ANDNE     'P'
     C     ZOP           ANDNE     'A'
     C                   ENDIF

     C     ZOP           CASEQ     '5'           SRBE                           Vise
     C     ZOP           CASEQ     'P'           SRBP                           Skriv ut
     C     ZOP           CASEQ     'A'           SRAR                           Skriv ut
     C                   ENDCS
     C                   ENDIF
      *
     C  N52              ENDDO

     C     *IN03         CABEQ     '1'           SRB9
     C     *IN12         CABEQ     '1'           SRB3
     C                   GOTO      SRB1

     C                   ENDIF

     C     *IN08         IFEQ      '1'
     C     *IN12         OREQ      '1'
     C                   EXSR      SRB0
     C     *IN03         CABEQ     '0'           SRB1
     C                   ENDIF

     C     SRB9          ENDSR
      *////////////////////////////////////////////////////////////
      *  Start søking                                        SRB0 /
      *////////////////////////////////////////////////////////////
     C     SRB0          BEGSR

N01  C                   EVAL      ZS_1004 = *BLANKS
N01  C                   EVAL      ZS_MRN  = *BLANKS
     C     SRB01         TAG
     C                   EXFMT     SVU000DD
     C                   MOVEA     '0000'        *IN(96)
     C                   SETOFF                                       30

     C   03              DO
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END

     C                   EXSR      TESTB1
     C   30              GOTO      SRB01

     C                   ENDSR
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Vise                                                SRBE /
      *////////////////////////////////////////////////////////////
     C     SRBE          BEGSR

KING C     DOC_1004      CHAIN     SVUH                               33

     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    SVU000DA

     C                   EXFMT     SVU000DE

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Skriv ut                                            SRBP /
      *////////////////////////////////////////////////////////////
     C     SRBP          BEGSR
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    SVU000DA
      *________________________
      * call på externt program
      *""""""""""""""""""""""""
     C                   CALL      'SVU002R'
     C                   PARM                    DOC_1004
     C                   PARM      'P'           CALLTYP           1
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Arkiv                                               SRAR /
      *////////////////////////////////////////////////////////////
     C     SRAR          BEGSR
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    SVU000DA
      *________________________
      * call på externt program
      *""""""""""""""""""""""""
     C                   CALL      'ARC003'
     C                   PARM      0             avd               4 0
     C                   PARM      0             opd               7 0
     C                   PARM                    DOC_1004
     C                   ENDSR
