     H*DEBUG(*YES)
      *_______________________
      * DS For incoming string
      *"""""""""""""""""""""""
     Fcundc03   IF   E           K DISK
     FKUNDL01   IF   E           K DISK
     FMAILSPL1  UF A E           K DISK
     FFIRM      IF   E           K DISK
     FKORTL06   IF   E           K DISK
     Fhordl11   IF   E           K DISK
     Fdordl12   IF   E           K DISK
     Fdordl09   IF   E           K DISK
     F                                     RENAME(DORDR:DORDR09)
     F                                     RENAME(HDORR:DORDR07)
     Fmailwork  IF   E           K DISK    USROPN
     D                 DS
     D  USRDTA                 1     10
     D  USRDTA01               1      1
     D  USRDTA02               1      2
     D  USRDTA03               2      3
     D  USRDTA04               4     10
     D                 DS
     D  syatxt                 1    132
     D  TXT                    1    132
     D                                     DIM(132)
     D  KUTXT                 79     86
     D  KUTXT2                78     85
     D  UOPP                  20     23
     D  UOPP2                 27     34
     D  KUTXT3                98    105
     D  KUTXT3N              113    120
      *
     c                   exsr      init
      *
     C     START         TAG
     C                   MOVE      *BLANKS       SYATXT
     C                   MOVE      *BLANKS       SYATXT
      * HENTE KUNDE FRA HORDF ordrenummer
     C     USRDTA01      IFEQ      'O'
     c                   exsr      HORDFSR
     C                   END
      * HENTE KUNDE FRA DORDF fakturanr
     C     USRDTA01      IFEQ      'F'
     c                   exsr      DORDFSR
     C                   END
      * HENTE KUNDE FRA DORDF pakkseddel
     C     USRDTA01      IFEQ      'P'
     c                   exsr      DORDFSR2
     C                   END
      *
      * hold tilbake print
     C     USRDTA02      IFEQ      'KU'
     c                   exsr      chgusrdta
     c*                  dump
      *_____________________
      * cpysplf TIL FIL HVIS IKKE KUNDE I USRDTA
      *""""""""""""""""""""
     C                   else
     C                   CALL      'MAIL01T'
     C                   PARM                    UJOBNO
     C                   PARM                    UUSER
     C                   PARM                    UJOBNA
     C                   PARM                    UFILE
     C                   PARM                    USNBRN
     C
     c                   exsr      finnku
     C                   END
      *
     c                   exsr      skrivfil
     C                   MOVE      '1'           *INLR
     c                   return
     c**********************************************************************
     c     INIT          begsr
     c**********************************************************************
     c     *entry        plist
     c                   parm                    uuser            10
     c                   parm                    ujobna           10
     c                   parm                    ujobno            6
     c                   parm                    ufile            10
     c                   parm                    unbr              2
     c                   parm                    uusrdt           10
     c                   parm                    udateu            6
      *
     c                   move      uusrdt        usrdta
     c                   move      unbr          usnbrn            2 0
      *
     c     kunkey        klist
     c                   kfld                    fifirm
     c                   kfld                    kundnr
      *
      *
     c     cundck        klist
     c                   kfld                    fifirm
     c                   kfld                    typdok
     c                   kfld                    kundnr
      *
     c     loggk         klist
     c                   kfld                    Xjobna
     c                   kfld                    Xuser
     c                   kfld                    xjobno
     c                   kfld                    xsnbra
     c                   read      firm                                   33
      *
      *__________________________
      * Receive record from dataq
      *""""""""""""""""""""""""""
      *
      * hent brukers mailadresse
      *
     c                   call      'MAIL01T3'
     c                   parm                    uuser
     c                   parm                    til              70
     c                   endsr
     c**********************************************************************
     c     finnku        begsr
     c**********************************************************************
     c                   movel     'NN        '  usrdta
     c                   move      *zeros        kundnr            8 0
     c                   move      *zeros        xkundn
     c                   move      *blanks       xnavn
     c                   setoff                                       33
     c                   open      mailwork
     c     *in33         doweq     '0'
     c                   read      mailwork                               33
      *
      * pos 79
      *
     c  N33kutxt         ifeq      'KUNDENR.'
     c     kutxt         oreq      'CUST.NO.'
     c     kutxt         oreq      'KUNDENNR'
     c                   read      mailwork                               33
     c     *in33         ifeq      '0'
     c                   movel     'KU'          usrdta
     c                   move      kutxt         kundnr
     c                   exsr      flyttku
     c                   goto      ut
     c                   end
     c                   end
      *
      * pos 78
      *
     c  N33kutxt2        ifeq      'KUNDENR.'
     c     kutxt2        oreq      'CUST.NO.'
     c     kutxt2        oreq      'KUNDENNR'
     c     kutxt2        oreq      'UNDENNR.'
     c                   read      mailwork                               33
     c     *in33         ifeq      '0'
     c                   movel     'KU'          usrdta
     c                   move      kutxt2        kundnr
     c                   exsr      flyttku
     c                   goto      ut
     c                   end
     c                   end
      *
      * uoppgjorte poster debitorer
      *
     c     ufile         ifeq      'DR180U01  '
     c  N33UOPP          ifeq      'Fra:'
     c                   movel     'KU'          usrdta
     c                   move      UOPP2         kundnr
     c                   exsr      flyttku
     c                   goto      ut
     c                   end
     c                   end
      *
      * Kontoutskrift
      *
     c     ufile         ifeq      'DR050U01  '
     c  N33kutxt3        ifeq      'Kundenr.'
     c                   movel     'KU'          usrdta
     c                   move      kutxt3n       kundnr
     c                   exsr      flyttku
     c                   goto      ut
     c                   end
     c                   end
     c                   end
     c     ut            tag
     c                   exsr      chgusrdta
     c                   close     mailwork
     c                   endsr
     c**********************************************************************
     c     chgusrdta     begsr
     c**********************************************************************
     c                   move      usrdta        uuuusr           10
     C                   CALL      'MAIL01T2'
     C                   PARM                    UJOBNO
     C                   PARM                    UUSER
     C                   PARM                    UJOBNA
     C                   PARM                    UFILE
     C                   PARM                    USNBRn
     C                   PARM                    UUUUSR
     c                   endsr
     c**********************************************************************
     c     flyttku       begsr
     c**********************************************************************
     c                   move      kundnr        usrdta
     c                   move      kundnr        xkundn
     c     kunkey        chain     kundl01                            34
     c  N34              move      knavn         xnavn
     c                   move      ufile         ufile11          11
     c                   movel     '*'           ufile11          11
     c                   movel     ufile11       typdok           30
     c     cundck        chain     cundc03                            34
     c     *in34         ifeq      '0'
     c                   exsr      cusr
     c*                  movel     cemail        til
     c                   else
     c     kunkey        chain     kortl06                            34
     c     *in34         ifeq      '0'
     c     emnrko        andne     *blanks
     c                   move      *blanks       til
     c                   movel     emnrko        til
     c                   end
     c                   end
     c                   endsr
     c**********************************************************************
     c     skrivfil      begsr
     c**********************************************************************
     c                   movel     UUSER         xUSER            10
     c                   movel     UJOBNA        xJOBNA           10
     c                   movel     UJOBNO        xJOBNO            6
     c                   MOVE      UNBR          xSNBRA            2
     c     loggk         chain     mailspl1                           33
     C  N33              DELETE    MAILSPR
     c                   movel     UFILE         xFILE            10
     c                   movel     USRDTA        xUSRDT           10
     c                   movel     TIL           xTIL             70
     c                   movel     TIL2          xTIL2            70
     c                   movel     TIL3          xTIL3            70
     c                   movel     TIL4          xTIL4            70
     c                   movel     TIL5          xTIL5            70
     c                   movel     udateu        xdate
     C                   WRITE     MAILSPR
     C                   ENDSR
     c**********************************************************************
     c     cusr          begsr
     c**********************************************************************
     c     cundck        setll     cundc03
     c     cundck        reade     cundc03                                34
     c  N34              movel     cemail        til
     c  N34cundck        reade     cundc03                                34
     c  N34              movel     cemail        til2             70
     c  N34cundck        reade     cundc03                                34
     c  N34              movel     cemail        til3             70
     c  N34cundck        reade     cundc03                                34
     c  N34              movel     cemail        til4             70
     c  N34cundck        reade     cundc03                                34
     c  N34              movel     cemail        til5             70
     c                   setoff                                       34
     c                   endsr
     c**********************************************************************
     c     hordfsr       begsr
     c**********************************************************************
     c     hordkey       klist
     c                   kfld                    fifirm
     c                   kfld                    fitype            1
     c                   kfld                    fiaar             4 0
     c                   kfld                    fiordnr           7 0
     c                   move      'O'           fitype
     c                   z-add     2000          fiaar
     c                   move      usrdta03      fiaar
     c                   move      usrdta04      fiordnr
     c     hordkey       chain     hordl11                            33
     c  N33              movel     'KU'          usrdta
     c  N33              move      kundnr        usrdta
     c  n33              exsr      flyttku
     c                   endsr
     c**********************************************************************
     c     dordfsr       begsr
     c**********************************************************************
     c     dordkey       klist
     c                   kfld                    fifirm
     c                   kfld                    fitype            1
     c                   kfld                    fiaar             4 0
     c                   kfld                    fifaknr           7 0
     c                   move      'O'           fitype
     c                   z-add     2000          fiaar
     c                   move      usrdta03      fiaar
     c                   move      usrdta04      fifaknr
     c     dordkey       chain     dordl12                            33
     c  N33              movel     'KU'          usrdta
     c  N33              move      kundnr        usrdta
     c  n33              exsr      flyttku
     c                   endsr
     c**********************************************************************
     c     dordfsr2      begsr
     c**********************************************************************
     c     dordkey2      klist
     c                   kfld                    fifirm
     c                   kfld                    fitype            1
     c                   kfld                    fiaar             4 0
     c                   kfld                    fipaks            7 0
     c                   move      'O'           fitype
     c                   z-add     2000          fiaar
     c                   move      usrdta03      fiaar
     c                   move      usrdta04      fipaks
     c     dordkey2      chain     dordl09                            33
     c  N33              movel     'KU'          usrdta
     c  N33              move      kundnr        usrdta
     c  n33              exsr      flyttku
     c                   endsr
