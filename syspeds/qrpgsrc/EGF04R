     FINFIL     IF   F   80        DISK
     FEDIS      UF   E           K DISK
     FEDII      IF   E           K DISK
     FEDIJ2     IF   E           K DISK
     FEDISE     O  A E             DISK
     FEDISS     O  A E             DISK
      *____________________
      * DS for input string
      *""""""""""""""""""""
     D                 DS
     D  A                      1     80
     D                                     DIM(80)                              Input string
     D  ADS                    1     80
      *_____________________
      * DS for output string
      *"""""""""""""""""""""
     D                 DS
     D  B                      1     80
     D                                     DIM(80)                              Output string
     D  SDATA                  1     80
      *________________________________________
      * DS for å venstrestille numeriske felter
      *""""""""""""""""""""""""""""""""""""""""
     D                 DS
     D  ØN152                  1     15  2
     D  ØA152H                 1     13
     D  ØA152X                 5     13
     D  ØA152D                14     15
     D                 DS
     D  ØA12                   1     12
     D  Ø12                    1     12
     D                                     DIM(12)                              Num edit
      *____________
      *  DS for DLM
      *""""""""""""
     D                 DS
     D  WALFA                  1      3
     D  WALFA1                 1      1
     D  WALFA2                 2      2
     D  WALFA3                 3      3
     IINFIL     AA  09
     I                                  1   80  INDATA
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   EXSR      SRC
     C                   EXSR      SRD
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    SSN           WSN
     C     *LIKE         DEFINE    S0036         W0036
     C     *LIKE         DEFINE    JCLFE         WCLFE
     C     *LIKE         DEFINE    SST           WST
     C                   Z-ADD     0             ØX                2 0
     C                   MOVE      *BLANKS       ØAN              12
     C                   Z-ADD     0             W0074             6 0
     C                   MOVE      *BLANKS       UIN02             1
     C                   MOVE      *BLANKS       UIN03             1
     C                   MOVEL     *BLANKS       UWS              10
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYA          KLIST
     C                   KFLD                    WSN
     C     KEYC          KLIST
     C                   KFLD                    S0004
     C                   KFLD                    S0010
     C                   KFLD                    WCLFE
      *_____________
      * Init av felt
      *"""""""""""""
      * Hente dagens dato og klokkeslett.
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      *BLANKS       WST
     C                   Z-ADD     0             W0036
      * Workfields for Array's
     C                   Z-ADD     0             AX                2 0          Index for A
     C                   Z-ADD     1             BX                2 0          Index for B
     C                   Z-ADD     0             AXV               2 0          Leftindx A
     C                   Z-ADD     0             AXH               2 0          Rightindx A
     C                   MOVE      'R'           WDIR              1            Search direction
      *                                                    L=LEFT
      *                                                    R=RIGHT
      *                                                    N=HOLE STRING
     C                   MOVE      *BLANKS       WCHAR             1            Test character
     C                   MOVE      'Y'           WCHART            1            Test character
     C                   MOVE      *BLANKS       WCONT             5            Continues
      * Workfields for separation character  '
     C                   BITON     '123457'      WAPSTR            1
     C                   BITOFF    '06'          WAPSTR
      * Workfields for DLM
     C                   BITON     '12345'       WALFA1
     C                   BITOFF    '067'         WALFA1
     C                   MOVE      WALFA1        WALFA2
     C                   MOVE      WALFA1        WALFA3
      * Workfields for NIT FMS record
     C**                   MOVE 'FMS01'   FMS01
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C     WSN           PARM                    WSN
     C     FMS1          PARM                    FMS1             80
     C     FMS2          PARM                    FMS2             80
      *__________________
      * Output parametrer
      *""""""""""""""""""
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Start av file                                        SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
      *_____________________________
      * Hente data fra sendningslogg
      *"""""""""""""""""""""""""""""
     C     KEYA          CHAIN     EDIS                               81
     C                   Z-ADD     0             W0036
      * HENT NETTVERKSKODE PÅ MOTTAKER
     C                   MOVEL     S0010         W0010            35
     C     W0010         CHAIN     EDII                               20
      * Hent komponentnavn
     C                   EVAL      SEMBR=SMBR
      *__________________________________________
      * Legg in JCL i starten av filen for NIT
      *""""""""""""""""""""""""""""""""""""""""""
     C     INNETW        IFEQ      '1'
     C                   EXSR      NITSR
     C                   END
      *__________________________________________
      * Legg in CMD i starten av filen for IBM IN
      *""""""""""""""""""""""""""""""""""""""""""
     C     INNETW        IFEQ      '2'
     C                   EXSR      SNUFA
     C                   END
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  LAGE INNEHOLD                                        SRC /
      *////////////////////////////////////////////////////////////
     C     SRC           BEGSR

      * Legg in eventuell FMS-record NR 1
     C     FMS1          IFNE      *BLANKS
     C                   MOVE      *BLANKS       ADS
     C                   MOVE      FMS1          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     80            AXH
     C                   MOVE      'N'           WDIR
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      * Legg in eventuell FMS-record NR 2
     C     FMS2          IFNE      *BLANKS
     C                   MOVE      *BLANKS       ADS
     C                   MOVE      FMS2          ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     80            AXH
     C                   MOVE      'N'           WDIR
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   END
      * Hent alle poster i aktuell transaksjonsfil
     C                   READ      INFIL                                  20
     C     *IN20         DOWEQ     '0'

     C                   MOVE      *BLANKS       ADS
     C                   MOVE      INDATA        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     80            AXH
     C                   MOVE      'N'           WDIR
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ
     C                   ADD       1             W0036

     C                   READ      INFIL                                  20
     C                   ENDDO

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Slutt på file                                        SRD /
      *////////////////////////////////////////////////////////////
     C     SRD           BEGSR
      *____________
      * End of data
      *""""""""""""
      *
      *_______________________________________________
      * Siste linje må ikke være exakt 80 ved IN-net
      *"""""""""""""""""""""""""""""""""""""""""""""""
     C     INNETW        IFEQ      '2'
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WALFA         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     3             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C     BX            IFGT      1
     C                   WRITE     EDISER
     C                   END
     C                   END
      *_______________________________________________
      * Legg in JCL i slutten av filen for Kommunedata
      *"""""""""""""""""""""""""""""""""""""""""""""""
     C     INNETW        IFEQ      '1'
     C                   MOVE      'E'           WCLFE
     C     KEYC          CHAIN     EDIJ2                              81
     C     *IN81         DOWEQ     '0'
     C                   MOVE      JCLC          SDATA
     C                   WRITE     EDISER
     C     KEYC          READE     EDIJ2                                  81
     C  N81              END
     C                   END
      *________________________
      * Oppdatere sendningslogg
      *""""""""""""""""""""""""
     C                   MOVE      'A'           SST
     C                   Z-ADD     W0036         S0036                          * ANT LINJER
     C                   UPDATE    EDISR
      * SKRIV POST TIL DETALJ LOGG
     C                   CLEAR                   EDISSR
     C                   Z-ADD     SSN           SSSN
     C                   MOVEL     WDT           SSDT
     C                   MOVEL     WTM           SSTM
     C                   MOVEL     SST           SSST
     C                   EVAL      SSTEXT='File created'
     C                   WRITE     EDISSR
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * SR for output string, read input from left              SRÅ
      *////////////////////////////////////////////////////////////
     C     SRÅ           BEGSR
      *_______________
      * Find positions
      *""""""""""""""""
      * Find first non-0 position
     C                   SELECT

     C     WDIR          WHENEQ    'L'
     C     AXV           DO        AXH           AXV
     C     A(AXV)        COMP      '0'                                  8383
     C   83              END
      * Find last non-blank position
     C     WDIR          WHENEQ    'R'

     C     SRÅ01         TAG

     C     AXH           IFGT      AXV
     C     A(AXH)        IFEQ      *BLANKS
     C                   SUB       1             AXH
     C                   GOTO      SRÅ01
     C                   END
     C                   END

     C                   ENDSL
     C                   MOVE      'R'           WDIR
      *________________________________________________
      * Read input string and place it in output string
      *""""""""""""""""""""""""""""""""""""""""""""""""
     C     AXV           DO        AXH           AXV                            <-------------I
     C                   MOVE      A(AXV)        WCHAR                                        I
      * If invalid character (' + : ?) then replace with 'Ø'             I
     C     WCHART        IFEQ      'Y'                                           <-----------II
     C     WDIR          IFEQ      'R'                                            <---------III
     C     WDIR          OREQ      'N'                                            <---------III
     C     WCHAR         IFEQ      ';'                                                      III
     C                   MOVE      ','           WCHAR                                        I
     C                   ENDIF                                                   <-----------II
     C     WCHAR         COMP      WAPSTR                                 83                III
     C  N83WCHAR         COMP      '+'                                    83                III
     C  N83WCHAR         COMP      ':'                                    83                III
     C  N83WCHAR         COMP      '?'                                    83                III
     C   83              EXSR      SRÅA                                                     III
     C                   END                                                      <---------III
     C                   END                                                     <-----------II
      * Move to output string                                            I
     C                   MOVE      WCHAR         B(BX)                                        I
     C                   ADD       1             BX                                           I
      * If arrayindex for output array is over 80 Then add a record      I
     C     BX            IFGT      80                                            <-----------II
     C                   WRITE     EDISER                                                    II
     C                   Z-ADD     1             BX                                          II
     C                   MOVE      *BLANKS       SDATA                                       II
     C                   END                                                     <-----------II

     C                   END                                                    <-------------I

     C                   MOVE      'Y'           WCHART

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * SR for replace control characters                      SRÅA
      *////////////////////////////////////////////////////////////
     C     SRÅA          BEGSR
      * Move '?' before the character
     C                   MOVE      '?'           B(BX)
     C                   ADD       1             BX
     C     BX            IFGT      80                                           <-------------I
     C                   WRITE     EDISER                                                     I
     C                   Z-ADD     1             BX                                           I
     C                   MOVE      *BLANKS       SDATA                                        I
     C                   END                                                    <-------------I

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Venstrestill numeriske verdier                      SRNE /
      *////////////////////////////////////////////////////////////
     C     SRNE          BEGSR
      * Flytte in rett verdi i Alfa 12-felt
     C                   MOVE      *ZEROS        ØA12
     C     ØA152D        IFEQ      '00'                                         <-------------I
     C                   MOVE      ØA152H        ØA12                                         I
     C                   ELSE                                                   <-------------I
     C                   MOVEL     ØA152X        ØA12                                         I
     C                   MOVE      ',  '         ØA12                                         I
     C                   MOVE      ØA152D        ØA12                                         I
     C                   END                                                    <-------------I
      * lete fra venstre og finn foerste siffer over 0
     C     1             DO        11            ØX                             <-------------I
     C     Ø12(ØX)       IFNE      '0'                                           <-----------II
     C                   GOTO      SRNE1                                                     II
     C                   END                                                     <-----------II
     C                   END                                                    <-------------I
     C     SRNE1         TAG
      * Venstrestill til et nytt felt
     C                   MOVE      *BLANKS       ØAN
     C                   MOVEA     Ø12(ØX)       ØAN

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Lage JCL   for NIT                                 NITSR /
      *////////////////////////////////////////////////////////////
     C     NITSR         BEGSR

     C                   MOVE      'F'           WCLFE
     C     KEYC          CHAIN     EDIJ2                              81
     C     *IN81         DOWEQ     '0'
     C                   MOVE      JCLC          SDATA
     C                   WRITE     EDISER
     C     KEYC          READE     EDIJ2                                  81
     C  N81              END
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Lage "CMD" for IBM IN via SNUF                     SNUFA /
      *////////////////////////////////////////////////////////////
     C     SNUFA         BEGSR
      *_________
      * SEND-CMD
      *"""""""""
     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'SEND'        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     4             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ' '           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'NICKNAME'    ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '('           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     S0010         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ')'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ' '           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'CLASS'       ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     5             AXH
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '('           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'TARZAN'      ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     WAPSTR        ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ')'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ' '           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     'MSGNAME'     ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     7             AXH
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     '('           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     S0020         ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     8             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ')'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   MOVE      *BLANKS       ADS
     C                   MOVEL     ';'           ADS
     C                   Z-ADD     1             AXV
     C                   Z-ADD     1             AXH
     C                   MOVE      'N'           WCHART
     C                   EXSR      SRÅ

     C                   ENDSR
