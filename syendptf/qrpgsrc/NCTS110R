      * START Customs office
XXX   * MIDLETIDIG ENDRING
      * For å kompilere: ADDLIBLE LIB(LIBHTTP) POSITION(*LAST)
      *----------------------------------------------------------------
      * Program sender IE15, IE13 (endring) og IE170 (presentasjon)
      *----------------------------------------------------------------
     H DftActGrp(*No)
     FEDIC      UF   E             DISK
     FEDIS      O  A E             DISK
     FEDIM      UF   E           K DISK
     FTRUGH     UF   E           K DISK
      /copy ifsio_h
     D EDIDTA          DS           256
     D  UELIBF               171    180
     D                 DS
     D  WMBR                   1     14
     D  WMBRA                  1      1
     D  WMBRB                  2     10  0
     D                 DS
     D  XDT                    1      8
     D  XDTA                   1      4
     D  XDTM                   5      6
     D  XDTD                   7      8
     D                 DS
     D  XTM                    1      6
     D  XTMH                   1      2
     D  XTMM                   3      4
     D  XTMS                   5      6
      *
     D FILE_o          s             10I 0
     D String          s            512a
     D rc              s             10i 0
     D CmdLine         S            512
     D CmdLen          S             15  5
     D LF              c                   x'25'
     D XCHGAUT         s            200A
     D XTXT500         S            500A
     D RunCmd          PR                  EXTPGM('QCMDEXC')
     D  Cmd                         200A   CONST
     D  Len                          15P 5 CONST
      *
     D                 DS
     D  XTXT801                1     80
     D  XT801                  1     80    DIM(80)
     D                 DS
     D  XTXT802                1     80
     D  XT802                  1     80    DIM(80)
     D                SDS
     D  ZUSER                254    263
      *//////////////
      *  Hodelogikk /
      *//////////////
      * Initiering av variabler og nøkler
     C                   EXSR      SRA
      * Plukk NCTS og send til Tollvesenet
     C                   EXSR      SRC
      * Avsluttning av sending
     C                   EXSR      SRD
     C                   MOVE      '1'           *INLR
      *
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
      *_____________
      * Init av felt
      *"""""""""""""
      * Hente dagens dato og klokkeslett.
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           XIDAG             8 0
     C                   MOVE      WDT           XDT
     C                   MOVE      WTM           XTM
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    UMN               9 0
     C                   PARM                    UGNR             24
      *
     C     *DTAARA       DEFINE                  EDIDTA
     C                   IN        EDIDTA
     C                   MOVE      *BLANKS       XDATA          1024
     C                   BITON     '123457'      XAPS              1
     C                   BITOFF    '06'          XAPS
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Les meldinger                                        SRC /
      *////////////////////////////////////////////////////////////
     C     SRC           BEGSR
      *
     C     UMN           CHAIN     EDIM                               33
     C                   IF        *IN33 = *OFF                                 1<-B
     C     1             CHAIN     EDIC                               33
     C                   ADD       1             CSN
     C                   UPDATE    EDICR
      *
     C     UGNR          CHAIN     TRUGH                              33
     C                   IF        *IN33 = *OFF                                  2<-B
XXX  C*                  MOVE      'A'           TGST
XXX  C                   MOVE      ' '           TGST
     C                   UPDATE    TRUGHR
     C                   Z-ADD     CSN           MSN
     C                   MOVE      'A'           MST
     C                   MOVEL     WDT           MDT
     C                   MOVEL     WTM           MTM
     C                   UPDATE    EDIMR
     C                   SELECT                                                   3<-B
     C     M1N07         WHENEQ    '026'
     C                   EXSR      CHGACC
     C                   ENDSL                                                    3<-E
     C                   ELSE                                                    2
     C                   UPDATE    EDIMR
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Slutt på file                                        SRD /
      *////////////////////////////////////////////////////////////
     C     SRD           BEGSR
      *________________________
      * Oppdatere sendningslogg
      *""""""""""""""""""""""""
     C                   EVAL      WMBRA = 'S'
     C                   EVAL      WMBRB = CSN
     C                   EVAL      S0004  = M0004
     C                   EVAL      S0010  = M0010
     C*                  EVAL      S0020  = WMBR
     C                   EVAL      S0020  = 'SG' + UGNR
     C                   EVAL      SSN    = CSN
     C                   EVAL      SSR    = 'S'
XXX  C*                  EVAL      SST    = 'A'
XXX  C                   EVAL      SST    = 'X'
     C                   EVAL      S0036  = 1
     C                   MOVEL     WDT           SDT
     C                   MOVEL     WTM           STM
     C                   EVAL      SFILE  = '*IFS'
     C                   EVAL      SMBR   = WMBR
     C                   EVAL      SLIB   = '*LIBL'
     C                   EVAL      SIFS   = WFILNAM2
     C                   WRITE     EDISR
      *
     C                   ENDSR
      *
      */////////////////////////////////////////////////////////////
      * Send ny aksess kode til Tollvesnet                         /
      */////////////////////////////////////////////////////////////
     C     CHGACC        BEGSR
      * Lag fil og set codepage (pc)
     C                   MOVE      *BLANKS       WFilNam         256
     C                   EVAL      WFilNam= '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/NCTS_'
     C                             + %TRIM(UGNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_014.xml'
     C                   MOVE      *BLANKS       WFilNam2        256
     C                   EVAL      WFilNam2 = '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/BACKUP/NCTS_'
     C                             + %TRIM(UGNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_026.xml'
      * 1208 = UTF-8
     C                   eval      FILE_o = open( %TrimR( WFilNam2 )
     C                               : O_CREAT+O_TRUNC+O_WRONLY
     C                                + O_TEXT_CREAT+O_CCSID+O_TEXTDATA
     C                               : S_IRUSR + S_IWUSR
     C                               : 1208
     C                               : 0)
      *
     C                   EVAL      XDATA = '<?xml version="1.0" '
     C                             + 'encoding="UTF-8" standalone="yes"?>'
     C*                            + 'encoding="UTF-8" standalone="true"?>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<ns2:CC026C '
     C                             + 'xmlns:ns2="http://ncts.dgtaxud.ec">'
     C                   EXSR      OPDFIL
      *
     C                   EXSR      SRMESSAGEACC
      *
     C                   EVAL      XDATA = '</ns2:CC026C>'
     C                   EXSR      OPDFIL
      *
     C                   callp     close( FILE_o )
     C                   EVAL      XCHGAUT = 'CHGAUT OBJ(' + XAPS
     C                             + %TRIM(WFilNam2) + XAPS
     C                             + ') USER(*PUBLIC) DTAAUT(*RWX) OBJAUT(*ALL)'
     C                   CALLP     RUNCMD(XCHGAUT:200)
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Message                                     SRMESSAGEACC /
      *////////////////////////////////////////////////////////////
     C     SRMESSAGEACC  BEGSR
      *
     C                   EVAL      XDATA = '<messageSender>'
     C                             + %TRIM(M0004) + '</messageSender>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<messageRecipient>'
     C                             + %TRIM(%SUBST(M0010:1:8))
     C                             + '</messageRecipient>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<preparationDateAndTime>'
     C                             + %TRIM(XDTA) + '-' + %TRIM(XDTM) + '-'
     C                             + %TRIM(XDTD) + 'T' + %TRIM(XTMH) + ':'
     C                             + %TRIM(XTMM) + ':' + %TRIM(XTMS)
     C                             + '</preparationDateAndTime>'
     C                   EXSR      OPDFIL
     C                   CALL      'UUIDC'
     C                   PARM                    U_UUID           36
     C                   EVAL      XDATA = '<messageIdentification>'
     C                             + %SUBST(U_UUID:1:35)
     C                             + '</messageIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<messageType>'
     C                             + 'CC026C' + '</messageType>'
     C                   EXSR      OPDFIL
      *
     C*                  EVAL      XDATA = '<correlationIdentifier>'
     C*                            + 'O' + '</correlationIdentifier>'
     C*                  EXSR      OPDFIL
      *
      * Holder of the transit procesure
     C                   EVAL      XDATA = '<HolderOfTheTransitProcedure>'
     C                   EXSR      OPDFIL
     C                   IF        TGTINA <> *BLANKS
     C                   EVAL      XTXT801 = TGTINA
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C                   IF        TGTINA = *BLANKS
      *
     C                   EVAL      XTXT801 = TGNAA
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TGADA1
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TGPNA
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TGPSA
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(TGLKA) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
      *
     C                   END
      *
     C                   EVAL      XDATA = '</HolderOfTheTransitProcedure>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<CustomsOfficeOfGuarantee>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(TGTSD)
     C                             + '</referenceNumber>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '</CustomsOfficeOfGuarantee>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<GuaranteeReference>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<GRN>' + %TRIM(TGGNR) + '</GRN>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<masterAccessCode>'
     C                             + %TRIM(TGAKGM) + '</masterAccessCode>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '</GuaranteeReference>'
     C*                  EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<AccessCode>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<accessCodeCurrent>'
     C                             + %TRIM(TGAKGM) + '</accessCodeCurrent>'
     C*                  EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<accessCodeNew>'
     C                             + %TRIM(TGAKNY) + '</accessCodeNew>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '</AccessCode>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '</GuaranteeReference>'
     C                   EXSR      OPDFIL
      *
     C                   ENDSR
      *
      ***********************************************
     C     OPDFIL        BEGSR
      ***********************************************
     C                   EVAL      XDATA=(%trimr(XDATA))+ LF
     c                   callp     write(File_o : %addr(Xdata)
     c                                : %len(%trimr(Xdata)) )
      *
     C                   ENDSR
      *
      ***********************************************
     C     KNVST         BEGSR
      ***********************************************
     C                   Z-ADD     50            XN53              3 0
     C     XN53          SUB       4             XN54              3 0
     C     XN53          SUB       5             XN55              3 0
     C     XN53          SUB       6             XN56              3 0
     C                   Z-ADD     0             XN52              3 0
     C                   MOVE      *BLANKS       XTXT802
     C     1             DO        80            XN51              3 0
     C                   IF        XT801(XN51) = '&' OR
     C                             XT801(XN51) = '"' OR
     C                             XT801(XN51) = 'Æ' OR
     C                             XT801(XN51) = 'Ø' OR
     C                             XT801(XN51) = 'Å' OR
     C                             XT801(XN51) = 'æ' OR
     C                             XT801(XN51) = 'ø' OR
     C                             XT801(XN51) = 'å' OR
     C                             XT801(XN51) = X'5A' OR                       ¤
     C                             XT801(XN51) = X'8E' OR
     C                             XT801(XN51) = X'B0' OR
     C                             XT801(XN51) = X'B2' OR
     C                             XT801(XN51) = X'71' OR
     C                             XT801(XN51) = X'54' OR
     C                             XT801(XN51) = X'74' OR
     C                             XT801(XN51) = X'58' OR
     C                             XT801(XN51) = X'7D' OR
     C                             XT801(XN51) = X'EC' OR
     C                             XT801(XN51) = X'90' OR
     C                             XT801(XN51) = X'63' OR                       Ä -> AA
     C                             XT801(XN51) = X'FC' OR
     C                             XT801(XN51) = X'CC' OR                       ö -> oe
     C                             XT801(XN51) = X'43' OR                       ä -> aa
     C                             XT801(XN51) = X'55' OR                       í -> i
     C                             XT801(XN51) = X'62' OR                       Â -> A
     C                             XT801(XN51) = X'51' OR                       é -> e
     C                             XT801(XN51) = X'42' OR                       â -> aa
     C                             XT801(XN51) = X'CE' OR                       ó -> o
     C                             XT801(XN51) = X'64' OR                       À -> A
     C                             XT801(XN51) = X'65' OR                       Á -> A
     C                             XT801(XN51) = X'5B' OR                       Å -> A
     C                             XT801(XN51) = X'41' OR                       '41' -> '40'
     C                             XT801(XN51) = X'4D' OR                       '4D' -> u
     C                             XT801(XN51) = X'A1' OR                       ü -> u
     C                             XT801(XN51) = X'66' OR                       Ã -> A
     C                             XT801(XN51) = X'75' OR                       Í -> I
     C                             XT801(XN51) = X'8F' OR                       ± -> +/-
     C                             XT801(XN51) = X'FD' OR                       Ù -> U
     C                             XT801(XN51) = X'E1' OR                       ÷ -> O
     C                             XT801(XN51) = X'AD' OR                       Ý -> OE
     C                             XT801(XN51) = X'73' OR                       Ë -> E
     C                             XT801(XN51) = X'FE' OR                       Ú -> U
     C                             XT801(XN51) = X'3F' OR                       '3F' -> Blank
     C                             XT801(XN51) = X'BE' OR                       ´ -> blank
     C                             XT801(XN51) = X'45' OR                       á -> a
     C                             XT801(XN51) = XAPS OR
     C                             XT801(XN51) = '<' OR
     C                             XT801(XN51) = '>'
     C                   IF        XN52 < XN53
     C                   ADD       1             XN52
     C                   SELECT
     C                   WHEN      XT801(XN51) = 'Å'                               4
     C                             OR XT801(XN51) = X'63'
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'AA'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'Ø'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'OE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'Æ'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'AE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'æ'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'aa'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'ø'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'oe'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'å'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'ae'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'5A'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     '.'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'8E'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'OE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'B0'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'oe'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'B2'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'OE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'71'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'E'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'54'                             4
     C                             OR XT801(XN51) = X'74'
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'E'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'58'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'i'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'7D'                             4
     C                   IF        XN51 < XN56                                      5<-B
     C                   MOVEA     '&apos;'      XT802(XN52)
     C                   ADD       5             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'EC'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'O'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'90'                             4
     C                   IF        XN51 < XN56                                      5<-B
     C                   EVAL      XT802(XN52) = X'5F'
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'FC'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'U'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'CC'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'oe'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'43'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'aa'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'55'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'i'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'62'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'A'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'51'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'e'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'42'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'aa'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'CE'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'o'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'64' OR                          4
     C                             XT801(XN51) = X'65' OR
     C                             XT801(XN51) = X'66' OR
     C                             XT801(XN51) = X'5B'
     C                   IF        XT801(XN51) = X'66' AND XT801(XN51+1) = X'9D'    Ã¸ -> oe
     C                   MOVEA     'oe'          XT802(XN52)
     C                   ADD       1             XN51
     C                   ADD       1             XN52
     C                   ELSE
     C                   IF        XT801(XN51) = X'66' AND XT801(XN51+1) = X'70'    Ã¦-> ae
     C                   MOVEA     'ae'          XT802(XN52)
     C                   ADD       1             XN51
     C                   ADD       1             XN52
     C                   ELSE
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'A'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   END
     C                   END
     C                   WHEN      XT801(XN51) = X'41'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     ' '           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'4D'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'u'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'A1'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'u'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'75'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'I'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'8F'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     '+/-'         XT802(XN52)
     C                   ADD       2             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'FD'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'U'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'E1'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'O'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'AD'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'OE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'73'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'E'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'FE'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'U'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51)=X'66' AND XT801(XN51+1)=X'80'       4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'ae'          XT802(XN52)
     C                   ADD       1             XN51
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'3F'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     ' '           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'BE'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     ' '           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'45'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'a'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = '&'
     C                   IF        XN51 < XN55
     C                   MOVEA     '&amp;'       XT802(XN52)
     C                   ADD       4             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = '"'
     C                   IF        XN51 < 75
     C                   MOVEA     '&quot;'      XT802(XN52)
     C                   ADD       5             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = XAPS
     C                   IF        XN51 < XN56
     C                   MOVEA     '&apos;'      XT802(XN52)
     C                   ADD       5             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = '>'
     C                   IF        XN51 < XN54
     C                   MOVEA     '&gt;'        XT802(XN52)
     C                   ADD       3             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = '<'
     C                   IF        XN51 < XN54
     C                   MOVEA     '&lt;'        XT802(XN52)
     C                   ADD       3             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   ENDSL
     C                   END
     C                   ELSE
     C                   IF        XN52 < XN53
     C                   ADD       1             XN52
     C                   MOVE      XT801(XN51)   XT802(XN52)
     C                   ELSE
     C                   LEAVE
     C                   END
     C                   END
     C                   ENDDO
      *
     C                   IF        XTXT802 = *BLANKS                            1<-B
     C                   EVAL      XTXT802 = '.'
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
