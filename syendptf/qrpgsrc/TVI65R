********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 SH  PTF12 store endringer ikke merket
********************************************************************
     FTVI65D    CF   E             WORKSTN
     F                                     SFILE(TVI65DB:ZRECNO)
     FSADH9     IF   E           K DISK
     FSAEH9     IF   E           K DISK
     FEDIM2     IF   E           K DISK
     FEDIS      IF   E           K DISK
     FSTANDI    IF   E           K DISK
     FSTANDE    IF   E           K DISK
     FTRIH07    IF   E           K DISK
     FTRUH07    IF   E           K DISK
     FTRISTD    IF   E           K DISK
     FTRUSTD    IF   E           K DISK
     D                 DS
     D  ZDTTM                  1     14  0
     D  ZDT                    1      8  0
     D  ZDT6                   3      8  0
     D  ZTM                    9     14  0
     D                 DS
     D  MDTTM                  1     14  0
     D  MDT                    1      8  0
     D  MDT6                   3      8  0
     D  MTM                    9     14  0
     D                 DS
     D  WDT                    1      8
     D  WÅ                     1      4  0
     D  WM                     5      6  0
     D  WD                     7      8  0
     D                 DS
     D  WTID                   1      6  0
     D  WTIDH                  1      2  0
     D  WTIDM                  3      4  0
     D  WTIDS                  5      6  0
     D                 DS
     D  M0068A                 1      8  0
     D  M068A6                 3      8  0
     D                 DS
     D  M0068                  1     35
     D  M006825                1     25
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    *IN03         WIN03
     C     *LIKE         DEFINE    *IN30         WIN30
     C     *LIKE         DEFINE    SIST          WIST
     C     *LIKE         DEFINE    M0068A        W0068A
     C     *LIKE         DEFINE    M0068B        W0068B
     C     *LIKE         DEFINE    M0068C        W0068C
     C     *LIKE         DEFINE    SEST          WEST
     C     *LIKE         DEFINE    SEAVD         WEAVD
     C     *LIKE         DEFINE    SETDN         WETDN
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYA          KLIST
     C                   KFLD                    WIST
     C     KEYB          KLIST
     C                   KFLD                    MSN
     C     KEYC          KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C                   KFLD                    W0068A
     C                   KFLD                    W0068B
     C                   KFLD                    W0068C
     C     KEYD          KLIST
     C                   KFLD                    ZAVD
     C     KEYEH9        KLIST
     C                   KFLD                    WEST
     C                   KFLD                    WEAVD
     C                   KFLD                    WETDN
     C     KEYF          KLIST
     C                   KFLD                    SEAVD
     C                   KFLD                    SETDN
     C                   KFLD                    W0068A
     C     KEYTI         KLIST
     C                   KFLD                    TIAVD
     C                   KFLD                    TITDN
     C                   KFLD                    W0068A
     C     KEYTE         KLIST
     C                   KFLD                    THAVD
     C                   KFLD                    THTDN
     C                   KFLD                    W0068A
      *_____________
      * Init av felt
      *"""""""""""""
     C* Hente dagens dato og klokkeslett.
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVEL     WDT           ZDT
     C                   Z-ADD     235959        ZTM
     C                   MOVE      'C'           WIST
     C                   Z-ADD     99999999      W0068A
     C                   MOVE      'C'           WEST
     C                   Z-ADD     1             WEAVD
     C                   Z-ADD     1             WETDN
      *__________________
      * Output parametrer
      *""""""""""""""""""
     C     PLISTA        PLIST
     C                   PARM      MMN           MMN
     C     *IN03         PARM                    WIN03
     C     PLISTB        PLIST
     C                   PARM      SLIB          SLIB
     C                   PARM      SFILE         SFILE
     C                   PARM      SMBR          SMBR
     C     *IN30         PARM                    WIN30
     C     PLISTC        PLIST
     C                   PARM      MSN           MSN
     C                   PARM      MMN           MMN
     C                   PARM      MAVD          MAVD
     C                   PARM      MTDN          MTDN
     C                   PARM      M0068A        M0068A
     C                   PARM      M0068B        M0068B
     C                   PARM      M0068C        M0068C
     C                   PARM      M1001         M1001
     C     *IN03         PARM                    WIN03
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
      *___________
      * Startbilde
      *"""""""""""
     C     SRB1          TAG
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     TVI65DØ
     C                   EXFMT     TVI65DA
     C                   MOVEA     '0000000'     *IN(30)
     C     *IN03         CABEQ     '1'           SRB9
      * Teste avdeling, hvis tastet.
     C     ZAVD          IFGT      0
     C     KEYD          CHAIN     STANDI                             30
     C   30KEYD          CHAIN     STANDE                             30
     C   30KEYD          CHAIN     TRISTD                             30
     C   30KEYD          CHAIN     TRUSTD                             30
     C     *IN30         IFEQ      '1'
     C                   MOVE      'SPA0001'     ZMSGNO
     C                   MOVEA     '110'         *IN(30)
     C                   GOTO      SRB1
     C                   END
     C                   END
      * Teste dato
     C                   MOVEL     ZDT           WDT
     C     WM            COMP      1                                    30
     C  N30WM            COMP      12                                 30
     C  N30WD            COMP      1                                    30
     C  N30WD            COMP      31                                 30
     C   30              MOVE      'SPD0001'     ZMSGNO
     C   30              MOVEA     '1100000'     *IN(30)
     C   30              GOTO      SRB1
      * Teste tid
     C                   Z-ADD     ZTM           WTID
     C  N30WTIDH         COMP      24                                 30
     C  N30WTIDM         COMP      60                                 30
     C  N30WTIDS         COMP      60                                 30
     C   30              MOVE      'SPK0006'     ZMSGNO
     C   30              MOVEA     '1001000'     *IN(30)
     C   30              GOTO      SRB1
     C     SRB2          TAG
      *______________
      * Tømme Subfile
      *""""""""""""""
     C                   MOVE      '1'           *IN93
     C                   WRITE     TVI65DC
     C                   MOVEA     '000'         *IN(93)
     C                   Z-ADD     *ZERO         ZRECNO
      *_____________
      * Fyll Subfile
      *"""""""""""""
      * IMPORT STATUSKODE='+'
     C                   MOVE      '+'           WIST
     C                   MOVE      '0'           *IN94
     C     KEYA          SETLL     SADH9
     C     KEYA          READE     SADH9                                  94
      *
     C     *IN94         DOWEQ     '0'
      *
     C     KEYC          SETLL     EDIM2
     C                   READP     EDIM2                                  20
     C     *IN20         IFEQ      '0'
     C     MDTTM         ANDLE     ZDTTM
     C                   MOVE      '0'           *IN21
     C     ZAVD          COMP      0                                  20
     C   20MAVD          COMP      ZAVD                               2020
     C  N20MTDN          COMP      SITDN                              2020
     C  N20M0065         IFEQ      'CUSDEC'
     C     M1001         ANDEQ     '929'
     C                   MOVE      'TVIN-I'      WSIMEX
     C                   ADD       1             ZRECNO
     c                   EVAL      avsmot=%trim(m0004) + '-' +%trim(M0010)
     C                   WRITE     TVI65DB
     C                   END
     C                   END
      *
     C     KEYA          READE     SADH9                                  94
      *
     C  N94              END
      * IMPORT STATUSKODE='A'
     C                   MOVE      'A'           WIST
     C                   MOVE      '0'           *IN94
     C     KEYA          SETLL     SADH9
     C     KEYA          READE     SADH9                                  94
      *
     C     *IN94         DOWEQ     '0'
      *
     C     KEYC          SETLL     EDIM2
     C                   READP     EDIM2                                  20
     C     *IN20         IFEQ      '0'
     C     MDTTM         ANDLE     ZDTTM
     C                   MOVE      '0'           *IN21
     C     ZAVD          COMP      0                                  20
     C   20MAVD          COMP      ZAVD                               2020
     C  N20MTDN          COMP      SITDN                              2020
     C  N20M0065         IFEQ      'CUSDEC'
     C     M1001         ANDEQ     '929'
     C                   MOVE      'TVIN-I'      WSIMEX
     C                   ADD       1             ZRECNO
     c                   EVAL      avsmot=%trim(m0004) + '-' +%trim(M0010)
     C                   WRITE     TVI65DB
     C                   END
     C                   END
      *
     C     KEYA          READE     SADH9                                  94
      *
     C  N94              END
      * IMPORT STATUSKODE='B'
     C                   MOVE      'B'           WIST
     C                   MOVE      '0'           *IN94
     C     KEYA          SETLL     SADH9
     C     KEYA          READE     SADH9                                  94
      *
     C     *IN94         DOWEQ     '0'
      *
     C     KEYC          SETLL     EDIM2
     C                   READP     EDIM2                                  20
     C     *IN20         IFEQ      '0'
     C     MDTTM         ANDLE     ZDTTM
     C                   MOVE      '0'           *IN21
     C     ZAVD          COMP      0                                  20
     C   20MAVD          COMP      ZAVD                               2020
     C  N20MTDN          COMP      SITDN                              2020
     C  N20M0065         IFEQ      'CUSDEC'
     C     M1001         ANDEQ     '929'
     C                   MOVE      'TVIN-I'      WSIMEX
     C                   ADD       1             ZRECNO
     c                   EVAL      avsmot=%trim(m0004) + '-' +%trim(M0010)
     C                   WRITE     TVI65DB
     C                   END
     C                   END
      *
     C     KEYA          READE     SADH9                                  94
      *
     C  N94              END
      * IMPORT STATUSKODE='C'
     C                   MOVE      'C'           WIST
     C                   MOVE      '0'           *IN94
     C     KEYA          SETLL     SADH9
     C     KEYA          READE     SADH9                                  94
      *
     C     *IN94         DOWEQ     '0'
      *
     C     KEYC          SETLL     EDIM2
     C                   READP     EDIM2                                  20
     C     *IN20         IFEQ      '0'
     C     MDTTM         ANDLE     ZDTTM
     C                   MOVE      '0'           *IN21
     C     ZAVD          COMP      0                                  20
     C   20MAVD          COMP      ZAVD                               2020
     C  N20MTDN          COMP      SITDN                              2020
     C  N20M0065         IFEQ      'CUSDEC'
     C     M1001         ANDEQ     '929'
     C                   MOVE      'TVIN-I'      WSIMEX
     C                   ADD       1             ZRECNO
     c                   EVAL      avsmot=%trim(m0004) + '-' +%trim(M0010)
     C                   WRITE     TVI65DB
     C                   END
     C                   END
      *
     C     KEYA          READE     SADH9                                  94
      *
     C  N94              END
      * EKSPORT STATUS='+'
     C                   MOVE      '+'           WEST
     C                   MOVE      '0'           *IN94
     C     KEYEH9        SETLL     SAEH9
     C     WEST          READE     SAEH9                                  94
      *
     C     *IN94         DOWEQ     '0'
      *
     C     KEYF          SETLL     EDIM2
     C                   READP     EDIM2                                  20
     C     *IN20         IFEQ      '0'
     C     MDTTM         ANDLE     ZDTTM
     C                   MOVE      '0'           *IN21
     C     ZAVD          COMP      0                                  20
     C   20MAVD          COMP      ZAVD                               2020
     C  N20MTDN          COMP      SETDN                              2020
     C  N20M0065         IFEQ      'CUSDEC'
     C     M1001         ANDEQ     '830'
     C                   MOVE      'TVIN-E'      WSIMEX
     C                   ADD       1             ZRECNO
     c                   EVAL      avsmot=%trim(m0004) + '-' +%trim(M0010)
     C                   WRITE     TVI65DB
     C                   END
     C                   END
      *
     C     WEST          READE     SAEH9                                  94
      *
     C  N94              END
      * EKSPORT STATUS='A'
     C                   MOVE      'A'           WEST
     C                   MOVE      '0'           *IN94
     C     KEYEH9        SETLL     SAEH9
     C     WEST          READE     SAEH9                                  94
      *
     C     *IN94         DOWEQ     '0'
      *
     C     KEYF          SETLL     EDIM2
     C                   READP     EDIM2                                  20
     C     *IN20         IFEQ      '0'
     C     MDTTM         ANDLE     ZDTTM
     C                   MOVE      '0'           *IN21
     C     ZAVD          COMP      0                                  20
     C   20MAVD          COMP      ZAVD                               2020
     C  N20MTDN          COMP      SETDN                              2020
     C  N20M0065         IFEQ      'CUSDEC'
     C     M1001         ANDEQ     '830'
     C                   MOVE      'TVIN-E'      WSIMEX
     C                   ADD       1             ZRECNO
     c                   EVAL      avsmot=%trim(m0004) + '-' +%trim(M0010)
     C                   WRITE     TVI65DB
     C                   END
     C                   END
      *
     C     WEST          READE     SAEH9                                  94
      *
     C  N94              END
      * EKSPORT STATUS='B'
     C                   MOVE      'B'           WEST
     C                   MOVE      '0'           *IN94
     C     KEYEH9        SETLL     SAEH9
     C     WEST          READE     SAEH9                                  94
      *
     C     *IN94         DOWEQ     '0'
      *
     C     KEYF          SETLL     EDIM2
     C                   READP     EDIM2                                  20
     C     *IN20         IFEQ      '0'
     C     MDTTM         ANDLE     ZDTTM
     C                   MOVE      '0'           *IN21
     C     ZAVD          COMP      0                                  20
     C   20MAVD          COMP      ZAVD                               2020
     C  N20MTDN          COMP      SETDN                              2020
     C  N20M0065         IFEQ      'CUSDEC'
     C     M1001         ANDEQ     '830'
     C                   MOVE      'TVIN-E'      WSIMEX
     C                   ADD       1             ZRECNO
     c                   EVAL      avsmot=%trim(m0004) + '-' +%trim(M0010)
     C                   WRITE     TVI65DB
     C                   END
     C                   END
      *
     C     WEST          READE     SAEH9                                  94
      *
     C  N94              END
      * EKSPORT STATUS='C'
     C                   MOVE      'C'           WEST
     C                   MOVE      '0'           *IN94
     C     KEYEH9        SETLL     SAEH9
     C     WEST          READE     SAEH9                                  94
      *
     C     *IN94         DOWEQ     '0'
      *
     C     KEYF          SETLL     EDIM2
     C                   READP     EDIM2                                  20
     C     *IN20         IFEQ      '0'
     C     MDTTM         ANDLE     ZDTTM
     C                   MOVE      '0'           *IN21
     C     ZAVD          COMP      0                                  20
     C   20MAVD          COMP      ZAVD                               2020
     C  N20MTDN          COMP      SETDN                              2020
     C  N20M0065         IFEQ      'CUSDEC'
     C     M1001         ANDEQ     '830'
     C                   MOVE      'TVIN-E'      WSIMEX
     C                   ADD       1             ZRECNO
     c                   EVAL      avsmot=%trim(m0004) + '-' +%trim(M0010)
     C                   WRITE     TVI65DB
     C                   END
     C                   END
      *
     C     WEST          READE     SAEH9                                  94
      *
     C  N94              END
      * TET-IMPORT
     C                   MOVE      '+'           WIST
     C     STTETI        TAG
     C     KEYA          SETLL     TRIH07
     C     KEYA          READE     TRIH07                                 94
      *
     C     *IN94         DOWEQ     '0'
      *
     C     KEYTI         SETLL     EDIM2
     C                   READP     EDIM2                                  20
     C     *IN20         IFEQ      '0'
     C     MDTTM         ANDLE     ZDTTM
     C                   MOVE      '0'           *IN21
     C     ZAVD          COMP      0                                  20
     C   20MAVD          COMP      ZAVD                               2020
     C  N20MTDN          COMP      TITDN                              2020
     C  N20M0065         IFEQ      'CUSDEC'
     C     M1001         ANDEQ     'TEI'
     C                   MOVE      'TET-I '      WSIMEX
     C                   ADD       1             ZRECNO
     c                   EVAL      avsmot=%trim(m0004) + '-' +%trim(M0010)
     C                   WRITE     TVI65DB
     C                   END
     C                   END
      *
     C     KEYA          READE     TRIH07                                 94
      *
     C  N94              END
      *
     C     WIST          IFNE      'F'
     C                   SELECT
     C     WIST          WHENEQ    '+'
     C                   MOVE      'A'           WIST
     C     WIST          WHENEQ    'A'
     C                   MOVE      'B'           WIST
     C     WIST          WHENEQ    'B'
     C                   MOVE      'C'           WIST
     C     WIST          WHENEQ    'C'
     C                   MOVE      'F'           WIST
     C                   ENDSL
     C                   GOTO      STTETI
     C                   END
      *
      * TET-EKSPORT
     C                   MOVE      '+'           WIST
     C     STTETE        TAG
     C     KEYA          SETLL     TRUH07
     C     KEYA          READE     TRUH07                                 94
      *
     C     *IN94         DOWEQ     '0'
      *
     C     KEYTE         SETLL     EDIM2
     C                   READP     EDIM2                                  20
     C     *IN20         IFEQ      '0'
     C     MDTTM         ANDLE     ZDTTM
     C                   MOVE      '0'           *IN21
     C     ZAVD          COMP      0                                  20
     C   20MAVD          COMP      ZAVD                               2020
     C  N20MTDN          COMP      THTDN                              2020
     C  N20M0065         IFEQ      'CUSDEC'
     C     M1001         ANDEQ     'TET'
     C                   MOVE      'TET-E '      WSIMEX
     C                   ADD       1             ZRECNO
     c                   EVAL      avsmot=%trim(m0004) + '-' +%trim(M0010)
     C                   WRITE     TVI65DB
     C                   END
     C                   END
      *
     C     KEYA          READE     TRUH07                                 94
      *
     C  N94              END
      *
     C     WIST          IFNE      'C'
     C                   SELECT
     C     WIST          WHENEQ    '+'
     C                   MOVE      'A'           WIST
     C     WIST          WHENEQ    'A'
     C                   MOVE      'B'           WIST
     C     WIST          WHENEQ    'B'
     C                   MOVE      'C'           WIST
     C                   ENDSL
     C                   GOTO      STTETE
     C                   END
      *
     C     ZRECNO        IFEQ      0
     C                   MOVE      'SPR0002'     ZMSGNO
     C                   MOVE      '1'           *IN30
     C                   GOTO      SRB1
     C                   END
     C                   Z-ADD     1             ZRECNO
      *_______________
      * Behandle bilde
      *"""""""""""""""
     C     SRB3          TAG
      *
     C                   MOVEA     '11'          *IN(91)
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     TVI65DØ
     C                   WRITE     TVI65DD
     C                   EXFMT     TVI65DC
      *
     C     *IN12         CABEQ     '1'           SRB1
     C     *IN03         IFEQ      '0'
      *
     C                   MOVEA     '00'          *IN(91)
      *_____________
      * F5=Frisk opp
      *"""""""""""""
     C     *IN05         CABEQ     '1'           SRB2
      *_______
      * Valg ?
      *"""""""
     C                   MOVE      '0'           *IN52
     C                   MOVE      '0'           *IN30
     C                   MOVE      '0'           *IN95
     C     *IN52         DOWEQ     '0'
      *
     C                   READC     TVI65DB                                52
     C     *IN52         IFEQ      '0'
     C     ZOP           CASEQ     '4'           SRBD
     C     ZOP           CASEQ     '5'           SRBE
     C     ZOP           CASEQ     '7'           SRBG
     C                   END
     C                   END
      *
     C  N30
     CANN52              END
      *
     C     *IN03         CABEQ     '1'           SRB9
     C     *IN95         CABEQ     '1'           SRB2
     C     *IN95         CABEQ     '0'           SRB3
     C                   END
      *
     C     SRB9          ENDSR
      *////////////////////////////////////////////////////////////
      *  Besvare melding internt.                            SRBD /
      *////////////////////////////////////////////////////////////
     C     SRBD          BEGSR
     C                   MOVE      '1'           *IN95
      *________________________
      * Call på eksternt CL-pgm
      *""""""""""""""""""""""""
     C                   CALL      'TVI10C'      PLISTC
     C     SRBD9         ENDSR
      *////////////////////////////////////////////////////////////
      *  Vise hele meldingsloggen.                           SRBE /
      *////////////////////////////////////////////////////////////
     C     SRBE          BEGSR
      *________________________
      * Call på eksternt CL-pgm
      *""""""""""""""""""""""""
     C                   CALL      'TVI67R'      PLISTA
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    TVI65DB
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Vise fysisk filkomponent                            SRBG /
      *////////////////////////////////////////////////////////////
     C     SRBG          BEGSR
      *___________________
      * Hente sendningsref
      *"""""""""""""""""""
     C     KEYB          CHAIN     EDIS                               20
      *________________________
      * Call på eksternt CL-pgm
      *""""""""""""""""""""""""
     C                   CALL      'SAD003C'     PLISTB
     C     *IN30         IFEQ      '1'
     C                   MOVE      'SY00120'     ZMSGNO
     C                   END
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C  N30              MOVE      *BLANKS       ZOP
     C  N30              UPDATE    TVI65DB
      *
     C                   ENDSR
