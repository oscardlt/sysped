      * For å kompilere: ADDLIBLE LIB(LIBHTTP) POSITION(*LAST)
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12300 * 01 CB  PTF12 Feil i tagnavn slutt  </ComplementOfInfomration>
********************************************************************
      *----------------------------------------------------------------
      * Program sender IE07 (ankomst) og IE44 (lossemerknad)
      *----------------------------------------------------------------
     H DftActGrp(*No)
     FEDIC      UF   E             DISK
     FEDIS      O  A E             DISK
     FEDIM      UF   E           K DISK
     FTRACKF    O  A E             DISK
     FNCTSIH    UF   E           K DISK
     FNCTSIV    IF   E           K DISK
     FNCTSIC    IF   E           K DISK
     FNCTSII    IF   E           K DISK
     FNCTSII01  IF   E           K DISK    RENAME(NCTSIIR:NCTSIIR01)
     F                                     PREFIX(I1_)
      /copy ifsio_h
     D EDIDTA          DS           256
     D  UELIBF               171    180
     D                 DS
     D  CSN                    1      9  0
     D  X_CSN                  1      9
     D                 DS
     D  WMBR                   1     14
     D  WMBRA                  1      1
     D  WMBRB                  2     10  0
     D                 DS
     D  XDT                    1      8
     D  XDTA                   1      4
     D  XDTM                   5      6
     D  XDTD                   7      8
     D                 DS
     D  XTM                    1      6
     D  XTMH                   1      2
     D  XTMM                   3      4
     D  XTMS                   5      6
     D                 DS
     D  TIAVD                  1      4  0
     D  TITDN                  5     11  0
     D  TIOPDNR                1     11
     D                 DS
     D  TIDTA                  1      8  0
     D  TIDTAA                 1      4
     D  TIDTAM                 5      6
     D  TIDTAD                 7      8
     D                 DS
     D  TITMA                  1      6  0
     D  TITMAH                 1      2
     D  TITMAM                 3      4
     D  TITMAS                 5      6
     D                 DS
     D  TVADT                  1      8  0
     D  TVADTA                 1      4
     D  TVADTM                 5      6
     D  TVADTD                 7      8
     D                 DS
     D  TVTXT                  1    512
     D  TX                     1    560    DIM(8)
     D                 DS
     D  NIULDT                 1      8  0
     D  NIULDTA                1      4
     D  NIULDTM                5      6
     D  NIULDTD                7      8
      *
     D FILE_o          s             10I 0
     D String          s            512a
     D rc              s             10i 0
     D*Data            s             80a   Varying
     D*Codepage        s              5a   Varying
     D CmdLine         S            512
     D CmdLen          S             15  5
     D LF              c                   x'25'
     D XCHGAUT         s            200A
     d U_UUID          s             36A
     D RunCmd          PR                  EXTPGM('QCMDEXC')
     D  Cmd                         200A   CONST
     D  Len                          15P 5 CONST
      *
     D                 DS
     D  XTXT801                1    200
     D  XT801                  1    200    DIM(200)
     D                 DS
     D  XTXT802                1    200
     D  XT802                  1    200    DIM(200)
     D                SDS
     D  ZUSER                254    263
      *//////////////
      *  Hodelogikk /
      *//////////////
      * Initiering av variabler og nøkler
     C                   EXSR      SRA
      * Plukk NCTS og send til Tollvesenet
     C                   EXSR      SRC
      * Avsluttning av sending
     C                   EXSR      SRD
     C                   MOVE      '1'           *INLR
      *
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYD          KLIST
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     C     KEYE          KLIST
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     C                   KFLD                    TCLI
     C     NCTSII01K     KLIST
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     C                   KFLD                    I1_TNLIT
      *_____________
      * Init av felt
      *"""""""""""""
      * Hente dagens dato og klokkeslett.
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           XIDAG             8 0
     C                   MOVE      WDT           XDT
     C                   MOVE      WTM           XTM
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    UMN               9 0
      *
     C     *DTAARA       DEFINE                  EDIDTA
     C                   IN        EDIDTA
     C                   MOVE      *BLANKS       XDATA          1024
     C                   BITON     '123457'      XAPS              1
     C                   BITOFF    '06'          XAPS
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Les meldinger                                        SRC /
      *////////////////////////////////////////////////////////////
     C     SRC           BEGSR
      *
     C     UMN           CHAIN     EDIM                               33
     C                   IF        *IN33 = *OFF                                 1<-B
     C     1             CHAIN     EDIC                               36
     C                   ADD       1             CSN
     C                   UPDATE    EDICR
      *
     C     KEYD          CHAIN     NCTSIH                             33
     C                   IF        *IN33 = *OFF                                  2<-B
     C                   MOVE      'A'           TIST
     C                   UPDATE    NCTSIHR
     C                   Z-ADD     CSN           MSN
     C                   MOVE      'A'           MST
     C                   MOVEL     WDT           MDT
     C                   MOVEL     WTM           MTM
     C*                  UPDATE    EDIMR
     C                   SELECT                                                   3<-B
     C     M1N07         WHENEQ    '007'
     C                   EXSR      ANKOMST
     C     M1N07         WHENEQ    '044'
     C                   EXSR      MERKNAD
     C                   ENDSL                                                    3<-E
     C                   EVAL      M1004 = %SUBST(U_UUID:1:35)
     C                   UPDATE    EDIMR
     C                   ELSE                                                    2
     C                   UPDATE    EDIMR
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Slutt på file                                        SRD /
      *////////////////////////////////////////////////////////////
     C     SRD           BEGSR
      *________________________
      * Oppdatere sendningslogg
      *""""""""""""""""""""""""
     C                   EVAL      WMBRA = 'S'
     C                   EVAL      WMBRB = CSN
     C                   EVAL      S0004  = M0004
     C                   EVAL      S0010  = M0010
     C*                  EVAL      S0020  = WMBR
     C                   EVAL      S0020  = 'SI' + TIOPDNR
     C                   EVAL      SSN    = CSN
     C                   EVAL      SSR    = 'S'
     C                   EVAL      SST    = 'A'
     C                   EVAL      S0036  = 1
     C                   MOVEL     WDT           SDT
     C                   MOVEL     WTM           STM
     C                   EVAL      SFILE  = '*IFS'
     C                   EVAL      SMBR   = WMBR
     C                   EVAL      SLIB   = '*LIBL'
     C                   EVAL      SIFS   = WFILNAM2
     C                   WRITE     EDISR
      *
      * Oppdater track & trace
     C                   EVAL      TTAVD  = MAVD
     C                   EVAL      TTOPD  = MTDN
     C                   EVAL      TTACTI = 'NCT'
     C                   MOVEL     WDT           TTDATE
     C                   MOVEL     WTM           TTTIME
     C                   EVAL      TTTEXT='NCTS ENTRY (' + %TRIM(M1N07)
     C                             + ') is sent to TVINN.'
     C                   EVAL      TTUSER = ZUSER
     C                   EVAL      TTDATL = TTDATE
     C                   EVAL      TTTIML = TTTIME
     C                   EVAL      TTTEXT='NCTS ENTRY (' + %TRIM(M1N07)
     C                             + ') er sendt til TVINN.'
     C                   WRITE     TRACKFR
      *
     C                   ENDSR
      *
      */////////////////////////////////////////////////////////////
      * Send ankomstmelding til Tollvesnet                         /
      */////////////////////////////////////////////////////////////
     C     ANKOMST       BEGSR
      * Lag fil og set codepage (pc)
     C                   MOVE      *BLANKS       WFilNam         256
      *
      * Ankomst
     C                   EVAL      WFilNam= '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/NCTS_'
     C                             + %TRIM(TIOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_007.xml'
     C                   MOVE      *BLANKS       WFilNam2        256
     C                   EVAL      WFilNam2 = '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/BACKUP/NCTS_'
     C                             + %TRIM(TIOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_007.xml'
      *
      * 1208 = UTF-8
     C                   eval      FILE_o = open( %TrimR( WFilNam2 )
     C                               : O_CREAT+O_TRUNC+O_WRONLY
     C                                + O_TEXT_CREAT+O_CCSID+O_TEXTDATA
     C                               : S_IRUSR + S_IWUSR
     C                               : 1208
     C                               : 0)
      *
     C                   EVAL      XDATA = '<?xml version="1.0" '
     C                             + 'encoding="UTF-8" standalone="yes"?>'
     C*                            + 'encoding="UTF-8" standalone="true"?>'
     C                   EXSR      OPDFIL
      *
      * Endret '<ns2:CC007C>' til <CC007C> 06.09.2023. Endret tilbake 25.09.2023.
     C*                  EVAL      XDATA = '<ns2:CC007C '
     C*                  EVAL      XDATA = '<CC007C '
     C*                            + 'xmlns:ns2="http://ncts.dgtaxud.ec">'
      * Endret til '<ns3:CC007C
      *              xmlns:ns2="urn:eds:datamodel:EDS:EDS_EXTENSIONS:1"
      *              xmlns:ns3="http://ncts.dgtaxud.ec">'
      * Endret '<ns3:CC007C>' til <ns2:CC007C> 04.12.2023.
     C*                  EVAL      XDATA = '<ns3:CC007C '
     C*                            + 'xmlns:ns2="urn:eds:datamodel:EDS'
     C*                            + ':EDS_EXTENSIONS:1" '
     C*                            + 'xmlns:ns3="http://ncts.dgtaxud.ec">'
     C                   EVAL      XDATA = '<ns2:CC007C '
     C                             + 'xmlns:ns2="http://ncts.dgtaxud.ec" '
     C                             + 'xmlns:ns3="urn:eds:datamodel:EDS'
     C                             + ':EDS_EXTENSIONS:1">'
     C                   EXSR      OPDFIL
      *
     C                   EXSR      SRMSGANK
      *
      * Endret '<ns2:CC007C>' til <CC007C> 06.09.2023. Endret tilbake 25.09.2023.
     C*                  EVAL      XDATA = '</ns2:CC007C>'
     C*                  EVAL      XDATA = '</CC007C>'
      * Endret '<ns2:CC007C>' til <ns3:CC007C> 27.11.2023.
     C*                  EVAL      XDATA = '</ns3:CC007C>'
      * Endret '<ns3:CC007C>' til <ns2:CC007C> 04.12.2023.
     C                   EVAL      XDATA = '</ns2:CC007C>'
     C                   EXSR      OPDFIL
      *
     C                   callp     close( FILE_o )
     C                   EVAL      XCHGAUT = 'CHGAUT OBJ(' + XAPS
     C                             + %TRIM(WFilNam2) + XAPS
     C                             + ') USER(*PUBLIC) DTAAUT(*RWX) OBJAUT(*ALL)'
     C                   CALLP     RUNCMD(XCHGAUT:200)
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Message ankomst                                 SRMSGANK /
      *////////////////////////////////////////////////////////////
     C     SRMSGANK      BEGSR
      *
      * Godsnr
     C                   EVAL      XDATA = '<Extensions>'
     C                   EXSR      OPDFIL
      * Fjernet 04.12.2023
     C*                  EVAL      XDATA = '<ns2:SequenceNumeric>1'
     C*                            + '</ns2:SequenceNumeric>'
     C*                  EXSR      OPDFIL
     C*                  EVAL      XDATA = '<ns2:Key>SUBMITTER</ns2:Key>'
     C*                  EXSR      OPDFIL
     C*                  EVAL      XDATA = '<ns2:Value>object</ns2:Value>'
     C*                  EXSR      OPDFIL
     C*                  EVAL      XDATA = '<ns2:DataType>object</ns2:DataType>'
     C*                  EXSR      OPDFIL
      *
     C*                  EVAL      XDATA = '<ns2:Extensions>'
     C*                  EXSR      OPDFIL
      * Endret fra ns2 til ns3, 04.12.2023
     C                   EVAL      XDATA = '<ns3:SequenceNumeric>1'
     C                             + '</ns3:SequenceNumeric>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<ns3:Key>NextProcedure</ns3:Key>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<ns3:Value>'
     C                             + %TRIM(TIGN) + '</ns3:Value>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<ns3:DataType>text</ns3:DataType>'
     C                   EXSR      OPDFIL
      * Fjernet 04.12.2023
     C*                  EVAL      XDATA = '</ns2:Extensions>'
     C*                  EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '</Extensions>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<messageSender>'
     C                             + %TRIM(M0004) + '</messageSender>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<messageRecipient>'
     C*                            + %TRIM(%SUBST(M0010:1:8))
     C                             + %TRIM(M0010)
     C                             + '</messageRecipient>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<preparationDateAndTime>'
     C                             + %TRIM(XDTA) + '-' + %TRIM(XDTM) + '-'
     C                             + %TRIM(XDTD) + 'T' + %TRIM(XTMH) + ':'
     C                             + %TRIM(XTMM) + ':' + %TRIM(XTMS)
     C                             + '</preparationDateAndTime>'
     C                   EXSR      OPDFIL
     C*                  CALL      'UUIDC'
     C*                  PARM                    U_UUID           36
     C                   EVAL      U_UUID = %TRIM(M0004) + '-'
     C                             + %TRIM(WDT) + '-' + %TRIM(X_CSN)
     C                   EVAL      XDATA = '<messageIdentification>'
     C*                            + %SUBST(U_UUID:1:35)
     C                             + %TRIM(U_UUID)
     C                             + '</messageIdentification>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<messageType>'
     C                             + 'CC007C' + '</messageType>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<correlationIdentifier>'
     C                             + %TRIM(U_UUID)
     C                             + '</correlationIdentifier>'
     C*                  EXSR      OPDFIL
      * Transit operation
     C                   EVAL      XDATA = '<TransitOperation>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<MRN>' + %TRIM(TITRNR) + '</MRN>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<arrivalNotificationDateAndTime>'
     C                             + %TRIM(TIDTAA) + '-' + %TRIM(TIDTAM) + '-'
     C                             + %TRIM(TIDTAD) + 'T' + %TRIM(TITMAH) + ':'
     C                             + %TRIM(TITMAM) + ':' + %TRIM(TITMAS)
     C                             + '</arrivalNotificationDateAndTime>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<simplifiedProcedure>'
     C                             + %TRIM(%EDITC(TISPR:'3'))
     C                             + '</simplifiedProcedure>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<incidentFlag>'
     C                             + %TRIM(%EDITC(TIIFLG:'3'))
     C                             + '</incidentFlag>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '</TransitOperation>'
     C                   EXSR      OPDFIL
      * Authorisation
     C                   IF        TIAREF <> *BLANKS AND TISPR = 1
     C                   EVAL      XDATA = '<Authorisation>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1'
     C                             + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TIATYP) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(TIAREF) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Authorisation>'
     C                   EXSR      OPDFIL
     C                   END
      * Customs office of destination
     C                   EVAL      XDATA = '<CustomsOfficeOfDestinationActual>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(TITSBA) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</CustomsOfficeOfDestinationActual>'
     C                   EXSR      OPDFIL
      * Trader at destination
     C                   EVAL      XDATA = '<TraderAtDestination>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(TITINTA) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TISKTA <> *BLANKS
     C                   EVAL      XDATA ='<communicationLanguageAtDestination>'
     C                             + %TRIM(TISKTA)
     C                             + '</communicationLanguageAtDestination>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</TraderAtDestination>'
     C                   EXSR      OPDFIL
      *
      * Consignment
     C                   EXSR      SRMSGANKC
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Consignment                                    SRMSGANKC /
      *////////////////////////////////////////////////////////////
     C     SRMSGANKC     BEGSR
      *
      * Consigment
     C                   EVAL      XDATA = '<Consignment>'
     C                   EXSR      OPDFIL
      *
      * Location of goods
     C                   EXSR      SRMSGANKCL
      *
      * Incident
     C                   EXSR      SRMSGANKCI
      *
     C                   EVAL      XDATA = '</Consignment>'
     C                   EXSR      OPDFIL
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  SRMSGANKCL                                    SRMSGANKCL /
      *////////////////////////////////////////////////////////////
     C     SRMSGANKCL    BEGSR
      *
      * Location of goods
     C                   EVAL      XDATA = '<LocationOfGoods>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<typeOfLocation>'
     C                             + %TRIM(TILCTY)
     C                             + '</typeOfLocation>'
     C                   EXSR      OPDFIL
      * Godsnr sendes som autorisasjon med qualifier=Z
     C                   EVAL      XDATA = '<qualifierOfIdentification>'
     C                             + %TRIM(TIQID)
     C*                            + 'Z'
     C                             + '</qualifierOfIdentification>'
     C                   EXSR      OPDFIL
      *
     C                   SELECT                                                 1<-B
     C                   WHEN      TIQID = 'Y'                                  1
     C                   EVAL      XTXT801 = TIANR
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<authorisationNumber>'
     C                             + %TRIM(XTXT802) + '</authorisationNumber>'
     C*                            + %TRIM(TIGN) + '</authorisationNumber>'
     C                   EXSR      OPDFIL
      *
     C                   IF        TIAID <> *BLANKS
     C                   EVAL      XTXT801 = TIAID
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<additionalIdentifier>'
     C                             + %TRIM(XTXT802) + '</additionalIdentifier>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C                   WHEN      TIQID = 'U'                                  1
     C                   EVAL      XDATA = '<UNLocode>'
     C                             + %TRIM(TISD) + '</UNLocode>'
     C                   EXSR      OPDFIL
      *
     C                   WHEN      TIQID = 'V'                                  1
      * Customs office
     C                   EVAL      XDATA = '<CustomsOffice>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(TITS) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</CustomsOffice>'
     C                   EXSR      OPDFIL
      *
     C                   WHEN      TIQID = 'X'                                  1
      * Economic operator
     C                   EVAL      XDATA = '<EconomicOperator>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TITINE
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</EconomicOperator>'
     C                   EXSR      OPDFIL
      *
     C                   WHEN      TIQID = 'Z'                                  1
      * Address
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIADE1
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPNE
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPSE
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   IF        TILKE <> *BLANKS
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(TILKE) + '</country>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
      *
     C                   WHEN      TIQID = 'T'                                  1
      * Postcode address
     C                   EVAL      XDATA = '<PostcodeAddress>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIADE2
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<houseNumber>'
     C                             + %TRIM(XTXT802) + '</houseNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPNE2
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   IF        TILKE2 <> *BLANKS
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(TILKE2) + '</country>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</PostcodeAddress>'
     C                   EXSR      OPDFIL
      *
     C                   WHEN      TIQID = 'W'                                  1
     C                   ENDSL                                                  1<-E
      *
     C                   IF        TIQID <> 'V'
      * Contact person
     C                   IF        TICPE <> *BLANKS
     C                   EVAL      XDATA = '<ContactPerson>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TICPE
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TITLE
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<phoneNumber>'
     C                             + %TRIM(XTXT802) + '</phoneNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TIEME <> *BLANKS
     C                             AND TIEME = *BLANKS
      * Problem ved å sende epostadresse i test. Siden den ikke krav sendes den ikke.
     C                   EVAL      XDATA = '<E-mailAddress>'
     C                             + %TRIM(TIEME) + '</E-mailAddress>'
     C*                  EVAL      XDATA = '<eMailAddress>'
     C*                            + %TRIM(TIEME) + '</eMailAddress>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</ContactPerson>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C                   END
      *
      * SLUTT på location of goods
     C                   EVAL      XDATA = '</LocationOfGoods>'
     C                   EXSR      OPDFIL
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  SRMSGANKCI                                    SRMSGANKCI /
      *////////////////////////////////////////////////////////////
     C     SRMSGANKCI    BEGSR
      *
     C                   MOVE      *BLANKS       TX
     C     KEYD          SETLL     NCTSIV
     C     KEYD          READE     NCTSIV                                 33
     C                   MOVE      *ZEROS        XN                3 0
      *
     C                   DOW       *IN33 = *OFF
      * Incident
     C                   EVAL      XDATA = '<Incident>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XN = XN + 1
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + %TRIM(%EDITC(XN:'Z')) + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<code>'
     C                             + %TRIM(TVKD) + '</code>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = *BLANKS
     C     1             DO        8             XN2               3 0
     C                   IF        TX(XN2) <> *BLANKS
     C                   EVAL      XTXT801 = TX(XN2)
     C                   EXSR      KNVST
     C                   EVAL      XDATA = %TRIM(XDATA) + %TRIM(XTXT802)
     C                   END
     C                   ENDDO
     C                   EVAL      XDATA = '<text>'
     C                             + %TRIM(XDATA) + '</text>'
     C                   EXSR      OPDFIL
      * Endorsement
     C                   IF        TVADT <> 0
     C                   EVAL      XDATA = '<Endorsement>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<date>'
     C                             + %TRIM(%EDITC(TVADT:'Z')) + '</date>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TVAAUT
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<authority>'
     C                             + %TRIM(XTXT802) + '</authority>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TVASD
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<place>'
     C                             + %TRIM(XTXT802) + '</place>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(TVALK) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Endorsement>'
     C                   EXSR      OPDFIL
     C                   END
      * Location
     C                   IF        TVSD <> *BLANKS
     C                   EVAL      XDATA = '<Location>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<qualifierOfIdentification>'
     C                             + %TRIM(TVQID)
     C                             + '</qualifierOfIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<UNLoccode'
     C                             + %TRIM(TVSD) + '</UNLoccode'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(TVLK) + '</country>'
     C                   EXSR      OPDFIL
      * Address
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TVAD1
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TVPN
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TVPS
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '</Location>'
     C                   EXSR      OPDFIL
     C                   END
      *
      * Transport equipment
     C                   IF        TVCNR <> *BLANKS
     C                   EVAL      XDATA = '<TransportEquipment>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1'
     C                             + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<containerIdentificationNumber>'
     C                             + %TRIM(TVCNR)
     C                             + '</containerIdentificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<numberOfSeals>'
     C                             + %TRIM(%EDITC(TVANTS:'Z'))
     C                             + '</numberOfSeals>'
     C                   EXSR      OPDFIL
      * Seal
     C                   EVAL      XDATA = '<Seal>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1'
     C                             + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C     '#'           SCAN      TVSID         XPOS              3 0    33
     C                   IF        *IN33 = *OFF
     C                   EVAL      XTXT801 = TVSID
     C                   ELSE
     C                   EVAL      XTXT801 = %SUBST(TVSID:1:XPOS-1)
     C                   END
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identifier>'
     C                             + %TRIM(XTXT802)
     C                             + '</identifier>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Seal>'
     C                   EXSR      OPDFIL
      * Seal 2
     C                   IF        XPOS > 0 AND %SUBST(TVSID:XPOS+1:1) <> ' '
     C                   EVAL      XDATA = '<Seal>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '2' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XPOS = XPOS + 1
     C     '#'           SCAN      TVSID:XPOS    XPOS2             3 0    33
     C                   IF        *IN33 = *OFF
     C                   EVAL      XTXT801 = %SUBST(TVSID:XPOS:21-XPOS)
     C                   ELSE
     C                   EVAL      XTXT801 = %SUBST(TVSID:XPOS:XPOS2-XPOS)
     C                   END
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identifier>'
     C                             + %TRIM(XTXT802)
     C                             + '</identifier>'
     C                   EXSR      OPDFIL
      * SLUTT Seal 2
     C                   EVAL      XDATA = '</Seal>'
     C                   EXSR      OPDFIL
     C                   END
      * Goods reference
     C                   EVAL      XDATA = '<GoodsReference>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1'
     C                             + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<declarationGoodsItemNumber>'
     C                             + %TRIM(%EDITC(TVDLI:'Z'))
     C                             + '</declarationGoodsItemNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</GoodsReference>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '</TransportEquipment>'
     C                   EXSR      OPDFIL
     C                   END
      *
      * Transhipment
     C                   EVAL      XDATA = '<Transhipment>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<containerIndicator>'
     C                             + %TRIM(%EDITC(TVKDC:'4'))
     C                             + '</containerIndicator>'
     C                   EXSR      OPDFIL
      * Transport means
     C                   EVAL      XDATA = '<TransportMeans>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<typeOfIdentification>'
     C                             + %TRIM(%EDITC(TVTTY:'4'))
     C                             + '</typeOfIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TVTID
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<nationality>'
     C                             + %TRIM(TVTLK) + '</nationality>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</TransportMeans>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '</Transhipment>'
     C                   EXSR      OPDFIL
      *
      * SLUTT på incident
     C                   EVAL      XDATA = '</Incident>'
     C                   EXSR      OPDFIL
      *
     C     KEYD          READE     NCTSIV                                 33
     C                   ENDDO
      *
     C                   ENDSR
      *
      */////////////////////////////////////////////////////////////
      * Send lossemarknad til Tollvesnet                           /
      */////////////////////////////////////////////////////////////
     C     MERKNAD       BEGSR
      * Lag fil og set codepage (pc)
     C                   MOVE      *BLANKS       WFilNam         256
      *
      * Lossemarknad
     C                   EVAL      WFilNam= '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/NCTS_'
     C                             + %TRIM(TIOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_044.xml'
     C                   MOVE      *BLANKS       WFilNam2        256
     C                   EVAL      WFilNam2 = '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/BACKUP/NCTS_'
     C                             + %TRIM(TIOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_044.xml'
      *
      * 1208 = UTF-8
     C                   eval      FILE_o = open( %TrimR( WFilNam2 )
     C                               : O_CREAT+O_TRUNC+O_WRONLY
     C                                + O_TEXT_CREAT+O_CCSID+O_TEXTDATA
     C                               : S_IRUSR + S_IWUSR
     C                               : 1208
     C                               : 0)
      *
     C                   EVAL      XDATA = '<?xml version="1.0" '
     C                             + 'encoding="UTF-8" standalone="yes"?>'
     C*                            + 'encoding="UTF-8" standalone="true"?>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<ns2:CC044C '
     C*                  EVAL      XDATA = '<CC044C '
     C                             + 'xmlns:ns2="http://ncts.dgtaxud.ec">'
     C                   EXSR      OPDFIL
      *
     C                   EXSR      SRMSGLM
      *
     C                   EVAL      XDATA = '</ns2:CC044C>'
     C*                  EVAL      XDATA = '</CC044C>'
     C                   EXSR      OPDFIL
      *
     C                   callp     close( FILE_o )
     C                   EVAL      XCHGAUT = 'CHGAUT OBJ(' + XAPS
     C                             + %TRIM(WFilNam2) + XAPS
     C                             + ') USER(*PUBLIC) DTAAUT(*RWX) OBJAUT(*ALL)'
     C                   CALLP     RUNCMD(XCHGAUT:200)
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Message lossemerknad                             SRMSGLM /
      *////////////////////////////////////////////////////////////
     C     SRMSGLM       BEGSR
      *
     C                   EVAL      XDATA = '<messageSender>'
     C                             + %TRIM(M0004) + '</messageSender>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<messageRecipient>'
     C*                            + %TRIM(%SUBST(M0010:1:8))
     C                             + %TRIM(M0010)
     C                             + '</messageRecipient>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<preparationDateAndTime>'
     C                             + %TRIM(XDTA) + '-' + %TRIM(XDTM) + '-'
     C                             + %TRIM(XDTD) + 'T' + %TRIM(XTMH) + ':'
     C                             + %TRIM(XTMM) + ':' + %TRIM(XTMS)
     C                             + '</preparationDateAndTime>'
     C                   EXSR      OPDFIL
     C*                  CALL      'UUIDC'
     C*                  PARM                    U_UUID           36
     C                   EVAL      U_UUID = %TRIM(M0004) + '-'
     C                             + %TRIM(WDT) + '-' + %TRIM(X_CSN)
     C                   EVAL      XDATA = '<messageIdentification>'
     C*                            + %SUBST(U_UUID:1:35)
     C                             + %TRIM(U_UUID)
     C                             + '</messageIdentification>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<messageType>'
     C                             + 'CC044C' + '</messageType>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<correlationIdentifier>'
     C                             + 'O' + '</correlationIdentifier>'
     C                   EXSR      OPDFIL
      * Transit operation
     C                   EVAL      XDATA = '<TransitOperation>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<MRN>' + %TRIM(TITRNR) + '</MRN>'
     C                   EXSR      OPDFIL
      *
     C                   IF        NITXT <> *BLANKS
     C                   EVAL      XDATA = '<otherThingsToReport>'
     C                             + %TRIM(NITXT) + '</otherThingsToReport>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C                   EVAL      XDATA = '</TransitOperation>'
     C                   EXSR      OPDFIL
      * Customs office of destination (actual)
     C                   EVAL      XDATA = '<CustomsOfficeOfDestinationActual>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(NITSB)
     C                             + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</CustomsOfficeOfDestinationActual>'
     C                   EXSR      OPDFIL
      * Trader at destination
     C                   EVAL      XDATA = '<TraderAtDestination>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(NITINT) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</TraderAtDestination>'
     C                   EXSR      OPDFIL
      * Unloading remark
     C                   EVAL      XDATA = '<UnloadingRemark>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<conform>'
     C                             + %TRIM(%EDITC(NIULKF:'3'))
     C                             + '</conform>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<unloadingCompletion>'
     C                             + %TRIM(%EDITC(NIULKM:'3'))
     C                             + '</unloadingCompletion>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<unloadingDate>'
     C                             + %TRIM(NIULDTA) + '-'
     C                             + %TRIM(NIULDTM) + '-'
     C                             + %TRIM(NIULDTD)
     C                             + '</unloadingDate>'
     C                   EXSR      OPDFIL
     C*                  IF        NIULST <> 0
     C                   IF        NIDANT > 0
     C                   EVAL      XDATA = '<stateOfSeals>'
     C                             + %TRIM(%EDITC(NIULST:'3'))
     C                             + '</stateOfSeals>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        NIULMR <> *BLANKS
     C                   EVAL      XTXT801 = NIULMR
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<unloadingRemark>'
     C                             + %TRIM(XTXT802) + '</unloadingRemark>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</UnloadingRemark>'
     C                   EXSR      OPDFIL
      *
      * Consignment
     C                   IF        NIULKF <> 1
     C                   EXSR      SRMSGLMC
     C                   END
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Message lossemerknad consignment                SRMSGLMC /
      *////////////////////////////////////////////////////////////
     C     SRMSGLMC      BEGSR
      * Finn siste deklarasjons gods item nummer
     C                   EVAL      I1_TNLIT = 99999
     C     NCTSII01K     SETLL     NCTSII01
     C     KEYD          READPE    NCTSII01                               33
      *
      * Consignment
     C                   EVAL      XDATA = '<Consignment>'
     C                   EXSR      OPDFIL
      * Gross mass
     C                   SELECT
     C*                  WHEN      TC01 = 'S'
     C                   WHEN      NIVKB = -1
      * Consignment total manko
     C                   EVAL      XDATA = '<grossMass>0</grossMass>'
     C                   WHEN      NIVKB = 0
      * Ingen endring på consignment
     C                   EVAL      XDATA = '<grossMass>'
     C*                            + %TRIM(%EDITC(TIVKB:'L')) + '</grossMass>'
     C                             + %TRIM(%EDITW(TIVKB:'        0 .   '))
     C                             + '</grossMass>'
     C                   OTHER
      * Endring på consignment
     C                   EVAL      XDATA = '<grossMass>'
     C*                            + %TRIM(%EDITC(NIVKB:'3')) + '</grossMass>'
     C                             + %TRIM(%EDITW(NIVKB:'        0 .   '))
     C                             + '</grossMass>'
     C                   ENDSL
     C                   EXSR      OPDFIL
      * Transport Equipment
     C                   IF        TICNR <> *BLANKS
     C                   EVAL      XDATA = '<TransportEquipment>'
     C                   EXSR      OPDFIL
      *  Sequence Number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *  Container identification
     C                   IF        NICNR = *BLANKS
     C                   EVAL      XDATA = '<containerIdentificationNumber>'
     C                             + %TRIM(TICNR)
     C                             + '</containerIdentificationNumber>'
     C                   ELSE
     C                   EVAL      XDATA = '<containerIdentificationNumber>'
     C                             + %TRIM(NICNR)
     C                             + '</containerIdentificationNumber>'
     C                   END
     C                   EXSR      OPDFIL
      *  Number of seals
     C                   IF        NIDANT = 0
     C                   EVAL      XDATA = '<numberOfSeals>'
     C                             + %TRIM(%EDITC(TIDANT:'3'))
     C                             + '</numberOfSeals>'
     C                   ELSE
     C                   EVAL      XDATA = '<numberOfSeals>'
     C                             + %TRIM(%EDITC(NIDANT:'3'))
     C                             + '</numberOfSeals>'
     C                   END
     C                   EXSR      OPDFIL
      *  Seal
     C                   EVAL      XDATA = '<Seal>'
     C                   EXSR      OPDFIL
      *   Sequence Number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *   Identifier
     C                   IF        NIDFKD = *BLANKS
     C                   EVAL      XDATA = '<identifier>'
     C                             + %TRIM(TIDFKD) + '</identifier>'
     C                   ELSE
     C                   EVAL      XDATA = '<identifier>'
     C                             + %TRIM(NIDFKD) + '</identifier>'
     C                   END
     C                   EXSR      OPDFIL
      *  Slutt på Seal
     C                   EVAL      XDATA = '</Seal>'
     C                   EXSR      OPDFIL
      *  Goods reference
     C                   EVAL      XDATA = '<GoodsReference>'
     C                   EXSR      OPDFIL
      *   Sequence Number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *   Declaration goods item number
     C                   IF        NIGINR = 0
     C                   EVAL      XDATA = '<declarationGoodsItemNumber>'
     C                             + %TRIM(%EDITC(TIGINR:'3'))
     C                             + '</declarationGoodsItemNumber>'
     C                   ELSE
     C                   EVAL      XDATA = '<declarationGoodsItemNumber>'
     C                             + %TRIM(%EDITC(NIGINR:'3'))
     C                             + '</declarationGoodsItemNumber>'
     C                   END
     C                   EXSR      OPDFIL
      *  Slutt på Goods reference
     C                   EVAL      XDATA = '</GoodsReference>'
     C                   EXSR      OPDFIL
      * Slutt på Transport Equipment
     C                   EVAL      XDATA = '</TransportEquipment>'
     C                   EXSR      OPDFIL
      *
     C                   END
      *
     C                   IF        NITATY <> 0 OR NITAID <> *BLANKS
     C                             OR NITALK <> *BLANKS
      * Depature transport means
     C                   EVAL      XDATA = '<DepatureTransportMeans>'
     C                   EXSR      OPDFIL
      *  Sequence number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *  Type of identification
     C                   IF        NITATY = 0 AND NITAID = *BLANKS
     C                             AND NITALK = *BLANKS
     C                   EVAL      XDATA = '<typeOfIdentification>'
     C                             + %TRIM(%EDITC(TITATY:'3'))
     C                             + '</typeOfIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TITAID
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<nationality>'
     C                             + %TRIM(TITALK) + '</nationality>'
     C                   EXSR      OPDFIL
     C                   ELSE
     C                   EVAL      XDATA = '<typeOfIdentification>'
     C                             + %TRIM(%EDITC(NITATY:'3'))
     C                             + '</typeOfIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = NITAID
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<nationality>'
     C                             + %TRIM(NITALK) + '</nationality>'
     C                   EXSR      OPDFIL
     C                   END
      * Slutt på Depature transport means
     C                   EVAL      XDATA = '</DepatureTransportMeans>'
     C                   EXSR      OPDFIL
      *
     C                   END
      *
     C                   IF        NISDRF <> *BLANKS
      * Supporting document
     C                   EVAL      XDATA = '<SupportingDocument>'
     C                   EXSR      OPDFIL
      *  Sequence number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *  Type
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(NISDTY) + '</type>'
     C                   EXSR      OPDFIL
      *  Reference number
     C                   EVAL      XTXT801 = NISDRF
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
      *  Complement of information
     C                   EVAL      XTXT801 = NISDIN
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<complementOfInformation>'
     C                             + %TRIM(XTXT802)
     C                             + '</complementOfInformation>'
     C                   EXSR      OPDFIL
      * Slutt på Supporting document
     C                   EVAL      XDATA = '</SupportingDocument>'
     C                   EXSR      OPDFIL
      *
     C                   END
      *
     C                   IF        NITDRF <> *BLANKS
      * Transport document
     C                   EVAL      XDATA = '<TransportDocument>'
     C                   EXSR      OPDFIL
      *  Sequence number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *  Type
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(NITDTY) + '</type>'
     C                   EXSR      OPDFIL
      *  Reference number
     C                   EVAL      XTXT801 = NITDRF
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
      * Slutt på Transport document
     C                   EVAL      XDATA = '</TransportDocument>'
     C                   EXSR      OPDFIL
      *
     C                   END
      *
     C                   IF        NIADRF <> *BLANKS
      * Additional reference
     C                   EVAL      XDATA = '<AdditionalReference>'
     C                   EXSR      OPDFIL
      *  Sequence number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *  Type
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(NIADTY) + '</type>'
     C                   EXSR      OPDFIL
      *  Reference number
     C                   EVAL      XTXT801 = NIADRF
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
      * Slutt på Additional reference
     C                   EVAL      XDATA = '</AdditionalReference>'
     C                   EXSR      OPDFIL
      *
     C                   END
      *
      * House consignment
     C                   EXSR      SRMSGLMHC
      *
      * Slutt på Consignement
     C                   EVAL      XDATA = '</Consignment>'
     C                   EXSR      OPDFIL
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Message lossemerknad house consignment         SRMSGLMHC /
      *////////////////////////////////////////////////////////////
     C     SRMSGLMHC     BEGSR
      *
     C     KEYD          SETLL     NCTSIC
     C     KEYD          READE     NCTSIC                                 33
     C*                  MOVE      *ZEROS        XN                3 0
     C                   DOW       *IN33 = *OFF                                 1<-B
      *
     C                   IF        NCVKTB > 0 OR TC01 = 'S'                      2<-B
      *
      * House Consignment
     C                   EVAL      XDATA = '<HouseConsignment>'
     C                   EXSR      OPDFIL
      *  Sequence number
     C*                  EVAL      XN = XN + 1
     C                   EVAL      XDATA = '<sequenceNumber>'
     C*                            + %TRIM(%EDITC(XN:'Z')) + '</sequenceNumber>'
     C                             + %TRIM(%EDITC(TCLI:'Z'))
     C                             + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *  Gross mass
     C                   SELECT
     C                   WHEN      TC01 = 'S'
     C*                  EVAL      XDATA = '<grossMass>0</grossMass>'
     C                   OTHER
     C                   EVAL      XDATA = '<grossMass>'
     C*                            + %TRIM(%EDITC(NCVKTB:'3')) + '</grossMass>'
     C                             + %TRIM(%EDITW(NCVKTB:'        0 .   '))
     C                             + '</grossMass>'
     C                   EXSR      OPDFIL
     C                   ENDSL
      *
     C                   IF        NCTATY <> 0 OR NCTAID <> *BLANKS               3<-B
      *  Depature transport means
     C                   EVAL      XDATA = '<DepatureTransportMeans>'
     C                   EXSR      OPDFIL
      *   Sequence number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *   Type of identification
     C                   EVAL      XDATA = '<typeOfIdentification>'
     C                             + %TRIM(%EDITC(NCTATY:'3'))
     C                             + '</typeOfIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = NCTAID
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<nationality>'
     C                             + %TRIM(NCTALK) + '</nationality>'
     C                   EXSR      OPDFIL
      * Slutt på Depature transport means
     C                   EVAL      XDATA = '</DepatureTransportMeans>'
     C                   EXSR      OPDFIL
      *
     C                   END                                                      3<-E
      *
     C                   IF        NCSDRF <> *BLANKS                              3<-B
      * Supporting document
     C                   EVAL      XDATA = '<SupportingDocument>'
     C                   EXSR      OPDFIL
      *  Sequence number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *  Type
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(NCSDTY) + '</type>'
     C                   EXSR      OPDFIL
      *  Reference number
     C                   EVAL      XTXT801 = NCSDRF
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
      *  Complement of information
     C                   EVAL      XTXT801 = NCSDIN
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<complementOfInformation>'
N01  C                             + %TRIM(XTXT802)
N01  C                             + '</complementOfInformation>'
S01  C*                            + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
      * Slutt på Supporting document
     C                   EVAL      XDATA = '</SupportingDocument>'
     C                   EXSR      OPDFIL
      *
     C                   END                                                      3<-E
      *
     C                   IF        NCTDRF <> *BLANKS                              3<-B
      * Transport document
     C                   EVAL      XDATA = '<TransportDocument>'
     C                   EXSR      OPDFIL
      *  Sequence number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *  Type
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(NCTDTY) + '</type>'
     C                   EXSR      OPDFIL
      *  Reference number
     C                   EVAL      XTXT801 = NCTDRF
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
      * Slutt på Transport document
     C                   EVAL      XDATA = '</TransportDocument>'
     C                   EXSR      OPDFIL
      *
     C                   END                                                      3<-E
      *
     C                   IF        NCADRF <> *BLANKS                              3<-B
      * Additional reference
     C                   EVAL      XDATA = '<AdditionalReference>'
     C                   EXSR      OPDFIL
      *  Sequence number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *  Type
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(NCADTY) + '</type>'
     C                   EXSR      OPDFIL
      *  Reference number
     C                   EVAL      XTXT801 = NCADRF
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
      * Slutt på Additional reference
     C                   EVAL      XDATA = '</AdditionalReference>'
     C                   EXSR      OPDFIL
      *
     C                   END
      *                                                                           3<-E
      * Consignment item
     C                   EXSR      SRMSGLMCI
      *
      * Slutt på House Consignement
     C                   EVAL      XDATA = '</HouseConsignment>'
     C                   EXSR      OPDFIL
      *
     C                   END                                                     2<-E
      *
     C     KEYD          READE     NCTSIC                                 33
     C                   ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Message lossemerknad consignment item          SRMSGLMCI /
      *////////////////////////////////////////////////////////////
     C     SRMSGLMCI     BEGSR
      *
     C     KEYE          SETLL     NCTSII
     C     KEYE          READE     NCTSII                                 33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   IF        TN01 <> 'S' AND NNVKB > 0                     2<-B
     C                             OR TN01 = 'S'
     C*                  IF        TN01 <> 'S'                                   2<-B
      *
      * Consignment item
     C                   EVAL      XDATA = '<ConsignmentItem>'
     C                   EXSR      OPDFIL
      *  Sequence number
     C                   EVAL      XDATA = '<goodsItemNumber>'
     C                             + %TRIM(%EDITC(TNLI2:'Z'))
     C                             + '</goodsItemNumber>'
     C                   EXSR      OPDFIL
      *  Declaration goods item number
     C                   IF        TNLIT = 0
      * Ny item. Hent deklarasjons gods item nummer
     C                   EVAL      I1_TNLIT = I1_TNLIT + 1
     C                   EVAL      TNLIT = I1_TNLIT
     C                   END
      *
     C                   EVAL      XDATA = '<declarationGoodsItemNumber>'
     C                             + %TRIM(%EDITC(TNLIT:'Z'))
     C                             + '</declarationGoodsItemNumber>'
     C                   EXSR      OPDFIL
      *
     C                   IF        TN01 <> 'S'                                    3<-B
      *  Commodity
     C                   EVAL      XDATA = '<Commodity>'
     C                   EXSR      OPDFIL
      *  Description of goods
     C                   SELECT
     C                   WHEN      NNCTX <> *BLANKS
     C                   EVAL      XTXT801 = NNCTX
     C                   WHEN      TNCTX <> *BLANKS
     C                   EVAL      XTXT801 = TNCTX
     C                   OTHER
     C                   EVAL      XTXT801 = '.'
     C                   ENDSL
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<descriptionOfGoods>'
     C                             + %TRIM(XTXT802) + '</descriptionOfGoods>'
     C                   EXSR      OPDFIL
      *  CUS code
     C                   SELECT
     C                   WHEN      NNCCUS <> *BLANKS
     C                   EVAL      XDATA = '<cusCode>'
     C                             + %TRIM(NNCCUS) + '</cusCode>'
     C                   EXSR      OPDFIL
     C                   WHEN      TNCCUS <> *BLANKS
     C                   EVAL      XDATA = '<cusCode>'
     C                             + %TRIM(TNCCUS) + '</cusCode>'
     C                   EXSR      OPDFIL
     C                   ENDSL
      *  Commodity code
     C     NNCCH         COMP      *BLANKS                                91
     C   91TNCCH         COMP      *BLANKS                                91
     C                   IF        *IN91=*OFF
     C                   EVAL      XDATA = '<CommodityCode>'
     C                   EXSR      OPDFIL
      *  Harmonized system sub-heading code
     C                   SELECT
     C                   WHEN      NNCCH <> *BLANKS
     C                   EVAL      XDATA = '<harmonizedSystemSubHeadingCode>'
     C                             + %TRIM(NNCCH)
     C                             + '</harmonizedSystemSubHeadingCode>'
     C                   WHEN      TNCCH <> *BLANKS
     C                   EVAL      XDATA = '<harmonizedSystemSubHeadingCode>'
     C                             + %TRIM(TNCCH)
     C                             + '</harmonizedSystemSubHeadingCode>'
JOV  C                   OTHER
JOV  C                   EVAL      XDATA = *blanks
     C                   ENDSL
     C                   IF        XDATA <> *blanks
     C                   EXSR      OPDFIL
     C                   END
      *  Combined nomenclature code
     C*                  SELECT
     C*                  WHEN      NNCCCD <> *BLANKS
     C*                  EVAL      XDATA = '<combinedNomenclatureCode>'
     C*                            + %TRIM(NNCCCD)
     C*                            + '</combinedNomenclatureCode>'
     C*                  EXSR      OPDFIL
     C*                  WHEN      TNCCCD <> *BLANKS
     C*                  EVAL      XDATA = '<combinedNomenclatureCode>'
     C*                            + %TRIM(TNCCCD)
     C*                            + '</combinedNomenclatureCode>'
     C*                  EXSR      OPDFIL
     C*                  ENDSL
      *  Slutt på Commodity code
     C                   EVAL      XDATA = '</CommodityCode>'
     C                   EXSR      OPDFIL
     C                   END
      *  Goods measure
     C                   EVAL      XDATA = '<GoodsMeasure>'
     C                   EXSR      OPDFIL
      *   Gross mass
     C                   SELECT
     C                   WHEN      NNVKB <> 0
     C                   EVAL      XDATA = '<grossMass>'
     C*                            + %TRIM(%EDITC(NNVKB:'3')) + '</grossMass>'
     C                             + %TRIM(%EDITW(NNVKB:'        0 .   '))
     C                             + '</grossMass>'
     C                   EXSR      OPDFIL
     C                   WHEN      TNVKB <> 0
     C                   EVAL      XDATA = '<grossMass>'
     C*                            + %TRIM(%EDITC(TNVKB:'3')) + '</grossMass>'
     C                             + %TRIM(%EDITW(TNVKB:'        0 .   '))
     C                             + '</grossMass>'
     C                   EXSR      OPDFIL
     C                   ENDSL
      *   Net mass
     C                   SELECT
     C                   WHEN      NNVKN <> 0
     C                   EVAL      XDATA = '<netMass>'
     C*                            + %TRIM(%EDITC(NNVKN:'3')) + '</netMass>'
     C                             + %TRIM(%EDITW(NNVKN:'        0 .   '))
     C                             + '</netMass>'
     C                   EXSR      OPDFIL
     C                   WHEN      TNVKN <> 0
     C                   EVAL      XDATA = '<netMass>'
     C*                            + %TRIM(%EDITC(TNVKN:'3')) + '</netMass>'
     C                             + %TRIM(%EDITW(TNVKN:'        0 .   '))
     C                             + '</netMass>'
     C                   EXSR      OPDFIL
     C                   ENDSL
      *  Slutt på Goods measure
     C                   EVAL      XDATA = '</GoodsMeasure>'
     C                   EXSR      OPDFIL
      *  Slutt på Commodity
     C                   EVAL      XDATA = '</Commodity>'
     C                   EXSR      OPDFIL
      *  Packaging
     C                   EVAL      XDATA = '<Packaging>'
     C                   EXSR      OPDFIL
      *   Sequence number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *   Type of packages
     C                   SELECT
     C                   WHEN      NNPTY <> *BLANKS
     C                   EVAL      XDATA = '<typeOfPackages>'
     C                             + %TRIM(NNPTY)
     C                             + '</typeOfPackages>'
     C                   EXSR      OPDFIL
     C                   WHEN      TNPTY <> *BLANKS
     C                   EVAL      XDATA = '<typeOfPackages>'
     C                             + %TRIM(TNPTY)
     C                             + '</typeOfPackages>'
     C                   EXSR      OPDFIL
     C                   ENDSL
      *   Number of packages
     C                   SELECT
     C                   WHEN      NNPNT <> 0
     C                   EVAL      XDATA = '<numberOfPackages>'
     C                             + %TRIM(%EDITC(NNPNT:'3'))
     C                             + '</numberOfPackages>'
     C                   EXSR      OPDFIL
     C                   WHEN      TNPNT <> 0
     C                   EVAL      XDATA = '<numberOfPackages>'
     C                             + %TRIM(%EDITC(TNPNT:'3'))
     C                             + '</numberOfPackages>'
     C                   EXSR      OPDFIL
     C                   ENDSL
      *   Shipping marks
     C                   SELECT
     C                   WHEN      NNPMRK <> *BLANKS
     C                   EVAL      XTXT801 = NNPMRK
     C                   WHEN      TNPMRK <> *BLANKS
     C                   EVAL      XTXT801 = TNPMRK
     C                   OTHER
     C                   EVAL      XTXT801 = '.'
     C                   ENDSL
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<shippingMarks>'
     C                             + %TRIM(XTXT802)
     C                             + '</shippingMarks>'
     C                   EXSR      OPDFIL
      *  Slutt på Packaging
     C                   EVAL      XDATA = '</Packaging>'
     C                   EXSR      OPDFIL
      *
     C                   IF        NNSDRF <> *BLANKS                              3<-B
      * Supporting document
     C                   EVAL      XDATA = '<SupportingDocument>'
     C                   EXSR      OPDFIL
      *  Sequence number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *  Type
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(NNSDTY) + '</type>'
     C                   EXSR      OPDFIL
      *  Reference number
     C                   EVAL      XTXT801 = NNSDRF
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
      *  Complement of information
     C                   EVAL      XTXT801 = NNSDIN
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<complementOfInformation>'
N01  C                             + %TRIM(XTXT802)
N01  C                             + '</complementOfInformation>'
S01  C*                            + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
      * Slutt på Supporting document
     C                   EVAL      XDATA = '</SupportingDocument>'
     C                   EXSR      OPDFIL
      *
     C                   END                                                      3<-E
      *
     C                   IF        NCTDRF <> *BLANKS                              3<-B
      * Transport document
     C                   EVAL      XDATA = '<TransportDocument>'
     C                   EXSR      OPDFIL
      *  Sequence number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *  Type
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(NNTDTY) + '</type>'
     C                   EXSR      OPDFIL
      *  Reference number
     C                   EVAL      XTXT801 = NNTDRF
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
      * Slutt på Transport document
     C                   EVAL      XDATA = '</TransportDocument>'
     C                   EXSR      OPDFIL
      *
     C                   END                                                      3<-E
      *
     C                   IF        NNADRF <> *BLANKS                              3<-B
      * Additional reference
     C                   EVAL      XDATA = '<AdditionalReference>'
     C                   EXSR      OPDFIL
      *  Sequence number
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      *  Type
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(NNADTY) + '</type>'
     C                   EXSR      OPDFIL
      *  Reference number
     C                   EVAL      XTXT801 = NNADRF
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
      * Slutt på Additional reference
     C                   EVAL      XDATA = '</AdditionalReference>'
     C                   EXSR      OPDFIL
      *
     C                   END                                                      3<-E
      *
     C                   END                                                      3<-E
      *
      * Slutt på House Consignement
     C                   EVAL      XDATA = '</ConsignmentItem>'
     C                   EXSR      OPDFIL
      *
     C                   END                                                     2<-E
      *
     C     KEYE          READE     NCTSII                                 33
     C                   ENDDO
      *
     C                   ENDSR
      *
      ***********************************************
     C     OPDFIL        BEGSR
      ***********************************************
     C                   EVAL      XDATA=(%trimr(XDATA))+ LF
     c                   callp     write(File_o : %addr(Xdata)
     c                                : %len(%trimr(Xdata)) )
      *
     C                   ENDSR
      *
      ***********************************************
     C     KNVST         BEGSR
      ***********************************************
     C                   Z-ADD     150           XN53              3 0
     C     XN53          SUB       4             XN54              3 0
     C     XN53          SUB       5             XN55              3 0
     C     XN53          SUB       6             XN56              3 0
     C                   Z-ADD     0             XN52              3 0
     C                   MOVE      *BLANKS       XTXT802
     C     1             DO        200           XN51              3 0
     C                   IF        XT801(XN51) = '&' OR
     C                             XT801(XN51) = '"' OR
     C                             XT801(XN51) = 'Æ' OR
     C                             XT801(XN51) = 'Ø' OR
     C                             XT801(XN51) = 'Å' OR
     C                             XT801(XN51) = 'æ' OR
     C                             XT801(XN51) = 'ø' OR
     C                             XT801(XN51) = 'å' OR
     C                             XT801(XN51) = X'5A' OR                       ¤
     C                             XT801(XN51) = X'8E' OR
     C                             XT801(XN51) = X'B0' OR
     C                             XT801(XN51) = X'B2' OR
     C                             XT801(XN51) = X'71' OR
     C                             XT801(XN51) = X'54' OR
     C                             XT801(XN51) = X'74' OR
     C                             XT801(XN51) = X'58' OR
     C                             XT801(XN51) = X'7D' OR
     C                             XT801(XN51) = X'EC' OR
     C                             XT801(XN51) = X'90' OR
     C                             XT801(XN51) = X'63' OR                       Ä -> AA
     C                             XT801(XN51) = X'FC' OR
     C                             XT801(XN51) = X'CC' OR                       ö -> oe
     C                             XT801(XN51) = X'43' OR                       ä -> aa
     C                             XT801(XN51) = X'55' OR                       í -> i
     C                             XT801(XN51) = X'62' OR                       Â -> A
     C                             XT801(XN51) = X'51' OR                       é -> e
     C                             XT801(XN51) = X'42' OR                       â -> aa
     C                             XT801(XN51) = X'CE' OR                       ó -> o
     C                             XT801(XN51) = X'64' OR                       À -> A
     C                             XT801(XN51) = X'65' OR                       Á -> A
     C                             XT801(XN51) = X'67' OR                       $ -> A
     C                             XT801(XN51) = X'5B' OR                       Å -> A
     C                             XT801(XN51) = X'41' OR                       '41' -> '40'
     C                             XT801(XN51) = X'4D' OR                       '4D' -> u
     C                             XT801(XN51) = X'A1' OR                       ü -> u
     C                             XT801(XN51) = X'66' OR                       Ã -> A
     C                             XT801(XN51) = X'75' OR                       Í -> I
     C                             XT801(XN51) = X'8F' OR                       ± -> +/-
     C                             XT801(XN51) = X'FD' OR                       Ù -> U
     C                             XT801(XN51) = X'E1' OR                       ÷ -> O
     C                             XT801(XN51) = X'7C' OR                       Ø -> O
     C                             XT801(XN51) = X'EF' OR                       Õ -> O
     C                             XT801(XN51) = X'AD' OR                       Ý -> OE
     C                             XT801(XN51) = X'73' OR                       Ë -> E
     C                             XT801(XN51) = X'72' OR                       Ê -> E
     C                             XT801(XN51) = X'FE' OR                       Ú -> U
     C                             XT801(XN51) = X'3F' OR                       '3F' -> Blank
     C                             XT801(XN51) = X'BE' OR                       ´ -> blank
     C                             XT801(XN51) = X'45' OR                       á -> a
     C                             XT801(XN51) = X'59' OR                       ß -> S
     C                             XT801(XN51) = X'AF' OR                       ® -> Blank
     C                             XT801(XN51) = X'68' OR                       Ç -> Blank
     C                             XT801(XN51) = XAPS OR
     C                             XT801(XN51) = '<' OR
     C                             XT801(XN51) = '>'
     C                   IF        XN52 < XN53
     C                   ADD       1             XN52
     C                   SELECT
     C                   WHEN      XT801(XN51) = 'Å'                               4
     C                             OR XT801(XN51) = X'63'
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'AA'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'Ø'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'OE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'Æ'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'AE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'æ'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'aa'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'ø'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'oe'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'å'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'ae'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'5A'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     '.'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'8E'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'OE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'B0'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'oe'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'B2'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'OE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'71'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'E'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'54'                             4
     C                             OR XT801(XN51) = X'74'
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'E'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'58'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'i'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'7D'                             4
     C                   IF        XN51 < XN56                                      5<-B
     C                   MOVEA     '&apos;'      XT802(XN52)
     C                   ADD       5             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'EC'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'O'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'90'                             4
     C                   IF        XN51 < XN56                                      5<-B
     C                   EVAL      XT802(XN52) = X'5F'
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'FC'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'U'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'CC'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'oe'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'43'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'aa'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'55'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'i'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'62'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'A'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'51'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'e'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'42'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'aa'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'CE'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'o'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'64' OR                          4
     C                             XT801(XN51) = X'65' OR
     C                             XT801(XN51) = X'66' OR
     C                             XT801(XN51) = X'67' OR
     C                             XT801(XN51) = X'5B'
     C                   IF        XT801(XN51) = X'66' AND XT801(XN51+1) = X'9D'    Ã¸ -> oe
     C                   MOVEA     'oe'          XT802(XN52)
     C                   ADD       1             XN51
     C                   ADD       1             XN52
     C                   ELSE
     C                   IF        XT801(XN51) = X'66' AND XT801(XN51+1) = X'70'    Ã¦-> ae
     C                   MOVEA     'ae'          XT802(XN52)
     C                   ADD       1             XN51
     C                   ADD       1             XN52
     C                   ELSE
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'A'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   END
     C                   END
     C                   WHEN      XT801(XN51) = X'41'                             4
     C                             OR XT801(XN51) = X'AF'
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     ' '           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'4D'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'u'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'A1'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'u'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'75'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'I'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'8F'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     '+/-'         XT802(XN52)
     C                   ADD       2             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'FD'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'U'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'E1'                             4
     C                             OR XT801(XN51) = X'7C'
     C                             OR XT801(XN51) = X'EF'
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'O'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'AD'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'OE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'73'                             4
     C                             OR XT801(XN51) = X'72'
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'E'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'FE'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'U'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51)=X'66' AND XT801(XN51+1)=X'80'       4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'ae'          XT802(XN52)
     C                   ADD       1             XN51
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'3F'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     ' '           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'BE'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     ' '           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'45'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'a'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'59'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'S'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'68'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'C'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = '&'
     C                   IF        XN51 < XN55
     C                   MOVEA     '&amp;'       XT802(XN52)
     C                   ADD       4             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = '"'
     C                   IF        XN51 < 75
     C                   MOVEA     '&quot;'      XT802(XN52)
     C                   ADD       5             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = XAPS
     C                   IF        XN51 < XN56
     C                   MOVEA     '&apos;'      XT802(XN52)
     C                   ADD       5             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = '>'
     C                   IF        XN51 < XN54
     C                   MOVEA     '&gt;'        XT802(XN52)
     C                   ADD       3             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = '<'
     C                   IF        XN51 < XN54
     C                   MOVEA     '&lt;'        XT802(XN52)
     C                   ADD       3             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   ENDSL
     C                   END
     C                   ELSE
     C                   IF        XN52 < XN53
     C                   ADD       1             XN52
     C                   MOVE      XT801(XN51)   XT802(XN52)
     C                   ELSE
     C                   LEAVE
     C                   END
     C                   END
     C                   ENDDO
      *
     C                   IF        XTXT802 = *BLANKS                            1<-B
     C                   EVAL      XTXT802 = '.'
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
