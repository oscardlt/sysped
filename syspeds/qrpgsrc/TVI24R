********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 skriv eksternref
10XXX * 02 SH  PTF10 sitrt byttet med sitst i printfil
10247 * 03 YBC PTF10 INFORMASJON OM MIDLERTIDIG DEKLARASJON
********************************************************************
n01  FFRISOK    IF   E           K DISK
     FKODTP     IF   E           K DISK
     FKODTFM    IF   E           K DISK
     FSADH      UF   E           K DISK
     FSADH8     IF   E           K DISK
     F                                     RENAME(SADHR:SADH8R)
N03  FSADHMD    IF   E           K DISK
     FSADV      IF   E           K DISK
     FEDIM4     IF   E           K DISK
     FTVINF     IF   E           K DISK
     FTVINUA    O    E             PRINTER OFLIND(*IN51)
N03  D                 DS
N03  D  SIFRDT                 1      8  0
N03  D  SIFRDTA                1      4  0
N03  D  SIFRDTM                5      6  0
N03  D  SIFRDTD                7      8  0
N03  D                 DS
N03  D  XSIFRDT                1      8  0
N03  D  XSIFRDTD               1      2  0
N03  D  XSIFRDTM               3      4  0
N03  D  XSIFRDTA               5      8  0
N03  D                 DS
N03  D  SIFRT1                 1     70
N03  D  XSIFRT1                1     60
N03  D                 DS
N03  D  SIFRT2                 1     70
N03  D  XSIFRT2                1     60
N03  D                 DS
N03  D  SIFRT3                 1     70
N03  D  XSIFRT3                1     60
N03  D                 DS
N03  D  SIFRT4                 1     70
N03  D  XSIFRT4                1     60
N03  D                 DS
N03  D  SIFRT5                 1     70
N03  D  XSIFRT5                1     60
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRINIT
     C                   EXSR      SRHOVE
     C                   SETON                                        LR
      *
      *
      *////////////////////////////////////////////////////////////
      *  Initiering                                        SRINIT /
      *////////////////////////////////////////////////////////////
     C     SRINIT        BEGSR
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C     UAVD          PARM                    UAVD              4 0
     C     UWS           PARM                    UWS              10
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
n01  C     FRIKEY        KLIST
n01  C                   KFLD                    SIAVD
n01  C                   KFLD                    SITDN
n01  C                   KFLD                    WSKODE
n01  C                   move      '*CR'         WSKODE            3
     C     KEYSH         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    SITDN
     C     KEYSH8        KLIST
     C                   KFLD                    UWS
     C                   KFLD                    WST               1
     C     KEYTM4        KLIST
     C                   KFLD                    WSR               1
     C                   KFLD                    WAVD              4 0
     C                   KFLD                    WTDN              7 0
     C                   KFLD                    W0068A            8 0
     C     KTM42         KLIST
     C                   KFLD                    WSR
     C                   KFLD                    WAVD
     C                   KFLD                    WTDN
     C     KEYTF         KLIST
     C                   KFLD                    MMN
     C     KODTPK        KLIST
     C                   KFLD                    KOPUNI
     C                   KFLD                    UAVD
     C                   KFLD                    KOPLNR
     C                   MOVE      'P'           KOPUNI
     C                   Z-ADD     86            KOPLNR
      *___________________
      * Initiere faste nøkkelfelt
      *_________________
     C                   MOVE      'R'           WSR
     C                   MOVE      UAVD          WAVD
     C                   MOVE      99999999      W0068A
     C                   MOVE      'L'           WST
     C     KODTPK        CHAIN     KOPR                               33
     C  N33KOPFM         IFNE      *BLANKS
     C     KOPFM         SETLL     KODTFM
     C     KOPFM         READE     KODTFM                                 33
     C                   END
      *_____________
      * Sett nøkkel for å hente alle UA ('EDIRE     B')
      *"""""""""""""
     C     KEYSH8        SETLL     SADH8
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Behandl alle B-oppdrag,                           SRHOVE /
      *////////////////////////////////////////////////////////////
     C     SRHOVE        BEGSR
      *___________________
      * Hent alle SAD- med EDIRE/B. finn siste Recievemelding
      * via meldingsnr skriv  FRITEKST/ oppdater status i sadh
      *"""""""""""""""""
     C                   SETOFF                                           33
     C     FLERSH        TAG
     C     KEYSH8        READE     SADH8                                  33
     C  N33              DO
     C     UAVD          CABNE     SIAVD         FLERSH
     C                   MOVE      SITDN         WTDN
     C                   SETOFF                                           34
     C     KEYTM4        SETLL     EDIM4
     C     FLEREM        TAG
     C     KTM42         READPE    EDIM4                                  34
     C     *IN34         IFEQ      '1'
     C     KEYSH         CHAIN     SADH                               20
     C  N20              MOVE      'P'           SIST
     C  N20              UPDATE    SADHR
     C                   END
     C  N34M0065         IFNE      'CUSRES'
     C     M0065         ANDNE     'CUSDEC'
     C                   GOTO      FLEREM
     C                   END
     C  N34M1001         IFNE      '929'
     C     M1N07         ORNE      'DUA'
     C                   GOTO      FLEREM
     C                   END
     C  N34              EXSR      SRSKRI
     C                   GOTO      FLERSH
     C                   END
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Skriv en melding (en post i TVINF)                SRSKRI /
      *////////////////////////////////////////////////////////////
     C     SRSKRI        BEGSR
n01  C                   MOVE      *BLANKS       FSSOK
n01  C     FRIKEY        CHAIN     FRISOK                             20
      * Oppdatere tolldeklarasjon med ny status (Behold C ved DMK)
     C     KEYSH         CHAIN     SADH                               20
     C     SIKDDK        IFEQ      'D'
     C     KEYSH         SETLL     SADV                               33
     C     KEYSH         READE     SADV                                   33
     C  N33              MOVE      'P'           SIST
     C  N33              MOVE      ' '           SIMI
     C   33              MOVE      'U'           SIST
     C                   ELSE
     C                   MOVE      'U'           SIST
     C                   END
     C  N20              UPDATE    SADHR
N03  C     KEYSH         CHAIN     SADHMD                             38
N03  C                   IF        *IN38
N03  C                   EVAL      XSIFRDT = 0
N03  C                   ELSE
N03  C                   EVAL      XSIFRDTA = SIFRDTA
N03  C                   EVAL      XSIFRDTM = SIFRDTM
N03  C                   EVAL      XSIFRDTD = SIFRDTD
N03  C                   END
     C     SIKTC         IFEQ      ' '
     C     SIKDDK        COMP      'D'                                    01
     C     SIKDDK        COMP      'K'                                    02
     C                   ELSE
     C                   MOVEA     '00'          *IN(01)
     C                   END
      * Les alle på samme meldingsnr
      * IKKE SKRIV UT HELE PERSONNR. FOR PRIVATPERSONER
     C     1             SUBST     SIRG:11       PERSN             1
     C     PERSN         COMP      *BLANKS                            8989
     C                   WRITE     TVINUAA
     C     KEYTF         SETLL     TVINF
     C     FLEREF        TAG
     C     KEYTF         READE     TVINF                                  35
      * Skriv ut melding.
     C  N35              WRITE     TVINUAB
     C  N35
     CAN 51              DO                                                     OVERFLOW
      * IKKE SKRIV UT HELE PERSONNR. FOR PRIVATPERSONER
     C     1             SUBST     SIRG:11       PERSN             1
     C     PERSN         COMP      *BLANKS                            8989
     C                   WRITE     TVINUAA
     C                   SETOFF                                       51
     C                   END
     C  N35              GOTO      FLEREF
      *
     C                   ENDSR
