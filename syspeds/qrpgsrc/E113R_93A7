********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10172 * 01 SH  PTF10 norsk text til Track and trace
10172 * 02 SH  PTF10 ny parameter syge13
      *%%%%%%%%%%%%%%%%%%%%
      * 03 JOV PTF11 clear av array A før kall på getnum
      * XX JOV OBS!!!!!! må hentes fra Ramberg !!!!!!!!!
      ***
      * 11 JOV PTF11 FIXAI
      * 12 jov PTF11 ta hensyn til DMQ
      * 13 jov PTF11 kolli 9 manglet
      * 14 jov PTF11 akkumuler vekt/vil/lm frta evt flere linjer
********************************************************************
HAU   * OBS!! VISSE HARDKODEDE VERDIER
      *****************************************************************
      * MOTTAK AV IFCSUM RETT INN TIL HEADF M.M FOR "OPTIMAL INNLAND" *
      * AVDELING STYRES AV MOTTAKERS POSTNR                           *
      * OBS!! HARDKODET OM EN VIL LAGE DUP(UTKJØRING) (SØK "LAGDUP")  *
      * OBS!! KUNDENR OPPDRAGSGIVER("AGENT" SOM SENDER GODSLISTA) BØR *
      *  LIGGE I ECMSG (EDINMU3 PKT 5 "EDI-PARTERS STANDARDMELDINGER")*
     H DATEDIT(*YMD)
     FEDIS      IF   E           K DISK
     FEDIM      IF   E           K DISK
     FEUNB      IF   E           K DISK
     FFIRM      IF   E           K DISK
     FFIRINL    IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FECMSG2    IF   E           K DISK
     FETDT93A   IF   E           K DISK
     FERFF93A   IF   E           K DISK
     FECNI93A   IF   E           K DISK
     FEFTX93A   IF   E           K DISK
     FENAD93A   IF   E           K DISK
     FETOD93A   IF   E           K DISK
     FEGID93A   IF   E           K DISK
     FEMEA93A   IF   E           K DISK
     FEPCI93A   IF   E           K DISK
     FETSR93A   IF   E           K DISK
     FEMOA93A   IF   E           K DISK
     FKODTRI    IF   E           K DISK
     FNOPNR     IF   E           K DISK
     FTELL      UF   E           K DISK
     FHEAD39    IF   E           K DISK
     F                                     RENAME(HEADFR:HEAD39R)
     FKODTA     IF   E           K DISK
     FSTED2D    IF   E           K DISK
     FTURER14   UF   E           K DISK
     FHEADF     O  A E             DISK
     FDISP      O  A E             DISK
     FFAKT      O  A E             DISK
     FDOKUFM    O  A E             DISK
     FFRISOK    O  A E             DISK
     FFREETXT   O  A E             DISK
     FDOK29     O  A E             DISK
     FHESTED    O  A E             DISK
     FTRACKF    O  A E             DISK
     D A               S              1    DIM(79)
     D B               S              1    DIM(18)
      *________________________
      * DS for decimal handling
      *""""""""""""""""""""""""
     D                 DS
     D  ZDEC                   1      7  6
     D  ZDEC6                  2      7
     D  ZHEL                  11     22  0
     D                 DS
     D  WMN2                   1      9  0
     D                 DS
     D  WPOS1                  1      3  0
     D  WPOS1A                 1      3
     D                 DS
     D  C1004                  1     35
     D  CSNDNR                 1     20
     D  C0117                  1     17
     D  C17                   17     17
     D  C1820                 18     20
     D                 DS
     D  HXHEAD                 1    256
     D  XXUR                   1      1
     D  XXFR                   2      4
     D  XXKDPL                 5      5
     D  XXLKA                  6      7
     D  XXSDF                  8     12
     D  XXTRI                 13     14
     D  XXSDT                 15     19
     D  XXLKS                 20     21
     D  XXSDFF                22     26
     D  XXLKK                 27     28
     D  XXSDVT                29     33
     D  XXVKT                 34     42  0
     D  XXFBV                 43     51  0
     D  XXM3                  52     58  3
     D  XXLM                  59     62  2
     D  XXNT                  63     69  0
     D  XXVERV                70     72
     D  XXVERB                73     75  2
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
      * Track/Trace-tekster
     D TTXED1          C                   CONST('Incoming EDI prepar-
     D                                     ed from sender      ')
      *
     D TTXED2          C                   CONST('Incoming EDI reciev-
     D                                     ed                  ')
      *
     D TTXSTR          C                   CONST('Order entered (proc-
     D                                     essed from EDI-data)')
      * Track/Trace-tekster
n01  D TTXED1L         C                   CONST('Innkommende EDI kla-
n01  D                                     gjort av avsender   ')
      *
n01  D TTXED2L         C                   CONST('Innkommende ED mott-
n01  D                                     att                 ')
      *
n01  D TTXSTRL         C                   CONST('Ordre opprettet(lag-
n01  D                                     et av  EDI-data)')
      *
     D CNAV            C                   CONST('B.H. RAMBERG A/S ')
     D CADR1           C                   CONST('SVEND HAUGSGT. 11')
     D CADR3           C                   CONST('3013 DRAMMEN     ')
      */////////////
      * MAIN LOGIC /
      */////////////
      *___________
      * Initiering
      *"""""""""""
     C                   EXSR      INIT
      *________
      * CONVERT
      *""""""""
     C                   EXSR      RTVD
      *
     C                   MOVE      '1'           *INLR
      *
      *////////////////////////////////////////////////////////////
      *                                                      INIT /
      *////////////////////////////////////////////////////////////
     C     INIT          BEGSR
     C     KEYMS0        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN0
     C     KEYMS1        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN1
     C                   KFLD                    ZREPB0
     C     KODTAK        KLIST
     C                   KFLD                    YYAUNI
     C                   KFLD                    YYAVD             4 0
     C                   MOVE      'A'           YYAUNI            1
     C     KUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C     STEDKE        KLIST
     C                   KFLD                    YYLAND            2
     C                   KFLD                    YYSTED            5
     C                   MOVE      'NO'          YYLAND
      *
     C     *LIKE         DEFINE    NMN           ZMN
     C     *LIKE         DEFINE    NGN           ZGN0
     C     *LIKE         DEFINE    NGN           ZGN1
     C     *LIKE         DEFINE    NREP0         ZREPB0
s14  C*    *LIKE         DEFINE    HEVKT         HXVKT
s14  C*    *LIKE         DEFINE    HEFBV         HXFBV
     C     *LIKE         DEFINE    HEM3          HXM3
s14  C*    *LIKE         DEFINE    HELM          HXLM
     C     *LIKE         DEFINE    TUTS          XUTS
     C     *LIKE         DEFINE    TUTVKT        XUTVKT
     C     *LIKE         DEFINE    TUTM3         XUTM3
     C     *LIKE         DEFINE    TUTLM         XUTLM
     C     *LIKE         DEFINE    TUAO          XUAO
      * INIT WORKFIELDS
      *
     C     *ENTRY        PLIST
     C                   PARM                    WMN1              9
     C                   MOVEL     WMN1          WMN2
     C                   Z-ADD     WMN2          ZMN
      * Get msg and interchange values
     C     ZMN           CHAIN     EDIM                               51
     C     MSN           CHAIN     EDIS                               51
      *
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
HAU  C                   MOVE      5871          XXTERM            4 0
     C     *LIKE         DEFINE    HEAVD         AVDZER
     C                   MOVE      *ZEROS        AVDZER
     C     AVDZER        CHAIN     FIRINL                             33
      *
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * RETREIVE INFO FROM EDIFACT DATABASE TO SYSPED400     RTVD /
      *////////////////////////////////////////////////////////////
     C     RTVD          BEGSR
      *_______________________
      * READ ALL MAIN SEGMENTS
      *"""""""""""""""""""""""
      * TDT05 - TRANSPORT DETAILS - HENTER DETTE FØRST AV ALT FORDI
      *         DETTE AVGJØR OM DET ER HENTEOPPDRAG ELLER DIREKTE...
      *         T8051=10 - FF-TUR -> HENOP/HENOS,
      *         20 - HOVEDTUR->ZEADF....   (SENERE...)
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     5             ZGN0
     C     KEYMS0        SETLL     ETDT93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ETDT93A                                51
     C     *IN51         DOWEQ     '0'
      *
     C                   MOVEL     T8212         XXBILN           10
      *
     C  N51KEYMS0        READE     ETDT93A                                51
     C  N51              END
     C                   END
      *
      *
     C*                    MOVELM1004     XXSNDN 20
      *
      *
      * RFF01 - FF = TURNR
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     01            ZGN0
     C     KEYMS0        SETLL     ERFF93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ERFF93A                                51
     C     *IN51         DOWEQ     '0'
      *
     C     R1153         IFEQ      'FF '
     C                   MOVEL     R1154         XXREFF            8
     C                   MOVE      '1'           *IN51
     C                   END
      *
     C  N51KEYMS0        READE     ERFF93A                                51
     C  N51              END
     C                   END
      *
      * DTM05 - TRANSP.DATO - HVIS INGENTING -> DAGENS DATO(MELDINGENS)
     C                   Z-ADD     MDT           XXDT              8 0
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     5             ZGN0
      *
      * NAD09 - HER BØR!!! EN HA INN ET NAD-SEGMENT PÅ HVEM SOM ER AVS.
      * NÅ - HENTE-OPPDR.HEADER SKRIVES NÅR FØRSTE LINJE-NAD ER LEST
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     9             ZGN0
      *
      *___________________
      * READ CONSIGNEMENTS  = LINJER  (= 401... SENDINGSNR)
      *"""""""""""""""""""
     C                   MOVE      *ZEROS        WSLNR2            3 0
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     15            ZGN0
     C     KEYMS0        SETLL     ECNI93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ECNI93A                                51
     C     *IN51         DOWEQ     '0'
      *DET KAN VÆRE ET 17 LANGT SENDINGSNR
     C     C1820         IFEQ      *BLANKS
     C     C17           ANDNE     *BLANKS
     C                   MOVE      C0117         TMP17            17
     C                   MOVEL     '401'         CSNDNR
     C                   MOVE      TMP17         CSNDNR
     C                   END
      * FINNES SENDINGEN ALLEREDE...
     C                   movel     C1004         Sndnr20          20
     C     Sndnr20       chain     Head39                             33
     C     *IN33         CABEQ     '0'           NXTCNI
      *
     C                   EXSR      RTVDB
      *
     C     NXTCNI        TAG
     C     KEYMS0        READE     ECNI93A                                51
     C  N51              ENDDO
     C                   ENDIF
      *
     C     TUPRO         IFNE      *ZEROS
     C     TUPRO         CHAIN     TURER14                            33
     C     *IN33         IFEQ      '0'
     C                   MOVE      XUTS          TUTS
     C                   MOVE      XUTVKT        TUTVKT
     C                   MOVE      XUTM3         TUTM3
     C                   MOVE      XUTLM         TUTLM
     C                   MOVE      XUAO          TUAO
     C                   UPDATE    TURERR
     C                   END
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * RETREIVE INFO FROM EDIFACT DATABASE TO SYSPED400    RTVDB /
      *////////////////////////////////////////////////////////////
     C     RTVDB         BEGSR
      *__________________
      * INIT. DATAFELTER
      *""""""""""""""""""
      * Skal DUP-OPPDRAG (Henteoppdrag)lages?   Foreløpig hardkodet ...
      * med tiden styring via kode i "ett eller annet" edi-segment???
     C                   MOVE      'J'           LAGDUP            1
     C                   MOVE      'J'           LAGTUR            1
      *
     C                   CLEAR                   HEADFR
      * INNTIL VIDERE - SKRIV FRAKTBREV VED EDI-MOTTATTE OPPDRAG.
     C* IKKE VED OMEX      MOVE 'J'       HEPK1
      * Edi-kode... (K=Kundeløsning, I=InternEDI, E=Ekstern EDI)
     C                   MOVE      'E'           HXEDIK
     C                   MOVE      'H'           HEUR
     C                   MOVE      'HO'          TRSLAG
     C                   MOVE      'EDI'         HESG
     C                   MOVEL     C1004         SNDN             20
     C                   MOVEL     SNDN          HERFK
     C     ECMKEY        KLIST
     C                   KFLD                    M0004                          AVSENDER
     C                   KFLD                    M0010                          MOTTAKER
     C                   KFLD                    MSR                            R
     C                   KFLD                    M0065                          IFCSUM
     C     ECMKEY        CHAIN     ECMSG2                             33
     C     *IN33         IFEQ      '0'
     C                   Z-ADD     ECCNO         TRKNFA                         KNR OPD.GIV
     C                   Z-ADD     ECCNO         KUNDNR
     C     KUNKEY        CHAIN     CUNDL01                            33
     C  N33              MOVEL     KNAVN         HENAA                          NAVN OPD.GIV
     C                   ELSE
     C                   END
     C                   MOVE      TRKNFA        HEKNSF
     C                   MOVEL     'X'           HEKDFK
     C                   MOVEL     'S'           TRKDFF
     C                   MOVE      XXDT          HEDTR
     C                   MOVE      XXDT          HEDTOP
     C                   MOVE      XXDT          TRSDFD
     C                   MOVE      XXDT          TRSDTD
      *__________________
      * READ ALL SEGMENTS
      *""""""""""""""""""
     C                   Z-ADD     CREP0         ZREPB0
      * NAD25 TILDELER AVD/OPPDR.NR - DERFOR FØRST.
     C                   EXSR      NAD25
     C                   EXSR      TSR15
     C                   EXSR      MOA15
     C                   EXSR      FTX15
     C                   EXSR      TOD17
     C                   EXSR      RFF18
     C                   EXSR      GID31
     C                   EXSR      MEA34
     C                   EXSR      PCI37
      *__________________
      * LAGE UTKJ.-DUP???
      *""""""""""""""""""
     C     LAGDUP        IFEQ      'J'
      * NOEN ENDRINGER ALT PÅ HOVEDOPPDRAGET
      * Innhenting! Indiker at VIA på fraside (DUP) ER utført
     C                   MOVE      'O'           TRSTAE
     C                   MOVEL     'NO'          HELKK
     C                   MOVEL     XXTERM        HESDVT
     C                   MOVE      HEDTOP        TRSVTD
      * Hoved-oppd må referere til Duppens avd/opd (nedadgående ref)
     C                   Z-ADD     RIAVDH        TRAVD2
     C     TRAVD2        IFEQ      *ZEROS
HAU  C                   Z-ADD     5000          TRAVD2
     C                   END
     C                   MOVE      *ZEROS        TROPD2
     C     TRAVD2        CHAIN     TELL                               33
     C   33AVDZER        CHAIN     TELL                               33
     C                   MOVE      TEOPDN        TROPD2
     C                   ADD       1             TEOPDN
     C                   UPDATE    TELLR
     C                   END
      * ENKELTE VIL AT HOVEDOPPDRAGENE (=INNGÅENDE TUR) AUTOMATISK
      * SKAL SETTES PÅ TUR PÅ INNGÅENDE AVD, BILNR "UKJENT"
     C     LAGTUR        IFEQ      'J'
     C     TUPRO         ANDEQ     *ZEROS
     C                   MOVEL     'UKJENT'      XBILN            10
     C                   MOVE      HEAVD         XAVD              4 0
     C                   MOVE      *ZEROS        XPRO              8 0
     C                   MOVE      999           XANT              3 0          LAG NY!!
     C                   CALL      'SYTR88H'
     C                   PARM                    XAVD
     C                   PARM                    XBILN
     C                   PARM                    XPRO
     C                   PARM                    XANT
     C     XPRO          CHAIN(N)  TURER14                            33
     C                   END
     C                   MOVEL     TUPRO         HEPRO
     C                   MOVEL     TUBILN        HEHAWB
     C                   MOVE      TURUND        TRRUND
     C                   ADD       HENT          XUTS
     C                   ADD       HEVKT         XUTVKT
     C                   ADD       HEM3          XUTM3
     C                   ADD       HELM          XUTLM
     C                   ADD       1             XUAO
      *___________________
      * WRITE TO HEADF/DISP
      *"""""""""""""""""""
     C                   WRITE     HEADFR
      *
     C                   CLEAR                   DISPR
     C                   CLEAR                   HESTEDR
      *
     C                   MOVE      HEOPD         DIOPD
     C                   MOVE      HEAVD         DIAVD
     C                   MOVE      HEOT          DIOT
     C                   MOVE      HESG          DISIGN
     C                   MOVE      HESDF         DISTEF
     C                   MOVE      TRSDFD        DIDATF
     C                   MOVE      HESDT         DISTET
     C                   MOVE      TRSVTD        DIDATT
     C                   MOVE      'E'           DISTA1
     C                   MOVE      *BLANKS       XDSONT            5             (D=DUP=VF)
     C                   MOVE      HESDF         YYSTED
     C     STEDKE        CHAIN     STED2D                             35
     C  N35              MOVEL     ST2NVN        HSFROM
     C                   MOVEL     'NO'          DISONF
     C  N35              MOVE      ST2SOL        DISONF
     C                   MOVE      HESDT         YYSTED
     C     STEDKE        CHAIN     STED2D                             35
     C  N35              MOVEL     ST2NVN        HSTO
     C                   MOVEL     'NO'          DISONT
     C  N35              MOVE      ST2SOL        DISONT
     C  N35              MOVEL     ST2LK         XDSONT
     C  N35              MOVE      ST2SOL        XDSONT
     C     HESDVT        IFNE      *BLANKS
      * Hovedfraktens SLUTT-pkt skal inn i DISP-sone
     C                   MOVE      HESDVT        DISTEF
     C                   MOVE      HESDVT        YYSTED
     C     STEDKE        CHAIN     STED2D                             35
     C  N35              MOVEL     ST2NVN        HSVIA2
     C  N35              MOVEL     ST2LK         DISONT
     C  N35              MOVE      ST2SOL        DISONT
     C                   END
      * TUR-INFO (ER 0 HVIS LAGTUR ULIK "J")
     C                   MOVE      TUAVD         DITUAV
     C                   MOVE      TUPRO         DITUR
     C                   MOVE      TURUND        DIRUND
     C                   WRITE     DISPR
      *
     C                   MOVE      HEAVD         HSAVD
     C                   MOVE      HEOPD         HSOPD
     C                   WRITE     HESTEDR
      *
     C     FIURBL        IFEQ      'J'
     C                   EXSR      TTSR
     C                   END
      *
      * SKAL DET SKAPES UTKJ-OPPDRAGS-DUP??
     C     TROPD2        IFNE      *ZEROS
     C                   EXSR      LAGVF
     C                   END
      *
     C                   ENDSR
     C***********************************************
     C     LAGVF         BEGSR
     C***********************************************
      * DUP SKAL UANSETT IKKE VÆRE PÅ TUR
     C                   MOVE      *ZEROS        HEPRO
     C                   MOVE      *BLANKS       HEHAWB
     C                   MOVE      *ZEROS        TRRUND
      * KUNDE FOR DUPFRAKT
     C                   MOVE      *ZEROS        DUPKNR            8 0
     C                   MOVE      TRAVD2        YYAVD
     C     KODTAK        CHAIN     KODTA                              33
     C  N33              MOVE      KOAKNR        DUPKNR
      * INNHENTINGS DUP-OPPDRAGET, ENDRE VISSE DATA
     C                   MOVE      *ZEROS        HEKNA                           AGENT
      * VIA-data fra hovedoppdraget blankes - Tilsted=terminal
     C*DUP-OPPDRAGET FÅR ALLTID PREFIX 402 FOR Å SKILLES FRA HOVED.OPPD
     C                   MOVEL     '402'         HERFK
     C                   MOVE      *ZEROS        HXPALL
     C     HEVKT         IFLE      IFOTVG
     C                   MOVEL     IFOTVF        HEOT
     C                   ELSE
     C                   MOVEL     IFO2VF        HEOT
     C                   END
     C                   MOVE      IFFRVF        HEFR
     C                   MOVE      *ZEROS        HEKNKF
     C                   MOVEL     'X'           HEKDFK
     C                   MOVEL     ' '           HEKDFS
     C                   MOVEL     'S'           TRKDFF
     C                   MOVE      DUPKNR        HEKNSF
     C                   MOVE      DUPKNR        KUNDNR
     C     KUNKEY        CHAIN     CUNDL01                            33
     C  N33              MOVE      KNAVN         HENASF
      *
     C                   MOVE      *BLANKS       TRSTAE
     C                   MOVE      *BLANKS       HELKS
     C                   MOVE      *BLANKS       HESDVT
     C                   MOVE      *ZEROS        TRSVTD
     C                   MOVEL     'NO'          HETRI
     C                   MOVE      *BLANKS       HESDF
     C                   MOVEL     XXTERM        HESDF
     C                   MOVEL     'VF'          TRSLAG
      * REF TIL OVERORNET OPPDRAG...
     C                   MOVE      HEAVD         TRAVD0
     C                   MOVE      HEOPD         TROPD0
      * DUP.OPPDRAGETS AVD/OOPDR.NR
     C                   MOVE      TRAVD2        HEAVD
     C                   MOVE      TROPD2        HEOPD
     C                   MOVE      *ZEROS        TRAVD1
     C                   MOVE      *ZEROS        TROPD1
     C                   MOVE      *ZEROS        TRAVD2
     C                   MOVE      *ZEROS        TROPD2
      * AUTOPRISE DUP-OPPDRAGET
     C                   EXSR      BERFRP
     C                   MOVEL     ' '           TRFRAK
     C                   MOVE      *ZEROS        TRFRAB
     C                   MOVE      'N'           TRMVA
     C     UUBELØ        IFNE      *ZEROS
     C                   MOVEL     'M'           TRFRAK
     C                   Z-ADD     UUBELØ        TRFRAB
     C                   END
     C                   MOVE      ' '           HEPK1
     C                   WRITE     HEADFR
      * Faktura-post
     C     TRFRAB        IFNE      *ZEROS
     C                   CLEAR                   FAKTR
     C                   MOVE      *ZEROS        FALI
     C                   MOVE      HEAVD         FAAVD
     C                   MOVE      HEOPD         FAOPD
     C                   Z-ADD     TRFRAB        FABELV
     C                   Z-ADD     TRFRAB        FABELN
     C                   MOVE      'FRA'         FAVK
     C                   MOVE      FICURR        FAVAL
     C                   MOVE      TRMVA         FAKDM
     C                   MOVE      'M'           FAKDA
     C                   Z-ADD     TRAVD0        FAAVDR                          *DUP AV..
     C                   MOVE      HEKNSF        FAKUNR
     C                   MOVE      'I'           FASK
     C                   WRITE     FAKTR
     C                   END
      *
      * Stedsnavn i egen fil
     C                   CLEAR                   HESTEDR
     C                   MOVE      HEAVD         HSAVD
     C                   MOVE      HEOPD         HSOPD
     C                   MOVEL     HSVIA2        HSFROM
     C                   MOVE      *BLANKS       HSVIA2
     C                   WRITE     HESTEDR
      *
     C                   CLEAR                   DISPR
     C                   MOVE      HEOPD         DIOPD
     C                   MOVE      HEAVD         DIAVD
     C                   MOVE      HEOT          DIOT
     C                   MOVE      HESG          DISIGN
     C                   MOVE      HESDT         DISTET
     C                   MOVE      TRSVTD        DIDATT
     C                   MOVE      TRSVTK        DITIMT
     C                   MOVE      HESDT         DISTET
     C                   MOVE      TRSDTD        DIDATT
     C                   MOVE      TRSDTK        DITIMT
     C                   MOVE      XDSONT        DISONT
     C                   MOVE      ' '           DISTA1
      *
     C                   WRITE     DISPR
      *
     C     FIURBL        IFEQ      'J'
     C                   EXSR      TTSR
     C                   END
      *
     C                   ENDSR
      *
     C******************************************
     C     BERFRP        BEGSR
     C******************************************
     C* POSTNUMMERBASERT KALKULASJON
     C                   MOVE      'H'           XXUR
     C                   MOVE      'NO'          XXLKA
     C                   MOVE      'NO'          XXTRI
     C                   MOVE      *BLANKS       XXLKS
     C                   MOVE      *BLANKS       XXSDFF
     C                   MOVE      *BLANKS       XXLKK
     C                   MOVE      *BLANKS       XXSDVT
     C                   MOVE      *BLANKS       XXVERV
     C                   MOVE      *ZEROS        XXVERB
     C                   MOVE      *ZEROS        N5                5 0
     C                   MOVE      *ZEROS        NOPD              7 0
     C                   MOVE      ' '           USKA              1
     C                   Z-ADD     HEKNSF        UUKN              8 0
      * Finn frakt i kundersfraktavtale
     C                   MOVE      *BLANKS       UUVAL             3
     C                   MOVE      'FRA'         UGEB              3
     C                   MOVE      'FRA'         UGEBKO            3
     C                   MOVE      *ZEROS        UUBELØ           13 2
     C                   MOVE      HXHEAD        UHEAD           256
     C                   CALL      'SYGE14'
     C                   PARM                    UGEBKO
     C                   PARM                    UGEB
     C                   PARM                    UAVD              4 0
     C                   PARM                    NOPD
     C                   PARM                    UUKN
     C                   PARM                    UUVAL
     C                   PARM                    UUBELØ
     C                   PARM                    UAVNR             9 0
     C                   PARM                    UAVMSG           50
     C                   PARM                    USKA
     C                   PARM                    UHEAD
      * BRUTTO
     C     UUBELØ        IFEQ      0
     C                   MOVE      *BLANKS       USONE
     C                   MOVE      *BLANKS       UUVAL
     C                   MOVE      *ZEROS        URABAT
     C                   MOVE      HXHEAD        UHEAD           256
     C                   CALL      'SYGE13'
     C                   PARM                    UGEB
     C                   PARM                    UAVD
     C                   PARM                    NOPD
     C                   PARM                    UUVAL
     C                   PARM                    UUBELØ
     C                   PARM                    USONE             5
     C                   PARM                    URABAT            5 2
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    UUKN
     C                   PARM                    UHEAD
n02  C                   PARM                    ATDUM             1
     C                   END
     C                   ENDSR
     C*
      *
      *////////////////////////////////////////////////////////////
      * TSR15                                               TSR15 /
      *////////////////////////////////////////////////////////////
     C     TSR15         BEGSR
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     15            ZGN1
     C     KEYMS1        SETLL     ETSR93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     ETSR93A                                52
     C     *IN52         DOWEQ     '0'
      * RMD=FARLIG (-> ADR-MERKING)  ZHO=VARME (-> IMD-MERKING)
     C                   SELECT
     C     T7085         WHENEQ    'RMD'
     C                   MOVEL     'X'           TRFA21
     C     T7085         WHENEQ    'ZHO'
     C                   MOVEL     'X'           TRFA11
     C                   ENDSL
     C     KEYMS1        READE     ETSR93A                                52
     C                   ENDDO
      *
     C                   ENDIF
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * MOA15                                               MOA15 /
      *////////////////////////////////////////////////////////////
     C     MOA15         BEGSR
     C                   CLEAR                   FAKTR
     C                   MOVE      *ZEROS        XXLI              5 0
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     15            ZGN1
     C     KEYMS1        SETLL     EMOA93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     EMOA93A                                52
     C     *IN52         DOWEQ     '0'
      * '209' = AGENT COMMISSION AMOUNT
     C                   SELECT
     C     M5025         WHENEQ    '209'
N03  C                   CLEAR                   A
     C                   MOVEA     M5004         A
     C                   EXSR      GETNUM
      * INGEN FAKTURERING, MEN AVREGN-OMSETNING
     C                   Z-ADD     XXLI          FALI
     C                   MOVE      'E'           FASK
     C                   MOVE      'FRA'         FAVK
     C                   MOVE      HEAVD         FAAVDR
     C                   MOVE      HEAVD         FAAVD
     C                   MOVE      HEOPD         FAOPD
     C                   MOVE      'NOK'         FAVAL
     C                   MOVE      'N'           FAKDM
     C                   MOVE      'M'           FAKDA
     C                   Z-ADD     ZNUM          FABELN
     C                   Z-ADD     ZNUM          FABELV
     C                   Z-ADD     TRKNFA        FAKUNR
     C                   WRITE     FAKTR
     C     FALI          IFEQ      0
     C                   MOVE      'N'           TRMVA
     C                   MOVE      'E'           TRFRAK
     C                   Z-ADD     FABELN        TRFRAB
     C                   END
     C                   ADD       1             XXLI
     C                   ENDSL
     C     KEYMS1        READE     EMOA93A                                52
     C                   ENDDO
      *
     C                   ENDIF
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * FTX15                                               FTX15 /
      *////////////////////////////////////////////////////////////
     C     FTX15         BEGSR
     C                   CLEAR                   FREETXTR
     C                   MOVE      HEAVD         FRTAVD
     C                   MOVE      HEOPD         FRTOPD
     C                   Z-ADD     MDT           FRTDT
     C                   CLEAR                   DOK29R
     C                   MOVE      HEAVD         D29AVD
     C                   MOVE      HEOPD         D29OPD
     C                   Z-ADD     1             D29FNR
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     15            ZGN1
     C     KEYMS1        SETLL     EFTX93A                                20
     C     KEYMS1        READE     EFTX93A                                51
     C     *IN51         DOWEQ     '0'
      *
     C     F4451         IFEQ      'SIC'
     C                   MOVE      'G'           FRTKOD
      *
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440A        FRTTXT
     C                   WRITE     FREETXTR
      *
     C     F4440B        IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440B        FRTTXT
     C                   WRITE     FREETXTR
     C                   ENDIF
     C     F4440C        IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440C        FRTTXT
     C                   WRITE     FREETXTR
     C                   ENDIF
     C     F4440D        IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440D        FRTTXT
     C                   WRITE     FREETXTR
     C                   ENDIF
     C     F4440E        IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     F4440E        FRTTXT
     C                   WRITE     FREETXTR
     C                   ENDIF
     C                   ENDIF
      *
      **UNDERRETNING TIL KUNDE LEGGES RETT UT I RUBR38-FIL FOR FR.BREV
      * ALL FRITEKT PÅ DETT NIVÅ - RETT UT I RUBR38-FIL FOR FR.BREV
     C                   MOVEL     F4440A        D29TXT
     C                   WRITE     DOK29R
      *
     C     F4440B        IFNE      *BLANKS
     C                   MOVEL     F4440B        D29TXT
     C                   WRITE     DOK29R
     C                   ENDIF
     C     F4440C        IFNE      *BLANKS
     C                   MOVEL     F4440C        D29TXT
     C                   WRITE     DOK29R
     C                   ENDIF
     C     F4440D        IFNE      *BLANKS
     C                   MOVEL     F4440D        D29TXT
     C                   WRITE     DOK29R
     C                   ENDIF
     C     F4440E        IFNE      *BLANKS
     C                   MOVEL     F4440E        D29TXT
     C                   WRITE     DOK29R
     C                   ENDIF
      *
      *
     C     KEYMS1        READE     EFTX93A                                51
     C  N51              ENDDO
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * TOD17                                               TOD17 /
      *////////////////////////////////////////////////////////////
     C     TOD17         BEGSR
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     17            ZGN1
     C     KEYMS1        SETLL     ETOD93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     ETOD93A                                52
     C     *IN52         IFEQ      '0'
      *
     C                   SELECT
     C     T4215         WHENEQ    'CC'
     C                   MOVEL     'M'           HEFR
     C     T4215         WHENEQ    'TP'
     C                   MOVEL     'A'           HEFR
     C                   OTHER
     C                   MOVEL     'S'           HEFR
     C                   END
      *
     C                   ENDIF
     C                   ENDIF
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * RFF18                                               RFF18 /
      *////////////////////////////////////////////////////////////
     C     RFF18         BEGSR
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     18            ZGN1
     C     KEYMS1        SETLL     ERFF93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     ERFF93A                                52
     C     *IN52         DOWEQ     '0'
      *
     C                   SELECT
      * FF     FREIGHT FORWARDERS REF
     C     R1153         WHENEQ    'FF '
     C                   MOVE      HEAVD         FSAVD
     C                   MOVE      HEOPD         FSOPD
     C                   MOVE      'FFR'         FSKODE
     C                   MOVEL     R1154         FSSOK
     C                   WRITE     FRISOKR
      * LEGG UT  EGEN OMEX-FRISØSK
     C     HXEDIK        IFEQ      'O'
     C                   MOVE      'OME'         FSKODE
     C                   WRITE     FRISOKR
     C                   END
      * CU     CONSIGNOR'S REFERENCE NUMBER         (SENDERS REF)
     C     R1153         WHENEQ    'CU '
     C                   MOVEL     R1154         HERFA
      * AAO    CONSIGNEE'S SHIPMENT REFERENCE NUMBER(MOTTAKERS REF)
     C     R1153         WHENEQ    'AAO'
     C     HEFR          ANDEQ     'M  '
     C                   MOVEL     R1154         HERFA
     C                   ENDSL
      *
     C  N52KEYMS1        READE     ERFF93A                                52
     C  N52              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * NAD25                                               NAD25 /
      *////////////////////////////////////////////////////////////
     C     NAD25         BEGSR
      * PNRT= POSTNR FOR TEST / HENT AVDELING
      * (FRA-POSTNR V.INNGÅENDE / TIL-POSTNR V/UTGÅENDE)
     C                   MOVE      *ZEROS        PNRT
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     25            ZGN1
     C     KEYMS1        SETLL     ENAD93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     ENAD93A                                52
     C     *IN52         DOWEQ     '0'
      *
     C                   SELECT
     C     N3035         WHENEQ    'CZ'                                         GODSAVSENDER
      * NAD
N03  C                   CLEAR                   A
     C                   MOVEA     N3039         A
     C                   EXSR      GETNUM
     C*                    Z-ADDZNUM      HEKNS
     C                   MOVEL     N3036A        HENAS
     C                   MOVEL     N3042A        HEADS1
     C                   MOVEL     N3251         HEADS3
     C                   MOVEL     N3164         XXST25           25
     C                   MOVE      XXST25        HEADS3
     C                   MOVE      'NO'          HELKA
     C     LAGDUP        IFEQ      'J'
     C                   MOVEL     N3251         HESDF
     C                   MOVEL     N3251         PNRTA             4
     C                   TESTN                   PNRTA                34
     C     *IN34         IFEQ      '1'
     C                   MOVEL     N3251         PNRT              4 0
     C                   ELSE
     C                   MOVE      *ZEROS        PNRT
     C                   END
     C                   ELSE
     C                   MOVEL     XXTERM        HESDF
     C                   END
      *
     C     N3035         WHENEQ    'CN'                                         GODSMOTTAKER
     C     N3055         IFEQ      '87'
N03  C                   CLEAR                   A
     C                   MOVEA     N3039         A
     C                   EXSR      GETNUM
     C*                    Z-ADDZNUM      HEKNK
     C                   END
     C                   MOVEL     N3036A        HENAK
     C                   MOVEL     N3042A        HEADK1
     C                   MOVEL     N3251         HEADK3
     C                   MOVEL     N3164         XXST25
     C                   MOVE      XXST25        HEADK3
     C                   MOVE      'NO'          HETRI
     C                   MOVEL     N3251         HESDT
     C     PNRT          IFEQ      *ZEROS
     C                   MOVEL     N3251         PNRTA             4
     C                   TESTN                   PNRTA                34
     C     *IN34         IFEQ      '1'
     C                   MOVEL     N3251         PNRT              4 0
     C                   ELSE
     C                   MOVE      *ZEROS        PNRT
     C                   END
     C                   END
      * ANNEN FAK.BET
     C     N3035         WHENEQ    'IV'                                         F.MOT V. ANN
     C     N3055         IFEQ      '87'
N03  C                   CLEAR                   A
     C                   MOVEA     N3039         A
     C                   EXSR      GETNUM
     C*                    Z-ADDZNUM      HEKNSF
     C                   END
     C                   ENDSL
      *
     C     KEYMS1        READE     ENAD93A                                52
     C  N52              ENDDO
     C                   ENDIF
      *
      * ANTAR AT SENDINGER SOM KOMMER INN PÅ GODSLISTE ER
      * INNGÅENDE HVIS DUP (INNG. HOVEDOPPDRAG, MED UTGÅENDE DUP)
      * (VED INNG: POSTNR FRA AVGJØR AVDELING - PNRT INNEHOLDER FRA)
      * MEN REGNES SOM UTGÅENDE (KUN DISTRIBUSJ.KJØRING) NÅR DIREKTE
      * (VED UTG: POSTNR TIL AVGJØR AVDELING - PNRT INNEHOLDER TIL)
     C     KODRIK        KLIST
     C                   KFLD                    RITERM
     C                   KFLD                    PNRT
     C                   MOVE      XXTERM        RITERM
      *
     C                   MOVE      *ZEROS        HEAVD
     C     PNRT          IFNE      *ZEROS
     C     KODRIK        CHAIN     NOPNR                              33
     C     *IN33         IFEQ      *OFF
     C     NOAVDU        ANDNE     *ZEROS
     C                   MOVE      NOAVDU        RIAVDU
     C                   MOVE      NOAVDI        RIAVDI
     C                   MOVE      NOAVDH        RIAVDH
     C                   goto      AvdOK
     C                   END
     C     KODRIK        SETGT     KODTRI
     C     RITERM        READPE    KODTRI                                 33
     C  N33PNRT          IFGE      RIPNRF
     C     PNRT          ANDLE     RIPNRT
     C     AvdOk         Tag
     C     LAGDUP        IFEQ      'J'
     C                   MOVE      RIAVDI        HEAVD
     C                   ELSE
     C                   MOVE      RIAVDU        HEAVD
     C                   END
     C                   ENDIF
     C                   ENDIF
     C     HEAVD         IFEQ      *ZEROS
HAU  C                   Z-ADD     5000          HEAVD
     C                   MOVEL     'OBS AVD!'    HESDL
     C                   ENDIF
      * OPPDRAG MED 00000 SKAPER KAOS - BEDRE MED 1 V/FEIL...
     C     HEAVD         CHAIN     TELL                               33
     C   33              Z-ADD     1             TEOPDN
     C                   MOVE      TEOPDN        HEOPD
     C                   ADD       1             TEOPDN
     C  N33              UPDATE    TELLR
     C                   MOVE      HEAVD         DIAVD
     C                   MOVE      HEOPD         DIOPD
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * GID31                                               GID31 /
      *////////////////////////////////////////////////////////////
     C     GID31         BEGSR
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     31            ZGN1
     C     KEYMS1        SETLL     EGID93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     EGID93A                                52
     C     *IN52         DOWEQ     '0'
      *
     C     G1496         IFEQ      '99999'
N03  C                   CLEAR                   A
     C                   MOVEA     G7224A        A
     C                   EXSR      GETNUM
     C                   ADD       ZNUM          HENT
     C                   MOVEL     G7065A        HEVS1
     C     HEVS1         IFEQ      *BLANKS
     C     HEVS1         OREQ      'KLI'
     C                   MOVEL     'KLL'         HEVS1
     C                   ENDIF
     C                   ENDIF
      *
     C     KEYMS1        READE     EGID93A                                52
     C  N52              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *
      *
      *
      *////////////////////////////////////////////////////////////
      * MEA34                                               MEA34 /
      *////////////////////////////////////////////////////////////
     C     MEA34         BEGSR
N14   * dersom noen operere med samlelinje (99999) så forventes IKKE detaljlinjer..
N14   *        dermed kan en enkelt summere uansett uten  å teste på linjenr
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     34            ZGN1
     C     KEYMS1        SETLL     EMEA93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     EMEA93A                                52
     C     *IN52         DOWEQ     '0'
      *
N03  C                   CLEAR                   A
     C                   MOVEA     M6314         A
     C                   EXSR      GETNUM
     C                   SELECT
     C     M6311         WHENEQ    'WT '
s14  C*                  Z-ADD     ZNUM          HEVKT
s14  C*                  ADD       HEVKT         HXVKT
s14  C*                  ADD       HEVKT         HXFBV
n14  C                   ADD       ZNUM          HEVKT
     C     M6311         WHENEQ    'LMT'
s14  C*                  Z-ADD     ZNUM          HELM
s14  C*                  ADD       HELM          HXLM
N14  C                   ADD       ZNUM          HELM
     C     M6311         WHENEQ    'VOL'
N12  C     M6411         IFEQ      'DMQ'
S14  C*    ZNUM          DIV(H)    1000          HEM3
N14  C     ZNUM          DIV(H)    1000          HXM3
N14  C                   ADD       HXM3          HEM3
N12  C                   ELSE
S14  C*                  Z-ADD     ZNUM          HEM3
N14  C                   ADD       ZNUM          HEM3
N12  C                   END
S14  C*                  ADD       HEM3          HXM3
     C                   ENDSL
      *
     C     KEYMS1        READE     EMEA93A                                52
     C  N52              ENDDO
     C                   ENDIF
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * PCI37                                               PCI37 /
      *////////////////////////////////////////////////////////////
     C     PCI37         BEGSR
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     37            ZGN1
     C                   MOVE      *ZEROS        FMMKNR
     C     KEYMS1        SETLL     EPCI93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     EPCI93A                                52
     C     *IN52         DOWEQ     '0'
      *
     C     P4233         IFEQ      '18'
     C                   MOVE      'F'           FMRI
     C                   MOVE      HEAVD         FMAVD
     C                   MOVE      HEOPD         FMOPD
     C                   Z-ADD     1             FMFBNR
     C                   MOVE      'E'           FMST
     C                   ADD       1             FMMKNR
     C                   MOVEL     P7102A        FMMRK1
S11  C*                  MOVEL     P7102A        FMMRK1
N11  C                   MOVEL     P7102A        CLID             20
N11  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C     P7102B        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
S11  C*                  MOVEL     P7102B        FMMRK1
N11  C                   MOVEL     P7102B        CLID
N11  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102C        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
S11  C*                  MOVEL     P7102C        FMMRK1
N11  C                   MOVEL     P7102C        CLID
N11  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102D        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
S11  C*                  MOVEL     P7102D        FMMRK1
N11  C                   MOVEL     P7102D        CLID
N11  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102E        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
S11  C*                  MOVEL     P7102E        FMMRK1
N11  C                   MOVEL     P7102E        CLID
N11  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102F        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
S11  C*                  MOVEL     P7102F        FMMRK1
N11  C                   MOVEL     P7102F        CLID
N11  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102G        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
S11  C*                  MOVEL     P7102G        FMMRK1
N11  C                   MOVEL     P7102G        CLID
N11  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102H        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
S11  C*                  MOVEL     P7102H        FMMRK1
N11  C                   MOVEL     P7102H        CLID
N11  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102I        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
S11  C*                  MOVEL     P7102I        FMMRK1
N11  C                   MOVEL     P7102I        CLID
N11  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C     P7102J        IFNE      *BLANKS
     C                   ADD       1             FMMKNR
S11  C*                  MOVEL     P7102J        FMMRK1
N11  C                   MOVEL     P7102J        CLID
N11  c                   exsr      FixAI
     C                   WRITE     DOKUFMR
     C                   END
     C                   END
      *
     C     KEYMS1        READE     EPCI93A                                52
     C  N52              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
N11   ************************************************************
N11  C     FixAI         BEGSR
N11   ************************************************************
N11  C                   if        %subst(CLID:1:2)='00' and
N11  C                             %subst(CLID:20:1)<>' '
N11  C                   eval      FMMRK1=%subst(CLID:3)
N11  c                   else
N11  C                   eval      FMMRK1=CLID
N11  c                   end
N11  C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Get numerical value                               GETNUM /
      *////////////////////////////////////////////////////////////
     C     GETNUM        BEGSR
     C                   MOVE      *ZEROS        ZHEL
     C                   MOVE      *ZEROS        ZDEC
     C                   MOVE      *ZEROS        B
     C                   Z-ADD     1             AX                2 0
     C                   Z-ADD     1             BX                2 0
      * Get Integer
     C     A(AX)         DOWGE     '0'
     C     ZHEL          MULT      10            ZHEL
     C                   MOVE      A(AX)         ZHEL
     C                   ADD       1             AX
     C                   ENDDO
      * Decimal point ?
     C     A(AX)         IFEQ      '.'
     C     A(AX)         OREQ      ','
     C                   ADD       1             AX
     C     A(AX)         DOWGE     '0'
     C                   MOVE      A(AX)         B(BX)
     C                   ADD       1             AX
     C                   ADD       1             BX
     C                   ENDDO
     C                   MOVEA     B             ZDEC6
     C                   ENDIF
      * Concatenate
     C                   Z-ADD     ZHEL          ZNUM             18 6
     C                   ADD       ZDEC          ZNUM
     C                   ENDSR
     C***********************************************
     C     TTSR          BEGSR
     C***********************************************
      * EDI-FIL klargjort hos avsender (hentet fra EUNB)
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C     MSN           CHAIN     EUNB                               33
     C   33              MOVE      *ZEROS        U0017
     C   33              MOVE      *ZEROS        U0019
     C   33              MOVE      *ZEROS        TTDATE
     C                   MOVE      'ED1'         TTACTI
     C                   MOVEL     U0017         TSTÅR             2
     C  N33TSTÅR         IFGT      '43'
     C                   MOVEL     '19'          TTDATE
     C                   ELSE
     C                   MOVEL     '20'          TTDATE
     C                   END
     C                   MOVE      U0017         TTDATE
     C                   MOVEL     U0019         TTTIME
     C                   MOVE      '00'          TTTIME
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      ULDT          TTDATL
     C                   MOVE      XULTM         TTTIML
     C                   MOVEL     U0004         TTUSER
n01  C                   MOVE      *BLANKS       TTTEXT
     C                   MOVEL     TTXED1        TTTEXT
n01  C                   MOVE      *BLANKS       TTTEXL
n01  C                   MOVEL     TTXED1L       TTTEXL
     C                   WRITE     TRACKFR
      * EDI-fil mottatt og logget i SYSPED/SYEDI (hentet fra EDIS)
     C                   MOVE      'ED2'         TTACTI
     C                   MOVEL     SDT           TTDATE
     C                   MOVEL     STM           TTTIME
     C                   MOVE      *BLANKS       TTUSER
     C                   MOVEL     'SY400USR'    TTUSER
n01  C                   MOVE      *BLANKS       TTTEXT
     C                   MOVEL     TTXED2        TTTEXT
n01  C                   MOVE      *BLANKS       TTTEXL
n01  C                   MOVEL     TTXED2L       TTTEXL
     C                   WRITE     TRACKFR
      * Registrert (SKREVET TIL HEADF...)
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      'STR'         TTACTI
     C                   MOVE      ULDT          TTDATE
     C                   MOVE      XULTM         TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
     C                   MOVEL     'SY400USR'    TTUSER
n01  C                   MOVE      *BLANKS       TTTEXT
     C                   MOVEL     TTXSTR        TTTEXT
n01  C                   MOVE      *BLANKS       TTTEXL
n01  C                   MOVEL     TTXSTRL       TTTEXL
     C                   WRITE     TRACKFR
     C                   ENDSR
