      *
      ***********************************************************
      *** PROGRAM SKAL ARBEIDE MED REGLER OG BETINGELSER      ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01 02 04 07-11 13-24             ***
      *** LEDIGE INDIKATORER 29 31 32 34-39 55-59 61-84 88
      ***                    90 95-97                         ***
      ***********************************************************
      *
     FTRREGLUP  UF A E           K DISK
     FTRREGEL1  IF   E           K DISK    RENAME(TRREGR:TRREGR1)
     FTR006D    CF   E             WORKSTN
     F                                     SFILE(TR006D01:ZRECNO)
     F                                     INFDS(FBAREA)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
      *
     C                   EXSR      INIT
     C                   EXSR      ARBREG
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
     C***********************************************
     C     ARBREG        BEGSR
     C***********************************************
      *
     C     STAK1         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     TR006D02
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
     C                   MOVE      W2UNI1        Y2UNI1            1
     C                   MOVE      W2UNI2        Y2UNI2            5
     C                   MOVE      *BLANKS       XRUNI1            1
     C                   MOVE      *BLANKS       XRUNI2            5
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     TRREGL1K1     SETLL     TRREGEL1
     C                   READ      TRREGEL1                               94
      *
     C     STAK2         TAG
      *
     C  N94              DO
     C                   DO        17
     C                   ADD       1             ZRECNO
     C                   WRITE     TR006D01
     C                   READ      TRREGEL1                               94
     C  N94              MOVE      TRUNI1        XRUNI1
     C  N94              MOVE      TRUNI2        XRUNI2
     C  N94              END
     C                   END
      *
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
     C     STAK3         TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   EXFMT     TR006D07
     C                   ELSE
     C                   WRITE     TR006D03
     C                   EXFMT     TR006D02
     C                   END
     C                   SETOFF                                       999830
      *
      *** AVSLUTT
     C   03              GOTO      SLAK
      *
      *** FRISK OPP
     C   05              GOTO      STAK1
      *
      *** LAGE NY KODE
     C   06              DO
     C                   Z-ADD     16            LINNBR
     C                   Z-ADD     5             POSNBR
     C                   GOTO      STAK5
     C                   END
      *
      *** SØK
     C   08              GOTO      STAK6
      *
      *** BLA VIDERE
     C   25              DO
     C                   SETOFF                                       25
     C                   Z-ADD     YRECNO        ZRECNO
     C  N94TRREGL1K2     CHAIN     TRREGEL1                           94
     C                   GOTO      STAK2
     C                   END
      *
     C     ZRECNO        IFNE      0
     C                   EXSR      HENT
     C                   END
     C                   GOTO      STAK3
      *
      *** LAGE NY KODE
     C     STAK5         TAG
     C                   EXFMT     TR006D04
     C                   MOVEA     '000'         *IN(88)
     C                   MOVE      '0'           *IN30
     C   03              GOTO      SLAK
     C                   IF        *IN12 = *OFF
     C                   EXSR      TESTB2
     C   30              GOTO      STAK5
     C                   END
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   GOTO      STAK3
      *
      *** SØK
     C     STAK6         TAG
     C                   EXFMT     TR006D06
     C   12              GOTO      STAK3
     C                   GOTO      STAK1
      *
     C     SLAK          ENDSR
      *
      ***********************************************
     C     TESTB2        BEGSR
      ***********************************************
     C  N40              DO
     C     WSUNI1        COMP      *BLANKS                                90
     C  N90WSUNI2        COMP      *BLANKS                                90
     C   90              MOVE      'YBC0804'     MSGNR
     C   90              SETON                                        30
     C     TRREGL1K3     CHAIN(N)  TRREGLUP                           33
     C  N33              DO
     C                   MOVE      'YBC0805'     MSGNR
     C                   SETON                                        3090
     C                   END
     C   90              Z-ADD     16            LINNBR
     C   90              Z-ADD     5             POSNBR
     C                   END
      *
     C     WSTXT1        IFEQ      *BLANKS
     C  N30              MOVE      'YBC0806'     MSGNR
     C  N30              Z-ADD     16            LINNBR
     C  N30              Z-ADD     13            POSNBR
     C                   SETON                                        8930
     C                   END
      *
     C   30              GOTO      SLTB1
      *
      *** OPPDATERE PÅ REGISTER OG SUBFIL
     C     TRREGL1K3     CHAIN     TRREGLUP                           33
     C                   EXSR      MOVWST
     C  N33              UPDATE    TRREGR
     C   33              WRITE     TRREGR
     C   40              UPDATE    TR006D01
     C  N40              ADD       1             YRECNO
     C  N40              Z-ADD     YRECNO        ZRECNO
     C  N40              WRITE     TR006D01
     C                   WRITE     TR006D02
     C                   EXSR      MOVB2
      *
     C     SLTB1         ENDSR
      *
      ***********************************************
     C     HENT          BEGSR
      ***********************************************
     C                   MOVEA     '00'          *IN(91)
     C     *IN98         DOWEQ     '0'
     C                   READC     TR006D01                               98
     C   98              DO
     C   99              MOVE      '0'           *IN98
     C                   MOVE      '0'           *IN99
     C                   GOTO      SLHENT
     C                   END
      *
     C     ZRECNO        DIV       17            XLIN              5 0
     C                   MVR                     XLIN
     C     XLIN          IFEQ      0
     C                   Z-ADD     24            XLIN
     C                   ELSE
     C                   ADD       5             XLIN
     C                   END
      *
     C                   SELECT
     C     WSNR          WHENEQ    '2'
     C     TRTXT1        COMP      '*DELETE'                              98
     C   98              GOTO      SLHENT
     C                   EXSR      CHGTRK
     C     WSNR          WHENEQ    '4'
     C     TRTXT1        COMP      '*DELETE'                              98
     C   98              GOTO      SLHENT
     C                   EXSR      DLTTRK
     C     WSNR          WHENEQ    '5'
     C     TRTXT1        COMP      '*DELETE'                              98
     C   98              GOTO      SLHENT
     C                   EXSR      DSPTRK
     C                   ENDSL
     C                   END
      *
     C     SLHENT        TAG
     C     *IN98         IFEQ      '1'
     C                   MOVE      'DIV0012'     MSGNR
     C                   SETON                                        30
     C                   ELSE
     C                   Z-ADD     5             LINNBR
     C                   END
     C                   Z-ADD     2             POSNBR
      *
     C                   ENDSR
      *
      ***********************************************
     C     CHGTRK        BEGSR
      ***********************************************
     C                   EXSR      MOVTWS
     C     STCHG         TAG
     C                   EXFMT     TR006D04
     C                   MOVEA     '000'         *IN(88)
     C                   SETOFF                                         30
     C   12              DO
     C                   UPDATE    TR006D01
     C                   EXSR      MOVB2
     C                   END
     C  N12              EXSR      TESTB2
     C  N12
     CAN 30              GOTO      STCHG
     C     XLIN          IFEQ      0
     C                   Z-ADD     6             LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     DLTTRK        BEGSR
      ***********************************************
     C                   SETON                                        99
     C                   EXFMT     TR006D05
     C  N12              DO
     C     TRREGL1K3     CHAIN     TRREGLUP                           33
     C  N33              DELETE    TRREGR
     C                   EXSR      MOVB1
     C                   END
     C     XLIN          IFEQ      0
     C                   Z-ADD     6             LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C                   UPDATE    TR006D01
      *
     C                   ENDSR
      *
      ***********************************************
     C     DSPTRK        BEGSR
      ***********************************************
     C                   SETON                                        99
     C                   EXFMT     TR006D05
     C     XLIN          IFEQ      0
     C                   Z-ADD     6             LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C                   UPDATE    TR006D01
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVWST        BEGSR
      ***********************************************
     C                   MOVE      WSUNI1        TRUNI1
     C                   MOVE      WSUNI2        TRUNI2
     C                   MOVE      WSTXT1        TRTXT1
     C                   MOVE      WSTXT2        TRTXT2
     C                   MOVE      WSTXT3        TRTXT3
     C                   MOVE      WSTXT4        TRTXT4
     C                   MOVE      WSTXT5        TRTXT5
     C                   MOVE      WSTXT6        TRTXT6
     C                   MOVE      WSTXT7        TRTXT7
     C                   MOVE      WSTXT8        TRTXT8
     C                   MOVE      WSTXT9        TRTXT9
     C                   MOVE      WSTXTA        TRTXTA
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVTWS        BEGSR
      ***********************************************
     C                   MOVE      TRUNI1        WSUNI1
     C                   MOVE      TRUNI2        WSUNI2
     C                   MOVE      TRTXT1        WSTXT1
     C                   MOVE      TRTXT2        WSTXT2
     C                   MOVE      TRTXT3        WSTXT3
     C                   MOVE      TRTXT4        WSTXT4
     C                   MOVE      TRTXT5        WSTXT5
     C                   MOVE      TRTXT6        WSTXT6
     C                   MOVE      TRTXT7        WSTXT7
     C                   MOVE      TRTXT8        WSTXT8
     C                   MOVE      TRTXT9        WSTXT9
     C                   MOVE      TRTXTA        WSTXTA
     C                   SETON                                        40
     C                   SETON                                        99
     C                   Z-ADD     16            LINNBR
     C                   Z-ADD     13            POSNBR
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVB1         BEGSR
      ***********************************************
     C                   MOVE      *BLANKS       TRUNI1
     C                   MOVE      *BLANKS       TRUNI2
     C                   MOVEL     '*DELETE'     TRTXT1
     C                   MOVE      *BLANKS       TRTXT2
     C                   MOVE      *BLANKS       TRTXT3
     C                   MOVE      *BLANKS       TRTXT4
     C                   MOVE      *BLANKS       TRTXT5
     C                   MOVE      *BLANKS       TRTXT6
     C                   MOVE      *BLANKS       TRTXT7
     C                   MOVE      *BLANKS       TRTXT8
     C                   MOVE      *BLANKS       TRTXT9
     C                   MOVE      *BLANKS       TRTXTA
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVB2         BEGSR
      ***********************************************
     C                   SETOFF                                       40
     C                   MOVE      *BLANKS       WSUNI1
     C                   MOVE      *BLANKS       WSUNI2
     C                   MOVE      *BLANKS       WSTXT1
     C                   MOVE      *BLANKS       WSTXT2
     C                   MOVE      *BLANKS       WSTXT3
     C                   MOVE      *BLANKS       WSTXT4
     C                   MOVE      *BLANKS       WSTXT5
     C                   MOVE      *BLANKS       WSTXT6
     C                   MOVE      *BLANKS       WSTXT7
     C                   MOVE      *BLANKS       WSTXT8
     C                   MOVE      *BLANKS       WSTXT9
     C                   MOVE      *BLANKS       WSTXTA
      *
     C                   ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     TRREGL1K1     KLIST
     C                   KFLD                    W2UNI1
     C                   KFLD                    W2UNI2
     C     TRREGL1K2     KLIST
     C                   KFLD                    XRUNI1
     C                   KFLD                    XRUNI2
     C     TRREGL1K3     KLIST
     C                   KFLD                    WSUNI1
     C                   KFLD                    WSUNI2
      *
     C                   ENDSR
      *
