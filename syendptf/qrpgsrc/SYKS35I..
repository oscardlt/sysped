********************************************************************
      * RETTINGER I DETTE PROGRAM:
     FFIRMTEL   UF A E           K DISK                                         X010
     FHEADF     IF   E           K DISK
     FLEVEL01   IF   E           K DISK
     FKOSTB8    UF   E           K DISK
     FKOSTA     IF   E           K DISK
     FFAKT      O  A E           K DISK
     FFIRM      IF   E           K DISK
     FFIRMINT   IF   E           K DISK
     D*
     D                SDS
     D  USERID               254    263
N02  D                 DS
N02  D  KBBILT                 1     15
N02  D  SIKOL                  1      3
N02  D  SSORDRE                4     10  0
     c                   exsr      init
     C                   EXSR      INTERI
     c                   seton                                        lr
     c                   return
     C******************************************
     C     INIT          BEGSR
     C******************************************
      *
     C     KEYHEA        KLIST
     C                   KFLD                    KBAVD
     C                   KFLD                    KBOPD
     C     KEYKOST       KLIST
     C                   KFLD                    KBNØKKE           1 0
     C                   z-add     5             KBNØKKE
     c                   read      firm                                   33
     c     fifirm        chain     firmint                            33
     C* henter teller hvis minst 1 post
     C     KEYKOST       chain     KOSTB8                             61
     c     *in61         ifeq      '0'
     C     FIFIRM        CHAIN     FIRMTEL                            61
     C                   ADD       1             FIJOU2
     C  N61              UPDATE    FIRMTR
     C   61              WRITE     FIRMTR
     C                   END
     C                   END
     c                   endsr
      ***********************************************
     C     INTERI        BEGSR
      ***********************************************
      *
     C     KEYKOST       SETLL     KOSTB8
     C     *in33         doweq     '0'
     C     KEYKOST       READE     KOSTB8                                 33
     C     *in33         ifeq      '0'
     C     KBBNR         chain     kosta                              34
     C  N34keyhea        chain     headf                              34
     c     *in34         ifeq      '0'
     C*                  Z-ADD     1             KBNØKK
     C                   UPDATE    KOSTBR
      * SKRIV TIL FAKTURAFIL
     C                   EXSR      FAKTSR
     c                   end
     c                   end
     C                   enddo
     C                   ENDSR
     C******************************************
     C     FAKTSR        BEGSR
     C******************************************
      *
     c                   clear                   faktr
     C                   Z-ADD     KABDT         FADATO
     C                   Z-ADD     KAFFDT        FADAFF
     C                   MOVE      KBAVD         FAAVD
     C                   MOVE      KBOPD         FAOPD
     C                   MOVE      *ZEROS        FALI
     C                   CALL      'SYGE06'
     C                   PARM                    FAAVD
     C                   PARM                    FAOPD
     C                   PARM                    FALI
     C     KBKN          IFEQ      HEKNSF                                       1B
     C                   MOVE      'S'           FASK
     C                   ELSE
     C     KBKN          IFEQ      HEKNKF                                       2B
     C                   MOVE      'K'           FASK
     C     HEUR          IFEQ      'D'                                           3B
     C     HESAML        ANDEQ     *BLANKS
     C                   MOVE      'F'           FASK
     C                   END                                                     3E
     C                   ELSE
     C                   MOVE      'X'           FASK
     C                   END                                                    2E
     C                   END                                                    1E
     C* På fakturalinja skal det opprinnelig KBVK (ikke evt. bilkode)
     C                   MOVE      KBVK          FAVK
     C                   MOVEL     LNAVN         FAVT
     C     KBBILT        IFNE      *BLANKS
     C     SIKOL         andeq     'SI:'
     C                   MOVEL     SSORDRE       FAVT
     C                   END
     C                   MOVE      SPLKOD        FAVT
     C                   MOVE      KAVAL         FAVAL
     C                   MOVE      KAVAL         FACURI
      * ALDRI MVA PÅ DISSE FØRINGER
     C                   MOVE      'N'           FAKDM
     C                   Z-ADD     KBBLHB        FABELV
     C* Snu beløp for kostnadslinje(kostnad ligger til kredit på oppd.)
     C                   MULT      -1            FABELV
     C                   Z-ADD     FABELV        FABELN
     C     KAVAL         IFNE      '   '
     C     KAVAL         ANDNE     FICURR
     C     KAVKU         DIV       KAOMRF        XFAKT             9 6
     C     FABELN        DIV       XFAKT         FABELV
     C                   END
     C                   MOVE      'K'           FAKDA
     C                   MOVE      *BLANKS       FA01
     C                   MOVE      ' '           FA01B
     C                   MOVE      ' '           FAKDUK
     C                   MOVE      ' '           FAKDUL
     C                   MOVE      *ZEROS        FABELU
     C                   MOVE      KABNR2        FAFAKT
     C                   MOVE      'T'           FAOPKO
     C                   Z-ADD     KBKN          FAKUNR
     C                   Z-ADD     KALNR         FALEVN
     C                   Z-ADD     KAPCC         FACC
     C                   Z-ADD     PERAAR        FAÅR
     C                   Z-ADD     PERNR         FAMND
     C                   Z-ADD     FIJOU2        FAJOUR
     C                   MOVE      *ZEROS        FAFRBN
     C                   MOVE      KSTED         FAAVDR
     C                   MOVE      KBARER        FABÆR
     C                   MOVE      KONTO         FAACCN
     C                   WRITE     FAKTR
      *
     C                   ENDSR
