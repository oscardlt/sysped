********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnrF*Sek Sig Vers Beskrivelse...........................
"""""F*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
P0XXXF* 01 CB VER10 OVERSETT SÆRNORSKE TEGN
10XXX * 02 YBC PTF10 SEND XML-FIL
10XXX * 03 CB  PTF10 Flere RFF segment kan forekomme
10XXX * 04 sh  PTF10 feil ved ekstern referanse
10XXX * 05 YBC PTF10 IKKE OPPDATER FEILMELDING PÅ SAD VED STATUS=P ELLER U
10212 * 06 YBC PTF10 OPPDATER RFF+IV OG RFF+PQ PÅ FRISOK
10XXX * 07 YBC PTF10 RETTELSE PÅ ENDRING 5. PURRING PÅ STIKK SKAL SKRIVES UT
10023 * 08 YBC PTF10 HOPP OVER ALLE INVOIC
10XXX * 09 YBC PTF10 OPPDATER XML-FIL VED 972,954,,,
10XXX * 10 YBC PTF10 IKKE OPPDATER FEILMELDING PÅ SAD VED STATUS=K/Å/Q
10XXX * 11 YBC PTF10 TEST Y0035='6' PGA. SEND XML-FEILMELDING
10172 * 12 SH  PTF10 norsk text til Track and trace
10XXX * 13 YBC PTF10 SEND KODE 999 I XML TIL AN
10XXX * 14 YBC PTF10 SENDNINGSDATO/SEKVENSNR/VERSJONNR SKAL SENDES TIL AN
10XXX * 15 SH  PTF10 SLETTER EVENTUELLE GAMLE ARKIVPOSTER
10247 * 16 YBC PTF10 INFORMASJON OM MIDLERTIDIG DEKLARASJON
10XXX * 17 SH  PTF10 utelate epost på oppdragstyper
10XXX * 18 YBC PTF10 OPPDATER P PÅ HEPK4 (IMPORT) ELLER HEPK6 (EKSPORT)
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11XXX * 19 YBC PTF11 MELDING 955 BEHANDLES SAMME SOM 954
11016 * 20 YBC PTF11 OMBEREGNING
11XXX * 21 YBC PTF11 OPPDATER NYTT LØPENR
11XXX * 22 YBC PTF11 HENT OPPDRAGS STATUS
11XXX * 23 YBC PTF11 RETTELSE PÅ ENDRING 10
11XXX * 24 YBC PTF11 OPPDATER SIMF VED VENTEKØ
11XXX * 25 YBC PTF11 OPPDATER OMBEREGNING PÅ ARKIV
11XXX * 26 YBC PTF11 RETTE ENDRING 19
11XXX * 27 YBC PTF11 RETTE ENDRING 10 (TEST OGSÅ PÅ STATUS=M
11XXX * 28 YBC PTF11 VED OMBEREGNING --> IKKE VENT MED UTSKRIFT
11101 * 29 YBC PTF11 5. LINJE FOR BEGRUNNELSE AV OMBEREGING
11XXX * 30 YBC PTF11 DATO OG TID PÅ MOTTAK AV TOLLDEK
11108‚* 31 YBC PTF11 OMBEREGNING PÅ OMBEREGNING
11XXX‚* 32 YBC PTF11 RETT FEIL PÅ ENDRING 29
11138 * 33 YBC PTF11 OPPDATER STATUS PÅ LINJE VED SPESIFISERT LINJENR
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
12XXX * 34 YBC PTF12 IKKE OPPDATER STATUS VED SLETTET LINJE
12XXX * 35 YBC PTF12 TEST TOTAL AVGIFT INKL. MOMS MOT 50-KR GRENSE
12XXX * 36 YBC PTF12 FEIL OPPDATERT T&T VED DUA
12053 * 37 YBC PTF12 FLERE FELTER ER ENDRET LENGDE
12125 * 38 YBC PTF12 IKKE OPPDATERE ERROR-STATUS VED SLETTET LINJE PÅ OMBEREGNING
12132 * 39 YBC PTF12 Epost på signatur opphever vente-kø (gjelde KUN melding fra TVINN).
12133 * 40 YBC PTF12 Purring på dokumentkontroll
12158 * 41 YBC PTF12 Ny status N for feil sendte ny versjon uten TVINN be om
12XXX * 42 YBC PTF12 IKKE OPPDATERE ERROR-STATUS PÅ ORIGINAL LINJE VED OMBEREGNING
12XXX * 43 YBC PTF12 Feilmelding 982 = Be om ny versjon, ikke dok.kontroll
12XXX * 44 SH  PTF12 Kall arkivprogram ved "lagt til manuellt behandl" og direktefortolling
12165 * 45 CB  Oppdater CW1
12XXX * 46 YBC PTF12 Rettelse på endring 42
12XXX * 47 YBC PTF12 Rettelse på endring 19 og 26
12234 * 48 YBC PTF12 Send XML-event til CW1
12235 * 49 YBC PTF12 Oppdater for ekspressfortolling
********************************************************************
      *****************************************************************
      *** PROGRAM SKAL KONVERTERE INNGÅENDE EDI-FACT FIL            ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER          ***
      *** LEDIGE INDIKATORER 01-26                                  ***
      *** LEDIGE INDIKATORER 27-32 35-37 39 40 44-50 54-80 84-92    ***
      ***                    95-99                                  ***
      *****************************************************************
     FFPXREF1   IF   E           K DISK
     FCUNDC03   IF   E           K DISK
N39  FKODTSI    IF   E           K DISK
     FARKTXT    IF   E           K DISK
     FFIRMARC   IF   E           K DISK
s15  F*rkivP    O  A E           K DISK
n15  Farkivl03  UF A E           K DISK
n15  FARKEXT    IF   E           K DISK
     FTVINRMD   O  A E           K DISK
     FTRACKF    O  A E           K DISK
     FFIRM      IF   E           K DISK
     FFRISOK    UF A E           K DISK
     FKODFRI    IF   E           K DISK
     FEDIRE     IF   E           K DISK
N49  FEDIM4     IF   E           K DISK    RENAME(EDIMR:EDIMR4)
N49  F                                     PREFIX(M4_)
N49  FSADEFDEF  IF   E           K DISK
     FSTANDI    IF   E           K DISK
     FSTANDE    IF   E           K DISK
     FSADH      UF   E           K DISK
N16  FSADHMD    UF A E           K DISK
N20  FSADHOM    UF   E           K DISK    RENAME(SADHR:SADHROM)
     FSAEH      UF   E           K DISK
N20  FSAEHOM    UF   E           K DISK    RENAME(SAEHR:SAEHROM)
N33  FSADV4     UF   E           K DISK
N33  FSAEV4     UF   E           K DISK
N31  FSADOMTH   UF   E           K DISK    PREFIX(OMT_)
N31  FSAEOMTH   UF   E           K DISK    PREFIX(OMT_)
     FHEADF     UF   E           K DISK
     FEDIM5     IF   E           K DISK
     F                                     RENAME(EDIMR:EDIMR5)
     FEDIC      UF   E             DISK
     FTVINE     IF   E           K DISK
S20  F*TVINF     O  A E             DISK
N20  FTVINF     IF A E           K DISK
     FEDIM      O  A E             DISK
     FEDIS      O  A E             DISK
      *___________________________
      * Finner username
      *"""""""""""""""""""""""""""
S29  D*FT1             S             70    DIM(4)
N29  D FT1             S             70    DIM(5)
N20  D AT1             S              2    DIM(20)
N20  D BL1             S             11  0 DIM(20)
N20  D                 DS
N20  D  SIFT11                 1     70
N20  D  SIFT12                71    140
N20  D  SIFT13               141    210
N20  D  SIFT14               211    280
N29  D  SIFT15               281    350
N20  D  SEFT11                 1     70
N20  D  SEFT12                71    140
N20  D  SEFT13               141    210
N20  D  SEFT14               211    280
N29  D  SEFT15               281    350
S29  D* FT2                    1    280    DIM(4)
N29  D  FT2                    1    350    DIM(5)
N20  D                 DS
N20  D  SITY01                 1      2
N20  D  SITY02                 3      4
N20  D  SITY03                 5      6
N20  D  SITY04                 7      8
N20  D  SITY05                 9     10
N20  D  SITY06                11     12
N20  D  SITY07                13     14
N20  D  SITY08                15     16
N20  D  SITY09                17     18
N20  D  SITY10                19     20
N20  D  SITY11                21     22
N20  D  SITY12                23     24
N20  D  SITY13                25     26
N20  D  SITY14                27     28
N20  D  SITY15                29     30
N20  D  SITY16                31     32
N20  D  SITY17                33     34
N20  D  SITY18                35     36
N20  D  SITY19                37     38
N20  D  SITY20                39     40
N20  D  SETY01                 1      2
N20  D  SETY02                 3      4
N20  D  SETY03                 5      6
N20  D  SETY04                 7      8
N20  D  SETY05                 9     10
N20  D  AT2                    1     40    DIM(20)
N20  D                 DS
N20  D  SIBL01                 1     11  2
N20  D  SIBL02                12     22  2
N20  D  SIBL03                23     33  2
N20  D  SIBL04                34     44  2
N20  D  SIBL05                45     55  2
N20  D  SIBL06                56     66  2
N20  D  SIBL07                67     77  2
N20  D  SIBL08                78     88  2
N20  D  SIBL09                89     99  2
N20  D  SIBL10               100    110  2
N20  D  SIBL11               111    121  2
N20  D  SIBL12               122    132  2
N20  D  SIBL13               133    143  2
N20  D  SIBL14               144    154  2
N20  D  SIBL15               155    165  2
N20  D  SIBL16               166    176  2
N20  D  SIBL17               177    187  2
N20  D  SIBL18               188    198  2
N20  D  SIBL19               199    209  2
N20  D  SIBL20               210    220  2
N20  D  SEBL01                 1     11  2
N20  D  SEBL02                12     22  2
N20  D  SEBL03                23     33  2
N20  D  SEBL04                34     44  2
N20  D  SEBL05                45     55  2
N20  D  BL2                    1    220  2 DIM(20)
     D                SDS
     D  ZUSER                254    263
n17  D                 DS
n17  D  av                     1     80  0 DIM(20)
n17  D  CAVD                   1     80
n17   *
n17  D                 DS
n17  D  OTY                    1     10    DIM(5)
n17  D  COPD                   1     10
      *
     D                 DS
     D  F0078A                 1     70
     D  F0078B                71    140
     D  F0078C               141    210
     D  F0078D               211    280
     D  F0078E               281    350
     D  F78                    1    350    DIM(5)
N16  D                 DS
N16  D  SIFRT1                 1     70
N16  D  SIFRT2                71    140
N16  D  SIFRT3               141    210
N16  D  SIFRT4               211    280
N16  D  SIFRT5               281    350
N16  D  FRT                    1    350    DIM(5)
     D                 DS
     D  FE                     1    256    DIM(256)
     D  FELT                   1    256
     D  XTLEGM                 1      3
     D  XTLLGM                 6     10
     D  XTLENY                 1      6
     D  XTLLNY                 7     16
     D                 DS
     D  AA                     1     80    DIM(80)
     D  AADS                   1     80
     D                 DS
     D  AB                     1     80    DIM(80)
     D  ABDS                   1     80
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     D                 DS
     D  HETLE                  1      6
     D  HETLL                  8     17
     D  HETOLL                 1     17
     D                 DS
     D  W0068                  1     16  0
     D  W0068A                 1      8  0
     D  W0068B                 9     14  0
     D  W0068C                15     16  0
     D                 DS
     D  ÆN068                  1     25
     D  Æ0068                  2     25
     D  Æ00683                10     25
     D                 DS
     D  EKSLØP                 1     16
     D  EKSSTE                 1      6
     D  LØPENR                 7     16
     D                 DS
     D  FRTTXT                 1     70
     D  FRTTX1                 1     16
     D  FRTTX2                17     70
     D                 DS
     D  SIST                   1      1
     D  SIDTG                  2     11
     D  SITLE                 12     17
     D  SIMF                  20     22
     D  SIPKL                 23     23
     D  SIWS                  24     33
     D  SI0035                34     34
     D  SIMI                  35     35
     D  SINAK                 36     65
     D  SIADK1                66     95
     D  SIADK2                96    125
     D  SIADK3               126    155
     D  SITLL                156    165
     D  SILV2                166    168
     D  SIUATK               166    166
N41  D  SIKDV                169    169
     D  SEST                   1      1
     D  SEDTG                  2     11
     D  SETLE                 12     17
     D  SEMF                  20     22
     D  SEPKL                 23     23
     D  SEWS                  24     33
     D  SE0035                34     34
     D  SEMI                  35     35
     D  SENAK                 36     65
     D  SEADK1                66     95
     D  SEADK2                96    125
     D  SEADK3               126    155
     D  SETLL                156    165
     D  SELV2                166    168
N41  D  SEKDV                169    169
     D                 DS
     D  WMBR                   1     10
     D  WMBRA                  1      1
     D  WMBRB                  2     10S 0
N02  D                 DS
N02  D  SISG                   1      3
N02  D  SESG                   1      3
N02  D                 DS
N02  D  SIGN                   1     15
N02  D  SEGN                   1     15
N02  D                 DS
N02  D  SIPOS                  1      9
N02  D  SEPOS                  1      8
N02  D                 DS
N02  D  SINTK                  1      7  0
N02  D  SENTK                  1      7  0
N02  D                 DS
N02  D  XPARM1                 1   1024
N02  D  XP101                  1     10                                         IMP/EKSP
N02  D  XP102                 11     26                                         SYSPEDREF
N02  D  XP1021                11     14                                         AVDELING
N02  D  XP1022                15     21                                         OPPDRAGSNR
N02  D  XP1023                22     24                                         SIGNATUR
N02  D  XP103                 27     41                                         GODSNR
N02  D  XP104                 42     48                                         POSISJON
N02  D  XP105                 49     83                                         SENDINGSREF
N02  D  XP106                 84     91                                         MELDINGSDATO
N02  D  XP107                 92     99                                         KLARERINGSDATO
N02  D  XP108                100    102                                         MELDINGSTYPE
N02  D  XP109                103    104                                         MELDINGSCKATAGORI
N02  D  XP110                105    106                                         FUNSJONSKODE
N02  D  XP111                107    109                                         KVALIFIKATOR
N02  D  XP112                110    124                                         TOTAL AVGIFTER
N02  D  XP113                125    140                                         LØPENR
N02  D  XP114                141    143                                         KODE FOR LØPENR
N02  D  XP115                144    160                                         PART-ID
N02  D  XP116                161    195                                         PARTSNAVN
N02  D  XP117                196    212                                         ANSVARLIG ID
N02  D  XP118                213    219                                         ANTALL KOLLI
N02  D  XP119                220    229                                         RELEASE/ERROR
N02  D  XP120                230    238                                         MELDINGSNR
N14  D  XP121                239    246                                         SEND.DATO
N14  D  XP122                247    252                                         SEND.SEKVENSNR
N14  D  XP123                253    254                                         SEND.VERSJONNR
N02  D                 DS
N02  D  XPARM2                 1   1024
N02  D  XP201                  1     20                                         ERP+??
N02  D  XP201T                 1     20    DIM(10)                              ERP+??
N02  D  XP202                 21    370                                         ERP+??:??????
N02  D  XP202T                21    370    DIM(10)                              ERP+??:??????
N02  D  XP203                371    520                                         ERC+???
N02  D  XP203T               371    520    DIM(50)                              ERC+???
     IEDIMR5
     I              M0004                       X0004
     I              M0010                       X0010
     I              M0035                       X0035
     I              M0062                       X0062
     I              M0065                       X0065
     I              M0068                       X0068
     I              M0068A                      X0068A
     I              M0068B                      X0068B
     I              M0068C                      X0068C
     I              M0068D                      X0068D
     I              M0068E                      X0068E
     I              M0068F                      X0068F
     I              M1001                       X1001
     I              M1004                       X1004
     I              M1225                       X1225
     I              M2005B                      X2005B
     I              M3039D                      X3039D
     I              M3039E                      X3039E
     I              M5004D                      X5004D
     I              M1N07                       X1N07
     I              M1N08                       X1N08
     I              M9N01                       X9N01
     I              MSN                         XSN
     I              MMN                         XMN
     I              MSR                         XSR
     I              MST                         XST
     I              MDT                         XDT
     I              MTM                         XTM
     I              MVEN                        XVEN
N37  ISADVR
N37  I              SVBELT                      I_SVBELT
     C*___________
     C* HODELOGIKK
     C*"""""""""""
     C                   EXSR      SRINIT
     C     SEGSTA        TAG
     C  NLR              EXSR      GETSEG
     C   LR              GOTO      SLUTT
     C     SEGNAM        CASEQ     'UNB'         SRUNB
     C     SEGNAM        CASEQ     'UNH'         SRUNH
     C     SEGNAM        CASEQ     'UNZ'         SRUNZ
     C                   END
     C                   GOTO      SEGSTA
     C     SLUTT         TAG
     C*__________________________________________________________
     C* SR for initiering                                  SRINIT
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     c**************************************************************
     C     SRINIT        BEGSR
     c**************************************************************
     C                   READ      FIRM                                   33
     C* HENTE DAGENS DATO OG TID
     C                   CALL      'SYGE15C'
     C                   PARM                    WDATO             8
     C                   PARM                    WTID              6
     C     *ENTRY        PLIST
     C                   PARM                    SLIB
     C                   PARM                    SFILE
     C                   PARM                    SMBR
     C                   PARM                    WS               10            (=TVINR)
     C* Returnerer J i OK dersom data er konvertert, N dersom ikke.
     C                   PARM                    OK                1
     C     FRIKEY        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    FSKODE            3
     C                   MOVE      'TLØ'         FSKODE
     C     FRIKE2        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    FSKOD2            3
     C                   MOVE      'TLE'         FSKOD2
N02   * DEFINER NØKKELFELT (SJEKK OM XML TILBAKE MELDING)
N02  C     FRIKE3        KLIST
N02  C                   KFLD                    MAVD
N02  C                   KFLD                    MTDN
N02  C                   KFLD                    FSKOD3            3
N45  C     FRIKEN45      KLIST
N45  C                   KFLD                    HEAVD
N45  C                   KFLD                    HEOPD
N45  C                   KFLD                    FSKODN45          3
N45  C                   MOVE      'N45'         FSKODN45
N06  C     FRISOKKIV     KLIST
N06  C                   KFLD                    MAVD
N06  C                   KFLD                    MTDN
N06  C                   KFLD                    FSKODEIV          3
N06  C                   MOVE      'TLI'         FSKODEIV
N06  C     FRISOKKPQ     KLIST
N06  C                   KFLD                    MAVD
N06  C                   KFLD                    MTDN
N06  C                   KFLD                    FSKODEPQ          3
N06  C                   MOVE      'TLP'         FSKODEPQ
     C* DEFINER NØKKELFELT FOR SADH
     C     TDEKEY        KLIST
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
N31  C     SADOMTHK      KLIST
N31  C                   KFLD                    MAVD
N31  C                   KFLD                    MTDN
N31  C                   KFLD                    OMT_SIOMBN
N31  C     SAEOMTHK      KLIST
N31  C                   KFLD                    MAVD
N31  C                   KFLD                    MTDN
N31  C                   KFLD                    OMT_SEOMBN
N33  C     SADVK         KLIST
N33  C                   KFLD                    MAVD
N33  C                   KFLD                    MTDN
N33  C                   KFLD                    SVLN
N33  C     SAEVK         KLIST
N33  C                   KFLD                    MAVD
N33  C                   KFLD                    MTDN
N33  C                   KFLD                    SVLN
     C* DEFINER NØKKELFELT FOR forenklet prosedyre
     C     TDEKEF        KLIST
     c                   kfld                    fpstat
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     c                   move      'O'           fpstat
     C     EPOKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    mail30
     C                   KFLD                    ARKUND
N39  C     KODTSIK       KLIST
N39  C                   KFLD                    KSIUNI
N39  C                   KFLD                    XSG
N39  C                   EVAL      KSIUNI = 'SI'
      * DEFINER NØKKELFELT FOR EDIM5
     C     KEYM5         KLIST
     C                   KFLD                    M0068
      * INIT AV ARBEIDSFELT
     C                   MOVE      'N'           OK                             UNB--> J    elt.
     C                   MOVE      *ZEROS        NUMVRD           15 0          Gener. num felt.
     C                   MOVE      *ZEROS        NUTEGN            1 0          "TEGN" numerisk rep.
     C                   MOVE      *BLANKS       SEGNAM            3            Segment navn
N20  C                   MOVE      *BLANKS       XOMB              1
N20  C                   MOVE      *BLANKS       XAN02             2
N20  C                   MOVE      *ZEROS        XN021             2 0
N20  C                   MOVE      *ZEROS        XN022             2 0
     C* De meldingstyper vi mottar i dag inneholder IKKE omberegning
     C                   MOVE      *ZEROS        M0068D                         Dek.dato.OMB/TDENR)
     C                   MOVE      *ZEROS        M0068E                         Dek.sekv.OMB/TDENR)
     C                   MOVE      *ZEROS        M0068F                         Dek.vers.OMB/TDENR)
     C* Enkelte felt i loggen benyttes ikke ved recieve
     C                   MOVE      *ZEROS        M2005B                         Ønsk.be.dat./TDENR)
     C                   MOVE      *ZEROS        M3039D                         Dek.referan./TDENR)
     C                   MOVE      *ZEROS        M3039E                         Eksp.enhet  /TDENR)
     C                   MOVE      *ZEROS        M5004D                         Depositum   /TDENR)
     C                   MOVE      *ZEROS        M9N01                          Eksp.priori./TDENR)
     C                   MOVE      *BLANKS       M1N08                          Meld.id.korr/TDENR)
     C                   MOVE      *BLANKS       MVEN                           Ventekode   /TDENR)
     C* Enkelte felt er faste ved recieve
     C                   MOVE      'R'           SSR                            Send/rec.sen
     C                   MOVE      'C'           SST                            Status sendi
     C                   MOVEL     WDATO         SDT                            Dato inn sen
     C                   MOVEL     WTID          STM                            Tid inn  sen
     C                   MOVE      'R'           MSR                            Send/rec.mel/TDENR)
     C                   MOVE      'C'           MST                            Status meld./TDENR)
     C                   MOVEL     WDATO         MDT                            Dato inn mel
     C                   MOVEL     WTID          MTM                            Tid inn  mel
     C* Datafelt AB i EDIRE (80 lang) går rett inn i array AB ved READ
     C* TN=81 soerger for automatisk overflyt array AB->AA ved kall av GETCH
      * HVIS NETTVERK=KOMMUNEDATA ER FØRSTE RECORD=3 (VED ORIGINAL)
      * DA ER FØRSTE KARAKTER 'ø' I LINJE 1 (LINJE 2 ER BLANK)
      * VED RETRANSMITT FÅR VI IKKE INN "RUSK I LINJE" 1 OG 2
     C     SMBR          SETLL     EDIRE
     C     SMBR          READE     EDIRE                                  LR
     C   LR              GOTO      ENDINI
     C                   MOVE      RDATA         ABDS
     C     AB(1)         IFEQ      'ø'
     C     1             DO        2
     C     SMBR          READE     EDIRE                                  LR
     C   LR              GOTO      ENDINI
     C                   END
     C                   END
     C*
     C                   MOVE      RDATA         ABDS
     C                   Z-ADD     81            TN                2 0
     C                   MOVE      'NO '         EOF               3             * FLAGG FOR EOF
     C                   MOVE      ' '           TEGN              1
     C                   MOVE      ' '           LOKAHE            1
     C*
     C* Spesielt reserverte tegn defineres her med både grafisk verdi og
     C* med en logisk verdi. Den grafiske verdien testes det mot i rutinen
     C* som henter tegn. Finner denne rutinen at at tegnet er ment som en
     C* spesialverdi (ikke ? foran), byttes tegnet med tilsvarende LOGISK VERDI
     C* (De logiske verdiene er ikke lesbre tegn,og vil aldri forekomme i den
     C* innkommende datastroemmen). '?' når brukt som opphevelse foran annet
     C* spesialtegn vil bli "spist" av henterutinen (GETCH) og en vil derfor
     C* kunne betrakte spoersmålstegn som grafisk tegn i resten av programmet.
     C*
     C* Ved andre standarder for spesialtegn er det bare å bytte verdiene til
     C* de GRAFISKE tegnene her. (Programmet arbeider da med riktige verdier).
     C                   MOVE      '?'           GRASPØ            1
     C                   MOVE      '+'           GRAPLU            1
     C                   MOVE      ':'           GRAKOL            1
     C                   BITON     '123457'      GRAAPP            1
     C                   BITOFF    '06'          GRAAPP
     C* Logiske verdier for spesialtegn
     C* LOGAPP = slutt på segmentet. I NODI er tegnet "'".
     C                   BITON     '17'          LOGAPP            1
     C                   BITOFF    '023456'      LOGAPP
     C* HVIS KOMMUNEDATA, INITIERE MED LOGAPP (GÅ RETT PÅ UNB)
     C                   MOVE      LOGAPP        TEGN
     C* LOGPLU = sparasjonstegn for Tag/dataelement. I NODI er tegnet "+".
     C                   BITON     '16'          LOGPLU            1
     C                   BITOFF    '023457'      LOGPLU
     C* LOGKOL = sparasjonstegn for delelement. I NODI er tegnet ":".
     C                   BITON     '167'         LOGKOL            1
     C                   BITOFF    '02345'       LOGKOL
     C* LOGBLA = utenlandske måten å vise blank.
     C                   BITON     '01234567'    LOGBLA            1
     C*
     C     ENDINI        ENDSR
      ****************************************************************
     C     SRUNB         BEGSR
      ****************************************************************
     C*__________________________________________________________
     C* SR for å hente UNBdata - (NodiID.)                 SRUNB
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C* Når UNB-segm er funnet sett 'J' i OK-param.(retur til CL-prog)
     C                   MOVE      'J'           OK                             UNB-->OK=J  elt.
     C* Sendingsnr fra fil
     C                   EVAL      WMBR=SMBR
     C                   EVAL      SSN=WMBRB
     C*
     C* Står nå på + i     'UNB+   -  nå foelger: UNOA:1+
     C                   DO        7
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C                   END
     C* TEGN er nå '+' forran Avsenders Nodi-ID
     C                   MOVE      *BLANKS       FE
     C     1             DO        35            NR                3 0
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C     TEGN          IFEQ      LOGPLU
     C     TEGN          OREQ      LOGAPP
     C     TEGN          OREQ      LOGKOL
     C                   GOTO      UNB001
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     UNB001        TAG
     C                   MOVEL     FELT          S0004                          Avsenders NODI-ID
     C* Possisjoner til '+' forran mottagers Nodi-ID
     C     TEGN          DOWNE     LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C                   END
     C* Hent mottakers Nodi-ID
     C                   MOVE      *BLANKS       FE
     C     1             DO        35            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C     TEGN          IFEQ      LOGPLU
     C     TEGN          OREQ      LOGAPP
     C     TEGN          OREQ      LOGKOL
     C                   GOTO      UNB002
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     UNB002        TAG
     C                   MOVEL     FELT          S0010                          Mottakers NODI-ID
     C* Possisjoner til '+' forran dato tidsfelt (mandatory)
     C     TEGN          DOWNE     LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C                   END
S30  C* Possisjoner til '+' forran sendingsref (mandatory)
S30  C*    TEGN          DOUEQ     LOGPLU
S30  C*                  EXSR      GETCH
S30  C*  LR              GOTO      ENDUNB
S30  C*                  END
N30   * Hent dato
N30  C                   Z-ADD     0             XDATO             8 0
N30  C     1             DO        7             NR
N30  C                   EXSR      GETCH
N30  C   LR              GOTO      ENDUNB
N30  C     TEGN          IFEQ      LOGPLU
N30  C     TEGN          OREQ      LOGAPP
N30  C     TEGN          OREQ      LOGKOL
N30  C                   GOTO      UNB003
N30  C                   END
N30  C                   MULT      10            XDATO
N30  C                   MOVE      TEGN          XDATO
N30  C                   ENDDO
N30  C     UNB003        TAG
N30  C                   ADD       20000000      XDATO
N30   * Hent tid
N30  C                   Z-ADD     0             XTID              4 0
N30  C                   IF        TEGN <> LOGPLU
N30  C     1             DO        5             NR
N30  C                   EXSR      GETCH
N30  C   LR              GOTO      ENDUNB
N30  C     TEGN          IFEQ      LOGPLU
N30  C     TEGN          OREQ      LOGAPP
N30  C                   GOTO      UNB004
N30  C                   END
N30  C                   MULT      10            XTID
N30  C                   MOVE      TEGN          XTID
N30  C                   ENDDO
N30  C     UNB004        TAG
N30  C                   END
     C* Hent sendingsreferanse
     C                   MOVE      *BLANKS       FE
     C     1             DO        256           NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C     TEGN          IFEQ      LOGPLU
     C     TEGN          OREQ      LOGAPP
     C                   GOTO      UNB010
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     UNB010        TAG
     C                   MOVEL     FELT          S0020                          Meldingsref.DI-ID
     C* Tegn er nå enten ' for segmentslutt eller + for neste felt
     C* Er testindikator satt ?? (ikke oppgitt eller '1' når oppgitt)
     C                   MOVE      ' '           S0035                          Testindikat.
     C* Spis 5 felt -i det sjette finnes evt testindikator.
     C* Treffes LOGAPP før fem felt er spist er testindikator ikke satt
     C                   DO        5                                            I
     C     TEGN          IFEQ      LOGAPP                                       ii
     C                   GOTO      ENDUNB
     C                   END                                                    ii
     C     1             DO        256           NR                             II
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C     TEGN          IFEQ      LOGPLU                                       III
     C     TEGN          OREQ      LOGAPP
     C                   GOTO      UNB020
     C                   END                                                    III
     C                   END                                                    II
     C     UNB020        TAG
     C                   END                                                    I
     C*
     C* Tegn er + foran testind.(el. ' -seg.slutt etter Ident kom.avt.)
     C*
     C     TEGN          IFEQ      LOGPLU                                       III
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNB
     C                   MOVE      TEGN          S0035                          Testindikato
     C                   END
     C*
      * Hente feil-kode tekst (000) og legge inn X000
     C                   MOVE      '000'         F0077
     C     F0077         CHAIN     TVINE                              33
     C                   MOVE      E4440         X4440            70
     C*
     C     ENDUNB        ENDSR
     C*
      **************************************************************
     C     SRUNZ         BEGSR
      **************************************************************
     C*__________________________________________________________
     C* SR for å hente UNZdata(oppdatere sendingslogg)     SRUNZ
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C* TEGN er nå '+' forran Antall meldinger i sendingen(numerisk)
     C                   MOVE      *ZEROS        NUMVRD
     C     1             DO        7             NR                             *max 7 foer '+'
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNZ
     C     TEGN          IFEQ      LOGPLU
     C                   GOTO      UNZT01
     C                   END
     C     TEGN          IFLT      '0'
     C     TEGN          ORGT      '9'
     C                   GOTO      UNZT01
     C                   END
     C                   MULT      10            NUMVRD
     C                   MOVE      TEGN          NUTEGN
     C                   ADD       NUTEGN        NUMVRD
     C                   END
     C     UNZT01        TAG
     C                   Z-ADD     NUMVRD        S0036
     C*
     C* Oppdater sendingsloggen
     C                   WRITE     EDISR
     C*
     C     ENDUNZ        ENDSR
      **************************************************************************
     C     GETCH         BEGSR
      **************************************************************************
     C*__________________________________________________________
     C* SR for å hente neste tegn i datastroem             GETCH
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C* Rutinen henter "TEGN" fra array AA. Ved slutten av AA "toemmes" AB inn
     C* i AA. (AB benyttes kun for alltid å kunne ha "lookahead-tegn" - LOKAHE)
     C* LR settes når en ved "Toemming" finner at AB-arrayet er tomt.
     C*
     C* "?" spises av SR når "?" kun varsler grafisk betydning av spesialtegn.
     C*Når tegn ved utgang av SR er ',+ eller :  er betydningen av ind. 98 :
     C*    98 ON -> kun grafisk betydning (uforandret)
     C*    98 OFF-> spesialtegn (Bytt tegn mot ikke lesbar logisk verdi LOG???)
     C                   SETOFF                                           98
     C     STACH         TAG
     C* Må ny record hentes inn i array AA (fra AB)?????
     C     TN            IFEQ      81
     C     EOF           IFEQ      'YES'
     C                   SETON                                            LR
     C                   GOTO      ENDCH
     C                   END
     C                   MOVE      ABDS          AADS
     C  N99SMBR          READE     EDIRE                                  99     *hent ny til AB
     C  N99              MOVE      RDATA         ABDS
     C   99              MOVE      *BLANKS       ABDS
     C   99              MOVE      'YES'         EOF                             * FLAGG FOR EOF
     C                   Z-ADD     1             TN                              * Tegn-index-nr
     C                   END
     C* Hent det tegn som TN peker på - Tegnet etter er "Lookahead"
     C                   MOVE      AA(TN)        TEGN
     C                   ADD       1             TN
     C     TN            IFLE      80
     C                   MOVE      AA(TN)        LOKAHE            1
     C                   ELSE
     C                   MOVE      AB(1)         LOKAHE
     C                   END
N01  C                   SELECT
N01  C     TEGN          WHENEQ    X'47'                                        å
N01  C                   MOVE      X'D0'         TEGN
N01  C     TEGN          WHENEQ    X'9F'                                        Å
N01  C                   MOVE      X'5B'         TEGN
N01  C     TEGN          WHENEQ    X'BB'                                        ø
N01  C                   MOVE      X'6A'         TEGN
N01  C     TEGN          WHENEQ    X'E0'                                        Ø
N01  C                   MOVE      X'7C'         TEGN
N01  C     TEGN          WHENEQ    X'9C'                                        æ
N01  C                   MOVE      X'C0'         TEGN
N01  C     TEGN          WHENEQ    X'9E'                                        Æ
N01  C                   MOVE      X'7B'         TEGN
N01  C                   ENDSL
     C* Dersom TEGN er "?" og LOKAHE er spes.tegn - "spis" spoersmålstegnet
     C* Når 98 er on her betyr det at "?" foran spesialtegn alt er "spist"
     C*        evt. nytt "?" er da grafisk tegn - LOKAHE skal da IKKE testes.
     C  N98TEGN          IFEQ      GRASPØ
     C     LOKAHE        COMP      GRAAPP                                 98
     C  N98LOKAHE        COMP      GRAPLU                                 98
     C  N98LOKAHE        COMP      GRAKOL                                 98
     C  N98LOKAHE        COMP      GRASPØ                                 98
     C   98              GOTO      STACH
     C                   END
     C* Ved N98 og ',+ eller : i TEGN betyr det at det IKKE var opphevelsestegn
     C* foran. Vi har med andre ord et LOGISK SPESIALTEN INNE
     C  N98TEGN          IFEQ      GRAAPP
     C                   MOVE      LOGAPP        TEGN
     C                   ELSE
     C     TEGN          IFEQ      GRAPLU
     C                   MOVE      LOGPLU        TEGN
     C                   ELSE
     C     TEGN          IFEQ      GRAKOL
     C                   MOVE      LOGKOL        TEGN
     C                   ELSE
     C     TEGN          IFEQ      LOGBLA
     C                   MOVE      ' '           TEGN
     C                   END
     C                   END
     C                   END
     C                   END
     C*
     C     ENDCH         ENDSR
      ************************************************************
     C     GETSEG        BEGSR
      ************************************************************
     C*__________________________________________________________
     C* SR for å hente neste Segment                       GETSEG
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C* "Spis tegn" til appostrof er lest
     C     TEGN          DOWNE     LOGAPP
     C                   EXSR      GETCH
     C   LR              GOTO      ENDSEG
     C                   END
     C* Har nå lest appostrof - de 3 neste vil være SEGMENTNAVN
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR                3 0
     C                   EXSR      GETCH
     C   LR              GOTO      ENDSEG
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          SEGNAM
     C* La TEGN være '+' etter segmentnavnet ved utgang av SR
     C                   EXSR      GETCH
     C* Segmentnavn returneres nå i variabel 'SEGNAM'
     C     ENDSEG        ENDSR
      *******************************************************************
     C     SRUNH         BEGSR
      *******************************************************************
     C*__________________________________________________________
     C* SR for å behandle UNH-segmentet                    SRUNH
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C* Felt fra sendingsloggen - som også legge på meldingsnivå
N02  C                   MOVE      *BLANKS       XPARM1
N02  C                   MOVE      *BLANKS       XPARM2
N02-1C                   MOVE      *ZEROS        XERCNR
N16  C                   MOVE      *ZEROS        XSIFRDT           8 0
     C                   MOVE      SSN           MSN                            Sendingsnr
     C                   MOVEL     S0004         M0004                          Nodiid-avs.
     C                   MOVEL     S0010         M0010                          Nodiid-mot.
     C* Om hele sendingen er test- da er den enkelte melding også test
     C     S0035         IFEQ      '1'
     C                   MOVE      '1'           M0035                          Test-indik.
     C                   END
     C* Hente meldingsnr fra fil (EDIC) og legge det inn MMN
     C     1             CHAIN     EDIC                               33
     C  N33              ADD       1             CMN
     C  N33              UPDATE    EDICR
     C  N33              MOVE      CMN           MMN                            Nr. i meld-
     C   33              Z-ADD     1             MMN                            ingsloggen
     C*                                                                ngde)
     C* Egen referanse inneholder TDEKEY+sign                          ngde)
     C* Her bør vi for IBM-nettet heller lese I EDIM for å finne key  ngde)
     C* via avsendt. (samme dato/sekv/med S i Send/Recieve-kode)       ngde)
     C* maxlengde i NODI for ref er 14-senest innen 15. steg skal + påtreffes.
     C                   MOVE      *BLANKS       FE
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNH
     C     TEGN          IFEQ      LOGPLU
     C                   GOTO      UNH010
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     UNH010        TAG
     C                   MOVEL     FELT          M0062
      *             01 I VERSJON.
     C* Hent meldings-ID (fra tollvesenet)  inn i felt M0065
     C                   MOVE      *BLANKS       FE
     C     1             DO        6             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNH
     C                   MOVE      TEGN          FE(NR)
     C                   END
N08  C                   IF        FELT = 'INVOIC'
N08  C                   GOTO      ENDUNH
N08  C                   END
     C                   MOVEL     FELT          M0065
     C*
     C* Hopp over evt versjon (det ser ut for at TAD alltid legger 1 her)
     C* (Delingstegn mellom ID/versjon er ':')
     C     TEGN          DOWNE     LOGPLU
     C     TEGN          ANDNE     LOGAPP
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNH
     C                   END
     C* Hent felles referanse (dato/sekvens/versjonsnr) og legg i felt N0068
     C                   MOVE      *BLANKS       FE
     C* Hvis sist leste tegn = + da finnes 0068 eller rett til neste.  N0068
     C     TEGN          IFEQ      LOGPLU
     C     1             DO        25            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNH
     C     TEGN          COMP      LOGPLU                                 33
     C  N33TEGN          COMP      LOGAPP                                 33
     C  N33              MOVE      TEGN          FE(NR)
     C   33              GOTO      UNH020
     C                   END
     C                   END
     C     UNH020        TAG
     C                   MOVEL     FELT          M0068                          Via DS->M...
N02  C                   MOVEL     FELT          XP105
     C                   MOVE      M0068         XAN11            11
     C     XAN11         IFEQ      *BLANKS
     C                   MOVEL     FELT          Æ0068                          Via DS->M...
     C                   ELSE
     C                   MOVEL     FELT          ÆN068                          Via DS->M...
     C                   END
     C                   MOVE      Æ00683        W0068
     C                   Z-ADD     W0068A        M0068A
     C                   Z-ADD     W0068B        M0068B
     C                   Z-ADD     W0068C        M0068C
      *
N20  C                   EVAL      XOMB = 'N'
     C     KEYM5         SETLL     EDIM5                              33
     C     UNH011        TAG
     C     KEYM5         READE     EDIM5                                  33
N20   *
N20   * TVINN BRUKER LIKETALL PÅ VERSJONNR
N20  C                   IF        *IN33 AND XOMB = 'N'
N20  C                   EVAL      XAN02 = %SUBST(M0068:24:2)
N20  C                   MOVE      XAN02         XN021
N20  C                   EVAL      XN022 = XN021 / 2 * 2
N20  C                   IF        XN021 = XN022
N20  C                   EVAL      XN021 = XN021 - 1
N20  C                   MOVE      XN021         XAN02
N20  C                   EVAL      %SUBST(M0068:24:2) = XAN02
N20  C     KEYM5         SETLL     EDIM5
N20  C                   EVAL      XOMB = 'J'
N20  C                   GOTO      UNH011
N20  C                   END
N20  C                   END
N20  C                   IF        *IN33 = *OFF AND XOMB = 'J'
N20  C                   Z-ADD     W0068C        M0068C
N20  C                   MOVE      W0068C        XAN02
N20  C                   EVAL      %SUBST(M0068:24:2) = XAN02
N20  C                   END
N20   *
     C  N33X1001         IFNE      '830'
     C     X1001         ANDNE     '929'
     C                   MOVEL     X0065         X0065X            3
     C     X0065X        IFEQ      'IFT'
     C                   GOTO      UNH011
     C                   END
     C     X0065X        IFEQ      'CUS'
     C                   MOVE      '830'         X1001
     C                   ELSE
     C                   MOVE      '929'         X1001
     C                   END
     C                   END
     C  N33              MOVE      X1001         M1001
     C   33              MOVE      *ZEROS        MAVD
     C   33              MOVE      *ZEROS        MTDN
     C   33              MOVE      *ZEROS        MFFBNR
      *
     C* Hent BGM-segment for meldingstype
     C     SEGNAM        DOWNE     'BGM'
     C                   EXSR      GETSEG
     C   LR              GOTO      ENDUNH
     C                   END
      * Hent feil-kode og legge inn i felt M1001
      * Y1001 = 932 ---> DUA/DTK   ELLERS   DFI/DME/DIU
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          Y1001             3
N02  C                   MOVEL     FELT          XP108
      * Lese '++137:' til før ekspedisjonsdato
     C                   MOVE      *BLANKS       FE
     C     1             DO        6             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNH
     C                   END
N02   * Lese ekspedisjonsdato
N02  C                   MOVE      *BLANKS       FE
N02  C     1             DO        8             NR
N02  C                   EXSR      GETCH
N02  C   LR              GOTO      ENDUNH
N02  C                   IF        (((TEGN = LOGKOL) OR
N02  C                               (TEGN = LOGPLU)) OR
N02  C                               (TEGN = LOGAPP))
N02  C                   LEAVE
N02  C                   END
N02  C                   MOVEL     TEGN          FE(NR)
N02  C                   ENDDO
N02  C                   MOVEL     FELT          XP106
      * Hent meldingskode og legge inn i felt M1225
     C     TEGN          DOWNE     LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNH
     C                   END
     C                   MOVE      *BLANKS       FE
     C     1             DO        2             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNH
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          M1225
N02  C                   MOVEL     FELT          XP109
     C                   MOVE      ' '           Y0035             1
      *
     C     M1225         IFEQ      '27 '
     C                   MOVE      'DFI'         M1N07
     C                   EXSR      SRRES
     C                   END
     C     M1225         IFEQ      '11 '
     C     Y1001         IFEQ      '932'
     C                   MOVE      'DUA'         M1N07
     C                   EXSR      SRDEC
     C                   ELSE
     C                   MOVE      'DME'         M1N07
     C                   EXSR      SRRES
     C                   END
     C                   END
     C     M1225         IFEQ      '32 '
     C                   MOVE      'DTK'         M1N07
     C                   EXSR      SRDEC
     C                   END
     C     M1225         IFEQ      'ZZ '
     C                   MOVE      'DIU'         M1N07
     C                   EXSR      SRRES
     C                   END
N20  C                   IF        M1225 = '19' OR M1225 = '18' OR M1225 = '43'
N20  C                   SELECT
N20  C                   WHEN      M1225 = '18'
N20  C                   MOVE      'DEB'         M1N07
N20  C                   WHEN      M1225 = '19'
N20  C                   MOVE      'DEB'         M1N07
N20  C                   WHEN      M1225 = '43'
N20  C                   MOVE      'DSO'         M1N07
N20  C                   ENDSL
N20  C                   EXSR      SRDOM
N20  C                   END
N49   *
N49  C                   IF        M1001 = '929' AND M1N07 <> 'DIU'             1<-B
N49  C                             AND M1N07 <> 'DFI' AND M1N07 <> 'DEB'
N49  C                             AND M1N07 <> 'DRE' AND M1N07 <> 'DSO'
N49   * EKSPRESS FORTOLLING. OPPDATER KLAR-OPPDRAG I SADEFCF.
N49  C     *LIKE         DEFINE    MSR           M4_MSR
N49  C                   EVAL      M4_MSR    = 'S'
N49  C     *LIKE         DEFINE    M0068C        M4_M0068C
N49  C                   EVAL      M4_M0068C = 1
N49  C     EDIM4K        KLIST
N49  C                   KFLD                    M4_MSR
N49  C                   KFLD                    MAVD
N49  C                   KFLD                    MTDN
N49  C                   KFLD                    M0068A
N49  C                   KFLD                    M0068B
N49  C                   KFLD                    M4_M0068C
N49  C     EDIM4K        CHAIN     EDIM4                              33
N49  C                   IF        *IN33 = *OFF                                  2<-B
N49   * SJEKK OM EKSPEDISJONSENHET LIGGER I AVDELINGSDEFAULT
N49  C     *LOVAL        SETLL     SADEFDEF
N49  C                   READ      SADEFDEF                               33
N49  C                   DOW       *IN33 = *OFF                                   3<-B
N49  C                   IF        EF3039E = M4_M3039E                             4<-B
N49  C                   LEAVE
N49  C                   END                                                       4<-E
N49  C                   READ      SADEFDEF                               33
N49  C                   ENDDO                                                    3<-E
N49   *
N49  C                   IF        *IN33 = *OFF                                   3<-B
N49   * EKSPEDISJONSENHET FOR EKSPRESSFORTOLLING ER FUNNET.
N49  C     TDEKEY        CHAIN(N)  SADH                               33
N49  C                   IF        *IN33 = *OFF AND SIDP = 40 AND SITDN > 0        4<-B
N49  C                             AND %SUBST(SIGN:7:1) = 'D'                   DIREKTE FORTOLLING
N49  C                             AND %SUBST(SIGN:8:8) = *BLANKS
N49  C                   MOVE      SIAVD         EF_AVD            4
N49  C                   MOVE      SITDN         EF_TDN            7
N49  C*                  MOVE      M4_M3039E     EF_3039E          6
N49  C                   MOVE      M0068A        EF_0068A          8
N49  C                   MOVE      M0068B        EF_0068B          6
N49  C                   MOVE      SINTK         EF_NTK            7
N49  C                   MOVE      SIVKB         EF_VKB            9
N49  C                   CALL      'SAD135R'
N49  C                   PARM                    EF_AVD
N49  C                   PARM                    EF_TDN
N49  C*                  PARM                    EF_3039E
N49  C                   PARM                    EF_0068A
N49  C                   PARM                    EF_0068B
N49  C                   PARM                    EF_NTK
N49  C                   PARM                    EF_VKB
N49  C                   PARM                    SITRID
N49  C                   END                                                       4<-E
N49  C                   END                                                      3<-E
N49  C                   END                                                     2<-E
N49  C                   END                                                    1<-E
      *
     C     ENDUNH        ENDSR
      ********************************************************************
     C     SRRES         BEGSR
      ********************************************************************
     C*__________________________________________________________
     C* SR for merknadsutskrift                            SRRES
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
      * Legg kryssreferanse til riktig meldingsnr
     C                   MOVE      MMN           FMN
     C                   MOVE      *ZEROS        FLN
N02  C                   MOVE      *ZEROS        XERPNR            3 0
N07  C                   MOVE      'N'           XUTMSG            1
     C* Nå skal finne ERC-segment
     C     STRES1        TAG
     C     SEGNAM        DOWNE     'ERP'
     C     SEGNAM        ANDNE     'ERC'
     C     SEGNAM        ANDNE     'FTX'
     C     SEGNAM        ANDNE     'DTM'
     C     SEGNAM        ANDNE     'GIS'
     C     SEGNAM        ANDNE     'UNT'
     C                   EXSR      GETSEG
     C   LR              GOTO      ENDRES
     C                   END
      *
     C     SEGNAM        IFEQ      'GIS'
     C                   EXSR      GETCH
     C                   MOVE      TEGN          Y0035
     C                   MOVE      *BLANKS       SEGNAM
     C                   GOTO      STRES1
     C                   END
     C     SEGNAM        IFEQ      'FTX'
     C                   GOTO      STRES3
     C                   END
     C     SEGNAM        IFEQ      'DTM'
      * Teste om dataelement er 184. Hvis ikke, leser neste 'DTM'
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDRES
     C     TEGN          CABEQ     LOGKOL        SRRS21
     C     TEGN          CABEQ     LOGPLU        SRRS21
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     SRRS21        TAG
     C                   MOVEL     FELT          XAN3              3
S16  C*    XAN3          IFNE      '184'
N16  C                   IF        XAN3 <> '184' AND XAN3 <> '255'
     C                   MOVE      *BLANKS       SEGNAM
     C                   GOTO      STRES1
     C                   END
      * Lese forbi kollon (:)
N16  C                   IF        TEGN <> LOGKOL AND TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDRES
N16  C                   END
      *
     C                   MOVE      *BLANKS       FE
     C     1             DO        14            NR                                         6 ganger
     C                   EXSR      GETCH
     C   LR              GOTO      ENDRES
     C     TEGN          CABEQ     LOGKOL        SRRS22
     C     TEGN          CABEQ     LOGPLU        SRRS22
     C     TEGN          CABEQ     LOGAPP        SRRS22
     C                   MOVEL     TEGN          FE(NR)
     C                   END
     C     SRRS22        TAG
N16  C                   SELECT
N16  C                   WHEN      XAN3 = '184'
     C                   MOVEL     FELT          XAN14            14
     C                   MOVEL     XAN14         M2005B
     C                   MOVE      XAN14         M3039D
     C                   MOVEL     '00'          M3039D
N16  C                   WHEN      XAN3 = '255'
N16  C                   MOVEL     FELT          XSIFRDT           8 0
N16  C                   ENDSL
     C                   MOVE      *BLANKS       SEGNAM
     C                   GOTO      STRES1
     C                   END
     C     SEGNAM        IFEQ      'UNT'
     C                   GOTO      ENDRES
     C                   END
      *
      * Hente feilmelding fra TVINE og legge inn i TVINF
     C     SEGNAM        IFEQ      'ERP'
     C                   EXSR      SRRES4
     C                   ELSE
     C                   EXSR      SRRES2
     C                   END
     C                   MOVE      *BLANKS       SEGNAM
     C                   GOTO      STRES1
      * Prøve å finne FTX-segment
     C     STRES2        TAG
     C   LR              GOTO      ENDRES
     C     SEGNAM        DOWNE     'FTX'
     C     SEGNAM        ANDNE     'UNT'
     C                   EXSR      GETSEG
     C   LR              GOTO      ENDRES
     C                   END
     C     SEGNAM        IFEQ      'UNT'
     C                   GOTO      ENDRES
     C                   END
     C     STRES3        TAG
      * Hente feilmeld. som er sendt av Tollvesene / legge inn i TVINF
     C                   EXSR      SRRES3
     C                   MOVE      *BLANKS       SEGNAM
     C                   GOTO      STRES2
     C*
     C* Har nå UNT-segmentet inne
     C*
     C     ENDRES        TAG
      * Har nå nødvendig info for å oppdatere meldingslogg
     C                   WRITE     EDIMR
     C*
     C                   MOVE      'N'           EMAILJ            1
     C*
     C* Merk SAEH-record for utskrift av melding
     C     M1001         IFEQ      '929'
     C     TDEKEY        CHAIN     SADH                               33
N05  C  N33              IF        M1N07 <> 'DIU'
S10  C*                  IF        ((SIST = 'P') OR (SIST = 'U'))
N10  C                   IF        SIST = 'P' OR SIST = 'U' OR
N10  C                             SIST = 'K' OR SIST = 'Å' OR
S23  C*                            SIST = '1' OR SIST = '2' OR
S23  C*                            SIST = '3' OR SIST = 'Q'
N23  C                             SIST = '2' OR SIST = '3' OR
S27  C*                            SEST = 'Q'
N27  C                             SEST = 'Q' OR SIST = 'M'
N07  C                   IF        XUTMSG <> 'J'
N05  C                   UPDATE    SADHR
N05  C                   EVAL      *IN33 = *ON
N07  C                   END
N05  C                   END
N05  C                   END
      *
      * SKAL EMAIL SENDES
     C                   END
     C     M1001         IFEQ      '830'
     C     TDEKEY        CHAIN     SAEH                               33
N05  C  N33              IF        M1N07 <> 'DIU'
S10  C*                  IF        ((SEST = 'P') OR (SEST = 'U'))
N10  C                   IF        SEST = 'P' OR SIST = 'U' OR
N10  C                             SEST = 'K' OR SIST = 'Å' OR
N10  C                             SEST = 'Q'
N07  C                   IF        XUTMSG <> 'J'
N05  C                   UPDATE    SAEHR
N05  C                   EVAL      *IN33 = *ON
N07  C                   END
N05  C                   END
N05  C                   END
     C                   END
N48   *
N48   * OPPDATERE CW1
N48  C                   MOVE      MAVD          UAVD
N48  C                   MOVE      MTDN          UTDN
N48  C                   SELECT
N48  C                   WHEN      Y0035 = '5'
N48  C                   EVAL      UTYPE = 'DKT'
N48  C                   WHEN      Y0035 = '6'
N48  C                   EVAL      UTYPE = 'VKT'
N48  C                   WHEN      Y0035 = '9'
N48  C                   EVAL      UTYPE = 'MAN'
N48  C                   OTHER
N48  C                   EVAL      UTYPE = 'MSG'
N48  C                   ENDSL
N48  C                   SELECT
N48  C                   WHEN      M1001 = '830'
N48  C                   EVAL      UIE = 'EXP'
N48  C                   WHEN      M1001 = '929'
N48  C                   EVAL      UIE = 'IMP'
N48  C                   ENDSL
N48  C                   CALL      'SYXML53'
N48  C                   PARM                    UAVD              4
N48  C                   PARM                    UTDN              7
N48  C                   PARM                    UTYPE             3
N48  C                   PARM                    UREF             17
N48  C                   PARM                    UIE               3
N48   *
     C     M1N07         IFEQ      'DIU'
     C                   MOVE      *BLANKS       SIMI
N20  C                   IF        MTDN < 0
N20  C                   IF        M1001 = '929'
N20  C     TDEKEY        CHAIN     SADHOM                             34
N20  C                   ELSE
N20  C     TDEKEY        CHAIN     SAEHOM                             34
N20  C                   END
N20  C     MMN           SETLL     TVINF
N20  C                   Z-ADD     0             XFT2NR            3 0
N20  C     MMN           READE     TVINF                                  34
N20  C                   DOW       *IN34 = *OFF
S29  C*    2             DO        5             XN01
S32  C*    2             DO        6             XN01
N32  C     2             DO        5             XN01
N20  C                   IF        F78(XN01) <> *BLANKS
N20  C                   ADD       1             XFT2NR
N20  C                   EVAL      FT2(XFT2NR) = F78(XN01)
S29  C*                  IF        XFT2NR = 4
N29  C                   IF        XFT2NR = 5
N20  C                   GOTO      ENDRESOMB
N20  C                   END
N20  C                   END
N20  C                   ENDDO
N20  C     MMN           READE     TVINF                                  34
N20  C                   ENDDO
N20  C     ENDRESOMB     TAG
N20  C                   IF        M1001 = '929'
N20  C                   UPDATE    SADHROM
N20  C                   ELSE
N20  C                   UPDATE    SAEHROM
N20  C                   END
N20  C                   END
     C                   END
     C  N33              DO                                                     1<-B
     C     TDEKEY        CHAIN(N)  HEADF                              33
     C   33              MOVE      *ZEROS        HEPRO
     C                   MOVE      SISG          XSG               3
     C                   MOVE      SIST          YSIST             1
     C     M1001         IFEQ      '929'                                         2<-B
     C                   MOVE      S0004         Y0004            35
     C                   MOVE      S0010         Y0010            35
     C                   MOVE      S0026         Y0026            14
     C                   MOVE      SIMI          YSIMI             1
     C                   MOVE      SIWS          YSIWS            10
N02  C                   MOVE      SINTK         YSINTK            7 0
N02  C                   MOVE      SIGN          YSIGN            15
N02  C                   MOVE      SIPOS         YSIPOS            9
     C     MAVD          CHAIN     STANDI                             33
N28  C                   IF        MTDN < 0
N28  C                   EVAL      SIST = 'N'
N28  C                   END
     C                   MOVE      Y0004         S0004
     C                   MOVE      Y0010         S0010
     C                   MOVE      Y0026         S0026
     C                   MOVE      YSIMI         SIMI
     C                   MOVE      YSIWS         SIWS
N02  C                   MOVE      YSINTK        SINTK
N02  C                   MOVE      YSIGN         SIGN
N02  C                   MOVE      YSIPOS        SIPOS
N39   *
N39  C                   IF        SIST = 'J' AND Y0035 <> '9'
N39  C     KODTSIK       CHAIN     KODTSI                             33
N39  C  N33              IF        KSIXXX <> *BLANKS AND KSISTA = 'J'
N39  C                   EVAL      SIST = ' '
N39  C                   END
N39  C                   END
N39   *
     C     SIST          IFEQ      'J'                                            3<-B
     C     Y0035         ANDNE     '9'
N41  C     Y0035         ANDNE     '7'
N22  C                   MOVE      YSIST         SEST
      * Melding skal vente å skrive ut
     C     SEST          IFNE      'K'                                             4<-B
     C     SEST          ANDNE     'P'
     C     SEST          ANDNE     'L'
     C     SEST          ANDNE     '2'
     C     SEST          ANDNE     '3'
N41  C                   IF        Y0035 = '5' OR                               DOK.KONTROLL
N41  C                             Y0035 = '6'                                  VAREKONTROLL
N41  C                   IF        W0068C = 1                                    2<-B
N41   * Hent bevarte opprinnelig SADH
N41  C                   MOVE      '3'           UMOD
N41  C                   ELSE                                                    2
N41   * Slett evt. oppbevarte opprinnelig fortolling pga. ny versjon uten be om
N41  C                   MOVE      '2'           UMOD              1
N41  C                   END                                                     2<-E
N41  C                   CALL      'SAD061X'
N41  C                   PARM                    SIAVD
N41  C                   PARM                    SITDN
N41  C                   PARM                    UMOD
N41  C                   END
     C                   MOVE      '1'           SIST
     C                   MOVE      *BLANKS       SIWS
     C                   MOVE      MAVD          TRAVD
     C                   MOVE      MTDN          TRTDN
     C                   MOVE      XSG           TRSG
     C                   MOVE      SIST          TRMTY
     C                   MOVE      HEPRO         TRPRO
     C                   MOVE      M0068A        TR068A
     C                   MOVE      M0068B        TR068B
     C                   MOVE      M0068C        TR068C
     C                   MOVE      M0068D        TR068D
     C                   MOVE      M0068E        TR068E
     C                   MOVE      M0068F        TR068F
     C                   MOVE      MMN           TRMN
     C                   WRITE     TVINRMDR
     C                   END                                                       4<-E
     C                   ELSE                                                     3
     C                   MOVE      YSIST         SEST
     C     SEST          IFEQ      'C'                                             4<-B
     C     Y0035         ORNE      '9'
     C     SEST          IFNE      'K'                                              5<-B
     C     SEST          ANDNE     'P'
     C     SEST          ANDNE     'L'
N41  C                   IF        (SEST = 'D' OR SEST = 'V') AND Y0035 = '7'
N41  C                   EVAL      SEKDV = SEST
N41  C                   ELSE
N41  C                   EVAL      SEKDV = ' '
N41  C                   END
     C                   MOVE      'Å'           SEST
     C                   MOVE      WS            SEWS
     C                   END
     C                   ELSE
     C                   MOVE      SE0035        Y0035
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C                   MOVE      YSIST         SEST
     C     SEST          IFEQ      'C'                                            3<-B
     C     Y0035         ORNE      '9'
     C     SEST          IFNE      'K'                                              5<-B
     C     SEST          ANDNE     'P'
     C     SEST          ANDNE     'L'
N41  C                   IF        (SEST = 'D' OR SEST = 'V') AND Y0035 = '7'
N41  C                   EVAL      SEKDV = SEST
N41  C                   ELSE
N41  C                   EVAL      SEKDV = ' '
N41  C                   END
     C                   MOVE      'Å'           SEST
     C                   MOVE      WS            SEWS
     C                   END
     C                   ELSE
     C                   MOVE      SE0035        Y0035
     C                   END                                                      3<-E
     C                   END                                                     2<-E
      *
     C     Y0035         IFEQ      '9'
     C     FILE31        ANDEQ     'N'
     C                   MOVE      ' '           Y0035
     C     SEST          IFEQ      'Å'
N41  C                   IF        W0068C = 1                                    2<-B
N41   * Hent bevarte opprinnelig SADH
N41  C                   MOVE      '3'           UMOD
N41  C                   ELSE                                                    2
N41   * Slett evt. oppbevarte opprinnelig fortolling pga. ny versjon uten be om
N41  C                   MOVE      '2'           UMOD              1
N41  C                   END                                                     2<-E
N41  C                   SELECT
N41  C                   WHEN      M1001 = '929'
N41  C                   CALL      'SAD061X'
N41  C                   PARM                    SIAVD
N41  C                   PARM                    SITDN
N41  C                   PARM                    UMOD
N41  C                   WHEN      M1001 = '830'
N41  C                   CALL      'SAD052X'
N41  C                   PARM                    SEAVD
N41  C                   PARM                    SETDN
N41  C                   PARM                    UMOD
N41  C                   ENDSL
N41  C                   EVAL      SEKDV = ' '
     C                   MOVE      'T'           SEST
     C                   MOVE      *BLANKS       SEWS
     C                   END
     C                   END
N20   *
N20  C                   IF        MTDN < 0 AND SEST = 'Å' AND M1N07 = 'DIU'
N20  C                   MOVE      'Z'           SEST
N20  C                   MOVE      *BLANKS       SEWS
N20  C                   END
      *
N41  C                   IF        Y0035 = '7' AND SITLL <> *BLANKS
N41  C                   EVAL      Y0035 = *BLANKS
N41  C                   END
     C                   MOVE      Y0035         SE0035
     C     M1001         IFEQ      '929'                                         2<-B
N02  C                   EVAL      XP101  = 'Import'
s04  C*                  MOVE      '*CE'         FSKOD3
n04  C                   MOVE      '*CR'         FSKOD3
     C                   EXCEPT    SADHME
     C                   END                                                     2<-E
     C     M1001         IFEQ      '830'                                         2<-B
     C                   EXCEPT    SAEHME
N02  C                   EVAL      XP101  = 'Export'
N02  C                   MOVE      '*CE'         FSKOD3
     C                   END                                                     2<-E
N02   *
N02  C     FRIKE3        CHAIN(N)  FRISOK                             33
N02  C                   IF        *IN33 AND *IN33 = *OFF
N02  C                   MOVE      MAVD          XP1021
N02  C                   MOVE      MTDN          XP1022
N02  C                   EVAL      XP1023 = SISG
N02  C                   EVAL      XP103  = SIGN
N02  C                   EVAL      XP104  = SIPOS
N02  C                   MOVE      SINTK         XP118
N02  C                   IF        XP116 = *BLANKS
N02  C                   EVAL      XP116 = SINAS
N02  C                   END
N02  C                   EVAL      XP119  = 'Error'
N02  C                   MOVE      MMN           XP120
N14  C                   MOVE      M0068A        XP121
N14  C                   MOVE      M0068B        XP122
N14  C                   MOVE      M0068C        XP123
N02  C                   CALL      'SYXML08'
N02  C                   PARM      XPARM1        UPARM1         1024
N02  C                   PARM      XPARM2        UPARM2         1024
N02  C                   END
N02   *
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *********************************************************************
     C     SRRES2        BEGSR
      *********************************************************************
     C*
     C*__________________________________________________________
     C* Oppdatere feil-melding på TVINF                    SRRES2
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C                   MOVE      *BLANKS       F78
     C* Adder linjenr (FTX-seg.-nr) med 1
     C                   ADD       1             FLN
      *
     C     TEGN          IFEQ      LOGPLU
     C                   MOVE      *ZEROS        X0077             3 0
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDRE2
     C     TEGN          IFGE      '0'
     C     TEGN          ANDLE     '9'
     C                   MULT      10            X0077
     C                   MOVE      TEGN          X0077
     C                   END
     C                   END
     C                   MOVE      X0077         F0077
N02   *
N02  C     SEGNAM        IFEQ      'ERC'
N02YBC     XERCNR        ANDLT     50
N02  C                   ADD       1             XERCNR            3 0
N02YBC*                  IF        XERCNR < 11
N02  C                   MOVEL     F0077         XP203T(XERCNR)
N02YBC*                  END
N02  C                   END
N02   *
N41  C                   IF        F0077 = '739'
N41  C                   EVAL      Y0035 = '7'
N41  C                   END
N41   *
     C     F0077         CHAIN     TVINE                              33
     C   33              MOVEL     X4440         F0078A
     C  N33              MOVEL     E4440         F0078A
     C                   MOVE      'JA'          F4815
     C                   WRITE     TVINFF
     C     F0077         IFEQ      '958'
     C     F0077         OREQ      '974'
     C                   MOVE      'DPU'         M1N07
     C                   END
     C                   END
      *
     C     ENDRE2        ENDSR
      *****************************************************************
     C     SRRES3        BEGSR
      *****************************************************************
     C*
     C*__________________________________________________________
     C* Oppdatere feil-melding på TVINF                    SRRES3
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C                   MOVE      *BLANKS       F0077
     C                   MOVE      *BLANKS       F78
     C* Adder linjenr (FTX-seg.-nr) med 1
     C                   ADD       1             FLN
N16   *
N16   * Hent dataelement som inneholder CIP.
N16  C                   MOVE      *BLANKS       FE
N16  C     1             DO        4             NR
N16  C                   EXSR      GETCH
N16  C   LR              GOTO      ENDRE3
N16  C     TEGN          CABEQ     LOGKOL        STR30
N16  C     TEGN          CABEQ     LOGPLU        STR30
N16  C                   MOVEL     TEGN          FE(NR)
N16  C                   END
N16  C     STR30         TAG
N16  C                   MOVEL     FELT          XCIP              3
      *
S16   * Lese 3 pluss-tegn før fritekster
S16  C*    1             DO        3
N16   * Lese 3 pluss-tegn før fritekster
N16  C     1             DO        2
     C                   EXSR      GETCH
     C   LR              GOTO      ENDRE3
     C     TEGN          DOWNE     LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDRE3
     C                   END
     C                   END
     C* Hent meldingstekster legg i felt F0078A/B/C
     C     1             DO        5             NR
     C                   MOVE      *BLANKS       FE
     C     1             DO        71            NR2               2 0
     C                   EXSR      GETCH
     C   LR              GOTO      ENDRE3
     C     TEGN          IFEQ      LOGKOL
     C     TEGN          OREQ      LOGAPP
     C                   GOTO      STR31
     C                   END
     C                   MOVEL     TEGN          FE(NR2)
     C                   END
     C     STR31         TAG
     C                   MOVEL     FELT          F78(NR)
N16  C                   IF        XCIP <> 'CIP'
     C                   MOVEL     FELT          X9705             3
     C     X9705         IFEQ      '958'
N40  C     X9705         ORGE      '980'
N40  C     X9705         ANDLE     '982'
     C                   MOVE      'DPU'         M1N07
     C                   END
     C     X9705         IFEQ      '972'
N44  c                   call      'TVI21MAN'
N44  c                   parm                    FIFIRM
N44  c                   parm                    MAVD
N44  c                   parm                    MTDN
     C                   MOVE      '9'           Y0035
N13  C     XERCNR        IFLT      50
N09  C                   ADD       1             XERCNR            3 0
N09  C                   EVAL      XP203T(XERCNR) = X9705
N13  C                   END
     C                   END
     C     X9705         IFEQ      '954'                                        954 DOK.KONTROLL
     C     Y0035         ANDEQ     ' '
N11  C     X9705         OREQ      '954'                                        954 DOK.KONTROLL
N11  C     Y0035         ANDEQ     '6'
N19  C     X9705         OREQ      '955'                                        955 VAREKONTROLL
N19  C     Y0035         ANDEQ     ' '
N19  C     X9705         OREQ      '955'                                        955 VAREKONTROLL
S26  C*    Y0035         ANDEQ     '6'
N26  C     Y0035         ANDEQ     '5'
N40  C     X9705         ORGE      '980'                                        980-982 PURRING DOK.
S43  C*    X9705         ANDLE     '982'
N43  C     X9705         ANDLE     '981'
N40  C     Y0035         ANDEQ     ' '
N40  C     X9705         ORGE      '980'                                        980-982 PURRING DOK.
N40  C     X9705         ANDLE     '982'
N40  C     Y0035         ANDEQ     '6'
N47  C                   IF        Y0035 <> '5'
     C                   MOVE      '6'           Y0035
N47  C                   END
N13  C     XERCNR        IFLT      50
N09  C                   ADD       1             XERCNR            3 0
N09  C                   EVAL      XP203T(XERCNR) = X9705
N13  C                   END
     C                   END
N13S C*    X9705         IFEQ      '999'                                        MELDING FØLGER ANDRE
N13S C*    XERCNR        ANDLT     50
N13S C*                  ADD       1             XERCNR            3 0
N13S C*                  EVAL      XP203T(XERCNR) = X9705
N13S C*                  END
N07  C     X9705         IFEQ      '974'                                        SEND ENDELIG VERSJON
N07  C     X9705         OREQ      '958'                                        PURR ENDELIG VERSJON
N11  C     X9705         OREQ      '950'                                        IKKE UTLEV, NY VERSJ
N07  C                   EVAL      XUTMSG = 'J'
N13  C     XERCNR        IFLT      50
N09  C                   ADD       1             XERCNR            3 0
N09  C                   EVAL      XP203T(XERCNR) = X9705
N13  C                   END
N07  C                   END
N16  C                   END
     C     TEGN          IFEQ      LOGAPP
     C                   GOTO      STR32
     C                   END
     C                   END
     C     STR32         TAG
N16   * OPPDATER MIDLERTID DEKLARASJONS INFORMASJON
N16  C                   IF        XCIP = 'CIP'
N16  C     TDEKEY        CHAIN     SADHMD                             33
N16  C                   EVAL      SIFRDT = XSIFRDT
N16  C     1             DO        5             NR
N16  C                   EVAL      FRT(NR) = F78(NR)
N16  C                   ENDDO
N16  C                   IF        *IN33
N16  C                   EVAL      SIAVD = MAVD
N16  C                   EVAL      SITDN = MTDN
N16  C                   WRITE     SADHMDR
N16  C                   ELSE
N16  C                   UPDATE    SADHMDR
N16  C                   END
N16  C                   ELSE
     C     Y0035         IFEQ      '9'
     C     FILE31        ANDEQ     'N'
     C                   MOVE      'NE'          F4815
     C                   ELSE
     C                   MOVE      'JA'          F4815
     C                   END
     C                   WRITE     TVINFF
N16  C                   END
      *
     C     ENDRE3        ENDSR
      *********************************************************************
     C     SRRES4        BEGSR
      *********************************************************************
     C*
     C*__________________________________________________________
     C* Oppdatere feil-melding på TVINF                    SRRES4
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C                   MOVE      *BLANKS       F78
     C* Adder linjenr (FTX-seg.-nr) med 1
     C                   ADD       1             FLN
      *
S02  C*    TEGN          DOWNE     LOGAPP
S02  C*    TEGN          ANDNE     LOGKOL
S02  C*                  EXSR      GETCH
S02  C*  LR              GOTO      ENDRE4
S02  C*                  END
N02  C                   MOVE      *BLANKS       FELT
N02  C     1             DO        71            NR2               2 0
N02  C                   EXSR      GETCH
N02  C   LR              GOTO      ENDRE4
N02  C     TEGN          IFEQ      LOGAPP
N02  C     TEGN          OREQ      LOGKOL
N02  C                   LEAVE
N02  C                   END
N02  C                   MOVEL     TEGN          FE(NR2)
N02  C                   END
N02YBC                   IF        XERPNR < 10
N02  C                   EVAL      XERCNR = XERPNR * 5
N02  C                   ADD       1             XERPNR
N02YBC*                  IF        XERPNR < 11
N02  C                   EVAL      XP201T(XERPNR) = FELT
N02YBC*                  END
N02  C                   END
N02   *
     C     TEGN          IFEQ      LOGKOL
     C     1             DO        71            NR2               2 0
     C                   EXSR      GETCH
     C   LR              GOTO      ENDRE4
     C     TEGN          IFEQ      LOGAPP
     C                   GOTO      STR4
     C                   END
     C                   MOVEL     TEGN          FE(NR2)
     C                   END
     C     STR4          TAG
     C                   MOVE      *BLANKS       F0077
     C                   MOVEL     FELT          F0078A
N02YBC                   IF        XERPNR < 11
N02  C                   EVAL      XP202T(XERPNR) = FELT
N02YBC                   END
     C     Y0035         IFEQ      '9'
     C     FILE31        ANDEQ     'N'
     C                   MOVE      'NE'          F4815
     C                   ELSE
     C                   MOVE      'JA'          F4815
     C                   END
     C                   WRITE     TVINFF
N33   * OPPDATER STATUS PÅ LINJE
N33  C     'VARELINJE'   SCAN      FELT          XPOS              3 0    33
N33  C                   IF        *IN33
N33  C                   EVAL      SVLN  = %DEC(%SUBST(FELT:XPOS+10:5):5:0)
N33  C                   IF        M1001 = '929'
N33  C     SADVK         SETLL     SADV4
N33  C     SADVK         READE     SADV4                                  33
N33  C                   DOW       *IN33 = *OFF
N33  C                   IF        SVREFL <= 0
N34  C                   IF        SVPREÆ = 'S'
N38  C                             OR SVPREÆ = 'D'
S46  C*                            OR SVPREÆ = ' '
N46  C                             OR SVPREÆ = ' ' AND SVTDN < 0
S38  C*                  EVAL      SVERR = 'M'
N38  C                   EVAL      SVERR = ' '
N34  C                   ELSE
N33  C                   EVAL      SVERR = 'M'
N34  C                   END
N33  C                   ELSE
N33  C                   EVAL      SVERR = ' '
N33  C                   END
N33  C                   UPDATE    SADVR
N33  C     SADVK         READE     SADV4                                  33
N33  C                   ENDDO
N33  C                   ELSE
N33  C     SAEVK         SETLL     SAEV4
N33  C     SAEVK         READE     SAEV4                                  33
N33  C                   DOW       *IN33 = *OFF
N33  C                   IF        SVREFL <= 0
N34  C                   IF        SVPREÆ = 'S'
N38  C                             OR SVPREÆ = 'D'
S46  C*                            OR SVPREÆ = ' '
N46  C                             OR SVPREÆ = ' ' AND SVTDN < 0
S38  C*                  EVAL      SVERR = 'M'
N38  C                   EVAL      SVERR = ' '
N34  C                   ELSE
N33  C                   EVAL      SVERR = 'M'
N34  C                   END
N33  C                   ELSE
N33  C                   EVAL      SVERR = ' '
N33  C                   END
N33  C                   UPDATE    SAEVR
N33  C     SAEVK         READE     SAEV4                                  33
N33  C                   ENDDO
N33  C                   END
N33  C                   END
N33   *
     C                   END
      *
     C     ENDRE4        ENDSR
      ****************************************************************
     C     SRDEC         BEGSR
      ****************************************************************
     C*
     C*__________________________________________________________
     C* SR for utleveringsattest/tollkvittering            SRDEC
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C                   MOVE      'N'           WARKIVJN          1
N06  C                   MOVE      *BLANKS       XFAKTNR          35
N06  C                   MOVE      *BLANKS       XBETALL          35
      * Har nå nødvendig info for å oppdatere meldingslogg
     C*                    WRITEEDIMR
      * Legg kryssreferanse til riktig meldingsnr
     C                   MOVE      MMN           FMN
     C                   MOVE      *ZEROS        FLN
     C                   MOVE      *BLANKS       XNA              30
     C                   MOVE      *BLANKS       XADR1            30
     C                   MOVE      *BLANKS       XADR2            30
     C                   MOVE      *BLANKS       XADR3            30
     C*
     C*  På de fleste segm antar vi at tollv. ikke har endret noe
     C*  Henter kun BGM (ekspedisjonsdato), RFF (ekspedisjon-/løpenr)
      *
      * Nå skal lese eksp.dato, godgj.nr, meldinger, osv.
     C     SRDEC1        TAG
     C     SEGNAM        DOWNE     'DTM'                                        1<-B
     C     SEGNAM        ANDNE     'RFF'
     C     SEGNAM        ANDNE     'FTX'
     C     SEGNAM        ANDNE     'UNT'
     C     SEGNAM        ANDNE     'NAD'
N02  C     SEGNAM        ANDNE     'TAX'
     C                   EXSR      GETSEG
     C   LR              GOTO      ENDDEC
     C                   END                                                    1<-E
     C     SEGNAM        IFEQ      'NAD'                                        1<-B
     C                   EXSR      SRHADR
     C                   MOVE      *BLANKS       SEGNAM
     C                   GOTO      SRDEC1
     C                   END                                                    1<-E
     C     SEGNAM        IFEQ      'DTM'                                        1<-B
     C                   GOTO      SRDEC2
     C                   END                                                    1<-E
N02  C     SEGNAM        IFEQ      'TAX'                                        1<-B
N02  C                   GOTO      SRDEC3
N02  C                   END                                                    1<-E
     C     SEGNAM        IFEQ      'FTX'                                        1<-B
     C                   EXSR      SRRES3
     C                   MOVE      *BLANKS       SEGNAM
     C                   GOTO      SRDEC1
     C                   END                                                    1<-E
     C     SEGNAM        IFEQ      'UNT'                                        1<-B
     C                   GOTO      ENDDEC
     C                   END                                                    1<-E
      * Teste om dataelement er 'ABT'. Hvis ikke, leser neste 'RFF'
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR                             1<-B
     C                   EXSR      GETCH
     C   LR              GOTO      ENDDEC
N06  C     TEGN          IFEQ      LOGPLU
N06  C     TEGN          OREQ      LOGAPP
N06  C     TEGN          OREQ      LOGKOL
N06  C                   LEAVE
N06  C                   END
     C                   MOVEL     TEGN          FE(NR)
     C                   END                                                    1<-E
S03  C*                  MOVEL     FELT          EKSSTE
N03  C                   MOVEL     FELT          WQUAL             3
S03  C*    EKSSTE        IFNE      'ABT'                                        1<-B
N03  C     WQUAL         IFNE      'ABT'                                        1<-B
N06  C     WQUAL         ANDNE     'IV'
N06  C     WQUAL         ANDNE     'PQ'
     C                   MOVE      *BLANKS       SEGNAM
     C                   GOTO      SRDEC1
     C                   END                                                    1<-E
      * Lese forbi kollon (:)
N06  C                   IF        TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDDEC
N06  C                   END
      * Les hele segmentet
     C                   MOVE      *BLANKS       FE
S06  C*    1             DO        16            NR                             1<-B
N06  C     1             DO        35            NR                             1<-B
     C                   EXSR      GETCH
     C   LR              GOTO      ENDDEC
     C     TEGN          CABEQ     LOGAPP        STENLN
N06  C     TEGN          CABEQ     LOGPLU        STENLN
N06  C     TEGN          CABEQ     LOGKOL        STENLN
     C                   MOVEL     TEGN          FE(NR)
     C                   END                                                    1<-E
     C     STENLN        TAG
N06  C                   SELECT                                                 1<-B
N06  C                   WHEN      WQUAL = 'ABT'                                1
      * Før 1.1.98:    ekspedisjonsnr = 3 lang og løpenr = 6 lang.
      * F.o.m. 1.1.98: ekspesisjonsnr = 6 lang og løpenr = 10 lang.
     C                   MOVE      *BLANKS       HETOGM            8
     C     NR            IFGT      16                                            2<-B
     C                   MOVE      *BLANKS       EKSSTE
     C                   MOVE      *BLANKS       LØPENR                                     6 ganger
     C                   MOVEL     XTLENY        EKSSTE
     C                   MOVEL     XTLLNY        LØPENR                                     6 ganger
     C                   ELSE                                                    2
     C                   MOVEL     XTLEGM        EKSSTE
     C                   MOVEL     XTLLGM        LØPENR                                     6 ganger
     C                   MOVE      *BLANKS       HETOGM
     C                   MOVEL     XTLEGM        HETOGM
     C                   MOVEL     XTLLGM        HETOGM                                     6 ganger
     C                   END                                                     2<-E
N02  C                   MOVEL     FELT          XP113
N02  C                   MOVEL     'ABT'         XP114
N06  C                   WHEN      WQUAL = 'IV'                                 1
N06  C                   EVAL      XFAKTNR = FELT
N06  C                   WHEN      WQUAL = 'PQ'                                 1
N06  C                   EVAL      XBETALL = FELT
N06  C                   ENDSL                                                  1<-E
     C                   MOVE      *BLANKS       SEGNAM
     C                   GOTO      SRDEC1
      *
     C     SRDEC2        TAG
      *
      * Teste om dataelement er 58/184. Hvis ikke, leser neste 'DTM'
     C                   MOVE      *BLANKS       FE
     C     1             DO        4             NR                             1<-B
     C                   EXSR      GETCH
     C   LR              GOTO      ENDDEC
     C     TEGN          CABEQ     LOGKOL        SRDC21
     C                   MOVEL     TEGN          FE(NR)
     C                   END                                                    1<-E
     C     SRDC21        TAG
     C                   MOVEL     FELT          XAN3              3
     C     XAN3          IFNE      '58 '                                        1<-B
     C     XAN3          ANDNE     '184'
N16  C     XAN3          ANDNE     '255'
     C                   MOVE      *BLANKS       SEGNAM
     C                   GOTO      SRDEC1
     C                   END                                                    1<-E
      *
     C                   MOVE      *BLANKS       FE
     C     1             DO        14            NR                             1<-B        6 ganger
     C                   EXSR      GETCH
     C   LR              GOTO      ENDDEC
     C     TEGN          CABEQ     LOGKOL        SRDC22
     C     TEGN          CABEQ     LOGPLU        SRDC22
     C     TEGN          CABEQ     LOGAPP        SRDC22
     C                   MOVEL     TEGN          FE(NR)
     C                   END                                                    1<-E
     C     SRDC22        TAG
     C                   MOVEL     FELT          XAN14            14
     C     XAN3          IFEQ      '184'                                        1<-B
     C                   MOVEL     XAN14         M2005B
     C                   MOVE      XAN14         M3039D
     C                   MOVEL     '00'          M3039D
N02  C                   MOVEL     XAN14         XP106
     C                   ELSE                                                   1
N16  C     XAN3          IFEQ      '255'                                        1<-B
N16  C                   MOVEL     XAN14         XSIFRDT
N16  C                   ELSE                                                   1
     C                   MOVEL     XAN14         DTEKSP           10
N02  C                   MOVEL     XAN14         XP107
N16  C                   END                                                    1<-E
     C                   END                                                    1<-E
     C                   MOVE      *BLANKS       SEGNAM
     C                   GOTO      SRDEC1
N02   *
N02  C     SRDEC3        TAG
N02   *
N02   * HENT KODE OG BELØP
N02  C                   MOVE      *BLANKS       FE
N02  C     1             DO        4             NR                             1<-B
N02  C                   EXSR      GETCH
N02  C   LR              GOTO      ENDDEC
N02  C     TEGN          CABEQ     LOGPLU        SRDC31
N02  C                   MOVEL     TEGN          FE(NR)
N02  C                   END                                                    1<-E
N02  C     SRDC31        TAG
N02  C     FELT          CABNE     '4'           SRDC34
N02  C                   MOVEL     FELT          XP110
N02   *
N02  C                   MOVE      *BLANKS       FE
N02  C     1             DO        4             NR                             1<-B
N02  C                   EXSR      GETCH
N02  C   LR              GOTO      ENDDEC
N02  C     TEGN          CABEQ     LOGKOL        SRDC32
N02  C     TEGN          CABEQ     LOGPLU        SRDC32
N02  C     TEGN          CABEQ     LOGAPP        SRDC32
N02  C                   MOVEL     TEGN          FE(NR)
N02  C                   END                                                    1<-E
N02  C     SRDC32        TAG
N02  C                   MOVEL     FELT          XP111
N02   *
N02  C                   MOVE      *BLANKS       FE
N02  C     1             DO        20            NR                             1<-B
N02  C                   EXSR      GETCH
N02  C   LR              GOTO      ENDDEC
N02  C     TEGN          CABEQ     LOGAPP        SRDC33
N02  C                   MOVEL     TEGN          FE(NR)
N02  C                   END                                                    1<-E
N02  C     SRDC33        TAG
N02  C                   MOVEL     FELT          XP112
N02   *
N02  C     SRDC34        TAG
N02  C                   MOVE      *BLANKS       SEGNAM
N02  C                   GOTO      SRDEC1
     C*
     C* Har nå UNT-segmentet inne
     C*
     C*
     C     ENDDEC        TAG
      * Har nå nødvendig info for å oppdatere meldingslogg
     C                   WRITE     EDIMR
     C* Merk SADH/SAEH-record for utskrift av U-attest/tollkvittering
     C     M1001         IFEQ      '929'                                        1<-B
N41  C                   IF        W0068C = 1                                    2<-B
N41   * Hent bevarte opprinnelig SADH
N41  C                   MOVE      '3'           X_MOD             1
N41  C                   ELSE                                                    2
N41   * Slett bevarte opprinnelig SADH
N41  C                   MOVE      '2'           X_MOD             1
N41  C                   END                                                     2<-E
N41  C                   CALL      'SAD061X'
N41  C                   PARM                    MAVD
N41  C                   PARM                    MTDN
N41  C                   PARM                    X_MOD
N41   *
     C     TDEKEY        CHAIN     SADH                               33
     C                   MOVE      'si'          ARTYPE
     C                   MOVE      SIKNK         ARKUND
     C                   MOVE      *BLANKS       SIMID
     C                   MOVE      *BLANKS       SIMIDK
     C                   END                                                    1<-E
     C     M1001         IFEQ      '830'                                        1<-B
N41  C                   IF        W0068C = 1                                    2<-B
N41   * Hent bevarte opprinnelig SADH
N41  C                   MOVE      '3'           X_MOD             1
N41  C                   ELSE                                                    2
N41   * Slett bevarte opprinnelig SADH
N41  C                   MOVE      '2'           X_MOD             1
N41  C                   END                                                     2<-E
N41  C                   CALL      'SAD052X'
N41  C                   PARM                    MAVD
N41  C                   PARM                    MTDN
N41  C                   PARM                    X_MOD
     C     TDEKEY        CHAIN     SAEH                               33
     C                   MOVE      'se'          ARTYPE
     C                   MOVE      SEKNK         ARKUND
     C                   END                                                    1<-E
     C     M1N07         IFEQ      'DTK'                                        1<-B
     C                   MOVE      *BLANKS       SIMI
     C                   MOVE      'DTK'         SEMF
     C                   END                                                    1<-E
     C  N33              DO                                                     1<-B
N06   *
N06  C                   IF        XFAKTNR <> *BLANKS
N06  C                   CLEAR                   FRISOKR
N06  C     FRISOKKIV     CHAIN     FRISOK                             77
N06  C                   EVAL      FSSOK = XFAKTNR
N06  C                   IF        *IN77
N06  C                   MOVE      MAVD          FSAVD
N06  C                   MOVE      MTDN          FSOPD
N06  C                   MOVE      WDATO         FSDTOP
N06  C                   EVAL      FSKODE = 'TLI'
N06  C                   WRITE     FRISOKR
N06  C                   ELSE
N06  C                   UPDATE    FRISOKR
N06  C                   END
N06  C                   END
N06  C                   IF        XBETALL <> *BLANKS
N06  C                   CLEAR                   FRISOKR
N06  C     FRISOKKPQ     CHAIN     FRISOK                             77
N06  C                   EVAL      FSSOK = XBETALL
N06  C                   IF        *IN77
N06  C                   MOVE      MAVD          FSAVD
N06  C                   MOVE      MTDN          FSOPD
N06  C                   MOVE      WDATO         FSDTOP
N06  C                   EVAL      FSKODE = 'TLP'
N06  C                   WRITE     FRISOKR
N06  C                   ELSE
N06  C                   UPDATE    FRISOKR
N06  C                   END
N06  C                   END
      *
      * oppdaterer toll og moms på heading
      *
     C     TDEKEY        CHAIN     HEADF                              33
     C   33              MOVE      *ZEROS        HEPRO
     C  N33              DO                                                      2<-B
     C                   MOVE      LØPENR        HETLL
     C                   MOVE      EKSSTE        HETLE
N18  C                   IF        M1001 = '929'
N18  C                   EVAL      HEPK4 = 'P'
N18  C                   ELSE
N18  C                   EVAL      HEPK6 = 'P'
N18  C                   END
     C                   UPDATE    HEADFR
N45  C     *IN33         IFEQ      *OFF
N45  C     M1001         IFEQ      '929'
N45  C     M1001         OREQ      '830'
N45  C     TRSTA4        ANDEQ     ' '
N45  C     FRIKEN45      CHAIN     FRISOK
N45  C                   IF        %FOUND(FRISOK)
N45  C                   EXSR      N45SR1
N45  C                   ENDIF
N45  C                   ENDIF
N45  C                   ENDIF
      *
      *
      * SKRIV TIL ARKIV
      *
      * EKSPEDISJONSSTED
     C     FSKOD2        CHAIN     KODFRI                             77
     C     FRIKE2        CHAIN     FRISOK                             77
     C                   MOVE      *BLANKS       FSSOK
     C                   MOVEL     EKSSTE        FSSOK
     C                   MOVEL     KFSODK        FSDOKK
     C  N77              UPDATE    FRISOKR
     C   77              MOVE      HEAVD         FSAVD
     C   77              MOVE      HEOPD         FSOPD
     C   77              MOVE      FSKOD2        FSKODE
     C   77              MOVE      HEDTOP        FSDTOP
     C   77              WRITE     FRISOKR
      * LØPENUMMER
     C                   MOVE      'TLØ'         FSKODE
     C     FSKODE        CHAIN     KODFRI                             77
     C     FRIKEY        CHAIN     FRISOK                             77
     C                   MOVE      *BLANKS       FSSOK
     C                   MOVEL     LØPENR        FSSOK
     C                   MOVEL     KFSODK        FSDOKK
     C  N77              UPDATE    FRISOKR
     C   77              MOVE      HEAVD         FSAVD
     C   77              MOVE      HEOPD         FSOPD
     C   77              MOVE      HEDTOP        FSDTOP
     C   77              WRITE     FRISOKR
S36  C*    FIURBL        IFEQ      'J'                                            3<-B
S36  C*    M1001         IFEQ      '929'                                           4<-B
S36  C*                  MOVE      'ITK'         TTACTI
S36  C*                  ELSE                                                      4
S36  C*                  MOVE      'ETK'         TTACTI
S36  C*                  END                                                       4<-E
S36  C*                  EXSR      TTSR
S36  C*                  END                                                      3<-E
     C                   END                                                     2<-E
      *
      * arkivering flyttet hit etter HEADF oppdatering
      *
      *
      * SKRIV TIL ARKIV
      *
      * SKAL DOKUMENT ARKIVERES
      *
     C                   MOVE      'N'           MAILKU            1
     C     FIFIRM        CHAIN     FIRMARC                            34
     C  N34ARTYPE        CHAIN     ARKTXT                             34
     C     *IN(34)       IFEQ      '0'
     C     arkjn         andeq     'J'
      *
      * SKJEKKER OM DET ER MAILKUNDE SOM ER MOTTAKER
      *
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c     epokey        CHAIN     cundc03                            34
n17  c  n34              exsr      testep
     C  N34              MOVE      'J'           MAILKU            1
      *
      *
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      FIFIRM        ARFIRM
     C                   MOVE      MAVD          ARAVD
     C                   MOVE      MTDN          AROPD
N31  C                   MOVE      *BLANKS       ARUNDE
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     C                   MOVE      ZUSER         ARUSER
     C                   EVAL      WARKIVJN = 'J'
     C                   END
      *
      *
      *
      * Skjekk om dette er forenklet prosedyre
      *
     C     TDEKEF        CHAIN     FPXREF1                            34
     C     *IN(34)       IFEQ      '0'
     C                   MOVE      LØPENR        utll             10 0
     C                   MOVE      EKSSTE        utle              6 0
     C                   MOVEL     DTEKSP        utdt              8 0
     C                   CALL      'TVI21RFP'
     c                   parm                    mavd
     c                   parm                    mtdn
     c                   parm                    utle
     c                   parm                    utll
     c                   parm                    utdt
     C                   end
      *
     C     M1001         IFEQ      '929'                                         2<-B
     C                   MOVE      SISG          XSG
     C                   MOVE      S0004         Y0004            35
     C                   MOVE      S0010         Y0010            35
     C                   MOVE      S0026         Y0026            14
     C                   MOVE      SIMI          YSIMI             1
     C                   MOVE      SINAK         YNAK             30
     C                   MOVE      SIADK1        YADK1            30
     C                   MOVE      SIADK2        YADK2            30
     C                   MOVE      SIADK3        YADK3            30
     C                   MOVE      SIMF          YMF               3
      *
E37  C                   MOVE      SIBEL6        YBEL6            11 0
     C                   MOVE      SIBEL7        YBEL7            11 0
E37  C                   MOVE      SIBELT        YBELT            11 0
     C                   MOVE      SISKI         YSKI              1
N02  C                   MOVE      SINTK         YSINTK            7 0
      *
     C     MAVD          CHAIN     STANDI                             33
     C                   IF        MAILKU = 'J'
N28  C                             OR MTDN < 0
     C                   EVAL      SIST = 'N'
     C                   END
      *
     C                   MOVE      YBEL6         SIBEL6
     C                   MOVE      YBEL7         SIBEL7
     C                   MOVE      YBELT         SIBELT
     C                   MOVE      YSKI          SISKI
N02  C                   MOVE      YSINTK        SINTK
      *
     C                   MOVE      Y0004         S0004
     C                   MOVE      Y0010         S0010
     C                   MOVE      Y0026         S0026
     C                   MOVE      YSIMI         SIMI
     C                   MOVE      YNAK          SINAK
     C                   MOVE      YADK1         SIADK1
     C                   MOVE      YADK2         SIADK2
     C                   MOVE      YADK3         SIADK3
     C                   MOVE      YMF           SIMF
     C     SIST          IFEQ      'J'                                            3<-B
     C     M1N07         IFEQ      'DUA'                                           4<-B
     C                   MOVE      '2'           SIST
     C                   ELSE                                                      4
     C                   MOVE      '3'           SIST
     C                   END                                                       4<-E
     C                   MOVE      *BLANKS       SIWS
     C                   MOVE      MAVD          TRAVD
     C                   MOVE      MTDN          TRTDN
     C                   MOVE      XSG           TRSG
     C                   MOVE      SIST          TRMTY
     C                   MOVE      HEPRO         TRPRO
     C                   MOVE      M0068A        TR068A
     C                   MOVE      M0068B        TR068B
     C                   MOVE      M0068C        TR068C
     C                   MOVE      M0068D        TR068D
     C                   MOVE      M0068E        TR068E
     C                   MOVE      M0068F        TR068F
     C                   MOVE      MMN           TRMN
     C                   WRITE     TVINRMDR
N24  C                   IF        M1N07 = 'DUA' AND SIMI <> 'I'                   4<-B
N24  C                   MOVE      'DUA'         SEMF
N24  C                   END                                                       4<-E
     C                   GOTO      ENDDE2
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C                   MOVE      SENAK         YNAK             30
     C                   MOVE      SEADK1        YADK1            30
     C                   MOVE      SEADK2        YADK2            30
     C                   MOVE      SEADK3        YADK3            30
     C                   MOVE      SEMF          YMF               3
     C                   MOVE      S0004         Y0004            35
     C                   MOVE      S0010         Y0010            35
     C                   MOVE      S0026         Y0026            14
N02  C                   MOVE      SINTK         YSINTK            7 0
N02  C                   MOVE      SEGN          YSEGN            15
N02  C                   MOVEL     SEPOS         YSEPOS            8
     C     MAVD          CHAIN     STANDE                             33
     C                   MOVE      YNAK          SENAK
     C                   MOVE      YADK1         SEADK1
     C                   MOVE      YADK2         SEADK2
     C                   MOVE      YADK3         SEADK3
     C                   MOVE      YMF           SEMF
     C                   MOVE      Y0004         S0004
     C                   MOVE      Y0010         S0010
     C                   MOVE      Y0026         S0026
N02  C                   MOVE      YSINTK        SINTK
N02  C                   MOVE      YSEGN         SEGN
N02  C                   MOVEL     YSEPOS        SEPOS
     C                   END                                                     2<-E
      *
     C                   MOVE      WS            SEWS
     C     M1N07         IFEQ      'DUA'                                         2<-B
     C     SIUATK        IFEQ      'J'                                            3<-B
N07  C     SIMI          ANDNE     'I'
     C                   MOVE      'DUA'         SEMF
     C     MAILKU        IFNE      'J'
     C     CPRINT        oreq      'J'
     C                   MOVE      'K'           SEST
     C                   ELSE
     C                   MOVE      'P'           SEST
     C                   END
N36  C     FIURBL        IFEQ      'J'                                             4<-B
N36  C     M1001         IFEQ      '929'                                            5<-B
N36  C                   MOVE      'ITK'         TTACTI
N36  C                   ELSE                                                       5
N36  C                   MOVE      'ETK'         TTACTI
N36  C                   END                                                        5<-E
N36  C                   EXSR      TTSR
N36  C                   END                                                       4<-E
     C                   ELSE                                                     3
     C                   MOVE      'L'           SEST
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     MAILKU        IFNE      'J'
     C     CPRINT        oreq      'J'
     C                   MOVE      'K'           SEST
     C                   ELSE
     C                   MOVE      'P'           SEST
     C                   END
N36  C     FIURBL        IFEQ      'J'                                            3<-B
N36  C     M1001         IFEQ      '929'                                           4<-B
N36  C                   MOVE      'ITK'         TTACTI
N36  C                   ELSE                                                      4
N36  C                   MOVE      'ETK'         TTACTI
N36  C                   END                                                       4<-E
N36  C                   EXSR      TTSR
N36  C                   END                                                      3<-E
     C                   END                                                     2<-E
      *
     C     ENDDE2        TAG
     C                   MOVE      LØPENR        SETLL
     C                   MOVE      EKSSTE        SETLE
     C                   MOVE      DTEKSP        SEDTG
     C                   MOVE      'J'           SEPKL
     C                   MOVE      Y0035         SE0035
     C     XNA           IFNE      *BLANKS                                       2<-B
     C                   MOVE      XNA           SINAK
     C                   MOVE      XADR1         SIADK1
     C                   MOVE      XADR2         SIADK2
     C                   MOVE      XADR3         SIADK3
     C                   END                                                     2<-E
      *
      * oppdaterer SADH med DTK DUA
      *
     C     M1001         IFEQ      '929'                                         2<-B
     C                   EXCEPT    SADHUT
N02  C                   EVAL      XP101  = 'Import'
s04  C*                  MOVE      '*CE'         FSKOD3
n04  C                   MOVE      '*CR'         FSKOD3
      *
     C     M1N07         IFEQ      'DUA'                                          3<-B
     C     TDEKEY        CHAIN     HEADF                              33
S35  C* N33SIBEL6        IFGT      50                                              4<-B
N35  C  N33SIBEL7        IFGT      50                                              4<-B
     C     SIBEL7        SUB       SIBEL6        HEBELT
     C                   Z-ADD     SIBEL6        HEBELM
     C                   ELSE                                                      4
     C                   MOVE      *ZEROS        HEBELM
S35  C*    SIBELT        IFGE      5                                                5<-B
S35  C*                  Z-ADD     SIBELT        HEBELT
S35  C*                  ELSE                                                       5
     C                   MOVE      *ZEROS        HEBELT
S35  C*                  END                                                        5<-E
     C                   END                                                       4<-E
     C  N33              MOVE      'P'           HEPK4
     C  N33              MOVE      SISKI         HEKDTM
     C  N33              UPDATE    HEADFR
N45  C     TRSTA4        IFEQ      ' '
N45  C     FRIKEN45      CHAIN     FRISOK
N45  C                   IF        %FOUND(FRISOK)
N45  C                   EXSR      N45SR1
N45  C                   ENDIF
N45  C                   ENDIF
     C     FIURBL        IFEQ      'J'                                             4<-B
     C     M1001         IFEQ      '929'                                            5<-B
     C                   MOVE      'IUA'         TTACTI
     C                   ELSE                                                       5
     C                   MOVE      'EUA'         TTACTI
     C                   END                                                        5<-E
     C                   EXSR      TTSR
     C                   END                                                       4<-E
      * UPDATE TAXES/PRICES TO INVOICE
     C     *IN33         IFEQ      '0'                                             4<-B
     C                   CALL      'SYFA50'
     C                   PARM                    MAVD
     C                   PARM                    MTDN
     C                   ENDIF                                                     4<-E
     C                   END                                                      3<-E
      *
     C                   END                                                     2<-E
     C     M1001         IFEQ      '830'                                         2<-B
     C                   EXCEPT    SAEHUT
N02  C                   EVAL      XP101  = 'Export'
N02  C                   MOVE      '*CE'         FSKOD3
     C                   END                                                     2<-E
N02   *
N02  C     FRIKE3        CHAIN(N)  FRISOK                             33
N02  C                   IF        *IN33 AND *IN33 = *OFF
N02  C                   MOVE      MAVD          XP1021
N02  C                   MOVE      MTDN          XP1022
N02  C                   EVAL      XP1023 = SISG
N02  C                   EVAL      XP103  = SIGN
N02  C                   EVAL      XP104  = SIPOS
N02  C                   MOVE      SINTK         XP118
N02  C                   IF        XP116 = *BLANKS
N02  C                   EVAL      XP116 = SINAK
N02  C                   END
N02  C                   EVAL      XP119  = 'Release'
N02  C                   MOVE      MMN           XP120
N14  C                   MOVE      M0068A        XP121
N14  C                   MOVE      M0068B        XP122
N14  C                   MOVE      M0068C        XP123
N02  C                   CALL      'SYXML08'
N02  C                   PARM      XPARM1        UPARM1         1024
N02  C                   PARM      XPARM2        UPARM2         1024
N02  C                   END
N02   *
     C                   END                                                    1<-E
      *
     C                   IF        WARKIVJN = 'J'
S    C*                  WRITE     ARKIVR
N15  C     keyark        KLIST
N15  c                   kfld                    artype
N15  c                   kfld                    aravd
N15  c                   kfld                    aropd
N31  C                   kfld                    ARUNDE
N15  C*
N15  C     keyark        chain     arkivl03                           35
N15  C     *in35         ifeq      '1'
N15  C                   WRITE     arkivr
N15  C                   ELSE
N15  C                   MOVE      ULDT          ARDATE
N15  C                   MOVE      XULTM         ARTIME
N15  C                   MOVE      ZUSER         ARUSER
N15  C                   MOVE      *BLANKS       ARSTAT
N15  C                   UPDATE    arkivr
N15  C                   exsr      delpdf
      *
      * sletter tillegg eksport
      *
N15  C     ARTYPE        IFEQ      'se'
n15  c                   move      'sf'          artype
N15  C     keyark        chain     arkivl03                           35
N15  C  N35              delete    arkivr
N15  C  N35              exsr      delpdf
N15   *
n15  c                   move      'sg'          artype
N15  C     keyark        chain     arkivl03                           35
N15  C  N35              delete    arkivr
N15  C  N35              exsr      delpdf
N15  c                   end
N15   *
      *
      * sletter tillegg import
      *
N15  C     ARTYPE        IFEQ      'si'
n15  c                   move      'sj'          artype
N15  C     keyark        chain     arkivl03                           35
N15  C  N35              delete    arkivr
N15  C  N35              exsr      delpdf
N15   *
n15  c                   move      'sk'          artype
N15  C     keyark        chain     arkivl03                           35
N15  C  N35              delete    arkivr
N15  C  N35              exsr      delpdf
n15  c                   end
      *
N15  C                   MOVE      ULDT          ARDATE
N15  C                   MOVE      XULTM         ARTIME
N15  C                   MOVE      ZUSER         ARUSER
N15  C                   MOVE      *BLANKS       ARSTAT
N15  c                   end
N15   *
      *
     C                   EVAL      WARKIVJN = 'N'
     C                   ENDIF

      *
     C                   ENDSR
      *************************************************************************
N20  C     SRDOM         BEGSR
      *************************************************************************
N20   *__________________________________________________________
N20  C* SR for omberegning                                 SRDOM
N20   *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
N20   * Legg kryssreferanse til riktig meldingsnr
N20  C                   MOVE      MMN           FMN
N20  C                   MOVE      *ZEROS        FLN
N20  C                   MOVE      *BLANKS       XNA              30
N20  C                   MOVE      *BLANKS       XADR1            30
N20  C                   MOVE      *BLANKS       XADR2            30
N20  C                   MOVE      *BLANKS       XADR3            30
N20  C                   MOVE      *BLANKS       XBLTT            11 0
N20  C                   MOVE      *BLANKS       FT1
N20  C                   MOVE      *BLANKS       AT1
N20  C                   MOVE      *ZEROS        BL1
N20  C                   MOVE      *ZEROS        XFT1NR            3 0
N20  C                   MOVE      'N'           XOMBAVG           1
N31  C                   MOVE      *BLANKS       ARUNDE
N20   *
N20   *  På de fleste segm antar vi at tollv. ikke har endret noe
N20   *  Henter kun BGM (ekspedisjonsdato), RFF (ekspedisjon-/løpenr)
N20   *
N20   * Nå skal lese eksp.dato, godgj.nr, meldinger, osv.
N20  C     STDOM1        TAG
N20  C     SEGNAM        DOWNE     'FTX'                                        1<-B
N21  C     SEGNAM        ANDNE     'RFF'
N20  C     SEGNAM        ANDNE     'NAD'
N20  C     SEGNAM        ANDNE     'TAX'
N20  C     SEGNAM        ANDNE     'UNT'
N20  C     SEGNAM        ANDNE     'UNS'
N20  C                   EXSR      GETSEG
N20  C   LR              GOTO      ENDDOM
N20  C                   END                                                    1<-E
N20  C     SEGNAM        IFEQ      'FTX'                                        1<-B
N20  C                   EXSR      SRDOM2
N20  C                   MOVE      *BLANKS       SEGNAM
N20  C                   GOTO      STDOM1
N20  C                   END                                                    1<-E
N21  C     SEGNAM        IFEQ      'RFF'                                        1<-B
N21  C                   EXSR      SRDOM4
N21  C                   MOVE      *BLANKS       SEGNAM
N21  C                   GOTO      STDOM1
N21  C                   END                                                    1<-E
N20  C     SEGNAM        IFEQ      'NAD'                                        1<-B
N20  C                   EXSR      SRHADR
N20  C                   MOVE      *BLANKS       SEGNAM
N20  C                   GOTO      STDOM1
N20  C                   END                                                    1<-E
N20  C     SEGNAM        IFEQ      'TAX'                                        1<-B
N20  C     XOMBAVG       IFEQ      'J'
N20  C                   EXSR      SRDOM3
N20  C                   ELSE
N20  C                   MOVE      *BLANKS       SEGNAM
N20  C                   END
N20  C                   GOTO      STDOM1
N20  C                   END                                                    1<-E
N20  C     SEGNAM        IFEQ      'UNS'                                        1<-B
N20  C                   EXSR      GETCH
N20  C* NLR              IF        TEGN = 'D'
N20  C  NLR              IF        TEGN = 'S'
N20  C                   MOVE      'J'           XOMBAVG
N20  C                   END
N20  C                   MOVE      *BLANKS       SEGNAM
N20  C*                  GOTO      ENDDOM
N20  C                   GOTO      STDOM1
N20  C                   END                                                    1<-E
N20  C     SEGNAM        IFEQ      'UNT'                                        1<-B
N20  C                   GOTO      ENDDOM
N20  C                   END                                                    1<-E
N20   *
N20  C     ENDDOM        TAG
N20  C                   WRITE     EDIMR
N21   *
N21  C                   CLEAR                   FRISOKR
N21  C                   MOVE      MAVD          FSAVD
N21  C                   EVAL      FSOPD  = MTDN * -1
N21  C                   MOVE      WDATO         FSDTOP
N21  C                   EVAL      FSKODE = 'TLØ'
N21  C                   EVAL      FSSOK  = LØPENR
N21  C                   MOVE      'OMBEREGNING' FSSOK
N21  C                   WRITE     FRISOKR
N21  C                   EVAL      FSKODE = 'TLE'
N21  C                   EVAL      FSSOK  = EKSSTE
N21  C                   MOVE      'OMBEREGNING' FSSOK
N21  C                   WRITE     FRISOKR
N21   *
N25  C                   IF        FIURBL = 'J'
N25  C     TDEKEY        CHAIN     HEADF                              33
S25  C*                  EXSR      TTSR
N25  C  N33              EXSR      TTSR
N25  C                   END
N21   *
N20  C                   IF        M1001 = '929'
N20  C     TDEKEY        CHAIN     SADH                               33
N20  C                   EVAL      SIST = 'P'
N21  C                   MOVE      LØPENR        SITLL
N21  C                   MOVE      EKSSTE        SITLE
N25  C                   EVAL      SIDTG = XP106
N20  C                   UPDATE    SADHR
N20  C     TDEKEY        CHAIN     SADHOM                             33
N20  C     XNA           IFNE      *BLANKS                                      1<-B
N20  C                   MOVE      XNA           SINAK
N20  C                   MOVE      XADR1         SIADK1
N20  C                   MOVE      XADR2         SIADK2
N20  C                   MOVE      XADR3         SIADK3
N20  C                   END                                                    1<-E
N20  C                   Z-ADD     XBLTT         SIBLTT
N20  C                   MOVEA     FT1           FT2
N20  C                   MOVEA     AT1           AT2
N20  C     1             DO        20            XN01
N20  C                   Z-ADD     BL1(XN01)     BL2(XN01)
N20  C                   END
N20  C                   UPDATE    SADHROM
N25  C                   MOVE      'si'          ARTYPE
N25  C                   MOVE      SIKNK         ARKUND
N20  C                   END
N20  C                   IF        M1001 = '830'
N20  C     TDEKEY        CHAIN     SAEH                               33
N20  C                   EVAL      SEST = 'P'
N21  C                   MOVE      LØPENR        SETLL
N21  C                   MOVE      EKSSTE        SETLE
N25  C                   EVAL      SEDTG = XP106
N20  C                   UPDATE    SAEHR
N20  C     TDEKEY        CHAIN     SAEHOM                             33
N20  C                   Z-ADD     XBLTT         SEBLTT
N20  C                   MOVEA     FT1           FT2
N20  C                   MOVEA     AT1           AT2
N20  C     1             DO        5             XN01
N20  C                   Z-ADD     BL1(XN01)     BL2(XN01)
N20  C                   END
N20  C                   UPDATE    SAEHROM
N25  C                   MOVE      'se'          ARTYPE
N25  C                   MOVE      SEKNK         ARKUND
N20  C                   END
N25   *
N25  C     FIFIRM        CHAIN     FIRMARC                            34
N25  C  N34ARTYPE        CHAIN     ARKTXT                             34
N25  C  N34              IF        ARKJN = 'J'                                  1<-B
N25  C                   MOVE      MAVD          ARAVD
N25  C                   MOVE      MTDN          AROPD
N25  C                   TIME                    XULTID
N25  C                   MOVE      XULDD         ULDD
N25  C                   MOVE      XULMM         ULMM
N25  C                   MOVE      XULÅÅ         ULÅÅ
N25  C                   MOVE      FIFIRM        ARFIRM
N25  C                   MOVE      ULDT          ARDATE
N25  C                   MOVE      XULTM         ARTIME
N25  C                   MOVE      ZUSER         ARUSER
N31   *
N31  C                   IF        AROPD < 0
N31   * VED OMBEREGNING SJEKKER PÅ EGEN ARKIV
N31  C                   IF        M1001 = '929'
N31  C                   Z-ADD     99            OMT_SIOMBN
N31  C     SADOMTHK      SETGT     SADOMTH
N31  C     TDEKEY        READPE    SADOMTH                                35
N31  C  N35              ADD       1             OMT_SIOMBN
N31  C  N35              MOVEL     OMT_SIOMBN    ARUNDE
N31  C                   ELSE
N31  C                   Z-ADD     99            OMT_SEOMBN
N31  C     SAEOMTHK      SETGT     SAEOMTH
N31  C     TDEKEY        READPE    SAEOMTH                                35
N31  C  N35              ADD       1             OMT_SEOMBN
N31  C  N35              MOVEL     OMT_SEOMBN    ARUNDE
N31  C                   END
N31  C                   END
N31   *
N25  C     keyark        chain     arkivl03                           35
N25  C                   IF        *IN35                                         2<-B
N25  C                   WRITE     arkivr
N25  C                   ELSE                                                    2
N25  C                   MOVE      ULDT          ARDATE
N25  C                   MOVE      XULTM         ARTIME
N25  C                   MOVE      ZUSER         ARUSER
N25  C                   MOVE      *BLANKS       ARSTAT
N25  C                   UPDATE    arkivr
N25  C                   exsr      delpdf
N25   * sletter tillegg eksport
N25  C                   IF        ARTYPE = 'se'                                  3<-B
N25  c                   move      'sf'          artype
N25  C     keyark        chain     arkivl03                           35
N25  C  N35              delete    arkivr
N25  C  N35              exsr      delpdf
N25   *
N25  c                   move      'sg'          artype
N25  C     keyark        chain     arkivl03                           35
N25  C  N35              delete    arkivr
N25  C  N35              exsr      delpdf
N25  c                   END                                                      3<-E
N25   * sletter tillegg import
N25  C                   IF        ARTYPE = 'si'                                  3<-B
N25  c                   move      'sj'          artype
N25  C     keyark        chain     arkivl03                           35
N25  C  N35              delete    arkivr
N25  C  N35              exsr      delpdf
N25   *
N25  c                   move      'sk'          artype
N25  C     keyark        chain     arkivl03                           35
N25  C  N35              delete    arkivr
N25  C  N35              exsr      delpdf
N25  c                   END                                                      3<-E
N25   *
N25  C                   MOVE      ULDT          ARDATE
N25  C                   MOVE      XULTM         ARTIME
N25  C                   MOVE      ZUSER         ARUSER
N25  C                   MOVE      *BLANKS       ARSTAT
N25  c                   END                                                     2<-E
N25   *
N25  C                   END                                                    1<-E
N20   *
N20  C                   ENDSR
      *******************************************************************
N20  C     SRDOM2        BEGSR
      *******************************************************************
N20   *
N20   *__________________________________________________________
N20  C* Oppdatere tilbake melding fra TVINN for omberegning SRDOM2
N20   *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
N20   *
N20   * Les kode AAP
N20  C                   MOVE      *BLANKS       FE
N20  C     1             DO        4             NR
N20  C                   EXSR      GETCH
N20  C   LR              GOTO      ENDDOM2
N20  C     TEGN          CABEQ     LOGKOL        STDOM21
N20  C     TEGN          CABEQ     LOGPLU        STDOM21
N20  C                   MOVEL     TEGN          FE(NR)
N20  C                   END
N20  C     STDOM21       TAG
N20  C     FELT          CABNE     'AAP'         ENDDOM2
N20   *
N20   * Lese 3 pluss-tegn før fritekster
N20  C     1             DO        2
N20  C                   EXSR      GETCH
N20  C   LR              GOTO      ENDDOM2
N20  C     TEGN          DOWNE     LOGPLU
N20  C                   EXSR      GETCH
N20  C   LR              GOTO      ENDDOM2
N20  C                   END
N20  C                   END
N20   * Hent meldingstekster legg i FT1
S29  C*    1             DO        4             NR
N29  C     1             DO        5             NR
N20  C                   MOVE      *BLANKS       FE
N20  C     1             DO        71            NR2               2 0
N20  C                   EXSR      GETCH
N20  C   LR              GOTO      ENDDOM2
N20  C     TEGN          CABEQ     LOGKOL        STDOM22
N20  C     TEGN          CABEQ     LOGAPP        STDOM22
N20  C                   MOVEL     TEGN          FE(NR2)
N20  C                   ENDDO
N20  C     STDOM22       TAG
S29  C*                  IF        XFT1NR < 4
N29  C                   IF        XFT1NR < 5
N20  C                   ADD       1             XFT1NR
N20  C                   MOVEL     FELT          FT1(XFT1NR)
N20  C                   END
N20  C     TEGN          CABEQ     LOGAPP        ENDDOM2
N20  C                   ENDDO
N20   *
N20  C     ENDDOM2       ENDSR
N20   *
      ***********************************************************************
N20  C     SRDOM3        BEGSR
      ***********************************************************************
N20   *__________________________________________________________
N20  C* Oppdatere avgifter fra TVINN                       SRDOM3
N20   *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
N20   *
N20  C                   MOVE      *ZEROS        XN01              3 0
N20  C     STDOM30       TAG
N20   * Hent KODE OM TOTALL ELLER AVGIFT
N20  C                   MOVE      *BLANKS       FE
N20  C     1             DO        2             NR
N20  C                   EXSR      GETCH
N20  C   LR              GOTO      ENDDOM3
N20  C     TEGN          CABEQ     LOGPLU        STDOM31
N20  C                   MOVEL     TEGN          FE(NR)
N20  C                   END
N20  C     STDOM31       TAG
N20  C                   MOVEL     FELT          XTYPE             1
N20   *
N20   * Lese KODE 161
N20  C     1             DO        4
N20  C                   EXSR      GETCH
N20  C   LR              GOTO      ENDDOM3
N20  C     TEGN          CABEQ     LOGKOL        STDOM32
N20  C                   ENDDO
N20  C     STDOM32       TAG
N20   * Hent beløp
N20  C                   MOVE      *ZEROS        XBL              11 0
N20  C                   MOVE      *BLANKS       XFTEGN            1
N20  C     1             DO        71            NR2               2 0
N20  C                   EXSR      GETCH
N20  C   LR              GOTO      ENDDOM3
N20  C     TEGN          CABEQ     LOGPLU        STDOM33
N20  C     TEGN          CABEQ     LOGAPP        STDOM33
N20  C                   IF        TEGN = '-'
N20  C                   EVAL      XFTEGN = '-'
N20  C                   ELSE
N20  C                   MULT      10            XBL
N20  C                   MOVE      TEGN          XBL
N20  C                   END
N20  C                   ENDDO
N20  C     STDOM33       TAG
N20  C                   IF        XFTEGN = '-'
N20  C                   EVAL      XBL = XBL * -1
N20  C                   END
N20  C                   SELECT
N20  C                   WHEN      XTYPE = '4'
N20  C                   EVAL      XBLTT = XBL
N20  C                   GOTO      STDOM35
N20  C                   WHEN      XTYPE = '3'
N20  C                   ADD       1             XN01
N20  C                   EVAL      BL1(XN01) = XBL
N20  C                   ENDSL
N20   * Hent AVGIFTSKODE
N20  C                   MOVE      *BLANKS       FE
N20  C     1             DO        3             NR
N20  C                   EXSR      GETCH
N20  C   LR              GOTO      ENDDOM3
N20  C     TEGN          CABEQ     LOGKOL        STDOM34
N20  C     TEGN          CABEQ     LOGAPP        STDOM34
N20  C                   MOVEL     TEGN          FE(NR)
N20  C                   END
N20  C     STDOM34       TAG
N20  C                   MOVEL     FELT          AT1(XN01)
N20   *
N20  C     STDOM35       TAG
N20  C                   EXSR      GETSEG
N20  C   LR              GOTO      ENDDOM3
N20  C     SEGNAM        CABEQ     'TAX'         STDOM30
N20   *
N20  C     ENDDOM3       ENDSR
      *********************************************************************
N21  C     SRDOM4        BEGSR
      *********************************************************************
N20   *
N21   *__________________________________________________________
N21  C* Oppdatere nytt løpenr fra TVINN for omberegning SRDOM4
N21   *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
N21   *
N21   * Teste om dataelement er 'ABT'. Hvis ikke, leser neste 'RFF'
N21  C                   MOVE      *BLANKS       FE
N21  C     1             DO        3             NR                             1<-B
N21  C                   EXSR      GETCH
N21  C   LR              GOTO      ENDDOM4
N21  C     TEGN          IFEQ      LOGPLU
N21  C     TEGN          OREQ      LOGAPP
N21  C     TEGN          OREQ      LOGKOL
N21  C                   LEAVE
N21  C                   END
N21  C                   MOVEL     TEGN          FE(NR)
N21  C                   END                                                    1<-E
N21   *
N21  C                   IF        FELT = 'ABT'                                 1<-B
N21   * Lese forbi kollon (:)
N21  C                   IF        TEGN <> LOGKOL
N21  C                   EXSR      GETCH
N21  C   LR              GOTO      ENDDOM4
N21  C                   END
N21   * Les hele segmentet
N21  C                   MOVE      *BLANKS       FE
N21  C     1             DO        35            NR                              2<-B
N21  C                   EXSR      GETCH
N21  C   LR              GOTO      ENDDOM4
N21  C     TEGN          CABEQ     LOGAPP        SRDOM41
N21  C     TEGN          CABEQ     LOGPLU        SRDOM41
N21  C     TEGN          CABEQ     LOGKOL        SRDOM41
N21  C                   MOVEL     TEGN          FE(NR)
N21  C                   END                                                     2<-E
N21  C     SRDOM41       TAG
N21  C                   MOVEL     XTLENY        EKSSTE
N21  C                   MOVEL     XTLLNY        LØPENR
N21  C                   END                                                    1<-E
N21   *
N21  C     ENDDOM4       ENDSR
N21   *
      **************************************************************************
     C     SRHADR        BEGSR
      **************************************************************************
     C*__________________________________________________________
     C* Hente navn og adresse til avsender/mottaker        SRHADR
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
S02  C*                  EXSR      GETCH
S02   * Lese to '+' TIL
S02  C*    1             DO        2
S02  C*    TEGN          DOWNE     LOGAPP
S02  C*    TEGN          ANDNE     LOGPLU
S02  C*                  EXSR      GETCH
S02  C*  LR              GOTO      ENDSRH
S02  C*                  END
S02  C*    TEGN          IFEQ      LOGAPP
S02  C*                  GOTO      ENDSRH
S02  C*                  END
S02  C*                  MOVE      ' '           TEGN
S02  C*                  END
N02   * HENT KODE
N02  C                   MOVE      *BLANKS       FE
N02  C                   MOVE      *ZEROS        NR2
N02  C                   MOVE      ' '           TEGN
N02  C     TEGN          DOWNE     LOGPLU
N02  C                   EXSR      GETCH
N02  C   LR              GOTO      ENDSRH
N02  C                   ADD       1             NR2
N02  C                   MOVEL     TEGN          FE(NR2)
N02  C                   END
N02  C                   MOVEL     FELT          XAN02             2
N02   * HENT KUNDE-ID
N02  C                   MOVE      *BLANKS       FE
N02  C                   MOVE      *ZEROS        NR2
N02  C                   MOVE      ' '           TEGN
N02  C     TEGN          DOWNE     LOGKOL
N02  C     TEGN          ANDNE     LOGPLU
N02  C                   EXSR      GETCH
N02  C   LR              GOTO      ENDSRH
N02  C     TEGN          IFNE      LOGKOL
N02  C     TEGN          ANDNE     LOGPLU
N02  C                   ADD       1             NR2
N02  C                   MOVEL     TEGN          FE(NR2)
N02  C                   END
N02  C                   END
N02   *
N02  C                   SELECT
N02  C                   WHEN      XAN02 = 'IM'
N02  C                   MOVEL     FELT          XP115
N02  C                   WHEN      XAN02 = 'DT'
N02  C                   MOVEL     FELT          XP117
N02  C                   ENDSL
N02   *
N02  C     TEGN          DOWNE     LOGAPP
N02  C     TEGN          ANDNE     LOGPLU
N02  C                   EXSR      GETCH
N02  C   LR              GOTO      ENDSRH
N02  C                   ENDDO
N02  C     TEGN          IFEQ      LOGAPP
N02  C                   GOTO      ENDSRH
N02  C                   END
      * Hente navn
     C                   EXSR      GETCH
     C                   MOVE      *BLANKS       FE
     C                   MOVE      *ZEROS        NR2
     C     TEGN          DOWNE     LOGAPP
     C     TEGN          ANDNE     LOGKOL
     C     NR2           IFLT      30
     C                   ADD       1             NR2
     C                   MOVEL     TEGN          FE(NR2)
     C                   END
     C                   EXSR      GETCH
     C   LR              GOTO      ENDSRH
     C                   END
     C                   MOVEL     FELT          XNA
N02   *
N02  C                   IF        XAN02 = 'IM'
N02  C                   MOVEL     FELT          XP116
N02  C                   END
N02   *
     C     TEGN          IFEQ      LOGAPP
     C                   GOTO      ENDSRH
     C                   END
      * Hente adresse-1
     C                   EXSR      GETCH
     C                   MOVE      *BLANKS       FE
     C                   MOVE      *ZEROS        NR2
     C     TEGN          DOWNE     LOGAPP
     C     TEGN          ANDNE     LOGKOL
     C     NR2           IFLT      30
     C                   ADD       1             NR2
     C                   MOVEL     TEGN          FE(NR2)
     C                   END
     C                   EXSR      GETCH
     C   LR              GOTO      ENDSRH
     C                   END
     C                   MOVEL     FELT          XADR1
     C     TEGN          IFEQ      LOGAPP
     C                   GOTO      ENDSRH
     C                   END
      * Hente adresse-2
     C                   EXSR      GETCH
     C                   MOVE      *BLANKS       FE
     C                   MOVE      *ZEROS        NR2
     C     TEGN          DOWNE     LOGAPP
     C     TEGN          ANDNE     LOGKOL
     C     NR2           IFLT      30
     C                   ADD       1             NR2
     C                   MOVEL     TEGN          FE(NR2)
     C                   END
     C                   EXSR      GETCH
     C   LR              GOTO      ENDSRH
     C                   END
     C                   MOVEL     FELT          XADR2
     C     TEGN          IFEQ      LOGAPP
     C                   GOTO      ENDSRH
     C                   END
      * Hente adresse-3
     C                   EXSR      GETCH
     C                   MOVE      *BLANKS       FE
     C                   MOVE      *ZEROS        NR2
     C     TEGN          DOWNE     LOGAPP
     C     TEGN          ANDNE     LOGKOL
     C     NR2           IFLT      30
     C                   ADD       1             NR2
     C                   MOVEL     TEGN          FE(NR2)
     C                   END
     C                   EXSR      GETCH
     C   LR              GOTO      ENDSRH
     C                   END
     C                   MOVEL     FELT          XADR3
      *
     C     ENDSRH        ENDSR
     C*
     C***********************************************
     C     TTSR          BEGSR
     C***********************************************
     C                   MOVE      HEAVD         TTAVD
N21  C                   IF        MTDN < 0
N21  C                   EVAL      TTOPD = MTDN * -1
N21  C                   MOVE      M1N07         TTACTI
N21  C                   ELSE
     C                   MOVE      HEOPD         TTOPD
N21  C                   END
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
S30  C*                  MOVE      ULDT          TTDATE
S30  C*                  MOVE      XULTM         TTTIME
S30  C*                  MOVE      TTDATE        TTDATL
S30  C*                  MOVE      TTTIME        TTTIML
N30  C                   EVAL      TTDATE = XDATO
N30  C                   EVAL      TTTIME = XTID * 100
N30  C                   EVAL      TTDATL = ULDT
N30  C                   EVAL      TTTIML = XULTM
     C                   MOVEL     'SY400USR'    TTUSER
N21  C                   IF        MTDN < 0
N21  C                   EVAL      TTTEXT = 'Accept Customs omberegning'
N21  C                   ELSE
     C                   MOVEL     'Accept c'    XXTEXT           16
     C                   MOVE      'ustoms  '    XXTEXT
     C                   MOVEL     XXTEXT        TTTEXT
N21  C                   END
     C     HETOGM        IFEQ      *BLANKS
     C                   MOVE      HETOLL        TTTEXT
     C                   ELSE
     C                   MOVE      HETOGM        TTTEXT
     C                   END
N21  C                   IF        MTDN < 0
N21  C                   EVAL      TTTEXL = 'Godkjent tollno omberegning'
N21  C                   ELSE
n12  C                   MOVEL     'Godkjent'    XXTEXT           16
n12  C                   MOVE      ' tollno '    XXTEXT
n12  C                   MOVEL     XXTEXT        TTTEXL
N21  C                   END
n12  C     HETOGM        IFEQ      *BLANKS
n12  C                   MOVE      HETOLL        TTTEXL
n12  C                   ELSE
n12  C                   MOVE      HETOGM        TTTEXL
n12  C                   END
     C                   WRITE     TRACKFR
     C                   ENDSR
      *
     C*
N15  C***********************************************
N15  C     DELPDF        BEGSR
N15  C***********************************************
N15  C     LagKey        KLIST
N15  C                   KFLD                    FIFIRM
N15  C                   KFLD                    ARKLAG
N15  C     ARKLAG        IFNE      *BLANKS
N15  C     LagKey        CHAIN     ARKEXT                             36
N15  c                   END
N15   *
N15  c                   eval      fradok=arcane
N15   *
N15  C     fradok        CAT       '/':0         fradok
N15  C     fradok        CAT       arlink:0      fradok
N15  C     '.'           SCAN      arlink                                 35
N15  C     *in35         ifeq      '0'
N15  C     fradok        CAT       '.pdf':0      fradok
N15  c                   end
N15  c                   call      'ARC041C1'
N15  c                   parm                    fradok           70
N15  c                   endsr
n17  C*******************************************************
n17  C     TESTEP        BEGSR
n17  C*******************************************************
n17   *
n17   * utelate epost i visse tilfelle
n17   *
n17  c     testny        tag
n17   *
n17   * tester oppdragstype
n17   *
n17  c     copd          ifne      *blanks
n17  C     heot          LOOKUP    oty                                    35
n17  c     copdio        ifeq      'I'
n17  c  N35              seton                                        34
n17  c                   end
n17  c     copdio        ifeq      'O'
n17  c   35              seton                                        34
n17  c                   end
n17  c                   end
n17   *
n17   * tester avdeling
n17   *
n17  C     cavd          ifne      *zeros
n17  C     heavd         LOOKUP    av                                     35
n17  c     cavdio        ifeq      'I'
n17  c  N35              seton                                        34
n17  c                   end
n17  c     cavdio        ifeq      'O'
n17  c   35              seton                                        34
n17  c                   end
n17  c                   end
n17   *
n17   * les videre hvis 34 er satt på
n17   *
n17  c     *in34         ifeq      '1'
n17  c                   setoff                                       35
n17  c     epokey        reade     cundc03                                35
n17  c     *in35         ifeq      '0'
n17  c                   setoff                                       34
n17  c                   goto      testny
n17  c                   end
n17  c                   end
n17  c                   endsr
N45  C************************************************
N45  C     N45SR1        BEGSR
N45  C************************************************
N45  C                   SELECT
N45  C     HEUR          WHENEQ    'A'
N45  C                   MOVE      'XXX'         TSKODE
N45  C     HEUR          WHENEQ    'C'
N45  C                   MOVE      'CLC'         TSKODE
N45  C     HEUR          WHENEQ    'F'
N45  C                   MOVE      'A39'         TSKODE
N45  C     HEUR          WHENEQ    'B'
N45  C                   MOVE      'XXX'         TSKODE
N45  C     HEUR          WHENEQ    'D'
N45  C                   MOVE      'ECR'         TSKODE
N45  C     HEUR          WHENEQ    'G'
N45  C                   MOVE      'A45'         TSKODE
N45  C                   ENDSL
N45
N45  C                   MOVE      HEAVD         TSAVD
N45  C                   MOVE      HEOPD         TSOPD
N45  C                   MOVE      M0068A        U0068A            9
N45  C                   MOVE      M0068B        U0068B            6
N45  C                   MOVE      M0068C        U0068C            2
N45  C                   MOVE      EKSLØP        UEKSLØP          16
N45
N45  C     HEUR          IFEQ      'A'
N45  C     HEUR          OREQ      'C'
N45  C     HEUR          OREQ      'F'
N45  C                   CALL      'SYXML45NOI'
N45  C                   PARM                    TSAVD             4
N45  C                   PARM                    TSOPD             7
N45  C                   PARM                    TSKODE            3
N45  C                   PARM                    U0068A
N45  C                   PARM                    U0068B
N45  C                   PARM                    U0068C
N45  C                   PARM                    UEKSLØP
N45  C                   ELSE
N45  C                   CALL      'SYXML45NOE'
N45  C                   PARM                    TSAVD
N45  C                   PARM                    TSOPD
N45  C                   PARM                    TSKODE
N45  C                   PARM                    U0068A
N45  C                   PARM                    U0068B
N45  C                   PARM                    U0068C
N45  C                   PARM                    UEKSLØP
N45  C                   ENDIF
N45
N45  C     TDEKEY        CHAIN     HEADF
N45  C                   IF        %FOUND(HEADF)
N45  C                   EVAL      TRSTA4='S'
N45  C                   UPDATE    HEADFR
N45  C                   ENDIF
N45  C                   ENDSR
     OSADHR     E            SADHUT
     O                       SIST
     O                       SINAK
     O                       SIADK1
     O                       SIADK2
     O                       SIADK3
     O                       SIDTG
     O                       SITLL
     O                       SITLE
     O                       SIMID
     O                       SIMIDK
     O                       SIMF
     O                       SIMI
     O                       SIPKL
     O                       SI0035
     O                       SIWS
     OSADHR     E            SADHME
     O                       SIST
     O                       SIMI
N41  O                       SIKDV
     O                       SI0035
     O                       SIWS
     OSAEHR     E            SAEHUT
     O                       SEST
     O                       SENAK
     O                       SEADK1
     O                       SEADK2
     O                       SEADK3
     O                       SEDTG
     O                       SETLL
     O                       SETLE
     O                       SEMF
     O                       SEPKL
     O                       SEWS
     O                       SE0035
     O                       SEMI
     OSAEHR     E            SAEHME
     O                       SEST
     O                       SEWS
N41  O                       SEKDV
     O                       SE0035
     O                       SEMI
