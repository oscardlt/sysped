     H Option( *SrcStmt ) DftActGrp( *No ) BndDir( 'QC2LE' )
     FTRIH      UF   E           K DISK
     FTRISTD    IF   E           K DISK
     FEDIC      UF   E             DISK
     FDKTFI     IF   E             DISK
     FEDIM      O  A E             DISK
      *__________
      * Variabler
      *""""""""""
     D FILE_o          s               *
     D String          s            512a
     D rc              s             10i 0
     D Data            s          10000a   Varying
     D Codepage        s              5a   Varying
      *___________________________
      * IFS Stream file funksjoner
      *"""""""""""""""""""""""""""
     Dopen             Pr              *   ExtProc( '_C_IFS_fopen' )
     D                                 *   Value Options( *String )
     D                                 *   Value Options( *String )

     Dfputs            Pr            10i 0 ExtProc( '_C_IFS_fputs' )
     D                                 *   Value Options( *String )
     D                                 *   Value

     Dclose            Pr            10i 0 ExtProc( '_C_IFS_fclose' )
     D                                 *   Value
     D RunCmd          PR                  EXTPGM('QCMDEXC')
     D  Cmd                         200A   CONST
     D  Len                          15P 5 CONST
      *   SYEDI data area
     D EDIDTA          DS           256
     D  UELIBF               171    180

     C                   EXSR      INIT

     C     TRIHKEY       CHAIN     TRIH                               33
     C                   MOVE      'Q'           TIST
     C  N33              UPDATE    TRIHR

     C                   EXSR      KOMLIN

     C     SLUTT         TAG
     C                   EVAL      *INLR = *ON
      ***********************************************
     C     KOMLIN        BEGSR
      ***********************************************
     C                   CALL      'DKX151R'
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    U1N07
     C                   PARM                    UDATA         10000
      * Lag ASCIIfil
     C                   MOVE      UAVD          WAVD              4
     C                   MOVE      UTDN          WOPD              7
     C                   MOVE      *BLANKS       WFILNAM         256
     C                   EVAL      WFILNAM = '/' + %trimr(UELIBF)
     C                             + '/EDISE/TEMP/DKYU' + WAVD + '-' + WOPD

     C                   EVAL      Codepage = '819'
     C                   EVAL      FILE_o = open( %TrimR( WfilNam )
     C                             : 'w, codepage=' + Codepage )

     C                   EVAL      rc = close( FILE_o )

     C                   EVAL      FILE_o = open( %TrimR( WfilNam )
     C                             : 'w' )

     C                   IF        FILE_o <> *Null
     C                   EVAL      Data = %trimr(UDATA)
     C                   EVAL      rc = fputs(Data : File_o)
     C                   EVAL      rc = close( FILE_o )
     C                   ENDIF
      *_______________
      * Skriv til EDIM
      *"""""""""""""""
     C                   CLEAR                   EDIMR
     C                   EVAL      M0004=DKTF_0004T
     C                   EVAL      M0010='NTA.DK'
     C                   EVAL      M0035=TI0035
     C                   MOVEL     TIAVD         W0062            11
     C                   MOVE      TITDN         W0062
     C                   EVAL      M0062=W0062
     C                   EVAL      M0065='CUSDEC'
     C                   EVAL      M1001='DTI'
     C                   EVAL      M1004=TITUID
     C                   EVAL      M0068=TITUID
     C                   EVAL      M1225=U1N07
     C                   EVAL      M1N07=U1N07
     C                   EVAL      MMN=CMN
     C                   EVAL      MSR='S'
     C                   MOVEL     WDT           MDT
     C                   MOVEL     WTM           MTM
     C                   EVAL      MAVD=TIAVD
     C                   EVAL      MTDN=TITDN

     C                   WRITE     EDIMR

     C                   ENDSR
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     *LIKE         DEFINE    M0068A        MAX0B
     C     *LIKE         DEFINE    M0068B        MAX0C
     C     *LIKE         DEFINE    M0068C        MAX0D
     C     TRIHKEY       KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C     M2KDCK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    MAX0B
     C                   KFLD                    MAX0C
     C                   KFLD                    MAX0D
     C     M2KD2K        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN

     C     *ENTRY        PLIST
     C                   PARM                    UAVD              4 0
     C                   PARM                    UTDN              7 0
     C                   PARM                    U1N07             3
     C                   PARM                    UFLAGG            1 0

     C                   MOVE      '99999999'    MAX0B
     C                   MOVE      '999999'      MAX0C
     C                   MOVE      '99'          MAX0D

     C     UAVD          CHAIN     TRISTD                             33
     C     TRIHKEY       CHAIN(N)  TRIH                               33

      * Åpne dataarea
     C     *DTAARA       DEFINE                  EDIDTA
     C                   IN        EDIDTA
      * Hæmta firmaupplysningar
     C     1             CHAIN     DKTFI                              51
      * Hæmta næsta meddelandenummer
     C     1             CHAIN     EDIC                               51
     C                   ADD       1             CMN
     C                   UPDATE    EDICR
      * Hæmta dagens datum och klockslag
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6

     C                   ENDSR
