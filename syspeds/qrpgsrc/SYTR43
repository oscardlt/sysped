********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 00 SH  PTF10 tatt inn kingsrød som standard
10XXX * 01 JOV PTF10 TA MED OGSÅ DET SOM ER KJØRT PÅ REKV.
10XXX * 02 JOV PTF10 FWEIL VED BESTILLING AV ALLE
10XXX * 03 SH  PTF10 bruddsum rekvisisjonener
10XXX * 04 SH  PTF10 tar antall ordre fra head11
10XXX * 05 SH  PTF10 sende epost J/N
10XXX * 06 SH  PTF10 rettelse til 05
10XXX * 07 SH  PTF11 tekst kjørt på rekvisisjon + div
********************************************************************
     FSYTR43FI  O  A E           K DISK
     FKODTGE    IF   E           K DISK
     FHODE      IF   E           K DISK
     FTRAN      IF   E           K DISK
     FTURER     IF   E           K DISK
     FTURER21   IF   E           K DISK
N01  F                                     RENAME(TURERR:TURERR21)
     FTRAVH1    IF   E           K DISK
     FTRAVV     IF   E           K DISK
     FTRAVV5    IF   E           K DISK
     F                                     RENAME(TRAVVR:TRAVVR5)
N01  FHEADF     IF   E           K DISK
     FHEAD11    IF   E           K DISK
N01  F                                     RENAME(HEADFR:HEADFR11)
     FKOSBU     IF   E           K DISK
N01  FKOSBU16   IF   E           K DISK
N01  F                                     RENAME(KOSBUR:KOSBUR16)
     FKOSTA     IF   E           K DISK
     FSYTR43PF  O    E             PRINTER
     FFIRM      IF   E           K DISK
     FFAKT      IF   E           K DISK
     FSTED2D    IF   E           K DISK
     D                 DS
     D  UDATOX                 1      6  0
     D  UDT1X                  1      2  0
     D  UDT2X                  3      4  0
     D  UDT3X                  5      6  0
     D                 DS
     D  UDATOF                 1      6  0
     D  UDT1F                  1      2  0
     D  UDT2F                  3      4  0
     D  UDT3F                  5      6  0
     D                 DS
     D  UDATOT                 1      6  0
     D  UDT1T                  1      2  0
     D  UDT2T                  3      4  0
     D  UDT3T                  5      6  0
     d                 DS
     D  tusonf                 1      5
     d  tulkfr                 1      2
     d                 DS
     D  tusont                 1      5
     d  tulkti                 1      2
     d                 DS
     D  tusdf                  1     20
     d  tustf6                 1      6
     D                 DS
     D  tusdt                  1     20
     D  tustt6                 1      6
     D                 DS
     D  TURPER                 1      8  0
     D  TURACC                 1      2  0
     D  TURAAR                 3      4  0
     D  TURMND                 5      6  0
     D  TURDAG                 7      8  0
N01  D                 DS
N01  D  REKPER6                1      6  0
N01  D  BUPCC                  1      2  0
N01  D  BUPÅR                  3      4  0
N01  D  BUPMN                  5      6  0
     D                 DS
     D  UTUDT                  1      6  0
     D  UTUCCA                 1      2  0
     D  UTUAAR                 3      4  0
     D  UTUMND                 5      6  0
     D                 DS
     D  ENGAD3                 1     30
     D  SYPOGE                 1      9
     D  ADR3                  11     34
     D                 DS
     D  TUSJN1                 1     30
     D  TUSJ15                 1     15
     D                 DS
     D  UDATO0                 1      6  0
     D  UDT1                   1      2  0
     D  UDT2                   3      4  0
     D  UDT3                   5      6  0
     C*
     C                   EXSR      INIT
     C*
     C  N66
     CANN32              EXSR      HOVED
     C   66              EXSR      LESALL
     C*
     C                   SETON                                        LR
     C                   RETURN
     C*****************************************************************
     C     HOVED         BEGSR
     C*****************************************************************
     C*
     C                   Z-ADD     0             WSIDE             3 0
     C*
     C     UHEAD         IFEQ      'J'
     C     UHEAD         OREQ      'Y'
     C                   ADD       1             WSIDE
n05  c     epost         ifne      'J'
     C                   WRITE     HEADP
n05  c                   end
     C                   Z-ADD     9             ANTL              2 0
     C                   ELSE
     C                   ADD       1             WSIDE
n05  c     epost         ifne      'J'
     C                   WRITE     HEAD0
n05  c                   end
     C                   Z-ADD     5             ANTL
     C                   END
     C*
     C                   MOVEL     UDAT81        UTUDT
     C     TURKE2        SETLL     TURER21
     C     START         TAG
     C     UBILN         READE     TURER21                                32
     C  N32              Z-ADD     01            TURDAG
     C  N32TURPER        COMP      UDAT82                             32
     C   32              GOTO      SLUTT
     C*
     C     START2        TAG
     C* HVIS TRANSP. IKKE FINNES - SKIPP TUREN (SPEDISJONSTUR ???)
     C     TRANKE        CHAIN     TRAN                               32
     C   32              GOTO      START
     C*
     C*
     C                   SETOFF                                       50
     C*
     C* SNUR DATOER
     C                   MOVE      TUDT          FRADAT
     C                   MOVE      TUDTT         TILDAT
     C     FIDTFM        IFNE      3
     C                   CALL      'DATFM3'
     C                   PARM                    FIDTFM
     C                   PARM                    FRADAT
     C                   CALL      'DATFM3'
     C                   PARM                    FIDTFM
     C                   PARM                    TILDAT
     C                   END
     C*
     C*
     C     ANTL          IFGT      57
     C     UHEAD         IFEQ      'J'
     C     UHEAD         OREQ      'Y'
     C                   ADD       1             WSIDE
n05  c     epost         ifne      'J'
     C                   WRITE     HEADP
n05  c                   end
     C                   Z-ADD     9             ANTL
     C                   ELSE
     C                   ADD       1             WSIDE
n05  c     epost         ifne      'J'
     C                   WRITE     HEAD0
n05  c                   end
     C*                  Z-ADD     4             ANTL
     C                   Z-ADD     5             ANTL
     C                   END
     C                   END
     C*
     C*TUREN AVREGNET? HVIS IKKE:SIMULER AVREGNING FOR Å FÅ DATA
     C     TRAVHK        CHAIN     TRAVH1                             33
     C   33              MOVE      ' '           THST
     C   33              MOVE      ' '           THSTAR
     C*HVIS DEN IKKE FANTES ELLER VAR UBESKYTTET - GENERER DATA
     C     THST          IFEQ      ' '
     C     THSTAR        ANDEQ     ' '                                           *UBESKYTTET
     C                   MOVE      TUAVD         XXAVD             4 0
     C                   MOVE      TUPRO         XXTUNR            8 0
     C                   MOVE      'N'           XXVIS             1
     C                   CALL      'SYTR12A'
     C                   PARM                    XXAVD
     C                   PARM                    XXTUNR
     C                   PARM                    XXVIS
     C                   PARM                    N4                4 0
     C                   PARM                    N7                7 0
     C                   PARM                    N8                8 0
     C* CHAIN PÅ NY FOR Å HENTE TALL FRA AVREGNING
     C     TRAVHK        CHAIN     TRAVH1                             33
     C                   END
     C*
     C* SPLITT (AKKUMULER) BRUTTO
     C                   MOVE      *ZEROS        BRUTTO            7 0
     C                   MOVE      'B'           TVTYP             1
     C     TRAVVK        SETLL     TRAVV
     C     TRAVVK        READE     TRAVV                                  33
     C     *IN33         DOWEQ     '0'
     C     VMINCR        IFNE      2
     C     TVTYP         ANDEQ     'B'
     C                   ADD       TVBLLB        BRUTTO
     C                   ELSE
     C     TVTYP         IFNE      'D'
     C     TVTYP         ANDNE     'F'
     C     TVTYP         ANDNE     'E'
     C     TVTYP         ANDNE     'C'
     C                   ADD       TVBLLB        BRUTTO
     C                   END
     C                   END
     C     TRAVVK        READE     TRAVV                                  33
     C                   END
     C*
      *
      * endre netto brutto
      *
     C* GRUPPER ANDRE BELØP - FORKORT TIL 7 LANG.
     C     THINH         ADD       THUTK         INNUT             7 0
     C     THRKV         ADD       THBUD         REKV              7 0
     C                   ADD       THJUS         REKV
     C                   MOVE      *ZEROS        AVR               7 0
     C* Ved EGEN bil - ikke vis avregn. som egen kolonne
     C* (kolonna Prov.mm viser ved EGEN bil brutto - rene trekk)
     C*    VMINCR        IFNE      2
     C                   Z-ADD     THTOT         AVR
     C*                  END
     C* FINN SAMLET FVEKT
     C*
      *
      * BEHANDLING VED AVTALT PRIS
      *
     C* SKRIV *AVTALT* DERSOM AVREGNET BELØP = AVTALT
     C                   setoff                                       55
     C     TUTAKO        IFEQ      'A'
     C                   seton                                        55
     c                   z-add     tutbel        avr
     c                   exsr      brusr
     c                   end
     C* BRUTTO MINUS ALLE KOSTN LEGGES I FELT PROVISJ (M.M.)
     C* (AVR.TOT. HAR + FORTEGN MENS TREKK HAR MINUS (ADD=TREKK FRA)
     C     VMINCR        IFNE      2
     C     BRUTTO        ADD       REKV          PROVIS            7 0
     C                   ADD       INNUT         PROVIS
     C                   SUB       AVR           PROVIS
     C                   end
     C                   MOVE      *ZEROS        TOTFVK            7 0
     C                   MOVE      *ZEROS        WTOTA             8 0
     C                   MOVE      *ZEROS        WTOTB             8 0
     C                   MOVE      *ZEROS        WTOTC             8 0
     C                   MOVE      *ZEROS        WTOTD             8 0
     C                   MOVE      *ZEROS        WTOTE             8 0
      *
N04  c                   z-add     0             antord            3 0
     C     TUPRO         SETLL     HEAD11
     C     TUPRO         READE     HEAD11                                 33
     C     *IN33         DOWEQ     '0'
     C                   ADD       HEFBV         TOTFVK
N04  c                   add       1             antord
     C                   EXSR      SUM1
     C     TUPRO         READE     HEAD11                                 33
     C                   END
     C*
     C                   Z-ADD     WTOTA         TOTA              7 0
     C                   Z-ADD     WTOTB         TOTB              7 0
     C                   Z-ADD     WTOTC         TOTC              7 0
     C                   Z-ADD     WTOTD         TOTD              7 0
     C                   Z-ADD     WTOTE         TOTE              7 0
s04  C*                  Z-ADD     TUAO          XXANT             3 0
n04  C                   Z-ADD     ANTORD        XXANT             3 0
     C*
     C*
     C* HENT BILAGSNR FOR FØRT/OPPGJORT KOSTNAD
     C*(ENTEN INNG. LEV.BILAG ELLER KREDITNOTANR)
     C                   MOVE      *ZEROS        BILAG             6 0
     C                   MOVE      *BLANKS       BILTYP            2
     C     TUTREF        IFNE      *ZEROS
     C     TUTREF        CHAIN     KOSBU                              33
     C  N33BUST          IFNE      ' '
     C     BUBNR2        ANDNE     *ZEROS
     C                   Z-ADD     BUBNR2        BILAG
     C                   MOVE      'IP'          BILTYP                         *INNG.PREREGNR
     C     BUBNR2        CHAIN     KOSTA                              33
     C     *IN32         IFEQ      '0'
     C     KABNR2        ANDNE     *ZEROS
     C                   Z-ADD     KABNR2        BILAG
     C                   MOVE      'IF'          BILTYP                         *INNG. FAK
     C                   END
     C                   END
     C                   END
     C     BILAG         IFEQ      *ZEROS
     C     THFAKT        ANDNE     *ZEROS
     C                   Z-ADD     THFAKT        BILAG
     C                   MOVE      'AV'          BILTYP                         *AVREGN.
     C                   END
     C*
     C* Akkumuler totaler for denne bil
     C                   ADD       1             ANTTUR
     C                   ADD       TUTVKT        BILVKB
     C                   ADD       TOTFVK        BILVKF
     C                   ADD       XXANT         BILANT
     C                   ADD       BRUTTO        BILBRT
     C                   ADD       PROVIS        BILPRO
     C                   ADD       INNUT         BILIU
     C                   ADD       REKV          BILREK
     C                   ADD       AVR           BILAVR
     C                   ADD       TOTA          BILA
     C                   ADD       TOTB          BILB
     C                   ADD       TOTC          BILC
     C                   ADD       TOTD          BILD
     C                   ADD       TOTE          BILE
     C*
n05  c     epost         ifne      'J'
     C                   WRITE     DET
n05  c                   else
N05  c                   write     sytr43fir
n05  c                   end
     C                   EXSR      SUM2
     C                   ADD       2             ANTL
     C*
     C                   GOTO      START
     C*
     C     SLUTT         TAG
N01  C* Hent summer kjørt på rekvisisjon
N01  C                   exsr      REKVSR
     C* Skriv bruddsum
     C     ANTTUR        IFGT      0
     C                   MOVE      UBILN         FBILN            10              (PRTF..)
n05  c     epost         ifne      'J'
     C                   WRITE     BILTOT
n05  c                   end
     C* Initier for neste bruddsum
     C                   MOVE      *ZEROS        ANTTUR            3 0
     C                   MOVE      *ZEROS        BILVKB            7 0
     C                   MOVE      *ZEROS        BILVKF            7 0
     C                   MOVE      *ZEROS        BILANT            3 0
     C                   MOVE      *ZEROS        BILBRT            7 0
     C                   MOVE      *ZEROS        BILPRO            7 0
     C                   MOVE      *ZEROS        BILIU             7 0
     C                   MOVE      *ZEROS        BILREK            7 0
     C                   MOVE      *ZEROS        BILAVR            7 0
     C                   MOVE      *ZEROS        BILA              7 0
     C                   MOVE      *ZEROS        BILB              7 0
     C                   MOVE      *ZEROS        BILC              7 0
     C                   MOVE      *ZEROS        BILD              7 0
     C                   MOVE      *ZEROS        BILE              7 0
     C                   END
     C                   ENDSR
      *
      *
N01  C*****************************************************************
N01  C     REKVSR        BEGSR
N01  C*****************************************************************
N02  C                   z-add     0             brurek            9 0
N01   *  UTFØRT I PERIODEN - BILNR IKKE!! SAMSVARENDE MED TURENS BILNR
N01   *  justeringer (uten turnummer) medtas ikke
N01  c                   move      'N'           rekHea            1
N01  C     TURKE2        SETLL     KOSBU16
N01  C     UBILN         READE     KOSBU16                                33
N01  C     *IN33         DOWEQ     '0'
N01  C     REKPER6       cabgt     TilPer6       UtRekv               32
N01  C     BUST          cabeq     'S'           nextRekv
N01  C     BUTUNR        cabeq     *zeros        nextRekv
N01  C     turKey        chain     TURER                              33
N01  C     *in33         cabeq     '1'           nextRekv
N01  C     BUBILN        cabeq     TUBILN        nextRekv
N01  c                   exsr      clearHea
N01  c     BUOPD         ifne      *zeros
N01  C     heaKey        chain     HEADF                              33
N01  c                   endif
N01   * funnet rekv som skal med..
N01  C     rekHea        ifeq      'N'
n05  c     epost         ifne      'J'
N01  C                   WRITE     REKVHEAD
n05  c                   end
N01  c                   move      'Y'           rekHea                         Skrevet
N01  c                   endif
N01  C                   Z-ADD     BUBL          HEE
N01  c                   ADD       BUBL          BILAVR
N02  C                   ADD       BUBL          brurek            9 0
N01  c     HEOPD         ifne      *zeros
N01  C                   Z-ADD     HENT          HHENT
N01  C                   Z-ADD     HEFBV         HHEFBV
N01  C                   Move      *zeros        HEA
N01  C                   Move      *zeros        HEB
N01  C                   Move      *zeros        HEC
N01  C                   Move      *zeros        HED
N01  c                   ADD       HEVKT         BILVKB
N01  c                   ADD       HEFBV         BILVKF
N01  c                   ADD       1             BILANT
N01  C                   Z-ADD     HEKNS         HHEKNS
N01  C                   MOVEL     HENAS         HHENAS
N01  C                   MOVEL     *BLANKS       WFRA
N01  C                   MOVEL     *BLANKS       WTIL
N01  C                   MOVEL     HELKA         WLAND
N01  C                   MOVEL     HESDF         WSTED
N01  C     STED2KY       CHAIN     STED2D                             44
N01  C     *IN44         IFEQ      *OFF
N01  C                   MOVEL     ST2NVN        WFRA
N01  C                   ENDIF
N01  C                   MOVEL     HETRI         WLAND
N01  C                   MOVEL     HESDT         WSTED
N01  C     STED2KY       CHAIN     STED2D                             44
N01  C     *IN44         IFEQ      *OFF
N01  C                   MOVEL     ST2NVN        WTIL
N01  C                   ENDIF
N01  c                   endif
N01   *
N01  C*
N01  C     ANTL          IFGT      57
N01  C     UHEAD         IFEQ      'J'
N01  C     UHEAD         OREQ      'Y'
N01  C                   ADD       1             WSIDE
n05  c     epost         ifne      'J'
N01  C                   WRITE     HEADP
n05  c                   end
N01  C                   Z-ADD     9             ANTL
N01  C                   ELSE
N01  C                   ADD       1             WSIDE
n05  c     epost         ifne      'J'
N01  C                   WRITE     HEAD0
n05  c                   end
N01  C                   Z-ADD     5             ANTL
N01  C                   END
N01  C                   END
N01   *
N01  c     HEOPD         ifne      *zeros
n05  c     epost         ifne      'J'
N01  C                   WRITE     DETHE
n06  c                   else
n06  c                   clear                   SYTR43FIR
N06  c                   z-add     HHEFBV        TOTFVK
N06  c                   z-add     HHENT         XXANT
N06  c                   z-add     HEA           BRUTTO
N06  c                   z-add     HEB           PROVIS
N06  c                   z-add     HEC           INNUT
N06  c                   z-add     HED           REKV
N06  c                   z-add     HEE           AVR
N06  c                   MOVE      HELKA         TULKFR
N06  c                   MOVEL     HESDF         TUSTF6
N06  c*                  MOVE      WFRA          FRADAT
N06  c                   MOVE      HETRI         TULKTI
N06  c                   MOVEL     HESDT         TUSTT6
N06  c*                  MOVE      WTIL          TILDAT
N06  c                   z-add     HEAVD         TUAVD
N06  c                   z-add     HEOPD         TUPRO
N06  c*                  MOVE      HHEKNS        b
N06  C*                  MOVE      HHENAS
n07  c                   move      *blanks       vmnavn
n07  c                   move      *zeros        vmtran
n07  C     TRANKER       CHAIN     TRAN                               34
N06  c                   write     sytr43fir
n01  c                   end
N01  c                   else
n05  c     epost         ifne      'J'
N01  C                   WRITE     DETREKV
n06  c                   else
n06  c                   clear                   SYTR43FIR
n06  c                   movel     BUTXT         tustt6
n06  c                   move      BUTUNR        tupro
n06  c                   move      BUBNR         turund
n06  c                   z-add     HEE           avr
n07  c                   move      *blanks       vmnavn
n07  c                   move      *zeros        vmtran
n07  C     TRANKER       CHAIN     TRAN                               34
n07  c                   eval      tubiln=BUBILN
N06  c                   write     sytr43fir
n05  c                   end
N01  c                   endif
N01  C                   ADD       1             ANTL
N01   *
N01  C     nextRekv      tag
N01  C     UBILN         READE     KOSBU16                                33
N01  C                   ENDDO
N01   *
N01   *
N02  C     Utrekv        TAG
N02  C     brurek        ifne      0
n05  c     epost         ifne      'J'
N02  C                   write     brurekp
n05  c                   end
N02  C                   END
S02  C*    Utrekv        ENDSR
N02  C                   ENDSR
      *
     C*****************************************************************
     C     clearHea      BEGSR
     C*****************************************************************
     c                   clear                   HEAVD
     c                   clear                   HEOPD
     c                   clear                   HENT
     c                   clear                   HEVKT
     c                   clear                   HEFBV
     c                   clear                   HEKNS
     c                   clear                   HENAS
     c                   clear                   HELKA
     c                   clear                   HESDF
     c                   clear                   HETRI
     c                   clear                   HESDT
N01  C                   ENDSR
      *
     C*****************************************************************
     C     LESALL        BEGSR
     C*****************************************************************
     C* KALLES NÅR IKKE SELEKTERT PÅ BILNUMMER
     C*
     C* Finn neste bilnummer
     C*
     C     NESTBI        TAG
     C     TURKEM        SETGT     TURER21
     C                   READ      TURER21                                30
     C  N30              MOVE      TUBILN        UBILN
     C   30              GOTO      UTFINN
     C*
     C* Finnes det gyldige turer innen det bilnummeret
     C*
N02  C                   MOVEL     UDAT81        UTUDT
     C     TURKE2        SETLL     TURER21
     C     UBILN         READE     TURER21                                32
     C     *IN32         DOWEQ     '0'
     C     TUDT          CABGT     UDAT82        NESTBI
     C*Hvis ugyldig transportør (sped.tur??) sjekk om fler på samme bil
     C     TRANKE        CHAIN     TRAN                               33
     C  N33              GOTO      OKBILN
     C     UBILN         READE     TURER21                                32
     C                   END
     c* INGEN GYLDIGE FANTES....
     C                   GOTO      NESTBI
     C*
     C     OKBILN        TAG
     C*
     C     UTYPE         IFNE      ' '
     C     VMINCR        IFNE      UTYPEN
     C                   GOTO      NESTBI
     C                   END
     C                   END
     C*
     C* SR HOVED BEHANDLER ET GITT BILNR...
     C                   EXSR      HOVED
     C*
     C                   GOTO      NESTBI
     C*
     C     UTFINN        ENDSR
     C*****************************************************************
     C     INIT          BEGSR
     C*****************************************************************
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UBILN            10
     C                   PARM                    UDATO1            6 0
     C                   PARM                    UDATO2            6 0
     C                   PARM                    UTYPE             1
     C                   PARM                    UHEAD             1
     C                   PARM                    UANT              3 0
n05  C                   PARM                    EPOST             1
     C                   MOVE      UDATO1        UFRA              4 0
     C                   MOVE      UDATO2        UTIL              4 0
     C     TURKE2        KLIST
     C                   KFLD                    UBILN
     C                   KFLD                    UTUCCA
     C                   KFLD                    UTUAAR
     C                   KFLD                    UTUMND
     C     TURKEM        KLIST
     C                   KFLD                    UBILN
     C                   KFLD                    MAXACC
     C                   KFLD                    MAXAAR
     C                   KFLD                    MAXMND
     C     TRANKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    TUKNT2
N07  C     TRANKER       KLIST
N07  C                   KFLD                    FIFIRM
N07  C                   KFLD                    BUTNR
     C     HODEK         KLIST
     C                   KFLD                    YNET
     C                   KFLD                    TUAVD
     C     TRAVHK        KLIST
     C                   KFLD                    TUAVD
     C                   KFLD                    TUPRO
     C     TRAVVK        KLIST
     C                   KFLD                    TUAVD
     C                   KFLD                    TUPRO
     C     STED2KY       KLIST
     C                   KFLD                    WLAND             2
     C                   KFLD                    WSTED             5
N01  C     turKey        KLIST
N01  C                   KFLD                    BUTAVD
N01  C                   KFLD                    BUTUNR
N01  C     heaKey        KLIST
N01  C                   KFLD                    BUOAVD
N01  C                   KFLD                    BUOPD
     C*
     C                   Z-ADD     99            MAXACC            2 0
     C                   Z-ADD     99            MAXAAR            2 0
     C                   Z-ADD     99            MAXMND            2 0
     C                   MOVE      ' '           YNET              1
     C                   MOVE      'Y'           STAT              1
     C*
     C     UBILN         COMP      *BLANKS                                66
     C*
     C     UTYPE         IFNE      *BLANKS
     C                   MOVE      UTYPE         UTYPEN            1 0
     C                   END
     C   66              Z-ADD     1             UAVD              4 0
     C*
     C                   MOVE      UYEAR         UDT1
     C                   MOVE      UMONTH        UDT2
     C                   MOVE      UDAY          UDT3
     C                   MOVE      UDATO0        UDATO             6 0
     C     UHEAD         IFEQ      'J'
     C     HODEK         CHAIN     HODE                               33
     C                   END
     C                   READ      FIRM                                   33
     C*
     C     FIDTFM        IFNE      3
     C                   CALL      'DATFM5'
     C                   PARM                    FIDTFM
     C                   PARM                    UDATO1
     C                   CALL      'DATFM5'
     C                   PARM                    FIDTFM
     C                   PARM                    UDATO2
     C                   CALL      'DATFM3'
     C                   PARM                    FIDTFM
     C                   PARM                    UDATO
     C                   END
     C*
     C     UDATO1        IFEQ      0
     C                   MOVE      *ZEROS        UDAT81            8 0
     C                   ELSE
     C     UDATO1        IFGT      501231
     C     UDATO1        ADD       19000000      UDAT81
     C                   ELSE
     C     UDATO1        ADD       20000000      UDAT81
     C                   END
     C                   END
     C     UDATO2        IFEQ      0
     C                   MOVE      *ZEROS        UDAT82            8 0
     C                   ELSE
     C     UDATO2        IFGT      501231
     C     UDATO2        ADD       19000000      UDAT82
     C                   ELSE
     C     UDATO2        ADD       20000000      UDAT82
     C                   END
     C                   END
     C                   MOVE      '01'          UDAT81
     C                   MOVE      '31'          UDAT82
N01  c                   movel     Udat82        TILPER6           6 0
      * FRA DATO
     C                   MOVE      UDATO1        UDATOX
     C                   MOVE      UDT1X         UDT3F
     C                   MOVE      UDT2X         UDT2F
     C                   MOVE      UDT3X         UDT1F
      * TIL DATO
     C                   MOVE      UDATO2        UDATOX
     C                   MOVE      UDT1X         UDT3T
     C                   MOVE      UDT2X         UDT2T
     C                   MOVE      UDT3X         UDT1T
     C*
     C* HENTER NØDVENDIGE STARTDATA
     C*
     C*
     C  N66              DO
     C                   MOVEL     UDAT81        UTUDT
     C     TURKE2        SETLL     TURER21
     C     NESTE         TAG
     C     UBILN         READE     TURER21                                32
     C  N32TUDT          COMP      UDAT82                             32
     C  N32TRANKE        CHAIN     TRAN                               33
     C* SKIPP TURER UTEN GYLDIG TRANSPORTØR (SPEDISJON??)
     C  N32
     CAN 33              GOTO      NESTE
     C                   END
     C                   ENDSR
     C*****************************************************************
     C     SUM1          BEGSR
     C*****************************************************************
     C                   setoff                                       61
     C     TRAVVK5       KLIST
     C                   KFLD                    TUAVD
     C                   KFLD                    TUPRO
     C                   KFLD                    TVSTK
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   MOVE      ' '           TVSTK             1
     C     TRAVVK5       SETLL     TRAVV5
     C     LESFAK        TAG
     C     TRAVVK5       READE     TRAVV5                                 61
     C     *IN61         IFEQ      *OFF
      * TYPE A/B
     C     TVTYP         IFEQ      'A'
     C     TVTYP         OREQ      'B'
     C     TVBLLB        SUB       TVBLL         DIFF              9 0
     C     VMINCR        IFNE      2
     C     TUTAKO        IFNE      'A'
     C                   add       DIFF          WTOTB
     C                   end
     C                   end
     C                   ADD       TVBLLB        WTOTA
     C     TUTAKO        IFNE      'A'
     C                   ADD       TVBLL         WTOTE
     c                   end
     C                   ENDIF
      * TYPE C/D
     C     TVTYP         IFEQ      'C'
     C     TVTYP         OREQ      'D'
     C     TVBLLB        SUB       TVBLL         DIFF              9 0
     C     VMINCR        IFNE      2
     C     TUTAKO        IFNE      'A'
     C                   add       DIFF          WTOTB
     c                   end
     c                   end
     C                   ADD       TVBLLB        WTOTC
     C     TUTAKO        IFNE      'A'
     C                   ADD       TVBLL         WTOTE
     c                   end
     C                   ENDIF
      * TYPE E/F
     C     TVTYP         IFEQ      'E'
     C     TVTYP         OREQ      'F'
     C     TVBLLB        SUB       TVBLL         DIFF              9 0
     C     VMINCR        IFNE      2
     C     TUTAKO        IFNE      'A'
     C                   add       DIFF          WTOTB
     c                   end
     c                   end
     C                   ADD       TVBLLB        WTOTD
     C     TUTAKO        IFNE      'A'
     C                   ADD       TVBLL         WTOTE
     c                   end
     C                   ENDIF
     C                   GOTO      LESFAK
     C                   ENDIF
      *
     C                   ENDSR
     C*****************************************************************
     C     SUM2          BEGSR
     C*****************************************************************
     C* leser alle oppdrag på aktuell tur
      *
     C     TUPRO         SETLL     HEAD11
     C     TUPRO         READE     HEAD11                                 33
     C     *IN33         DOWEQ     '0'
     C     hest          ifne      'S'
     C                   MOVE      *ZEROS        WTOTA             8 0
     C                   MOVE      *ZEROS        WTOTB             8 0
     C                   MOVE      *ZEROS        WTOTC             8 0
     C                   MOVE      *ZEROS        WTOTD             8 0
     C                   MOVE      *ZEROS        WTOTE             8 0
     C                   EXSR      SUM1
     C                   Z-ADD     HENT          HHENT
     C                   Z-ADD     HEFBV         HHEFBV
     C                   Z-ADD     WTOTA         HEA
     C                   Z-ADD     WTOTB         HEB
     C                   Z-ADD     WTOTC         HEC
     C                   Z-ADD     WTOTD         HED
     C                   Z-ADD     WTOTE         HEE
      *
      * BEHANDLING VED AVTALT PRIS
      *
     C* SKRIV *AVTALT* DERSOM AVREGNET BELØP = AVTALT
     C                   setoff                                       55
     C     TUTAKO        IFEQ      'A'
     C                   seton                                        55
     c                   move      *zeros        brutto
     c                   exsr      sumfak
     c                   Z-add     brutto        HEA
     c                   end
     C*
     C     ANTL          IFGT      57
     C     UHEAD         IFEQ      'J'
     C     UHEAD         OREQ      'Y'
     C                   ADD       1             WSIDE
n05  c     epost         ifne      'J'
     C                   WRITE     HEADP
n05  c                   end
     C                   Z-ADD     9             ANTL
     C                   ELSE
     C                   ADD       1             WSIDE
n05  c     epost         ifne      'J'
     C                   WRITE     HEAD0
n05  c                   end
     C                   Z-ADD     5             ANTL
     C                   END
     C                   END
     C*
     C                   Z-ADD     HEKNS         HHEKNS
     C                   MOVEL     HENAS         HHENAS
      *
     C                   MOVEL     *BLANKS       WFRA
     C                   MOVEL     *BLANKS       WTIL
     C                   MOVEL     HELKA         WLAND
     C                   MOVEL     HESDF         WSTED
     C     STED2KY       CHAIN     STED2D                             44
     C     *IN44         IFEQ      *OFF
     C                   MOVEL     ST2NVN        WFRA
     C                   ENDIF
     C                   MOVEL     HETRI         WLAND
     C                   MOVEL     HESDT         WSTED
     C     STED2KY       CHAIN     STED2D                             44
     C     *IN44         IFEQ      *OFF
     C                   MOVEL     ST2NVN        WTIL
     C                   ENDIF
      *
n05  c     epost         ifne      'J'
     C                   WRITE     DETHE
n05  c                   end
     C                   ADD       1             ANTL
     c                   end
     C     TUPRO         READE     HEAD11                                 33
     C                   END
      *
     C                   ENDSR
     C***********************************************
     C     BRUSR         BEGSR
     C***********************************************
     C                   SETOFF                                       33
     C                   MOVE      *ZEROS        BRUTTO
     C     TUPRO         SETLL     HEAD11
     C     *IN33         DOWEQ     '0'
     C     TUPRO         READE     HEAD11                                 33
     C     *IN33         IFEQ      '0'
     C                   EXSR      SUMFAK
     C                   END
     C                   END
     C                   ENDSR
     C***********************************************
     C     SUMFAK        BEGSR
     C***********************************************
     C     FAKEY         KLIST
     C                   KFLD                    heavd
     C                   KFLD                    heopd
     C     KODGEK        KLIST
     C                   KFLD                    YGEUNI
     C                   KFLD                    FAVK
     C                   MOVE      'GE'          YGEUNI            2
     C                   SETOFF                                       34
     C     FAKEY         SETLL     FAKT
     C     *IN34         DOWEQ     '0'
     C     FAKEY         READE     FAKT                                   34
     C     *IN34         IFEQ      '0'
      *
     C     FAOPKO        IFNE      'D'
     C     FASK          IFEQ      'S'
     C     FASK          OREQ      'K'
     C     FASK          OREQ      'X'
      *
      * INNTEKTER
     C     KODGEK        CHAIN     KODTGE                             35
     C   35              MOVE      ' '           KGEAVR
     C*
     C     FAKDA         IFNE      'K'
     C     KGEAVR        ANDEQ     'T'                                           2<-B
     C                   ADD       FABELN        Brutto
     C                   END
     C                   END
     C                   END
      *
     C                   END
     C                   END
     C                   ENDSR
     C*
