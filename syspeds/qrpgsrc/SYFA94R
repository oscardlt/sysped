********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 for de som øsnker kan eksternref tastes
10172 * 02 SH  PTF10 norsk text til Track and trace
      * 03 jov PTF10 Spre POD på oppdrag i DUP-kjeden
      * 04 jov PTF10 POD på Oppdrag- oppdaterer ogsp TRACKT-ATA om den er 0
      * 05 jov PTF10 OPPDATER ATA -> TRSDTD
      * 06 sh  PTF10 skriv også tle til FRISOK
      * 07 sh  PTF10 skriv ITK til trackfr
      * 08 JOV Ikke 'S' på dup-oppdrag
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11062 * 09 YBC TEST DATO FORMAT
********************************************************************
      *
      *
      *****************************************************************
      * PROGRAM FOR Å KVITTERE AV GODS FOR MOTTATT/LEGGE LØPENR M.M ***
      * DERSOM FAKTURA INNEHOLDER ÅPEN LINJE MED DAGGEBYR (LAGERLEIE)**
      * KALKULERES LAGERLEIE - DERSOM LINJA INGÅR I GR.LAG UTLPROV   **
      * TILBYS DEFAULT REKALKULERING AV UTLPROV (MEN KAN SI "N")     **
      * OBS ! SOM FORUTSETNING TATT AT AVTALE ER I LOKAL VALUTA
      *       DERSOM BRUTTO - SJEKK KUN TABELL NR 1
      *****************************************************************
      *
     FEDIM4     IF   E           K DISK
     FSYFA94FM  CF   E             WORKSTN
     FFIRM      IF   E           K DISK
     FHEADF     UF   E           K DISK
     FHEAD11    UF   E           K DISK
     F                                     RENAME(HEADFR:HEADFR11)
     FTurer14   IF   E           K DISK
     FSADH      UF   E           K DISK
     FDOKUF     UF   E           K DISK
     FKODTA     IF   E           K DISK
     FTRACKL02  UF A E           K DISK
N04  FTRACKT    UF   E           K DISK
     FFAKT      UF A E           K DISK
     FFAK4      UF   E           K DISK
     F                                     RENAME(FAKTR:FAKTR4)
     FFRISOK    UF A E           K DISK
N01  FFRISOL01  IF   E           K DISK
N01  F                                     RENAME(frisokr:frisokl)
     FKODFRI    IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FVALUL01   IF   E           K DISK
     FPRIK      IF   E           K DISK
     FPRIK1     IF   E           K DISK
     F                                     RENAME(PRIKR:PRIKR1)
     FPRIS      IF   E           K DISK
      *
     D                SDS
     D  ZJOB                 244    253
     D  ZUSER                254    263
     D  ZJOBNR               264    269  0
      *
     D TABA            S              2  0 DIM(12) CTDATA PERRCD(1)
     D TABB            S              3  0 DIM(12) ALT(TABA)
     D                 DS
     D  HXSNDN                 1     20
     D  HXSND3                 1      3
     D  HXSND17                4     20
N03  D                 DS
n03  D  DUP                    1   1100  0
n03  D                                     DIM(100)
N03  D                 DS
n08  D  DSl                    1    200                                         Array TRSLAG
n08  D                                     DIM(100)
N08  D                 DS
N03  D  AvdOpd                 1     11  0
n03  D   DsAvd                 1      4  0
n03  D   DsOpd                 5     11  0
     D                 DS
     D  DFMÅL                  1     17
     D  DFDTMO                 1      8
     D  DFKLMO                 9     12
     D  DFSGM                 13     17
     D                 DS
     D  XPOS1                  1      4  0
     D  POSDAG                 1      2  0
     D  POSMND                 3      4  0
     D                 DS
     D  HEDTÅ                  1      4  0
     D  HEDTM                  5      6  0
     D  HEDTD                  7      8  0
     D  HEDTOP                 1      8  0
     D                 DS
     D  WDT                    1      6  0
     D  WDTM                   3      4  0
     D  WDTD                   1      2  0
N06  D                 DS
N06  D  ZIDTG                  1     10
N06  D  ZIAA                   1      4
N06  D  ZIMM                   5      6
N06  D  ZIDD                   7      8
N06  D                 DS
N06  D  ZIDTG6                 1      6  0
N06  D  ZIDDI                  1      2  0
N06  D  ZIMMI                  3      4  0
N06  D  ZIAAI                  5      6  0
     D                 DS
     D  XDT8                   1      8  0
     D  XDT8Å                  1      4  0
     D  XDT8M                  5      6  0
     D  XDT8D                  7      8  0
     D                 DS
     D  XDT                    1      6  0
     D  XDTD                   1      2  0
     D  XDTM                   3      4  0
     D  XDTÅ                   5      6  0
     D                 DS
     D  HEDTMO                 1      8
     D  HDTMOA                 1      2
     D  HDTMOB                 3      4
     D  HDTMOC                 5      6
     D  HDTMOD                 7      8
     D                 DS
     D  YKNR                   1      8
     D  YAVTN                  9      9
     D  YGEBY                 10     12
     D  YKEY2                  1     12
     D                 DS
     D  PKPPR                  1      5  0
     D  PRANT                  1      5  0
     D                 DS
     D  PKKOLL                 1      1
     D  PRKOLL                 1      1
     D                 DS
     D  YTNR                   1      1
     D  YVK                    2      4
     D  YKEY                   1      4
     D                 DS
     D  DSFRI                  1     35
     D  ZETLL                  1     10
N06  D                 DS
N06  D  DSFRIE                 1     35
N06  D  ZETLE                  1      6
     D                 DS
     D  PRTNR                  1      1
     D  PRGEBY                 2      4
     D  PRKEY                  1      4
     D                 DS
     D  PKKNR                  1      8
     D  PKAVTN                 9      9
     D  PKGEBY                10     12
     D  PKKEY2                 1     12
     D                 DS
     D  SYMINU                 1      4  2
     D  XUTLMI                 1      2  0
     D                 DS
     D  TTTXTA                 1     70
     D  TXDATE                 1      5
     D  XXDTMO                 7     14
     D  TXTIME                17     19
     D  ZEKLMO                21     24
     D  TXBY                  27     29
     D  ZESGM                 31     40
     D                 DS
     D  TTTXTB                 1     70
     D  TTRTXT                 1     18
     D  TTDTG                 21     30
     D  TTDTG8                21     28
     D  TTDTGA                21     22
     D  TTDTGB                28     28
     D  TTDTGC                29     30
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D  XULDDMM                7     10  0
     D  XULÅÅ2                13     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
s02  D*RUCTXT          C                   CONST('RUCK ATTEST. DATO:')
n02  D RUCTXT          C                   CONST('RUCK ATTEST. DATE:')
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
     C     *ENTRY        PLIST
     C                   PARM                    UAVD              4
     C                   PARM                    UOPD              7
      *_________
      * Workfelt
      *"""""""""
     C                   MOVE      'A'           WAUNI             1
     C                   MOVE      *ZEROS        XDT8
     C                   Z-ADD     0             ÅDTÅ              1 0
     C                   Z-ADD     0             ÅDGR              3 0
     C                   MOVE      'A'           YKOAUN            1
     C                   MOVE      *ZEROS        YKOAAV            4 0
     C                   MOVE      *ZEROS        SYMINU
     C                   MOVE      'M'           YST               1
     C*                    MOVE ' '       YSK     1
     C                   MOVE      *ZEROS        YKNR              8
     C                   MOVE      *BLANKS       YFRAN             3
     C                   MOVE      *BLANKS       YOPDT             2
     C                   MOVE      *BLANKS       YAVTN             1
     C                   MOVE      *BLANKS       YGEBY             3
     C                   MOVE      *BLANKS       YAVTT             1
     C                   MOVE      *ZEROS        YINT              5 0
     C                   MOVE      *BLANKS       YTNR              1
     C                   MOVE      *BLANKS       YVK               3
     C                   MOVE      *ZEROS        YINTR             5 0
     C                   MOVE      *ZEROS        YLNR              4 0
     C                   MOVE      *BLANKS       XAKDM             1
N07  C                   MOVE      *zeros        ZIDTG6
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     TVIM4K        KLIST
     C                   KFLD                    XSR1
     C                   KFLD                    ZEAVD
     C                   KFLD                    ZEOPD
     C                   MOVE      'R'           XSR1              1
     C     KEYA          KLIST
     C                   KFLD                    ZEAVD
     C                   KFLD                    ZEOPD
     C     KEYB          KLIST
     C                   KFLD                    WAUNI
     C                   KFLD                    ZEAVD
     C     DOKKEY        KLIST
     C                   KFLD                    DFRI
     C                   KFLD                    ZEAVD
     C                   KFLD                    ZEOPD
     C                   MOVE      'F'           DFRI
N04  C     TRACKTK       KLIST
N04  C                   KFLD                    TTAVD
N04  C                   KFLD                    TTOPD
     C     TTKEY         KLIST
     C                   KFLD                    ZEAVD
     C                   KFLD                    ZEOPD
     C                   KFLD                    XXFBNR
     C                   KFLD                    XXACTI
     C     *LIKE         DEFINE    TTFBNR        XXFBNR
     C     *LIKE         DEFINE    TTACTI        XXACTI
     C                   MOVE      *ZEROS        XXFBNR
     C                   MOVE      'RUC'         XXACTI
     C     FAKTK         KLIST
     C                   KFLD                    FAAVD
     C                   KFLD                    FAOPD
     C                   KFLD                    FALI
     C     FAK4K         KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     FRIKEY        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    FSKODE            3
     C                   MOVE      'TLØ'         FSKODE
     C     FRIKEY1       KLIST
     C                   KFLD                    FSKODE1           3
     C                   KFLD                    ZEEXT
     C                   MOVE      '*CR'         FSKODE1
     C     KUND1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C     HEADFK        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     HEAD1K        KLIST
     C                   KFLD                    KOAAVD
     C                   KFLD                    YST
     C     VALU1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    FAVAL
     C     KOAKEY        KLIST
     C                   KFLD                    YKOAUN
     C                   KFLD                    YKOAAV
     C     PRIKK         KLIST
     C                   KFLD                    YKNR
     C                   KFLD                    YAVTN
     C                   KFLD                    YGEBY
     C                   KFLD                    YAVTT
     C                   KFLD                    YINT
     C                   KFLD                    YLNR
     C     PRIK1K        KLIST
     C                   KFLD                    YKNR
     C                   KFLD                    YFRAN
     C                   KFLD                    YOPDT
     C                   KFLD                    YAVTN
     C                   KFLD                    YGEBY
     C                   KFLD                    YLNR
     C     PRIKEY        KLIST
     C                   KFLD                    YTNR
     C                   KFLD                    YVK
     C                   KFLD                    YINTR
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Endre melding                                        SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
      *________
      * Bilde-1
      *""""""""
     C     SRB1          TAG
     C                   SETON                                        55
     C  N30              MOVE      'SY00000'     ZMSGNO
     C  N30ZEAVD         IFNE      *ZEROS
     C                   SETOFF                                       313255
     C                   END
     C     UAVD          IFEQ      '0000'
     C                   WRITE     BILDE3
     C                   EXFMT     BILDE1
     C                   MOVEA     '000'         *IN(30)
     C     *IN03         CABEQ     '1'           SRB9
     C     *IN12         CABEQ     '1'           SRB9
     C                   MOVE      *OFF          *IN45
N01  c     ZEEXT         IFNE      *blanks
N01  c     FRIKEY1       CHAIN     FRISOL01                           33
N01  C  N33              MOVE      FSAVD         ZEAVD
N01  C  N33              MOVE      FSOPD         ZEOPD
N01  C                   END
     C                   ELSE
     C                   MOVE      UAVD          ZEAVD
     C                   MOVE      UOPD          ZEOPD
     C                   MOVE      *ON           *IN45
     C                   ENDIF                                                  <UAVD
      * Negativt oppdr-nr = tur
     C     ZEOPD         IFLT      0
     C     ZEOPD         mult      -1            TMPPro9          11 0
     C                   MOVEL     UAVD          TMPPro9
     C                   MOVE      TMPPro9       ZEPRO
     C     ZEPRO         Chain     TURER14                            33
     C                   movel     TUNAT         ZESGM
     C                   TIME                    XULTID
     C                   MOVEL     XULDDMM       ZEDTMO
     C                   MOVE      XULÅÅ2        ZEDTMO
     C                   MOVEL     XULTM         ZEKLMO
     C                   GOTO      SRB2
     C                   end
      * Teste Avdeling.
     C     KEYB          CHAIN     KODTA                              30
     C     *IN30         IFEQ      '1'
     C                   MOVE      '1'           *IN31
     C                   MOVE      'SPA0001'     ZMSGNO
     C                   GOTO      SRB1
     C                   END
      *
      * Finnes oppdrag ?
     C     KEYA          CHAIN     HEADF                              30
     C  N30              UPDATE    HEADFR
     C  N30KEYA          CHAIN     SADH                               51
     C  N30
     CANN51              UPDATE    SADHR
     C     *IN30         IFEQ      '1'
     C                   MOVEA     '01'          *IN(31)
     C                   MOVE      'SPO0001'     ZMSGNO
     C                   GOTO      SRB1
     C                   END
     C                   MOVE      *BLANKS       ZETLE
     C                   MOVE      *BLANKS       ZETLL
      * Ok !, flytte data
      *
      * TEST OM DET HAR FÅTT TOLLKVITTERING
      * SETTER DA PÅ IND 97
     C                   SETOFF                                       97
     C     TVIM4K        SETLL     EDIM4                              98
     C     *IN98         DOWEQ     '0'
     C     TVIM4K        READE     EDIM4                                  98
     C  N98M1N07         IFEQ      'DTK'
     C     M1N07         OREQ      'DUA'
     C                   move      sitll         zetll
     c                   move      sitle         zetle
     C                   SETON                                        9798
     C                   END
     C  N98              ENDDO
      *
     C                   MOVE      HESGM         ZESGM
     C                   MOVEL     HESGM         ZESGML           10
     C                   MOVE      HEKLMO        ZEKLMO
     C     HEDTMO        IFNE      '000000  '
     C     HEDTMO        ANDNE     *ZEROS
     C     HEDTMO        ANDNE     *BLANKS
     C     HDTMOD        IFEQ      '  '
     C                   MOVEL     HEDTMO        ZEDTMO                           GML DDMMÅÅ
     C                   ELSE                                                     N:ÅÅÅÅMMDD
     C                   MOVE      HDTMOB        XDTÅ
     C                   MOVE      HDTMOC        XDTM
     C                   MOVE      HDTMOD        XDTD
     C                   MOVE      XDT           ZEDTMO                             DDMMÅÅ
     C                   END
     C                   END
     C     HEKLMO        IFNE      0
     C                   MOVE      HEKLMO        ZEKLMO
     C                   END
     C     HETLE         IFNE      *ZEROS
     C     HETLE         ANDNE     *BLANKS
     C                   MOVE      HETLE         ZETLE
     C                   END
     C     HETLL         IFNE      *ZEROS
     C     HETLL         ANDNE     *BLANKS
     C                   MOVE      HETLL         ZETLL
     C                   END
     C     ZETLL         IFEQ      *ZEROS
     C                   MOVE      *BLANKS       ZETLL
     C                   END
     C                   MOVE      HETLKU        ZETLKU
     C                   MOVE      SIDTG         ZIDTG
N06  C                   MOVE      ZIDD          ZIDDI
N06  C                   MOVE      ZIMM          ZIMMI
N06  C                   MOVE      ZIAA          ZIAAI
     C     ZIDTG         IFEQ      *BLANKS
     C     TTKEY         CHAIN(N)  TRACKL02                           52
     C     *IN52         IFEQ      '0'
     C                   MOVEL     TTTEXT        TTTXTB
s07  C*                  MOVE      TTDTG         ZIDTG
N07  C                   MOVEL     TTDATE        ZIDTG
N06  C                   MOVE      ZIDD          ZIDDI
N06  C                   MOVE      ZIMM          ZIMMI
N06  C                   MOVE      ZIAA          ZIAAI
     C                   END
     C                   END
     C                   MOVE      HEGNN         ZEGNN
     C                   MOVEA     '00000000'    *IN(30)
     C                   SETOFF                                       55
      * BEVAR GAMMEL
     C                   MOVEL     ZEDTMO        ZEDTGM            6
     C                   MOVEL     ZEKLMO        ZEKLGM            4
      *
     C     ZEDTMO        IFNE      *BLANKS
     C     ZETLE         ANDEQ     *BLANKS
     C                   SETON                                        55
     C                   END
      *________
      * Bilde-2
      *""""""""
     C     SRB2          TAG
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     BILDE3
     C     ZEPRO         IFEQ      *ZEROS
     C                   EXFMT     BILDE2
     C                   else
     C                   EXFMT     BILDE2T
     C                   end
     C                   MOVEA     '00000000'    *IN(30)
N09   *
N09  C                   IF        ZIDTG6 <> *ZEROS
N09  C                   MOVE      ZIDDI         UDD
N09  C                   MOVE      ZIMMI         UMM
N09  C                   MOVE      ZIAAI         UAA
N09  C                   CALL      'TESTDATO'
N09  C                   PARM                    UDD               2 0
N09  C                   PARM                    UMM               2 0
N09  C                   PARM                    UAA               2 0
N09  C                   PARM                    FLAGG             1 0
N09  C     FLAGG         COMP      1                                      36
N09  C   36              EVAL      *IN30 = *ON
N09  C   36              GOTO      SRB2
N09  C                   END
N09   *
N06  C                   MOVE      '2000'        ZIAA
N06  C                   MOVE      ZIDDI         ZIDD
N06  C                   MOVE      ZIMMI         ZIMM
N06  C                   MOVE      ZIAAI         ZIAA
     C     *IN03         CABEQ     '1'           SRB9
     C     *IN12         CABEQ     '1'           SRB1
      * Signatur og dato må begge vare blanke eller utfyllte.
     C     ZESGM         IFEQ      *BLANKS
     C     ZEDTMO        IFNE      *BLANKS
     C                   MOVE      '1'           *IN30
     C                   END
     C                   ELSE
     C     ZEDTMO        IFEQ      *BLANKS
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
     C     *IN30         IFEQ      '1'
     C                   MOVEA     '11'          *IN(31)
     C                   MOVE      'SPS0015'     ZMSGNO
     C                   GOTO      SRB2
     C                   END
      * Teste dato, hvis utfyllt.
     C     ZEDTMO        IFNE      *BLANKS
     C                   MOVE      ZEDTMO        WDT
     C     WDTM          COMP      1                                    30
     C  N30WDTM          COMP      12                                 30
     C  N30WDTD          COMP      1                                    30
     C  N30WDTD          COMP      31                                 30
     C     *IN30         IFEQ      '1'
     C                   MOVEA     '01'          *IN(31)
     C                   MOVE      'SPD0001'     ZMSGNO
     C                   GOTO      SRB2
     C                   END
     C                   END
      * Eksp.sted og løpenr må begge vare blanke eller utfyllte.
     C     ZETLE         IFEQ      *BLANKS
     C     ZETLL         IFNE      *BLANKS
     C                   MOVE      '1'           *IN30
     C                   END
     C                   ELSE
     C     ZETLL         IFEQ      *BLANKS
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
     C     *IN30         IFEQ      '1'
     C                   MOVEA     '11'          *IN(33)
     C                   MOVE      'SPE0001'     ZMSGNO
     C                   GOTO      SRB2
     C                   END
      * Kan utf må vare blank eller X.
     C     ZETLKU        IFNE      *BLANKS
     C     ZETLKU        ANDNE     'X'
     C                   MOVEA     '100001'      *IN(30)
     C                   MOVE      'SPK0016'     ZMSGNO
     C                   GOTO      SRB2
     C                   END
      *
      *
      *
     C* FØRST DATOKONVERTERING -> XDT8 ER RESULTATET
     C                   MOVEL     ZEDTMO        XDT
     C     XDTÅ          IFGT      50
     C     XDTÅ          ADD       1900          XDT8Å
     C                   ELSE
     C     XDT           IFNE      *ZEROS
     C     XDTÅ          ADD       2000          XDT8Å
     C                   END
     C                   END
     C                   MOVE      XDTM          XDT8M
     C                   MOVE      XDTD          XDT8D
     C                   MOVE      *ZEROS        ANTFBR            3 0
     C                   MOVE      *OFF          *IN50
      * Merking alle på tur...
     C     ZEPRO         IFNE      *ZEROS
     C                   exsr      MrkTur
     C                   goto      SRB9
     C                   end
      *
      * VED MERKING MOTATT - FINS DET ETT OG BARE ETT F.BREV...
     C     ZESGM         IFNE      *BLANKS
     C     ZESGM         ANDNE     ZESGML
     C     DOKKEY        SETLL     DOKUF
     C     DOKKEY        READE(N)  DOKUF                                  33
     C     *IN33         DOWEQ     '0'
     C                   ADD       1             ANTFBR
     C     DOKKEY        READE(N)  DOKUF                                  33
     C                   END
     C*
     C     ANTFBR        IFGT      1
     C                   MOVE      *ON           *IN50
     C                   Z-ADD     XDT8          UDTMO             8 0
     C                   MOVE      ZEKLMO        UKLMO             4 0
     C                   MOVE      *blanks       UBREF            17
     C                   CALL      'SYFA94RB'
     C                   PARM                    ZEAVD
     C                   PARM                    ZEOPD
     C                   PARM                    ZESGM
     C                   PARM                    UDTMO
     C                   PARM                    UKLMO
     C                   PARM                    UBREF
     C                   END
     C*
     C     ANTFBR        IFEQ      1
     C     DOKKEY        CHAIN     DOKUF                              33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     ZESGM         DFSGM
     C                   MOVEL     XDT8          DFDTMO
     C                   MOVEL     XDT8          XXDTMO
     C                   MOVEL     ZEKLMO        DFKLMO
     C                   MOVEL     XDT8          HEDTMO
     C                   MOVEL     ZEKLMO        HEKLMO
     C                   UPDATE    DOKUFR
     C                   EXSR      TTSR
     C                   END
     C                   END
     C                   END
      *
      * Oppdatere record:
     C                   MOVE      *ZEROS        DFFBNR
     C     KEYA          CHAIN     HEADF                              30
     C  N30KEYA          CHAIN     SADH                               51
     C  N50              MOVE      ZESGM         HESGM
     C                   MOVEL     ZEDTMO        XDT
     C     XDTÅ          IFGT      50
     C     XDTÅ          ADD       1900          XDT8Å
     C                   ELSE
     C     XDT           IFNE      *ZEROS
     C     XDTÅ          ADD       2000          XDT8Å
     C                   END
     C                   END
     C                   MOVE      XDTM          XDT8M
     C                   MOVE      XDTD          XDT8D
     C  N50              MOVEL     XDT8          HEDTMO
     C  N50              MOVEL     XDT8          XXDTMO
     C                   MOVE      ZETLE         HETLE
     C                   MOVE      ZETLL         HETLL
     C     ZETLE         IFNE      *ZEROS
     C     ZETLL         ANDNE     *ZEROS
     C     ZETLE         ANDNE     *BLANKS
     C     ZETLL         ANDNE     *BLANKS
     C                   MOVE      ZETLE         SITLE
     C                   MOVE      ZETLL         SITLL
      *
      * tollvesenets løpenummer
      *
N01  C                   MOVE      'TLØ'         FSKODE
     C     FRIKEY        CHAIN     FRISOK                             77
     C                   MOVE      DSFRI         FSSOK
     C  N77              UPDATE    FRISOKR
     C   77FSKODE        CHAIN     KODFRI                             33
     C   77              IF        *IN33 = *OFF
     C                   MOVE      KFSODK        FSDOKK
     C                   END
     C   77              MOVE      HEAVD         FSAVD
     C   77              MOVE      HEOPD         FSOPD
     C   77              MOVE      HEDTOP        FSDTOP
     C   77              WRITE     FRISOKR
      *
      * tollvesenets EKSPEDISJONSSTED
      *
N06  C                   MOVE      'TLE'         FSKODE
N06  C     FRIKEY        CHAIN     FRISOK                             77
N06  C                   MOVE      DSFRIE        FSSOK
N06  C  N77              UPDATE    FRISOKR
N06  C   77FSKODE        CHAIN     KODFRI                             33
N06  C   77              IF        *IN33 = *OFF
N06  C                   MOVE      KFSODK        FSDOKK
N06  C                   END
N06  C   77              MOVE      HEAVD         FSAVD
N06  C   77              MOVE      HEOPD         FSOPD
N06  C   77              MOVE      HEDTOP        FSDTOP
N06  C   77              WRITE     FRISOKR
      *
      * skriver ITK til track and trace
      *
N07  C                   EXSR      TTSR3
     C                   END
     C                   MOVE      ZETLKU        HETLKU
N09  C                   IF        ZIDTG <> '20000000'
     C                   MOVE      ZIDTG         SIDTG
N09  C                   END
     C                   MOVE      ZEGNN         HEGNN
     C  N50              MOVE      ZEKLMO        HEKLMO
     C     HEDTMO        IFEQ      *ZEROS
     C                   MOVE      *BLANKS       HEDTMO
     C                   END
     C                   UPDATE    HEADFR
     C  N50FIURBL        IFEQ      'J'
     C     ZESGM         ANDNE     *BLANKS
     C                   EXSR      TTSR
     C                   END
      * RUCK-ATTEST...
     C     ZEGNN         IFNE      *BLANKS
     C     ZIDTG         ANDNE     *BLANKS
     C                   EXSR      TTSR2
     C                   END
     C  N51              UPDATE    SADHR
     C*
     C* F20 ER OVER TIL FAXSYSTEM
     C*
     C   20
     COR 21              DO
     C   21              MOVE      'M'           FAXTYP            1
     C   20              MOVE      'A'           FAXTYP
     C                   MOVE      ' '           FAXPA2            1
     C                   MOVE      HEKNA         FAXKUN            8 0
     C                   MOVE      'A'           FAXPAR            1
     C                   CALL      'FAX010CL'
     C                   PARM                    FAXKUN
     C                   PARM                    ZEAVD
     C                   PARM                    ZEOPD
     C                   PARM                    FAXTYP
     C                   PARM                    FAXPAR
     C                   PARM                    FAXPA2
     C                   END
      * Per day invoice line??
     C                   EXSR      SRBA
      *  Goto screen 1 for more cinsignments
     C     *IN45         IFEQ      *OFF
     C                   GOTO      SRB1
     C                   ENDIF
      *
     C     SRB9          ENDSR
      *////////////////////////////////////////////////////////////
      *  Oppdatere ant. dager for lagerleie.                 SRBA /
      *////////////////////////////////////////////////////////////
     C     SRBA          BEGSR
      *
     C     HEDTMO        IFGT      '0'                                          1<-B
      *
     C                   MOVEL     HEPOS1        XPOS12            4
     C                   TESTN                   XPOS12               21
     C  N21              MOVE      *ZEROS        XPOS1
     C   21              MOVEL     HEPOS1        XPOS1
      * Dersom fly import benytt pos-feltet som ing. dato
     C     HEUR          IFEQ      'C'                                           2<-B
     C     POSDAG        ANDGT     0
     C     POSDAG        ANDLT     32
     C     POSMND        ANDGT     0
     C     POSMND        ANDLT     13
     C                   MOVE      POSMND        HEDTM
     C                   MOVE      POSDAG        HEDTD
     C                   END                                                     2<-E
      * Regn ut antall dager.
     C     HDTMOD        IFEQ      '  '
     C                   MOVEL     HEDTMO        XDT
     C     XDTÅ          IFGT      50
     C     XDTÅ          ADD       1900          XDT8Å
     C                   ELSE
     C     XDT           IFNE      *ZEROS
     C     XDTÅ          ADD       2000          XDT8Å
     C                   END
     C                   END
     C                   MOVE      XDTM          XDT8M
     C                   MOVE      XDTD          XDT8D
     C                   ELSE
     C                   MOVEL     HEDTMO        XDT8
     C                   END
     C     XDT8Å         SUB       HEDTÅ         ÅDTÅ
     C     ÅDTÅ          MULT      365           ÅDGR
     C     HEDTM         LOOKUP    TABA          TABB                     21
     C   21              SUB       TABB          ÅDGR
     C                   SUB       HEDTD         ÅDGR
     C     XDT8M         LOOKUP    TABA          TABB                     21
     C   21              ADD       TABB          ÅDGR
     C                   ADD       XDT8D         ÅDGR
      * Arrival day is counted too
     C                   ADD       1             ÅDGR
      *
      * Is there any Day based pricelines in the invoice
     C                   SETOFF                                       41
     C     FAK4K         SETLL     FAK4
      *
     C     STLES         TAG
     C     FAK4K         READE(N)  FAK4                                   41
      * Price per day. = D i FA01B
     C  N41FA01B         IFEQ      'D'                                           2<-B
     C     FABELN        ANDEQ     *ZEROS
     C                   EXSR      BFAKT0
     C                   END                                                     2<-E
     C  N41              GOTO      STLES
     C                   END                                                    1<-E
      *
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  REKALKULERE UTLEGGSPROVISJON                        RECALC
      *////////////////////////////////////////////////////////////
     C     RECALC        BEGSR
      *
     C* 99 on indicates that a "per day" line added in the in voice
     C* leads to recalculation of disbursment fee
     C                   SETOFF                                       99
     C*
     C                   MOVE      *ZEROS        UTLGR             9 0
     C                   MOVE      FASK          XXSK              1
     C                   SETOFF                                       41
     C     FAK4K         SETLL     FAK4
     C* SLETT GAMMEL LINJE MED UTLPROV - AKKUMULER NYTT GR.LAG.
     C     STLESU        TAG
     C     FAK4K         READE     FAK4                                   41
     C   41              GOTO      UTLESU
     C     FASK          IFNE      XXSK                                         B1
     C                   UPDATE    FAKTR4
     C                   ELSE                                                   X1
     C*** FJERNER UTLEGGSPOST
     C     FAVK          IFEQ      'UTL'                                          B2
     C                   MOVE      FAKDM         XAKDM             1
     C                   DELETE    FAKTR4
     C                   ELSE                                                     X2
     C                   UPDATE    FAKTR4
     C*** ØKER UTLEGGSGRUNNLAG
     C     FAKDUL        IFEQ      'J'                                              B3
     C                   ADD       FABELN        UTLGR
     C                   END                                                        E3
     C                   END                                                      E2
     C                   END                                                    E1
     C                   GOTO      STLESU
     C*
     C     UTLESU        TAG
     C*
     C                   MOVE      'UTL'         FAVK
     C     UTLGR         MULT      SYUTLP        FABELV
     C     FABELV        DIV(H)    100           FABELN
     C     FABELN        IFLT      XUTLMI                                           B1
     C                   Z-ADD     XUTLMI        FABELN
     C                   END                                                        E1
     C                   Z-ADD     FABELN        FABELV
     C     XAKDM         IFNE      *BLANK                                        B1
     C                   MOVE      XAKDM         FAKDM
     C                   ELSE
     C                   MOVE      'N'           FAKDM
     C                   END                                                     E1
     C                   EXSR      OPDFAK
     C*
     C                   ENDSR
     C******************************************
     C     BFAKT0        BEGSR
     C******************************************
     C* Indicate that a "per day" line added in the in voice
     C* leads to recalculation of disbursment fee
     C     FAKDUL        IFEQ      'J'                                          B1
     C  N99              SETON                                            99
     C     FASK          IFEQ      'S'                                            B2
     C     XS            ANDEQ     ' '
     C                   MOVE      'S'           XS                1
     C                   END                                                      E2
     C     FASK          IFNE      'S'                                            B2
     C     XK            ANDEQ     ' '
     C                   MOVE      FASK          XK                1
     C                   END                                                      E2
     C                   END                                                    E1
     C* INDICATOR FOR THE SCREENFILE- SENDER/CONSIGNEE
     C     FASK          IFEQ      'S'
     C                   SETON                                            98
     C                   ELSE
     C                   SETOFF                                           98
     C                   END
     C*
     C                   MOVE      '1'           YTNR
     C                   MOVE      FICURR        VALKOD
     C                   MOVE      FASK          XSK               1
     C                   MOVE      YTNR          PKTNR
     C                   MOVE      HEFR          YFRAN
     C                   MOVE      HEOT          YOPDT
     C                   MOVE      FAVK          YGEBY
     C                   MOVE      FAVK          YVK
     C     HEVKT         IFGT      99999
     C                   Z-ADD     99999         YINT
     C                   Z-ADD     99999         YINTR
     C                   ELSE
     C                   Z-ADD     HEVKT         YINT
     C                   Z-ADD     HEVKT         YINTR
     C                   END
     C                   MOVE      *BLANKS       PRKOLL
     C*
     C* OBS ! SOM FORUTSETNING TATT AT AVTALE ER I LOKAL VALUTA
     C*       DERSOM BRUTTO - SJEKK KUN TABELL NR 1
     C*
     C*
     C* S E L G E R             F A K T U R E R I N G
     C*
     C     HEKDFS        COMP      'X'                                    33
     C  N33XSK           COMP      'K'                                    33
     C   33              GOTO      VMOTT
     C                   MOVE      *ZEROS        XPROS             9 2
     C                   MOVE      *BLANKS       YAVTT
     C*
     C*    H A R  S E L G E R  A V T A L E
     C*
     C     HEKDFS        IFEQ      ' '
     C                   MOVE      HEKNSF        YKNR
     C                   MOVE      HEANS         YAVTN
     C                   ELSE
     C     HEKDFS        IFEQ      'B'
     C                   MOVE      HEANK         YAVTN
     C     HEKDFK        IFEQ      'E'
     C                   MOVE      HEKNK         YKNR
     C                   ELSE
     C                   MOVE      HEKNKF        YKNR
     C                   END
     C                   ELSE
     C     HEKDFS        IFEQ      'E'
     C                   MOVE      HEKNS         YKNR
     C                   MOVE      HEANS         YAVTN
     C                   END
     C                   END
     C                   END
     C*
     C                   EXSR      AVTSR
     C*
     C* SKJEKKER BRUTTOTARIFF   FOR SELGER
     C*
     C   33              MOVE      'S'           YAVTN
     C   33              EXSR      BRUTAR
     C                   GOTO      UTLI
     C*
     C* K J Ø P E R    F A K T U R E R I N G
     C*
     C     VMOTT         TAG
     C     HEKDFK        COMP      'X'                                    33
     C   33              GOTO      UTLI
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      *BLANKS       YAVTT
     C*
     C*       S K J E K K E R  K J Ø P E R S  A  V T A L E
     C*
     C     HEKDFK        IFEQ      ' '
     C                   MOVE      HEKNKF        YKNR
     C                   MOVE      HEANK         YAVTN
     C                   ELSE
     C     HEKDFK        IFEQ      'B'
     C                   MOVE      HEANS         YAVTN
     C     HEKDFS        IFEQ      'E'
     C                   MOVE      HEKNS         YKNR
     C                   ELSE
     C                   MOVE      HEKNSF        YKNR
     C                   END
     C                   ELSE
     C     HEKDFK        IFEQ      'E'
     C                   MOVE      HEKNK         YKNR
     C                   MOVE      HEANK         YAVTN
     C                   END
     C                   END
     C                   END
     C*
     C                   EXSR      AVTSR
     C*
     C* SKJEKKER BRUTTOTARIFF KJØPER
     C*
     C   33              MOVE      'K'           YAVTN
     C   33              EXSR      BRUTAR
     C*
     C     UTLI          ENDSR
     C*
     C******************************************
     C     BRUTAR        BEGSR
     C******************************************
     C*
     C* H E N T E R   F R A   B R U T T O T A R I F F
     C*
     C                   SETOFF                                       34
     C                   MOVE      '    ALLE'    YKNR
     C                   MOVE      HEFR          YFRAN
     C                   MOVE      HEOT          YOPDT
     C                   MOVE      *BLANKS       YAVTT
     C     PRIK1K        SETLL     PRIK1
     C                   READ      PRIK1                                  34
     C  N34YFRAN         COMP      PKFR01                             3434
     C  N34YOPDT         COMP      PKOT01                             3434
     C  N34YKEY2         COMP      PKKEY2                             3434
     C  N34              MOVEL     PKTNR         YTNR
     C  N34              EXSR      FBELØ
     C*
     C                   ENDSR
     C*
     C******************************************
     C     AVTSR         BEGSR
     C******************************************
     C*
     C                   EXSR      BFAKT
     C*
     C   33              GOTO      AVSRUT
     C*
     C                   EXSR      FBELØ2
     C*
     C     AVSRUT        ENDSR
     C******************************************
     C     BFAKT         BEGSR
     C******************************************
     C*
     C*  Tests that there is at least one valid price line in the price
     C*  agreement system (for a client (AVTSR)
     C*  33 OFF after this subroutine - at least one valid line found.
     C                   SETOFF                                       33
     C* Find first priceline- assumes that ther is only one line
     C* on this key (No testing on outdated lines,includ/omit etc.)
     C     PRIKK         SETLL     PRIK
     C                   READ      PRIK                                   33
     C**
     C  N33YKEY2         COMP      PKKEY2                             3333
     C  N33              MOVEL     PKTNR         YTNR
     C*
     C                   ENDSR
     C*
     C******************************************
     C     FBELØ         BEGSR
     C******************************************
     C*
     C* HENTER DATA FRA BRUTTO TARIFF
     C*
     C                   SETOFF                                       34
     C*
     C* HENTER BRUTTO GEBYR
     C*
     C     PRIKEY        SETLL     PRIS
     C                   READ      PRIS                                   34
     C  N34YKEY          COMP      PRKEY                              3434
     C  N34PRKOLL        IFGT      '0'
     C     PRKOLL        ANDLE     '9'
     C                   MOVE      PRKOLL        JUSTDG            1 0
     C                   SUB       JUSTDG        ÅDGR
     C                   END
     C  N34ÅDGR          COMP      0                                    3434
     C*
     C  N34              EXSR      SRTAB
     C*
     C                   ENDSR
     C*
     C******************************************
     C     FBELØ2        BEGSR
     C******************************************
     C*
     C* KALLES HVIS KUNDEN HAR AVTALE
     C* PROSENT AV BRUTTO ELLER REN BRUTTO
     C                   MOVE      *ZEROS        XPROS
     C     PKAVTT        COMP      'P'                                    34
     C   34              MOVE      PKBELØ        XPROS
     C  N34PKAVTT        COMP      'B'                                    34
     C   34              EXSR      FBELØ
     C     PKAVTT        COMP      'B'                                    34
     C  N34PKAVTT        COMP      'P'                                    34
     C   34              GOTO      UTSTP2
     C*
     C* N Ø K K E L   E R   N Å   T = E G E N   A V T A L E - T A B E L L
     C*
     C                   MOVE      PKGEBY        YGEBY
     C                   MOVE      PKAVTT        YAVTT
     C*
     C* SKAL IKKE HA GEBYR VED X NÅR BRUTTOAVTALE BENYTTES
     C* ELLER VED Y NÅR KALLES FRA REG LINJE
     C*
     C     PKAVTT        COMP      'T'                                3434
     C   34              GOTO      UTSTP2
     C*
     C                   SETOFF                                       34
     C     PRIKK         SETLL     PRIK
     C                   READ      PRIK                                   34
     C*
     C  N34YKEY2         COMP      PKKEY2                             3434
     C  N34PKKOLL        IFGT      '0'
     C     PKKOLL        ANDLE     '9'
     C                   MOVE      PKKOLL        JUSTDG            1 0
     C                   SUB       JUSTDG        ÅDGR
     C                   END
     C  N34ÅDGR          COMP      0                                    3434
     C   34              GOTO      UTSTP2
     C*
     C                   MOVE      PKBELØ        PRBELØ
     C                   MOVE      PKTEGN        PRTEGN
     C                   MOVE      PKJUST        PRJUST
     C                   EXSR      SRTAB
     C*
     C     UTSTP2        ENDSR
     C******************************************
     C     SRTAB         BEGSR
     C******************************************
     C*
     C*
     C* PRICES ARE PR DAY (AND MIGHT IN ADDITION BE PR XXX KGS)
     C                   MULT      ÅDGR          PRBELØ
     C* ADJUSTMENT WITH NUMERIC CONSTAN SUPPOSED TO BE PR DAY TOO
     C                   MULT      ÅDGR          PRJUST
     C*
     C*
     C* PRICE PR XXX KILOS.
     C*
     C     PRANT         IFGT      0
     C* BASEED ON ACTUAL WEIGHT-
     C     PRBELØ        DIV       PRANT         XWORK            15 4
     C     XWORK         MULT      HEVKT         PRBELØ
     C                   ADD       .50           PRBELØ
     C                   MOVE      '000'         PRBELØ
     C                   END
     C* PRICE ADJUSTMENT ON AMOUNT
     C*
     C*
     C     PRTEGN        IFEQ      '-'
     C                   SUB       PRJUST        PRBELØ
     C                   ELSE
     C     PRTEGN        IFEQ      '+'
     C                   ADD       PRJUST        PRBELØ
     C                   END
     C                   END
     C*
     C* PERSENT OF STANDARD RATES
     C*
     C     XPROS         COMP      0                                  35
     C   35PRBELØ        DIV       100           XWORK            15 4
     C   35XWORK         MULT      XPROS         PRBELØ
     C   35              ADD       .5            PRBELØ
     C   35              MOVE      '000'         PRBELØ
     C*
     C                   Z-ADD     PRBELØ        FABELN
     C                   Z-ADD     PRBELØ        FABELV
     C                   EXSR      VALUTA
     C*
     C                   ENDSR
     C*
     C******************************************
     C     VALUTA        BEGSR
     C******************************************
     C                   MOVE      'SY00000'     ZMSGNO
     C                   MOVE      'J'           WSCALC
     C   99FAOPKO        COMP      ' '                                    99
     C* UTLEGSPROV.SATS                                                . rate
     C* FIRMAVALG FOR AVTALEPART (GODSEIER / FAKTURAMOTTAKER)
     C   99FIAVTE        IFEQ      'G'                                          B1
     C* Goodsowner (swapp values in workfields )
     C     HEKNS         IFNE      *ZEROS                                         B2
     C                   MOVE      HEKNS         XAKNSF
     C                   ELSE                                                     X2
     C                   MOVE      HEKNSF        XAKNSF
     C                   END                                                      E2
     C     HEKNK         IFNE      *ZEROS                                         B2
     C                   MOVE      HEKNK         XAKNKF
     C                   ELSE                                                     X2
     C                   MOVE      HEKNKF        XAKNKF
     C                   END                                                      E2
     C                   MOVE      HEKNSF        XAKNS
     C                   MOVE      HEKNKF        XAKNK
     C                   ELSE                                                   X1
     C* Invoicereciever (default)
     C                   MOVE      HEKNS         XAKNS             8 0
     C                   MOVE      HEKNSF        XAKNSF            8 0
     C                   MOVE      HEKNK         XAKNK             8 0
     C                   MOVE      HEKNKF        XAKNKF            8 0
     C                   END                                                    E1
     C* NY UTLEGGSLINJE ER MOT SELGER
     C   99FASK          IFEQ      'S'                                          B1
     C* "B" = BYTT TIL "MOTPARTENS" AVTALE
     C     HEKDFS        IFEQ      'B'                                            B2
     C* "E" = BYTT INNEN SAMME PART                                    fee. rate
     C     HEKDFK        IFEQ      'E'                                              B3
     C                   MOVE      XAKNK         KUNDNR
     C                   ELSE                                                       X3
     C*       HAR IKKE BYTTET INNEN SAMME PART                         ee. rate
     C                   MOVE      XAKNKF        KUNDNR
     C                   END                                                        E3
     C                   ELSE                                                     X2
     C*       HAR IKKE BYTTET TIL "MOTPARTENS" AVTALE
     C* "E" = BYTT INNEN SAMME PART                                    . rate
     C     HEKDFS        IFEQ      'E'                                              B3
     C                   MOVE      XAKNS         KUNDNR
     C                   ELSE                                                       X3
     C*       HAR IKKE BYTTET INNEN SAMME PART                         ee. rate
     C                   MOVE      XAKNSF        KUNDNR
     C                   END                                                        E3
     C                   END                                                      E2
     C                   ELSE                                                   X1
     C* NY UTLEGGSLINJE ER MOT KJØPER
     C* "B" = BYTT TIL "MOTPARTENS" AVTALE
     C     HEKDFK        IFEQ      'B'                                            B2
     C* "E" = BYTT INNEN SAMME PART                                    fee. rate
     C     HEKDFS        IFEQ      'E'                                              B3
     C                   MOVE      XAKNS         KUNDNR
     C                   ELSE                                                       X3
     C*       HAR IKKE BYTTET INNEN SAMME PART                         ee. rate
     C                   MOVE      XAKNSF        KUNDNR
     C                   END                                                        E3
     C                   ELSE                                                     X2
     C*       HAR IKKE BYTTET TIL "MOTPARTENS" AVTALE
     C* "E" = BYTT INNEN SAMME PART                                    . rate
     C     HEKDFK        IFEQ      'E'                                              B3
     C                   MOVE      XAKNK         KUNDNR
     C                   ELSE                                                       X3
     C*       HAR IKKE BYTTET INNEN SAMME PART                         ee. rate
     C                   MOVE      XAKNKF        KUNDNR
     C                   END                                                        E3
     C                   END                                                      E2
     C                   END                                                    E1
     C*
      *
     C     KUND1K        CHAIN     CUNDL01                            48
     C  N48SYUTLP        IFEQ      *ZEROS                                       B1
     C                   MOVE      'B'           FAKDA
     C                   MOVE      FIUPS         SYUTLP            4 2
     C                   MOVE      FIUPM         XUTLMI            2 0
     C                   END                                                    E1
     C     SYUTLP        IFEQ      99.99                                        B1
     C                   MOVE      'A'           FAKDA
     C                   MOVE      *ZEROS        SYUTLP
     C                   END                                                    E1
     C* DERSOM PROVISJONSSATS = 0 - IKKE REKALK
     C   99SYUTLP        COMP      *ZEROS                             9999
     C                   WRITE     BILDE3
     C                   EXFMT     BILDE5
     C                   MOVEA     '00000000'    *IN(30)
     C     FABELN        IFNE      *ZEROS                                        1<-B
      *
     C                   MOVE      FABELN        XBELN            13 2
     C     FAKTK         CHAIN     FAKT                               84
     C                   MOVE      XBELN         FABELN
      *
     C   99WSCALC        COMP      'J'                                    99
     C                   MOVE      FAVAL         XXVAL             3
     C     FAVAL         IFEQ      FICURR                                         2<-B
     C                   Z-ADD     FABELN        FABELV
     C                   ELSE                                                     2
     C     VALU1K        CHAIN     VALUL01                            84
     C  N84VALKU2        IFNE      0                                              3<-B
     C                   Z-ADD     VALKU2        VALKU1
     C                   END                                                      3<-E
     C  N84FABELN        MULT      OMRFAK        XWORK            15 4
     C  N84XWORK         DIV(H)    VALKU1        FABELV
     C                   END                                                     2<-E
     C                   EXSR      DECI
     C                   MOVE      ' '           FAOPKO
     C                   MOVE      'E'           FAKDA
     C                   MOVE      *ZEROS        FAKUNR
     C                   MOVE      *ZEROS        FAFAKT
     C                   MOVE      *ZEROS        FAJOUR
     C                   MOVE      *ZEROS        FACC
     C                   MOVE      *ZEROS        FAÅR
     C                   MOVE      *ZEROS        FAMND
     C                   MOVE      *ZEROS        FADATO
     C                   MOVE      *ZEROS        FADAFF
     C                   MOVE      *ZEROS        FAAVDR
     C                   MOVE      *ZEROS        FABÆR
     C                   MOVE      *ZEROS        FABELU
     C                   MOVE      *ZEROS        FALEVN
     C                   UPDATE    FAKTR
     C                   ELSE                                                    1
     C   99              SETOFF                                           99
     C                   END                                                     1<-E
      * Recalculate dispursm.fee if needed/desired
     C   99              EXSR      RECALC
     C                   ENDSR
     C*
     C******************************************
     C     OPDFAK        BEGSR
     C******************************************
     C* Legg ut ny linje for utleggsprovisjon
     C* FINN NESTE LEDIGE LINJENR - FAKTURALINJER
     C                   MOVE      *ZEROS        FALI
     C                   CALL      'SYGE06'
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    FALI
     C*
     C                   MOVE      *BLANKS       FA01
     C                   MOVE      HEAVD         FAAVD
     C                   MOVE      HEOPD         FAOPD
     C                   MOVE      XSK           FASK
     C                   MOVE      *BLANKS       FAVT
     C                   MOVE      *BLANKS       FA01B
     C                   MOVE      XXVAL         FAVAL
     C                   MOVE      ' '           FAKDUL
     C                   MOVE      ' '           FAKDUK
     C                   MOVE      *ZEROS        FAKUNR
     C                   MOVE      *ZEROS        FAFAKT
     C                   MOVE      *ZEROS        FAJOUR
     C                   MOVE      *ZEROS        FACC
     C                   MOVE      *ZEROS        FAÅR
     C                   MOVE      *ZEROS        FAMND
     C                   MOVE      *ZEROS        FADATO
     C                   MOVE      *ZEROS        FADAFF
     C                   MOVE      *ZEROS        FAAVDR
     C                   MOVE      *ZEROS        FABELU
     C                   MOVE      *ZEROS        FABÆR
     C     FAVAL         IFEQ      FICURR
     C                   Z-ADD     FABELN        FABELV
     C                   ELSE
     C     VALU1K        CHAIN     VALUL01                            84
     C  N84VALKU2        IFNE      0
     C                   Z-ADD     VALKU2        VALKU1
     C                   END
     C  N84FABELN        MULT      OMRFAK        XWORK            15 4
     C  N84XWORK         DIV(H)    VALKU1        FABELV
     C                   END
     C                   EXSR      DECI
     C                   EXCEPT    NYFAKT
     C*
     C                   ENDSR
     C***********************************************
     C     DECI          BEGSR
     C***********************************************
     C     FIDECI        IFEQ      0
     C                   Z-ADD(H)  FABELN        FABEL0           11 0
     C                   Z-ADD     FABEL0        FABELN
     C                   Z-ADD(H)  FABELU        FABEL0           11 0
     C                   Z-ADD     FABEL0        FABELU
     C                   ELSE
     C     FIDECI        IFEQ      1
     C                   Z-ADD(H)  FABELN        FABEL1           12 1
     C                   Z-ADD     FABEL1        FABELN
     C                   Z-ADD(H)  FABELU        FABEL1           12 1
     C                   Z-ADD     FABEL1        FABELU
     C                   END
     C                   END
     C*
     C                   ENDSR
     C***********************************************
     C     TTSR          BEGSR
     C***********************************************
N08  C     KEYA          CHAIN(N)  HEADF                              33
      * INGEN ENDREDE VERDIER... HOPP UT.
     C     ZESGM         IFEQ      ZESGML
     C     ZEDTMO        ANDEQ     ZEDTGM
     C     ZEKLMO        ANDEQ     ZEKLGM
     C                   GOTO      UTTT
     C                   END
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C                   MOVE      DFFBNR        TTFBNR
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      'POD'         TTACTI
     C                   MOVE      ULDT          TTDATL
     C                   MOVE      XULTM         TTTIML
     C                   MOVE      ZUSER         TTUSER
     C                   MOVE      'Date:'       TXDATE
     C                   MOVE      'Ti:'         TXTIME
     C                   MOVE      'By:'         TXBY
     C                   MOVE      TTTXTA        TTTEXT
N02  C                   MOVE      'Dato:'       TXDATE
n02  C                   MOVE      'Ti:'         TXTIME
n02  C                   MOVE      'Av:'         TXBY
n02  C                   MOVE      TTTXTA        TTTEXL
     C                   TESTN                   HEDTMO               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      HEDTMO        TTDATE
     C                   ELSE
     C                   MOVE      TTDATL        TTDATE
     C                   END
     C                   MOVE      *ZEROS        TTTIME
     C                   MOVEL     HEKLMO        TTTIME
     C                   MOVEL     ZESGM         TTNAME
     C                   move      ' '           TTMANU
     C     DFFBNR        ifeq      *zeros
     C                   move      'S'           TTMANU
     C                   end
n08  c     HEUR          IFEQ      'H'
n08  c     TRSLAG        andne     'HO'
n08  C                   move      ' '           TTMANU
N08  c                   endif
     C                   WRITE     TRACKFR
N04   * Actual time of ARRIVAL  i trackt
N04  C     DFFBNR        ifeq      *zeros
N04  c     TRACKTK       chain     Trackt                             33
N04  C     *in33         Ifeq      *OFF
N04  C     TXATAD        Ifeq      *zeros
N04  c                   move      TTDATE        TXATAD
N04  c                   movel     TTTIME        TXATAK                         kun 4 første tegn
N05  C     KEYA          CHAIN     HEADF                              33
N05  C                   IF        HEUR = 'H'
N05  C                   movel     TTDATE        TRSDTD
N05  C                   movel     TTTIME        TRSDTK
N05  C  N33              UPDATE    HEADFR
N05  C                   ENDIF
N04  C                   end
N04  c                   update    tracktr
N04  C                   end
N04  C                   end
      * Dup av... Oppdatere overordnet fraktbrev/oppdrag??
      * distribusjonsoppdrag via transportmodul Innland
     C     HXsnd3        ifeq      '401'
     C     TROPD0        andne     *zeros
     C     DFFBNR        andeq     *zeros
     C                   Z-ADD     XDT8          UDTMO             8 0
     C                   MOVE      ZEKLMO        UKLMO             4 0
     C                   MOVE      HEAVD         XXAVDA            4
     C                   MOVE      HEOPD         XXOPDA            7
     C                   EVAL      UBREF  ='U.op:' + XXAVDA + '/' + XXOPDA
     C                   CALL      'SYFA94RB'
     C                   PARM                    TRAVD0
     C                   PARM                    TROPD0
     C                   PARM                    ZESGM
     C                   PARM                    UDTMO
     C                   PARM                    UKLMO
     C                   PARM                    UBREF
N03  C                   else
N03   * Trmodul annet - dup-kjede
N03  c     HEUR          ifeq      'H'
N03  c                   exsr      AddDup
N03  c                   exsr      DupOppd
N03  C                   endif
     C                   end
     C     UTTT          TAG
     C                   ENDSR
N03
N03   ***********************************************
N03  C     ADDDUP        BEGSR
N03   ***********************************************
N03   * Finn ut om oppdraget er en del av en "DUP-struktur" - legg alle i ARRAY
N03  C     DsHeaKey      KLIST
N03  C                   KFLD                    DsAVD
N03  C                   KFLD                    DsOPD
N03   * FINN TOPP-NIVÅET
N03  C     HEAKY0        KLIST
N03  C                   KFLD                    TRAVD0
N03  C                   KFLD                    TROPD0
N03  C     TROPD0        DOWNE     0
N03  C     HEAKY0        CHAIN     HEADF                              33
N03  C                   ENDDO
N03  C* Legg inn topp-oppdraget som start i array
N03  c                   clear                   DUP
N03  c                   z-add     1             Nr                3 0
N03  c                   movel     heavd         Dup(Nr)
N03  c                   move      heopd         Dup(Nr)
N03  c     1             do        100           Cur               3 0
N03  c     Dup(Cur)      cabeq     *zeros        UtAdd
N03  c                   move      Dup(Cur)      AvdOpd
N03  C     DSHeaKey      CHAIN     HEADF                              33
n08  c                   move      TRSLAG        DSl(Nr)
N03  C  N33TrOpd1        IFNE      *ZEROS
N03  C                   add       1             Nr
N03  c                   movel     TrAvd1        Dup(Nr)
N03  c                   move      TrOpd1        Dup(Nr)
N03  C                   ENDIF
N03  C  N33TrOpd2        IFNE      *ZEROS
N03  C                   add       1             Nr
N03  c                   movel     TrAvd2        Dup(Nr)
N03  c                   move      TrOpd2        Dup(Nr)
N03  C                   ENDIF
N03  c                   enddo
N03  C     UtAdd         tag
N03  C* Hent opp ingangsoppdraget
N03  C     KEYA          CHAIN(N)  HEADF                              33
N03  C                   ENDSR
N03   **************************************************************************
N03  C     DupOppd       begsr
N03   **************************************************************************
N03  C                   MOVE      'KOP'         TTEDRE                         KOPI FRA ANNET...
N03  c                   movel     ZEAVD         AvdOpdN          11 0
N03  c                   move      ZEOPD         AvdOpdN
N03   * Dupliser hendelse til alle oppdrag i "DUP-struktur"
N03  c     1             do        100           Nr
N03  c     Dup(Nr)       cabeq     *zeros        UtDupArr
N03  c                   move      Dup(Nr)       AvdOpd
N03  c     AvdOpd        ifne      AvdopdN
N03  C                   MOVE      TTAVD         TmpAVD            4 0
N03  C                   MOVE      TTOPD         TmpOPD            7 0
N03  C                   MOVE      DsAvd         TTAVD
N03  C                   MOVE      DsOpd         TTOPD
N08  c                   move      Dsl(Nr)       TRSLAG
N08  C                   move      'S'           TTMANU
N08  c     HEUR          IFEQ      'H'
N08  c     TRSLAG        andne     'HO'
N08  C                   move      ' '           TTMANU
N08  c                   endif
N03  C                   WRITE     TRACKFR
N04  c     TRACKTK       chain     Trackt                             33
N04  C     *in33         Ifeq      *OFF
N04  C     TXATAD        Ifeq      *zeros
N04  c                   move      TTDATE        TXATAD
N04  c                   movel     TTTIME        TXATAK                         kun 4 første tegn
N04  C                   end
N04  c                   update    tracktr
N04  C                   end
N03  C                   MOVE      TmpAVD        TTAVD
N03  C                   MOVE      TmpOPD        TTOPD
N03   * dersom POD oppdater også oppdrag....
N03  C                   ENDIF
N03  c                   enddo
N03  C     UtDupArr      tag
N03  C                   MOVE      *BLANKS       TTEDRE                         EVENT PÅ DETTE ..
N03  C                   ENDSR
     C***********************************************
     C     TTSR2         BEGSR
     C***********************************************
     C     TTKEY         CHAIN     TRACKL02                           52
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      'RUC'         TTACTI
     C                   MOVE      ULDT          TTDATE
     C                   MOVE      XULTM         TTTIME
     C                   MOVE      ULDT          TTDATL
     C                   MOVE      XULTM         TTTIML
     C                   MOVE      ZUSER         TTUSER
     C                   MOVE      RUCTXT        TTRTXT
     C                   MOVE      ZIDTG         TTDTG
     C                   MOVE      TTTXTB        TTTEXT
      * HVIS DATO ER 8 LANG OG BEGYNNER PÅ '20..' LAGER I EVENT TIME
     C     TTDTGA        IFEQ      '20'
     C     TTDTGB        ANDNE     *BLANKS
     C     TTDTGC        ANDEQ     *BLANKS
     C                   TESTN                   TTDTG8               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      TTDTG8        TTDATE
     C                   MOVE      *ZEROS        TTTIME
     C                   END
     C                   END
     C                   move      ' '           TTMANU
      *
     C   52              WRITE     TRACKFR
     C  N52              UPDATE    TRACKFR
     C                   ENDSR
N07  C***********************************************
N07  C     TTSR3         BEGSR
N07  C***********************************************
     C     TTKEY         CHAIN     TRACKL02                           52
N07  C                   MOVE      HEAVD         TTAVD
N07  C                   MOVE      HEOPD         TTOPD
N07  C                   TIME                    XULTID
N07  C                   MOVE      XULDD         ULDD
N07  C                   MOVE      XULMM         ULMM
N07  C                   MOVE      XULÅÅ         ULÅÅ
N07  C                   MOVE      'RUC'         TTACTI
N07  C                   MOVE      ULDT          TTDATE
N07  C                   MOVE      XULTM         TTTIME
N07  C                   MOVE      TTDATE        TTDATL
N07  C                   MOVE      TTTIME        TTTIML
N07  C                   MOVEL     ZUSER         TTUSER
N07  C                   MOVEL     'Accept c'    XXTEXT           16
N07  C                   MOVE      'ustoms  '    XXTEXT
N07  C                   MOVEL     XXTEXT        TTTEXT
N07  C                   MOVEL     ZETLE         TTTE17           17
N07  C                   MOVE      ZETLL         TTTE17
N07  C                   MOVE      TTTE17        TTTEXT
N07  C                   MOVEL     'Godkjent'    XXTEXT           16
N07  C                   MOVE      ' tollno '    XXTEXT
N07  C                   MOVEL     XXTEXT        TTTEXL
N07  C                   MOVE      TTTE17        TTTEXT
N07  C                   move      ' '           TTMANU
N07  C                   MOVEL     ZIDTG         TTDATE
N07  C   52              WRITE     TRACKFR
N07  C  N52              UPDATE    TRACKFR
N07  C                   ENDSR
      *
     C*
     C***********************************************
     C     MrkTur        BEGSR
     C***********************************************
      * Formater dato
     C                   MOVEL     ZEDTMO        XDT
     C     XDTÅ          IFGT      50
     C     XDTÅ          ADD       1900          XDT8Å
     C                   ELSE
     C     XDT           IFNE      *ZEROS
     C     XDTÅ          ADD       2000          XDT8Å
     C                   END
     C                   END
     C                   MOVE      XDTM          XDT8M
     C                   MOVE      XDTD          XDT8D
     C     ZEPRO         setll     HEAD11
     C     ZEPRO         reade     HEAD11                                 35
     C     *in35         Doweq     *OFF
     C     HESGM         IFEQ      *BLANKS
     C                   MOVE      HEAVD         ZEAVD
     C                   MOVE      HEOPD         ZEOPD
      *
     C                   MOVE      ZESGM         HESGM
     C                   MOVEL     XDT8          HEDTMO
     C                   MOVEL     XDT8          XXDTMO
     C                   MOVE      ZEKLMO        HEKLMO
     C                   UPDATE    HEADFR11
     C                   MOVE      *ZEROS        DFFBNR
     C                   EXSR      TTSR
      * alle fraktbrev
     C     DOKKEY        SETLL     DOKUF
     C     DOKKEY        READE     DOKUF                                  33
     C     *IN33         DOWEQ     '0'
     C                   MOVEL     ZESGM         DFSGM
     C                   MOVEL     XDT8          DFDTMO
     C                   MOVEL     XDT8          XXDTMO
     C                   MOVEL     ZEKLMO        DFKLMO
     C                   MOVEL     XDT8          HEDTMO
     C                   MOVEL     ZEKLMO        HEKLMO
     C                   UPDATE    DOKUFR
     C                   EXSR      TTSR
     C     DOKKEY        READE     DOKUF                                  33
     c                   end
     C                   END
      *
     C     ZEPRO         reade     HEAD11                                 35
     C                   end
     C                   ENDSR
     OFAKTR     EADD         NYFAKT
     O                       FA01
     O                       FALI
     O                       FAAVD
     O                       FAOPD
     O                       FASK
     O                       FAVK
     O                       FAVT
     O                       FAVAL
     O                       FABELV
     O                       FAKDM
     O                       FABELN
     O                       FAKDA
     O                       FA01B
     O                       FAKDUL
     O                       FAKDUK
     O                       FABELU
** TABA/TABB, HVOR MANGE DAGER FRA NYTTÅR ?
01000
02031
03059
04090
05120
06151
07181
08212
09243
10273
11304
12334
