********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX * 01 JOV PTF11 husk å cleare subfil også ved F8-søk
11XXX * 02 CB  PTF11 Se arkiv
********************************************************************
     FSVZ000D   CF   E             WORKSTN
     F                                     SFILE(SVZ000DA:ZRECNO)
     F                                     INFDS(FBAREA)
     FSVZH      IF   E           K DISK
     FSVZH1     IF   E           K DISK
     F                                     RENAME(SVZHR:SVZHR1)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *________________
      * Arbetsvariablar
      *""""""""""""""""
     C     *LIKE         DEFINE    ZRECNO        WRECNO
     C     *LIKE         DEFINE    *IN03         WIN03
     C     *LIKE         DEFINE    *IN03         WIN03
     C     *LIKE         DEFINE    *IN12         WIN12
     C                   MOVEA     '000010000'   *IN(41)

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR

     C     SRB1          TAG
      *______________
      * Tømme Subfile
      *""""""""""""""
     C                   EVAL      *IN93=*ON
     C                   WRITE     SVZ000DB
     C                   MOVEA     '000'         *IN(93)
     C                   Z-ADD     *ZERO         ZRECNO
     C                   Z-ADD     *ZERO         WRECNO
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     *HIVAL        SETLL     SVZH1
     C                   READP     SVZH1                                  94

     C     SRB2          TAG
     C  N94              DO
     C                   DO        256
     C                   ADD       1             ZRECNO
     C                   WRITE     SVZ000DA
     C                   MOVE      ZRECNO        XRECN2            5 0
     C                   READP     SVZH1                                  94
     C  N94              ENDDO
     C                   ENDDO
     C                   MOVE      ZRECNO        XRECNO            5 0

     C     ZRECNO        IFEQ      0
     C                   CLEAR                   SVZ000DA
     C                   ADD       1             ZRECNO
     C                   WRITE     SVZ000DA
     C                   ENDIF
     C                   EVAL      WRECNO=ZRECNO
     C                   EVAL      ZRECNO=1
      *_______________
      * Behandle bilde
      *"""""""""""""""
     C     SRB3          TAG

     C                   MOVEA     '11'          *IN(91)
     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     SVZ000DØ
     C                   WRITE     SVZ000DC
     C                   EXFMT     SVZ000DB
     C                   EVAL      *IN30=*OFF
     C                   EVAL      *IN31=*OFF

     C     *IN03         IFEQ      '0'
     C     *IN08         ANDEQ     '0'
     C     *IN12         ANDEQ     '0'

     C                   MOVEA     '00'          *IN(91)
      *_____________
      * F5=Frisk opp
      *"""""""""""""
     C     *IN05         CABEQ     '1'           SRB1
      *_____________
      * F25=Bla frem
      *"""""""""""""
     C   25              DO
     C                   Z-ADD     XRECNO        ZRECNO
KING C     SVZH_TUID     CHAIN     SVZH                               33
     C                   SETOFF                                       25
     C                   GOTO      SRB2
     C                   END
      *_______
      * Valg ?
      *"""""""
     C                   EVAL      *IN52=*OFF
     C                   EVAL      *IN95=*OFF
     C     *IN52         DOWEQ     '0'

     C                   READC     SVZ000DA                               52
     C     *IN52         IFEQ      '0'
     C     ZOP           IFNE      *BLANKS
     C     ZOP           ANDNE     'P'
N02  C     ZOP           ANDNE     'A'
     C                   ENDIF

     C     ZOP           CASEQ     'P'           SRBP                           Skriv ut
     C     ZOP           CASEQ     'A'           SRBA                           Arkiv
     C                   ENDCS
     C                   ENDIF
      *
     C  N52              ENDDO

     C     *IN03         CABEQ     '1'           SRB9
     C     *IN12         CABEQ     '1'           SRB3
     C                   GOTO      SRB1

     C                   ENDIF

     C     *IN08         IFEQ      '1'
     C     *IN12         OREQ      '1'
     C                   EXSR      SRB0
KING C     ZVZH_TUID     CHAIN     SVZH                               33
S01  C*                  MOVEA     '000'         *IN(93)
N01  C                   EVAL      *IN93=*ON
     C                   WRITE     SVZ000DB
N01  C                   MOVEA     '000'         *IN(93)
     C                   Z-ADD     *ZERO         ZRECNO
     C                   Z-ADD     *ZERO         WRECNO
     C                   ADD       1             ZRECNO
     C                   WRITE     SVZ000DA
     C                   MOVE      ZRECNO        XRECN2            5 0
     C     *HIVAL        SETLL     SVZH1
     C                   READP     SVZH1                                  94
     C     *IN03         CABEQ     '0'           SRB2
     C                   ENDIF

     C     SRB9          ENDSR
      *////////////////////////////////////////////////////////////
      *  Start søking                                        SRB0 /
      *////////////////////////////////////////////////////////////
     C     SRB0          BEGSR

     C     SRB01         TAG
     C                   EXFMT     SVZ000DD
     C                   MOVEA     '0000'        *IN(96)
     C                   SETOFF                                       30

     C   03              DO
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END

     C   30              GOTO      SRB01

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Skriv ut                                            SRBP /
      *////////////////////////////////////////////////////////////
     C     SRBP          BEGSR
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    SVZ000DA
      *________________________
      * call på externt program
      *""""""""""""""""""""""""
     C                   CALL      'SVZ002R'
     C                   PARM                    SVZH_TUID
     C                   PARM      'P'           CALLTYP           1
     C                   ENDSR
N02   *////////////////////////////////////////////////////////////
N02   *  Arkiv                                               SRBA /
N02   *////////////////////////////////////////////////////////////
N02  C     SRBA          BEGSR
N02   *_________________
N02   * Oppdatere SUBFIL
N02   *"""""""""""""""""
N02  C                   MOVE      *BLANKS       ZOP
N02  C                   UPDATE    SVZ000DA
N02   *________________________
N02   * call på externt program
N02   *""""""""""""""""""""""""
N02  C                   CALL      'ARC003'
N02  C                   PARM                    UAVD              4 0
N02  C                   PARM                    UOPD              7 0
N02  C                   PARM                    SVZH_TUID
N02  C                   ENDSR
