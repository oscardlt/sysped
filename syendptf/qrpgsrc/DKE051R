     FDKE051D   CF   E             WORKSTN
     F                                     SFILE(DKE051DA:ZRECNO)
     F                                     INFDS(FBAREA)
     FDKEA      UF A E           K DISK
     FDKEA1     IF   E           K DISK
     F                                     RENAME(DKEAR:DKEAR1)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *________________
      * Arbetsvariablar
      *""""""""""""""""
     C     *LIKE         DEFINE    ZRECNO        WRECNO
     C     *LIKE         DEFINE    DKEA_SYAV     ZKIA_SYAV
     C     *LIKE         DEFINE    DKEA_SYOP     ZKIA_SYOP
      *_________________________________
      * Hæmta dagens datum och klockslag
      *"""""""""""""""""""""""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR

     C     SRB1          TAG
      *______________
      * Tømme Subfile
      *""""""""""""""
     C                   EVAL      *IN93=*ON
     C                   WRITE     DKE051DB
     C                   MOVEA     '000'         *IN(93)
     C                   Z-ADD     *ZERO         ZRECNO
     C                   Z-ADD     *ZERO         WRECNO
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     *LOVAL        SETLL     DKEA1
     C                   READ      DKEA1                                  94

     C     *IN94         DOWEQ     '0'
     C                   ADD       1             ZRECNO
     C                   WRITE     DKE051DA
     C                   READ      DKEA1                                  94
     C  N94              ENDDO

     C     ZRECNO        IFEQ      0
     C                   ADD       1             ZRECNO
     C                   WRITE     DKE051DA
     C                   ENDIF
     C                   EVAL      WRECNO=ZRECNO
     C                   EVAL      ZRECNO=1
      *_______________
      * Behandle bilde
      *"""""""""""""""
     C     SRB3          TAG

     C                   MOVEA     '11'          *IN(91)
     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     DKE051DE
     C                   WRITE     DKE051DØ
     C                   WRITE     DKE051DC
     C                   EXFMT     DKE051DB

     C     *IN03         IFEQ      '0'
     C     *IN12         ANDEQ     '0'

     C                   MOVEA     '00'          *IN(91)
      *_____________
      * F5=Frisk opp
      *"""""""""""""
     C     *IN05         CABEQ     '1'           SRB1
      *___________
      * F6=Lage ny
      *"""""""""""
     C     *IN06         IFEQ      '1'
     C                   EXSR      SRBA
     C     *IN03         CABEQ     '1'           SRB9
     C                   GOTO      SRB3
     C                   ENDIF
      *_______
      * Valg ?
      *"""""""
     C                   EVAL      *IN52=*OFF
     C                   EVAL      *IN95=*OFF
     C     *IN52         DOWEQ     '0'

     C                   READC     DKE051DA                               52
     C     *IN52         IFEQ      '0'
     C     ZOP           CASEQ     '2'           SRBB                           Endre
     C     ZOP           CASEQ     '4'           SRBD                           Slette
     C                   ENDCS
     C                   ENDIF
      *
     C  N52              ENDDO

     C     *IN03         CABEQ     '1'           SRB9
     C     *IN12         CABEQ     '1'           SRB3
     C                   GOTO      SRB1

     C                   ENDIF

     C     SRB9          ENDSR
      *////////////////////////////////////////////////////////////
      *  Lage ny                                             SRBA /
      *////////////////////////////////////////////////////////////
     C     SRBA          BEGSR

     C                   CLEAR                   DKE051DD
     C                   MOVEA     '0000'        *IN(30)

     C     SRBA1         TAG

      *____________
      * Blanke felt
      *""""""""""""
     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     DKE051DØ
     C                   EXFMT     DKE051DD
     C                   MOVEA     '0000'        *IN(30)
     C     *IN03         IFEQ      '0'
     C     *IN05         ANDEQ     '0'
     C     *IN12         ANDEQ     '0'
      *_______
      * F4=Søk
      *"""""""
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN04         IFEQ      '1'
     C     LINNBR        ANDEQ     23
     C                   ENDIF
      *____________
      * Teste input-1
      *""""""""""""
     C   30              GOTO      SRBA1
      *___________________
      * Adda post til  FIL
      *"""""""""""""""""""
     C                   EVAL      DKEA_SYAV=ZKIA_SYAV
     C                   EVAL      DKEA_SYOP=ZKIA_SYOP
     C                   EVAL      DKEA_14A=ZKIA_14A
     C                   EVAL      DKEA_14B=ZKIA_14B
     C                   EVAL      DKEA_14C=ZKIA_14C
     C                   EVAL      DKEA_14D=ZKIA_14D
     C                   EVAL      DKEA_14E=ZKIA_14E
     C                   EVAL      DKEA_14F=ZKIA_14F
     C                   EVAL      DKEA_0035=ZKIA_0035
     C                   EVAL      DKEA_FTIP=ZKEA_FTIP
     C                   EVAL      DKEA_US=ZKEA_US
     C                   EVAL      DKEA_PW=ZKEA_PW
     C                   EVAL      DKEA_PRTF=ZKEA_PRTF
     C                   WRITE     DKEAR
      *______________________
      * Adda post til  SUBFIL
      *""""""""""""""""""""""
     C                   ADD       1             WRECNO
     C                   EVAL      ZRECNO=WRECNO
     C                   WRITE     DKE051DA

     C                   GOTO      SRBA1

     C                   ENDIF

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Endre                                               SRBB /
      *////////////////////////////////////////////////////////////
     C     SRBB          BEGSR
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    DKE051DA
      *____________
      * Flytte felt
      *""""""""""""
     C     DKEA_SYAV     CHAIN(N)  DKEA                               53
     C                   MOVEA     '0000'        *IN(30)
     C                   EVAL      ZKIA_SYAV=DKEA_SYAV
     C                   EVAL      ZKIA_SYOP=DKEA_SYOP
     C                   EVAL      ZKIA_14A=DKEA_14A
     C                   EVAL      ZKIA_14B=DKEA_14B
     C                   EVAL      ZKIA_14C=DKEA_14C
     C                   EVAL      ZKIA_14D=DKEA_14D
     C                   EVAL      ZKIA_14E=DKEA_14E
     C                   EVAL      ZKIA_14F=DKEA_14F
     C                   EVAL      ZKIA_0035=DKEA_0035
     C                   EVAL      ZKEA_FTIP=DKEA_FTIP
     C                   EVAL      ZKEA_US=DKEA_US
     C                   EVAL      ZKEA_PW=DKEA_PW
     C                   EVAL      ZKEA_PRTF=DKEA_PRTF

     C     SRBB1         TAG

     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     DKE051DØ
     C                   EXFMT     DKE051DD
     C                   MOVEA     '000'         *IN(30)
     C     *IN12         IFEQ      '0'
      *_______
      * F4=Søk
      *"""""""
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN04         IFEQ      '1'
     C     LINNBR        ANDEQ     23
     C                   ENDIF
      *____________
      * Teste input
      *""""""""""""
     C   30              GOTO      SRBB1
      *______________
      * Oppdatere FIL
      *""""""""""""""
     C     ZKIA_SYAV     CHAIN     DKEA                               53
     C                   EVAL      DKEA_SYOP=ZKIA_SYOP
     C                   EVAL      DKEA_14A=ZKIA_14A
     C                   EVAL      DKEA_14B=ZKIA_14B
     C                   EVAL      DKEA_14C=ZKIA_14C
     C                   EVAL      DKEA_14D=ZKIA_14D
     C                   EVAL      DKEA_14E=ZKIA_14E
     C                   EVAL      DKEA_14F=ZKIA_14F
     C                   EVAL      DKEA_0035=ZKIA_0035
     C                   EVAL      DKEA_FTIP=ZKEA_FTIP
     C                   EVAL      DKEA_US=ZKEA_US
     C                   EVAL      DKEA_PW=ZKEA_PW
     C                   EVAL      DKEA_PRTF=ZKEA_PRTF
     C                   UPDATE    DKEAR

     C                   ENDIF

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Slette                                              SRBD /
      *////////////////////////////////////////////////////////////
     C     SRBD          BEGSR
      *______________
      * Oppdatere FIL
      *""""""""""""""
     C     DKEA_SYAV     CHAIN     DKEA                               53
     C                   DELETE    DKEAR
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   CLEAR                   DKE051DA
     C                   UPDATE    DKE051DA
     C                   EVAL      *IN95=*ON

     C                   ENDSR
