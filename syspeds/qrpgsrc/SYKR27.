     Ffak3      IF   E           K DISK
     F                                     RENAME(FAKTR:FAKTR3)
     Ffakt      O  A E             DISK
     Fsaml      IF A E           K DISK
     Fheadf     IF   E           K DISK
      *
     c     keyhead       klist
     c                   kfld                    faavd
     c                   kfld                    faopd
      *
      *
     c     key           klist
     c                   kfld                    kode              1
     c                   kfld                    faktn             6 0
     c                   move      'O'           kode
     c                   move      wsfakt        faktn
      *
     c     key           setll     fak3
      *
     c     *in(33)       doweq     '0'
     c     key           reade     fak3                                   33
     c     *in(33)       ifeq      '0'
     c     fakda         andne     'K'
      *
      * lager kreditnota
      *
     C                   exsr      kredit
      *
      * lager nye fakturalinjer lik de gamle
      * og merker de samtidig ferdigmeldt
      *
     c                   exsr      nyfakt
     C                   END
     c                   end
      *
     c                   seton                                        lr
     c                   return
     c*******************************************************
     c     kredit        begsr
     c*******************************************************
      *
      * legger først ut kreditfaktura
      *
     c                   z-add     0             fajour
     c                   z-sub     fabeln        fabeln
     c                   z-sub     fabelv        fabelv
     c                   z-sub     fabelu        fabelu
     c                   z-add     374323        fafakt
     c                   move      'G'           faopko
     C                   CALL      'SYGE06'
     C                   PARM                    faavd
     C                   PARM                    faopd
     C                   PARM                    FALI
     c                   write     faktr
     c                   endsr
     c*******************************************************
     c     nyfakt        begsr
     c*******************************************************
      *
      * legger deretter ut nye fakturalinjer ferdimeldt
      *
     c                   z-sub     fabeln        fabeln
     c                   z-sub     fabelv        fabelv
     c                   z-sub     fabelu        fabelu
     c                   z-add     0             fafakt
     c                   z-add     0             fadato
     c                   z-add     0             fadaff
      * flytter gammel facuri til sacuri hvis ikke lik firmavalutqa
     c                   move      *blanks       saval
     c     faval         ifne      ficuri
     c                   move      faval         saval
     c                   end
      *
     C                   MOVE      *BLANKS       FACURI
     c                   move      'C'           faopko
     C                   CALL      'SYGE06'
     C                   PARM                    faavd
     C                   PARM                    faopd
     C                   PARM                    FALI
     c                   write     faktr
     c                   exsr      ferdigm
     c                   endsr
     c*******************************************************
     c     ferdigm       begsr
     c*******************************************************
     c*
      * legger ut samlefakturarecord
      *
     c     keyhead       chain     headf                              38
      *
     C     SAMLK         KLIST
     C                   KFLD                    SAKN
     C                   KFLD                    SAVAL
     C                   KFLD                    SAAVD
     C                   KFLD                    SAOPD
      *
     C                   MOVE      FAkunr        SAKN
     C                   MOVE      FAAVD         SAAVD
     C                   MOVE      FAOPD         SAOPD
     C     SAMLK         CHAIN     SAML                               34
     c     *in(34)       ifeq      '1'
     C                   MOVE      HEPRO         SAPRO
     C                   MOVE      'J'           SAGRP
NV5  C                   MOVE      HEDTOP        SADATO
     C                   MOVE      HEUR          SAUR
     C   34              WRITE     SAMLR
     c                   end
     c                   endsr
