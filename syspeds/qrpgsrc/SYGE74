********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX * 01 SH  PTF11 tildele rekvisisjonsnummer
********************************************************************
     H DECEDIT(',') debug(*yes)
      ************************************************************************
      *  budsjett feil
      ************************************************************************
N01  FKOSTT     UF   E           K DISK
     FKOSBU12   UF A E           K DISK
     FKOSTB     UF   E           K DISK
     FKOSTA1    IF   E           K DISK
     FTRAN      IF   E           K DISK
     Ffirm      if   E           K disk
     Ffirmtp    if   E           K disk
     FHEADF     IF   E           K DISK
     FDOKUF     IF   E           K DISK
     D                 DS
     D  TRVK01                 1      5  0
     D  TRVK02                 6     10  0
     D  TRVK03                11     15  0
     D  TRVK04                16     20  0
     D  TRVK05                21     25  0
     D  TRVK06                26     30  0
     D  TRVK07                31     35  0
     D  TRVK08                36     40  0
     D  TRVK09                41     45  0
     D  TRVK10                46     50  0
     D  TRVK11                51     55  0
     D  TRVK12                56     60  0
     D  FV                     1     60  0
     D                                     DIM(12) ASCEND                       VEKTGR. AVTALE
     D                 DS
     D  TRPA01                 1      3  1
     D  TRPA02                 4      6  1
     D  TRPA03                 7      9  1
     D  TRPA04                10     12  1
     D  TRPA05                13     15  1
     D  TRPA06                16     18  1
     D  TRPA07                19     21  1
     D  TRPA08                22     24  1
     D  TRPA09                25     27  1
     D  TRPA10                28     30  1
     D  TRPA11                31     33  1
     D  TRPA12                34     36  1
     D  FP                     1     36  1
     D                                     DIM(12)                              VEKTGR. AVTALE
     D                 DS
     D  HEDTÅ                  1      4  0
     D  HEDTM                  5      6  0
     D  HEDTD                  7      8  0
     D  HEDTOP                 1      8  0
      *
     c                   exsr      init
      *
     c
      *
      * HOVEDLØKKE FOR LESING
      *
     C                   setoff                                       33
     C     kostak        setll     kosta1
     c     *in33         doweq     '0'
     c     kostak        reade     kosta1                                 33
     c     *in33         ifeq      '0'
     c     kalnr         andeq     tplevn
     c                   exsr      lesb
     C                   end
     C                   END
     c                   seton                                        lr
     c                   return
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     kostak        KLIST
     C                   KFLD                    kast
     C     kostbk        KLIST
     C                   KFLD                    kabnr
     C     DOKUFK        KLIST
     C                   KFLD                    DFRI
     C                   KFLD                    KBAVD
     C                   KFLD                    KBOPD
     C                   KFLD                    DFFBNR
     c                   z-add     1             dffbnr
     c                   move      'F'           DFRI
     C     headfk        KLIST
     C                   KFLD                    KBAVD
     C                   KFLD                    KBOPD
     C     KOSBUK        KLIST
     C                   KFLD                    KBAVD
     C                   KFLD                    KBOPD
     C                   KFLD                    UTXT             35
     C     TRAKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    DFTRAN
     C                   read      firm                                   33
     c     fifirm        chain     firmtp                             33
     C                   ENDSR
      *
      ***********************************************
     C     LESB          BEGSR
      ***********************************************
     C                   setoff                                       35
     C     kostbk        setll     kostb
     c     *in35         doweq     '0'
     c     kostbk        reade     kostb                                  35
     C   35              MOVE      *zeros        NYTTBU
     c     *in35         ifeq      '0'
     c     kbavd         andne     *zeros
     c     kbopd         andne     *zeros
     c     headfk        chain     headf                              34
     c  n34dokufk        chain     dokuf                              34
     C     TRAKEY        CHAIN     TRAN                               78
     c     *in34         ifeq      '0'
     c                   exsr      berbud
     c                   z-add     nyttbu        kbbuds
     c                   update    kostbr
     C                   end
     C                   end
     C                   END
     c                   endsr
      ***********************************************
     C     BERBUD        BEGSR
      ***********************************************
     C                   EVAL      utxt='*fb*'
     c                   move      dffbnr        dffbna            3
     c     UTXT          CAT       DFFBNA:0      UTXT
     C                   MOVE      *zeros        NYTTBU            9 0
     C                   MOVE      'N'           UOVERS            1
     C                   MOVE      DFPNLS        U2PNF             4
     C                   MOVE      DFPOUL        U2PNT             4
     C                   MOVE      HENT          U2NT              7
     C                   MOVE      HEVKT         U2VKT             9
     C                   MOVE      HEM3          U2DM3             7
     C                   MOVE      DFTRAN        U2KNT             8
     C                   MOVE      *ZEROS        U2RAB             3
     C                   MOVE      '2'           U2FLAGG           1
     C                   MOVE      KBAVD         U2AVD             4
     C                   MOVE      KBOPD         U2OPD             7
     C     HEKNKF        IFNE      *ZEROS
     C                   MOVE      HEKNKF        U2KN              8
     C                   ELSE
     C                   MOVE      HEKNK         U2KN
     C                   END
     C                   MOVE      DFKNS         U2KNS            12
     C                   MOVE      DFTRAN        U2TRAN            8
     C                   MOVE      DFPROK        U2PROK            5
     C                   CALL      'SYFB05C'
     C                   PARM                    U2PNF
     C                   PARM                    U2PNT
     C                   PARM                    U2NT
     C                   PARM                    U2VKT
     C                   PARM                    U2DM3
     C                   PARM                    U2KNT
     C                   PARM                    U2BRTBL           9
     C                   PARM                    U2NETBL           9
     C                   PARM                    U2RAB
     C                   PARM                    U2FLAGG
     C                   PARM                    U2AVD
     C                   PARM                    U2OPD
     C                   PARM                    U2KN
     C                   PARM                    U2KNS
     C                   PARM                    U2TRAN
     C                   PARM                    U2PROK
     C                   IF        U2FLAGG = '0'
     C                   MOVE      U2NETBL       NYTTBU            9 0
     c     nyttbu        ifne      *zeros
     c                   exsr      oppdat
     c                   end
     c                   end
     C                   ENDSR
     C*********************************************************************
     c     oppdat        begsr
     C*********************************************************************
     c     kosbuk        chain     kosbu12                            34
      *
      * hopp ut hvis budsjett er ført
      *
     c  n34bust          ifne      ' '
     c                   goto      utbud
     c                   end
      *
      * flytter data til budsjett record
      *
     c                   move      'NOK'         buval
     c                   z-add     nyttbu        bubl
     c                   z-add     dftran        butnr
     c                   z-add     vmtrle        bulnr
     C                   MOVEL     HEDTÅ         BUPCC
     C                   MOVE      HEDTÅ         BUPÅR
     C                   MOVE      HEDTM         BUPMN
     C                   MOVE      'FRA'         BUVK
     C                   MOVE      HESG          BUSG
     C                   MOVE      'O'           BUFER                          *O = OPPDRAG
     C                   MOVE      'E'           BUBLST
     C                   MOVE      'E'           BUTYPE
     c                   move      utxt          butxt
      * endre gammelt budsjett
      *
     c     *in34         ifeq      '0'
     c                   update    kosbur
      * logikk ved skrive ny
     c                   else
     c                   move      kbavd         buoavd
     c                   move      kbopd         buopd
N01  C                   MOVE      'Å'           YBNRT             1
N01  C     YBNRT         CHAIN     KOSTT                              34
N01  C  N34              ADD       1             KTNR
N01  C  N34              UPDATE    KOSTTR
N01  C  N34              MOVE      KTNR          BUBNR
     c                   write     kosbur
     c                   end
     c     utbud         endsr
