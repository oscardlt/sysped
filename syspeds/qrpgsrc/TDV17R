********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 godtar også zebra uten 95
10XXX * 02 SH  PTF10 PRINTERSTYRING
10XXX * 03 SH  PTF10 TD FLASCH
10XXX * 04 SH  PTF11 hawbnr
10XXX * 05 SH  PTF11 handling info
10XXX * 06 SH  PTF11 PDF Print
10XXX * 07 SH  PTF11 ny endring handling info
********************************************************************
      *
     H DATEDIT(*YMD)
     FKODTP     IF   E           K DISK
     FKODTV     IF   E           K DISK
     FLABF      O    E             DISK
     FPARL01    IF   E           K DISK
     FISUL01    IF   E           K DISK
     FCNFF      UF   E             DISK
     FFIRM      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FHEAD3     IF   E           K DISK
     F                                     RENAME(HEADFR:HEAD3R)
     Fheadf     IF   E           K DISK
     FDOKEFIM1  IF   E           K DISK
     FDOKEF     IF   E           K DISK
     FDOKUI     IF   E           K DISK
     FSAMLB     IF   E           K DISK
     FDOLAF     UF A E             DISK
     F                                     INFDS(DOLADS)
     FTDV17D    CF   E             WORKSTN USROPN
     D                 DS
     D  WW1                    1      3
     D  WW2                    4      6
     D  WW3                    7     14
     D  LAAWBC                 1     14
     D                 DS
     D  ROUTIN                 1     16
     D  WWA                    1      3
     D  WWB                    5     11
     D  WWC                   12     12
     D  WWD                   13     14
     D                 DS
     D  WARECA                 1      9  0
     D                 DS
     D  WNHEG3                 1      3  0
     D  LAAWBN                 1     11  0
     D                 DS            14
     D PCARGO          C                   CONST('PRIORITY CARGO')
N03  D TDFLAS          C                   CONST('TD flash      ')
     D                 DS
     D  DIXXX1                 1      7
     D  DIXXV1                 1      3
     D  DIXXV2                 4      6
     D                 DS
     D  TID                    1      6  0
     D  LAAVD                  3      6  0
      * Get recordnumber from file
     D DOLADS          DS
     D  DORECN               397    400B 0
     D                UDS
     D  UAVD                  15     18
     IDOLAR
     I              LAISTX                      DOISTX
      *
     C     KODTPK        KLIST
     C                   KFLD                    WSPUNI
     C                   KFLD                    DIVAVD
     C                   KFLD                    WSPLNR
     C     KODTVK        KLIST
     C                   KFLD                    WSVUNI
     C                   KFLD                    DIVAVD
     C     HEAD3K        KLIST
     C                   KFLD                    DIVAVD
     C                   KFLD                    WSAWB
     C     DOKEFK        KLIST
     C                   KFLD                    WSFUNI
     C                   KFLD                    DIVAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    DFLOP
     C     CUNDKI        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WKUND
     C     DOKUIK        KLIST
     C                   KFLD                    WSIUNI
     C                   KFLD                    DIVAVD
     C                   KFLD                    HEOPD
      *
     C     *LIKE         DEFINE    SMSD          WSMSD
     C     *LIKE         DEFINE    SMLNR         WSMLNR
     C     SAMLBK        KLIST
     C                   KFLD                    WSMSD
     C                   KFLD                    WSMLNR
     C     *ENTRY        PLIST
     C                   PARM                    JOB               5 0
     C                   PARM                    BATCH             1
     C                   PARM                    UAWB             11
     c     batch         ifeq      'N'
     c                   open      TDV17D
     c                   end
      *
     C                   Z-add     1             dflop
     C                   Z-ADD     0             TELLER            3 0
     C                   CLEAR                   TDV17B10
     C                   MOVE      'P'           WSPUNI            1
     C                   MOVE      'V'           WSVUNI            1
     C                   MOVE      'F'           WSFUNI            1
     C                   MOVE      'I'           WSIUNI            1
     C                   Z-ADD     68            WSPLNR            3 0
     C     UAVD          IFNE      *BLANKS
     C                   MOVE      UAVD          DIVAVD
     C     KODTPK        CHAIN     KODTP                              90
     C     *IN90         IFEQ      *OFF
     C                   MOVE      KOPNVN        DIVPRT
     C                   ENDIF
     C                   ENDIF
     C                   READ      FIRM                                   90
     C     *IN90         IFEQ      *ON
     C                   MOVE      *ON           *IN30
     C                   MOVE      'BBA0035'     MSGNR
     C                   ENDIF
      *
     C     START         TAG
     c     batch         ifeq      'N'
     C                   EXFMT     TDV17B10
     c                   else
     c                   move      uawb          LAAWBN
     c                   end
     C                   MOVE      *OFF          *IN30
      *
     C     *IN03         IFEQ      *ON
     C                   GOTO      SLUTT
     C                   ENDIF
      *
     C                   EXSR      TESTB
      *
     C     *IN30         IFEQ      *ON
     c     batch         ifeq      'N'
     C                   GOTO      START
     c                   else
     c                   goto      slutt
     c                   end
     C                   ENDIF
      *
     C     *IN10         IFEQ      *ON
     c     batch         oreq      'Y'
N06  C     KOPTY         ifeq      'PDF'
N06  c                   exsr      printmp
N06  c                   else
     C     FITDVI        IFEQ      'J'
     C                   EXSR      PRINT
     C                   EXSR      SNDDTA
     C                   ELSE
     C                   EXSR      PRINT2
     C                   ENDIF
N06  C                   ENDIF
     C                   ENDIF
      *
     c     batch         ifne      'Y'
     C                   GOTO      START
     c                   end
      *
     C     SLUTT         TAG
     c     batch         ifeq      'N'
     C                   close     TDV17D
     c                   end
     C                   SETON                                        LR
     C                   RETURN
      *
      ******************************************
     C     TESTB         BEGSR
      ******************************************
     C     KODTVK        CHAIN     KODTV                              90
     C     *IN90         IFEQ      *ON
     C                   MOVE      'SPA0001'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   GOTO      TEST99
     C                   ENDIF
     C     DIVPRT        IFEQ      *BLANKS
     C     KODTPK        CHAIN     KODTP                              90
     C     *IN90         IFEQ      *ON
     C                   MOVE      'BBA0052'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   GOTO      TEST99
     C                   ENDIF
     C                   MOVEL     KOPNVN        DIVPRT
     C                   ENDIF
      *
     C     LANUMC        IFEQ      0
     C                   Z-ADD     0             TELLER
     C                   ENDIF
     C     LAAWBN        IFNE      *ZEROS
     C     LANUMC        ANDEQ     0
     C                   MOVE      LAAWBN        WSAWB            15
     C     HEAD3K        CHAIN     HEAD3                              90
     c     IMKEY         klist
     c                   kfld                    imavd
     c                   kfld                    imopd
     C     *IN90         IFEQ      *ON
     C     wsawb         chain     dokefim1                           90
     c  N90imkey         chain     headf                              90
     C  N90              z-add     IMLOP         dflop
     c                   end
     C     *IN90         IFEQ      *ON
     C     TELLER        ANDEQ     0
     C                   MOVE      'BBA0053'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   ADD       1             TELLER
     C                   ENDIF
     C     *IN90         IFEQ      *OFF
     C     DOKEFK        CHAIN     DOKEF                              90
     C     *IN90         IFEQ      *OFF
      * Move values from SYSPED400 to fields for screen
     C                   MOVEL     HENAS         LASHP1
     C                   MOVEL     HEADS1        LASHP2
     C                   MOVEL     HEADS2        LASHP3
     C                   MOVEL     HEADS3        LASHP4
     C                   MOVEL     HENAK         LACNE1
     C                   MOVEL     HEADK1        LACNE2
     C                   MOVEL     HEADK2        LACNE3
     C                   MOVEL     HEADK3        LACNE4
     C                   MOVEL     HESDF         WSFROM
     C                   MOVEL     HESDT         WSTO
     C                   MOVEL     DFROA1        WSROA1
     C                   MOVEL     DFROB1        WSROB1
     C                   Z-ADD     DFROC1        WSROC1
     C                   MOVEL     DFROA2        WSROA2
     C                   MOVEL     DFROB2        WSROB2
     C                   Z-ADD     DFROC2        WSROC2
     C                   MOVEL     DFROA3        WSROA3
     C                   MOVEL     DFROB3        WSROB3
     C                   Z-ADD     DFROC3        WSROC3
     C                   Z-ADD     DFNTT         LANUMC
     C                   Z-ADD     DFNTT         LANUMP
     C                   Z-ADD     DFVKTT        LAWGHT
s07  C*                  MOVEL     DFINFA        LAHAIN
      * HENT VERDIER FOR SAMLAST
     C                   MOVEL     HESAML        WSMSD
     C                   MOVE      HESAML        WSMLNR
     C     SAMLBK        CHAIN     SAMLB                              91
     C     *IN91         IFEQ      *OFF
     C                   MOVEL     SMSD          LADCTY
s05  C*                  MOVEL(P)  SMSD          LAHAIN
s05  C*                  MOVEL     'HWB:'        LAHAIN
s05  C*    LAHAIN        CAT       HESDT:1       LAHAIN
n05  C                   MOVEL     HESDF         LAHAIN
     C     LAHAIN        CAT       HEHAWB:0      LAHAIN
s04  C*    LAHAIN        CAT       'DES:':0      LAHAIN
s04  C*    LAHAIN        CAT       HESDT:0       LAHAIN
s07  C*    LAHAIN        CAT       'DES:':1      LAHAIN
s07  C*    LAHAIN        CAT       HESDT:0       LAHAIN
     C                   ENDIF
     C     DFRK1         IFEQ      'P'
     C     DFRK2         OREQ      'P'
     C     DFRK3         OREQ      'P'
     C     DFRK4         OREQ      'P'
     C     DFRK5         OREQ      'P'
     C     DFRK6         OREQ      'P'
     C                   MOVE      'P'           SERCDE
     C                   ENDIF
N03  C     DFRK1         IFEQ      'Z'
N03  C     DFRK2         OREQ      'Z'
N03  C     DFRK3         OREQ      'Z'
N03  C     DFRK4         OREQ      'Z'
N03  C     DFRK5         OREQ      'Z'
N03  C     DFRK6         OREQ      'Z'
N03  C                   MOVE      'Z'           SERCDE
N03  C                   ENDIF
     C                   ELSE                                                   <*IN90
      * Export fraktbrev ikke funnet, prøver å finne innlands ...
     C     DOKUIK        CHAIN     DOKUI                              90
     C     *IN90         IFEQ      *OFF
      * Move values from SYSPED400 to fields for screen
     C                   MOVEL     HENAS         LASHP1
     C                   MOVEL     HEADS1        LASHP2
     C                   MOVEL     HEADS2        LASHP3
     C                   MOVEL     HEADS3        LASHP4
     C                   MOVEL     HENAK         LACNE1
     C                   MOVEL     HEADK1        LACNE2
     C                   MOVEL     HEADK2        LACNE3
     C                   MOVEL     HEADK3        LACNE4
     C                   MOVEL     HESDF         WSFROM
     C                   MOVEL     HESDT         WSTO
     C     DIRUN2        IFEQ      *BLANKS
     C     DIRUN3        ANDEQ     *BLANKS
     C                   MOVEL     DITIL         WSROA1
     C                   MOVEL     DIRUNR        WSROB1
     C                   Z-ADD     DIDAG1        WSROC1
     C                   ENDIF
     C     DIRUN3        IFEQ      *BLANKS
     C     DIRUN2        ANDNE     *BLANKS
     C                   MOVEL     DIXXV1        WSROA1
     C                   MOVEL     DIRUNR        WSROB1
     C                   Z-ADD     DIDAG1        WSROC1
     C                   MOVEL     DITIL         WSROA2
     C                   MOVEL     DIRUN2        WSROB2
     C                   Z-ADD     DIDAG2        WSROC2
     C                   ENDIF
     C     DIRUN3        IFNE      *BLANKS
     C     DIRUN2        ANDNE     *BLANKS
     C                   MOVEL     DIXXV1        WSROA1
     C                   MOVEL     DIRUNR        WSROB1
     C                   Z-ADD     DIDAG1        WSROC1
     C                   MOVEL     DIXXV2        WSROA2
     C                   MOVEL     DIRUN2        WSROB2
     C                   Z-ADD     DIDAG2        WSROC2
     C                   MOVEL     DITIL         WSROA3
     C                   MOVEL     DIRUN3        WSROB3
     C                   Z-ADD     DIDAG3        WSROC3
     C                   ENDIF
     C                   Z-ADD     DIANT         LANUMC
     C                   Z-ADD     DIANT         LANUMP
     C                   Z-ADD     DIVEKT        LAWGHT
     C                   MOVEL     *BLANKS       LAHAIN
     C                   ENDIF                                                  <*IN90
     C                   ENDIF                                                  <*IN90
     C                   ENDIF
     C                   ENDIF
      *
     C     WSKUNF        IFNE      *ZEROS
     C     LASHP1        ANDEQ     *BLANKS
     C                   Z-ADD     WSKUNF        WKUND             8 0
     C     CUNDKI        CHAIN     CUNDL01                            90
     C     *IN90         IFEQ      *OFF
     C                   MOVEL     KNAVN         LASHP1
     C                   MOVEL     ADR1          LASHP2
     C                   MOVEL     ADR2          LASHP3
     C                   MOVEL     POSTNR        LASHP4
     C                   MOVE      ADR3          LASHP4
     C                   ENDIF
     C                   ENDIF
      *
     C     WSKUNT        IFNE      *ZEROS
     C     LACNE1        ANDEQ     *BLANKS
     C                   Z-ADD     WSKUNT        WKUND             8 0
     C     CUNDKI        CHAIN     CUNDL01                            90
     C     *IN90         IFEQ      *OFF
     C                   MOVEL     KNAVN         LACNE1
     C                   MOVEL     ADR1          LACNE2
     C                   MOVEL     ADR2          LACNE3
     C                   MOVEL     POSTNR        LACNE4
     C                   MOVE      ADR3          LACNE4
     C                   ENDIF
     C                   ENDIF
      *
     C     TEST99        ENDSR
      *
      ******************************************
     C     PRINT         BEGSR
      ******************************************
     C     WNHEG3        CHAIN     ISUL01                             90
     C     *IN90         CABEQ     '1'           ENDPR3
     C                   MOVEL     ISPART        LAPAID
     C                   MOVEL     'LAI'         LAMEID
     C                   MOVEL     DIVPRT        LAPRID
     C     1             CHAIN     CNFF                               90
     C     *IN90         CABEQ     '1'           ENDPR3
     C                   ADD       1             CNRECN
     C                   UPDATE    CNFR
     C     ISPART        CHAIN     PARL01                             90
     C     *IN90         CABEQ     '1'           ENDPR3
     C                   MOVEL     LABNAM        LAISTX
     C                   Z-ADD     CNRECN        LARECN
     C                   MOVEL     LAAWBN        WW1
     C                   MOVEL     WSFROM        WW2
     C                   MOVE      LAAWBN        WW3
     C                   MOVEL     WSTO          LADCTY
     C     SERCDE        IFEQ      'P'
     C                   MOVEL     PCARGO        LASERC
     C                   ELSE
N03  C     SERCDE        IFEQ      'Z'
N03  C                   MOVEL     TDFLAS        LASERC
N03  C                   ELSE
     C                   MOVEL     *BLANKS       LASERC
N03  C                   ENDIF
     C                   ENDIF
     C     WSROA1        IFNE      *BLANKS
     C                   MOVEL     WSROA1        WWA
     C                   MOVEL     WSROB1        WWB
     C                   MOVEL     '/'           WWC
     C                   MOVEL     WSROC1        WWD
     C                   MOVEL     ROUTIN        LARTN1
     C                   ENDIF
     C     WSROA2        IFNE      *BLANKS
     C                   MOVEL     *BLANKS       ROUTIN
     C                   MOVEL     WSROA2        WWA
     C                   MOVEL     WSROB2        WWB
     C                   MOVEL     '/'           WWC
     C                   MOVEL     WSROC2        WWD
     C                   MOVEL     ROUTIN        LARTN2
     C                   ENDIF
     C     WSROA3        IFNE      *BLANKS
     C                   MOVEL     *BLANKS       ROUTIN
     C                   MOVEL     WSROA3        WWA
     C                   MOVEL     WSROB3        WWB
     C                   MOVEL     '/'           WWC
     C                   MOVEL     WSROC3        WWD
     C                   MOVEL     ROUTIN        LARTN3
     C                   ENDIF
     C     WSROA4        IFNE      *BLANKS
     C                   MOVEL     *BLANKS       ROUTIN
     C                   MOVEL     WSROA4        WWA
     C                   MOVEL     WSROB4        WWB
     C                   MOVEL     '/'           WWC
     C                   MOVEL     WSROC4        WWD
     C                   MOVEL     ROUTIN        LARTN4
     C                   ENDIF
     C     WSROA5        IFNE      *BLANKS
     C                   MOVEL     *BLANKS       ROUTIN
     C                   MOVEL     WSROA5        WWA
     C                   MOVEL     WSROB5        WWB
     C                   MOVEL     '/'           WWC
     C                   MOVEL     WSROC5        WWD
     C                   MOVEL     ROUTIN        LARTN5
     C                   ENDIF
     C     LAHNUM        IFGT      *ZEROS
     C     LAHWGT        ANDGT     *ZEROS
     C                   MOVE      'H'           LAHCDE
     C                   ELSE
     C                   MOVE      ' '           LAHCDE
     C                   ENDIF
      *
     C                   WRITE     LABR
      *
     C     ENDPR3        ENDSR
      ***********************************************
     C     SNDDTA        BEGSR
      ***********************************************
     C                   MOVEL     'SMADTARQ'    QTNAME           10
     C                   MOVEL     '*LIBL'       QTLIB            10
     C                   Z-ADD     9             QTLEN             5 0
     C                   MOVE      *BLANKS       QTFIEL            9
     C                   Z-ADD     LARECN        WARECA
     C                   MOVE      WARECA        QTFIEL
     C                   Z-ADD     9             QKILEN            3 0
     C                   MOVE      *BLANKS       QKEY              9
     C                   MOVEL     'LAI'         QKEY
     C                   CALL      'QSNDDTAQ'
     C                   PARM                    QTNAME
     C                   PARM                    QTLIB
     C                   PARM                    QTLEN
     C                   PARM                    QTFIEL
     C                   PARM                    QKILEN
     C                   PARM                    QKEY
      *
     C                   ENDSR
      ******************************************
     C     PRINT2        BEGSR
      ******************************************
     C     WNHEG3        CHAIN     ISUL01                             90
     C  N90ISPART        CHAIN     PARL01                             90
      * SJEKK OM DET ER KORREKT PRINTER ANGITT I PAPIRTYPE
     C     KOPTY         IFEQ      'ZEBRA 95'
N01  C     KOPTY         OREQ      'ZEBRA   '
     C     KOPTY         OREQ      'STRIPE  '
     C     KOPTY         OREQ      'ELTRON  '
     C     *IN90         IFEQ      *ON
     C     LABNAM        OREQ      *BLANKS
     C                   MOVEL     FIKRTN        DOISTX
     C                   ELSE
     C                   MOVEL     LABNAM        DOISTX
     C                   ENDIF
     C                   MOVEL     KOPNVN        LAPRID
     C                   MOVEL     LAAWBN        WW1
     C                   MOVEL     WSFROM        WW2
     C                   MOVE      LAAWBN        WW3
     C                   MOVEL     WSTO          LADCTY
     C     SERCDE        IFEQ      'P'
     C                   MOVEL     PCARGO        LASERC
     C                   ELSE
N03  C     SERCDE        IFEQ      'Z'
N03  C                   MOVEL     TDFLAS        LASERC
N03  C                   ELSE
     C                   MOVEL     *BLANKS       LASERC
N03  C                   ENDIF
     C                   ENDIF
     C                   MOVEL     *BLANKS       LARTN1
     C                   MOVEL     *BLANKS       LARTN2
     C                   MOVEL     *BLANKS       LARTN3
     C                   MOVEL     *BLANKS       LARTN4
     C                   MOVEL     *BLANKS       LARTN5
     C     WSROA1        IFNE      *BLANKS
     C                   MOVEL     WSROA1        WWA
     C                   MOVEL     WSROB1        WWB
     C                   MOVEL     '/'           WWC
     C                   MOVEL     WSROC1        WWD
     C                   MOVEL     ROUTIN        LARTN1
     C                   ENDIF
     C     WSROA2        IFNE      *BLANKS
     C                   MOVEL     *BLANKS       ROUTIN
     C                   MOVEL     WSROA2        WWA
     C                   MOVEL     WSROB2        WWB
     C                   MOVEL     '/'           WWC
     C                   MOVEL     WSROC2        WWD
     C                   MOVEL     ROUTIN        LARTN2
     C                   ENDIF
     C     WSROA3        IFNE      *BLANKS
     C                   MOVEL     *BLANKS       ROUTIN
     C                   MOVEL     WSROA3        WWA
     C                   MOVEL     WSROB3        WWB
     C                   MOVEL     '/'           WWC
     C                   MOVEL     WSROC3        WWD
     C                   MOVEL     ROUTIN        LARTN3
     C                   ENDIF
     C     WSROA4        IFNE      *BLANKS
     C                   MOVEL     *BLANKS       ROUTIN
     C                   MOVEL     WSROA4        WWA
     C                   MOVEL     WSROB4        WWB
     C                   MOVEL     '/'           WWC
     C                   MOVEL     WSROC4        WWD
     C                   MOVEL     ROUTIN        LARTN4
     C                   ENDIF
     C     WSROA5        IFNE      *BLANKS
     C                   MOVEL     *BLANKS       ROUTIN
     C                   MOVEL     WSROA5        WWA
     C                   MOVEL     WSROB5        WWB
     C                   MOVEL     '/'           WWC
     C                   MOVEL     WSROC5        WWD
     C                   MOVEL     ROUTIN        LARTN5
     C                   ENDIF
     C     LAHNUM        IFGT      *ZEROS
     C     LAHWGT        ANDGT     *ZEROS
     C                   MOVE      'H'           LAHCDE
     C                   ELSE
     C                   MOVE      ' '           LAHCDE
     C                   ENDIF
      * Hvis info ikke er hentet fra ett oppdrag lages dummy
      * oppdrag og avdeling fra jobbnummer og klokkeslett.
      * Husk. Recorden slettes etter at utskrift er ferdig.
     C     HEAVD         IFNE      *ZEROS
     C     HEOPD         ANDNE     *ZEROS
     C                   Z-ADD     HEAVD         LAAVD
     C                   Z-ADD     HEOPD         LAOPD
     C                   ELSE
     C                   Z-ADD     JOB           LAOPD
      * TID er dobbeldefinert med LAAVD slik at min/sek legges i LAAVD
     C                   TIME                    TID
     C                   ENDIF
      *
     C                   WRITE     DOLAR
      *
     C                   Z-ADD     LAAVD         AVD               4 0
N02  C                   MOVEL     DIVPRT        KOPNVN
     C                   CALL      'SYLA01C'
     C                   PARM                    AVD
     C                   PARM                    LAOPD
     C                   PARM                    KOPTY
     C                   PARM                    KOPNVN
      *
     C     DORECN        CHAIN     DOLAR                              90
     C     *IN90         IFEQ      *OFF
     C                   DELETE    DOLAR                                90
     C                   ENDIF
      *
     C                   ENDIF                                                  <WOPTY
      *
     C     ENDPR         ENDSR
N06   ******************************************
N06  C     PRINTMP       BEGSR
N06   ******************************************
N06   * merkelapper i pdf
N06   *
N06  c                   move      dfavd         dfavda            4
N06  c                   move      dfopd         dfopda            7
N06  c                   move      dflop         dflopa            3
N06  c                   movel     hesaml        dfsama            6
N06  c                   call      'SYEF14MCL'
N06  c                   parm                    dfavda
N06  c                   parm                    dfopda
N06  c                   parm                    dflopa
N06  c                   parm                    dfsama
N06  C                   PARM                    KOPNVN
N06  c                   endsr
