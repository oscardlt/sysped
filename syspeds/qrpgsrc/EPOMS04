OBS!! * OBS!!! automatisk mail sendes hos SYSTEMA hardkodet til janottar@systema.no
OBS!! *        HOS CC/I PROD går den til innkjøpers mailadr (blank->kenneth.johansen@europris.no)
      *********************************************************************
      *
      *
CRTPG+*  CRTPGM SYSPED/EPOMS04 MODULE(*LIBL/EPOMS04
CRTPGM*        *LIBL/CHECKUSR *LIBL/INCGI) ACTGRP(CGI) AUT(*USE)
      *
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 KOLLI, VEKT KUBIKK
10261 * 02 YBC PTF10 VEKT/KUBIKK I TURER ER ENDRET TIL 9.0 OG 7.3
10261 * 03 jov PTF10 kan sette avvikende POL/POD(=Post Of Loading/Discharge, fra/til-sted)
10XXX *              Statusfelt i EPOTT - T&T-hendeses skal sendes som mail hvis S
10XXX * 04 YBC PTF10 VED NY SPLITTET LINJE: ENDRING AV ANTALL BETYR SLUTTMERKES
10XXX * 05 JOV PTF10 Send mail dersom POL/POD er endret
10XXX * 06 YBC PTF10 Bevare opprinnelig datoer til rest-linje
10XXX * 07 YBC PTF10 LINJE-INFORMASJON ETTER SUMMERING AV VEKT TIL HEADING
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11XXX * 08 YBC PTF11 backbuttom med onmouseover/onmouseout
11XXX * 09 YBC PTF11 ARBEID MED KOLLI
11XXX * 10 YBC PTF11 IKKE MERKELAPP FØR IO ER BEKREFTET PÅ HODE-NIVÅ.
      *              ALLE LOGIKK MED XSENDEDI=J Å GJØRE ER VERDILØS NÅ.
11XXX * 11 YBC PTF11 CCLT ÅRSAK TIL GODS FORSINKET. ELTRNV BRUKES.
********************************************************************
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     UF   E           K DISK    USROPN
     FEPOL      UF A E           K DISK    USROPN
N09  FEPOLT     UF A E           K DISK    USROPN
N09  FEPOAT     UF A E           K DISK    USROPN
N09  FEPOK      UF   E           K DISK    USROPN
N09  FEPOKLOG   O  A E             DISK    USROPN
     FEPOH      UF   E           K DISK    USROPN
     FEPOTT     IF A E           K DISK    USROPN
N09  FARKIVL02  IF   E           K DISK    USROPN
N09  FFIRMARC   IF   E           K DISK    usropn
N09  FARKTXT    IF   E           K DISK    usropn
N09  FARKEXT    IF   E           K DISK    usropn
     FHEADF     UF   E           K DISK    USROPN
     FTURER14   UF   E           K DISK    USROPN
     FBRPARF    IF   E           K DISK    USROPN
     FCundL01   IF   E           K DISK    USROPN
N03  FSTED2     IF   E           K DISK    USROPN
     FKALENDER  IF   E           K DISK    USROPN
      *********************************************************************
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      /copy syspeds/qrpgsrcpy,variables3
      *
     D OddEven         s             10
     0* Client input variables
     D user            s             10
     D UsrSpcName      s             10
     D WSKN            S              8
     D BSKN            S              8  0
N09  D WSDIR           s              1
     D ELBES           s             10
     D ELLINA          s              7
     D ELULINA         s              5
N09  D WSARTL          s             35
N09  D WSARTE          s             35
N09  D WSPRIS          S             12
N09  D WSPRISN         S             11  2
     D WSSTA3          s              1
     D*WSTTD           s             10
     D WSTTDN          s              8  0
     D WSETD           s             10
     D WSETDN          s              8  0
     D WSETDB          s             10
     D WSETDBN         s              8  0
     D WSETA           s             10
     D WSETAN          s              8  0
     D WSETAB          s             10
     D WSETABN         s              8  0
     D*WSSTD           s             10
     D WSSTDN          s              8  0
     D XDIFF           s              9  0
     D WSNTSL          s              9
     D WSNTSLN         s              9  0
     D WSNTKL          s              7
     D WSNTKLN         s              7  0
     D WSSLUT          s              1
     D WSVKTL          s             12
     D WSVKTLN         s             11  3
     D WSVKNL          s             12
     D WSVKNLN         s             11  3
     D WSM3L           s              9
     D WSM3LN          s              7  3
     D WSVKTE          s             12
     D WSVKTEN         s             11  3
     D WSVKNE          s             12
     D WSVKNEN         s             11  3
     D WSM3E           s             12
     D WSM3EN          s             11  7
     D WSBLNR          s             16
     D WSORIG          s              1
     D WSSTA           S              5
     D StatChgd        S              1
     D WSREAS          S              3
n03  D WSFLK           s              2
n03  D WSFSTE          s              5
n03  D WSTLK           s              2
n03  D WSTSTE          s              5
     D WSSUBM          S              1
     D AVSLUTT         S              1
N09  D WSTNNE          S              8
N09  D WSTNNEN         S              8  0
N09  D WSTNNE_T        S              8
N09  D WSTNNEN_T       S              8  0
N09  D PRTMLP          S              1
     D FMELDNR         S              2
S04  D*FEILMELDING     S             80
N04  D FEILMELDING     S            120
     D EXTRAMELD       S             80
     D WSRORD1         S              1
     D BigNum          s             19  9
     D PGM             C                   CONST('SYSPED/CHECKUSR')
      *
     D From            s              8
     D To              s              8
     D STATUS          S            100
     D REASON          S            100
     D Title           S            100
      *
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
     D ItemCount       s             10i 0
     D i               s             10i 0
      * For xlate mellom Upper Case og Lower Case
     D UC              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZÆØÅ')
     D LC              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzæøå')
     D                 DS
     D DT8                     1      8  0
     D  DTÅ                    1      4  0
     D  DTM                    5      6  0
     D  DTD                    7      8  0
      *
      /copy syspeds/qrpgsrcpy,prolog3
      *
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input / cvt to numeric
     C                   exsr      Parse
      * File open / keys
     C                   EXSR      INIT
      *
     C                   CALLB     PGM
     C                   PARM                    BIBRID
     C                   PARM                    UsrSpcName
     C                   PARM                    UINN              1
     C                   IF        UINN = 'N'
     C                   GOTO      SLUTT
     C                   END
      * dato/tid siste vellykkede operasjon.
     C     USER          CHAIN     BRIDF                              50
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           BIDTF
     C                   MOVE      WTM           BITIDF
     C                   UPDATE    BRIDFR
      * Read output skeleton html member into memory
     C                   exsr      LoadHtml
      * Set section variables
N09   * DIREKT SENDING
N09  C                   IF        WSDIR = 'J'
N09  C                   EXSR      SRDIRECT
N09  C                   END
     C                   exsr      Settop
     C                   callp     wrtsection('top')
N09   *
N09   * DIREKT SENDING
N09  C                   IF        WSDIR = 'J'
N09  C                   callp     wrtsection('TTSLUTT')
N09  C                   GOTO      SLUTT
N09  C                   END
N09   *
N09  C                   IF        XJOBBKL = 'J'
N09  C                   callp     wrtsection('TopCl11')
N11  C                   exsr      SLDELAY
N09  C                   callp     wrtsection('TopCl13')
N09  C                   callp     wrtsection('TopCl21')
N09  C                   ELSE
N09  C                   callp     wrtsection('TopCl12')
N09  C                   callp     wrtsection('TopCl13')
N09  C                   callp     wrtsection('TopCl22')
     C                   exsr      SLTREASON
     C                   callp     wrtsection('bot')
N09  C                   END
N09  C                   callp     wrtsection('BotCl')
     C                   exsr      DSPTT
      *
      * Quit
      * Compute run time
      *
     C     SLUTT         TAG
     C                   exsr      Exit
      *
     C                   eval      *inlr = *on
     C                   return
      *
N11   ****************************************************
N11  C     SLDELAY       BEGSR
N11   ****************************************************
N11  C                   IF        USER = 'LTPOMS'
N11   * Select new delay-code..
N11   *
N11  C                   callp     wrtsection('DelayTop')
N11  C                   IF        WSREAS = *BLANKS
N11  C                   callp     updhtmlvar('SLDELAY':'')
N11  C                   callp     updhtmlvar('CDELAY':'')
N11  C                   callp     updhtmlvar('FDELAY':'On time')
N11  C                   callp     wrtsection('Delayrow')
N11  C                   END
N11   *
N11  C                   MOVE      *ZEROS        XN                3 0
N11  C                   MOVEL     'POMDL'       PAID
N11  C                   MOVE      BIBRID        PABRID
N11  C     BRPARFK       CHAIN     BRPARF                             33
N11  c   33              Eval      PABRID = '*KUNDFT*'+BIFIRM
N11  C   33BRPARFK       CHAIN     BRPARF                             33
N11  C                   DOW       *IN33 = *OFF
N11  C                   ADD       1             XN
N11  C                   MOVEL     PAVRDA        XAN02             2
N11  C                   callp     updhtmlvar('CDELAY':XAN02)
N11  C                   callp     updhtmlvar('FDELAY':%SUBST(PAVRDA:4:47))
N11  C                   IF        XAN02 = WSREAS
N11  C                   callp     updhtmlvar('SLDELAY':'SELECTED')
N11  C                   else
N11  C                   callp     updhtmlvar('SLDELAY':'')
N11  C                   END
N11  C                   callp     wrtsection('Delayrow')
N11  C     BRPARFK       READE     BRPARF                                 33
N11  C                   ENDDO
N11   *
N11  C                   callp     wrtsection('DelayBot')
N11   *
N11  C                   ELSE
N11  C                   EVAL      %SUBST(PAVRDA:4:47) = 'On time'
N11  C                   MOVEL     'POMDL'       PAID
N11  C                   MOVE      BIBRID        PABRID
N11  C     BRPARFK       CHAIN     BRPARF                             33
N11  c   33              Eval      PABRID = '*KUNDFT*'+BIFIRM
N11  C   33BRPARFK       CHAIN     BRPARF                             33
N11  C                   DOW       *IN33 = *OFF
N11  C                   IF        WSREAS = %SUBST(PAVRDA:1:2)
N11  C                   LEAVE
N11  C                   END
N11  C     BRPARFK       READE     BRPARF                                 33
N11  C                   ENDDO
N11  C                   callp     updhtmlvar('WSDELAY':%SUBST(PAVRDA:4:47))
N11  C                   callp     wrtsection('DelayDsp')
N11  C                   END
N11   *
N11  C                   ENDSR
N11   *
      ****************************************************
     C     SLTREASON     BEGSR
      ****************************************************
      * Select new reason-code..
     C                   callp     wrtsection('Reasontop')
      *
     C                   IF        WSREAS = *BLANKS
     C                   callp     updhtmlvar('SLREASON':'')
     C                   callp     updhtmlvar('RKD':'')
     C                   callp     updhtmlvar('RFT':' -- blank -- ')
     C                   callp     wrtsection('Reasonrow')
     C                   END
      *
     C                   MOVE      *ZEROS        XN                3 0
     C                   MOVEL     'POMRC'       PAID
     C                   MOVE      BIBRID        PABRID
     C     BRPARFK       CHAIN     BRPARF                             33
     c   33              Eval      PABRID = '*KUNDFT*'+BIFIRM
     C   33BRPARFK       CHAIN     BRPARF                             33
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   MOVEL     PAVRDA        XAN03             3
     C                   callp     updhtmlvar('RKD':XAN03)
     C                   callp     updhtmlvar('RFT':PAVRDA)
     C                   IF        XAN03 = WSREAS
     C                   callp     updhtmlvar('SLREASON':'SELECTED')
     C                   else
     C                   callp     updhtmlvar('SLREASON':'')
     C                   END
     C                   callp     wrtsection('Reasonrow')
     C     BRPARFK       READE     BRPARF                                 33
     C                   ENDDO
      *
     C                   callp     wrtsection('ReasonBot')
      *
     C                   ENDSR
      *
      ****************************************************
     C     DSPTT         BEGSR
      ****************************************************
     C                   callp     wrtsection('TTSTART')
     C     EPOTTK        SETLL     EPOTT
     C     EPOTTK        READE     EPOTT                                  33
     c                   DOW       *IN33 = *OFF
     C                   callp     updHTMLvar('ETDATE':
     C                             %trim(%editw(ETDATE:'    .  .  ')))
     C                   callp     updHTMLvar('ETTIME':
     C                             %trim(%editw(ETTIME:'  :  :  ')))
     C                   callp     updhtmlvar('ETTEXT':ETTEXT)
     C                   callp     updhtmlvar('ETUSER':ETUSER)
     C                   callp     wrtsection('TTROW')
     C     EPOTTK        READE     EPOTT                                  33
     C                   ENDDO
      *
     C                   callp     wrtsection('TTSLUTT')
      *
     C                   ENDSR
      *
      *=====================================================================
      * Parse input / cvt to numeric
      *=====================================================================
     C     Parse         begsr
      * Userid.....
     C                   eval      user = zhbgetvar('user')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   eval      WSKN    = zhbgetvar('WSKN')
     C                   eval      BSKN    = c2n2(WSKN)
N09  c                   eval      WSDIR    = zhbgetvar('WSDIR')
     c                   eval      ELBES    = zhbgetvar('ELBES')
     C                   eval      ELLINA   = zhbgetvar('ELLIN')
     C                   eval      ELLIN    = c2n2(ELLINA)
     C                   eval      ELULINA  = zhbgetvar('ELULIN')
     C                   eval      ELULIN   = c2n2(ELULINA)
      *
N09  C                   eval      WSTNNE  = zhbgetvar('WSTNNE')
N09  C                   eval      WSTNNEN  = c2n2(WSTNNE)
N09  C                   eval      WSTNNE_T = zhbgetvar('WSTNNE_T')
N09  C                   eval      WSTNNEN_T = c2n2(WSTNNE_T)
N09  C                   eval      WSPRIS  = zhbgetvar('WSPRIS')
N09  C                   eval      WSPRISN = c2n2(WSPRIS)
N09  C                   eval      WSARTL  = zhbgetvar('WSARTL')
N09  C     LC:UC         XLATE     WSARTL        WSARTL
N09  C                   eval      WSARTE  = zhbgetvar('WSARTE')
N09  C     LC:UC         XLATE     WSARTE        WSARTE
     C*                  eval      WSTTD   = zhbgetvar('WSTTD')
     C*                  EVAL      WSTTDN  = c2n2(WSTTD)
     C                   eval      WSETD   = zhbgetvar('WSETD')
     C                   EVAL      WSETDN  = c2n2(WSETD)
     C                   eval      WSETDB  = zhbgetvar('WSETDB')
     C                   EVAL      WSETDBN = c2n2(WSETDB)
     C                   eval      WSETA   = zhbgetvar('WSETA')
     C                   EVAL      WSETAN  = c2n2(WSETA)
     C                   eval      WSETAB  = zhbgetvar('WSETAB')
     C                   EVAL      WSETABN = c2n2(WSETAB)
     C*                  eval      WSSTD   = zhbgetvar('WSSTD')
     C*                  EVAL      WSSTDN  = c2n2(WSSTD)
     C                   eval      WSVKTE  = zhbgetvar('WSVKTE')
     C                   EVAL      WSVKTEN = c2n2(WSVKTE)
     C                   eval      WSVKNE  = zhbgetvar('WSVKNE')
     C                   EVAL      WSVKNEN = c2n2(WSVKNE)
     C                   eval      WSM3E   = zhbgetvar('WSM3E')
     C                   EVAL      WSM3EN  = c2n2(WSM3E)
     C                   eval      WSNTSL  = zhbgetvar('WSNTSL')
     C                   EVAL      WSNTSLN = c2n2(WSNTSL)
     C                   eval      WSNTKL  = zhbgetvar('WSNTKL')
     C                   EVAL      WSNTKLN = c2n2(WSNTKL)
     C                   eval      WSSLUT  = zhbgetvar('WSSLUT')
     C                   eval      WSVKTL  = zhbgetvar('WSVKTL')
     C                   EVAL      WSVKTLN = c2n2(WSVKTL)
     C                   eval      WSM3L   = zhbgetvar('WSM3L')
     C                   EVAL      WSM3LN  = c2n2(WSM3L)
     C                   eval      WSVKNL  = zhbgetvar('WSVKNL')
     C                   EVAL      WSVKNLN = c2n2(WSVKNL)
     C                   eval      WSBLNR  = zhbgetvar('WSBLNR')
     C     LC:UC         XLATE     WSBLNR        WSBLNR
     C                   eval      WSORIG  = zhbgetvar('WSORIG')
     C     LC:UC         XLATE     WSORIG        WSORIG
     C                   eval      WSSTA   = zhbgetvar('WSSTA')
     C                   eval      WSRORD1 = zhbgetvar('WSRORD1')
      *
     C                   eval      WSREAS  = zhbgetvar('WSREAS')
N03  C                   eval      WSFLK   = zhbgetvar('WSFLK')
N03  C     LC:UC         XLATE     WSFLK         WSFLK
N03  C                   eval      WSFSTE  = zhbgetvar('WSFSTE')
N03  C     LC:UC         XLATE     WSFSTE        WSFSTE
N03  C                   eval      WSTLK   = zhbgetvar('WSTLK')
N03  C     LC:UC         XLATE     WSTLK         WSTLK
N03  C                   eval      WSTSTE  = zhbgetvar('WSTSTE')
N03  C     LC:UC         XLATE     WSTSTE        WSTSTE
N03  C                   eval      WSSUBM  = zhbgetvar('WSSUBM')
N03  C                   eval      WSSTA3  = zhbgetvar('WSSTA3')
      *
     C*                  IF        (WSRORD1 = *BLANKS AND WSSTA3 = 'R') OR
     C*                            ELULIN = 99999
      * IKKE LOV Å ENDRE EN SPLITTET LINJE FØR DEN ER SENDT.
     C*                  EVAL      UsrSpcName  = *BLANKS
     C*                  END
      *
     C                   endsr
      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      * Quit
     C                   CLOSE     BRIDF
     C                   CLOSE     CUNDL01
     C                   CLOSE     EPOL
N09  C                   CLOSE     EPOLT
N09  C                   CLOSE     EPOAT
N09  C                   CLOSE     EPOK
N09  C                   CLOSE     EPOKLOG
     C                   CLOSE     EPOH
     C                   CLOSE     EPOTT
N09  C                   CLOSE     ARKIVL02
N09  C                   CLOSE     FIRMARC
N09  C                   CLOSE     ARKTXT
N09  C                   CLOSE     ARKEXT
     C                   CLOSE     HEADF
     C                   CLOSE     TURER14
     C                   CLOSE     BRPARF
N03  C                   CLOSE     STED2
     C                   CLOSE     KALENDER
     C                   endsr
      *=====================================================================
      * Read output skeleton html member into memory
      *=====================================================================
     C     LoadHtml      begsr
     c                   callp     gethtmlifs(
cccccC                             '/syspeddev/html/EPOMS04.html':
cccccC                             '/CGITAG/')
     C                   endsr
      *=====================================================================
      *  Set variable data for section /$top
      *=====================================================================
     C     SetTOP        begsr
      * Sjekk om uferdig restlinje PÅ GANG (STA3=R eller ULIN 99999)- i så fall PROTECT
     c                   move      ELULIN        TMPULIN           5 0
     c                   move      'N'           Protect           1
     C     KeyL          SETLL     EPOL
     C     KeyL          READE(N)  EPOL                                   33
     C                   DOW       *IN33 = *OFF
     c                   if        ELSTA3='R' or ELULIN=99999
     c                   move      'J'           Protect
     c                   leave
     c                   endif
     C     KeyL          READE(N)  EPOL                                   33
     C                   ENDDO
     c                   move      TMPULIN       ELULIN
      *
      * VERDIER som kan endres flyttes til WSvariable kun første gang (WSSUBM=blank)
      * finn rett linje ved evt splitt (Lin/rst-lin kan ha samme nr STA3=blank/R eneste skille)
     C     KEY           CHAIN(N)  EPOL                               33
     C                   DOW       *IN33 = *OFF
     C                   IF        WSSTA3 = ELSTA3
     C                   LEAVE
     C                   END
     C     KEY           READE(N)  EPOL                                   33
     C                   ENDDO
N09  C     WSDIR         CABEQ     'Y'           STSTDIR
N09  C  N33              IF        XJOBBKL = 'J'
N09  C     KEY           CHAIN(N)  EPOLT                              33
N09  C     EPOATK        CHAIN(N)  EPOAT                              33
N09  C  N33              IF        ELTNNE = 0 AND ETTNNE = 0
N09  C                   EVAL      ELTNNE = EATNN1
N09  C                   EVAL      ETTNNE = EATNN2
N09  C                   END
N09  C  N33              IF        ELVKTL = 0
N09  C                   EVAL      ELVKTL = ELNTSL * EAVKTE
N09  C                   EVAL      ELVKTE = EAVKTE
N09  C                   END
N09  C  N33              IF        ELVKNL = 0
N09  C                   EVAL      ELVKNL = ELNTSL * EAVKNE
N09  C                   EVAL      ELVKNE = EAVKNE
N09  C                   END
N09  C  N33              IF        ELM3L = 0
N09  C                   EVAL      ELM3L = ELNTSL * EAM3E
N09  C                   EVAL      ELM3E = EAM3E
N09  C                   END
N09  C                   END
      *
     C                   IF        WSSUBM = ' '
     c                   exsr      GETCHG
     c                   else
      * Y=Submit/kontroll av allerde vist bilde: TEST / Alt OK=>Update og sett var for close..
     c                   exsr      TSTCHG
     c     FMELDNR       ifeq      *blanks
N09  C                   IF        XJOBBKL <> 'J' OR EHSTA <> '5'
     c                   exsr      UPDCHG
N09  C                   END
N09  C                   IF        XJOBBKL = 'J' AND EHSTA <> '5'
N09  C                   CALL      'EPOMS04B'
N09  C                   PARM                    ELKUND
N09  C                   PARM                    ELBES
N09  C                   PARM                    ELLIN
N09  C                   PARM                    ELULIN
N09  C                   MOVE      ELKUND        WKN               8
N09  C                   MOVE      ELLIN         WLIN              7
N09  C                   MOVE      ELULIN        WULIN             5
N09  C                   CALL      'CC023R'
N09  C                   PARM                    WKN
N09  C                   PARM                    ELBES
N09  C                   PARM                    WLIN
N09  C                   PARM                    WULIN
N09  C                   END
     c                   IF        AVSLUTT = ' '
     c                   eval      AVSLUTT = 'Y'                                Gir 'self.close'
     c                   END
     c                   endif
     c                   endif
      *
      * Klargjør neste visning (ved avslutt=Y KUNNE en hoppe det meste her,men lite tid å spare)
     C                   callp     updHTMLvar('USER':USER)
     C                   callp     updHTMLvar('BIBESK':BIBESK)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHtmlVar('WSKN':
     C                             %trim(%editc(BSKN:'Z')))
     C                   callp     updHTMLvar('KNAVN':KNAVN)
     C                   callp     updHtmlVar('ELBES':ELBES)
     C                   callp     updHtmlVar('ELLIN ':
     C                             %trim(%editc(ELLIN :'Z')))
     C                   callp     updHtmlVar('ELULIN':
     C                             %trim(%editc(ELULIN:'Z')))
N09  C                   callp     updHTMLvar('WSTNNE':
N09  C                             %trim(%editc(WSTNNEN:'Z')))
N09  C                   callp     updHTMLvar('WSTNNE_T':
N09  C                             %trim(%editc(WSTNNEN_T:'Z')))
N09  C                   callp     updHTMLvar('WSPRIS':
N09  C                             %trim(%editc(WSPRISN:'4')))
N09  C     KEYH          CHAIN(N)  EPOH                               33
N09  C                   callp     updhtmlvar('EHITLF':EHITLF)
N09  C                   callp     updhtmlvar('PRTMLP':PRTMLP)
N09  C                   callp     updhtmlvar('LABELTYP':LabelTyp)
N09  C                   IF        XJOBBKL = 'J'
N09  C                   callp     updhtmlvar('WSREAS':'')
N09  C                   END
      *
     C*                  callp     updHTMLvar('WSTTD':
     C*                            %trim(%editw(WSTTDN:'    .  .  ')))
     C                   callp     updHTMLvar('ELTTD':
     C                             %trim(%editw(ELTTD:'    .  .  ')))
     C                   callp     updHTMLvar('WSETD':
     C                             %trim(%editw(WSETDN:'    .  .  ')))
     C                   callp     updHTMLvar('WSETDB':
     C                             %trim(%editw(WSETDBN:'    .  .  ')))
     C                   callp     updHTMLvar('WSETA':
     C                             %trim(%editw(WSETAN:'    .  .  ')))
     C                   callp     updHTMLvar('WSETAB':
     C                             %trim(%editw(WSETABN:'    .  .  ')))
     C*                  callp     updHTMLvar('WSSTD':
     C*                            %trim(%editw(WSSTDN:'    .  .  ')))
     C                   callp     updHTMLvar('ELSTD':
     C                             %trim(%editw(ELSTD:'    .  .  ')))
     C                   callp     updHTMLvar('ELART':ELART)
     C                   callp     updHTMLvar('ELARTL':ELARTL)
     C                   callp     updHTMLvar('ELARTE':ELARTE)
     C                   callp     updHTMLvar('ELABES':ELABES)
N09  C                   callp     updHTMLvar('ETBES1':ETBES1)
N09  C                   callp     updHTMLvar('ETREF1':ETREF1)
N09  C                   callp     updHTMLvar('ETREF2':ETREF2)
N09  C                   callp     updHTMLvar('ELTRNV':ELTRNV)
N09  C                   callp     updHTMLvar('WSARTL':ELARTL)
N09  C                   callp     updHTMLvar('WSARTE':ELARTE)
      *BESTILT
     C                   callp     updHTMLvar('ELANTS':
     C                             %trim(%editc(ELANTS:'Z')))
     C                   callp     updHTMLvar('ELANKL':
     C                             %trim(%editc(ELANKL:'Z')))
     C                   callp     updHTMLvar('ELSTKL':
     C                             %trim(%editc(ELSTKL:'Z')))
     C                   callp     updHTMLvar('WSVKTE':
     C                             %trim(%editc(WSVKTEN:'J')))
     C                   callp     updHTMLvar('WSVKNE':
     C                             %trim(%editc(WSVKNEN:'J')))
     C                   callp     updHTMLvar('WSM3E':
     C                             %trim(%editc(WSM3EN:'J')))
      *LEVERT
     C                   callp     updHTMLvar('WSNTSL':
     C                             %trim(%editc(WSNTSLN:'Z')))
     C                   callp     updHTMLvar('WSNTKL':
     C                             %trim(%editc(WSNTKLN:'Z')))
     C*                  callp     updHTMLvar('ELNTKL':
     C*                            %trim(%editc(ELNTKL:'Z')))
     C                   callp     updHTMLvar('WSVKTL':
     C                             %trim(%editc(WSVKTLN:'J')))
     C                   callp     updHTMLvar('WSVKNL':
     C                             %trim(%editc(WSVKNLN:'J')))
     C*                  callp     updHTMLvar('ELVKTL':
     C*                            %trim(%editc(ELVKTL:'J')))
     C                   callp     updHTMLvar('WSM3L':
     C                             %trim(%editc(WSM3LN:'J')))
     C*                  callp     updHTMLvar('ELM3L':
     C*                            %trim(%editc(ELM3L:'J')))
     C                   callp     updHTMLvar('WSBLNR':WSBLNR)
     C                   callp     updHTMLvar('WSORIG':WSORIG)
N03  C                   callp     updHTMLvar('WSFLK':WSFLK)
N03  C                   callp     updHTMLvar('WSFSTE':WSFSTE)
N03  C                   callp     updHTMLvar('WSTLK':WSTLK)
N03  C                   callp     updHTMLvar('WSTSTE':WSTSTE)
      * status tekst
     c                   select
     c     ELSTA         wheneq    ' '
     c     ELSTA         oreq      '0'
     c                   eval      STATUS = 'Pending'
     c     ELSTA         wheneq    '1'
     c                   eval      STATUS = 'Contacted'
     c     ELSTA         wheneq    '15'
     c                   eval      STATUS = 'Ready for stuffing'
     c     ELSTA         wheneq    '2'
     c                   eval      STATUS = 'Booked'
     c     ELSTA         wheneq    '3'
     c                   eval      STATUS = 'Confirmed'
     c     ELSTA         wheneq    '4'
     c                   eval      STATUS = 'Shipped'
     c     ELSTA         wheneq    '5'
     c                   eval      STATUS = 'Arrived'
     c     ELSTA         wheneq    '6'
     c                   eval      STATUS = '6*Undefined*'
     c                   endsl
     C                   callp     updHTMLvar('STATUS':STATUS)                  Current status
     C                   callp     updHTMLvar('WSSTA':WSSTA)                    NY status
      *
     C                   callp     updHTMLvar('ELREAS':ELREAS)                  Previous Reason
     C                   IF        WSSLUT = 'Y'
     C                   callp     updHTMLvar('WSCHECKED':'checked')
     C                   ELSE
     C                   callp     updHTMLvar('WSCHECKED':'')
     C                   END
     C                   callp     updHTMLvar('AVSLUTT':AVSLUTT)
     C                   callp     updHTMLvar('FMELDNR':FMELDNR)
     C                   callp     updHTMLvar('FEILMELDING':FEILMELDING)
     C                   callp     updHTMLvar('EXTRAMELD':EXTRAMELD)
     C                   callp     updHTMLvar('WSRORD1':WSRORD1)
     C                   IF        WSRORD1 = *BLANKS
     C                   callp     updHtmlVar('WSSTA3':ELSTA3)
     C                   ELSE
     C                   callp     updHtmlVar('WSSTA3':'R')
     C                   END
      * OK/Delete-button vies normalt - men ikke ved alle statuser
     c                   eval      BACKBUTTON='<INPUT TYPE="button" '
     c                             +'VALUE="Back" NAME="BackButton" '
N08  c                             +'onClick="self.close()" '
N08  c                             +'onmouseover="form1.WSNTSL.onblur=null" '
N08  c                             +'onmouseout="form1.WSNTSL.onblur=ChgPcs">'
S08  c*                            +'onClick="self.close()">'
     c                   eval      OKBUTTON ='<INPUT TYPE="SUBMIT" '
     c                             +'VALUE="   OK   ">'
N09  c                   IF        USER = 'LTPOMS' AND ELSTA <= 'C'
N09  c                   eval      DIRBUTTON='<INPUT TYPE="button" '
N09  c                             +'VALUE="Direct" NAME="DirButton" '
N09  c                             +'onClick="DirPO()">'
N09  C                   ELSE
N09  c                   MOVE      *BLANKS       DIRBUTTON       150
N09  C                   END
N09  C                   IF        USER = 'LTPOMS' AND ELSTA = 'E' AND ELAVD > 0
N09  C     ARKIVL02K     CHAIN     ARKIVL02                           33
N09  C     'go'          CHAIN     ARKTXT                             33
N09  C                   IF        *IN33
N09  C                   MOVE      *BLANKS       PDFBUTTON
N09  C                   ELSE
N09  C                   EXSR      GENBANE
N09  C                   END
N09  C                   ELSE
N09  C                   MOVE      *BLANKS       PDFBUTTON       150
N09  C                   END
N09  C                   IF        XJOBBKL = 'J'
N10  C                             AND EHORIG = 'S'
N09  c                   eval      PRTBUTTON='<INPUT TYPE="button" '
N09  c                             +'VALUE="Print" NAME="PrtButton" '
N09  c                             +'onClick="PrtML()">'
N09  c                   MOVE      *BLANKS       DELBUTTON
N09  C                   ELSE
     c                   eval      DELBUTTON='<INPUT TYPE="button" '
     c                             +'VALUE="Delete" NAME="DelButton" '
     c                             +'onClick="DelPOL()">'
N09  c                   MOVE      *BLANKS       PRTBUTTON       150
N09  C                   END
      * Back ut av en restlinje er ikk tillat (blir stående med V) MÅ velge OK eller delete.
     c                   if        EXTRAMELD <> *Blanks
S08  c*                  move      *blanks       BACKBUTTON      150
N08  c                   move      *blanks       BACKBUTTON      250
     C                   endif
      * change/del ikke tillatt....  (men ved SKAPING av REST (EXTRAMELD<> blank) vis OK/DEL)
     c                   if        EXTRAMELD = *blanks  and
     c                             (ELSTA2 = 'S' or ELSTA2 = 'V'                Send / Vent
     c                             or Protect = 'J')                            Uferd restlinje
     c                   move      *blanks       OKBUTTON        150
     c                   move      *blanks       DELBUTTON       150
     c                   eval      OKBUTTON ='<b>OK/Delete not allowed due to '
     c                             +'status.</b>'
     c                   if        Protect = 'J'
     c                   eval      OKBUTTON ='<b>OK/Delete not allowed due to '
     c                             +'unfinished Rest-Line.</b>'
     c                   endif
     c                   endif
N09  C     STSTDIR       TAG
     C                   callp     updHTMLvar('BACKBUTTON':BACKBUTTON)
     C                   callp     updHTMLvar('OKBUTTON':OKBUTTON)
     C                   callp     updHTMLvar('DELBUTTON':DELBUTTON)
N09  C                   callp     updHTMLvar('DIRBUTTON':DIRBUTTON)
N09  C                   callp     updHTMLvar('PRTBUTTON':PRTBUTTON)
N09  C                   callp     updHTMLvar('PDFBUTTON':PDFBUTTON)
      *
     C                   endsr
      *
N09   ***********************************************
N09  C     GENBANE       BEGSR
N09   ***********************************************
N09  C                   MOVE      ARKLAG        ARCEXT
N09  C     ARKEXTK       CHAIN     ARKEXT                             33
N09  C   33ARFIRM        CHAIN     FIRMARC                            33
N09   * genererer bane for lagring
N09  C                   EVAL      PDFBUTTON = '<td><a href="/' + %TRIM(ARCANE)
N09  C                             + '/' + %TRIM(ARLINK) + '" target="_top">'
N09  C                             + 'MANIFEST</a></d>'
N09   *
N09  C                   endsr
N09   *
      ***************************************************
     C     GETCHG        begsr
      ***************************************************
      * Kun data som skal endres trengs over i WS-variable
N09  C                   EVAL      WSTNNEN = ELTNNE
N09  C                   EVAL      WSTNNEN_T = ETTNNE
N09  C                   EVAL      WSPRISN = ETPRIS
     C*                  eval      WSTTDN  = ELTTD
     C                   eval      WSETDN  = ELETD
     C                   eval      WSETDBN = ELETDB
     C                   eval      WSETAN  = ELETA
     C                   eval      WSETABN = ELETAB
     C*                  eval      WSSTDN  = ELSTD
     C                   eval      WSVKTEN = ELVKTE
     C                   eval      WSVKNEN = ELVKNE
     C                   eval      WSM3EN  = ELM3E
     C                   eval      WSNTSLN = ELNTSL
     C                   eval      WSNTKLN = ELNTKL
     C                   eval      WSVKTLN = ELVKTL
     C                   eval      WSVKNLN = ELVKNL
     C                   eval      WSM3LN  = ELM3L
     C                   eval      WSBLNR  = ELBLNR
     C                   eval      WSORIG  = ELORIG
N03  C                   eval      WSFLK   = ELFLK
N03  C                   eval      WSFSTE  = ELFSTE
N03  C                   eval      WSTLK   = ELTLK
N03  C                   eval      WSTSTE  = ELTSTE
N04  C                   eval      WSREAS  = ELREAS
     C*                  eval      WSSTA  = ELSTA
     c     ELSTA2        ifeq      'S'
     c                   eval      FEILMELDING = 'Previous changes'
     c*    ELSTA3        ifeq      'R'
     c*                  eval      FEILMELDING = %trim(FEILMELDING)
     c*                            +' (and reason)'
     c*                  endif
     c                   eval      FEILMELDING = %trim(FEILMELDING)
     c                             +' NOT YET SENT to consignee.'
     c                   endif
     C                   endsr
      *
      ***************************************************
     C     TSTCHG        begsr
      ***************************************************
     C                   MOVE      *blanks       FMELDNR
     C                   MOVE      *blanks       FEILMELDING
N09   *
N09  C                   IF        XJOBBKL = 'J'
N10   * IKKE LOV Å ENDRE ETD FØR IO ER BEKREFTET PÅ HODE-NIVÅ
N10  C                   IF        EHORIG = ' ' AND EHETD <> WSETDN
N10  C                   eval      FMELDNR = '02'
N10  c                   eval      FEILMELDING = 'IO should be confirmed before'
N10  c                             + ' chainging of ETD'
N10  C                   GOTO      TSTCHG1
N10  C                   END
N10   *
N09  C                   EVAL      ELARTL = WSARTL
N09  C                   EVAL      ELARTE = WSARTE
N09  C*                  IF        ELSTA > 'B' AND ELNTKL <> WSNTKLN
N09  C                   IF        ELSTA > 'D' AND ELNTKL <> WSNTKLN
N09  C                   eval      FMELDNR = '11'
N09  C                   eval      FEILMELDING = 'You cannot change number of '
N09  C                             + 'colli now.'
N09  C                   endif
N09  C                   GOTO      TSTCHG1
N09  C                   END
N04   *
N04  C                   IF        ELSTA2 = 'V' AND ELSTA3 = 'R' AND
N04  C                             ELNTSL <> WSNTSLN AND WSSLUT <> 'Y'
N04  C                   eval      FEILMELDING = 'You cannot split a REST line.'
N04  C                             + ' You can reduce n.o.pcs and "mark '
N04  C                             + 'Finished" or keep n.o.pcs '
N04  C                             + '(and split later if desired).'
N04  C                   eval      FMELDNR = '08'
N04  C                   eval      WSNTSLN = ELNTSL
N04  C*                  eval      EXTRAMELD   = 'This is a rest order. Please '
N04  C*                            + 'correct ETD or other informations.'
N04  C                   goto      UtTst
N04  C                   END
      *
      * Diverse tester
      * WSTTD = Tidligste Tid Departure
     c*    WSTTDN        ifne      *zeros
     C*                  MOVE      WSTTDN        DT8
     C*                  EXSR      TSTDT
     C*    UFLAGG        IFEQ      1
     C*                  MOVE      '01'          FMELDNR
     c*                  eval      FEILMELDING = 'Invalid Earliest Ship. Date '
     c*                            + '(valid: yyyy.mm.dd)'
     C*                  GOTO      UtTst
     C*                  ENDIF
     C*                  ENDIF
      * ETD-dato kan ikke være blank
N09  C     TSTCHG1       TAG
     c     WSETDN        ifeq      *zeros
     C                   eval      FMELDNR = '02'
     c                   eval      FEILMELDING = 'ETD cannot be blank'
     c                   goto      UtTst
     C                   endif
      *
     C                   MOVE      WSETDN        DT8
     C                   EXSR      TSTDT
     C     UFLAGG        IFEQ      1
     C                   MOVE      '02'          FMELDNR
     c                   eval      FEILMELDING = 'Invalid ETD date '
     c                             + '(valid: yyyy.mm.dd)'
     C                   GOTO      UtTst
     C                   ENDIF
N09  C                   IF        XJOBBKL = 'J'
N09  C                   GOTO      UtTst
N09  C                   END
      * BEKRETET ETD-dato
     C                   IF        WSETDBN <> 0
     C                   MOVE      WSETDBN       DT8
     C                   EXSR      TSTDT
     C                   IF        UFLAGG = 1
     C                   MOVE      '03'          FMELDNR
     C                   eval      FEILMELDING = 'Invalid confirmed ETD date '
     C                             + '(valid: yyyy.mm.dd)'
     C                   GOTO      UtTst
     C                   ENDIF
     C                   ENDIF
      * ETA-dato
     C                   IF        WSETAN <> 0
     C                   MOVE      WSETAN        DT8
     C                   EXSR      TSTDT
     C                   IF        UFLAGG = 1
     C                   MOVE      '04'          FMELDNR
     C                   eval      FEILMELDING = 'Invalid ETA date '
     C                             + '(valid: yyyy.mm.dd)'
     C                   GOTO      UtTst
     C                   ENDIF
     C                   ENDIF
      * BEKREFETET ETA-dato
     C                   IF        WSETABN <> 0
     C                   MOVE      WSETABN       DT8
     C                   EXSR      TSTDT
     C                   IF        UFLAGG = 1
     C                   MOVE      '05'          FMELDNR
     C                   eval      FEILMELDING = 'Invalid confirmed ETA date '
     C                             + '(valid: yyyy.mm.dd)'
     C                   GOTO      UtTst
     C                   ENDIF
     C                   ENDIF
N03   * WSFSTE = FRA HAVN (POL)
N03  C     WSFSTE        IFEQ      *BLANKS
N03  C                   EVAL      WSFLK = *BLANKS
N03  C                   ELSE
N03  C     WSFSTE        CHAIN     STED2                              33
N03  c                   IF        *IN33
N03  C                   MOVE      '08'          FMELDNR
N03  c                   eval      FEILMELDING = 'POL - Port of Loading - '
N03  c                             +'is invalid.'
N03  C                   GOTO      UtTst
N03  C                   ELSE
N03  C                   EVAL      WSFLK = ST2LK
N03  C                   ENDIF
N03  C                   ENDIF
N03   * WSTSTE = TIL HAVN (POD)
N03  C     WSTSTE        IFEQ      *BLANKS
N03  C                   EVAL      WSTLK = *BLANKS
N03  C                   ELSE
N03  C     WSTSTE        CHAIN     STED2                              33
N03  c                   IF        *IN33
N03  C                   MOVE      '09'          FMELDNR
N03  c                   eval      FEILMELDING = 'POD - Port of Discharge - '
N03  c                             +'is invalid.'
N03  C                   GOTO      UtTst
N03  C                   ELSE
N03  C                   EVAL      WSTLK = ST2LK
N03  C                   ENDIF
N03  C                   ENDIF
      *
      * Status kun 0/1
      * når er input gjort om til Pulldown - umulig med feil...
     c     WSSTA         ifne      ' '
     c     WSSTA         andne     '0'
     c     WSSTA         andne     '1'
     c     WSSTA         andne     '15'
     C                   eval      FMELDNR = '06'
     c                   eval      FEILMELDING = 'Status can only be set to: '
     c                             + '0=Pending, 1=Contacted '
     c                             + '15=Ready for stuffing'
     c                   goto      UtTst
     C                   endif
      * WSREAS må oppgis når enhetsvekt endret
     C                   IF        WSREAS = *BLANKS AND WSVKTEN <> ELVKTE
     C                   eval      FMELDNR = '07'
     C                   eval      FEILMELDING = 'Reason code has to given '
     C                             + 'when unit weight is changed.'
     C                   goto      UtTst
     C                   END
      * WSREAS må oppgis når enhetsvolum endret
     C                   IF        WSREAS = *BLANKS AND WSM3EN <> ELM3E
     C                   eval      FMELDNR = '07'
     C                   eval      FEILMELDING = 'Reason code has to given '
     C                             + 'when unit cbm is changed.'
     C                   goto      UtTst
     C                   END
      * WSREAS må oppgis når STK endret
     C                   IF        WSREAS = *BLANKS AND WSNTSLN <> ELNTSL
     C                   eval      FMELDNR = '07'
     C                   eval      FEILMELDING = 'Reason code has to given '
     C                             + 'when pieces is changed.'
     C                   goto      UtTst
     C                   END
      * WSREAS må oppgis ved restordre
     C                   IF        WSREAS = *BLANKS AND WSRORD1 = 'J'
     C                   eval      FMELDNR = '07'
     C                   eval      FEILMELDING = 'Reason code has to given '
     C                             + 'for rest order.'
     C                   eval      EXTRAMELD   = 'This is a rest order. Please '
     C                             + 'correct ETD or other informations.'
     C                   goto      UtTst
     C                   END
     C                   EVAL      WSRORD1 = 'N'
     C                   eval      EXTRAMELD   = *BLANKS
      * FINN NY SHIPPING VINDU VED SPLITT LINJE
     C*                  IF        ELULIN = 99999
     C                   IF        ELSTA3 = 'R'
     C     WSETDN        CHAIN     KALENDER                           33
     C     1             DO        7
     C                   READP     KALENDER                               33
     C                   ENDDO
     C                   EVAL      WSTTDN = KADATE
     C                   EVAL      ELTTD  = KADATE
     C     WSETDN        CHAIN     KALENDER                           33
     C     1             DO        7
     C                   READ      KALENDER                               33
     C                   ENDDO
     C                   EVAL      WSSTDN = KADATE
     C                   EVAL      ELSTD  = KADATE
     C                   ELSE
     C                   EVAL      WSTTDN = ELTTD
     C                   EVAL      WSSTDN = ELSTD
     C                   END
      * WSREAS må oppgis når ETD er utenfor shipping vindu
      * (MEN KUN DERSOM SHIPPING VINDU ER ANGITT.. (BURDE TESTE INDIVIDULET - EARLEIST/LATEST))
     c                   IF        ELTTD <> *ZEROS AND ELSTD <> *ZEROS
     C                   IF        WSREAS = *BLANKS AND WSETDN <> ELETD
     C                   IF        WSETDN < ELTTD OR WSETDN > ELSTD
     C                   eval      FMELDNR = '07'
     C                   eval      FEILMELDING = 'Reason code has to given '
     C                             + 'when ETD is out of shipping window.'
     C                   goto      UtTst
     C                   END
     C                   END
     C                   END
      *
S04  C*    UtTst         endsr
N04  C     UtTst         TAG
N04  C                   IF        FMELDNR <> *BLANKS AND WSRORD1 = 'J'
N04  C                   eval      EXTRAMELD   = 'This is a rest order. Please '
N04  C                             + 'correct ETD or other informations.'
N04  C                   END
N04   *
N04  C                   ENDSR
      *
      **************************************************************
     C     TSTDT         BEGSR
      **************************************************************
     C                   MOVE      DTD           UDD               2 0
     C                   MOVE      DTM           UMM               2 0
     C                   MOVE      DTÅ           UÅÅ               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
     C                   endsr
      *
      ***************************************************
     C     UPDCHG        begsr
      ***************************************************
N09  C                   EVAL      XSNDK2 = 'N'
N05  C     KEYH          CHAIN(N)  EPOH                               33
N01  C                   EVAL      ETSTAT = ' '
      * NOE er endret = ELSTA2 = S - Send
     C     KEY           CHAIN     EPOL                               33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   IF        WSSTA3 = ELSTA3                               2<-B
     C                   LEAVE
     C                   END                                                     2<-E
     C                   UPDATE    EPOLR
     C     KEY           READE     EPOL                                   33
     C                   ENDDO                                                  1<-E
     c     *in33         ifeq      *off                                         1<-B
N09  C                   IF        XJOBBKL = 'J'
N09  C     KEY           CHAIN     EPOLT                              33
N09  C                   END
      *
      * OPPDATER TT
     C                   IF        ELBLNR <> WSBLNR                              2<-B
     C                   EVAL      ETTEXT = 'BL-no is changed '
     C                             + 'from ' + %TRIM(EHBLNR)
     C                             + ' to ' + %TRIM(WSBLNR)
     C                   EVAL      ETACTI = 'CHG'
     C                   EXSR      UPDTT
     C                   END                                                     2<-E
     C                   IF        ELORIG = *BLANKS AND WSORIG <> *BLANKS        2<-B
     C                   EVAL      ETTEXT = 'Orignal is received.'
     C                   EVAL      ETACTI = 'CHG'
     C                   EXSR      UPDTT
     C                   END                                                     2<-E
     C                   IF        WSORIG = *BLANKS AND ELORIG <> *BLANKS        2<-B
     C                   EVAL      ETTEXT = 'Orignal is not received.'
     C                   EVAL      ETACTI = 'CHG'
     C                   EXSR      UPDTT
     C                   END                                                     2<-E
      *
     C                   IF        ELETD  <> WSETDN                              2<-B
     C                   IF        ELSTA = '0'                                    3<-B
     C                   EVAL      WSSTA = '1'
     C                   END                                                      3<-E
     C                   EVAL      ETTEXT = 'ETD is changed from '
     C                             + %TRIM(%EDITW(ELETD:'    .  .  '))
     C                             + ' to '
     C                             + %TRIM(%EDITW(WSETDN:'    .  .  '))
     C                   EVAL      ETACTI = 'CHD'
     C                   EXSR      UPDTT
     C                   END                                                     2<-E
      *
     C                   IF        ELETA  <> WSETAN                              2<-B
     C                   EVAL      WSSTA = '1'
     C                   EVAL      ETTEXT = 'ETA is changed from '
     C                             + %TRIM(%EDITW(ELETA:'    .  .  '))
     C                             + ' to '
     C                             + %TRIM(%EDITW(WSETAN:'    .  .  '))
     C                   EVAL      ETACTI = 'CHD'
     C                   EXSR      UPDTT
     C                   END                                                     2<-E
      *
     C                   IF        ELNTSL <> WSNTSLN AND ELSTA = '0'             2<-B
     C                   EVAL      WSSTA = '1'
     C                   END                                                     2<-E
N01
N01   * Frasted
N05  c                   move      ELFSTE        ExFSTE            5
N05  c                   move      WSFSTE        WxFSTE            5
N05  c                   if        ExFSTE = *blanks                              2<-B
N05  c                   move      EHFSTE        ExFSTE
N05  c                   endif                                                   2<-E
N05  c                   if        WxFSTE = *blanks                              2<-B
N05  c                   move      EHFSTE        WxFSTE
N05  c                   endif                                                   2<-E
N01  c                   IF        ELFSTE <> WSFSTE                              2<-B
N01  C                   EVAL      ETTEXT = 'POL is changed '
e05  C                             + 'from ' + %TRIM(ExFSTE)
e05  C                             + ' to ' + %TRIM(WxFSTE)
N01  C                   EVAL      ETACTI = 'CHG'
N01  C                   EVAL      ETSTAT = 'S'
N01  C                   EXSR      UPDTT
N01  C                   EVAL      ETSTAT = ' '
N01  C                   END                                                     2<-E
N01   * Tilsted
N05  c                   move      ELTSTE        ExTSTE            5
N05  c                   move      WSTSTE        WxTSTE            5
N05  c                   if        ExTSTE = *blanks                              2<-B
N05  c                   move      EHTSTE        ExTSTE
N05  c                   endif                                                   2<-E
N05  c                   if        WxTSTE = *blanks                              2<-B
N05  c                   move      EHTSTE        WxTSTE
N05  c                   endif                                                   2<-E
N01  c                   IF        ELTSTE <> WSTSTE                              2<-B
N01  C                   EVAL      ETTEXT = 'POD is changed '
e05  C                             + 'from ' + %TRIM(ExTSTE)
e05  C                             + ' to ' + %TRIM(WxTSTE)
N01  C                   EVAL      ETACTI = 'CHG'
N01  C                   EVAL      ETSTAT = 'S'
N01  C                   EXSR      UPDTT
N01  C                   EVAL      ETSTAT = ' '
N01  C                   END                                                     2<-E
N01   *
      * mail om endret POL eller POD
N05  c**                 IF        ELFSTE <> WSFSTE or ELTSTE <> WSTSTE
N05  c                   IF        ELFSTE <> WSFSTE                              2<-B
N05  c                   move      *blanks       CMD            1024
N05  c                   move      *blanks       mailto           60
OBS!!c                   eval      mailTo ='janottar@systema.no'
OBS!!c**                 eval      mailTo ='kenneth.johansen@europris.no'
N05  c                   if        EHIEM<>*blanks                                 3<-B
OBS!!c**                 eval      mailTo = EHIEM
N05  c                   endif                                                    3<-E
N05  c                   eval      CMD='SNDDST TYPE(*LMSG) TOINTNET(('''
N05  c                             +%trim(mailto)+''')) DSTD(''PortChg: PO '
N05  c                             +%trim(ELBES)+' '
     c                             +%trim(%editc(ELLIN:'3')) +'/'
N05  c                             +%trim(%editc(ELULIN:'3'))+' '
N05  c                             +%trim(ExFSTE)+'-'+%trim(ExTSTE)+'->'
N05  c                             +%trim(WxFSTE)+'-'+%trim(WxTSTE)
N05  c                             +''') MSG(''Information about changed Port '
N05  c                             +'Of Loading and/or Port Of Discharge.'') '
N05  c                             +'LONGMSG(''On PO '+%trim(ELBES)
N05  c                             +' Line '+%trim(%editc(ELLIN:'3'))
N05  c                             +' Subline '+%trim(%editc(ELULIN:'3'))
N05  c                             +' POL-POD was changed from '
N05  c                             +%trim(ExFSTE)+'-'+%trim(ExTSTE)+' to '
N05  c                             +%trim(WxFSTE)+'-'+%trim(WxTSTE)
N05  c                             +':/N:/N:/Nnoreply@collicare.no'')'
N05  c                   eval      rc=docmd(%trim(CMD))
N05  c                   ENDIF                                                   2<-E
      * Er status endret ??
     c                   Eval      StatChgd = 'N'
     c                   IF        ELSTA <> WSSTA AND WSSTA <> *BLANKS           2<-B
     c                   Eval      StatChgd = 'Y'
     c                   IF        ELSTA = *BLANKS                                3<-B
     C                   EVAL      ETTEXT = 'Status is changed from 0'
     C                             + ' to ' + %TRIM(WSSTA)
     C                   ELSE                                                     3
     C                   EVAL      ETTEXT = 'Status is changed from '
     C                             + %TRIM(ELSTA) + ' to ' + %TRIM(WSSTA)
     C                   END                                                      3<-E
     C                   EVAL      ETACTI = 'CHG'
     C                   EXSR      UPDTT
     C                   MOVE      'J'           XSTENDRET         1
     C                   MOVE      WSSTA         XWSSTA            5
     C                   END                                                     2<-E
      * Reason code flytte sist  (også etter splitt..)
     C                   MOVE      *BLANKS       XTYPE            10
S09  C*                  IF        ELREAS <> WSREAS                              2<-B
N09  C                   IF        ELREAS <> WSREAS AND WSREAS <> *BLANKS        2<-B
N11  C                             OR (ELREAS <> WSREAS AND XJOBBKL = 'J')
     C                   EVAL      ETTEXT = 'Reason code '+WSREAS
     C                   EVAL      ETACTI = 'CHG'
     C                   EXSR      UPDTT
     C                   END                                                     2<-E
N09   *
N09  C                   MOVE      'N'           XSENDEDI          1
N09   *
N09  C                   IF        XJOBBKL = 'J'                                 2<-B
N09   *
N10  C                   IF        EHORIG = 'S'
N09  C                   IF        ELSTA < 'A' OR ELETD <> WSETDN                 3<-B
N09  C                   IF        ELSTA < 'A'                                     4<-B
N09  C                   EVAL      WSSTA = 'A'
N09  C                   END                                                       4<-E
N09  C                   EVAL      XSENDEDI = 'J'
N09  C                   END                                                      3<-E
N10  C                   END
N09   * Tariffnr 1
N09  C                   MOVE      *BLANKS       XTYPE            10
N09  C                   IF        ELTNNE <> WSTNNEN                              3<-B
N09  C                   EVAL      ETTEXT = 'TariffNo is changed from '
N09  C                             + %TRIM(%EDITC(ELTNNE:'Z'))
N09  C                             + ' to '
N09  C                             + %TRIM(%EDITC(WSTNNEN:'Z'))
N09  C                   EVAL      ETACTI = 'CHG'
N09  C                   EXSR      UPDTT
N09  C                   END                                                      3<-E
N09   * Tariffnr 2
N09  C                   MOVE      *BLANKS       XTYPE            10
N09  C                   IF        ETTNNE <> WSTNNEN_T                            3<-B
N09  C                   EVAL      ETTEXT = 'TariffNo is changed from '
N09  C                             + %TRIM(%EDITC(ETTNNE:'Z'))
N09  C                             + ' to '
N09  C                             + %TRIM(%EDITC(WSTNNEN_T:'Z'))
N09  C                   EVAL      ETACTI = 'CHG'
N09  C                   EXSR      UPDTT
N09  C                   END                                                      3<-E
N09   * Pris
N09  C                   MOVE      *BLANKS       XTYPE            10
N09  C                   IF        ETPRIS <> WSPRISN                              3<-B
N09  C                   EVAL      ETTEXT = 'Price is changed from '
N09  C                             + %TRIM(%EDITC(ETPRIS:'4'))
N09  C                             + ' to '
N09  C                             + %TRIM(%EDITC(WSPRISN:'4'))
N09  C                   EVAL      ETACTI = 'CHG'
N09  C                   EXSR      UPDTT
N09  C                   END                                                      3<-E
N09   * Kolli
N09  C                   MOVE      *BLANKS       XTYPE            10
N09  C                   IF        ELNTSL <> WSNTSLN                              3<-B
N09  C                   EVAL      ETTEXT = 'Colli is changed from '
N09  C                             + %TRIM(%EDITC(ELNTSL:'Z'))
N09  C                             + ' to '
N09  C                             + %TRIM(%EDITC(WSNTSLN:'Z'))
N09  C                   EVAL      ETACTI = 'CHG'
N09  C                   EXSR      UPDTT
N09  C                   END                                                      3<-E
N09   * Kolli levert
N09  C                   MOVE      *BLANKS       XTYPE            10
N09  C                   IF        ELNTKL <> WSNTKLN                              3<-B
N09  C                   EVAL      ETTEXT = 'Colli (delivery) is changed from '
N09  C                             + %TRIM(%EDITC(ELNTKL:'Z'))
N09  C                             + ' to '
N09  C                             + %TRIM(%EDITC(WSNTKLN:'Z'))
N09  C                   EVAL      ETACTI = 'CHG'
N09  C                   EXSR      UPDTT
N09  C                   END                                                      3<-E
N09   * Brutto vekt
N09  C                   MOVE      *BLANKS       XTYPE            10
N09  C                   IF        ELVKTL <> WSVKTLN                              3<-B
N09  C                   EVAL      ETTEXT = 'Brut weight is changed from '
N09  C                             + %TRIM(%EDITC(ELVKTL:'4'))
N09  C                             + ' to '
N09  C                             + %TRIM(%EDITC(WSVKTLN:'4'))
N09  C                   EVAL      ETACTI = 'CHG'
N09  C                   EXSR      UPDTT
N09  C                   END                                                      3<-E
N09   * Netto vekt
N09  C                   MOVE      *BLANKS       XTYPE            10
N09  C                   IF        ELVKTL <> WSVKTLN                              3<-B
N09  C                   EVAL      ETTEXT = 'Net weight is changed from '
N09  C                             + %TRIM(%EDITC(ELVKNL:'4'))
N09  C                             + ' to '
N09  C                             + %TRIM(%EDITC(WSVKNLN:'4'))
N09  C                   EVAL      ETACTI = 'CHG'
N09  C                   EXSR      UPDTT
N09  C                   END                                                      3<-E
N09   * Kubikk
N09  C                   MOVE      *BLANKS       XTYPE            10
N09  C                   IF        ELM3L <> WSM3LN                                3<-B
N09  C                   EVAL      ETTEXT = 'Volumn is changed from '
N09  C                             + %TRIM(%EDITC(ELM3L:'4'))
N09  C                             + ' to '
N09  C                             + %TRIM(%EDITC(WSM3LN:'4'))
N09  C                   EVAL      ETACTI = 'CHG'
N09  C                   EXSR      UPDTT
N09  C                   END                                                      3<-E
N09   *
N09  C                   END                                                     2<-E
      *
      * HÅNDTERE SPLITT
     C                   EVAL      XDIFF = ELNTSL - WSNTSLN
     C                   SELECT                                                  2<-B
     C                   WHEN      XDIFF < 0                                     2 OVERTALLIG
     C                   EVAL      ETTEXT = 'Pieces is changed from '
     C                             + %TRIM(%EDITC(ELNTSL:'Z'))
     C                             + ' to '
     C                             + %TRIM(%EDITC(WSNTSLN:'Z'))
     C**                           + '. New order line is created.'
     C                   EVAL      ETACTI = 'CHG'
     C                   EXSR      UPDTT
     C*                  EVAL      WSNTSLN = ELNTSL
     C                   WHEN      XDIFF > 0                                     2 RESTORDRE
     C                   EVAL      ETTEXT = 'Pieces is changed from '
     C                             + %TRIM(%EDITC(ELNTSL:'Z'))
     C                             + ' to '
     C                             + %TRIM(%EDITC(WSNTSLN:'Z'))
     C**                           + '. Rest order line is create.'
N01  C                   IF        WSSLUT <> 'Y'                                  3<-B
N01  C                   EVAL      ETTEXT = %TRIM(ETTEXT)
     C                             + '. Rest order line is created.'
N01  C                   END                                                      3<-E
     C                   EVAL      ETACTI = 'CHG'
     C                   EXSR      UPDTT
     C                   ENDSL                                                   2<-E
      *
      * autoberegne basert på stykk levert av original (via OrgStkLev fro å hindre div m/Zero)
     c                   z-add     ELNTSL        OrgStkLev         9 0
     c                   if        OrgStkLev = *zeros                            2<-B
     c                   z-add     1             OrgStkLev
     c                   endif                                                   2<-E
N01   * AUTO BEREGNE KARTONG VED KARTONG=0 ELLER STYKK ENDRET, MEN KARTONG IKKE ENDRET
N01  C                   IF        WSNTKLN = 0 OR                                2<-B
N01  C                             (WSNTSLN <> ELNTSL AND WSNTKLN = ELNTKL)
N01  C                   IF        ELSTKL = 0                                     3<-B
N09  C                   IF        XJOBBKL <> 'J'                                  4<-B
N01  C*                  eval(H)   WSNTKLN = ELNTKL * WSNTSLN / ELNTSL
N01  C                   eval(H)   WSNTKLN = ELNTKL * WSNTSLN / OrgStkLev
N09  C                   END                                                       4<-E
N01  C                   ELSE                                                     3
N01  C                   eval(H)   WSNTKLN = WSNTSLN / ELSTKL
N01  C                   END                                                      3<-E
N01  C                   END                                                     2<-E
N01   * AUTO BEREGNE BRUTTOVEKT VED VEKT=0 ELLER STYKK ENDRET, MEN VEKT IKKE ENDRET
N01  C                   IF        WSVKTLN = 0 OR                                2<-B
N01  C                             (WSNTSLN <> ELNTSL AND WSVKTLN = ELVKTL)
N01  C                   IF        ELVKTE = 0                                     3<-B
N01  C*                  eval(H)   WSVKTLN = ELVKTL * WSNTSLN / ELNTSL
N01  C                   eval(H)   WSVKTLN = ELVKTL * WSNTSLN / OrgStkLev
N01  C                   ELSE                                                     3
N01  C                   eval(H)   WSVKTLN = WSNTSLN * ELVKTE
N01  C                   END                                                      3<-E
N01  C                   END                                                     2<-E
N01   * AUTO BEREGNE NETTOVEKT VED VEKT=0 ELLER STYKK ENDRET, MEN VEKT IKKE ENDRET
N01  C                   IF        WSVKNLN = 0 OR                                2<-B
N01  C                             (WSNTSLN <> ELNTSL AND WSVKNLN = ELVKNL)
S09  C*                  IF        ELVKNE = 0                                     3<-B
N09  C                   IF        ELVKNE = 0 OR XJOBBKL ='J'                     3<-B
N01  C*                  eval(H)   WSVKNLN = ELVKNL * WSNTSLN / ELNTSL
N01  C                   eval(H)   WSVKNLN = ELVKNL * WSNTSLN / OrgStkLev
N01  C                   ELSE                                                     3
N01  C                   eval(H)   WSVKNLN = WSNTSLN * ELVKNE
N01  C                   END                                                      3<-E
N01  C                   END                                                     2<-E
N01   * AUTO BEREGNE KUBIKK VED KUBIKK=0 ELLER STYKK ENDRET, MEN KUBIKK IKKE ENDRET
N01  C                   IF        WSM3LN = 0 OR                                 2<-B
N01  C                             (WSNTSLN <> ELNTSL AND WSM3LN = ELM3L)
N01  C                   IF        ELVKTE = 0                                     3<-B
N01  C*                  eval(H)   WSM3LN = ELM3L * WSNTSLN / ELNTSL
N01  C                   eval(H)   WSM3LN = ELM3L * WSNTSLN / OrgStkLev
N01  C                   ELSE                                                     3
N01  C                   eval(H)   WSVKTLN = WSNTSLN * ELM3E
N01  C                   END                                                      3<-E
N01  C                   END                                                     2<-E
N01   *
      *
     C                   IF        ELAVD > 0                                     2<-B
     C     HEADFK        CHAIN     HEADF                              33
     C                   SUB(H)    ELNTSL        HENT
     C                   ADD(H)    WSNTSLN       HENT
     C                   SUB(H)    ELVKTL        HEVKT
     C                   ADD(H)    WSVKTLN       HEVKT
     C                   IF        HEM3 < 9999.999                                3<-B
     C                   SUB(H)    ELM3L         HEM3
     C     HEM3          ADD(H)    WSM3LN        BIGNUM
     C                   IF        BIGNUM < 9999.999                               4<-B
     C                   Z-ADD(H)  BIGNUM        HEM3
     C                   ELSE                                                      4
     C                   Z-ADD     9999.999      HEM3
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   UPDATE    HEADFR
     C     HEPRO         CHAIN     TURER14                            33
S02  C*                  IF        TUTS < 99999
     C                   SUB(H)    ELNTSL        TUTS
N02  C                   ADD(H)    WSNTSLN       TUTS
S02  C*    TUTS          ADD(H)    WSNTSLN       BIGNUM
S02  C*                  IF        BIGNUM < 99999
S02  C*                  Z-ADD(H)  BIGNUM        TUTS
S02  C*                  ELSE
S02  C*                  Z-ADD     99999         TUTS
S02  C*                  END
S02  C*                  END
S02  C*                  IF        TUTVKT < 99999
     C                   SUB(H)    ELVKTL        TUTVKT
N02  C                   ADD(H)    WSVKTLN       TUTVKT
S02  C*    TUTVKT        ADD(H)    WSVKTLN       BIGNUM
S02  C*                  IF        BIGNUM < 99999
S02  C*                  Z-ADD(H)  BIGNUM        TUTVKT
S02  C*                  ELSE
S02  C*                  Z-ADD     99999         TUTVKT
S02  C*                  END
S02  C*                  END
S02  C*                  IF        TUTM3 < 99.99
     C                   SUB(H)    ELM3L         TUTM3
N02  C                   ADD(H)    WSM3LN        TUTM3
S02  C*    TUTM3         ADD(H)    WSM3LN        BIGNUM
S02  C*                  IF        BIGNUM < 99.99
S02  C*                  Z-ADD(H)  BIGNUM        TUTM3
S02  C*                  ELSE
S02  C*                  Z-ADD     99.99         TUTM3
S02  C*                  END
S02  C*                  END
     C  N33              UPDATE    TURERR
     C                   END                                                     2<-E
      *
     c                   if        (ELETD <> WSETDN)                             2<-B
     C                             or (ELETA <> WSETAN)
     c                             or (ELNTSL <> WSNTSLN)
     c                             or (StatChgd = 'Y')
     c                             or (ELREAS<> WSREAS)
N01  c                             or (ELFSTE<> WSFSTE)
N01  c                             or (ELTSTE<> WSTSTE)
N09  C                   IF        XJOBBKL <> 'J'                                 3<-B
     C                   SELECT                                                    4<-B
     C                   WHEN      XDIFF > 0 AND WSSLUT <> 'Y'                     4
     C                   EVAL      ELSTA2 = 'V'                                    4 VENT
     C*                  WHEN      ELULIN = 99999                                  4
     C                   WHEN      ELSTA3 = 'R'                                    4 SPLITTET LINJE
     C                   EVAL      ELSTA2 = 'V'                                      VENT
     C                   OTHER                                                     4
     C                   eval      ELSTA2 = 'S'                                      Send
     C                   ENDSL                                                     4<-E
N09  c                   END                                                      3<-E
     c                   endif                                                   2<-E
N06  C                   MOVE      ELTTD         XORELTTD          8 0
N06  C                   MOVE      ELETD         XORELETD          8 0
N06  C                   MOVE      ELETDB        XORELETDB         8 0
N06  C                   MOVE      ELETA         XORELETA          8 0
N06  C                   MOVE      ELETAB        XORELETAB         8 0
N06  C                   MOVE      ELSTD         XORELSTD          8 0
     C                   eval      ELTTD  = WSTTDN
N09  C*                  IF        XJOBBKL = 'J' AND ELETD <> WSETDN
N09  C*                  MOVE      'J'           XSENDEDI          1
N09  C*                  ELSE
N09  C*                  MOVE      'N'           XSENDEDI
N09  C*                  END
     C                   eval      ELETD  = WSETDN
     C                   eval      ELETDB = WSETDBN
     C                   eval      ELETA  = WSETAN
     C                   eval      ELETAB = WSETABN
     C                   eval      ELSTD  = WSSTDN
     C                   eval      ELVKTE = WSVKTEN
     C                   eval      ELVKNE = WSVKNEN
     C                   eval      ELM3E  = WSM3EN
     C                   eval      ELNTSL = WSNTSLN
S01  C*                  IF        WSNTKLN = 0 AND ELSTKL <> 0
S01  C*                  EVAL(H)   WSNTKLN = ELNTSL / ELSTKL + 0,49
S01  C*                  END
N01   * REGN KOLLI, VEKT OG KUBIKK PÅ RESTORDRE
N01  C                   eval      XELNTKL = ELNTKL - WSNTKLN
N01  C                   eval      XELVKTL = ELVKTL - WSVKTLN
N01  C                   eval      XELVKNL = ELVKNL - WSVKNLN
N01  C                   eval      XELM3L  = ELM3L - WSM3LN
N01   *
N09  C                   IF        ELNTKL <> WSNTKLN AND XJOBBKL = 'J'           2<-B
N09  C                             AND WSNTKLN > 0
N09  C                   EVAL      PRTMLP = 'Y'
N09  C                   END                                                     2<-E
N09  C                   IF        XJOBBKL = 'J'                                 2<-B
N09  C                   EVAL      ELARTL = WSARTL
N09  C                   EVAL      ELARTE = WSARTE
N09  C                   EVAL      ELTNNE = WSTNNEN
N09  C                   EVAL      ETTNNE = WSTNNEN_T
N09  C                   EVAL      ETPRIS = WSPRISN
N09  C                   END                                                     2<-E
N09   *
N09  C                   IF        XJOBBKL = 'J'                                 2<-B
N09  C                   IF        ELNTKL > 0 AND WSNTKLN = 0                     3<-B
N09  C                   eval      WSSTA  = 'A'
N09  C                   EVAL      XSNDK2 = 'J'
N09  C     KEY           CHAIN     EPOK                               33
N09  C                   DOW       *IN33 = *OFF                                    4<-B
N09  C                   EVAL      EGKUND  = EKKUND
N09  C                   EVAL      EGBES   = EKBES
N09  C                   EVAL      EGLIN   = EKLIN
N09  C                   EVAL      EGULIN  = EKULIN
N09  C                   EVAL      EGKLIN  = EKKLIN
N09  C                   EVAL      EGTYPE  = 'DLT'
N09  C                   MOVE      WDT           EGDTLG
N09  C                   MOVE      WTM           EGTMLG
N09  C                   EVAL      EGUSR   = USER
N09  C                   EVAL      EG1ST   = EKST
N09  C                   EVAL      EG1MRK  = EKMRK
N09  C                   EVAL      EG1DTPR = EKDTPR
N09  C                   EVAL      EG1USR  = EKUSR
N09  C                   EVAL      EG1DTHK = EKDTHK
N09  C                   EVAL      EG1DTIN = EKDTIN
N09  C                   EVAL      EG1DTUT = EKDTUT
N09  C                   EVAL      EG1DTLK = EKDTLK
N09  C                   EVAL      EG1BILN = EKBILN
N09  C                   WRITE     EPOKLOGR
N09  C                   DELETE    EPOKR
N09  C     KEY           READE     EPOK                                   33
N09  C                   ENDDO                                                     4<-E
N09  C                   END                                                      3<-E
N09  C                   END                                                     2<-E
N09   *
     C                   eval      ELNTKL = WSNTKLN
     C                   eval      ELVKTL = WSVKTLN
     C                   eval      ELVKNL = WSVKNLN
     C                   eval      ELM3L  = WSM3LN
     C                   eval      ELBLNR = WSBLNR
N03  C                   eval      ELFLK  = WSFLK
N03  C                   eval      ELFSTE = WSFSTE
N03  C                   eval      ELTLK  = WSTLK
N03  C                   eval      ELTSTE = WSTSTE
     C                   eval      ELORIG = WSORIG
     c     WSSTA         ifne      *blanks                                       2<-B
     C                   eval      ELSTA  = WSSTA
     c                   endif                                                   2<-E
     c     WSREAS        ifne      *blanks                                       2<-B
N11  c     XJOBBKL       OREQ      'J'
     C                   eval      ELREAS = WSREAS
     C*                  eval      ELSTA3 = 'R'
     c                   endif                                                   2<-E
      *
XX   C*                  IF        XDIFF > 0 OR WSSLUT = 'Y'
XX   C                   IF        WSSLUT = 'Y'                                  2<-B
     C                   EVAL      ELSLUT = 'X'
     C                   END                                                     2<-E
N09  C                   IF        XJOBBKL = 'J' AND ELANTS = 0
N09  C                   IF        ELNTSL = 0
N09  C                   EVAL      ELNTSL = ELNTKL
N09  C                   END
N09  C                   eval      ELANTS = ELNTSL
N09  C                   END
     c                   update    EPOLR
N09  C                   IF        XJOBBKL = 'J'
N09  C                   IF        ELTNNE <> 0 OR ETTNNE <> 0
N09  C     EPOATK        CHAIN     EPOAT                              33
N09  C                   EVAL      EATNN1 = ELTNNE
N09  C                   EVAL      EATNN2 = ETTNNE
N09  C                   IF        ELVKTL <> 0 AND ELNTSL <> 0
N09  C                   EVAL(H)   EAVKTE = ELVKTL/ELNTSL
N09  C                   END
N09  C                   IF        ELVKNL <> 0 AND ELNTSL <> 0
N09  C                   EVAL(H)   EAVKNE = ELVKNL/ELNTSL
N09  C                   END
N09  C                   IF        ELM3L <> 0 AND ELNTSL <> 0
N09  C                   EVAL(H)   EAM3E  = ELM3L/ELNTSL
N09  C                   END
N09  C                   IF        *IN33
N09  C                   EVAL      EAKUND = ELKUND
N09  C                   EVAL      EAART  = ELART
N09  C                   WRITE     EPOATR
N09  C                   ELSE
N09  C                   UPDATE    EPOATR
N09  C                   END
N09  C                   END
N09  c                   update    EPOLTR
N09  C                   END
N09   *
N09  C                   IF        XSENDEDI = 'J' AND EHSTA <> '5'
N09  C                             AND EHORIG = ' '
     C     KEYH          CHAIN     EPOH                               33
N09  C                   EVAL      EHORIG = 'S'
N09  C                   UPDATE    EPOHR
N09   * SEND ORDRSP 03A TIL SKEIDAR
N09  C                   MOVE      ELKUND        UKUND             8
N09  C                   MOVE      ELLIN         ULIN              7
N09  C                   MOVE      ELULIN        UULIN             5
N09  C                   CALL      'CC028C'
N09  C                   PARM                    UKUND
N09  C                   PARM                    ELBES
N09  C                   PARM                    ULIN
N09  C                   PARM                    UULIN
N09  C                   END
      *
     C*                  IF        ELULIN = 99999
     C                   IF        ELSTA3 = 'R'                                  2<-B
     C     KEYL          SETLL     EPOL
     C     KEYL          READE     EPOL                                   33
     C                   DOW       *IN33 = *OFF                                   3<-B
     C                   IF        ELSTA2 = 'V'                                    4<-B
     C                   EVAL      ELSTA2 = 'S'
     C                   END                                                       4<-E
     C                   UPDATE    EPOLR
     C     KEYL          READE     EPOL                                   33
     C                   ENDDO                                                    3<-E
     C                   END                                                     2<-E
      *
      * KUN VED UNDERLEVERING SKAL LAGE EN UNDERLINJE. DIFF = ØNSKET - LEVERT
     C                   IF        XDIFF > 0 AND WSSLUT <> 'Y'                   2<-B
CC    * EUROPRIS OPPDATERER ALLTID UNDERLINJENR 99999 PÅ SPLITT FRA HOVEDLINJE
CC    *           OR UNDERLINJENR MED NEGATIV FORTEGN PÅ SPLITT FRA UNDERLINJE
CC   C                   IF        ELKUND = 12497                                 3<-B
CC   C*                  EVAL      ELULIN = 99999
CC   C                   ELSE                                                     3
     C                   CALL      'EPOMS04A'                                   HENT NESTE UNDERL.NR
     C                   PARM                    ELKUND
     C                   PARM                    ELBES
     C                   PARM                    ELLIN
     C                   PARM                    ELULIN
CC   C                   END                                                      3<-E
      *
     C                   EVAL      ELSTA3 = 'R'
     C                   EVAL      ELLTYP = 'R'
     C                   EVAL      ELNTSL = XDIFF
     C                   EVAL      ETTEXT = 'Rest order: '
     C                             + %TRIM(%EDITC(ELNTSL:'Z'))
     C                   EVAL      ETACTI = 'CHG'
     C                   EXSR      UPDTT
     C                   eval      EXTRAMELD   = 'This is a rest order. Please '
     C                             + 'correct ETD or other informations.'
     C                   EVAL      WSRORD1 = 'J'
     C                   EVAL      ELSTA  = '1'
     C                   EVAL      ELREAS = *BLANKS
N01  C                   eval      ELNTKL = XELNTKL
N01  C                   eval      ELVKTL = XELVKTL
N01  C                   eval      ELVKNL = XELVKNL
N01  C                   eval      ELM3L  = XELM3L
N06  C                   EVAL      ELTTD  = XORELTTD
N06  C                   EVAL      ELETD  = XORELETD
N06  C                   EVAL      ELETDB = XORELETDB
N06  C                   EVAL      ELETA  = XORELETA
N06  C                   EVAL      ELETAB = XORELETAB
N06  C                   EVAL      ELSTD  = XORELSTD
     c                   WRITE     EPOLR
      * KLARGJØR FELT FOR ARBEID MED RESTORDRE
     C                   EVAL      WSSTA  = *BLANKS
     C                   EVAL      WSNTSLN = ELNTSL
N01  C                   EVAL      WSNTKLN = ELNTKL
N01  C                   EVAL      WSVKTLN = ELVKTL
N01  C                   EVAL      WSVKNLN = ELVKNL
N01  C                   EVAL      WSM3LN  = ELM3L
S04  C*                  EVAL      WSREAS = *BLANKS
     c                   eval      AVSLUTT = 'N'
     C                   END                                                     2<-E
      *
     C                   endif                                                  1<-E
N01  C                   EVAL      XELLIN  = ELLIN
N01  C                   EVAL      XELULIN = ELULIN
N01  C                   EVAL      XELLTYP = ELLTYP
N01  C                   EVAL      XELSTA3 = ELSTA3
      *
      * OPPDATER STATUS PÅ EPOH HVIS ALLE LINJENE HAR SAMME STATUS
     C                   IF        XSTENDRET = 'J'                              1<-B
     C*                  IF        XWSSTA = '0' OR XWSSTA = ' '                 PENDING
     C*                  EVAL      *IN33 = *ON
     C*                  ELSE
     C     KEYH          CHAIN     EPOH                               33
     C                   IF        EHSTA <> XWSSTA                               2<-B
     C                   SELECT                                                   3<-B
     C                   WHEN      XWSSTA = '0'                                   3 PENDING
     C                   EVAL      *IN33 = *ON
     C                   WHEN      XWSSTA = '1'                                   3 CONTACTED
     C                             OR XWSSTA = '15'                             Ready for stuffing
N09  C                             OR XWSSTA = 'A'                              CCLT confirmed
     C*    KEYL          SETLL     EPOL
     C*    KEYL          READE(N)  EPOL                                   33
     C     KEYH          SETLL     EPOL
     C     KEYH          READE(N)  EPOL                                   33
     C                   DOW       *IN33 = *OFF                                    4<-B
     C                   IF        ELSTA <> XWSSTA                                  5<-B
     C                   LEAVE
     C                   END                                                        5<-E
     C*    KEYL          READE(N)  EPOL                                   33
     C     KEYH          READE(N)  EPOL                                   33
     C                   ENDDO                                                     4<-E
     C                   ENDSL                                                    3<-E
     C                   END                                                     2<-E
     C                   IF        *IN33                                         2<-B
     C                   EVAL      ETTEXT = 'Status is changed from '
     C                             + %TRIM(EHSTA) + ' to ' + %TRIM(XWSSTA)
     C                   EVAL      ETKUND = EHKUND
     C                   EVAL      ETBES  = EHBES
     C                   EVAL      ETLIN  = 0
     C                   EVAL      ETULIN = 0
     C                   EVAL      ETACTI = 'CHG'
     C                   MOVE      WDT           ETDATE
     C                   MOVE      WTM           ETTIME
     C                   MOVE      BIBRID        ETUSER
     C                   WRITE     EPOTTR
     C                   EVAL      EHSTA = XWSSTA
     C                   END                                                     2<-E
     C                   UPDATE    EPOHR
     C*                  END
     C                   END                                                    1<-E
      *
      * OPPDATER KOLLI, VEKT OG M3 PÅ PO-HODE
     C     KEYH          CHAIN     EPOH                               33
     C                   IF        *IN33 = *OFF                                 1<-B
     C                   MOVE      *ZEROS        XEHANTK          11 3
     C                   MOVE      *ZEROS        XEHVKT           13 3
     C                   MOVE      *ZEROS        XEHM3             9 3
N07  C                   MOVE      ELTTD         XELTTD
N07  C                   MOVE      ELSTD         XELSTD
N07  C                   MOVE      ELART         XELART
N07  C                   MOVE      ELARTL        XELARTL
N07  C                   MOVE      ELARTE        XELARTE
N07  C                   MOVE      ELABES        XELABES
N07  C                   MOVE      ELANTS        XELANTS
N07  C                   MOVE      ELANKL        XELANKL
N07  C                   MOVE      ELSTKL        XELSTKL
N07  C                   MOVE      ELNTKL        XELNTKL
N07  C                   MOVE      ELVKTL        XELVKTL
N07  C                   MOVE      ELM3L         XELM3L
N07  C                   MOVE      ELSTA         XELSTA
N07  C                   MOVE      ELREAS        XELREAS
N09  C                   MOVE      'J'           XOPDEPOHST        1
     C     KEYH          SETLL     EPOL
     C     KEYH          READE(N)  EPOL                                   33
     C                   DOW       *IN33 = *OFF                                  2<-B
     C                   IF        ELAVD <> -9999                                 3<-B
     C                   EVAL      XEHANTK  = XEHANTK + ELNTKL
     C                   EVAL      XEHVKT   = XEHVKT  + ELVKTL
     C                   EVAL      XEHM3    = XEHM3   + ELM3L
     C                   END                                                      3<-E
N09  C                   IF        ELSTA < 'A'                                    3<-B
N09  C                   MOVE      'N'           XOPDEPOHST
N09  C                   END                                                      3<-E
     C     KEYH          READE(N)  EPOL                                   33
     C                   ENDDO                                                   2<-E
N09  C                   IF        XJOBBKL =  'J' AND XOPDEPOHST = 'J'           2<-B
N09  C                             AND EHSTA < '1'
N09  C                   EVAL      EHSTA = '1'
N09  C                   END                                                     2<-E
     C                   IF        XEHANTK < 999999.999                          2<-B
     C                   EVAL      EHANTK = XEHANTK
     C                   ELSE                                                    2
     C                   EVAL      EHANTK = 0
     C                   END                                                     2<-E
     C                   IF        XEHVKT < 99999999.999                         2<-B
     C                   EVAL      EHVKT  = XEHVKT
     C                   ELSE                                                    2
     C                   EVAL      EHVKT  = 0
     C                   END                                                     2<-E
     C                   IF        XEHM3 < 9999.999                              2<-B
     C                   EVAL      EHM3   = XEHM3
     C                   ELSE                                                    2
     C                   EVAL      EHM3   = 0
     C                   END                                                     2<-E
     C                   UPDATE    EPOHR
     C                   END                                                    1<-E
N01  C                   EVAL      ELLIN  = XELLIN
N01  C                   EVAL      ELULIN = XELULIN
N01  C                   EVAL      ELLTYP = XELLTYP
N01  C                   EVAL      ELSTA3 = XELSTA3
N07  C                   EVAL      ELTTD  = XELTTD
N07  C                   EVAL      ELSTD  = XELSTD
N07  C                   EVAL      ELART  = XELART
N07  C                   EVAL      ELARTL = XELARTL
N07  C                   EVAL      ELARTE = XELARTE
N07  C                   EVAL      ELABES = XELABES
N07  C                   EVAL      ELANTS = XELANTS
N07  C                   EVAL      ELANKL = XELANKL
N07  C                   EVAL      ELSTKL = XELSTKL
N07  C                   EVAL      ELNTKL = XELNTKL
N07  C                   EVAL      ELVKTL = XELVKTL
N07  C                   EVAL      ELM3L  = XELM3L
N07  C                   EVAL      ELSTA  = XELSTA
N07  C                   EVAL      ELREAS = XELREAS
N09   *
N09  C                   IF        XSNDK2 = 'J' AND EHSTA <> '5'
N09  C                   MOVE      ELKUND        UKUND             8
N09  C                   MOVE      ELLIN         ULIN              7
N09  C                   MOVE      ELULIN        UULIN             5
N09  C                   CALL      'CC023R'
N09  C                   PARM                    UKUND
N09  C                   PARM                    ELBES
N09  C                   PARM                    ULIN
N09  C                   PARM                    UULIN
N09  C                   END
      *
     C                   endsr
      *
      ***************************************************
     C     UPDTT         BEGSR
      ***************************************************
     C                   EVAL      ETKUND = ELKUND
     C                   EVAL      ETBES  = ELBES
     C                   EVAL      ETLIN  = ELLIN
     C                   EVAL      ETULIN = ELULIN
     C*                  EVAL      ETACTI = 'CHG'
     C                   MOVE      WDT           ETDATE
     C                   MOVE      WTM           ETTIME
     C                   MOVE      BIBRID        ETUSER
     C                   WRITE     EPOTTR
      *
     C                   ENDSR
      *
N09   ***************************************************
N09  C     SRDIRECT      BEGSR
N09   ***************************************************
N09  C     KEY           CHAIN(N)  EPOL                               33
N09  C                   IF        *IN33 = *OFF
N09  C                   MOVE      *ZEROS        UMN               9
N09  C                   MOVE      ELKUND        UKUND             8
N09  C                   MOVE      ELLIN         ULIN              7
N09  C                   CALL      'CC024R'
N09  C                   PARM                    UMN
N09  C                   PARM                    UKUND
N09  C                   PARM                    ELBES
N09  C                   PARM                    ULIN
N09  C                   PARM                    USER
N09  C                   END
N09   *
N09  C     KEYH          CHAIN     EPOH                               33
N09  C                   IF        EHSTA <= '3'
N09  C     KEYH          SETLL     EPOL
N09  C     KEYH          READE(N)  EPOL                                   33
N09  C                   MOVE      'J'           XDIRALL           1
N09  C                   DOW       *IN33 = *OFF
N09  C                   IF        ELAVD = 0
N09  C                   EVAL      XDIRALL = 'N'
N09  C                   LEAVE
N09  C                   END
N09  C     KEYH          READE(N)  EPOL                                   33
N09  C                   ENDDO
N09  C                   IF        XDIRALL = 'J'
N09  C                   EVAL      EHSTA = '5'
N09  C                   END
N09  C                   UPDATE    EPOHR
N09  C                   ELSE
N09  C                   UPDATE    EPOHR
N09  C                   END
N09   *
N09  c                   eval      AVSLUTT = 'D'                                Gir 'self.close'
N09   *
N09  C                   ENDSR
N09   *
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   OPEN      BRIDF
     C     USER          CHAIN(N)  BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
      *
      * hent Parametre som går igjen i mange prog:
      *      Odd/Even/Rowhead-farger,Logobilde,Språk,Intern/Ekstern bruker,  mm
     c                   call      'ESGETPAR'
     c                   parm                    BIBRID
     c                   parm                    BIFIRM
     c                   parm                    BIKUNR
     c                   parm                    BIKNG
     c                   parm                    RowHead          10
     c                   parm                    Odd              10
     c                   parm                    Even             10
     c                   parm                    LogoImg          50
     c                   parm                    XSPRÅK            2
     c                   parm                    XINTERN           1
     c                   parm                    ParmDS1        1024
     c                   parm                    ParmDS2        1024
     c                   parm                    ParmDS3        1024
      *
     C                   OPEN      CUNDL01
     C                   OPEN      EPOL
N09  C                   OPEN      EPOLT
N09  C                   OPEN      EPOAT
N09  C                   OPEN      EPOK
N09  C                   OPEN      EPOKLOG
     C                   OPEN      EPOH
     C                   OPEN      EPOTT
N09  C                   OPEN      ARKIVL02
N09  C                   OPEN      FIRMARC
N09  C                   OPEN      ARKTXT
N09  C                   OPEN      ARKEXT
     C                   OPEN      HEADF
     C                   OPEN      TURER14
     C                   OPEN      BRPARF
     C                   OPEN      STED2
     C                   OPEN      KALENDER
      *
     C     HEADFK        klist
     C                   kfld                    ELAVD
     C                   kfld                    ELOPD
     c     Key           klist
     C                   kfld                    BSKN
     c                   kfld                    ELBES
     c                   kfld                    ELLIN
     c                   kfld                    ELULIN
     c     KeyL          klist
     C                   kfld                    BSKN
     c                   kfld                    ELBES
     c                   kfld                    ELLIN
     c     KeyH          klist
     C                   kfld                    BSKN
     c                   kfld                    ELBES
N09  C     ARKIVL02K     KLIST
N09  C                   KFLD                    ARSTAT
N09  C                   KFLD                    ELAVD
N09  C                   KFLD                    ELOPD
N09  C                   KFLD                    ARTYPE
N09  c                   EVAL      ARSTAT = 'A'
N09  c                   EVAL      ARTYPE = 'go'
N09  C     ARKEXTK       KLIST
N09  C                   KFLD                    ARFIRM
N09  C                   KFLD                    ARCEXT
     c     KunKey        klist
     c                   kfld                    BIFIRM
     c                   kfld                    BSKN
     C     KunKey        chain     CUNDL01
     C     BRPARFK       KLIST
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
     C     EPOTTK        KLIST
     C                   kfld                    ELKUND
     C                   kfld                    ELBES
     C                   kfld                    ELLIN
     C                   kfld                    ELULIN
N09  C     EPOATK        KLIST
N09  C                   kfld                    ELKUND
N09  C                   kfld                    ELART
      *
N01  C     *LIKE         DEFINE    ELLIN         XELLIN
N01  C     *LIKE         DEFINE    ELULIN        XELULIN
N01  C     *LIKE         DEFINE    ELLTYP        XELLTYP
N01  C     *LIKE         DEFINE    ELSTA3        XELSTA3
N01  C     *LIKE         DEFINE    ELNTKL        XELNTKL
N01  C     *LIKE         DEFINE    ELVKTL        XELVKTL
N01  C     *LIKE         DEFINE    ELVKNL        XELVKNL
N01  C     *LIKE         DEFINE    ELM3L         XELM3L
N07  C     *LIKE         DEFINE    ELTTD         XELTTD
N07  C     *LIKE         DEFINE    ELSTD         XELSTD
N07  C     *LIKE         DEFINE    ELART         XELART
N07  C     *LIKE         DEFINE    ELARTL        XELARTL
N07  C     *LIKE         DEFINE    ELARTE        XELARTE
N07  C     *LIKE         DEFINE    ELABES        XELABES
N07  C     *LIKE         DEFINE    ELANTS        XELANTS
N07  C     *LIKE         DEFINE    ELANKL        XELANKL
N07  C     *LIKE         DEFINE    ELSTKL        XELSTKL
N07  C     *LIKE         DEFINE    ELSTA         XELSTA
N07  C     *LIKE         DEFINE    ELREAS        XELREAS
N09   *
N09  C                   MOVE      BIBRID        PABRID
N09  C                   MOVE      'POMKL'       PAID
N09  C                   MOVE      'N'           XJOBBKL           1
N09  C     BRPARFK       chain     BRPARF                             33
N09  C  N33              IF        %SUBST(PAVRDA:1:1) = 'J' OR
N09  C                             %SUBST(PAVRDA:1:1) = 'j'
N09  C                   EVAL      XJOBBKL = 'J'
N09  C                   END
N09   * Hent labeltye (zebra/eltron) dersom det er behandling av tur
N09  c                   Move      *blanks       LabelTyp          1
N09  C                   MOVE      'LABTY'       PAID
N09  C     BRPARFK       Chain     BRPARF                             33
N09  c  n33              MoveL     PAVRDA        LabelTyp
N09  c   33              MoveL     'Z'           LabelTyp
N09  c                   MoveL     'L'           LabelTyp
N09   *
N09  C                   MOVE      ' '           XSNDK2            1
N09  C     KEYH          CHAIN(N)  EPOH                               33
      *
     C                   endsr
      *
