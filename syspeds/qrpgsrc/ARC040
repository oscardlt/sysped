********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 skjekk tegn i dokumenttype
10XXX * 02 SH  PTF10 SELEKTER KUN EN TYPE DOKUMENTER
11XXX * 03 SH  PTF11 utelate *m
      *
      ***********************************************************
      *** PROGRAM SKAL kopiere til cdbrenning
      ***********************************************************
      *
     Farkivl07  IF   E           K DISK
     Ffirm      IF   E           K DISK
     Ffirmarc   IF   E           K DISK
     Farktxt    IF   E           K DISK
     FARKEXT    IF   E           K DISK    PREFIX(Y_)
     FARC040FM  CF   E             WORKSTN
     D                 DS
     D  frapera                1      8
     D  fraper                 1      8s 0
     D  wsafra                 1      4s 0
     D  wspfra                 5      6s 0
     D  wsdfra                 7      8s 0
     D                 DS
     D  tilpera                1      8
     D  tilper                 1      8s 0
     D  wsatil                 1      4s 0
     D  wsptil                 5      6s 0
     D  wsdtil                 7      8s 0
     D                 DS
     D  Idag                   1      8
     D  IdagCC                 1      2s 0
     D  IdagÅÅ                 3      4s 0
     D  IdagMM                 5      6s 0
     D  IdagDD                 7      8s 0
     C*
     C                   EXSR      INIT
     C*
     C     START         TAG
     c                   exfmt     BILDE01
     c   03              goto      slutt
     c                   exsr      testb1
     c  n10              goto      start
     c   30              goto      start
      *
      * starter med å bygge grunnmappen
      *
     c                   exsr      byggm
      *
      * ARKIVERER JOURNALER
      *
N02  C     WSTYPE        IFEQ      'L1'
N02  C     WSTYPE        OREQ      '**'
     C                   EXSR      ARKJOUR
N02  C                   END
     C*
      *
      * ARKIVERER PDF DOKUMENTER
      *
N02  C     WSTYPE        IFNE      'L1'
     C                   EXSR      ARKPDF
N02  C                   END
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     testb1        BEGSR
     C***********************************************
     c* test
     c*
     c                   setoff                                       707130
N02  c                   setoff                                       72
     c     fraper        ifgt      tilper
     c     fraper        orlt      20000000
     c                   seton                                        7030
     C                   MOVE      'SHU0996'     MSGNR
     C                   end
     c     wsfld         ifeq      *blanks
     c                   seton                                        7130
     C                   MOVE      'SHU0997'     MSGNR
     c                   end
      *
N02  c     wstype        ifne      '**'
N02  c     wstype        ANDNE     'L1'
N02  c     wstype        chain     arktxt                             72
N02  c     *in(72)       ifeq      '1'
N02  c                   seton                                        30
N02  C                   MOVE      'SHU1007'     MSGNR
N02  c                   end
N02  c                   end
      *
     C     SLTB          ENDSR
     C***********************************************
     C     byggm         BEGSR
     C***********************************************
     c                   move      *blanks       bane
     C     bane          CAT       wsfld:0       bane
     c     umappe        ifne      *blanks
     C     bane          CAT       '/':0         bane
     c     bane          cat       umappe:0      bane
     c                   end
     c                   call      'ARC040C1'
     c                   parm                    bane
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     c     keypdf0       klist
     c                   kfld                    fifirm
     c                   kfld                    artype
     c                   kfld                    stdato
     c     keypdf1       klist
     c                   kfld                    fifirm
     c                   kfld                    artype
     C     LagKey        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    ARKLAG
     c                   move      *blanks       bane             60
     c                   move      *blanks       umappe           15
     c                   move      *zeros        fraper
     c                   move      *zeros        tilper
     c                   z-add     01            wsdfra
     c                   z-add     31            wsdtil
     C*
     c                   read      firm                                   33
     c                   read      firmarc                                33
      *
     C* foreslå mappenavn for brenning...
     c                   move      20            IdagCC
     c                   move      Uyear         IdagÅÅ
     c                   move      Umonth        IdagMM
     c                   move      Uday          IdagDD
     C     '/'           SCAN      ARCANE:2      X                 3 0
     C                   EVAL      WSFLD  = %SUBST(ARCANE:1:X)
     C                             + 'Burn' + Idag
      *
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     ARKJOUR       BEGSR
     C***********************************************
      *
      * bygger deretter mappe for journalbrenning
      *
     c                   movel     'journaler'   umappe
     c                   exsr      byggm
      *
      * kaller program for å kopiere arkivfil i løsning 1 (IBMENDA)
      *
     C     bane          CAT       '/data.txt':0 bane
     c                   call      'ARC040C2'
     c                   parm                    bane
     c                   parm                    frapera
     c                   parm                    tilpera
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     ARKPDF        BEGSR
     C***********************************************
      *
      * bygger deretter mappe for journalbrenning
      *
     C                   SETOFF                                       33
     C     *IN(33)       DOWEQ     '0'
     C                   READ      ARKTXT                                 33
N02  C     wstype        ifne      '**'
N02  C     wstype        chain     ARKTXT                             33
N02  C                   end
     C     *IN(33)       IFEQ      '0'
N03  c     artype        andne     '*m'
      * Behandle kun TYPER med J i arkiver / Z
     c                   move      *blanks       Y_ARCANE
     c                   movel     ARTYPE        TSTZ              1
     c     arkjn         ifeq      'J'
     c     TSTZ          oreq      'Z'
      *   og hvis ekssternt lager angitt -må det være samme server (samme IP)
     c                   move      *off          *in36
     C     ARKLAG        IFNE      *BLANKS
     C     LagKey        CHAIN     ARKEXT                             36
     c  N36Y_ARCPAD      comp      ARCPAD                             3636
     c                   END
     c     *in36         ifeq      *off
      * fjerne farlige karakterer fra mappenavn
S01  C*    '.':' '       XLATE     artxt         artxt
N01  C     '.':'_'       XLATE     artxt         artxt
     C     '/':'_'       XLATE     artxt         artxt
N01  C     '*':'_'       XLATE     artxt         artxt
N01  C     'ø':'o'       XLATE     artxt         artxt
N01  C     'Ø':'O'       XLATE     artxt         artxt
N01  C     '-':'_'       XLATE     artxt         artxt
N01  C     '>':'_'       XLATE     artxt         artxt
     c                   eval      umappe = artype + '_' + artxt
     c                   exsr      byggm
     c                   exsr      lespdf
     c                   END
     c                   end
     c                   end
N02  C     wstype        ifne      '**'
N02  C                   seton                                        33
N02  C                   end
     c                   end
     c                   endsr
     C*
     C***********************************************
     C     LESPDF        BEGSR
     C***********************************************
     C*
     c                   setoff                                       34
     c                   move      fraper        stdato            8 0
     c     keypdf0       setll     arkivl07
     c     *in(34)       doweq     '0'
     c     keypdf1       reade     arkivl07                               34
     c  N34ARDATE        comp      tilper                             34
     c     *in(34)       ifeq      '0'
     c     arlink        andne     *blanks
     c                   exsr      kopipdf
     c                   end
     c                   end
     c                   endsr
     C*
     C***********************************************
     C     KOPIPDF       BEGSR
     C***********************************************
      * dersom arlink inneholder . tas det som tegn på at det IKKE skal legges på .pdf
      * (kun internproduserte dokumenter mangler extention - de inneholder IKKE . )
     C*
     c*                  move      *blanks       fradok           60
     c                   move      *blanks       fradok           80
     c                   move      *blanks       fradok           80
     c     Y_ARCANE      ifeq      *blanks
     c                   movel     arcane        fradok
     c                   else
     c                   movel     Y_ARCANE      fradok                         annet lager/samme IP
     c                   end
     C     fradok        CAT       '/':0         fradok
     C     fradok        CAT       arlink:0      fradok
     C     '.'           SCAN      arlink                                 35
     C     *in35         ifeq      '0'
     C     fradok        CAT       '.pdf':0      fradok
     c                   end
     c                   move      *blanks       tildok           80
     c                   movel     bane          tildok
     C     tildok        CAT       '/':0         tildok
     C     tildok        CAT       arlink:0      tildok
     C     *in35         ifeq      '0'
     C     tildok        CAT       '.pdf':0      tildok
     c                   end
     c                   call      'ARC040C3'
     c                   parm                    fradok
     c                   parm                    tildok
     c                   endsr
