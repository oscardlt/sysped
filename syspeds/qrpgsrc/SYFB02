********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX * 01 SH  PTF11 HA MED RIKTIG ANTALL
11XXX * 02 SH  PTF11 NYE PARAMETRE
********************************************************************
      *
      **************************************************************
      *** PROGRAM SKAL BEREGNE FRAKT (TRANSPORTØRER UNTATT TG/LG)***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER       ***
      *** LEDIGE INDIKATORER 01-11 13-24                         ***
      *** LEDIGE INDIKATORER 28-32 34-90 95-97                   ***
      **************************************************************
      *
     FFRTAB     IF   E           K DISK
     FFRSTTG    IF   E           K DISK
     FTRAN      IF   E           K DISK
     FSTED2     IF   E           K DISK
     FSYFB02D   CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
     D KN              S              8  0 DIM(50)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  ST2KO2                 1      5
     D  ST2KO3                 1      4
     D                 DS
     D  FPINT                  1     60
     D  IN                     1     60P 0
     D                                     DIM(20)
     D                 DS
     D  FPPR                   1     80
     D  PR                     1     80P 2
     D                                     DIM(20)
     D                 DS
     D  FPMÅTE                 1     60
     D  MÅ                     1     60P 0
     D                                     DIM(20)
     D                 DS
     D  FPRAB                  1     40
     D  RB                     1     40P 1
     D                                     DIM(20)
     D                 DS
     D  FPENDR                 1     40
     D  PM                     1     40P 0
     D                                     DIM(20)
     D                UDS
     D  UFIRM                  1      2
     C*
     C                   EXSR      INIT
     C*
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
      * BEREGNE FRAKT FOR TOLLPOST
     C     *LOVAL        SETLL     FRSTTG
     C                   READ      FRSTTG                                 33
     C  N33TGEK          COMP      *BLANKS                                33
     C                   IF        *IN33
     C                   EXSR      BFTG
     C                   ELSE
     C                   EXSR      BFTGHTTP
     C                   END
      * BEREGNE FRAKT FOR LINJEGODS
     C                   EXSR      BFLG
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     START0        TAG
     C     FRTABK0       SETLL     FRTAB
     C                   READ      FRTAB                                  94
     C     *IN94         IFEQ      '0'
     C                   MOVE      FPKNT         YKNT
     C                   ELSE
     C                   GOTO      ST22
     C                   END
     C     FRTABK        SETGT     FRTAB
     C     START1        TAG
     C     FRTBK1        READPE    FRTAB                                  94
     C     *IN94         IFEQ      '0'
     C     FPPNTT        IFEQ      0
     C                   MOVE      FPPNT         FPPNTT
     C                   END
     C  N27UPNT          CABGT     FPPNTT        START1
     C   27YPNT          CABGT     FPPNTT        START1
     C                   EXSR      FRAFØR
     C  N33              GOTO      START1
     C                   ELSE
     C                   ADD       1             YKNT
     C                   GOTO      START0
     C                   END
      *
     C     START2        TAG
      *
     C  N94              DO
     C                   DO        50
     C                   EXSR      BFRAKT
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C                   ADD       1             XN5               2 0
     C                   MOVE      WSKNT         KN(XN5)
     C     ST21          TAG
     C     FRTBK1        READPE    FRTAB                                  94
     C     *IN94         IFEQ      '0'
     C     FPPNTT        IFEQ      0
     C                   MOVE      FPPNT         FPPNTT
     C                   END
     C  N27UPNT          CABGT     FPPNTT        ST21
     C   27YPNT          CABGT     FPPNTT        ST21
     C                   EXSR      FRAFØR
     C  N33              GOTO      ST21
     C                   ELSE
     C                   ADD       1             YKNT
     C                   GOTO      START0
     C                   END
     C  N94              END
     C                   END
     C*
     C     ST22          TAG
     C  N27              DO
     C                   SETON                                        27
     C                   MOVEL     UPNT          YST               5
     C     YST           CHAIN     STED2                              33
     C  N33              DO
     C                   TESTN                   ST2KO3               33
     C   33              MOVE      ST2KO3        YPNT              4 0
     C                   GOTO      START0
     C                   END
     C                   END
     C*
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     3             POSNBR
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   EXFMT     NYWRK
     C                   ELSE
     C                   WRITE     SUBCTL
     C                   EXFMT     BUNN
     C                   END
     C*
     C***
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   END
     C***
     C*
     C                   SETOFF                                       9899
     C*
     C*** AVSLUTT
     C   12              GOTO      SLUTT
     C*
     C*** BLA VIDERE
     C   25              DO
     C                   SETOFF                                       25
     C                   GOTO      START2
     C                   END
     C*
     C     ZRECNO        IFNE      0
     C                   EXSR      HENT
     C     WSNR          IFEQ      '1'
     C                   GOTO      SLUTT
     C                   END
     C                   END
     C   98XRECNO        IFNE      0
     C                   Z-ADD     XRECNO        ZRECNO
     C                   END
     C                   GOTO      START3
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     HENT          BEGSR
     C***********************************************
     C                   Z-ADD     0             LINNBR
     C                   SETOFF                                       919299
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C   98              DO
     C   99              SETOFF                                       98
     C                   Z-ADD     1             LINNBR
     C                   GOTO      SLHENT
     C                   END
     C     ZRECNO        DIV       16            LINNBR
     C                   MVR                     XLIN              2 0
     C     XLIN          IFEQ      0
     C                   Z-ADD     16            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C     WSNR          IFEQ      '1'                                          PLUKKE
     C                   MOVE      WSKNT         UKNT
     C                   GOTO      SLHENT
     C                   END
     C                   END
     C*
     C     SLHENT        TAG
     C                   ADD       4             LINNBR
     C                   Z-ADD     3             POSNBR
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     FRAFØR        BEGSR
     C***********************************************
     C                   SETON                                        33
     C                   Z-ADD     1             XN6               2 0
     C     XN6           DOWLE     XN5
     C     KN(XN6)       COMP      FPKNT                              3333
     C  N33              LEAVE
     C                   ADD       1             XN6
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     BFTG          BEGSR
     C***********************************************
     C                   MOVE      'N'           UOVERS
     C                   MOVE      UPNF          GMPNF             4 0
     C                   MOVE      *BLANKS       CHGPNF            9
     C                   MOVE      *ZEROS        URAB
     C                   MOVE      *ZEROS        UKNT2
     C                   Z-ADD     2             UFLAGG
     C                   CALL      'SYFB03'
     C                   PARM                    UPNF
     C                   PARM                    UPNT
     C                   PARM                    UVKT
     C                   PARM                    ULM
     C                   PARM                    UM3
     C                   PARM                    UKNT2             8 0
     C                   PARM                    UBL               9 0
     C     WSVKT2        PARM                    UVKT2             9 0
     C                   PARM                    UFLAGG            1 0
     C                   PARM                    UOVERS            1
     C                   PARM                    UKUNDE            8 0
     C                   PARM                    UANT              7 0
     C                   PARM                    UTGSON            3
     C                   PARM                    UBL2              9 0
     C                   PARM                    URAB              3 1
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD              7 0
     C                   PARM                    UFBN              3 0
     C     UPNF          IFNE      GMPNF
     C                   MOVEL     ' FRA:   '    CHGPNF
     C                   MOVE      UPNF          CHGPNF
     C                   MOVE      GMPNF         UPNF
     C                   END
     C     UFLAGG        IFEQ      0
     C                   MOVE      UKNT2         WSKNT
     C                   MOVE      UBL           WSBL1
     C     TRANK         CHAIN     TRAN                               33
     C   33              MOVE      *BLANKS       VMNAVN
     C   33              MOVE      *ZEROS        VMRAB
     C     CHGPNF        IFEQ      *BLANKS
     C                   MOVE      UTGSON        VMNAVN
     C                   ELSE
     C                   MOVEL     CHGPNF        CPNSON           13
     C                   MOVE      UTGSON        CPNSON
     C                   MOVE      CPNSON        VMNAVN
     C                   END
     C     URAB          IFEQ      *ZEROS
     C                   Z-ADD     VMRAB         WSRAB
     C     100           SUB       WSRAB         XRABAT
     C                   DIV       100           XRABAT
     C     XRABAT        MULT(H)   UBL           WSBL2
     C                   ELSE
     C                   Z-ADD     URAB          WSRAB
     C                   MOVE      UBL2          WSBL1
     C                   MOVE      UBL           WSBL2
     C                   END
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C                   END
     C*
     C                   ENDSR
     C*
      ***********************************************
     C     BFTGHTTP      BEGSR
      ***********************************************
     C                   MOVE      'N'           UOVERS
     C                   MOVE      UPNF          U2PNF             4
     C                   MOVE      UPNT          U2PNT             4
S01  C*                  MOVE      '0000001'     U2NT              7
N01  C                   MOVE      UANT          U2NT              7
     C                   MOVE      UVKT          U2VKT             9
     C                   MOVE      UM3           U2DM3             7
     C                   MOVE      *ZEROS        U2KNT             8
     C                   MOVE      '2'           U2FLAGG           1
     C                   MOVE      UAVD          U2AVD             4
     C                   MOVE      UOPD          U2OPD             7
     C                   MOVE      UKUNDE        U2KN              8
     C                   MOVE      *ZEROS        U2RAB             3
N02  C                   MOVE      UKS           U2KS             12
N02  C                   MOVE      Utra          U2tra             8
N02  C                   MOVE      Upro          U2pro             5
     C                   CALL      'SYFB05C'
     C                   PARM                    U2PNF
     C                   PARM                    U2PNT
     C                   PARM                    U2NT
     C                   PARM                    U2VKT
     C                   PARM                    U2DM3
     C                   PARM                    U2KNT
     C                   PARM                    U2BRTBL           9
     C                   PARM                    U2NETBL           9
     C                   PARM                    U2RAB
     C                   PARM                    U2FLAGG
     C                   PARM                    U2AVD
     C                   PARM                    U2OPD
     C                   PARM                    U2KN
N01  C                   PARM                    U2KS
N01  C                   PARM                    U2tra
N01  C                   PARM                    U2pro
     C                   IF        U2FLAGG = '0'
     C                   MOVE      U2KNT         WSKNT
     C     TRANK         CHAIN     TRAN                               33
     C   33              MOVE      *BLANKS       VMNAVN
     C                   MOVE      UVKT          WSVKT2
     C                   MOVE      U2NETBL       WSBL1
     C                   MOVE      U2BRTBL       WSBL2
     C                   MOVE      U2RAB         WSRAB
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     BFLG          BEGSR
     C***********************************************
     C                   CALL      'SYFB04'
     C                   PARM                    UPNF
     C                   PARM                    UPNT
     C                   PARM                    UVKT
     C                   PARM                    ULM
     C                   PARM                    UM3
     C                   PARM                    UKNT2             8 0
     C                   PARM                    UBL               9 0
     C     WSVKT2        PARM                    UVKT2             9 0
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      0
     C                   MOVE      UKNT2         WSKNT
     C                   MOVE      UBL           WSBL1
     C     TRANK         CHAIN     TRAN                               33
     C   33              MOVE      *BLANKS       VMNAVN
     C   33              MOVE      *ZEROS        VMRAB
     C                   Z-ADD     VMRAB         WSRAB
     C     100           SUB       WSRAB         XRABAT
     C                   DIV       100           XRABAT
     C     XRABAT        MULT(H)   UBL           WSBL2
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     BFRAKT        BEGSR
     C***********************************************
     C                   MOVE      FPKNT         WSKNT
     C     TRANK         CHAIN     TRAN                               33
     C   33              DO
     C                   MOVE      *BLANKS       VMNAVN
     C                   MOVE      *ZEROS        VMLMOM
     C                   MOVE      *ZEROS        VMM3OM
     C                   MOVE      *ZEROS        VMRAB
     C                   END
     C*
     C     ULM           MULT(H)   VMLMOM        XVKTLM            9 0
     C     UM3           MULT(H)   VMM3OM        XVKTM3            9 0
     C                   SELECT
     C     UVKT          WHENGE    XVKTLM
     C     UVKT          ANDGE     XVKTM3
     C                   MOVE      UVKT          XVKT              9 0
     C     XVKTLM        WHENGE    XVKTM3
     C                   MOVE      XVKTLM        XVKT
     C                   OTHER
     C                   MOVE      XVKTM3        XVKT
     C                   ENDSL
     C                   Z-ADD     XVKT          WSVKT2
     C     XVKT          IFGT      99999
     C                   Z-ADD     99999         XVKT5             5 0
     C                   ELSE
     C                   Z-ADD     XVKT          XVKT5
     C                   END
     C*
     C     1             DO        20            XN                2 0
     C*          XVKT5     IFLT IN,XN
     C     XVKT5         IFLE      IN(XN)
     C                   LEAVE
     C                   END
     C                   END
      * HVIS VEKT ER STØRRE ENN SISTE VEKTGRUPPEN, SETTES PRISEN 0.
     C     XN            IFGT      20
     C     PR(XN)        OREQ      0
     C                   MOVE      *ZEROS        WSBL1
     C                   MOVE      *ZEROS        WSBL2
     C                   ELSE
      *
      *** BEREGNE FRAKT I DETTE INTERVALET SOM VEKT LIGGER I.
     C                   SELECT
     C     MÅ(XN)        WHENEQ    0
     C                   Z-ADD     PR(XN)        XPR11            11 2
     C     MÅ(XN)        WHENEQ    1
     C     XVKT          MULT      PR(XN)        XPR11
     C                   OTHER
     C     XVKT          ADD       MÅ(XN)        XVKT
     C                   SUB       1             XVKT
     C     XVKT          DIV       MÅ(XN)        XPR09             9 0
     C     XPR09         MULT(H)   PR(XN)        XPR11
     C                   ENDSL
     C     XPR11         ADD       PM(XN)        XPR11
      * TEST OM BELØP ER MINDRE ENN MINIMUM
     C     FPMIN         IFGT      XPR11
     C                   Z-ADD     FPMIN         XPR11
     C                   END
      * BEREGNE RABATT
     C     VMRAB         IFEQ      0
     C     100           SUB       RB(XN)        XRABAT            6 3
     C                   ELSE
     C     100           SUB       VMRAB         XRABAT
     C                   END
     C                   DIV       100           XRABAT
      * BEREGNE FRAKT MED RABATT
     C     XPR11         MULT(H)   XRABAT        XPR12            11 2
      *
     C     IN(XN)        IFLT      99999
     c     XN            ANDLT     20
     C                   Z-ADD     IN(XN)        XVKT2             5 0
     C                   ADD       1             XN
     C                   ADD       MÅ(XN)        XVKT2
      *** BEREGNE FRAKT I NESTE INTERVALET.
     C                   SELECT
     C     MÅ(XN)        WHENEQ    0
     C                   Z-ADD     PR(XN)        XPR21            11 2
     C     MÅ(XN)        WHENEQ    1
     C     XVKT2         MULT      PR(XN)        XPR21
     C                   OTHER
     C     XVKT2         DIV       MÅ(XN)        XPR21
     C     XVKT2         DIV       MÅ(XN)        XPR09
     C     XPR09         MULT(H)   PR(XN)        XPR21
     C                   ENDSL
     C     XPR21         ADD       PM(XN)        XPR21
      * BEREGNE RABATT
     C     VMRAB         IFEQ      0
     C     100           SUB       RB(XN)        XRABA2            6 3
     C                   ELSE
     C     100           SUB       VMRAB         XRABA2
     C                   END
     C                   DIV       100           XRABA2
      * BEREGNE FRAKT MED RABATT
     C     XPR21         MULT(H)   XRABA2        XPR22             9 0
      *
     C     XPR22         IFLT      XPR12
     C                   Z-ADD     XVKT2         WSVKT2
     C                   Z-ADD(H)  XPR21         WSBL1
     C                   Z-ADD(H)  XPR22         WSBL2
     C                   Z-ADD     XRABA2        XRABAT
     C                   ELSE
     C                   Z-ADD(H)  XPR11         WSBL1
     C                   Z-ADD(H)  XPR12         WSBL2
     C                   END
      *
     C                   ELSE
      *
     C                   Z-ADD(H)  XPR11         WSBL1
     C                   Z-ADD(H)  XPR12         WSBL2
      *
     C                   END
      *
     C                   SUB       1             XRABAT
     C     XRABAT        MULT      100           WSRAB
      *
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     FRTABK0       KLIST
     C                   KFLD                    YKNT
     C                   KFLD                    UPNF
     C     FRTABK        KLIST
     C                   KFLD                    YKNT
     C                   KFLD                    UPNF
     C                   KFLD                    UPNT
     C     FRTBK1        KLIST
     C                   KFLD                    YKNT
     C                   KFLD                    UPNF
     C     FRTBK2        KLIST
     C                   KFLD                    YKNT
     C                   KFLD                    UPNF
     C                   KFLD                    YPNT
     C     TRANK         KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSKNT
     C*
     C     *ENTRY        PLIST
     C     WSPNF         PARM                    UPNF              4 0
     C     WSPNT         PARM                    UPNT              4 0
     C     WSVKT         PARM                    UVKT              9 0
     C     WSLM          PARM                    ULM               7 3
     C     WSM3          PARM                    UM3               7 3
     C                   PARM                    UKNT              8 0
     C                   PARM                    UKUNDE            8 0
     C                   PARM                    UANT              7 0
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD              7 0
     C                   PARM                    UFBN              3 0
N01  C                   PARM                    UKS              12
N01  C                   PARM                    UTRA              8
N01  C                   PARM                    UPRO              5
     C*
     C                   MOVE      *ZEROS        KN
     C                   MOVE      *ZEROS        IN
     C                   MOVE      *ZEROS        PR
     C                   MOVE      *ZEROS        MÅ
     C                   MOVE      *ZEROS        RB
     C                   MOVE      *ZEROS        PM
     C                   MOVE      *ZEROS        YKNT              8 0
     C*
     C                   ENDSR
     C*
