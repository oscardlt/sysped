             PGM        PARM(&KUN &AVD &OPD &FAK &VAL &KOP &KOHE +
                          &DAT &FFDAT &TYP &STMF &BANE &VISE &INFOP)
             DCL        VAR(&AVD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&OPD) TYPE(*CHAR) LEN(7)
             DCL        VAR(&KUN) TYPE(*CHAR) LEN(8)
             DCL        VAR(&FAK) TYPE(*CHAR) LEN(7)
             DCL        VAR(&VAL) TYPE(*CHAR) LEN(3)
             DCL        VAR(&KOP) TYPE(*CHAR) LEN(1)
             DCL        VAR(&KOHE) TYPE(*CHAR) LEN(28)
             DCL        VAR(&DAT) TYPE(*CHAR) LEN(6)
             DCL        VAR(&FFDAT) TYPE(*CHAR) LEN(6)
             DCL        VAR(&TYP) TYPE(*CHAR) LEN(1)
             DCL        VAR(&DAT) TYPE(*CHAR) LEN(6)
             DCL        VAR(&FILEN) TYPE(*CHAR) LEN(10)
             DCL        VAR(&STMF) TYPE(*CHAR) LEN(152)
             DCL        VAR(&VISE) TYPE(*CHAR) LEN(1)
             DCL        VAR(&INFOP) TYPE(*CHAR) LEN(1)
             DCL        VAR(&BANE) TYPE(*CHAR) LEN(50)
             DCL        VAR(&QUSER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QJOB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QNBR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&LIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&UNIK) TYPE(*CHAR) LEN(10) /* Unikkode +
                          til register SORT. */
             DCL        VAR(&TIME) TYPE(*CHAR) LEN(9)

             RTVJOBA    JOB(&QJOB) USER(&QUSER) NBR(&QNBR)
             OVRMSGF    MSGF(QUSERMSG) TOMSGF(SYMSGF)
             IF         COND(&INFOP = 'D') THEN(DO)
             OVRPRTF    FILE(SYFA27PP) DEVTYPE(*AFPDS) PAGESIZE(70 +
                          80) CPI(10) OVRFLW(66) FRONTOVL(LOGOFAKT) +
                          OUTQ(OUTMAIL) +
                          TOSTMF(&BANE) WSCST(*PDF)
             ENDDO

             IF         COND(&INFOP *NE 'D') THEN(DO)
             OVRPRTF    FILE(SYFA27PP) DEVTYPE(*AFPDS) PAGESIZE(70 +
                          80) CPI(10) OVRFLW(66) FRONTOVL(LOGOFAKT) +
                          OUTQ(OUTMAIL)
             ENDDO
    /*                        */
    /* SETTER VARIABLE        */
    /*                        */
VIDERE:      CHGDTAARA  DTAARA(*LDA (15 4)) VALUE(&AVD)
             CHGDTAARA  DTAARA(*LDA (48 1)) VALUE('A')
    /*                        */
    /* OPPRETTE SORTERINGSFIL */
    /*                        */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&TIME)
             CHGVAR     VAR(&UNIK) VALUE('W' *CAT &TIME)
             RTVDTAARA  DTAARA(FIRMDT (141 10)) RTNVAR(&LIB)
             OVRDBF     FILE(SORT) TOFILE(&LIB/SORT)

             RMVM       FILE(&LIB/SORT) MBR(&UNIK)
             MONMSG     MSGID(CPF7310)
             ADDPFM     FILE(&LIB/SORT) MBR(&UNIK)
             OVRDBF     FILE(SORT) TOFILE(&LIB/SORT) MBR(&UNIK)

    /* SKRIVE UT FAKTURA */
             CALL       PGM(SYFA27Q) PARM(&KUN &AVD &OPD &FAK &VAL +
                                          &KOP &KOHE &DAT &FFDAT &TYP)
             IF         COND(&INFOP = 'D') THEN(RETURN)
    /*                   */
             CHGVAR     VAR(&FILEN) VALUE('SYFA27PP')
    /* */
             ADDLIBLE   LIB(MMAIL)
             MONMSG     MSGID(CPF0000)
/*                                       */
/* LAGER PDF OG LEGGER I MAPPE          */
/* UTEN INFOPRINT                        */
/*                                       */
             IF         COND(&INFOP = 'N') THEN(DO)
             CVTSPLFPDF SPLF(&FILEN) JOB(&QNBR/&QUSER/&QJOB) +
                          TOPDF(&BANE) ORIENTAT(*V)
                          ENDDO
/*                                       */
/* LAGER PDF OG LEGGER I MAPPE           */
/* MED  INFOPRINT                        */
/*                                       */
             IF         COND(&INFOP = 'J') THEN(DO)
             CALL       PGM(INF001CL) PARM(&FILEN &QNBR &QUSER &QJOB +
                          &BANE)
                          ENDDO
             RMVLIBLE   LIB(MMAIL)
    /* */
             RCLRSC
             RMVM       FILE(SORT) MBR(&UNIK)
    /* */
SLUTT:       ENDPGM
