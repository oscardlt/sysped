********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 KOPIER ENDRET LINJE TIL ALLE MED SAMME PRISTYPE
********************************************************************
      *
      ***********************************************************
      *** PROGRAM SKAL ARBEIDE MED PRIS UTLEVERING            ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      ***********************************************************
      *
     FFIRM      IF   E           K DISK
     FHEADF     IF   E           K DISK
     FFAKT      IF   E           K DISK
     F                                     RENAME(FAKTR:FAKTR0)
     FFAK5      UF A E           K DISK
     FLLGSFL01  UF A E           K DISK
     FLLGSFL04  IF   E           K DISK
     F                                     RENAME(LLGSFR:LLGSFR4)
     FLLGSFW01  UF A E           K DISK
     F                                     RENAME(LLGSFR:LLGSFRW)
     FLLGSFW03  IF   E           K DISK
     F                                     RENAME(LLGSFR:LLGSFRW3)
     FLLHEAD07  IF   E           K DISK
     FLLAGJL01  IF   E           K DISK
     FLLAGJL10  IF   E           K DISK
     F                                     RENAME(LLAGJR:LLAGJR10)
     FLLKAFL02  IF   E           K DISK
     FLLKAFL03  IF   E           K DISK
     F                                     RENAME(LLKAFR:LLKAFR03)
     FLLGRPK05  IF   E           K DISK
     FLLXFAK    IF   E           K DISK
     FKOFAST    IF   E           K DISK
     FKODTGE    IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FVALUL01   IF   E           K DISK
     FLL052D    CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  XTEKST                 1     34
     D  XTLPT                  1      3
     D  XTTXT                  5     27
     D  XTGEB                 29     31
     D  XTANR                  1     15
     D  XTLLOK                17     34
     D  XDLT                   1      7
     D                 DS
     D  HEDTOP                 1      8  0
     D  HEDTOÅ                 1      4  0
     D  HEDTOM                 5      6  0
     D  HEDTOD                 7      8  0
     D                 DS
     D  XDTF                   1      8  0
     D  XDTFÅ                  1      4  0
     D  XDTFM                  5      6  0
     D  XDTFD                  7      8  0
     D                 DS
     D  XDTT                   1      8  0
     D  XDTTÅ                  1      4  0
     D  XDTTM                  5      6  0
     D  XDTTD                  7      8  0
     D                 DS
     D  AN                     1     20
     D                                     DIM(20)
     D  AN20                   1     20
     D                 DS
     D  XN07                   1      7  0
     D  XN02                   8      9  0
     D  XN92                   1      9  2
     D  XA07                   1      7
     D  XA02                   8      9
     D                 DS
     D XTXT01          C                   CONST('Uten grupp')
     D XTXT02          C                   CONST('Kunde uten gr.-
     D                                     tilhørighet')
     D                 DS
     D  U1PARM                 1    256
     D  U1GRP                  1      8
     D  U1PNR                  9     16
     D  U1BNR                 17     33
     D  U1PAK                 34     50
     D  U1ORDR                51     67
     D  U1FLN                 68     84
     D  U1TDT                 85     92  0
     D  U1ALN                 93     99  0
     D  U1AVD                100    103  0
     D  U1OPD                104    110  0
     D  U1UT                 111    115
     D  U1FIRM               116    117
     D  U1ANR                118    132
     D  U1FLAG               256    256
      *
     C                   EXSR      INIT
      *
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     *IN27         IFEQ      '0'
     C     LGW1K         SETLL     LLGSFW01
     C     LGW1K         READE(N)  LLGSFW01                               94
     C                   ELSE
     C     LGW1K         SETLL     LLGSFW03
     C     LGW1K         READE     LLGSFW03                               94
     C                   END
     C     *IN94         IFEQ      '0'                                          1<-B
      * FAKTURAGRUNNLAG FINNES FRA FØR
     C                   EXSR      SRFIL
      *
     C                   ELSE                                                   1
     C     *IN27         CABEQ     '1'           SLUTT
      *
     C     LH07K         SETLL     LLHEAD07
     C     LH07K         READE     LLHEAD07                               94
     C     *IN94         IFEQ      '0'                                           2<-B
      * BEREGN FAKTURAGRUNNLAG FOR UTTAK
     C                   MOVE      '0'           *IN36
     C                   ELSE                                                    2
     C     LA10K         SETLL     LLAGJL10
     C     LA10K         READE     LLAGJL10                               94
     C     *IN94         IFEQ      '0'                                            3<-B
      * BEREGN FAKTURAGRUNNLAG FOR INNLEGGING
     C                   MOVE      '1'           *IN36
     C                   ELSE                                                     3
      * BEREGN FAKTURAGRUNNLAG FOR LAGERLEIER
     C                   EXSR      SRLEIE
     C                   GOTO      SLUTT
     C                   END                                                      3<-E
     C                   END                                                     2<-E
      *
     C     *IN36         IFEQ      '0'                                           2<-B
     C                   EXSR      SRUT
     C                   ELSE                                                    2
     C                   EXSR      SRINN
     C                   END                                                     2<-E
     C     XAUTO         IFEQ      'J'
     C                   Z-ADD     ZRECNO        YRECNO            4 0
     C                   EXSR      OPDFAK
     C                   GOTO      SLUTT
     C                   END
      *
     C                   END                                                    1<-E
      *
     C                   Z-ADD     ZRECNO        YRECNO            4 0
     C     ZRECNO        IFGT      1
     C                   Z-ADD     1             ZRECNO
     C                   END
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
      *
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   EXFMT     NYVARE
     C                   ELSE
     C                   WRITE     BUNN
     C                   EXFMT     SUBCTL
     C                   END
      *
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
      *
     C                   SETOFF                                       9998
     C                   SETOFF                                       30
      *** VIS MOTTAK ELLER UTTAK
     C   02              DO
     C                   EXSR      DSPLL
     C                   GOTO      START
     C                   END
      *** FRISK OPP
     C   05              GOTO      START
      *** BEREGN PÅ NYTT
     C   07              DO
     C     LGW1K         SETLL     LLGSFW01
     C     LGW1K         READE     LLGSFW01                               33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    LLGSFRW
     C     LGW1K         READE     LLGSFW01                               33
     C  N33              ENDDO
     C                   GOTO      START
     C                   END
      *** AVSLUTT
     C   12              DO
     C                   Z-ADD     1             UFLAGG
     C                   GOTO      SLUTT
     C                   END
      *** OPPDATER PÅ FAKTURAFIL
     C   23              DO
     C                   EXSR      OPDFAK
     C                   GOTO      SLUTT
     C                   END
      *
      *** BLA VIDERE
     C   25              DO
     C                   Z-ADD     YRECNO        ZRECNO
     C                   SETOFF                                       25
     C                   GOTO      START3
     C                   END
      *
     C     ZRECNO        IFNE      0
     C                   EXSR      HHENT
     C                   END
     C   98XRECNO        IFNE      0
     C                   Z-ADD     XRECNO        ZRECNO
     C                   END
     C                   GOTO      START3
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
     C***********************************************
     C     SRFIL         BEGSR
     C***********************************************
     C     GSMN          COMP      0                                  3636
     C     *IN36         IFEQ      '0'
     C                   MOVE      'S'           YSK               1
     C     LH07K         SETLL     LLHEAD07
     C     LH07K         READE     LLHEAD07                               33
     C                   MOVE      LHGRP         YGRP
     C                   MOVE      LHPNR         YPNR
     C                   MOVEL     'LAGERUTT'    KFTYP
     C                   MOVE      'AK'          KFTYP
     C                   ELSE
     C                   MOVE      'K'           YSK
     C     LA10K         SETLL     LLAGJL10
     C     LA10K         READE     LLAGJL10                               33
     C                   MOVE      VAGRUP        YGRP
     C                   MOVE      VAKJED        YPNR
     C                   MOVEL     'LAGERMOT'    KFTYP
     C                   MOVE      VAMRNR        UMRNR             5
     C                   END
      *
     C     YGRP          COMP      0                                      33
     C  N33CUN1KG        CHAIN     CUNDL01                            33
     C  N33              MOVEL     KNAVN         XXGNV2
     C   33              MOVEL     XTXT01        XXGNV2
     C     CUN1KP        CHAIN     CUNDL01                            33
     C  N33              MOVEL     KNAVN         XXPNV2
     C   33              MOVE      *BLANKS       XXPNV2
     C   33              MOVEL     '*UKJENT'     XXPNV2
     C                   MOVE      *ZEROS        XXBLT
     C                   MOVE      UAVD          GSAVD
     C                   MOVE      UOPD          GSOPD
     C                   MOVE      *ZEROS        XXMN              7 0
      *
     C     *IN94         DOWEQ     '0'
     C   36GSMN          IFNE      XXMN
     C                   MOVE      '1'           *IN35
     C     LA01K         CHAIN     LLAGJL01                           33
     C                   MOVE      *BLANKS       XTEKST
     C                   MOVE      VAANR         XTANR
     C                   MOVEL     VALLOK        XTLLOK
     C                   MOVE      GSBL          XXBL              7 2
     C                   MOVE      *ZEROS        GSBL
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C                   MOVE      XXBL          GSBL
     C                   MOVE      '0'           *IN35
     C                   MOVE      *BLANKS       XTEKST
     C                   MOVE      GSMN          XXMN
     C                   END
     C                   MOVEL     GSLPT         KFKOD
     C     KOFASK        CHAIN     KOFAST                             34
     C                   MOVE      GSLPT         XTLPT
     C                   MOVEL     KFTXT         XTTXT
     C                   MOVE      GSGEB         XTGEB
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C                   ADD       GSBL          XXBLT
     C     *IN27         IFEQ      '0'
     C     LGW1K         READE(N)  LLGSFW01                               94
     C                   ELSE
     C     LGW1K         READE     LLGSFW03                               94
     C                   END
     C  N94              ENDDO
      *
     C                   ENDSR
      *
     C***********************************************
     C     SRUT          BEGSR
     C***********************************************
     C                   MOVE      'S'           YSK
     C                   MOVE      LHGRP         YGRP
     C                   MOVE      LHPNR         YPNR
     C     LHGRP         COMP      0                                      33
     C  N33CUN1KG        CHAIN     CUNDL01                            33
     C  N33              MOVEL     KNAVN         XXGNV2
     C   33              MOVEL     XTXT01        XXGNV2
     C     CUN1KP        CHAIN     CUNDL01                            33
     C  N33              MOVEL     KNAVN         XXPNV2
     C   33              MOVE      *BLANKS       XXPNV2
     C   33              MOVEL     '*UKJENT'     XXPNV2
     C                   MOVEL     'LAGERUTT'    KFTYP
     C                   MOVE      'AK'          KFTYP
     C                   MOVE      *ZEROS        XXBLT
     C                   MOVE      UAVD          GSAVD
     C                   MOVE      UOPD          GSOPD
     C                   MOVE      *ZEROS        GSLI
      *
     C     *IN94         DOWEQ     '0'                                          1<-B
     C                   MOVE      *ZEROS        XDAG              2 0
      *
     C     LKA3K         SETLL     LLKAFL03
     C     LKA3K         READE     LLKAFL03                               33
      *
     C     *IN33         IFEQ      '1'                                           2<-B
     C                   MOVE      *ZEROS        YPNR
     C     LKA3K         SETLL     LLKAFL03
     C     LKA3K         READE     LLKAFL03                               33
     C     *IN33         IFEQ      '1'                                            3<-B
     C     YGRP          ANDNE     0
     C                   MOVE      *ZEROS        YGRP
     C     LKA3K         SETLL     LLKAFL03
     C     LKA3K         READE     LLKAFL03                               33
     C                   END                                                      3<-E
     C                   END                                                     2<-E
      *
     C     *IN33         DOWEQ     '0'                                           2<-B
     C     KADTUT        CABLT     LHTDT         STUT
     C     KALPT         CABEQ     GSLPT         STUT
      *
     C                   MOVEL     KALPT         KFKOD
     C     KOFASK        CHAIN     KOFAST                             34
     C                   MOVE      KALPT         XTLPT
     C                   MOVEL     KFTXT         XTTXT
     C                   MOVE      KAGEB         XTGEB
     C                   MOVE      KALPT         GSLPT
     C                   MOVE      KAGEB         GSGEB
     C                   MOVE      KAPR          GSPR
     C                   MOVE      KAMVA         GSMVA
     C                   MOVE      KAVAL         GSVAL
     C                   MOVE      *ZEROS        GSBL
     C                   MOVE      *ZEROS        GSANT
      *
     C                   SELECT                                                   3<-B
     C     KALPT         WHENEQ    'A  '
     C                   Z-ADD     LHKLL         GSANT
     C     KAPR          MULT(H)   LHKLL         GSBL
     C     KALPT         WHENEQ    'B10'
     C                   SELECT
     C     KAMDAG        WHENGE    LHTLIN
     C                   Z-ADD     LHTLIN        GSANT
     C                   Z-ADD     LHTLIN        XDAG
     C     KAMDAG        MULT(H)   KAPR          GSBL
     C     KADAG         WHENGE    LHTLIN
     C                   Z-ADD     LHTLIN        GSANT
     C                   Z-ADD     LHTLIN        XDAG
     C     GSANT         MULT(H)   KAPR          GSBL
     C                   OTHER
     C                   Z-ADD     KADAG         GSANT
     C                   Z-ADD     KADAG         XDAG
     C     GSANT         MULT(H)   KAPR          GSBL
     C                   ENDSL
     C     KALPT         WHENEQ    'B20'
     C     XDAG          IFLT      LHTLIN
     C     LHTLIN        SUB       XDAG          GSANT
     C     GSANT         IFGT      0
     C     KAPR          MULT(H)   GSANT         GSBL
     C                   END
     C                   END
     C     KALPT         WHENEQ    'C10'
     C                   Z-ADD     LHANT0        GSANT
     C     KAPR          MULT(H)   LHANT0        GSBL
     C     KALPT         WHENEQ    'C20'
     C                   Z-ADD     LHANT1        GSANT
     C     KAPR          MULT(H)   LHANT1        GSBL
     C     KALPT         WHENEQ    'C30'
     C                   Z-ADD     LHANT2        GSANT
     C     KAPR          MULT(H)   LHANT2        GSBL
     C     KALPT         WHENEQ    'C40'
     C                   Z-ADD     LHANT3        GSANT
     C     KAPR          MULT(H)   LHANT3        GSBL
     C     KALPT         WHENEQ    'C50'
     C                   Z-ADD     LHWVEK        GSANT
     C     KAPR          MULT(H)   LHWVEK        GSBL
     C     KALPT         WHENEQ    'C60'
     C                   Z-ADD     LHWKUB        GSANT
     C     KAPR          MULT(H)   LHWKUB        GSBL
     C     KALPT         WHENEQ    'D10'
     C                   Z-ADD     LHKLL         GSANT
     C     KAPR          MULT(H)   LHKLL         GSBL
     C     KALPT         WHENEQ    'D20'
     C                   Z-ADD     LHWVEK        GSANT
     C     KAPR          MULT(H)   LHWVEK        GSBL
     C     KALPT         WHENEQ    'E  '
     C     KALPT         OREQ      'E2 '
     C                   Z-ADD     0             GSANT
     C                   Z-ADD(H)  0             GSBL
     C     KALPT         WHENGE    'X  '
     C     KALPT         ANDLE     'X99'
     C     LLXFAKK       CHAIN     LLXFAK                             33
     C                   IF        *IN33
     C                   Z-ADD     0             GSANT
     C                   Z-ADD     0             GSBL
     C                   ELSE
     C                   Z-ADD     LXANT         GSANT
     C                   EVAL      GSBL = KAPR * GSANT
     C                   END
     C                   ENDSL                                                    3<-E
      *
      * NY "SELEC" PGA. FOR MANGE "WHEQ"
     C                   SELECT                                                   3<-B
     C     KALPT         WHENEQ    'O  '
     C                   Z-ADD     1             GSANT
     C                   Z-ADD     GSPR          GSBL
     C                   ENDSL                                                    3<-E
     C     GSBL          IFLT      KAPRM
     C                   Z-ADD     KAPRM         GSBL
     C                   END
     C                   ADD       GSBL          XXBLT
     C                   ADD       1             GSLI
     C                   WRITE     LLGSFRW
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C     STUT          TAG
     C     LKA3K         READE     LLKAFL03                               33
     C  N33              ENDDO                                                   2<-E
      *
     C     LH07K         READE     LLHEAD07                               94
     C  N94              ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
     C***********************************************
     C     SRINN         BEGSR
     C***********************************************
     C                   MOVE      'K'           YSK
     C                   MOVE      VAGRUP        YGRP
     C                   MOVE      VAKJED        YPNR
     C                   MOVE      VAMRNR        UMRNR             5
     C     YGRP          COMP      0                                      33
     C  N33CUN1KG        CHAIN     CUNDL01                            33
     C  N33              MOVEL     KNAVN         XXGNV2
     C   33              MOVEL     XTXT01        XXGNV2
     C     CUN1KP        CHAIN     CUNDL01                            33
     C  N33              MOVEL     KNAVN         XXPNV2
     C   33              MOVE      *BLANKS       XXPNV2
     C   33              MOVEL     '*UKJENT'     XXPNV2
     C                   MOVEL     'LAGERMOT'    KFTYP
     C                   MOVE      '  '          KFTYP
     C                   MOVE      *ZEROS        XXBLT
     C                   MOVE      UAVD          GSAVD
     C                   MOVE      UOPD          GSOPD
     C                   MOVE      *ZEROS        GSLI
      *
     C     *IN94         DOWEQ     '0'                                          1<-B
     C                   MOVE      VAMN          GSMN
     C                   MOVE      *BLANKS       GSLPT
     C                   MOVE      *BLANKS       XTEKST
     C                   MOVE      VAANR         XTANR
     C                   MOVEL     VALLOK        XTLLOK
     C                   MOVE      *ZEROS        GSBL
     C                   MOVE      '1'           *IN35
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C                   MOVE      '0'           *IN35
     C                   MOVE      *BLANKS       XTEKST
      *
     C     LKA2K         SETLL     LLKAFL02
     C     LKA2K         READE     LLKAFL02                               33
      *
     C     *IN33         IFEQ      '1'                                           2<-B
     C                   MOVE      *ZEROS        YPNR
     C     LKA2K         SETLL     LLKAFL02
     C     LKA2K         READE     LLKAFL02                               33
     C     *IN33         IFEQ      '1'                                            3<-B
     C     YGRP          ANDNE     0
     C                   MOVE      *ZEROS        YGRP
     C     LKA2K         SETLL     LLKAFL02
     C     LKA2K         READE     LLKAFL02                               33
     C                   END                                                      3<-E
     C                   END                                                     2<-E
      *
     C     *IN33         DOWEQ     '0'                                           2<-B
     C     KADTUT        CABLT     VADATO        STINN
     C     KALPT         CABEQ     GSLPT         STINN
      *
     C                   MOVEL     KALPT         KFKOD
     C     KOFASK        CHAIN     KOFAST                             34
     C                   MOVE      KALPT         XTLPT
     C                   MOVEL     KFTXT         XTTXT
     C                   MOVE      KAGEB         XTGEB
     C                   MOVE      KALPT         GSLPT
     C                   MOVE      KAGEB         GSGEB
     C                   MOVE      KAPR          GSPR
     C                   MOVE      KAMVA         GSMVA
     C                   MOVE      KAVAL         GSVAL
      *
     C                   SELECT                                                   3<-B
     C     KALPT         WHENEQ    'A  '
     C     VAAN03        IFEQ      0
     C                   MOVE      *ZEROS        GSANT
     C                   MOVE      *ZEROS        GSBL
     C                   ELSE
     C     VAOANT        DIV       VAAN03        GSANT
     C                   MVR                     XREST             7 0
     C     XREST         IFGT      0
     C                   ADD       1             GSANT
     C                   END
     C     KAPR          MULT(H)   GSANT         GSBL
     C                   END
     C     KALPT         WHENEQ    'B  '
     C                   MOVE      *ZEROS        GSANT
     C                   MOVE      *ZEROS        GSBL
     C     KALPT         WHENEQ    'C  '
     C                   MOVE      *ZEROS        GSANT
     C                   MOVE      *ZEROS        GSBL
     C     KALPT         WHENEQ    'D  '
     C                   MOVE      *ZEROS        GSANT
     C                   MOVE      *ZEROS        GSBL
     C     KALPT         WHENEQ    'E  '
     C     KALPT         OREQ      'E2 '
     C                   IF        VAOANT = VASALD
     C     VASAE0        MULT(H)   VAKUB0        VAKUB             7 4
     C     VASAE1        MULT(H)   VAKUB1        XKUB              7 4
     C                   ADD       XKUB          VAKUB
     C     VASAE2        MULT(H)   VAKUB2        XKUB
     C                   ADD       XKUB          VAKUB
     C     VASAE3        MULT(H)   VAKUB3        XKUB
     C                   ADD       XKUB          VAKUB
     C                   ELSE
     C     VAOANT        MULT(H)   VAKUB0        VAKUB
     C                   END
     C                   Z-ADD(H)  VAKUB         GSANT
     C     KAPR          MULT(H)   VAKUB         GSBL
     C     KALPT         WHENEQ    'F  '
     C                   IF        VAOANT = VASALD
     C     VASAE0        MULT(H)   VAVKT0        VAVKT             7 2
     C     VASAE1        MULT(H)   VAVKT1        XVKT              7 2
     C                   ADD       XVKT          VAVKT
     C     VASAE2        MULT(H)   VAVKT2        XVKT
     C                   ADD       XVKT          VAVKT
     C     VASAE3        MULT(H)   VAVKT3        XVKT
     C                   ADD       XVKT          VAVKT
     C                   ELSE
     C     VAOANT        MULT(H)   VAVKT0        VAVKT
     C                   END
     C                   Z-ADD     VAVKT         GSANT
     C     KAPR          MULT(H)   VAVKT         GSBL
     C     KALPT         WHENEQ    'G  '
     C                   Z-ADD     VAOANT        GSANT
     C     KAPR          MULT(H)   VAOANT        GSBL
     C     KALPT         WHENEQ    'H  '
     C                   MOVE      *ZEROS        GSANT
     C                   MOVE      *ZEROS        GSBL
     C     KALPT         WHENGE    'I  '
     C     KALPT         ANDLE     'I50'
     C                   MOVE      *ZEROS        GSANT
     C                   MOVE      *ZEROS        GSBL
     C     KALPT         WHENEQ    'J  '
     C                   MOVE      *ZEROS        GSANT
     C                   MOVE      *ZEROS        GSBL
     C                   ENDSL                                                    3<-E
     C                   ADD       GSBL          XXBLT
     C                   ADD       1             GSLI
     C                   WRITE     LLGSFRW
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C     STINN         TAG
     C     LKA2K         READE     LLKAFL02                               33
     C  N33              ENDDO                                                   2<-E
      *
     C     LA10K         READE     LLAGJL10                               94
     C  N94              ENDDO                                                  1<-E
      *
     C                   ENDSR
      *
     C***********************************************
     C     HHENT         BEGSR
     C***********************************************
     C                   Z-ADD     0             LINNBR
     C                   SETOFF                                       919299
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C   98              DO
     C   99              SETOFF                                       98
     C                   Z-ADD     1             LINNBR
     C                   GOTO      SLHENT
     C                   END
      *
     C     ZRECNO        DIV       15            LINNBR
     C                   MVR                     XLIN              2 0
     C     XLIN          IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
      *
      *
     C     WSNR          IFEQ      '2'
     C     XDLT          IFEQ      '*DELETE'
     C                   MOVE      '1'           *IN98
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   GOTO      SLHENT
     C                   END
     C                   EXSR      CHGLIN
     C   12              GOTO      SLHENT
     C                   END
      *
     C     WSNR          IFEQ      '4'
     C     XDLT          IFEQ      '*DELETE'
     C                   MOVE      '1'           *IN98
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   GOTO      SLHENT
     C                   END
     C                   EXSR      DLTLIN
     C   12              GOTO      SLHENT
     C                   END
      *
     C                   END
      *
     C     SLHENT        TAG
     C                   ADD       3             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   SETOFF                                       99
     C   98              DO
     C                   MOVE      'DIV0012'     MSGNR
     C                   SETON                                            30
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     CHGLIN        BEGSR
     C***********************************************
     C                   MOVEL     KFTXT         XXTXT
     C                   MOVE      GSGEB         WSGEB
     C                   MOVE      GSANT         WSANT
     C                   MOVE      GSPR          WSPR
     C                   MOVE      GSBL          WSBL
     C                   MOVE      GSMVA         WSMVA
     C                   MOVE      GSVAL         WSVAL
     C                   MOVE      '1'           *IN40
     C                   MOVE      '1'           *IN99
     C                   MOVE      '0'           *IN30
     C     STCHG         TAG
     C                   EXFMT     VARELI
     C                   MOVEA     '000'         *IN(88)
     C                   MOVE      '0'           *IN30
      *
     C     *IN04         IFEQ      '1'
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     LINNBR        IFEQ      22
     C     POSNBR        IFGE      31
     C     POSNBR        ANDLE     33
     C                   CALL      'SYFI10D'
     C                   PARM                    WSGEB
     C                   END
     C     POSNBR        IFGE      68
     C     POSNBR        ANDLE     70
     C                   MOVE      'J'           USØK              1
     C                   CALL      'V200SY'
     C                   PARM                    USØK
     C                   PARM                    WSVAL
     C                   END
     C                   END
     C                   GOTO      STCHG
     C                   END
      *
     C     *IN12         IFEQ      '0'
      * TEST INNTASTET DATA
     C     KODGEK        CHAIN     KODTGE                             90
     C     *IN90         IFEQ      '1'
     C                   MOVE      'SPG0002'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      STCHG
     C                   END
     C     WSMVA         IFNE      'J'
     C     WSMVA         andne     'N'
     C                   MOVE      'SPM0004'     MSGNR
     C                   MOVE      '1'           *IN89
     C                   MOVE      '1'           *IN30
     C                   GOTO      STCHG
     C                   END
     C     WSVAL         IFEQ      *BLANKS
     C                   MOVE      FICURR        WSVAL
     C                   ELSE
     C     VALU1K        CHAIN     VALUL01                            88
     C     *IN88         IFEQ      '1'
     C                   MOVE      'SPV0001'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      STCHG
     C                   END
     C                   END
      * OPPDATER SUBFIL
     C     WSBL          IFEQ      0
     C     WSANT         MULT(H)   WSPR          WSBL
     C                   END
     C     LGW1K2        CHAIN     LLGSFW01                           33
     C                   MOVE      WSGEB         GSGEB
     C                   MOVE      WSANT         GSANT
     C                   MOVE      WSPR          GSPR
     C                   SUB       GSBL          XXBLT
     C                   ADD       WSBL          XXBLT
     C                   MOVE      WSBL          GSBL
     C                   MOVE      WSMVA         GSMVA
     C                   MOVE      WSVAL         GSVAL
     C                   UPDATE    LLGSFRW
     C                   END
      *
     C     XLIN          IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C                   MOVE      ' '           WSNR
     C                   MOVE      GSGEB         XTGEB
     C                   UPDATE    SUBFIL
N01   *
N01  C                   IF        *IN10
N01  C                   MOVE      GSLPT         WSLPT             3
N01  C                   MOVE      ZRECNO        WSRECNO           5 0
N01  C                   MOVE      *ZEROS        WSMN              7 0
N01  C     1             DO        YRECNO        ZRECNO
N01  C     ZRECNO        CHAIN     SUBFIL                             33
N01  C                   IF        *IN33 = *OFF
N01  C                   IF        WSMN = GSMN
N01  C                   MOVE      '0'           *IN35
N01  C                   IF        WSLPT = GSLPT AND WSGEB = GSGEB
N01  C                   MOVE      WSANT         GSANT
N01  C                   MOVE      WSBL          GSBL
N01  C                   END
N01  C                   ELSE
N01  C                   MOVE      '1'           *IN35
N01  C                   MOVE      *ZEROS        GSANT
N01  C                   MOVE      *ZEROS        GSBL
N01  C                   END
N01  C                   UPDATE    SUBFIL
N01  C                   EVAL      WSMN = GSMN
N01  C                   END
N01  C                   ENDDO
N01  C                   MOVE      WSRECNO       ZRECNO
N01  C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     DLTLIN        BEGSR
     C***********************************************
     C                   MOVEL     KFTXT         XXTXT
     C                   SETON                                        99
     C                   EXFMT     VAREL3
     C  N12              DO
     C     LGW1K2        CHAIN     LLGSFW01                           33
     C                   MOVE      *BLANKS       GSLPT
     C                   MOVE      *BLANKS       XTEKST
     C                   MOVE      '*DELETE'     XDLT
     C                   MOVE      *ZEROS        GSANT
     C                   MOVE      *ZEROS        GSPR
     C                   SUB       GSBL          XXBLT
     C                   MOVE      *ZEROS        GSBL
     C                   MOVE      *BLANKS       GSMVA
     C                   MOVE      *BLANKS       GSVAL
     C                   DELETE    LLGSFRW
     C                   END
      *
     C     XLIN          IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
      *
     C                   ENDSR
      *
     C***********************************************
     C     OPDFAK        BEGSR
     C***********************************************
      * SLETT GAMLE AUTOGENERELTE FAKTURALINJER
     C     FAK5K         SETLL     FAK5
     C     FAK5K         READE     FAK5                                   33
     C     *IN33         DOWEQ     '0'
     C     FACD13        IFEQ      'L'
     C     FAFAKT        ANDEQ     0
     C                   DELETE    FAKTR
     C                   ELSE
     C                   UPDATE    FAKTR
     C                   END
     C     FAK5K         READE     FAK5                                   33
     C  N33              ENDDO
      *
      * SLETTE TRANSASJONSLINJER FRA DRIFTSFIL
     C     LG01K         SETLL     LLGSFL01
     C     LG01K         READE     LLGSFL01                               33
     C     *IN33         DOWEQ     '0'
     C     GSMMUU        IFEQ      *BLANKS
      * UTTAK/INNLEGGING --> SLETT
     C                   DELETE    LLGSFR
     C                   ELSE
      * LAGERLEIER --> IKKE SLETT
     C                   UPDATE    LLGSFR
     C                   END
     C     LG01K         READE     LLGSFL01                               33
     C  N33              ENDDO
     C                   MOVE      *ZEROS        XXLI              5 0
      *
      * HENT SISTE BRUKT LINJENR
     C     FAKTKM        SETLL     FAKT
     C     FAKTKX        READPE    FAKT                                   33
     C     *IN33         IFEQ      '0'
     C                   Z-ADD     FALI          XLI               5 0
     C                   ELSE
     C                   MOVE      *ZEROS        XLI
     C                   END
      * OPPDATER FAKTURA
     C     YRECNO        IFGT      0                                            1<-B
     C     1             DO        YRECNO        ZRECNO                          2<-B
     C     ZRECNO        CHAIN     SUBFIL                             33
      *
     C     GSBL          IFGT      0                                              3<-B
      *
     C     FAK5K         SETLL     FAK5
     C     FAK5K         READE     FAK5                                   34
      *
     C     *IN34         DOWEQ     '0'                                             4<-B
     C     FACD13        IFEQ      'L'                                              5<-B
     C     FAVK          ANDEQ     GSGEB
     C     FAKDM         ANDEQ     GSMVA
     C     FAVAL         ANDEQ     GSVAL
     C                   LEAVE
     C                   END                                                        5<-E
     C                   UPDATE    FAKTR
     C     FAK5K         READE     FAK5                                   34
     C  N34              ENDDO                                                     4<-E
      *
     C     *IN34         IFEQ      '1'                                             4<-B
     C                   CLEAR                   FAKTR
     C                   MOVE      UAVD          FAAVD
     C                   MOVE      UOPD          FAOPD
     C     *IN36         IFEQ      '0'
     C                   MOVE      'S'           FASK
     C                   ELSE
     C                   MOVE      'K'           FASK
     C                   END
     C                   MOVE      'L'           FAKDA
     C                   MOVE      'L'           FACD13
     C                   ADD       1             XLI
     C                   MOVE      XLI           FALI
     C                   MOVE      YPNR          FAKUNR
     C                   MOVE      GSMVA         FAKDM
     C                   MOVE      GSGEB         FAVK
     C                   MOVE      GSVAL         FAVAL
     C                   EXSR      SRBEL
     C                   WRITE     FAKTR
     C                   ELSE                                                      4
     C                   EXSR      SRBEL
     C                   UPDATE    FAKTR
     C                   END                                                       4<-E
      * OPPDATER TRANSASJONSLINJE PÅ DRIFTSFIL
     C                   ADD       1             XXLI
     C                   MOVE      XXLI          GSLI
     C                   MOVE      FALI          GSFALI
     C                   WRITE     LLGSFR
      *
     C                   END                                                      3<-E
      *
     C                   ENDDO                                                   2<-E
      *
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
     C***********************************************
     C     SRBEL         BEGSR
     C***********************************************
     C                   EXSR      OPDANT
     C                   ADD       GSBL          FABELV
     C     FICURR        IFEQ      KAVAL
     C                   ADD       GSBL          FABELN
     C                   SELECT
     C     FIDECI        WHENEQ    0
     C                   ADD       .50           FABELV
     C                   MOVE      00            FABELV
     C                   ADD       .50           FABELN
     C                   MOVE      00            FABELN
     C     FIDECI        WHENEQ    1
     C                   ADD       .50           FABELV
     C                   MOVE      00            FABELV
     C                   ADD       .05           FABELN
     C                   MOVE      0             FABELN
     C                   ENDSL
     C                   ELSE
     C     VALU1X        CHAIN     VALUL01                            34
     C     GSBL          MULT(H)   VALKU1        XWORK            17 5
     C                   DIV(H)    OMRFAK        XWORK
     C                   ADD(H)    XWORK         FABELN
     C                   SELECT
     C     FIDECI        WHENEQ    0
     C                   ADD       .50           FABELN
     C                   MOVE      00            FABELN
     C     FIDECI        WHENEQ    1
     C                   ADD       .05           FABELN
     C                   MOVE      0             FABELN
     C                   ENDSL
     C                   END
      *
     C                   EXSR      VALUTA
      *
     C                   ENDSR
      *
      ***********************************************
     C     VALUTA        BEGSR
      ***********************************************
      * Converts from local currency to whatever currency that is
      * to be used on the invoice.
      * If the invoice is to be written in local currency or the line
      * already is in the right currency, nothing is done.
      *
     C*CURRENCY INVOICED (BLANK=FICURR)
     C     HEADFK        CHAIN     HEADF                              34
     C                   MOVE      *BLANKS       FACURI
     C     FASK          IFEQ      'S'
     C                   MOVE      HEVALS        WSVAL
     C                   ELSE
     C     FASK          IFEQ      'K'
     C                   MOVE      HEVALK        WSVAL
     C                   ELSE
     C                   END
     C                   END
      *
      * SKAL FAKTURERES I "FREMMEDVALUTA" MEN LINJA HAR ALT DEN SAMME
      * INGEN OMREGNING - FREMMEDVALUTAEN LAGRES PÅ LINJA -HOPP SÅ UT
      *
     C     FAVAL         IFEQ      WSVAL
     C                   MOVE      WSVAL         FACURI
     C                   GOTO      SLVAL
     C                   END
     C*
     C     VALU1K        CHAIN     VALUL01                            34
     C                   MOVE      *ZEROS        FAEXRA
      *
     C     FABELN        MULT      OMRFAK        XWORK            17 5
     C     XWORK         DIV(H)    VALKU1        FABELV
     C                   MOVE      WSVAL         FAVAL
     C*CURRENCY INVOICED (NÅR FORSKJELLIG FRA FICURR)
     C                   MOVE      WSVAL         FACURI
      *
     C     SLVAL         ENDSR
      *
     C***********************************************
     C     OPDANT        BEGSR
     C***********************************************
     C                   MOVE      FAVT          AN20
     C                   MOVE      *ZEROS        XN92
     C                   MOVE      'N'           XDES              1
     C     1             DO        20            XN                3 0
     C                   SELECT
     C     AN(XN)        WHENEQ    ','
     C                   MOVE      'J'           XDES
     C     AN(XN)        WHENNE    ' '
     C     XDES          IFEQ      'J'
     C                   MULT      10            XN02
     C                   MOVE      AN(XN)        XN02
     C                   ELSE
     C                   MULT      10            XN07
     C                   MOVE      AN(XN)        XN07
     C                   END
     C                   ENDSL
     C                   ENDDO
      *
     C                   ADD       GSANT         XN92
      *
     C                   MOVE      *BLANKS       AN20
     C     XN02          IFEQ      0
     C                   MOVEA     XA07          AN(14)
     C                   ELSE
     C                   MOVEA     XA07          AN(11)
     C                   MOVE      ','           AN(18)
     C                   MOVEA     XA02          AN(19)
     C                   END
     C     11            DO        20            XN
     C                   SELECT
     C     AN(XN)        WHENEQ    '0'
     C                   MOVE      ' '           AN(XN)
     C     AN(XN)        WHENEQ    ','
     C                   LEAVE
     C     AN(XN)        WHENNE    ' '
     C                   LEAVE
     C                   ENDSL
     C                   ENDDO
      *
     C                   MOVE      AN20          FAVT
      *
     C                   ENDSR
      *
     C***********************************************
     C     DSPLL         BEGSR
     C***********************************************
     C     *IN36         IFEQ      '0'
     C                   MOVE      YGRP          U1GRP
     C                   MOVE      YPNR          U1PNR
     C                   MOVE      *ZEROS        U1FLAG
     C                   CALL      'LL031R'
     C     U1PARM        PARM      U1PARM        U2PARM          256
     C                   ELSE
     C                   MOVE      YGRP          UGRP              8
     C                   MOVE      YPNR          UPNR              8
     C                   MOVE      'N'           UFLAG             1
     C                   CALL      'LL020R'
     C                   PARM                    UGRP
     C                   PARM                    UPNR
     C                   PARM                    UMRNR
     C                   PARM                    UFLAG
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     SRLEIE        BEGSR
     C***********************************************
     C     HEADFK        CHAIN     HEADF                              33
     C     HEKNSF        CHAIN     LLGRPK05                           33
     C     *IN33         CABEQ     '1'           SLLEIE
     C                   MOVE      GKGRP         YGRP
     C                   IF        GKGRP = 0
     C                   MOVEL     XTXT02        XXGNV
     C                   ELSE
     C     CUN1KG        CHAIN     CUNDL01                            33
     C                   IF        *IN33
     C                   MOVEL     XTXT02        XXGNV
     C                   ELSE
     C                   MOVEL     KNAVN         XXGNV
     C                   END
     C                   END
     C     CUN1KS        CHAIN     CUNDL01                            33
     C  N33              MOVEL     KNAVN         XXPNV
     C   33              MOVE      *BLANKS       XXPNV
     C   33              MOVEL     '*UKJENT'     XXPNV
     C                   SELECT
     C     WSUMTS        WHENEQ    ' '
     C                   MOVE      HEDTOÅ        WSÅR
     C                   MOVE      *ZEROS        WSUM
     C     WSUMTS        WHENEQ    'U'
     C     WSUMS         ANDEQ     52
     C     WSÅRS         ADD       1             WSÅR
     C                   Z-ADD     1             WSUM
     C     WSUMTS        WHENEQ    'M'
     C     WSUMS         ANDEQ     12
     C     WSÅRS         ADD       1             WSÅR
     C                   Z-ADD     1             WSUM
     C                   OTHER
     C                   MOVE      WSÅRS         WSÅR
     C     WSUMS         ADD       1             WSUM
     C                   ENDSL
     C                   MOVE      WSUMTS        WSUMTY
      *
     C     STLEIE        TAG
     C                   EXFMT     LLEIER
     C                   MOVEA     '00'          *IN(89)
     C                   MOVE      '0'           *IN30
      *
     C   03
     COR 12              GOTO      SLLEIE
      *
      * TEST TYPE AV PERIODE
     C     WSUMTY        IFEQ      ' '
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN89
     C                   MOVE      'YBC0793'     MSGNR
     C                   GOTO      STLEIE
     C                   END
      * TEST PERIODE
     C     WSUMTY        IFEQ      'M'
     C     WSUM          IFLT      1
     C     WSUM          ORGT      12
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN90
     C                   MOVE      'YBC0794'     MSGNR
     C                   GOTO      STLEIE
     C                   END
     C                   ELSE
     C     WSUM          IFLT      1
     C     WSUM          ORGT      53
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN90
     C                   MOVE      'YBC0794'     MSGNR
     C                   GOTO      STLEIE
     C                   END
     C                   END
      *
      *
     C     WSUMTY        IFEQ      'M'
     C                   Z-ADD     1             XDTFD
     C                   MOVE      WSUM          XDTFM
     C     WSÅR          ADD       2000          XDTFÅ
     C                   MOVE      XDTF          XDTT
     C                   SELECT
     C     WSUM          WHENEQ    2
     C     WSUM          DIV       4             XSKUD             1 0
     C                   MVR                     XSKUD
     C     XSKUD         IFEQ      0
     C                   MOVE      29            XDTTD
     C                   ELSE
     C                   MOVE      28            XDTTD
     C                   END
     C     WSUM          WHENEQ    4
     C     WSUM          OREQ      6
     C     WSUM          OREQ      9
     C     WSUM          OREQ      11
     C                   MOVE      30            XDTTD
     C                   OTHER
     C                   MOVE      31            XDTTD
     C                   ENDSL
     C                   ELSE
      * BEREGN FRA OG MED / TIL OG MED DATO
     C                   EXSR      BFTDT
     C                   END
      *
     C                   MOVE      XDTF          UDTF              8
     C                   MOVE      XDTT          UDTT              8
     C     WSÅR          ADD       2000          UÅÅMM4            4 0
     C                   MOVEL     UÅÅMM4        UÅÅMM             6
     C                   MOVE      WSUM          UÅÅMM
     C                   CALL      'LL053C'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UDTF
     C                   PARM                    UDTT
     C                   PARM                    UÅÅMM
      *
     C     SLLEIE        ENDSR
      *
     C***********************************************
     C     BFTDT         BEGSR
     C***********************************************
      * KOPIERT FRA VR014 I BING
     C                   Z-ADD     WSÅR          WÅR               3 0
      *
     C     WÅR           IFGT      72
     C                   SUB       73            WÅR
     C                   ELSE
     C                   ADD       100           WÅR
     C                   SUB       73            WÅR
     C                   END                                                    <WÅR
      *
     C     WÅR           MULT      365.25        WDGANT            5 0
     C     WDGANT        DIV       7             WUKANT            5 0
     C     WUKANT        MULT      7             WRES              5 0
     C     WDGANT        SUB       WRES          WJUST             1 0
      *
     C     WSÅR          IFGT      *ZERO
     C     WSÅR          IFLT      73
     C                   SUB       1             WJUST
     C                   END                                                    <WAAR
     C                   END                                                    <WAAR
      *
     C     WSUM          MULT      7             ÅDGNR             3 0
     C                   ADD       1             ÅDGNR
     C                   SUB       WJUST         ÅDGNR
     C     WJUST         IFLT      4
     C                   SUB       7             ÅDGNR
     C                   END
      *
     C     ÅDGNR         IFGT      *ZERO
     C                   GOTO      SUKE
     C                   END
     C     WSÅR          IFEQ      *ZERO
     C                   Z-ADD     99            WSÅR
     C                   ELSE
     C                   SUB       1             WSÅR
     C                   END
      *
     C     WSÅR          DIV       4             WRES
     C                   MVR                     WSKUDD            1 0
     C     WSKUDD        IFEQ      *ZERO
     C     WSÅR          IFNE      *ZERO
     C                   ADD       366           ÅDGNR
     C                   GOTO      UKEND
     C                   END
     C                   END
     C                   ADD       365           ÅDGNR
     C                   GOTO      UKEND
      *
     C     SUKE          TAG
     C     ÅDGNR         IFLT      366
     C                   GOTO      UKEND
     C                   END
      *
     C     WSÅR          DIV       4             WRES
     C                   MVR                     WSKUDD
     C     WSKUDD        IFEQ      *ZERO
     C     ÅDGNR         IFEQ      366
     C     WSÅR          IFNE      *ZERO
     C                   GOTO      UKEND
     C                   END
     C                   END
     C                   END
      *
     C     WSKUDD        IFEQ      *ZERO
     C     WSÅR          IFNE      *ZERO
     C                   SUB       366           ÅDGNR
     C                   GOTO      TSTÅR
     C                   END
     C                   END
      *
     C                   SUB       365           ÅDGNR
     C     TSTÅR         TAG
     C     WSÅR          IFNE      99
     C                   ADD       1             WSÅR
     C                   ELSE
     C                   MOVE      *ZERO         WSÅR
     C                   END
      *
     C     UKEND         TAG
     C     WSÅR          ADD       2000          XDTFÅ
     C                   MOVE      XDTFÅ         XDTTÅ
     C                   Z-ADD     1             XDTFM
     C                   MOVE      ÅDGNR         XDTFD
     C                   DO        11
     C                   SELECT
     C     XDTFM         WHENEQ    2
     C     WSÅR          DIV       4             WRES
     C                   MVR                     WSKUDD
     C     WSKUDD        IFEQ      0
     C     ÅDGNR         IFLE      29
     C     ÅDGNR         IFLE      23
     C     ÅDGNR         ADD       6             XDTTD
     C                   Z-ADD     2             XDTTM
     C                   ELSE
     C     ÅDGNR         SUB       23            XDTTD
     C                   Z-ADD     3             XDTTM
     C                   END
     C                   GOTO      SLBFTD
     C                   END
     C                   SUB       29            ÅDGNR
     C                   ELSE
     C     ÅDGNR         IFLE      28
     C     ÅDGNR         IFLE      22
     C     ÅDGNR         ADD       6             XDTTD
     C                   Z-ADD     2             XDTTM
     C                   ELSE
     C     ÅDGNR         SUB       22            XDTTD
     C                   Z-ADD     3             XDTTM
     C                   END
     C                   GOTO      SLBFTD
     C                   END
     C                   SUB       28            ÅDGNR
     C                   END
     C     XDTFM         WHENEQ    4
     C     XDTFM         OREQ      6
     C     XDTFM         OREQ      9
     C     XDTFM         OREQ      11
     C     ÅDGNR         IFLE      30
     C     ÅDGNR         IFLE      24
     C     ÅDGNR         ADD       6             XDTTD
     C                   MOVE      XDTFM         XDTTM
     C                   ELSE
     C     ÅDGNR         SUB       24            XDTTD
     C     XDTFM         ADD       1             XDTTM
     C                   END
     C                   GOTO      SLBFTD
     C                   END
     C                   SUB       30            ÅDGNR
     C                   OTHER
     C     ÅDGNR         IFLE      31
     C     ÅDGNR         IFLE      25
     C     ÅDGNR         ADD       6             XDTTD
     C                   MOVE      XDTFM         XDTTM
     C                   ELSE
     C     ÅDGNR         SUB       25            XDTTD
     C     XDTFM         IFEQ      12
     C                   Z-ADD     1             XDTTM
     C                   ADD       1             XDTTÅ
     C                   ELSE
     C     XDTFM         ADD       1             XDTTM
     C                   END
     C                   END
     C                   GOTO      SLBFTD
     C                   END
     C                   SUB       31            ÅDGNR
     C                   ENDSL
     C                   ADD       1             XDTFM
     C                   MOVE      ÅDGNR         XDTFD
     C                   ENDDO
      *
     C     SLBFTD        ENDSR
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     LG01K         KLIST
     C                   KFLD                    YAVD
     C                   KFLD                    YOPD
     C     LGW1K         KLIST
     C                   KFLD                    YAVD
     C                   KFLD                    YOPD
     C     LGW1K2        KLIST
     C                   KFLD                    YAVD
     C                   KFLD                    YOPD
     C                   KFLD                    GSLI
     C     LH07K         KLIST
     C                   KFLD                    YAVD
     C                   KFLD                    YOPD
     C     LA01K         KLIST
     C                   KFLD                    YGRP
     C                   KFLD                    YPNR
     C                   KFLD                    GSMN
     C     LA10K         KLIST
     C                   KFLD                    YAVD
     C                   KFLD                    YOPD
     C     CUN1KG        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    YGRP
     C     CUN1KP        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    YPNR
     C     CUN1KS        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    HEKNSF
     C     LKA2K         KLIST
     C                   KFLD                    YGRP
     C                   KFLD                    YPNR
     C     LKA3K         KLIST
     C                   KFLD                    YGRP
     C                   KFLD                    YPNR
     C     LLXFAKK       KLIST
     C                   KFLD                    LHMN
     C                   KFLD                    KALPT
     C     KOFASK        KLIST
     C                   KFLD                    KFTYP
     C                   KFLD                    KFKOD
     C     HEADFK        KLIST
     C                   KFLD                    YAVD
     C                   KFLD                    YOPD
     C     HEAFK2        KLIST
     C                   KFLD                    GSAVD
     C                   KFLD                    GSOPD
     C     FAK5K         KLIST
     C                   KFLD                    YOPKO
     C                   KFLD                    YSK
     C                   KFLD                    YAVD
     C                   KFLD                    YOPD
     C                   MOVE      *BLANKS       YOPKO             1
     C     FAKTKM        KLIST
     C                   KFLD                    YAVD
     C                   KFLD                    YOPD
     C                   KFLD                    YLI
     C                   MOVE      99999         YLI               5 0
     C     FAKTKX        KLIST
     C                   KFLD                    YAVD
     C                   KFLD                    YOPD
     C     KODGEK        KLIST
     C                   KFLD                    KGEUNI
     C                   KFLD                    WSGEB
     C                   MOVE      'GE'          KGEUNI
     C     VALU1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSVAL
     C     VALU1X        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    GSVAL
      *
     C     *ENTRY        PLIST
     C                   PARM                    UAVD              4
     C                   PARM                    UOPD              7
     C                   PARM                    UFLAGG            1 0
      *
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
      *
     C     UFLAGG        IFEQ      9
     C                   MOVE      'J'           XAUTO             1
     C                   END
     C     UFLAGG        COMP      1                                      27
     C                   MOVE      UAVD          YAVD              4 0
     C                   MOVE      UOPD          YOPD              7 0
     C                   MOVE      *ZEROS        UFLAGG
     C                   MOVE      *BLANKS       U1PARM
     C                   MOVE      *ZEROS        U1TDT
     C                   MOVE      *ZEROS        U1ALN
     C                   MOVE      UAVD          U1AVD
     C                   MOVE      UOPD          U1OPD
     C                   MOVE      FIFIRM        U1FIRM
      *
      * FINNE SISTE PERIODE TIL FAKTURA AV LAGERLEIER
     C     LH07K         SETLL     LLHEAD07
     C     LH07K         READE     LLHEAD07                               33
     C     *IN33         IFEQ      '0'                                          1<-B
      * OPPDRAG ER FOR UTTAK
     C                   ELSE                                                   1
     C     LA10K         SETLL     LLAGJL10
     C     LA10K         READE     LLAGJL10                               33
     C     *IN33         IFEQ      '0'                                           2<-B
      * OPPDRAG ER FOR INNLEGGING
     C                   ELSE                                                    2
      * OPPDRAG ER LAGERLEIER
     C     HEADFK        CHAIN     HEADF                              33
     C                   MOVE      HEKNSF        XXKNSF            8 0
     C                   MOVE      999999        GSÅÅMU
     C     GSÅÅMU        SETLL     LLGSFL04
     C                   READP     LLGSFL04                               33
     C     *IN33         DOWEQ     '0'                                            3<-B
     C     HEAFK2        CHAIN     HEADF                              34
     C     HEKNSF        IFEQ      XXKNSF                                          4<-B
     C                   MOVE      GSÅÅMU        WSUMS
     C                   MOVEL     GSÅÅMU        XXÅRS             4 0
     C                   MOVE      XXÅRS         WSÅRS
     C                   MOVE      GSMMUU        WSUMTS
     C                   LEAVE
     C                   END                                                       4<-E
     C                   READP     LLGSFL04                               33
     C  N33              ENDDO                                                    3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
