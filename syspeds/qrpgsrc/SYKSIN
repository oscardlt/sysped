***** **************************************************************
      * Program for å generere internbelastning mot alle oppdrag som xxxxx
***** **************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr *Sek Sig Vers Beskrivelse...........................
""""" *"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 Sjekk om Intern fakturalinje/Geb alt finnes (unngå dobbel)
      * 02 JOV PTF10 Ta hensyn til B=bruttovekt prisbereging..
      * 03 JOV PTF10 Avrunding til hele kroner
      * 04 jov PTF10 Kunne si Incl/Omit på avd, OT, FR, LS(før kun incl..) / Nå 4 LS
      *              Flere F4 søk - tester på OT/FR bedre(før ble de tatt med hvis blank)
      * 05 JOV PTF10 Kan lagre/søke i rapport-maler
      * 06 SH  PTF11 Tatt bruk PRJOIN
***** **************************************************************
N05  FSYKSINM   UF A E           K DISK
     FHEADDT    IF   E           K DISK
     FHEADF     IF   E           K DISK
     F                                     RENAME(HEADFR:HEADFF)
     FSADHD     IF   E           K DISK
     FSADV4     IF   E           K DISK
     FKODTKSB   IF   E           K DISK
     FKODTge    IF   E           K DISK
s06  F*RJOIN    IF   E           K DISK
     FPRIK      IF   E           K DISK
     FFIRM      IF   E           K DISK
N01  FFAK2      IF   E           K DISK
     FWINTF     O    E             DISK
     FSYKSINFM  CF   E             WORKSTN
     F                                     INFDS(FBAREA)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
      *___________________________
      * Finner username
      *"""""""""""""""""""""""""""
     D                SDS
     D  ZJOB                 244    253
     D  ZUSER                254    263
     D  ZJOBNR               264    269  0
     D                 DS
     D  UR                     1     10
     D                                     DIM(10)                              I/O. ursp.kode
     D  PKUR01                 1      1
     D  PKUR02                 2      2
     D  PKUR03                 3      3
     D  PKUR04                 4      4
     D  PKUR05                 5      5
     D  PKUR06                 6      6
     D  PKUR07                 7      7
     D  PKUR08                 8      8
     D  PKUR09                 9      9
     D  PKUR10                10     10
     D                 DS
     D  FR                     1     30
     D                                     DIM(10)                              I/O. frankatur
     D  PKFR01                 1      3
     D  PKFR02                 4      6
     D  PKFR03                 7      9
     D  PKFR04                10     12
     D  PKFR05                13     15
     D  PKFR06                16     18
     D  PKFR07                19     21
     D  PKFR08                22     24
     D  PKFR09                25     27
     D  PKFR10                28     30
     D                 DS
     D  GNA                    1     30
     D                                     DIM(10)
     D  GNAT                   1     30
     D  AFGE01                 1      3
     D  AFGE02                 4      6
     D  AFGE03                 7      9
     D  AFGE04                10     12
     D  AFGE05                13     15
     D  AFGE06                16     18
     D  AFGE07                19     21
     D  AFGE08                22     24
     D  AFGE09                25     27
     D  AFGE10                28     30
     D                 DS
     D  OT                     1     20
     D                                     DIM(10)                              I/O. oppd.type
     D  PKOT01                 1      2
     D  PKOT02                 3      4
     D  PKOT03                 5      6
     D  PKOT04                 7      8
     D  PKOT05                 9     10
     D  PKOT06                11     12
     D  PKOT07                13     14
     D  PKOT08                15     16
     D  PKOT09                17     18
     D  PKOT10                19     20
     D                 DS
     D  LK                     1     20
     D                                     DIM(10)                              I/O. landkode
     D  PKLK01                 1      2
     D  PKLK02                 3      4
     D  PKLK03                 5      6
     D  PKLK04                 7      8
     D  PKLK05                 9     10
     D  PKLK06                11     12
     D  PKLK07                13     14
     D  PKLK08                15     16
     D  PKLK09                17     18
     D  PKLK10                19     20
     D                 DS
     D  FS                     1     50
     D                                     DIM(10)                              I/O. frasted
     D  PKFS01                 1      5
     D  PKFS02                 6     10
     D  PKFS03                11     15
     D  PKFS04                16     20
     D  PKFS05                21     25
     D  PKFS06                26     30
     D  PKFS07                31     35
     D  PKFS08                36     40
     D  PKFS09                41     45
     D  PKFS10                46     50
     D                 DS
     D  TS                     1     50
     D                                     DIM(10)                              I/O. tilsted
     D  PKTS01                 1      5
     D  PKTS02                 6     10
     D  PKTS03                11     15
     D  PKTS04                16     20
     D  PKTS05                21     25
     D  PKTS06                26     30
     D  PKTS07                31     35
     D  PKTS08                36     40
     D  PKTS09                41     45
     D  PKTS10                46     50
     D                 DS
s06  D* LS                     1     60
s06  D*                                    DIM(3)                               I/O. last/loss
n06  D  LS                     1    100
n06  D                                     DIM(5)                               I/O. last/loss
     D  PKLS01                 1     20
     D  PKLS02                21     40
     D  PKLS03                41     60
n06  D  PKLS04                61     80
n06  D  PKLS05                81    100
      * lastested
     D                 DS
n06  D  L2                     1    100
n06  D                                     DIM(5)                               I/O. last/loss
n06  D  PKL201                 1     20
n06  D  PKL202                21     40
n06  D  PKL203                41     60
n06  D  PKL204                61     80
n06  D  PKL205                81    100
     D                 DS
     D  WSBDT                  1      6  0
     D  WSBDTD                 1      2  0
     D  WSBDTM                 3      4  0
     D  WSBDTÅ                 5      6  0
     D                 DS
     D  WSTXT                  1     35
     D  WSTXT1                 1      3
     D  WSTXT2                 4     35
N02  D                 DS
N02  D  WSDTD                  1      2  0
N02  D  WSDTM                  3      4  0
N02  D  WSDTÅ                  5      6  0
N02  D  WSDT                   1      6  0
     D                 DS
EV5  D  KABDT                  1      8  0
EV5  D  KABDTÅ                 1      4  0
EV5  D  KABDTM                 5      6  0
EV5  D  KABDTD                 7      8  0
N02  D                 DS
N02  D  WUDTFÅ                 1      4  0
N02  D  WUDTFM                 5      6  0
N02  D  WUDTFD                 7      8  0
N02  D  WUDTF                  1      8  0
N02  D                 DS
N02  D  WUDTTÅ                 1      4  0
N02  D  WUDTTM                 5      6  0
N02  D  WUDTTD                 7      8  0
N02  D  WUDTT                  1      8  0
     D                 DS
NV5  D  HEDTÅ                  1      4  0
NV5  D  HEDTM                  5      6  0
NV5  D  HEDTD                  7      8  0
NV5  D  HEDTOP                 1      8  0
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D  XDATO                  7     14  0
N05  D                 DS
N05  D  ULÅÅ                   1      4  0
N05  D  ULMM                   5      6  0
N05  D  ULDD                   7      8  0
N05  D  ULDT                   1      8  0
     D UP              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZÆØÅ')
     D LO              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzæøå')
xxxxxD TSTSDL          s             20    VARYING
     D                UDS
     D* UDgavd                91     94
     D* UDgopd                95     99
     D  UDgavd                90     93
     D  UDgopd                94    100
     D  UDvk01               101    103
     D  UDdtf                104    109
     D  UDdtt                110    115
     D  UDavdf               116    119
     D  UDavdt               120    123
     D  UDAV01               141    144
     D  UDAV02               145    148
     D  UDAV03               149    152
     D  UDAV04               153    156
     D  UDAV05               157    160
     D  UDAV06               161    164
     D  UDAV07               165    168
     D  UDAV08               169    172
     D  UDAV09               173    176
     D  UDAV10               177    180
     D  UDAV11               181    184
     D  UDAV12               185    188
     D  UDAV13               189    192
     D  UDAV14               193    196
     D  UDAV15               197    200
     D  UDAV16               201    204
     D  UDAV17               205    208
     D  UDAV18               209    212
     D  UDAV19               213    216
     D  UDAV20               217    220
     D  UDFR01               221    223
     D  UDFR02               224    226
     D  UDFR03               227    229
     D  UDFR04               230    232
     D  UDFR05               233    235
     D  UDFR06               236    238
     D  UDFR07               239    241
     D  UDFR08               242    244
     D  UDFR09               245    247
     D  UDFR10               248    250
     D  UDOT01               251    252
     D  UDOT02               253    254
     D  UDOT03               255    256
     D  UDOT04               257    258
     D  UDOT05               259    260
     D  UDOT06               261    262
     D  UDOT07               263    264
     D  UDOT08               265    266
     D  UDOT09               267    268
     D  UDOT10               269    270
     D  UDIE                 271    271
S04  D* UDSDL                272    271
N04  D  UDAVIO               272    272
N04  D  UDFRIO               273    273
N04  D  UDOTIO               274    274
N04  D  UDSDLIO              275    275
N04  D  UDSDL01              281    300
N04  D  UDSDL02              301    320
N04  D  UDSDL03              321    340
N04  D  UDSDL04              341    360
S04  D* UUSER                401    410
      *
     C                   EXSR      INIT
     C*
     C     START         TAG
N05  C                   MOVE      WSRNAV        GMRNAV           10
     C                   MOVE      *OFF          WIN03             1
     C                   EXFMT     BILDE01
     C     *IN03         IFEQ      *ON
     C                   MOVE      *ON           WIN03
     C                   GOTO      SLUTT
     C                   ENDIF
     C     *IN04         IFEQ      *ON
     C                   EXSR      SØKDTA
     C                   GOTO      START
     C                   ENDIF
      *
N05
N05   * RAPPORT-MAL
N05  C     *IN13         IFEQ      '0'
N05  C     *IN14         ANDEQ     '0'
N05   * ENDRET MAL-NAVN (UTEN F13/F14 LAGRE-OVERSKRIVE) = HENT VERDIER
N05  C     WSRNAV        IFNE      *BLANKS
N05  C     WSRNAV        ANDNE     GMRNAV
N05  C                   EXSR      GETMAL
N05  C                   GOTO      START
N05  C                   END
N05  C                   ELSE
N05  C* F-TAST FOR Å LAGRE NY/OVERSKRIVE MAL ER TASTET.
N05  C                   EXSR      SKRMAL
N05  C                   GOTO      START
N05  C                   END
N05   *
     c                   move      'N'           endret            1
     C* Hent tekst via kortkode
     C     WSTXT1        IFNE      *BLANKS
     C     WSTXT2        ANDEQ     *BLANKS
     C     WSTXT1        CHAIN     KODTKSB                            33
     C     *IN33         IFEQ      '0'
     C                   MOVE      KOKSTX        WSTXT
     c                   move      'J'           endret
     C                   END
     C                   END
     C* Tildato blank = UT måneden
     C     WSDTF         IFne      *zeros
     C     wsdtt         andeq     *zeros
     C                   MOVE      wsdtf         WSdtt
     C                   MOVEL     '31'          WSdtt
     c                   move      'J'           endret
     C                   END
     C* Til-avd er blank = sett lik fra
     C     WSAVDF        IFne      *zeros
     C     WSAVDt        andeq     *zeros
     C                   MOVE      WSAVDF        WSAVDt
     c                   move      'J'           endret
     C                   END
N04
N04  C* IO avd ikke satt
N04  C     WSAV01        IFne      *zeros
N04  C     WSAVIO        andne     'I'
N04  C     WSAVIO        andne     'O'
N04  C                   MOVE      'I'           WSAVIO
N04  c                   move      'J'           endret
N04  C                   END
N04  C     WSFR01        IFne      *blanks
N04  C     WSFRIO        andne     'I'
N04  C     WSFRIO        andne     'O'
N04  C                   MOVE      'I'           WSFRIO
N04  c                   move      'J'           endret
N04  C                   END
N04  C     WSOT01        IFne      *blanks
N04  C     WSOTIO        andne     'I'
N04  C     WSOTIO        andne     'O'
N04  C                   MOVE      'I'           WSOTIO
N04  c                   move      'J'           endret
N04  C                   END
N04  C     WSSDL01       IFne      *blanks
N04  C     WSSDLIO       andne     'I'
N04  C     WSSDLIO       andne     'O'
N04  C                   MOVE      'I'           WSSDLIO
N04  c                   move      'J'           endret
N04  C                   END
      * HVis noe endret autom - vis bilde på ny
     C     Endret        cabeq     'J'           Start
      *  Div tester
     c                   exsr      TESTB
     c   30              goto      START
      *
      *  OK  - velg poster
      * Hvis basert på mal - oppdatert sist kjørt.
N05  C     WSRNAV        IFNE      *BLANKS
N05  C                   EXSR      OPDMAL
N05  C                   END
     C                   Z-ADD     WSDTF         WSDT
     C                   Z-ADD     WSDTD         WUDTFD
     C                   Z-ADD     WSDTM         WUDTFM
     C                   Z-ADD     2000          WUDTFÅ
     C                   ADD       WSDTÅ         WUDTFÅ
     C                   Z-ADD     WSDTT         WSDT
     C                   Z-ADD     WSDTD         WUDTTD
     C                   Z-ADD     WSDTM         WUDTTM
     C                   Z-ADD     2000          WUDTTÅ
     C                   ADD       WSDTÅ         WUDTTÅ
     C                   EXSR      LESHEA
      * save parametre i UDS
     C                   EXSR      SAVPARM
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
      ***********************************************
     C     TESTB         BEGSR
      ***********************************************
     C                   move      '0'           *IN(30)
     C                   movea     '000000000'   *IN(71)
      * godskrivingsoppdrag..
     c                   move      wsgavd        HEAVD
     c                   move      wsgopd        HEOPD
     c     HeaKey        chain     Headf                              71
     C  N71HEST          COMP      'S'                                    71
     C  N71heopd         COMP      0                                      71
     c     *IN71         ifne      *off
     C                   MOVE      'JOV1468'     MSGNR
     C                   move      *ON           *IN30
     c                   z-add     4             LinNbr
     c                   z-add     30            PosNbr
     C                   goto      UtTest
     c                   end
      * Gebyrkode..
     c     KODTGEK       chain     KODTGE                             72
     c     *IN72         ifne      *off
     C                   MOVE      'JOV1469'     MSGNR
     C                   move      *ON           *IN30
     c                   z-add     6             LinNbr
     c                   z-add     30            PosNbr
     C                   goto      UtTest
     c                   end
      * Dato fra / til
     c     WSDTF         ifeq      *zeros
     c     WSDTF         oreq      *zeros
     C                   MOVE      'JOV1470'     MSGNR
     C                   move      *ON           *IN73
     C                   move      *ON           *IN30
     c                   z-add     7             LinNbr
     c                   z-add     30            PosNbr
     C                   goto      UtTest
     c                   end
     c     UtTest        endsr
      ***********************************************
     C     SØKDTA        BEGSR
      ***********************************************
     C     WSCLOC        DIV       256           LINNBR            3 0
     C                   MVR                     POSNBR            3 0
     C                   Z-ADD     WSSUBN        XRECNO            4 0
      *
N05
N05   * Lagret rapport-mal
N05  C     LINNBR        IFEQ      2
N05  C                   CALL      'SYKSINMR'
N05  C                   PARM                    WSRNAV
N05  C                   PARM                    WSBESK
N05  C                   Z-ADD     04            LINNBR
N05  C                   Z-ADD     30            POSNBR
N05  C     WSRNAV        IFNE      *BLANKS
N05  C                   EXSR      GETMAL
N05  c     WSGAVD        ifne      *zeros
N05  C                   Z-ADD     37            POSNBR
N05  c                   endif
N05  C                   END
N05  C                   GOTO      SLSØK
N05  C                   END
     C     LINNBR        IFle      5
     C                   CALL      'SYFM21'
     C                   PARM      'S'           UTYPE2            1
     C                   PARM                    NN40              4 0
     C                   PARM                    NN50              5 0
     C                   PARM                    NN3               3
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     30            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C*
     C     LINNBR        IFEQ      6
     C                   CALL      'SYFI10D'
     C                   PARM                    WSVK01
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     30            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
N04   * AVdelinger - fra/til
N04  C     LINNBR        IFEQ      09
N04  C     POSNBR        andge     30
N04  C     POSNBR        andle     33
N04  C                   CALL      'SYFA14B'
N04  C                   PARM                    WSAVDF
N04  C                   Z-ADD     9             LINNBR
N04  C                   Z-ADD     37            POSNBR
N04  C                   GOTO      SLSØK
N04  c                   ENDIF
N04  C     LINNBR        IFEQ      09
N04  C     POSNBR        andge     37
N04  C     POSNBR        andle     40
N04  C                   CALL      'SYFA14B'
N04  C                   PARM                    WSAVDT
N04  C                   Z-ADD     13            LINNBR
N04  C                   Z-ADD     30            POSNBR
N04  C                   GOTO      SLSØK
N04  c                   ENDIF
N04   *
N04   * AVdelinger - liste
N04  C     LINNBR        IFEQ      10
N04  C                   CALL      'SYFA14B'
N04  C                   PARM      0000          XXAVD             4 0
N04  C                   if        PosNbr>=30 and PosNbr<=33
N04  c                   eval      WSAV01=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=35 and PosNbr<=38
N04  c                   eval      WSAV02=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=40 and PosNbr<=43
N04  c                   eval      WSAV03=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=45 and PosNbr<=48
N04  c                   eval      WSAV04=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=50 and PosNbr<=53
N04  c                   eval      WSAV05=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=55 and PosNbr<=58
N04  c                   eval      WSAV06=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=60 and PosNbr<=63
N04  c                   eval      WSAV07=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=65 and PosNbr<=68
N04  c                   eval      WSAV08=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=70 and PosNbr<=73
N04  c                   eval      WSAV09=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=75 and PosNbr<=78
N04  c                   eval      WSAV10=XXAVD
N04  c                   endif
N04  C                   GOTO      SLSØK
N04  C                   ENDIF
N04  C     LINNBR        IFEQ      11
N04  C                   CALL      'SYFA14B'
N04  C                   PARM      0000          XXAVD
N04  C                   if        PosNbr>=30 and PosNbr<=33
N04  c                   eval      WSAV11=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=35 and PosNbr<=38
N04  c                   eval      WSAV12=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=40 and PosNbr<=43
N04  c                   eval      WSAV13=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=45 and PosNbr<=48
N04  c                   eval      WSAV14=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=50 and PosNbr<=53
N04  c                   eval      WSAV15=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=55 and PosNbr<=58
N04  c                   eval      WSAV16=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=60 and PosNbr<=63
N04  c                   eval      WSAV17=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=65 and PosNbr<=68
N04  c                   eval      WSAV18=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=70 and PosNbr<=73
N04  c                   eval      WSAV19=XXAVD
N04  c                   endif
N04  C                   if        PosNbr>=75 and PosNbr<=78
N04  c                   eval      WSAV20=XXAVD
N04  c                   endif
N04  C                   GOTO      SLSØK
N04  C                   ENDIF
N04
N04  C*
N04  C* FRANKATUR
N04  C*
N04  C*
N04  C                   MOVE      'J'           USPED             1
N04  C     LINNBR        IFEQ      13
N04  C     POSNBR        IFGE      30
N04  C     POSNBR        ANDLE     32
N04  C                   CALL      'SYFI10G'
N04  C                   PARM                    WSFR01
N04  C                   PARM                    USPED
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      34
N04  C     POSNBR        ANDLE     36
N04  C                   CALL      'SYFI10G'
N04  C                   PARM                    WSFR02
N04  C                   PARM                    USPED
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      38
N04  C     POSNBR        ANDLE     40
N04  C                   CALL      'SYFI10G'
N04  C                   PARM                    WSFR03
N04  C                   PARM                    USPED
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      42
N04  C     POSNBR        ANDLE     44
N04  C                   CALL      'SYFI10G'
N04  C                   PARM                    WSFR04
N04  C                   PARM                    USPED
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      46
N04  C     POSNBR        ANDLE     48
N04  C                   CALL      'SYFI10G'
N04  C                   PARM                    WSFR05
N04  C                   PARM                    USPED
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      50
N04  C     POSNBR        ANDLE     52
N04  C                   CALL      'SYFI10G'
N04  C                   PARM                    WSFR06
N04  C                   PARM                    USPED
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      54
N04  C     POSNBR        ANDLE     56
N04  C                   CALL      'SYFI10G'
N04  C                   PARM                    WSFR07
N04  C                   PARM                    USPED
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      58
N04  C     POSNBR        ANDLE     60
N04  C                   CALL      'SYFI10G'
N04  C                   PARM                    WSFR08
N04  C                   PARM                    USPED
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      62
N04  C     POSNBR        ANDLE     46
N04  C                   CALL      'SYFI10G'
N04  C                   PARM                    WSFR09
N04  C                   PARM                    USPED
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      66
N04  C     POSNBR        ANDLE     68
N04  C                   CALL      'SYFI10G'
N04  C                   PARM                    WSFR10
N04  C                   PARM                    USPED
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C                   END
N04  C* OPPDR TYPE
N04  C     LINNBR        IFEQ      15
N04  C     POSNBR        IFGE      30
N04  C     POSNBR        ANDLE     31
N04  C                   CALL      'SYFI10C'
N04  C                   PARM                    WSOT01
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      34
N04  C     POSNBR        ANDLE     35
N04  C                   CALL      'SYFI10C'
N04  C                   PARM                    WSOT02
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      38
N04  C     POSNBR        ANDLE     39
N04  C                   CALL      'SYFI10C'
N04  C                   PARM                    WSOT03
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      42
N04  C     POSNBR        ANDLE     43
N04  C                   CALL      'SYFI10C'
N04  C                   PARM                    WSOT04
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      46
N04  C     POSNBR        ANDLE     47
N04  C                   CALL      'SYFI10C'
N04  C                   PARM                    WSOT05
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      50
N04  C     POSNBR        ANDLE     51
N04  C                   CALL      'SYFI10C'
N04  C                   PARM                    WSOT06
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      54
N04  C     POSNBR        ANDLE     55
N04  C                   CALL      'SYFI10C'
N04  C                   PARM                    WSOT07
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      58
N04  C     POSNBR        ANDLE     59
N04  C                   CALL      'SYFI10C'
N04  C                   PARM                    WSOT08
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      62
N04  C     POSNBR        ANDLE     63
N04  C                   CALL      'SYFI10C'
N04  C                   PARM                    WSOT09
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     POSNBR        IFGE      66
N04  C     POSNBR        ANDLE     67
N04  C                   CALL      'SYFI10C'
N04  C                   PARM                    WSOT10
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C                   END
     C*
     C* LOSSESTED
     C*
E04  C     LINNBR        IFEQ      17
N04  c     POSNBR        andge     30
N04  c     POSNBR        andle     49
     C                   CALL      'SYFI10J'
E01  C                   PARM                    WSSDL01
     C                   GOTO      SLSØK
     C                   END
N04  C     LINNBR        IFEQ      17
N04  c     POSNBR        andge     52
N04  c     POSNBR        andle     71
N04  C                   CALL      'SYFI10J'
N04  C                   PARM                    WSSDL02
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     LINNBR        IFEQ      18
N04  c     POSNBR        andge     30
N04  c     POSNBR        andle     49
N04  C                   CALL      'SYFI10J'
N04  C                   PARM                    WSSDL03
N04  C                   GOTO      SLSØK
N04  C                   END
N04  C     LINNBR        IFEQ      18
N04  c     POSNBR        andge     52
N04  c     POSNBR        andle     71
N04  C                   CALL      'SYFI10J'
N04  C                   PARM                    WSSDL04
N04  C                   GOTO      SLSØK
N04  C                   END
      *
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
      *
     C     SLSØK         ENDSR
      *
      ***********************************************
     C     LESHEA        BEGSR
      ***********************************************
     c                   move      *zeros        LinTOT            5 0
     c                   select
     c     WSVK01        wheneq    'FOR'
     C     WUDTF         SETLL     SADHD
     c                   other
     C     WUDTF         SETLL     HEADDT
     c                   endsl
      *
     C     LESHE         TAG
      *
     c                   select
     c     WSVK01        wheneq    'FOR'
     C                   READ      SADHD                                  66
     c  N66              exsr      SadhHE
     c                   other
     C                   READ      HEADDT                                 66
     c                   endsl
      *
     C     *IN66         IFEQ      *OFF
      * DATO
     C     HEDTOP        IFGT      WUDTT
     C                   GOTO      SLLESH
     C                   ENDIF
      *
     C                   EXSR      TEST1
     C     *IN30         IFEQ      *OFF
     c                   move      *zeros        LinNr             5 0
     C                   EXSR      LAGINT
      * vel fortolling- legg også ut en linje for tariffering
     c     WSVK01        ifeq      'FOR'
     C                   MOVE      'TAR'         WSVK01
     C                   EXSR      LAGINT
     C                   MOVE      'FOR'         WSVK01
     C                   ENDIF
     C                   END
     C     LINTOT        CABGT     9999          SLLESH
     C                   GOTO      LESHE
      *
     C                   ENDIF
     C     SLLESH        ENDSR
      *
      ***********************************************
     C     SadhHE        BEGSR
      ***********************************************
     C                   CLEAR                   HEADFR
     c     SADHKEY       CHAIN     HEADF                              33
     c                   move      SIAVD         HEAVD
     c                   move      SITDN         HEOPD
     c                   move      SIDT          HEDTOP
      * Når Headf ikke finnes - div verdier som benyttes senere
     c     *in33         ifeq      *on
n01   * Slettet?
n01  c     SIST          ifeq      'S'
n01  C                   MOVE      'S'           HEST
n01  c                   end
     c                   move      SINTK         HENT
     c                   move      SIVKB         HEVKT
     c                   move      SIVKB         HEFBV
     c                   move      SITLL         HETLL
     c* antall varelinjer (sjekk rett mot SADV) når headf ikke finnes
     c     SADVMAX       setgt     sadv4
     c     SADHKEY       readpe    sadv4                                  33
     c  N33              z-add     SVLN          HENTF
     C                   end
     C                   ENDSR
     C*
      *
      ***********************************************
     C     LAGINT        BEGSR
      ***********************************************
     c                   add       1             LinTOT
     C                   CLEAR                   WINTFR
     c                   add       1             LinNr
     c                   Move      LinNr         WILI
     C                   MOVE      ' '           WIST
     C                   Z-ADD     HEAVD         WIAVD
     C                   Z-ADD     HEOPD         WIOPD
     C                   MOVE      WSVK01        WIVK
     c** kalkuler pris...
     c                   exsr      GetPris
dummyc     WIBELN        ifeq      *zeros
dummyc                   move      'x'           BebugDummy        1
dummyc                   end
     C                   WRITE     WINTFR
     C                   ENDSR
      *
      ***********************************************
     C     GetPris       BEGSR
      ***********************************************
     c                   MOVEL     '00000999'    XKNR
     c                   MOVEL     '9'           XAVTN
     c                   MOVEL     WSVK01        XGEBY
     C                   MOVE      'T'           XAVTT
     c                   z-add     HEFBV         XINT
N02   * Finn evt avvikende type via første linje på akt Gebyr
N02  c     PrikE         chain     PRIK                               33
N02  c     *in33         ifeq      *off
N02  c                   select
N02  c     PKKOLL        wheneq    'B'
N02  c                   z-add     HEVKT         XINT
N02  c     PKKOLL        wheneq    'L'
N02  c                   z-add     HENTF         XINT
N02  c     PKKOLL        wheneq    'X'
N02  c                   z-add     HENT          XINT
N02  c                   endsl
N02  c                   endif
s02   * HARD-koder NÅ..
s02  c*    WSVK01        ifeq      'TAR'
s02  c*                  z-add     HENTF         XINT
s02  c*                  end
     c                   z-add     XINT          WIGRL
      *
     c     Prikk         setll     PRIK
     c     GIOtag        tag
     c     PrikE         reade     PRIK                                   33
     c     *in33         ifeq      *off
      * dersom vilkår på mer enn det som ligger i PRIK---
     c                   exsr      TSTGIO
     C   78              goto      GIOtag
      * FUNNET pris
     c                   Z-add     PKBELØ        WIBELN
      * Pris re enhet ??
     C     PKKOLL        IFEQ      'L'
     C     PKPPR         IFEQ      *ZEROS
     C                   Z-ADD     1             PKPPR
     C                   END
     C                   END
     c     PKPPR         ifne      *zeros
     c                   eval      WIBELN = PKBELØ / PKPPR * XINT
     c                   end
      * Legg til/trekk fra
     c     PKTEGN        ifne      ' '
     c     PKJUST        andne     *zeros
     c                   select
     c     PKTEGN        wheneq    '-'
     c                   eval      WIBELN = WIBELN - PKJUST
     c     PKTEGN        wheneq    '+'
     c                   eval      WIBELN = WIBELN + PKJUST
     c     PKTEGN        wheneq    'M'
     c     WIBELN        iflt      PKJUST
     c                   eval      WIBELN = PKJUST
     c                   end
     c     PKTEGN        wheneq    'N'
     c     WIBELN        ifgt      PKJUST
     c                   eval      WIBELN = PKJUST
     c                   end
     c                   endsl
     c                   end
      * Div info fra benyttet avtalelinje
     c                   z-add     PKINT         WIINT
     c                   z-add     PKBELØ        WIBELØ
N03  c                   z-add(H)  WIBELN        TMPBEL           11 0
N03  c                   z-add     TMPBEL        WIBELN
     c                   z-add     PKPPR         WIPPR
     c                   move      PKTEGN        WITEGN
     c                   z-add     PKJUST        WIJUST
      *
     c                   end
     c
     C     UTPRIS        ENDSR
      ***********************************************
     C     TSTGIO        BEGSR
      ***********************************************
      *                 (= PRGE (Urspr/Franka/Opd.ty.) + PRLK (landk.)
      *                  + PRFS (FRASTED) + PRTS (Tilsted))
      *          contains all include/omit conditions possible for one
      *          priceline (max. include or omit per condition)
      *
      * TEST LK INC/OMIT PÅ "UTENLANDS-SIDEN" (=HELKA VED SPEDISJ.OPPD)
     C                   MOVE      HELKA         INOMLK            2
      * TRANSP.OPPD: HELKA=FRASIDE/HETRI=TILSIDE (HVIS NORGE, BRUK TIL)
     C     HEUR          IFEQ      'H'
     C     HELKA         IFEQ      FILAND
     C                   MOVE      HETRI         INOMLK            2
N30  C                   ELSE
N30  C     HETRI         IFNE      FILAND
N30  C                   MOVE      HETRI         INOMLK
N30  C                   END
     C                   END
     C                   END
     C     INOMLK        IFEQ      '  '
     C                   MOVE      'XX'          INOMLK
N30  C                   end
      *
      *
      *
     C                   SETOFF                                       78
      *
s06  C*    PRJOIK        CHAIN     PRJOIN                             80
s06  C* N80              DO                                                     I
      * ______________________________
      * Ursprungskode - Include / Omit
      * """"""""""""""""""""""""""""""
     C     PKURIO        IFNE      ' '                                          II
     C     PKURIO        IFEQ      'I'                                          III
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HEUR          LOOKUP    UR                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit må begrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HEUR          LOOKUP    UR                                     80
     C   80              SETON                                        78
     C                   END                                                    III
     C                   END                                                    II
      * ___________________________________
      * Frankatur/Oppdt. er låst ved brutto
      * """""""""""""""""""""""""""""""""""
     C     XKNR          IFNE      '    ALLE'                                   II
      * ______________________________
      * Frankatur     - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKFRIO        IFNE      ' '                                          III
     C     PKFRIO        IFEQ      'I'                                          IIII
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HEFR          LOOKUP    FR                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HEFR          LOOKUP    FR                                     80
     C   80              SETON                                        78
     C                   END                                                    IIII
     C                   END                                                    III
      *
      * ______________________________
      * Oppdr.type    - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKOTIO        IFNE      ' '                                          III
     C     PKOTIO        IFEQ      'I'                                          IIII
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HEOT          LOOKUP    OT                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i-arrayet (->80 off)
     C                   SETOFF                                       80
     C     HEOT          LOOKUP    OT                                     80
     C   80              SETON                                        78
     C                   END                                                    IIII
     C                   END                                                    III
      *
     C                   END                                                    II
      *
      * ______________________________
      * Landkode     - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKLKIO        IFNE      ' '                                          II
     C     PKLKIO        IFEQ      'I'                                          III
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     INOMLK        LOOKUP    LK                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit må begrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     INOMLK        LOOKUP    LK                                     80
     C   80              SETON                                        78
     C                   END                                                    III
     C                   END                                                    II
      *
      * ______________________________
      * Frasted      - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKFSIO        IFNE      ' '                                          II
     C     PKFSIO        IFEQ      'I'                                          III
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HESDF         LOOKUP    FS                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HESDF         LOOKUP    FS                                     80
     C   80              SETON                                        78
     C                   END                                                    III
     C                   END                                                    II
      *
      * ______________________________
      * Tilsted      - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKTSIO        IFNE      ' '                                          II
     C     PKTSIO        IFEQ      'I'                                          III
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HESDT         LOOKUP    TS                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HESDT         LOOKUP    TS                                     80
     C   80              SETON                                        78
     C                   END                                                    III
     C                   END                                                    II
      * ______________________________
      * lossested - Include / Omit
      *(Gebyrer som er betinget av valgfrie felt tas
      * aldri med dersom feltet i oppdraget er blankt)
      * """"""""""""""""""""""""""""""
     C  N78PKLSIO        IFNE      ' '                                          II
     C     HESDL         IFEQ      *BLANKS                                      III
     C                   SETON                                        78
     C                   ELSE
     C     PKLSIO        IFEQ      'I'                                          IIII
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HESDL         LOOKUP    LS                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HESDL         LOOKUP    LS                                     80
     C   80              SETON                                        78
     C                   END                                                    IIII
     C                   END                                                    III
     C                   END                                                    II
      * ______________________________
      * lastested - Include / Omit
      *(Gebyrer som er betinget av valgfrie felt tas
      * aldri med dersom feltet i oppdraget er blankt)
      * """"""""""""""""""""""""""""""
     C  N78PKL2IO        IFNE      ' '                                          II
     C     HESDLA        IFEQ      *BLANKS                                      III
     C                   SETON                                        78
     C                   ELSE
     C     PKL2IO        IFEQ      'I'                                          IIII
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HESDLA        LOOKUP    L2                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HESDLA        LOOKUP    L2                                     80
     C   80              SETON                                        78
     C                   END                                                    IIII
     C                   END                                                    III
     C                   END                                                    II
      *
s06  C*                  END                                                    I
      *
      * _______________________________________________________________
      * UTLØPSDATO (indikator 79 varsler at minsten linje i avt utløpt)
      * """""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     PKDT          IFGT      0
     C  N78
NV5  CANN79PKDT          COMP      HEDTOP                               79
NV5  C  N78PKDT          COMP      HEDTOP                               78
     C                   END
      * Linjen ok? (indikator 78 varsler at denne linje ikke gjelder)
      *
     C     UTGIO         ENDSR
      *
      ***********************************************
     C     TEST1         BEGSR
      ***********************************************
     C                   MOVE      *OFF          *IN30
      *
n01   * Slettet
n01  c     HEST          ifeq      'S'
n01  C                   MOVE      *ON           *IN30
n01  C                   GOTO      SLTST1
n01  c                   end
      *
      * AVDELING FRA - TIL
     C     WSAVDF        IFNE      *ZERO
     C     WSAVDT        ORNE      *ZERO
     C     HEAVD         IFLT      WSAVDF
     C     HEAVD         ORGT      WSAVDT
     C                   MOVE      *ON           *IN30
     C                   GOTO      SLTST1
     C                   ENDIF
     C                   ENDIF
      * AVDELING INCLUDE
S04  C*    WSAVDF        IFEQ      *ZERO
S04  C*    WSAVDT        ANDEQ     *ZERO
     C     WSAV01        IFNE      *ZERO
N04  C                   IF        WSAVIO='I'                                   INCLUDE
     C     HEAVD         IFNE      WSAV01
     C     HEAVD         andne     WSAV02
     C     HEAVD         andne     WSAV03
     C     HEAVD         andne     WSAV04
     C     HEAVD         andne     WSAV05
     C     HEAVD         andne     WSAV06
     C     HEAVD         andne     WSAV07
     C     HEAVD         andne     WSAV08
     C     HEAVD         andne     WSAV09
     C     HEAVD         andne     WSAV10
     C     HEAVD         andne     WSAV11
     C     HEAVD         andne     WSAV12
     C     HEAVD         andne     WSAV13
     C     HEAVD         andne     WSAV14
     C     HEAVD         andne     WSAV15
     C     HEAVD         andne     WSAV16
     C     HEAVD         andne     WSAV17
     C     HEAVD         andne     WSAV18
     C     HEAVD         andne     WSAV19
     C     HEAVD         andne     WSAV20
     C                   MOVE      *ON           *IN30                          ULIK ALLE... = SKIPP
     C                   GOTO      SLTST1
     C                   ENDIF
N04  C                   ELSE                                                   OMIT
N04  C     HEAVD         IFEQ      WSAV01
N04  C     HEAVD         oreq      WSAV02
N04  C     HEAVD         oreq      WSAV03
N04  C     HEAVD         oreq      WSAV04
N04  C     HEAVD         oreq      WSAV05
N04  C     HEAVD         oreq      WSAV06
N04  C     HEAVD         oreq      WSAV07
N04  C     HEAVD         oreq      WSAV08
N04  C     HEAVD         oreq      WSAV09
N04  C     HEAVD         oreq      WSAV10
N04  C     HEAVD         oreq      WSAV11
N04  C     HEAVD         oreq      WSAV12
N04  C     HEAVD         oreq      WSAV13
N04  C     HEAVD         oreq      WSAV14
N04  C     HEAVD         oreq      WSAV15
N04  C     HEAVD         oreq      WSAV16
N04  C     HEAVD         oreq      WSAV17
N04  C     HEAVD         oreq      WSAV18
N04  C     HEAVD         oreq      WSAV19
N04  C     HEAVD         oreq      WSAV20
N04  C                   MOVE      *ON           *IN30                          Lik en av de = SKIPP
N04  C                   GOTO      SLTST1
N04  C                   ENDIF
N04  C                   ENDIF
     C                   ENDIF
S04  C*                  ENDIF
      * FRANKATUR INCLUDE
     C     WSFR01        IFNE      *BLANKS
S04  C*    HEFR          andne     *BLANKS
N04  C                   IF        WSFRIO='I'                                   INCLUDE
N04  c     HEFR          IFEQ      *blanks
N04  C                   MOVE      *ON           *IN30
N04  C                   GOTO      SLTST1
N04  c                   endif
     C     HEFR          IFNE      WSFR01
     C     HEFR          ANDNE     WSFR02
     C     HEFR          ANDNE     WSFR03
     C     HEFR          ANDNE     WSFR04
     C     HEFR          ANDNE     WSFR05
     C     HEFR          ANDNE     WSFR06
     C     HEFR          ANDNE     WSFR07
     C     HEFR          ANDNE     WSFR08
     C     HEFR          ANDNE     WSFR09
     C     HEFR          ANDNE     WSFR10
     C                   MOVE      *ON           *IN30
     C                   GOTO      SLTST1
     C                   ENDIF
N04  c                   ELSE                                                   OMIT
N04  C     HEFR          Ifne      *BLANKS
N04  C     HEFR          IFEQ      WSFR01
N04  C     HEFR          oreq      WSFR02
N04  C     HEFR          oreq      WSFR03
N04  C     HEFR          oreq      WSFR04
N04  C     HEFR          oreq      WSFR05
N04  C     HEFR          oreq      WSFR06
N04  C     HEFR          oreq      WSFR07
N04  C     HEFR          oreq      WSFR08
N04  C     HEFR          oreq      WSFR09
N04  C     HEFR          oreq      WSFR10
N04  C                   MOVE      *ON           *IN30
N04  C                   GOTO      SLTST1
N04  C                   ENDIF
N04  C                   ENDIF
N04  C                   ENDIF
     C                   ENDIF
N04
      * OPPDRAGSTYPE INCLUDE
     C     WSOT01        IFNE      *BLANKS
s04  C*    HEOT          andne     *BLANKS
N04  C                   IF        WSOTIO='I'                                   INCLUDE
N04  c     HEOT          IFEQ      *blanks
N04  C                   MOVE      *ON           *IN30
N04  C                   GOTO      SLTST1
N04  c                   endif
     C     HEOT          IFNE      WSOT01
     C     HEOT          ANDNE     WSOT02
     C     HEOT          ANDNE     WSOT03
     C     HEOT          ANDNE     WSOT04
     C     HEOT          ANDNE     WSOT05
     C     HEOT          ANDNE     WSOT06
     C     HEOT          ANDNE     WSOT07
     C     HEOT          ANDNE     WSOT08
     C     HEOT          ANDNE     WSOT09
     C     HEOT          ANDNE     WSOT10
     C                   MOVE      *ON           *IN30
     C                   GOTO      SLTST1
     C                   ENDIF
N04  c                   ELSE                                                   OMIT
N04  C     HEOT          ifne      *BLANKS
N04  C     HEOT          IFEQ      WSOT01
N04  C     HEOT          oreq      WSOT02
N04  C     HEOT          oreq      WSOT03
N04  C     HEOT          oreq      WSOT04
N04  C     HEOT          oreq      WSOT05
N04  C     HEOT          oreq      WSOT06
N04  C     HEOT          oreq      WSOT07
N04  C     HEOT          oreq      WSOT08
N04  C     HEOT          oreq      WSOT09
N04  C     HEOT          oreq      WSOT10
N04  C                   MOVE      *ON           *IN30
N04  C                   GOTO      SLTST1
N04  C                   ENDIF
N04  C                   ENDIF
N04  c                   ENDIF
     C                   ENDIF
      * KUN IMPORT/EKSPORT
     C     WSIE          IFNE      *BLANKS
     C     HEUR          andne     *BLANKS
     C     WSIE          IFEQ      'I'
     C     HEUR          IFNE      'A'
     C     HEUR          ANDNE     'C'
     C     HEUR          ANDNE     'F'
     C*    HEUR          ANDNE     'H'
     C                   MOVE      *ON           *IN30
     C                   GOTO      SLTST1
     C                   ENDIF
     C                   ENDIF
     C     WSIE          IFEQ      'E'
     C     HEUR          IFNE      'B'
     C     HEUR          ANDNE     'D'
     C     HEUR          ANDNE     'G'
     C*    HEUR          ANDNE     'H'
     C                   MOVE      *ON           *IN30
     C                   GOTO      SLTST1
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      * LOSSE/LASTESTED
N04   *  TESTET FLYTTE I EGEN SR - GAMMER LOGIKK SLETTET HER FOR RYDDIGHET
N04  C     WSSDL01       IFNE      *BLANKS
N04  c                   exsr      SRTSTSDL
N04   * 41,42,43,44=WSSSDL01,2,3,4, samsvarer (finnes i HESDL)
N04  C                   IF        WSSDLIO='I'                                  INCLUDE
N04  C     *in41         IFne      *on
N04  C     *in42         andne     *on
N04  C     *in43         andne     *on
N04  C     *in44         andne     *on
N04  C                   MOVE      *ON           *IN30                          ingen matcher=SKIP
N04  C                   GOTO      SLTST1
N04  C                   ENDIF
N04  c                   ELSE                                                   OMIT
N04  C     *in41         IFEQ      *on
N04  C     *in42         oreq      *on
N04  C     *in43         oreq      *on
N04  C     *in44         oreq      *on
N04  C                   MOVE      *ON           *IN30                          Minst en match=SKIP
N04  C                   GOTO      SLTST1
N04  C                   ENDIF
N04  C                   ENDIF
N04   *
N04  C                   ENDIF
      *
N01   * Belastningen finnes fra før ??
N01   * Sjekker om det allerede finnes en I-linje med samme gebyrkode
N01   *   (justeringer etter første I-linje-belastning forutsettes altså gjort manuelt)
N01   * OBS!!! Åpne linjer genereres først på "inntekst-oppdraget" og belastes det enklete
N01   *        først ved intern-overføring. Testen her (på oppdraget som belastes slår altså
N01   *        til først etter at int-overføring er KJØRT.   M.a.o. KJØR OVERFØRING KJAPT!!!!
debugC     HEOPD         ifeq      154999
debugc                   move      'x'           Dummydebug        1
debugc                   end
N01  C     FAK2key       setll     FAK2
N01  C     FAK2key       reade     FAK2                                   33
N01  C     *in33         doweq     '0'
N01  C     WSVK01        ifeq      FAVK
N01  C     FAKDA         andeq     'I'                                          = Intern Motpost
N01  C                   MOVE      *ON           *IN30
N01  c                   goto      SLTST1
N01  C                   end
N01  C     FAK2key       reade     FAK2                                   33
N01  C                   end
      *
     C     SLTST1        ENDSR
      *
      *
N04   ***********************************************
N04  C     SRTSTSDL      BEGSR
N04   ***********************************************
N04   * 41,42,43,44=WSSSDL01,2,3,4, samsvarer (finnes i HESDL)
N04  C                   MOVEA     '0000'        *IN(41)
N04   *
N04  C                   MOVEL     WSSDL01       WSSDL            20
N04  C                   EXSR      TSTSDL2
N04  C     *IN33         IFEQ      *ON
N04  C                   MOVE      *ON           *IN41
N04  C                   ENDIF
N04   *
N04  C     WSSDL02       IFNE      *BLANKS
N04  C                   MOVEL     WSSDL02       WSSDL
N04  C                   EXSR      TSTSDL2
N04  C     *IN33         IFEQ      *ON
N04  C                   MOVE      *ON           *IN42
N04  C                   ENDIF
N04  C                   ENDIF
N04   *
N04  C     WSSDL03       IFNE      *BLANKS
N04  C                   MOVEL     WSSDL03       WSSDL
N04  C                   EXSR      TSTSDL2
N04  C     *IN33         IFEQ      *ON
N04  C                   MOVE      *ON           *IN43
N04  C                   ENDIF
N04  C                   ENDIF
N04   *
N04  C     WSSDL04       IFNE      *BLANKS
N04  C                   MOVEL     WSSDL04       WSSDL
N04  C                   EXSR      TSTSDL2
N04  C     *IN33         IFEQ      *ON
N04  C                   MOVE      *ON           *IN44
N04  C                   ENDIF
N04  C                   ENDIF
N04   *
N04  c                   ENDSR
N04   *
N04   ***********************************************
N04  C     TSTSDL2       BEGSR
N04   ***********************************************
N04  C     ' '           CHECKR(E) WSSDL         NUM               2 0
N04  C                   EVAL      %len(TSTSDL)=NUM
N04  C     NUM           SUBST     WSSDL:1       TSTSDL
N04  C     LO:UP         XLATE     HESDL         HesdlUP          20
N04  C     TSTSDL        SCAN      HesdlUP                                33
N04  C                   ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     HEAKEY        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     KODTGEK       KLIST
     C                   KFLD                    KGEUNI
     C                   KFLD                    WSVK01
     C                   move      'GE'          KGEUNI
     C     SADHKEY       KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SIOPD
     C     SADVMAX       KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SIOPD
     C                   KFLD                    MAXLN             5 0
     C                   z-add     99999         MAXLN
     C     PRIKK         KLIST
     C                   KFLD                    XKNR              8
     C                   KFLD                    XAVTN             1
     C                   KFLD                    XGEBY             3
     C                   KFLD                    XAVTT             1
     C                   KFLD                    XINT              5 0
     C     PRIKE         KLIST
     C                   KFLD                    XKNR
     C                   KFLD                    XAVTN
     C                   KFLD                    XGEBY
     C                   KFLD                    XAVTT
s06  C*    PRJOIK        KLIST
s06  C*                  KFLD                    PKKNR
s06  C*                  KFLD                    PKAVTN
s06  C*                  KFLD                    PKLNR
N01  C     FAK2Key       KLIST
N01  C                   KFLD                    HEAVD
N01  C                   KFLD                    HEOPD
N01  C                   KFLD                    FASK
N01  c                   move      'I'           FASK
      *
     C     *ENTRY        PLIST
     C                   PARM                    WIN03
      * inn med 1 i verdi - kommer fra F12 - UDS finnes
     C     WIN03         ifeq      '1'
     c                   move      'J'           UDSparm           1
     c                   end
     C                   move      '0'           WIN03
      *
     C                   TIME                    XULTID
      *
     C     *loval        setll     FIRM
     C                   read      FIRM
     C*
     C                   CLEAR                   BILDE01
      * finnes det verdier i UDS...
     C     UDSparm       ifeq      'J'
     c                   EXSR      RSTPARM
     C                   end
     C                   ENDSR
      ***********************************************
     C     SAVPARM       BEGSR
      ***********************************************
      * Save parametre i UDS
     c                   move      wsgavd        udgavd
     c                   move      wsgopd        udgopd
     c                   move      wsvk01        udvk01
     c                   move      wsdtf         uddtf
     c                   move      wsdtt         uddtt
     c                   move      wsavdf        udavdf
     c                   move      wsavdt        udavdt
N04  c                   move      WSAVIO        udAVIO
     c                   move      WSAV01        udAV01
     c                   move      WSAV02        udAV02
     c                   move      WSAV03        udAV03
     c                   move      WSAV04        udAV04
     c                   move      WSAV05        udAV05
     c                   move      WSAV06        udAV06
     c                   move      WSAV07        udAV07
     c                   move      WSAV08        udAV08
     c                   move      WSAV09        udAV09
     c                   move      WSAV10        udAV10
     c                   move      WSAV11        udAV11
     c                   move      WSAV12        udAV12
     c                   move      WSAV13        udAV13
     c                   move      WSAV14        udAV14
     c                   move      WSAV15        udAV15
     c                   move      WSAV16        udAV16
     c                   move      WSAV17        udAV17
     c                   move      WSAV18        udAV18
     c                   move      WSAV19        udAV19
     c                   move      WSAV20        udAV20
N04  c                   move      WSFRIO        udFRIO
     c                   move      WSFR01        udFR01
     c                   move      WSFR02        udFR02
     c                   move      WSFR03        udFR03
     c                   move      WSFR04        udFR04
     c                   move      WSFR05        udFR05
     c                   move      WSFR06        udFR06
     c                   move      WSFR07        udFR07
     c                   move      WSFR08        udFR08
     c                   move      WSFR09        udFR09
     c                   move      WSFR10        udFR10
N04  c                   move      WSOTIO        udOTIO
     c                   move      WSOT01        udOT01
     c                   move      WSOT02        udOT02
     c                   move      WSOT03        udOT03
     c                   move      WSOT04        udOT04
     c                   move      WSOT05        udOT05
     c                   move      WSOT06        udOT06
     c                   move      WSOT07        udOT07
     c                   move      WSOT08        udOT08
     c                   move      WSOT09        udOT09
     c                   move      WSOT10        udOT10
     c                   move      WSIE          udIE
N04  c                   move      WSSDLIO       UDSDLIO
E04  c                   move      WSSDL01       UDSDL01
N04  c                   move      WSSDL02       UDSDL02
N04  c                   move      WSSDL03       UDSDL03
N04  c                   move      WSSDL04       UDSDL04
     C                   ENDSR
      ***********************************************
     C     RSTPARM       BEGSR
      ***********************************************
      * GeT parametre fra UDS
     c                   move      udgavd        wsgavd
     c                   move      udgopd        wsgopd
     c                   move      udvk01        wsvk01
     c                   move      uddtf         wsdtf
     c                   move      uddtt         wsdtt
     c                   move      udavdf        wsavdf
     c                   move      udavdt        wsavdt
N04  c                   move      udAVIO        WSAVIO
     c                   move      udAV01        WSAV01
     c                   move      udAV02        WSAV02
     c                   move      udAV03        WSAV03
     c                   move      udAV04        WSAV04
     c                   move      udAV05        WSAV05
     c                   move      udAV06        WSAV06
     c                   move      udAV07        WSAV07
     c                   move      udAV08        WSAV08
     c                   move      udAV09        WSAV09
     c                   move      udAV10        WSAV10
     c                   move      udAV11        WSAV11
     c                   move      udAV12        WSAV12
     c                   move      udAV13        WSAV13
     c                   move      udAV14        WSAV14
     c                   move      udAV15        WSAV15
     c                   move      udAV16        WSAV16
     c                   move      udAV17        WSAV17
     c                   move      udAV18        WSAV18
     c                   move      udAV19        WSAV19
     c                   move      udAV20        WSAV20
N04  c                   move      udFRIO        WSFRIO
     c                   move      udFR01        WSFR01
     c                   move      udFR02        WSFR02
     c                   move      udFR03        WSFR03
     c                   move      udFR04        WSFR04
     c                   move      udFR05        WSFR05
     c                   move      udFR06        WSFR06
     c                   move      udFR07        WSFR07
     c                   move      udFR08        WSFR08
     c                   move      udFR09        WSFR09
     c                   move      udFR10        WSFR10
N04  c                   move      udOTIO        WSOTIO
     c                   move      udOT01        WSOT01
     c                   move      udOT02        WSOT02
     c                   move      udOT03        WSOT03
     c                   move      udOT04        WSOT04
     c                   move      udOT05        WSOT05
     c                   move      udOT06        WSOT06
     c                   move      udOT07        WSOT07
     c                   move      udOT08        WSOT08
     c                   move      udOT09        WSOT09
     c                   move      udOT10        WSOT10
     c                   move      udIE          WSIE
N04  c                   move      UDSDLIO       WSSDLIO
E04  c                   move      UDSDL01       WSSDL01
n04  c                   move      UDSDL02       WSSDL02
n04  c                   move      UDSDL03       WSSDL03
n04  c                   move      UDSDL04       WSSDL04
     C                   ENDSR
N05
N05   *********************************************
N05  C     GETMAL        BEGSR
N05   *********************************************
N05   *
N05  C     WSRNAV        CHAIN(N)  SYKSINM                            96
N05  C     *IN96         IFEQ      '1'
N05  C                   MOVE      'JOV1233'     MSGNR
N05  C                   SETON                                        30
N05  C                   Z-ADD     2             LINNBR
N05  C                   Z-ADD     27            POSNBR
N05  C                   ELSE
N05  C                   MOVE      SBESK         WSBESK
N05  C                   MOVE      SGAVD         WSGAVD
N05  C                   MOVE      SVK01         WSVK01
N05  C                   MOVE      SDTF          WSDTF
N05  C                   MOVE      SDTT          WSDTT
N05  C                   MOVE      SAVDF         WSAVDF
N05  C                   MOVE      SAVDT         WSAVDT
N05  C*
N05  C                   MOVE      SAVIO         WSAVIO
N05  C                   MOVE      SAV01         WSAV01
N05  C                   MOVE      SAV02         WSAV02
N05  C                   MOVE      SAV03         WSAV03
N05  C                   MOVE      SAV04         WSAV04
N05  C                   MOVE      SAV05         WSAV05
N05  C                   MOVE      SAV06         WSAV06
N05  C                   MOVE      SAV07         WSAV07
N05  C                   MOVE      SAV08         WSAV08
N05  C                   MOVE      SAV09         WSAV09
N05  C                   MOVE      SAV10         WSAV10
N05  C                   MOVE      SAV11         WSAV11
N05  C                   MOVE      SAV12         WSAV12
N05  C                   MOVE      SAV13         WSAV13
N05  C                   MOVE      SAV14         WSAV14
N05  C                   MOVE      SAV15         WSAV15
N05  C                   MOVE      SAV16         WSAV16
N05  C                   MOVE      SAV17         WSAV17
N05  C                   MOVE      SAV18         WSAV18
N05  C                   MOVE      SAV19         WSAV19
N05  C                   MOVE      SAV20         WSAV20
N05  C*
N05  C                   MOVE      SFRIO         WSFRIO
N05  C                   MOVE      SFR01         WSFR01
N05  C                   MOVE      SFR02         WSFR02
N05  C                   MOVE      SFR03         WSFR03
N05  C                   MOVE      SFR04         WSFR04
N05  C                   MOVE      SFR05         WSFR05
N05  C                   MOVE      SFR06         WSFR06
N05  C                   MOVE      SFR07         WSFR07
N05  C                   MOVE      SFR08         WSFR08
N05  C                   MOVE      SFR09         WSFR09
N05  C                   MOVE      SFR10         WSFR10
N05  C*
N05  C                   MOVE      SOTIO         WSOTIO
N05  C                   MOVE      SOT01         WSOT01
N05  C                   MOVE      SOT02         WSOT02
N05  C                   MOVE      SOT03         WSOT03
N05  C                   MOVE      SOT04         WSOT04
N05  C                   MOVE      SOT05         WSOT05
N05  C                   MOVE      SOT06         WSOT06
N05  C                   MOVE      SOT07         WSOT07
N05  C                   MOVE      SOT08         WSOT08
N05  C                   MOVE      SOT09         WSOT09
N05  C                   MOVE      SOT10         WSOT10
N05  C*
N05  C                   MOVE      SSDLIO        WSSDLIO
N05  C                   MOVE      SSDL01        WSSDL01
N05  C                   MOVE      SSDL02        WSSDL02
N05  C                   MOVE      SSDL03        WSSDL03
N05  C                   MOVE      SSDL04        WSSDL04
N05  C*  klargjort for ehget felt for lastested
N05  C*                  MOVE      SSLAIO        WSSLAIO
N05  C*                  MOVE      SSLA01        WSSLA01
N05  C*                  MOVE      SSLA02        WSSLA02
N05  C*                  MOVE      SSLA03        WSSLA03
N05  C*                  MOVE      SSLA04        WSSLA04
N05  C                   MOVE      SIE           WSIE
N05  C                   END
N05   *
N05  C                   ENDSR
N05   *
N05   *********************************************
N05  C     SKRMAL        BEGSR
N05   *********************************************
N05   *
N05   * SKAL UANSETT VARSLE...
N05   * ENTEN FEIL, ELLER ER SKREVET / OPPDATERT
N05  C                   SETON                                        3096
N05  C                   Z-ADD     2             LINNBR
N05  C                   Z-ADD     27            POSNBR
N05   *
N05  C     WSRNAV        CHAIN     SYKSINM                            33
N05   * FINNES, MEN F13 ER TASTET - varsel om at F14=Overskriv
N05  C     *IN33         IFEQ      '0'
N05  C     *IN13         ANDEQ     '1'
N05  C                   UPDATE    SYKSINMR
N05  C                   MOVE      'JOV1234'     MSGNR
N05  C                   GOTO      UTSKMA
N05  C                   END
N05   * FINNES IKKE, MEN F14 ER TASTET, - varsel om at F13=Lagre ny
N05  C     *IN33         IFEQ      '1'
N05  C     *IN14         ANDEQ     '1'
N05  C                   MOVE      'JOV1235'     MSGNR
N05  C                   GOTO      UTSKMA
N05  C                   END
N05   * NAVN/BESK. KAN IKKE VÆRE BLANK
N05  C     WSRNAV        IFEQ      *BLANKS
N05  C     WSBESK        OREQ      *BLANKS
N05  C  N33              delete    SYKSINMR
N05  C                   MOVE      'JOV1238'     MSGNR
N05  C                   GOTO      UTSKMA
N05  C                   END
N05   *
N05   * 33-ON = SKRIV NY / OFF = OPPDATER
N05  C                   MOVE      WSRNAV        SRNAV
N05  C                   MOVE      WSBESK        SBESK
N05  C                   MOVE      WSGAVD        SGAVD
N05  C                   MOVE      WSVK01        SVK01
N05  C                   MOVE      WSDTF         SDTF
N05  C                   MOVE      WSDTT         SDTT
N05  C                   MOVE      WSAVDF        SAVDF
N05  C                   MOVE      WSAVDT        SAVDT
N05  C*
N05  C                   MOVE      WSAVIO        SAVIO
N05  C                   MOVE      WSAV01        SAV01
N05  C                   MOVE      WSAV02        SAV02
N05  C                   MOVE      WSAV03        SAV03
N05  C                   MOVE      WSAV04        SAV04
N05  C                   MOVE      WSAV05        SAV05
N05  C                   MOVE      WSAV06        SAV06
N05  C                   MOVE      WSAV07        SAV07
N05  C                   MOVE      WSAV08        SAV08
N05  C                   MOVE      WSAV09        SAV09
N05  C                   MOVE      WSAV10        SAV10
N05  C                   MOVE      WSAV11        SAV11
N05  C                   MOVE      WSAV12        SAV12
N05  C                   MOVE      WSAV13        SAV13
N05  C                   MOVE      WSAV14        SAV14
N05  C                   MOVE      WSAV15        SAV15
N05  C                   MOVE      WSAV16        SAV16
N05  C                   MOVE      WSAV17        SAV17
N05  C                   MOVE      WSAV18        SAV18
N05  C                   MOVE      WSAV19        SAV19
N05  C                   MOVE      WSAV20        SAV20
N05  C*
N05  C                   MOVE      WSFRIO        SFRIO
N05  C                   MOVE      WSFR01        SFR01
N05  C                   MOVE      WSFR02        SFR02
N05  C                   MOVE      WSFR03        SFR03
N05  C                   MOVE      WSFR04        SFR04
N05  C                   MOVE      WSFR05        SFR05
N05  C                   MOVE      WSFR06        SFR06
N05  C                   MOVE      WSFR07        SFR07
N05  C                   MOVE      WSFR08        SFR08
N05  C                   MOVE      WSFR09        SFR09
N05  C                   MOVE      WSFR10        SFR10
N05  C*
N05  C                   MOVE      WSOTIO        SOTIO
N05  C                   MOVE      WSOT01        SOT01
N05  C                   MOVE      WSOT02        SOT02
N05  C                   MOVE      WSOT03        SOT03
N05  C                   MOVE      WSOT04        SOT04
N05  C                   MOVE      WSOT05        SOT05
N05  C                   MOVE      WSOT06        SOT06
N05  C                   MOVE      WSOT07        SOT07
N05  C                   MOVE      WSOT08        SOT08
N05  C                   MOVE      WSOT09        SOT09
N05  C                   MOVE      WSOT10        SOT10
N05  C*
N05  C                   MOVE      WSSDLIO       SSDLIO
N05  C                   MOVE      WSSDL01       SSDL01
N05  C                   MOVE      WSSDL02       SSDL02
N05  C                   MOVE      WSSDL03       SSDL03
N05  C                   MOVE      WSSDL04       SSDL04
N05  C*
N05  C*                  MOVE      WSSLAIO       SSLAIO
N05  C*                  MOVE      WSSLA01       SSLA01
N05  C*                  MOVE      WSSLA02       SSLA02
N05  C*                  MOVE      WSSLA03       SSLA03
N05  C*                  MOVE      WSSLA04       SSLA04
N05  C*                  MOVE      WSIE          SIE
N05  C                   TIME                    XULTID
N05  C                   MOVE      XULDD         ULDD
N05  C                   MOVE      XULMM         ULMM
N05  C                   MOVE      XULÅÅ         ULÅÅ
N05  C                   MOVE      ZUSER         SSIEID
N05  C                   MOVE      ULDT          SSIEDT
N05  C     *IN33         IFEQ      *ON
N05  C                   WRITE     SYKSINMR
N05  C                   MOVE      'JOV1236'     MSGNR
N05  C                   ELSE
N05  C                   UPDATE    SYKSINMR
N05  C                   MOVE      'JOV1237'     MSGNR
N05  C                   END
N05   *
N05  C     UTSKMA        ENDSR
N05   *
N05   *********************************************
N05  C     OPDMAL        BEGSR
N05   *********************************************
N05   *
N05  C     WSRNAV        CHAIN     SYKSINM                            33
N05  C     *IN33         IFEQ      *OFF
N05  C                   TIME                    XULTID
N05  C                   MOVE      XULDD         ULDD
N05  C                   MOVE      XULMM         ULMM
N05  C                   MOVE      XULÅÅ         ULÅÅ
N05  C                   MOVE      ZUSER         SSISID
N05  C                   MOVE      ULDT          SSISDT
N05  C                   UPDATE    SYKSINMR
N05  C                   END
N05   *
N05  C                   ENDSR
N05   *
