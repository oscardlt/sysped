     Ffkgmladr  ip   e             DISK
     F                                     RENAME(fkkunder:fffff)
     Ffkcunda   o    e             DISK
     D A               S              1    DIM(79)
     D B               S              1    DIM(18)
      *________________________
      * DS for decimal handling
      *""""""""""""""""""""""""
     D                 DS
     D  ZDEC                   1      7  6
     D  ZDEC6                  2      7
     D  ZHEL                  11     22  0
     D                 DS
     D  data                   1    300
     D  da                     1    300
     D                                     DIM(300)
     D                 DS
     D  felta                  1     60
     D  fa                     1     60
     D                                     DIM(60)
     D                 DS
     D  dta                    1   6000
     D                                     DIM(60)
     D LO              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyz')
     D UP              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZ')
      *
      * INITIERER VARIABLE
      *
     c                   z-add     1             fra               3 0
     c                   z-add     1             til               3 0
     c                   z-add     0             DN                3 0
     c                   movel     fkkunder      data
      *
      * leser til neste skilletegn ';'
      *
     c     til           dowlt     300
     C     da(til)       ifne      ';'
     c                   add       1             til
     c                   else
      *
      * fra og til er funnet
      *
     c                   exsr      dekod
     c                   add       1             til
     c                   z-add     til           fra
     c                   endif
     c                   enddo
      *
      * siste post
      *
     c     fra           add       58            til
     c                   exsr      dekod
      * DETALJBEHANDLING
      *
     c                   exsr      DETSR
      *
     c***************************************************************
     c     dekod         begsr
     c***************************************************************
      *
      * dekoder innlest post
      *
     c     til           sub       fra           antp              3 0
     c     antp          ifgt      0
     c                   exsr      dokoda
     c                   add       1             dn
     c                   movel     felta         dta(dn)
     C                   ELSE
     c                   add       1             dn
     c                   end
     c                   endsr
     c***************************************************************
     c     DOKODA        begsr
     c***************************************************************
     c*    dekoder  TIL FELTA
     c*
     c                   move      *blanks       felta
     c                   z-add     fra           nr                3 0
     c                   z-add     1             n2                3 0
     c                   do        antp
     c                   move      da(nr)        fa(n2)
     c                   add       1             n2
     c                   add       1             nr
     c                   enddo
     c                   endsr
     c***************************************************************
     c     DETSR         begsr
     c***************************************************************
     c                   clear                   KUNDR
      *
      * KUNDERNUMMER I 1-6
      *
     C                   MOVE      'A'           AKTKOD
     C                   MOVEL     'FK'          FIRMA
     C                   MOVEL     data          KUND05            5 0
     C                   z-add     kund05        KUNDNR
      *
      * KUNDENAVN
      *
     c                   movel     dta(1)        KNAVN
      *
     c                   movel     knavn         sonavn
     C     LO:UP         XLATE     sonavn        sonavn
      *
      * ADRESSELINJE 1
      *
     c                   movea     dta(2)        ADR1
      *
      * ADR4ESSELINJE 2
      *
     c                   movel     dta(3)        adr2
      *
      * POSTNR STED
      *
     c                   movel     dta(5)        TEST5             5
     C                   MOVE      TEST5         TEST1             1
     C                   MOVEL     TEST5         TEST4             4
     C     TEST1         IFEQ      *BLANK
     C                   TESTN                   TEST4                88
     C     *IN(88)       IFEQ      '1'
     C                   MOVE      TEST4         POSTNR
     C                   MOVEL     DTA(5)        TEST29           29
     C                   MOVE      TEST29        TEST24           24
     C                   MOVEL     TEST24        TEST1
     C     TEST1         IFEQ      *BLANK
     C                   MOVE      TEST24        TEST23           23
     C                   MOVEL     TEST23        TEST24
     C                   END
     C                   MOVEL     TEST24        ADR3
     C                   ELSE
     C                   MOVEL     DTA(5)        ADR3
     c                   end
     C                   ELSE
     C                   MOVEL     DTA(5)        ADR3
     C                   END
      *
      * TELEFON
      *
     c                   moveL     dta(6)        TLF
      *
      * TELEFAX
      *
     c                   moveL     dta(7)        TFAXNR
      *
      * FORETAKSNUMMER
      *
     c*                  moveL     dta(8)        TEST9             9
     C*                  TESTN                   TEST9                88
     C*    *IN(88)       IFEQ      '1'
     C*                  MOVEL     DTA(8)        TEST10           10
     C*                  MOVE      TEST10        TEST1
     C*    TEST1         IFEQ      ' '
     C*                  MOVEL     TEST9         SYRG
     C*                  END
     C*                  END
      *
      *
      * KONTO KONTROLLSIFFER
      *
      *
     c*                  movea     dta(9)        a
     c*                  exsr      getnum
     c*                  z-add     znum          KTOKSI            8 0
     C*                  MOVE      KTOKSI        SYKONT
     C*    KTOKSI        IFgt      9999999
     C*                  MOVEL     KTOKSI        SYFR02
     C*                  END
      *
     c                   write     kundr
     c                   endsr
     c*****************************************
     c     getnum        begsr
     c*****************************************
     C                   MOVE      *ZEROS        ZHEL
     C                   MOVE      *ZEROS        ZDEC
     C                   MOVE      *ZEROS        B
     C                   Z-ADD     1             AX                2 0
     C                   Z-ADD     1             BX                2 0
      * Get Integer
     C     A(AX)         DOWGE     '0'
     C     ZHEL          MULT      10            ZHEL
     C                   MOVE      A(AX)         ZHEL
     C                   ADD       1             AX
     C                   ENDDO
      * Decimal point ?
     C     A(AX)         IFEQ      '.'
     C     A(AX)         OREQ      ','
     C                   ADD       1             AX
     C     A(AX)         DOWGE     '0'
     C                   MOVE      A(AX)         B(BX)
     C                   ADD       1             AX
     C                   ADD       1             BX
     C                   ENDDO
     C                   MOVEA     B             ZDEC6
     C                   ENDIF
      * Concatenate
     C                   Z-ADD     ZHEL          ZNUM             18 6
     C                   ADD       ZDEC          ZNUM
     C                   ENDSR
     c
