********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 SH  PTF12 simulerer webkall til syfa93b
12XXX * 02 YBC PTF12 Oppdater flere felter
12XXX * 03 YBC PTF12 Sett slettemerke på FRISOK
********************************************************************
     H DATEDIT(*YMD)
     FEDIS      IF   E           K DISK
     FEDIM      UF   E           K DISK
     FEUNH      IF   E           K DISK
     FECNI01B   IF   E           K DISK
     FECNT01B   IF   E           K DISK
     FECOM01B   IF   E           K DISK
     FECTA01B   IF   E           K DISK
     FEDTM01B   IF   E           K DISK
     FEEQD01B   IF   E           K DISK
     FELOC01B   IF   E           K DISK
     FETDT01B   IF   E           K DISK
     FEFTX01B   IF   E           K DISK
     FENAD01B   IF   E           K DISK
     FERFF01B   IF   E           K DISK
     FETOD01B   IF   E           K DISK
     FEGID01B   IF   E           K DISK
     FEMEA01B   IF   E           K DISK
     FEMOA01B   IF   E           K DISK
     FEGIN01B   IF   E           K DISK
     FEPCI01B   IF   E           K DISK
     FFIRM      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FTELL      UF A E           K DISK
     FHEADF     UF A E           K DISK
     FDISP      UF A E           K DISK
     FFREETXT   UF A E           K DISK
     FFRISOL01  IF   E           K DISK    RENAME(FRISOKR:FRISOKR1)
     FFRISOK    UF A E           K DISK
     FKODFRI    IF   E           K DISK
     FDOKUFM    UF A E           K DISK
     FDOKUFV    UF A E           K DISK
     FDOKUFE    UF A E           K DISK
     FTRACKF    O  A E             DISK
     FTRACKT    UF A E           K DISK
     D A               S              1    DIM(79)
     D B               S              1    DIM(18)
     D TABA            S             35    DIM(12) CTDATA PERRCD(1)
     D TABB            S              8    DIM(12) ALT(TABA)
     D CD              S              3    DIM(10)
     D RF              S             35    DIM(10)
      *________________________
      * DS for decimal handling
      *""""""""""""""""""""""""
     D                 DS
     D  ZDEC                   1      7  6
     D  ZDEC6                  2      7
     D  ZHEL                  11     22  0
     D                 DS
     D  WMN2                   1      9  0
     D                 DS
     D  XFT                    1    512
     D  FT                     1    490    DIM(7)
     D                SDS
     D  ZUSER                254    263
      */////////////
      * MAIN LOGIC /
      */////////////
      *___________
      * Initiering
      *"""""""""""
     C                   EXSR      INIT
      *________
      * CONVERT
      *""""""""
     C                   EXSR      RTVD
      *
     C                   MOVE      '1'           *INLR
      *
      *////////////////////////////////////////////////////////////
      *                                                      INIT /
      *////////////////////////////////////////////////////////////
     C     INIT          BEGSR
     C     CUNDL01K      KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C     FRISOKK       KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    FSKODE
     C     FRISOL01K     KLIST
     C                   KFLD                    W_FSKODE
     C                   KFLD                    W_FSSOK
     C     HEADFK        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     DOKUFMK       KLIST
     C                   KFLD                    FMRI
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     DOKUFVK       KLIST
     C                   KFLD                    FVRI
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     DOKUFEK       KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    FE_DFFBNR
     C                   KFLD                    FE_N3035
     C     KEYMS0        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN0
     C     KEYMS1        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN1
     C                   KFLD                    ZREPB0
     C     KEYMS2        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN2
     C                   KFLD                    ZREPC0
     C                   KFLD                    ZREPC1
     C     KEYMS3        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN3
     C                   KFLD                    ZREPD0
     C                   KFLD                    ZREPD1
     C                   KFLD                    ZREPD2
      *
     C     *LIKE         DEFINE    NMN           ZMN
     C     *LIKE         DEFINE    NGN           ZGN0
     C     *LIKE         DEFINE    NGN           ZGN1
     C     *LIKE         DEFINE    NGN           ZGN2
     C     *LIKE         DEFINE    NGN           ZGN3
     C     *LIKE         DEFINE    NREP0         ZREPB0
     C     *LIKE         DEFINE    NREP0         ZREPC0
     C     *LIKE         DEFINE    NREP1         ZREPC1
     C     *LIKE         DEFINE    NREP0         ZREPD0
     C     *LIKE         DEFINE    NREP1         ZREPD1
     C     *LIKE         DEFINE    NREP2         ZREPD2
     C     *LIKE         DEFINE    HEHAWB        WEHAWB
     C     *LIKE         DEFINE    HETRC         WETRC
     C     *LIKE         DEFINE    HETRCN        WETRCN
     C     *LIKE         DEFINE    HESDF         WESDF
     C     *LIKE         DEFINE    HESDT         WESDT
     C     *LIKE         DEFINE    HEKNA         WEKNA
     C     *LIKE         DEFINE    HESDL         WESDL
     C     *LIKE         DEFINE    FSKODE        W_FSKODE
     C     *LIKE         DEFINE    FSSOK         W_FSSOK
      * INIT WORKFIELDS
     C                   MOVE      *BLANKS       WEHAWB
     C                   MOVE      *BLANKS       WETRC
     C                   MOVE      *BLANKS       WETRCN
     C                   MOVE      *BLANKS       WESDF
     C                   MOVE      *BLANKS       WESDT
     C                   MOVE      *ZEROS        WEKNA
     C                   MOVE      *BLANKS       WESDL
     C                   EVAL      FMRI     = 'F'
     C                   EVAL      FVRI     = 'F'
     C                   EVAL      FE_DFFBNR = 1
     C                   EVAL      W_FSKODE = 'KRF'
      *
     C     *ENTRY        PLIST
     C                   PARM                    WMN1              9
     C                   MOVEL     WMN1          WMN2
     C                   Z-ADD     WMN2          ZMN
      * Get msg and interchange values
     C     ZMN           CHAIN(N)  EDIM                               51
     C     ZMN           CHAIN     EUNH                               51
     C     MSN           CHAIN     EDIS                               51
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   51
      *
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * RETREIVE INFO FROM EDIFACT DATABASE TO SYSPED400     RTVD /
      *////////////////////////////////////////////////////////////
     C     RTVD          BEGSR
      *_______________________
      * READ ALL MAIN SEGMENTS
      *"""""""""""""""""""""""
      * RFF01
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     1             ZGN0
     C                   Z-ADD     0             XN                3 0
     C     KEYMS0        SETLL     ERFF01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ERFF01B                                51
     C     *IN51         DOWEQ     '0'
      *
     C                   ADD       1             XN                             SENDING AG
     C                   EVAL      CD(XN) = R1153
     C                   EVAL      RF(XN) = R1154
      *
     C  N51KEYMS0        READE     ERFF01B                                51
     C  N51              ENDDO
     C                   END
      *
      * NAD16
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     16            ZGN0
     C     KEYMS0        SETLL     ENAD01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ENAD01B                                51
     C     *IN51         DOWEQ     '0'
      *
     C                   SELECT
     C                   WHEN      N3035 = 'CA'
     C                   Z-ADD     0             WEKNA
     C     N3039         LOOKUP    TABA          TABB                     20
     C     *IN20         IFEQ      *ON
     C                   MOVEL     TABB          WEKNA
     C                   MOVE      '1'           *IN51
     C                   ENDIF
     C                   ENDSL
      *
     C  N51KEYMS0        READE     ENAD01B                                51
     C  N51              END
     C                   END
      * LOC10
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     10            ZGN0
     C     KEYMS0        SETLL     ELOC01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ELOC01B                                51
     C     *IN51         DOWEQ     '0'
      *
     C                   Z-ADD     10            ZGN1
     C                   Z-ADD     LREP0         ZREPB0
     C     KEYMS1        CHAIN     EDTM01B                            52
     C                   SELECT
     C                   WHEN      L3227 = '9'
     C                   MOVEL     L3225         WESDF
     C  N52              MOVEL     D2380         W2380_F          35
     C                   WHEN      L3227 = '88'
     C                   MOVEL     L3225         WESDT
     C  N52              MOVEL     D2380         W2380_T          35
     C                   ENDSL
      *
     C  N51KEYMS0        READE     ELOC01B                                51
     C  N51              ENDDO
     C                   END
      * EQD21
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     21            ZGN0
     C     KEYMS0        SETLL     EEQD01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     EEQD01B                                51
     C     *IN51         DOWEQ     '0'
      *
     C     E8053         IFEQ      'CN'
     C                   MOVE      '1'           WETRC
     C                   MOVEL     E8260         WETRCN
     C                   MOVE      '1'           *IN51
     C                   ELSE
     C     E8053         IFEQ      'TE'
     C                   MOVEL     E8260         WEHAWB
     C                   MOVE      '1'           *IN51
     C                   END
     C                   END
      *
     C  N51KEYMS0        READE     EEQD01B                                51
     C  N51              ENDDO
     C                   END
      * TDT09
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     9             ZGN0
     C     KEYMS0        SETLL     ETDT01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ETDT01B                                51
     C     *IN51         DOWEQ     '0'
      *
     C                   MOVEL     T8212         WEHAWB
      *
     C  N51KEYMS0        READE     ETDT01B                                51
     C  N51              ENDDO
     C                   END
      *___________________
      * READ CONSIGNEMENTS
      *"""""""""""""""""""
     C                   Z-ADD     0             WPOS              3 0
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     25            ZGN0
     C     KEYMS0        SETLL     ECNI01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ECNI01B                                51
     C     *IN51         DOWEQ     '0'
      *
     C                   MOVE      'N'           XSNDIFTMBC        1
      *
     C                   EXSR      RTVDB
      *
     C                   IF        XSNDIFTMBC = 'J'
     C                   MOVE      HEAVD         UAVD
     C                   MOVE      HEOPD         UOPD
     C                   CALL      'E341R_01B'
     C                   PARM                    UAVD              4
     C                   PARM                    UOPD              7
     C                   ENDIF
      *
     C     KEYMS0        READE     ECNI01B                                51
     C  N51              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * RETREIVE INFO FROM EDIFACT DATABASE TO SYSPED400    RTVDB /
      *////////////////////////////////////////////////////////////
     C     RTVDB         BEGSR
      *
     C                   EVAL      W_FSSOK = C1004
     C     FRISOL01K     CHAIN     FRISOL01                           33
     C                   DOW       *IN33 = *OFF
      * LES INNTIL ENTEN INGEN OPPDRAG FUNNET ELLER AKTIV OPPDRAG
     C                   EVAL      HEAVD = FSAVD
     C                   EVAL      HEOPD = FSOPD
     C     HEADFK        CHAIN(N)  HEADF                              33
     C                   IF        *IN33 = *OFF AND
     C                             (HEST = ' ' OR HEST = 'X')
      * AKTIV OPPDRAG
     C                   LEAVE
     C                   END
     C     FRISOL01K     READE     FRISOL01                               33
     C                   ENDDO
      *
     C                   IF        *IN33
     C                   MOVE      'J'           XNYOPD            1
     C                   ELSE
     C                   MOVE      'N'           XNYOPD
     C                   EVAL      HEAVD = FSAVD
     C                   EVAL      HEOPD = FSOPD
     C                   IF        U1225 = '1'                                  KANSELLERING
     C                   EXSR      SRSLTOPD
     C                   GOTO      SLRTVDB
     C                   END
     C                   EXSR      SRSLT                                        SLETT GAMLE INFO
     C                   END
      *__________________
      * INIT. DATAFELTER
      *""""""""""""""""""
     C                   IF        XNYOPD = 'J'
     C                   CLEAR                   HEADFR
     C                   EVAL      HEAVD = 11
     C     HEAVD         CHAIN     TELL                               33
     C                   MOVE      TEOPDN        HEOPD
     C                   ADD       1             TEOPDN
     C                   UPDATE    TELLR
     C                   EVAL      HESG = 'EDI'
     C                   MOVE      WDT           HEDTR
     C                   MOVE      WDT           HEDTOP
     C                   MOVE      WDT           TRSDFD
     C                   MOVE      WDT           TRSDTD
     C                   EVAL      TRSLAG = 'HO'
     C                   EVAL      TRKNFA = 84
     C                   EVAL      HEKNS  = 84
     C                   EVAL      HEKNSF = 84
     C                   EVAL      TRKDFF = 'S'
     C                   ELSE
     C                   EVAL      HEAVD = FSAVD
     C                   EVAL      HEOPD = FSOPD
     C                   END
     C     HEADFK        CHAIN     HEADF                              51
N02  C                   EVAL      HEVKT  = 0
N02  C                   EVAL      HEM3   = 0
N02  C                   EVAL      HELM   = 0
      *
     C                   MOVE      'H'           HEUR
     C                   Z-ADD     WEKNA         HEKNA
     C                   Z-ADD     WEKNA         KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            33
     C  N33              EVAL      HENAA = KNAVN
      *
     C                   MOVEL     's'           HESDL
     C                   MOVEL     C1004         HERFA
     C                   ADD       1             WPOS
     C                   MOVEL     WEHAWB        HEHAWB
     C                   MOVEL     WPOS          HEPOS1
     C                   MOVEL     SLIB          HELIB
     C                   MOVEL     SFILE         HEFILE
     C                   MOVEL     SMBR          HEMBR
     C                   MOVE      'IFCSUM'      HETYPE
     C                   MOVE      '01B'         HELVL
     C                   Z-ADD     ZMN           HESNN
      *__________________
      * READ ALL SEGMENTS
      *""""""""""""""""""
     C                   Z-ADD     CREP0         ZREPB0
     C                   EXSR      DTM25
     C                   EXSR      CNT25
     C                   EXSR      FTX25
     C*                  EXSR      LOC20
     C                   EXSR      TOD31
     C                   EXSR      RFF32
     C                   EXSR      NAD43
     C                   EXSR      GID50
      *___________________
      * WRITE TO SYSPED400
      *"""""""""""""""""""
     C                   EVAL      HEHAWB = WEHAWB
     C                   EVAL      HETRC  = WETRC
     C                   EVAL      HETRCN = WETRCN
N02  C                   IF        HESDF = *BLANKS
     C                   EVAL      HESDF  = WESDF
N02  C                   END
N02  C                   IF        HESDT = *BLANKS
     C                   EVAL      HESDT  = WESDT
N02  C                   END
     C                   EVAL      HESDL  = WESDL
     C                   IF        TXETDD <> 0
     C                   EVAL      HEDTOP = TXETDD
     C                   EVAL      TRSDFD = TXETDD
     C                   END
     C                   IF        TXETAD <> 0
     C                   EVAL      TRSDTD = TXETAD
     C                   END
      *
     C                   IF        *IN51
     C                   WRITE     HEADFR
     C                   ELSE
     C                   UPDATE    HEADFR
     C                   END
     C                   EVAL      XSNDIFTMBC = 'J'
      *
     C     ZMN           CHAIN     EDIM                               51
     C                   EVAL      MAVD = HEAVD
     C                   EVAL      MTDN = HEOPD
     C                   UPDATE    EDIMR
      *
     C                   CLEAR                   DISPR
     C     HEADFK        CHAIN     DISP                               33
     C                   EVAL      DIAVD  = HEAVD
     C                   EVAL      DIOPD  = HEOPD
     C                   MOVE      HESDF         DISTEF
     C                   MOVE      HESDT         DISTET
N02  C                   EVAL      DISONF = HELKA
N02  C                   EVAL      DISONT = HETRI
     C                   MOVE      TRSDFD        DIDATF
     C                   MOVE      TRSDTD        DIDATT
     C                   MOVE      TRSDFK        DITIMF
     C                   MOVE      TRSDTK        DITIMT
     C*                  MOVE      'E'           DISTA1
     C                   IF        *IN33
     C                   WRITE     DISPR
     C                   ELSE
     C                   UPDATE    DISPR
     C                   ENDIF
      *________________
      * WRITE TO FRISOK
      *""""""""""""""""
     C                   CLEAR                   FRISOKR
     C                   IF        XNYOPD = 'J'
     C                   Z-ADD     HEAVD         FSAVD
     C                   Z-ADD     HEOPD         FSOPD
     C                   MOVEL     'KRF'         FSKODE
     C                   MOVEL     C1004         FSSOK
     C     FSKODE        CHAIN     KODFRI                             33
     C  N33              MOVE      KFSODK        FSDOKK
     C   33              MOVE      *BLANKS       FSDOKK
     C                   WRITE     FRISOKR
      * legg ut fri søkevei EDS som samler(v/F13) 'Esendinger' fra aktuell avsender (avds kundenr)
     C                   MOVE      'EDS'         FSKODE
     C                   MOVE      *BLANKS       FSDOKK
     C                   MOVE      HEKNSF        AAKNFA            8
     C                   MOVE      HEDTOP        AADTOP            8
     C                   MOVE      HEPRO         GMTURA            8
     C                   MOVEL     HEHAWB        GMBILA            8
     C                   EVAL      FSSOK=AAKNFA+' '+AADTOP+' '+GMTURA+' '+GMBILA
     C     FSKODE        CHAIN     KODFRI                             33
     C  N33              MOVE      KFSODK        FSDOKK
     C   33              MOVE      *BLANKS       FSDOKK
     C                   WRITE     FRISOKR
     C                   END
      *
     C                   EXSR      SRLOGG
      *
     C     SLRTVDB       TAG
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * COM44                                               COM44 /
      *////////////////////////////////////////////////////////////
     C     COM44         BEGSR
     C                   MOVE      '0'           *IN54
     C                   Z-ADD     44            ZGN3
     C                   Z-ADD     CREP0         ZREPD0
     C                   Z-ADD     CREP1         ZREPD1
     C                   Z-ADD     CREP2         ZREPD2
     C     KEYMS3        SETLL     ECOM01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS3        READE     ECOM01B                                54
     C     *IN54         DOWEQ     '0'
      *
     C                   SELECT
     C                   WHEN      C3155 = 'EM'
     C                   EVAL      FE_C3148E = C3148
     C                   WHEN      C3155 = 'FX'
     C                   EVAL      FE_C3148C = C3148
     C                   WHEN      C3155 = 'TE'
     C                   EVAL      FE_C3148A = C3148
     C                   ENDSL
      *
     C     KEYMS3        READE     ECOM01B                                54
     C  N54              ENDDO
      *
     C                   ENDIF
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * CTA44                                               CTA44 /
      *////////////////////////////////////////////////////////////
     C     CTA44         BEGSR
     C                   MOVE      '0'           *IN53
     C                   Z-ADD     44            ZGN2
     C                   Z-ADD     NREP0         ZREPC0
     C                   Z-ADD     NREP1         ZREPC1
     C     KEYMS2        SETLL     ECTA01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS2        READE     ECTA01B                                53
     C     *IN53         DOWEQ     '0'
      *
     C                   EVAL      FE_DFAVD  = HEAVD
     C                   EVAL      FE_DFOPD  = HEOPD
     C                   EVAL      FE_DFFBNR = 1
     C                   EVAL      FE_N3035  = N3035
     C     DOKUFEK       CHAIN     DOKUFE                             33
     C                   EVAL      FE_C3413  = C3413
     C                   EVAL      FE_C3412  = C3412
     C                   EVAL      FE_C3148A = *BLANKS
     C*                  EVAL      FE_C3148B = *BLANKS
     C                   EVAL      FE_C3148C = *BLANKS
     C*                  EVAL      FE_C3148D = *BLANKS
     C                   EVAL      FE_C3148E = *BLANKS
     C*                  EVAL      FE_C3148F = *BLANKS
      *
     C                   EXSR      COM44
      *
     C  N33              UPDATE    DOKUFER
     C   33              WRITE     DOKUFER
      *
     C     KEYMS2        READE     ECTA01B                                53
     C  N53              ENDDO
      *
     C                   ENDIF
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * LOC20                                               LOC20 /
      *////////////////////////////////////////////////////////////
     C*    LOC20         BEGSR
     C*                  MOVE      '0'           *IN52
     C*                  Z-ADD     20            ZGN1
     C*    KEYMS1        SETLL     ELOC96A                                20
     C*    *IN20         IFEQ      '1'
     C*    KEYMS1        READE     ELOC96A                                52
     C*    *IN52         DOWEQ     '0'
      *
     C*    L3227         IFEQ      '1'
     C*                  MOVEL     L3224         HESDT
     C*                  MOVE      '1'           *IN52
     C*                  END
      *
     C*    KEYMS1        READE     ELOC96A                                52
     C* N52              ENDDO
     C*                  ENDIF
      *
     C*                  ENDSR
      *
      *////////////////////////////////////////////////////////////
      * TOD31                                               TOD31 /
      *////////////////////////////////////////////////////////////
     C     TOD31         BEGSR
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     31            ZGN1
     C     KEYMS1        SETLL     ETOD01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     ETOD01B                                52
     C     *IN52         IFEQ      '0'
      *
     C                   MOVEL     T4053         HEFR
      *
     C                   ENDIF
     C                   ENDIF
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * NAD43                                               NAD43 /
      *////////////////////////////////////////////////////////////
     C     NAD43         BEGSR
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     43            ZGN1
     C     KEYMS1        SETLL     ENAD01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     ENAD01B                                52
     C     *IN52         DOWEQ     '0'
      *
     C                   SELECT
     C     N3035         WHENEQ    'CN'                                         LEV.ADR
     C     N3124A        IFNE      *BLANKS
     C                   MOVEL     N3124A        HENAK
     C                   ENDIF
     C     N3124B        IFNE      *BLANKS
     C                   MOVEL     N3124B        HEADK1
     C                   ENDIF
     C     N3124C        IFNE      *BLANKS
     C                   MOVEL     N3124C        HEADK2
     C                   ENDIF
     C     N3124D        IFNE      *BLANKS
     C                   MOVEL     N3124D        HEADK3
     C                   ENDIF
     C     N3036A        IFNE      *BLANKS
     C                   MOVEL     N3036A        HENAK
     C                   ENDIF
     C     N3042A        IFNE      *BLANKS
     C                   MOVEL     N3042A        HEADK1
     C                   ENDIF
     C     N3251         IFNE      *BLANKS
     C*                  MOVEL     N3251         WEADS1            9
     C*                  MOVEL     N3164         WEADS2           21
     C*                  MOVEL     WEADS1        HEADK3
     C*                  MOVE      WEADS2        HEADK3
     C                   EVAL      HEADK3 = %TRIM(N3251) + ' ' + %TRIM(N3164)
     C*                  MOVEL     N3251         HESDVT
     C*                  MOVE      ' '           HESDVT
     C                   EVAL      HESDT = N3251
     C*                  MOVEL     'NO'          HELKK
     C                   EVAL      HETRI = N3207
     C                   ELSE
     C                   EVAL      HETRI = 'NO'
     C                   ENDIF
      * HENT COM
     C*                  Z-ADD     44            ZGN2
     C*                  Z-ADD     NREP0         ZREPC0
     C*                  Z-ADD     NREP1         ZREPC1
     C*    KEYMS2        CHAIN     ECOM01B                            53
     C*    *IN53         IFEQ      *OFF
     C*                  MOVEL     C3155         HEKDL
     C*    HEKDL         CAT       C3148:1       HEKDL
     C*                  ENDIF
      *
     C     N3035         WHENEQ    'CZ'                                         AVS.
     C     N3124A        IFNE      *BLANKS
     C                   MOVEL     N3124A        HENAS
     C                   ENDIF
     C     N3124B        IFNE      *BLANKS
     C                   MOVEL     N3124B        HEADS1
     C                   ENDIF
     C     N3124C        IFNE      *BLANKS
     C                   MOVEL     N3124C        HEADS2
     C                   ENDIF
     C     N3124D        IFNE      *BLANKS
     C                   MOVEL     N3124D        HEADS3
     C                   ENDIF
     C     N3036A        IFNE      *BLANKS
     C                   MOVEL     N3036A        HENAS
     C                   ENDIF
     C     N3042A        IFNE      *BLANKS
     C                   MOVEL     N3042A        HEADS1
     C                   ENDIF
     C     N3251         IFNE      *BLANKS
     C*                  MOVEL     N3251         WEADS1            9
     C*                  MOVEL     N3164         WEADS2           21
     C*                  MOVEL     WEADS1        HEADS3
     C*                  MOVE      WEADS2        HEADS3
     C                   EVAL      HEADS3 = %TRIM(N3251) + ' ' + %TRIM(N3164)
     C*                  MOVEL     N3251         HESDFF
     C*                  MOVE      ' '           HESDFF
     C                   EVAL      HESDF = N3251
     C                   ENDIF
     C     N3207         IFNE      *BLANKS
     C*                  MOVEL     N3207         HELKS
     C                   EVAL      HELKA = N3207
     C                   ENDIF
      *
     C                   ENDSL
      *
     C                   EXSR      CTA44
      *
     C     KEYMS1        READE     ENAD01B                                52
     C  N52              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * RFF32                                               RFF32 /
      *////////////////////////////////////////////////////////////
     C     RFF32         BEGSR
      *
     C                   EVAL      FSAVD = HEAVD
     C                   EVAL      FSOPD = HEOPD
     C                   EVAL      FSKODE = 'CU'
     C     FRISOKK       CHAIN     FRISOK                             33
     C                   EVAL      FSSOK  = U1004
     C                   IF        *IN33
     C                   WRITE     FRISOKR
     C                   ELSE
     C                   UPDATE    FRISOKR
     C                   END
      *
     C     1             DO        10            XN
     C                   IF        CD(XN) = *BLANKS
     C                   LEAVE
     C                   END
     C                   IF        CD(XN) <> 'CU'
     C                   EVAL      FSKODE = CD(XN)
     C     FRISOKK       CHAIN     FRISOK                             33
     C                   EVAL      FSSOK  = RF(XN)
     C     FSKODE        CHAIN     KODFRI                             34
     C  N34              MOVE      KFSODK        FSDOKK
     C   34              MOVE      *BLANKS       FSDOKK
     C                   IF        *IN33
     C                   WRITE     FRISOKR
     C                   ELSE
     C                   UPDATE    FRISOKR
     C                   END
     C                   END
     C                   ENDDO
      *
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     32            ZGN1
     C     KEYMS1        SETLL     ERFF01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     ERFF01B                                52
     C     *IN52         DOWEQ     '0'
      *
     C                   IF        R1153 <> 'CU'
     C                   EVAL      FSKODE = R1153
     C     FRISOKK       CHAIN     FRISOK                             33
     C                   EVAL      FSSOK  = R1154
     C     FSKODE        CHAIN     KODFRI                             34
     C  N34              MOVE      KFSODK        FSDOKK
     C   34              MOVE      *BLANKS       FSDOKK
     C                   IF        *IN33
     C                   WRITE     FRISOKR
     C                   ELSE
     C                   UPDATE    FRISOKR
     C                   END
     C                   END
      *
     C  N52KEYMS1        READE     ERFF01B                                52
     C  N52              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * CNT25                                               CNT25 /
      *////////////////////////////////////////////////////////////
     C     CNT25         BEGSR
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     25            ZGN1
     C     KEYMS1        SETLL     ECNT01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     ECNT01B                                52
     C     *IN52         DOWEQ     '0'
      *
     C                   MOVEA     C6066         A
     C                   EXSR      GETNUM
     C                   SELECT
     C                   WHEN      C6069 = '7' AND C6411 = 'KGM'
     C                   Z-ADD(H)  ZNUM          HEVKT
     C                   WHEN      C6069 = '57' AND C6411 = 'MTR'
     C                   Z-ADD(H)  ZNUM          HELM
     C                   WHEN      C6069 = '15' AND C6411 = 'MTQ'
     C                   Z-ADD(H)  ZNUM          HEM3
     C                   WHEN      C6069 = '11'
     C                   Z-ADD(H)  ZNUM          HENT
     C                   OTHER
     C                   ENDSL
      *
     C     KEYMS1        READE     ECNT01B                                52
     C  N52              ENDDO
     C                   ENDIF
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * DTM25                                               DTM25 /
      *////////////////////////////////////////////////////////////
     C     DTM25         BEGSR
     C     HEADFK        CHAIN     TRACKT                             33
     C                   IF        *IN33
     C                   CLEAR                   TRACKTR
     C                   EVAL      TXAVD = HEAVD
     C                   EVAL      TXOPD = HEOPD
     C                   END
     C                   EVAL      TTAVD = HEAVD
     C                   EVAL      TTOPD = HEOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
     C                   MOVE      ZUSER         TTUSER
     C                   EVAL      TTDEPO = 'E113R_01B'
     C                   EVAL      TTMANU = 'X'
     C                   MOVE      'N'           X_OPDETD          1
     C                   MOVE      'N'           X_OPDETA          1
     C     *LIKE         DEFINE    TTTEXT        ETD_TTTEXT
     C     *LIKE         DEFINE    TTTEXL        ETD_TTTEXL
     C     *LIKE         DEFINE    TTTEXT        ETA_TTTEXT
     C     *LIKE         DEFINE    TTTEXL        ETA_TTTEXL
      *
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     25            ZGN1
     C     KEYMS1        SETLL     EDTM01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     EDTM01B                                52
     C     *IN52         DOWEQ     '0'
      *
     C                   MOVEL     D2380         XAN12            12
     C                   MOVEL     XAN12         XAN08             8
     C                   MOVE      XAN12         XAN04             4
     C                   SELECT
     C                   WHEN      D2005 = '2' OR D2005 = '63' OR D2005 = '64'
     C                   MOVE      XAN08         TXETAD
     C                   MOVE      XAN04         TXETAK
     C                   EVAL      X_OPDETD = 'J'
     C                   EVAL      ETD_TTTEXL = 'ETA (' + %TRIM(D2380) + ') '
     C                             + 'er oppdatert av Kronos'
     C                   EVAL      ETD_TTTEXT = 'ETA (' + %TRIM(D2380) + ') '
     C                             + 'is updated by Kronos'
     C                   WHEN      D2005 = '10' OR D2005 = '234' OR
     C                             D2005 = '235'
     C                   MOVE      XAN08         TXETDD
     C                   MOVE      XAN04         TXETDK
     C                   EVAL      X_OPDETA = 'J'
     C                   EVAL      ETA_TTTEXL = 'ETD (' + %TRIM(D2380) + ') '
     C                             + 'er oppdatert av Kronos'
     C                   EVAL      ETA_TTTEXT = 'ETD (' + %TRIM(D2380) + ') '
     C                             + 'is updated by Kronos'
     C                   OTHER
     C                   ENDSL
      *
     C     KEYMS1        READE     EDTM01B                                52
     C  N52              ENDDO
     C                   ENDIF
      *
     C                   IF        *IN33
     C                   WRITE     TRACKTR
     C                   ELSE
     C                   UPDATE    TRACKTR
     C                   END
     C                   IF        X_OPDETD = 'J'
     C                   EVAL      TTACTI = 'ETD'
     C                   EVAL      TTTEXL = ETD_TTTEXL
     C                   EVAL      TTTEXT = ETD_TTTEXT
     C                   WRITE     TRACKFR
     C                   END
     C                   IF        X_OPDETA = 'J'
     C                   EVAL      TTACTI = 'ETA'
     C                   EVAL      TTTEXL = ETA_TTTEXL
     C                   EVAL      TTTEXT = ETA_TTTEXT
     C                   WRITE     TRACKFR
     C                   END
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * FTX25                                               FTX25 /
      *////////////////////////////////////////////////////////////
     C     FTX25         BEGSR
     C                   CLEAR                   FREETXTR
     C                   EVAL      FRTAVD = HEAVD
     C                   EVAL      FRTOPD = HEOPD
     C                   Z-ADD     MDT           FRTDT
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     25            ZGN1
     C     KEYMS1        SETLL     EFTX01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     EFTX01B                                52
     C     *IN52         DOWEQ     '0'
      *
     C     F4451         IFEQ      'DIN'
     C     F4451         OREQ      'HAN'
     C                   EVAL      XFT = F4440A
     C                   EXSR      SROPDFT
     C     F4440B        IFNE      *BLANKS
     C                   EVAL      XFT = F4440B
     C                   EXSR      SROPDFT
     C                   END
     C     F4440C        IFNE      *BLANKS
     C                   EVAL      XFT = F4440C
     C                   EXSR      SROPDFT
     C                   END
     C     F4440D        IFNE      *BLANKS
     C                   EVAL      XFT = F4440D
     C                   EXSR      SROPDFT
     C                   END
     C     F4440E        IFNE      *BLANKS
     C                   EVAL      XFT = F4440E
     C                   EXSR      SROPDFT
     C                   END
     C                   ENDIF
      *
     C  N52KEYMS1        READE     EFTX01B                                52
     C  N52              ENDDO
     C                   ENDIF
      * LEGG IN AVGANGSDATO I FITEKST
     C     W2380_F       IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     'AVG.DATO'    FRTTXT
     C     FRTTXT        CAT       W2380_F:1     FRTTXT
     C                   WRITE     FREETXTR
     C                   END
      * LEGG IN AVGANGSDATO I FITEKST
     C     W2380_T       IFNE      *BLANKS
     C                   ADD       1             FRTLI
     C                   MOVEL     'ANK.DATO'    FRTTXT
     C     FRTTXT        CAT       W2380_T:1     FRTTXT
     C                   WRITE     FREETXTR
     C                   END
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SROPDFT                                                   /
      *////////////////////////////////////////////////////////////
     C     SROPDFT       BEGSR
      *
     C     1             DO        7             XN                3 0
     C                   IF        FT(XN) <> *BLANKS
     C                   ADD       1             FRTLI
     C                   EVAL      FRTTXT = FT(XN)
     C                   WRITE     FREETXTR
     C                   END
     C                   ENDDO
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * GID50                                               GID50 /
      *////////////////////////////////////////////////////////////
     C     GID50         BEGSR
     C                   Z-ADD     0             FVANT
     C                   IF        HENT > 0
     C                   MOVE      'N'           XOPDKOLLI         1
     C                   ELSE
     C                   MOVE      'J'           XOPDKOLLI         1
     C                   END
      *
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     50            ZGN1
     C     KEYMS1        SETLL     EGID01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     EGID01B                                52
     C     *IN52         DOWEQ     '0'
      *
     C                   MOVEA     G7224A        A
     C                   EXSR      GETNUM
     C                   Z-ADD     ZNUM          FVANT
     C*    HENT          IFEQ      0
     C                   IF        XOPDKOLLI = 'J'
     C                   ADD       ZNUM          HENT
     C                   END
     C                   IF        G7065A <> *BLANKS
     C                   IF        HEVS1 = *BLANKS
     C                   EVAL      HEVS1 = G7065A
     C                   ELSE
     C                   EVAL      HEVS1 = %TRIM(HEVS1) + ' ' + %TRIM(G7065A)
     C                   ENDIF
     C                   END
      * HENT FTX
     C                   Z-ADD     50            ZGN2
     C                   Z-ADD     GREP0         ZREPC0
     C                   Z-ADD     GREP1         ZREPC1
     C     KEYMS2        CHAIN     EFTX01B                            53
     C  N53              IF        HEVS1 = *BLANKS
     C                   EVAL      HEVS1 = F4440A
     C                   ELSE
     C                   EVAL      HEVS1 = %TRIM(HEVS1) + ' ' + %TRIM(F4440A)
     C                   ENDIF
     C                   ADD       1             FRTLI
     C                   MOVEL(P)  G7224A        FRTTXT
     C     FRTTXT        CAT       G7064A:1      FRTTXT
      * HENT FTX
     C                   Z-ADD     50            ZGN2
     C                   Z-ADD     GREP0         ZREPC0
     C                   Z-ADD     GREP1         ZREPC1
     C     KEYMS2        CHAIN     EFTX01B                            53
     C     *IN53         IFEQ      *OFF
     C     FRTTXT        CAT       F4440A:1      FRTTXT
     C                   ENDIF
     C                   WRITE     FREETXTR
     C*                  ENDIF
      *
     C                   EXSR      MEA52
     C                   EXSR      PCI55
      *
     C     KEYMS1        READE     EGID01B                                52
     C                   ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * MEA52                                               MEA52 /
      *////////////////////////////////////////////////////////////
     C     MEA52         BEGSR
     C                   MOVE      '0'           *IN53
     C                   Z-ADD     52            ZGN2
     C                   Z-ADD     GREP1         ZREPC1
     C     KEYMS2        SETLL     EMEA01B                                20
     C     *IN20         IFEQ      '1'
      *
     C                   EVAL      FVST   = 'E'
     C                   EVAL      FVAVD  = HEAVD
     C                   EVAL      FVOPD  = HEOPD
     C                   EVAL      FVFBNR = 1
     C                   EVAL      FVLINR = FVLINR + 1
     C                   Z-ADD     50            ZGN2
     C     KEYMS2        CHAIN     EFTX01B                            33
     C                   IF        *IN33
     C                   EVAL      FVVT   = HEVS1
     C                   ELSE
     C                   EVAL      FVVT   = F4440A
     C                   ENDIF
     C                   Z-ADD     52            ZGN2
     C     KEYMS2        SETLL     EMEA01B                                20
      *
     C     KEYMS2        READE     EMEA01B                                53
     C     *IN53         DOWEQ     '0'
      *
     C                   MOVEA     M6314         A
     C                   EXSR      GETNUM
     C                   SELECT
     C                   WHEN      M6311 = 'WT' AND M6313 = 'AAE'
     C                   ADD       ZNUM          HEVKT
     C                   Z-ADD     ZNUM          FVVKT
     C                   WHEN      M6311 = 'LMT' AND M6411 = 'MTR'
E02  C                   ADD       ZNUM          HELM
     C                   Z-ADD     ZNUM          FVLM
     C                   WHEN      M6311 = 'VOL' AND M6411 = 'MTQ'
     C                   ADD       ZNUM          HEM3
     C                   Z-ADD     ZNUM          FVVOL
     C                   OTHER
     C                   ENDSL
      *
     C     KEYMS2        READE     EMEA01B                                53
     C  N53              ENDDO
      *
     C                   WRITE     DOKUFVR
      *
     C                   ENDIF
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * PCI55                                               PCI55 /
      *////////////////////////////////////////////////////////////
     C     PCI55         BEGSR
     C                   EVAL      FMST   = 'E'
     C                   EVAL      FMRI   = 'F'
     C                   EVAL      FMAVD  = HEAVD
     C                   EVAL      FMOPD  = HEOPD
     C                   EVAL      FMFBNR = 1
      *
     C                   MOVE      '0'           *IN53
     C                   Z-ADD     55            ZGN2
     C                   Z-ADD     GREP0         ZREPC0
     C                   Z-ADD     GREP1         ZREPC1
     C     KEYMS2        SETLL     EPCI01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS2        READE     EPCI01B                                53
     C     *IN53         DOWEQ     '0'
      *
      * HENT KOLLI-ID
     C                   EXSR      GIN55
      *
     C     KEYMS2        READE     EPCI01B                                53
     C                   ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * GIN55                                               GIN55 /
      *////////////////////////////////////////////////////////////
     C     GIN55         BEGSR
     C                   EVAL      FMLINR = FMLINR + 1
     C                   EVAL      FMMKNR = 0
      *
     C                   MOVE      '0'           *IN54
     C                   Z-ADD     55            ZGN3
     C                   Z-ADD     PREP0         ZREPD0
     C                   Z-ADD     PREP1         ZREPD1
     C                   Z-ADD     PREP2         ZREPD2
     C     KEYMS3        SETLL     EGIN01B                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS3        READE     EGIN01B                                54
     C     *IN54         DOWEQ     '0'
      *
     C                   SELECT
     C                   WHEN      G7402A <> *BLANKS
     C                   EVAL      FMMKNR = FMMKNR + 1
     C                   EVAL      FMMRK1 = G7402A
     C                   WRITE     DOKUFMR
     C                   WHEN      G7402B <> *BLANKS
     C                   EVAL      FMMKNR = FMMKNR + 1
     C                   EVAL      FMMRK1 = G7402B
     C                   WRITE     DOKUFMR
     C                   WHEN      G7402C <> *BLANKS
     C                   EVAL      FMMKNR = FMMKNR + 1
     C                   EVAL      FMMRK1 = G7402C
     C                   WRITE     DOKUFMR
     C                   WHEN      G7402D <> *BLANKS
     C                   EVAL      FMMKNR = FMMKNR + 1
     C                   EVAL      FMMRK1 = G7402D
     C                   WRITE     DOKUFMR
     C                   WHEN      G7402E <> *BLANKS
     C                   EVAL      FMMKNR = FMMKNR + 1
     C                   EVAL      FMMRK1 = G7402E
     C                   WRITE     DOKUFMR
     C                   WHEN      G7402F <> *BLANKS
     C                   EVAL      FMMKNR = FMMKNR + 1
     C                   EVAL      FMMRK1 = G7402F
     C                   WRITE     DOKUFMR
     C                   WHEN      G7402G <> *BLANKS
     C                   EVAL      FMMKNR = FMMKNR + 1
     C                   EVAL      FMMRK1 = G7402G
     C                   WRITE     DOKUFMR
     C                   WHEN      G7402H <> *BLANKS
     C                   EVAL      FMMKNR = FMMKNR + 1
     C                   EVAL      FMMRK1 = G7402H
     C                   WRITE     DOKUFMR
     C                   WHEN      G7402I <> *BLANKS
     C                   EVAL      FMMKNR = FMMKNR + 1
     C                   EVAL      FMMRK1 = G7402I
     C                   WRITE     DOKUFMR
     C                   WHEN      G7402J <> *BLANKS
     C                   EVAL      FMMKNR = FMMKNR + 1
     C                   EVAL      FMMRK1 = G7402J
     C                   WRITE     DOKUFMR
     C                   ENDSL
      *
     C     KEYMS3        READE     EGIN01B                                54
     C                   ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SRSLTOPD                                         SRSLTOPD /
      *////////////////////////////////////////////////////////////
     C     SRSLTOPD      BEGSR
      *
     C     HEADFK        CHAIN     HEADF                              51
     C                   IF        HEST = ' '
      * SJEKK MOT FAKTURALINJER
N01  c                   move      'W'           slette
     C                   CALL      'SYFA93B'
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    SLETTE            1
     C                   IF        SLETTE <> 'N'
     C                   EVAL      HEST  = 'S'
     C                   EVAL      HENAS = '*SLETTET*'
     C                   MOVE      'J'           HEPK3
     C                   END
     C                   UPDATE    HEADFR
     C                   IF        SLETTE <> 'N'
     C     HEADFK        CHAIN     DISP                               33
     C  N33              MOVE      'D'           DISTA1
     C  N33              UPDATE    DISPR
     C                   END
N03   *
N03  C                   IF        SLETTE <> 'N'
N03  C     HEADFK        SETLL     FRISOK
N03  C     HEADFK        READE     FRISOK                                 33
N03  C                   DOW       *IN33 = *OFF
N03  C                   MOVE      '*D'          FSSOK
N03  C                   UPDATE    FRISOKR
N03  C     HEADFK        READE     FRISOK                                 33
N03  C                   ENDDO
N03  C                   END
      *
     C                   ELSE
     C                   UPDATE    HEADFR
     C                   END
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SRSLT                                               SRSLT /
      *////////////////////////////////////////////////////////////
     C     SRSLT         BEGSR
      *
     C     DOKUFMK       SETLL     DOKUFM
     C     DOKUFMK       READE     DOKUFM                                 33
     C                   DOW       *IN33 = *OFF
     C*                  IF        FMST = 'E' AND FMFBNR = 1
     C                   IF        FMFBNR = 1
     C                   DELETE    DOKUFMR
     C                   ELSE
     C                   UPDATE    DOKUFMR
     C                   END
     C     DOKUFMK       READE     DOKUFM                                 33
     C                   ENDDO
     C                   EVAL      FMLINR = 0
      *
     C     DOKUFVK       SETLL     DOKUFV
     C     DOKUFVK       READE     DOKUFV                                 33
     C                   DOW       *IN33 = *OFF
     C*                  IF        FVST = 'E' AND FVFBNR = 1
     C                   IF        FVFBNR = 1
     C                   DELETE    DOKUFVR
     C                   ELSE
     C                   UPDATE    DOKUFVR
     C                   END
     C     DOKUFVK       READE     DOKUFV                                 33
     C                   ENDDO
     C                   EVAL      FVLINR = 0
      *
     C     HEADFK        SETLL     FRISOK
     C     HEADFK        READE     FRISOK                                 33
     C                   DOW       *IN33 = *OFF
     C                   IF        FSKODE = 'EDS' OR FSKODE = 'KRF'
     C                   UPDATE    FRISOKR
     C                   ELSE
     C                   DELETE    FRISOKR
     C                   END
     C     HEADFK        READE     FRISOK                                 33
     C                   ENDDO
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRLOGG        BEGSR
      ***********************************************
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
     C                   MOVE      ZUSER         TTUSER
     C                   IF        XNYOPD = 'J'
     C                   MOVE      'ED1'         TTACTI
     C                   eval      tttext='Incoming EDI prepared from sender'
     C                   eval      tttexl='Inkommende EDI klargjort av avsender'
     C                   eval      TTMANU=' '
     C                   WRITE     TRACKFR
     C                   MOVE      'ED2'         TTACTI
     C                   eval      tttext='Incoming EDI recieved'
     C                   eval      tttexl='Inkommende EDI er mottatt'
     C                   WRITE     TRACKFR
     C                   MOVE      'STR'         TTACTI
     C                   eval      tttext='Order entered by Kronos'
     C                   eval      tttexl='Ordre opprettet av Kronos'
     C                   eval      TTMANU='S'
     C                   ELSE
     C                   MOVE      'UPD'         TTACTI
     C                   eval      tttext='Order updated by Kronos'
     C                   eval      tttexl='Ordre oppdatert av Kronos'
     C                   eval      TTMANU='S'
     C                   END
     C                   WRITE     TRACKFR
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRLOGG2       BEGSR
      ***********************************************
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
     C                   MOVE      ZUSER         TTUSER
     C                   MOVE      'DEL'         TTACTI
     C                   eval      tttext='Order cancelled by Kronos'
     C                   eval      tttexl='Ordre slettet av Kronos'
     C                   eval      TTMANU=' '
     C                   WRITE     TRACKFR
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Get numerical value                               GETNUM /
      *////////////////////////////////////////////////////////////
     C     GETNUM        BEGSR
     C                   MOVE      *ZEROS        ZHEL
     C                   MOVE      *ZEROS        ZDEC
     C                   MOVE      *ZEROS        B
     C                   Z-ADD     1             AX                2 0
     C                   Z-ADD     1             BX                2 0
      * Get Integer
     C     A(AX)         DOWGE     '0'
     C     ZHEL          MULT      10            ZHEL
     C                   MOVE      A(AX)         ZHEL
     C                   ADD       1             AX
     C                   ENDDO
      * Decimal point ?
     C     A(AX)         IFEQ      '.'
     C     A(AX)         OREQ      ','
     C                   ADD       1             AX
     C     A(AX)         DOWGE     '0'
     C                   MOVE      A(AX)         B(BX)
     C                   ADD       1             AX
     C                   ADD       1             BX
     C                   ENDDO
     C                   MOVEA     B             ZDEC6
     C                   ENDIF
      * Concatenate
     C                   Z-ADD     ZHEL          ZNUM             18 6
     C                   ADD       ZDEC          ZNUM
     C                   ENDSR
**
LCL05                              00001000
