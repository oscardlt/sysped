     fSYTRG01F  o  a e             disk

     d                sds
     d  sxpgm            *proc
     d  dev                  244    253
     d  user                 254    263

     dparm_01          ds
     d  file                   1     10
     d  lib                   11     20
     d  mbr                   21     30
     d  trgevent              31     31
     ‚*     1=Add
     ‚*     2=Delete
     ‚*     3=Update
     d  trgtime               32     32
     ‚*     1=After Record Added/Deleted/Updated
     ‚*     2=Before Record Added/Deleted/Updated
     d  old_offset            49     52b 0
     d  new_offset            65     68b 0
     d  new_rcdlen            69     72b 0
     d  data                       8192

     dparm_02          ds
     d  buffer_len                    4b 0

     do_cundf        e ds                  extname(cundf)
     d                                     prefix(o_)

     dn_cundf        e ds                  extname(cundf)
     d                                     prefix(n_)
     ddelete           s                   like(trgevent) inz('2')
     dupdate           s                   like(trgevent) inz('3')

     ‚*_____________*
     ‚* Hovedlogikk *
     ‚*"""""""""""""*

     c     *entry        plist
     c                   parm                    parm_01
     c                   parm                    parm_02

      /free
       o_cundf = %subst(data: old_offset-71:
                          new_rcdlen);
       n_cundf = %subst(data: new_offset-71:
                          new_rcdlen);

       exsr skriv;

       *inlr = *on;

       //_______________________________________________
       // Skriv til loggfil                        SKRIV
       //"""""""""""""""""""""""""""""""""""""""""""""""
       begsr skriv;

         tlib  = lib;
         tfile = file;
         tmbr  = mbr;
         tdev  = dev;
         tuser = user;
         tevent = trgevent;
         tbefaft= trgtime;
         tdate = %char(%date() : *iso0);
         ttime = %char(%time() : *iso0);
         if trgevent=delete;
           firma  = o_firma;
           kundnr = o_kundnr;
           knavn  = o_knavn;
         else;
           firma  = n_firma;
           kundnr = n_kundnr;
           knavn  = n_knavn;
         endif;

         if trgevent=update;
           if o_cundf = n_cundf;
             tftx='No fields changed';
           else;

             if o_aktkod <> n_aktkod;
               tftx=%trim(tftx) +
               ' *AKTKOD from: ' + %trim(o_aktkod) +
               ' to: ' + %trim(n_aktkod);
             endif;

             if o_dkund <> n_dkund;
               tftx=%trim(tftx) +
               ' *DKUND from: ' + %trim(o_dkund) +
               ' to: ' + %trim(n_dkund);
             endif;

             if o_knavn <> n_knavn;
               tftx=%trim(tftx) +
               ' *KNAVN from: ' + %trim(o_knavn) +
               ' to: ' + %trim(n_knavn);
             endif;

             if o_adr1 <> n_adr1;
               tftx=%trim(tftx) +
               ' *ADR1 from: ' + %trim(o_adr1) +
               ' to: ' + %trim(n_adr1);
             endif;

             if o_adr2 <> n_adr2;
               tftx=%trim(tftx) +
               ' *ADR2 from: ' + %trim(o_adr2) +
               ' to: ' + %trim(n_adr2);
             endif;

             if o_postnr <> n_postnr;
               tftx=%trim(tftx) +
               ' *POSTNR from: ' + %trim(%char(o_postnr)) +
               ' to: ' + %trim(%char(n_postnr));
             endif;

             if o_adr3 <> n_adr3;
               tftx=%trim(tftx) +
               ' *ADR3 from: ' + %trim(o_adr3) +
               ' to: ' + %trim(n_adr3);
             endif;

             if o_kpers <> n_kpers;
               tftx=%trim(tftx) +
               ' *KPERS from: ' + %trim(o_kpers) +
               ' to: ' + %trim(n_kpers);
             endif;

             if o_tlf <> n_tlf;
               tftx=%trim(tftx) +
               ' *TLF from: ' + %trim(o_tlf) +
               ' to: ' + %trim(n_tlf);
             endif;

             if o_sonavn <> n_sonavn;
               tftx=%trim(tftx) +
               ' *SONAVN from: ' + %trim(o_sonavn) +
               ' to: ' + %trim(n_sonavn);
             endif;

             if o_valkod <> n_valkod;
               tftx=%trim(tftx) +
               ' *VALKOD from: ' + %trim(o_valkod) +
               ' to: ' + %trim(n_valkod);
             endif;

             if o_spraak <> n_spraak;
               tftx=%trim(tftx) +
               ' *SPRAAK from: ' + %trim(o_spraak) +
               ' to: ' + %trim(n_spraak);
             endif;

             if o_bankg <> n_bankg;
               tftx=%trim(tftx) +
               ' *BANKG from: ' + %trim(o_bankg) +
               ' to: ' + %trim(n_bankg);
             endif;

             if o_postg <> n_postg;
               tftx=%trim(tftx) +
               ' *POSTG from: ' + %trim(o_postg) +
               ' to: ' + %trim(n_postg);
             endif;

             if o_fmot <> n_fmot;
               tftx=%trim(tftx) +
               ' *FMOT from: ' + %trim(%char(o_fmot)) +
               ' to: ' + %trim(%char(n_fmot));
             endif;

             if o_betbet <> n_betbet;
               tftx=%trim(tftx) +
               ' *BETBET from: ' + %trim(o_betbet) +
               ' to: ' + %trim(n_betbet);
             endif;

             if o_betmat <> n_betmat;
               tftx=%trim(tftx) +
               ' *BETMAT from: ' + %trim(o_betmat) +
               ' to: ' + %trim(n_betmat);
             endif;

             if o_sfakt <> n_sfakt;
               tftx=%trim(tftx) +
               ' *SFAKT from: ' + %trim(o_sfakt) +
               ' to: ' + %trim(n_sfakt);
             endif;

             if o_kgrens <> n_kgrens;
               tftx=%trim(tftx) +
               ' *KGRENS from: ' + %trim(%char(o_kgrens)) +
               ' to: ' + %trim(%char(n_kgrens));
             endif;

             if o_tfaxnr <> n_tfaxnr;
               tftx=%trim(tftx) +
               ' *TFAXNR from: ' + %trim(o_tfaxnr) +
               ' to: ' + %trim(n_tfaxnr);
             endif;

             if o_syregn <> n_syregn;
               tftx=%trim(tftx) +
               ' *SYREGN from: ' + %trim(%char(o_syregn)) +
               ' to: ' + %trim(%char(n_syregn));
             endif;

             if tftx = *blanks;
             tftx='Record changed';
             endif;

           endif;
         endif;

         write sytrg01fr;

       endsr;
      /end-free
