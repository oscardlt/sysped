********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 SØK KUN EN KUNDE AV GANGEN
********************************************************************
      *
      *****************************************************************
      * PROGRAM SKAL SKRIVE UT FRAKTAVTALER (SJØ)                     *
      * INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER              *
      * LEDIGE INDIKATORER 01 02 05-26                                *
      * LEDIGE INDIKATORER 40-93                                      *
      *****************************************************************
      *
     FCUNDL01   IF   E           K DISK
     FSTED2     IF   E           K DISK
     FCDCON4    IF   E           K DISK
     FKODTOTY   IF   E           K DISK
     FHODE      IF   E           K DISK
     FCFRATFR1  IF   E           K DISK
     FCFRATTI1  IF   E           K DISK    RENAME(CFRATR:CFRATTR)
     FFIRM      IF   E           K DISK
E01  FSYYA12FM  CF   E             WORKSTN INFDS(FBAREA)
     FSYYA12PF  O    E             PRINTER OFLIND(*IN34)
N01  D FBAREA          DS
N01  D  WSCLOC               370    371B 0
N01  D  WSSUBN               378    379B 0
     D KD              S              2    DIM(99)
     D FT              S             30    DIM(99)
     D                 DS
     D  FIFT                   1     45
     D  FIFT40                 1     40
     D                 DS
     D  HOHT1                  1     80
     D  HOHT2                 81    160
     D  HOHT3                161    240
     D  HOHT4                241    320
     D  HOHT5                321    400
     D  HOHT6                401    480
     D  HOHT7                481    560
     D  HO                     1    560
     D                                     DIM(7)
     D                UDS
     D  UFIRM                  1      2
     D  UAVD                  15     18  0
      *
     C                   EXSR      INIT
      *
     C     START         TAG
     C                   EXFMT     BILDE
     C                   MOVEA     '0000'        *IN(96)
     C                   MOVEA     '00000000'    *IN(27)
      *
     C   03              GOTO      SLUTT
     C   04              DO
     C                   EXSR      SØKKUN
     C                   GOTO      START
     C                   END
      *
     C                   EXSR      TESTB
     C                   EXSR      PRINT
     C                   SETOFF                                       9930
     C                   MOVE      'N'           WSHEAD
     C                   GOTO      START
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
     C******************************************
     C     TESTB         BEGSR
     C******************************************
      *
      * TEST FRA OG TIL KUNDENR
     C     WSKNF         IFEQ      0
     C     WSKNT         COMP      0                                  9999
     C   99              MOVE      'SPK0018'     MSGNR
     C   99              SETON                                        30
     C   99              GOTO      SLTB
     C                   SETON                                        27
     C                   ELSE
     C     WSKNT         IFEQ      0
     C                   MOVE      WSKNF         WSKNT
     C                   ELSE
     C     WSKNT         COMP      WSKNF                                99
     C   99              MOVE      'SPK0019'     MSGNR
     C   99              SETON                                        30
     C   99              GOTO      SLTB
     C                   END
     C                   END
      *
      * TEST OM MAN SKAL HA UTENLANDSIDE I HEADING
     C     WSHEAD        COMP      'J'                                    38
     C                   SETOFF                                       39
      *
      * TEST FRA-STED
     C     WSSDF         IFNE      *BLANKS
     C     WSSDF         CHAIN     STED2                              97
     C   97              MOVE      'SPS0012'     MSGNR
     C   97              SETON                                        30
     C   97              GOTO      SLTB
     C                   SETON                                        29
     C                   END
      *
      * TEST TIL-STED
     C     WSSDT         IFNE      *BLANKS
     C     WSSDT         CHAIN     STED2                              96
     C   96              MOVE      'SPS0013'     MSGNR
     C   96              SETON                                        30
     C   96              GOTO      SLTB
     C                   SETON                                        31
     C                   END
     C*
     C     SLTB          ENDSR
     C*
     C***********************************************
     C     PRINT         BEGSR
     C***********************************************
     C                   MOVE      'DIV0782'     MSGNR
     C                   MOVE      *ZEROS        XSIDE
     C                   SETOFF                                       94
      *
      *  27 - FRA KUNDENUMMER = 0
      *       TIL KUNDENUMMER = 0
      *  29 - FRA STED UTFYLT
      *  31 - TIL STED UTFYLT
      *  38 - WSHEAD = J
      *  39 - KJØR IMPORT/EXPORT RUTINE MED MOTSATTE TEKSTER
      *
      *  FRA ALLE STEDER / TIL ALLE STEDER
      *
     C  N29
     CANN31              DO
     C     WSHEAD        IFEQ      'J'
     C                   SETOFF                                       35
     C                   SETON                                        39        * SPESIAL
     C                   EXSR      PRTIM                                        * EXPORT
     C                   EXSR      PRTEX                                        * IMPORT
     C                   ELSE                                                   <WSHEAD
     C                   SETOFF                                       35
     C                   SETOFF                                       39
     C                   EXSR      PRTEX                                        * EXPORT
     C                   EXSR      PRTIM                                        * IMPORT
     C                   END                                                    <WSHEAD
     C                   SETON                                        35
     C                   SETOFF                                       39
     C                   EXSR      PRTIM                                        * INNLAND
     C                   EXSR      PRTEX                                        * UTLAND
     C                   END
      *
      *  FRA ALLE STEDER / TIL VALGT STED
      *
     C  N29
     CAN 31              DO
     C     WSSDT         CHAIN     STED2                              99
     C     ST2LK         IFEQ      FILAND
     C     WSHEAD        IFEQ      'J'
     C                   SETOFF                                       35
     C                   SETON                                        39        * SPESIAL
     C                   EXSR      PRTEX                                        * IMPORT
     C                   ELSE
     C                   SETOFF                                       35
     C                   SETOFF                                       39
     C                   EXSR      PRTIM                                        * IMPORT
     C                   END                                                    <WSHEAD
     C                   SETON                                        35
     C                   SETOFF                                       39
     C                   EXSR      PRTIM                                        * INNLAND
     C                   ELSE
     C     WSHEAD        IFEQ      'J'
     C                   SETOFF                                       35
     C                   SETON                                        39        * SPESIAL
     C                   EXSR      PRTIM                                        * EXPORT
     C                   ELSE
     C                   SETOFF                                       35
     C                   SETOFF                                       39
     C                   EXSR      PRTEX                                        * EXPORT
     C                   END                                                    <WSHEAD
     C                   SETON                                        35
     C                   SETOFF                                       39
     C                   EXSR      PRTEX                                        * UTLAND
     C                   END
     C                   END
      *
      *  FRA VALGT STED / TIL ALLE STEDER
      *
     C   29
     CANN31              DO
     C     WSSDF         CHAIN     STED2                              99
     C     ST2LK         IFEQ      FILAND
     C     WSHEAD        IFEQ      'J'
     C                   SETOFF                                       35
     C                   SETON                                        39        * SPESIAL
     C                   EXSR      PRTIM                                        * EXPORT
     C                   ELSE
     C                   SETOFF                                       35
     C                   SETOFF                                       39
     C                   EXSR      PRTEX                                        * EXPORT
     C                   END                                                    <WSHEAD
     C                   SETON                                        35
     C                   SETOFF                                       39
     C                   EXSR      PRTIM                                        * INNLAND
     C                   ELSE
     C     WSHEAD        IFEQ      'J'
     C                   SETOFF                                       35
     C                   SETON                                        39        * SPESIAL
     C                   EXSR      PRTEX                                        * IMPORT
     C                   ELSE
     C                   SETOFF                                       35
     C                   SETOFF                                       39
     C                   EXSR      PRTIM                                        * IMPORT
     C                   END                                                    <WSHEAD
     C                   SETON                                        35
     C                   SETOFF                                       39
     C                   EXSR      PRTEX                                        * UTLAND
     C                   END
     C                   END
      *
      *  FRA VALGT STED / TIL VALGT STED
      *
     C   29
     CAN 31              DO
     C     WSSDF         CHAIN     STED2                              99
     C     ST2LK         IFEQ      FILAND
     C     WSSDT         CHAIN     STED2                              99
     C     ST2LK         IFEQ      FILAND
     C                   SETON                                        35
     C                   SETOFF                                       39
     C                   EXSR      PRTIM                                        * INNLAND
     C                   ELSE
     C     WSHEAD        IFEQ      'J'
     C                   SETOFF                                       35
     C                   SETON                                        39        * SPESIAL
     C                   EXSR      PRTIM                                        * EXPORT
     C                   ELSE                                                   <WSHEAD
     C                   SETOFF                                       35
     C                   SETOFF                                       39
     C                   EXSR      PRTEX                                        * EXPORT
     C                   END                                                    <WSHEAD
     C                   SETOFF                                       39
     C                   END
     C                   ELSE
     C     WSSDT         CHAIN     STED2                              99
     C     ST2LK         IFEQ      FILAND
     C     WSHEAD        IFEQ      'J'
     C                   SETOFF                                       35
     C                   SETON                                        39        * SPESIAL
     C                   EXSR      PRTEX                                        * IMPORT
     C                   ELSE                                                   <WSHEAD
     C                   SETOFF                                       35
     C                   SETOFF                                       39
     C                   EXSR      PRTIM                                        * IMPORT
     C                   END                                                    <WSHEAD
     C                   ELSE
     C                   SETON                                        35
     C                   SETOFF                                       39
     C                   EXSR      PRTEX                                        * UTLAND
     C                   END
     C                   END
     C                   END
      *
     C   94              MOVE      'DIV0781'     MSGNR
      *
     C                   ENDSR
      *
     C***********************************************
     C     PRTEX         BEGSR
     C***********************************************
     C                   MOVE      *ZEROS        XKN               8 0
     C                   MOVE      *ZEROS        XN                3 0
     C                   MOVE      *BLANKS       KD
     C                   MOVE      *BLANKS       FT
      *
     C     FRATFK        SETLL     CFRATFR1
      *
     C     STPRE         TAG
     C                   READ      CFRATFR1                               30
     C  N30
     CAN 27FTKNR         COMP      0                                  30
     C  N30
     CANN27WSKNT         COMP      FTKNR                                30
     C  N30
     CANN27
     CAN 29WSSDF         COMP      FTFRA                              3030
     C  N30
     CANN27
     CAN 31WSSDT         COMP      FTTIL                              3737
     C  N30
     CAN 31
     CAN 37              GOTO      STPRE
     C   30              GOTO      SLPRE
      *
      *   SELEKTER OPPDRAGSTYPE
      *
     C     WSOPDT        IFNE      *BLANKS
     C     WSOPDT        ANDNE     FTOPDT
     C                   GOTO      STPRE
     C                   END                                                    <WSOPDT
      *
     C     *IN39         IFEQ      '1'
     C     FTFRA         CHAIN     STED2                              99
     C  N99
     CANN35ST2LK         COMP      FILAND                                 99
     C  N99
     CAN 35ST2LK         COMP      FILAND                             9999
     C   99              GOTO      STPRE
     C                   MOVE      ST2LK         XLKF              2
     C     FTTIL         CHAIN     STED2                              99
     C  N99ST2LK         COMP      FILAND                             9999
     C   99              GOTO      STPRE
     C                   ELSE                                                   <*IN39
      *
     C     FTFRA         CHAIN     STED2                              99
     C  N99
     CANN35ST2LK         COMP      FILAND                             9999
     C  N99
     CAN 35ST2LK         COMP      FILAND                                 99
     C   99              GOTO      STPRE
     C                   MOVE      ST2LK         XLKF
     C     FTTIL         CHAIN     STED2                              99
     C  N99ST2LK         COMP      FILAND                                 99
     C   99              GOTO      STPRE
     C                   END                                                    <*IN39
     C                   MOVE      ST2LK         XLKT              2
     C     WSLK          IFNE      *BLANKS                                      *LANDKODE GITT
     C     WSLK          ANDNE     XLKF                                         *MEN ULIK FRA
     C     WSLK          ANDNE     XLKT                                         *OG ULIK TILKODE
     C                   GOTO      STPRE
     C                   END
     C                   SETON                                        94
      *
     C  N27FTKNR         IFNE      XKN
     C     XN            CASGT     0             PRTOT
     C                   ENDCS
     C                   MOVE      FTKNR         XKN
     C                   MOVE      *BLANKS       XSTF              5
     C     KUND1K        CHAIN     CUNDL01                            33
     C                   MOVE      '1'           *IN34
     C                   END
      *
     C     FTFRA         IFNE      XSTF
     C     XN            CASGT     0             PRTOT
     C                   ENDCS
     C                   MOVE      FTFRA         XSTF
     C     FTFRA         CHAIN     STED2                              33
     C                   MOVE      ST2NVN        XSTFRA
     C                   MOVE      '1'           *IN34
     C                   END
      *
     C     FTTIL         CHAIN     STED2                              33
     C                   MOVEL     ST2NVN        XSTT20
     C     FTTYPE        CHAIN     CDCON4                             33
     C     *IN34         IFEQ      '1'
     C                   ADD       1             XSIDE
     C                   WRITE     EXHEAD
     C                   MOVE      '0'           *IN34
     C                   END
     C                   WRITE     EXDET1
      *
     C                   EXSR      GETOT
      *
     C                   GOTO      STPRE
      *
     C     SLPRE         TAG
     C     XN            CASGT     0             PRTOT
     C                   ENDCS
      *
     C                   ENDSR
      *
     C***********************************************
     C     PRTIM         BEGSR
     C***********************************************
     C                   MOVE      *ZEROS        XKN               8 0
     C                   MOVE      *ZEROS        XN                3 0
     C                   MOVE      *BLANKS       KD
     C                   MOVE      *BLANKS       FT
      *
     C     FRATTK        SETLL     CFRATTI1
      *
     C     STPRI         TAG
     C                   READ      CFRATTI1                               30
     C  N30
     CAN 27FTKNR         COMP      0                                  30
     C  N30
     CANN27WSKNT         COMP      FTKNR                                30
     C  N30
     CANN27
     CAN 31WSSDT         COMP      FTTIL                              3030
     C  N30
     CANN27
     CAN 29WSSDF         COMP      FTFRA                              3737
     C  N30
     CAN 29
     CAN 37              GOTO      STPRI
     C   30              GOTO      SLPRI
      *
      *   SELEKTER OPPDRAGSTYPE
      *
     C     WSOPDT        IFNE      *BLANKS
     C     WSOPDT        ANDNE     FTOPDT
     C                   GOTO      STPRI
     C                   END                                                    <WSOPDT
      *
     C     *IN39         IFEQ      '1'
     C     FTTIL         CHAIN     STED2                              99
     C  N99ST2LK         COMP      FILAND                                 99
     C   99              GOTO      STPRI
     C                   MOVE      ST2LK         XLKT
     C     FTFRA         CHAIN     STED2                              99
     C  N99
     CANN35ST2LK         COMP      FILAND                             9999
     C  N99
     CAN 35ST2LK         COMP      FILAND                                 99
     C   99              GOTO      STPRI
     C                   ELSE                                                   <*IN39D
     C     FTTIL         CHAIN     STED2                              99
     C  N99ST2LK         COMP      FILAND                             9999
     C   99              GOTO      STPRI
     C                   MOVE      ST2LK         XLKT
     C     FTFRA         CHAIN     STED2                              99
     C  N99
     CANN35ST2LK         COMP      FILAND                                 99
     C  N99
     CAN 35ST2LK         COMP      FILAND                             9999
     C   99              GOTO      STPRI
     C                   END                                                    <*IN39
     C                   MOVE      ST2LK         XLKF
     C     WSLK          IFNE      *BLANKS                                      *LANDKODE GITT
     C     WSLK          ANDNE     XLKF                                         *MEN ULIK FRA
     C     WSLK          ANDNE     XLKT                                         *OG ULIK TILKODE
     C                   GOTO      STPRI
     C                   END
     C                   SETON                                        94
      *
     C  N27FTKNR         IFNE      XKN
     C     XN            CASGT     0             PRTOT
     C                   ENDCS
     C                   MOVE      FTKNR         XKN
     C                   MOVE      *BLANKS       XSTT              5
     C     KUND1K        CHAIN     CUNDL01                            33
     C                   MOVE      '1'           *IN34
     C                   END
     C     FTTIL         IFNE      XSTT
     C     XN            CASGT     0             PRTOT
     C                   ENDCS
     C                   MOVE      FTTIL         XSTT
     C     FTTIL         CHAIN     STED2                              33
     C                   MOVE      ST2NVN        XSTTIL
     C                   MOVE      '1'           *IN34
     C                   END
      *
     C     FTFRA         CHAIN     STED2                              33
     C                   MOVEL     ST2NVN        XSTF20
     C     FTTYPE        CHAIN     CDCON4                             33
     C     *IN34         IFEQ      '1'
     C                   ADD       1             XSIDE
     C                   WRITE     IMHEAD
     C                   MOVE      '0'           *IN34
     C                   END
     C                   WRITE     IMDET1
      *
     C                   EXSR      GETOT
      *
     C                   GOTO      STPRI
      *
     C     SLPRI         TAG
     C     XN            CASGT     0             PRTOT
     C                   ENDCS
      *
     C                   ENDSR
      *
     C***********************************************
     C     GETOT         BEGSR
     C***********************************************
     C     XN            IFNE      0
     C     1             DO        XN            XN2               3 0
     C     KD(XN2)       IFEQ      FTOPDT
     C                   GOTO      SLGET
     C                   END
     C                   END
     C                   END
     C     KODOTK        CHAIN     KODTOTY                            33
     C                   ADD       1             XN
     C                   MOVE      FTOPDT        KD(XN)
     C                   MOVEL     '='           FT(XN)
     C                   MOVE      KO1NTX        FT(XN)
      *
     C     SLGET         ENDSR
      *
     C***********************************************
     C     PRTOT         BEGSR
     C***********************************************
     C                   MOVE      *ZEROS        XN2
     C                   MOVE      '0'           *IN28
     C     XN2           DOWLE     XN
     C                   ADD       1             XN2
     C                   MOVE      KD(XN2)       OTKD1
     C                   MOVE      FT(XN2)       OTFT1
     C                   ADD       1             XN2
     C                   MOVE      KD(XN2)       OTKD2
     C                   MOVE      FT(XN2)       OTFT2
     C     *IN34         IFEQ      '1'
     C                   ADD       1             XSIDE
     C                   WRITE     EXHEAD
     C                   MOVE      '0'           *IN34
     C                   END
     C                   WRITE     OTDESC
     C                   MOVE      '1'           *IN28
     C                   END
      *
     C                   MOVE      *BLANKS       KD
     C                   MOVE      *BLANKS       FT
     C                   MOVE      *ZEROS        XN
      *
     C                   ENDSR
      *
     C***********************************************
     C     SØKKUN        BEGSR
     C***********************************************
S01  C*                  CALL      'SOEKUN'
S01  C*                  PARM                    UFIRM
S01  C*                  PARM                    SOANTK
S01  C*                  PARM                    SOTXT1
S01  C*                  PARM                    WSKNF
S01  C*                  PARM                    SOTXT2
S01  C*                  PARM                    WSKNT
S01  C*                  PARM                    SOTXT3
S01  C*                  PARM                    SOKNR3
S01  C*                  PARM                    SOTXT4
S01  C*                  PARM                    SOKNR4
S01  C*                  PARM                    SOTXT5
S01  C*                  PARM                    SOKNR5
S01  C*                  PARM                    SOTXT6
S01  C*                  PARM                    SOKNR6
S01  C*                  PARM                    SOTXT7
S01  C*                  PARM                    SOKNR7
S01  C*                  PARM                    SOTXT8
S01  C*                  PARM                    SOKNR8
N01   *
N01  C     WSCLOC        DIV       256           LINNBR
N01  C                   MVR                     POSNBR
N01   *
N01  C     LINNBR        IFEQ      5
N01  C     POSNBR        ANDGE     18
N01  C     POSNBR        ANDLE     25
N01  C                   MOVE      *BLANKS       UKNAVN           30
N01  C                   CALL      'SOEKKUN'
N01  C                   PARM                    WSKNT
N01  C                   PARM                    FIFIRM
N01  C                   PARM                    UKNAVN
N01  C                   Z-ADD     7             POSNBR
N01  C                   Z-ADD     18            POSNBR
N01  C                   END
N01   *
N01  C     LINNBR        IFEQ      4
N01  C     POSNBR        ANDGE     18
N01  C     POSNBR        ANDLE     25
N01  C                   MOVE      *BLANKS       UKNAVN           30
N01  C                   CALL      'SOEKKUN'
N01  C                   PARM                    WSKNF
N01  C                   PARM                    FIFIRM
N01  C                   PARM                    UKNAVN
N01  C                   Z-ADD     5             POSNBR
N01  C                   Z-ADD     18            POSNBR
N01  C                   END
     C*
     C                   ENDSR
     C*
     C******************************************
     C     INIT          BEGSR
     C******************************************
     C     KODOTK        KLIST
     C                   KFLD                    YOTUNI
     C                   KFLD                    FTOPDT
     C     FRATFK        KLIST
     C                   KFLD                    WSKNF
     C                   KFLD                    WSSDF
     C     FRATTK        KLIST
     C                   KFLD                    WSKNF
     C                   KFLD                    WSSDT
     C     KUND1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    FTKNR
     C     HODEK         KLIST
     C                   KFLD                    YNET
     C                   KFLD                    UAVD
      *
     C                   MOVE      'OTY'         YOTUNI            3
     C                   MOVE      *BLANKS       YNET              1
     C                   MOVE      'DIV0000'     MSGNR
     C                   MOVE      'N'           WSHEAD
      *
S01  C*                  Z-ADD     2             SOANTK            1 0
S01  C*                  MOVE      *BLANKS       SOTXT3            8
S01  C*                  MOVE      *BLANKS       SOTXT4            8
S01  C*                  MOVE      *BLANKS       SOTXT5            8
S01  C*                  MOVE      *BLANKS       SOTXT6            8
S01  C*                  MOVE      *BLANKS       SOTXT7            8
S01  C*                  MOVE      *BLANKS       SOTXT8            8
S01  C*                  MOVE      *ZEROS        SOKNR3            8 0
S01  C*                  MOVE      *ZEROS        SOKNR4            8 0
S01  C*                  MOVE      *ZEROS        SOKNR5            8 0
S01  C*                  MOVE      *ZEROS        SOKNR6            8 0
S01  C*                  MOVE      *ZEROS        SOKNR7            8 0
S01  C*                  MOVE      *ZEROS        SOKNR8            8 0
S01  C*
S01  C*                  EXSR      HMSG
      *
     C     UFIRM         CHAIN     FIRM                               99
      *
     C                   MOVE      *BLANKS       HO
     C     HODEK         CHAIN     HODE                               99
      *
     C                   ENDSR
      *
S01  C***********************************************
S01  C*    HMSG          BEGSR
S01  C***********************************************
S01  C*                  MOVE      'DIV0779'     XMSGNR            7            MELDING-ID
S01  C*                  EXSR      HMSG2
S01  C*                  MOVEL     XMSG          SOTXT1            8
S01  C*                  MOVE      'DIV0780'     XMSGNR
S01  C*                  EXSR      HMSG2
S01  C*                  MOVEL     XMSG          SOTXT2            8
S01  C*
S01  C*                  ENDSR
S01  C*
S01  C***********************************************
S01  C*    HMSG2         BEGSR
S01  C***********************************************
S01  C*                  Z-ADD     3             XLEVEL            1 0          NIVÅ
S01  C*                  Z-ADD     0             XRETUR            1 0          RETURKODE
S01  C*                  Z-ADD     132           XMSGL             4 0          LENGDE PÅ MELDING
S01  C*                  CALL      'SUBR23R3'
S01  C*                  PARM                    XMSGNR
S01  C*                  PARM                    XMSG            132
S01  C*                  PARM                    XLEVEL
S01  C*                  PARM                    XRETUR
S01  C*                  PARM                    XMSGL
S01  C*
S01  C*                  ENDSR
S01  C*
