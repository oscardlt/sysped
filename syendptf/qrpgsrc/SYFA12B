********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 FRITEKST PRINTES EN LINJE AV GANGEN
10XXX * 02 jov PTF10 sikre key (user)p brparf
10XXX * 03 YBC PTF10 HENT FIRMAKODE
10XXX * 04 JOV PTF10 overlay hentes nå i CL / FRALIG BRUK AV IND 51
10XXX * 05 YBC PTF10 SKRIV UT TOLLPASS FRAKTBREV
      * 06 JOV PTF10 DIGIT OR SIGN.. DFPNLS
      * 07 JOV PTF10 endring ved Betaler   Sender/mottaker/Annen
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11XXX * 08 YBC PTF11 SLETT GAMMEL FRAKTBREV OG LAG NYTT
      * 09 JOV PTF11 Rekomp - printerfilendring - BRINGTMS-prosjekt.
      * 10 JOV PTF11 setter 75 ON = print m dobbel linjeavstand (r38) - minimum av endringer
      *%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
12039 * 11 JOV Endret R37 - 12B har pr nå ennå ikke linjer / LXBXH men DS mm er klargj som i ..12
12039 * 12 JOV Feil i PTF34 / justerer for å få på plass STOOOR volum
12XXX * 13 YBC PTF12 RETT FEIL PÅ ENDRING 08
12XXX * 14 YBC PTF12 Behold gammel fr.brevnr (rett enndring 8)
12XXX * 15 YBC PTF12 Skriv også klokke i rub. 17 utst.dato(finne siste ved flere fysisk printede)
12XXX * 16 jov PTF12 varelinjer innført - OBS hele GETVL byttet med den fra syfa12/tilpasset
      *    Venter med godsmerke (må også fisa syfa12sn(mm) som forvente kun CLIFD i ZOKUFM
12XXX * 17 YBC PTF12 AVSENDERS ADR-3 TREFFER OPPDRAGSREF.
********************************************************************
      ************************************************** *************
      * UTSKRIFT AV FRAKTBREV fra ZEADF (WEB)
      **************************************************************
      *
     FZEADL02   IF   E           K DISK
S08  F*ZRISOL01  IF A E           K DISK
N08  FZRISOL01  UF A E           K DISK
S07  F*ODTFR    IF   E           K DISK
N07  FCUNDL01   IF   E           K DISK
     Fzreetxt1  IF   E           K DISK
N16  FZOKUFV1   IF   E           K DISK
N16  FZOKUFVF1  IF   E           K DISK
N16  FADRUNNRF  IF   E           K DISK
     FBRPARF    IF   E           K DISK
N03  FFIRM      IF   E           K DISK
     FSYFA12P   O    E             PRINTER
      *Array for fjerning av foranstilte 0 i tallverdi
     D NUM             S              1    DIM(9)
     D MERKNA          C                   CONST('M E R K N A D E R:')
N17  D                 DS
N17  D  DFAD3S                 1     30
N17  D  DFAD3S26               1     26
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
N15  D  XULTM4                 1      4  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D  XULDDMM                7     10  0
     D  XULÅÅ2                13     14  0
     D                 DS
     D  PDATDD                 1      2  0
     D  PDATMM                 3      4  0
     D  PDATÅÅ                 5      6  0
     D  PDATE1                 1      6  0
S01  D*WSMTxt          S            700
S01  D*WSTTxt          S            700
N01  D                 DS
N01  D  WSMTXT                 1    700
N01  D  WMT                    1    700    DIM(10)
N01  D                 DS
N01  D  WSTTXT                 1    700
N01  D  WTT                    1    700    DIM(10)
      *Array for fri-tekster
     D                 DS
     D  TEXT                   1    700
     D  TX                     1    700    DIM(700)
     D                 DS
     D  FTX                    1     70
     D  FT                     1     70    DIM(70)
     D Wpos            s              4  0
     D Gmpos           s              4  0
     D BLF             s              4  0
N16  D DFGM            s             12
N16  D DFGM2           s             12
N16  D DFLM            s              4  2
N16  D DFM3            s              7  3
N16  D DFNT            s              7  0
N16  D DFVKT           s              9  0
N16  D DFVKTF          s              9  0
N16  D DFVS            s             25
N16  D DFVS2           s             25
N16  D MaxLin          s              3  0
N16  D AntADRlin       s              3  0
N16   *TMP - FFINDX  må inn i ZOKUFVF
N16  D FFINDX          s              1
     D Tst700          s            700
N04  D                 DS
N04  D  DFBREF                 1     17
N04  D  DFBREFX                1     17
N04  D                 DS
N04  D  DFSREF                 1     17
N04  D  DFSREFX                1     17
N11   * klargjort for varelinjer med LxBxH
N11  D                 DS
N11  D DSLBH                   1     18
N11  D  DSLEN                  1      4
N11  D  oxx1                   6      6    inz('x')
N11  D  DSBRD                  7     10
N11  D  oxx2                  12     12    inz('x')
N11  D  DSHOY                 13     16
N11  D  oxx3                  17     18    inz('Cm')
N11  D                 DS
N11  D DSDM3LM                 1     18
E12  D  DSDM3                  1      7
E12  D  DSDMTX                 8     10
N11  D  DSLM                  11     15
E12  D  DSLMTX                16     17
N11   * standalone wrkfelt
s12  D* TmpDm3                        5S 0
N12  D  TmpDm3                        7S 0
      * Definere  hex 0D / 25 (CRLF)
     D Hex0D           c                   x'0D'
     D Hex25           c                   x'25'
N08  D UCMD            DS          1024
      *
      *
     C                   EXSR      INIT
     C                   EXSR      HOVED
      *
     C                   SETON                                        LR
     C                   RETURN
      *
      ******************************************
     C     HOVED         BEGSR
      ******************************************
      *
     C     UUUNIK        CHAIN     ZEADL02                            33
      *
     C                   MOVEL     HENAS         DFNAVS
     C                   MOVEL     HEADS1        DFAD1S
S06  C*                  MOVEL     HEADS3        DFPNLS
N06  C                   MOVEL     HEADS3        TMPPUL            4
N06  C                   TESTN                   TMPPUL               34
N06  C     *IN34         IFEQ      '1'
N06  C                   MOVE      TMPPUL        DFPNLS
N06  C                   end
     C                   MOVE      HEADS3        TMPAD325         25
     C                   MOVEL     TMPAD325      DFAD3S
     C                   MOVEL     HENAK         DFNAVM
     C                   MOVEL     HEADK1        DFAD1M
     C                   MOVEL     HEADK3        DFAD3M
     C                   MOVEL     HENAK         DFNAVL
     C                   MOVEL     HEADK1        DFAD1L
     C                   MOVE      *ZEROS        DFPOUL                          UTL.POSTNR
     C                   MOVEL     HEADK3        TMPPUL            4
     C                   TESTN                   TMPPUL               34
     C     *IN34         IFEQ      '1'
     C                   MOVE      TMPPUL        DFPOUL                          UTL.POSTNR
     C                   MOVE      HEADK3        TMPAD325         25
     C                   MOVEL     TMPAD325      DFADUL
     C                   else
     C                   MOVEL     HEADK3        DFADUL
     C                   end
S07   *
S07   *    Belastningskode utfra CC/PP på frankatur
S07  C*    KODFRK        CHAIN     KODTFR                             33
S07  C*                  SELECT
S07  C*    KFRCP         WHENEQ    'PP'
S07  C*    KFRCP         OREQ      'S '
S07  C*                  MOVEL     'S'           DFBELA            1
S07  C*    KFRCP         WHENEQ    'CC'
S07  C*    KFRCP         OREQ      'M '
S07  C*                  MOVEL     'M'           DFBELA
S07  C*                  OTHER
S07  C*                  MOVEL     'S'           DFBELA
S07  C*                  END
      * KODE FOR BETALER SETTES ETTER REELL BETALER, SENDER / MOTTAKER (ELLER ANNEN)
N07  C     HEKNSF        IFNE      *ZEROS
N07  C                   MOVEL     'S'           DFBELA            1
N07  C     HEKNSF        IFNE      HEKNS
N07  C                   MOVEL     'A'           DFBELA
N07  C                   MOVE      HEKNSF        KUNDNR
N07  C                   EXSR      GetAnnen
N07  C                   ENDIF
N07  C                   ELSE
N07  C                   MOVEL     'M'           DFBELA
N07  C     HEKNKF        IFNE      HEKNK
N07  C                   MOVEL     'A'           DFBELA
N07  C                   MOVE      HEKNKF        KUNDNR
N07  C                   EXSR      GetAnnen
N07  C                   ENDIF
N07  C                   ENDIF
      *Belastes: 46 ON=Sender, 47 ON=Mottaker 48 ON=Annen
     C     DFBELA        COMP      'S'                                    46
     C     DFBELA        COMP      'M'                                    47
     C     DFBELA        COMP      'A'                                    48
      *
      * AREF=SENDERS REF
     C                   MOVEL     HERFA         DFSREF
N16  C                   MOVEL     HERFK         DFMREF
N16  C                   EVAL      DFGM   = HEGM1
N16  C                   EVAL      DFGM2  = HEGM2
N16  C                   EVAL      DFNT   = HENT
N16  C                   EVAL      DFVS   = HEVS1
N16  C                   EVAL      DFVS2  = HEVS2
N16  C                   EVAL      DFVKT  = HEVKT
N16  C                   EVAL      DFM3   = HEM3
N16  C                   EVAL      DFLM   = HELM
N16  C                   EVAL      DFVKTF = HEFBV
      *
      * Finnes sendingsnr - HVIS IKKE, TILDEL
     C                   MOVE      *BLANKS       WSSN17
     C                   MOVE      *BLANKS       USTMF
     C                   MOVEL     HEFILE        PABRID
     c     HEUNIK        setll     Zrisol01
     c     HEUNIK        Reade     Zrisol01                               33
     c     *in33         doweq     '0'
     C                   SELECT
     C                   WHEN      FSKODE = 'IFB'
S13  c*                  movel     FSSOK         WSSN17
S14  c*                  DELETE    FRISOKR
N14  c                   movel     FSSOK         WSSN17
     C                   WHEN      ((FSKODE = '#VD') AND
     C                              (FSSOK = 'Fraktbrev.pdf'))
     C     BrParKey      CHAIN     BRPARF                             33
     C     *in33         ifeq      '1'
S03  c*                  eval      PABRID='*KUNDFT*SY'
N03  C                   eval      PABRID = '*KUNDFT*' + %TRIM(FIFIRM)
     C     BrParKey      CHAIN     BRPARF                             33
     c                   end
     C                   EVAL      USTMF = PAVRDA
     C                   MOVEL     FSUNIK        XAN09             9
     C                   CAT       XAN09:0       USTMF
     C                   CAT       FSDOKK:0      USTMF
     C                   CAT       FSSOK:0       USTMF
N08  c                   DELETE    FRISOKR
N08  c                   OTHER
N08  c                   UPDATE    FRISOKR
     c                   end
     c     HEUNIK        Reade     Zrisol01                               33
     c                   end
N08  C                   IF        USTMF <> *BLANKS
N08  C                   BITON     '123457'      WAPSTR            1
N08  C                   BITOFF    '06'          WAPSTR
N08  C                   Z-ADD     1024          UCMDL            15 5
N08  C                   EVAL      UCMD = 'RMVLNK OBJLNK(' + WAPSTR
N08  C                             + %TRIM(USTMF) + WAPSTR + ')'
N08  C                   CALL      'QCMDEXC'                            33
N08  C                   PARM                    UCMD
N08  C                   PARM                    UCMDL
N08  C                   EVAL      USTMF = *BLANKS
N08  C                   END
      *
     C                   SELECT
     C                   WHEN      ((WSSN17 <> *BLANKS) AND (USTMF <> *BLANKS))
     C                   GOTO      FbnrOK
     C                   WHEN      WSSN17 <> *BLANKS
     C                   MOVE      HEAVD         FSAVD
     C                   MOVE      HEOPD         FSOPD
     C                   MOVE      HEUNIK        FSUNIK
     C                   MOVE      HEREFF        FSREFF
     C                   MOVE      HEOPD         FSOPD
     C                   GOTO      FbnrOK1
     C                   ENDSL
      *
     C                   call      'SYGE15'
     c                   parm                    sndnr20          20
     c                   move      sndnr20       WSSN17           17
     c                   move      HEAVD         FSAVD
     c                   move      HEOPD         FSOPD
     c                   move      'IFB'         FSKODE
     C                   MOVE      *BLANKS       FSSOK
     C                   MOVEL     WSSN17        FSSOK
     c                   move      HEDTOP        FSDTOP
     c                   move      *BLANKS       FSDOKK
     c                   move      HEUNIK        FSUNIK
     c                   move      HEREFF        FSREFF
     C                   write     FRISOKR
      *
     C     FbnrOK1       TAG
N02  C                   MOVEL     HEFILE        PABRID
     C     BrParKey      CHAIN     BRPARF                             33
     C     *in33         ifeq      '1'
S03  c*                  eval      PABRID='*KUNDFT*SY'
N03  C                   eval      PABRID = '*KUNDFT*' + %TRIM(FIFIRM)
     C     BrParKey      CHAIN     BRPARF                             33
     c                   end
     C                   CALL      'ARCRAN'
     C                   PARM                    NEWRAN           10
     C                   EVAL      FSDOKK = NEWRAN
     C                   EVAL      FSSOK = 'Fraktbrev.pdf'
     C                   MOVE      '#VD'         FSKODE
     C                   WRITE     FRISOKR
     C                   EVAL      USTMF = PAVRDA
     C                   MOVEL     FSUNIK        XAN09             9
     C                   CAT       XAN09:0       USTMF
     C                   CAT       NEWRAN:0      USTMF
     C                   CAT       FSSOK:0       USTMF
      *
     C     FbnrOK        TAG
     C                   MOVEL     '401'         WSSN20
     C                   MOVE      WSSN17        WSSN20
      *
      * SKRIV FRAKTBREVET (51 = forminsket formuler som i fax/mail..)
N04  c                   seton                                        51
     C                   WRITE     FAXLAY
      * Skriv varelinjer (ant/vekt...) + FRITEKST
     C                   EXSR      GETVL
      *
s04  C**                 MOVEL     'FB1'         OVL03             3
s04  C**                 MOVEL     OVL03         FB01
s04  C**                 write     ovl
      *
     C                   ENDSR
      *
      *
N07   ******************************************
N07  C     GETANNEN      BEGSR
N07   ******************************************
N07   *
N07  C     KUND1K        CHAIN     CUNDL01                            33
N07  C     *in33         IFEQ      *off
N07  C                   MOVE      KNAVN         DFNAVX           30
N07  C                   MOVE      ADR1          DFAD1X           30
N07  C                   MOVE      ADR2          DFAD2X           30
N07  C                   MOVEL     POSTNR        DFAD3X           30
N07  C                   MOVE      ADR3          DFAD3X
N07  C                   END
N07  C                   ENDSR
      *
N16   ******************************************
N16  C     GETVL         BEGSR
N16   ******************************************
N16   * DFVKTA er vekt i hjelpevariabel/alfa for å  dynamisk i linje 111 ved lang R38/ADR
N16  C                   move      *blanks       DFVKTFA           9
N16   * LINJE holde rede på hvor en står ETTER siste write
N16  C                   Z-ADD     61            LINJE             3 0
N16   * 75 ON  = Normal - skriver på annenhver linje - og med 12 LPI blir det da som før (max 32)
N16   * 75 OFF = Fortettet - skriver på hver linje - og med 12 LPI blir det da dobbelt så mange
N16  C                   exsr      TSTR38
N16  C*                  eval      *in75 = *off
N16  C*                  eval      *in75 = *on
N16   * 34 ON = SKRIV HIGHLIGHTET BUNNTOTAL (HVIS LINJER ER SKREVET)
N16  C                   MOVE      *OFF          *IN34
N16   * SJEKK OM DET ER MER ENN XX  LINJER
N16  C                   MOVE      *ZEROS        X2                3 0
N16  C     HEUNIK        SETLL     ZOKUFV1                            33
N16  C     HEUNIK        READE     ZOKUFV1                                33
N16  C     *IN33         DOWEQ     '0'
N16  C                   ADD       1             X2
N16  C   75X2            CABGT     15            UTGVL                          Normal
N16  C  N75X2            CABGT     30            UTGVL                          Linjedobling
N16  C     HEUNIK        READE     ZOKUFV1                                33
N16  C                   END
N16   * Ved 0 eller 1 linje (= skapt automatisk ved f10), ikke skriv linjer
N16  C     X2            CABEQ     0             UTGVL
N16   *
N16   * DET FANTES LINJER OG DET ER PLASS TIL Å SKRIVE DETALJERT....
N16  C     HEUNIK        SETLL     ZOKUFV1                            33
N16  C     STGVL         TAG
N16  C     HEUNIK        READE     ZOKUFV1                                33
N16  C     *IN33         DOWEQ     '0'
N16  C*                  Z-ADD     1             FMMKNR
N16  C*                  Z-ADD     1             FMLONR
N16  C*    DOKUFMKEY     CHAIN     DOKUFM                             33
N16  C*    *IN33         IFEQ      '0'
N16  C*                  MOVEL     FMMRK1        R33MRK
N16  C*                  ELSE
N16  C                   MOVE      *BLANKS       R33MRK
N16  C*                  END
N16  C                   Z-ADD     FVANT         R34ANT
N16  C                   eval      R35VSL = %trim(FVPAKN)+' '+FVVT
N16  C                   Z-ADD     FVVKT         R36VKT
N16  c                   eval      R37TXT = *blanks
N16  c                   if        FVlen <> 0
N16  C                   eval      DSLEN = %trimr(%editc(FVLEN:'Z'))
N16  C                   eval      DSBRD = %trimr(%editc(FVBRD:'Z'))
N16  C                   eval      DSHOY = %trimr(%editc(FVHOY:'Z'))
N16  c                   eval      R37TXT= DSLBH
N16  c                   else
N16  c                   eval      DSDM3LM= *blanks
N16  c                   if        FVVOL <> 0
N16  c                   eval      TmpDm3= FVVOL*1000
N16  C                   eval      DSDM3 = %trimr(%editc(TmpDm3:'Z'))
N16  C                   eval      DSDMTX = 'dm3'
N16  c                   endif
N16  c                   if        FVLM  <> 0
N16  C                   eval      DSLM  = %trimr(%editw(FVLM:'0 ,  '))
N16  C                   eval      DSLMTX= 'Lm'
N16  c                   endif
N16  c                   eval      R37TXT= DSDM3LM
N16  c                   endif
N16  C   75              ADD       1             LINJE
N16  C   75              WRITE     BLANKLIN
N16  C                   ADD       1             LINJE
N16  C                   WRITE     VARELIP
N16  C     HEUNIK        READE     ZOKUFV1                                33
N16  C                   END
N16   * SKRIV STREK / HIGHLIGHT BUNNTOTAL
N16  C   75              ADD       1             LINJE
N16  C   75              WRITE     BLANKLIN
N16  C                   ADD       1             LINJE
N16  C                   WRITE     VARELIU
N16  C                   MOVE      *ON           *IN34
N16   *
N16  C     UTGVL         TAG
N16   * Skriv TOTALER hentet fra selve fraktbrevet
N16  C                   MOVEL     DFGM          R33MRK
N16  C                   Z-ADD     DFNT          R34ANT
N16  C                   EVAL      R35VSL = DFVS
N16  C                   Z-ADD     DFVKT         R36VKT
N16  c                   eval      DSDM3LM= *blanks
N16  c                   eval      R37TXT = *blanks
N16  c                   if        DFM3  <> 0
N16  c                   eval      TmpDm3= DFM3*1000
N16  C                   eval      DSDM3 = %trimr(%editc(TmpDm3:'Z'))
N16  C                   eval      DSDMTX= 'dm3'
N16  c                   endif
N16  c                   if        DFLM  <> 0
N16  C                   eval      DSLM  = %trimr(%editw(DFLM:'0 ,  '))
N16  C                   eval      DSLMTX= 'Lm'
N16  c                   endif
N16  c                   eval      R37TXT= DSDM3LM
N16  c*
N16  C   75              ADD       1             LINJE
N16  C   75              WRITE     BLANKLIN
N16  C                   ADD       1             LINJE
N16  C                   WRITE     VARELIP
N16   *
N16  C                   MOVE      *ZEROS        R34ANT
N16  C                   MOVE      *ZEROS        R36VKT
N16  c                   eval      R37TXT = *blanks
N16  C     DFGM2         IFNE      *BLANKS
N16  C     DFVS2         ORNE      *BLANKS
N16  C                   MOVEL     DFGM2         R33MRK
N16  C                   EVAL      R35VSL = DFVS2
N16  C   75              ADD       1             LINJE
N16  C   75              WRITE     BLANKLIN
N16  C                   ADD       1             LINJE
N16  C                   WRITE     VARELIP
N16  C                   END
N16   *
      *
      * POSISJONER TIL RUBR 38
     C     LINJE         DOWLT     76
     C   75              ADD       1             LINJE
     C   75              WRITE     BLANKLIN
     C                   ADD       1             LINJE
     C                   WRITE     BLANKLIN
     C                   END
      * Linjer i rubr R38,  HENT FRA ZREETXT
     C                   exsr      FixFreeTxt
      *
N24   * evt linjeadr på slutten.....
N24  c     124           sub       AntAdrlin     MaxLin            3 0
      *
N24  c                   if        AntADRlin > 0
N24  c                   move      'J'           PrintAdr          1
N24  c                   move      *zeros        AntADRlin         3 0
N24  c                   EXSR      ADRLIN
N24  c                   endif
      *
     C                   ENDSR
      *
      *
      *=====================================================================******
      * Fix freetekst
      *=====================================================================******
     C     FixFreeTxt    begsr
N01  C                   Z-ADD     0             XNMT              3 0
N01  C                   Z-ADD     0             XNTT              3 0
      * Hent Fritekst til samlet streng max 700 lang
     C     UUUNIK        SETLL     Zreetxt1
     C     UUUNIK        Reade     Zreetxt1                               33
     C     *in33         doweq     '0'
     c     frtkod        IFEQ      'R'
S01  c*                  cat       FRTTXT:0      WSMTXT
N01  C                   IF        XNMT < 10
N01  C                   ADD       1             XNMT
N01  C                   MOVE      FRTTXT        WMT(XNMT)
N01  C                   END
     c                   end
     c     frtkod        IFEQ      'G'
S01  c*                  cat       FRTTXT:0      WSTTXT
N01  C                   IF        XNTT < 10
N01  C                   ADD       1             XNTT
N01  C                   MOVE      FRTTXT        WTT(XNTT)
N01  C                   END
     c                   end
     C     UUUNIK        Reade     Zreetxt1                               33
     c                   end
      *
     c                   movel     Hex0D         CrLf              2
     c                   move      Hex25         CrLf
      * Melding til mottaker....
     c     WSMtxt        Ifne      *blanks
N10  C   75              ADD       1             LINJE
N10  C   75              WRITE     BLANKLIN
     C                   ADD       1             LINJE
     c                   eval      D29TXT = 'Melding til mottaker:'
     C                   WRITE     R38LIN
     c                   moveA     WSMTXT        TX
     c                   exsr      SkrivFrt
     c                   end
      * Melding til Transportør.
     c     WSTtxt        Ifne      *blanks
N10  C   75              ADD       1             LINJE
N10  C   75              WRITE     BLANKLIN
     C                   ADD       1             LINJE
     C                   WRITE     BLANKLIN
     C                   ADD       1             LINJE
     c                   eval      D29TXT = 'Melding til transportør:'
     C                   WRITE     R38LIN
     c                   moveA     WSTTXT        TX
     c                   exsr      SkrivFrt
     c                   end
     c                   endsr
      *=====================================================================******
      * Skriv freetekst
      *=====================================================================******
     C     SkrivFrt      begsr
     C                   z-add     1             GMPOS
     C                   z-add     1             WPOS
      * Neste linje er fram til neste CR/LF eller max 70 tegn
     c     NextCRLF      Tag
S04  C*    CRLF          SCAN      TEXT:GMPOS    WPOS                     51
N04  C     CRLF          SCAN      TEXT:GMPOS    WPOS                     41
      * fant ikke flere CRLF, resten blank? Hopp ut / ellers lagre 70+70.
S04  C*    *IN51         IFEQ      *OFF
N04  C     *IN41         IFEQ      *OFF
     c                   MOVE      *BLANKS       TST700
     c                   movea     TX(GMpos)     TST700
     C     TST700        CABEQ     *BLANKS       UTSKRIV
     c                   z-add     9999          Wpos
     c                   end
      *
      * Lagre uansett fra og med start.sted
     C                   MOVEA     TX(GMPOS)     FT
      * Finn lengde på siste streng(max 70) - blank resten (fra lengde +1)
     C                   EVAL      BLF = WPOS - GMPOS + 1
     C     BLF           IFGT      70
      *(41 OFF. skal IKKE hoppe over CRLF før neste linje.)
S04  C*                  MOVE      *OFF          *IN51
N04  C                   MOVE      *OFF          *IN41
     C                   eval      wpos = GMPOS +70
     c                   end
     C     BLF           IFge      1
     C     BLF           andle     70
     C                   MOVEA     *BLANKS       FT(BLF)
     C                   END
      *
      * Skriv til rubr 38...
N10  C   75              ADD       1             LINJE
N10  C   75              WRITE     BLANKLIN
     c                   Movea     FT            D29TXT
     C                   ADD       1             LINJE
S10  C*    LINJE         CABGT     60            Utskriv
S10  C*    LINJE         IFGT      51
N10  C     LINJE         CABGT     124           Utskriv
N10  C     LINJE         IFGT      108
     C                   MOVE      BLANK20       D29TXT
     C                   END
     C                   WRITE     R38LIN
      *
      * Finn neste start-posisjon (HVIS CRLF - hopp pver)
     C                   Z-add     WPOS          GMPOS
s04  C*    *IN51         IFEQ      *ON
N04  C     *IN41         IFEQ      *ON
     C                   ADD       2             GMPOS
     C                   END
     C     GMPOS         CABLE     700           NEXTCRLF
     C
      *
     c     UtSKRIV       endsr
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
      *
     C     *ENTRY        PLIST
     C                   PARM                    UUUNIKA           9
     C                   PARM                    USTMF            50
N05  C                   PARM                    UTOLLP            1
N05  C     UTOLLP        COMP      'T'                                    50
     C                   MOVE      UUUNIKA       UUUNIK            9 0
      *
S07  C*    KODFRK        KLIST
S07  C*                  KFLD                    KFRUNI
S07  C*                  KFLD                    HEFR
S07  C*                  MOVE      'FR'          KFRUNI
N07  C     KUND1K        KLIST
N07  C                   KFLD                    FIFIRM
N07  C                   KFLD                    KUNDNR
N16  C     UnNrKeyF      KLIST
N16  C                   KFLD                    FFUNNR
N16  C                   KFLD                    FFEMBG
N16  C                   KFLD                    FFINDX
     C     BrParKey      KLIST
     C                   KFLD                    PABRID
     C                   KFLD                    PAKUNR
     C                   KFLD                    PAID
     C                   MOVE      *ZEROS        PAKUNR
     C                   MOVE      'OLBAN'       PAID
      *
     C                   MOVE      *BLANKS       BLANK20          20
N17  C                   MOVE      *BLANKS       DFAD3S
      * HENT DATO/KLOKKESLETT Utstedelsesdato
     C                   TIME                    XULTID
     C                   MOVE      XULDD         PDATDD
     C                   MOVE      XULMM         PDATMM
     C                   MOVE      XULÅÅ2        PDATÅÅ
N15  C                   MOVE      *blanks       PTIME             5
N15  c                   eval      PTIME=%editw(XULTM4:'  :  ')
N03   *
N03  C     *LOVAL        SETLL     FIRM
N03  C                   READ      FIRM                                   33
      *
     C                   ENDSR
N16   ******************************************
N16  C     TSTR38        BEGSR
N16   ******************************************
N16   * Sjekk volum i Rubr 38 - 75 ON=Lite/nomal skriftstørrelse  , 75 OFF=Mye/linjedobling
N16  C                   MOVE      *on           *in75
N16  c                   move      *zeros        AntLin            3 0
N24   * Farlig-gods.(skrives uansett med linjedobling, plassbehov er tilnærmet div 2 + 2 )
N24  c                   move      'N'           PrintAdr
N24  c                   move      *zeros        AntADRlin
N24  c                   EXSR      ADRLIN
N24  c                   if        AntAdrlin > 1
N24  c                   eval      AntAdrlin = (AntAdrlin/2)+2                  ikke presist men..
N24  c                   add       AntADRlin     AntLin
N24  c                   endif
N16   *
N16   *
N16  C     endTstVl      ENDSR
N24   ******************************************
N24  C     ADRLIN        BEGSR
N24   ******************************************
N24  c                   move      *blanks       FFANTKA           5
N33  c*                  move      *blanks       FFANTEA           7
N33  c                   move      *blanks       FFANTEA          11
N24  c                   move      *blanks       UNbesk1          21
N24  c                   move      *blanks       MerkeCont        12
N24   *
N24   * Hvis PrinMode - skriveloop til en kommer til startpunkt for ADR-linjer
N24  c                   if        PrintAdr <>'N'
N24  c     LINJE         dowlt     Maxlin
N24  C                   ADD       1             LINJE
N29  C     LINJE         IFEQ      111
N29  C                   eval      DFVKTFA = %trimr(%editc(DFVKT:'Z'))
N29  C                   else
N29  C                   eval      DFVKTFA = *blanks
N29  C                   endif
N24  C                   WRITE     BLANKLIN
N24  c                   enddo
N24  c                   endif
N24   *
N24   * Når PrintAdr = 'N' er det kun sjekk for å finne ant linjer det er behov for..
N24  C     HEUNIK        SETLL     ZOKUFVF1
N24  C     HEUNIK        READE     ZOKUFVF1                               33
N24  C     *in33         DOWEQ     '0'
N24  C     UnNrKeyF      chain     ADRUNNRF                           33
N24   * kontroll...
N24  c                   if        PrintAdr = 'N'
N24  c                   if        AntADRlin= 0                                 Først,head(2)+Oversk
N24  c                   add       3             AntADRlin
N24  c                   endif
N24  c                   add       1             AntADRlin                      Hovedlinja m 21 txt
N24  c                   if        %subst(ADTEXT:22)<>*blanks
N24  c                   add       1             AntADRlin                      extra pga mer enn 21
N24  c                   endif
N24  c                   if        %subst(ADTEXT:103)<>*blanks
N24  c                   add       1             AntADRlin                      extra pga mer enn102
N24  c                   endif
N24  c                   else
N24   *Print..
N24  C                   Z-ADD     FFLINR        FVLINR
N24  C*                  Z-ADD     1             FMMKNR
N24  C*                  Z-ADD     1             FMLONR
N24  C*    DOKUFMKEY     CHAIN     DOKUFM                             33
N24  C* N33              MOVEL     FMMRK1        MerkeCont
N24  c                   if        AntADRlin= 0                                 Først?head(2)+Oversk
N24  C                   ADD       1             LINJE
N24  C                   WRITE     BLANKLIN
N24  C                   ADD       1             LINJE
N24  C                   WRITE     R38FARH                                      FARLIG-header
N24  c                   eval      FARLTXT='UnNr Beskrivesle.......... '        Kolonne-overskrift
N24  c                             +'Klas FareSeddel EmGr TunellRest '
S33  c*                            +'Ant.K Mengde Enh Cont-ID'
N33  c                             +'Ant.K Mengde     Enh Cont-ID'
N24  C                   ADD       1             LINJE
N24  c                   add       1             AntADRlin
N24  C                   WRITE     R38FARL
N24  c                   endif
N24   * .. Lin 1 (besk 1-20)
N24  c                   eval      FFANTKA = %trimr(%editc(FFANTK:'Z'))
S33  c*                  eval      FFANTEA = %trimr(%editc(FFANTE:'Z'))
N33  c                   eval      FFANTEA =
N33  c                                   %trimr(%editw(FFANTE:'     0 ,   '))
N24  c                   eval      UNbesk1 = %subst(ADTEXT:1:21)                21 første tegn...
N24  c                   eval      FARLTXT= ADUNNR+' '+UNBESK1+' '+FFKLAS+' '
N24  c                             +FFSEDD+' '+FFEMBG+'  '+FFTRES+' '+FFANTKA
N24  c                             +FFANTEA+' '+FFENH+' '+MerkeCont
N24  C                   ADD       1             LINJE
N24  c                   add       1             AntADRlin
N24  C                   WRITE     R38FARL
N24   * .. Ekstra  pga lang tekst (besk 22-102)
N24  c                   if        %subst(ADTEXT:21)<>*blanks
N24  c                   eval      FARLTXT='     '+ %subst(ADTEXT:22:83)
N24  C                   ADD       1             LINJE
N24  c                   add       1             AntADRlin
N24  C                   WRITE     R38FARL
N24  c                   endif
N24   * .. Ekstra  pga lang tekst (besk 103-150)
N24  c                   if        %subst(ADTEXT:103)<>*blanks
N24  c                   eval      FARLTXT='     '+ %subst(ADTEXT:103)
N24  C                   ADD       1             LINJE
N24  c                   add       1             AntADRlin
N24  C                   WRITE     R38FARL
N24  c                   endif
N24  c                   endif
N24  C     HEUNIK        READE     ZOKUFVF1                               33
N24  C  N33              ENDDO
N24  C                   ENDSR
