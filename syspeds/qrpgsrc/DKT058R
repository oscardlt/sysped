     FDKT058D   CF   E             WORKSTN
     F                                     SFILE(DKT058DB:ZRECNO)
     FDKTSE     IF   E           K DISK
     FDKTSE1    UF A E           K DISK
     F                                     RENAME(DKTSER:DKTSER1)
     FFIRM      IF   E             DISK
     FCUNDL01   IF   E           K DISK
      *_________________
      * DS for constants
      *"""""""""""""""""
     D                 DS
     D  WTXT01                 1     40    INZ('(No codes match the -
     D                                     subsetting criteria)')
      *//////////////
      *  Main logic /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   EVAL      *INLR=*ON
      *////////////////////////////////////////////////////////////
      *  INZ                                                  SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *__________________
      * Define Workfields
      *""""""""""""""""""
     C     *LIKE         DEFINE    ZRECNO        WRECNO
      *_____________
      * Define key's
      *"""""""""""""
     C     KEYA          KLIST
     C                   KFLD                    WKSE_KNR
     C     KEYB          KLIST
     C                   KFLD                    WKSE_KNR
     C                   KFLD                    DKSE_331
     C                   KFLD                    DKSE_34
     C                   KFLD                    DKSE_4421
     C                   KFLD                    DKSE_442A
     C     KEYC          KLIST
     C                   KFLD                    WKSE_KNR
     C                   KFLD                    ZKSE_331
     C                   KFLD                    ZKSE_34
     C                   KFLD                    ZKSE_4421
     C                   KFLD                    ZKSE_442A
     C     CUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WKSE_KNR
      * Les firmarecord
     C                   READ      FIRM
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Calculate formats                                    SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
      *___________
      * Select tag
      *"""""""""""
     C     SRB0          TAG

     C                   EXSR      SRBA
     C     *IN03         CABEQ     '1'           SRB9
     C     *IN12         CABEQ     '1'           SRB9

     C     SRB1          TAG
     C*                  ENDIF
      *______________
      * Clear Subfile
      *""""""""""""""
     C                   MOVE      '1'           *IN93
     C                   WRITE     DKT058DC
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZERO         ZRECNO
     C                   Z-ADD     *ZERO         WRECNO
      *_____________
      * Fill Subfile
      *"""""""""""""
     C     KEYA          SETLL     DKTSE
     C     KEYA          READE(N)  DKTSE                                  94
     C     *IN94         IFEQ      '1'
     C                   MOVE      '1'           *IN41
     C                   ADD       1             ZRECNO
     C                   Z-ADD     ZRECNO        WRECNO
     C                   CLEAR                   DKT058DB
     C                   WRITE     DKT058DB
     C                   GOTO      SRB3
     C                   ENDIF
      *
     C     SRB2          TAG
     C                   Z-ADD     WRECNO        ZRECNO
      *
     C     *IN94         DOWEQ     *OFF
     C                   MOVE      '0'           *IN41
     C                   ADD       1             ZRECNO
     C                   Z-ADD     ZRECNO        WRECNO
     C                   WRITE     DKT058DB
     C     KEYA          READE(N)  DKTSE                                  94
     C  N94              ENDDO
     C                   EVAL      ZRECNO=1
      *______
      * Enter
      *""""""
     C     SRB3          TAG
      *
     C                   MOVEA     '11'          *IN(91)
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     DKT058DF
     C                   WRITE     DKT058DØ
     C                   WRITE     DKT058DD
     C                   EXFMT     DKT058DC
      *
      *________
      * F3=Exit
      *""""""""
     C     *IN03         CABEQ     '1'           SRB9
      *___________
      * F12=Cancel
      *"""""""""""
     C     *IN12         IFEQ      '1'
     C                   GOTO      SRB0
     C                   ENDIF
      *
     C                   MOVEA     '00'          *IN(91)
      *_______
      * ROLLUP
      *"""""""
     C     *IN25         IFEQ      '1'
     C                   MOVE      '0'           *IN25
     C                   GOTO      SRB2
     C                   ENDIF
      *___________
      * F5=Refresh
      *"""""""""""
     C     *IN05         CABEQ     '1'           SRB1
      *__________
      * F6=Create
      *""""""""""
     C     *IN06         IFEQ      '1'
     C                   EXSR      SRBF
     C     *IN03         CABEQ     '1'           SRB9
     C                   GOTO      SRB3
     C                   ENDIF
      *_________
      * Option ?
      *"""""""""
     C                   MOVE      '0'           *IN52
     C                   MOVE      '0'           *IN05
     C     *IN52         DOWEQ     '0'
      *
     C                   READC     DKT058DB                               52
     C     *IN52         IFEQ      '0'
     C     ZOP           CASEQ     '4'           SRBD                           Delete
     C                   ENDCS
     C                   ENDIF
      *
     C  N52              ENDDO
      *
     C     *IN03         CABEQ     '1'           SRB9                           End
     C     *IN05         CABEQ     '1'           SRB1                           Refresh
     C     *IN05         CABEQ     '0'           SRB3                           Subfile
      *
     C     SRB9          ENDSR
      *////////////////////////////////////////////////////////////
      *  Select tag                                          SRBA /
      *////////////////////////////////////////////////////////////
     C     SRBA          BEGSR
     C     SRBA1         TAG
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     DKT058DØ
     C                   EXFMT     DKT058DA
     C                   MOVEA     '00'          *IN(30)
      *________
      * F3=Exit
      *""""""""
     C     *IN03         CABEQ     '1'           SRBA9
      *____________
      * F4=Søk kund
      *""""""""""""
     C     *IN04         IFEQ      '1'
     C                   CALL      'SOEKKUN'
     C                   PARM                    WKSE_KNR
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN           30
     C                   GOTO      SRBA1
     C                   ENDIF
      *___________
      * F12=Cancel
      *"""""""""""
     C     *IN12         CABEQ     '1'           SRBA9
      *______
      * Enter
      *""""""
     C                   MOVE      *BLANKS       WKNAVN
     C                   MOVEL     'Generell'    WKNAVN
      * Gjyldigt kundenummer ?
     C                   IF        WKSE_KNR > *ZEROS
     C     CUNKEY        CHAIN     CUNDL01                            30
     C     *IN30         IFEQ      '1'
     C                   MOVE      '1'           *IN31
     C                   MOVE      'DKT0011'     ZMSGNO
     C                   GOTO      SRBA1
     C                   ENDIF
     C                   MOVEL     KNAVN         WKNAVN
     C                   ENDIF
     C     SRBA9         ENDSR
      *////////////////////////////////////////////////////////////
      *  Delete                                              SRBD /
      *////////////////////////////////////////////////////////////
     C     SRBD          BEGSR
      *______________
      * Delete record
      *""""""""""""""
     C     KEYB          CHAIN     DKTSE1                             53
     C  N53              DELETE    DKTSER1
      *_______________
      * Update subfile
      *"""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   MOVE      '0'           *IN41
     C                   UPDATE    DKT058DB
     C                   MOVE      '1'           *IN05
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Create                                              SRBF /
      *////////////////////////////////////////////////////////////
     C     SRBF          BEGSR
      *_____________
      * Blank fields
      *"""""""""""""
     C                   MOVEA     '00'          *IN(30)
     C                   CLEAR                   DKTSER1
     C                   CLEAR                   DKT058DE
     C     SRBFA         TAG

     C     *IN03         DOWEQ     '0'
     C     *IN12         ANDEQ     '0'

     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     DKT058DØ
     C                   EXFMT     DKT058DE
     C                   MOVEA     '00'          *IN(30)
      *______________
      * End or Cancel
      *""""""""""""""
     C     *IN03         IFEQ      '0'
     C     *IN12         ANDEQ     '0'
      *_____
      * Test
      *"""""
     C     KEYC          CHAIN(N)  DKTSE1                             53
     C                   IF        *IN53=*OFF
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN31=*ON
     C                   MOVE      'DKT0010'     ZMSGNO
     C                   GOTO      SRBFA
     C                   ENDIF
      *__________
      * Add to PF
      *""""""""""
     C                   MOVE      WKSE_KNR      DKSE_KNR
     C                   MOVE      ZKSE_331      DKSE_331
     C                   MOVE      ZKSE_34       DKSE_34
     C                   MOVE      ZKSE_4421     DKSE_4421
     C                   MOVE      ZKSE_442A     DKSE_442A
     C                   WRITE     DKTSER1
      *_______________
      * Add to subfile
      *"""""""""""""""
     C                   ADD       1             WRECNO
     C                   Z-ADD     WRECNO        ZRECNO
     C                   MOVE      '0'           *IN41
     C                   WRITE     DKT058DB
      *
     C                   ENDIF
     C                   ENDDO
      *
     C                   ENDSR
