      *********************************************************************
      * Spørring på (generering av) STATISTIKK
      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/SYSTO1 MODULE(*LIBL/SYSTO1 *LIBL/INCGI)
CRTPGM*         ACTGRP(CGI) AUT(*USE)
      *********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 avvikende kundenr dersom User er intern
      *%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
10XXX * 02 JOV PTF11 editcode med mellomrom i stedet for punktum (av hensyn til excel)
********************************************************************
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
     Fhead33    IF   E           K DISK    USROPN
     FFakt      IF   E           K DISK    USROPN
     FKodta     IF   E           K DISK    USROPN
     FKodtge    IF   E           K DISK    USROPN
     FKODTV     IF   E           K DISK    USROPN
     FBRSTF     IF   E           K DISK    USROPN
     FBRSTP     IF   E           K DISK    USROPN
     FCUNDL01   IF   E           K DISK    USROPN
     FCGIWSTI   UF A E           K DISK    USROPN
      *********************************************************************
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      /copy syspeds/qrpgsrcpy,variables3
      *
     D OddEven         s             10
      * Client input variables
     D FRA             s              6
     D TIL             s              6
     D Retning         s              1
     D LK              s              2
     D Sone            s              1
     D SonePrVg        s              1
     D SoneSomTab      s              1
     D Visant          s              1
     D Viskll          s              1
     D Visvkt          s              1
     D Visfvk          s              1
     D Visebl          s              1
     D Visege          s              1
     D Vismbl          s              1
     D Vistbl          s              1
     D Denne           s              3
     D Txtant          s             30
     D Txtkll          s             30
     D Txtvkt          s             30
     D Txtfvk          s             30
     D Txtebl          s             30
     D Txtege          s             30
     D Txtmbl          s             30
     D Txttbl          s             30
     D MaID            s             10
     D user            s             10
N01  D AVVKNR          S              8
N01  D AVVKNN          S              8  0
      *
     D PerTxt          s             20
     D PerTxt2         s             50
     D KunLkTxt        s             15
     D OpdRetn         s              1
      *
N02  D Sign            s              1a
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
     D                 DS
     D  HEDTOP                 1      8  0
     D  ÅR                     1      4  0
     D  MN                     5      6  0
     D                 DS
     D  FRADT6                 1      6  0
     D  FRA6DAG                1      2  0
     D  FRA6MND                3      4  0
     D  FRA6AAR                5      6  0
     D                 DS
     D  FRADT                  1      8  0
     D  FRAAAR                 1      4  0
     D  FRAMND                 5      6  0
     D  FRADAG                 7      8  0
     D                 DS
     D  DTDDMMÅÅÅÅ             1      8  0
     D  DTDAG                  1      2  0
     D  DTMND                  3      4  0
     D  DTAAR                  5      8  0
     D                 DS
     D  TILDT6                 1      6  0
     D  TIL6DAG                1      2  0
     D  TIL6MND                3      4  0
     D  TIL6AAR                5      6  0
     D                 DS
     D  TILDT                  1      8  0
     D  TILAAR                 1      4  0
     D  TILMND                 5      6  0
     D  TILDAG                 7      8  0
      * Antall
     D                 DS
     D  ANT01N                 1      9  0
     D  ANT02N                10     18  0
     D  ANT03N                19     27  0
     D  ANT04N                28     36  0
     D  ANT05N                37     45  0
     D  ANT06N                46     54  0
     D  ANT07N                55     63  0
     D  ANT08N                64     72  0
     D  ANT09N                73     81  0
     D  ANT10N                82     90  0
     D  ANT11N                91     99  0
     D  ANT12N               100    108  0
     D  ANT13N               109    117  0
     D  ANT                    1    117  0
     D                                     DIM(13)
      * Kolli
     D                 DS
     D  KLL01N                 1      9  0
     D  KLL02N                10     18  0
     D  KLL03N                19     27  0
     D  KLL04N                28     36  0
     D  KLL05N                37     45  0
     D  KLL06N                46     54  0
     D  KLL07N                55     63  0
     D  KLL08N                64     72  0
     D  KLL09N                73     81  0
     D  KLL10N                82     90  0
     D  KLL11N                91     99  0
     D  KLL12N               100    108  0
     D  KLL13N               109    117  0
     D  KLL                    1    117  0
     D                                     DIM(13)
      * Vekt
     D                 DS
     D  VKT01N                 1      9  0
     D  VKT02N                10     18  0
     D  VKT03N                19     27  0
     D  VKT04N                28     36  0
     D  VKT05N                37     45  0
     D  VKT06N                46     54  0
     D  VKT07N                55     63  0
     D  VKT08N                64     72  0
     D  VKT09N                73     81  0
     D  VKT10N                82     90  0
     D  VKT11N                91     99  0
     D  VKT12N               100    108  0
     D  VKT13N               109    117  0
     D  VKT                    1    117  0
     D                                     DIM(13)
      * Fraktvekt
     D                 DS
     D  FVK01N                 1      9  0
     D  FVK02N                10     18  0
     D  FVK03N                19     27  0
     D  FVK04N                28     36  0
     D  FVK05N                37     45  0
     D  FVK06N                46     54  0
     D  FVK07N                55     63  0
     D  FVK08N                64     72  0
     D  FVK09N                73     81  0
     D  FVK10N                82     90  0
     D  FVK11N                91     99  0
     D  FVK12N               100    108  0
     D  FVK13N               109    117  0
     D  FVK                    1    117  0
     D                                     DIM(13)
      * Eget beløp (frakter)
     D                 DS
     D  EBL01N                 1      9  0
     D  EBL02N                10     18  0
     D  EBL03N                19     27  0
     D  EBL04N                28     36  0
     D  EBL05N                37     45  0
     D  EBL06N                46     54  0
     D  EBL07N                55     63  0
     D  EBL08N                64     72  0
     D  EBL09N                73     81  0
     D  EBL10N                82     90  0
     D  EBL11N                91     99  0
     D  EBL12N               100    108  0
     D  EBL13N               109    117  0
     D  EBL                    1    117  0
     D                                     DIM(13)
      * Eget beløp - Gebyrer
     D                 DS
     D  EGE01N                 1      9  0
     D  EGE02N                10     18  0
     D  EGE03N                19     27  0
     D  EGE04N                28     36  0
     D  EGE05N                37     45  0
     D  EGE06N                46     54  0
     D  EGE07N                55     63  0
     D  EGE08N                64     72  0
     D  EGE09N                73     81  0
     D  EGE10N                82     90  0
     D  EGE11N                91     99  0
     D  EGE12N               100    108  0
     D  EGE13N               109    117  0
     D  EGE                    1    117  0
     D                                     DIM(13)
      * Motparts beløp (frakter)
     D                 DS
     D  MBL01N                 1      9  0
     D  MBL02N                10     18  0
     D  MBL03N                19     27  0
     D  MBL04N                28     36  0
     D  MBL05N                37     45  0
     D  MBL06N                46     54  0
     D  MBL07N                55     63  0
     D  MBL08N                64     72  0
     D  MBL09N                73     81  0
     D  MBL10N                82     90  0
     D  MBL11N                91     99  0
     D  MBL12N               100    108  0
     D  MBL13N               109    117  0
     D  MBL                    1    117  0
     D                                     DIM(13)
      * Totalt beløp
     D                 DS
     D  TBL01N                 1      9  0
     D  TBL02N                10     18  0
     D  TBL03N                19     27  0
     D  TBL04N                28     36  0
     D  TBL05N                37     45  0
     D  TBL06N                46     54  0
     D  TBL07N                55     63  0
     D  TBL08N                64     72  0
     D  TBL09N                73     81  0
     D  TBL10N                82     90  0
     D  TBL11N                91     99  0
     D  TBL12N               100    108  0
     D  TBL13N               109    117  0
     D  TBL                    1    117  0
     D                                     DIM(13)
      * Vektgrupper
     D                 DS
     D  KOVK1                  1      5  0
     D  KOVK2                  6     10  0
     D  KOVK3                 11     15  0
     D  KOVK4                 16     20  0
     D  KOVK5                 21     25  0
     D  KOVK6                 26     30  0
     D  KOVK7                 31     35  0
     D  KOVK8                 36     40  0
     D  KOVK9                 41     45  0
     D  KOVK10                46     50  0
     D  KOVK11                51     55  0
     D  KOVK12                56     60  0
     D  FF                     1     65  0
     D                                     DIM(13) ASCEND
      * Totalt antall fordelt på vektgrupper
     D                 DS
     D  TVG01N                 1      9  0
     D  TVG02N                10     18  0
     D  TVG03N                19     27  0
     D  TVG04N                28     36  0
     D  TVG05N                37     45  0
     D  TVG06N                46     54  0
     D  TVG07N                55     63  0
     D  TVG08N                64     72  0
     D  TVG09N                73     81  0
     D  TVG10N                82     90  0
     D  TVG11N                91     99  0
     D  TVG12N               100    108  0
     D  TVG13N               109    117  0
     D  TVG                    1    117  0
     D                                     DIM(13)
      *
      * Datastrukturer som matcher WORKFILE
      * Antall
     D                 DS
     D  ANT01W                 1      9  0
     D  ANT02W                10     18  0
     D  ANT03W                19     27  0
     D  ANT04W                28     36  0
     D  ANT05W                37     45  0
     D  ANT06W                46     54  0
     D  ANT07W                55     63  0
     D  ANT08W                64     72  0
     D  ANT09W                73     81  0
     D  ANT10W                82     90  0
     D  ANT11W                91     99  0
     D  ANT12W               100    108  0
     D  ANT13W               109    117  0
     D  ANTW                   1    117  0
     D                                     DIM(13)
      * Kolli
     D                 DS
     D  KLL01W                 1      9  0
     D  KLL02W                10     18  0
     D  KLL03W                19     27  0
     D  KLL04W                28     36  0
     D  KLL05W                37     45  0
     D  KLL06W                46     54  0
     D  KLL07W                55     63  0
     D  KLL08W                64     72  0
     D  KLL09W                73     81  0
     D  KLL10W                82     90  0
     D  KLL11W                91     99  0
     D  KLL12W               100    108  0
     D  KLL13W               109    117  0
     D  KLLW                   1    117  0
     D                                     DIM(13)
      * Vekt
     D                 DS
     D  VKT01W                 1      9  0
     D  VKT02W                10     18  0
     D  VKT03W                19     27  0
     D  VKT04W                28     36  0
     D  VKT05W                37     45  0
     D  VKT06W                46     54  0
     D  VKT07W                55     63  0
     D  VKT08W                64     72  0
     D  VKT09W                73     81  0
     D  VKT10W                82     90  0
     D  VKT11W                91     99  0
     D  VKT12W               100    108  0
     D  VKT13W               109    117  0
     D  VKTW                   1    117  0
     D                                     DIM(13)
      * Fraktvekt
     D                 DS
     D  FVK01W                 1      9  0
     D  FVK02W                10     18  0
     D  FVK03W                19     27  0
     D  FVK04W                28     36  0
     D  FVK05W                37     45  0
     D  FVK06W                46     54  0
     D  FVK07W                55     63  0
     D  FVK08W                64     72  0
     D  FVK09W                73     81  0
     D  FVK10W                82     90  0
     D  FVK11W                91     99  0
     D  FVK12W               100    108  0
     D  FVK13W               109    117  0
     D  FVKW                   1    117  0
     D                                     DIM(13)
      * Eget beløp (frakter)
     D                 DS
     D  EBL01W                 1      9  0
     D  EBL02W                10     18  0
     D  EBL03W                19     27  0
     D  EBL04W                28     36  0
     D  EBL05W                37     45  0
     D  EBL06W                46     54  0
     D  EBL07W                55     63  0
     D  EBL08W                64     72  0
     D  EBL09W                73     81  0
     D  EBL10W                82     90  0
     D  EBL11W                91     99  0
     D  EBL12W               100    108  0
     D  EBL13W               109    117  0
     D  EBLW                   1    117  0
     D                                     DIM(13)
      * Eget beløp - Gebyrer
     D                 DS
     D  EGE01W                 1      9  0
     D  EGE02W                10     18  0
     D  EGE03W                19     27  0
     D  EGE04W                28     36  0
     D  EGE05W                37     45  0
     D  EGE06W                46     54  0
     D  EGE07W                55     63  0
     D  EGE08W                64     72  0
     D  EGE09W                73     81  0
     D  EGE10W                82     90  0
     D  EGE11W                91     99  0
     D  EGE12W               100    108  0
     D  EGE13W               109    117  0
     D  EGEW                   1    117  0
     D                                     DIM(13)
      * Motparts beløp (frakter)
     D                 DS
     D  MBL01W                 1      9  0
     D  MBL02W                10     18  0
     D  MBL03W                19     27  0
     D  MBL04W                28     36  0
     D  MBL05W                37     45  0
     D  MBL06W                46     54  0
     D  MBL07W                55     63  0
     D  MBL08W                64     72  0
     D  MBL09W                73     81  0
     D  MBL10W                82     90  0
     D  MBL11W                91     99  0
     D  MBL12W               100    108  0
     D  MBL13W               109    117  0
     D  MBLW                   1    117  0
     D                                     DIM(13)
      * Totalt beløp
     D                 DS
     D  TBL01W                 1      9  0
     D  TBL02W                10     18  0
     D  TBL03W                19     27  0
     D  TBL04W                28     36  0
     D  TBL05W                37     45  0
     D  TBL06W                46     54  0
     D  TBL07W                55     63  0
     D  TBL08W                64     72  0
     D  TBL09W                73     81  0
     D  TBL10W                82     90  0
     D  TBL11W                91     99  0
     D  TBL12W               100    108  0
     D  TBL13W               109    117  0
     D  TBLW                   1    117  0
     D                                     DIM(13)
      *
      /copy syspeds/qrpgsrcpy,prolog3
      *
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input / cvt to numeric
     C                   exsr      Parse
      * File open / keys
     C                   EXSR      INIT
      * Read output skeleton html member into memory
     C                   exsr      LoadHtml
      *
      *
      * Set section variables
     C                   exsr      SetTop
     C                   callp     wrtsection('top')
      * Behandle valgt år
     C                   move      'Y'           Runde1            1
     C                   eval      PerTxt = 'Statistikkperiode:  '
     C*                  eval      PerTxt2 = '                   '
     C                   exsr      VisEttAar
      *
      * foregående år...
     C                   move      ' '           Runde1
     C                   eval      PerTxt = 'Foregående år:      '
     c                   sub       1             FRAAAR
     c                   sub       1             TILAAR
     C                   exsr      VisEttAar
      *
      * Brutt ned på Postnr... -(men viser da kun årets tall)
     c     Sone          ifeq      'Y'
     c                   Exsr      SoneSr
     c                   end
      *
      * Quit
      * Compute run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   callp     wrtsection('bot')
      *
     C                   exsr      Exit
      *
     C                   eval      *inlr = *on
     C                   return
      *
      *
      *=====================================================================
      * Akkumuler og vis tallene for ETT år
      *=====================================================================
     C     VisEttAar     begsr
     C                   exsr      akkum
     C                   exsr      SetRow
     C                   callp     wrtsection('rowhead')
     C                   callp     wrtsection('rowheadmnd')
     C     Visant        Ifeq      'Y'
     C                   callp     wrtsection('rowant')
     C                   end
     C     Viskll        Ifeq      'Y'
     C                   callp     wrtsection('rowkll')
     C                   end
     C     Visvkt        Ifeq      'Y'
     C                   callp     wrtsection('rowvkt')
     C                   end
     C     Visfvk        Ifeq      'Y'
     C                   callp     wrtsection('rowfvk')
     C                   end
     C     Visebl        Ifeq      'Y'
     C                   callp     wrtsection('rowebl')
     C                   end
     C     Visege        Ifeq      'Y'
     C                   callp     wrtsection('rowege')
     C                   end
     C     Vismbl        Ifeq      'Y'
     C                   callp     wrtsection('rowmbl')
     C                   end
     C     Vistbl        Ifeq      'Y'
     C                   callp     wrtsection('rowtbl')
     C                   end
     C                   callp     updHTMLvar('FORDANT':
     C                             %trim(%editc(TVG13N:'J')))
     C                   callp     updHTMLvar('FORDENH':'sendingene')
     C                   callp     wrtsection('rowheadvgr')
     C                   callp     wrtsection('rowtvg')
     C                   callp     wrtsection('rowbot')
     C                   endsr
      *=====================================================================
      * Finn hvilke statistikkbegrep osm ønskes brutt ned på sone
      *=====================================================================
     C     SoneSr        begsr
      *
     C                   eval      PerTxt = 'Statistikkperiode:  '
     c                   add       1             FRAAAR
     c                   add       1             TILAAR
     C                   callp     wrtsection('Sonehead')
      * Vis Sone som egen tabell (sonenavn = Header...)
      * det enkelte stat-begrep (ant,kll,vkt) er linjer/y-akse.
     C     SoneSomTab    IFEQ      'Y'
     c                   eval      Denne  =  'all'
     c                   exsr      SoneSrB
     C                   else
      * Vis Sone som linje (y-akse )
     C     Visant        Ifeq      'Y'
     c                   eval      Denne  =  'ant'
     C                   eval      PerTxt2 = 'Ant. Snd / Geografisk område'
     c                   move      Totant        Totnnn            9 0
     c                   movel     'sendinger  ' FORDENH          15
     c                   exsr      SoneSrB
     c                   end
     C     Viskll        Ifeq      'Y'
     c                   eval      Denne  =  'kll'
     C                   eval      PerTxt2 = 'Ant. Kolli / Geografisk område'
     c                   move      Totkll        Totnnn
     c                   movel     'kolli      ' FORDENH
     c                   exsr      SoneSrB
     c                   end
     C     Visvkt        Ifeq      'Y'
     c                   eval      Denne  =  'vkt'
     C                   eval      PerTxt2 = 'Brt.vekt / Geografisk område'
     c                   move      Totvkt        Totnnn
     c                   movel     'kilo       ' FORDENH
     c                   exsr      SoneSrB
     c                   end
     C     Visfvk        Ifeq      'Y'
     c                   eval      Denne  =  'fvk'
     C                   eval      PerTxt2 = 'F.b.vekt / Geografisk område'
     c                   move      Totfvk        Totnnn
     c                   movel     'kilo       ' FORDENH
     c                   exsr      SoneSrB
     c                   end
     C     Visebl        Ifeq      'Y'
     c                   eval      Denne  =  'ebl'
     C                   eval      PerTxt2 = 'Frakt egen / Geografisk område'
     c                   move      Totebl        Totnnn
     c                   movel     'kr.        ' FORDENH
     c                   exsr      SoneSrB
     c                   end
     C     Visege        Ifeq      'Y'
     c                   eval      Denne  =  'ege'
     C                   eval      PerTxt2 = 'Till.tjenester/ Geografisk område'
     c                   move      Totege        Totnnn
     c                   movel     'kr.        ' FORDENH
     c                   exsr      SoneSrB
     c                   end
     C     Vismbl        Ifeq      'Y'
     c                   eval      Denne  =  'mbl'
     C                   eval      PerTxt2 = 'Fr.Motpart / Geografisk område'
     c                   move      Totmbl        Totnnn
     c                   movel     'kr.        ' FORDENH
     c                   exsr      SoneSrB
     c                   end
     C     Vistbl        Ifeq      'Y'
     c                   eval      Denne  =  'tbl'
     C                   eval      PerTxt2 = 'Total kost / Geografisk område'
     c                   move      Tottbl        Totnnn
     c                   movel     'kr.        ' FORDENH
     c                   exsr      SoneSrB
     c                   end
      *
     c                   end
      *
     c                   endsr
      *
      *=====================================================================
      * Vis tallene For ETT begrep brutt ned på postnummersoner
      *=====================================================================
     C     SoneSrB       begsr
      *
      * Denne=all betyr at en kjører sone som header og alle linjene
      *           fortløpende (som "hoved-tabellen)
     c                   move      *zeros        DetteLnr          5 0
     c
     c     sessionid     setll     CGIWSTI
     c     sessionid     reade     CGIWSTI                                33
     c     *in33         doweq     *off
     c                   movea     antw          ant
     c                   movea     kllw          kll
     c                   movea     vktw          vkt
     c                   movea     fvkw          fvk
     c                   movea     eblw          ebl
     c                   movea     egew          ege
     c                   movea     mblw          mbl
     c                   movea     tblw          tbl
     c     cwsona        ifeq      *blanks
     c                   move      CWSONR        CWSONRA           2
     c                   eval      CWSONA = 'Sone ' + CWSONRA
     c                   end
     c     Denne         ifeq      'all'
     C                   eval      PerTxt2 = 'Område: '+cwsona
     c                   z-add     ant13n        Totnnn            9 0
     c                   movel     'sendinger  ' FORDENH          15
     c                   else
     c                   eval      Txtant = CWSONA
     c                   eval      Txtkll = CWSONA
     c                   eval      Txtvkt = CWSONA
     c                   eval      Txtfvk = CWSONA
     c                   eval      Txtebl = CWSONA
     c                   eval      Txtege = CWSONA
     c                   eval      Txtmbl = CWSONA
     c                   eval      Txttbl = CWSONA
     c                   end
     C                   add       1             DetteLnr
     C                   exsr      SetRow
      * Header før første linje.
     C     DetteLnr      Ifeq      1
     C     Denne         oreq      'all'
     C                   callp     updHTMLvar('FORDANT':
     C                             %trim(%editc(TOTNNN:'J')))
     C                   callp     updHTMLvar('FORDENH':FORDENH)
     C                   callp     wrtsection('rowhead')
     c     SonePrVg      ifeq      'Y'
     C                   callp     wrtsection('rowheadvgr')
     c                   else
     C                   callp     wrtsection('rowheadmnd')
     c                   end
     c                   end
     C     VisAnt        Ifeq      'Y'
     c     Denne         Ifeq      'ant'
     c     Denne         Oreq      'all'
     C                   callp     wrtsection('rowant')
     C                   END
     C                   END
     C     VisKll        Ifeq      'Y'
     c     Denne         Ifeq      'kll'
     c     Denne         Oreq      'all'
     C                   callp     wrtsection('rowkll')
     C                   END
     C                   END
     C     VisVkt        Ifeq      'Y'
     c     Denne         Ifeq      'vkt'
     c     Denne         Oreq      'all'
     C                   callp     wrtsection('rowvkt')
     C                   END
     C                   END
     C     VisFvk        Ifeq      'Y'
     c     Denne         Ifeq      'fvk'
     c     Denne         Oreq      'all'
     C                   callp     wrtsection('rowfvk')
     C                   END
     C                   END
     C     VisEbl        Ifeq      'Y'
     c     Denne         Ifeq      'ebl'
     c     Denne         Oreq      'all'
     C                   callp     wrtsection('rowebl')
     C                   END
     C                   END
     C     VisEge        Ifeq      'Y'
     c     Denne         Ifeq      'ege'
     c     Denne         Oreq      'all'
     C                   callp     wrtsection('rowege')
     C                   END
     C                   END
     C     VisMbl        Ifeq      'Y'
     c     Denne         Ifeq      'mbl'
     c     Denne         Oreq      'all'
     C                   callp     wrtsection('rowmbl')
     C                   END
     C                   END
     C     VisTbl        Ifeq      'Y'
     c     Denne         Ifeq      'tbl'
     c     Denne         Oreq      'all'
     C                   callp     wrtsection('rowtbl')
     C                   END
     C                   END
     C     Denne         ifeq      'all'
     C                   callp     wrtsection('rowbot')
     C                   end
     c     sessionid     reade     CGIWSTI                                33
     c                   end
      *
     C     Denne         ifne      'all'
     C                   callp     wrtsection('rowbot')
     C                   end
      *
     C                   ENDSR
      *
      *=====================================================================
      * Parse input / cvt to numeric
      *=====================================================================
     C     Parse         begsr
      * Parse variables from QUERY_STRING environment variable
     C                   eval      FRA     = zhbgetvar('FRA')
     C                   eval      FRADT6  = c2n2(FRA)
     C                   eval      FRAAAR  = 2000 + FRA6AAR
     C                   eval      FRAMND  = FRA6MND
     C                   eval      FRADAG  = FRA6DAG
     C                   eval      TIL     = zhbgetvar('TIL')
     C                   eval      TILDT6  = c2n2(TIL)
     C                   eval      TILAAR  = 2000 + TIL6AAR
     C                   eval      TILMND  = TIL6MND
     C                   eval      TILDAG  = TIL6DAG
     C                   eval      Retning = zhbgetvar('Retning')
     C                   eval      LK      = zhbgetvar('LK')
     C                   eval      Sone    = zhbgetvar('Sone')
     C                   eval      SonePrVg  = zhbgetvar('SonePrVg')
     C                   eval      SoneSomTab  = zhbgetvar('SoneSomTab')
     C                   eval      Visant  = zhbgetvar('Visant')
     C                   eval      Viskll  = zhbgetvar('Viskll')
     C                   eval      Visvkt  = zhbgetvar('Visvkt')
     C                   eval      Visfvk  = zhbgetvar('Visfvk')
     C                   eval      Visebl  = zhbgetvar('Visebl')
     C                   eval      Visege  = zhbgetvar('Visege')
     C                   eval      Vismbl  = zhbgetvar('Vismbl')
     C                   eval      Vistbl  = zhbgetvar('Vistbl')
     C                   eval      MaID    = zhbgetvar('MaID')
     C     MaID          ifeq      *blanks
     c                   eval      MaID    = 'STANDARD'
     C                   end
      * Userid.....
     C                   eval      user = zhbgetvar('user')
N01  C                   eval      AVVKNR  = zhbgetvar('AVVKNR')
N01  C                   eval      AVVKNN  = c2n2(AVVKNR)
     C                   endsr
      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
     c                   exsr      TØMWRK
      * Quit
     C                   CLOSE     BRIDF
     C                   CLOSE     head33
     C                   CLOSE     fakt
     C                   CLOSE     kodta
     C                   CLOSE     kodtge
     C                   CLOSE     kodtv
     C                   CLOSE     cundl01
     C                   CLOSE     BRSTF
     C                   CLOSE     BRSTP
     C                   CLOSE     CGIWSTI
      *
     C                   endsr
      *=====================================================================
      * Read output skeleton html member into memory
      *=====================================================================
     C     LoadHtml      begsr
     C                   callp     gethtml('HTMLSRC':
     C                             '*LIBL':
     C                             'SYSTO1':'/CGITAG/')
     C                   endsr
      *=====================================================================
      *  Set variable data for section /$top
      *=====================================================================
     C     SetTop        begsr
      *
OddEvC                   callp     updHTMLvar('ROWHEAD':RowHead)
OddEvC                   callp     updHTMLvar('LogoImg':LogoImg)
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updHTMLvar('USER':USER)
     C                   callp     updHTMLvar('BESK':BIBESK)
     C                   callp     updHtmlVar('KUNDE':
     C                             %trim(%editc(BIKUNR:'Z')))
     C                   callp     updHTMLvar('KNAVN':KNAVN)
     C                   endsr
      *=====================================================================
      *  Set variable data for section /$all
      *=====================================================================
     C     SetRow        begsr
      *
     C     DetteLnr      Ifeq      1
     C     Denne         oreq      'all'
     C* klargjøre HTMLvariable - Header
     C                   callp     updHTMLvar('PERTXT':PerTxt)
     C                   callp     updHTMLvar('PERTXT2':PerTxt2)
     c                   move      FRAAAR        DTAAR
     c                   move      FRAMND        DTMND
     c                   move      FRADAG        DTDAG
     C                   callp     updHTMLvar('FRA':
     C                             %trim(%editw(DTDDMMÅÅÅÅ:'  .  .    ')))
     c                   move      TILAAR        DTAAR
     c                   move      TILMND        DTMND
     c                   move      TILDAG        DTDAG
     C                   callp     updHTMLvar('TIL':
     C                             %trim(%editw(DTDDMMÅÅÅÅ:'  .  .    ')))
     C                   END
      * Antall
     C     Denne         ifeq      'all'
     c     Denne         oreq      'ant'
     C                   callp     updHTMLvar('Txtant':Txtant)
     C                   callp     updHTMLvar('ANT01':
N02  C                             %trim(%editw(ANT01N:'   &   &  0')))
S02  C*                            %trim(%editc(ANT01N:'J')))
S02   * samme mønster på alle - da merket kun med E02
     C                   callp     updHTMLvar('ANT02':
E02  C                             %trim(%editw(ANT02N:'   &   &  0')))
     C                   callp     updHTMLvar('ANT03':
E02  C                             %trim(%editw(ANT03N:'   &   &  0')))
     C                   callp     updHTMLvar('ANT04':
E02  C                             %trim(%editw(ANT04N:'   &   &  0')))
     C                   callp     updHTMLvar('ANT05':
E02  C                             %trim(%editw(ANT05N:'   &   &  0')))
     C                   callp     updHTMLvar('ANT06':
E02  C                             %trim(%editw(ANT06N:'   &   &  0')))
     C                   callp     updHTMLvar('ANT07':
E02  C                             %trim(%editw(ANT07N:'   &   &  0')))
     C                   callp     updHTMLvar('ANT08':
E02  C                             %trim(%editw(ANT08N:'   &   &  0')))
     C                   callp     updHTMLvar('ANT09':
E02  C                             %trim(%editw(ANT09N:'   &   &  0')))
     C                   callp     updHTMLvar('ANT10':
E02  C                             %trim(%editw(ANT10N:'   &   &  0')))
     C                   callp     updHTMLvar('ANT11':
E02  C                             %trim(%editw(ANT11N:'   &   &  0')))
     C                   callp     updHTMLvar('ANT12':
E02  C                             %trim(%editw(ANT12N:'   &   &  0')))
     C                   callp     updHTMLvar('ANT13':
E02  C                             %trim(%editw(ANT13N:'   &   &  0')))
     C                   end
      * Kolli
     C     Denne         ifeq      'all'
     c     Denne         oreq      'kll'
     C                   callp     updHTMLvar('Txtkll':Txtkll)
     C                   callp     updHTMLvar('KLL01':
E02  C                             %trim(%editw(KLL01N:'   &   &  0')))
     C                   callp     updHTMLvar('KLL02':
E02  C                             %trim(%editw(KLL02N:'   &   &  0')))
     C                   callp     updHTMLvar('KLL03':
E02  C                             %trim(%editw(KLL03N:'   &   &  0')))
     C                   callp     updHTMLvar('KLL04':
E02  C                             %trim(%editw(KLL04N:'   &   &  0')))
     C                   callp     updHTMLvar('KLL05':
E02  C                             %trim(%editw(KLL05N:'   &   &  0')))
     C                   callp     updHTMLvar('KLL06':
E02  C                             %trim(%editw(KLL06N:'   &   &  0')))
     C                   callp     updHTMLvar('KLL07':
E02  C                             %trim(%editw(KLL07N:'   &   &  0')))
     C                   callp     updHTMLvar('KLL08':
E02  C                             %trim(%editw(KLL08N:'   &   &  0')))
     C                   callp     updHTMLvar('KLL09':
E02  C                             %trim(%editw(KLL09N:'   &   &  0')))
     C                   callp     updHTMLvar('KLL10':
E02  C                             %trim(%editw(KLL10N:'   &   &  0')))
     C                   callp     updHTMLvar('KLL11':
E02  C                             %trim(%editw(KLL11N:'   &   &  0')))
     C                   callp     updHTMLvar('KLL12':
E02  C                             %trim(%editw(KLL12N:'   &   &  0')))
     C                   callp     updHTMLvar('KLL13':
E02  C                             %trim(%editw(KLL13N:'   &   &  0')))
     c                   end
      * Vekt
     C     Denne         ifeq      'all'
     c     Denne         oreq      'vkt'
     C                   callp     updHTMLvar('Txtvkt':Txtvkt)
     C                   callp     updHTMLvar('VKT01':
E02  C                             %trim(%editw(VKT01N:'   &   &  0')))
     C                   callp     updHTMLvar('VKT02':
E02  C                             %trim(%editw(VKT02N:'   &   &  0')))
     C                   callp     updHTMLvar('VKT03':
E02  C                             %trim(%editw(VKT03N:'   &   &  0')))
     C                   callp     updHTMLvar('VKT04':
E02  C                             %trim(%editw(VKT04N:'   &   &  0')))
     C                   callp     updHTMLvar('VKT05':
E02  C                             %trim(%editw(VKT05N:'   &   &  0')))
     C                   callp     updHTMLvar('VKT06':
E02  C                             %trim(%editw(VKT06N:'   &   &  0')))
     C                   callp     updHTMLvar('VKT07':
E02  C                             %trim(%editw(VKT07N:'   &   &  0')))
     C                   callp     updHTMLvar('VKT08':
E02  C                             %trim(%editw(VKT08N:'   &   &  0')))
     C                   callp     updHTMLvar('VKT09':
E02  C                             %trim(%editw(VKT09N:'   &   &  0')))
     C                   callp     updHTMLvar('VKT10':
E02  C                             %trim(%editw(VKT10N:'   &   &  0')))
     C                   callp     updHTMLvar('VKT11':
E02  C                             %trim(%editw(VKT11N:'   &   &  0')))
     C                   callp     updHTMLvar('VKT12':
E02  C                             %trim(%editw(VKT12N:'   &   &  0')))
     C                   callp     updHTMLvar('VKT13':
     C                             %trim(%editw(VKT13N:'   &   &  0')))
     c                   end
      * Fraktvekt
     C     Denne         ifeq      'all'
     c     Denne         oreq      'fvk'
     C                   callp     updHTMLvar('Txtfvk':Txtfvk)
     C                   callp     updHTMLvar('FVK01':
E02  C                             %trim(%editw(FVK01N:'   &   &  0')))
     C                   callp     updHTMLvar('FVK02':
E02  C                             %trim(%editw(FVK02N:'   &   &  0')))
     C                   callp     updHTMLvar('FVK03':
E02  C                             %trim(%editw(FVK03N:'   &   &  0')))
     C                   callp     updHTMLvar('FVK04':
E02  C                             %trim(%editw(FVK04N:'   &   &  0')))
     C                   callp     updHTMLvar('FVK05':
E02  C                             %trim(%editw(FVK05N:'   &   &  0')))
     C                   callp     updHTMLvar('FVK06':
E02  C                             %trim(%editw(FVK06N:'   &   &  0')))
     C                   callp     updHTMLvar('FVK07':
E02  C                             %trim(%editw(FVK07N:'   &   &  0')))
     C                   callp     updHTMLvar('FVK08':
E02  C                             %trim(%editw(FVK08N:'   &   &  0')))
     C                   callp     updHTMLvar('FVK09':
E02  C                             %trim(%editw(FVK09N:'   &   &  0')))
     C                   callp     updHTMLvar('FVK10':
E02  C                             %trim(%editw(FVK10N:'   &   &  0')))
     C                   callp     updHTMLvar('FVK11':
E02  C                             %trim(%editw(FVK11N:'   &   &  0')))
     C                   callp     updHTMLvar('FVK12':
E02  C                             %trim(%editw(FVK12N:'   &   &  0')))
     C                   callp     updHTMLvar('FVK13':
E02  C                             %trim(%editw(FVK13N:'   &   &  0')))
     c                   end
      * Eget beløp (frakt)
     C     Denne         ifeq      'all'
     c     Denne         oreq      'ebl'
     C                   callp     updHTMLvar('Txtebl':Txtebl)
N02  c                   if        EBL01N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EBL01': Sign +
E02  C                             %trim(%editw(EBL01N:'   &   &  0')))
N02  c                   if        EBL02N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EBL02': Sign +
E02  C                             %trim(%editw(EBL02N:'   &   &  0')))
N02  c                   if        EBL03N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EBL03': Sign +
E02  C                             %trim(%editw(EBL03N:'   &   &  0')))
N02  c                   if        EBL04N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EBL04': Sign +
E02  C                             %trim(%editw(EBL04N:'   &   &  0')))
N02  c                   if        EBL05N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EBL05': Sign +
E02  C                             %trim(%editw(EBL05N:'   &   &  0')))
N02  c                   if        EBL06N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EBL06': Sign +
E02  C                             %trim(%editw(EBL06N:'   &   &  0')))
N02  c                   if        EBL07N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EBL07': Sign +
E02  C                             %trim(%editw(EBL07N:'   &   &  0')))
N02  c                   if        EBL08N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EBL08': Sign +
E02  C                             %trim(%editw(EBL08N:'   &   &  0')))
N02  c                   if        EBL09N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EBL09': Sign +
E02  C                             %trim(%editw(EBL09N:'   &   &  0')))
N02  c                   if        EBL10N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EBL10': Sign +
E02  C                             %trim(%editw(EBL10N:'   &   &  0')))
N02  c                   if        EBL11N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EBL11': Sign +
E02  C                             %trim(%editw(EBL11N:'   &   &  0')))
N02  c                   if        EBL12N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EBL12': Sign +
E02  C                             %trim(%editw(EBL12N:'   &   &  0')))
N02  c                   if        EBL13N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EBL13': Sign +
E02  C                             %trim(%editw(EBL13N:'   &   &  0')))
     c                   end
      * Eget GEBYR beløp
     C     Denne         ifeq      'all'
     c     Denne         oreq      'ege'
     C                   callp     updHTMLvar('Txtege':Txtege)
N02  c                   if        EGE01N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EGE01': Sign +
E02  C                             %trim(%editw(EGE01N:'   &   &  0')))
N02  c                   if        EGE02N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EGE02': Sign +
E02  C                             %trim(%editw(EGE02N:'   &   &  0')))
N02  c                   if        EGE03N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EGE03': Sign +
E02  C                             %trim(%editw(EGE03N:'   &   &  0')))
N02  c                   if        EGE04N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EGE04': Sign +
E02  C                             %trim(%editw(EGE04N:'   &   &  0')))
N02  c                   if        EGE05N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EGE05': Sign +
E02  C                             %trim(%editw(EGE05N:'   &   &  0')))
N02  c                   if        EGE06N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EGE06': Sign +
E02  C                             %trim(%editw(EGE06N:'   &   &  0')))
N02  c                   if        EGE07N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EGE07': Sign +
E02  C                             %trim(%editw(EGE07N:'   &   &  0')))
N02  c                   if        EGE08N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EGE08': Sign +
E02  C                             %trim(%editw(EGE08N:'   &   &  0')))
N02  c                   if        EGE09N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EGE09': Sign +
E02  C                             %trim(%editw(EGE09N:'   &   &  0')))
N02  c                   if        EGE10N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EGE10': Sign +
E02  C                             %trim(%editw(EGE10N:'   &   &  0')))
N02  c                   if        EGE11N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EGE11': Sign +
E02  C                             %trim(%editw(EGE11N:'   &   &  0')))
N02  c                   if        EGE12N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EGE12': Sign +
E02  C                             %trim(%editw(EGE12N:'   &   &  0')))
N02  c                   if        EGE13N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('EGE13': Sign +
E02  C                             %trim(%editw(EGE13N:'   &   &  0')))
     c                   end
      * Motparts beløp (frakt)
     C     Denne         ifeq      'all'
     c     Denne         oreq      'mbl'
     C                   callp     updHTMLvar('Txtmbl':Txtmbl)
N02  c                   if        MBL01N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('MBL01': Sign +
E02  C                             %trim(%editw(MBL01N:'   &   &  0')))
N02  c                   if        MBL02N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('MBL02': Sign +
E02  C                             %trim(%editw(MBL02N:'   &   &  0')))
N02  c                   if        MBL03N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('MBL03': Sign +
E02  C                             %trim(%editw(MBL03N:'   &   &  0')))
N02  c                   if        MBL04N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('MBL04': Sign +
E02  C                             %trim(%editw(MBL04N:'   &   &  0')))
N02  c                   if        MBL05N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('MBL05': Sign +
E02  C                             %trim(%editw(MBL05N:'   &   &  0')))
N02  c                   if        MBL06N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('MBL06': Sign +
E02  C                             %trim(%editw(MBL06N:'   &   &  0')))
N02  c                   if        MBL07N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('MBL07': Sign +
E02  C                             %trim(%editw(MBL07N:'   &   &  0')))
N02  c                   if        MBL08N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('MBL08': Sign +
E02  C                             %trim(%editw(MBL08N:'   &   &  0')))
N02  c                   if        MBL09N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('MBL09': Sign +
E02  C                             %trim(%editw(MBL09N:'   &   &  0')))
N02  c                   if        MBL10N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('MBL10': Sign +
E02  C                             %trim(%editw(MBL10N:'   &   &  0')))
N02  c                   if        MBL11N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('MBL11': Sign +
E02  C                             %trim(%editw(MBL11N:'   &   &  0')))
N02  c                   if        MBL12N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('MBL12': Sign +
E02  C                             %trim(%editw(MBL12N:'   &   &  0')))
N02  c                   if        MBL13N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('MBL13': Sign +
E02  C                             %trim(%editw(MBL13N:'   &   &  0')))
     c                   end
      * Totalt beløp
     C     Denne         ifeq      'all'
     c     Denne         oreq      'tbl'
     C                   callp     updHTMLvar('Txttbl':Txttbl)
N02  c                   if        TBL01N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('TBL01': Sign +
E02  C                             %trim(%editw(TBL01N:'   &   &  0')))
N02  c                   if        TBL02N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('TBL02': Sign +
E02  C                             %trim(%editw(TBL02N:'   &   &  0')))
N02  c                   if        TBL03N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('TBL03': Sign +
E02  C                             %trim(%editw(TBL03N:'   &   &  0')))
N02  c                   if        TBL04N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('TBL04': Sign +
E02  C                             %trim(%editw(TBL04N:'   &   &  0')))
N02  c                   if        TBL05N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('TBL05': Sign +
E02  C                             %trim(%editw(TBL05N:'   &   &  0')))
N02  c                   if        TBL06N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('TBL06': Sign +
E02  C                             %trim(%editw(TBL06N:'   &   &  0')))
N02  c                   if        TBL07N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('TBL07': Sign +
E02  C                             %trim(%editw(TBL07N:'   &   &  0')))
N02  c                   if        TBL08N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('TBL08': Sign +
E02  C                             %trim(%editw(TBL08N:'   &   &  0')))
N02  c                   if        TBL09N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('TBL09': Sign +
E02  C                             %trim(%editw(TBL09N:'   &   &  0')))
N02  c                   if        TBL10N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('TBL10': Sign +
E02  C                             %trim(%editw(TBL10N:'   &   &  0')))
N02  c                   if        TBL11N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('TBL11': Sign +
E02  C                             %trim(%editw(TBL11N:'   &   &  0')))
N02  c                   if        TBL12N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('TBL12': Sign +
E02  C                             %trim(%editw(TBL12N:'   &   &  0')))
N02  c                   if        TBL13N < 0
N02  c                   eval      Sign='-'
N02  c                   else
N02  c                   eval      Sign=' '
N02  c                   endif
     C                   callp     updHTMLvar('TBL13': Sign +
E02  C                             %trim(%editw(TBL13N:'   &   &  0')))
     c                   end
      * Vektgruppe-overskrifter
     C                   callp     updHTMLvar('KOV01':
     C                             %trim(%editc(KOVK1:'J')))
     C                   callp     updHTMLvar('KOV02':
     C                             %trim(%editc(KOVK2:'J')))
     C                   callp     updHTMLvar('KOV03':
     C                             %trim(%editc(KOVK3:'J')))
     C                   callp     updHTMLvar('KOV04':
     C                             %trim(%editc(KOVK4:'J')))
     C                   callp     updHTMLvar('KOV05':
     C                             %trim(%editc(KOVK5:'J')))
     C                   callp     updHTMLvar('KOV06':
     C                             %trim(%editc(KOVK6:'J')))
     C                   callp     updHTMLvar('KOV07':
     C                             %trim(%editc(KOVK7:'J')))
     C                   callp     updHTMLvar('KOV08':
     C                             %trim(%editc(KOVK8:'J')))
     C                   callp     updHTMLvar('KOV09':
     C                             %trim(%editc(KOVK9:'J')))
     C                   callp     updHTMLvar('KOV10':
     C                             %trim(%editc(KOVK10:'J')))
     C                   callp     updHTMLvar('KOV11':
     C                             %trim(%editc(KOVK11:'J')))
     C                   callp     updHTMLvar('KOV12':
     C                             %trim(%editc(KOVK12:'J')))
      * Totalt antall fordelt på vektgrupper
     C                   callp     updHTMLvar('TVG01':
E02  C                             %trim(%editw(TVG01N:'   &   &  0')))
     C                   callp     updHTMLvar('TVG02':
E02  C                             %trim(%editw(TVG02N:'   &   &  0')))
     C                   callp     updHTMLvar('TVG03':
E02  C                             %trim(%editw(TVG03N:'   &   &  0')))
     C                   callp     updHTMLvar('TVG04':
E02  C                             %trim(%editw(TVG04N:'   &   &  0')))
     C                   callp     updHTMLvar('TVG05':
E02  C                             %trim(%editw(TVG05N:'   &   &  0')))
     C                   callp     updHTMLvar('TVG06':
E02  C                             %trim(%editw(TVG06N:'   &   &  0')))
     C                   callp     updHTMLvar('TVG07':
E02  C                             %trim(%editw(TVG07N:'   &   &  0')))
     C                   callp     updHTMLvar('TVG08':
E02  C                             %trim(%editw(TVG08N:'   &   &  0')))
     C                   callp     updHTMLvar('TVG09':
E02  C                             %trim(%editw(TVG09N:'   &   &  0')))
     C                   callp     updHTMLvar('TVG10':
E02  C                             %trim(%editw(TVG10N:'   &   &  0')))
     C                   callp     updHTMLvar('TVG11':
E02  C                             %trim(%editw(TVG11N:'   &   &  0')))
     C                   callp     updHTMLvar('TVG12':
E02  C                             %trim(%editw(TVG12N:'   &   &  0')))
     C                   callp     updHTMLvar('TVG13':
E02  C                             %trim(%editw(TVG13N:'   &   &  0')))
      *
      *
     C                   endsr
      *=====================================================================
      * Akkumuler oppdragene
      *=====================================================================
     C     Akkum         begsr
     c                   clear                   ant
     c                   clear                   kll
     c                   clear                   vkt
     c                   clear                   fvk
     c                   clear                   ebl
     c                   clear                   ege
     c                   clear                   mbl
     c                   clear                   tbl
     c                   clear                   tvg
     C     frakey        setll     head33
     C     bikunr        reade     head33                                 35
     C     *IN35         doweq     *OFF
     c     HEDTOP        cabgt     TILDT         UtLoop
     c     HEST          cabeq     'S'           nextsnd
     c     mn            cabeq     0             nextsnd
     c     TRSLAG        cabeq     'FF'          nextsnd
     c     TRSLAG        cabeq     'VF'          nextsnd
      *
     c                   select
      * transp-modul - velg etter landkode
     c     HEUR          WHENEQ    'H'
     c                   move      '3'           Opdretn
     c     Helka         IFEQ      'NO'
     c     HETRI         ANDEQ     'NO'
     c                   move      'D'           Opdretn
     c                   end
     c     Helka         IFEQ      'NO'
     c     HETRI         ANDNE     'NO'
     c                   move      'E'           Opdretn
     c                   end
     c     Helka         IFNE      'NO'
     c     HETRI         ANDEQ     'NO'
     c                   move      'I'           Opdretn
     c                   end
      * andre moduler
     c                   other
     c     heur          ifeq      'E'
     c                   move      'D'           Opdretn
     c                   end
     c     heur          ifeq      'A'
     c     heur          oreq      'C'
     c     heur          oreq      'F'
     c                   move      'I'           Opdretn
     c                   end
     c     heur          ifeq      'B'
     c     heur          oreq      'D'
     c     heur          oreq      'G'
     c                   move      'E'           Opdretn
     c                   end
     c                   endsl
     c     Retning       ifne      'A'
     c     Retning       cabne     OpdRetn       nextsnd
     c                   end
      *
      * KUN ett land??
      * transp-modul HELKA=FraLK, HETRI=TilLK,
      *  andre moduler HELKA er den "utenlandske siden".
     C     LK            IFNE      *blanks
     c     HEUR          IFEQ      'H'
     c     Opdretn       andeq     'E'
     c     HETRI         CABNE     LK            nextsnd
     C                   else
     c     HELKA         CABNE     LK            nextsnd
     C                   end
     C                   end
      *
      * OPPDRAGET SKAL VÆRE MED..
      * Antall vekter (kun fra hovedoppdrag)
     c                   add       1             ant(MN)
     c                   add       1             ant(13)
     c                   add       HENT          KLL(MN)
     c                   add       HENT          KLL(13)
     c                   add       HEVKT         VKT(MN)
     c                   add       HEVKT         VKT(13)
     c                   add       HEFBV         FVK(MN)
     c                   add       HEFBV         FVK(13)
     C     HEFBV         IFGT      99999                                         2<-B
     C                   MOVE      99999         XFBV              5 0
     C                   ELSE                                                    2
     C                   MOVE      HEFBV         XFBV
     C                   END                                                     2<-E
     C                   Z-ADD     1             VV                2 0
     C     XFBV          LOOKUP    FF(VV)                             33  33
     c                   add       1             TVG(VV)
     c                   add       1             TVG(13)
      *
      * Beløp...
     c                   exsr      getbel
      * Frakt egen
     c                   add       BelFraEge     EBL(MN)
     c                   add       BelFraEge     EBL(13)
      * gebyr egen
     c                   add       BelGebEge     EGE(MN)
     c                   add       BelGebEge     EGE(13)
      * Frakt motpart (viser IKKE gebyrer)
     c                   add       BelFraMot     MBL(MN)
     c                   add       BelFraMot     MBL(13)
      * Beløp Total
     c                   add       BelTot        TBL(MN)
     c                   add       BelTot        TBL(13)
      *
      * I FØRSTE RUNDE - AKKUMULER OGSÅ BRUTT NED PÅ POSTNRSONE
     C     Runde1        IFEQ      'Y'
     C     Sone          ANDEQ     'Y'
     c                   Move      *zeros        cwsonr
     C                   EXSR      AkkuSone
     C     SoneSomTab    IFNE      'Y'
     c                   Move      99            cwsonr
     C                   EXSR      AkkuSone
     C                   end
     C                   end
      *
     c     nextsnd       tag
     C     bikunr        reade     head33                                 35
     c                   end
     c
     C     utloop        tag
      * ta vare på sum ant. oppdrag for evt bruk i SoneSR
     C     Runde1        IFEQ      'Y'
     c                   z-add     ant13n        Totant            9 0
     c                   z-add     kll13n        Totkll            9 0
     c                   z-add     vkt13n        Totvkt            9 0
     c                   z-add     fvk13n        Totfvk            9 0
     c                   z-add     ebl13n        Totebl            9 0
     c                   z-add     ege13n        Totege            9 0
     c                   z-add     mbl13n        Totmbl            9 0
     c                   z-add     tbl13n        Tottbl            9 0
     C                   end
     c                   endsr
      *
      *=====================================================================******
      *  Akumuler også tall brutt ned på postnrSone
      *=====================================================================******
     C     AkkuSone      begsr
     c                   clear                   antw
     c                   clear                   kllw
     c                   clear                   vktw
     c                   clear                   fvkw
     c                   clear                   eblw
     c                   clear                   egew
     c                   clear                   mblw
     c                   clear                   tblw
      * Hvis bedt om regionstall fordelt etter vektgrp (og ikke mnd)
      * så benyttes variabel for MN til vektgrupper
     C     SonePrVg      Ifeq      'Y'
     C                   Z-ADD     1             MN
     C     XFBV          LOOKUP    FF(MN)                             33  33
     C                   end
      * FINN SONE (hvis ikke kalt med 99 = totalt alle soner )
      *          (burde 99 være eksklusiv 98 - m.a.o bare DEFINERTE SONER ?)
      * (PÅ HENTEOPPDRAG burde en egentlig gå via hov.oppdrag for å finne
      *  tilpostnummer)
     c     cwSonr        ifeq      99
     c                   eval      RiSona = 'Totalt'
     c                   else
     c                   move      sessionid     CWUNIK
      * 98= Ukjent sone (øvrige postnr) ..
     c                   move      '98'          cwSonr
      * Ved eksport og domestic(utgående) gruppers på TIL-NR / ellers på FRA
     c     OpdRetn       Ifeq      'E'
     c     OpdRetn       Oreq      'D'
     C                   movel     hesdt         PostnrA           4
     c                   else
     C                   movel     hesdF         PostnrA           4
     c                   end
     C                   TESTN                   PostnrA              33
     C     *IN33         IFEQ      '1'
     c                   move      PostnrA       XXPostNr
     C     BRPKEY        SETGT     BRSTP
     C     BRPKEYE       READPE    BRSTP                                  33
     C  N33XXPostNr      IFGE      RIPNRF
     C     XXPostNr      ANDLE     RIPNRT
     C                   MOVE      RISONR        cwSonr
     C                   END
     C                   END
     c     cwSonr        IFEQ      98
     c                   eval      RiSona = 'Øvrige postnummer'
     C                   Else
     c     RiSona        IFEQ      *blanks
     c                   move      RIPNRF        RIPFA             4
     c                   move      RIPNRF        RIPTA             4
     c                   eval      RiSona = 'Postnr '+RIPFA+'-'+RIPTA
     C                   END
     C                   END
     C                   END
      *
     c     SoneKey       chain     CGIWSTI                            50
     c                   eval      CwSona = Risona
     c                   add       1             antw(MN)
     c                   add       1             antw(13)
     c                   add       HENT          KLLw(MN)
     c                   add       HENT          KLLw(13)
     c                   add       HEVKT         VKTw(MN)
     c                   add       HEVKT         VKTw(13)
     c                   add       HEFBV         FVKw(MN)
     c                   add       HEFBV         FVKw(13)
      * Frakt egen
     c                   add       BelFraEge     EBLw(MN)
     c                   add       BelFraEge     EBLw(13)
      * gebyr egen
     c                   add       BelGebEge     EGEw(MN)
     c                   add       BelGebEge     EGEw(13)
      * Frakt motpart (viser IKKE gebyrer)
     c                   add       BelFraMot     MBLw(MN)
     c                   add       BelFraMot     MBLw(13)
      * Beløp Total
     c                   add       BelTot        TBLw(MN)
     c                   add       BelTot        TBLw(13)
     c   50              write     CGIWSTIR
     c  N50              update    CGIWSTIR
      *
     C                   endsr
      *
      *
      *=====================================================================******
      *  Hent beløp total / mot eget kundenr
      *=====================================================================******
     C     GetBel        begsr
     C                   Move      *ZEROS        BelFraEge         9 0
     C                   Move      *ZEROS        BelGebEge         9 0
     C                   Move      *ZEROS        BelFraMot         9 0
     C                   Move      *ZEROS        BelTot            9 0
     c     FakKey        SETLL     FAKT
     c     FakKey        READE     FAKT                                   33
     c     *IN33         doweq     *OFF
     c     FAOPKO        IFGE      'F'
     c     FAKDA         ANDNE     'K'
     c     FASK          IFEQ      'S'
     c     FASK          OREQ      'K'
     c     FASK          OREQ      'X'
     C     TRSLAG        IFEQ      'HO'
      * 34 ON = Ikke avregningsfrakt = GEBYR
     C     GEBKEY        CHAIN     KODTGE                             34
     C  N34KGEAVR        COMP      'T'                                3434
     c     FAKUNR        IFEQ      BIKUNR
     C  N34              ADD       FABELN        BelFraEge
     C   34              ADD       FABELN        BelGebEge
     c                   else
     c  N34              ADD       FABELN        BelFraMot
     c                   end
     c                   else
      * hente/utk.oppdrag (betraktes alltid som gebyr)
     c     FAKUNR        IFEQ      BIKUNR
     C                   ADD       FABELN        BelGebEge
     c                   end
     c                   end
     c                   end
     c                   end
     c     FakKey        READE     FAKT                                   33
     c                   end
     c                   eval      Beltot = BelFraEge+BelGebEge+BelFraMot
     C                   endsr
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   OPEN      BRIDF
     C     USER          CHAIN     BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
OddEv * hent Parametre som går igjen i mange prog:
OddEv *      Odd/Even/Rowhead-farger,Logobilde,Språk,Intern/Ekstern bruker,  mm
OddEvc                   call      'ESGETPAR'
OddEvc                   parm                    BIBRID
OddEvc                   parm                    BIFIRM
OddEvc                   parm                    BIKUNR
OddEvc                   parm                    BIKNG
OddEvc                   parm                    RowHead          10
OddEvc                   parm                    Odd              10
OddEvc                   parm                    Even             10
OddEvc                   parm                    LogoImg          50
OddEvc                   parm                    XSPRÅK            2
OddEvc                   parm                    XINTERN           1
OddEvc                   parm                    ParmDS1        1024
OddEvc                   parm                    ParmDS2        1024
OddEvc                   parm                    ParmDS3        1024
      *
     C                   OPEN      head33
     C                   OPEN      fakt
     C                   OPEN      kodta
     C                   OPEN      kodtge
     C                   OPEN      kodtV
     C                   OPEN      BRSTF
     C                   OPEN      BRSTP
     C                   OPEN      cundl01
     C                   OPEN      CGIWSTI
      * Key for CUNDL01
     C     KunKey        KLIST
     C                   KFLD                    BIFIRM
     C                   KFLD                    BIKUNR
      * Key for head33
     C     FRAKEY        KLIST
     C                   KFLD                    BIKUNR
     C                   KFLD                    FRADT
      * Key for FAKT
     C     FAKKEY        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
      * Key for Workfile Sone-fordeling
     C     SoneKey       KLIST
     C                   KFLD                    CWUNIK
     C                   KFLD                    CWSONR
      * Key for Gebyrfil KODTGE
     C     GEBKEY        KLIST
     C                   KFLD                    KGEUNI
     C                   KFLD                    FAVK
     C                   MOVEL     'GE'          KGEUNI
      * Key for Avdelingsfil
     C     KODAKEY       KLIST
     C                   KFLD                    KOAUNI
     C                   KFLD                    HEAVD
     C                   MOVE      'A'           KOAUNI
      * Bruker/kunde-postnr.inndeling
     C     BRPKEY        KLIST
     C                   KFLD                    BIKUNR
     C                   KFLD                    MAID
     C                   KFLD                    XXPostnr          4 0
      * Bruker/kunde-postnr.inndeling
     C     BRPKEYE       KLIST
     C                   KFLD                    BIKUNR
     C                   KFLD                    MAID
      * Key for Stardard vektgrupper (firmastandard)
     c                   clear                   ff
     C     KODVKE        KLIST
     C                   KFLD                    KOVUNI
     C                   KFLD                    KOVAVD
     C                   MOVE      'V'           KOVUNI
     C                   MOVE      *ZEROS        KOVAVD
     C     bikunr        CHAIN     BRSTF                              33
     C   33KODVKE        CHAIN     KODTV                              33
     C                   MOVE      99999         FF(12)
     C                   MOVE      99999         FF(13)
N01   * dobbelttester at user virkelig er intern slik at ikke kreati skjel sender &avvkn=...
N01  c     AVVKNN        ifne      *zeros
N01  c     XINTERN       andeq     'J'
N01  C                   MOVE      AVVKNN        BIKUNR
N01  c                   end
     C     KunKey        CHAIN     Cundl01                            33
bhr   * Spesialvri for å kunne deme uten å avsløre kundenavn
bhr  c*                  MOVEL     USER          tstjov            4
bhr  c*    tstjov        ifeq      'JOVO'
bhr  c*                  eval      KNAVN  = 'Jan Ottar Valderhaug'
bhr  c*                  end
      *
     C                   eval      sessionid = getsessionid
     c                   exsr      TØMWRK
      *
     c                   eval      Denne  =  'all'
     c                   move      *zeros        DetteLnr          5 0
     C                   eval      Txtant  = 'Ant. Snd'
     C                   eval      Txtkll  = 'Ant. Kolli'
     C                   eval      Txtvkt  = 'Brt.vekt'
     C                   eval      Txtfvk  = 'F.b.vekt'
     C                   eval      Txtebl  = 'Frakt egen'
     C                   eval      Txtege  = 'Till.tjenester'
     C                   eval      Txtmbl  = 'Fr.Motpart'
     C                   eval      Txttbl  = 'Total kost'
      * Tillegs-kriterium.
     C                   select
     c     Retning       wheneq    'I'
     c                   eval      Pertxt2='Kun Import,'
     c     Retning       wheneq    'E'
     c                   eval      Pertxt2='Kun Eksport,'
     c     Retning       wheneq    'D'
     c                   eval      Pertxt2='Kun Innland,'
     c     Retning       wheneq    '3'
     c                   eval      Pertxt2='Kun 3.-land,'
     c                   other
     c                   eval      Pertxt2='                   '
     c                   endsl
     C     LK            ifne      *blank
     c                   eval      KunLKTxt = 'Kun LK:'
     c                   cat       KunLkTxt:1    PerTxt2
     c                   cat       LK:1          PerTxt2
     c                   end
      *
     C                   endsr
      *
      *******************************************
     C     TØMWRK        BEGSR
      *******************************************
      * Tøm workfil
     c     sessionid     setll     CGIWSTI
     c     sessionid     reade     CGIWSTI                                33
     c     *in33         doweq     *off
     c                   delete    CGIWSTIR
     c     sessionid     reade     CGIWSTI                                33
     c                   end
      *
     C                   endsr
      *
