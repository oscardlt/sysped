********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 SH  PTF12 dokumentkontroll ..
12XXX * 02 SH  PTF12 FEIL VED KUNDE 0
12XXX * 03 YBC PTF12 OMBEREGNING BRUKER POSITIV OPPDRAGSNR
12XXX * 04 SH  PTF12 skriver eventuelt kreditnota i emnerubrikk
12XXX * 05 SH  PTF12 forbedring kreditnota
12XXX * 06 SH  PTF12 transportøravregning tar aar/periode i arlink
12XXX * 07 SH  PTF12 cmr looper
12XXX * 08 SH  PTF12 test avdeling sad kundenummer 0
12XXX * 09 SH  PTF12 legger inn alfaparameter ved kall pdf020cl
12XXX * 10 SH  PTF12 evt epost av dokumentet advisering
********************************************************************
     H DECEDIT(',') debug(*yes)
      ***********************************************************
      *** PROGRAM for arkivering
      ***********************************************************
N01  FPRIK1     IF   E           K DISK
     FGSSORF    IF   E           K DISK
     FCDBOAT    IF   E           K DISK
     FGSSPOF    IF   E           K DISK
     FSAMCMRD   IF   E           K DISK
     FRUCKPU    UF   E           K DISK
     FKODTA     IF   E           K DISK
     FKODTOT2   IF   E           K DISK
     FCUSAPR    IF   E           K DISK
     FTRACKF    O  A E           K DISK
     FFRISOK    IF   E           K DISK
     FKODFRI    IF   E           K DISK
     FVADR1     IF   E           K DISK
     FSYPARL3   IF   E           K DISK
     FSADH      IF   E           K DISK
     FSAEH      IF   E           K DISK
     FSVIH      IF   E           K DISK
     FSVEH      IF   E           K DISK
     FDKIH      IF   E           K DISK
     FDKEH      IF   E           K DISK
     FARUSERL1  IF   E           K DISK
     FTRAVH3    IF   E           K DISK
     FTRAVH6    IF   E           K DISK
     F                                     RENAME(TRAVHR:TRAVHR2)
     FTRUV      IF   E           K DISK
     FSVXV      IF   E           K DISK    PREFIX(SVX_)
     FDKXV      IF   E           K DISK    PREFIX(DKX_)
     FDOKUF     IF   E           K DISK
     FDOKEC     IF   E           K DISK
     FDOKECe    IF   E           K DISK
     FTRAVV6    IF   E           K DISK
     Fcundl01   IF   E           K DISK
     FFAK8      IF   E           K DISK
     F                                     RENAME(faktr:faktr8)
     FFAK9      IF   E           K DISK
     FFIRM      IF   E           K DISK
     FARKEPO    UF A E           K DISK
     FARKTXT    IF   E           K DISK
     FTURER14   IF   E           K DISK
     FCUNDC03   IF   E           K DISK
     FFain      IF   E           K DISK
     Fhead14    IF   E           K DISK
     F                                     RENAME(HEADFR:HEAD14r)
     Fhead19    IF   E           K DISK
     F                                     RENAME(HEADFR:HEAD19r)
     Fheadf     IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FARKIVL01  UF A E           K DISK
     FARKIVL02  UF   E           K DISK
     F                                     RENAME(arkivr:arkivr2)
     FARKIVL06  IF   E           K DISK
     F                                     RENAME(arkivr:arkivr6)
     FKOSBU     IF   E           K DISK
     D                SDS
     D  UUSR                 254    263
     D                 DS
     D  av                     1     80  0
     D                                     DIM(20)
     D  CAVD                   1     80
      *
     D                 DS
     D  OTY                    1     10
     D                                     DIM(5)
     D  COPD                   1     10
      *
     D                 DS
     D  SIGN                   1     15
     D  TLAGER                 5      9
     D                 DS
     D  FADATO                 1      8  0
     D  FAAA                   3      4
     D  FAMM                   5      6
     D  FADG                   7      8
     D                 DS
     D  ARDATE                 1      8  0
     D  AAR                    1      4
     D  MND                    5      6
     D  DAG                    7      8
     D                 DS
     D  DFS                    1     10    DIM(10)
     D  FSDOKK                 1     10
     D                 DS
     D  DFRT                   1    210    DIM(3)
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     D                 DS
     D  avdopd                 1     11
     D  aravd                  1      4  0
     D  aropd                  5     11  0
     D                 DS
     D  ag                     1    800  0
     D                                     DIM(100)
     D                 DS
     D  hegn                   1     15
     D  hegn11                 5     15
     D                 DS
     D  V                      1     60
     D                                     DIM(30)
     D  arkved                 1     60
     D  V01                    1      2
     D  V02                    3      4
     D  V03                    5      6
     D  V04                    7      8
     D  V05                    9     10
     D  V06                   11     12
     D  V07                   13     14
     D  V08                   15     16
     D  V09                   17     18
     D  V10                   19     20
     D  V11                   21     22
     D  V12                   23     24
     D  V13                   25     26
     D  V14                   27     28
     D  V15                   29     30
     D  V16                   31     32
     D  V17                   33     34
     D  V18                   35     36
     D  V19                   37     38
     D  V20                   39     40
     D  V21                   41     42
     D  V22                   43     44
     D  V23                   45     46
     D  V24                   47     48
     D  V25                   49     50
     D  V26                   51     52
     D  V27                   53     54
     D  V28                   55     56
     D  V29                   57     58
     D  V30                   59     60
     D vedleggnc       C                   CONST('NCTS er sendt -
     D                                     som PDF-vedlegg')
     D vedlegglm       C                   CONST('Mottaksrapport er sendt -
     D                                     som PDF-vedlegg')
     D vedlegglm2      C                   CONST('Mottaksrapport er sendt -
     D                                     fra:')
     D vedleggf        C                   CONST('Fakturaen er sendt -
     D                                     som PDF-vedlegg')
n04  D vedleggfk       C                   CONST('Kreditnota er sendt -
n04  D                                     som PDF-vedlegg')
     D vedlegga        C                   CONST('Avregning er sendt -
     D                                     som PDF-vedlegg')
     D vedleggg        C                   CONST('Godsliste er sendt -
     D                                     som PDF-vedlegg')
     D vedleggt        C                   CONST('Tolldeklarasjon er sendt -
     D                                     som PDF-vedlegg')
     D vedleggu        C                   CONST('Utleveringsattest er sendt -
     D                                     som PDF-vedlegg')
     D vedleggs        C                   CONST('Fraktbrevet er sendt -
     D                                     som PDF-vedlegg')
     D vedleggaw       C                   CONST('Flyfraktbrev er sendt -
     D                                     som PDF-vedlegg')
     D vedleggcmr      C                   CONST('CMR er sendt -
     D                                     som PDF-vedlegg')
     D vedleggkk       C                   CONST('Meldeseddel er sendt -
     D                                     som PDF-vedlegg')
n10  D vedleggad       C                   CONST('Advisering er sendt -
n10  D                                     som PDF-vedlegg')
N01  D vedleggsd       C                   CONST('Dokumentkontroll er sendt -
N01  D                                     som PDF-vedlegg')
     D vedleggko       C                   CONST('Kostnadsoverslag er sendt -
     D                                     som PDF-vedlegg')
     D vedleggla       C                   CONST('Lasteliste er sendt -
     D                                     som PDF-vedlegg')
     D vedlegglo       C                   CONST('Losseliste er sendt -
     D                                     som PDF-vedlegg')
     D vedleggaen      C                   CONST('Arbeidsordre er sendt -
     D                                     som PDF-vedlegg')
     D trykknc         C                   CONST('Trykk på link for å -
     D                                     se på NCTS')
     D trykklm         C                   CONST('Trykk på link for å -
     D                                     se på Mottaksrapport')
     D trykkf          C                   CONST('Trykk på link for å -
     D                                     se på faktura')
     D trykka          C                   CONST('Trykk på link for å -
     D                                     se på avregning')
     D trykkg          C                   CONST('Trykk på link for å -
     D                                     se på godsliste')
     D trykkt          C                   CONST('Trykk på link for å -
     D                                     se på Tolldeklarasjon')
     D trykku          C                   CONST('Trykk på link for å -
     D                                     se på Utleveringsattest')
     D trykkcmr        C                   CONST('Trykk på link for å -
     D                                     se på Fraktbrevet')
     D trykkaw         C                   CONST('Trykk på link for å -
     D                                     se på flyfraktbrev')
     D trykks          C                   CONST('Trykk på link for å -
     D                                     se på CMR')
     D trykkkk         C                   CONST('Trykk på link for å -
     D                                     se på Meldeseddel')
n10  D trykkad         C                   CONST('Trykk på link for å -
n10  D                                     se på Advisering')
n01  D trykksd         C                   CONST('Trykk på link for å -
n01  D                                     se på Dokumentkontroll')
     D trykkko         C                   CONST('Trykk på link for å -
     D                                     se på Kostnadsoverslag')
     D trykkla         C                   CONST('Trykk på link for å -
     D                                     se på Lasteliste')
     D trykklo         C                   CONST('Trykk på link for å -
     D                                     se på Losseliste')
     D trykkaen        C                   CONST('Trykk på link for å -
     D                                     se på Arbeidsordre')
     D vedlegglme      C                   CONST('Receivereport is sent -
     D                                     as PDF-attachment')
     D vedleggnce      C                   CONST('NCTS is sendt -
     D                                     from:')
     D vedlegglm2e     C                   CONST('Receivereport is sendt -
     D                                     from:')
     D vedleggfe       C                   CONST('Invoice is sent as -
     D                                     PDF-attachment')
N04  D vedleggfek      C                   CONST('Creditnote is sent as -
N04  D                                     PDF-attachment')
     D vedleggae       C                   CONST('Avregning er sendt -
     D                                     som PDF-vedlegg')
     D vedleggge       C                   CONST('Waybill is sent as -
     D                                     PDF-attachment')
     D vedleggue       C                   CONST('Deliverycertificate is sent -
     D                                     as PDF-attachment')
     D vedleggte       C                   CONST('Cust.clearance is sent -
     D                                     as PDF-attachment')
     D vedleggse       C                   CONST('Waybill is sent as -
     D                                     PDF-attachment')
     D vedleggawe      C                   CONST('Airwaybill is sent as -
     D                                     PDF-attachment')
     D vedleggcmre     C                   CONST('CMR is sent -
     D                                     as PDF-attachment')
     D vedleggkke      C                   CONST('Arrivalnote is sent as -
     D                                     PDF-attachment')
N10  D vedleggade      C                   CONST('Advicenote is sent as -
N10  D                                     PDF-attachment')
N01  D vedleggsde      C                   CONST('Documentcontrol is sent as -
N01  D                                     PDF-attachment')
     D vedleggkoe      C                   CONST('Cost budget is sent as -
     D                                     PDF-attachment')
     D vedlegglae      C                   CONST('Loadinglist is sent as -
     D                                     PDF-attachment')
     D vedleggloe      C                   CONST('Unloadinglist is sent as -
     D                                     PDF-attachment')
     D vedleggaee      C                   CONST('Workorder is sent as -
     D                                     PDF-attachment')
     D trykknce        C                   CONST('Press link to open -
     D                                     NCTS')
     D trykklme        C                   CONST('Press link to open -
     D                                     receivereport')
     D trykkfe         C                   CONST('Press link to open -
     D                                     invoice')
     D trykkae         C                   CONST('Press link to open -
     D                                     invoice')
     D trykkge         C                   CONST('Press link to open -
     D                                     waybill')
     D trykkte         C                   CONST('Press link to open -
     D                                     cust.clearanse')
     D trykkue         C                   CONST('Press link to open -
     D                                     Delivery.certificate')
     D trykkcmre       C                   CONST('Press link to open -
     D                                     waybill')
     D trykkawe        C                   CONST('Press link to open -
     D                                     Airwaybill')
     D trykkse         C                   CONST('Press link to open -
     D                                     CMR')
     D trykkkke        C                   CONST('Press link to open -
     D                                     Arrivalnote')
n10  D trykkade        C                   CONST('Press link to open -
n10  D                                     Arrivalnote')
n01  D trykksde        C                   CONST('Press link to open -
n01  D                                     Documentcontrol')
     D trykkkoe        C                   CONST('Press link to open -
     D                                     Cost budget')
     D trykklae        C                   CONST('Press link to open -
     D                                     Loadinglist')
     D trykkloe        C                   CONST('Press link to open -
     D                                     Unloadinglist')
     D trykkaee        C                   CONST('Press link to open -
     D                                     Workorder')
     D                 DS
     D  UPARM2                 1     64
     D  UKJED                  1      8
     D  UPNR                   9     16
     D  UMRNR                 17     21
     D  UOPT                  22     22
     D  UKOPI                 23     23
     D  UPSDL                 24     30
     D                UDS
     D  UPARM1                 1   1024
     D  USG1                   1      3
     D  USD1                   4      8
     D  UDTIN1                 9     14
     D  UMN1                  15     31
     D  UDTSIN1               32     37
     D  UARKIV              1024   1024
      *
     c                   exsr      init
      *
     c     stny          tag
     c     key           chain     arkivl01                           34
     c     *in34         ifeq      '0'
      *
      * oppdater ARSTAT med 'X'
     c  N34              move      'X'           arstat
     c  N34              except    updark
     C                   MOVE      ARAVD         AAVD
     C                   MOVE      AROPD         AOPD
     C                   MOVE      ARKUND        AKUN              8
     c     keyhea        chain     headf                              44
     c                   move      *zeros        atur
     C  N44              MOVE      HEPRO         ATUR              8
     c     artype        ifeq      'go'
     C     ARTYPE        OREQ      'la'
     C     ARTYPE        OREQ      'lo'
     C                   movel     arunde        ATUR
     C                   end
      *
      * skjekker om frie søkeveier ved epost
      *
     c     artype        chain     arktxt                             33
     c  N33arksnd        ifeq      'J'
     c     epjn          andne     'U'
     c                   exsr      frisr
     c                   end
      * ny chain for senere oppdatering
     c  N34keya02        chain     arkivl02                           34
     c                   add       1             runde             5 0
     c**n34runde         comp      5                                  34
     c     *in34         ifeq      '0'
      *
      *mottaksrapport lagersystem
      *
     c     artype        ifeq      'lm'
     c                   exsr      pdflm
     c                   end
      *
      * Pakkseddel lagersystem
      *
     C                   IF        ARTYPE = 'ps'
     C                   EXSR      PDFPS
     C                   END
      *
      *faktura singel
      *
     c     artype        ifeq      'fa'
      * xfri=x betyr at annen bestilling kjører avbryt jobb
     c                   move      arunde        xxunde           10
     c                   exsr      pdfinv
      *
      *hent arkivpost
      *
     c                   move      arlink        xxlink           40
     C                   exsr      timesr
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     c     fins1         ifeq      'J'
     c                   move      xxlink        arlink
     c                   Move      'A'           arSTAT
     c                   update    arkivr2
     c                   else
     c     fafakt        setll     fak9
     c                   setoff                                       66
     c     les9n         tag
     c     fafakt        reade     fak9                                   66
     c     *in66         ifeq      '0'
     c     fakda         cabeq     'K'           les9n
     c                   end
     c                   Move      'E'           arSTAT
     c   34              move      'N'           arstat
     c                   update    arkivr2
     c                   end
     c                   seton                                        lr
     c                   return
     c                   end
      *
      *ferje faktura
      *
     c     artype        ifeq      'ff'
     c                   exsr      pdfff
     c                   end
      *
      *transportøravregning
      *
     c     artype        ifeq      'ta'
     c                   exsr      pdftran
     c                   end
      *
      *plukkliste
      *
     c     artype        ifeq      'pl'
     c                   exsr      pdfpl
     c                   end
      *
      *
      *proformafaktura
      *
     c     artype        ifeq      'pf'
     c                   exsr      pdfpf
     c                   end
      *
      *z-dokument til shipssystemet
      *
     c                   movel     artype        arty1             1
     c     arty1         ifeq      'Z'
     c                   exsr      pdfship
     c                   end
      *
      *Invoice basis
      *
     c     artype        ifeq      'ib'
     c                   exsr      pdfib
     c                   end
      *
      *Invoice basis
      *
     c     artype        ifeq      'te'
     c                   exsr      pdfte
     c                   end
      * SVENSK NCTS EXPORT
      *
     C                   IF        ARTYPE = 'ne'
     C                   EXSR      PDFNE
     C                   END
      * DANSK NCTS EXPORT
      *
     C                   IF        ARTYPE = 'D5'
     C                   EXSR      PDFD5
     C                   END
      *
      *samlefaktura
      *skriver alle refer til arkivfil
      *
     c     artype        ifeq      'fs'
     c                   delete    arkivr2
     c                   exsr      pdfinvs
     c                   end
      *
      *Ametaavregning
      *
     c     artype        ifeq      'aa'
     c                   delete    arkivr2
     c                   exsr      pdfame
     c                   end
      *
      *CMR
      *
     c     artype        ifeq      'cm'
     c                   exsr      pdfcmr
     c                   end
      *
      *stykkgodsfraktbrev
      *
     c     artype        ifeq      'sb'
     c                   exsr      pdffb
     c                   end
      *
      *sad import/eksport
      *
     c     artype        ifeq      'si'
     c     artype        oreq      'se'
     c                   exsr      pdfsad
     c                   end
      *
      *AWB FLYFRAKTBREV merkelapper
      *
     c     artype        ifeq      'al'
     c                   exsr      pdfawbl
     c                   end
      *
      *AWB FLYFRAKTBREV merkelapper
      *
     c     artype        ifeq      'lf'
     c                   exsr      pdfl1fa
     c                   end
      *
      *AWB FLYFRAKTBREV SINGEL
      *
     c     artype        ifeq      'aw'
     c                   exsr      pdfawb
     c                   end
      *
      *AWB FLYFRAKTBREV SINGEL
      *
     c     artype        ifeq      'am'
     c                   delete    arkivr2
     c                   exsr      pdfawbm
     c                   end
      *
      *Godsliste for land
     c     artype        ifeq      'go'
      * tur må ha oppdrag
     C                   MOVEL     ARUNDE        TUPRO             8 0
     c     tupro         chain     head14                             33
     c     *in33         ifeq      '1'
     c                   delete    arkivr2
     c                   goto      stny
     c                   end
     c                   exsr      pdfgods
     c                   delete    arkivr2
     c                   end
      *Lasteliste for land
     c     artype        ifeq      'la'
      * tur må ha oppdrag
     C                   MOVEL     ARUNDE        TUPRO             8 0
     c     tupro         chain     head14                             33
     c     *in33         ifeq      '1'
     c                   delete    arkivr2
     c                   goto      stny
     c                   end
     c                   exsr      pdflast
     c                   end
      *Losseliste for land import
     c     artype        ifeq      'lo'
      * tur må ha oppdrag
     C                   MOVEL     ARUNDE        TUPRO             8 0
     c     tupro         chain     head14                             33
     c     *in33         ifeq      '1'
     c                   delete    arkivr2
     c                   goto      stny
     c                   end
     c                   exsr      pdfloss
     c                   end
      *
      * MANIFEST FLY
     c     artype        ifeq      'mf'
     c                   delete    arkivr2
     c                   exsr      pdfman
     c                   end
      *
      * ADVISERING SJØ
      *
     C                   IF        ARTYPE = 'ad'
     C                   EXSR      PDFAD
     C                   END
      *
      * BOOKING SJØ
      *
     C                   IF        ARTYPE = 'bo'
     C                   EXSR      PDFBO
     C                   END
N01   *
N01   * SAD dokumentkontroll
N01   *
N01  C                   IF        ARTYPE = 'sd'
N01  C                   EXSR      PDFSD
N01  C                   END
      *
      * SAMLASTSPESIFIKASJON SJØ
      *
     C                   IF        ARTYPE = 'ss'
     C                   EXSR      PDFSS
     C                   END
      *
      * svensk fortolling import
     c     artype        ifeq      'SI'
     c     artype        oreq      'SE'
     c     artype        oreq      'S1'
     c     artype        oreq      'S2'
     c     artype        oreq      'S3'
     c     artype        oreq      'S4'
     c     artype        oreq      'SZ'
     c     artype        oreq      'S5'
     c                   exsr      pdfsve
     c                   end
      * dansk fortolling import
     c     artype        ifeq      'DI'
     c     artype        oreq      'DE'
     c     artype        oreq      'D1'
     c     artype        oreq      'D2'
     c     artype        oreq      'D3'
     c     artype        oreq      'D4'
     c                   exsr      pdfden
     c                   end
      * svensk utlæmningssedel
     c     artype        ifeq      'UT'
     c                   exsr      pdfutl
     c                   end
      *
      *
      * kjørekvittering
      *
     c     artype        ifeq      'kk'
     c                   exsr      pdfkk
     c                   end
      *
      *
      * kostnadsoverslag
      *
     c     artype        ifeq      'ko'
     c                   exsr      pdfko
     c                   end
      *
      * Arbeidsordre
      *
     c     artype        ifeq      'ae'
     c                   exsr      pdfae
     c                   end
      *
      * oppdaterer hvis ikke spesiallogikk på dokumentet
      *
     c     artype        ifne      'fs'
     c     artype        andne     'aa'
     c     artype        andne     'am'
     c     artype        andne     'te'
     c     artype        andne     'ne'
     c     artype        andne     'mf'
     c     artype        andne     'fa'
     c     artype        andne     'ss'
     c     artype        andne     'si'
     c     artype        andne     'se'
     c     artype        andne     'go'
     c     artype        andne     'D5'
     c     arty1         andne     'Z'
     c                   Move      'A'           arSTAT
     C                   exsr      timesr
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     c                   except    updark2
     c                   end
     c                   end
     c                   end
     c     slutt         tag
     c                   seton                                        lr
     c                   return
      *
     C***********************************************
     C     PDFCMR        BEGSR
     C***********************************************
      * CMR fraktbrev
      *
      * tester om norsk eller utenlandsk variant
      *
     c                   move      'NO'          cmrlan            2
     C     FILAND        COMP      *BLANKS                            2727
     C   27FILAND        COMP      'NO'                               2727
     c   27              move      'EU'          cmrlan
     c* ordner start av linken med forståelig info
     c*
     c     keyhea        chain     headf                              33
     c     keyhea        chain     dokec                              33
     c   33keyhea        chain     dokece                             33
     c     *in33         ifeq      '0'
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     c                   exsr      genbane
     C                   CALL      'PDF004CL'
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    cmrlan
     C                   PARM                    ARCINF
     C*
     c                   end
      *
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     c     arkund        ifeq      0
     c                   z-add     hekna         arkund
     c                   end
     c  N33arkund        ifne      0
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C     cmrtag        tag
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nestecmr      tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nestecmr
     C     KU0CMR        TAG
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     DCSNR         IFNE      *BLANKS
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Shipmentno:' wstex2
     c                   else
     C                   movel     'Sendingsnr:' wstex2
     c                   end
     C     wstex2        CAT       DCSNR:1       wstex2
     C                   END
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C  N33wstex2        cat       'To:':1       wstex2
     c                   else
     C  N33wstex2        cat       'Til:':1      wstex2
     c                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'CMR from'    wscvp1
     c                   else
     C                   movel     'CMR fra'     wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkcmre     wscvp2
     c                   else
     C                   movel     trykkcmr      wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggcmre   wscvp2
     c                   else
     c                   movel     vedleggcmr    wscvp2
     c                   end
     C                   end
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
      *
      *  tester også fortollingsagent
     c     hekna         ifne      tuknt
     c     hekna         andne     *zeros
N07  c     tuknt         andne     *zeros
     c                   move      hekna         tuknt
     c                   goto      cmrtag
     c                   end
      *
      * eventuelt mail til seg selv   skjekk dette
      * gjøres kun 1 gang når kunde er ulik 0
      *
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0cmr
n08  C  N33              GOTO      KU0CMR
     C                   END
     C                   END
     c                   end
     c                   end
     C                   ENDSR
     C*
     C***********************************************
     C     PDFPF         BEGSR
     C***********************************************
      * Proforma faktura
      *
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   move      arunde        ucomm             1
     C                   MOVE      EPJN          UORDTYP           1
     c                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     c                   exsr      genbane
     C                   CALL      'PDF011CL'
     C                   PARM                    Avdopd
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     C                   PARM                    ARCINF
     c                   parm                    ucomm
     C                   PARM                    UORDTYP
     C*
      *
     C                   ENDSR
     C***********************************************
     C     PDFPL         BEGSR
     C***********************************************
      * Plukkliste skissysptem
      *
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     c                   exsr      genbane
     C                   CALL      'PDF036CL'
     C                   PARM                    Avdopd
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     C                   PARM                    ARCINF
      *
     C                   ENDSR
     C***********************************************
     C     PDFIB         BEGSR
     C***********************************************
      * Proforma faktura
      *
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     c                   exsr      genbane
     C                   CALL      'PDF012CL'
     C                   PARM                    Avdopd
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     C                   PARM                    ARCINF
     C*
      *
     C                   ENDSR
     C***********************************************
     C     PDFTE         BEGSR
     C***********************************************
      * Transittering eksport
      *
     c     truvk         klist
     c                   kfld                    aravdi
     c                   kfld                    aropdi
     c                   move      aravd         aravdi            4 0
     c                   move      aropd         aropdi            7 0
      *
      * fikser bane til vareliste = UBANEV
      *
     c                   move      *blanks       arlink
     c                   movel     'tf'          arlink
     C                   move      *blanks       ubanev           50
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     c                   exsr      genbane
     c                   move      *blanks       ubanev           50
     c                   movel     ubane         ubanev
     c                   move      *blanks       uhttpiv         152
     c                   movel     uhttpi        uhttpiv
     c                   move      *blanks       uhttpev         152
     c                   movel     uhttpe        uhttpev
     c                   movel     arlink        arlinkv          40
      *
     c* ordner start av linken med forståelig info  HOVEDARK
     c*
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     C                   MOVE      ARUNDE        TRETYP            1
     C                   MOVEl     ARUNDE        thPRO             8
     C                   MOVE      thpro         thPROn            8 0
     C                   z-add     thpron        hePRO
     c                   exsr      genbane
     c                   move      arlink        arlinkh          40
      *
      *
     C                   CALL      'PDF013CL'
     C                   PARM                    ARAVD
     C                   PARM                    AROPD
     C                   PARM                    TRETYP
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    varel             1
     c                   parm                    ubanev
     C                   PARM                    ARCINF
     C*
     c                   Move      'A'           arSTAT
     C                   exsr      timesr
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     c                   except    updark2
     c     varel         ifeq      'J'
     c                   move      'tf'          artype
     c                   movel     arlinkv       arlink
     c                   write     arkivr
      *tilbakestill
     c                   move      'te'          artype
     c                   movel     arlinkh       arlink
     c                   end
      *
      * hvis flere oppdrag inngår legges disse i arkivp
      *
      *oppdaterer mot alle eventuelle headingrecord
      *
     c                   setoff                                       35
     c     truvk         setll     truv
     c     *in35         doweq     '0'
     c     lesnyte       tag
     c     truvk         reade     truv                                   35
     c     *in35         ifeq      '0'
      *ikke skriv doble record
     c     tvavd2        ifeq      aravdi
     c     tvtdn2        andeq     aropdi
     c                   goto      lesnyte
     c                   end
      *ikke skriv 0 record
     c     tvavd2        ifeq      0
     c     tvtdn2        oreq      0
     c                   goto      lesnyte
     c                   end
     C                   MOVE      tvavd2        ARAVD
     C                   MOVE      tvtdn2        AROPD
     c                   move      'A'           arstat
     c                   write     arkivr
     c                   end
     c                   end
      *
      *oppdaterer vareliste  mot alle headingrecord
     c     varel         ifeq      'J'
     c                   eval      arlink=arlinkv
     c                   move      'tf'          artype
      *
     c                   setoff                                       35
     c     truvk         setll     truv
     c     *in35         doweq     '0'
     c     lesnytev      tag
     c     truvk         reade     truv                                   35
     c     *in35         ifeq      '0'
      *ikke skriv doble record
     c     tvavd2        ifeq      aravdi
     c     tvtdn2        andeq     aropdi
     c                   goto      lesnytev
     c                   end
      *ikke skriv 0 record
     c     tvavd2        ifeq      0
     c     tvtdn2        oreq      0
     c                   goto      lesnytev
     c                   end
     C                   MOVE      tvavd2        ARAVD
     C                   MOVE      tvtdn2        AROPD
     c                   move      'A'           arstat
     c                   write     arkivr
     c                   end
     c                   end
      *tilbakestill
     c                   move      'te'          artype
     c                   movel     arlinkh       arlink
     c                   end
      *
      *
     c     artype        chain     ARKTXT                             33
      *
      * SKAL skal ha en mail
      *
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C     tuknt         andne     0
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     nestete       tag
     c     mailk         reade     cundc03                                44
     c     *in44         ifeq      '0'
     c                   exsr      testep
     c   33              goto      nestete
     c     ku0tet        tag
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
     c* slett eventuellt gamle poster
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c                   move      *blanks       wstex1
     c     mailkk        CHAIN     CUNDL01                            33
     C                   movel     'NCTS:'       wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C     wstex2        CAT       thpro:1       wstex2
     C     wstex2        CAT       'Date':1      wstex2
     c                   else
     C     wstex2        CAT       afak:1        wstex2
     C     wstex2        CAT       'Dato':1      wstex2
     c                   end
     C     wstex2        CAT       DAG:1         wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       MND:0         wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       AAR:0         wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C  N33wstex2        cat       'To:':1       wstex2
     c                   else
     C  N33wstex2        cat       'Til:':1      wstex2
     c                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     C                   MOVE      *BLANKS       EPBANE
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      * skjekk om mailbruker  er intern
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
      *
      *Vareliste
      *
     c     Varel         ifeq      'J'
      *
      * skjekk om mailbruker  er intern
      *
     c                   movel     uhttpiv       eplink
     c                   movel     uhttpev       epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANEV
     C                   END
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   move      *blanks       wstex1           30
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   moveL     'Goodslist'   wste13           13
     c                   else
     c                   moveL     'Vareliste'   wste13           13
     c                   end
     c                   moveL     wste13        wstex1           30
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     c                   end
     C                   move      *blanks       wscvp1
     C                   movel     'NCTS '       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C     wscvp1        cat       'from':1      wscvp1
     c                   else
     C     wscvp1        cat       'fra':1       wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C                   move      *blanks       wscvp2
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykknce      wscvp2
     c                   else
     C                   movel     trykknc       wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggnce    wscvp2
     c                   else
     c                   movel     vedleggnc     wscvp2
     c                   end
     C                   end
      *
      * sender epost
      *
     C                   EXSR      EPOSTSR
     C                   CLEAR                   trackfr
     C                   eval      tttext='emailed NCTS to:'
     C                   movel     CEMAIL        CEMA50           50
     C     tttext        cat       CEMA50:1      tttext
     C                   move      CCOMPN        tttext
     C                   eval      tttexl='Epost av NCTS til:'
     C     tttexl        cat       CEMA50:1      tttexl
     C                   move      CCOMPN        tttexl
     c                   movel     'N:'          ttdepo
     C                   move      THPRO         ttdepo
     C                   EXSR      TTSRNC
     c                   end
     c                   end
     c                   end
      *
      * eventuelt mail til seg selv   skjekk dette
      * gjøres kun 1 gang når kunde er ulik 0
      *
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0TET
n08  C  N33              GOTO      KU0TET
     C                   END
     c                   end
      *
     C                   ENDSR
     C*
     C***********************************************
     C     PDFNE         BEGSR
     C***********************************************
      * SVENSK NCTS EXPORT
      *
     C     SVXVK         klist
     C                   kfld                    xaravdi
     C                   kfld                    xaropdi
     C                   move      aravd         xaravdi           4 0
     C                   move      aropd         xaropdi           7 0
      * ordner start av linken med forståelig info
      *
     C                   move      *blanks       arlink
     C                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     C                   MOVE      ARUNDE        TRETYP            1
     C                   MOVEl     ARUNDE        thPRO             8
     C                   MOVE      thpro         thPROn            8 0
     C                   z-add     thpron        hePRO
     C                   exsr      genbane
      *
      * fikser bane til vareliste = UBANEV
      *
     C                   move      arlink        arlinkv          40
     C                   movel     'nv'          arlinkv
     C                   move      *blanks       ubanev           50
     C                   movel     ubanesta      ubanev
     C     ubanev        CAT       arlinkv:0     ubanev
     C     ubanev        CAT       '.pdf':0      ubanev
     C                   move      aravd         xaravdA           4
     C                   move      aropd         xaropdA           7
     C                   CALL      'PDF018CL'
     C                   PARM                    XARAVDA
     C                   PARM                    XAROPDA
     C                   PARM                    TRETYP
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     C                   parm                    varel             1
     C                   parm                    ubanev
     C                   PARM                    ARCINF
      *
     C                   Move      'A'           arSTAT
     C                   exsr      timesr
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     c                   except    updark2
     C     varel         ifeq      'J'
     C                   move      'nv'          artype
     C                   movel     'nv'          arlink
     C                   write     arkivr
      *tilbakestill
     C                   move      'ne'          artype
     C                   movel     'ne'          arlink
     C                   end
      *
      * hvis flere oppdrag inngår legges disse i arkivp
      *
     c*                  dump
      *oppdaterer mot alle eventuelle headingrecord
      *
     C                   setoff                                       35
     C     SVXVK         SETLL     SVXV
     C     *in35         doweq     '0'
     C     STPDFNE       TAG
     C     SVXVK         READE     SVXV                                   35
     C     *in35         ifeq      '0'
      *ikke skriv doble record
     c     tvavd2        ifeq      aravdi
     c     SVX_tvtdn2    andeq     aropdi
     c                   goto      STPDFNE
     c                   end
      *ikke skriv 0 record
     c     tvavd2        ifeq      0
     c     SVX_tvtdn2    oreq      0
     c                   goto      STPDFNE
     c                   end
     C                   MOVE      Tvavd2        ARAVD
     C                   MOVE      SVX_tvtdn2    AROPD
     c                   move      'A'           arstat
     c                   write     arkivr
     C                   end
     C                   end
      *
      *oppdaterer vareliste  mot alle headingrecord
     C     varel         ifeq      'J'
     C                   movel     'nv'          arlink
     C                   move      'nv'          artype
      *
     C                   setoff                                       35
     C     SVXVK         SETLL     SVXV
     C     *in35         doweq     '0'
     C     STPDFNE2      TAG
     C     SVXVK         READE     SVXV                                   35
     C     *in35         ifeq      '0'
      *ikke skriv doble record
     C     tvavd2        ifeq      aravdi
     C     SVX_tvtdn2    andeq     aropdi
     C                   goto      STPDFNE2
     C                   end
      *
     C     tvavd2        ifeq      0
     C     SVX_tvtdn2    oreq      0
     C                   goto      STPDFNE2
     C                   end
     C                   MOVE      tvavd2        ARAVD
     C                   MOVE      SVX_tvtdn2    AROPD
     C                   move      'A'           arstat
     C                   write     arkivr
     C                   end
     C                   end
      *tilbakestill
     C                   move      'ne'          artype
     C                   movel     'ne'          arlink
     C                   end
      *
     C                   ENDSR
      ***********************************************
     C     PDFD5         BEGSR
      ***********************************************
      * DANSK NCTS EXPORT

     C     DKXVK         klist
     C                   kfld                    xaravdi
     C                   kfld                    xaropdi
     C                   move      aravd         xaravdi           4 0
     C                   move      aropd         xaropdi           7 0
      * ordner start av linken med forståelig info

     C                   move      *blanks       arlink
     C                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     C                   MOVE      ARUNDE        TRETYP            1
     C                   MOVEl     ARUNDE        thPRO             8
     C                   MOVE      thpro         thPROn            8 0
     C                   z-add     thpron        hePRO
     C                   exsr      genbane

      * fikser bane til vareliste = UBANEV

     C                   move      arlink        arlinkv          40
     C                   movel     'D6'          arlinkv
     C                   move      *blanks       ubanev           50
     C                   movel     ubanesta      ubanev
     C     ubanev        CAT       arlinkv:0     ubanev
     C     ubanev        CAT       '.pdf':0      ubanev
     C                   move      aravd         xaravdA           4
     C                   move      aropd         xaropdA           7
     C                   CALL      'PDF038CL'
     C                   PARM                    XARAVDA
     C                   PARM                    XAROPDA
     C                   PARM                    TRETYP
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     C                   parm                    varel             1
     C                   parm                    ubanev
     C                   PARM                    ARCINF

     C                   Move      'A'           arSTAT
     C                   exsr      timesr
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     c                   except    updark2
     C     varel         ifeq      'J'
     C                   move      'D6'          artype
     C                   movel     'D6'          arlink
     C                   write     arkivr
      *tilbakestill
     C                   move      'D5'          artype
     C                   movel     'D5'          arlink
     C                   end
      *
      * hvis flere oppdrag inngår legges disse i arkivp
      *oppdaterer mot alle eventuelle headingrecord
      *
     C                   setoff                                       35
     C     DKXVK         SETLL     DKXV
     C     *in35         doweq     '0'
     C     STPDFD5       TAG
     C     DKXVK         READE     DKXV                                   35
     C     *in35         ifeq      '0'
      *ikke skriv doble record
     c     tvavd2        ifeq      aravdi
     c     DKX_tvtdn2    andeq     aropdi
     c                   goto      STPDFD5
     c                   end
      *ikke skriv 0 record
     c     tvavd2        ifeq      0
     c     SVX_tvtdn2    oreq      0
     c                   goto      STPDFD5
     c                   end
     C                   MOVE      Tvavd2        ARAVD
     C                   MOVE      DKX_tvtdn2    AROPD
     c                   move      'A'           arstat
     c                   write     arkivr
     C                   end
     C                   end
      *
      *oppdaterer vareliste  mot alle headingrecord
     C     varel         ifeq      'J'
     C                   movel     'D6'          arlink
     C                   move      'D6'          artype
      *
     C                   setoff                                       35
     C     DKXVK         SETLL     DKXV
     C     *in35         doweq     '0'
     C     STPDFD52      TAG
     C     DKXVK         READE     DKXV                                   35
     C     *in35         ifeq      '0'
      *ikke skriv doble record
     C     tvavd2        ifeq      aravdi
     C     DKX_tvtdn2    andeq     aropdi
     C                   goto      STPDFD52
     C                   end
      *ikke skriv 0 record
     C     tvavd2        ifeq      0
     C     DKX_tvtdn2    oreq      0
     C                   goto      STPDFD52
     C                   end
     C                   MOVE      tvavd2        ARAVD
     C                   MOVE      DKX_tvtdn2    AROPD
     C                   move      'A'           arstat
     C                   write     arkivr
     C                   end
     C                   end
      *tilbakestill
     C                   move      'D5'          artype
     C                   movel     'D5'          arlink
     C                   end

     C                   ENDSR
     C***********************************************
     C     PDFAWB        BEGSR
     C***********************************************
      * AWB flyfraktbrev
     c     keyhea        chain     headf                              33
     c     *in33         ifeq      '0'
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     arunde        uulope            3
     C     arlink        CAT       aar:0         arlink
     c     hegn11        ifne      *blanks
     c     hegn11        andne     *zeros
     C     arlink        CAT       hegn11:0      arlink
     c                   else
     C     arlink        CAT       avdopd:0      arlink
     c                   end
     c                   exsr      genbane
     C                   CALL      'PDF007CL'
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    uulope
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
      *
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     c  N33arkund        ifne      0
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nesteawb      tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nesteawb
     C     KU0AWB        TAG
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'AWB-number:' wstex2
     c                   else
     C                   movel     'AWB-nummer:' wstex2
     c                   end
     C     wstex2        CAT       hegn11:1      wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C  N33wstex2        cat       'From:':1     wstex2
     c                   else
     C  N33wstex2        cat       'Fra:':1      wstex2
     c                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Airwaybill'  wscvp1
     C     wscvp1        cat       'from:':0     wscvp1
     c                   else
     C                   movel     'Flyfraktbrev'wscvp1
     C     wscvp1        cat       'fra:':0      wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkawe      wscvp2
     c                   else
     C                   movel     trykkaw       wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggawe    wscvp2
     c                   else
     c                   movel     vedleggaw     wscvp2
     c                   end
     C                   end
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
      * eventuelt mail til seg selv
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0AWB
n08  C  N33              GOTO      KU0AWB
     C                   END
     C                   END
     c                   end
     c                   end
     c                   end
     C*
     C                   ENDSR
     C***********************************************
     C     PDFSHIP       BEGSR
     C***********************************************
      * vedlegg til shipssystem
     c                   Move      'A'           arSTAT
     C                   exsr      timesr
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     c                   update    arkivr2
     c                   exsr      genbane
     c                   move      arunde        ssordre           7 0
     c                   move      ssordre       oronoa            7
     c     ssordre       chain     gssorf                             33
     c  N33orbcd         chain     cdboat                             33
     c  N33ssordre       chain     gsspof                             33
      *
      * skal kunde ha mail
      *
     c  N33arkund        ifne      0
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nesteship     tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nesteship
     C     KU0SHIP       TAG
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'OUR orderno:'wstex2
     c                   else
     C                   movel     'Vår ordre:'  wstex2
     c                   end
     C     wstex2        CAT       oronoa:1      wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
      *  PO number & vessel name
     C                   movel     'POnbr:'      wscvp1
     C     wscvp1        cat       pocono:1      wscvp1
     C     wscvp1        cat       'vessel:':1   wscvp1
     C     wscvp1        cat       CBNAB:1       wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   eval      wscvp2='Press link!'
     c                   else
     C                   eval      wscvp2='Trykk på lenke!'
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   eval      wscvp2='Document attached!'
     c                   else
     C                   eval      wscvp2='Dokument vedlagt!'
     c                   end
     C                   end
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
      * eventuelt mail til seg selv
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
      *
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0SHIP
n08  C  N33              GOTO      KU0SHIP
     C                   END
     C                   END
     c                   end
     c                   end
     C                   ENDSR
     C***********************************************
     C     PDFAWBL       BEGSR
     C***********************************************
     C                   MOVEL     *blanks       uuSAM             6
      * AWB flyfraktbrev
     c     keyhea        chain     headf                              33
     c     *in33         ifeq      '0'
     c                   movel     hesaml        uusam
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     arunde        uulope            3
     C     arlink        CAT       aar:0         arlink
     c     hegn11        ifne      *blanks
     c     hegn11        andne     *zeros
     C     arlink        CAT       hegn11:0      arlink
     c                   else
     C     arlink        CAT       avdopd:0      arlink
     c                   end
     c                   exsr      genbane
     C                   CALL      'PDF034CL'
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    uulope
     C                   PARM                    uusam
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
      *
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     c  N33arkund        ifne      0
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nesteawbl     tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nesteawbl
     C     KU0AWBL       TAG
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'AWB-number:' wstex2
     c                   else
     C                   movel     'AWB-nummer:' wstex2
     c                   end
     C     wstex2        CAT       hegn11:1      wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C  N33wstex2        cat       'From:':1     wstex2
     c                   else
     C  N33wstex2        cat       'Fra:':1      wstex2
     c                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Airwaybill'  wscvp1
     C     wscvp1        cat       'from:':0     wscvp1
     c                   else
     C                   movel     'Flyfraktbrev'wscvp1
     C     wscvp1        cat       'fra:':0      wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkawe      wscvp2
     c                   else
     C                   movel     trykkaw       wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggawe    wscvp2
     c                   else
     c                   movel     vedleggaw     wscvp2
     c                   end
     C                   end
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
      * eventuelt mail til seg selv
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0AWBL
n08  C  N33              GOTO      KU0AWBL
     C                   END
     C                   END
     c                   end
     c                   end
     c                   end
     C*
     C                   ENDSR
     C***********************************************
     C     PDFL1FA       BEGSR
     C***********************************************
      * L1 fakturaer
     c                   movel     arunde        l1fanr            7
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       l1fanr:0      arlink
     c                   exsr      genbane
     C                   CALL      'PDF035CL'
     C                   PARM                    L1fanr
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
      *
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     c  N33arkund        ifne      0
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nestel1fa     tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nestel1fa
     C     KU0L1FA       TAG
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'fakturanr:'  wstex2
     c                   else
     C                   movel     'Fakturanr:'  wstex2
     c                   end
     C     wstex2        CAT       l1fanr:1      wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C  N33wstex2        cat       'From:':1     wstex2
     c                   else
     C  N33wstex2        cat       'Fra:':1      wstex2
     c                   end
     C  N33wstex2        cat       fift:1        wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Invoiceno:'  wscvp1
     C     wscvp1        cat       l1fanr:1      wscvp1
     C     wscvp1        cat       'from:':1     wscvp1
     c                   else
     C                   movel     'Fakturanr:'  wscvp1
     C     wscvp1        cat       l1fanr:1      wscvp1
     C     wscvp1        cat       'fra:':1      wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkfe       wscvp2
     c                   else
     C                   movel     trykkf        wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggfe     wscvp2
     c                   else
     c                   movel     vedleggf      wscvp2
     c                   end
     C                   end
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
      * eventuelt mail til seg selv
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0L1FA
n08  C  N33              GOTO      KU0L1FA
     C                   END
     C                   END
     c                   end
     c                   end
     C                   ENDSR
     C***********************************************
     C     PDFAWBM       BEGSR
     C***********************************************
      * samlast fly
     c                   Move      'A'           arSTAT
     C                   MOVEL     ARUNDE        samlnr            6
     c                   movel     samlnr        saml1             3
     c                   move      samlnr        saml2             3
     c                   move      aravd         xxavd             4
     c                   setoff                                       35
     c                   move      aravd         xxavd             4
     C                   MOVE      *zeros        ARAVD
     C                   MOVE      *zeros        AROPD
      *
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       samlnr:0      arlink
     c                   exsr      genbane
      *
     C                   CALL      'PDF008CL'
     C                   PARM                    XXavd
     C                   PARM                    saml1
     C                   PARM                    saml2
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
     C*
      *
      * skriver 1 record pr oppdrag ved Master samlast
      *
     c     samlnr        setll     head19
     c     *in35         doweq     '0'
     c     samlnr        reade     head19                                 35
     c     *in35         ifeq      '0'
     C                   MOVE      HEAVD         ARAVD
     C                   MOVE      HEOPD         AROPD
     c                   write     arkivr
     c                   end
     c                   end
      *
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     PDFKK         BEGSR
     C***********************************************
      * kjørekvittering
     c     keyhea        chain     headf                              33
     c     *in33         ifeq      '0'
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     arunde        uulope            3
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     c                   exsr      genbane
     C                   CALL      'PDF026CL'
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
      *
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     c  N33arkund        ifne      0
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nestekk       tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nestekk
     C     KU0KK         TAG
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Order:'      wstex2
     c                   else
     C                   movel     'Ordre:'      wstex2
     c                   end
     C     wstex2        CAT       aavd:1        wstex2
     C     wstex2        CAT       '/':0         wstex2
     C     wstex2        CAT       aopd:1        wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C     wstex2        cat       'From:':1     wstex2
     c                   else
     C     wstex2        cat       'Fra:':1      wstex2
     c                   end
     C     wstex2        cat       FIFT:1        wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Arrivalnote' wscvp1
     C     wscvp1        cat       'from:':1     wscvp1
     c                   else
     C                   movel     'Meldeseddel' wscvp1
     C     wscvp1        cat       'fra:':1      wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkkke      wscvp2
     c                   else
     C                   movel     trykkkk       wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggkke    wscvp2
     c                   else
     c                   movel     vedleggkk     wscvp2
     c                   end
     C                   end
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
      * eventuelt mail til seg selv
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0KK
n08  C  N33              GOTO      KU0KK
     C                   END
     C                   END
     c                   end
     c                   end
     c                   end
     C*
     C                   ENDSR
N01  C***********************************************
N01  C     PDFSD         BEGSR
N01  C***********************************************
N01   * dokumentkontroll
N01  c                   move      'SADI'        typesad           4
N01  c     keyhea        chain     sadh                               33
N01  c*
N01  c     *in33         ifeq      '0'
N01  c                   move      *blanks       arlink
N01  c                   movel     artype        arlink
N01  c                   movel     arunde        UMM               9 0
N01  C     arlink        CAT       aar:0         arlink
N03  C                   IF        AROPD < 0
N03  C                   EVAL      AROPD = AROPD * -1
N03  C     arlink        CAT       avdopd:0      arlink
N03  C                   EVAL      AROPD = AROPD * -1
N03  C                   ELSE
N01  C     arlink        CAT       avdopd:0      arlink
N03  C                   END
N01  c                   exsr      genbane
N01  c                   z-add     ARAVD         ARAVDN            4 0
N01  c                   z-add     AROPD         AROPDN            7 0
N01  C                   CALL      'PDF039CL'
N01  C                   PARM                    TYPESAD
N01  C                   PARM                    UMM
N01  C                   PARM                    ARAVDN
N01  C                   PARM                    AROPDN
N01  C                   PARM                    uhttpi
N01  C                   PARM                    ubane
N01  c                   parm                    vise
N01  c                   parm                    arcinf
n01   * oppdaterer gebyr på faktura
N01  C     KEYGENGE      KLIST
N01  C                   KFLD                    ALLE              8
N01  C                   KFLD                    HEFRGE            3
N01  C                   KFLD                    HEOTGE            2
N01  C                   move      '    ALLE'    ALLE
N01  C                   move      'GEN'         HEFRGE
N01  C                   move      'GE'          HEOTGE
N01   *
N01  c     keyhea        chain     headf                              33
N01  c     *in33         ifeq      '0'
N01  c     trslag        andne     'VF'
N01  c     trslag        andne     'FF'
N01  C                   Z-ADD     HEFBV         XINT              5 0
N01  c                   setoff                                       33
N01  c                   move      'N'           dokojn            1
N01  c     keygenge      setll     prik1
N01  c     *in33         doweq     '0'
N01  c     keygenge      reade     prik1                                  33
N01  c     *in33         ifeq      '0'
N01  c     pkkoll        andeq     'K'
N01  c                   move      'J'           dokojn
N01  c                   endif
N01  c                   enddo
N01  C     dokojn        ifeq      'J'
N01  C                   CALL      'SYFA10XG'
N01  c                   parm                    ARAVDN
N01  c                   parm                    AROPDN
N01  c                   parm                    xint
N01  c                   end
N01  c                   end
N01   *
N01  c     artype        chain     ARKTXT                             33
N01   *
N01   * skal kunde ha mail
N01   *
N01  c  N33arkund        ifne      0
N01  c                   z-add     arkund        tuknt
N01  C     ARKSND        IFEQ      'J'
N01  c     epjn          andne     'U'
N01  C                   MOVE      ARTXT         MAIL16           16
N01  C                   MOVEL     '*'           MAIL16
N01  c                   movel     MAIL16        mail30           30
N01  c                   moveL     artxt         wstex1           30
N01  c                   setoff                                       44
N01  c     mailk         setll     cundc03
N01  c     *in(44)       doweq     '0'
n01  c     nestesd       tag
N01  c     mailk         reade     cundc03                                44
N01  c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nestesd
N01  C     KU0SD         TAG
N01  c                   move      *blanks       eplink
N01  c                   move      *blanks       epline
N01  c                   move      *blanks       epbane
N01   *
N01   * slett eventuellt gamle poster
N01   *
N01  c                   exsr      delark
N01  c                   move      *blanks       wstex2
N01  c     mailkk        CHAIN     CUNDL01                            33
N01  C     spraak        ifeq      'E'
N01  c     spraak        oreq      'T'
N01  C                   movel     'Order:'      wstex2
N01  c                   else
N01  C                   movel     'Ordre:'      wstex2
N01  c                   end
N01  C     wstex2        CAT       aavd:1        wstex2
N01  C     wstex2        CAT       '/':0         wstex2
N01  C     wstex2        CAT       aopd:1        wstex2
N01  C     spraak        ifeq      'E'
N01  c     spraak        oreq      'T'
N01  C     wstex2        cat       'From:':1     wstex2
N01  c                   else
N01  C     wstex2        cat       'Fra:':1      wstex2
N01  c                   end
N01  C     wstex2        cat       FIFT:1        wstex2
N01  c                   move      uusr          epuser
N01  c                   movel     uhttpi        eplink
N01  c                   movel     uhttpe        epline
N01  C     CLIVE         IFEQ      'V'
N01  c                   eval      EPBANE = UBANE
N01  C                   END
N01   *
N01   * skjekk om mailbruker  er intern
N01   *
N01  C                   MOVE      'E'           inteks
N01  C     CEMAIL        CHAIN     ARUSERL1                           33
N01  C  N33arinek        ifeq      'I'
N01  C                   MOVE      'I'           inteks
N01  c                   end
N01  c                   moveL     wstex1        eptex1
N01  c                   move      wstex2        eptex2
N01  c                   write     arkepor
N01  C                   move      *blanks       wscvp1
N01  C     spraak        ifeq      'E'
N01  c     spraak        oreq      'T'
N01  C                   eval      wscvp1='documentcontrol'
N01  C     wscvp1        cat       'from:':1     wscvp1
N01  C     wscvp1        cat       'Customs':1   wscvp1
N01  c                   else
N01  C                   eval      wscvp1='Dokumentkontroll'
N01  C     wscvp1        cat       'fra:':1      wscvp1
N01  C     wscvp1        cat       'Tollen':1    wscvp1
N01  c                   end
N01  C     CLIVE         IFNE      'V'
N01  C     spraak        ifeq      'E'
N01  c     spraak        oreq      'T'
N01  C                   movel     trykksde      wscvp2
N01  c                   else
N01  C                   movel     trykksd       wscvp2
N01  c                   end
N01  C                   else
N01  C     spraak        ifeq      'E'
N01  c     spraak        oreq      'T'
N01  c                   movel     vedleggsde    wscvp2
N01  c                   else
N01  c                   movel     vedleggsd     wscvp2
N01  c                   end
N01  C                   end
N01  C                   EXSR      EPOSTSR
N01  c                   end
N01  c                   end
N01   * eventuelt mail til seg selv
N01  c     tuknt         ifne      0
N01  c                   z-add     0             tuknt
N01  c     mailk         chain     cundc03                            33
N01  C     *IN33         IFEQ      '0'
N01  c     CEMAIL        ifeq      '@user'
N01  c                   exsr      hentep
N01  C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0SD
n08  C  N33              GOTO      KU0SD
N01  C                   END
N01  C                   END
N01  c                   end
N01  c                   end
N01  c                   end
N01  C*
N01  C                   ENDSR
     C*
     C**************0********************************
     C     PDFKO         BEGSR
     C***********************************************
      * kostnadsoverslag
     c     keyhea        chain     headf                              33
     c     *in33         ifeq      '0'
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     arunde        uulope            3
     C                   MOVE      ARKUND        AKUN              8
     C     KUNKEY        CHAIN     CUNDL01                            33
     C     VALKOD        IFEQ      FICURR
     C                   MOVE      *BLANKS       SAVAL             3
     C                   ELSE
     C                   MOVE      VALKOD        SAVAL
     C                   END
     C                   MOVE      'A'           ANTKOK
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      ULDT          ULDT6
     C                   MOVE      *ZEROS        ULDNUL            6
     C                   MOVE      *ZEROS        YYFAKT
     C                   MOVEL     ARUNDE        YYFAKT
     C     ARKUND        CHAIN     CUSAPR                             33
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     c                   exsr      genbane
     C                   CALL      'PDF031CL'
     C                   PARM                    AKUN
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    YYFAKT            7
     C                   PARM                    SAVAL
     C                   PARM                    ANTKOK            1
     C                   PARM                    CPKOHE
     C                   PARM                    ULDT6             6
     C                   PARM                    ULDNUL
     C                   PARM                    CPKO
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
      *
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     c  N33arkund        ifne      0
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nesteko       tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nesteko
     C     KU0KO         TAG
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Order:'      wstex2
     c                   else
     C                   movel     'Ordre:'      wstex2
     c                   end
     C     wstex2        CAT       aavd:1        wstex2
     C     wstex2        CAT       '/':0         wstex2
     C     wstex2        CAT       aopd:1        wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C     wstex2        cat       'From:':1     wstex2
     c                   else
     C     wstex2        cat       'Fra:':1      wstex2
     c                   end
     C     wstex2        cat       FIFT:1        wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Costbudget'  wscvp1
     C     wscvp1        cat       'from:':1     wscvp1
     c                   else
     C                   movel     'Kostoverslag'wscvp1
     C     wscvp1        cat       'fra:':1      wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkkoe      wscvp2
     c                   else
     C                   movel     trykkko       wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggkoe    wscvp2
     c                   else
     c                   movel     vedleggko     wscvp2
     c                   end
     C                   end
     C                   EXSR      EPOSTSR
     C                   CLEAR                   trackfr
     C                   eval      tttext='emailed Costbudget:'
     C                   movel     CEMAIL        CEMA50           50
     C     tttext        cat       CEMA50:1      tttext
     C                   move      CCOMPN        tttext
     C                   eval      tttexl='Epost av kost.overslag:'
     C     tttexl        cat       CEMA50:1      tttexl
     C                   move      CCOMPN        tttexl
     c                   movel     'KOS'         ttdepo
     C                   MOVE      'EMA'         TTACTI
     C                   EXSR      TTSR
     c                   end
     c                   end
      * eventuelt mail til seg selv
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0KO
n08  C  N33              GOTO      KU0KO
     C                   END
     C                   END
     c                   end
     c                   end
     c                   end
     C                   ENDSR
     C*
     C***********************************************
     C     PDFAE         BEGSR
     C***********************************************
      * kjørekvittering
     c     keyhea        chain     headf                              33
     c     *in33         ifeq      '0'
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   movel     arunde        uulope            3
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       avdopd:0      arlink
     c                   exsr      genbane
     C                   CALL      'PDF027CL'
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
      *
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     c  N33arkund        ifne      0
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nestekkae     tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nestekkae
     C     KU0KKAE       TAG
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Order:'      wstex2
     c                   else
     C                   movel     'Ordre:'      wstex2
     c                   end
     C     wstex2        CAT       aavd:1        wstex2
     C     wstex2        CAT       '/':0         wstex2
     C     wstex2        CAT       aopd:1        wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C     wstex2        cat       'From:':1     wstex2
     c                   else
     C     wstex2        cat       'Fra:':1      wstex2
     c                   end
     C     wstex2        cat       FIFT:1        wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Workorder'   wscvp1
     C     wscvp1        cat       'from:':1     wscvp1
     c                   else
     C                   movel     'Arbeidsordre'wscvp1
     C     wscvp1        cat       'fra:':1      wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkaee      wscvp2
     c                   else
     C                   movel     trykkaen      wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggaee    wscvp2
     c                   else
     c                   movel     vedleggaen    wscvp2
     c                   end
     C                   end
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
      * eventuelt mail til seg selv
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0KKAE
n08  C  N33              GOTO      KU0KKAE
     C                   END
     C                   END
     c                   end
     c                   end
     c                   end
     C                   ENDSR
     C***********************************************
     C     PDFINV        BEGSR
     C***********************************************
     C     KEYOTY        KLIST
     C                   KFLD                    OTYKO             3
     C                   KFLD                    HEOT
     C                   MOVE      'O2Y'         OTYKO
     c     keyhea        chain     headf                              44
     C                   MOVEL     ARUNDE        AFAK              7
     C                   MOVEL     ARUNDE        fafakt
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       afak:0        arlink
     c                   move      'J'           fins1             1
     c                   move      'N'           fins2             1
     C*
     C     faktkk        KLIST
     C                   KFLD                    fifirm
     C                   KFLD                    fakunr
     C*
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
      *
      * Singel faktura til arkiv
      *
     C                   exsr      genbane
     C                   move      'A'           sinsam            1
     C                   CALL      'PDF006CL'
     C                   PARM                    AAVD
     C                   PARM                    AFAK
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    fins1
     c                   parm                    ubanes
     c                   parm                    fins2
     C                   PARM                    ARCINF
     c                   parm                    sinsam
      *
      * faktura må finnes
      *
     c     ubane         ifeq      'ERROR'
     c                   move      'N'           fins1
     c                   end
     C     fins1         ifeq      'J'
      *
      * skal kunde ha mail
      *
     c     fafakt        setll     fak9
     c                   setoff                                       66
     c     les9nb        tag
     c     fafakt        reade     fak9                                   66
     c     *in66         ifeq      '0'
     c     fakda         cabeq     'K'           les9nb
     c                   end
     c     *in(66)       ifeq      '0'
     c                   z-add     fakunr        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     c     arkund        andne     12345678
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     nestec        tag
     c     mailk         reade     cundc03                                44
     c     *in44         ifeq      '0'
     c                   exsr      testep
     c   33              goto      nestec
     c                   end
     c     *in(44)       ifeq      '0'
     C     KU0FAK        TAG
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
N04  C     frikfa        klist
N04  C                   kfld                    aravd
N04  C                   kfld                    aropd
N04  c                   kfld                    kreno
N05  c                   kfld                    krfak
N05  c                   movel     AFAK          krfak            35
N04  c                   move      'KRE'         kreno             3
N04  c     frikfa        chain     frisok                             33
N04  c  N33              move      'J'           kreditn           1
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
N04  c     kreditn       ifeq      ' '
     C                   movel     'Invoiceno:'  wstex2
     C     wstex2        CAT       afak:1        wstex2
     C     wstex2        CAT       'Invoiceda':1 wstex2
     C     wstex2        CAT       'te:':0       wstex2
N04  C                   else
N04  C                   movel     'Creditnote:' wstex2
N04  C     wstex2        CAT       afak:1        wstex2
N04  C     wstex2        CAT       'Creditnot':1 wstex2
N04  C     wstex2        CAT       'e date:':0   wstex2
N04  c                   end
     c                   else
N04  c     kreditn       ifeq      ' '
     C                   movel     'Fakturanr:'  wstex2
     C     wstex2        CAT       afak:1        wstex2
     C     wstex2        CAT       'fakturada':1 wstex2
     C     wstex2        CAT       'to:':0       wstex2
N04  c                   else
N04  C                   movel     'kreditnota:' wstex2
N04  C     wstex2        CAT       afak:1        wstex2
N04  C     wstex2        CAT       'Kreditnot':1 wstex2
N04  C     wstex2        CAT       'a dato:':0   wstex2
N04  c                   end
     c                   end
     C     wstex2        CAT       fadg:1        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       famm:0        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       faaa:0        wstex2
     C  N33spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C     wstex2        cat       'To:':1       wstex2
     C                   else
     C     wstex2        cat       'Til:':1      wstex2
     C                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
N04  c     kreditn       ifeq      ' '
     C                   movel     'Invoice from'wscvp1
N04  c                   else
N04  C                   movel     'Creditnote f'wscvp1
N04  C     wscvp1        cat       'rom':0       wscvp1
N04  c                   end
     C     wscvp1        CAT       ':':0         wscvp1
     c                   else
     c     KEYOTY        chain     KODTOT2                            33
     C     KO2NTX        ifeq      *blanks
N04  c     kreditn       ifeq      ' '
     C                   movel     'Faktura fra:'wscvp1
N04  c                   else
N04  C                   movel     'Kreditnota f'wscvp1
N04  C     wscvp1        cat       'ra:':0       wscvp1
N04  c                   end
     c                   else
     c                   eval      wscvp1=KO2NTX
     C     wscvp1        cat       'fra:':1      wscvp1
     c                   end
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     wscvp1        cat       '#':1         wscvp1
     C     wscvp1        CAT       afak:0        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkfe       wscvp2
     c                   else
     C                   movel     trykkf        wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
N04  c     kreditn       ifeq      ' '
     c                   movel     vedleggfe     wscvp2
N04  c                   else
N04  c                   movel     vedleggfek    wscvp2
N04  c                   end
     c                   else
N04  c     kreditn       ifeq      ' '
     c                   movel     vedleggf      wscvp2
N04  c                   else
N04  c                   movel     vedleggfk     wscvp2
N04  c                   end
     c                   end
     C                   end
     C                   EXSR      EPOSTSR
     C                   CLEAR                   trackfr
N04  c     kreditn       ifeq      ' '
     C                   eval      tttext='emailed invoice to:'
N04  c                   else
N04  C                   eval      tttext='emailed creditnote to:'
N04  c                   end
     C                   movel     CEMAIL        CEMA50           50
     C     tttext        cat       CEMA50:1      tttext
     C                   move      CCOMPN        tttext
N04  c     kreditn       ifeq      ' '
     C                   eval      tttexl='Epost av faktura til:'
N04  c                   else
N04  C                   eval      tttexl='Epost av kreditnota til:'
N04  c                   end
     C     tttexl        cat       CEMA50:1      tttexl
     C                   move      CCOMPN        tttexl
     c                   movel     'INV'         ttdepo
     C                   move      FAFAKT        ttdepo
     C                   MOVE      'EMA'         TTACTI
     C                   EXSR      TTSR
     c                   end
     c                   end
      *
      * eventuelt mail til seg selv   skjekk dette
      * gjøres kun 1 gang når kunde er ulik 0
      *
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c                   exsr      testep
     c   33              goto      utpdfi
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0FAK
n08  C  N33              GOTO      KU0fak
     C                   END
     C                   END
     c                   else
     c     arkund        ifeq      12345678
     c                   move      fakunr        arkund
     c                   end
     c                   end
     c                   end
     c                   end
     c                   end
     C     UTPDFI        ENDSR
     C***********************************************
     C     PDFFF         BEGSR
     C***********************************************
     C                   movel     arunde        afak              7
     C                   MOVEl     '0'           fffak             8
     C                   MOVE      afak          fffak
     C                   MOVEL     ARUNDE        fafakt
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   move      aar           ffaar             2
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       afak:0        arlink
     C*
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
      *
      * Singel faktura til arkiv
      *
     C                   exsr      genbane
     C                   CALL      'PDF015CL'
     C                   PARM                    fffak
     C                   PARM                    AAVD
     C                   PARM                    ffaar
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     C                   PARM                    ARCINF
     C*
     c                   end
     C                   ENDSR
     C***********************************************
     C     PDFINVS       BEGSR
     C***********************************************
      *
      * samlefaktura
     c                   move      aravd         xxavd
     c                   move      'J'           fins1             1
     c                   move      'J'           fins2             1
     c                   Move      'A'           arSTAT
     C                   MOVEL     ARUNDE        fifn
     C                   MOVEL     ARUNDE        AFAK              7
     C                   MOVEL     ARUNDE        fafakt
     c                   move      'A'           arstat
      * skal arkivering skje
      *
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
     c                   setoff                                       35
     c     fifn          chain     fain                               33
     c     xxavd         ifeq      *zeros
     c                   move      fiavd         xxavd             4
     c                   end
      *****************************************************************************
      * genererer bane til spesifikasjon
      *****************************************************************************
     C                   MOVE      *zeros        ARAVD
     C                   MOVE      *zeros        AROPD
      *
      * ordner start av linken med forståelig info
      *
     c                   move      *blanks       arlink
     c                   movel     'fx'          arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       afak:0        arlink
      *
     c                   exsr      genbane
     c                   move      *blanks       ubanes           50
     c                   movel     ubane         ubanes
     c                   move      *blanks       uhttpis         152
     c                   movel     uhttpi        uhttpis
     c                   move      *blanks       uhttpes         152
     c                   movel     uhttpe        uhttpes
     c                   movel     arlink        arlinks          40
      *
      * genererer bane til selve fakturaen
      *
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   movel     'fs'          arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       afak:0        arlink
      *
     c                   exsr      genbane
     c                   movel     arlink        arlinkf          40
      *
     C                   move      'C'           sinsam            1
     C                   CALL      'PDF006CL'
     C                   PARM                    XXavd
     C                   PARM                    AFAK
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    fins1
     c                   parm                    ubanes
     c                   parm                    fins2
     C                   PARM                    ARCINF
     C                   PARM                    SINSAM
     C*
      *
      * skriver 1 record pr oppdrag ved samlefaktura
      *
     c     fifn          setll     fain
     c     *in35         doweq     '0'
     c     fifn          reade     fain                                   35
     c     *in35         ifeq      '0'
     C     FAK8K2        KLIST
     C                   KFLD                    FIAVD
     C                   KFLD                    FIOPD
     C                   KFLD                    FIFN
     C     FAK8K2        CHAIN     FAK8                               33
     C     FAKDA         IFNE      'K'
     C     *IN33         OREQ      '1'
     C                   MOVE      FIAVD         ARAVD
     C                   MOVE      FIOPD         AROPD
      * faktura fins
     c     fins1         ifeq      'J'
     c                   move      'fs'          ARTYPE
     c                   movel     arlinkf       arlink
     C                   exsr      timesr
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     c                   write     arkivr
     c                   end
      * egen record hvis spesifikasjon
      * ved spesifikasjon skrives record
     c     fins2         ifeq      'J'
     c                   move      'fx'          ARTYPE
     c                   movel     arlinks       arlink
     c                   write     arkivr
     c                   move      'fs'          ARTYPE
     c                   end
     c                   end
     c                   end
     c                   end
      *
      * skal kunde ha mail av samlefaktura
      *
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
      *
      * SKAL skal ha en mail
      *
     c     fafakt        ifne      gmfakt
     c                   z-add     fafakt        gmfakt            7 0
     c     fafakt        setll     fak9
     c                   setoff                                       66
     c     les9nc        tag
     c     fafakt        reade     fak9                                   66
     c     *in66         ifeq      '0'
     c     fakda         cabeq     'K'           les9nc
     c                   end
     c     *in(66)       ifeq      '0'
     c                   z-add     fakunr        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     nestecs       tag
     c     mailk         reade     cundc03                                44
     c     *in44         ifeq      '0'
     c                   exsr      testep
     c   33              goto      nestecs
     c                   end
     c     *in(44)       ifeq      '0'
     c     ku0faks       tag
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
     c* slett eventuellt gamle poster
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c                   move      *blanks       wstex1
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Invoiceno:'  wstex2
     C     wstex2        CAT       afak:1        wstex2
     C     wstex2        CAT       'Invoiceda':1 wstex2
     C     wstex2        CAT       'te:':0       wstex2
     c                   else
     C                   movel     'Fakturanr:'  wstex2
     C     wstex2        CAT       afak:1        wstex2
     C     wstex2        CAT       'fakturada':1 wstex2
     C     wstex2        CAT       'to:':0       wstex2
     c                   end
     C     wstex2        CAT       fadg:1        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       famm:0        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       faaa:0        wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C  N33wstex2        cat       'To:':1       wstex2
     c                   else
     C  N33wstex2        cat       'Til:':1      wstex2
     c                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     C                   MOVE      *BLANKS       EPBANE
     c     fins1         ifeq      'J'
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      * skjekk om mailbruker  er intern
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     c                   end
      *
      *spesifikasjon
      *
     c     fins2         ifeq      'J'
      *
      * skjekk om mailbruker  er intern
      *
     c                   movel     uhttpis       eplink
     c                   movel     uhttpes       epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANES
     C                   END
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c     fins1         ifeq      'J'
     c                   move      *blanks       wstex1           30
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   moveL     'Spesificatio'wste13           13
     c                   move      'n'           wste13
     c                   else
     c                   moveL     'Spesifikasjo'wste13           13
     c                   move      'n'           wste13
     c                   end
     c                   moveL     wste13        wstex1           30
     c                   end
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     c                   end
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Invoice from'wscvp1
     C     wscvp1        cat       ':':0         wscvp1
     c                   else
     C                   movel     'Faktura fra:'wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     wscvp1        cat       '#':1         wscvp1
     C     wscvp1        CAT       afak:0        wscvp1
     C                   move      *blanks       wscvp2
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkfe       wscvp2
     c                   else
     C                   movel     trykkf        wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggfe     wscvp2
     c                   else
     c                   movel     vedleggf      wscvp2
     c                   end
     C                   end
      *
      * vedlegg FRA alle oppdrag
      *
     c                   setoff                                       35
     c     fifn          setll     fain
     c     *in35         doweq     '0'
     c     fifn          reade     fain                                   35
     c     *in35         ifeq      '0'
     C     FAK8K2        CHAIN     FAK8                               33
     C     FAKDA         IFNE      'K'
     C     *in33         oreq      'K'
     C                   MOVE      FIAVD         Aavd
     C                   MOVE      FIOPD         aopd
     C                   CALL      'ARC002V'
     C                   PARM                    ARTYPE
     C                   PARM                    Aavd
     C                   PARM                    Aopd
     C                   PARM                    ARKVED
     C                   PARM                    CLIVE
     C                   PARM                    arinek
     C                   PARM                    tuknt
     C                   END
     C                   END
     C                   END
     C                   move      'N'           k002v             1
     C                   EXSR      EPOSTSR
     C                   CLEAR                   trackfr
     C                   eval      tttext='emailed invoice to:'
     C                   movel     CEMAIL        CEMA50           50
     C     tttext        cat       CEMA50:1      tttext
     C                   move      CCOMPN        tttext
     C                   eval      tttexl='Epost av faktura til:'
     C     tttexl        cat       CEMA50:1      tttexl
     C                   move      CCOMPN        tttexl
     c                   movel     'INV'         ttdepo
     C                   move      FAFAKT        ttdepo
     C                   EXSR      TTSRSA
     c                   end
     c                   end
      *
      * eventuelt mail til seg selv   skjekk dette
      * gjøres kun 1 gang når kunde er ulik 0
      *
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0FAKS
n08  C  N33              GOTO      KU0fakS
     C                   END
     C                   END
     c                   end
     c                   end
     c                   end
     c                   end
     c                   end
     C                   ENDSR
     C*
     C***********************************************
     C     PDFAME        BEGSR
     C***********************************************
      *
      * Ametaavregning
     c                   move      aravd         xxavd
     c                   Move      'A'           arSTAT
     C                   MOVEL     ARUNDE        fifn
     C                   MOVEL     ARUNDE        AFAK              7
     C                   MOVEL     ARUNDE        fafakt
     c                   move      'A'           arstat
      *
     C     keyam         klist
     c                   kfld                    fiavd
     c                   kfld                    fiopd
      *
     c     fifn          chain     fain                               33
     C     keyam         chain     headf                              33
      * skal arkivering skje
      *
     c     artype        chain     ARKTXT                             33
     c                   setoff                                       35
     c     xxavd         ifeq      *zeros
     c                   move      fiavd         xxavd             4
     c                   end
      *****************************************************************************
      * genererer bane til fakturabilag
      *****************************************************************************
     C                   MOVE      *zeros        ARAVD
     C                   MOVE      *zeros        AROPD
      *
      * ordner start av linken med forståelig info
      *
     c                   move      *blanks       arlink
     c                   movel     'ab'          arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       afak:0        arlink
      *
     c                   exsr      genbane
     c                   move      *blanks       ubanes           50
     c                   movel     ubane         ubanes
     c                   move      *blanks       uhttpis         152
     c                   movel     uhttpi        uhttpis
     c                   move      *blanks       uhttpes         152
     c                   movel     uhttpe        uhttpes
     c                   movel     arlink        arlinks          40
      *
      * genererer bane til selve fakturaen
      *
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   movel     'aa'          arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       afak:0        arlink
      *
     c                   exsr      genbane
     c                   movel     arlink        arlinkf          40
      *
     C                   CALL      'PDF033CL'
     C                   PARM                    hepro
     C                   PARM                    arkund
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    ubanes
     C                   PARM                    ARCINF
     C                   PARM                    XXAVD
     C                   PARM                    AFAK
     C*
      *
      * skriver 1 record pr oppdrag ved samlefaktura
      *
     c     fifn          setll     fain
     c     *in35         doweq     '0'
     c     fifn          reade     fain                                   35
     c     *in35         ifeq      '0'
     C     FAK8K2        CHAIN     FAK8                               33
     C     FAKDA         IFNE      'K'
     C     *IN33         OREQ      '1'
     C                   MOVE      FIAVD         ARAVD
     C                   MOVE      FIOPD         AROPD
      * AMETAARKET aa
     c                   move      'aa'          ARTYPE
     c                   movel     arlinkf       arlink
     c                   write     arkivr
      * FAKTURA ab                   n
     c                   move      'ab'          ARTYPE
     c                   movel     arlinks       arlink
     c                   write     arkivr
     c                   move      'aa'          ARTYPE
     c                   end
     c                   end
     c                   end
      *
      * skal kunde ha mail av samlefaktura
      *
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
      *
      * SKAL skal ha en mail
      *
     c     fafakt        ifne      gmfakt
     c                   z-add     fafakt        gmfakt            7 0
     c     fafakt        setll     fak9
     c                   setoff                                       66
     c     les9ncA       tag
     c     fafakt        reade     fak9                                   66
     c     *in66         ifeq      '0'
     c     fakda         cabeq     'K'           les9ncA
     c                   end
     c     *in(66)       ifeq      '0'
     c                   z-add     fakunr        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     nestecsA      tag
     c     mailk         reade     cundc03                                44
     c     *in44         ifeq      '0'
     c                   exsr      testep
     c   33              goto      nestecsA
     c                   end
     c     *in(44)       ifeq      '0'
     c     ku0faksA      tag
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
     c* slett eventuellt gamle poster
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c                   move      *blanks       wstex1
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Invoiceno:'  wstex2
     C     wstex2        CAT       afak:1        wstex2
     C     wstex2        CAT       'Invoiceda':1 wstex2
     C     wstex2        CAT       'te:':0       wstex2
     c                   else
     C                   movel     'Fakturanr:'  wstex2
     C     wstex2        CAT       afak:1        wstex2
     C     wstex2        CAT       'fakturada':1 wstex2
     C     wstex2        CAT       'to:':0       wstex2
     c                   end
     C     wstex2        CAT       fadg:1        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       famm:0        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       faaa:0        wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C  N33wstex2        cat       'To:':1       wstex2
     c                   else
     C  N33wstex2        cat       'Til:':1      wstex2
     c                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     C                   MOVE      *BLANKS       EPBANE
     c     fins1         ifeq      'J'
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      * skjekk om mailbruker  er intern
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     c                   end
      *
      *spesifikasjon
      *
     c     fins2         ifeq      'J'
      *
      * skjekk om mailbruker  er intern
      *
     c                   movel     uhttpis       eplink
     c                   movel     uhttpes       epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANES
     C                   END
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c     fins1         ifeq      'J'
     c                   move      *blanks       wstex1           30
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   moveL     'Spesificatio'wste13           13
     c                   move      'n'           wste13
     c                   else
     c                   moveL     'Spesifikasjo'wste13           13
     c                   move      'n'           wste13
     c                   end
     c                   moveL     wste13        wstex1           30
     c                   end
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     c                   end
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Invoice from'wscvp1
     C     wscvp1        cat       ':':0         wscvp1
     c                   else
     C                   movel     'Faktura fra:'wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     wscvp1        cat       '#':1         wscvp1
     C     wscvp1        CAT       afak:0        wscvp1
     C                   move      *blanks       wscvp2
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkfe       wscvp2
     c                   else
     C                   movel     trykkf        wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggfe     wscvp2
     c                   else
     c                   movel     vedleggf      wscvp2
     c                   end
     C                   end
      *
      * vedlegg FRA alle oppdrag
      *
     c                   setoff                                       35
     c     fifn          setll     fain
     c     *in35         doweq     '0'
     c     fifn          reade     fain                                   35
     c     *in35         ifeq      '0'
     C                   MOVE      FIAVD         Aavd
     C                   MOVE      FIOPD         aopd
     C                   CALL      'ARC002V'
     C                   PARM                    ARTYPE
     C                   PARM                    Aavd
     C                   PARM                    Aopd
     C                   PARM                    ARKVED
     C                   PARM                    CLIVE
     C                   PARM                    arinek
     C                   PARM                    tuknt
     C                   END
     C                   END
     C                   move      'N'           k002v             1
     C                   EXSR      EPOSTSR
     C                   CLEAR                   trackfr
     C                   eval      tttext='emailed invoice to:'
     C                   movel     CEMAIL        CEMA50           50
     C     tttext        cat       CEMA50:1      tttext
     C                   move      CCOMPN        tttext
     C                   eval      tttexl='Epost av faktura til:'
     C     tttexl        cat       CEMA50:1      tttexl
     C                   move      CCOMPN        tttexl
     c                   movel     'INV'         ttdepo
     C                   move      FAFAKT        ttdepo
     C                   EXSR      TTSRSA
     c                   end
     c                   end
      *
      * eventuelt mail til seg selv   skjekk dette
      * gjøres kun 1 gang når kunde er ulik 0
      *
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0FAKSA
n08  C  N33              GOTO      KU0FAKSA
     C                   END
     C                   END
     c                   end
     c                   end
     c                   end
     c                   end
     C                   ENDSR
     C*
     C***********************************************
     C     PDFLM         BEGSR
     C***********************************************
      * lager mottaksrapport
      *
     c* ordner start av linken med forståelig info
     c*
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   z-add     arkund        fakunr
     c                   z-add     arkund        tuknt
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       arunde:0      arlink
     C*
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
      *
      * Mottaksrapport til arkiv
      *
     C                   exsr      genbane
      *
     C                   MOVE      'J'           ukopi
     c                   movel     arunde        umrnr
     c                   move      arkund        upnr
     c                   move      'E'           uopt
     c                   move      *zeros        ukjed
     c                   move      uparm2        uuparm           64
     C                   CALL      'PDF014CL'
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     C                   PARM                    ARCINF
     C                   PARM                    UPARM2
     C*
      *
      * skal kunde ha mail
      *
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nestelm       tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nestelm
     c     ku0lm         tag
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Reportno:'   wstex2
     C                   else
     C                   movel     'Rapportnr:'  wstex2
     c                   end
     C     wstex2        CAT       arunde:1      wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C  N33wstex2        cat       'To:':1       wstex2
     c                   else
     C  N33wstex2        cat       'Til:':1      wstex2
     c                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     vedlegglm2e   wscvp1
     c                   else
     C                   movel     vedlegglm2    wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykklme      wscvp2
     c                   else
     C                   movel     trykklm       wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedlegglme    wscvp2
     c                   else
     c                   movel     vedlegglm     wscvp2
     c                   end
     C                   end
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0LM
n08  C  N33              GOTO      KU0LM
     C                   END
     C                   END
     c                   end
     c                   end
     C                   ENDSR
      ***********************************************
     C     PDFPS         BEGSR
     C***********************************************
      * Logistikk pakkseddel
      *
      * ordner start av linken med forståelig info
      *
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     c                   z-add     arkund        fakunr
     c                   z-add     arkund        tuknt
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       arunde:0      arlink
      *
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
      *
      * Pakkseddel til arkiv
      *
     C                   exsr      genbane
      *
     C                   MOVE      'J'           ukopi
     c                   movel     arunde        upsdl
     c                   move      arkund        upnr
     c                   move      'E'           uopt
     c                   move      *zeros        ukjed
     c                   move      uparm2        uuparm           64
     C                   CALL      'PDF014CL'
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     C                   PARM                    ARCINF
     C                   PARM                    UPARM2
      *
      * skal kunde ha mail
      *
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nesteps       tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nesteps
     c     KU0PS         tag
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Reportno:'   wstex2
     C                   else
     C                   movel     'Rapportnr:'  wstex2
     c                   end
     C     wstex2        CAT       arunde:1      wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C  N33wstex2        cat       'To:':1       wstex2
     c                   else
     C  N33wstex2        cat       'Til:':1      wstex2
     c                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     vedlegglm2e   wscvp1
     c                   else
     C                   movel     vedlegglm2    wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykklme      wscvp2
     c                   else
     C                   movel     trykklm       wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedlegglme    wscvp2
     c                   else
     c                   movel     vedlegglm     wscvp2
     c                   end
     C                   end
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0PS
n08  C  N33              GOTO      KU0PS
     C                   END
     C                   END
     c                   end
     c                   end
      *
     C                   ENDSR
      *
     C***********************************************
     C     PDFGODS       BEGSR
     C***********************************************
      * SAMLE CMR
     C
      *****************************************************************************
      * genererer bane til SAMLWE CMR  HEOPD HAR LØPENUMMER
      *****************************************************************************
     C     aropd         IFNE      0
     c                   move      'F'           CMRBRU
     c                   move      'J'           CMR
     C                   MOVE      AROPD         SAMLOPA           7
     C                   MOVE      AROPD         SAMLOP            7 0
     C                   MOVE      *zeros        CMRKUN            8
     C                   MOVE      AROPD         CMRKUN
     C                   MOVE      *zeros        AROPD
      *
      * ordner start av linken med forståelig info
      *
     c                   move      *blanks       arlink
     c                   movel     'cs'          arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       samlopa:0     arlink
      *
     c                   exsr      genbane
     c                   move      *blanks       ubanec           50
     c                   movel     ubane         ubanec
     c                   move      *blanks       uhttpic         152
     c                   movel     uhttpi        uhttpic
     c                   move      *blanks       uhttpec         152
     c                   movel     uhttpe        uhttpec
     c                   movel     arlink        arlinkc          40
     c                   end
      *
      * Godsliste
      *
      *
      * SKAL GODSLISTE ARKIVERES
      *
      * sjekker om fraktbrevene skal lagres/sendes
     c                   move      'N'           gfjn              1
     c                   move      'N'           gfsnd             1
     c                   move      'gf'          artype
     c                   move      arkund        gokund            8 0
     c     artype        chain     arktxt                             33
     C  N33              move      arkjn         gfjn
     C  N33              move      arksnd        gfsnd
     c                   move      'go'          artype
      *
     C                   MOVEL     ARUNDE        TUPRO             8 0
     C                   MOVE      *BLANKS       ATUR10A          10
     C                   MOVE      *BLANKS       ATUR10T          10
     C                   MOVE      *BLANKS       ATUR10F          10
      *
      * hent arkivtekst
      *
     c     artype        chain     ARKTXT                             33
      *
     C  N33ARKJN         IFEQ      'J'
      *
     c                   move      'N'           vise              1
     c                   move      'T'           abeljn            1
     c                   move      'N'           adrjn             1
     c                   move      '1'           uin03             1
     c     tupro         chain     turer14                            13
     c                   Movel     'GODSLIST'    PRTNA            10
     C                   MOVE      tuavd         xxavd             4
     C                   MOVEL     ARUNDE        Atur              8
     C                   MOVEL     ARUNDE        Atur9             9
     C                   MOVEL     ATUR9         ATUR10T          10
     C     ATUR10T       CAT       'T':0         ATUR10T
     C                   MOVEL     ATUR9         ATUR10A          10
     C     ATUR10A       CAT       'A':0         ATUR10A
     C                   MOVEL     ATUR9         ATUR10F          10
     C     ATUR10F       CAT       'F':0         ATUR10F
      *
      * ordner start av linken med forståelig info
      * først eventuellt mot transportør
      * og lager selve godslista i PDF
      *
     c                   exsr      gengods
     c                   move      *blanks       arlinktra
     c                   movel     arlink        arlinktra        40
     c                   move      ubane         ubanegotr        50
     c
      *
      *
      * skriver 1 record pr opppdrag
      * Finn samtidig ut om det er agent(er) turen
      * og om fraktbrev finnes
      *
     c     cmr           ifne      'J'
     c                   exsr      skrivtur
     c                   else
     c                   exsr      skrivturc
     c                   end
      *
      * tester om agenter finnes på godslista
      * lager i så fall pdf
      *
     c     ag(1)         ifne      *zeros
     c                   move      'A'           abeljn            1
     c                   exsr      gengods
     c                   move      *blanks       arlinkage
     c                   movel     arlink        arlinkage        40
     c                   move      ubane         ubanegoag        50
     c                   end
      *
      *
      *
      * produserer samleliste  fraktbrev PDF hvis finnes
      *
     c     fbfins        ifeq      'J'
     c     gfjn          andeq     'J'
     c                   exsr      genfbpdf
     c                   end
      *
      * skal Transportør ha mail
      *
     c     mailk         klist
     c                   kfld                    fifirm
     c                   kfld                    mail30
     c                   kfld                    tuknt
     c     mailkk        klist
     c                   kfld                    fifirm
     c                   kfld                    tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
      *
      * spesial CMR for key
      *
     C     CMR           ifeq      'J'
     C     'cs'          chain     ARKTXT                             33
     C                   end
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
      * tilbakestill ved CMR
      *
     C     CMR           ifeq      'J'
     C     'go'          chain     ARKTXT                             33
     C                   end
      *
      * godsliste til transportør
      *
     c                   z-add     gokund        tuknt
     c                   move      'T'           gotype            1
     c                   exsr      godsmail
      *
      * Mail til agent?
      *
     c     1             do        99            nr                2 0
     c     ag(nr)        ifne      *zeros
     c     ag(nr)        andne     gokund
     c                   move      'A'           gotype            1
     c                   z-add     ag(nr)        tuknt
     c                   exsr      skrivtur2
     c                   exsr      godsmail
     c                   else
     c                   goto      utag
     c                   end
     c                   end
     c     utag          tag
      *
      *
     c                   end
     c                   end
     c*
     C                   ENDSR
     C***********************************************
     C     PDFLAST       BEGSR
     C***********************************************
      * Lasteliste
     c     artype        chain     ARKTXT                             33
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     C                   MOVEL     ARUNDE        TUPRO             8 0
     c     tupro         chain     turer14                            33
     c     *in33         ifeq      '0'
     c                   movel     tupro         atur
     c                   movel     tuavd         aavd
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       arunde:0      arlink
     c                   exsr      genbane
     C                   CALL      'PDF028CL'
     C                   PARM                    AAVD
     C                   PARM                    ATUR
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
      * sprer utover enkeltoppdragene
     c                   setoff                                       35
      *
     c     tupro         ifne      *zeros
     c     tupro         setll     head14
     c     *in35         doweq     '0'
     c     tupro         reade     head14                                 35
     c     *in35         ifeq      '0'
     C                   MOVE      heAVD         ARAVD
     C                   MOVE      heOPD         AROPD
     c                   move      'A'           arstat
     c                   write     arkivr
     c                   end
     c                   end
     c                   end
      *
      * skal kunde ha mail
      *
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     tuknt         cabeq     0             testlameg
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nestela       tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nestela
     C     KU0LA         TAG
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Trip:'       wstex2
     c                   else
     C                   movel     'Tur:'        wstex2
     c                   end
     C     wstex2        CAT       atur:1        wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C     wstex2        cat       'From:':1     wstex2
     c                   else
     C     wstex2        cat       'Fra:':1      wstex2
     c                   end
     C     wstex2        cat       FIFT:1        wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Loadinglist' wscvp1
     C     wscvp1        cat       'from:':1     wscvp1
     c                   else
     C                   movel     'Lasteliste'  wscvp1
     C     wscvp1        cat       'fra:':1      wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykklae      wscvp2
     c                   else
     C                   movel     trykkla       wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedlegglae    wscvp2
     c                   else
     c                   movel     vedleggla     wscvp2
     c                   end
     C                   end
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
      * eventuelt mail til seg selv
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     testlameg     tag
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0LA
n08  C  N33              GOTO      KU0LA
     C                   END
     C                   END
     c                   end
     c                   end
     C                   ENDSR
     C***********************************************
     C     PDFLOSS       BEGSR
     C***********************************************
      * Losseliste
     c     artype        chain     ARKTXT                             33
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     C                   MOVEL     ARUNDE        TUPRO             8 0
     c                   movel     hepro         atur
     c                   movel     heavd         aavd
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       arunde:0      arlink
     c                   exsr      genbane
     C                   CALL      'PDF029CL'
     C                   PARM                    AAVD
     C                   PARM                    ATUR
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
      * sprer utover enkeltoppdragene
     c                   setoff                                       35
      *
     c     hepro         setll     head14
     c     *in35         doweq     '0'
     c     hepro         reade     head14                                 35
     c     *in35         ifeq      '0'
     C                   MOVE      heAVD         ARAVD
     C                   MOVE      heOPD         AROPD
     c                   move      'A'           arstat
     c                   write     arkivr
     c                   end
     c                   end
      *
      * skal kunde ha mail
      *
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     tuknt         cabeq     0             testlomeg
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
N08  C     NESTELO       TAG
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nestelO
     C     KU0LO         TAG
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Trip:'       wstex2
     c                   else
     C                   movel     'Tur:'        wstex2
     c                   end
     C     wstex2        CAT       atur:1        wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C     wstex2        cat       'From:':1     wstex2
     c                   else
     C     wstex2        cat       'Fra:':1      wstex2
     c                   end
     C     wstex2        cat       FIFT:1        wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   eval      wscvp1='Unloadinglist'
     C     wscvp1        cat       'from:':1     wscvp1
     c                   else
     C                   movel     'Losseliste'  wscvp1
     C     wscvp1        cat       'fra:':1      wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkloe      wscvp2
     c                   else
     C                   movel     trykklo       wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggloe    wscvp2
     c                   else
     c                   movel     vedlegglo     wscvp2
     c                   end
     C                   end
     C*    ARKVED        IFNE      *BLANKS
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
      * eventuelt mail til seg selv
     c     tuknt         ifne      0
     c     testlomeg     tag
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0LO
n08  C  N33              GOTO      KU0LO
     C                   END
     C                   END
     c                   end
     C                   ENDSR
     C***********************************************
     C     PDFMAN        BEGSR
     C***********************************************
      * manifest fly
     c*
     c                   Move      'A'           arSTAT
     C                   MOVEL     ARUNDE        samlnr            6
     c                   movel     samlnr        saml1             3
     c                   move      samlnr        saml2             3
     c                   move      aravd         xxavd             4
     c                   setoff                                       35
     c                   move      aravd         xxavd             4
     C                   MOVE      *zeros        ARAVD
     C                   MOVE      *zeros        AROPD
      *
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       samlnr:0      arlink
     c                   exsr      genbane
      *
     C                   CALL      'PDF016CL'
     C                   PARM                    XXavd
     C                   PARM                    saml1
     C                   PARM                    saml2
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
     C*
      *
      * skriver 1 record pr oppdrag ved Master samlast
      *
     c     samlnr        setll     head19
     c     *in35         doweq     '0'
     c     samlnr        reade     head19                                 35
     c     *in35         ifeq      '0'
     C                   MOVE      HEAVD         ARAVD
     C                   MOVE      HEOPD         AROPD
     c                   write     arkivr
     c                   end
     c                   end
      *
     C                   ENDSR
     C***********************************************
     C     PDFSVE        BEGSR
     C***********************************************
      * SVENSK sad EKSPORT
     c     artype        ifeq      'SE'
     C                   MOVE      'E'           TDTYP             1
     c                   z-add     aropd         aropds
     c     keysve        chain     sveh                               33
     c  n33              move      SVEH_SYSG     signat            3
     c                   end
     c     artype        ifeq      'SI'
     C                   MOVE      'I'           TDTYP             1
     c                   z-add     aropd         aropds
     c     keysve        chain     svih                               33
     c  n33              move      SVIH_SYSG     signat            3
     c                   end
     c     artype        ifeq      'S1'
     c                   z-add     aropd         aropds
     c     keysve        chain     svih                               33
     c  n33              move      SVIH_SYSG     signat            3
     C                   MOVE      '1'           TDTYP             1
     c                   end
     c     artype        ifeq      'S2'
     c                   z-add     aropd         aropds
     c     keysve        chain     svih                               33
     c  n33              move      SVIH_SYSG     signat            3
     C                   MOVE      '2'           TDTYP             1
     c                   end
     c     artype        ifeq      'S3'
     c                   z-add     aropd         aropds
     c     keysve        chain     sveh                               33
     c  n33              move      SVEH_SYSG     signat            3
     c                   MOVE      '3'           TDTYP             1
     c                   end
     c     artype        ifeq      'S4'
     c                   z-add     aropd         aropds
     c     keysve        chain     sveh                               33
     c  n33              move      SVEH_SYSG     signat            3
     C                   MOVE      '4'           TDTYP             1
     c                   end
     C     ARTYPE        IFEQ      'SZ'
     C                   Z-ADD     AROPD         AROPDS
     C     KEYSVE        CHAIN     SVEH                               33
     C  N33              MOVE      SVEH_SYSG     signat            3
     C                   MOVE      'Z'           TDTYP             1
     C                   ENDIF
     C     ARTYPE        IFEQ      'S5'
     C                   Z-ADD     AROPD         AROPDS
     C     KEYSVE        CHAIN     SVEH                               33
     C  N33              MOVE      SVEH_SYSG     signat            3
     C                   MOVE      '5'           TDTYP             1
     C                   ENDIF
      * svensk import
     c*
     c                   Move      'A'           arSTAT
     C                   MOVE      AROPD         sveopd            7
     c                   move      aravd         xxavd             4
     c                   setoff                                       35
      *
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       xxavd:0       arlink
     C     arlink        CAT       sveopd:0      arlink
     c                   exsr      genbane
      *
     C                   CALL      'PDF017CL'
     C                   PARM                    XXavd
     C                   PARM                    sveopd
     C                   PARM                    TDTYP
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
     C*
      *
      * HENT VERDIER
      *
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c                   move      arkund        tuknt
     c                   move      arkund        fakunr
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     lesn02        tag
     c     mailk         reade     cundc03                                44
     c     *in44         ifeq      '0'
     c                   exsr      testep
     c   33              goto      lesn02
     c                   end
     c     *in(44)       ifeq      '0'
     c     cemail        ifeq      '@'
     c                   goto      lesn02
     c                   end
     c     ku0sve        tag
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Cust. cleara'wstex2
     C     wstex2        CAT       'nse':0       wstex2
     C  N33wstex2        cat       'To:':1       wstex2
     c                   else
     C                   movel     'Tolldeklaras'wstex2
     C     wstex2        CAT       'jon':0       wstex2
     C  N33wstex2        cat       'Til:':1      wstex2
     c                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
      *
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'cust cleara:'wscvp1
     C     wscvp1        cat       'nce from:':0 wscvp1
     c                   else
     C                   movel     'Tolldeklara:'wscvp1
     C     wscvp1        cat       'jon fra:':0  wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkfe       wscvp2
     c                   else
     C                   movel     trykkf        wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggfe     wscvp2
     c                   else
     c                   movel     vedleggf      wscvp2
     c                   end
     C                   end
     C                   movel     'Ref:'        wscvp3
     C     wscvp3        cat       aavd:1        wscvp3
     C     wscvp3        cat       '/':0         wscvp3
     C     wscvp3        cat       aopd:0        wscvp3
     C                   EXSR      EPOSTSR
     C                   END
     C                   END
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   move      *blanks       SYUSER
     c                   movel     signat        SYVRDA
     C     UsrKey        Chain     SYPARL3                            33
     c   33              goto      UTSVE
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0SVE
n08  C  N33              GOTO      KU0SVE
     C                   END
     C                   END
     C                   END
      *
     c     utsve         tag
      *
     C                   ENDSR
     C***********************************************
     C     PDFDEN        BEGSR
     C***********************************************
      * Dansk import/Export
     c     artype        ifeq      'DE'
     C                   MOVE      'E'           TDTYP             1
     c                   z-add     aropd         aropdd
     c     keydan        chain     dkeh                               33
     c  n33              move      DKEH_SYSG     signat            3
     c                   end
     c     artype        ifeq      'DI'
     C                   MOVE      'I'           TDTYP             1
     c                   z-add     aropd         aropdd
     c     keydan        chain     dkih                               33
     c  n33              move      DKIH_SYSG     signat            3
     c                   end
     c     artype        ifeq      'D1'
     c                   z-add     aropd         aropdd
     c     keydan        chain     dkih                               33
     c  n33              move      DKIH_SYSG     signat            3
     C                   MOVE      '1'           TDTYP             1
     c                   end
     c     artype        ifeq      'D2'
     c                   z-add     aropd         aropdd
     c     keydan        chain     dkih                               33
     c  n33              move      DKIH_SYSG     signat            3
     C                   MOVE      '2'           TDTYP             1
     c                   end
     c     artype        ifeq      'D3'
     c                   z-add     aropd         aropdd
     c     keydan        chain     DKIH                               33
     c  n33              move      DKIH_SYSG     signat            3
     C                   MOVE      '3'           TDTYP             1
     c                   end
     c     artype        ifeq      'D4'
     c                   z-add     aropd         aropdd
     c     keydan        chain     dkeh                               33
     c  n33              move      DKEH_SYSG     signat            3
     C                   MOVE      '4'           TDTYP             1
     c                   end
      * danks import
     c*
     c                   Move      'A'           arSTAT
     C                   MOVE      AROPD         danopd            7
     c                   move      aravd         xxavd             4
     c                   setoff                                       35
      *
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       xxavd:0       arlink
     C     arlink        CAT       danopd:0      arlink
     c                   exsr      genbane
      *
     C                   CALL      'PDF032CL'
     C                   PARM                    XXavd
     C                   PARM                    danopd
     C                   PARM                    TDTYP
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
     C*
      * Skal det skrives ref til extra sysped-oppdrag import ?
     C     ARTYPE        IFEQ      'DI'
     C     ARTYPE        OREQ      'D1'
     C     ARTYPE        OREQ      'D2'
     C     ARTYPE        OREQ      'D3'
     C     ARTYPE        OREQ      'D4'
     C                   EXSR      PDFDEN2
     C                   ENDIF
      *
      * HENT VERDIER
      *
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c                   move      arkund        tuknt
     c                   move      arkund        fakunr
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     lesnD2        tag
     c     mailk         reade     cundc03                                44
     c     *in44         ifeq      '0'
     c                   exsr      testep
     c   33              goto      lesnD2
     c                   end
     c     *in(44)       ifeq      '0'
     c     cemail        ifeq      '@'
     c                   goto      lesnD2
     c                   end
     c     ku0dan        tag
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Cust. cleara'wstex2
     C     wstex2        CAT       'nse':0       wstex2
     C  N33wstex2        cat       'To:':1       wstex2
     c                   else
     C                   movel     'Tolldeklaras'wstex2
     C     wstex2        CAT       'jon':0       wstex2
     C  N33wstex2        cat       'Til:':1      wstex2
     c                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
      *
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'cust cleara:'wscvp1
     C     wscvp1        cat       'nce from:':0 wscvp1
     c                   else
     C                   movel     'Tolldeklara:'wscvp1
     C     wscvp1        cat       'jon fra:':0  wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkfe       wscvp2
     c                   else
     C                   movel     trykkf        wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggfe     wscvp2
     c                   else
     c                   movel     vedleggf      wscvp2
     c                   end
     C                   end
     C                   movel     'Ref:'        wscvp3
     C     wscvp3        cat       aavd:1        wscvp3
     C     wscvp3        cat       '/':0         wscvp3
     C     wscvp3        cat       aopd:0        wscvp3
     C                   EXSR      EPOSTSR
     C                   END
     C                   END
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   move      *blanks       SYUSER
     c                   movel     signat        SYVRDA
     C     UsrKey        Chain     SYPARL3                            33
     c   33              goto      UTDAN
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0DAN
n08  C  N33              GOTO      KU0DAN
     C                   END
     C                   END
     C                   END
      *
     c     utdan         tag
      *
     C                   ENDSR
     C***********************************************
     C     PDFDEN2       BEGSR
     C***********************************************
     C     *LIKE         DEFINE    ARAVD         XAVDN
     C     *LIKE         DEFINE    AROPD         XOPDN
     C     *LIKE         DEFINE    FSKODE        WSKODE
     C                   MOVEL     '*CR'         WSKODE
     C     FRIKEY        KLIST
     C                   KFLD                    DKIH_SYAV
     C                   KFLD                    DKIH_SYOP
     C                   KFLD                    WSKODE
      * Finnes extern referanse ?
      * og er den et syspedoppdrag i egen database ?
      * Skriv da i tillegg til arkiv med en referansen
     C     FRIKEY        CHAIN     FRISOK                             91
     C     *IN91         CABEQ     *ON           PDFDEN29
      * Er dette avd + opd ?   Kan skrives 4/10168  eller 0004/0010168
     C     '/'           SCAN      FSSOK         WP                2 0
     C     WP            IFLE      1
     C     WP            ORGT      5
     C                   GOTO      PDFDEN29
     C                   ENDIF
      * Hent avd
     C                   SUB       1             WP
     C     WP            SUBST     FSSOK:1       XAVD              4
     C                   Z-ADD     0             XAVDN
      /free
        monitor                              ;
           xavdn = %dec(xavd:4:0)            ;
        on-error 105                         ;
        endmon                               ;
      /end-free
      * Hent opd
     C                   ADD       2             WP
     C     ' '           SCAN      FSSOK         WQ                2 0
     C                   SUB       1             WQ
     C     WQ            SUB       WP            WR                2 0
     C                   ADD       1             WR
     C     WR            SUBST     FSSOK:WP      XOPD              7
     C                   Z-ADD     0             XOPDN
      /free
        monitor                              ;
           xopdn = %dec(xopd:7:0)            ;
        on-error 105                         ;
        endmon                               ;
      /end-free
      * Skriv til ARKIVP
     C                   MOVE      XAVDN         ARAVD
     C                   MOVE      XOPDN         AROPD
     C                   WRITE     ARKIVR

     C     PDFDEN29      TAG
     C                   ENDSR
     C***********************************************
     C     PDFUTL        BEGSR
     C***********************************************
      * Utlæmningssedel
     c*
     c                   Move      'A'           arSTAT
     C                   MOVE      ARUNDE        TULLID           10
     c                   setoff                                       35
      *
     c                   move      *blanks       arlink
     c                   movel     artype        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       tullid:0      arlink
     c                   exsr      genbane
      *
     C                   CALL      'PDF019CL'
     C                   PARM                    TULLID
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     c                   parm                    arcinf
     C*
      *
      * HENT VERDIER
      *
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c                   move      arkund        tuknt
     c                   move      arkund        fakunr
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nesteutl      tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nesteutl
     C     KU0UTL        TAG
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Delivery not'wstex2
     C     wstex2        CAT       'e':0         wstex2
     C  N33wstex2        cat       'To:':1       wstex2
     c                   else
     C                   movel     'Utlæmningsse'wstex2
     C     wstex2        CAT       'del':0       wstex2
     C  N33wstex2        cat       'Til:':1      wstex2
     c                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
      *
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Delivery no:'wscvp1
     C     wscvp1        cat       'te from:':0  wscvp1
     c                   else
     C                   movel     'Utlæmningss:'wscvp1
     C     wscvp1        cat       'edel fra:':0 wscvp1
     C     wscvp1        cat       fift:1        wscvp1
     c                   end
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkfe       wscvp2
     c                   else
     C                   movel     trykkf        wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggfe     wscvp2
     c                   else
     c                   movel     vedleggf      wscvp2
     c                   end
     C                   end
     C                   movel     'Ref:'        wscvp3
     C     wscvp3        cat       aavd:1        wscvp3
     C     wscvp3        cat       '/':0         wscvp3
     C     wscvp3        cat       aopd:0        wscvp3
     C                   EXSR      EPOSTSR
     C                   END
     C                   END
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
S08  c*    CEMAIL        ANDNE     '@user'
S08  C*                  GOTO      KU0UTL
S08  C*                  END
N08  c     CEMAIL        ifeq      '@user'
N08  c                   exsr      hentep
N08  C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0UTL
n08  C  N33              GOTO      KU0UTL
     C                   END
     C                   END
     C                   END
      *
      *
     C                   ENDSR
      ***********************************************
     C     PDFAD         BEGSR
      ***********************************************
      * Advisering SJØ
      *
      * ordner start av linken med forståelig info
      *
     C                   EVAL      ARLINK = ARTYPE + AAR + AVDOPD + ARUNDE
     C                   EXSR      GENBANE
     C                   MOVE      ARAVD         UAVD              4
     C                   MOVE      AROPD         UOPD              7
     C                   MOVEL     ARUNDE        UNR               1
N09  c                   select
N09  c     unr           wheneq    '1'
N09  c                   move      'A'           unr
N09  c     unr           wheneq    '2'
N09  c                   move      'B'           unr
N09  c     unr           wheneq    '3'
N09  c                   move      'C'           unr
N09  c     unr           wheneq    '4'
N09  c                   move      'D'           unr
N09  c     unr           wheneq    '5'
N09  c                   move      'E'           unr
N09  c     unr           wheneq    '6'
N09  c                   move      'F'           unr
N09  c     unr           wheneq    '7'
N09  c                   move      'G'           unr
N09  c     unr           wheneq    '8'
N09  c                   move      'H'           unr
n09  C                   ENDSL
     C                   CALL      'PDF020CL'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UNR
     C                   PARM                    UBANE
     C                   PARM                    ARCINF
n10   *
n10   * skal kunde ha mail
n10   *
n10  c     artype        chain     ARKTXT                             33
n10  c  N33arkund        ifne      0
n10  c                   z-add     arkund        tuknt
n10  C     ARKSND        IFEQ      'J'
n10  c     epjn          andne     'U'
n10  C                   MOVE      ARTXT         MAIL16           16
n10  C                   MOVEL     '*'           MAIL16
n10  c                   movel     MAIL16        mail30           30
n10  c                   moveL     artxt         wstex1           30
n10  c                   setoff                                       44
n10  c     mailk         setll     cundc03
n10  c     *in(44)       doweq     '0'
n10  c     nestead       tag
n10  c     mailk         reade     cundc03                                44
n10  c     *in(44)       ifeq      '0'
n10  c                   exsr      testep
n10  c   33              goto      nestead
n10  C     KU0ad         TAG
n10  c                   move      *blanks       eplink
n10  c                   move      *blanks       epline
n10  c                   move      *blanks       epbane
n10   *
n10   * slett eventuellt gamle poster
n10   *
n10  c                   exsr      delark
n10  c                   move      *blanks       wstex2
n10  c     mailkk        CHAIN     CUNDL01                            33
n10  C     spraak        ifeq      'E'
n10  c     spraak        oreq      'T'
n10  C                   movel     'Order:'      wstex2
n10  c                   else
n10  C                   movel     'Ordre:'      wstex2
n10  c                   end
n10  C     wstex2        CAT       aavd:1        wstex2
n10  C     wstex2        CAT       '/':0         wstex2
n10  C     wstex2        CAT       aopd:1        wstex2
n10  C     spraak        ifeq      'E'
n10  c     spraak        oreq      'T'
n10  C     wstex2        cat       'From:':1     wstex2
n10  c                   else
n10  C     wstex2        cat       'Fra:':1      wstex2
n10  c                   end
n10  C     wstex2        cat       FIFT:1        wstex2
n10  c                   move      uusr          epuser
n10  c                   movel     uhttpi        eplink
n10  c                   movel     uhttpe        epline
n10  C     CLIVE         IFEQ      'V'
n10  c                   eval      EPBANE = UBANE
n10  C                   END
n10   *
n10   * skjekk om mailbruker  er intern
n10   *
n10  C                   MOVE      'E'           inteks
n10  C     CEMAIL        CHAIN     ARUSERL1                           33
n10  C  N33arinek        ifeq      'I'
n10  C                   MOVE      'I'           inteks
n10  c                   end
n10  c                   moveL     wstex1        eptex1
n10  c                   move      wstex2        eptex2
n10  c                   write     arkepor
n10  C                   move      *blanks       wscvp1
n10  C     spraak        ifeq      'E'
n10  c     spraak        oreq      'T'
n10  C                   movel     'Advicenote'  wscvp1
n10  C     wscvp1        cat       'from:':1     wscvp1
n10  c                   else
n10  C                   movel     'Advisering'  wscvp1
n10  C     wscvp1        cat       'fra:':1      wscvp1
n10  c                   end
n10  C     wscvp1        cat       fift:1        wscvp1
n10  C     CLIVE         IFNE      'V'
n10  C     spraak        ifeq      'E'
n10  c     spraak        oreq      'T'
n10  C                   movel     trykkade      wscvp2
n10  c                   else
n10  C                   movel     trykkad       wscvp2
n10  c                   end
n10  C                   else
n10  C     spraak        ifeq      'E'
n10  c     spraak        oreq      'T'
n10  c                   movel     vedleggade    wscvp2
n10  c                   else
n10  c                   movel     vedleggad     wscvp2
n10  c                   end
n10  C                   end
n10  C                   EXSR      EPOSTSR
n10  C                   eval      tttext='Email Advice:'
n10  C                   movel     CEMAIL        CEMA50           50
n10  C     tttext        cat       CEMA50:1      tttext
n10  C                   move      CCOMPN        tttext
n10  C                   eval      tttexl='Epost Advisering:'
n10  C     tttexl        cat       CEMA50:1      tttexl
n10  C                   move      CCOMPN        tttexl
n10  c                   movel     ARKUND        ttdepo
n10  C                   MOVE      'EMA'         TTACTI
n10  C                   EXSR      TTSR
n10  c                   end
n10  c                   end
n10   * eventuelt mail til seg selv
n10  c     tuknt         ifne      0
n10  c                   z-add     0             tuknt
n10  c     mailk         chain     cundc03                            33
n10  C     *IN33         IFEQ      '0'
n10  c     CEMAIL        ifeq      '@user'
n10  c                   exsr      hentep
n10  C                   END
n10  c                   exsr      testep
n10  C  N33              GOTO      KU0ad
n10  C                   END
n10  C                   END
n10  c                   end
n10  c                   end
      *
     C                   ENDSR
      *
      ***********************************************
     C     PDFBO         BEGSR
      ***********************************************
      * Booking SJØ
      *
      * ordner start av linken med forståelig info
      *
     C                   EVAL      ARLINK = ARTYPE + AAR + AVDOPD + ARUNDE
     C                   EXSR      GENBANE
     C                   MOVE      ARAVD         UAVD              4
     C                   MOVE      AROPD         UOPD              7
     C                   SELECT
     C                   WHEN      ARUNDE = 'OS'
     C                   MOVE      '1'           UNR               1
     C                   MOVEL     'PDF021CL'    XPGM             10
     C                   WHEN      ARUNDE = 'LO'
     C                   MOVE      '2'           UNR
     C                   MOVEL     'PDF021CL'    XPGM             10
     C                   WHEN      ARUNDE = 'TR'
     C                   MOVE      '3'           UNR
     C                   MOVEL     'PDF021CL'    XPGM             10
     C                   WHEN      ARUNDE = 'DE'
     C                   MOVE      '4'           UNR
     C                   MOVEL     'PDF021CL'    XPGM             10
     C                   WHEN      ARUNDE = 'TE'
     C                   MOVE      '5'           UNR
     C                   MOVEL     'PDF021CL'    XPGM             10
     C                   WHEN      ARUNDE = 'BB'
     C                   MOVE      '6'           UNR
     C                   MOVEL     'PDF022CL'    XPGM             10
     C                   WHEN      ARUNDE = 'LS'
     C                   MOVE      '7'           UNR
     C                   MOVEL     'PDF023CL'    XPGM             10
     C                   WHEN      ARUNDE = 'FM'
     C                   MOVE      '8'           UNR
     C                   MOVEL     'PDF024CL'    XPGM             10
     C                   ENDSL
     C                   CALL      XPGM
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UNR
     C                   PARM                    UBANE
     C                   PARM                    ARCINF
      *
     C                   ENDSR
      *
      ***********************************************
     C     PDFSS         BEGSR
      ***********************************************
      * Samlastspesifikasjon SJØ
      *
      * ordner start av linken med forståelig info
      *
     C                   EVAL      ARLINK = ARTYPE + AAR + %TRIM(USG1)
     C                             + %TRIM(USD1) + ARUNDE
     C                   EXSR      GENBANE
     C                   CALL      'PDF025CL'
     C                   PARM                    UPARM1
     C                   PARM                    UBANE
     C                   PARM                    ARCINF
      *
      * OPPDATER ARKIVPOSTER
     C                   Move      'A'           arSTAT
     C                   exsr      timesr
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     C                   except    updark2
     C                   MOVE      ARLINK        XARLINK          40
     C     key           READE     arkivl01                               33
     C                   DOW       *IN33 = *OFF
     C                   Move      'A'           arSTAT
     C                   MOVE      XARLINK       ARLINK
     C                   UPDATE    ARKIVR
     C     key           READE     arkivl01                               33
     C                   ENDDO
      *
     C                   ENDSR
      *
     C*****************************************************************
     c     gengods       begsr
     c*****************************************************************
     c                   move      *blanks       arlink
     c                   movel     ARTYPE        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       atur9:0       arlink
     C     arlink        CAT       abeljn:0      arlink
      *
     c                   exsr      genbane
      *
      *
      *genererer PDF til selve godslista
      *
     C                   CALL      'PDF009CL'
     c                   parm                    uin03
     c                   parm                    xxavd
     c                   parm                    atur
     c                   parm                    abeljn
     c                   parm                    adrjn
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    ubanec
     c                   parm                    vise
     C                   PARM                    ARCINF
     c                   parm                    cmrbru            1
     c                   parm                    cmr               1
     c                   parm                    cmrkun            8
     c                   endsr
     C*
     c**********************************************************************
     c     skrivtur      begsr
     c**********************************************************************
     c                   move      arunde        arundeg          10
     c                   move      'N'           fbfins            1
      *
      * tømm array med agenter
      *
     c                   MOVEa     *ZEROS        ag
     c                   z-add     0             nra               2 0
     c                   setoff                                       35
      *
     c     tupro         setll     head14
     c     *in35         doweq     '0'
     c     tupro         reade     head14                                 35
     c     *in35         ifeq      '0'
     C                   z-add     1             ARFFBN
     C     KEYDOK2       CHAIN     DOKUF                              33
     c  N33              move      'J'           fbfins
     C                   MOVE      heAVD         ARAVD
     C                   MOVE      heOPD         AROPD
     c                   move      'A'           arstat
     c                   move      atur10t       arunde
     c                   write     arkivr
      *
      * legger benyttede agenter i array
      *
     C     hekna         ifne      *zeros
     C     hekna         lookup    ag                                     33
     c     *in(33)       ifeq      '0'
     c                   add       1             nra
     c                   move      hekna         ag(nra)
     c                   end
     c                   end
      *
     c                   end
     c                   end
     c                   move      arundeg       arunde
     c                   endsr
     c**********************************************************************
     c     skrivturc     begsr
     c**********************************************************************
     c                   move      arunde        arundeg          10
     c                   move      'N'           fbfins            1
      *
      * tømm array med agenter
      *
     c                   MOVEa     *ZEROS        ag
     c                   z-add     0             nra               2 0
     c                   setoff                                       35
      *
     c     samlop        setll     samcmrd
     c     *in35         doweq     '0'
     c     samlop        reade     samcmrd                                35
     c     *in35         ifeq      '0'
      * skriver først post til selve godslisten = 'go'
     C                   MOVE      samavd        ARAVD
     C                   MOVE      samopd        AROPD
     c                   move      'A'           arstat
     c                   move      atur10f       arunde
     c                   write     arkivr
      * skriver så  post til samle cmr
     c                   move      arlink        arlinkg          40
     c                   move      arlinkc       arlink
     c                   eval      ARFRI='NY'
     c                   move      'cs'          artype
     c                   write     arkivr
     c                   move      *blanks       arfri
     c                   move      'go'          artype
     c                   move      'N'           epmain
     c                   move      arlinkg       arlink
      *
      * legger agent i arrayelement 1
      *
      *
     c                   end
     c                   enddo
     c                   move      arundeg       arunde
     c                   endsr
     c**********************************************************************
     c     samcmrsr      begsr
     c**********************************************************************
     c                   setoff                                       35
      *
     c     samlop        setll     samcmrd
     c     *in35         doweq     '0'
     c     samlop        reade     samcmrd                                35
     c     *in35         ifeq      '0'
     C                   MOVE      samavd        Aavd
     C                   MOVE      samopd        aopd
     c                   move      'cs'          artype
     C                   CALL      'ARC002V'
     C                   PARM                    ARTYPE
     C                   PARM                    Aavd
     C                   PARM                    Aopd
     C                   PARM                    ARKVED
     C                   PARM                    CLIVE
     C                   PARM                    arinek
     C                   PARM                    tuknt
     c                   end
     c                   enddo
     c                   move      'go'          artype
     c                   endsr
     c**********************************************************************
     c     skrivtur2     begsr
     c**********************************************************************
      * skriv agentrecords til loggfil på de oppdrag som er på agent
      *
     c     keytua        klist
     c                   kfld                    tupro
     c                   kfld                    tuknt
     c                   setoff                                       35
     c                   move      arunde        arundeg          10
      *
     c     keytua        setll     head14
     c     *in35         doweq     '0'
     c     keytua        reade     head14                                 35
     c     *in35         ifeq      '0'
     C                   MOVE      heAVD         ARAVD
     C                   MOVE      heOPD         AROPD
     c                   move      'A'           arstat
     c                   move      atur10a       arunde
     c                   move      tuknt         arkund
     c                   write     arkivr
     c                   end
     c                   end
     c                   move      arundeg       arunde
     c                   endsr
     C*
     C***********************************************
     C     godsmail      BEGSR
     C***********************************************
      *
      * sende godsliste på mail
      *
     C                   MOVE      *BLANKS       WSTEX1
     c                   setoff                                       3344
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nestegod      tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nestegod
     C     KU0GOD        TAG
      *
      *Godsliste
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex1           30
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Waybill     'wstex1
     c                   move      *blanks       wstex2
     C                   movel     'Tripno:'     wstex2           60
     C     wstex2        CAT       ATUR:1        wstex2
     C     wstex2        CAT       'From:':1     wstex2
     C     wstex2        CAT       tusdf:1       wstex2
     C     wstex2        CAT       'To:':1       wstex2
     c                   else
     C                   movel     'Godsliste   'wstex1
     c                   move      *blanks       wstex2
     C                   movel     'Turnr:'      wstex2           60
     C     wstex2        CAT       ATUR:1        wstex2
     C     wstex2        CAT       'Fra:':1      wstex2
     C     wstex2        CAT       tusdf:1       wstex2
     C     wstex2        CAT       'Til:':1      wstex2
     c                   end
     C     wstex2        CAT       tusdt:1       wstex2
     c                   move      uusr          epuser
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     C                   MOVE      'E'           INTEKS
     C     CEMAIL        CHAIN     ARUSERL1                           35
     C  N35arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
      *
      * lager http for interne   brukere
      *
     C                   move      *blanks       uhttpi
      *
     c                   movel     uhttpista     uhttpi
      *
      * test transportør / agent
      *
     c     gotype        ifeq      'T'
     C     uhttpi        CAT       arlinktra:0   uhttpi
     c                   else
     C     uhttpi        CAT       arlinkage:0   uhttpi
     c                   end
     C     uhttpi        CAT       '.pdf':0      uhttpi
      * lager http for eksterne  brukere
     C                   move      *blanks       uhttpe
     c                   movel     uhttpesta     uhttpe
      *
      * test transportør / agent
      *
     c     gotype        ifeq      'T'
     C     uhttpe        CAT       arlinktra:0   uhttpe
     c                   else
     C     uhttpe        CAT       arlinkage:0   uhttpe
     c                   end
     C     uhttpe        CAT       '.pdf':0      uhttpe
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c     gotype        ifeq      'T'
     c                   eval      EPBANE = ubanegotr
     c                   else
     c                   eval      EPBANE = ubanegoag
     c                   end
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     c                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Waybill from'wscvp1
     c                   else
     C                   movel     'Godsliste fr'wscvp1
     C     wscvp1        cat       'a:':0        wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C     WSCVP1        cat       'Car:':1      wscvp1
     c                   else
     C     wscvp1        cat       'Bil:':1      wscvp1
     c                   end
     C     wscvp1        cat       tubiln:1      wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkge       wscvp2
     c                   else
     C                   movel     trykkg        wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggge     wscvp2
     c                   else
     c                   movel     vedleggg      wscvp2
     c                   end
     C                   end
     C     cmr           ifeq      'J'
     c                   move      'N'           EPMAIN
      * eventuelle vedlegg til oppdragene
     c                   exsr      samcmrsr
     c                   end
     c                   move      'K'           EPMAIN
     c                   write     arkepor
      *
      * legg til link samlet fraktbrev pdf
      *
     c     fbfins        ifeq      'J'
     c     gfjn          andeq     'J'
     c     gfsnd         andeq     'J'
     c                   exsr      addfbre
     c                   end
      *
     C                   move      'N'           k002v             1
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
      *
      * eventuelt mail til seg selv   skjekk dette
      * gjøres kun 1 gang når kunde er ulik 0
      *
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0GOD
n08  C  N33              GOTO      KU0GOD
     C                   END
     C                   END
     c                   endsr
     C***********************************************
     C     delark        BEGSR
     C***********************************************
     c                   move      *blanks       epbane
     c                   move      '0'           *in(39)
     c     uusr          setll     arkepo
     c     *in(39)       doweq     '0'
     c     uusr          reade     arkepo                                 39
     c     *in(39)       ifeq      '0'
     c                   delete    arkepor
     c                   end
     c                   end
     c                   endsr
      *stykkgods fraktbrev
     C*
     C***********************************************
     C     PDFFB         BEGSR
     C***********************************************
     C     KEYDOK        KLIST
     C                   KFLD                    ARFB              1
     C                   KFLD                    ARAVD
     C                   KFLD                    AROPD
     C                   KFLD                    ARFFBN
     C                   MOVEL     ARUNDE        ARFFBN            3 0
     C                   MOVE      'F'           ARFB
     C     KEYDOK        CHAIN     DOKUF                              33
      *
      * ordner start av linken med forståelig info
      *
     c                   move      *blanks       arlink
     c                   movel     ARTYPE        arlink
     C     arlink        CAT       aar:0         arlink
     C  N33arlink        CAT       DF1004:0      arlink
      *
      *stykkgods fraktbrev
     C                   MOVEL     ARUNDE        AFBN              3
     C                   MOVEL     ARUNDE        AFT04             4
     C                   MOVE      AFT04         Afrto             1
     c                   exsr      genbane
     C                   CALL      'PDF003CL'
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    AFBN
     c                   parm                    Afrto
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     C                   PARM                    ARCINF
     C*
     c     artype        chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
      * dummy hvis null for å følge syklus
     c     arkund        ifeq      0
     c                   z-add     99999999      arkund
     c                   end
     c                   z-add     arkund        tuknt
     C  N33ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nestefb       tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nestefb
     C     KU0FB         TAG
     c                   move      *blanks       eplink
     c                   move      *blanks       epline
     c                   move      *blanks       epbane
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Shipmentno:' wstex2
     C     wstex2        CAT       df1004:1      wstex2
     C  N33wstex2        cat       'To:':1       wstex2
     c                   else
     C                   movel     'Sendingsnr:' wstex2
     C     wstex2        CAT       df1004:1      wstex2
     C     wstex2        cat       'Til:':1      wstex2
     c                   end
     C     wstex2        cat       DFNAVM:1      wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Waybill from'wscvp1
     C     wscvp1        cat       ':':0         wscvp1
     c                   else
     C                   movel     'Fraktbrev fr'wscvp1
     C     wscvp1        cat       'a:':0        wscvp1
     c                   end
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkse       wscvp2
     c                   else
     C                   movel     trykks        wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggse     wscvp2
     c                   else
     c                   movel     vedleggs      wscvp2
     c                   end
     C                   end
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
      *
      * eventuelt mail til seg selv   skjekk dette
      * gjøres kun 1 gang når kunde er ulik 0
      *
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0FB
n08  C  N33              GOTO      KU0FB
     C                   END
     C                   END
      *
      * eventuelt mail til varemottaker
      * gjøres kun 1 gang når sndfbv= ' '
      *
     c     mailkkv       klist
     c                   kfld                    fifirm
     c                   kfld                    arkund
     c                   kfld                    DFNAVM
     c                   kfld                    DFAD1M
     c
     c     sndfbv        ifeq      ' '
     c                   move      'J'           sndfbv            1
     c                   z-add     0             tuknt
     c     mailkkv       chain     VADR1                              33
     C     *IN33         IFEQ      '0'
     c     VAMAIL        andne     *blanks
     C                   EVAL      CEMAIL=VAMAIL
     C                   EVAL      CLIVE='V'
     C                   GOTO      KU0FB
     C                   END
     C                   END
     c                   end
     C                   ENDSR
     C***********************************************
     C     PDFSad        BEGSR
     C***********************************************
     c                   move      artype        artygm            2
      *sad import
     c     artype        ifeq      'si'
     C                   MOVE      'I'           TDTYP             1
     c     keyhea        chain     sadh                               33
     c  n33              move      sisg          signat            3
     c                   end
      *sad EKSPORT
     c     artype        ifeq      'se'
     c     keyhea        chain     saeh                               33
     c  n33              move      sesg          signat            3
     C                   MOVE      'E'           TDTYP             1
     c                   end
     C
      * SAD import/eksport
      *
      * ordner start av linken med forståelig info
      *
     c                   move      *blanks       arlink
     c                   movel     ARTYPE        arlink
     C     arlink        CAT       aar:0         arlink
N03  C                   IF        AROPD < 0
N03  C                   EVAL      AROPD = AROPD * -1
N03  C     arlink        CAT       avdopd:0      arlink
N03  C                   EVAL      AROPD = AROPD * -1
N03  C                   ELSE
     C     arlink        CAT       avdopd:0      arlink
N03  C                   END
      *
     c                   exsr      genbane
     C                   CALL      'PDF001CL'
     C                   PARM                    AAVD
     C                   PARM                    Aopd
     C                   PARM                    TDTYP
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     C                   PARM                    vise
     c                   parm                    finst             1
     c                   parm                    finsd             1
     c                   PARM                    ARCINF
     c                   move      arlink        arlinkft         40
     c                   move      artype        artypeft          2
     c                   movel     ubane         ubaneft          50
     c                   move      *blanks       uhttpift        152
     c                   movel     uhttpi        uhttpift
     c                   move      *blanks       uhttpeft        152
     c                   movel     uhttpe        uhttpeft
      *tilleggsark
     c     finst         ifeq      'J'
     c     tdtyp         ifeq      'I'
     C                   MOVE      'sj'          artype
     c                   else
     C                   MOVE      'sf'          artype
     c                   end
     c                   move      *blanks       arlink
     c                   movel     ARTYPE        arlink
     c                   Move      'A'           arSTAT
     C     arlink        CAT       aar:0         arlink
N03  C                   IF        AROPD < 0
N03  C                   EVAL      AROPD = AROPD * -1
N03  C     arlink        CAT       avdopd:0      arlink
N03  C                   EVAL      AROPD = AROPD * -1
N03  C                   ELSE
     C     arlink        CAT       avdopd:0      arlink
N03  C                   END
     c                   exsr      genbane
     c                   movel     ubane         ubanet
     c                   move      *blanks       uhttpit         152
     c                   movel     uhttpi        uhttpit
     c                   move      *blanks       uhttpet         152
     c                   movel     uhttpe        uhttpet
     c                   write     arkivr
     c                   end
      *
      * dataliste
      *
     c     finsd         ifeq      'J'
     c     tdtyp         ifeq      'I'
     C                   MOVE      'sk'          artype
     c                   else
     C                   MOVE      'sg'          artype
     c                   end
     c                   move      *blanks       arlink
     c                   movel     ARTYPE        arlink
     c                   Move      'A'           arSTAT
     C     arlink        CAT       aar:0         arlink
N03  C                   IF        AROPD < 0
N03  C                   EVAL      AROPD = AROPD * -1
N03  C     arlink        CAT       avdopd:0      arlink
N03  C                   EVAL      AROPD = AROPD * -1
N03  C                   ELSE
     C     arlink        CAT       avdopd:0      arlink
N03  C                   END
     c                   exsr      genbane
     c                   movel     ubane         ubaned
     c                   move      *blanks       uhttpid         152
     c                   movel     uhttpi        uhttpid
     c                   move      *blanks       uhttped         152
     c                   movel     uhttpe        uhttped
     c                   write     arkivr
     c                   end
     c     finsd         ifeq      'J'
     c     finst         oreq      'J'
     C                   IF        TDTYP = 'I'
     C                   EVAL      ULISTNV = 'SAD61PFT'
     C                   ELSE
     C                   EVAL      ULISTNV = 'SAD52PFT'
     C                   END
     C                   CALL      'PDF001CL2'
     C                   PARM                    ubanet           50
     C                   PARM                    ubaned           50
     c                   parm                    finst             1
     c                   parm                    finsd             1
     c                   PARM                    ARCINF
     c                   PARM                    ULISTNV          10
     c                   end
      *
      * HENT VERDIER
      *
     c     artypeft      chain     ARKTXT                             33
      *
      * skal kunde ha mail
      *
     c                   Move      'A'           arSTAT
     c                   move      arlink        arlinkta         40
     c                   move      arlinkft      arlink
     C                   exsr      timesr
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     c                   except    updark2
     c                   move      arlinkta      arlink
      *
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c                   move      arkund        tuknt
     c                   move      arkund        fakunr
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
     c     lesn01        tag
     c     mailk         reade     cundc03                                44
     c     *in44         ifeq      '0'
     c                   exsr      testep
     c   33              goto      lesn01
     c                   end
     c     *in(44)       ifeq      '0'
     c     cemail        ifeq      '@'
     c                   goto      lesn01
     c                   end
     c     ku0sad        tag
      *
      * sende XML til EMMA
      *
     C                   IF        CLIVE = 'X'
     C                   IF        ARTYPE = 'si'
     C                   EVAL      TDTYP = 'I'
     C                   ELSE
     C                   EVAL      TDTYP = 'E'
     C                   END
     C                   CALL      'PDF001CL3'
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    TDTYP
      * skriver til track & trace
     C                   eval      tttext='Transferred XML of custdec to:'
     C     tttext        cat       CFAX:1        tttext
     C                   move      CCOMPN        tttext
     C                   eval      tttexl='Overført XML av tolldek til:'
     C     tttexl        cat       CFAX:1        tttexl
     C                   move      CCOMPN        tttexl
     C                   MOVE      'XML'         TTACTI
     C                   EXSR      TTSR
     c                   GOTO      LESN01
     C                   END
      *
      *
      * slett eventuellt gamle poster
      *
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Cust.clearan'wstex2
     C     wstex2        CAT       'ce':0        wstex2
     C  N33wstex2        cat       'To:':1       wstex2
     c                   else
     C                   movel     'Tolldeklaras'wstex2
     C     wstex2        CAT       'jon':0       wstex2
     C  N33wstex2        cat       'Til:':1      wstex2
     c                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      uusr          epuser
     c                   movel     uhttpift      eplink
     c                   movel     uhttpeft      epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANEFT
     C                   END
      *
      * skjekk om mailbruker  er intern
      *
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
      *
      * tilleggsark
      *
     c     finst         ifeq      'J'
      *
      * skjekk om mailbruker  er intern
      *
     c                   movel     uhttpit       eplink
     c                   movel     uhttpet       epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANET
     C                   END
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c     fins1         ifeq      'J'
     c                   move      *blanks       wstex1           30
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   moveL     'Spesificatio'wste13           13
     c                   move      'n'           wste13
     c                   else
     c                   moveL     'Spesifikasjo'wste13           13
     c                   move      'n'           wste13
     c                   end
     c                   moveL     wste13        wstex1           30
     c                   end
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     c                   end
      *
      * dataliste
      *
     c     finsd         ifeq      'J'
      *
      * skjekk om mailbruker  er intern
      *
     c                   movel     uhttpid       eplink
     c                   movel     uhttped       epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANED
     C                   END
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     c     finsd         ifeq      'J'
     c                   move      *blanks       wstex1           30
     c                   move      *blanks       wstex2
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   moveL     'Spesificatio'wste13           13
     c                   move      'n'           wste13
     c                   else
     c                   moveL     'Spesifikasjo'wste13           13
     c                   move      'n'           wste13
     c                   end
     c                   moveL     wste13        wstex1           30
     c                   end
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     c                   end
      *
      * coverpage
      *
     C                   move      *blanks       wscvp1
     C                   eval      wscvp1='Tolldokument:'
     C     TDTYP         IFEQ      'I'
     C     wscvp1        cat       SITLE:1       wscvp1
     C     wscvp1        cat       SITLL:0       wscvp1
     c                   else
     C     wscvp1        cat       SETLE:1       wscvp1
     C     wscvp1        cat       SETLL:0       wscvp1
     c                   end
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c     SIMF          ifne      'DUA'
     C                   movel     trykkte       wscvp2
     c                   else
     c                   movel     trykkue       wscvp2
     c                   end
     c                   else
     c     SIMF          ifne      'DUA'
     C                   movel     trykkt        wscvp2
     c                   else
     c                   movel     trykku        wscvp2
     c                   end
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c     SIMF          ifne      'DUA'
     c                   movel     vedleggte     wscvp2
     c                   else
     c                   movel     vedleggue     wscvp2
     c                   end
     c                   else
     c     SIMF          ifne      'DUA'
     c                   movel     vedleggt      wscvp2
     c                   else
     c                   movel     vedleggu      wscvp2
     c                   end
     c                   end
     C                   end
     C                   movel     'Ref:'        wscvp3
     C     wscvp3        cat       aavd:1        wscvp3
     C     wscvp3        cat       '/':0         wscvp3
     C                   IF        AROPD < 0
     C     AROPD         MULT      -1            XN07              7 0
     C                   MOVE      XN07          XAN07             7
     C     wscvp3        cat       XAN07:0       wscvp3
     C                   ELSE
     C     wscvp3        cat       aopd:0        wscvp3
     C                   END
     C                   EXSR      EPOSTSR
      * skriver til track & trace
     c                   eval      wscvp3 = '.'
     C                   eval      tttext='emailed custdec to:'
     C                   movel     CEMAIL        CEMA50           50
     C     tttext        cat       CEMA50:1      tttext
     C                   move      CCOMPN        tttext
     C                   eval      tttexl='epost av tolldekl. til:'
     C     tttexl        cat       CEMA50:1      tttexl
     C                   move      CCOMPN        tttexl
     C                   MOVE      'EMA'         TTACTI
     C                   EXSR      TTSR
     c                   end
     c                   end
      *
      * eventuelt mail til seg selv   skjekk dette
      * gjøres kun 1 gang når kunde er ulik 0
      *
     c     tuknt         ifne      0
S02  c*    epsendt       andne     'J'
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   move      *blanks       SYUSER
     c                   movel     signat        SYVRDA
     C     UsrKey        Chain     SYPARL3                            33
     c   33              goto      UTSAD
     c                   exsr      hentep
     C                   END
N08  c     testny0       tag
N08  c                   exsr      testep
n08  c     *in33         ifeq      '1'
n08  c     mailk         reade     cundc03                                33
n08  c  N33              goto      testny0
N08  c                   end
s08  C*                  GOTO      KU0SAD
n08  C  N33              GOTO      KU0SAD
     C                   END
     C                   END
     C                   END
     c     utsad         tag
      *
      * tilbakestiller verdier
      *
     c                   move      artypeft      artype
     c                   move      arlinkft      arlink
     C*
      *ryckattest import
      *
     c     keysypa       klist
     c                   kfld                    sypaid
     c                   kfld                    syvrdn
      *
     c     tdtyp         ifeq      'I'
     c                   move      'RYCUT'       sypaid
     c                   testn                   tlager               33
     c     *in33         ifeq      '1'
     c                   setoff                                       33
     c                   move      tlager        tlagern           5 0
     C                   z-add     tlagern       syvrdn
     c     keyhea        chain(n)  ruckpu                             33
     c     *in33         ifeq      '0'
     c     keyhea        setll     ruckpu
     c     *in33         doweq     '0'
     c     keyhea        reade     ruckpu                                 33
     c  n33              exsr      rucksr
     c                   end
     c                   end
     c                   end
     c                   end
     c                   move      artygm        artype
     C                   ENDSR
     C*
     C***********************************************
     C     genbane       BEGSR
     C***********************************************
      * genererer bane for lagring
      *
      * henter  randomverdi
      *
     C     arty1         ifne      'Z'
     C                   call      'ARCRAN'
     C                   parm                    arli10           10
     C     arlink        cat       arli10:0      arlink
     C                   END
      *
     C                   MOVE      'N'           vise              1
     C                   MOVE      ARAVD         AAVD              4
     C                   MOVE      AROPD         AOPD              7
     C                   MOVE      'J'           EPMAIN
     C                   MOVE      ARAVD         EPAVD
     C                   MOVE      AROPD         EPOP              7
      *
      * lager http for interne brukere
      *
     C                   move      *blanks       uhttpi
     c                   movel     uhttpista     uhttpi          152
     C     uhttpi        CAT       arlink:0      uhttpi
     C     uhttpi        CAT       '.pdf':0      uhttpi
      * lager http for interne brukere
     C                   move      *blanks       uhttpe          152
     c                   movel     uhttpesta     uhttpe
     C     uhttpe        CAT       arlink:0      uhttpe
     C     uhttpe        CAT       '.pdf':0      uhttpe
      *
      * lager bane til IFS
      *
     C                   move      *blanks       ubane            50
     C                   movel     ubanesta      ubane
     C     ubane         CAT       arlink:0      ubane
     C     arty1         ifne      'Z'
     C     ubane         CAT       '.pdf':0      ubane
     c                   end
     c                   endsr
     C***********************************************
     C     PDFTRAN       BEGSR
     C***********************************************
     C*
     C     TRH3KE        KLIST
     C                   KFLD                    XXST              1
     C                   KFLD                    NFAK
     C*
     C     TRV6KE        KLIST
     C                   KFLD                    NFAK
     C*
     C                   MOVE      'F'           XXST
     C                   z-add     0             ntrans            8 0
     c                   move      *zeros        traavd            4
      *
     C*
     c                   move      'tb'          ARTYPE
     c     artype        chain     ARKTXT                             33
     c  N33arkjn         ifeq      'J'
     c                   move      'J'           arkvedl           1
     c                   end
     c                   move      'ta'          XXTYPE
     c     artype        chain     ARKTXT                             33
     C  N33ARKJN         IFEQ      'J'
     C                   MOVEL     ARUNDE        AFAK
     C                   MOVEL     ARUNDE        NFAK              7 0
     c                   move      ardate        fadato
     C     TRH3KE        CHAIN     TRAVH3                             72
     C  N72              z-add     thtnr         ntrans            8 0
     c  N72              move      thtavd        traavd            4
     C   72              MOVE      'O'           XXST
     C   72TRH3KE        CHAIN     TRAVH3                             72
     C  N72              z-add     thtnr         ntrans
     c  N72              move      thtavd        traavd
     C     *IN(72)       IFEQ      '1'
     C     TRV6KE        CHAIN     TRAVV6                             72
     C  N72              Z-ADD     TVTUNR        NTRANS
     C  N72              move      TVoavd        traavd
     C                   END
      *
      * transportør 0 er feil -  går da ut av rutinen
      *
     c     ntrans        ifeq      0
     c                   goto      utta
     c                   end
      * ordner start av linken med forståelig info til arbeidsliste
     c     arkvedl       ifeq      'J'
     c                   move      *blanks       arlink
     c                   move      'tb'          artype
s06  c*                  movel     ARTYPE        arlink
s06  C*    arlink        CAT       aar:0         arlink
s06  C*    arlink        CAT       AFAK:0        arlink
n06  c                   eval      arlink=%trim(artype)
n06  c                             +%trim(%editw(thcc:'0  '))
n06  c                             + %TRIm(%editw(thÅr:'0  '))
n06  c                             + %TRIm(%editw(thmnd:'0  '))
n06  c                             + %trim(afak)
     C                   exsr      genbane
     c                   move      ubane         ubanea           50
     c                   move      arlink        arlinka          40
     c                   move      'A'           arstat
     c                   write     arkivr
     c                   move      'ta'          artype
     c                   end
      * lagrer avregning
      *
      * ordner start av linken med forståelig info til avregning
      *
     c                   move      *blanks       arlink
s06  c*                  movel     ARTYPE        arlink
s06  C*    arlink        CAT       aar:0         arlink
s06  C*    arlink        CAT       AFAK:0        arlink
n06  c                   eval      arlink=%trim(artype)
n06  c                             +%trim(%editw(thcc:'0  '))
n06  c                             + %TRIm(%editw(thÅr:'0  '))
n06  c                             + %TRIm(%editw(thmnd:'0  '))
n06  c                             + %trim(afak)
      *
     C                   exsr      genbane
     C                   CALL      'PDF010CL'
     C                   PARM                    NFAK
     C                   PARM                    Ntrans
     C                   PARM                    traavd
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     C                   PARM                    ubanea
     c                   parm                    vise
     c                   parm                    arcinf
     c                   parm                    arkvedl
     c                   end
      *
      * sprer utover turene på avregning
      *
     c                   setoff                                       35
     c     nfak          setll     travh6
     C     *in35         doweq     '0'
     c     nfak          reade     travh6                                 35
     c     *in35         ifeq      '0'
     c     thtunr        andne     0
     c                   movel     'T:'          arunde
     c                   move      thtunr        arunde
     c                   move      'A'           arstat
     c                   write     arkivr
      * Også vedlegget
     c     arkvedl       ifeq      'J'
     c                   move      arlink        arlinkg          40
     c                   move      arlinka       arlink
     c                   move      'tb'          artype
     c                   write     arkivr
     c                   move      'ta'          artype
     c                   move      arlinkg       arlink
     c                   end
     c                   end
     C                   enddo
      *
      *
      * sprer utover turene på avregning basert på travv legg kundenr 0
      *
     c     arkey6        klist
     c                   kfld                    arfirm
     c                   kfld                    artype
     c                   kfld                    arunde
     c                   kfld                    arlink
     c
     c                   setoff                                       35
     C                   MOVE      ARKUND        ARKUNDSA          8 0
     c     nfak          setll     travv6
     C     *in35         doweq     '0'
     c     nfak          reade     travv6                                 35
     c     *in35         ifeq      '0'
     c     TVBNRB        andne     0
     c     TVBNRB        CHAIN     KOSBU                              33
     c     *in33         ifeq      '0'
     c     butunr        chain     turer14                            33
     c     *in33         ifeq      '0'
     c                   movel     'T:'          arunde
     c                   move      tupro         arunde
     c                   move      'A'           arstat
     C                   MOVE      *ZEROS        ARKUND
     c     arkey6        chain     arkivl06                           33
     c     *in33         ifeq      '1'
     c                   write     arkivr
      * Også vedlegget
     c     arkvedl       ifeq      'J'
     c                   move      arlink        arlinkg          40
     c                   move      arlinka       arlink
     c                   move      'tb'          artype
     c                   write     arkivr
     c                   move      'ta'          artype
     c                   move      arlinkg       arlink
     c                   end
     c                   end
     c                   end
     c                   end
     c                   end
     C                   enddo
     C                   MOVE      ARKUNDSA      ARKUND            8 0
      *
      * skal kunde ha mail
      *
     c                   z-add     arkund        tuknt
     C     ARKSND        IFEQ      'J'
     c     epjn          andne     'U'
     c     artype        chain     ARKTXT                             33
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
     c     mailk         setll     cundc03
     c     *in(44)       doweq     '0'
n08  c     nestetra      tag
     c     mailk         reade     cundc03                                44
     c     *in(44)       ifeq      '0'
n08  c                   exsr      testep
n08  c   33              goto      nestetra
     C     KU0TRA        TAG
      *
     c* slett eventuellt gamle poster
     c                   exsr      delark
     c                   move      *blanks       wstex2
     c     mailkk        CHAIN     CUNDL01                            33
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Inv:'        wstex2
     C     wstex2        CAT       afak:1        wstex2
     C     wstex2        CAT       'date:':1     wstex2
     C     wstex2        CAT       fadg:1        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       famm:0        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       faaa:0        wstex2
     C  N33wstex2        cat       'To:':1       wstex2
     c                   else
     C                   movel     'Fakt:'       wstex2
     C     wstex2        CAT       afak:1        wstex2
     C     wstex2        CAT       'dato:':1     wstex2
     C     wstex2        CAT       fadg:1        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       famm:0        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       faaa:0        wstex2
     C  N33wstex2        cat       'Til:':1      wstex2
     c                   end
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      *blanks       epuser
     c                   movel     uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
      * skjekk om mailbruker  er intern
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     C                   move      *blanks       wscvp1
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     'Transporter 'wscv24           24
     C                   move      'balance from'wscv24           24
     c                   else
     C                   movel     'Transportøra'wscv24           24
     C                   move      'vregning fra'wscv24           24
     c                   end
     c                   movel     wscv24        wscvp1
     C     wscvp1        cat       fift:1        wscvp1
     C     CLIVE         IFNE      'V'
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   movel     trykkae       wscvp2
     c                   else
     C                   movel     trykka        wscvp2
     c                   end
     C                   else
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     c                   movel     vedleggae     wscvp2
     c                   else
     c                   movel     vedlegga      wscvp2
     c                   end
     C                   end
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     C                   EXSR      EPOSTSR
     c                   end
     c                   end
      *
      * eventuelt mail til seg selv   skjekk dette
      * gjøres kun 1 gang når kunde er ulik 0
      *
     c     tuknt         ifne      0
     c                   z-add     0             tuknt
     c     mailk         chain     cundc03                            33
     C     *IN33         IFEQ      '0'
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
N08  c                   exsr      testep
s08  C*                  GOTO      KU0TRA
n08  C  N33              GOTO      KU0TRA
     C                   END
     C                   END
     c                   end
     c     utta          endsr
      *
     C***********************************************
     C     init          BEGSR
     C***********************************************
     C*
     C     *ENTRY        PLIST
     c                   parm                    utype             2
     c                   parm                    UUSER            10
     c                   parm                    epjn              1
     c                   move      utype         xxtype            2
     c                   move      uUSER         xxUSER           10
     C                   MOVE      'N'           vise              1
      *
     C     KUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    ARKUND
     C     KEYDOK2       KLIST
     C                   KFLD                    ARFB
     C                   KFLD                    heAVD
     C                   KFLD                    heOPD
     C                   KFLD                    ARFFBN
     C                   MOVE      'F'           ARFB
      *
     C     KEYHEA        KLIST
     C                   KFLD                    ARAVD
     C                   KFLD                    AROPD
      *
      *
     C     KEYSVE        KLIST
     C                   KFLD                    ARAVD
     C                   KFLD                    AROPDS            7 0
     C     KEYDAN        KLIST
     C                   KFLD                    ARAVD
     C                   KFLD                    AROPDD            7 0
      *
     c     key           klist
     c                   kfld                    XXSTAT            1
     c                   kfld                    xxUSER
     c                   kfld                    xxtype
     C                   move      'K'           xxstat
     C*
     c     keya02        klist
     c                   kfld                    YYSTAT
     c                   kfld                    ARAVD
     c                   kfld                    AROPD
     c                   kfld                    ARTYPE
     c                   kfld                    ARUNDE
     c                   move      'X'           yystat            1
     C*
     C     USRKEY        KLIST
     C                   KFLD                    SYPAID
     C                   KFLD                    SYVRDA
     C                   move      'USRID'       SYPAID
      *
     c                   read      firm                                   33
     c                   read      firmarc                                33
     c     *in33         ifeq      '1'
     c                   seton                                        lr
     c                   return
     c                   end
     c     arinf         chain     arktxt                             33
     c  N33              move      arsban        infban           50
      *
      * med vennlig hilsen
      *
     c                   movel     '.'           wscvp3
     c                   movel     '.'           wscvp4
     c                   movel     '.'           wscvp5
     c                   movel     '.'           wscvp6
     c                   movel     'Med vennlig 'wscvp11n         80
     C     wscvp11n      CAT       'hilsen':1    wscvp11n
     c                   movel     'Regards     'wscvp11e         80
     C                   movel     fift          wscvp12
     c*
     c*
     c*
     C* lager starten på http og IFS-bane  intern ekstern
     c*
     c*
      * lager http for interne brukere
      *
      * intern
      *
     C                   move      *blanks       uhttpista       152
     c                   movel     'http://'     uhttpista
     C     uhttpista     CAT       arcpad:0      uhttpista
     C     uhttpista     CAT       '/':0         uhttpista
     C     uhttpista     CAT       arcane:0      uhttpista
     C     uhttpista     CAT       '/':0         uhttpista
      *
      * ekstern
      *
     C                   move      *blanks       uhttpesta       152
     c                   movel     'http://'     uhttpesta
     C     uhttpesta     CAT       arcpae:0      uhttpesta
     C     uhttpesta     CAT       '/':0         uhttpesta
     C     uhttpesta     CAT       arcane:0      uhttpesta
     C     uhttpesta     CAT       '/':0         uhttpesta
      *
      * lager bane til IFS
      *
     C                   movel     '/'           ubanesta         70
     C     ubanesta      CAT       arcane:0      ubanesta
     C     ubanesta      CAT       '/':0         ubanesta
     c                   endsr
     C***********************************************
     C     genfbpdf      BEGSR
     C***********************************************
      *
      *
     c                   move      'gf'          artype            2
     c                   move      arlink        arlinkg          40
      *
      * arlink kommer fra godsnummer   byttes bare til 'gf'
      *
      *
      * ordner start av linken med forståelig info
      *
     c                   move      *blanks       arlink
     c                   movel     ARTYPE        arlink
     C     arlink        CAT       aar:0         arlink
     C     arlink        CAT       atur9:0       arlink
      *
      *
      *stykkgods fraktbrev på hel tur
      *
      * Trikser med kode for å fortelle at det er PDF003cl på GODSL./TUR-nivå
     C                   MOVE      'G'           Afrto             1
     c                   exsr      genbane
     C                   MOVE      atur          Afbn
     C                   MOVEl     atur          Aopd
     C                   MOVE      'F'           ARFB
     C                   CALL      'PDF003CL'
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    AFBN
     c                   parm                    Afrto
     C                   PARM                    uhttpi
     C                   PARM                    ubane
     c                   parm                    vise
     C                   PARM                    ARCINF
     C                   move      'A'           arstat
     c                   move      *zeros        aravd
     c                   move      *zeros        aropd
     C                   write     arkivr
      *
     c                   move      arlink        arlinkfb         40
     c                   move      'go'          artype            2
     c                   move      arlinkg       arlink           40
     C*
     c                   endsr
     C***********************************************
     C     addfbre       BEGSR
     C***********************************************
     c                   move      *blanks       wstex1
     c                   move      *blanks       wstex2
     C                   movel     'Fraktbrevene'wstex1
     c* skriver til mailfil
     C                   movel     'til turnr:'  wstex2
     C     wstex2        cat       atur:1        wstex2
     c                   move      uusr          epuser
      * lager http for interne   brukere
     C                   move      *blanks       uhttpi
     c                   movel     uhttpista     uhttpi
     C     uhttpi        CAT       arlinkfb:0    uhttpi
     C     uhttpi        CAT       '.pdf':0      uhttpi
      * lager http for eksterne  brukere
     C                   move      *blanks       uhttpe
     c                   movel     uhttpesta     uhttpe
     C     uhttpe        CAT       arlinkfb:0    uhttpe
     C     uhttpe        CAT       '.pdf':0      uhttpe
      *
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
     c                   movel     wstex1        eptex1
     c                   move      wstex2        eptex2
     C     CLIVE         IFEQ      'V'
     c                   eval      EPBANE = UBANE
     C                   END
     c                   write     arkepor
     c                   endsr
      ***************************************************************
     C     frisr         begsr
      ***************************************************************
     c                   z-add     1             nr                2 0
      *
      * FRIE SØKEVEIER (KUN DE SOM HAR DOK.KODE E=Epost)
      *
     C     KEYHEA        SETLL     FRISOK
     C     KEYHEA        READE     FRISOK                                 33
     C     *IN33         DOWEQ     '0'
     C                   SORTA     DFS
     C     DFS(10)       IFNE      ' '
     C     'E'           LOOKUP    DFS                                    33
     C     *IN33         IFEQ      '1'
     C     FSKODE        CHAIN     KODFRI                             33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     KFSOTX        DFRT(NR)
     c     DFRT(NR)      cat       ':':0         DFRT(NR)
     c     DFRT(NR)      cat       FSSOK:0       DFRT(NR)
     C                   ADD       1             NR
     C                   END
     C                   END
     C                   END
     C*
     C     KEYHEA        READE     FRISOK                                 33
     C  N33NR            COMP      3                                  33
     C                   END
     C     DFRT(1)       IFNE      *blanks
     C                   MOVEL     DFRT(1)       wscvp4
     C                   END
     C     DFRT(2)       IFNE      *blanks
     C                   MOVEL     DFRT(2)       wscvp5
     C                   END
     C     DFRT(3)       IFNE      *blanks
     C                   MOVEL     DFRT(3)       wscvp6
     C                   END
     C                   ENDSR
      *
     C***********************************************
     C     TTSR          BEGSR
     C***********************************************
      * OPPDRAG OPPRETTET (POST I FIL TRACKF)
     C                   MOVE      ARAVD         TTAVD
     C                   MOVE      AROPD         TTOPD
     C                   exsr      timesr
     C                   MOVE      ULDT          TTDATE
     C                   MOVE      XULTM         TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
     C                   MOVE      UUSR          TTUSER
     C                   MOVEL     KNAVN         TTNAME
     C                   WRITE     TRACKFR
     C                   ENDSR
     C***********************************************
     C     TIMESR        BEGSR
     C***********************************************
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   ENDSR
     C***********************************************
     C     TTSRSA        BEGSR
     C***********************************************
      * samlefaktura sperer EMA linjen
      *
      *
     c                   setoff                                       35
     c     fifn          setll     fain
     c     *in35         doweq     '0'
     c     fifn          reade     fain                                   35
     c     *in35         ifeq      '0'
     C                   MOVE      FIAVD         ARAVD
     C                   MOVE      FIOPD         AROPD
     C                   MOVE      'EMA'         TTACTI
     c                   EXSR      TTSR
     c                   end
     c                   end
     C                   ENDSR
     C***********************************************
     C     TTSRNC        BEGSR
     C***********************************************
     c* NCTS  sprer EMA linjer
     c                   setoff                                       35
     c     truvk         setll     truv
     c     *in35         doweq     '0'
     c     lesnytte      tag
     c     truvk         reade     truv                                   35
     c     *in35         ifeq      '0'
      *ikke skriv doble record
     c     tvavd2        ifeq      aravdi
     c     tvtdn2        andeq     aropdi
     c                   goto      lesnytte
     c                   end
      *ikke skriv 0 record
     c     tvavd2        ifeq      0
     c     tvtdn2        oreq      0
     c                   goto      lesnytte
     c                   end
     C                   MOVE      tvavd2        ARAVD
     C                   MOVE      tvtdn2        AROPD
     C                   MOVE      'EMA'         TTACTI
     c                   exsr      ttsr
     c                   end
     c                   end
      *
     C                   ENDSR
     C*******************************************************
     C     TESTEP        BEGSR
     C*******************************************************
     c                   setoff                                       33
      *
      * utelate epost i visse tilfelle
      *
     c     testny        tag
      *
      * tester oppdragstype
      *
     c     copd          ifne      *blanks
N08  c     heot          andne     *blanks
     C     heot          LOOKUP    oty                                    34
     c     copdio        ifeq      'I'
     c  N34              seton                                        33
     c                   end
     c     copdio        ifeq      'O'
     c   34              seton                                        33
     c                   end
     c                   end
      *
      * tester avdeling
      *
     C     cavd          ifne      *zeros
N08  c     aravd         andne     0
     C     aravd         LOOKUP    av                                     34
     c     cavdio        ifeq      'I'
     c  N34              seton                                        33
     c                   end
     c     cavdio        ifeq      'O'
     c   34              seton                                        33
     c                   end
     c                   end
     c                   endsr
     C*******************************************************
     C     RUCKSR        BEGSR
     C*******************************************************
     C     KEYFRI        KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C                   Kfld                    fskode
     C                   move      '*CR'         fskode
     C     KEYKOA        KLIST
     C                   KFLD                    KOAUNI
     C                   KFLD                    SIAVD
     c                   move      'A'           KOAUNI
     C     KEYKOA        CHAIN     KODTA                              34
     C     *in34         ifeq      '0'
     C                   MOVE      KOAKNR        ARKUND
     C     KUNKEY        CHAIN     CUNDL01                            34
     C     *in34         ifeq      '0'
      * epostadresse
     C                   eval      cemail=ruepost
      * emne
     c                   eval      wscvp1='Rykkattest fra:'
     c     wscvp1        cat       fift:1        wscvp1
     c     wscvp1        cat       'ID-nr:':1    wscvp1
     c     wscvp1        cat       syrg:1        wscvp1
      * linje 2
     c                   eval      wscvp2='Vårt oppdrag:'
     c     wscvp2        cat       aavd:1        wscvp2
     C     wscvp2        cat       '/':0         wscvp2
     c     wscvp2        cat       aopd:0        wscvp2
     C     KEYFRI        chain     frisok                             34
     c     *in34         ifeq      '0'
     c     wscvp2        cat       '/':0         wscvp2
     c     wscvp2        cat       fssok:0       wscvp2
     c                   end
     c     wscvp2        cat       '/':0         wscvp2
     c     wscvp2        cat       sisg:0        wscvp2
      * linje 3
     c                   eval      wscvp3='Deres Godsnr:'
     c     wscvp3        cat       sign:1        wscvp3
     c     wscvp3        cat       '/':0         wscvp3
     c     wscvp3        cat       sipos:1       wscvp3
      * linje 4
     c                   eval      wscvp4='Eks.sted/Løpenr:'
     c     wscvp4        cat       sitle:1       wscvp4
     c     wscvp4        cat       '/':0         wscvp4
     c     wscvp4        cat       sitll:0       wscvp4
      * linje 5
     c                   eval      wscvp5='Ant. Kli: '
     C                             +%trim(%editc(SINTK:'Z'))
     C                             +' Vekt:'
     C                             +%trim(%editc(SIVKB:'Z'))
      * linje 6
     c                   eval      wscvp6='Avsender'
     c     wscvp6        cat       sinas:1       wscvp6
     c     wscvp6        cat       'Land':1      wscvp6
     c     wscvp6        cat       silka:1       wscvp6
      *
      * linje 7
     c                   eval      wscvp11='Mottaker'
     c     wscvp11       cat       sinak:1       wscvp11
      *
      * linje 8
     c                   move      *blanks       wscvp12
     c                   eval      wscvp12='Vår saksbehandler:'
     c     wscvp12       cat       sitarf:1      wscvp12
      *evrt legge på dokument
     c                   move      'ry'          artype
     c                   move      'V'           clive
     c     artype        chain     arktxt                             33
     C     arkved        ifne      *blanks
     C                   CALL      'ARC002V'
     C                   PARM                    ARTYPE
     C                   PARM                    Aavd
     C                   PARM                    Aopd
     C                   PARM                    ARKVED
     C                   PARM                    CLIVE
     C                   PARM                    arinek
     C                   PARM                    tuknt
     c                   end
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           80
     c                   parm                    wscvp2           80
     c                   parm                    wscvp3           80
     c                   parm                    wscvp4           80
     C                   parm                    wscvp5           80
     C                   parm                    wscvp6           80
     C                   parm                    wscvp7           80
     C                   parm                    wscvp8           80
     C                   parm                    wscvp9           80
     C                   parm                    wscvp10          80
     C                   parm                    wscvp11          80
     C                   parm                    wscvp12          80
     C                   parm                    inteks            1
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    ATUR
     C                   PARM                    AKUN
     C                   PARM                    FIRMRG
     C                   eval      tttext='Email Rykkattest:'
     C                   movel     CEMAIL        CEMA50           50
     C     tttext        cat       CEMA50:1      tttext
     C                   move      CCOMPN        tttext
     C                   eval      tttexl='Epost Rykkattest:'
     C     tttexl        cat       CEMA50:1      tttexl
     C                   move      CCOMPN        tttexl
     c                   movel     SITLL         ttdepo
     C                   MOVE      'EMA'         TTACTI
     C                   EXSR      TTSR
     C                   MOVE      ULDT          RUDATO
     C                   MOVE      XULTM         RUTID
     C                   UPDATE    RUCKPUR
     C                   end
     C                   end
     C                   endsr
     C*******************************************************
     C     EPOSTSR       BEGSR
     C*******************************************************
S02  c*                  move      'J'           EPSENDT           1
     C     K002V         IFNE      'N'
     C                   CALL      'ARC002V'
     C                   PARM                    ARTYPE
     C                   PARM                    Aavd
     C                   PARM                    Aopd
     C                   PARM                    ARKVED
     C                   PARM                    CLIVE
     C                   PARM                    arinek
     C                   PARM                    tuknt
     C                   END
      * vedlegg generelt
      *
     c     arvedl        ifne      *blanks
     c                   eval      eplink = 'http://'
     C     eplink        CAT       arcpad:0      eplink
     C     eplink        CAT       '/':0         eplink
     C     eplink        CAT       infban:0      eplink
     C     eplink        CAT       '/':0         eplink
     C     eplink        CAT       arvedl:0      eplink
     C                   move      *blanks       uhttpesta       152
     c                   eval      epline = 'http://'
     C     epline        CAT       arcpae:0      epline
     C     epline        CAT       '/':0         epline
     C     epline        CAT       infban:0      epline
     C     epline        CAT       '/':0         epline
     C     epline        CAT       arvedl:0      epline
     C                   eval      epbane = '/'
     C     epbane        CAT       infban:0      epbane
     C     epbane        CAT       '/':0         epbane
     C     epbane        CAT       arvedl:0      epbane
     C                   EVAL      EPMAIN = 'V'
     C                   move      *blanks       eptex1
     C                   move      *blanks       eptex2
     C                   write     arkepor
     C                   END
      *
     c     cemne         ifne      *blanks
     c                   move      cemne         wscvp1
     c                   end
     C                   MOVE      wscvp11n      wscvp11
     C     spraak        ifeq      'E'
     c     spraak        oreq      'T'
     C                   MOVE      wscvp11e      wscvp11
     c                   end
     C                   MOVE      ARCMRG        FIRMRG            1
     C     ARMRG         IFNE      ' '
     C                   MOVE      ARMRG         FIRMRG
     C                   END
     C     CMERGE        IFNE      ' '
     C                   MOVE      CMERGE        FIRMRG
     C                   END
     c     CEMAIL        ifeq      '@user'
     c                   exsr      hentep
     C                   END
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           80
     c                   parm                    wscvp2           80
     c                   parm                    wscvp3           80
     c                   parm                    wscvp4           80
     C                   parm                    wscvp5           80
     C                   parm                    wscvp6           80
     C                   parm                    wscvp7           80
     C                   parm                    wscvp8           80
     C                   parm                    wscvp9           80
     C                   parm                    wscvp10          80
     C                   parm                    wscvp11          80
     C                   parm                    wscvp12          80
     C                   parm                    inteks            1
     C                   PARM                    AAVD
     C                   PARM                    AOPD
     C                   PARM                    ATUR
     C                   PARM                    AKUN
     C                   PARM                    FIRMRG
     C                   ENDSR
      *******************************************************************
     c     hentep        begsr
      *******************************************************************
     C                   MOVE      *BLANKS       INTADR
     C                   CALL      'EPOS04E'
     C                   PARM                    UUSR
     C                   PARM                    DIRENA            8
     C                   PARM                    DIREAD            8
     C                   PARM                    INTADR           70
     C                   EVAL      CEMAIL=INTADR
     c                   endsr
     O*                                                                   D150
     OARKIVR    E            UPDARK
     O                       ARSTAT
     O                       ARLINK
     OARKIVR2   E            UPDARK2
     O                       ARSTAT
     O                       ARLINK
     O                       ARDATE
     O                       ARTIME
