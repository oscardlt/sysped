     FDKIV      IF   E           K DISK
     FDKIVA     IF   E           K DISK
     FDKIH      IF   E           K DISK
     FDKTHA     IF   E           K DISK
     FKODTP     IF   E           K DISK
     FKODTFM    IF   E           K DISK
     FDKI047P   O    E             PRINTER OFLIND(*IN27) USROPN
     FFIRM      IF   E             DISK
     FARKTXT    IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FARKIVP    O  A E           K DISK
     D                SDS
     D  ZUSER                254    263
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    UKIHASYAV         4
     C                   PARM                    UKIHASYOP         7
     C                   PARM                    CALLTYP           1
     C                   MOVE      UKIHASYAV     UKIH_SYAV
     C                   MOVE      UKIHASYOP     UKIH_SYOP
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    DKIH_SYAV     UKIH_SYAV
     C     *LIKE         DEFINE    DKIH_SYOP     UKIH_SYOP
     C     *LIKE         DEFINE    KOPUNI        UOPUNI
     C     *LIKE         DEFINE    KOPAVD        UOPAVD
     C     *LIKE         DEFINE    KOPLNR        UOPLNR
     C     *LIKE         DEFINE    KFMSD         UFMSD
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYA          KLIST
     C                   KFLD                    UKIH_SYAV
     C                   KFLD                    UKIH_SYOP
     C     KEYB          KLIST
     C                   KFLD                    UKIH_SYAV
     C                   KFLD                    UKIH_SYOP
     C                   KFLD                    DKIV_SYLI
     C     KEYP          KLIST
     C                   KFLD                    UOPUNI
     C                   KFLD                    UOPAVD
     C                   KFLD                    UOPLNR
     C     KEYF          KLIST
     C                   KFLD                    KOPFM
     C                   KFLD                    UFMSD
      *_____________
      * Init av felt
      *"""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           WDT80             8 0
     C                   EVAL      UOPUNI='P'
     C                   EVAL      UOPAVD=UKIH_SYAV
     C                   EVAL      UOPLNR=251
     C                   EVAL      UFMSD=1
     C                   Z-ADD     1024          UCMDL            15 5
     C                   MOVE      *BLANKS       UCMD           1024
      *______________________________________
      * Hente firmaopplysninger fra spedisjon
      *""""""""""""""""""""""""""""""""""""""
     C                   READ      FIRM
      *_____________________
      * Hente printerstyring
      *"""""""""""""""""""""
     C     KEYP          CHAIN     KODTP
     C     KEYF          CHAIN     KODTFM
      *_______________
      * Printerstyring
      *"""""""""""""""
      *_______________
      * Printerstyring ikke ved arkiv
      *"""""""""""""""
     C     calltyp       ifne      'A'
     C     koplas        andne     'P'
N01  C     koplas        andne     'F'
     C                   OPEN      DKI047P
     C                   EVAL      UCMD='OVRPRTF FILE(DKI047P) OUTQ('
      *
     C     UCMD          CAT       KOPNVN:0      UCMD
     C     UCMD          CAT       ')':0         UCMD
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     c                   end
      *
      * PDF vdirekte print
     C     KOPLAS        IFEQ      'P'
N01  C     KOPLAS        oreq      'F'
N01  C     calltyp       ifne      'A'
     C                   CALL      'DKI047C'
     C                   PARM                    KOPNVN
     C                   PARM                    CALLTYP
     C                   OPEN      DKI047P
N01  c                   end
     C                   END
      * arkivering
     C     calltyp       ifeq      'A'
     C                   CALL      'DKI047CA'
     C                   OPEN      DKI047P
     C                   END
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Læs varuposter                                       SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
     C     KEYA          CHAIN     DKIH

     C     KEYA          SETLL     DKIV
     C     KEYA          READE     DKIV                                   51
     C     *IN51         DOWEQ     *OFF
     C                   EXSR      SRBB
     C                   WRITE     DKI047PA

     C     KEYA          READE     DKIV                                   51
     C  N51              ENDDO

     C     CALLTYP       IFEQ      'C'
     C                   EXSR      ARKSR
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Fyll upp varuposter                                 SRBB /
      *////////////////////////////////////////////////////////////
     C     SRBB          BEGSR
      * rensa alla fælt
     C                   CLEAR                   DKI047PA
     C     KEYA          CHAIN     DKIH
      * gemensamma variablar før alla 3 kolonner
     C                   EVAL      W11C=DKIH_221
     C                   EVAL      W11D=DKIH_221B
     C                   EVAL      W17=DKIH_A
     C                   EVAL      W21A=DKIV_T21A
     C                   EVAL      W25A1=DKIV_T25A
     C                   EVAL      W25B1=DKIV_T25B
     C                   EVAL      W25C1=DKIV_T25C
     C                   EVAL      W25D1=DKIV_T25D
      * Kolonn-1
     C                   EVAL      WVP1=DKIV_32
     C                   EVAL      W11A1=DKIV_42
     C                   EVAL      W11B1=DKIV_T11B
     C                   EVAL      W121=DKIV_T12
     C                   EVAL      W13A1=DKIV_T13A
     C                   EVAL      W13B1=DKIV_T13B
     C                   EVAL      W13C1=DKIV_T13C
     C                   EVAL      W14A1=DKIV_T14A
     C                   EVAL      W14B1=DKIV_T14B
     C                   EVAL      W14C1=DKIV_T14C
     C                   EVAL      W14D1=DKIV_T14D
     C                   EVAL      W151=DKIV_T15
     C                   EVAL      W161=DKIV_T16
     C                   EVAL      W17A1=DKIV_T17A
     C                   EVAL      W17B1=DKIV_T17B
     C                   EVAL      W17C1=DKIV_T17C
     C                   EVAL      W181=DKIV_T18
     C                   EVAL      W191=DKIV_T19
     C                   EVAL      W201=DKIV_T20
     C                   EVAL      W21B1=DKIV_T21B
     C                   EVAL      W221=DKIV_T22
     C                   EVAL      W231=DKIV_T23
     C                   EVAL      W241=DKIV_T24
      * Kolonn-2
     C     KEYA          READE     DKIV                                   51
     C     *IN51         CABEQ     *ON           SRBB9
     C                   EVAL      WVP2=DKIV_32
     C                   EVAL      W11A2=DKIV_42
     C                   EVAL      W11B2=DKIV_T11B
     C                   EVAL      W122=DKIV_T12
     C                   EVAL      W13A2=DKIV_T13A
     C                   EVAL      W13B2=DKIV_T13B
     C                   EVAL      W13C2=DKIV_T13C
     C                   EVAL      W14A2=DKIV_T14A
     C                   EVAL      W14B2=DKIV_T14B
     C                   EVAL      W14C2=DKIV_T14C
     C                   EVAL      W14D2=DKIV_T14D
     C                   EVAL      W152=DKIV_T15
     C                   EVAL      W162=DKIV_T16
     C                   EVAL      W17A2=DKIV_T17A
     C                   EVAL      W17B2=DKIV_T17B
     C                   EVAL      W17C2=DKIV_T17C
     C                   EVAL      W182=DKIV_T18
     C                   EVAL      W192=DKIV_T19
     C                   EVAL      W202=DKIV_T20
     C                   EVAL      W21B2=DKIV_T21B
     C                   EVAL      W222=DKIV_T22
     C                   EVAL      W232=DKIV_T23
     C                   EVAL      W242=DKIV_T24
      * Kolonn-3
     C     KEYA          READE     DKIV                                   51
     C     *IN51         CABEQ     *ON           SRBB9
     C                   EVAL      WVP3=DKIV_32
     C                   EVAL      W11A3=DKIV_42
     C                   EVAL      W11B3=DKIV_T11B
     C                   EVAL      W123=DKIV_T12
     C                   EVAL      W13A3=DKIV_T13A
     C                   EVAL      W13B3=DKIV_T13B
     C                   EVAL      W13C3=DKIV_T13C
     C                   EVAL      W14A3=DKIV_T14A
     C                   EVAL      W14B3=DKIV_T14B
     C                   EVAL      W14C3=DKIV_T14C
     C                   EVAL      W14D3=DKIV_T14D
     C                   EVAL      W153=DKIV_T15
     C                   EVAL      W163=DKIV_T16
     C                   EVAL      W17A3=DKIV_T17A
     C                   EVAL      W17B3=DKIV_T17B
     C                   EVAL      W17C3=DKIV_T17C
     C                   EVAL      W183=DKIV_T18
     C                   EVAL      W193=DKIV_T19
     C                   EVAL      W203=DKIV_T20
     C                   EVAL      W21B3=DKIV_T21B
     C                   EVAL      W223=DKIV_T22
     C                   EVAL      W233=DKIV_T23
     C                   EVAL      W243=DKIV_T24

     C     SRBB9         TAG

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *    Arkiver                                          ARKSR /
      /////////////////////////////////////////////////////////////
     C     ARKSR         BEGSR
      * SKAL DOKUMENT ARKIVERES ?
     C                   MOVE      'D3'          ARTYPE
     C     FIFIRM        CHAIN     FIRMARC                            34
     C  N34ARTYPE        CHAIN     ARKTXT                             34
     C     *IN(34)       IFEQ      '0'
     C     ARKJN         ANDEQ     'J'

     C                   z-add     DKIH_AVKN     ARKUND
     C                   MOVE      FIFIRM        ARFIRM
     C                   MOVE      UKIH_SYAV     ARAVD
     C                   MOVE      UKIH_SYOP     AROPD
     C                   MOVE      WDT           ARDATE
     C                   MOVE      WTM           ARTIME
     C                   MOVE      ZUSER         ARUSER
     C                   MOVE      UKIH_SYOP     ARUNDE
     C                   MOVEL     'D3:'         ARUNDE
     C                   WRITE     ARKIVR
      *_________________________
      * Aktivera arkivfunktionen  FJERNES SENERE
      *"""""""""""""""""""""""""
     C     DKIH_SYSG     CHAIN     DKTHA
     C                   CALL      'ARC002CLB'
     C                   PARM      'D3'          WATYPE            2
     C                   PARM                    ARUSER
     C                   ENDIF
     C                   ENDSR
