********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10198 * 01 JOV PTF10 Tegnesett/versjon  ... fjern søkebegrep ETTER søk topplinja (I->B i DDS)
10208 * 02 JOV PTF10 VIS KUNDENR I SUBFILA, søk kunde /F9 = switch visning
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
12XXX * 03 YBC PTF12 OPPDATERE FIRMAKODE
12015 * 04 YBC PTF12 OPPDATERE AVSENDER/MOTTAKER PÅ CUNDC
********************************************************************
     H DATEDIT(*YMD)
     FCUNDL01   IF   E           K DISK    USROPN
     FECMSG3    UF A E           K DISK
     FEDIIJ1    IF   E           K DISK
     FEDII      IF   E           K DISK
     FFIRM      IF   E             DISK    USROPN
N04  FCUNDC01   UF   E           K DISK
     FE003D     CF   E             WORKSTN
     F                                     SFILE(E003H50:ZRECNO)
     F                                     INFDS(FBAREA)
      *
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D RCVAR           DS
     D  OBJNAM                 8     17
     D RCVAR2          DS
     D  A                      1      4B 0
     D  B                      5      8B 0
     D  RCVERR                 9     15
     D  C                     16     16
     D  D                     17     76
     D                 DS
     D  RCVLE                  1      4B 0
N02  D                 DS
N02  D  WSONAV                 1     30
N02  D  WSONA20                1     20
      *______________________
      * Initialize subroutine
      *""""""""""""""""""""""
     C                   EXSR      INIT
      *___________________________
      * Main logic subset criteria
      *"""""""""""""""""""""""""""
     C     MAIN01        TAG
     C                   EXFMT     E003B10
     C     *IN03         CABEQ     '1'           ENDPGM
     C     *IN04         IFEQ      *ON
     C                   EXSR      SOEK2
     C                   GOTO      MAIN01
     C                   ENDIF
      *
     C     START0        TAG
      *
     C     *LOVAL        SETLL     EDIIJ1
      *______________
      * Clear Subfile
      *""""""""""""""
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     E003K60
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     0             ZRECNO
     C                   MOVEA     '00000000'    *IN(30)
     C                   MOVEA     '000'         *IN(38)
      *_____________
      * Fill Subfile
      *"""""""""""""
     C     START1        TAG
     C                   DO        14
     C     NEXT          TAG
     C                   READ      EDIIJ1                                 94
     C     *IN94         IFEQ      '0'
     C     EC0065        CABEQ     'SYSPED'      NEXT
     C     WWIIDC        IFNE      *BLANKS
     C     WWIIDC        CABNE     ECIIDC        NEXT
     C                   END
N02  C     WWCNO         IFNE      *ZEROS
N02  C     WWCNO         CABNE     ECCNO         NEXT
N02  C                   END
     C     WWIIDI        IFNE      *BLANKS
     C     WWIIDI        CABNE     ECIIDI        NEXT
     C                   END
     C     WW0065        IFNE      *BLANKS
     C     WW0065        CABNE     EC0065        NEXT
     C                   END
     C     WW0054        IFNE      *BLANKS
     C     WW0054        CABNE     EC0054        NEXT
     C                   END
     C     WWSR          IFNE      *BLANKS
     C     WWSR          CABNE     ECSR          NEXT
     C                   END
     C                   MOVEL     ECIIDC        WWWIDC
N02  C                   MOVEL     INNA          SFNAVN
N02  C     *in50         ifeq      '1'
N02  C     ECCNO         andne     *zeros
N02  c     KunKey        chain     Cundl01
N02  C  N33              MOVEL     KNAVN         SFNAVN
N02  c                   endif
     C                   ADD       1             ZRECNO
     C                   WRITE     E003H50
     C                   END                                                    <*IN94
     C  N94              ENDDO                                                  <DO 14
      *
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C     ZRECNO        IFGT      0
     C     ZRECNO        SUB       1             CURS1
     C     CURS1         DIV       14            CURS1
     C     CURS1         MULT      14            CURS1
     C                   ADD       1             CURS1
     C                   ENDIF
      *________________
      * Display Subfile
      *""""""""""""""""
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C     VISB30        TAG
     C                   EXFMT     E003B30
      *
     C                   ELSE                                                   <ZRECNO
     C                   WRITE     E003B40
     C                   EXFMT     E003K60
     C                   END                                                    <ZRECNO
      *
     C                   MOVE      *OFF          *IN30
      *
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   END
      *
     C                   SETOFF                                       999830
      *** F3=Exit
     C     *IN03         IFEQ      '1'
     C                   GOTO      ENDPGM
     C                   END                                                    <*IN03
      *** F5=Refresh
     C     *IN05         IFEQ      '1'
     C                   GOTO      START0
     C                   END                                                    <*IN05
N02   *** 09=Refresh/vis kunde /partsID
N02  C     *IN09         IFEQ      '1'
N02  C     *IN50         IFEQ      '0'
N02  C                   move      '1'           *IN50
N02  c                   else
N02  C                   move      '0'           *IN50
N02  c                   endif
N02  C                   GOTO      START0
N02  C                   END                                                    <*IN05
      *** F6=New
     C     *IN06         IFEQ      '1'
     C                   MOVE      *ON           *IN46
     C                   EXSR      NEW
     C                   MOVE      *OFF          *IN46
     C                   GOTO      START0
     C                   END                                                    <*IN06
      *** F12=Cancel
     C     *IN12         IFEQ      '1'
     C                   GOTO      MAIN01
     C                   MOVE      *OFF          *IN12
     C                   END                                                    <*IN12
      *** Roll
     C     *IN25         IFEQ      '1'
     C     *IN94         ANDEQ     '0'                                           EOF
     C                   Z-ADD     YRECNO        ZRECNO
     C                   MOVE      '0'           *IN25
     C                   GOTO      START1
     C                   END                                                    <*IN25
      *** Nytt Søk
     C     WSONAV        IFNE      *BLANKS
     C     WSONAV        SETLL     EDIIJ1                             90
     C     *IN90         IFEQ      *ON                                          <Forbi EOF
     C     *HIVAL        SETGT     EDIIJ1
     C                   READP     EDIIJ1                                 90
     C                   READP     EDIIJ1                                 90
     C                   END                                                    <*IN91
     C                   MOVEL     *BLANKS       WSONAV
     C                   GOTO      START
     C                   END                                                    <WSONAV
      *
      *** Get options from screen
     C     ZRECNO        IFNE      0
     C                   EXSR      GETOPT
     C     *IN03         CABEQ     '1'           ENDPGM
     C     *IN12         CABEQ     '1'           START3
     C                   END                                                    <ZRECNO
      *
     C                   GOTO      START3
      *
     C     ENDPGM        TAG
     C                   MOVE      '1'           *INLR
     C                   RETURN
      *
      ***********************************************
     C     GETOPT        BEGSR
      ***********************************************
     C                   Z-ADD     0             OPTNBR            2 0
     C                   SETOFF                                       919299
     C     *IN98         DOWEQ     '0'
     C                   READC     E003H50                                98
     C     *IN98         IFEQ      '1'
     C                   GOTO      ENDGET
     C                   END                                                    <*IN98
     C                   MOVEA     '00000000'    *IN(30)
     C                   MOVEA     '000'         *IN(38)
      ***  BLANK
     C     WSNR          IFEQ      ' '
     C                   UPDATE    E003H50
     C                   ELSE                                                   <WSNR
     C                   Z-ADD     ZRECNO        CURS1
      *** 2=Endre
     C     WSNR          IFEQ      '2'
     C                   MOVE      *ON           *IN42
     C                   EXSR      UPD
     C                   MOVE      *OFF          *IN42
     C                   MOVE      ' '           WSNR
     C                   UPDATE    E003H50
     C                   END                                                    <WSNR
      *** 3=Kopiere
     C     WSNR          IFEQ      '3'
     C                   MOVE      *ON           *IN43
     C                   EXSR      CPY
     C                   MOVE      *OFF          *IN43
     C                   MOVE      ' '           WSNR
     C                   UPDATE    E003H50
     C                   END                                                    <WSNR
      *** 4=Slette
     C     WSNR          IFEQ      '4'
     C                   MOVE      *ON           *IN44
     C                   MOVE      *ON           *IN88
     C                   EXSR      DLT
     C                   MOVE      *OFF          *IN44
     C                   MOVE      *OFF          *IN88
     C                   MOVE      ' '           WSNR
     C                   UPDATE    E003H50
     C                   END                                                    <WSNR
      *** 5=Display
     C     WSNR          IFEQ      '5'
     C                   MOVE      ' '           WSNR
     C                   UPDATE    E003H50
     C                   MOVE      *ON           *IN45
     C                   MOVE      *ON           *IN88
     C                   EXSR      MOVTLÅ
     C                   EXFMT     E003B20
     C                   MOVE      *OFF          *IN45
     C                   MOVE      *OFF          *IN88
     C                   END                                                    <WSNR
      *
     C                   END                                                    <WSNR=BLANK
      *
     C     *IN03         CABEQ     '1'           ENDGET
     C     *IN12         CABEQ     '1'           ENDGET
      *
     C                   ENDDO
      *
     C     ENDGET        TAG
     C                   MOVE      *OFF          *IN54
      *
     C                   ENDSR
      ***********************************************
     C     UPD           BEGSR
      ***********************************************
     C                   EXSR      MOVTLÅ
N02  C     ÅCCNO         IFNE      0
N02  C     KUNDKI        CHAIN     CUNDL01                            90
N02  C   90              MOVE      *BLANKS       KNAVN
N02  C                   ENDIF
     C     UPD01         TAG
     C                   EXFMT     E003B20
     C                   MOVEA     '00000000'    *IN(30)
     C                   MOVEA     '000'         *IN(38)
N01  C                   MOVEA     '00'          *IN(41)
     C     *IN03         CABEQ     *ON           UPD99
     C     *IN12         CABEQ     *ON           UPD99
     C     *IN04         IFEQ      *ON
     C                   EXSR      SOEK
     C                   GOTO      UPD01
     C                   ENDIF
      * KUNDENUMMER
     C     *IN61         IFEQ      *OFF
     C     *IN62         ANDEQ     *OFF
     C     ÅCCNO         ANDGT     0
S02  C*    KUNDKI        SETLL     CUNDL01                                90
S02  C*    *IN90         IFEQ      *OFF                                         <No records
N02  C     KUNDKI        CHAIN     CUNDL01                            90
N02  C   90              MOVE      *BLANKS       KNAVN
N02  C     *IN90         IFEQ      *ON                                          <No records
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN34
     C                   MOVE      'CBA0050'     MSGNR
     C                   ENDIF
     C                   ENDIF
      * PART
     C     ÅCIIDC        SETLL     EDII                                   90
     C     *IN90         IFEQ      *OFF                                         <No records
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN35
     C                   MOVE      'BBA0133'     MSGNR
     C                   ENDIF
      * PART
     C     ÅCIIDI        SETLL     EDII                                   90
     C     *IN90         IFEQ      *OFF                                         <No records
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN36
     C                   MOVE      'BBA0133'     MSGNR
     C                   ENDIF
      * MESSAGE TYPE
     C     ÅC0065        IFEQ      *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN37
     C                   MOVE      'BBA0135'     MSGNR
     C                   ENDIF
      * MESSAGE TYPE RELEASE
     C     ÅC0054        IFEQ      *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN38
     C                   MOVE      'BBA0135'     MSGNR
     C                   ENDIF
      * SEND/RECEIVE
     C     ÅCSR          IFNE      'S'
     C     ÅCSR          ANDNE     'R'
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN39
     C                   MOVE      'BBA0136'     MSGNR
     C                   ENDIF
      * ÅCSEND
     C     ÅCSEND        IFNE      ' '
     C     ÅCSEND        ANDNE     'J'
     C     ÅCSEND        ANDNE     'Y'
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN40
     C                   MOVE      'BBA0136'     MSGNR
     C                   ENDIF
      * PGM
     C     ÅCPGM         IFNE      *BLANKS
     C     ÅCLIB         ANDEQ     *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN31
     C                   MOVE      'CBA0060'     MSGNR
     C                   ENDIF
      * DTAQ
     C     ÅCDTAQ        IFNE      *BLANKS
     C     ÅCLIB         ANDEQ     *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN32
     C                   MOVE      'CBA0060'     MSGNR
     C                   ENDIF
      * PGM og DTAQ
     C     ÅCPGM         IFNE      *BLANKS
     C     ÅCDTAQ        ANDNE     *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN31
     C                   MOVE      '1'           *IN32
     C                   MOVE      'CBA0080'     MSGNR
     C                   ENDIF
      * Do PGM or DTAQ exist ?
     C     ÅCPGM         IFNE      *BLANKS
     C     ÅCDTAQ        ORNE      *BLANKS
     C                   EXSR      CHKOBJ
     C     RCVERR        IFEQ      'CPF9801'
     C     RCVERR        OREQ      'CPF9810'
     C     RCVERR        OREQ      'CPF9811'
     C     RCVERR        OREQ      'CPF9811'
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN31
     C                   MOVE      '1'           *IN32
     C                   MOVE      'CBA0070'     MSGNR
     C                   ENDIF
     C                   ENDIF
      * Hvis nøkkelverdier er endret, sjekkes det at ikke post finnes
      * fra før.
     C     ÅCSR          IFNE      ECSR
     C     ÅC0065        ORNE      EC0065
     C     ÅC0054        ORNE      EC0054
     C     ÅCIIDC        ORNE      ECIIDC
     C     ÅCIIDI        ORNE      ECIIDI
     C     ÅCCNO         ORNE      ECCNO
     C     ÅMSGKY        SETLL     ECMSG3                                 90
     C     *IN90         IFEQ      *ON                                          <Finnes
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN34
     C                   MOVE      '1'           *IN35
     C                   MOVE      '1'           *IN36
     C                   MOVE      '1'           *IN37
     C                   MOVE      '1'           *IN39
     C                   MOVE      'BBA0134'     MSGNR
     C                   ENDIF
     C                   ENDIF
N01
N01   * Tegnsett / versjon - ente begge blan elle begge utfylt
N01  C     ÅC0001        ifne      *blanks
N01  C     ÅC0002        ifeq      *blanks
N01  C                   MOVE      '1'           *IN30
N01  C                   MOVE      '1'           *IN41
N01  C                   MOVE      'JOV1586'     MSGNR
N01  c                   endif
N01  c                   else
N01  C     ÅC0002        ifne      *blanks
N01  C                   MOVE      '1'           *IN30
N01  C                   MOVE      '1'           *IN41
N01  C                   MOVE      'JOV1586'     MSGNR
N01  c                   endif
N01  c                   endif
      *
     C     *IN30         CABEQ     *ON           UPD01
      *
     C     MSGKEY        CHAIN     ECMSG3                             90
     C     *IN90         IFEQ      *OFF
     C                   EXSR      MOVFRÅ
N03  C                   EVAL      ECFIR = FIFIRM
     C                   UPDATE    ECMSGR
N04  C                   EXSR      SRUPDXML
     C                   ENDIF
      *
     C     UPD99         ENDSR
      ***********************************************
     C     CPY           BEGSR
      ***********************************************
     C                   EXSR      MOVTLÅ
     C     CPY01         TAG
     C                   EXFMT     E003B20
     C                   MOVEA     '00000000'    *IN(30)
     C                   MOVEA     '000'         *IN(38)
     C     *IN03         CABEQ     *ON           CPY99
     C     *IN12         CABEQ     *ON           CPY99
     C     *IN04         IFEQ      *ON
     C                   EXSR      SOEK
     C                   GOTO      CPY01
     C                   ENDIF
      * KUNDENUMMER
     C     *IN61         IFEQ      *OFF
     C     *IN62         ANDEQ     *OFF
     C     ÅCCNO         ANDGT     0
     C     KUNDKI        SETLL     CUNDL01                                90
     C     *IN90         IFEQ      *OFF                                         <No records
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN34
     C                   MOVE      'CBA0050'     MSGNR
     C                   ENDIF
     C                   ENDIF
      * PART
     C     ÅCIIDC        IFNE      *BLANKS
     C     ÅCIIDC        SETLL     EDII                                   90
     C     *IN90         IFEQ      *OFF                                         <No records
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN35
     C                   MOVE      'BBA0133'     MSGNR
     C                   ENDIF
     C                   ENDIF
      * PART
     C     ÅCIIDI        IFNE      *BLANKS
     C     ÅCIIDI        SETLL     EDII                                   90
     C     *IN90         IFEQ      *OFF                                         <No records
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN36
     C                   MOVE      'BBA0133'     MSGNR
     C                   ENDIF
     C                   ENDIF
      * MESSAGE TYPE
     C     ÅC0065        IFEQ      *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN37
     C                   MOVE      'BBA0135'     MSGNR
     C                   ENDIF
      * MESSAGE TYPE RELEASE
     C     ÅC0054        IFEQ      *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN38
     C                   MOVE      'BBA0135'     MSGNR
     C                   ENDIF
      * SEND/RECEIVE
     C     ÅCSR          IFNE      'S'
     C     ÅCSR          ANDNE     'R'
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN39
     C                   MOVE      'BBA0135'     MSGNR
     C                   ENDIF
      * ÅCSEND
     C     ÅCSEND        IFNE      ' '
     C     ÅCSEND        ANDNE     'J'
     C     ÅCSEND        ANDNE     'Y'
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN40
     C                   MOVE      'BBA0136'     MSGNR
     C                   ENDIF
      * PGM
     C     ÅCPGM         IFNE      *BLANKS
     C     ÅCLIB         ANDEQ     *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN31
     C                   MOVE      'CBA0060'     MSGNR
     C                   ENDIF
      * DTAQ
     C     ÅCDTAQ        IFNE      *BLANKS
     C     ÅCLIB         ANDEQ     *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN32
     C                   MOVE      'CBA0060'     MSGNR
     C                   ENDIF
      * PGM og DTAQ
     C     ÅCPGM         IFNE      *BLANKS
     C     ÅCDTAQ        ANDNE     *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN31
     C                   MOVE      '1'           *IN32
     C                   MOVE      'CBA0080'     MSGNR
     C                   ENDIF
      * Do PGM or DTAQ exist ?
     C     ÅCPGM         IFNE      *BLANKS
     C     ÅCDTAQ        ORNE      *BLANKS
     C                   EXSR      CHKOBJ
     C     RCVERR        IFEQ      'CPF9801'
     C     RCVERR        OREQ      'CPF9810'
     C     RCVERR        OREQ      'CPF9811'
     C     RCVERR        OREQ      'CPF9811'
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN31
     C                   MOVE      '1'           *IN32
     C                   MOVE      'CBA0070'     MSGNR
     C                   ENDIF
     C                   ENDIF
      * Kontroller at ikke post finnes fra før.
     C     ÅMSGKY        SETLL     ECMSG3                                 90
     C     *IN90         IFEQ      *ON                                          <Finnes
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN34
     C                   MOVE      '1'           *IN35
     C                   MOVE      '1'           *IN36
     C                   MOVE      '1'           *IN37
     C                   MOVE      '1'           *IN39
     C                   MOVE      'BBA0134'     MSGNR
     C                   ENDIF
      *
     C     *IN30         CABEQ     *ON           CPY01
      *
     C                   EXSR      MOVFRÅ
N03  C                   EVAL      ECFIR = FIFIRM
     C                   WRITE     ECMSGR
N04  C                   EXSR      SRUPDXML
      *
     C     CPY99         ENDSR
      ***********************************************
     C     DLT           BEGSR
      ***********************************************
     C                   EXSR      MOVTLÅ
     C     DLT01         TAG
     C                   EXFMT     E003B20
     C                   MOVEA     '00000000'    *IN(30)
     C                   MOVEA     '000'         *IN(38)
     C     *IN03         CABEQ     *ON           DLT99
     C     *IN12         CABEQ     *ON           DLT99
      * Sletting må bekreftes med F11.
     C     *IN11         IFEQ      *ON
     C     MSGKEY        CHAIN     ECMSG3                             90
     C     *IN90         IFEQ      *OFF                                         <Finnes
     C                   DELETE    ECMSGR
     C                   GOTO      DLT99
     C                   ENDIF
     C                   ENDIF
      *
     C                   GOTO      DLT01
      *
     C     DLT99         ENDSR
      ***********************************************
     C     NEW           BEGSR
      ***********************************************
     C                   CLEAR                   E003B20
     C     NEW01         TAG
N02  C     ÅCCNO         IFNE      0
N02  C     KUNDKI        CHAIN     CUNDL01                            90
N02  C   90              MOVE      *BLANKS       KNAVN
N02  C                   ENDIF
     C                   EXFMT     E003B20
     C                   MOVEA     '00000000'    *IN(30)
     C                   MOVEA     '000'         *IN(38)
     C     *IN03         CABEQ     *ON           NEW99
     C     *IN12         CABEQ     *ON           NEW99
     C     *IN04         IFEQ      *ON
     C                   EXSR      SOEK
     C                   GOTO      NEW01
     C                   ENDIF
      * KUNDENUMMER
     C     *IN61         IFEQ      *OFF
     C     *IN62         ANDEQ     *OFF
     C     ÅCCNO         ANDGT     0
S02  C*    KUNDKI        SETLL     CUNDL01                                90
S02  C*    *IN90         IFEQ      *OFF                                         <No records
N02  C     KUNDKI        CHAIN     CUNDL01                            90
N02  C   90              MOVE      *BLANKS       KNAVN
N02  C     *IN90         IFEQ      *ON                                          <No records
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN34
     C                   MOVE      'CBA0050'     MSGNR
     C                   ENDIF
     C                   ENDIF
      * PART
     C     ÅCIIDC        IFNE      *BLANKS
     C     ÅCIIDC        SETLL     EDII                                   90
     C     *IN90         IFEQ      *OFF                                         <No records
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN35
     C                   MOVE      'BBA0133'     MSGNR
     C                   ENDIF
     C                   ENDIF
      * PART
     C     ÅCIIDI        IFNE      *BLANKS
     C     ÅCIIDI        SETLL     EDII                                   90
     C     *IN90         IFEQ      *OFF                                         <No records
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN36
     C                   MOVE      'BBA0133'     MSGNR
     C                   ENDIF
     C                   ENDIF
      * MESSAGE TYPE
     C     ÅC0065        IFEQ      *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN37
     C                   MOVE      'BBA0135'     MSGNR
     C                   ENDIF
      * MESSAGE TYPE RELEASE
     C     ÅC0054        IFEQ      *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN38
     C                   MOVE      'BBA0135'     MSGNR
     C                   ENDIF
      * SEND/RECEIVE
     C     ÅCSR          IFNE      'S'
     C     ÅCSR          ANDNE     'R'
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN39
     C                   MOVE      'BBA0135'     MSGNR
     C                   ENDIF
      * ÅCSEND
     C     ÅCSEND        IFNE      ' '
     C     ÅCSEND        ANDNE     'J'
     C     ÅCSEND        ANDNE     'Y'
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN40
     C                   MOVE      'BBA0136'     MSGNR
     C                   ENDIF
      * PGM
     C     ÅCPGM         IFNE      *BLANKS
     C     ÅCLIB         ANDEQ     *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN31
     C                   MOVE      'CBA0060'     MSGNR
     C                   ENDIF
      * DTAQ
     C     ÅCDTAQ        IFNE      *BLANKS
     C     ÅCLIB         ANDEQ     *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN32
     C                   MOVE      'CBA0060'     MSGNR
     C                   ENDIF
      * PGM og DTAQ
     C     ÅCPGM         IFNE      *BLANKS
     C     ÅCDTAQ        ANDNE     *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN31
     C                   MOVE      '1'           *IN32
     C                   MOVE      'CBA0080'     MSGNR
     C                   ENDIF
      * Do PGM or DTAQ exist ?
     C     ÅCPGM         IFNE      *BLANKS
     C     ÅCDTAQ        ORNE      *BLANKS
     C                   EXSR      CHKOBJ
     C     RCVERR        IFEQ      'CPF9801'
     C     RCVERR        OREQ      'CPF9810'
     C     RCVERR        OREQ      'CPF9811'
     C     RCVERR        OREQ      'CPF9811'
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN31
     C                   MOVE      '1'           *IN32
     C                   MOVE      'CBA0070'     MSGNR
     C                   ENDIF
     C                   ENDIF
      * Kontroller at ikke post finnes fra før.
     C     ÅMSGKY        SETLL     ECMSG3                                 90
     C     *IN90         IFEQ      *ON                                          <Finnes
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN34
     C                   MOVE      '1'           *IN35
     C                   MOVE      '1'           *IN36
     C                   MOVE      '1'           *IN37
     C                   MOVE      '1'           *IN39
     C                   MOVE      'BBA0134'     MSGNR
     C                   ENDIF
      *
     C     *IN30         CABEQ     *ON           NEW01
      *
     C                   EXSR      MOVFRÅ
N03  C                   EVAL      ECFIR = FIFIRM
     C                   WRITE     ECMSGR
N04  C                   EXSR      SRUPDXML
      *
     C     NEW99         ENDSR
N04   *////////////////////////////////////////////////////////////
N04   *  Ved xml-faktura oppdater avsender/mottaker      SRUPDXML /
N04   *////////////////////////////////////////////////////////////
N04  C     SRUPDXML      BEGSR
N04  C                   IF        EC0065 = 'INVXML'
N04  C     CUNDC01KS     CHAIN     CUNDC01                            33
N04  C                   IF        *IN33 = *OFF
N04  C                   EVAL      CMOBIL = ECIIDI
N04  C                   EVAL      CFAX   = ECIIDC
N04  C                   UPDATE    CUNDCR
N04  C                   ENDIF
N04  C     CUNDC01KC     CHAIN     CUNDC01                            33
N04  C                   IF        *IN33 = *OFF
N04  C                   EVAL      CMOBIL = ECIIDI
N04  C                   EVAL      CFAX   = ECIIDC
N04  C                   UPDATE    CUNDCR
N04  C                   ENDIF
N04  C                   ENDIF
N04   *
N04  C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Check that object exist                           CHKOBJ /
      *////////////////////////////////////////////////////////////
     C     CHKOBJ        BEGSR
      *________________________________
      * Retreive Object Description API
      *""""""""""""""""""""""""""""""""
     C                   MOVEL     *BLANKS       RCVERR
     C     ÅCPGM         IFNE      *BLANKS
     C                   MOVEL     ÅCPGM         OBJLIB
     C                   MOVE      ÅCLIB         OBJLIB
     C                   MOVEL     '*PGM '       OBJTYP
     C                   ELSE
     C                   MOVEL     ÅCDTAQ        OBJLIB
     C                   MOVE      ÅCLIB         OBJLIB
     C                   MOVEL     '*DTAQ'       OBJTYP
     C                   ENDIF
     C                   Z-ADD     72            A
     C                   CALL      'QUSROBJD'
     C                   PARM                    RCVAR
     C                   PARM      17            RCVLE
     C                   PARM      'OBJD0100'    FMTNM             8
     C                   PARM                    OBJLIB           20
     C                   PARM                    OBJTYP           10
     C                   PARM                    RCVAR2
     C                   ENDSR
      ***********************************************
     C     MOVTLÅ        BEGSR
      ***********************************************
     C                   MOVEL     ECCNO         ÅCCNO
     C                   MOVEL     ECIIDC        ÅCIIDC
     C                   MOVEL     ECIIDI        ÅCIIDI
     C                   MOVEL     EC0065        ÅC0065
     C                   MOVEL     EC0054        ÅC0054
     C                   MOVEL     ECSR          ÅCSR
     C                   MOVEL     ECSEND        ÅCSEND
     C                   MOVEL     ECPGM         ÅCPGM
     C                   MOVEL     ECDTAQ        ÅCDTAQ
     C                   MOVEL     ECLIB         ÅCLIB
     C                   MOVEL     EC0001        ÅC0001
     C                   MOVEL     EC0002        ÅC0002
     C                   ENDSR
      ***********************************************
     C     MOVFRÅ        BEGSR
      ***********************************************
     C                   MOVEL     ÅCCNO         ECCNO
     C                   MOVEL     ÅCIIDC        ECIIDC
     C                   MOVEL     ÅCIIDI        ECIIDI
     C                   MOVEL     ÅC0065        EC0065
     C                   MOVEL     ÅC0054        EC0054
     C                   MOVEL     ÅCSR          ECSR
     C                   MOVEL     ÅCSEND        ECSEND
     C                   MOVEL     ÅCPGM         ECPGM
     C                   MOVEL     ÅCDTAQ        ECDTAQ
     C                   MOVEL     ÅCLIB         ECLIB
     C                   MOVEL     ÅC0001        EC0001
     C                   MOVEL     ÅC0002        EC0002
     C                   ENDSR
      ***********************************************
     C     SOEK          BEGSR
      ***********************************************
     C     WSCLOC        DIV       256           LINNBR            3 0
     C                   MVR                     POSNBR            3 0
N02  c                   select
N02  c     LINNBR        wheneq    5
N02  c     LINNBR        oreq      7
     C                   CALL      'EDI52R'
     C                   PARM                    PUTV             35
     C     PUTV          IFNE      *BLANKS
     C                   SELECT
     C     LINNBR        WHENEQ    5
     C                   MOVEL     PUTV          ÅCIIDC
     C     LINNBR        WHENEQ    7
     C                   MOVEL     PUTV          ÅCIIDI
     C                   ENDSL
     C                   ENDIF
N02  c     LINNBR        wheneq    14
N02  C                   MOVE      *BLANKS       KNAVN
N02  C                   CALL      'SOEKKUN'
N02  C                   PARM                    ÅCCNO
N02  C                   PARM                    FIFIRM
N02  C                   PARM                    KNAVN
N02  C                   ENDSL
     C                   ENDSR
      ***********************************************
     C     SOEK2         BEGSR
      ***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
N02  c                   select
N02  c     LINNBR        wheneq    7
N02  c     LINNBR        oreq      9
     C                   CALL      'EDI52R'
     C                   PARM                    PUTV             35
     C     PUTV          IFNE      *BLANKS
     C                   SELECT
     C     LINNBR        WHENEQ    7
     C                   MOVEL     PUTV          WWIIDC
     C     LINNBR        WHENEQ    9
     C                   MOVEL     PUTV          WWIIDI
     C                   ENDSL
     C                   ENDIF
N02  c     LINNBR        wheneq    8
N02  C                   MOVE      *BLANKS       KNAVN
N02  C                   CALL      'SOEKKUN'
N02  C                   PARM                    WWCNO
N02  C                   PARM                    FIFIRM
N02  C                   PARM                    KNAVN
N02  C                   ENDSL
      *
     C                   ENDSR
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
      *_____________________________________
      * Open files from SYSPED, if installed
      *"""""""""""""""""""""""""""""""""""""
     C                   OPEN      CUNDL01                              61
     C                   OPEN      FIRM                                 62
     C     MSGKEY        KLIST
     C                   KFLD                    ECSR
     C                   KFLD                    EC0065
     C                   KFLD                    EC0054
     C                   KFLD                    ECIIDC
     C                   KFLD                    ECIIDI
     C                   KFLD                    ECCNO
     C     ÅMSGKY        KLIST
     C                   KFLD                    ÅCSR
     C                   KFLD                    ÅC0065
     C                   KFLD                    ÅC0054
     C                   KFLD                    ÅCIIDC
     C                   KFLD                    ÅCIIDI
     C                   KFLD                    ÅCCNO
     C     KUNDKI        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    ÅCCNO
N02  C     KUNKey        KLIST
N02  C                   KFLD                    FIFIRM
N02  C                   KFLD                    ECCNO
N04  C     CUNDC01KS     KLIST
N04  C                   KFLD                    FIFIRM
N04  C                   KFLD                    ECCNO
N04  C                   KFLD                    SIN_CCONTA
N04  C     *LIKE         DEFINE    CCONTA        SIN_CCONTA
N04  C                   EVAL      SIN_CCONTA = 'SINGELFAKTURA'
N04  C     CUNDC01KC     KLIST
N04  C                   KFLD                    FIFIRM
N04  C                   KFLD                    ECCNO
N04  C                   KFLD                    SAM_CCONTA
N04  C     *LIKE         DEFINE    CCONTA        SAM_CCONTA
N04  C                   EVAL      SAM_CCONTA = 'SAMLEFAKTURA'
      *
     C     *IN61         IFEQ      *OFF
     C     *IN62         ANDEQ     *OFF
     C                   READ      FIRM                                   90
     C                   ENDIF
      *
     C                   Z-ADD     0             ZRECNO            4 0
      *
     C                   ENDSR
      *
