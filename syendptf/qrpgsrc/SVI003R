********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
P1000A* 01 CB  PTF10  kode till særskilda upplysningar
P1000A* 02 CB  PTF10  B00 må beregnes uansett
P10111* 03 CB  PTF10  Slett avgifter før omberegning
P1000A* 04 CB  PTF10  Sjekk at varelinjebeløp er null eller over null
P1000A* 05 CB  PTF10  Korrigering utregning av toll SRBAAA
P1000A* 06 CB  PTF10  Blanke flere felter ved ny
P1000A* 07 CB  PTF10  Bedre test ved lesing av tulltaxan
P1000A* 08 CB  PTF10  Vid Førfarande 4071 så ska lagerid behållas på varje linje
P1000A* 09 CB  PTF10  Automatisk viktberækning F10
P1000A* 10 CB  PTF10  Lægg till i kunders varuregister
P11042* 11 CB  PTF11  erstatt kode B00 med 1MT fra og med 20150101
P11XXX* 12 CB  PTF11  Ikke legg ut SE200 automatiskt
P11XXX* 13 CB  PTF11  Feil ved utregning av 1MT
P11066* 14 CB  PTF11  Hæmta Y-koder
P11XXX* 15 CB  PTF11  Automatisk førslag till CALLME=00
P11072* 16 CB  PTF11  Hæmta Tillæggskoder R33.3 .4 .5
P11075* 17 CB  PTF11  Kontroll av kollital
P11XXX* 18 CB  PTF11  Kontroll av decimaler
P11XXX* 19 CB  PTF11  Hæmta Y-koder och tillæggskoder också vid uppdatering 14, 16 utgår
P11079* 20 CB  PTF11  Automatiskt førmånskod, EU=300 ikke EU=100
P11XXX* 21 CB  PTF11  Automatiskt førmånskod=100 om A00=0 og EU
P11XXX* 22 CB  PTF11  Flytta hæmtning av Bilagda handlingar
P11091* 23 CB  PTF11  Mer kontroller på diff mellan huvud och varuposter
P11XXX* 24 CB  PTF11  Blanka ut status(ERR) vid uppdatering
P11XXX* 25 CB  PTF11  Via varupostnummer vid uppdatering
P11XXX* 26 CB  PTF11  Ændring avgiftslogik
P11XXX* 27 CB  PTF11  Inte hæmta alla variablar från kunders varuregister
P11172* 28 CB  PTF11  Anvænd ursprungsland istællet før avsændningsland
P12XXX* 29 CB  PTF12  Kontrollera kollislag
P12XXX* 30 CB  PTF12  Hämta varukodstext
P12XXX* 31 CB  PTF12  Div by zero
P12XXX* 32 CB  PTF12  HNU/HNK
********************************************************************
     FSVI003D   CF   E             WORKSTN
     F                                     SFILE(SVI003DA:ZRECNO)
     F                                     INFDS(FBAREA)
     FSVIV      UF A E           K DISK
     FSVIV1     IF   E           K DISK
     F                                     RENAME(SVIVR:SVIVR1)
     FSVIH      IF   E           K DISK
     FSVIVA     UF A E           K DISK
     FSVTX04F   IF   E           K DISK
     FSVTX08F2  IF   E           K DISK
     FSVTX03F   IF   E           K DISK
N30  FSVTX10F   IF   E           K DISK
     FSVTPRO    IF   E           K DISK
     FSVTVK     IF   E           K DISK
     FSVTLV     IF   E           K DISK
     FSVIW      IF   E           K DISK
     FSVIF      IF   E           K DISK
     D  WT             S             19    DIM(90)
     D                 DS
     D  WVTA                   1     19
     D  WVTA_X                 1      1
     D  WVTA_SAT               2     11S 3
     D  WVTA_FTI              12     13
     D  WVTA_MTI              14     16
     D  WVTA_MUC              17     19
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
N18  D                 DS
N18  D  WVIKT                  1     14S 3
N18  D  WVIKTHEL               1     11S 0
N18  D  WVIKTDEC              12     14S 0
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *________________
      * Arbetsvariablar
      *""""""""""""""""
     C     *LIKE         DEFINE    ZRECNO        WRECNO
     C     *LIKE         DEFINE    *IN03         WIN03
     C     *LIKE         DEFINE    SVIV_SYAV     ZVIV_SYAV
     C     *LIKE         DEFINE    SVIV_SYOP     ZVIV_SYOP
     C     *LIKE         DEFINE    SVIV_SYLI     ZVIV_SYLI
     C     *LIKE         DEFINE    SVIV_VANO     ZVIV_VANO
     C     *LIKE         DEFINE    SVTX03_01     ZVTA_IE
     C     *LIKE         DEFINE    SVIV_STVA     ZVIV_STVA
     C     *LIKE         DEFINE    SVIV_STVA2    ZVIV_STVA2
     C     *LIKE         DEFINE    SVIVA_ABB     WVIVA_ABB
     C     *LIKE         DEFINE    *IN03         WIN03
     C     *LIKE         DEFINE    *IN12         WIN12
     C     *LIKE         DEFINE    SVTX03_01     ZVKD_IE
     C     *LIKE         DEFINE    SVPR_IE       ZVPR_IE
     C     *LIKE         DEFINE    SVTX03_02     ZVKD_TYP
     C     *LIKE         DEFINE    SVTX03_03     ZVKD_KD
     C     *LIKE         DEFINE    SVIV_STVA     XVIV_STVA
     C                   Z-ADD     0             ZCIFTOT          18 4
     C                   Z-ADD     0             ZCIFTOT2         18 4
     C     *LIKE         DEFINE    SVIH_VUFR     ZVIH_VUFR
     C     *LIKE         DEFINE    SVVK_KD       ZVVK_KD
     C     *LIKE         DEFINE    SVVK_DTS      ZVVK_DTS
     C     *LIKE         DEFINE    WVTA_MUC      UVTA_MUC
     C     *LIKE         DEFINE    SVIW_KNSO     UVIW_KNSO
     C     *LIKE         DEFINE    SVIH_BRUT     WVIH_BRUT
     C     *LIKE         DEFINE    SVIH_BRUT     XVIH_BRUT
     C     *LIKE         DEFINE    SVIH_KOTA     WVIH_KOTA
     C     *LIKE         DEFINE    SVIH_KOTA     XVIH_KOTA
N21  C     *LIKE         DEFINE    WVTA_SAT      XVTA_SAT
     C                   Z-ADD     0             WPROT             1 0
     C                   Z-ADD     0             WTN               2 0
     C                   EVAL      ZVTA_IE='I'
     C                   EVAL      ZVPR_IE='I'
      *_________________
      * Input parametere
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    ZVIV_SYAV
     C                   PARM                    ZVIV_SYOP
     C                   PARM                    ZVIV_SYSG
     C                   PARM      *IN03         WIN03
     C                   PARM      *IN12         WIN12
     C                   PARM                    UMODE             1
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYA1         KLIST
     C                   KFLD                    ZVIV_SYAV
     C                   KFLD                    ZVIV_SYOP
     C     KEYA          KLIST
     C                   KFLD                    ZVIV_SYAV
     C                   KFLD                    ZVIV_SYOP
     C                   KFLD                    SVIV_SYLI
     C     SVTX03K       KLIST
     C                   KFLD                    ZVKD_IE
     C                   KFLD                    ZVKD_TYP
     C                   KFLD                    ZVKD_KD
     C     SVTPROKEY     KLIST
     C                   KFLD                    ZVPR_IE
     C                   KFLD                    ZVIV_EUP1
     C     SVTVKKEY      KLIST
     C                   KFLD                    ZVVK_KD
     C                   KFLD                    ZVVK_DTS
     C     SVIWKEY       KLIST
     C                   KFLD                    SVIH_MOKN
     C                   KFLD                    UVIW_KNSO
      *_________________________________
      * Hæmta dagens datum och klockslag
      *"""""""""""""""""""""""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
      *________________________________
      * Modus   D=Fråga, endast visning
      *""""""""""""""""""""""""""""""""
     C                   IF        UMODE='D'
     C                   EVAL      *IN27=*ON
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR

     C     SRB1          TAG
      *________________________
      * Summera varulinjebelopp
      *""""""""""""""""""""""""
     C                   EXSR      SRBS
      *______________
      * Tømme Subfile
      *""""""""""""""
     C                   EVAL      *IN93=*ON
     C                   WRITE     SVI003DB
     C                   MOVEA     '000'         *IN(93)
     C                   Z-ADD     *ZERO         ZRECNO
     C                   Z-ADD     *ZERO         WRECNO
     C                   Z-ADD     *ZERO         ZVIV_SYLI
     C                   Z-ADD     *ZERO         ZVIV_VANO
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     KEYA1         SETLL     SVIV1
     C     KEYA1         READE     SVIV1                                  94

     C     *IN94         DOWEQ     '0'
     C                   ADD       1             ZRECNO
      * Spara undan høgsta linjenr. i filen.
     C     SVIV_SYLI     IFGT      ZVIV_SYLI
     C                   EVAL      ZVIV_SYLI=SVIV_SYLI
     C                   ENDIF
     C                   WRITE     SVI003DA
     C     KEYA1         READE     SVIV1                                  94
     C  N94              ENDDO

     C                   EVAL      WRECNO=ZRECNO
     C                   IF        ZRECNO > 1
     C                   EVAL      ZRECNO=1
     C                   ENDIF
     C                   EVAL      ZVIV_VANO=SVIV_SYLI
      *_______________
      * Behandle bilde
      *"""""""""""""""
     C     SRB3          TAG

     C                   MOVEA     '11'          *IN(91)
     C  N30              EVAL      ZMSGNO='SY00000'
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   WRITE     SVI003DE
     C                   WRITE     SVI003DØ
     C                   WRITE     SVI003DC
     C                   IF        ZRECNO = 0
     C                   EXFMT     SVI003DF
     C                   ELSE
     C                   EXFMT     SVI003DB
     C                   ENDIF

     C     *IN03         IFEQ      '0'
     C     *IN12         ANDEQ     '0'

     C                   MOVEA     '00'          *IN(91)
      *_____________
      * F5=Frisk opp
      *"""""""""""""
     C     *IN05         CABEQ     '1'           SRB1
      *___________
      * F6=Lage ny
      *"""""""""""
     C     *IN06         IFEQ      '1'
     C     *IN27         ANDEQ     *OFF
     C                   EXSR      SRBA
     C     *IN03         CABEQ     '1'           SRB8
     C                   GOTO      SRB3
     C                   ENDIF
      *_______
      * Valg ?
      *"""""""
     C                   IF        ZRECNO > 0
     C                   EVAL      *IN52=*OFF
     C                   EVAL      *IN95=*OFF
     C     *IN52         DOWEQ     '0'

     C                   READC     SVI003DA                               52
     C     *IN52         IFEQ      '0'
N10  C  N27ZOP           CASEQ     'K'           SRBK                           Lægg till
     C  N27ZOP           CASEQ     '2'           SRBB                           Endre
     C  N27ZOP           CASEQ     '4'           SRBD                           Slette
     C     ZOP           CASEQ     '5'           SRBE                           Vise
     C                   ENDCS
     C                   ENDIF
      *
     C  N52              ENDDO
     C                   ENDIF

     C     *IN03         CABEQ     '1'           SRB8
     C     *IN12         CABEQ     '1'           SRB3
     C                   GOTO      SRB1

     C                   ENDIF

      * Kontrollera om det ær differans och be anvændaren vælja.
     C     SRB8          TAG

S23  C*    XVIH_FABL     IFNE      0
     C     *IN27         IFEQ      *OFF
N23  C     XVIH_FABL     COMP      0                                  7171
N23  C     XVIH_BRUT     COMP      0                                  7272
N23  C     XVIH_KOTA     COMP      0                                  7373
N23  C     *IN71         IFEQ      *ON
N23  C     *IN72         OREQ      *ON
N23  C     *IN73         OREQ      *ON
     C                   EVAL      XVIH_DIJN='N'
     C                   EXFMT     SVI003DG
     C     XVIH_DIJN     CABEQ     'J'           SRB9
     C                   GOTO      SRB1
N23  C                   ENDIF
     C                   ENDIF

     C     SRB9          ENDSR
      *////////////////////////////////////////////////////////////
      *  Lage ny                                             SRBA /
      *////////////////////////////////////////////////////////////
     C     SRBA          BEGSR

     C                   CLEAR                   SVI003DD
N06  C                   CLEAR                   SVI003DI
N06  C                   CLEAR                   SVI003DJ
N06  C                   CLEAR                   SVI003DK
N06  C                   CLEAR                   SVI003DL
N06  C                   CLEAR                   SVI003DM
N08  C                   IF        SVIH_EUP1<>'4071'
N06  C                   CLEAR                   SVI003DN
N08  C                   ENDIF
     C                   EVAL      ZVIV_ULKD=SVIH_AVUT
     C                   EVAL      ZVIV_KOTA=XVIH_KOTA
     C                   EVAL      ZVIV_KOSL=SVIV_KOSL
     C                   EVAL      ZVIV_KOS2=SVIV_KOS2
     C                   EVAL      ZVIV_KOS3=SVIV_KOS3
     C                   EVAL      ZVIV_KOS4=SVIV_KOS4
     C                   EVAL      ZVIV_KOS5=SVIV_KOS5
     C                   EVAL      ZVIV_VASL=SVIV_VASL
     C                   EVAL      ZVIV_VAS2=SVIV_VAS2
     C                   EVAL      ZVIV_VAS3=SVIV_VAS3
     C                   EVAL      ZVIV_VAS4=SVIV_VAS4
     C                   EVAL      ZVIV_GODM=SVIV_GODM
     C                   EVAL      ZVIV_GOD2=SVIV_GOD2
     C                   EVAL      ZVIV_GOD3=SVIV_GOD3
     C                   EVAL      ZVIV_GOD4=SVIV_GOD4
     C                   EVAL      ZVIV_GOD5=SVIV_GOD5
     C                   EVAL      ZVIV_BRUT=XVIH_BRUT
     C                   EVAL      ZVIV_EUP1=SVIH_EUP1
     C                   EVAL      ZVIV_EUP2=SVIH_EUP2
     C                   EVAL      ZVIV_FABL=XVIH_FABL
S20  C*                  EVAL      ZVIV_FOKD='300'
N15  C                   EVAL      ZVIV_CALL='00'
     C                   EVAL      ZVIV_BIT1=SVIH_FATY
     C                   EVAL      ZVIV_BII1=SVIH_FATX

     C                   IF        SVIH_EUP1='4200'
S12  C*                  EVAL      ZVIV_SUKO='SE200'
     C                   ENDIF

     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     7             POSNBR

     C     SRBA1         TAG

      *____________
      * Blanke felt
      *""""""""""""
     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     SVI003DØ
     C                   EXFMT     SVI003DD
     C                   EVAL      *IN30 = *OFF
     C                   EVAL      *IN31 = *OFF
     C                   EVAL      *IN32 = *OFF
     C                   EVAL      *IN33 = *OFF
     C                   EVAL      *IN34 = *OFF
     C                   EVAL      *IN35 = *OFF
     C                   EVAL      *IN36 = *OFF
     C                   EVAL      *IN37 = *OFF
     C                   EVAL      *IN38 = *OFF
     C                   EVAL      *IN39 = *OFF
     C                   EVAL      *IN40 = *OFF
     C                   EVAL      *IN41 = *OFF
     C                   EVAL      *IN42 = *OFF
     C                   EVAL      *IN45 = *OFF
     C                   EVAL      *IN46 = *OFF
     C                   EVAL      *IN47 = *OFF
     C     *IN03         IFEQ      '0'
     C     *IN05         ANDEQ     '0'
     C     *IN12         ANDEQ     '0'
      *_______
      * F4=Søk
      *"""""""
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN04         IFEQ      '1'
     C     LINNBR        IFEQ      22
     C     LINNBR        OREQ      23
     C     LINNBR        OREQ      24
     C     LINNBR        OREQ      25
     C                   EXSR      SRC
     C                   GOTO      SRBA1
     C                   ENDIF
     C                   ENDIF
N09   *_____________________________
N09   * F10=Automatisk viktberækning
N09   *"""""""""""""""""""""""""""""
N09  C                   IF        *IN10
N09  C                   EXSR      SRAUTOVK
N09  C                   GOTO      SRBA1
N09  C                   ENDIF
      *_________________________________
      * F11=Kunders varuposter (externt)
      *"""""""""""""""""""""""""""""""""
     C                   IF        *IN11
     C                   EXSR      SRKUNSOK
     C                   GOTO      SRBA1
     C                   ENDIF
      *______________
      * Teste input-1
      *""""""""""""""
     C                   EXSR      SRBTST
     C   30              GOTO      SRBA1
      * Lag linjenummer
     C                   ADD       1             ZVIV_SYLI
     C                   EVAL      ZVIV_VANO=ZVIV_SYLI
     C                   EVAL      SVIV_SYLI=ZVIV_SYLI
      * Mer R31
     C     *IN14         IFEQ      '1'
     C                   EXSR      SRI
     C                   GOTO      SRBA1
     C                   ENDIF
      * Mer Særsk uppl
     C     *IN15         IFEQ      '1'
     C                   EXSR      SRJ
     C                   GOTO      SRBA1
     C                   ENDIF
      * Mer Bil Handl
     C     *IN16         IFEQ      '1'
     C                   EXSR      SRK
     C                   GOTO      SRBA1
     C                   ENDIF
      * Mer Containernummer
     C     *IN17         IFEQ      '1'
     C                   EXSR      SRL
     C                   GOTO      SRBA1
     C                   ENDIF
      * Mer Tidigare Handlingar
     C     *IN18         IFEQ      '1'
     C                   EXSR      SRM
     C                   GOTO      SRBA1
     C                   ENDIF
      * Lageridentitet
     C     *IN19         IFEQ      '1'
     C                   EXSR      SRN
     C                   GOTO      SRBA1
     C                   ENDIF
      * Automatisk avgiftsberækning
     C                   EXSR      SRBAA
      * Manuell avgiftsberækning ?
     C                   IF        ZVIV_FABL > 0
     C                   CALL      'SVI004R'
     C                   PARM                    ZVIV_SYAV
     C                   PARM                    ZVIV_SYOP
     C                   PARM                    ZVIV_SYLI
     C                   PARM                    WPROT
     C                   ENDIF
N19   * Hæmta och skriv Y-koder och tillæggskoder automatiskt
N19  C                   EXSR      SRGETKOD
N22  C                   EXSR      SRGETBIL
      *___________________
      * Adda post til  FIL
      *"""""""""""""""""""
     C                   EVAL      SVIV_SYAV=ZVIV_SYAV
     C                   EVAL      SVIV_SYOP=ZVIV_SYOP
     C                   EVAL      SVIV_SYLI=ZVIV_SYLI
     C                   EVAL      SVIV_KOTA=ZVIV_KOTA
     C                   EVAL      SVIV_KOT2=ZVIV_KOT2
     C                   EVAL      SVIV_KOT3=ZVIV_KOT3
     C                   EVAL      SVIV_KOT4=ZVIV_KOT4
     C                   EVAL      SVIV_KOT5=ZVIV_KOT5
     C                   EVAL      SVIV_KOSL=ZVIV_KOSL
     C                   EVAL      SVIV_KOS2=ZVIV_KOS2
     C                   EVAL      SVIV_KOS3=ZVIV_KOS3
     C                   EVAL      SVIV_KOS4=ZVIV_KOS4
     C                   EVAL      SVIV_KOS5=ZVIV_KOS5
     C                   EVAL      SVIV_VASL=ZVIV_VASL
     C                   EVAL      SVIV_VAS2=ZVIV_VAS2
     C                   EVAL      SVIV_VAS3=ZVIV_VAS3
     C                   EVAL      SVIV_VAS4=ZVIV_VAS4
     C                   EVAL      SVIV_GODM=ZVIV_GODM
     C                   EVAL      SVIV_GOD2=ZVIV_GOD2
     C                   EVAL      SVIV_GOD3=ZVIV_GOD3
     C                   EVAL      SVIV_GOD4=ZVIV_GOD4
     C                   EVAL      SVIV_GOD5=ZVIV_GOD5
     C                   EVAL      SVIV_VANO=ZVIV_VANO
     C                   EVAL      SVIV_VATA=ZVIV_VATA
     C                   EVAL      SVIV_VATI=ZVIV_VATI
     C                   EVAL      SVIV_VAT4=ZVIV_VAT4
     C                   EVAL      SVIV_VAT5=ZVIV_VAT5
     C                   EVAL      SVIV_ULKD=ZVIV_ULKD
     C                   EVAL      SVIV_BRUT=ZVIV_BRUT
     C                   EVAL      SVIV_FOKD=ZVIV_FOKD
     C                   EVAL      SVIV_EUP1=ZVIV_EUP1
     C                   EVAL      SVIV_EUP2=ZVIV_EUP2
     C                   EVAL      SVIV_NETO=ZVIV_NETO
     C                   EVAL      SVIV_KVOT=ZVIV_KVOT
     C                   EVAL      SVIV_ANKV=ZVIV_ANKV
N01  C                   EVAL      SVIV_SUKO=ZVIV_SUKO
     C                   EVAL      SVIV_SUK6=ZVIV_SUK6
     C                   EVAL      SVIV_SUKB=ZVIV_SUKB
     C                   EVAL      SVIV_SUTX=ZVIV_SUTX
     C                   EVAL      SVIV_SUT2=ZVIV_SUT2
     C                   EVAL      SVIV_SUT3=ZVIV_SUT3
     C                   EVAL      SVIV_SUT4=ZVIV_SUT4
     C                   EVAL      SVIV_SUT5=ZVIV_SUT5
     C                   EVAL      SVIV_SUT6=ZVIV_SUT6
     C                   EVAL      SVIV_SUT7=ZVIV_SUT7
     C                   EVAL      SVIV_SUT8=ZVIV_SUT8
     C                   EVAL      SVIV_SUT9=ZVIV_SUT9
     C                   EVAL      SVIV_SUTA=ZVIV_SUTA
     C                   EVAL      SVIV_SUTB=ZVIV_SUTB
     C                   EVAL      SVIV_SUTC=ZVIV_SUTC
     C                   EVAL      SVIV_SUTD=ZVIV_SUTD
     C                   EVAL      SVIV_SUTE=ZVIV_SUTE
     C                   EVAL      SVIV_SUTF=ZVIV_SUTF
     C                   EVAL      SVIV_FABL=ZVIV_FABL
     C                   EVAL      SVIV_STVA=ZVIV_STVA
     C                   EVAL      SVIV_STVA2=ZVIV_STVA2
     C                   EVAL      SVIV_BIT1=ZVIV_BIT1
     C                   EVAL      SVIV_BIT2=ZVIV_BIT2
     C                   EVAL      SVIV_BIT3=ZVIV_BIT3
     C                   EVAL      SVIV_BIT4=ZVIV_BIT4
     C                   EVAL      SVIV_BIT5=ZVIV_BIT5
     C                   EVAL      SVIV_BIT6=ZVIV_BIT6
     C                   EVAL      SVIV_BIT7=ZVIV_BIT7
     C                   EVAL      SVIV_BIT8=ZVIV_BIT8
     C                   EVAL      SVIV_BIT9=ZVIV_BIT9
     C                   EVAL      SVIV_BII1=ZVIV_BII1
     C                   EVAL      SVIV_BII2=ZVIV_BII2
     C                   EVAL      SVIV_BII3=ZVIV_BII3
     C                   EVAL      SVIV_BII4=ZVIV_BII4
     C                   EVAL      SVIV_BII5=ZVIV_BII5
     C                   EVAL      SVIV_BII6=ZVIV_BII6
     C                   EVAL      SVIV_BII7=ZVIV_BII7
     C                   EVAL      SVIV_BII8=ZVIV_BII8
     C                   EVAL      SVIV_BII9=ZVIV_BII9
     C                   EVAL      SVIV_CO01=ZVIV_CO01
     C                   EVAL      SVIV_CO02=ZVIV_CO02
     C                   EVAL      SVIV_CO03=ZVIV_CO03
     C                   EVAL      SVIV_CO04=ZVIV_CO04
     C                   EVAL      SVIV_CO05=ZVIV_CO05
     C                   EVAL      SVIV_CO06=ZVIV_CO06
     C                   EVAL      SVIV_CO07=ZVIV_CO07
     C                   EVAL      SVIV_CO08=ZVIV_CO08
     C                   EVAL      SVIV_CO09=ZVIV_CO09
     C                   EVAL      SVIV_CO10=ZVIV_CO10
     C                   EVAL      SVIV_CO11=ZVIV_CO11
     C                   EVAL      SVIV_CO12=ZVIV_CO12
     C                   EVAL      SVIV_CO13=ZVIV_CO13
     C                   EVAL      SVIV_CO14=ZVIV_CO14
     C                   EVAL      SVIV_CO15=ZVIV_CO15
     C                   EVAL      SVIV_CO16=ZVIV_CO16
     C                   EVAL      SVIV_CO17=ZVIV_CO17
     C                   EVAL      SVIV_CO18=ZVIV_CO18
     C                   EVAL      SVIV_CO19=ZVIV_CO19
     C                   EVAL      SVIV_CO20=ZVIV_CO20
     C                   EVAL      SVIV_TIK1=ZVIV_TIK1
     C                   EVAL      SVIV_TIK2=ZVIV_TIK2
     C                   EVAL      SVIV_TIK3=ZVIV_TIK3
     C                   EVAL      SVIV_TIK4=ZVIV_TIK4
     C                   EVAL      SVIV_TIK5=ZVIV_TIK5
     C                   EVAL      SVIV_TIK6=ZVIV_TIK6
     C                   EVAL      SVIV_TIK7=ZVIV_TIK7
     C                   EVAL      SVIV_TIK8=ZVIV_TIK8
     C                   EVAL      SVIV_TIK9=ZVIV_TIK9
     C                   EVAL      SVIV_TIT1=ZVIV_TIT1
     C                   EVAL      SVIV_TIT2=ZVIV_TIT2
     C                   EVAL      SVIV_TIT3=ZVIV_TIT3
     C                   EVAL      SVIV_TIT4=ZVIV_TIT4
     C                   EVAL      SVIV_TIT5=ZVIV_TIT5
     C                   EVAL      SVIV_TIT6=ZVIV_TIT6
     C                   EVAL      SVIV_TIT7=ZVIV_TIT7
     C                   EVAL      SVIV_TIT8=ZVIV_TIT8
     C                   EVAL      SVIV_TIT9=ZVIV_TIT9
     C                   EVAL      SVIV_TIX1=ZVIV_TIX1
     C                   EVAL      SVIV_TIX2=ZVIV_TIX2
     C                   EVAL      SVIV_TIX3=ZVIV_TIX3
     C                   EVAL      SVIV_TIX4=ZVIV_TIX4
     C                   EVAL      SVIV_TIX5=ZVIV_TIX5
     C                   EVAL      SVIV_TIX6=ZVIV_TIX6
     C                   EVAL      SVIV_TIX7=ZVIV_TIX7
     C                   EVAL      SVIV_TIX8=ZVIV_TIX8
     C                   EVAL      SVIV_TIX9=ZVIV_TIX9
     C                   EVAL      SVIV_LAGI=ZVIV_LAGI
     C                   EVAL      SVIV_LAGT=ZVIV_LAGT
     C                   EVAL      SVIV_LAGL=ZVIV_LAGL
     C                   EVAL      SVIV_CALL=ZVIV_CALL
     C                   WRITE     SVIVR
      *______________________
      * Adda post til  SUBFIL
      *""""""""""""""""""""""
     C                   ADD       1             WRECNO
     C                   EVAL      ZRECNO=WRECNO
     C                   WRITE     SVI003DA

      * Oppdater arbetsvariabler for sum
     C                   ADD       SVIV_FABL     WVIH_FABL
     C                   EVAL      XVIH_FABL=SVIH_FABL - WVIH_FABL
     C                   ADD       SVIV_BRUT     WVIH_BRUT
     C                   EVAL      XVIH_BRUT=SVIH_BRUT - WVIH_BRUT
     C                   ADD       SVIV_KOTA     WVIH_KOTA
     C                   EVAL      XVIH_KOTA=SVIH_KOTA - WVIH_KOTA

     C                   ENDIF

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Endre                                               SRBB /
      *////////////////////////////////////////////////////////////
     C     SRBB          BEGSR
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    SVI003DA
      *____________
      * Flytte felt
      *""""""""""""
     C                   CLEAR                   SVI003DD
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     4             POSNBR
     C     KEYA          CHAIN(N)  SVIV                               53
     C                   EVAL      ZVIV_KOTA=SVIV_KOTA
     C                   EVAL      ZVIV_KOT2=SVIV_KOT2
     C                   EVAL      ZVIV_KOT3=SVIV_KOT3
     C                   EVAL      ZVIV_KOT4=SVIV_KOT4
     C                   EVAL      ZVIV_KOT5=SVIV_KOT5
     C                   EVAL      ZVIV_KOSL=SVIV_KOSL
     C                   EVAL      ZVIV_KOS2=SVIV_KOS2
     C                   EVAL      ZVIV_KOS3=SVIV_KOS3
     C                   EVAL      ZVIV_KOS4=SVIV_KOS4
     C                   EVAL      ZVIV_KOS5=SVIV_KOS5
     C                   EVAL      ZVIV_VASL=SVIV_VASL
     C                   EVAL      ZVIV_VAS2=SVIV_VAS2
     C                   EVAL      ZVIV_VAS3=SVIV_VAS3
     C                   EVAL      ZVIV_VAS4=SVIV_VAS4
     C                   EVAL      ZVIV_GODM=SVIV_GODM
     C                   EVAL      ZVIV_GOD2=SVIV_GOD2
     C                   EVAL      ZVIV_GOD3=SVIV_GOD3
     C                   EVAL      ZVIV_GOD4=SVIV_GOD4
     C                   EVAL      ZVIV_GOD5=SVIV_GOD5
     C                   EVAL      ZVIV_VATA=SVIV_VATA
     C                   EVAL      ZVIV_VATI=SVIV_VATI
     C                   EVAL      ZVIV_VAT4=SVIV_VAT4
     C                   EVAL      ZVIV_VAT5=SVIV_VAT5
     C                   EVAL      ZVIV_ULKD=SVIV_ULKD
     C                   EVAL      ZVIV_BRUT=SVIV_BRUT
     C                   EVAL      ZVIV_FOKD=SVIV_FOKD
     C                   EVAL      ZVIV_EUP1=SVIV_EUP1
     C                   EVAL      ZVIV_EUP2=SVIV_EUP2
     C                   EVAL      ZVIV_NETO=SVIV_NETO
     C                   EVAL      ZVIV_KVOT=SVIV_KVOT
     C                   EVAL      ZVIV_ANKV=SVIV_ANKV
N01  C                   EVAL      ZVIV_SUKO=SVIV_SUKO
     C                   EVAL      ZVIV_SUK6=SVIV_SUK6
     C                   EVAL      ZVIV_SUKB=SVIV_SUKB
     C                   EVAL      ZVIV_SUTX=SVIV_SUTX
     C                   EVAL      ZVIV_SUT2=SVIV_SUT2
     C                   EVAL      ZVIV_SUT3=SVIV_SUT3
     C                   EVAL      ZVIV_SUT4=SVIV_SUT4
     C                   EVAL      ZVIV_SUT5=SVIV_SUT5
     C                   EVAL      ZVIV_SUT6=SVIV_SUT6
     C                   EVAL      ZVIV_SUT7=SVIV_SUT7
     C                   EVAL      ZVIV_SUT8=SVIV_SUT8
     C                   EVAL      ZVIV_SUT9=SVIV_SUT9
     C                   EVAL      ZVIV_SUTA=SVIV_SUTA
     C                   EVAL      ZVIV_SUTB=SVIV_SUTB
     C                   EVAL      ZVIV_SUTC=SVIV_SUTC
     C                   EVAL      ZVIV_SUTD=SVIV_SUTD
     C                   EVAL      ZVIV_SUTE=SVIV_SUTE
     C                   EVAL      ZVIV_SUTF=SVIV_SUTF
     C                   EVAL      ZVIV_FABL=SVIV_FABL
     C                   EVAL      ZVIV_STVA=SVIV_STVA
     C                   EVAL      ZVIV_STVA2=SVIV_STVA2
     C                   EVAL      ZVIV_BIT1=SVIV_BIT1
     C                   EVAL      ZVIV_BIT2=SVIV_BIT2
     C                   EVAL      ZVIV_BIT3=SVIV_BIT3
     C                   EVAL      ZVIV_BIT4=SVIV_BIT4
     C                   EVAL      ZVIV_BIT5=SVIV_BIT5
     C                   EVAL      ZVIV_BIT6=SVIV_BIT6
     C                   EVAL      ZVIV_BIT7=SVIV_BIT7
     C                   EVAL      ZVIV_BIT8=SVIV_BIT8
     C                   EVAL      ZVIV_BIT9=SVIV_BIT9
     C                   EVAL      ZVIV_BII1=SVIV_BII1
     C                   EVAL      ZVIV_BII2=SVIV_BII2
     C                   EVAL      ZVIV_BII3=SVIV_BII3
     C                   EVAL      ZVIV_BII4=SVIV_BII4
     C                   EVAL      ZVIV_BII5=SVIV_BII5
     C                   EVAL      ZVIV_BII6=SVIV_BII6
     C                   EVAL      ZVIV_BII7=SVIV_BII7
     C                   EVAL      ZVIV_BII8=SVIV_BII8
     C                   EVAL      ZVIV_BII9=SVIV_BII9
     C                   EVAL      ZVIV_CO01=SVIV_CO01
     C                   EVAL      ZVIV_CO02=SVIV_CO02
     C                   EVAL      ZVIV_CO03=SVIV_CO03
     C                   EVAL      ZVIV_CO04=SVIV_CO04
     C                   EVAL      ZVIV_CO05=SVIV_CO05
     C                   EVAL      ZVIV_CO06=SVIV_CO06
     C                   EVAL      ZVIV_CO07=SVIV_CO07
     C                   EVAL      ZVIV_CO08=SVIV_CO08
     C                   EVAL      ZVIV_CO09=SVIV_CO09
     C                   EVAL      ZVIV_CO10=SVIV_CO10
     C                   EVAL      ZVIV_CO11=SVIV_CO11
     C                   EVAL      ZVIV_CO12=SVIV_CO12
     C                   EVAL      ZVIV_CO13=SVIV_CO13
     C                   EVAL      ZVIV_CO14=SVIV_CO14
     C                   EVAL      ZVIV_CO15=SVIV_CO15
     C                   EVAL      ZVIV_CO16=SVIV_CO16
     C                   EVAL      ZVIV_CO17=SVIV_CO17
     C                   EVAL      ZVIV_CO18=SVIV_CO18
     C                   EVAL      ZVIV_CO19=SVIV_CO19
     C                   EVAL      ZVIV_CO20=SVIV_CO20
     C                   EVAL      ZVIV_TIK1=SVIV_TIK1
     C                   EVAL      ZVIV_TIK2=SVIV_TIK2
     C                   EVAL      ZVIV_TIK3=SVIV_TIK3
     C                   EVAL      ZVIV_TIK4=SVIV_TIK4
     C                   EVAL      ZVIV_TIK5=SVIV_TIK5
     C                   EVAL      ZVIV_TIK6=SVIV_TIK6
     C                   EVAL      ZVIV_TIK7=SVIV_TIK7
     C                   EVAL      ZVIV_TIK8=SVIV_TIK8
     C                   EVAL      ZVIV_TIK9=SVIV_TIK9
     C                   EVAL      ZVIV_TIT1=SVIV_TIT1
     C                   EVAL      ZVIV_TIT2=SVIV_TIT2
     C                   EVAL      ZVIV_TIT3=SVIV_TIT3
     C                   EVAL      ZVIV_TIT4=SVIV_TIT4
     C                   EVAL      ZVIV_TIT5=SVIV_TIT5
     C                   EVAL      ZVIV_TIT6=SVIV_TIT6
     C                   EVAL      ZVIV_TIT7=SVIV_TIT7
     C                   EVAL      ZVIV_TIT8=SVIV_TIT8
     C                   EVAL      ZVIV_TIT9=SVIV_TIT9
     C                   EVAL      ZVIV_TIX1=SVIV_TIX1
     C                   EVAL      ZVIV_TIX2=SVIV_TIX2
     C                   EVAL      ZVIV_TIX3=SVIV_TIX3
     C                   EVAL      ZVIV_TIX4=SVIV_TIX4
     C                   EVAL      ZVIV_TIX5=SVIV_TIX5
     C                   EVAL      ZVIV_TIX6=SVIV_TIX6
     C                   EVAL      ZVIV_TIX7=SVIV_TIX7
     C                   EVAL      ZVIV_TIX8=SVIV_TIX8
     C                   EVAL      ZVIV_TIX9=SVIV_TIX9
     C                   EVAL      ZVIV_LAGI=SVIV_LAGI
     C                   EVAL      ZVIV_LAGT=SVIV_LAGT
     C                   EVAL      ZVIV_LAGL=SVIV_LAGL
     C                   EVAL      ZVIV_CALL=SVIV_CALL
N25  C                   EVAL      WVIV_SYLI=SVIV_SYLI
N26  C                   IF        SVIV_ERR = 'X'
N26  C                   EVAL      ZVIV_AVGB = 'X'
N26  C                   ENDIF
      * Hent fra heading
     C                   IF        ZVIV_BIT1=*BLANKS
     C                   EVAL      ZVIV_BIT1=SVIH_FATY
     C                   EVAL      ZVIV_BII1=SVIH_FATX
     C                   ENDIF

      * Oppdater arbetsvariabler for fakturasum
     C                   SUB       SVIV_FABL     WVIH_FABL
     C                   EVAL      XVIH_FABL=SVIH_FABL - WVIH_FABL
     C                   SUB       SVIV_BRUT     WVIH_BRUT
     C                   EVAL      XVIH_BRUT=SVIH_BRUT - WVIH_BRUT
     C                   SUB       SVIV_KOTA     WVIH_KOTA
     C                   EVAL      XVIH_KOTA=SVIH_KOTA - WVIH_KOTA

     C     SRBB1         TAG

     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     SVI003DØ
     C                   EXFMT     SVI003DD
     C                   EVAL      *IN30 = *OFF
     C                   EVAL      *IN31 = *OFF
     C                   EVAL      *IN32 = *OFF
     C                   EVAL      *IN33 = *OFF
     C                   EVAL      *IN34 = *OFF
     C                   EVAL      *IN35 = *OFF
     C                   EVAL      *IN36 = *OFF
     C                   EVAL      *IN37 = *OFF
     C                   EVAL      *IN38 = *OFF
     C                   EVAL      *IN39 = *OFF
     C                   EVAL      *IN40 = *OFF
     C                   EVAL      *IN41 = *OFF
     C                   EVAL      *IN42 = *OFF
     C                   EVAL      *IN45 = *OFF
     C                   EVAL      *IN46 = *OFF
     C     *IN12         IFEQ      '0'
      *_______
      * F4=Søk
      *"""""""
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN04         IFEQ      '1'
     C     LINNBR        IFEQ      22
     C     LINNBR        OREQ      23
     C     LINNBR        OREQ      24
     C     LINNBR        OREQ      25
     C                   EXSR      SRC
     C                   GOTO      SRBB1
     C                   ENDIF
     C                   ENDIF
N09   *_____________________________
N09   * F10=Automatisk viktberækning
N09   *"""""""""""""""""""""""""""""
N09  C                   IF        *IN10
N09  C                   EXSR      SRAUTOVK
N09  C                   GOTO      SRBB1
N09  C                   ENDIF
      *_________________________________
      * F11=Kunders varuposter (externt)
      *"""""""""""""""""""""""""""""""""
     C                   IF        *IN11
     C                   EXSR      SRKUNSOK
     C                   GOTO      SRBB1
     C                   ENDIF
      * Mer R31
     C     *IN14         IFEQ      '1'
     C                   EXSR      SRI
     C                   GOTO      SRBB1
     C                   ENDIF
      *_______________
      * Mer Særsk uppl
      *"""""""""""""""
     C     *IN15         IFEQ      '1'
     C                   EXSR      SRJ
     C                   GOTO      SRBB1
     C                   ENDIF
      * Mer Bil Handl
     C     *IN16         IFEQ      '1'
     C                   EXSR      SRK
     C                   GOTO      SRBB1
     C                   ENDIF
      * Mer Containernummer
     C     *IN17         IFEQ      '1'
     C                   EXSR      SRL
     C                   GOTO      SRBB1
     C                   ENDIF
      * Mer Tidigare Handlingar
     C     *IN18         IFEQ      '1'
     C                   EXSR      SRM
     C                   GOTO      SRBB1
     C                   ENDIF
      * Lageridentitet
     C     *IN19         IFEQ      '1'
     C                   EXSR      SRN
     C                   GOTO      SRBB1
     C                   ENDIF
      *____________
      * Teste input
      *""""""""""""
     C                   EXSR      SRBTST
     C   30              GOTO      SRBB1
      * Statistisk verdi
     C                   EXSR      SRCIFDET
      * Avgiftsberækning ?
S03  C*    ZVIV_AVGB     IFNE      *BLANKS
N26  C     ZVIV_AVGB     IFNE      *BLANKS
      * Automatisk avgiftsberækning
     C                   EXSR      SRBAA
     C                   EVAL      ZVIV_AVGB='X'
S03  C*                  ENDIF
N26  C                   ENDIF
N03  C                   IF        ZVIV_FABL > 0
     C                   CALL      'SVI004R'
     C                   PARM                    ZVIV_SYAV
     C                   PARM                    ZVIV_SYOP
     C                   PARM                    SVIV_SYLI
     C                   PARM                    WPROT
N03  C                   ENDIF
N19   *  Hæmta Y-koder och tillæggskoder
N19  C                   EXSR      SRGETKOD
      *______________
      * Oppdatere FIL
      *""""""""""""""
     C     KEYA          CHAIN     SVIV                               53
     C                   EVAL      SVIV_KOTA=ZVIV_KOTA
     C                   EVAL      SVIV_KOT2=ZVIV_KOT2
     C                   EVAL      SVIV_KOT3=ZVIV_KOT3
     C                   EVAL      SVIV_KOT4=ZVIV_KOT4
     C                   EVAL      SVIV_KOT5=ZVIV_KOT5
     C                   EVAL      SVIV_KOSL=ZVIV_KOSL
     C                   EVAL      SVIV_KOS2=ZVIV_KOS2
     C                   EVAL      SVIV_KOS3=ZVIV_KOS3
     C                   EVAL      SVIV_KOS4=ZVIV_KOS4
     C                   EVAL      SVIV_KOS5=ZVIV_KOS5
     C                   EVAL      SVIV_VASL=ZVIV_VASL
     C                   EVAL      SVIV_VAS2=ZVIV_VAS2
     C                   EVAL      SVIV_VAS3=ZVIV_VAS3
     C                   EVAL      SVIV_VAS4=ZVIV_VAS4
     C                   EVAL      SVIV_GODM=ZVIV_GODM
     C                   EVAL      SVIV_GOD2=ZVIV_GOD2
     C                   EVAL      SVIV_GOD3=ZVIV_GOD3
     C                   EVAL      SVIV_GOD4=ZVIV_GOD4
     C                   EVAL      SVIV_GOD5=ZVIV_GOD5
     C                   EVAL      SVIV_VATA=ZVIV_VATA
     C                   EVAL      SVIV_VATI=ZVIV_VATI
     C                   EVAL      SVIV_VAT4=ZVIV_VAT4
     C                   EVAL      SVIV_VAT5=ZVIV_VAT5
     C                   EVAL      SVIV_ULKD=ZVIV_ULKD
     C                   EVAL      SVIV_BRUT=ZVIV_BRUT
     C                   EVAL      SVIV_FOKD=ZVIV_FOKD
     C                   EVAL      SVIV_EUP1=ZVIV_EUP1
     C                   EVAL      SVIV_EUP2=ZVIV_EUP2
     C                   EVAL      SVIV_NETO=ZVIV_NETO
     C                   EVAL      SVIV_KVOT=ZVIV_KVOT
     C                   EVAL      SVIV_ANKV=ZVIV_ANKV
N01  C                   EVAL      SVIV_SUKO=ZVIV_SUKO
     C                   EVAL      SVIV_SUK6=ZVIV_SUK6
     C                   EVAL      SVIV_SUKB=ZVIV_SUKB
     C                   EVAL      SVIV_SUTX=ZVIV_SUTX
     C                   EVAL      SVIV_SUT2=ZVIV_SUT2
     C                   EVAL      SVIV_SUT3=ZVIV_SUT3
     C                   EVAL      SVIV_SUT4=ZVIV_SUT4
     C                   EVAL      SVIV_SUT5=ZVIV_SUT5
     C                   EVAL      SVIV_SUT6=ZVIV_SUT6
     C                   EVAL      SVIV_SUT7=ZVIV_SUT7
     C                   EVAL      SVIV_SUT8=ZVIV_SUT8
     C                   EVAL      SVIV_SUT9=ZVIV_SUT9
     C                   EVAL      SVIV_SUTA=ZVIV_SUTA
     C                   EVAL      SVIV_SUTB=ZVIV_SUTB
     C                   EVAL      SVIV_SUTC=ZVIV_SUTC
     C                   EVAL      SVIV_SUTD=ZVIV_SUTD
     C                   EVAL      SVIV_SUTE=ZVIV_SUTE
     C                   EVAL      SVIV_SUTF=ZVIV_SUTF
     C                   EVAL      SVIV_FABL=ZVIV_FABL
     C                   EVAL      SVIV_STVA=ZVIV_STVA
     C                   EVAL      SVIV_STVA2=ZVIV_STVA2
     C                   EVAL      SVIV_BIT1=ZVIV_BIT1
     C                   EVAL      SVIV_BIT2=ZVIV_BIT2
     C                   EVAL      SVIV_BIT3=ZVIV_BIT3
     C                   EVAL      SVIV_BIT4=ZVIV_BIT4
     C                   EVAL      SVIV_BIT5=ZVIV_BIT5
     C                   EVAL      SVIV_BIT6=ZVIV_BIT6
     C                   EVAL      SVIV_BIT7=ZVIV_BIT7
     C                   EVAL      SVIV_BIT8=ZVIV_BIT8
     C                   EVAL      SVIV_BIT9=ZVIV_BIT9
     C                   EVAL      SVIV_BII1=ZVIV_BII1
     C                   EVAL      SVIV_BII2=ZVIV_BII2
     C                   EVAL      SVIV_BII3=ZVIV_BII3
     C                   EVAL      SVIV_BII4=ZVIV_BII4
     C                   EVAL      SVIV_BII5=ZVIV_BII5
     C                   EVAL      SVIV_BII6=ZVIV_BII6
     C                   EVAL      SVIV_BII7=ZVIV_BII7
     C                   EVAL      SVIV_BII8=ZVIV_BII8
     C                   EVAL      SVIV_BII9=ZVIV_BII9
     C                   EVAL      SVIV_CO01=ZVIV_CO01
     C                   EVAL      SVIV_CO02=ZVIV_CO02
     C                   EVAL      SVIV_CO03=ZVIV_CO03
     C                   EVAL      SVIV_CO04=ZVIV_CO04
     C                   EVAL      SVIV_CO05=ZVIV_CO05
     C                   EVAL      SVIV_CO06=ZVIV_CO06
     C                   EVAL      SVIV_CO07=ZVIV_CO07
     C                   EVAL      SVIV_CO08=ZVIV_CO08
     C                   EVAL      SVIV_CO09=ZVIV_CO09
     C                   EVAL      SVIV_CO10=ZVIV_CO10
     C                   EVAL      SVIV_CO11=ZVIV_CO11
     C                   EVAL      SVIV_CO12=ZVIV_CO12
     C                   EVAL      SVIV_CO13=ZVIV_CO13
     C                   EVAL      SVIV_CO14=ZVIV_CO14
     C                   EVAL      SVIV_CO15=ZVIV_CO15
     C                   EVAL      SVIV_CO16=ZVIV_CO16
     C                   EVAL      SVIV_CO17=ZVIV_CO17
     C                   EVAL      SVIV_CO18=ZVIV_CO18
     C                   EVAL      SVIV_CO19=ZVIV_CO19
     C                   EVAL      SVIV_CO20=ZVIV_CO20
     C                   EVAL      SVIV_TIK1=ZVIV_TIK1
     C                   EVAL      SVIV_TIK2=ZVIV_TIK2
     C                   EVAL      SVIV_TIK3=ZVIV_TIK3
     C                   EVAL      SVIV_TIK4=ZVIV_TIK4
     C                   EVAL      SVIV_TIK5=ZVIV_TIK5
     C                   EVAL      SVIV_TIK6=ZVIV_TIK6
     C                   EVAL      SVIV_TIK7=ZVIV_TIK7
     C                   EVAL      SVIV_TIK8=ZVIV_TIK8
     C                   EVAL      SVIV_TIK9=ZVIV_TIK9
     C                   EVAL      SVIV_TIT1=ZVIV_TIT1
     C                   EVAL      SVIV_TIT2=ZVIV_TIT2
     C                   EVAL      SVIV_TIT3=ZVIV_TIT3
     C                   EVAL      SVIV_TIT4=ZVIV_TIT4
     C                   EVAL      SVIV_TIT5=ZVIV_TIT5
     C                   EVAL      SVIV_TIT6=ZVIV_TIT6
     C                   EVAL      SVIV_TIT7=ZVIV_TIT7
     C                   EVAL      SVIV_TIT8=ZVIV_TIT8
     C                   EVAL      SVIV_TIT9=ZVIV_TIT9
     C                   EVAL      SVIV_TIX1=ZVIV_TIX1
     C                   EVAL      SVIV_TIX2=ZVIV_TIX2
     C                   EVAL      SVIV_TIX3=ZVIV_TIX3
     C                   EVAL      SVIV_TIX4=ZVIV_TIX4
     C                   EVAL      SVIV_TIX5=ZVIV_TIX5
     C                   EVAL      SVIV_TIX6=ZVIV_TIX6
     C                   EVAL      SVIV_TIX7=ZVIV_TIX7
     C                   EVAL      SVIV_TIX8=ZVIV_TIX8
     C                   EVAL      SVIV_TIX9=ZVIV_TIX9
     C                   EVAL      SVIV_LAGI=ZVIV_LAGI
     C                   EVAL      SVIV_LAGT=ZVIV_LAGT
     C                   EVAL      SVIV_LAGL=ZVIV_LAGL
     C                   EVAL      SVIV_CALL=ZVIV_CALL
N24  C                   EVAL      SVIV_ERR=*BLANKS
     C                   UPDATE    SVIVR

      * Oppdater arbetsvariabler for fakturasum
     C                   ADD       SVIV_FABL     WVIH_FABL
     C                   EVAL      XVIH_FABL=SVIH_FABL - WVIH_FABL
     C                   ADD       SVIV_BRUT     WVIH_BRUT
     C                   EVAL      XVIH_BRUT=SVIH_BRUT - WVIH_BRUT
     C                   ADD       SVIV_KOTA     WVIH_KOTA
     C                   EVAL      XVIH_KOTA=SVIH_KOTA - WVIH_KOTA

     C                   ENDIF

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Slette                                              SRBD /
      *////////////////////////////////////////////////////////////
     C     SRBD          BEGSR
      *______________
      * Oppdatere FIL
      *""""""""""""""
     C     KEYA          CHAIN     SVIV                               53
     C                   DELETE    SVIVR
      *_______________
      * Slett avgifter
      *"""""""""""""""
     C                   EVAL      *IN53=*OFF
     C     KEYA          SETLL     SVIVA
     C     KEYA          READE     SVIVA                                  53
     C     *IN53         DOWEQ     *OFF
     C                   DELETE    SVIVAR
     C     KEYA          READE     SVIVA                                  53
     C                   ENDDO
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   CLEAR                   SVI003DA
     C                   UPDATE    SVI003DA
     C                   EVAL      *IN95=*ON

      * Oppdater arbetsvariabler for fakturasum
     C                   SUB       SVIV_FABL     WVIH_FABL
     C                   EVAL      XVIH_FABL=SVIH_FABL - WVIH_FABL
     C                   SUB       SVIV_BRUT     WVIH_BRUT
     C                   EVAL      XVIH_BRUT=SVIH_BRUT - WVIH_BRUT
     C                   SUB       SVIV_KOTA     WVIH_KOTA
     C                   EVAL      XVIH_KOTA=SVIH_KOTA - WVIH_KOTA

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Vise                                                SRBE /
      *////////////////////////////////////////////////////////////
     C     SRBE          BEGSR
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    SVI003DA
      *____________
      * Flytte felt
      *""""""""""""
     C                   CLEAR                   SVI003DD
     C                   IF        UMODE='D'
     C                   EVAL      *IN27=*ON
     C                   ENDIF
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     4             POSNBR
     C     KEYA          CHAIN(N)  SVIV                               53
     C                   EVAL      ZVIV_KOTA=SVIV_KOTA
     C                   EVAL      ZVIV_KOT2=SVIV_KOT2
     C                   EVAL      ZVIV_KOT3=SVIV_KOT3
     C                   EVAL      ZVIV_KOT4=SVIV_KOT4
     C                   EVAL      ZVIV_KOT5=SVIV_KOT5
     C                   EVAL      ZVIV_KOSL=SVIV_KOSL
     C                   EVAL      ZVIV_KOS2=SVIV_KOS2
     C                   EVAL      ZVIV_KOS3=SVIV_KOS3
     C                   EVAL      ZVIV_KOS4=SVIV_KOS4
     C                   EVAL      ZVIV_KOS5=SVIV_KOS5
     C                   EVAL      ZVIV_VASL=SVIV_VASL
     C                   EVAL      ZVIV_VAS2=SVIV_VAS2
     C                   EVAL      ZVIV_VAS3=SVIV_VAS3
     C                   EVAL      ZVIV_VAS4=SVIV_VAS4
     C                   EVAL      ZVIV_GODM=SVIV_GODM
     C                   EVAL      ZVIV_GOD2=SVIV_GOD2
     C                   EVAL      ZVIV_GOD3=SVIV_GOD3
     C                   EVAL      ZVIV_GOD4=SVIV_GOD4
     C                   EVAL      ZVIV_GOD5=SVIV_GOD5
     C                   EVAL      ZVIV_VATA=SVIV_VATA
     C                   EVAL      ZVIV_VATI=SVIV_VATI
     C                   EVAL      ZVIV_VAT4=SVIV_VAT4
     C                   EVAL      ZVIV_VAT5=SVIV_VAT5
     C                   EVAL      ZVIV_ULKD=SVIV_ULKD
     C                   EVAL      ZVIV_BRUT=SVIV_BRUT
     C                   EVAL      ZVIV_FOKD=SVIV_FOKD
     C                   EVAL      ZVIV_EUP1=SVIV_EUP1
     C                   EVAL      ZVIV_EUP2=SVIV_EUP2
     C                   EVAL      ZVIV_NETO=SVIV_NETO
     C                   EVAL      ZVIV_KVOT=SVIV_KVOT
     C                   EVAL      ZVIV_ANKV=SVIV_ANKV
N01  C                   EVAL      ZVIV_SUKO=SVIV_SUKO
     C                   EVAL      ZVIV_SUK6=SVIV_SUK6
     C                   EVAL      ZVIV_SUKB=SVIV_SUKB
     C                   EVAL      ZVIV_SUTX=SVIV_SUTX
     C                   EVAL      ZVIV_SUT2=SVIV_SUT2
     C                   EVAL      ZVIV_SUT3=SVIV_SUT3
     C                   EVAL      ZVIV_SUT4=SVIV_SUT4
     C                   EVAL      ZVIV_SUT5=SVIV_SUT5
     C                   EVAL      ZVIV_SUT6=SVIV_SUT6
     C                   EVAL      ZVIV_SUT7=SVIV_SUT7
     C                   EVAL      ZVIV_SUT8=SVIV_SUT8
     C                   EVAL      ZVIV_SUT9=SVIV_SUT9
     C                   EVAL      ZVIV_SUTA=SVIV_SUTA
     C                   EVAL      ZVIV_SUTB=SVIV_SUTB
     C                   EVAL      ZVIV_SUTC=SVIV_SUTC
     C                   EVAL      ZVIV_SUTD=SVIV_SUTD
     C                   EVAL      ZVIV_SUTE=SVIV_SUTE
     C                   EVAL      ZVIV_SUTF=SVIV_SUTF
     C                   EVAL      ZVIV_FABL=SVIV_FABL
     C                   EVAL      ZVIV_STVA=SVIV_STVA
     C                   EVAL      ZVIV_STVA2=SVIV_STVA2
     C                   EVAL      ZVIV_BIT1=SVIV_BIT1
     C                   EVAL      ZVIV_BIT2=SVIV_BIT2
     C                   EVAL      ZVIV_BIT3=SVIV_BIT3
     C                   EVAL      ZVIV_BIT4=SVIV_BIT4
     C                   EVAL      ZVIV_BIT5=SVIV_BIT5
     C                   EVAL      ZVIV_BIT6=SVIV_BIT6
     C                   EVAL      ZVIV_BIT7=SVIV_BIT7
     C                   EVAL      ZVIV_BIT8=SVIV_BIT8
     C                   EVAL      ZVIV_BIT9=SVIV_BIT9
     C                   EVAL      ZVIV_BII1=SVIV_BII1
     C                   EVAL      ZVIV_BII2=SVIV_BII2
     C                   EVAL      ZVIV_BII3=SVIV_BII3
     C                   EVAL      ZVIV_BII4=SVIV_BII4
     C                   EVAL      ZVIV_BII5=SVIV_BII5
     C                   EVAL      ZVIV_BII6=SVIV_BII6
     C                   EVAL      ZVIV_BII7=SVIV_BII7
     C                   EVAL      ZVIV_BII8=SVIV_BII8
     C                   EVAL      ZVIV_BII9=SVIV_BII9
     C                   EVAL      ZVIV_CO01=SVIV_CO01
     C                   EVAL      ZVIV_CO02=SVIV_CO02
     C                   EVAL      ZVIV_CO03=SVIV_CO03
     C                   EVAL      ZVIV_CO04=SVIV_CO04
     C                   EVAL      ZVIV_CO05=SVIV_CO05
     C                   EVAL      ZVIV_CO06=SVIV_CO06
     C                   EVAL      ZVIV_CO07=SVIV_CO07
     C                   EVAL      ZVIV_CO08=SVIV_CO08
     C                   EVAL      ZVIV_CO09=SVIV_CO09
     C                   EVAL      ZVIV_CO10=SVIV_CO10
     C                   EVAL      ZVIV_CO11=SVIV_CO11
     C                   EVAL      ZVIV_CO12=SVIV_CO12
     C                   EVAL      ZVIV_CO13=SVIV_CO13
     C                   EVAL      ZVIV_CO14=SVIV_CO14
     C                   EVAL      ZVIV_CO15=SVIV_CO15
     C                   EVAL      ZVIV_CO16=SVIV_CO16
     C                   EVAL      ZVIV_CO17=SVIV_CO17
     C                   EVAL      ZVIV_CO18=SVIV_CO18
     C                   EVAL      ZVIV_CO19=SVIV_CO19
     C                   EVAL      ZVIV_CO20=SVIV_CO20
     C                   EVAL      ZVIV_TIK1=SVIV_TIK1
     C                   EVAL      ZVIV_TIK2=SVIV_TIK2
     C                   EVAL      ZVIV_TIK3=SVIV_TIK3
     C                   EVAL      ZVIV_TIK4=SVIV_TIK4
     C                   EVAL      ZVIV_TIK5=SVIV_TIK5
     C                   EVAL      ZVIV_TIK6=SVIV_TIK6
     C                   EVAL      ZVIV_TIK7=SVIV_TIK7
     C                   EVAL      ZVIV_TIK8=SVIV_TIK8
     C                   EVAL      ZVIV_TIK9=SVIV_TIK9
     C                   EVAL      ZVIV_TIT1=SVIV_TIT1
     C                   EVAL      ZVIV_TIT2=SVIV_TIT2
     C                   EVAL      ZVIV_TIT3=SVIV_TIT3
     C                   EVAL      ZVIV_TIT4=SVIV_TIT4
     C                   EVAL      ZVIV_TIT5=SVIV_TIT5
     C                   EVAL      ZVIV_TIT6=SVIV_TIT6
     C                   EVAL      ZVIV_TIT7=SVIV_TIT7
     C                   EVAL      ZVIV_TIT8=SVIV_TIT8
     C                   EVAL      ZVIV_TIT9=SVIV_TIT9
     C                   EVAL      ZVIV_TIX1=SVIV_TIX1
     C                   EVAL      ZVIV_TIX2=SVIV_TIX2
     C                   EVAL      ZVIV_TIX3=SVIV_TIX3
     C                   EVAL      ZVIV_TIX4=SVIV_TIX4
     C                   EVAL      ZVIV_TIX5=SVIV_TIX5
     C                   EVAL      ZVIV_TIX6=SVIV_TIX6
     C                   EVAL      ZVIV_TIX7=SVIV_TIX7
     C                   EVAL      ZVIV_TIX8=SVIV_TIX8
     C                   EVAL      ZVIV_TIX9=SVIV_TIX9
     C                   EVAL      ZVIV_LAGI=SVIV_LAGI
     C                   EVAL      ZVIV_LAGT=SVIV_LAGT
     C                   EVAL      ZVIV_LAGL=SVIV_LAGL
     C                   EVAL      ZVIV_CALL=SVIV_CALL
N25  C                   EVAL      WVIV_SYLI=SVIV_SYLI

     C     SRBE1         TAG

     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     SVI003DØ
     C                   EXFMT     SVI003DD
     C                   EVAL      *IN30 = *OFF
     C                   EVAL      *IN31 = *OFF
     C                   EVAL      *IN32 = *OFF
     C                   EVAL      *IN33 = *OFF
     C                   EVAL      *IN34 = *OFF
     C                   EVAL      *IN35 = *OFF
     C                   EVAL      *IN36 = *OFF
     C                   EVAL      *IN37 = *OFF
     C                   EVAL      *IN38 = *OFF
     C                   EVAL      *IN39 = *OFF
     C                   EVAL      *IN40 = *OFF
     C                   EVAL      *IN41 = *OFF
     C                   EVAL      *IN42 = *OFF
     C                   EVAL      *IN45 = *OFF
     C                   EVAL      *IN46 = *OFF
     C                   EVAL      *IN47 = *OFF
     C     *IN12         IFEQ      '0'
      * Mer R31
     C     *IN14         IFEQ      '1'
     C                   EXSR      SRI
     C                   GOTO      SRBE1
     C                   ENDIF
      * Mer Særsk uppl
     C     *IN15         IFEQ      '1'
     C                   EXSR      SRJ
     C                   GOTO      SRBE1
     C                   ENDIF
      * Mer Bil Handl
     C     *IN16         IFEQ      '1'
     C                   EXSR      SRK
     C                   GOTO      SRBE1
     C                   ENDIF
      * Mer Containernummer
     C     *IN17         IFEQ      '1'
     C                   EXSR      SRL
     C                   GOTO      SRBE1
     C                   ENDIF
      * Mer Tidigare Handlingar
     C     *IN18         IFEQ      '1'
     C                   EXSR      SRM
     C                   GOTO      SRBE1
     C                   ENDIF
      * Lageridentitet
     C     *IN19         IFEQ      '1'
     C                   EXSR      SRN
     C                   GOTO      SRBE1
     C                   ENDIF
      * Visa avgifter
     C                   IF        ZVIV_FABL > 0
     C                   CALL      'SVI004R'
     C                   PARM                    ZVIV_SYAV
     C                   PARM                    ZVIV_SYOP
     C                   PARM                    SVIV_SYLI
     C                   PARM      1             WPROT
     C                   ENDIF

     C                   ENDIF

     C                   ENDSR
N10   *////////////////////////////////////////////////////////////
N10   *  Lægg till i kunders varuregister                    SRBK /
N10   *////////////////////////////////////////////////////////////
N10  C     SRBK          BEGSR
N10  C                   CALL      'SVI037R'
N10  C                   PARM                    ZVIV_SYAV
N10  C                   PARM                    ZVIV_SYOP
N10  C                   PARM                    SVIV_SYLI
N10   *_________________
N10   * Oppdatere SUBFIL
N10   *"""""""""""""""""
N10  C                   CLEAR                   SVI003DA
N10  C                   UPDATE    SVI003DA
N10  C                   EVAL      *IN95=*ON
N10  C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Søk                                                  SRC /
      *////////////////////////////////////////////////////////////
     C     SRC           BEGSR
      * Ursprungsland
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDEQ     4
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'A'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   MOVEL     UKD           ZVIV_ULKD
     C                   ENDIF
     C                   Z-ADD     7             POSNBR
     C                   GOTO      SRC1
     C                   ENDIF
      * Varukod
     C     LINNBR        IFEQ      22
     C     POSNBR        IFGE      7
     C     POSNBR        ANDLE     16
     C                   EVAL      UKD=ZVIV_VATA
     C     UKD           IFEQ      *BLANKS
     C                   EVAL      UKD='0000000000'
     C                   ENDIF
     C                   CALL      'SVT004R'
     C                   PARM                    UKD              10
     C                   PARM      WDT           UDATO             8
     C                   PARM      'I'           UIE               1
     C     UKD           IFNE      *BLANKS
     C                   MOVEL     UKD           ZVIV_VATA
     C                   ENDIF
     C                   Z-ADD     18            POSNBR
     C                   GOTO      SRC1
     C                   ENDIF
     C                   ENDIF
      * Tillæggskod 33:3
     C     LINNBR        IFEQ      25
     C     POSNBR        ANDEQ     88
     C                   CALL      'SVT003R'
     C                   PARM      'ADD'         UTYP              3
     C                   PARM      'A'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   MOVEL     UKD           ZVIV_VATI
     C                   ENDIF
     C                   Z-ADD     23            POSNBR
     C                   GOTO      SRC1
     C                   ENDIF
      * Førmånskod
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDEQ     18
     C                   CALL      'SVT003R'
     C                   PARM      'FOR'         UTYP              3
     C                   PARM      'I'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   MOVEL     UKD           ZVIV_FOKD
     C                   ENDIF
     C                   Z-ADD     22            POSNBR
     C                   GOTO      SRC1
     C                   ENDIF
      * Førfarande 37:1
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDEQ     22
     C                   CALL      'SVT006R'
     C                   PARM      'I'           UIE               1
     C                   PARM                    UKD2              4
     C     UKD2          IFNE      *BLANKS
     C                   MOVEL     UKD2          ZVIV_EUP1
     C                   ENDIF
     C                   Z-ADD     32            POSNBR
     C                   GOTO      SRC1
     C                   ENDIF
      * Førfarande 37:2
     C     LINNBR        IFEQ      25
     C     POSNBR        ANDEQ     106
     C                   CALL      'SVT003R'
     C                   PARM      'FFK'         UTYP              3
     C                   PARM      'A'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   MOVEL     UKD           ZVIV_EUP2
     C                   ENDIF
     C                   Z-ADD     43            POSNBR
     C                   GOTO      SRC1
     C                   ENDIF
      * R.31 Kollislag
     C     LINNBR        IFEQ      23
     C     POSNBR        ANDEQ     15
     C                   CALL      'SVT003R'
     C                   PARM      'KLI'         UTYP              3
     C                   PARM      'A'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   MOVEL     UKD           ZVIV_KOSL
     C                   ENDIF
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SRC1
     C                   ENDIF
      * Særskilda upplysningar, kod
     C     LINNBR        IFEQ      24
     C     POSNBR        ANDEQ     9
     C                   CALL      'SVT003R'
     C                   PARM      'SAL'         UTYP              3
     C                   PARM      'I'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   MOVEL     UKD           ZVIV_SUKO
     C                   ENDIF
     C                   Z-ADD     24            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SRC1
     C                   ENDIF
      * Bilagda handlingar
     C     LINNBR        IFEQ      25
     C     POSNBR        ANDEQ     40
     C                   CALL      'SVT003R'
     C                   PARM      'MCF'         UTYP              3
     C                   PARM      'A'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   MOVEL     UKD           ZVIV_BIT1
     C                   ENDIF
     C                   Z-ADD     25            LINNBR
     C                   Z-ADD     45            POSNBR
     C                   GOTO      SRC1
     C                   ENDIF
      * Call me
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDEQ     95
     C                   CALL      'SVT011R'
     C                   PARM      'I'           UIE
     C                   PARM                    XVIV_CALL         2
     C     XVIV_CALL     IFNE      *BLANKS
     C                   EVAL      ZVIV_CALL = XVIV_CALL
     C                   ENDIF
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     7             POSNBR
     C                   GOTO      SRC1
     C                   ENDIF

     C     SRC1          ENDSR
      *////////////////////////////////////////////////////////////
      *  Summera varulinjebelopp                             SRBS /
      *////////////////////////////////////////////////////////////
     C     SRBS          BEGSR
      *______________
      * Hæmta ærendet
      *""""""""""""""
     C     KEYA1         CHAIN     SVIH                               51
      * Rækna ut totalt CIF værde
     C                   EXSR      SRCIFTOT
      *___________________
      * Summera varulinjer
      *"""""""""""""""""""
     C                   EVAL      WVIH_FABL=0
     C                   EVAL      XVIH_FABL=0
     C                   EVAL      WVIH_BRUT=0
     C                   EVAL      XVIH_BRUT=0
     C                   EVAL      WVIH_KOTA=0
     C                   EVAL      XVIH_KOTA=0
     C                   EVAL      *IN94=*OFF

     C     KEYA1         SETLL     SVIV1
     C     KEYA1         READE     SVIV1                                  94
     C     *IN94         DOWEQ     '0'
     C                   ADD       SVIV_FABL     WVIH_FABL
     C                   ADD       SVIV_BRUT     WVIH_BRUT
     C                   ADD       SVIV_KOTA     WVIH_KOTA
     C     KEYA1         READE     SVIV1                                  94
     C  N94              ENDDO

     C                   EVAL      *IN94=*OFF
      *___________________________________________________
      * Differans mellan fakturabelopp och varulinjebelopp
      *"""""""""""""""""""""""""""""""""""""""""""""""""""
     C                   EVAL      XVIH_FABL=SVIH_FABL - WVIH_FABL
     C                   EVAL      XVIH_BRUT=SVIH_BRUT - WVIH_BRUT
     C                   EVAL      XVIH_KOTA=SVIH_KOTA - WVIH_KOTA
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Automatisk avgiftsberækning                        SRBAA /
      *////////////////////////////////////////////////////////////
     C     SRBAA         BEGSR
N03   * Slett alle tidligere avgifter
N03  C                   EVAL      *IN53=*OFF
N03  C     KEYA          SETLL     SVIVA
N03  C     KEYA          READE     SVIVA                                  53
N03  C     *IN53         DOWEQ     *OFF
N03  C                   DELETE    SVIVAR
N03  C     KEYA          READE     SVIVA                                  53
N03  C                   ENDDO
      * Starta med Statistiskt værde
     C                   EXSR      SRCIFDET
      * Tull
     C                   EXSR      SRBAAA
      * Andra tullar, skatter och avgifter
     C                   EXSR      SRBAAB
      * Merværdesskatt
     C                   EXSR      SRBAAC
      * Marker avgifter
     C                   EVAL      ZVIV_AVGB='X'
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Automatisk avgiftsberækning, Tull                 SRBAAA /
      *////////////////////////////////////////////////////////////
     C     SRBAAA        BEGSR
      * Hæmta tullavgift
     C                   CALL      'SVI303R'
     C                   PARM                    ZVIV_VATA
S28  C*                  PARM                    SVIH_AVUT
N28  C                   PARM                    ZVIV_ULKD
     C                   PARM                    ZVIV_FOKD
     C                   PARM      *ZEROS        WVTA_SAT
     C                   PARM      *BLANKS       WVTA_FTI
     C                   PARM      *BLANKS       WVTA_MTI
     C                   PARM      *BLANKS       WVTA_MUC
      * Skriv till avgiftsfil
     C                   IF        WVTA_SAT > 0

     C                   CLEAR                   SVIVAR
     C                   EVAL      SVIVA_SAV=ZVIV_SYAV
     C                   EVAL      SVIVA_SOP=ZVIV_SYOP
     C                   EVAL      SVIVA_SLI=SVIV_SYLI
     C                   EVAL      SVIVA_ABK='A00'
     C                   EVAL      SVIVA_ABS=WVTA_SAT
     C                   EVAL      SVIVA_ABX=WVTA_MUC
     C                   SELECT
     C     WVTA_MUC      WHENEQ    '   '
     C                   EVAL      SVIVA_ABG=ZVIV_STVA2
     C                   EVAL      SVIVA_ABB=(ZVIV_STVA2 * WVTA_SAT) / 100
     C                   OTHER
     C                   EVAL      SVIVA_ABG=ZVIV_ANKV
     C                   EVAL      SVIVA_ABB=ZVIV_ANKV * WVTA_SAT
     C                   ENDSL
     C                   IF        SVIVA_ABB = *ZEROS
     C                   IF        WVTA_SAT > *ZEROS
     C                   EVAL      SVIVA_ABB=1
     C                   ENDIF
     C                   ENDIF
N02  C     WDT           IFGE      '20160201'
N02  C                   EVAL      SVIVA_ABX=WVTA_MUC
N02  C                   ELSE
     C                   SELECT
     C     WVTA_MUC      WHENEQ    'DTN'
     C                   EVAL      SVIVA_ABX='DG  '
     C     WVTA_MUC      WHENEQ    'HMT'
     C                   EVAL      SVIVA_ABX='HM  '
     C     WVTA_MUC      WHENEQ    'KGM'
     C                   EVAL      SVIVA_ABX='KG  '
     C     WVTA_MUC      WHENEQ    'MTQ'
     C                   EVAL      SVIVA_ABX='KU  '
     C     WVTA_MUC      WHENEQ    'MTK'
     C                   EVAL      SVIVA_ABX='KV  '
     C     WVTA_MUC      WHENEQ    'LTR'
     C                   EVAL      SVIVA_ABX='L   '
     C     WVTA_MUC      WHENEQ    'MTR'
     C                   EVAL      SVIVA_ABX='ME  '
     C     WVTA_MUC      WHENEQ    'NPR'
     C                   EVAL      SVIVA_ABX='P   '
     C     WVTA_MUC      WHENEQ    'PAR'
     C                   EVAL      SVIVA_ABX='ST  '
     C     WVTA_MUC      WHENEQ    'TNE'
     C                   EVAL      SVIVA_ABX='TE  '
     C                   OTHER
N02  C                   EVAL      SVIVA_ABX=WVTA_MUC
     C                   ENDSL
     C                   ENDIF
     C*                  IF        SVIVA_ABB > 0
     C                   WRITE     SVIVAR
     C*                  ENDIF
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Andra tullar, skatter och avgifter                 SRBAAB /
      *////////////////////////////////////////////////////////////
     C     SRBAAB        BEGSR
      * Hæmta andra tullar/Avgifter
     C                   CALL      'SVI304R'
     C                   PARM                    ZVIV_VATA
S28  C*                  PARM                    SVIH_AVUT
N28  C                   PARM                    ZVIV_ULKD
     C                   PARM                    ZVIV_FOKD
     C                   PARM      *ZEROS        WVTA_SAT
     C                   PARM      *BLANKS       WVTA_FTI
     C                   PARM      *BLANKS       WVTA_MTI
     C                   PARM      *BLANKS       WVTA_MUC
      * Skriv till avgiftsfil
     C                   IF        WVTA_SAT > 0
     C     WVTA_MTI      IFNE      *BLANKS

     C                   CLEAR                   SVIVAR
     C                   EVAL      SVIVA_SAV=ZVIV_SYAV
     C                   EVAL      SVIVA_SOP=ZVIV_SYOP
     C                   EVAL      SVIVA_SLI=SVIV_SYLI
     C                   EVAL      SVIVA_ABK=WVTA_MTI
     C                   EVAL      SVIVA_ABS=WVTA_SAT
     C                   EVAL      SVIVA_ABX=WVTA_MUC
     C                   SELECT
     C     WVTA_MUC      WHENEQ    '   '
     C                   EVAL      SVIVA_ABG=ZVIV_STVA2
     C                   EVAL      SVIVA_ABB=(ZVIV_STVA2 * WVTA_SAT) / 100
     C                   OTHER
     C                   EVAL      SVIVA_ABG=ZVIV_ANKV
     C                   EVAL      SVIVA_ABB=ZVIV_ANKV * WVTA_SAT
     C                   ENDSL
N02  C     WDT           IFGE      '20160201'
N02  C                   EVAL      SVIVA_ABX=WVTA_MUC
N02  C                   ELSE
     C                   SELECT
     C     WVTA_MUC      WHENEQ    'DTN'
     C                   EVAL      SVIVA_ABX='DG  '
     C     WVTA_MUC      WHENEQ    'HMT'
     C                   EVAL      SVIVA_ABX='HM  '
     C     WVTA_MUC      WHENEQ    'KGM'
     C                   EVAL      SVIVA_ABX='KG  '
     C     WVTA_MUC      WHENEQ    'MTQ'
     C                   EVAL      SVIVA_ABX='KU  '
     C     WVTA_MUC      WHENEQ    'MTK'
     C                   EVAL      SVIVA_ABX='KV  '
     C     WVTA_MUC      WHENEQ    'LTR'
     C                   EVAL      SVIVA_ABX='L   '
     C     WVTA_MUC      WHENEQ    'MTR'
     C                   EVAL      SVIVA_ABX='ME  '
     C     WVTA_MUC      WHENEQ    'NPR'
     C                   EVAL      SVIVA_ABX='P   '
     C     WVTA_MUC      WHENEQ    'PAR'
     C                   EVAL      SVIVA_ABX='ST  '
     C     WVTA_MUC      WHENEQ    'TNE'
     C                   EVAL      SVIVA_ABX='TE  '
     C                   OTHER
N02  C                   EVAL      SVIVA_ABX=WVTA_MUC
     C                   ENDSL
     C                   ENDIF
     C*                  IF        SVIVA_ABB > 0
     C                   WRITE     SVIVAR
     C*                  ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Merværdesskatt                                    SRBAAC /
      *////////////////////////////////////////////////////////////
     C     SRBAAC        BEGSR
      *______________________________
      * Læs avgiftslinjer och summera
      *""""""""""""""""""""""""""""""
      * Blanka resultat
     C                   EVAL      WVIVA_ABB=0
      * Læs och summera
     C     KEYA          SETLL     SVIVA
     C     KEYA          READE(N)  SVIVA                                  55
     C     *IN55         DOWEQ     *OFF
     C                   ADD       SVIVA_ABB     WVIVA_ABB
     C     KEYA          READE     SVIVA                                  55
     C                   ENDDO
S02  C*                  IF        WVIVA_ABB > 0
     C                   ADD       ZVIV_STVA2    WVIVA_ABB
N13  C                   Z-ADD     ZVIV_STVA2    WVIVA_ABB
      * Addera momspost  (ikke ved 4200)
     C     ZVIV_EUP1     IFNE      '4200'
     C                   CLEAR                   SVIVAR
     C                   EVAL      SVIVA_SAV=ZVIV_SYAV
     C                   EVAL      SVIVA_SOP=ZVIV_SYOP
     C                   EVAL      SVIVA_SLI=SVIV_SYLI
N11  C     WDT           IFGE      '20150101'
N11  C                   EVAL      SVIVA_ABK='1MT'
N11  C                   EVAL      SVIVA_ABG=WVIVA_ABB
N11  C                   ELSE
     C                   EVAL      SVIVA_ABK='B00'
     C                   EVAL      SVIVA_ABS=25
     C                   EVAL      SVIVA_ABG=WVIVA_ABB
     C                   EVAL      SVIVA_ABB= WVIVA_ABB * 0,25
N11  C                   ENDIF
     C                   WRITE     SVIVAR
     C                   ENDIF
S02  C*                  ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Kontrollera input på linje                        SRBTST /
      *////////////////////////////////////////////////////////////
     C     SRBTST        BEGSR
      * Landkod
     C                   MOVEL     ZVIV_ULKD     ZVIV_ULKD4        4
     C     ZVIV_ULKD4    CHAIN     SVTX08F2                           31
     C                   IF        *IN31
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0009'     ZMSGNO
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     4             POSNBR
     C                   GOTO      SRBTST9
     C                   ENDIF
      * TARIC nummer
N32  C     SVIH_MTYP     IFNE      'HNU'
N32  C     SVIH_MTYP     ANDNE     'HNK'
N32  C     SVIH_MTYP     ANDNE     'HRT'
     C     ZVIV_VATA     CHAIN     SVTX04F                            32
     C                   IF        *IN32
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0020'     ZMSGNO
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     7             POSNBR
     C                   GOTO      SRBTST9
     C                   ENDIF
N32  C                   ENDIF
      * Tillæggskod
     C     ZVIV_VATI     IFNE      *BLANKS
     C                   EVAL      ZVKD_IE='A'
     C                   EVAL      ZVKD_TYP='ADD'
     C                   EVAL      ZVKD_KD=ZVIV_VATI
     C                   ENDIF
N20   * Førmåner, sætt automatiskt vid blank kod
N32  C     SVIH_MTYP     IFNE      'HNU'
N32  C     SVIH_MTYP     ANDNE     'HNK'
N32  C     SVIH_MTYP     ANDNE     'HRT'
N20  C                   IF        ZVIV_FOKD=*BLANKS
N20  C     ZVIV_ULKD     IFEQ      'CH'
N20  C     ZVIV_ULKD     OREQ      'NO'
N20  C     ZVIV_ULKD     OREQ      'EU'
N20  C                   EVAL      ZVIV_FOKD='300'
     C                   CALL      'SVI303R'
     C                   PARM                    ZVIV_VATA
S28  C*                  PARM                    SVIH_AVUT
N28  C                   PARM                    ZVIV_ULKD
     C                   PARM                    ZVIV_FOKD
     C                   PARM      *ZEROS        WVTA_SAT
     C                   PARM      *BLANKS       WVTA_FTI
     C                   PARM      *BLANKS       WVTA_MTI
     C                   PARM      *BLANKS       WVTA_MUC
N21  C     WVTA_SAT      IFEQ      *ZEROS
N21  C                   EVAL      ZVIV_FOKD='100'
N21  C                   ENDIF
N20  C                   ELSE
N20  C                   EVAL      ZVIV_FOKD='100'
N20  C                   ENDIF
N20  C                   ENDIF
      * Førmåner, riktig kod ?
     C                   EVAL      ZVKD_IE='I'
     C                   EVAL      ZVKD_TYP='FOR'
     C                   EVAL      ZVKD_KD=ZVIV_FOKD
     C     SVTX03K       CHAIN     SVTX03F                            34
     C                   IF        *IN34
     C                   EVAL      *IN30=*ON
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     18            POSNBR
     C                   MOVE      'SVI0019'     ZMSGNO
     C                   GOTO      SRBTST9
     C                   ENDIF
N32  C                   ENDIF
      * Førmån 400 endast tillåten ihop med landkod=TR (Turkiet)
     C     ZVIV_FOKD     IFEQ      '400'
     C     ZVIV_ULKD     ANDNE     'TR'
     C                   EVAL      *IN30=*ON
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     18            POSNBR
     C                   MOVE      'SVI0050'     ZMSGNO
     C                   GOTO      SRBTST9
     C                   ENDIF
      * EU Procedurkod
     C     SVTPROKEY     CHAIN     SVTPRO                             35
     C                   IF        *IN35
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0023'     ZMSGNO
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     22            POSNBR
     C                   GOTO      SRBTST9
     C                   ENDIF
      * Tillståndskod
     C*    ZVIV_SUTL     COMP      *BLANKS                                20
     C* N20ZVIV_SUTL     COMP      'UDH'                                  20
     C* N20ZVIV_SUTL     COMP      'LVP'                                  20
     C* N20ZVIV_SUTL     COMP      'KKI'                                  20
     C* N20ZVIV_SUTL     COMP      'KKE'                                  20
     C* N20ZVIV_SUTL     COMP      'JNI'                                  20
     C* N20ZVIV_SUTL     COMP      'JNE'                                  20
     C* N20ZVIV_SUTL     COMP      'HTR'                                  20
     C* N20ZVIV_SUTL     COMP      'SLV'                                  20
     C* N20ZVIV_SUTL     COMP      'NTL'                                  20
     C*    *IN20         IFEQ      *OFF
     C*                  EVAL      *IN30=*ON
     C*                  EVAL      *IN40=*ON
     C*                  MOVE      'SVI0022'     ZMSGNO
     C*                  Z-ADD     24            LINNBR
     C*                  Z-ADD     56            POSNBR
     C*                  GOTO      SRBTST9
     C*                  ENDIF
      * Bilagda handlingar, typ
     C     ZVIV_BIT1     IFEQ      *BLANKS
     C     ZVIV_BII1     ANDNE     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN45=*ON
     C                   MOVE      'SVI0045'     ZMSGNO
     C                   Z-ADD     25            LINNBR
     C                   Z-ADD     40            POSNBR
     C                   GOTO      SRBTST9
     C                   ENDIF
      * Bilagda handlingar, id
     C     ZVIV_BII1     IFEQ      *BLANKS
     C     ZVIV_BIT1     ANDNE     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN46=*ON
     C                   MOVE      'SVI0045'     ZMSGNO
     C                   Z-ADD     25            LINNBR
     C                   Z-ADD     45            POSNBR
     C                   GOTO      SRBTST9
     C                   ENDIF
      * Bilagda handlingar, id
     C     ZVIV_BII1     IFEQ      *BLANKS
     C     ZVIV_FOKD     ANDEQ     '300'
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN46=*ON
     C                   MOVE      'SVI0046'     ZMSGNO
     C                   Z-ADD     25            LINNBR
     C                   Z-ADD     45            POSNBR
     C                   GOTO      SRBTST9
     C                   ENDIF
      * X mängdenhet kräves ?
     C                   MOVE      *BLANKS       UVTA_MUC4         4
     C                   CALL      'SVT010R'
     C                   PARM                    ZVTA_IE
     C                   PARM                    ZVIV_VATA
     C                   PARM                    ZVIV_ULKD
     C                   PARM                    UVTA_MUC4
     C                   MOVEL     UVTA_MUC4     UVTA_MUC
     C     ZVIV_ANKV     IFLE      *ZEROS
     C     UVTA_MUC      ANDNE     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN38=*ON
     C                   MOVE      'SVI0041'     ZMSGNO
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     59            POSNBR
     C                   GOTO      SRBTST9
     C                   ENDIF
      * Belopp
S04  C     SVIH_MTYP     IFNE      'HNU'
S04  C     SVIH_MTYP     ANDNE     'HNK'
S04  C     SVIH_MTYP     ANDNE     'HRT'
N04  C                   IF        ZVIV_FABL < 0.001
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN44=*ON
     C                   MOVE      'SVI0040'     ZMSGNO
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     69            POSNBR
     C                   GOTO      SRBTST9
     C                   ENDIF
     C                   ENDIF
N17   * Kollital
N17  C     XVIH_KOTA     IFGT      *ZEROS
N17  C     ZVIV_KOTA     ANDLE     *ZEROS
N17  C                   EVAL      *IN30=*ON
N17  C                   MOVE      'SVI0012'     ZMSGNO
N17  C                   Z-ADD     23            LINNBR
N17  C                   Z-ADD     9             POSNBR
N17  C                   GOTO      SRBTST9
N17  C                   ENDIF
      * Kollislag
     C     ZVIV_KOSL     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0029'     ZMSGNO
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SRBTST9
     C                   ENDIF
N29   *
N29  C                   EVAL      ZVKD_IE='A'
N29  C                   EVAL      ZVKD_TYP='KLI'
N29  C                   EVAL      ZVKD_KD=ZVIV_KOSL
N29  C     SVTX03K       CHAIN     SVTX03F
N29  C                   IF        NOT %FOUND
N29  C                   EVAL      *IN30=*ON
N29  C                   Z-ADD     23            LINNBR
N29  C                   Z-ADD     15            POSNBR
N29  C                   MOVE      'SVI0053'     ZMSGNO
N29  C                   GOTO      SRBTST9
N29  C                   ENDIF
      * Godsmærkning
     C     ZVIV_GODM     IFEQ      *BLANKS
     C     ZVIV_KOSL     COMP      'VR'                                   20
     C  N20ZVIV_KOSL     COMP      'VY'                                   20
     C  N20ZVIV_KOSL     COMP      'VO'                                   20
     C  N20ZVIV_KOSL     COMP      'VL'                                   20
     C  N20ZVIV_KOSL     COMP      'VG'                                   20
     C  N20ZVIV_KOSL     COMP      'VQ'                                   20
     C  N20ZVIV_KOSL     COMP      'NE'                                   20
     C  N20ZVIV_KOSL     COMP      'NF'                                   20
     C  N20ZVIV_KOSL     COMP      'NG'                                   20
     C                   IF        *IN20=*OFF
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0027'     ZMSGNO
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     91            POSNBR
     C                   GOTO      SRBTST9
     C                   ENDIF
     C                   ENDIF
      * Nettovikt
N32  C     SVIH_MTYP     IFNE      'HNU'
N32  C     SVIH_MTYP     ANDNE     'HNK'
N32  C     SVIH_MTYP     ANDNE     'HRT'
     C     ZVIV_NETO     IFLE      *ZEROS
     C     ZVIV_BRUT     MULT      0.9           ZVIV_NETO
N18  C     ZVIV_NETO     IFGE      1
N18  C                   EVAL      WVIKT=ZVIV_NETO
N18  C                   EVAL      ZVIV_NETO=WVIKTHEL
N18  C                   ENDIF
     C                   ENDIF
     C     ZVIV_NETO     IFLE      *ZEROS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN37=*ON
     C                   MOVE      'SVI0047'     ZMSGNO
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     43            POSNBR
     C                   GOTO      SRBTST9
     C                   ENDIF
N18   * Nettovikt, Inga decimaler på vikter lik eller øver 1 Kg
N18  C     ZVIV_NETO     IFGE      1
N18  C                   EVAL      WVIKT=ZVIV_NETO
N18  C                   IF        WVIKTDEC > *ZEROS
N18  C                   EVAL      *IN30=*ON
N18  C                   EVAL      *IN37=*ON
N18  C                   MOVE      'SVI0052'     ZMSGNO
N18  C                   Z-ADD     22            LINNBR
N18  C                   Z-ADD     43            POSNBR
N18  C                   GOTO      SRBTST9
N18  C                   ENDIF
N18  C                   ENDIF
N32  C                   ENDIF
N18   * Bruttovikt, Inga decimaler på vikter lik eller øver 1 Kg
N18  C     ZVIV_BRUT     IFGE      1
N18  C                   EVAL      WVIKT=ZVIV_BRUT
N18  C                   IF        WVIKTDEC > *ZEROS
N18  C                   EVAL      *IN30=*ON
N18  C                   EVAL      *IN36=*ON
N18  C                   MOVE      'SVI0052'     ZMSGNO
N18  C                   Z-ADD     22            LINNBR
N18  C                   Z-ADD     27            POSNBR
N18  C                   GOTO      SRBTST9
N18  C                   ENDIF
N18  C                   ENDIF
N30   * Hämta varutext om den saknas
N30  C                   IF        ZVIV_VASL = *BLANKS
N30  C                   MOVEL     ZVIV_VATA     WVATA4            4
N30  C                   MOVEL     WVATA4        WVATA10          10
N30  C                   MOVE      '000000'      WVATA10
N30  C     WVATA10       CHAIN     SVTX10F
N30  C                   IF        %FOUND
N30  C                   MOVEL     SVTX10_31     ZVIV_VASL
N30  C                   ENDIF
N30  C                   ENDIF
      * Call me (Åtgærdsindikator)
     C     SVIH_MTYP     IFEQ      'DNK'
     C     SVIH_MTYP     OREQ      'HNK'
     C     SVIH_MTYP     OREQ      'OMP'
     C     SVIH_MTYP     OREQ      'TNU'
     C     ZVIV_CALL     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN47=*ON
     C                   MOVE      'SVI0032'     ZMSGNO
     C                   EVAL      LINNBR=22
     C                   EVAL      POSNBR=106
     C                   GOTO      SRBTST9
     C                   ENDIF
     C     ZVIV_CALL     COMP      '00'                                   20
     C  N20ZVIV_CALL     COMP      '01'                                   20
     C  N20ZVIV_CALL     COMP      '10'                                   20
     C  N20ZVIV_CALL     COMP      '11'                                   20
     C  N20ZVIV_CALL     COMP      '12'                                   20
     C  N20ZVIV_CALL     COMP      '13'                                   20
     C     *IN20         IFEQ      *OFF
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN47=*ON
     C                   MOVE      'SVI0032'     ZMSGNO
     C                   EVAL      LINNBR=22
     C                   EVAL      POSNBR=106
     C                   GOTO      SRBTST9
     C                   ENDIF
     C                   ENDIF

     C     SRBTST9       TAG

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Berækna CIF totalt                              SRCIFTOT /
      *////////////////////////////////////////////////////////////
     C     SRCIFTOT      BEGSR
      *__________________________________
      * Summera alla kostnader och avdrag
      *""""""""""""""""""""""""""""""""""
      * Hämta mall för aktuell leveransvillkår
     C     SVIH_LEKD     CHAIN     SVTLV                              64
      * Fakturabelopp i Svenska kronor
     C     SVIH_FABL     MULT      SVIH_VAKU     ZVIH_FABL        15 3
     C                   EVAL      ZVVK_KD=SVIH_VAKD
     C                   EVAL      ZVVK_DTS=99999999
     C     SVTVKKEY      SETGT     SVTVK
     C                   READP     SVTVK                                  64
SH   C                   DOW       *IN64 = *OFF
SH   C                   IF        SVIH_SYDT>= SVVK_DTS
SH   C                   LEAVE
SH   C                   END
SH   C                   READP     SVTVK                                  64
SH   C                   ENDDO
N31  C                   IF        ZVIH_FABL > 0
     C                   IF        SVVK_OMR > 0
     C     ZVIH_FABL     DIV       SVVK_OMR      ZVIH_FABL
N31  C                   ENDIF
     C                   ENDIF
     C                   EVAL      ZCIFTOT=ZVIH_FABL
     C                   EVAL      ZCIFTOT2=ZVIH_FABL
      * Transport CIF
     C                   IF        SVLV_TR='J'
     C     SVIH_VUFR     MULT      SVIH_VUKU     ZVIH_VUFR
     C                   EVAL      ZVVK_KD=SVIH_VUVA
     C                   EVAL      ZVVK_DTS=99999999
     C     SVTVKKEY      SETGT     SVTVK
     C                   READP     SVTVK                                  64
N31  C                   IF        ZVIH_VUFR > 0
N31  C                   IF        SVVK_OMR > 0
     C     ZVIH_VUFR     DIV       SVVK_OMR      ZVIH_VUFR
N31  C                   ENDIF
N31  C                   ENDIF
     C                   ADD       ZVIH_VUFR     ZCIFTOT
     C                   ENDIF
      * Transport TULL
     C                   IF        SVLV_TR2='J'
     C     SVIH_VUFR     MULT      SVIH_VUKU     ZVIH_VUFR
     C                   EVAL      ZVVK_KD=SVIH_VUVA
     C                   EVAL      ZVVK_DTS=99999999
     C     SVTVKKEY      SETGT     SVTVK
     C                   READP     SVTVK                                  64
N31  C                   IF        ZVIH_VUFR > 0
N31  C                   IF        SVVK_OMR > 0
     C     ZVIH_VUFR     DIV       SVVK_OMR      ZVIH_VUFR
N31  C                   ENDIF
N31  C                   ENDIF
     C                   ADD       ZVIH_VUFR     ZCIFTOT2
     C                   ENDIF
      * Førsækring CIF
     C     SVLV_FS       IFEQ      'J'
     C     SVLV_FS       OREQ      'P'
     C                   ADD       SVIH_VUFO     ZCIFTOT
     C                   ENDIF
      * Førsækring TULL
     C     SVLV_FS2      IFEQ      'J'
     C     SVLV_FS2      OREQ      'P'
     C                   ADD       SVIH_VUFO     ZCIFTOT2
     C                   ENDIF
      * Øvriga kostnader
     C                   IF        SVLV_OK='J'
     C                   ADD       SVIH_OVKO     ZCIFTOT
     C                   ENDIF
      * Kassarabatt
     C                   IF        SVLV_KR='J'
     C                   SUB       SVIH_KARA     ZCIFTOT
     C                   ENDIF
      * Annan rabatt
     C                   IF        SVLV_AR='J'
     C                   SUB       SVIH_ANRA     ZCIFTOT
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Berækna CIF før varupost                        SRCIFDET /
      *////////////////////////////////////////////////////////////
     C     SRCIFDET      BEGSR
     C                   IF        SVIH_FABL = ZCIFTOT
     C                   IF        ZVIV_STVA = *ZEROS
     C                   EVAL      ZVIV_STVA = ZVIV_FABL
     C                   ENDIF
     C                   IF        ZVIV_STVA2 = *ZEROS
     C                   EVAL      ZVIV_STVA2 = ZVIV_FABL
     C                   ENDIF
     C                   ELSE
N31  C                   IF        ZVIV_FABL > 0
N31  C                   IF        SVIH_FABL > 0
     C     ZVIV_FABL     DIV       SVIH_FABL     ZFAKTOR          18 8
N31  C                   ENDIF
N31  C                   ENDIF
     C                   IF        ZVIV_STVA = *ZEROS
     C     ZCIFTOT       MULT      ZFAKTOR       ZVIV_STVA
     C                   ENDIF
     C                   IF        ZVIV_STVA2 = *ZEROS
     C     ZCIFTOT2      MULT      ZFAKTOR       ZVIV_STVA2
     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Søk i kunders varuposter                        SRKUNSOK /
      *////////////////////////////////////////////////////////////
     C     SRKUNSOK      BEGSR
     C                   EVAL      UVIW_KNSO=*BLANKS
     C                   CALL      'SVI036R'
     C                   PARM                    SVIH_MOKN
     C                   PARM                    UVIW_KNSO
     C     UVIW_KNSO     IFNE      *BLANKS
     C     SVIWKEY       CHAIN     SVIW                               57
     C     *IN57         IFEQ      *OFF

     C                   EVAL      ZVIV_KOSL=SVIW_KOSL
     C                   EVAL      ZVIV_GODM=SVIW_GODM
     C                   EVAL      ZVIV_VASL=SVIW_VASL
     C                   EVAL      ZVIV_VANO=SVIW_VANO
     C                   EVAL      ZVIV_VATA=SVIW_VATA
     C                   EVAL      ZVIV_VATI=SVIW_VATI
     C                   EVAL      ZVIV_VAT4=SVIW_VAT4
     C                   EVAL      ZVIV_VAT5=SVIW_VAT5
     C                   EVAL      ZVIV_ULKD=SVIW_ULKD
     C                   EVAL      ZVIV_FOKD=SVIW_FOKD
     C                   EVAL      ZVIV_EUP1=SVIW_EUP1
     C                   EVAL      ZVIV_EUP2=SVIW_EUP2
N27  C     *IN57         IFEQ      *ON
     C                   EVAL      ZVIV_KOTA=SVIW_KOTA
     C                   EVAL      ZVIV_KOT2=SVIW_KOT2
     C                   EVAL      ZVIV_KOT3=SVIW_KOT3
     C                   EVAL      ZVIV_KOT4=SVIW_KOT4
     C                   EVAL      ZVIV_KOT5=SVIW_KOT5
     C                   EVAL      ZVIV_KOS2=SVIW_KOS2
     C                   EVAL      ZVIV_KOS3=SVIW_KOS3
     C                   EVAL      ZVIV_KOS4=SVIW_KOS4
     C                   EVAL      ZVIV_KOS5=SVIW_KOS5
     C                   EVAL      ZVIV_GOD2=SVIW_GOD2
     C                   EVAL      ZVIV_GOD3=SVIW_GOD3
     C                   EVAL      ZVIV_GOD4=SVIW_GOD4
     C                   EVAL      ZVIV_GOD5=SVIW_GOD5
     C                   EVAL      ZVIV_VAS2=SVIW_VAS2
     C                   EVAL      ZVIV_VAS3=SVIW_VAS3
     C                   EVAL      ZVIV_VAS4=SVIW_VAS4
     C                   EVAL      ZVIV_BRUT=SVIW_BRUT
     C                   EVAL      ZVIV_NETO=SVIW_NETO
     C                   EVAL      ZVIV_KVOT=SVIW_KVOT
     C                   EVAL      ZVIV_ANKV=SVIW_ANKV
     C                   EVAL      ZVIV_SUKO=SVIW_SUKO
     C                   EVAL      ZVIV_SUK6=SVIW_SUK6
     C                   EVAL      ZVIV_SUKB=SVIW_SUKB
     C                   EVAL      ZVIV_SUTX=SVIW_SUTX
     C                   EVAL      ZVIV_SUT2=SVIW_SUT2
     C                   EVAL      ZVIV_SUT3=SVIW_SUT3
     C                   EVAL      ZVIV_SUT4=SVIW_SUT4
     C                   EVAL      ZVIV_SUT5=SVIW_SUT5
     C                   EVAL      ZVIV_SUT6=SVIW_SUT6
     C                   EVAL      ZVIV_SUT7=SVIW_SUT7
     C                   EVAL      ZVIV_SUT8=SVIW_SUT8
     C                   EVAL      ZVIV_SUT9=SVIW_SUT9
     C                   EVAL      ZVIV_SUTA=SVIW_SUTA
     C                   EVAL      ZVIV_SUTB=SVIW_SUTB
     C                   EVAL      ZVIV_SUTC=SVIW_SUTC
     C                   EVAL      ZVIV_SUTD=SVIW_SUTD
     C                   EVAL      ZVIV_SUTE=SVIW_SUTE
     C                   EVAL      ZVIV_SUTF=SVIW_SUTF
     C                   EVAL      ZVIV_STVA=SVIW_STVA
     C                   EVAL      ZVIV_STVA2=SVIW_STVA2
     C                   EVAL      ZVIV_FABL=SVIW_FABL
     C                   EVAL      ZVIV_BIT1=SVIW_BIT1
     C                   EVAL      ZVIV_BIT2=SVIW_BIT2
     C                   EVAL      ZVIV_BIT3=SVIW_BIT3
     C                   EVAL      ZVIV_BIT4=SVIW_BIT4
     C                   EVAL      ZVIV_BIT5=SVIW_BIT5
     C                   EVAL      ZVIV_BIT6=SVIW_BIT6
     C                   EVAL      ZVIV_BIT7=SVIW_BIT7
     C                   EVAL      ZVIV_BIT8=SVIW_BIT8
     C                   EVAL      ZVIV_BIT9=SVIW_BIT9
     C                   EVAL      ZVIV_BII1=SVIW_BII1
     C                   EVAL      ZVIV_BII2=SVIW_BII2
     C                   EVAL      ZVIV_BII3=SVIW_BII3
     C                   EVAL      ZVIV_BII4=SVIW_BII4
     C                   EVAL      ZVIV_BII5=SVIW_BII5
     C                   EVAL      ZVIV_BII6=SVIW_BII6
     C                   EVAL      ZVIV_BII7=SVIW_BII7
     C                   EVAL      ZVIV_BII8=SVIW_BII8
     C                   EVAL      ZVIV_BII9=SVIW_BII9
     C                   EVAL      ZVIV_CO01=SVIW_CO01
     C                   EVAL      ZVIV_CO02=SVIW_CO02
     C                   EVAL      ZVIV_CO03=SVIW_CO03
     C                   EVAL      ZVIV_CO04=SVIW_CO04
     C                   EVAL      ZVIV_CO05=SVIW_CO05
     C                   EVAL      ZVIV_CO06=SVIW_CO06
     C                   EVAL      ZVIV_CO07=SVIW_CO07
     C                   EVAL      ZVIV_CO08=SVIW_CO08
     C                   EVAL      ZVIV_CO09=SVIW_CO09
     C                   EVAL      ZVIV_CO10=SVIW_CO10
     C                   EVAL      ZVIV_CO11=SVIW_CO11
     C                   EVAL      ZVIV_CO12=SVIW_CO12
     C                   EVAL      ZVIV_CO13=SVIW_CO13
     C                   EVAL      ZVIV_CO14=SVIW_CO14
     C                   EVAL      ZVIV_CO15=SVIW_CO15
     C                   EVAL      ZVIV_CO16=SVIW_CO16
     C                   EVAL      ZVIV_CO17=SVIW_CO17
     C                   EVAL      ZVIV_CO18=SVIW_CO18
     C                   EVAL      ZVIV_CO19=SVIW_CO19
     C                   EVAL      ZVIV_CO20=SVIW_CO20
     C                   EVAL      ZVIV_TIK1=SVIW_TIK1
     C                   EVAL      ZVIV_TIK2=SVIW_TIK2
     C                   EVAL      ZVIV_TIK3=SVIW_TIK3
     C                   EVAL      ZVIV_TIK4=SVIW_TIK4
     C                   EVAL      ZVIV_TIK5=SVIW_TIK5
     C                   EVAL      ZVIV_TIK6=SVIW_TIK6
     C                   EVAL      ZVIV_TIK7=SVIW_TIK7
     C                   EVAL      ZVIV_TIK8=SVIW_TIK8
     C                   EVAL      ZVIV_TIK9=SVIW_TIK9
     C                   EVAL      ZVIV_TIT1=SVIW_TIT1
     C                   EVAL      ZVIV_TIT2=SVIW_TIT2
     C                   EVAL      ZVIV_TIT3=SVIW_TIT3
     C                   EVAL      ZVIV_TIT4=SVIW_TIT4
     C                   EVAL      ZVIV_TIT5=SVIW_TIT5
     C                   EVAL      ZVIV_TIT6=SVIW_TIT6
     C                   EVAL      ZVIV_TIT7=SVIW_TIT7
     C                   EVAL      ZVIV_TIT8=SVIW_TIT8
     C                   EVAL      ZVIV_TIT9=SVIW_TIT9
     C                   EVAL      ZVIV_TIX1=SVIW_TIX1
     C                   EVAL      ZVIV_TIX2=SVIW_TIX2
     C                   EVAL      ZVIV_TIX3=SVIW_TIX3
     C                   EVAL      ZVIV_TIX4=SVIW_TIX4
     C                   EVAL      ZVIV_TIX5=SVIW_TIX5
     C                   EVAL      ZVIV_TIX6=SVIW_TIX6
     C                   EVAL      ZVIV_TIX7=SVIW_TIX7
     C                   EVAL      ZVIV_TIX8=SVIW_TIX8
     C                   EVAL      ZVIV_TIX9=SVIW_TIX9
     C                   EVAL      ZVIV_LAGI=SVIW_LAGI
     C                   EVAL      ZVIV_LAGT=SVIW_LAGT
     C                   EVAL      ZVIV_LAGL=SVIW_LAGL
     C                   EVAL      ZVIV_CALL=SVIW_CALL
N27  C                   ENDIF

     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Mer rubrik 31                                        SRI /
      *////////////////////////////////////////////////////////////
     C     SRI           BEGSR
      *____________
      * Flytte felt
      *""""""""""""
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   EVAL      ZVIV_KOT1=ZVIV_KOTA
     C                   EVAL      ZVIV_KOS1=ZVIV_KOSL
     C                   EVAL      ZVIV_VAS1=ZVIV_VASL

     C     SRI1          TAG

     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     SVI003DØ
     C                   EXFMT     SVI003DI
     C                   EVAL      *IN30 = *OFF
     C     *IN12         IFEQ      '0'
      *_______
      * F4=Søk
      *"""""""
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN04         IFEQ      '1'
     C     LINNBR        IFGE      5
     C     LINNBR        ANDLE     9
     C     POSNBR        ANDEQ     11
     C                   CALL      'SVT003R'
     C                   PARM      'KLI'         UTYP              3
     C                   PARM      'A'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   SELECT
     C     LINNBR        WHENEQ    5
     C                   MOVEL     UKD           ZVIV_KOS1
     C     LINNBR        WHENEQ    6
     C                   MOVEL     UKD           ZVIV_KOS2
     C     LINNBR        WHENEQ    7
     C                   MOVEL     UKD           ZVIV_KOS3
     C     LINNBR        WHENEQ    8
     C                   MOVEL     UKD           ZVIV_KOS4
     C     LINNBR        WHENEQ    9
     C                   MOVEL     UKD           ZVIV_KOS5
     C                   ENDSL
     C                   ENDIF
     C                   GOTO      SRI1
     C                   ENDIF
     C                   ENDIF
      *____________
      * Teste input
      *""""""""""""
     C*  30              GOTO      SRI1
      *________________________
      * Oppdatere felles felter
      *""""""""""""""""""""""""
     C                   EVAL      ZVIV_KOTA=ZVIV_KOT1
     C                   EVAL      ZVIV_KOSL=ZVIV_KOS1
     C                   EVAL      ZVIV_VASL=ZVIV_VAS1

     C                   ENDIF

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Mer Særskilda upplysningar                           SRJ /
      *////////////////////////////////////////////////////////////
     C     SRJ           BEGSR
      *____________
      * Flytte felt
      *""""""""""""
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   EVAL      ZVIV_SUK1=ZVIV_SUKO
     C                   EVAL      ZVIV_SUT1=ZVIV_SUTX

     C     SRJ1          TAG

     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     SVI003DØ
     C                   EXFMT     SVI003DJ
     C                   EVAL      *IN30 = *OFF
     C     *IN12         IFEQ      '0'
      *_______
      * F4=Søk
      *"""""""
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN04         IFEQ      '1'
     C     LINNBR        IFGE      5
     C     LINNBR        ANDLE     15
     C     POSNBR        ANDEQ     2
     C                   CALL      'SVT003R'
     C                   PARM      'SAL'         UTYP              3
     C                   PARM      'I'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   SELECT
     C     LINNBR        WHENEQ    5
     C                   MOVEL     UKD           ZVIV_SUK1
     C     LINNBR        WHENEQ    10
     C                   MOVEL     UKD           ZVIV_SUK6
     C     LINNBR        WHENEQ    15
     C                   MOVEL     UKD           ZVIV_SUKB
     C                   ENDSL
     C                   ENDIF
     C                   GOTO      SRJ1
     C                   ENDIF
     C                   ENDIF
      *____________
      * Teste input
      *""""""""""""
     C*  30              GOTO      SRJ1
      *________________________
      * Oppdatere felles felter
      *""""""""""""""""""""""""
     C                   EVAL      ZVIV_SUKO=ZVIV_SUK1
     C                   EVAL      ZVIV_SUTX=ZVIV_SUT1

     C                   ENDIF

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Mer Bilagda Handlingar                               SRK /
      *////////////////////////////////////////////////////////////
     C     SRK           BEGSR
      *____________
      * Flytte felt
      *""""""""""""
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR

     C     SRK1          TAG

     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     SVI003DØ
     C                   EXFMT     SVI003DK
     C                   EVAL      *IN30 = *OFF
     C     *IN12         IFEQ      '0'
      *_______
      * F4=Søk
      *"""""""
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN04         IFEQ      '1'
     C     LINNBR        IFGE      5
     C     LINNBR        ANDLE     13
     C     POSNBR        ANDEQ     2
     C                   CALL      'SVT003R'
     C                   PARM      'MCF'         UTYP              3
     C                   PARM      'A'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   SELECT
     C     LINNBR        WHENEQ    5
     C                   MOVEL     UKD           ZVIV_BIT1
     C     LINNBR        WHENEQ    6
     C                   MOVEL     UKD           ZVIV_BIT2
     C     LINNBR        WHENEQ    7
     C                   MOVEL     UKD           ZVIV_BIT3
     C     LINNBR        WHENEQ    8
     C                   MOVEL     UKD           ZVIV_BIT4
     C     LINNBR        WHENEQ    9
     C                   MOVEL     UKD           ZVIV_BIT5
     C     LINNBR        WHENEQ    10
     C                   MOVEL     UKD           ZVIV_BIT6
     C     LINNBR        WHENEQ    11
     C                   MOVEL     UKD           ZVIV_BIT7
     C     LINNBR        WHENEQ    12
     C                   MOVEL     UKD           ZVIV_BIT8
     C     LINNBR        WHENEQ    13
     C                   MOVEL     UKD           ZVIV_BIT9
     C                   ENDSL
     C                   ENDIF
     C                   GOTO      SRK1
     C                   ENDIF
     C                   ENDIF
      *____________
      * Teste input
      *""""""""""""
     C*  30              GOTO      SRK1

     C                   ENDIF

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Containernummer                                      SRL /
      *////////////////////////////////////////////////////////////
     C     SRL           BEGSR
      *____________
      * Flytte felt
      *""""""""""""
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR

     C     SRL1          TAG

     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     SVI003DØ
     C                   EXFMT     SVI003DL
     C                   EVAL      *IN30 = *OFF
     C     *IN12         IFEQ      '0'
      *____________
      * Teste input
      *""""""""""""
     C*  30              GOTO      SRL1

     C                   ENDIF

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Tidigare Handlingar                                  SRM /
      *////////////////////////////////////////////////////////////
     C     SRM           BEGSR
      *____________
      * Flytte felt
      *""""""""""""
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR

     C     SRM1          TAG

     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     SVI003DØ
     C                   EXFMT     SVI003DM
     C                   EVAL      *IN30 = *OFF
     C     *IN12         IFEQ      '0'
      *____________
      * Teste input
      *""""""""""""
     C*  30              GOTO      SRM1

     C                   ENDIF

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Identifiering av lager                               SRN /
      *////////////////////////////////////////////////////////////
     C     SRN           BEGSR
      *____________
      * Flytte felt
      *""""""""""""
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR

     C     SRN1          TAG

     C  N30              EVAL      ZMSGNO='SY00000'
     C                   WRITE     SVI003DØ
     C                   EXFMT     SVI003DN
     C                   EVAL      *IN30 = *OFF
     C     *IN12         IFEQ      '0'
      *____________
      * Teste input
      *""""""""""""
     C*  30              GOTO      SRN1

     C                   ENDIF

     C                   ENDSR
N09   *////////////////////////////////////////////////////////////
N09   *  Automatisk viktberækning                        SRAUTOVK /
N09   *////////////////////////////////////////////////////////////
N09  C     SRAUTOVK      BEGSR
N09  C     SVIH_FABL     IFGT      *ZEROS
N09  C     SVIH_BRUT     ANDGT     *ZEROS
N09
N31  C     ZVIV_FABL     IFGT      *ZEROS
N09  C     ZVIV_FABL     DIV(H)    SVIH_FABL     ZFAKTOR          18 8
N31  C                   ENDIF
N09  C     ZFAKTOR       MULT(H)   SVIH_BRUT     ZVIV_BRUT              4848
N09  C   48              EVAL      ZVIV_BRUT=1
N09  C                   EVAL      ZVIV_NETO=*ZEROS
N18  C     ZVIV_BRUT     IFGE      1
N18  C                   EVAL      WVIKT=ZVIV_BRUT
N18  C                   EVAL      ZVIV_BRUT=WVIKTHEL
N18  C                   ENDIF
N09
N09  C                   ENDIF
N09  C                   ENDSR
N19   *////////////////////////////////////////////////////////////
N19   *  Hæmta Y-koder och tillæggskoder                 SRGETKOD /
N19   *////////////////////////////////////////////////////////////
N19  C     SRGETKOD      BEGSR
N19   * Hæmta och skriv Y-koder automatiskt
N19  C                   IF        %SUBST(ZVIV_BIT2:1:1) <> 'Y' AND
N19  C                             %SUBST(ZVIV_BIT3:1:1) <> 'Y' AND
N19  C                             %SUBST(ZVIV_BIT4:1:1) <> 'Y' AND
N19  C                             %SUBST(ZVIV_BIT5:1:1) <> 'Y' AND
N19  C                             %SUBST(ZVIV_BIT6:1:1) <> 'Y' AND
N19  C                             %SUBST(ZVIV_BIT7:1:1) <> 'Y' AND
N19  C                             %SUBST(ZVIV_BIT8:1:1) <> 'Y' AND
N19  C                             %SUBST(ZVIV_BIT9:1:1) <> 'Y'
N19
N19  C                   CALL      'SVT013R'
N19  C                   PARM      'I'           UVIV_IE           1
N19  C                   PARM                    ZVIV_VATA
N19  C                   PARM                    ZVIV_ULKD
N19  C                   PARM                    ZVIV_FOKD
N19  C                   PARM      *BLANKS       UYKOD1            4
N19  C                   PARM      *BLANKS       UYKOD2            4
N19  C                   PARM      *BLANKS       UYKOD3            4
N19  C                   PARM      *BLANKS       UYKOD4            4
N19  C                   PARM      *BLANKS       UYKOD5            4
N19  C                   PARM      *BLANKS       UYKOD6            4
N19  C                   PARM      *BLANKS       UYKOD7            4
N19  C                   PARM      *BLANKS       UYKOD8            4
N19  C                   PARM      *BLANKS       UYKOD9            4
N19  C                   SELECT
N19  C     ZVIV_BIT1     WHENEQ    *BLANKS
N19  C                   EVAL      ZVIV_BIT1=UYKOD1
N19  C                   EVAL      ZVIV_BIT2=UYKOD2
N19  C                   EVAL      ZVIV_BIT3=UYKOD3
N19  C                   EVAL      ZVIV_BIT4=UYKOD4
N19  C                   EVAL      ZVIV_BIT5=UYKOD5
N19  C                   EVAL      ZVIV_BIT6=UYKOD6
N19  C                   EVAL      ZVIV_BIT7=UYKOD7
N19  C                   EVAL      ZVIV_BIT8=UYKOD8
N19  C                   EVAL      zVIV_BIT9=UYKOD9
N19  C     ZVIV_BIT2     WHENEQ    *BLANKS
N19  C                   EVAL      ZVIV_BIT2=UYKOD1
N19  C                   EVAL      ZVIV_BIT3=UYKOD2
N19  C                   EVAL      ZVIV_BIT4=UYKOD3
N19  C                   EVAL      ZVIV_BIT5=UYKOD4
N19  C                   EVAL      ZVIV_BIT6=UYKOD5
N19  C                   EVAL      ZVIV_BIT7=UYKOD6
N19  C                   EVAL      ZVIV_BIT8=UYKOD7
N19  C                   EVAL      ZVIV_BIT9=UYKOD8
N19  C     ZVIV_BIT3     WHENEQ    *BLANKS
N19  C                   EVAL      ZVIV_BIT3=UYKOD1
N19  C                   EVAL      ZVIV_BIT4=UYKOD2
N19  C                   EVAL      ZVIV_BIT5=UYKOD3
N19  C                   EVAL      ZVIV_BIT6=UYKOD4
N19  C                   EVAL      ZVIV_BIT7=UYKOD5
N19  C                   EVAL      ZVIV_BIT8=UYKOD6
N19  C                   EVAL      ZVIV_BIT9=UYKOD7
N19  C     ZVIV_BIT4     WHENEQ    *BLANKS
N19  C                   EVAL      ZVIV_BIT4=UYKOD1
N19  C                   EVAL      ZVIV_BIT5=UYKOD2
N19  C                   EVAL      ZVIV_BIT6=UYKOD3
N19  C                   EVAL      ZVIV_BIT7=UYKOD4
N19  C                   EVAL      ZVIV_BIT8=UYKOD5
N19  C                   EVAL      ZVIV_BIT9=UYKOD6
N19  C     ZVIV_BIT5     WHENEQ    *BLANKS
N19  C                   EVAL      ZVIV_BIT5=UYKOD1
N19  C                   EVAL      ZVIV_BIT6=UYKOD2
N19  C                   EVAL      ZVIV_BIT7=UYKOD3
N19  C                   EVAL      ZVIV_BIT8=UYKOD4
N19  C                   EVAL      ZVIV_BIT9=UYKOD5
N19  C     ZVIV_BIT6     WHENEQ    *BLANKS
N19  C                   EVAL      ZVIV_BIT6=UYKOD1
N19  C                   EVAL      ZVIV_BIT7=UYKOD2
N19  C                   EVAL      ZVIV_BIT8=UYKOD3
N19  C                   EVAL      ZVIV_BIT9=UYKOD4
N19  C     ZVIV_BIT7     WHENEQ    *BLANKS
N19  C                   EVAL      ZVIV_BIT7=UYKOD1
N19  C                   EVAL      ZVIV_BIT8=UYKOD2
N19  C                   EVAL      ZVIV_BIT9=UYKOD3
N19  C     ZVIV_BIT8     WHENEQ    *BLANKS
N19  C                   EVAL      ZVIV_BIT8=UYKOD1
N19  C                   EVAL      ZVIV_BIT9=UYKOD2
N19  C     ZVIV_BIT9     WHENEQ    *BLANKS
N19  C                   EVAL      ZVIV_BIT9=UYKOD1
N19  C                   ENDSL
N19   * Endast Y021 vid førmånskod=300
N19  C     ZVIV_FOKD     IFNE      '300'
N19  C     ZVIV_BIT1     IFEQ      'Y021'
N19  C                   EVAL      ZVIV_BIT1=*BLANKS
N19  C                   ENDIF
N19  C     ZVIV_BIT2     IFEQ      'Y021'
N19  C                   EVAL      ZVIV_BIT2=*BLANKS
N19  C                   ENDIF
N19  C     ZVIV_BIT3     IFEQ      'Y021'
N19  C                   EVAL      ZVIV_BIT3=*BLANKS
N19  C                   ENDIF
N19  C     ZVIV_BIT4     IFEQ      'Y021'
N19  C                   EVAL      ZVIV_BIT4=*BLANKS
N19  C                   ENDIF
N19  C     ZVIV_BIT5     IFEQ      'Y021'
N19  C                   EVAL      ZVIV_BIT5=*BLANKS
N19  C                   ENDIF
N19  C     ZVIV_BIT6     IFEQ      'Y021'
N19  C                   EVAL      ZVIV_BIT6=*BLANKS
N19  C                   ENDIF
N19  C     ZVIV_BIT7     IFEQ      'Y021'
N19  C                   EVAL      ZVIV_BIT7=*BLANKS
N19  C                   ENDIF
N19  C     ZVIV_BIT8     IFEQ      'Y021'
N19  C                   EVAL      ZVIV_BIT8=*BLANKS
N19  C                   ENDIF
N19  C     ZVIV_BIT9     IFEQ      'Y021'
N19  C                   EVAL      ZVIV_BIT9=*BLANKS
N19  C                   ENDIF
N19  C                   ENDIF
N19
N19  C                   ENDIF
N19
N19   * Hæmta och skriv tillæggskoder automatiskt
N19  C                   IF        ZVIV_VATI=*BLANKS AND
N19  C                             ZVIV_VAT4=*BLANKS AND
N19  C                             ZVIV_VAT5=*BLANKS
N19
N19  C                   CALL      'SVT015R'
N19  C                   PARM      'I'           UVIV_IE           1
N19  C                   PARM                    ZVIV_VATA
N19  C                   PARM                    ZVIV_ULKD
N19  C                   PARM      *BLANKS       UTKOD1            4
N19  C                   PARM      *BLANKS       UTKOD2            4
N19  C                   PARM      *BLANKS       UTKOD3            4
N19  C                   PARM      *BLANKS       UTKOD4            4
N19  C                   PARM      *BLANKS       UTKOD5            4
N19  C                   PARM      *BLANKS       UTKOD6            4
N19  C                   PARM      *BLANKS       UTKOD7            4
N19  C                   PARM      *BLANKS       UTKOD8            4
N19  C                   PARM      *BLANKS       UTKOD9            4
N19  C                   SELECT
N19  C     ZVIV_VATI     WHENEQ    *BLANKS
N19  C                   EVAL      ZVIV_VATI=UTKOD1
N19  C                   EVAL      ZVIV_VAT4=UTKOD2
N19  C                   EVAL      ZVIV_VAT5=UTKOD3
N19  C     ZVIV_VAT4     WHENEQ    *BLANKS
N19  C                   EVAL      ZVIV_VAT4=UTKOD1
N19  C                   EVAL      ZVIV_VAT5=UTKOD2
N19  C     ZVIV_VAT5     WHENEQ    *BLANKS
N19  C                   EVAL      ZVIV_VAT5=UTKOD1
N19
N19  C                   ENDSL
N19  C                   ENDIF
N19  C                   ENDSR
N22   *////////////////////////////////////////////////////////////
N22   *  Hæmta Bilagda handlingar från header            SRGETBIL /
N22   *////////////////////////////////////////////////////////////
N22  C     SRGETBIL      BEGSR
N22  C                   EVAL      *IN54=*OFF
N22  C     KEYA1         SETLL     SVIF
N22  C     KEYA1         READE     SVIF                                   54
N22  C     *IN54         DOWEQ     *OFF
N22  C                   SELECT
N22  C     ZVIV_BIT1     WHENEQ    *BLANKS
N22  C                   EVAL      ZVIV_BIT1=SVIF_FATY
N22  C                   EVAL      ZVIV_BII1=SVIF_FATX
N22  C     ZVIV_BIT2     WHENEQ    *BLANKS
N22  C                   EVAL      ZVIV_BIT2=SVIF_FATY
N22  C                   EVAL      ZVIV_BII2=SVIF_FATX
N22  C     ZVIV_BIT3     WHENEQ    *BLANKS
N22  C                   EVAL      ZVIV_BIT3=SVIF_FATY
N22  C                   EVAL      ZVIV_BII3=SVIF_FATX
N22  C     ZVIV_BIT4     WHENEQ    *BLANKS
N22  C                   EVAL      ZVIV_BIT4=SVIF_FATY
N22  C                   EVAL      ZVIV_BII4=SVIF_FATX
N22  C     ZVIV_BIT5     WHENEQ    *BLANKS
N22  C                   EVAL      ZVIV_BIT5=SVIF_FATY
N22  C                   EVAL      ZVIV_BII5=SVIF_FATX
N22  C     ZVIV_BIT6     WHENEQ    *BLANKS
N22  C                   EVAL      ZVIV_BIT6=SVIF_FATY
N22  C                   EVAL      ZVIV_BII6=SVIF_FATX
N22  C     ZVIV_BIT7     WHENEQ    *BLANKS
N22  C                   EVAL      ZVIV_BIT7=SVIF_FATY
N22  C                   EVAL      ZVIV_BII7=SVIF_FATX
N22  C     ZVIV_BIT8     WHENEQ    *BLANKS
N22  C                   EVAL      ZVIV_BIT8=SVIF_FATY
N22  C                   EVAL      ZVIV_BII8=SVIF_FATX
N22  C     ZVIV_BIT9     WHENEQ    *BLANKS
N22  C                   EVAL      ZVIV_BIT9=SVIF_FATY
N22  C                   EVAL      ZVIV_BII9=SVIF_FATX
N22  C                   ENDSL
N22  C     KEYA1         READE     SVIF                                   54
N22  C                   ENDDO
N22  C                   ENDSR
