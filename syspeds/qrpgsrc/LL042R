      *
      ***********************************************************
      *** PROGRAM SKAL SPØRRE PÅ BRUKTE LAGERPOS. PR DAGSDATO ***
      ***********************************************************
      *
     FFIRM      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FLLAGJS04  IF   E           K DISK
     FLLTKF     IF   E           K DISK
     FLLW042    UF A E           K DISK
     FLL042D    CF   E             WORKSTN
     F                                     INFDS(FBAREA)
     F                                     SFILE(SUBFIL:ZRECNO)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  WSSTD1                 1      5
     D  WSSTD2                 6     10
     D  WSSTD3                11     15
     D  WSSTD4                16     20
     D  WSSTD5                21     25
     D  SD                     1     25
     D                                     DIM(5)
     D  STD                    1     25
     D                 DS
     D  WSLLT1                 1      3
     D  WSLLT2                 4      6
     D  WSLLT3                 7      9
     D  WSLLT4                10     12
     D  WSLLT5                13     15
     D  LT                     1     15
     D                                     DIM(5)
     D  LLT                    1     15
     D                 DS
     D  VALLOK                 1     25
     D  VALOK1                 1      5
     D                 DS
     D XTXT            C                   CONST('Kunde uten gr.-
     D                                     tilhørighet')
      *
     C                   EXSR      INIT
      *
     C     ST0           TAG
     C                   EXFMT     BILDE01
      *
     C   03              GOTO      SLUTT
     C   04              DO
     C                   EXSR      SØKDTA
     C                   GOTO      ST0
     C                   END
      *
     C                   EXSR      LESPOS
      *
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
     C                   MOVE      *ZEROS        XGKN              8 0
     C                   MOVE      *ZEROS        XLKN              8 0
     C                   MOVE      *ZEROS        XANT
     C                   MOVE      *ZEROS        XANTEU
     C                   MOVE      *ZEROS        XANTT
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     *LOVAL        SETLL     LLW042
     C                   READ      LLW042                                 94
      *
     C     *IN94         DOWEQ     '0'
     C                   ADD       1             XANTT
     C                   SELECT
     C     XGKN          WHENEQ    0
     C     XLKN          ANDEQ     0
     C                   MOVE      L42GRU        XGKN
     C                   MOVE      L42KN         XLKN
     C                   Z-ADD     1             XANT
     C                   MOVE      *ZEROS        XANTEU
     C                   EXSR      SUMEUR
     C     XGKN          WHENNE    L42GRU
     C     XLKN          ORNE      L42KN
     C     XGKN          IFEQ      0
     C                   MOVEL     XTXT          XGRUP
     C                   ELSE
     C     GRUPPK        CHAIN     CUNDL01                            33
     C                   MOVE      KNAVN         XGRUP
     C                   END
     C     KUNDEK        CHAIN     CUNDL01                            33
     C                   MOVE      KNAVN         XKUNDE
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C                   MOVE      L42GRU        XGKN
     C                   MOVE      L42KN         XLKN
     C                   Z-ADD     1             XANT
     C                   MOVE      *ZEROS        XANTEU
     C                   EXSR      SUMEUR
     C     XGKN          WHENEQ    L42GRU
     C     XLKN          OREQ      L42KN
     C                   ADD       1             XANT
     C                   EXSR      SUMEUR
     C                   ENDSL
     C                   READ      LLW042                                 94
     C  N94              ENDDO
      *
     C     XANT          IFGT      0
     C     XGKN          IFEQ      0
     C                   MOVEL     XTXT          XGRUP
     C                   ELSE
     C     GRUPPK        CHAIN     CUNDL01                            33
     C                   MOVE      KNAVN         XGRUP
     C                   END
     C     KUNDEK        CHAIN     CUNDL01                            33
     C                   MOVE      KNAVN         XKUNDE
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C                   END
      *
     C     ZRECNO        IFGT      0
     C                   Z-ADD     1             ZRECNO
     C                   END
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
      *
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   EXFMT     NYWRK
     C                   ELSE
     C                   WRITE     BUNN
     C                   EXFMT     SUBCTL
     C                   END
      *
     C   03              GOTO      SLUTT
      *
     C   05              GOTO      START
      *** Finn valg
     C     ZRECNO        IFNE      0
     C                   EXSR      GETOPT
     C                   END
     C                   GOTO      START3
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
     C***********************************************
     C     SUMEUR        BEGSR
     C***********************************************
     C     L42LLT        CHAIN     LLTKF                              33
     C  N33              EVAL      XANTEU = XANTEU + TKOMRF
      *
     C                   ENDSR
      *
     C***********************************************
     C     LESPOS        BEGSR
     C***********************************************
     C     *LOVAL        SETLL     LLAGJS04
     C                   READ      LLAGJS04                               33
     C     *IN33         DOWEQ     '0'
      *
     C     STD           IFNE      *BLANKS
     C     1             DO        5             XN                1 0
     C     SD(XN)        CABEQ     VALOK1        STOPD1
     C                   ENDDO
     C                   GOTO      SLOPD
     C                   END
      *
     C     STOPD1        TAG
     C     LLT           IFNE      *BLANKS
     C     1             DO        5             XN                1 0
     C     LT(XN)        CABEQ     VALLT         STOPD2
     C                   ENDDO
     C                   GOTO      SLOPD
     C                   END
      *
     C     STOPD2        TAG
     C     WSOMRF        IFNE      'B'
     C     VALLT         CHAIN     LLTKF                              33
     C                   SELECT
     C     WSOMRF        WHENEQ    'J'
     C     TKOMRF        CABNE     0             STOPD3
     C     WSOMRF        WHENEQ    'N'
     C     TKOMRF        CABEQ     0             STOPD3
     C                   ENDSL
     C                   GOTO      SLOPD
     C                   END
      *
     C     STOPD3        TAG
     C     LW042K        CHAIN     LLW042                             34
     C     *IN34         IFEQ      '0'
     C                   ADD       1             L42ANT
     C                   UPDATE    LLW042R
     C                   ELSE
     C                   MOVE      VAGRUP        L42GRU
     C                   MOVE      VAKJED        L42KN
     C                   MOVE      VALLOK        L42LOK
     C                   MOVE      VALLT         L42LLT
     C                   Z-ADD     1             L42ANT
     C                   WRITE     LLW042R
     C                   END
     C     SLOPD         TAG
     C                   READ      LLAGJS04                               33
     C  N33              ENDDO
      *
     C                   ENDSR
      *
      ***********************************************
     C     GETOPT        BEGSR
      ***********************************************
     C                   Z-ADD     1             LINNBR
     C                   SETOFF                                       9192
     C                   SETOFF                                       9998
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C     *IN98         CABEQ     '1'           ENDGET
     C     ZRECNO        DIV       17            LINNBR
     C                   MVR                     XLIN              1 0
     C     XLIN          IFEQ      0
     C                   Z-ADD     17            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C     WSNR          IFEQ      '5'
     C                   MOVE      XGKN          UGKN              8
     C                   MOVE      XLKN          ULKN              8
     C                   CALL      'LL042RA'
     C                   PARM                    UGKN
     C                   PARM                    ULKN
     C                   PARM                    XKUNDE
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   ENDIF
     C                   ENDDO
      *
     C     ENDGET        TAG
     C                   ADD       4             LINNBR
     C                   Z-ADD     2             POSNBR
      *
     C                   ENDSR
      *
      ***********************************************
     C     SØKDTA        BEGSR
      ***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
     C     LINNBR        IFEQ      5
     C                   SELECT
     C     POSNBR        WHENGE    24
     C     POSNBR        ANDLE     28
     C                   MOVE      WSSTD1        ULLOK             5
     C     POSNBR        WHENGE    30
     C     POSNBR        ANDLE     34
     C                   MOVE      WSSTD2        ULLOK
     C     POSNBR        WHENGE    36
     C     POSNBR        ANDLE     40
     C                   MOVE      WSSTD3        ULLOK
     C     POSNBR        WHENGE    42
     C     POSNBR        ANDLE     46
     C                   MOVE      WSSTD4        ULLOK
     C     POSNBR        WHENGE    48
     C     POSNBR        ANDLE     52
     C                   MOVE      WSSTD5        ULLOK
     C                   OTHER
     C                   GOTO      SLSØK
     C                   ENDSL
     C                   CALL      'LL006R'
     C                   PARM                    ULLOK
     C                   SELECT
     C     POSNBR        WHENGE    24
     C     POSNBR        ANDLE     28
     C                   MOVE      ULLOK         WSSTD1
     C                   Z-ADD     30            POSNBR
     C     POSNBR        WHENGE    30
     C     POSNBR        ANDLE     34
     C                   MOVE      ULLOK         WSSTD2
     C                   Z-ADD     36            POSNBR
     C     POSNBR        WHENGE    36
     C     POSNBR        ANDLE     40
     C                   MOVE      ULLOK         WSSTD3
     C                   Z-ADD     42            POSNBR
     C     POSNBR        WHENGE    42
     C     POSNBR        ANDLE     46
     C                   MOVE      ULLOK         WSSTD4
     C                   Z-ADD     48            POSNBR
     C     POSNBR        WHENGE    48
     C     POSNBR        ANDLE     52
     C                   MOVE      ULLOK         WSSTD5
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     24            POSNBR
     C                   ENDSL
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      7
     C                   SELECT
     C     POSNBR        WHENGE    24
     C     POSNBR        ANDLE     26
     C                   MOVE      WSLLT1        ULLT              3
     C     POSNBR        WHENGE    30
     C     POSNBR        ANDLE     32
     C                   MOVE      WSLLT2        ULLT
     C     POSNBR        WHENGE    36
     C     POSNBR        ANDLE     38
     C                   MOVE      WSLLT3        ULLT
     C     POSNBR        WHENGE    42
     C     POSNBR        ANDLE     44
     C                   MOVE      WSLLT4        ULLT
     C     POSNBR        WHENGE    48
     C     POSNBR        ANDLE     50
     C                   MOVE      WSLLT5        ULLT
     C                   OTHER
     C                   GOTO      SLSØK
     C                   ENDSL
     C                   CALL      'LL008R'
     C                   PARM                    ULLT
     C                   SELECT
     C     POSNBR        WHENGE    24
     C     POSNBR        ANDLE     26
     C                   MOVE      ULLT          WSLLT1
     C                   Z-ADD     30            POSNBR
     C     POSNBR        WHENGE    30
     C     POSNBR        ANDLE     32
     C                   MOVE      ULLT          WSLLT2
     C                   Z-ADD     36            POSNBR
     C     POSNBR        WHENGE    36
     C     POSNBR        ANDLE     38
     C                   MOVE      ULLT          WSLLT3
     C                   Z-ADD     42            POSNBR
     C     POSNBR        WHENGE    42
     C     POSNBR        ANDLE     44
     C                   MOVE      ULLT          WSLLT4
     C                   Z-ADD     48            POSNBR
     C     POSNBR        WHENGE    48
     C     POSNBR        ANDLE     50
     C                   MOVE      ULLT          WSLLT5
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     24            POSNBR
     C                   ENDSL
     C                   GOTO      SLSØK
     C                   END
      *
     C     SLSØK         ENDSR
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     LW042K        KLIST
     C                   KFLD                    VAGRUP
     C                   KFLD                    VAKJED
     C                   KFLD                    VALLOK
     C     GRUPPK        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    XGKN
     C     KUNDEK        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    XLKN
      *
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
     C                   MOVE      'B'           WSOMRF
     C                   MOVE      *BLANKS       STD
     C                   MOVE      *BLANKS       LLT
      *
     C                   ENDSR
      *
