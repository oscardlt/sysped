********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10154 * 01 SH  PTF10 ikke til fakturering  gebyrkode FEI
      *--------------------------------------------------------------
10154 * 02 SH  PTF11 Faktura annen valuta
XXXXX * 03 SH  PTF12 ikke skrive faktura ved epostmottaker
XXXXX *              setter på 77 hvis ikke skal skrive
XXXXX *              satt N77 på alle write statement merket E03
********************************************************************
      *
      **************************************************************
      *** PROGRAM SOM SKRIVER EN FERJEFAKTURA (FOR EN TRANSPORTØR)**
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER       ***
      *** LEDIGE INDIKATORER 01 02 04 07 09-11 13-24             ***
      *** LEDIGE INDIKATORER 27-29 31    37-39 41-88             ***
      **************************************************************
      * 35 = FULL A4 FOR FAKTURA (GIRO SKRIVES IKKE / ELLER SEPARAT)
      * 70 = INVOICE IN ENGLISH
      * 79 = INVOICE IN GERMAN
      * (N70/N79 = INVOICE IN "HOME-LANGUAGE")
      *
N03  FCUNDC03   IF   E           K DISK
N02  FFERFAKT   IF A E           K DISK
     FBAGIRO    IF   E           K DISK
     FARKTXT    IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FARKIVP    O  A E             DISK
     Ftellfa    UF   E           K DISK
     FKODTFM    IF   E           K DISK
     FLEVEL01   IF   E           K DISK
     FKOSBU     IF   E           K DISK
     F*OSBU8    IF   E           K DISK
     FKOSBU8    UF   E           K DISK
     F                                     RENAME(KOSBUR:KOSB8R)
     FKOSTA     IF   E           K DISK
     FTURER     IF   E           K DISK
     FTURER10   UF   E           K DISK
     F                                     RENAME(TURERR:TUR10R)
     F*URER14   UF   E           K DISK
     FTURER14   IF   E           K DISK
     F                                     RENAME(TURERR:TUR14R)
     FTUFE2     UF   E           K DISK
     FTUFE3     IF   E           K DISK
     F                                     RENAME(TUFER:tufer3)
     FTRAA      IF   E           K DISK
     FTUFET     UF A E           K DISK
     FVALUL01   IF   E           K DISK
     FTRAN      IF   E           K DISK
     FFIRM      IF   E           K DISK
     FMULTKODT  IF   E           K DISK
     FHODE      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FSYTR52PF  O    E             PRINTER
     FSYTR52PG  O    E             PRINTER
     D APR             S              2  0 DIM(19)
     D WAPR            S              2    DIM(19)
     D ASS             S              1  0 DIM(38)
     D WASS            S              1    DIM(38)
     D A21             S              1  0 DIM(19) CTDATA PERRCD(19)
     D                 DS
     D  XBAK                   1      1  0
     D  ABAK                   1      1
     D  XTOTØR                13     14  0
     D  ATOTØR                13     14
     D                 DS
     D  A                      1     11
     D                                     DIM(11)
     D  ATOTKR                 1     11
     D                 DS
     D  WKID                   1     19  0
     D                                     DIM(19)
     D  XWKID                  1     19
     D  YKUNDN                 1      8  0
     D  TEFFNR                 9     15  0
     D  XNULL                 16     19  0
     D                 DS
     D  W1PERC                 1      2  0
     D  W1PERÅ                 3      4  0
     D  W1PERM                 5      6  0
     D  DSW1ÅM                 1      6  0
     D                 DS
     D  fedato                 1      8  0
     D  feccfa                 1      2  0
     D  feaafa                 3      4  0
     D  femnfa                 5      6  0
     D  fedgfa                 7      8  0
     D                 DS
     D  fedaff                 1      8  0
     D  feccff                 1      2  0
     D  feaaff                 3      4  0
     D  femnff                 5      6  0
     D  fedgff                 7      8  0
     D                 DS
     D  TURACC                 1      2  0
     D  TURAAR                 3      4  0
     D  TURMND                 5      6  0
     D  DSTUÅM                 1      6  0
     D                 DS
     D  BUPCC                  1      2  0
     D  BUPÅR                  3      4  0
     D  BUPMN                  5      6  0
     D  DSBUÅM                 1      6  0
     D                 DS
     D  LNAVN                  1     30
     D  LNA20                  1     20
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     D                SDS
     D  WUSER                254    263
     IKUNDR
     I              BANKG                       SYBAGI
     I              POSTG                       SYPOGI
     C                   EXSR      INIT
     C*
     C     W1TNR         IFNE      *ZEROS
     C     UTYPE         IFNE      'K'
     C     UTYPE         ANDNE     'A'
     C                   EXSR      ENTRAN
     C                   else
     C                   exsr      kopisr
     C                   end
     C                   ELSE
     C                   EXSR      ALLE
     C                   END
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C*
     C***********************************************
     C     ALLE          BEGSR
     C***********************************************
     C*
     C     TRANKE        SETLL     TRAN
     C                   READ      TRAN                                   94
     C     *IN94         DOWEQ     '0'
     C     VMTRKU        IFNE      *ZEROS                                       *MÅ HA KNR.
     C     VMINCR        ANDNE     2                                            *IKKE EGNE
     C                   Z-ADD     VMTRAN        W1TNR
     C                   EXSR      ENTRAN
     C                   END
     C*
     C                   SETOFF                                       94
     C                   READ      TRAN                                   94
     C  N94              END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     ENTRAN        BEGSR
     C***********************************************
      *
      * HENTER KUNDEDATA
      *
     C                   EXSR      KUNSR
     C                   EXSR      DETALJ
     C                   EXSR      DIVERS
     C     XTOTAL        IFNE      *ZEROS
     C                   EXSR      TOTAL
     C                   END
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     KOPISR        BEGSR
     C***********************************************
     C*
     C     TUFE3K        chain     TUFE3                              33
     c   33              move      'F'           kopist
     C     TUFE3K        chain     TUFE3                              33
     C  N33              do
     C                   move      fekunr        vmtrku
     c                   move      fedaff        xffdt
     c                   move      feaaff        xffdt
     c                   movel     fedgff        xffdt
     c                   move      fedato        idagx
     c                   move      feaafa        idagx
     c                   movel     fedgfa        idagx
     c                   move      FEÅR          W1PERÅ
     c                   move      FEMND         W1PERM
     C                   z-add     kopfak        XFN               7 0
     C                   z-add     kopfak        TEFFNR
     C                   EXSR      KUNSR
N02  C     XFN           chain     FERFAKT                            33
N02  C  N33              move      FERVAL        XVAL
N02   * henter kundedata
      * henter fakturalinjer kopiutskrift
     C                   EXSR      ferryk
     C                   EXSR      DIVERS
     C     XTOTAL        IFNE      *ZEROS
     C                   EXSR      TOTAL
     C                   END
     C                   END
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     DETALJ        BEGSR
     C***********************************************
     C* RESETT VERDIER FRA FOREGÅENDE FAKTURA
     C                   SETOFF                                       9798
     C                   MOVE      *ZEROS        XFN
     C                   MOVE      *ZEROS        XTOTAL
     C*------------------------------------------------------*
     C*                                                      *
     C*     FOR ALLE TURER MED TRANSPORTØREN I PERIODEN....  *
     C*                                                      *
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""*
     C*
     C     TUR10K        SETLL     TURER10
     C                   SETON                                        30
     C                   SETOFF                                       33
     C*
     C     TUTAG1        TAG
     C                   READ      TURER10                                33
     C  N33DSTUÅM        COMP      DSW1ÅM                             33
     C  N33TUKNT2        COMP      W1TNR                              33
     C  N33TUTST5        COMP      ' '                                33        *AVREGNET
     C*
     C* FUNNET TUR SOM SKAL MED I AVREGNING -
     C  N33              DO
     C                   EXSR      FERRY
     C  N99UTYPE         IFEQ      ' '
     C                   MOVE      'X'           TUTST5
     C                   END
     C  N99              UPDATE    TUR10R
     C* FLERE TURER TIL AVREGNING???
     C                   SETOFF                                       33
     C                   GOTO      TUTAG1
     C                   END
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     DIVERS        BEGSR
     C***********************************************
     C*
     C*------------------------------------------------------*
     C*                                                      *
     C*    "DIVERSEFERJER" ER SAMLET UNDER DUMMY TURNR:      *
     C*    AVD : 0000/ TURNR: XXXXXXXX  (= TRANPORTØRNR)     *
     C*""""""""""""""""""""""""""""""""""""""""""""""""""""""*
     C* 98 ON- INDIKERER AT TUR/RUNDTURSNR IKKE SKRIVES PÅ FERJEFAKT
     C                   SETON                                        98
     C*
     C     TURERK        CHAIN     TURER                              33
     C  N33              MOVE      ' '           TUTST5                         *SKAL ALLTID
     C  N33              Z-ADD     1             TURMND                          MEDTAS
     C  N33              Z-ADD     1             TURAAR
     C  N33              Z-ADD     19            TURACC
     C  N33              EXSR      FERRY
     C* STATUS FOR FERJEAVREGNING OPPDATERES ALDRI PÅ "DIVERSETUR"
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     FERRY         BEGSR
     C***********************************************
     C* 99 ON VED UTGANG AV "FERRY" - KAN IKKE SETTE "X" I AVR.STATUS
     C                   SETOFF                                       99
     C     TUFE2K        SETLL     TUFE2
     C                   SETOFF                                       34
     C*
     C     FE1TAG        TAG
     C     TUFE2K        READE     TUFE2                                  34
     C* HENT OPP DATA FRA BUSDSJETT/REKV (ER KOSTNAD ATTESTERT??)
     C  N34FETREF        CHAIN     KOSBU                              32        *FINNES IKKE
      *
      * rekvisisjon som ikke skal faktureres
      *
N01  C  N34
N01  CANN32BUVK          IFEQ      'FEI'
N01  C                   GOTO      FE1TAG
N01  C                   END
      *
     C* DIVERSE FERJER UTENOM TUR - PERIODISERING FRA KOSBU (LES ALLE)
     C  N34
     CANN32TUAVD         IFEQ      *ZEROS
     C     DSBUÅM        ANDGT     DSW1ÅM
     C                   GOTO      FE1TAG
     C                   END
     C  N34
     CANN32BUST          COMP      'F'                                3232      *32 OFF ->FØRT
     C* 99 ON - KAN IKKE SETTE "X" I FERJEAVR.STATUS PÅ TURNIVÅ
     C*         FORDI MINST EN KOSTN. VAR IKKE ATTESTERT/FANTES IKKE
     C  N34
     CAN 32              SETON                                        99
     C  N34
     CAN 32              GOTO      FE1TAG
     C*
     C*
     C* FUNNET EN FERJE SOM SKAL MED PÅ FAKTURAEN
     C  N34              DO
     C* DESOM DETTE ER FØRSTE LINJE - HENT FAKTNR. SKRIV HEADING
     C  N97              EXSR      HODESR
     C*
     C* NEXT PAGE ??
     C*
     C                   ADD       3             XANTL
     C                   EXSR      NEWPAG
     C   88              ADD       2             XANTL
     C* RABATT/PÅSLAG I FORHOLD TIL SALGSPRIS I FERJEREGISTER?
      * AVTALE LIGGER I TRAA - BUNDET TIL TRANSP/FERGE/FRA/TIL/DATO
      * ANTAR AT DATO ER GYLDIG FRA OG MED .....
      *
     C     TRAAK1        KLIST
     C                   KFLD                    W1TNR
     C                   KFLD                    FEFIRM
     C                   KFLD                    FEFROM
     C                   KFLD                    FETO
     C                   KFLD                    FEDAT2
     C     TRAAK2        KLIST
     C                   KFLD                    W1TNR
     C                   KFLD                    FEFIRM
     C                   KFLD                    FEFROM
     C                   KFLD                    FETO
      *
      *
     C     TRAAK1        SETGT     TRAA
     C     TRAAK2        READPE    TRAA                                   36
     C   36              Z-ADD     1             RABFAK            7 4
     C  N36TRPRO         DIV(H)    100           RABFAK
      *
     C     FEPRI2        MULT(H)   RABFAK        XPFNOK           13 2
      *
      *
     C                   Z-ADD     XPFNOK        XEPRI2
      *
     C*
     C* VALUTAOMREGNING?
     C*
     C     FECURR        IFNE      FICURR
     C                   MOVE      FECURR        VALKOD
     C                   EXSR      VALUT
     C                   END
     C                   EXSR      DECI
s02  C*                  ADD       XPFNOK        XTOTAL           13 2
     C* OPPDATER STAUS MM.
     C     UTYPE         IFEQ      ' '
     C                   MOVE      YKUNDN        FEKUNR
     C                   MOVE      XFN           FEFAKT
     C                   MOVE      'F'           FEOPKO
     C                   MOVE      W1PERM        FEMND
     C                   MOVE      W1PERÅ        FEÅR
     C                   MOVE      W1PERC        FECC
     C                   MOVE      IDAG          FEDATO
     C                   MOVE      XFFDT         UFFDT             6 0
     C                   CALL      'DATFM5'
     C                   PARM                    FIDTFM
     C                   PARM                    UFFDT
     C     UFFDT         IFEQ      0
     C                   MOVE      *ZEROS        FEDAFF
     C                   ELSE
     C     UFFDT         IFGT      501231
     C     UFFDT         ADD       19000000      FEDAFF
     C                   ELSE
     C     UFFDT         ADD       20000000      FEDAFF
     C                   END
     C                   END
     C                   MOVE      *ZEROS        FEJOUR
     C                   Z-ADD     XPFNOK        FEPRIN
     C                   END
     C                   UPDATE    TUFER
     C* HENT DIV. INFO FOR UTSKRIFTEN
     C     LEVE1K        CHAIN     LEVEL01                            32
     C   32              MOVE      *BLANKS       LNAVN
     C     BUBNR2        CHAIN     KOSTA                              32
     C   32              MOVE      *BLANKS       KAFNR
     C* SKRIV DETALJLINJE
     c                   exsr      omregn
E03  C  N77              WRITE     DET
E03  C  N77              WRITE     DET2
E03  C  N77              WRITE     DET3
     C* TILLEGSKOSTN (SLAVELINJER)KNYTTET TIL DENNE FERJE??
     C     BUBNR3        IFEQ      9999999
     C                   EXSR      SLAVE
     C                   END
     C* FLERE FERGER PÅ DENNE TUREN SOM SKAL MED I AVREGNING ??
     C                   GOTO      FE1TAG
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     FERRYK        BEGSR
     C***********************************************
      * henter fakturalinjer ved kopi
     C*
     C                   SETOFF                                       99
E03  C  N77              WRITE     KJØP
     C                   Z-ADD     1             XSIDE
     C                   SETON                                        97
     C     TUFE3K        SETLL     TUFE3
     C                   SETOFF                                       34
     C*
     C     nesteli       TAG
      *
     C     TUFE3K        READE     TUFE3                                  34
      *
     C     *in(34)       ifeq      '0'
      *
     C*
     C     FETUR         CHAIN     TURER14                            98
     C     FETREF        CHAIN     KOSBU                              32        *FINNES IKKE
      *
     C* DESOM DETTE ER FØRSTE LINJE - HENT FAKTNR. SKRIV HEADING
      *
     C*
     C* NEXT PAGE ??
     C*
     C                   ADD       3             XANTL
     C                   EXSR      NEWPAG
     C   88              ADD       2             XANTL
      *
      * eventuell omregning av beløp
      *
     C                   z-add     feprin        XPFNOK           13 2
      *
     C                   Z-ADD     fepri2        XEPRI2
      *
     C*
      *
     C                   EXSR      DECI
s04  C*                  ADD       XPFNOK        XTOTAL           13 2
     C*
     C* HENT DIV. INFO FOR UTSKRIFTEN
     C     LEVE1K        CHAIN     LEVEL01                            32
     C   32              MOVE      *BLANKS       LNAVN
     C     BUBNR2        CHAIN     KOSTA                              32
     C   32              MOVE      *BLANKS       KAFNR
     C* SKRIV DETALJLINJE
      *
      *omregn beløp
      *
N02  c                   exsr      omregn
E03  C  N77              WRITE     DET
E03  C  N77              WRITE     DET2
E03  C  N77              WRITE     DET3
     C* TILLEGSKOSTN (SLAVELINJER)KNYTTET TIL DENNE FERJE??
     C     BUBNR3        IFEQ      9999999
     C                   EXSR      SLAVE
     C                   END
      *
      * neste linje
      *
     C                   GOTO      nesteli
     C                   END
     C*
     C                   ENDSR
     C***********************************************
     C     SLAVE         BEGSR
     C***********************************************
      *
      * tester om ulike linjenr  kun ved originalkjøring
      * Har ikke klart å finne årsak til denne feil andre steder
      *
     C     UTYPE         IFEQ      ' '
     C                   EXSR      slave0
     c                   end
     C                   SETOFF                                       94
     C* FETREF ER PEKER FRA TUFE TIL BUDEDBILAG
     C                   MOVE      FETREF        BUBNR3
     C                   MOVE      *ZEROS        BULNR3
     C     KOSB8K        SETLL     KOSBU8
     C*
     C     FETREF        READE(N)  KOSBU8                                 94
     C     *IN94         DOWEQ     '0'
     C     BUST          IFNE      'S'
     C                   ADD       1             XANTL
     C                   EXSR      NEWPAG
     C                   Z-ADD(H)  BUBL          XPFNOK           13 2
     C* VALUTAOMREGNING?
     C     BUVAL         IFNE      FICURR
     C                   MOVE      BUVAL         VALKOD
     C                   EXSR      VALUT
     C                   END
      * KOPI / PRØVE
     C     utype         ifeq      'K'
     C     utype         oreq      'A'
     C     KOSB8K        chain     tufet                              32
     C                   Z-ADD     fetprn        XPFNOK           13 2
      * eventuell omregning
     C                   end
     C                   EXSR      DECI
s02  C*                  ADD       XPFNOK        XTOTAL           13 2
N02  c                   exsr      omregn
E03  C  N77              WRITE     DET4
     C*LEGG UT I EGET REGISTER NÅR FAKTURA KJØRT
      *
      * oppdaterer kun ved originalkjøring
      *
     C     UTYPE         IFEQ      ' '
     C     KOSB8K        CHAIN     TUFET                              32
     C                   MOVE      BUVAL         FETVAL
     C                   MOVE      BUBL          FETPR2
     C                   Z-ADD     XPFNOK        FETPRN
     C   32              MOVE      BUBNR3        FETBN3
     C   32              MOVE      BULNR3        FETLN3
     C   32              MOVE      BUBNR         FETBNR
     C  N32              UPDATE    TUFETR
     C   32              WRITE     TUFETR
     C                   END
     C                   END
     C*
     C     FETREF        READE(N)  KOSBU8                                 94
     C  N94              END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     SLAVE0        BEGSR
     C***********************************************
      *
      * tester om ulike linenr /  kun ved originalkjøring
      *
      *
     C                   SETOFF                                       94
     C* FETREF ER PEKER FRA TUFE TIL BUDEDBILAG
     C                   MOVE      FETREF        BUBNR3
     C                   MOVE      *ZEROS        BULNR3
     C                   MOVE      *ZEROS        SISTN3
     C     KOSB8K        SETLL     KOSBU8
     C*
     C     *IN94         DOWEQ     '0'
     C     FETREF        READE(N)  KOSBU8                                 94
     C     *IN94         ifeq      '0'
     C     BULNR3        ifeq      sistn3
     C                   EXSR      SLAVEF
     C                   GOTO      UTSL0
     C                   endif
     C                   MOVE      BULNR3        SISTN3            2 0
     C                   endif
     C                   enddo
     C     UTSL0         endsr
     C*
     C***********************************************
     C     SLAVEF        BEGSR
     C***********************************************
      * KALLES HVIS FEIL
      * tester om ulike linenr /  SETTER ALLE LINJER TIL 99
      *
     C                   SETOFF                                       94
     C* FETREF ER PEKER FRA TUFE TIL BUDEDBILAG
     C                   MOVE      FETREF        BUBNR3
     C                   MOVE      *ZEROS        BULNR3
     C     KOSB8K        SETLL     KOSBU8
     C*
     C     *IN94         DOWEQ     '0'
     C     FETREF        READE     KOSBU8                                 94
     C     *IN94         ifeq      '0'
     C                   Z-ADD     99            BULNR3
     C                   UPDATE    KOSB8R
     C                   endif
     C                   enddo
     C*
      *
     C                   SETOFF                                       94
     C                   Z-ADD     1             LINR              2 0
     C* FETREF LESER ALLE MED 99 I LINJENUMMER
     C     KOSB8K99      SETLL     KOSBU8
     C*
     C     *IN94         DOWEQ     '0'
     C     KOSB8K99      READE     KOSBU8                                 94
     C     *IN94         ifeq      '0'
     C                   Z-ADD     LINR          BULNR3
     C                   UPDATE    KOSB8R
     C                   ADD       1             LINR
     C                   endif
     C                   enddo
     C                   endsr
     C***********************************************
     C     TOTAL         BEGSR
     C***********************************************
     C                   Z-ADD     XTOTAL        XBRUTT           13 2
     C                   MOVEL     XBRUTT        XTOTKR
     C                   MOVE      XBRUTT        XTOTØR
     C*
     C* BUNNTOTAL PÅ FAKTURA + EVT 3 LINJER FASTE TEKSTER
     C     uowawb        ifNE      'K'
N03  C     *in77         ifeq      '0'
     C  N35              WRITE     TOTB
     C   35              WRITE     TOTC
     C                   ELSE
     C                   WRITE     TOTC
     C                   END
N03  C                   END
      *
      * blankett med KID i bunn
      *
     C     uowawb        ifeq      'K'
     C                   exsr      KIDGIR
     C                   GOTO      ENDGIR
     c                   end
     C*
     C*  GIRO TO BE PRINTED ??
     C*
     C     UOWBBS        IFNE      'N'                                          1<-B
     C     UOWAWB        IFNE      'J'                                           2<-B
     C                   EXSR      KDTFM1
E03  C  N77              WRITE     BGIR
     C                   EXSR      KDTFM1
     C                   EXSR      MOD10
     C     UOWBBS        IFEQ      'A'                                            3<-B
E03  C  N77              WRITE     BGIR2A
     C                   ELSE                                                     3
     C     UOWBBS        IFEQ      'B'                                             4<-B
      * FIX Z-SUPRESS FOR ALFA-FILED
     C                   MOVE      XTOTKR        ATOTKR
     C     1             DO        10            AX                2 0              5<-B
     C     A(AX)         IFEQ      '0'                                               6<-B
     C                   MOVE      ' '           A(AX)
     C                   ELSE                                                        6
     C                   GOTO      BGIRT
     C                   END                                                         6<-E
     C                   END                                                        5<-E
     C     BGIRT         TAG
      *
E03  C  N77              WRITE     BGIR2B
     C                   ELSE                                                      4
     C     UOWBBS        IFEQ      'C'                                              5<-B
E03  C  N77              WRITE     BGIR2C
     C                   ELSE                                                       5
     C     UOWBBS        IFEQ      'D'                                               6<-B
E03  C  N77              WRITE     BGIR2D
     C                   ELSE                                                        6<-B
     C     UOWBBS        IFEQ      'E'                                                7<-B
      * FIX Z-SUPRESS FOR ALFA-FILED
     C                   MOVE      XTOTKR        ATOTKR
     C     1             DO        10            AX                2 0                 8<-B
     C     A(AX)         IFEQ      '0'                                                  9<-B
     C                   MOVE      ' '           A(AX)
     C                   ELSE                                                           9
     C                   GOTO      BGIRE
     C                   END                                                            9<-E
     C                   END                                                           8<-E
     C     BGIRE         TAG
      *
E03  C  N77              WRITE     BGIR2E
     C                   ELSE                                                         7
E03  C  N77              WRITE     BGIR3
     C                   END                                                          7<-E
     C                   END                                                         6<-E
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C* WHEN SPLIT INVOICE/GIRO
     C                   ELSE                                                    2<-E
     C     YBETMA        IFEQ      'B'                                            3
     C     UTYPE         ANDEQ     ' '                                          IKKE V/TEST
     C                   EXSR      DELTG
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C*
     C     endgir        ENDSR
     C*
     C***********************************************
     C     DELTG         BEGSR
     C***********************************************
     C                   EXSR      KDTFM1
E03  C  N77              WRITE     SGIR
     C                   EXSR      KDTFM1
     C                   EXSR      MOD10
     C     UOWBBS        IFEQ      'A'
E03  C  N77              WRITE     SGIR2A
     C                   ELSE
     C     UOWBBS        IFEQ      'B'
      * FIX Z-SUPRESS FOR ALFA-FILED
     C                   MOVE      XTOTKR        ATOTKR
     C     1             DO        10            AX                2 0
     C     A(AX)         IFEQ      '0'
     C                   MOVE      ' '           A(AX)
     C                   ELSE
     C                   GOTO      SGIRT
     C                   END
     C                   END
     C     SGIRT         TAG
      *
E03  C  N77              WRITE     SGIR2B
     C                   ELSE
     C     UOWBBS        IFEQ      'C'
E03  C  N77              WRITE     SGIR2C
     C                   ELSE
     C     UOWBBS        IFEQ      'D'
E03  C  N77              WRITE     SGIR2D
     C                   ELSE
     C     UOWBBS        IFEQ      'E'
      * FIX Z-SUPRESS FOR ALFA-FILED
     C                   MOVE      XTOTKR        ATOTKR
     C     1             DO        10            AX                2 0
     C     A(AX)         IFEQ      '0'
     C                   MOVE      ' '           A(AX)
     C                   ELSE
     C                   GOTO      SGIRE
     C                   END
     C                   END
     C     SGIRE         TAG
      *
E03  C  N77              WRITE     SGIR2E
     C                   ELSE
E03  C  N77              WRITE     SGIR3
     C                   END
     C                   END
     C                   END
     C                   END
     C                   END
     C                   ENDSR
     C*
     C****************************************************************    D150
     C*       MOD10     -    UTREGNING AV MOD-10 KONTROLLFELT (WBAK)      D150
     C*---------------------------------------------------------------    D150
     C     MOD10         BEGSR                                                                 D150
     C     A21           MULT      WKID          APR                                           D150
     C                   MOVE      APR           WAPR                                          D150
     C                   MOVEA     WAPR          WASS                                          D150
     C                   MOVE      WASS          ASS                                           D150
     C                   XFOOT     ASS           XBAK                                          D150
     C     10            SUB       XBAK          XBAK              1 0                         D150
     C*                                                                   D150
     C                   ENDSR                                                                 D150
     C*
     C*
     C***********************************************
     C     NEWPAG        BEGSR
     C***********************************************
     C  N35XANTL         COMP      21                                 88  88
     C   35XANTL         COMP      41                                 88  88
     C     uowawb        ifeq      'K'
     C     XANTL         COMP      43                                 88  88
     c                   end
     C   88              DO
     C                   MOVE      *ZEROS        XANTL
     C                   ADD       1             XSIDE
E03  C  N77              WRITE     KJØP1
     C                   EXSR      KDTFM1
E03  C  N77              WRITE     KJØP
     C                   EXSR      KDTFM1
     C                   END
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     DECI          BEGSR
     C***********************************************
     C* TEST FIRMS NUMBER OF DECIMALS
     C*
     C* NO DECIMALS
     C     FIDECI        IFEQ      0
     C                   Z-ADD(H)  XPFNOK        FABEL0           11 0
     C                   Z-ADD     FABEL0        XPFNOK
     C                   ELSE
     C* 1 DECIMAL
     C     FIDECI        IFEQ      1
     C                   Z-ADD(H)  XPFNOK        FABEL1           12 1
     C                   Z-ADD     FABEL1        XPFNOK
     C                   END
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
N02  C     DECIPRI       BEGSR
N02  C***********************************************
N02  C* TEST FIRMS NUMBER OF DECIMALS
N02  C*
N02  C* NO DECIMALS
N02  C     FIDECI        IFEQ      0
N02  C                   Z-ADD(H)  XPFNOK        FABEL0           11 0
N02  C                   Z-ADD     FABEL0        XPFNOK
N02  C                   ELSE
N02  C* 1 DECIMAL
N02  C     FIDECI        IFEQ      1
N02  C                   Z-ADD(H)  XPFNOK        FABEL1           12 1
N02  C                   Z-ADD     FABEL1        XPFNOK
N02  C                   END
N02  C                   END
N02  C*
N02  C                   ENDSR
N02  C*
     C***********************************************
     C     HODESR        BEGSR
     C***********************************************
N03   * skjekk om epostmottager
N03  c                   setoff                                       77
     C                   move      'J'           cprint
N03  C     UTYPE         IFne      'K'
N03  C     UTYPE         andne     'C'
N03  C     UTYPE         andne     'A'
N03  C     UTYPE         andne     'T'
N03  C     CUNDC03K      CHAIN     CUNDC03                            88
N03  C  N88CPRINT        COMP      'N'                                    77
N03  C                   end
     C* UTYPE ' ' = ORDINÆR MED OPPDAT / 'T' = TEST
     C     UTYPE         IFEQ      ' '
     C     FIFIRM        CHAIN     tellfar                            32
n02  c     *in32         ifeq      '0'
     C                   MOVE      FIFNR         XFN
     C                   MOVE      FIFNR         TEFFNR
     C                   ADD       1             FIFNR
     C                   UPDATE    tellfar
N02  C     xval          ifne      ficurr
n02  c     valu1k2       chain     valul01                            32
N02  C                   z-add     teffnr        ferfak
n02  c                   move      xval          ferval
n02  c                   move      omrfak        feromr
n02  c                   move      valku1        ferkur
n02  c                   write     ferfaktr
n02  c                   end
n02  c                   end
     C                   exsr      arkivsr
     C                   END
n02  C     UTYPE         IFEQ      'T'
N02  C     xval          andne     ficurr
n02  c     valu1k2       chain     valul01                            32
n02  c                   move      xval          ferval
n02  c                   move      omrfak        feromr
n02  c                   move      valku1        ferkur
n02  c                   end
     C                   EXSR      KDTFM1
E03  C  N77              WRITE     KJØP
     C                   EXSR      KDTFM1
     C                   MOVE      *ZEROS        XANTL
     C                   Z-ADD     1             XSIDE
     C                   SETON                                        97
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     VALUT         BEGSR
     C***********************************************
     C*
     C     VALU1K        CHAIN     VALUL01                            39
     C  N39              DO
     C     VALKU2        IFNE      0
     C                   MOVE      VALKU2        VALKU1
     C                   END
     C     XPFNOK        MULT      VALKU1        XWORK            15 4
     C     XWORK         DIV(H)    OMRFAK        XPFNOK
     C                   END
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     BETSR         BEGSR
     C***********************************************
     C* KUNDENS LANDKODE
     C                   MOVE      *BLANKS       KLKNVN
     C     LKKEY         CHAIN     KODTLKR                            33
     C*
     C*** FINNER BETBET OG FORFALLSDATO
     C     UTYPE         IFEQ      'K'
     C     UTYPE         OREQ      'C'
     C     UTYPE         OREQ      'A'
     C                   MOVE      XFFDT         FFKOPI            6 0
     C                   END
     C                   MOVE      *ZEROS        XFFDT
     C                   MOVE      *BLANKS       BETTXT           30
     C                   CALL      'SYFA20A'
     C                   PARM                    XFFDT
     C                   PARM                    BETTXT
     C                   PARM                    FIFIRM
     C                   PARM                    BETBET
     C*
     C     UTYPE         IFEQ      'K'
     C     UTYPE         OREQ      'C'
     C     UTYPE         OREQ      'A'
     C                   MOVE      FFKOPI        XFFDT             6 0
     C                   END
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFM1        BEGSR
     C***********************************************
     C                   MOVE      IDAGX         XKDTFM            4 0
     C                   MOVEL     IDAGX         UDT1              2 0
     C                   MOVEL     XKDTFM        UDT2              2 0
     C                   MOVE      XKDTFM        UDT3              2 0
     C                   EXSR      KDTFMT
     C                   MOVEL     UDT1          IDAGX
     C                   MOVEL     UDT2          XKDTFM
     C                   MOVE      UDT3          XKDTFM
     C                   MOVE      XKDTFM        IDAGX
     C*
     C                   MOVE      XFFDT         XKDTFM
     C                   MOVEL     XFFDT         UDT1
     C                   MOVEL     XKDTFM        UDT2
     C                   MOVE      XKDTFM        UDT3
     C                   EXSR      KDTFMT
     C                   MOVEL     UDT1          XFFDT
     C                   MOVEL     UDT2          XKDTFM
     C                   MOVE      UDT3          XKDTFM
     C                   MOVE      XKDTFM        XFFDT
     C                   ENDSR
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C*
     C                   ENDSR
     C*
     C*
     C********************************************************************
     C     AVDSR         BEGSR
     C******************************************
     C* HENTER KUNDEINFORMASJON FOR AVDELINGEN (TIL GIRO)
     C*
     C     KODTAK        CHAIN     KOAR                               33
     C                   MOVE      KOAKNR        YKN
     C     KUND1K        CHAIN     CUNDL01                            33
     C  N33              DO
     C                   MOVE      KNAVN         XFNAVN           30
     C                   MOVE      ADR1          XFADR1           30
     C                   MOVE      ADR2          XFADR2           30
     C                   MOVE      POSTNR        XFPONR            4 0
     C                   MOVE      ADR3          XFADR3           24
     C                   MOVEL     BANKG         XFBANK           15
     C                   END
     C*
     C                   ENDSR
     C********************************************************************
     C     KUNSR         BEGSR
     C******************************************
     C* HENTER KUNDEINFORMASJON FOR AKTUELL TRANSPORTØR
     C*
     C                   MOVE      VMTRKU        YKN
     C     KUND1K        CHAIN     CUNDL01                            33
N02  c                   move      uvaluta       xval
n02  c     xval          ifeq      *blanks
n02  c                   move      valkod        xval
n02  c                   end
n02  c     xval          ifeq      *blanks
n02  c                   move      ficurr        xval
n02  c                   end
     C                   MOVE      BETMAT        YBETMA            1
     C                   MOVE      KUNDNR        YKUNDN            8 0
     C                   MOVE      KNAVN         YNAVN            30
     C                   MOVE      ADR1          YADR1            30
     C                   MOVE      ADR2          YADR2            30
     C* KOMPONER SISTE ADRESSELINJE UTFRA GITT POSTNR/LANGT POSTNR...
     C                   MOVE      *BLANKS       YADR3            35
     C     POSTNR        COMP      0                                      37
     C     SYPOGE        COMP      *BLANKS                                38
     C  N37              MOVEL     POSTNR        YADR3                          *NORSK
     C  N37              MOVEL     ADR3          YADR32           30              POSTNR
     C  N37              MOVE      YADR32        YADR3
     C   37
     CANN38              MOVEL     SYPOGE        YADR3                          *UTENLANDSK
     C   37
     CANN38              MOVE      ADR3          YADR3                            POSTNR
     C   37
     CAN 38              MOVEL     ADR3          YADR3                          *IKKE POSTNR
     C     SPRAAK        COMP      'E'                                    70
     C     SPRAAK        COMP      'T'                                    79
     C     UOWHOD        IFEQ      'J'
     C                   SETON                                        4446
     C                   ELSE
     C     UOWHOD        IFEQ      'T'
     C                   SETOFF                                       44
     C                   SETON                                        46
     C                   ELSE
     C     UOWHOD        IFEQ      'B'
     C                   SETON                                        44
     C                   SETOFF                                       46
     C                   END
     C                   END
     C                   END
     C   44
     COR 46HODEK         CHAIN     HODE                               33
     C*
     C                   EXSR      BETSR
     C*
     C                   SETOFF                                       33
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UUAVD             4            *ALPHA
     C                   PARM                    USG               3            *SIGN
     C                   PARM                    UOWHOD            1            *HODE-FAKTURA
     C                   PARM                    UOWBBS            1            *BBS -FAKTURA
     C                   PARM                    UOWAWB            1            *GIRO SEPARAA
     C* TIL SLUTT LEGGES PARAMETRE SOM SKILLER SEG FRA PROG TIL PROG.
     C                   PARM                    UUTNR             8            *TRANSP
     C                   PARM                    UUPERÅ            2            *PERIODEÅR
     C                   PARM                    UUPERM            2            *PERIODEMND
     C                   PARM                    UTYPE             1            *T=TEST
N02  C                   PARM                    UVALUTA           3            valkod
N03  C     CUNDC03K      KLIST
N03  C                   KFLD                    FIFIRM
N03  C                   KFLD                    XCTYPE           30
N03  C                   KFLD                    YKN
N03  C                   EVAL      XCTYPE = '*FERJEFAKTURA'
     C**
     C     UUAVD         IFGT      '0000'
     C     UUAVD         ANDLE     '9999'
     C                   MOVE      UUAVD         KOAAVD                         *NUMERIC
     C                   ELSE
     C                   MOVE      *ZEROS        KOAAVD
     C                   END
     C     UUTNR         IFGE      '00000000'
     C     UUTNR         ANDLE     '99999999'
     C                   MOVE      UUTNR         W1TNR             8 0          *NUMERIC
     C                   ELSE
     C                   MOVE      99999999      W1TNR
     C                   END
     C     UUPERÅ        IFGT      '00'
     C     UUPERÅ        ANDLE     '99'
     C                   MOVE      UUPERÅ        W1PERÅ            2 0          *NUMERIC
     C                   ELSE
     C                   MOVE      *ZEROS        W1PERÅ
     C                   END
     C     UUPERM        IFGT      '00'
     C     UUPERM        ANDLE     '99'
     C                   MOVE      UUPERM        W1PERM            2 0          *NUMERIC
     C                   ELSE
     C                   MOVE      *ZEROS        W1PERM
     C                   END
     C     W1PERM        IFEQ      0
     C                   MOVE      *ZEROS        W1PERC
     C                   ELSE
     C     W1PERÅ        IFGT      50
     C                   MOVE      19            W1PERC
     C                   ELSE
     C                   MOVE      20            W1PERC
     C                   END
     C                   END
     C     *LIKE         DEFINE    BUBNR3        YYBNR
     C     *LIKE         DEFINE    BULNR3        YYLNR
     C* KUNDEKEY
     C     KUND1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    YKN               8 0
     C* LEVEKEY (FERJESELSKAP)
     C     LEVE1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    FEFIRM
     C* KUNDES LANDKODE
     C     LKKEY         KLIST
     C                   KFLD                    YLKUNI
     C                   KFLD                    SYLAND
     C* VALUTAFIL
     C     VALU1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    VALKOD
n02  C* VALUTAFIL
n02  C     VALU1K2       KLIST
n02  C                   KFLD                    FIFIRM
n02  C                   KFLD                    XVAL
     C     KODGEK        KLIST
     C                   KFLD                    YGEUNI
     C                   KFLD                    BUVK
     C     KODTAK        KLIST
     C                   KFLD                    YAUNI
     C                   KFLD                    KOAAVD
     C     TUR10K        KLIST
     C                   KFLD                    YYST
     C                   KFLD                    W1TNR
     C     KODTPK        KLIST
     C                   KFLD                    KOPUNI
     C                   KFLD                    KOAAVD
     C                   KFLD                    KOPLNR
     C                   MOVE      'P'           KOPUNI
      *
     C     TURERK        KLIST
     C                   KFLD                    YYAVD
     C                   KFLD                    W1TNR
     C* FERJEOVERFARTER PÅ TUR - KUN MED STATUS ' '
     C*    DATO MÅ VARE MED FOR "DIVERSEFERJER"  (AVD 0 + TRANSP.NR)
     C     TUFE2K        KLIST
     C                   KFLD                    YYST
     C                   KFLD                    TUAVD
     C                   KFLD                    TUPRO
     C* FERJEfaktura kopi
     C*
     C     TUFE3K        KLIST
     C                   KFLD                    kopist            1
     C                   KFLD                    kopfak            7 0
     c                   move      'O'           kopist
     c                   move      uutnr         kopfak
     C* KEY FOR "SALVELINJER" (TILLEGG) I KOSBU/EGET REGISTER TUFET
     C     KOSB8K        KLIST
     C                   KFLD                    BUBNR3
     C                   KFLD                    BULNR3
     C     KOSB8K99      KLIST
     C                   KFLD                    BUBNR3
     C                   KFLD                    BUL99
     C     *LIKE         DEFINE    BULNR3        BUL99
     C                   Z-ADD     99            BUL99
     C     TRANKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    W1TNR
     C     HODEK         KLIST
     C                   KFLD                    SPRAAK
     C                   KFLD                    KOAAVD
     C*
     C                   MOVE      'GE'          YGEUNI            2
     C                   MOVE      ' '           YYKDM             1
     C                   MOVEL     'LK'          YLKUNI            3
     C                   MOVE      'A'           YAUNI             1
     C                   MOVE      *ZEROS        XANTL             2 0
     C                   MOVE      *ZEROS        XNULL
     C                   MOVE      *ZEROS        YKUNDN
     C                   MOVE      *ZEROS        TEFFNR
     C                   MOVE      ' '           YYST              1
     C                   MOVE      *ZEROS        YYAVD             4 0
     C*
     C     UYEAR         IFGT      50
     C     UYEAR         ADD       1900          IDAG
     C                   ELSE
     C     UYEAR         ADD       2000          IDAG
     C                   END
     C                   MULT      10000         IDAG
     C                   MOVEL     UMONTH        IDMMDD            4 0
     C                   MOVE      UDAY          IDMMDD
     C                   MOVE      IDMMDD        IDAG              8 0
     C                   MOVE      UYEAR         IDMMDD
     C                   MOVE      IDMMDD        IDAGX
     C                   MOVEL     UDAY          IDAGX
     C                   MOVEL     '2BD10601'    XW77             16
     C                   MOVE      '00000154'    XW77
     C                   MOVEL     '2BD10601'    XW66             16
     C                   MOVE      '00000277'    XW66
     C*
     C* TESTS IF GIRO SHALL BE WRITTEN INDICATOR 35
     C* ALSO WHEN SPLIT IS DEFINED
     C     UOWBBS        COMP      'N'                                    35    *IKKE GIRO
     C  N35UOWAWB        COMP      'J'                                    35    *DEL FAK/GIR
     C* 35 ON?- HELE A4-SIDEN TILGJENGELIG FOR UTSKRIFT AV FAKTURA
     C                   READ      FIRM                                   33
     C*
     C* AVDELINGENS KUNDENR FOR NAVN/GIRONR
     C                   EXSR      AVDSR
     C*
     C* TRANSPORTØRENS KUNDENR VED KUN EN (VED ALLE:READ I SR "ALLE")
     C     W1TNR         IFNE      *ZEROS
     C     UTYPE         ANDNE     'K'
     C     UTYPE         ANDNE     'C'
     C     UTYPE         ANDNE     'A'
     C     TRANKE        CHAIN     TRAN                               33
     C                   END
     C* TEST ?
     C     UTYPE         COMP      'T'                                    96
     C*
s02  C*                  MOVE      FICURR        XVAL              3
     C*
     C     UTYPE         ifne      'A'
     c                   exsr      string
     c                   end
     C                   ENDSR
     C*
     C*******************************************************
     C     STRING        BEGSR
     C*******************************************************
      *
      * henter styring fra faktura (4)
      *
     C                   Z-ADD     4             KOPLNR
     C*
     C     KODTPK        CHAIN     KOPR                               42
      *
      * HENTER OCRSTYRING FØR OG ETTER H-LINJEN
      *
     C  N42KOPFM         IFNE      *BLANKS
     C     KOPFM         CHAIN     KODTFM                             42
     C                   END
      *
     C                   ENDSR
     C*******************************************************
     C     arkivsr       BEGSR
     C*******************************************************
     C     FIFIRM        CHAIN     FIRMARC                            33
     C  N33'ff'          chain     arktxt                             33
     C     *IN33         IFEQ      '0'
     C     arkjn         andeq     'J'
     C                   MOVE      FIFIRM        ARFIRM
     C                   MOVE      uuavd         ARAVD
     C                   MOVE      *zeros        AROPD
     C                   MOVEL     XFN           ARUNDE
     C                   MOVE      'ff'          ARTYPE
     C                   MOVE      WUSER         ARUSER
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     C                   MOVE      YKUNDN        ARKUND
     C                   WRITE     ARKIVR
     C                   END
     C                   ENDSR
     C*
      *******************************************************
     C     KIDGIR        BEGSR
      *******************************************************
     C     KOPLAS        COMP      'P'                                    64
     C                   MOVE      *BLANKS       kidtxt            4
     C                   MOVE      *BLANKS       LIN20
     C                   MOVE      *BLANKS       GIRO20
     C     XVAL          CHAIN     bagiro                             33
     C     *IN(33)       IFEQ      '1'
     C                   MOVEL     'KONTONR:'    IBATXT            8
      * kid
     C     UOWBBS        IFNE      ' '
     C                   EXSR      MOD10
     C                   MOVE      'KID:'        kidtxt
     C                   MOVEL     XWKID         LIN20
     C                   MOVE      XBAK          LIN20
     C                   END
      *
     C                   MOVEL     XFBANK        GIRO20
     C                   ELSE
     C                   MOVEL     'BIC:  '      KIDTXT
     C                   MOVEL     'IBAN NO:'    IBATXT
     C                   MOVEL     BASWIF        LIN20
     C                   MOVEL     BAGIRN        GIRO20
     C                   END
N03  C     *in77         ifeq      '0'
     C                   WRITE     KIDLIN
     C   64              write     cvrpa2
N03  C                   end
     C                   ENDSR
     C*
     C*
n02   *******************************************************
n02  C     OMREGN        BEGSR
n02   *******************************************************
n02  c     xval          ifeq      ficurr
n02  c                   z-add     xpfnok        xpfnokp
n02  c                   else
n02  C     XPFNOK        div       FERKUR        xwork
n02  C     xwork         mult(h)   feromr        xpfnokp          13 2
N02  C     FEROMR        IFNE      1
N02  C                   EXSR      DECIPRI
N02  C                   END
n02  c                   end
n02  C                   ADD       XPFNOKP       XTOTAL           13 2
n02  c                   endsr
**
2121212121212121212
