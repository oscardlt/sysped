********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 BEGRENSE AVDELING VED SØKING
10015 * 02 YBC PTF10 NY Z-FIL FOR T&T
10015 * 03 SH  PTF10 OPPDATERE DISP MED TURNUMMER
10015 * 04 jov PTF10 Hvis turnr gitt/godsnr = blank, sjekk godsregistrering(go gods..)
10XXX * 05 YBC PTF10 LES EUNB/EDIS MED RIKTIG SENDINGSNR
10XXX * 06 jov PTF10 ytterligere fix PTF05
10XXX * 07 YBC PTF10 HENT BRUKER-ID FRA SDS OG OPPDATER SIGANTUR PÅ TTEDEV
10XXX * 08 YBC PTF10 KOPIER OGSÅ BILL OF LADING
10XXX * 09 JOV PTF10 SLETT POST I SADVJ
10XXX * 10 JOV PTF10 duplikate feltnavn med ulik definisjon
10XXX * 11 YBC PTF10 HENT DOKUMENTKODE NÅR DET OPPRETTER FRISØKEVEI
      * 12 SH  PTF10 endre ta vare på siste post ved rulling(*in25)
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11006 * 13 YBC PTF11 NYE FILER ZOKUDGS OG ZOKUFE
      * 14 JOV PTF11 T&T-lets på Local language
11XXX * 15 YBC PTF11 INITIER DISP
11XXX * 16 YBC PTF11 NY FIL: ZOKUFVF1
11XXX * 17 JOV PTF11 Ny status for prebooking
11XXX * 18 YBC PTF11 NY FIL: ZTRACKT1
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
12XXX * 19 YBC PTF11 REKOMP. PGA. SADV/SAEV ENDRET.
      *%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
12053 * 20 YBC PTF12 FLERE FELTER ER UTVIDET.
      * 21 JOV PTF12 OPPDATER Arkiv med opplastede dokumenter (endre logg)
12XXX * 22 CB  PTF12 LEGG INN MELDINGSNUMMER I EDIM
12XXX * 23 YBC PTF12 BEVARE REFERANSE FRA ZEADF
12XXX * 24 YBC PTF12 FEILRETTING PÅ ENDRING 23
12XXX * 25 YBC PTF12 Samme referanse tømmer tidligere turnr på plukket oppdrag.
12XXX * 26 YBC PTF12 overlapp korte/lange T&T-tekster, initieres nå (movel endret til eval)
********************************************************************
      * NORDCOM, EN DEL TILLEGG
     H DATEDIT(*YMD)
      ***********************************************************
      *** PROGRAMMET VISER OVERSIKT OVER INNGÅENDE            ***
      *** KOMMUNIKASJONSOPPDRAG.                              ***
      ***                                                     ***
      *** PROGRAMMET BLIR KALT FRA SYOP01R. DET ER DETTE      ***
      *** PROGRAM SOM SETTER STATUS TIL 'P' NÅR EN POST ER    ***
      *** PLUKKET. AVBRYTES PLUKKING SETTES STATUS TIL BLANK  ***
      *** IGJEN.                                              ***
      ***                                                     ***
      ***********************************************************
      *
     FBRIDF     IF   E           K DISK
     FZEADL03   IF   E           K DISK    RENAME(HEADFR:HEADFRDU)
     FZEADL01   UF   E           K DISK    INFDS(ZEA1DS)
     FZEADL02   IF   E           K DISK    RENAME(HEADFR:HEADFRP)
     FHEDUMMY   IF   E           K DISK    RENAME(HEADFR:HEAD2R)
     FHEADF     UF A E           K DISK    RENAME(HEADFR:HEADFRNY)
     FHEAD14    IF   E           K DISK    RENAME(HEADFR:HEADFR14)
S03  F*ISP      O  A E             DISK
N03  FDISP      UF A E           K DISK
     FFRISOK    O  A E             DISK
N08  FBILLOF    O  A E             DISK
N08  FBLV1      O  A E             DISK
N08  FBLV2      O  A E             DISK
     FKODFRI    IF   E           K DISK
     FBRPARF    IF   E           K DISK
     FZRISOL01  UF   E           K DISK    RENAME(FRISOKR:ZRISOKR)
     FFAKT      O  A E             DISK
     FZAKTL01   UF   E           K DISK    RENAME(FAKTR:ZAKTR)
     FTRACKF    O  A E             DISK
N18  FTRACKT    O  A E             DISK
     FEDIS      IF   E           K DISK
     FEUNB      IF   E           K DISK
N22  FEDIM6     UF   E           K DISK
     FFREETXT   O  A E           K DISK
     FZADFL01   UF   E           K DISK
     FZADHL01   UF   E           K DISK
     FZADVL01   UF   E           K DISK
N09  FZADVJL01  UF   E           K DISK
     FZAEFL01   UF   E           K DISK    RENAME(SADFR:SAEFR)
     FZAEHL01   UF   E           K DISK
S10  F*AEVL01   UF   E           K DISK
N10  FZAEVL01   UF   E           K DISK    PREFIX(EX_)
     FZOKUFL1   UF   E           K DISK
     FZOKUFM1   UF   E           K DISK
     FZOKUFV1   UF   E           K DISK
N16  FZOKUFVF1  UF   E           K DISK
N13  FZOKUDGS1  UF   E           K DISK
N13  FZOKUFEL1  UF   E           K DISK
     FZOK29L1   UF   E           K DISK
     FZOK36L1   UF   E           K DISK
     FZREETXT1  UF   E           K DISK    RENAME(FREETXTR:ZREETXTR)
     FZNADSL1   UF   E           K DISK    RENAME(NADSR:ZNADSR)
N02  FZTRACKL1  UF   E           K DISK    RENAME(TRACKFR:ZTRACKFR)
N18  FZTRACKT1  UF   E           K DISK    RENAME(TRACKTR:ZTRACKTR)
N08  FZILLOF    UF   E           K DISK    RENAME(BILLOFR:ZBILLOFR)
N08  FZLV1      UF   E           K DISK    RENAME(BLV1R:ZBLV1R)
N08  FZLV2      UF   E           K DISK    RENAME(BLV2R:ZBLV2R)
     FENADSF    O  A E           K DISK
     FTELL      UF   E           K DISK
     FMULTKODT  IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FTURER14   IF   E           K DISK
     FFIRM      IF   E           K DISK
     FKODTRI    IF   E           K DISK
     FKODKTR    IF   E           K DISK
N04  FGODSJL06  IF   E           K DISK
N21  FARKIVL10  UF   E           K DISK
     FSYOP21D   CF   E             WORKSTN
     F                                     SFILE(SY20H30:ZRECNO)
      ***********************************************************
     D ZEA1DS          DS
     D  RECNO1               397    400B 0
     D RX              S              1    DIM(35)
NRFA D                 DS
NRFA D  HERFA                  1     35
NRFA D  HERFA15                1     15
     D                 DS
     D  XIDAGÅ                 1      4  0
     D  XIDAGM                 5      6  0
     D  XIDAGD                 7      8  0
     D  XIDAG                  1      8  0
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     D                 DS
     D  KOT                    1     12
     D                                     DIM(6)
     D  W2KOT1                 1      2
     D  W2KO02                 3      4
     D  W2KO03                 5      6
     D  W2KO04                 7      8
     D  W2KO05                 9     10
     D  W2KO06                11     12
     D                 DS
     D  IOT                    1     12
     D                                     DIM(6)
     D  W2IOT1                 1      2
     D  W2IO02                 3      4
     D  W2IO03                 5      6
     D  W2IO04                 7      8
     D  W2IO05                 9     10
     D  W2IO06                11     12
     D                UDS
     D  UFIRM                  1      2
     D  UAVD                  15     18  0
     D  USG                   19     21
     D  UUSR                 301    310
N07  D                SDS
N07  D  ZUSER                254    263
      * Track/Trace-tekster
     D TTXED1          C                   CONST('Incoming EDI prepar-
     D                                     ed from sender      ')
      *
     D TTXED2          C                   CONST('Incoming EDI reciev-
     D                                     ed                  ')
      *
     D TTXSTR          C                   CONST('Order entered (proc-
     D                                     essed from EDI-data)')
      *
     D SLETTE          C                   CONST('** SLETTET ** ')
     D PLUKKE          C                   CONST('** PLUKKET ** ')
N20  ISADVR
N20  I              SVBELT                      I_SVBELT
      *______________________
      * Start
      *""""""""""""""""""""""
     C                   EXSR      INIT
      *______________
      * Tøm subfile
      *""""""""""""""
     C     START         TAG
     C     UUR           IFEQ      'B'
     C     UUR           OREQ      'H'
     C     UUR           OREQ      'C'
     C     UUR           OREQ      'D'
     C                   MOVE      'OPD'         NIVÅ
     C                   MOVEA     '0'           *IN(66)
     C                   END
     C                   MOVE      '1'           *IN93
     C                   WRITE     SY20K40
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     0             ZRECNO
N01  C                   MOVE      W2AVD         X2AVD             4 0
      *_____________
      * Fyll Subfile
      *"""""""""""""
      * LESER TURNIVÅ
      *
     C     NIVÅ          IFEQ      'TUR'
     C     *LOVAL        SETLL     ZEADL03                            77
     C     STTUR1        TAG
     C                   READ      ZEADL03                                94
N01  C  N94              IF        W2AVD <> 0
N01  C     W2AVD         CABNE     HEAVD         STTUR1
N01  C                   END
     C  N94              EXSR      TURANT
     C  N94HEREFF        SETGT     ZEADL03
      *
      * LESER OPPDRAGSNIVÅ
      *
     C                   ELSE
     C     PPREFF        SETLL     ZEADL03
     C     UUR           IFNE      'B'
     C     UUR           ANDNE     'H'
     C     UUR           ANDNE     'C'
     C     UUR           ANDNE     'D'
     C     PPREFF        READE     ZEADL03                                94
     C                   ELSE
     C     LESNY1        TAG
     C                   READ      ZEADL03                                94
N01  C  N94              IF        W2AVD <> 0
N01  C     W2AVD         CABNE     HEAVD         LESNY1
N01  C                   END
     C  N94HEUR          IFNE      UUR
     C     HEUR          ANDNE     ' '
     C                   GOTO      LESNY1
     C                   END
     C  N94              EXSR      FILTER
     C  N94SKIPP         CABEQ     'J'           LESNY1
     C                   END
     C                   END
      *
     C     START1        TAG
     C                   Z-ADD     0             COUNT
     C     *IN94         DOWEQ     *OFF
     C     COUNT         ANDLT     6
      *
      * STATUS SKAL VÆRE BLANK OG OPPDRAGNUMMER SKAL VÆRE 0
      *
     C     HEST          IFEQ      ' '
     C     HEOPD         ANDEQ     *ZEROS
     C                   MOVEL     HENAS         WSNA01
     C                   MOVEL     HENAK         WSNA02
     C                   MOVEL     HEADS3        WSAD01
     C                   MOVEL     HEADK3        WSAD02
     C*
     C* TESTER PÅ TURNIVÅ
     C*
     C     NIVÅ          IFEQ      'TUR'
     C                   Z-ADD     ANTOPD        HENT
     C                   MOVE      *ZEROS        HEVKT
     C                   MOVE      *BLANKS       WSNA01
     C                   MOVEL     HENAA         WSNA01
     C                   MOVE      *BLANKS       WSNA02
     C                   MOVE      *BLANKS       WSAD01
     C                   MOVE      *BLANKS       WSAD02
     C                   END
      *
      * SLUTT SPESIAL PÅ TURNIVÅ
      *
     C                   Z-ADD     RECNO1        RECNUM
     C                   ADD       1             COUNT
     C                   ADD       1             ZRECNO
     C     WSNA01        COMP      SLETTE                                 50
     C  N50WSNA01        COMP      PLUKKE                                 50
N17  c                   eval      BOOKTX = *blanks
N17  C     NIVÅ          ifeq      'OPD'
N17  c     HESTN7        ifeq      'P'
N17  c                   eval      BOOKTX = 'PreBookin'
N17  c                   endif
N17  c                   endif
     C                   WRITE     SY20H30
     C                   ENDIF                                                  <HEST
     C     NIVÅ          IFEQ      'TUR'
      *
      * TESTER PÅ TURNIVÅ
      *
     C     STTUR2        TAG
     C                   READ      ZEADL03                                94
N01  C  N94              IF        W2AVD <> 0
N01  C     W2AVD         CABNE     HEAVD         STTUR2
N01  C                   END
     C  N94HEST          IFNE      ' '
     C                   GOTO      STTUR2
     C                   END
     C  N94              EXSR      TURANT
     C  N94HEREFF        SETGT     ZEADL03
     C                   ELSE
      *
      * TESTER PÅ OPPDRAGSNIVÅ
      *
     C     UUR           IFNE      'B'
     C     UUR           ANDNE     'H'
     C     UUR           ANDNE     'C'
     C     UUR           ANDNE     'D'
     C     PPREFF        READE     ZEADL03                                94
     C                   ELSE
     C     LESNY2        TAG
     C                   READ      ZEADL03                                94
N01  C  N94              IF        W2AVD <> 0
N01  C     W2AVD         CABNE     HEAVD         LESNY2
N01  C                   END
     C  N94HEUR          IFNE      UUR
     C     HEUR          ANDNE     ' '
     C                   GOTO      LESNY2
     C                   END
     C  N94              EXSR      FILTER
     C  N94SKIPP         CABEQ     'J'           LESNY2
     C                   END
     C                   END
     C  N94              ENDDO                                                  <*IN94
      *
      * BEVAR VERDIER FOR "SUBFIL-POST 1 PÅ NESTE SIDE"
s12  C* N94              EXSR      KEEPSU
n12  C  N94              MOVE      HEREFF        ROREFF
n12  C  N94              MOVE      HEUNIK        ROUNIK
      *
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C     ZRECNO        IFGT      0
     C     ZRECNO        SUB       1             CURS1
     C     CURS1         DIV       6             CURS1
     C     CURS1         MULT      6             CURS1
     C                   ADD       1             CURS1
     C                   ENDIF
      *________________
      * Vis Subfile
      *""""""""""""""""
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C     VISB10        TAG
     C                   EXFMT     SY20B10
     C                   ELSE                                                   <ZRECNO
     C                   WRITE     SY20B20
     C                   EXFMT     SY20K40
     C                   ENDIF                                                  <ZRECNO
      *
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   ENDIF
      *
     C                   SETOFF                                       9899
     C                   MOVEA     '00000000'    *IN(30)
      *________________
      * F3=Avslutt
      *""""""""""""""""
     C     *IN03         IFEQ      '1'
     C                   GOTO      ENDPGM
     C                   ENDIF                                                  <*IN03
      *________________
      * F5=frisk opp
      *""""""""""""""""
     C     *IN05         IFEQ      '1'
     c                   move      wreff         pprefF
     C                   GOTO      START
     C                   ENDIF                                                  <*IN05
      * Filter
     C     *IN08         IFEQ      '1'
     c                   exfmt     Bilde02
     c                   move      wreff         pprefF
     c                   move      *blanks       FILTTXT
     c     W2AVD         ifne      *zeros
     c     W2KTR         orne      *zeros
     c     W2LKF         orne      *blanks
     c     W2PNF         orne      *blanks
     c     W2LKT         orne      *blanks
     c     W2PNT         orne      *blanks
     c     W2KOT1        orne      *blanks
     c     W2KO02        orne      *blanks
     c     W2KO03        orne      *blanks
     c     W2KO04        orne      *blanks
     c     W2KO05        orne      *blanks
     c     W2KO06        orne      *blanks
     c     W2IOT1        orne      *blanks
     c     W2IO02        orne      *blanks
     c     W2IO03        orne      *blanks
     c     W2IO04        orne      *blanks
     c     W2IO05        orne      *blanks
     c     W2IO06        orne      *blanks
     c     W2REFF        orne      *blanks
     c                   eval      FILTTXT ='Filter (F8) aktivt!'
     C                   end                                                    <*IN05
     C                   GOTO      START
     C                   ENDIF                                                  <*IN05
      *________________
      * F12=TILBAKE
      *""""""""""""""""
     C     *IN12         IFEQ      '1'
      * EKSPORT - KUN ETT NIVÅ... F12=AVSLUTT
     C     UUR           IFEQ      'B'
     C     UUR           OREQ      'H'
     C     UUR           OREQ      'C'
     C     UUR           OREQ      'D'
     C                   GOTO      ENDPGM
     C                   END
     C     NIVÅ          IFEQ      'OPD'
     C                   MOVE      'TUR'         NIVÅ
     C                   MOVEA     '1'           *IN(66)
     C                   WRITE     BILDEBL
     C                   GOTO      START
     C                   END
     C                   ENDIF                                                  <*IN05
      *________________
      * Roll
      *""""""""""""""""
     C     *IN25         IFEQ      '1'
     C     *IN94         ANDEQ     '0'                                           EOF
     C                   Z-ADD     YRECNO        ZRECNO
     C                   MOVE      '0'           *IN25
      * FØRSTE POST PÅ NESTE SIDE ER ALT REST - RESTORE VERDIER.
s12  C*                  EXSR      RESTSU
n12  C     rokey         setll     zeadl03
n12  C                   read      zeadl03                                94
     C                   GOTO      START1
     C                   ENDIF                                                  <*IN25
      *________________
      * Søk
      *""""""""""""""""
     C     WREFF         IFNE      WWREFF
N01  C     W2AVD         ORNE      X2AVD
     C                   EXSR      SETLOW
     C                   GOTO      START1
     C                   ENDIF
      *_____________________
      * Les valg fra subfile
      *"""""""""""""""""""""
     C     ZRECNO        IFNE      0
     C                   EXSR      GETOPT
      *
      * ENDRET TUR GÅ TIL TOPP ENDRE TIL MODE OPD
      *
     C     NIVÅ          IFEQ      'CHG'
     C                   MOVE      'OPD'         NIVÅ
     C                   MOVE      ' '           WSNR
     C                   MOVEA     '0'           *IN(66)
     C                   WRITE     BILDEBL
     C                   GOTO      START
     C                   END
      *
      * AVSLUTT
      *
     C     *IN03         CABEQ     '1'           ENDPGM
     C     *IN12         IFEQ      '1'
     C                   MOVE      *OFF          *IN12
     C                   GOTO      START3
     C                   ENDIF
      *
     C                   ENDIF                                                  <ZRECNO
      *
      *
      * SETTER SISTE BEHANDLEDE OPPDRAG PÅ TOPPEN AV LISTEN
      *
     C     WREFF         IFNE      WWREFF
     C                   MOVE      WWREFF        WREFF
     C                   EXSR      SETLOW
     C                   GOTO      START1
     C                   END
     C                   GOTO      START3
      *
     C     ENDPGM        TAG
     C                   MOVE      '1'           *INLR
     C                   RETURN
      *
      ***********************************************
     C     SETLOW        BEGSR
      ***********************************************
     C                   MOVE      WREFF         WWREFF
     C                   MOVE      '1'           *IN93
     C                   WRITE     SY20K40
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     0             ZRECNO
     C     NIVÅ          IFEQ      'TUR'
     C     WWREFF        SETLL     ZEADL03                            77
     C     STTUR3        TAG
     C                   READ      ZEADL03                                94
N01  C  N94              IF        W2AVD <> 0
N01  C     W2AVD         CABNE     HEAVD         STTUR3
N01  C                   END
     C  N94              EXSR      TURANT
     C  N94HEREFF        SETGT     ZEADL03
     C                   ELSE
     C     WWREFF        SETLL     ZEADL03
     C     UUR           IFNE      'B'
     C     UUR           ANDNE     'H'
     C     UUR           ANDNE     'C'
     C     UUR           ANDNE     'D'
     C     WWREFF        READE     ZEADL03                                94
     C                   ELSE
     c     stsl          tag
     C                   READ      ZEADL03                                94
N01  C  N94              IF        W2AVD <> 0
N01  C     W2AVD         CABNE     HEAVD         STSL
N01  C                   END
     C  N94HEUR          IFNE      UUR
     C     HEUR          ANDNE     ' '
     C                   GOTO      stsl
     C                   END
     C  N94              EXSR      FILTER
     C  N94SKIPP         CABEQ     'J'           stsl
     C                   END
     C                   END
     C                   ENDSR
s12   ***********************************************
s12  C*    KEEPSU        BEGSR
s12   ***********************************************
s12   *
s12  c*                  MOVE      RECNUM        SUCNUM
s12  C*                  MOVE      HEREFF        SUREFF
s12  C*                  MOVE      HEUNIK        SUUNIK
s12  C*                  MOVE      WSNA01        SUNA01
s12  C*                  MOVE      WSNA02        SUNA02
s21  C*                  MOVE      HENT          SUNT
s12  C*                  MOVE      HEVKT         SUVKT
s12  C*                  MOVE      WSAD01        SUAD01
s12  C*                  MOVE      WSAD02        SUAD02
s12  C*                  MOVE      HELKA         SULKA
s12  C*                  MOVE      HEDTOP        SUDTOP
s21  C*                  ENDSR
s12   ***********************************************
s12  C*    RESTSU        BEGSR
s12   ***********************************************
s12  C*                  MOVE      SUCNUM        RECNUM
s12  c**                 MOVE      SUREFF        HEREFF
s12  C**                 MOVE      SUUNIK        HEUNIK
s12  C**                 MOVE      SUNA01        WSNA01
s12  C**                 MOVE      SUNA02        WSNA02
s12  C**                 MOVE      SUNT          HENT
s12  c**                 MOVE      SUVKT         HEVKT
s12  C*                  MOVE      SUAD01        WSAD01
s12  C*                  MOVE      SUAD02        WSAD02
s12  C*                  MOVE      SULKA         HELKA
s12  C*                  MOVE      SUDTOP        HEDTOP
s21  C*                  ENDSR
      ***********************************************
     C     TURANT        BEGSR
      ***********************************************
      *
     C                   Z-ADD     1             ANTOPD
     C     STANT         TAG
     C     HEREFF        READE     ZEADL03                                33
     C  N33              ADD       1             ANTOPD            5 0
     C  N33              GOTO      STANT
     C                   ENDSR
      ***********************************************
     C     GETOPT        BEGSR
      ***********************************************
     C                   SETOFF                                       919299
     C                   MOVEA     '00000000'    *IN(30)
     C     *IN98         DOWEQ     '0'
     C                   READC     SY20H30                                98
     C     *IN98         IFEQ      '1'
     C                   GOTO      ENDGET
     C                   ENDIF                                                  <*IN98
     C     WSNA01        IFEQ      SLETTE
     C     WSNA01        OREQ      PLUKKE
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SY20H30
     C                   GOTO      ENDGET
     C                   ENDIF                                                  <*IN98
      *_______
      *  BLANK
      *"""""""
     C     WSNR          IFEQ      ' '
     C                   UPDATE    SY20H30
     C                   ELSE                                                   <WSNR
     C                   Z-ADD     ZRECNO        CURS1
      *____________________
      * 1=Plukk til oppdrag/ELLER VELG TUR
      *""""""""""""""""""""
     C     WSNR          IFEQ      '1'
     C                   Z-ADD     HEUNIK        PPUNIK
     C                   MOVEL     HEREFF        PPREFF
     C     NIVÅ          IFEQ      'TUR'
      * Hvis f.esk '0001 *DUP*     ' så hopp over tur/fellesopplysninger..
     C                   MOVEL     HEREFF        DUPTST           10
     C                   MOVE      DUPTST        KONDUP            5
     C     KONDUP        IFNE      '*DUP*'
     C                   EXSR      CHGOPD
     C                   END
     C                   MOVE      'CHG'         NIVÅ
     C                   GOTO      ENDGET
     C                   END
      *
     C                   ADD       1             RUNDN
     C                   EXSR      TASTOR
     C                   MOVE      ' '           WSNR
     C     WSNA01        COMP      SLETTE                                 50
     C  N50WSNA01        COMP      PLUKKE                                 50
     C                   UPDATE    SY20H30
     C                   ENDIF                                                  <WSNR
      *___________________________
      * 2=Endre fellesopplysninger
      *"""""""""""""""""""""""""""
     C     WSNR          IFEQ      '2'
     C                   MOVE      ' '           WSNR
     C     WSNA01        COMP      SLETTE                                 50
     C  N50WSNA01        COMP      PLUKKE                                 50
     C                   UPDATE    SY20H30
     C                   EXSR      CHGOPD
     C                   ENDIF                                                  <WSNR
      *____________________________________________________________
      * 4=Slett post pluss tilhørigheter. Justeres per installasjon
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     WSNR          IFEQ      '4'
     C     WSNA01        IFNE      SLETTE
     C     WSNA01        ANDNE     PLUKKE
     C     NIVÅ          IFEQ      'TUR'
N09  C                   MOVE      *ZEROS        UUNIK2            9 0
     C                   CALL      'SYOP22R'
     C                   PARM                    HEREFF
N09  C                   PARM                    UUNIK2
     C                   ELSE
     C                   EXSR      SLETT
     C                   END
     C                   MOVE      ' '           WSNR
     C                   MOVEL     *BLANKS       WSNA01
     C                   MOVEL     *BLANKS       WSNA02
     C                   Z-ADD     0             HENT
     C                   Z-ADD     0             HEVKT
     C                   MOVEL     SLETTE        WSNA01
     C                   END
     C     WSNA01        COMP      SLETTE                                 50
     C  N50WSNA01        COMP      PLUKKE                                 50
     C                   UPDATE    SY20H30
     C                   ENDIF                                                  <WSNR
      *____________________________________________________________
      * 5=Vis flere opplysninger om oppdraget. Enkelt oppdragsbilde
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     WSNR          IFEQ      '5'
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SY20H30
     C                   EXSR      DSPOPD
     C                   ENDIF                                                  <WSNR
      *_______________________________
      * 7=Vis FRIE SØKVEIER
      *"""""""""""""""""""""""""""""""
     C     WSNR          IFEQ      '7'
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SY20H30
     C                   EXSR      DSPFSV
     C                   ENDIF                                                  <WSNR
      *_______________________________
      * 7=Vis NOTISBLOKK
      *"""""""""""""""""""""""""""""""
     C     WSNR          IFEQ      '8'
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SY20H30
     C                   EXSR      DSPNOT
     C                   ENDIF                                                  <WSNR
      *_______________________________
      * 7=Vis Rådata, DSPPFM av member
      *"""""""""""""""""""""""""""""""
     C     WSNR          IFEQ      'F'
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SY20H30
     C                   EXSR      DSPPFM
     C                   ENDIF                                                  <WSNR
      *________________
      * 8=Vis redigerte data, EDIfact eller annet
      *""""""""""""""""
     C     WSNR          IFEQ      'E'
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SY20H30
     C                   EXSR      DISPSR
     C                   ENDIF                                                  <WSNR
      *________________
      * O=Vis opplastet dokument
      *""""""""""""""""
     C                   IF        WSNR = 'O'
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SY20H30
     C                   EXSR      OPPLAST
     C                   ENDIF                                                  <WSNR
     C                   ENDIF                                                  <WSNR=BLANK
      *
     C     *IN03         CABEQ     '1'           ENDGET
     C     *IN12         CABEQ     '1'           ENDGET
      *
     C                   ENDDO
      *
     C     ENDGET        TAG
      *
     C                   ENDSR
      *
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
N12  C     ROKEY         KLIST
N12  C                   KFLD                    ROREFF
N12  C                   KFLD                    ROUNIK
      *
N03  C     HEKEY         KLIST
N03  C                   KFLD                    HEAVD
N03  C                   KFLD                    HEOPD
      *
     C     PPKEY         KLIST
     C                   KFLD                    PPUNIK
     C                   KFLD                    PPREFF
     C     PPKEY1        KLIST
     C                   KFLD                    HEREFF
     C                   KFLD                    HEUNIK
     C     ZKEY          KLIST
     C                   KFLD                    HEUNIK
     C     TURKEY        KLIST
     C                   KFLD                    ÆEPRO
     C     KUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WKUNDN
     C     KODSFK        KLIST
     C                   KFLD                    WSSFUN
     C                   KFLD                    ÆESG
     C     KODSIK        KLIST
     C                   KFLD                    WSSIUN
     C                   KFLD                    WSSFSI
     C     KODTVK        KLIST
     C                   KFLD                    WSVUNI
     C                   KFLD                    WSVAVD
     C     KODTAK        KLIST
     C                   KFLD                    WSAUNI
     C                   KFLD                    WSVAVD
     C     HEADKY        KLIST
     C                   KFLD                    TRAVD0
     C                   KFLD                    TROPD0
     C     KTRkey        KLIST
     C                   KFLD                    FILAND
     C                   KFLD                    ALFPNR            5
N21  C     ARK10key      KLIST
N21  C                   KFLD                    ARSTAT
N21  C                   KFLD                    NulAVD            4 0
N21  C                   KFLD                    NulOPD            7 0
N21  C                   KFLD                    ARUNDE
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UUR               1
     C                   MOVE      UUR           UUR2              1
     C     UUR           IFEQ      'U'
     C                   MOVE      'H'           UUR
     C                   MOVE      *ZEROS        XXTERM
     C     *LOVAL        SETLL     KODTRI
     C                   READ      KODTRI                                 33
     C  N33              MOVE      RITERM        XXTERM
     C     *IN33         DOWEQ     '0'
     C     RITERM        IFNE      XXTERM
     C                   MOVE      *ZEROS        XXTERM
     C                   GOTO      UTTERM
     C                   END
     C                   READ      KODTRI                                 33
     C                   END
     C     UTTERM        TAG
     C     KODRIK        KLIST
     C                   KFLD                    XXTERM            4 0
     C                   KFLD                    NUMPNR            4 0
     C                   END
      *
     C                   TIME                    XULTID
     C                   MOVE      XULDD         XIDAGD
     C                   MOVE      XULMM         XIDAGM
     C                   MOVE      XULÅÅ         XIDAGÅ
     C*
     C                   MOVE      'SF'          WSSFUN            2
     C                   MOVE      'SI'          WSSIUN            2
     C                   MOVE      'V'           WSVUNI            1
     C                   MOVE      'A'           WSAUNI            1
      *
     C                   MOVE      'TUR'         NIVÅ              3
     C                   MOVEA     '1'           *IN(66)
     C     UUR           IFEQ      'B'
     C     UUR           OREQ      'H'
     C     UUR           OREQ      'C'
     C     UUR           OREQ      'D'
     C                   MOVE      'OPD'         NIVÅ
     C                   MOVEA     '0'           *IN(66)
     C                   END
      *
     C                   Z-ADD     0             AVDZER            4 0
     C                   Z-ADD     0             ZRECNO            4 0
     C                   Z-ADD     0             COUNT             3 0
     C                   Z-ADD     0             RUNDN             9 0
N05  C                   MOVE      *ZEROS        XAN09             9
n12  C     *LIKE         DEFINE    HEREFF        ROREFF
n12  C     *LIKE         DEFINE    HEUNIK        ROUNIK
s12  C*    *LIKE         DEFINE    RECNUM        SUCNUM
s12  C*    *LIKE         DEFINE    HEREFF        SUREFF
s12  C*    *LIKE         DEFINE    HEUNIK        SUUNIK
S12  C*    *LIKE         DEFINE    WSNA01        SUNA01
s12  C*    *LIKE         DEFINE    WSNA02        SUNA02
s12  C*    *LIKE         DEFINE    HENT          SUNT
s12  C*    *LIKE         DEFINE    HEVKT         SUVKT
s12  C*    *LIKE         DEFINE    WSAD01        SUAD01
s12  C*    *LIKE         DEFINE    WSAD02        SUAD02
S12  C*    *LIKE         DEFINE    HELKA         SULKA
S12  C*    *LIKE         DEFINE    HEDTOP        SUDTOP
     C     *LIKE         DEFINE    KUNDNR        WKUNDN
     C     *LIKE         DEFINE    HEUNIK        WWUNIK
     C     *LIKE         DEFINE    HEUNIK        PPUNIK
     C     *LIKE         DEFINE    HEREFF        PPREFF
     C     *LIKE         DEFINE    HEREFF        WWREFF
     C                   MOVE      *BLANKS       WWUNIK
      *
      *
     C                   READ      FIRM                                   20
     C                   WRITE     BILDEBL
      *
     C                   ENDSR
     C***********************************************
     C     FILTER        BEGSR
     C***********************************************
      * OBS! VED INNLEGG AV FLERE FILTER HUSK Å LEGGE DE INN OGSÅ NDE *IN08->FILTTXT
     C                   MOVE      'N'           Skipp             1
     C                   MOVE      '9'           ERSTAT            1
      *
     C     W2AVD         IFne      *zeros
     C     HEAVD         ANDNE     W2AVD
     C                   MOVE      'J'           Skipp
     C                   goto      UtFilter
     C                   end
      * div filter på FRA til Postnr
      * DERSOM VIA er fylt ut er det default, ellers Endepunkt  - Kode E= Endepunkt UANSETT
      * (ERSOM VIA er fylt ut er det default, ellers Endepunkt  - Kode E= Endepunkt UANSETT
     c                   movel     HESDF         FraPnr            5
     c                   movel     HESDT         TilPnr            5
      * I land imp/eksp er FF/VT ytterpunKT-BENYTT!! (HESDF/T = base for fraktkalk (IKKE benytt )
      * I TRmodul       er FF/VT VIASTED/terminal  - BENYTT !!
     c     HESDFF        ifne      *blanks
     c                   movel     HESDFF        FraPnr
     c                   end
     c     HESDVT        ifne      *blanks
     c                   movel     HESDVT        FraPnr
     c                   end
      * E=Endepkt - ved TR-modul - gå tilbake til hesdf/hesdt
     c     W2PNKO        ifeq      'E'
     c     HEUR          andeq     'H'
     c                   movel     HESDF         FraPnr
     c                   movel     HESDT         TilPnr
     c                   end
      * A=Adresse - 5 første av adr3
     c     W2PNKO        ifeq      'A'
     c                   movel     HEADS3        FraPnr
     c                   movel     HEADK3        TilPnr
     c                   end
      * KONTOR / AVDELING...
      * ENTEN MOTTAKERSIDE (IMP) ELLER AVSENDERSIDE(EXP) MÅ MATCHE NORSK POSTNR-AVD/KONTOR
     C     W2KTR         IFNE      *ZEROS
     C                   MOVE      *ZEROS        KKAVD
      * IMPORT (ELLER REN INNLAND)
     c     HETRI         ifeq      FILAND
     C                   MOVEL     TilPnr        ALFPNR
     C     KTRKEY        SETGT     KODKTR
     C     FILAND        READPE    KODKTR                                 33
     C  N33ALFPNR        IFGE      KKPNRF
     C     ALFPNR        ANDLE     KKPNRT
     C                   MOVE      KKAVD         KTRAVD            4 0
     C                   END
     C                   END
      * Eksport(ELLER REN INNLAND)
     c     W2ktr         ifne      KTRAVD
     c     HELKA         andeq     FILAND
     C                   MOVEL     FraPnr        ALFPNR
     C     KTRKEY        SETGT     KODKTR
     C     FILAND        READPE    KODKTR                                 33
     C  N33ALFPNR        IFGE      KKPNRF
     C     ALFPNR        ANDLE     KKPNRT
     C                   MOVE      KKAVD         KTRAVD
     C                   END
     C                   END
     c     W2ktr         ifne      KTRAVD
     C                   MOVE      'J'           Skipp
     C                   goto      UtFilter
     C                   END
     C                   END
      *  LK FRA
     C     W2LKF         IFne      *blanks
     C     HELKA         ANDNE     W2LKF
     C                   MOVE      'J'           Skipp
     C                   goto      UtFilter
     C                   end
      *  PNR FRA
     C     W2PNF         IFne      *blanks
     C                   Z-ADD     5             NMT
     c                   moveL     w2pnF         REPLA
     C                   EXSR      REPLAC
     C                   MOVEL     REPLA         MXPNF             5
     C     FraPnr        IFLT      W2PNF
     C     FraPnr        ORGT      MXPNF
     C                   MOVE      'J'           Skipp
     C                   goto      UtFilter
     C                   end
     C                   end
      *  LK TIL
     C     W2LKT         IFne      *blanks
     C     HETRI         ANDNE     W2LKT
     C                   MOVE      'J'           Skipp
     C                   goto      UtFilter
     C                   end
      *  PNR FRA
     C     W2PNT         IFne      *blanks
     C                   Z-ADD     5             NMT
     c                   moveL     w2pnT         REPLA
     C                   EXSR      REPLAC
     C                   MOVEL     REPLA         MXPNT             5
     C     TilPnr        IFLT      W2PNT
     C     TilPnr        ORGT      MXPNT
     C                   MOVE      'J'           Skipp
     C                   goto      UtFilter
     C                   end
     C                   end
      *  KUN OPPDR-TYPE 1-6   ( OT BLANK SLIPPER IKKE GJENNOM)
     C     W2KOT1        ifne      *blanks
     C     W2KO02        orne      *blanks
     C     W2KO03        orne      *blanks
     C     W2KO04        orne      *blanks
     C     W2KO05        orne      *blanks
     C     W2KO06        orne      *blanks
     C                   SETOFF                                       80
     C     HEOT          LOOKUP    KOT                                    80 *IN80 ON = FINNES
     C     *IN80         IFEQ      *OFF
     C     HEOT          OREQ      *BLANK
     C                   MOVE      'J'           Skipp
     C                   goto      UtFilter
     C                   end
     C                   end
      *  IKKE OPPDR-TYPE 1-6   ( OT BLANK SLIPPER GJENNOM)
     C     W2IOT1        ifne      *blanks
     C     W2IO02        orne      *blanks
     C     W2IO03        orne      *blanks
     C     W2IO04        orne      *blanks
     C     W2IO05        orne      *blanks
     C     W2IO06        orne      *blanks
     C                   SETOFF                                       80
     C     HEOT          LOOKUP    IOT                                    80 *IN80 ON = FINNES
     C     *IN80         IFEQ      *ON
     C     HEOT          ANDNE     *BLANK
     C                   MOVE      'J'           Skipp
     C                   goto      UtFilter
     C                   end
     C                   end
      *  EDIREF
     C     W2REFF        IFne      *blanks
     C                   Z-ADD     17            NMT
     c                   moveL     W2REFF        REPLA
     C                   EXSR      REPLAC
     C                   MOVEL     REPLA         MXREFF           17
     C     HEREFF        IFLT      W2REFF
     C     HEREFF        ORGT      MXREFF
     C                   MOVE      'J'           Skipp
     C                   goto      UtFilter
     C                   end
     C                   end
      *
     C     UtFilter      ENDSR
     C***********************************************
     C     REPLAC        BEGSR
     C***********************************************
     C     NMT           IFEQ      0
     C                   Z-ADD     15            NMT
     C                   END
      * Var ERSTAT må settes til ønsket erstatningsverdi. Eks. 9
      * Var REPLA må være venstrejustert og returneres med alle
      * blanke satt lik erstatningverdi
      * 2. Erstatter blanke med erstatningstegn
      *
     C                   MOVEA     REPLA         RX
     C     NMT           DOWGT     1
     C     RX(NMT)       IFEQ      ' '
     C                   MOVEA     ERSTAT        RX(NMT)
     C                   SUB       1             NMT               3 0
     C                   ELSE
     C                   LEAVE
     C                   ENDIF
     C                   ENDDO
     C                   MOVEA     RX            REPLA            35
      *
     C                   ENDSR
      ***********************************************
     C     TASTOR        BEGSR
      ***********************************************
     C     PPKEY1        CHAIN(N)  ZEADL01                            90
      * HVIS FRA INNLANDSMODUL SETT AVD ETTER TILSTED..
     C     UUR2          IFEQ      'U'
     c     XXTERM        ANDNE     *ZEROS
     C                   MOVEL     HESDT         TSTPNR            4
     C                   TESTN                   TSTPNR               33
     C     *IN33         IFEQ      '1'
     C                   MOVE      TSTPNR        NUMPNR
     C     KODRIK        SETGT     KODTRI
     C     XXTERM        READPE    KODTRI                                 33
     C  N33NUMPNR        IFGE      RIPNRF
     C     NUMPNR        ANDLE     RIPNRT
     C                   MOVE      RIAVDU        HEAVD
     C                   END
     C                   END
     C                   END
      * ELLES SETTES AVD KUN I 1. RUNDE
     C     RUNDN         IFEQ      1
     C     HEAVD         IFEQ      *ZEROS
     C                   MOVE      UAVD          WSVAVD
     C                   ELSE
     C                   MOVE      HEAVD         WSVAVD
     C                   END
     C*
     C     HESG          IFEQ      *BLANKS
     C                   MOVE      USG           WSSFSI
     C                   ELSE
     C                   MOVE      HESG          WSSFSI
     C                   END
     C*
     C                   WRITE     WINDOWSZ
     C     ST00          TAG
     C                   EXFMT     BILDE01
     C                   SETOFF                                       309899
     C   03              GOTO      UTSR
     C   04              DO
     C                   CALL      'SYFA14B'
     C                   PARM                    WSVAVD
     C                   END
     C     ST02          TAG
     C     WSVAVD        IFEQ      0
     C                   GOTO      ST00
     C                   END
     C     KODTVK        CHAIN     KOVR                               99
     C  N99KODTAK        CHAIN     KOAR                               99
     C   99              MOVE      'SPA0001'     MSGNR
     C  N99KOAIE         IFEQ      'E'
     C     UUR           ANDEQ     'A'
     C                   MOVE      'SHU0444'     MSGNR
     C                   SETON                                        99
     C                   END
     C   99              SETON                                        30
     C   99              GOTO      ST00
     C                   MOVE      WSSFSI        ÆESG
     C     KODSFK        CHAIN     KOSFR                              98
     C   98              MOVE      'SPS0001'     MSGNR
     C   98              SETON                                        30
     C   98              GOTO      ST00
     C                   END
     C*
     C* HENTER FRA DUMMY
     C     DUMKEY        KLIST
     C                   KFLD                    WSVAVD
     C                   KFLD                    OPDNUL            7 0
N23  C     *LIKE         DEFINE    HEREFF        X_HEREFF
N23  C     *LIKE         DEFINE    HEUNIK        X_HEUNIK
N24   * BEVARE REFERANSE PGA. HEDUMMY INNEHOLDER SAMME FELTER
N24  C                   EVAL      X_HEREFF = HEREFF
N24  C                   EVAL      X_HEUNIK = HEUNIK
     C     DUMKEY        CHAIN     HEDUMMY                            89
N23  C                   EVAL      HEREFF = X_HEREFF
N23  C                   EVAL      HEUNIK = X_HEUNIK
     C     *IN89         IFEQ      '0'
     C                   MOVE      HEKNA         DUKNA             8 0
     C                   MOVE      HEKDFS        DUKDFS            1
     C                   MOVE      HELKA         DULKA             2
     C                   MOVE      HELKK         DULKK             2
     C                   MOVE      HELKS         DULKS             2
     C                   MOVE      HESTD         DUSTD             4 0
     C                   MOVE      HEKNT         DUKNT             8 0
     C                   MOVE      HEVALT        DUVALT            3
     C                   MOVE      HEVALP        DUVALP            3 3
     C                   MOVE      HEOT          DUOT              2
     C                   ENDIF
     C     PPKEY1        CHAIN     ZEADL01                            90
     C                   Z-ADD     WSVAVD        HEAVD
     C                   MOVEL     WSSFSI        HESG
     C                   MOVE      'P'           HEST
     C     *IN89         IFEQ      '0'
     C     HEKNA         IFEQ      0
     C                   MOVE      DUKNA         HEKNA
     C                   ENDIF
     C     HEKDFS        IFEQ      *BLANKS
     C                   MOVE      DUKDFS        HEKDFS
     C                   ENDIF
     C     HELKA         IFEQ      *BLANKS
     C                   MOVE      DULKA         HELKA
     C                   ENDIF
     C     HELKK         IFEQ      *BLANKS
     C                   MOVE      DULKK         HELKK
     C                   ENDIF
     C     HELKS         IFEQ      *BLANKS
     C                   MOVE      DULKS         HELKS
     C                   ENDIF
     C     HESTD         IFEQ      0
     C                   MOVE      DUSTD         HESTD             4 0
     C                   ENDIF
     C     HEKNT         IFEQ      0
     C                   MOVE      DUKNT         HEKNT
     C                   ENDIF
     C     HEVALT        IFEQ      *BLANKS
     C                   MOVE      DUVALT        HEVALT
     C                   MOVE      DUVALP        HEVALP
     C                   ENDIF
     C     HEOT          IFEQ      *BLANKS
     C                   MOVE      DUOT          HEOT
     C                   ENDIF
     C                   ENDIF
     C*
     C* HENTE OPPDRAGSNUMMER
     C*
     C     HEAVD         CHAIN     TELL                               33
     C   33AVDZER        CHAIN     TELL                               33
     C                   MOVE      TEOPDN        HEOPD
     C                   ADD       1             TEOPDN
     C                   UPDATE    TELLR
     C*
     C* OPPDATER ZEADF MED AVD/OPPDR.NR, STAUS=P (+ SIGN + DEFAULTER..)
     C  N90              UPDATE    HEADFR
     C                   MOVEL     PLUKKE        WSNA01
     C*
     C                   MOVE      'U'           HEST
     C                   MOVE      'A'           HEUR
     C     UUR           IFNE      ' '
     C                   MOVE      UUR           HEUR
     C                   END
     C                   MOVE      XIDAG         HEDTR
     C                   MOVE      XIDAG         HEDTOP
     C     HEUR          IFEQ      'H'
     C     TRSLAG        ANDEQ     '  '
     C                   MOVE      'HO'          TRSLAG
     C                   END
     C                   EXSR      GETFRT
      * Til innlanndsmodul..
     C     UUR2          IFEQ      'U'
     C                   MOVE      HEDTOP        TRSDFD
     C                   MOVE      HEDTOP        TRSDTD
     C     PPUNIK        SETLL     ZRISOL01
     C     PPUNIK        READE(N)  ZRISOL01                               33
     C     *IN33         DOWEQ     *OFF
     C     FSKODE        IFEQ      'IFB'
     C                   EVAL      HXSNDN  = '401'+FSSOK
     C                   LEAVE
     C                   END
     C     PPUNIK        READE(N)  ZRISOL01                               33
     C  N33              ENDDO
     C                   END
     C                   WRITE     HEADFRNY
      * SKRIV EN "MINIMUMS" DISP-RECORD FOR Å SIKRE AT DATA IKKE "MISTES" V/F12 FRA OPPDRAG
     C     HEUR          IFEQ      'H'
N15  C                   CLEAR                   DISPR
     C                   MOVE      HEAVD         DIAVD
     C                   MOVE      HEOPD         DIOPD
     C                   MOVE      HEOT          DIOT
     C                   MOVE      HESDF         DISTEF
     C                   MOVE      HESDT         DISTET
     C                   MOVE      TRSDFD        DIDATF
     C                   MOVE      TRSDTD        DIDATT
     C                   MOVE      TRSDFK        DITIMF
     C                   MOVE      TRSDTK        DITIMT
N03  C     HEPRO         IFGT      0
N03  C                   MOVE      TRRUND        DIRUND
N03  C                   MOVE      HEPRO         DITUR
N03  C                   MOVE      TUAVD         DITUAV
N03  C                   END
     C                   WRITE     DISPR
     C                   END
      * FRI SØKEVEI "ORD"=ORDRENR FOR SØK FRA INTERNETT
     C     HERFA         IFNE      *BLANKS
     C                   MOVE      HEAVD         FSAVD
     C                   MOVE      HEOPD         FSOPD
     C                   MOVE      'ORD'         FSKODE
     C                   MOVEL     HERFA         FSSOK
     C                   MOVE      HEDTOP        FSDTOP
     C     FSKODE        CHAIN     KODFRI                             33
     C  N33              MOVE      KFSODK        FSDOKK
     C   33              MOVE      *BLANKS       FSDOKK
     C                   WRITE     FRISOKR
     C                   END
      *
     C                   IF        (((HELIB  = *BLANKS) AND
     C                               (HEFILE <> *BLANKS)) AND
     C                               (HEMBR = *BLANKS))
      * OPPDATER BRUKER-ID TIL DEN SOM REGISTRERTE WEB-OPPDRAG
     C                   MOVE      HEAVD         FSAVD
     C                   MOVE      HEOPD         FSOPD
     C                   MOVE      'WUI'         FSKODE
     C                   EVAL      FSSOK = HEFILE
     C                   MOVE      HEDTOP        FSDTOP
     C                   MOVE      *BLANKS       FSDOKK
N11  C     FSKODE        CHAIN     KODFRI                             33
N11  C  N33              MOVE      KFSODK        FSDOKK
     C                   WRITE     FRISOKR
     C                   END
      *
     C     FIURBL        IFEQ      'J'
N02  C     PPUNIK        CHAIN(N)  ZTRACKL1                           33
N02  C                   IF        *IN33
     C                   EXSR      TTSR
N02  C                   ELSE
N02  C                   EXSR      TTSRWEB
N02  C                   END
     C                   END
      * FAKTURA
     C     HEUNIK        SETLL     ZAKTL01
     C     HEUNIK        READE(N)  ZAKTL01                                33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      HEAVD         FAAVD
     C                   MOVE      HEOPD         FAOPD
     C                   WRITE     FAKTR
     C     HEUNIK        READE(N)  ZAKTL01                                33
     C  N33              ENDDO
N08   *
N08   * BILL OF LADING
N08  C     PPUNIK        SETLL     ZILLOF
N08  C     PPUNIK        READE(N)  ZILLOF                                 33
N08  C     *IN33         DOWEQ     *OFF
N08  C                   Z-ADD     HEAVD         BLAVD
N08  C                   Z-ADD     HEOPD         BLOPD
N08  C                   WRITE     BILLOFR
N08  C     PPUNIK        READE(N)  ZILLOF                                 33
N08  C  N33              ENDDO
N08   *
N08   * BL VARELINJE 1
N08  C     PPUNIK        SETLL     ZLV1
N08  C     PPUNIK        READE(N)  ZLV1                                   33
N08  C     *IN33         DOWEQ     *OFF
N08  C                   Z-ADD     HEAVD         BVAVD
N08  C                   Z-ADD     HEOPD         BVOPD
N08  C                   WRITE     BLV1R
N08  C     PPUNIK        READE(N)  ZLV1                                   33
N08  C  N33              ENDDO
N08   *
N08   * BL VARELINJE 2
N08  C     PPUNIK        SETLL     ZLV2
N08  C     PPUNIK        READE(N)  ZLV2                                   33
N08  C     *IN33         DOWEQ     *OFF
N08  C                   Z-ADD     HEAVD         BVAVD
N08  C                   Z-ADD     HEOPD         BVOPD
N08  C                   WRITE     BLV2R
N08  C     PPUNIK        READE(N)  ZLV2                                   33
N08  C  N33              ENDDO
     C*
     C* GENERERER FRAKTBREV
     C*
     C                   CALL      'SYOP30R'
     C                   PARM                    PPUNIK
     C                   PARM                    PPREFF
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C*
     C* FLYTTER FRI SØKEVEI
     C*
     C     PPUNIK        SETLL     ZRISOL01
     C     PPUNIK        READE(N)  ZRISOL01                               33
     C     *IN33         DOWEQ     *OFF
     C                   IF        FSKODE = '#VD'
     C                   MOVE      HEAVD         XAVD              4
     C                   MOVE      HEOPD         XOPD              7
     C                   MOVE      FSUNIK        XAN09             9
     C                   EVAL      UDOKNV = XAN09
     C                   CAT       FSDOKK:0      UDOKNV
     C                   CAT       FSSOK:0       UDOKNV
     C                   CALL      'SYOP23C'
     C                   PARM                    XAVD
     C                   PARM                    XOPD
     C                   PARM                    HEFILE
     C                   PARM                    UDOKNV           70
     C                   PARM                    FSSOK
     C                   ELSE
     C                   IF        ((FSKODE <> 'ORD') OR (HERFA <> FSSOK))
     C                   Z-ADD     HEAVD         FSAVD
     C                   Z-ADD     HEOPD         FSOPD
     C                   MOVE      HEDTOP        FSDTOP
     C     FSKODE        CHAIN     KODFRI                             33
     C  N33              MOVE      KFSODK        FSDOKK
     C                   WRITE     FRISOKR
     C                   END
     C                   END
     C     PPUNIK        READE(N)  ZRISOL01                               33
     C  N33              ENDDO
N21   *
N21   * Oppdater arkivdokumenter (ligger med 0 i avd/opd - Z123456789 i ARUNDE )
N21  C                   move      'A'           ARSTAT
N21  C                   movel     'Z'           ARUNDE
N21  C                   move      PPUNIK        ARUNDE
N21  C     ARK10key      setll     ARKIVL10
N21  C     ARK10key      READE     ARKIVL10                               33
N21  C     *IN33         DOWEQ     *OFF
N21  c                   eval      ARAVD = HEAVD
N21  c                   eval      AROPD = HEOPD
N21  c                   update    ARKIVR
N21  C     ARK10key      READE     ARKIVL10                               33
N21  C  N33              ENDDO
N21   **
     C*
     C* FLYTTER OVER FREETXT
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C*
     C                   Z-ADD     0             XRTLI             2 0
     C     PPUNIK        SETLL     ZREETXT1
     C     PPUNIK        READE(N)  ZREETXT1                               33
     C     *IN33         DOWEQ     *OFF
     C                   MOVE      ULDT          FRTDT
     C                   Z-ADD     HEAVD         FRTAVD
     C                   Z-ADD     HEOPD         FRTOPD
     C                   ADD       1             XRTLI
     C                   Z-ADD     XRTLI         FRTLI
     C                   WRITE     FREETXTR
     C*
     C     PPUNIK        READE(N)  ZREETXT1                               33
     C  N33              ENDDO
     C* ADRESSELINJER
     C*
     C     PPKEY         SETLL     ZNADSL1
     C     PPKEY         READE(N)  ZNADSL1                                33
     C     *IN33         DOWEQ     *OFF
     C                   Z-ADD     HEAVD         NAVD
     C                   Z-ADD     HEOPD         NOPD
     C                   WRITE     NADSR
     C     PPKEY         READE(N)  ZNADSL1                                33
     C  N33              ENDDO
     C                   MOVE      'Z'           UKODE             1
     C                   MOVE      ' '           UDUMMY            1
     C                   MOVE      HEAVD         UAVD2             4 0
     C                   MOVE      HEOPD         UOPD2             7 0
     C                   MOVE      HESG          USG2              3
     C                   MOVE      *ZEROS        UAVDNY            4 0
     C                   MOVE      'CHG'         UTYPE             3
      *
      * DISPRECORD
N03  C     HEUR          IFEQ      'H'
N15  C                   CLEAR                   DISPR
N03  C     HEKEY         CHAIN     DISP                               33
N03  C                   MOVE      HEAVD         DIAVD
N03  C                   MOVE      HEOPD         DIOPD
N03  C                   MOVE      HEOT          DIOT
N03  C                   MOVE      HESDF         DISTEF
N03  C                   MOVE      HESDT         DISTET
N03  C                   MOVE      TRSDFD        DIDATF
N03  C                   MOVE      TRSDTD        DIDATT
N03  C                   MOVE      TRSDFK        DITIMF
N03  C                   MOVE      TRSDTK        DITIMT
N03  C     HEPRO         IFGT      0
N03  C                   MOVE      TRRUND        DIRUND
N03  C                   MOVE      HEPRO         DITUR
N03  C                   MOVE      TUAVD         DITUAV
N03  C                   END
N03  C   33              WRITE     DISPR
N03  C  N33              UPDATE    DISPR
N03  C                   END
     C                   SELECT
      * LAND IMPORT
     C     HEUR          WHENEQ    'A'
     C                   CALL      'SYFA10'
     C                   PARM                    UAVD2
     C                   PARM                    UOPD2             7 0
     C                   PARM                    USG2
     C                   PARM                    UTYPE
     C                   PARM                    UKODE             1
     C                   PARM                    UDUMMY            1
     C                   PARM                    UAVDNY
     C     HEUR          WHENEQ    'B'
     C                   CALL      'SYEX10'
     C                   PARM                    UAVD2
     C                   PARM                    UOPD2             7 0
     C                   PARM                    USG2
     C                   PARM                    UTYPE
     C                   PARM                    UKODE             1
     C                   PARM                    UDUMMY            1
     C                   PARM                    UAVDNY
     C     HEUR          WHENEQ    'C'
     C                   CALL      'SYFI10'
     C                   PARM                    UAVD2
     C                   PARM                    UOPD2
     C                   PARM                    USG2
     C                   PARM                    UTYPE
     C                   PARM                    UKODE
     C                   PARM                    UAVDNY
     C     HEUR          WHENEQ    'D'
     C                   CALL      'SYEF10'
     C                   PARM                    UAVD2
     C                   PARM                    UOPD2
     C                   PARM                    USG2
     C                   PARM                    UTYPE
     C                   PARM                    UKODE
     C                   PARM                    UAVDNY
     C     HEUR          WHENEQ    'H'
     C                   MOVE      'A'           CALLFR            1
     C                   MOVE      '2'           UURETU            1
     C                   MOVE      '0'           UUFUNK            1
     C     UUR2          IFEQ      'U'
     C                   MOVE      'U'           CALLFR
     C                   END
     C                   CALL      'SYTR10'
     C                   PARM                    UAVD2
     C                   PARM                    UAVDNY
     C                   PARM                    UOPD2
     C                   PARM                    CALLFR
     C                   PARM                    UURETU
     C                   PARM                    UUFUNK
     C     HEAKEY        KLIST
     C                   KFLD                    UAVD2
     C                   KFLD                    UOPD2
      * fjerne X  er flyttet til etter ENDSL
      * link hoved/dup flyttet til etter ENDSL  - ingen merking
     C                   ENDSL
      * SEND E-POST TIL WEB-BRUKERE
     C                   EXSR      SNDEPWEB
      *
      * fjerne X  er flyttet til etter ENDSL
     C     HEAKEY        CHAIN     HEADF                              33
     C     *IN33         IFEQ      '0'
     C     HEST          IFEQ      'X'
     C                   MOVE      ' '           HEST
     C                   END
     C                   UPDATE    HEADFRNY
     C                   END
      * logikke for knytting HO/dup flyttet (ingen annen merking)
     C     TROPD0        IFne      *zeros
     C     TROPD1        orne      *zeros
     C     TROPD2        orne      *zeros
     c                   exsr      DUPSR
     c                   end
     C     UTSR          ENDSR
      *
      * logikke for knytting HO/dup flyttet (ingen annen merking)
      ***********************************************
     C     DUPSR         BEGSR
      ***********************************************
     C     HEAKYD        KLIST
     C                   KFLD                    TRAVD0
     C                   KFLD                    TROPD0
     C                   MOVE      TRSLAG        XRSLAG            2
     C                   Z-ADD     HEAVD         XEAVD             4 0
     C                   Z-ADD     HEOPD         XEOPD             7 0
      * DET SKAPTE OPPDRAGET ER et DUP-oppdrag, oppdater ref i overordnet/bestillende
     C     TRAVD0        IFNE      0
     C     TROPD0        ANDNE     0
     C     HEAKYD        CHAIN     HEADF                              65
     C     *IN65         IFEQ      *OFF
     C     XRSLAG        IFEQ      'FF'
     C                   Z-ADD     XEAVD         TRAVD1
     C                   Z-ADD     XEOPD         TROPD1
     C                   ENDIF
     C     XRSLAG        IFEQ      'VF'
     C                   Z-ADD     XEAVD         TRAVD2
     C                   Z-ADD     XEOPD         TROPD2
     C                   ENDIF
     C                   UPDATE    HEADFRNY
     C                   ENDIF
     C                   ELSE
      * DET SKAPTE OPPDRAGET ER HOVEDOPPDRAG, OPPRINNELIG ER HENTEOPPDRAG..
      * Oppdater DUP-AV-ref i det opprinnelige
     C     TRAVD1        IFNE      0
     C     TROPD1        ANDNE     0
     C     XRSLAG        IFEQ      'HO'
     C     XRSLAG        OREQ      '  '
     C     HEAKYD1       KLIST
     C                   KFLD                    TRAVD1
     C                   KFLD                    TROPD1
     C     HEAKYD1       CHAIN     HEADF                              65
     C     *IN65         IFEQ      *OFF
     C                   MOVE      'FF'          TRSLAG
     C                   Z-ADD     XEAVD         TRAVD0
     C                   Z-ADD     XEOPD         TROPD0
     C                   UPDATE    HEADFRNY
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     c                   endsr
      *=====================================================================******
      * SEND E-POST TIL WEB-BRUKERE
      *=====================================================================******
     C     SNDEPWEB      BEGSR
      *
     C                   IF        ((HELIB = *BLANKS) AND (HEFILE <> *BLANKS))
     C     HEFILE        CHAIN     BRIDF                              33
     C                   IF        *IN33 = *OFF
     C                   MOVE      HEUNIK        UUNIK             9
     C                   MOVE      'HEUMT'       UTYPEW            5
     C                   CALL      'ESOP11C'                            33
     C                   PARM                    UUNIK
     C                   PARM                    UTYPEW
     C                   END
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     SLETT         BEGSR
      ***********************************************
      * I standard versjonen sletter denne posten i alle Z-filene.
      * Det gjøres ingen forsøk på å fjerne filmemberet som
      * inneholder rådataene. Det forutsettes at data ligger i
      * membere i EDIRE og der slettes det i standarden fra før.
      * Evt. kundespesifikke datamottak som ikke går via TVINRE
      * må da legges inn som et kall i denne SR.
      *
      * SAD IMPORT...
     C     ZKEY          CHAIN     ZADFL01                            5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    SADFR
     C     ZKEY          READE     ZADFL01                              5353
     C  N53              ENDDO
      *
     C     ZKEY          CHAIN     ZADHL01                            5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    SADHR
     C     ZKEY          READE     ZADHL01                              5353
     C  N53              ENDDO
      *
     C     ZKEY          CHAIN     ZADVL01                            5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    SADVR
     C     ZKEY          READE     ZADVL01                              5353
     C  N53              ENDDO
N09  C     ZKEY          CHAIN     ZADVJL01                           5353
N09  C     *IN53         DOWEQ     '0'
N09  C                   DELETE    SADVJR
N09  C     ZKEY          READE     ZADVJL01                             5353
N09  C  N53              ENDDO
      * SAD EKSP...
     C     ZKEY          CHAIN     ZAEFL01                            5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    SAEFR
     C     ZKEY          READE     ZAEFL01                              5353
     C  N53              ENDDO
      *
     C     ZKEY          CHAIN     ZAEHL01                            5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    SAEHR
     C     ZKEY          READE     ZAEHL01                              5353
     C  N53              ENDDO
      *
     C     ZKEY          CHAIN     ZAEVL01                            5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    SAEVR
     C     ZKEY          READE     ZAEVL01                              5353
     C  N53              ENDDO
      * FRAKTBREV..
     C     ZKEY          CHAIN     ZOKUFL1                            5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    DOKUFR
     C     ZKEY          READE     ZOKUFL1                              5353
     C  N53              ENDDO
      *
     C     ZKEY          CHAIN     ZOKUFM1                            5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    DOKUFMR
     C     ZKEY          READE     ZOKUFM1                              5353
     C  N53              ENDDO
      *
     C     ZKEY          CHAIN     ZOKUFV1                            5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    DOKUFVR
     C     ZKEY          READE     ZOKUFV1                              5353
     C  N53              ENDDO
N16   *
N16  C     ZKEY          CHAIN     ZOKUFVF1                           5353
N16  C     *IN53         DOWEQ     '0'
N16  C                   DELETE    DOKUFVFR
N16  C     ZKEY          READE     ZOKUFVF1                             5353
N16  C  N53              ENDDO
N13   *
N13  C     ZKEY          CHAIN     ZOKUDGS1                           5353
N13  C     *IN53         DOWEQ     '0'
N13  C                   DELETE    DOKUDGSR
N13  C     ZKEY          READE     ZOKUDGS1                             5353
N13  C  N53              ENDDO
N13   *
N13  C     ZKEY          CHAIN     ZOKUFEL1                           5353
N13  C     *IN53         DOWEQ     '0'
N13  C                   DELETE    DOKUFER
N13  C     ZKEY          READE     ZOKUFEL1                             5353
N13  C  N53              ENDDO
      *
     C     ZKEY          CHAIN     ZOK29L1                            5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    DOK29R
     C     ZKEY          READE     ZOK29L1                              5353
     C  N53              ENDDO
      *
     C     ZKEY          CHAIN     ZOK36L1                            5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    DOK36R
     C     ZKEY          READE     ZOK36L1                              5353
     C  N53              ENDDO
      * NOTIS-BLOKK
     C     ZKEY          CHAIN     ZREETXT1                           5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    ZREETXTR
     C     ZKEY          READE     ZREETXT1                             5353
     C  N53              ENDDO
      * FRI SØKEVEI
     C     HEUNIK        CHAIN     ZRISOL01                           5353
     C     *IN53         DOWEQ     '0'
     C                   IF        FSKODE = '#VD'
     C     BRPARFK       KLIST
     C                   KFLD                    HEFILE
     C                   KFLD                    PAKUNR
     C                   KFLD                    PAID
     C                   MOVE      'OLBAN'       PAID
     C     BRPARFK       CHAIN     BRPARF                             33
     C                   EVAL      ULINK = PAVRDA
     C                   MOVE      FSUNIK        XAN09             9
     C                   CAT       XAN09:0       ULINK
     C                   CAT       FSDOKK:0      ULINK
     C                   CAT       FSSOK:0       ULINK
     C                   CALL      'SYOP23C2'
     C                   PARM                    ULINK           100
     C                   END
     C                   DELETE    ZRISOKR
     C     HEUNIK        READE     ZRISOL01                             5353
     C  N53              ENDDO
      * FAKTURA
     C     HEUNIK        CHAIN     ZAKTL01                            5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    ZAKTR
     C     HEUNIK        READE     ZAKTL01                              5353
     C  N53              ENDDO
N08   * BILL OF LADING
N08  C     ZKEY          CHAIN     ZILLOF                             5353
N08  C     *IN53         DOWEQ     '0'
N08  C                   DELETE    ZBILLOFR
N08  C     ZKEY          READE     ZILLOF                                 53
N08  C  N53              ENDDO
N08   * BL VARELINJE 1
N08  C     ZKEY          CHAIN     ZLV1                               5353
N08  C     *IN53         DOWEQ     '0'
N08  C                   DELETE    ZBLV1R
N08  C     ZKEY          READE     ZLV1                                   53
N08  C  N53              ENDDO
N08   * BL VARELINJE 2
N08  C     ZKEY          CHAIN     ZLV2                               5353
N08  C     *IN53         DOWEQ     '0'
N08  C                   DELETE    ZBLV2R
N08  C     ZKEY          READE     ZLV2                                   53
N08  C  N53              ENDDO
N02   * TRACK & TRACE
N02  C     ZKEY          CHAIN     ZTRACKL1                           5353
N02  C     *IN53         DOWEQ     '0'
N02  C                   DELETE    ZTRACKFR
N02  C     ZKEY          READE     ZTRACKL1                               53
N02  C  N53              ENDDO
N18   * DATOER
N18  C     ZKEY          CHAIN     ZTRACKT1                           5353
N18  C     *IN53         DOWEQ     '0'
N18  C                   DELETE    ZTRACKTR
N18  C     ZKEY          READE     ZTRACKT1                               53
N18  C  N53              ENDDO
      * ADRESSEINFO
     C     ZKEY          CHAIN     ZNADSL1                            5353
     C     *IN53         DOWEQ     '0'
     C                   DELETE    ZNADSR
     C     ZKEY          READE     ZNADSL1                              5353
     C  N53              ENDDO
      * OPPDRAG (ALLE PÅ EN TUR ELLER BARE ETT)
     C     NIVÅ          IFEQ      'TUR'
     C     HEREFF        CHAIN     ZEADL01                            5353
     C     *IN53         DOWEQ     '0'
     C                   MOVE      'S'           hest
     C                   UPDATE    HEADFR
     C     HEREFF        READE     ZEADL01                              5353
     C  N53              ENDDO
NORD C                   ELSE
NORD C     PPKEY1        CHAIN     ZEADL01                            53
     C  N53              MOVE      'S'           hest
     C  N53              UPDATE    HEADFR
NORD C                   ENDIF
     C                   MOVE      TRSLAG        XRSLAG            2
     C     HEADKY        CHAIN     HEADF                              54
     C     *IN54         IFEQ      *OFF
     C     XRSLAG        IFEQ      'FF'
     C                   Z-ADD     0             TRAVD1
     C                   Z-ADD     0             TROPD1
     C                   ENDIF
     C     XRSLAG        IFEQ      'VF'
     C                   Z-ADD     0             TRAVD2
     C                   Z-ADD     0             TROPD2
     C                   ENDIF
     C                   UPDATE    HEADFRNY
     C                   ENDIF
      *
     C                   ENDSR
      ***********************************************
     C     DSPFSV        BEGSR
      ***********************************************
     C     HEUNIK        CHAIN     ZEADL02                            90
     C                   CALL      'SYOP24R'
     C                   PARM                    HEUNIK
     C                   PARM                    HEREFF
      *
     C                   ENDSR
      *
      ***********************************************
     C     DSPNOT        BEGSR
      ***********************************************
     C     HEUNIK        CHAIN     ZEADL02                            90
     C                   CALL      'SYOP25R'
     C                   PARM                    HEUNIK
     C                   PARM                    HEREFF
      *
     C                   ENDSR
      *
      ***********************************************
     C     OPPLAST       BEGSR
      ***********************************************
     C                   MOVE      HEUNIK        UUNIK
     C                   CALL      'ARC023'
     C                   PARM                    HEREFF
     C                   PARM                    UUNIK
      *
     C                   ENDSR
      *
      ***********************************************
     C     DISPSR        BEGSR
      ***********************************************
      * Dette er alltid et kundespesifikt tilllegg.
      * Denne rutine skal vise alle data i en redigert form direkte
      * fra rådataene.
      *________________
      * Tar DSPPFM på valgt post. DENNE VISES SÅLENGE IKKE KUNDESPESIFIKT
      *""""""""""""""""
     C     HEUNIK        CHAIN     ZEADL02                            90
     C                   MOVEL     'DSPPFM F'    QCMDA             8
     C     QCMDA         CAT       'ILE('        QCMDB            12
     C     QCMDB         CAT       HEFILE        QCMDC            22
     C     QCMDC         CAT       ') MBR('      QCMDD            28
     C     QCMDD         CAT       HEMBR         QCMDE            38
     C     QCMDE         CAT       ')'           QCMDF            39
     C                   Z-ADD     39            QCMDL            15 5
     C                   CALL      'QCMDEXC'                            90
     C                   PARM                    QCMDF
     C                   PARM                    QCMDL
     C                   ENDSR
      ***********************************************
     C     DSPPFM        BEGSR
      ***********************************************
      *________________
      * Tar DSPPFM på valgt post.
      *""""""""""""""""
     C     HEUNIK        CHAIN     ZEADL02                            90
     C                   MOVEL     'DSPPFM F'    QCMDA             8
     C     QCMDA         CAT       'ILE('        QCMDB            12
     C     QCMDB         CAT       HEFILE        QCMDC            22
     C     QCMDC         CAT       ') MBR('      QCMDD            28
     C     QCMDD         CAT       HEMBR         QCMDE            38
     C     QCMDE         CAT       ')'           QCMDF            39
     C                   Z-ADD     39            QCMDL            15 5
     C                   CALL      'QCMDEXC'                            90
     C                   PARM                    QCMDF
     C                   PARM                    QCMDL
     C                   ENDSR
      ***********************************************
     C     DSPOPD        BEGSR
      ***********************************************
      *________________
      * Viser ett forenklet oppdragbilde basert på data i Z-filer
      *""""""""""""""""
     C     HEUNIK        CHAIN     ZEADL02                            90
     C     *IN90         IFEQ      *OFF
      *________________
      * Sjekker om det er data i NAD Z-adressefiler
      *""""""""""""""""
     C     ZKEY          CHAIN     ZNADSL1                            90
     C     *IN90         IFEQ      *OFF
     C                   MOVE      *ON           *IN57
     C                   ELSE
     C                   MOVE      *OFF          *IN57
     C                   ENDIF
n17   * prebooking ??
n17  c                   move      *blanks       BOOKTXT
n17  c     HESTN7        ifeq      'P'
n17  c                   eval      BOOKTXT = 'PreBooking'
n17  c                   endif
n17   *
     C                   EXFMT     SY20B50
     C                   ENDIF
      *
     C                   ENDSR
      *_________________________________________________________
      * 2=Endre fellesopplysninger                        CHGOPD
      *"""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     CHGOPD        BEGSR
      *
     C     HEUNIK        CHAIN     ZEADL02                            90
     C                   MOVE      UAVD          UAVD1             4 0
     C                   MOVE      UAVD1         ÆEAVD
     C*
     C     HEAVD         IFNE      *ZEROS
     C                   Z-ADD     HEAVD         ÆEAVD
     C                   END
     C                   MOVEL     HESG          ÆESG
     C     ÆESG          IFEQ      *BLANKS
     C                   MOVE      USG           ÆESG
     C                   END
     C                   Z-ADD     HEPRO         ÆEPRO
     C                   Z-ADD     HEKNA         ÆEKNA
     C                   MOVEL     HEGN          ÆEGN
     C                   MOVEL     HELKA         ÆELKA
     C                   MOVEL     HETRM         ÆEKDTM
     C                   MOVEL     HETRI         ÆETRI
      *
     C     CON01         TAG
      *
     C                   EXFMT     SY20B60
     C     *IN12         IFEQ      '1'
     C                   GOTO      CON99
     C                   ENDIF
     C     *IN04         IFEQ      '1'
     C                   EXSR      SOEK
     C                   GOTO      CON01
     C                   ENDIF
      *
     C                   MOVEA     '00000000'    *IN(30)
     C                   MOVEA     '00'          *IN(38)
     C                   MOVE      'SY00000'     MSGNR
      *
     C     ÆEAVD         CHAIN(N)  TELL                               30
     C   30AVDZER        CHAIN(N)  TELL                               30
     C     *IN30         IFEQ      '1'
     C                   MOVE      '1'           *IN31
     C                   MOVE      'BBA0031'     MSGNR
     C                   GOTO      CON01
     C                   ENDIF
      *
     C                   MOVE      ÆEAVD         WSVAVD
     C     KODTVK        CHAIN     KOVR                               99
     C  N99KODTAK        CHAIN     KOAR                               99
     C   99              MOVE      'SPA0001'     MSGNR
     C  N99KOAIE         IFEQ      'E'
     C                   MOVE      'SHU0444'     MSGNR
     C                   SETON                                        99
     C                   END
     C   99              SETON                                        30
     C   99              GOTO      CON01
     C*SLUTT AVDELINGSTEST
     C*
     C     KODSFK        CHAIN     KOSFR                              30
     C     *IN30         IFEQ      '1'
     C                   MOVE      '1'           *IN32
     C                   MOVE      'SPS0001'     MSGNR
     C                   GOTO      CON01
     C                   ENDIF
      *
     C     ÆEKNA         IFGT      0
     C                   Z-ADD     ÆEKNA         WKUNDN
     C     KUNKEY        CHAIN     CUNDL01                            30
     C     *IN30         IFEQ      '1'
     C                   MOVEA     '10001000'    *IN(30)
     C                   MOVE      'DIV2548'     MSGNR
     C                   GOTO      CON01
     C                   ENDIF
     C                   ENDIF
      *
     C                   MOVE      *ZEROS        ÆERUND            8 0
     C                   MOVE      *BLANKS       ÆEBILN           10
     C     ÆEPRO         IFGT      0
     C                   SETOFF                                       33
     C     TURKEY        CHAIN     TURER14                            30
     C   30TURKEY        CHAIN     HEAD14                             30
     C     *IN30         IFEQ      '1'
     C                   MOVE      '1'           *IN33
     C                   MOVE      'DIV2422'     MSGNR
     C                   GOTO      CON01
     C                   ENDIF
     C                   MOVE      TURUND        ÆERUND
     C                   MOVE      TUBILN        ÆEBILN
N04  c     ÆEGN          ifeq      *blanks
N04  c                   move      *blanks       GOTURN
N04  c                   movel     ÆEPRO         GOTURN
N04  C     GOTURN        CHAIN     GODSJL06                           33
N04  c   33              eval      GOTURN = %triml(%editc(ÆEPRO:'Z'))
N04  C   33GOTURN        CHAIN     GODSJL06                           33
N04  C     *in33         ifeq      *off
N04  C                   eval      ÆEGN = GOGN
N04  C                   MOVE      '1'           *IN30
N04  C                   MOVE      'JOV1533'     MSGNR
N04  C                   GOTO      CON01
N04  c                   endif
N04  c                   endif
     C                   ENDIF
      *_______________
      * Get Tripnumber IKKE VED TRANSPORTDISPONERING
      *"""""""""""""""
     C     UUR           IFNE      'H'
     C     ÆEPRO         IFEQ      0
     C     ÆEAVD         CHAIN     TELL                               53
     C   53AVDZER        CHAIN     TELL                               53
     C                   Z-ADD     TETURN        ÆEPRO
     C                   ADD       1             TETURN
     C                   UPDATE    TELLR
     C                   ENDIF
     C                   ENDIF
      *_____________
      * Update ZEADF
      *"""""""""""""
     C     HEREFF        CHAIN     ZEADL01                            5353
     C     *IN53         DOWEQ     '0'
N25  C                   IF        HEAVD = 0 AND HEOPD = 0                      KUN IKKE PLUKKET
     C                   Z-ADD     ÆEAVD         HEAVD
     C                   MOVEL     ÆESG          HESG
     C                   Z-ADD     ÆEPRO         HEPRO
     C                   Z-ADD     ÆEKNA         HEKNA
     C                   MOVEL     ÆEGN          HEGN
     C                   MOVEL     ÆELKA         HELKA
     C                   MOVEL     ÆEKDTM        HETRM
     C                   MOVEL     ÆETRI         HETRI
     C     UUR           IFEQ      'H'
     C     UUR           OREQ      'B'
     C                   Z-ADD     ÆERUND        TRRUND
     C                   MOVEL     ÆEBILN        HEHAWB
N03  C     UUR           IFEQ      'H'
N03  C     HEKEY         CHAIN     DISP                               34
N03  C  N34              MOVE      TRRUND        DIRUND
N03  C  N34              MOVE      HEPRO         DITUR
N03  C  N34              MOVE      TUAVD         DITUAV
N03YBC  N34              UPDATE    DISPR
N03  C                   END
     C                   ENDIF
N25  C                   END
     C                   UPDATE    HEADFR
     C     HEREFF        READE     ZEADL01                              5353
     C  N53              ENDDO
      *_______________________________________
      * Replace all option '2' with option ' '
      *"""""""""""""""""""""""""""""""""""""""
     C     *IN98         DOWEQ     '0'
     C                   READC     SY20H30                                98
     C     WSNR          IFEQ      '2'
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SY20H30
     C                   ENDIF
     C                   ENDDO
     C                   MOVE      '0'           *IN98
     C     CON99         ENDSR
      ***********************************************
     C     SOEK          BEGSR
      ***********************************************
      *                    MOVELZAVS      USØKKN
     C                   CALL      'SOEKKUN'
     C                   PARM                    ÆEKNA
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN           30
     C                   ENDSR
     C***********************************************
     C     TTSR          BEGSR
     C***********************************************
N07  C                   MOVEL     WSSFSI        TTEDEV
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
      * EDI-FIL klargjort hos avsender (hentet fra EUNB)
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
S05  C*    HESNN         CHAIN     EUNB                               33
N05  C                   EVAL      *IN33 = *ON
N05  C                   IF        ((HEFILE = 'EDIRE') OR (HEFILE = 'EDIRE1K'))
N05  C                   EVAL      XAN09 = %SUBST(HEMBR:2:9)
N05  C                   MOVE      XAN09         UIN
N05  C     UIN           CHAIN     EUNB                               33
N05  C                   END
N05  C   33HESNN         CHAIN     EUNB                               33
     C   33              MOVE      *ZEROS        U0017
     C   33              MOVE      *ZEROS        U0019
     C   33              MOVE      *ZEROS        TTDATE
     C                   MOVE      'ED1'         TTACTI
     C                   MOVEL     U0017         TSTÅR             2
     C  N33TSTÅR         IFGT      '43'
     C                   MOVEL     '19'          TTDATE
     C                   ELSE
     C                   MOVEL     '20'          TTDATE
     C                   END
     C                   MOVE      U0017         TTDATE
     C                   MOVEL     U0019         TTTIME
     C                   MOVE      '00'          TTTIME
     C                   MOVE      ULDT          TTDATL
     C                   MOVE      XULTM         TTTIML
     C                   MOVEL     U0004         TTUSER
S26  C*                  MOVEL     TTXED1        TTTEXT
s26  C*                  MOVEL     TTXED1        TTTEXL
N26  C                   eval      TTTEXT = TTXED1
N26  C                   eval      TTTEXL = TTXED1
     C                   WRITE     TRACKFR
      * EDI-fil mottatt og logget i SYSPED/SYEDI (hentet fra EDIS)
S05  C*    HESNN         CHAIN     EDIS                               33
N05  C                   EVAL      *IN33 = *ON
N05  C                   IF        ((HEFILE = 'EDIRE') OR (HEFILE = 'EDIRE1K'))
N05  C                   EVAL      XAN09 = %SUBST(HEMBR:2:9)
N05  C                   MOVE      XAN09         SSN
S06  C*    SSN           CHAIN     EUNB                               33
N06  C     SSN           CHAIN     EDIS                               33
N22  C                   IF        *IN33=*OFF
N22  C     SSN           CHAIN     EDIM6                              36
N22  C                   IF        *IN36=*OFF
N22  C                   EVAL      MAVD=HEAVD
N22  C                   EVAL      MTDN=HEPRO
N22  C                   UPDATE    EDIMR
N22  C                   ENDIF
N22  C                   ENDIF
N05  C                   END
s06  C*    HESNN         CHAIN     EDIS                               33
N22  C                   IF        *IN33=*ON
N06  C   33HESNN         CHAIN     EDIS                               33
N22  C                   IF        *IN33=*OFF
N22  C     HESNN         CHAIN     EDIM6                              36
N22  C                   IF        *IN36=*OFF
N22  C                   EVAL      MAVD=HEAVD
N22  C                   EVAL      MTDN=HEPRO
N22  C                   UPDATE    EDIMR
N22  C                   ENDIF
N22  C                   ENDIF
     C   33              MOVE      *ZEROS        SDT
     C   33              MOVE      *ZEROS        STM
     C   33              MOVE      *ZEROS        TTDATE
N22  C                   ENDIF
     C                   MOVE      'ED2'         TTACTI
     C                   MOVEL     SDT           TTDATE
     C                   MOVEL     STM           TTTIME
     C                   MOVE      ULDT          TTDATL
     C                   MOVE      XULTM         TTTIML
     C                   MOVE      *BLANKS       TTUSER
     C                   MOVEL     'SY400USR'    TTUSER
S26  C*                  MOVEL     TTXED2        TTTEXT
s26  C*                  MOVEL     TTXED2        TTTEXL
N26  C                   eval      TTTEXT = TTXED2
N26  C                   eval      TTTEXL = TTXED2
     C                   WRITE     TRACKFR
      * Registrert (plukket fra EDI)
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      'STR'         TTACTI
     C                   MOVE      ULDT          TTDATE
     C                   MOVE      XULTM         TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
S07  C*                  MOVE      UUSR          TTUSER
N07  C                   MOVE      ZUSER         TTUSER
S26  C*                  MOVEL     TTXSTR        TTTEXT
s26  C*                  MOVEL     TTXSTR        TTTEXL
N26  C                   eval      TTTEXT = TTXSTR
N26  C                   eval      TTTEXL = TTXSTR
     C                   WRITE     TRACKFR
     C                   ENDSR
N02   ***********************************************
N02  C     TTSRWEB       BEGSR
N02   ***********************************************
N02   *
N02  C     PPUNIK        SETLL     ZTRACKL1
N02  C     PPUNIK        READE(N)  ZTRACKL1                               33
N02  C                   DOW       *IN33 = *OFF
N02  C                   Z-ADD     HEAVD         TTAVD
N02  C                   Z-ADD     HEOPD         TTOPD
N02  C                   WRITE     TRACKFR
N02  C     PPUNIK        READE(N)  ZTRACKL1                               33
N02  C  N33              ENDDO
N02  C                   CALL      'SYGE15C'
N02  C                   PARM                    WDT               8
N02  C                   PARM                    WTM               6
N02  C                   MOVE      HEAVD         TTAVD
N02  C                   MOVE      HEOPD         TTOPD
N02  C                   MOVE      WDT           TTDATE
N02  C                   MOVE      WTM           TTTIME
N02  C                   MOVE      WDT           TTDATL
N02  C                   MOVE      WTM           TTTIML
S07  C*                  MOVE      UUSR          TTUSER
N07  C                   MOVE      ZUSER         TTUSER
N02  C                   MOVE      'STR'         TTACTI
S26  C*                  MOVEL     TTXSTR        TTTEXT
s26  C*                  MOVEL     TTXSTR        TTTEXL
N26  C                   eval      TTTEXT = TTXSTR
N26  C                   eval      TTTEXL = TTXSTR
N07  C                   MOVEL     WSSFSI        TTEDEV
N02  C                   WRITE     TRACKFR
N02   *
N02  C                   ENDSR
N02   *
     C***********************************************
     C     GETFRT        BEGSR
     C***********************************************
      * SR SOM HENTER VERDI FOR FRAKTTILLEGG (OLJE/VAL...)
     C     HEVALT        IFEQ      *BLANKS
     C                   MOVE      *ZEROS        UVALP
     C     HEUR          IFEQ      'B'
     C     HEUR          OREQ      'D'
     C     HEKNSF        IFNE      *ZEROS
     C     HEKDFS        ANDNE     'X'                                          VED EKSPORT.
     C                   MOVE      HEKNSF        UKNOP                          PRIM. SELGER
     C                   ELSE
     C                   MOVE      HEKNKF        UKNOP                          SEK. KJØPER
     C                   END
     C                   ELSE
     C     HEKNKF        IFNE      *ZEROS
     C     HEKDFK        ANDNE     'X'                                          VED IMPORT..
     C                   MOVE      HEKNKF        UKNOP                          PRIM. KJØPER
     C                   ELSE
     C                   MOVE      HEKNSF        UKNOP                          SEK. SELGER
     C                   END
     C                   END
     C     UKNOP         IFNE      *ZEROS
     C                   CALL      'SYFA24B'
     C                   PARM                    HEUR              1
     C                   PARM      HEAVD         UAVDOP            4 0
     C                   PARM                    UKNOP             8 0
     C                   PARM                    HEVALT
     C                   PARM                    UVALP             3 1
     C                   MOVE      UVALP         HEVALP
     C                   END
     C                   END
     C                   ENDSR
