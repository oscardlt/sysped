     FARKTXT    IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FarkivP    O  A E           K DISK
     FDKIH      IF   E           K DISK
     FDKIV      IF   E           K DISK
     FDKIA      IF   E           K DISK
     FDKIVA2    IF   E           K DISK
     FDKIF      IF   E           K DISK
     FKODTP     IF   E           K DISK
     FKODTFM    IF   E           K DISK
     FFIRM      IF   E             DISK
     FKODTA     IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FDKTHA     IF   E           K DISK
     FDKTVK     IF   E           K DISK
     FFRISOK    IF   E           K DISK
     FDKI046P   O    E             PRINTER USROPN
      *___________________________
      * Finner username
      *"""""""""""""""""""""""""""
     D                SDS
     D  ZUSER                254    263
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     D                 DS
     D  ØN154                  1     15  4
     D  ØA154H                 1     11
     D  ØA154X                 7     11
     D  ØA154D                12     15
     D                 DS
     D  ØA10                   1     10
     D  Ø10                    1     10
     D                                     DIM(10)                              Num edit
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    UVIHASYAV         4
     C                   PARM                    UVIHASYOP         7
     C                   PARM                    CALLTYP           1
     C                   MOVE      UVIHASYAV     UVIH_SYAV
     C                   MOVE      UVIHASYOP     UVIH_SYOP
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    DKIH_SYAV     UVIH_SYAV
     C     *LIKE         DEFINE    DKIH_SYOP     UVIH_SYOP
     C     *LIKE         DEFINE    KOPUNI        UOPUNI
     C     *LIKE         DEFINE    KOPAVD        UOPAVD
     C     *LIKE         DEFINE    KOPLNR        UOPLNR
     C     *LIKE         DEFINE    KFMSD         UFMSD1
     C     *LIKE         DEFINE    KFMSD         UFMSD3
     C     *LIKE         DEFINE    KOAUNI        WKOAUNI
     C     *LIKE         DEFINE    DKIH_222      ZVIH_222
     C     *LIKE         DEFINE    DKVK_KD       ZVVK_KD
     C     *LIKE         DEFINE    DKVK_DTS      ZVVK_DTS
     C     *LIKE         DEFINE    FSKODE        WSKODE
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYA          KLIST
     C                   KFLD                    UVIH_SYAV
     C                   KFLD                    UVIH_SYOP
     C     KEYP          KLIST
     C                   KFLD                    UOPUNI
     C                   KFLD                    UOPAVD
     C                   KFLD                    UOPLNR
     C     KEYF1         KLIST
     C                   KFLD                    KOPFM
     C                   KFLD                    UFMSD1
     C     KEYF3         KLIST
     C                   KFLD                    KOPFM
     C                   KFLD                    UFMSD3
     C     KEY046        KLIST
     C                   KFLD                    UVIH_SYAV
     C                   KFLD                    UVIH_SYOP
     C                   KFLD                    DKIVA_ABK
     C     KEYVX         KLIST
     C                   KFLD                    DKIV_SYAV
     C                   KFLD                    DKIV_SYOP
     C                   KFLD                    DKIV_SYLI
     C     KEYKODTA      KLIST
     C                   KFLD                    WKOAUNI
     C                   KFLD                    DKIH_SYAV
     C     KEYCUND       KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KOAKNR
     C     DKTVKKEY      KLIST
     C                   KFLD                    ZVVK_KD
     C                   KFLD                    ZVVK_DTS
     C     FRIKEY        KLIST
     C                   KFLD                    DKIH_SYAV
     C                   KFLD                    DKIH_SYOP
     C                   KFLD                    WSKODE
      *_____________
      * Init av felt
      *"""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           WDT80             8 0
     C                   EVAL      UOPUNI='P'
     C                   EVAL      UOPAVD=UVIH_SYAV
     C                   EVAL      UOPLNR=251
     C                   EVAL      UFMSD1=1
     C                   EVAL      UFMSD3=3
     C                   Z-ADD     1024          UCMDL            15 5
     C                   MOVE      *BLANKS       UCMD           1024
     C                   Z-ADD     0             ØX                2 0
     C                   MOVE      *BLANKS       ØAN              12
     C                   EVAL      WKOAUNI='A'
     C                   MOVEL     '*CR'         WSKODE
      *______________________________________
      * Hente firmaopplysninger fra spedisjon
      *""""""""""""""""""""""""""""""""""""""
     C                   READ      FIRM
      *_____________________
      * Hente printerstyring
      *"""""""""""""""""""""
     C     KEYP          CHAIN     KODTP                              33
      *_______________
      * Printerstyring ikke ved arkiv
      *"""""""""""""""
     C     calltyp       ifne      'A'
     C     koplas        andne     'P'
N01  C     koplas        andne     'F'
     C                   OPEN      DKI046P
     C                   EVAL      UCMD='OVRPRTF FILE(DKI046P) OUTQ('
      *
     C     UCMD          CAT       KOPNVN:0      UCMD
     C     UCMD          CAT       ')':0         UCMD
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     c                   end
      *
      * PDF vdirekte print
     C     KOPLAS        IFEQ      'P'
N01  C     KOPLAS        oreq      'F'
N01  C     calltyp       ifne      'A'
     C                   CALL      'DKI046C'
     C                   PARM                    KOPNVN
     C                   PARM                    CALLTYP
     C                   OPEN      DKI046P
N01  c                   end
     C                   END
      * arkivering
     C     calltyp       ifeq      'A'
     C                   CALL      'DKI046CA'
     C                   OPEN      DKI046P
     C                   END
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Start av file                                        SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
     C     KEYA          CHAIN     DKIH

      *_________
      * Huvudark
      *"""""""""
      * Hur många varuposter finnes ?
     C*                  EVAL      WRUBR5=0
     C                   EVAL      *IN52=*OFF
     C     KEYA          SETLL     DKIV
     C     KEYA          READE     DKIV                                   52
     C     *IN52         DOWEQ     *OFF
     C                   ADD       1             W10A
     C     KEYA          READE     DKIV                                   52
     C                   ENDDO
      * Varuposter
     C                   EXSR      SRBB
      * Matris før kryss på blanketten
     C                   IF        DKIH_T07A=*BLANKS
     C                   EVAL      W07AN='X'
     C                   ELSE
     C                   EVAL      W07AJ='X'
     C                   ENDIF
     C                   IF        DKIH_T07B=*BLANKS
     C                   EVAL      W07BN='X'
     C                   ELSE
     C                   EVAL      W07BJ='X'
     C                   ENDIF
     C                   IF        DKIH_T07C=*BLANKS
     C                   EVAL      W07CN='X'
     C                   ELSE
     C                   EVAL      W07CJ='X'
     C                   ENDIF
     C                   IF        DKIH_T08A=*BLANKS
     C                   EVAL      W08AN='X'
     C                   ELSE
     C                   EVAL      W08AJ='X'
     C                   ENDIF
     C                   IF        DKIH_T08B=*BLANKS
     C                   EVAL      W08BN='X'
     C                   ELSE
     C                   EVAL      W08BJ='X'
     C                   ENDIF
     C                   IF        DKIH_T09A=*BLANKS
     C                   EVAL      W09AN='X'
     C                   ELSE
     C                   EVAL      W09AJ='X'
     C                   ENDIF
     C                   IF        DKIH_T09B=*BLANKS
     C                   EVAL      W09BN='X'
     C                   ELSE
     C                   EVAL      W09BJ='X'
     C                   ENDIF
      * Skriv huvudark
     C     UVIH_SYAV     CHAIN     DKIA                               55
     C     KEYKODTA      CHAIN     KODTA
     C     KEYCUND       CHAIN     CUNDL01
     C     KEYF1         CHAIN     KODTFM
     C                   MOVEL     DKIA_14F      W10B1
     C     DKIH_SYSG     CHAIN     DKTHA
     C                   MOVEL     DKTH_NAMN     WT10B3
     C                   WRITE     DKI046PA
      * 1 kopi ved arkiv
     C     calltyp       ifne      'A'
     C     KEYF3         CHAIN     KODTFM
     C                   end
     C     calltyp       ifeq      'C'
     C                   EXSR      ARKSR
     C                   end
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Varuposter, flera                                   SRBB /
      *////////////////////////////////////////////////////////////
     C     SRBB          BEGSR
      * Skriv ut varuposter på egen lista
     C                   CALL      'DKI047R'
     C                   PARM                    UVIHASYAV
     C                   PARM                    UVIHASYOP
     C                   PARM                    CALLTYP
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Venstrestill numeriske verdier                      SRNE /
      *////////////////////////////////////////////////////////////
     C     SRNE          BEGSR
      * Flytte in rett verdi i Alfa 12-felt
     C                   MOVE      *ZEROS        ØA10
     C     ØA154D        IFEQ      '0000'                                       <-------------I
     C                   MOVE      ØA154H        ØA10                                         I
     C                   ELSE                                                   <-------------I
     C                   MOVEL     ØA154X        ØA10                                         I
     C                   MOVE      ',    '       ØA10                                         I
     C                   MOVE      ØA154D        ØA10                                         I
     C     Ø10(10)       IFEQ      '0'
     C                   MOVE      ' '           Ø10(10)
     C     Ø10(9)        IFEQ      '0'
     C                   MOVE      ' '           Ø10(9)
     C                   END
     C                   END
     C                   END                                                    <-------------I
      * lete fra venstre og finn foerste siffer over 0
     C     1             DO        9             ØX                             <-------------I
     C     Ø10(ØX)       IFNE      '0'                                           <-----------II
     C                   GOTO      SRNE1                                                     II
     C                   END                                                     <-----------II
     C                   END                                                    <-------------I
     C     SRNE1         TAG
      * Venstrestill til et nytt felt
     C                   MOVE      *BLANKS       ØAN
     C                   MOVEA     Ø10(ØX)       ØAN
      *
     C                   ENDSR
      *
      ***********************************************
     C     ARKSR         BEGSR
      ***********************************************
      *
      * SKRIV TIL ARKIV
      *
      * SKAL DOKUMENT ARKIVERES
      *
     C                   MOVE      'D2'          ARTYPE
     C     FIFIRM        CHAIN     FIRMARC                            34
     C  N34ARTYPE        CHAIN     ARKTXT                             34
     C     *IN(34)       IFEQ      '0'
     C     arkjn         andeq     'J'
      *
n04  C                   z-add     DKIH_AVKN     ARKUND
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      FIFIRM        ARFIRM
     C                   MOVE      UVIH_SYAV     ARAVD
N03  C                   MOVE      UVIH_SYOP     AROPD
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     C                   MOVE      ZUSER         ARUSER
     C                   MOVE      UVIH_SYOP     ARUNDE
     C                   movel     'D2:'         ARUNDE
     C                   WRITE     ARKIVR
      *_________________________
      * Aktivera arkivfunktionen  FJERNES SENERE
      *"""""""""""""""""""""""""
     C     DKIH_SYSG     CHAIN     DKTHA
     C                   CALL      'ARC002CLB'
     C                   PARM      'D2'          WATYPE            2
     C                   PARM                    ARUSER
     C                   END
     C                   ENDSR
