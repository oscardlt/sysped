********************************************************************
***** * Bestillingsprogram generering av EDI-faktura SYSPED internformat
********************************************************************
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX * 01 JOV PTF11 fange opp når ''NOE'' ligger i fila fra før - må få sendt det
11XXX * 02 JOV PTF11 sjekke om avregning via TRAVH - feil/ikke fleksibel staus i gml
********************************************************************
     FFAK9      IF   E           K DISK
     FCUIFAK    IF   E           K DISK
     Ftravv6    IF   E           K DISK
     Ftravh3    IF   E           K DISK
     Ftran      IF   E           K DISK
     Ffirm      IF   E           K DISK
     FINTFAS    IF   E           K DISK
     FSYKS37FB  CF   E             WORKSTN
      *
     D                 DS
     D  FAVT                   1     20
     D  FAVT1_2                1      2
     D  FAVT5_5                5      5
      *
     C     *ENTRY        PLIST
     C                   PARM                    NOE               1
     C                   MOVE      'N'           NOE
      *
      *  50 OFF - IKKE VIS TEKST "EDI INTERNFAKT ER KJØRT....."
     C                   SETOFF                                       50
      *  52 OFF - F5=KJØR ER TILLAT - 52 ON - IKKE VIS F5...
     C                   SETON                                        52
     C     Travh3Key     KLIST
     C                   KFLD                    THST
     C                   KFLD                    WSFAKT
     C     TranKey       KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    VMTRAN
     C     IntKey        KLIST
     C                   KFLD                    INST
     C                   KFLD                    WSSEID
     C                   KFLD                    WSMOID
     C                   KFLD                    WSFAKT
     C     *loval        setll     firm
     C                   read      firm
      *
     C     START         TAG
     C   51              SETON                                        52
     C                   EXFMT     BILDE
     C   03              GOTO      SLUTT
      *
     C                   SETOFF                                       5051
     C                   setoff                                       305354
     C                   MOVE      *blanks       AVREGN            1
     C                   MOVE      *blanks       AVRTXT
     C                   MOVE      *zeros        VMTRAN
     C                   MOVE      *blanks       VMNAVN
     C                   MOVE      *BLANKS       WSOPKO
     C                   MOVE      *ZEROS        WSKUNR
     C                   MOVE      *BLANKS       WSSEID
     C                   MOVE      *BLANKS       WSMOID
      * TESTER
     C     WSFAKT        CABEQ     0             START
     C     WSFAKT        SETLL     FAK9
     C     WSFAKT        READE     FAK9                                   51
     C     *IN51         DOWEQ     '0'
     C     FAKDA         CABNE     'K'           OKLIN
      * Kostn.linje KAN være "kreditnota/avregning"
     C     FAKDA         IFEQ      'K'
     C     FAVT1_2       ANDEQ     '*A'
     C     FAVT5_5       ANDEQ     '*'
     c     WSFAKT        Chain     TRAVV6                             33
     c     *in33         ifeq      *OFF
     C                   move      tvtunr        VMTRAN
     c                   else
S02  c*    Travh3Key     Chain     TRAVH3                             33
S02  C* N33              move      tvtunr        VMTRAN
N02  c                   move      'R'           THST
N02  c     Travh3Key     Chain     TRAVH3                             33
N02  c   33              move      'F'           THST
N02  c   33Travh3Key     Chain     TRAVH3                             33
N02  c   33              move      'O'           THST
N02  c   33Travh3Key     Chain     TRAVH3                             33
N02  C  N33              move      THTNR         VMTRAN
     C  N33              move      tvtunr        VMTRAN
     c                   end
     c     *in33         ifeq      *OFF
     c     TranKey       Chain     TRAN                               33
     c     *in33         ifeq      *OFF
     c                   move      VMTRKU        FAKUNR
     c                   MOVE      'J'           AVREGN
     C                   EVAL      AVRTXT = '(AVREGNING) Transp.:'
     c                   GOTO      OKLIN
     C                   END
     C                   END
      *
     C                   END
     C     WSFAKT        READE     FAK9                                   51
     C                   END
     C     OKLIN         TAG
     C     *IN51         IFEQ      *ON
     C                   MOVE      *ON           *IN30
     C                   MOVE      'JOV1408'     MSGNR
     C                   GOTO      START
     C                   END
     C                   MOVE      FAOPKO        WSOPKO
     C                   MOVE      FAKUNR        WSKUNR
     C     FAKUNR        CHAIN     CUIFAK                             51
     C     *IN51         IFEQ      *ON
     C                   MOVE      *ON           *IN30
     C                   MOVE      'JOV1409'     MSGNR
     C                   GOTO      START
     C                   END
     C                   MOVE      CISEID        WSSEID
     C                   MOVE      CIMOID        WSMOID
     C     WSSEID        COMP      *BLANKS                                51
     C  N51WSMOID        COMP      *BLANKS                                51
     C     *IN51         IFEQ      *ON
     C                   MOVE      *ON           *IN30
     C                   MOVE      'JOV1409'     MSGNR
     C                   GOTO      START
     C                   END
      *
      * Ikke F10 / sjekk om faktnr finnes fra før (F10 = kjør anyway)
     C     *in10         Ifne      '1'
     c                   move      ' '           INST
     c     INTKey        chain     INTFAS                             33
     c   33              move      'X'           INST
     c   33INTKey        chain     INTFAS                             33
     c  N33INST          ifeq      'X'
     C                   move      '1'           *in53                          F10 Tillatt
     c                   else
     C                   move      '1'           *in54                          F10 IKKE tilatt
N01  C                   MOVE      'J'           NOE                            finnes noe(fra før)
     c                   end
      * HVIS IKKE F5 TASTET (OG IKKE F10)  - VIS BILDE PÅ NY....
     C                   SETOFF                                       52         VIS F5
     C     *IN05         CABEQ     '0'           START
     C     *IN53         CABEQ     '1'           START
     C     *IN54         CABEQ     '1'           START
     c                   end
      *
      * F10=OMKJØR IKKE tillatt dersom status er blank
     C     *in10         Ifeq      '1'
     c                   move      ' '           INST
     c     INTKey        chain     INTFAS                             33
     C     *IN33         IFEQ      *OFF
     C                   SETOFF                                       52
     C                   move      '1'           *in54                          F10 IKKE tilatt
     C                   goto      START
     C                   END
     c                   end
      *
      * F5 (ELLER F10)  ER TASTET PÅ GYLDIG BILDE - KJØR....
     C                   MOVE      WSFAKT        UUFAKT            7
     C                   MOVE      WSKUNR        UUKUNR            8
     C                   CALL      'SYKS37'
     C                   PARM                    WSOPKO
     C                   PARM                    UUFAKT
     C                   PARM                    WSSEID
     C                   PARM                    WSMOID
     C                   PARM                    AVREGN
     C                   PARM                    UUKUNR
      * UT-PARAMETER - NOE ER KJØRT
     C                   MOVE      'J'           NOE
      * VIS KVITTERING/KLAR FOR NESTE
     C                   SETON                                        50
     C                   MOVE      *BLANKS       WSOPKO
     C                   MOVE      *ZEROS        WSFAKT
     C                   MOVE      *ZEROS        WSKUNR
     C                   MOVE      *BLANKS       WSSEID
     C                   MOVE      *BLANKS       WSMOID
     C                   MOVE      *blanks       AVREGN
     C                   MOVE      *blanks       AVRTXT
     C                   MOVE      *zeros        VMTRAN
     C                   MOVE      *blanks       VMNAVN
     C                   SETON                                        52
     C                   SETOFF                                       51
     C                   GOTO      START
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
     C     TSTGML        BEGSR
      *
     c                   move      ' '           INST
     c     INTKey        chain     INTFAS                             55
     c  n55              move      'X'           INST
     c  n55INTKey        chain     INTFAS                             55
     c                   endsr
