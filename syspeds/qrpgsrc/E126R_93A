     FEIMD93A   IF   E           K DISK
     FELIN93A   IF   E           K DISK
     FEMOA93A   IF   E           K DISK
     FEPIA93A   IF   E           K DISK
     FEPRI93A   IF   E           K DISK
     FEQTY93A   IF   E           K DISK
     FVAREL01   IF   E           K DISK
     FE126D     CF   E             WORKSTN
     F                                     SFILE(E126D01:ZRECNO)
     F                                     INFDS(FBAREA)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  A                      1     15
     D                                     DIM(15)
     D  A15                    1     15
     D                 DS
     D  B                      1     15
     D                                     DIM(15)
     D  B15                    1     15
      *
     C                   EXSR      INIT
      *
     C     START         TAG
     C                   MOVE      '1'           *IN(93)
     C                   WRITE     E126D02
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     LIN22K        SETLL     ELIN93A
     C     START1        TAG
     C     LIN22K        READE     ELIN93A                                94
      *
     C     START2        TAG
      *
     C  N94              DO
     C                   DO        999
     C                   EXSR      HDATA
     C                   ADD       1             ZRECNO
     C                   WRITE     E126D01
     C     LIN22K        READE     ELIN93A                                94
     C  N94              END
     C                   END
      *
     C                   Z-ADD     ZRECNO        XRECNO            5 0
     C     ZRECNO        IFGT      0
     C                   Z-ADD     1             ZRECNO
     C                   END
     C     START3        TAG
     C                   Z-ADD     4             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   EXFMT     E126D04
     C                   ELSE
     C                   WRITE     E126D03
     C                   EXFMT     E126D02
     C                   END
      *
     C                   MOVE      '0'           *IN30
     C                   MOVEA     '00'          *IN(98)
      *
     C   03              Z-ADD     3             UFLAGG
     C   03              GOTO      SLUTT
     C   05              GOTO      START
     C   12              Z-ADD     1             UFLAGG
     C   12              GOTO      SLUTT
     C   25              GOTO      START2
      *
     C     W2LN          IFNE      0
     C     W2LN          IFGT      XRECNO
     C                   Z-ADD     XRECNO        ZRECNO
     C                   ELSE
     C                   Z-ADD     W2LN          ZRECNO
     C                   END
     C                   MOVE      *ZEROS        W2LN
     C                   END
     C                   GOTO      START3
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
      ***********************************************
     C     HDATA         BEGSR
      ***********************************************
      * Hent linjernr.
     C                   Z-ADD     LREP0         XLN
      * Hent varenr.
     C                   MOVE      *BLANKS       XVN
     C                   MOVE      *BLANKS       A15
     C     PIA22K        SETLL     EPIA93A                                33
     C     *IN33         IFEQ      '1'                                          1<-B
     C     PIA22K        READE     EPIA93A                                33
     C     *IN33         DOWEQ     '0'                                           2<-B
     C     P7143A        IFEQ      'SA '                                          3<-B
     C                   MOVEL     P7140A        A15
     C                   MOVE      '1'           *IN33
     C                   ENDIF                                                    3<-E
     C  N33PIA22K        READE     EPIA93A                                33
     C  N33              ENDDO                                                   2<-E
     C                   ENDIF                                                  1<-E
     C     A15           IFEQ      *BLANKS                                      1<-B
     C                   MOVEL     L7140         A15
     C                   ENDIF                                                  1<-E
     C     1             DO        15            XN                3 0          1<-B
     C     16            SUB       XN            XN2               3 0
     C     A(XN2)        IFNE      ' '                                           2<-B
     C     16            SUB       XN2           XN
     C     1             DO        XN2           XN3               3 0            3<-B
     C                   MOVE      A(XN3)        B(XN)
     C                   ADD       1             XN
     C                   ENDDO                                                    3<-E
     C                   MOVE      B15           XVN
     C                   Z-ADD     16            XN
     C                   ENDIF                                                   2<-E
     C                   ENDDO                                                  1<-E
      *
     C     VARE1K        CHAIN     VAREL01                            33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     VARTE1        XVTXT
     C                   MOVEL     VAREGR        XAN03             3
     C                   MOVE      XAN03         XVGR
     C                   ELSE
     C                   MOVE      *BLANKS       XVTXT
     C                   MOVE      *BLANKS       XVGR
     C                   END
      * Hent varetekst
     C     IMD22K        SETLL     EIMD93A                                33
     C     *IN33         IFEQ      '1'                                          1<-B
     C     IMD22K        READE     EIMD93A                                33
     C     *IN33         DOWEQ     '0'                                           2<-B
     C     I7077         IFEQ      'FL '                                          3<-B
     C                   MOVEL     I7008A        XVTXT
     C                   MOVE      '1'           *IN33
     C                   ENDIF                                                    3<-E
     C  N33IMD22K        READE     EIMD93A                                33
     C  N33              ENDDO                                                   2<-E
     C                   ENDIF                                                  1<-E
      * Hent antall
     C                   MOVE      *ZEROS        XNT
     C     QTY22K        SETLL     EQTY93A                                33
     C     *IN33         IFEQ      '1'                                          1<-B
     C     QTY22K        READE     EQTY93A                                33
     C     *IN33         DOWEQ     '0'                                           2<-B
     C     Q6063         IFEQ      '47 '                                          3<-B
     C                   MOVEL     Q6060         A15
     C                   EXSR      HTALL
     C                   Z-ADD     XTALL         XNT
     C                   MOVE      '1'           *IN33
     C                   ENDIF                                                    3<-E
     C  N33QTY22K        READE     EQTY93A                                33
     C  N33              ENDDO                                                   2<-E
     C                   ENDIF                                                  1<-E
     C                   ADD       XNT           WSNT
      * Hent enhets pris
     C                   MOVE      *ZEROS        XPRIS
     C     PRI25K        SETLL     EPRI93A                                33
     C     *IN33         IFEQ      '1'                                          1<-B
     C     PRI25K        READE     EPRI93A                                33
     C     *IN33         DOWEQ     '0'                                           2<-B
     C     P5125         IFEQ      'AAB'                                          3<-B
     C                   MOVEL     P5118         A15
     C                   EXSR      HTALL
     C                   Z-ADD     XTALL         XPRIS
     C                   MOVE      '1'           *IN33
     C                   ENDIF                                                    3<-E
     C  N33PRI25K        READE     EPRI93A                                33
     C  N33              ENDDO                                                   2<-E
     C                   ENDIF                                                  1<-E
      * Hent rabatt
     C                   MOVE      *ZEROS        XRABAT
     C     MOA38K        SETLL     EMOA93A                                33
     C     *IN33         IFEQ      '1'                                          1<-B
     C     MOA38K        READE     EMOA93A                                33
     C     *IN33         DOWEQ     '0'                                           2<-B
     C                   MOVEL     M5004         A15
     C                   EXSR      HTALL
     C                   ADD       XTALL         XRABAT
     C  N33MOA38K        READE     EMOA93A                                33
     C  N33              ENDDO                                                   2<-E
     C                   ENDIF                                                  1<-E
      * Hent linjesum
     C                   MOVE      *ZEROS        XTOTL
     C     MOA23K        SETLL     EMOA93A                                33
     C     *IN33         IFEQ      '1'                                          1<-B
     C     MOA23K        READE     EMOA93A                                33
     C     *IN33         DOWEQ     '0'                                           2<-B
     C     M5025         IFEQ      '203'                                          3<-B
     C                   MOVEL     M5004         A15
     C                   EXSR      HTALL
     C                   Z-ADD     XTALL         XTOTL
     C                   MOVE      '1'           *IN33
     C                   ENDIF                                                    3<-E
     C  N33MOA23K        READE     EMOA93A                                33
     C  N33              ENDDO                                                   2<-E
     C                   ENDIF                                                  1<-E
     C                   ADD       XTOTL         WSTOT
      *
     C                   ENDSR
      *
      ***********************************************
     C     HTALL         BEGSR
      ***********************************************
     C                   MOVE      'N'           XKAMMA            1
     C                   MOVE      *ZEROS        XTALL            15 2
     C                   Z-ADD     100           XFAKT             3 0
     C     1             DO        15            XN
     C                   SELECT
     C     A(XN)         WHENGE    '0'
     C     A(XN)         ANDLE     '9'
     C                   MULT      10            XTALL
     C                   MOVE      A(XN)         XTALL
     C     XKAMMA        IFEQ      'J'
     C                   DIV       10            XFAKT
     C                   END
     C     A(XN)         WHENEQ    ','
     C                   MOVE      'J'           XKAMMA
     C     A(XN)         WHENEQ    '-'
     C                   Z-SUB     XFAKT         XFAKT
     C                   OTHER
     C                   ADD       15            XN
     C                   ENDSL
     C                   ENDDO
     C                   MULT      XFAKT         XTALL
      *
     C                   ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     IMD22K        KLIST
     C                   KFLD                    UMN
     C                   KFLD                    YGN22
     C                   KFLD                    LREP0
     C     LIN22K        KLIST
     C                   KFLD                    UMN
     C                   KFLD                    YGN22
     C     *LIKE         DEFINE    LGN           YGN22
     C                   Z-ADD     22            YGN22
     C     MOA23K        KLIST
     C                   KFLD                    UMN
     C                   KFLD                    YGN23
     C                   KFLD                    LREP0
     C     *LIKE         DEFINE    MGN           YGN23
     C                   Z-ADD     23            YGN23
     C     MOA38K        KLIST
     C                   KFLD                    UMN
     C                   KFLD                    YGN38
     C                   KFLD                    LREP0
     C     *LIKE         DEFINE    MGN           YGN38
     C                   Z-ADD     38            YGN38
     C     PIA22K        KLIST
     C                   KFLD                    UMN
     C                   KFLD                    YGN22
     C                   KFLD                    LREP0
     C     PRI25K        KLIST
     C                   KFLD                    UMN
     C                   KFLD                    YGN25
     C                   KFLD                    LREP0
     C     *LIKE         DEFINE    PGN           YGN25
     C                   Z-ADD     25            YGN25
     C     QTY22K        KLIST
     C                   KFLD                    UMN
     C                   KFLD                    YGN22
     C                   KFLD                    LREP0
     C     VARE1K        KLIST
     C                   KFLD                    FIRMA
     C                   KFLD                    XVN
      *
     C     *ENTRY        PLIST
     C                   PARM                    UMN               9 0
     C                   PARM                    UFN              10
     C                   PARM                    UKON              7
     C                   PARM                    UFLAGG            1 0
      *
     C                   MOVE      '01'          FIRMA
      *
     C                   ENDSR
      *
