********************************************************************
      * motta IFTSTA fra TOLLPOST
      * (SH tatt utg.pkt i Nortrail. CE01R (fra CE) - bygd om for tollpost sommeren 2008 (A13))
      * (JOV - Kommentar - Kunne også benyttet E162R_96A ....)
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 AVD/OPPD i DS ikke hensyntatt (+ fjernet noen unødige variable mm)
10XXX * 01 JOV PTF10 LEGG "TOLLPOST" I TTNAME DERSOM DET ER BLANKT
10XXX * 02 sh  PTF10 feil i oppdragsnummer test  takle v9 og v10
10XXX * 03 JOV PTF10 Nye event-koder
10XXX * 04 JOV PTF10 Ny  event-kode (mypack)
10172 * 05 SH  PTF10 norsk text til Track and trace
********************************************************************
     H DATEDIT(*YMD)
     FTRACKL02  IF A E           K DISK
     FHEADF     UF   E           K DISK
     FFIRM      UF   E           K DISK
     FFRISOK    IF A E           K DISK
     FKODFRI    IF   E           K DISK
     FECMSG     IF   E           K DISK
     FECNI96A   IF   E           K DISK
     FEDTM96A   IF   E           K DISK
     FENAD96A   IF   E           K DISK
     FERFF96A   IF   E           K DISK
     FESTS96A   IF   E           K DISK
     D                 DS
     D  HEKLMO                 1      4  0
     D  HEKLMOA                1      4
     D                 DS
     D  WMN2                   1      9  0
     D                 DS
N02  D  AVOPSI                 1     16
N02  D  AV                     1      4
N02  D  SL1                    5      5
N02  D  OP                     6     12
N02  D  OPV9                   6     10
N02  D  SL2                   13     13
N02  D  SL2V9                 11     11
N02  D  SI                    14     16
N02  D  SIV9                  12     14
     D                 DS
     D  HEDTÅ                  1      4  0
     D  HEDTM                  5      6  0
     D  HEDTD                  7      8  0
     D  HEDTOP                 1      8  0
      *
     D  W1             C                   'Arrived distribution terminal'
N03  D  WA1            C                   'Arrived distribution terminal'
N03  D  W13            C                   'Collected at sender'
     D  W20            C                   'Placed in warehouse'
     D  W21            C                   'Delivered customer'
N04  D  W41            C                   'Handed over to service partner'
N04  D  W43            C                   'Arrived at service partner'
N04  D  W45            C                   'Adviced via SMS or eMail'
     D  W48            C                   'Loaded distribution container'
     D  W56            C                   'Delivery to customer failed'
     D  W113           C                   'Loaded distribution truck'
N04  D  W276           C                   'Return form service partner'
     D  WOTH           C                   'Code not defined'
n05  D  W1L            C                   'Ankommet distribusjonsterminal'
n05  D  WA1L           C                   'Ankommet distribusjonsterminal'
n05  D  W13L           C                   'Hentet hos avsender'
n05  D  W20L           C                   'Plassert på lager'
n05  D  W21L           C                   'Delivered customer'
n05  D  W41L           C                   'Levert over til service partner'
n05  D  W43L           C                   'Ankommet hos service partner'
n05  D  W45L           C                   'Advisert via SMS eller EPOST'
n05  D  W48L           C                   'Lastet på distribusjonscontainer'
n05  D  W56L           C                   'Levering hos kunde misslykket'
n05  D  W113L          C                   'lastet på distribusjonsbil'
n05  D  W276L          C                   'Returblankett fra  service partner'
n05  D  WOTHL          C                   'Kode ikke definert'
      */////////////
      * MAIN LOGIC /
      */////////////
      *___________
      * Initiering
      *"""""""""""
     C                   EXSR      INIT
      *________
      * CONVERT
      *""""""""
     C                   EXSR      RTVD
      *
     C                   MOVE      '1'           *INLR
      *
      *////////////////////////////////////////////////////////////
      *                                                      INIT /
      *////////////////////////////////////////////////////////////
     c**************************************************************
     C     INIT          BEGSR
     c**************************************************************
     C     KEYMS0        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN0
     C     KEYMS1        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN1
     C                   KFLD                    CREP0
     C     KEYMS2        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN1
     C                   KFLD                    CREP0
     C                   KFLD                    SREP1
     C     HEADK         KLIST
     C                   KFLD                    ZEAVD
     C                   KFLD                    ZEOPD
     C     FRIKEY        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    WSKODE
     C* Hente dagens dato og klokkeslett.
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
      *
      *
     C     *LIKE         DEFINE    NMN           ZMN
     C     *LIKE         DEFINE    NGN           ZGN0
     C     *LIKE         DEFINE    CGN           ZGN1
     C     *LIKE         DEFINE    HEAVD         ZEAVD
     C     *LIKE         DEFINE    HEOPD         ZEOPD
     C     *LIKE         DEFINE    FSKODE        WSKODE
     C     *LIKE         DEFINE    FSKODE        WSKODE2
     C     *LIKE         DEFINE    ECIIDC        ECIIDCX
     C                   MOVEL     'S'           WCSR              1
     C                   MOVEL     'IFTSTA'      WC0065            6
     C                   read      firm                                   50
     C                   MOVEL     'POD'         WSKODE
      * INIT WORKFIELDS
      *
     C     *ENTRY        PLIST
     C                   PARM                    WMN1              9
     C                   MOVEL     WMN1          WMN2
     C                   Z-ADD     WMN2          ZMN
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * RETREIVE INFO FROM EDIFACT DATABASE                  RTVD /
      *////////////////////////////////////////////////////////////
     C******************************************************************
     C     RTVD          BEGSR
     C******************************************************************
      *_______________________
      * READ ALL MAIN SEGMENTS
      *"""""""""""""""""""""""
      * CNI05
     C                   MOVE      '0'           *IN50
     C                   Z-ADD     4             ZGN0
     C     KEYMS0        SETLL     ECNI96A
     C     KEYMS0        READE     ECNI96A                                50
     C     *IN50         DOWEQ     *OFF
     C                   EXSR      RTVD2
     C     KEYMS0        READE     ECNI96A                                50
     C  N50              ENDDO
     C                   ENDSR
     C******************************************************************
     C     RTVD2         BEGSR
     C******************************************************************
     C                   Z-ADD     5             ZGN1
     C                   MOVE      '0'           *IN51
     C     KEYMS1        setll     ESTS96A
     c     *in51         doweq     '0'
      * STS05
     C     KEYMS1        READE     ESTS96A                                51
      * RFF05
     C     *in51         IFEQ      '0'
     C     KEYMS2        CHAIN     ERFF96A                            52
     C
     C  N52              do
     C                   MOVEL     R1154         AVOPSI
     C     SL1           IFNE      '/'
E02  C     SL2           IFNE      '/'
N02  C     SL2V9         ANDNE     '/'
     C                   GOTO      NYLES
N02  C                   END
     C                   END
     C                   END
      * DTM05
     C                   MOVE      '0'           *IN52
     C     KEYMS2        CHAIN     EDTM96A                            52
      * NAD05
     C                   MOVE      '0'           *IN52
     C     KEYMS2        CHAIN     ENAD96A                            52
     C     *IN52         IFEQ      *ON
     C                   MOVE      *BLANKS       N3124A
     C                   ENDIF
     C                   EXSR      SR
     C                   end
     C                   end
     C     NYLES         ENDSR
      ***********************************************
     C     SR            BEGSR
      ***********************************************
s01  C*                  MOVEL     'E160R_'      UPGM              9
s01  C*                  MOVE      '96A'         UPGM
      *
S02  C*    4             SUBST     R1154:1       ZEAVDA            4
S02  C*    7             SUBST     R1154:6       ZEOPDA            7
N02  C                   MOVE      AV            ZEAVDA            4
N02  C                   MOVE      *ZEROS        ZEOPDA            7
N02  C     SL2V9         IFEQ      '/'
N02  C                   MOVE      OPV9          ZEOPDA
N02  C                   ELSE
N02  C                   MOVE      OP            ZEOPDA
N02  C                   END
     C                   MOVEL     ZEAVDA        ZEAVD
     C                   MOVEL     ZEOPDA        ZEOPD
s01  C*                  MOVEL     ZEAVDA        URFF              9
s01  C*                  MOVE      ZEOPDA        URFF
     C     HEADK         CHAIN     HEADF                              51
     C     *IN51         IFEQ      *OFF
      *---------------------------------------
      * OPPDATER DATO, KLOKKE OG SIGNATUR
      *---------------------------------------
     C     8             SUBST     D2380:1       UEDTMO            8
     C     4             SUBST     D2380:9       UEKLMO            4
     C     S9011         IFEQ      '012'
     C     S9011         OREQ      '21 '
     C     S9011         OREQ      '113'
     C                   MOVEL     N3124A        HESGM
     C     N3124A        IFEQ      *blanks
     C                   MOVEL     'TOLLPOST'    HESGM
     C                   end
     C                   MOVEL     UEDTMO        HEDTMO
     C                   MOVEL     UEKLMO        HEKLMO
     C                   ENDIF
     C                   MOVEL     S9011         HELB
     C                   UPDATE    HEADFR
      *
      *---------------------------------------
      * OPPDATER FRI SØKEVEI MED POD
      *---------------------------------------
      *
     C     s9011         ifeq      '21 '
     C                   CLEAR                   frisokr
     C     FRIKEY        CHAIN     FRISOK                             51
     C     *in51         ifeq      '1'
     C                   move      ZEAVD         fsavd
     C                   move      ZEOPD         fsopd
     C                   move      'POD'         fskode
     C                   MOVEL     'DT:'         FSSOK
     C     FSSOK         CAT       HEDTMO:1      FSSOK
     C     FSSOK         CAT       'TM:':1       FSSOK
     C     FSSOK         CAT       HEKLMOA:1     FSSOK
     C                   MOVE      HEDTOP        FSDTOP
     C     FSKODE        CHAIN     KODFRI                             33
     C  N33              MOVE      KFSODK        FSDOKK
     C                   write     frisokr
     C                   end
     C                   end
      *
      *
      *---------------------------------------
      * OPPDATER TRACK AND TRACE
      *------------------CE01R  --------------
      *
      * OPPDATER TRACK&TRACE
      *
     C     TRACKK        KLIST
     C                   KFLD                    TTAVD
     C                   KFLD                    TTOPD
     C                   KFLD                    TTFBNR
     C                   KFLD                    TTACTI
     C                   CLEAR                   TRACKFR
      *
     C                   MOVEL     ZEAVDA        TTAVD
     C                   MOVEL     ZEOPDA        TTOPD
     C                   MOVE      *ZEROS        TTFBNR
N01  C                   MOVE      'S'           TTMANU
     C     s9011         ifeq      '21 '
S01  C*                  MOVE      'S'           TTMANU
     C                   MOVEL     'POD'         TTACTI
     C                   else
s01  C*                  MOVE      ' '           TTMANU
     C                   MOVEL     'MOV'         TTACTI
     c                   end
     C                   MOVEL     D2380         TTDATE
     C     4             SUBST     D2380:9       WTTTIME           4
     C                   MOVE      WTTTIME       TTTIME
     C     TTTIME        MULT      100           TTTIME
     C                   MOVEL     s9011         TTTEXT
n05  C                   MOVEL     s9011         TTTEXL
     C                   SELECT
     C     S9011         WHENEQ    '1  '
     C                   CAT       W1:1          TTTEXT
N05  C                   CAT       W1L:1         TTTEXL
      *
N03  C     S9011         WHENEQ    'A1 '
N03  C                   CAT       WA1:1         TTTEXT
N05  C                   CAT       WA1L:1        TTTEXL
N03   *
N03  C     S9011         WHENEQ    '13 '
N03  C                   CAT       W13:1         TTTEXT
N05  C                   CAT       W13L:1        TTTEXL
      *
     C     S9011         WHENEQ    '20 '
     C                   CAT       W20:1         TTTEXT
n05  C                   CAT       W20L:1        TTTEXL
      *
     C     S9011         WHENEQ    '21 '
     C                   CAT       W21:1         TTTEXT
N05  C                   CAT       W21L:1        TTTEXL
N04   *
N04  C     S9011         WHENEQ    '41 '
N04  C                   CAT       W41:1         TTTEXT
N05  C                   CAT       W41L:1        TTTEXL
N04   *
N04  C     S9011         WHENEQ    '43 '
N04  C                   CAT       W43:1         TTTEXT
N05  C                   CAT       W43L:1        TTTEXL
N04   *
N04  C     S9011         WHENEQ    '45 '
N04  C                   CAT       W45:1         TTTEXT
N05  C                   CAT       W45L:1        TTTEXL
      *
     C     S9011         WHENEQ    '48 '
     C                   CAT       W48:1         TTTEXT
     C                   CAT       W48:1         TTTEXL
      *
     C     S9011         WHENEQ    '56 '
     C                   CAT       W56:1         TTTEXT
n05  C                   CAT       W56L:1        TTTEXL
      *
     C     S9011         WHENEQ    '113'
     C                   CAT       W113:1        TTTEXT
n05  C                   CAT       W113L:1       TTTEXl
N04   *
N04  C     S9011         WHENEQ    '276'
N04  C                   CAT       W276:1        TTTEXT
N05  C                   CAT       W276L:1       TTTEXL
N04   *
     C                   OTHER
     C                   CAT       WOTH:1        TTTEXT
N05  C                   CAT       WOTHL:1       TTTEXL
     C                   ENDSL
N04   *
     C                   MOVEL     WDT           TTDATL
     C                   MOVEL     WTM           TTTIML
     C                   EVAL      TTEDEV=S9011
     C                   EVAL      TTEDRE=S9013A
     C                   EVAL      TTNAME=N3124A
     C                   IF        N3124A=*BLANKS
     C                   EVAL      TTNAME=N3036A
     C                   ENDIF
XX   C                   IF        TTNAME=*BLANKS
XX   C                   EVAL      TTNAME='TOLLPOST'
XX   C                   ENDIF
     C                   MOVEL     'TOLLPOST'    TTUSER
     C                   WRITE     TRACKFR
     c                   END
     C                   ENDSR
