********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 Nullstiller witaxd   ...
10XXX * 02 SH  PTF10 tar bruker fra anne sted
10186 * 03 JOV PTF10 takl endret omr-faktor, men kun om beløp ulik 0 (før KABL div
10186 * 04 SH  PTF10 BRUKE VALKURS1 FRA VALUF
10186 * 05 SH  PTF10 SETTE STATUS 1 PÅ KOSTA HVIS 1.GANGSOPPDATERING
10XXX * 06 YBC PTF10 IKKE SETT 2000000 PÅ BILAGSDATO VED SPØRRING
10XXX * 07 SH  PTF10 Eget kall ved direkteføring økonomi
10XXX * 08 SH  PTF11 sende epost
10XXX * 09 SH  PTF11 IKKE KUNNE ENDRE HVIS 1, GANGS REG
10XXX * 10 SH  PTF12 brukerstyring
10XXX * 11 SH  PTF12 div cursorendringer
10XXX * 12 SH  PTF12 teste signaturkode + søk
10XXX * 13 SH  PTF12 F23 godta dubletter
********************************************************************
      *
      *
      **************************************************************
      *** PROGRAM FOR Å REGISTRERE "KREDITSIDA"I KOSTN.BILAG    ***
      **************************************************************
      *
N12  FKODTSF    IF   E           K DISK
     FKOSTA     UF A E           K DISK
     FKOSTA2    IF   E           K DISK
     F                                     RENAME(KOSTAR:KOSTA2R)
     FKOSTA14   IF   E           K DISK
     F                                     RENAME(KOSTAR:KOST14R)
     FKOSBU5    IF   E           K DISK
     FKOSTT     UF A E           K DISK
     FKODTKSB   IF   E           K DISK
     FKODTÅ     IF   E           K DISK
     FKODTGE    IF   E           K DISK
     FKODTG2    IF   E           K DISK
     FFIRM      IF   E           K DISK
     FLEVEL01   IF   E           K DISK
     FVALUL01   IF   E           K DISK
     FKODWL01   IF   E           K DISK
     FSYPARL1   IF   E           K DISK
     FSYKS02FM  CF   E             WORKSTN
     F                                     INFDS(FBAREA)
     D*
     D*
      *___________________________
      * Finner username
      *"""""""""""""""""""""""""""
n02  D                SDS
n02  D  UUSER                254    263
     D FBAREA          DS
     D  WSID                 197    206
     D  USCLOC               370    371B 0
     D  USSUBN               378    379B 0
     D                 DS
     D  WSBDT                  1      6  0
     D  WSBDTD                 1      2  0
     D  WSBDTM                 3      4  0
     D  WSBDTÅ                 5      6  0
     D                 DS
     D  W2BDT                  1      8  0
     D  W2BDTÅ                 1      4  0
     D  W2BDTM                 5      6  0
     D  W2BDTD                 7      8  0
     D                 DS
     D  KABDT                  1      8  0
     D  KABDTÅ                 1      4  0
     D  KABDTM                 5      6  0
     D  KABDTD                 7      8  0
     D                 DS
     D  WSFDT                  1      6  0
     D  WSFDTD                 1      2  0
     D  WSFDTM                 3      4  0
     D  WSFDTÅ                 5      6  0
     D                 DS
     D  KAFDT                  1      8  0
     D  KAFDTÅ                 1      4  0
     D  KAFDTM                 5      6  0
     D  KAFDTD                 7      8  0
     D                 DS
     D  WSFFDT                 1      6  0
     D  WSFFDD                 1      2  0
     D  WSFFDM                 3      4  0
     D  WSFFDÅ                 5      6  0
     D                 DS
     D  KAFFDT                 1      8  0
     D  KAFFDÅ                 1      4  0
     D  KAFFDM                 5      6  0
     D  KAFFDD                 7      8  0
     D                 DS
     D  XTIME                  1     14  0
     D  XTM                    1      6  0
     D  XDG                    7      8  0
     D  XMN                    9     10  0
     D  XÅR                   11     14  0
     D  XÅRTO                 13     14  0
     D                 DS
     D  KADTE                  1      8  0
     D  KAÅRE                  1      4  0
     D  KAMNE                  5      6  0
     D  KADGE                  7      8  0
     D                 DS
     D  WSDTE                  1      6  0
     D  WSDTED                 1      2  0
     D  WSDTEM                 3      4  0
     D  WSDTEÅ                 5      6  0
     D                 DS
     D  KADTR                  1      8  0
     D  KADTRÅ                 1      4  0
     D  KADTRM                 5      6  0
     D  KADTRD                 7      8  0
     D                 DS
     D  WSDTR                  1      6  0
     D  WSDTRD                 1      2  0
     D  WSDTRM                 3      4  0
     D  WSDTRÅ                 5      6  0
     D                 DS
     D  WSTXT                  1     35
     D  WSTXT1                 1      3
     D  WSTXT2                 4     35
     D                 DS
     D  WITAXD                 1      8  0
     D  MVAATW                 1      4  0
     D  MVAMTW                 5      6  0
     D  MVADTW                 7      8  0
      *
      * PARAMETERSTRENG FOR KALL PÅ SYKS12
     D                 DS
     D  P1DS                   1    256
     D  P1FLAG                 1      1
     D  P1BNR                  2      8  0
     D  P1AVD                  9     12  0
     D  P1TUNR                13     20  0
     D  P1OAVD                21     24  0
     D  P1OPD                 25     31  0
     D  P1BL                  32     44  2
     D  P1GN                  45     63
     D  P1KDM                 64     64
      *
      *
      * Parameterliste HR916/HR917
      *
     D                 DS
     D  PLKID                  1     25
     D  PRC                   26     26
     D  PARMD3                 1     26
     D                 DS
     D  SYVRDA                 1     50
     D   Arktype               1      2
     D   Attprt                3     12
      *----------------------------------------------------------------
s02  D*               UDS
s02  D* UUSER                401    410
     IKOSTA2R
     I              KAST                        XAST
     I              KABNR                       XABNR
     I              KABDT                       XABDT
     I              KAPCC                       XAPCC
     I              KAPÅR                       XAPÅR
     I              KAPMN                       XAPMN
     I              KALNR                       XALNR
     I              KAVAL                       XAVAL
     I              KABL                        XABL
     I              KAVK                        XAVK
     I              KAVKU                       XAVKU
     I              KAOMRF                      XAOMRF
     I              KAFNR                       XAFNR
     I              KAFDT                       XAFDT
     I              KAFFDT                      XAFFDT
     I              KABB                        XABB
     I              KASG                        XASG
     I              KALKID                      XALKID
     I              KARNR                       XARNR
     I              KATAVD                      XATAVD
     I              KATUNR                      XATUNR
     I              KAOAVD                      XAOAVD
     I              KAOPD                       XAOPD
     I              KABLST                      XABLST
     I              KATXT                       XATXT
     I              KABNR2                      XABNR2
     I              KAMVA                       XAMVA
     I              KABLM                       XABLM
     I              KAUSER                      XAUSER
     I              KADTE                       XADTE
     I              KATME                       XATME
     I              KAJOUR                      XAJOUR
     I              KADTR                       XADTR
     I              KATDR                       XATDR
     C*
     C                   EXSR      INIT
     C   29              GOTO      START3                                        *OPT 5
     C   28              GOTO      START2                                        *0PT 2
     C*
     C     START         TAG
     C     UTYPE         IFEQ      1
     C     *IN30         ANDEQ     '0'
     C                   MOVE      *ZEROS        WSBNR
     C                   END
N11  C* litt rå endring her
N11  C     *IN30         IFEQ      '0'
N11  C                   Z-ADD     5             LINNBR                          *BILAGSDATO
N11  C                   Z-ADD     38            POSNBR
N11  c     WSBNR2        IFNE      0
N11  C                   Z-ADD     7             LINNBR                          *BILAGSNR
N11  c                   end
N11  C                   END
     C     GMBNR         COMP      *ZEROS                                 88
     C     GMBNR2        COMP      *ZEROS                                 89
     C                   EXSR      KDTFM1
     C                   EXFMT     BILDE01
     C*
     C   03              GOTO      SLUTT2
     C*
     C***
     C     WSPMN         IFEQ      0
     C                   MOVE      WSBDTM        WSPMN
     C                   MOVE      WSBDTÅ        WSPÅR
     C                   END
     C     WSPMN         IFEQ      0
     C                   MOVE      *ZEROS        WSPCC
     C                   ELSE
     C     WSPÅR         IFGT      50
     C                   MOVE      '19'          WSPCC
     C                   ELSE
     C                   MOVE      '20'          WSPCC
     C                   END
     C                   END
     C                   MOVE      *ZEROS        GMBNR
     C                   MOVE      *ZEROS        GMBNR2
      *
      * Gå til budsjettsystem for å komponere  bilag av budsj.poster
     C     *IN08         IFEQ      '1'
     C* Endring via ENDELIG BILNR eller Innreg.nr (bygge videre på..)
     C* ... eller (hvis ikke tilslag) lage ny med gitt endelig bilagsnr
     C     WSBNR2        IFGT      *ZEROS
     C     WSBNR2        CHAIN     KOSTA14                            98
     C   98WSBNR2        CHAIN(N)  KOSTA                              98
     C  N98              MOVE      KABNR2        WSBNR2
     C  N98              MOVE      KABNR         WSBNR
     C   98              MOVE      *ZEROS        WSBNR
     C                   END
     C                   EXSR      BUDSR
     C                   ENDIF
      *
      * Direkte til fordelingsbildet via inntastet Bilagsnr (KABNR2)
     C     *IN10         IFEQ      '1'
     C                   EXSR      DIREKT
     C                   GOTO      START
     C                   ENDIF
      *
     C                   SETOFF                                       30
     C                   MOVEA     '0000'        *IN(96)
     C                   MOVE      '0'           *IN94
     C                   EXSR      KDTFM1
     C*
     C                   EXSR      TESTB1
     C   30              GOTO      START
     C*
     C     START2        TAG
     C*
     C     WSLNR         IFNE      0
     C     LEVE1K        CHAIN     LEVEL01                            99
     C  N99              MOVEL     LNAVN         WSSNAV
     C                   END
     C     WSBDT         IFNE      *ZEROS
     C     WSPMN         ANDNE     *ZEROS
     C  N30
     CANN04              Z-ADD     10            LINNBR
     C  N30
     CANN04              Z-ADD     38            POSNBR
     C                   ELSE
     C  N30
     CANN04              Z-ADD     7             LINNBR
     C  N30
     CANN04              Z-ADD     38            POSNBR
     C                   END
     C                   EXSR      KDTFM1
     C                   Z-SUB     WSBL          WSBL
     C                   Z-SUB     WSBLM         WSBLM
     C                   EXFMT     BILDE02
     C                   Z-ADD     FITAX         WITAX
     C                   Z-ADD     FITAXD        WITAXD
     C                   Z-ADD     FITAX2        WITAX2
     C     WSMVA         IFNE      'P'
     C     WSMVA         ANDNE     'F'
     C     WSMVA         ANDNE     '+'
     C     WSMVA         ANDNE     ' '
     C     KODWKY        CHAIN     KODWL01                            35
     C     *IN35         IFEQ      *OFF
     C     MVAAVI        DIV       100           WITAX
     C     GMVATW        DIV       100           WITAX2
     C                   ELSE
     C                   Z-ADD     0             WITAX
     C                   Z-ADD     0             WITAX2
     C                   ENDIF
     C                   ENDIF
     C   03              GOTO      SLUTT
     C                   Z-SUB     WSBL          WSBL
     C                   Z-SUB     WSBLM         WSBLM
     C                   SETOFF                                       309291
     C                   MOVEA     '0000'        *IN(96)
     C                   MOVE      '0'           *IN94
     C                   EXSR      KDTFM1
     C*
     C     USCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     USSUBN        XRECNO            4 0
     C*
     C   04              DO
     C     LINNBR        IFEQ      9
     C                   CALL      'SYKS52A'
     C                   PARM                    WSTXT
     C                   Z-ADD     10            LINNBR
     C                   Z-ADD     38            POSNBR
     C                   ELSE
     C                   EXSR      SØKDTA
     C                   END
     C                   GOTO      START2
     C                   END
      *
     C     WSPMN         IFEQ      0
     C                   MOVE      WSBDTM        WSPMN
     C                   MOVE      WSBDTÅ        WSPÅR
     C                   END
     C     WSPMN         IFEQ      0
     C                   MOVE      *ZEROS        WSPCC
     C                   ELSE
     C     WSPÅR         IFGT      50
     C                   MOVE      '19'          WSPCC
     C                   ELSE
     C                   MOVE      '20'          WSPCC
     C                   END
     C                   END
     C* Hent tekst via kortkode
     C     WSTXT1        IFNE      *BLANKS
     C     WSTXT2        ANDEQ     *BLANKS
     C     WSTXT1        CHAIN     KODTKSB                            33
     C     *IN33         IFEQ      '0'
     C                   MOVE      KOKSTX        WSTXT
     C                   END
     C                   END
      * Gå til budsjettsystem for å komponere  bilag av budsj.poster
     C     *IN08         IFEQ      '1'
     C                   EXSR      BUDSR
     C                   EXSR      TESTB1
     C                   GOTO      START2
     C                   ENDIF
      *
     C* AVBRYT
     C   12              DO
     C     WSBNR         CHAIN     KOSTA                              33
     C     UTYPE         IFNE      5
     C  N33              MOVE      ' '           KAST
     C                   END
     C  N33              UPDATE    KOSTAR
      *
     C   28              GOTO      SLUTT2
      *
     C                   GOTO      START
     C                   END
     C*
     C     START3        TAG
     C                   EXSR      TESTB2
     C   30
     CAN 29              MOVEA     '0000'        *IN(96)
     C   30
     CAN 29              MOVE      '0'           *IN94
     C   30
     CAN 29              SETOFF                                       309291
     C   30              GOTO      START2
     C*
     C  N29WSLNR         IFEQ      0
     C                   GOTO      START4
     C                   END
     C     WSBL          IFGT      0
     C                   GOTO      STAR3B
     C                   END
     C*
     C*** KREDITOR KREDIT
     C     STAR3A        TAG
     C                   EXSR      KDTF3A
     C                   EXFMT     BILDE03A
     C   03              GOTO      SLUTT
N12  c   04              do
N12  C                   CALL      'SYFA60'
N12  C                   PARM                    plukk
N12  c                   parm                    wssg
N12  c                   goto      star3a
N12  c                   enddo
     C                   SETOFF                                       30
     C                   MOVEA     '000'         *IN(97)
     C                   MOVE      '0'           *IN(93)
     C   12
     CAN 29              GOTO      SLUTT
     C   12              GOTO      START2
     C                   EXSR      KDTF3A
     C*
     C  N29              EXSR      TSTB3A
     C   30              GOTO      STAR3A
     C                   GOTO      START4
     C*
     C*** KREDITOR DEBET
     C     STAR3B        TAG
     C                   EXSR      KDTF3B
     C                   EXFMT     BILDE03B
     C   03              GOTO      SLUTT
N12  c   04              do
N12  C                   CALL      'SYFA60'
N12  C                   PARM                    plukk
N12  c                   parm                    wssg
N12  c                   goto      star3b
N12  c                   enddo
     C                   SETOFF                                       30
     C                   MOVEA     '000'         *IN(97)
     C                   MOVE      '0'           *IN(93)
     C   12
     CAN 29              GOTO      SLUTT
     C   12              GOTO      START2
     C                   EXSR      KDTF3B
     C*
     C  N29              EXSR      TSTB3B
     C   30              GOTO      STAR3B
     C*
     C*** OPPDATER KOSTNADER OG GÅ TIL DETALJ LINJE
     C     START4        TAG
     C                   EXSR      TILVL
     C   30              GOTO      START
      * RETUR FRA FORDELINGSPROGRAMMET.
     C  N03              EXSR      MOVB1
     C  N03
     CANN28              GOTO      START
     C*
     C     SLUTT         TAG
     C     WSBNR         CHAIN     KOSTA                              33
     C  N33KAST          IFEQ      'A'
     C     KAST          OREQ      'B'
     C     UTYPE         IFNE      5
     C                   MOVE      ' '           KAST
     C                   END
     C                   END
     C  N33              UPDATE    KOSTAR
     C     SLUTT2        TAG
     C                   SELECT
     C     *IN03         WHENEQ    '1'
     C                   MOVE      3             UTYPE
     C     *IN12         WHENEQ    '1'
     C                   MOVE      1             UTYPE
     C                   OTHER
     C                   MOVE      0             UTYPE
     C                   END
N08  C     inisg         ifne      kasg
N08  C                   CALL      'SYGE108'
N08  C                   PARM                    INISG
N08  C                   PARM                    KASG
N08  C                   PARM                    LNAVN
N08  C                   END
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     BUDSR         BEGSR
     C***********************************************
     C*
     C     WSBNR         IFEQ      *ZEROS
     C* TILDEL PRE.REG.NR (LØPENR FRA FAST TELLER)...
     C     'Ø'           CHAIN     KOSTT                              33
     C   33              MOVE      'Ø'           KTTYP
     C   33              MOVE      2000000       KTNR
     C                   MOVE      KTNR          WSBNR
     C                   ADD       1             KTNR
     C  N33              UPDATE    KOSTTR
     C   33              WRITE     KOSTTR
     C                   MOVE      WSBNR         GMBNR
     C                   END
     C* OPPDATER KOSTA (DE FELT SOM SYNES I BILDE01) FØR OVERGANG....
     C     WSBNR         CHAIN     KOSTA                              33
     C   33              CLEAR                   KOSTAR
     C                   MOVE      'A'           KAST                                       S REG
     C                   MOVE      WSBNR         KABNR
     C                   MOVE      WSBNR2        KABNR2
     C     WSBDT         IFEQ      0
     C                   MOVE      *ZEROS        KABDT
     C                   ELSE
     C                   MOVE      WSBDTD        KABDTD
     C                   MOVE      WSBDTM        KABDTM
     C     WSBDTÅ        IFGT      50
     C     WSBDTÅ        ADD       1900          KABDTÅ
     C                   ELSE
     C     WSBDTÅ        ADD       2000          KABDTÅ
     C                   END
     C                   END
     C                   MOVE      WSPCC         KAPCC
     C                   MOVE      WSPÅR         KAPÅR
     C                   MOVE      WSPMN         KAPMN
     C                   MOVE      WSTXT         KATXT
     C                   MOVE      WSMVA         KAMVA
      * Når F8 fra kred.sida av bilag skal beløp alltid regenereres
      * basert på KOSBU - bare forvirrende hvis evt halvferdig/usikkert
      * beløp (fra tidligere avbrutt plukk??) vises inne i budsj.modul
     C                   MOVE      *ZEROS        KABL
     C  N33              UPDATE    KOSTAR
     C   33              MOVE      *ZEROS        KAJOUR
     C   33              WRITE     KOSTAR
     C* GÅ TIL BUDSJETT/REKVISISJ.SYSTEM FOR Å PLUKKE POSTER
     C                   MOVE      'C'           P1FLAG
     C                   Z-ADD     WSBNR         P1BNR
     C                   MOVE      *ZEROS        P1AVD
     C                   MOVE      *ZEROS        P1TUNR
     C                   MOVE      *ZEROS        P1OAVD
     C                   MOVE      *ZEROS        P1OPD
     C                   MOVE      *ZEROS        P1BL
     C                   MOVE      *BLANKS       P1GN
     C     WSMVA         IFNE      'F'
     C     WSMVA         ANDNE     ' '
     C                   MOVE      'J'           P1KDM
     C                   ELSE
     C                   MOVE      ' '           P1KDM
     C                   END
     C                   MOVE      P1DS          PARM1           256
     C                   CALL      'SYKS12'
     C                   PARM                    PARM1
      * VED RETUR - HENT VERDIER TIL DIV WS.FELT FRA BUDSJETTERING..
     C* LEGG OppDIENE T
     C     WSBNR         CHAIN     KOSTA                              33
     C                   MOVE      ' '           KAST                                       S REG
     C                   MOVE      *ZEROS        XXBL             13 2
     C     WITAX         ADD       1             FITAXN            5 4           *
     C                   MOVE      'N'           DATOOK            1            *flagg
     C     WSBNR         SETLL     KOSBU5
     C     WSBNR         READE     KOSBU5                                 34
     C     *IN34         DOWEQ     '0'
     C* Forsl tip peri./varek/lev.. hentes fra 1. budpost hvor utfylt
     C     KAPMN         IFEQ      *ZEROS
     C                   MOVE      BUPMN         KAPMN
     C                   MOVE      BUPÅR         KAPÅR
     C                   MOVE      BUPCC         KAPCC
     C                   ENDIF
     C                   MOVE      *BLANKS       WSSNAV
     C     KALNR         IFEQ      *ZEROS
     C                   MOVE      BULNR         KALNR
     C                   ENDIF
     C     KALNR         IFNE      *ZEROS
     C                   MOVE      KALNR         WSLNR
     C     LEVE1K        CHAIN     LEVEL01                            99
     C                   ENDIF
     C     KASG          IFEQ      *BLANKS
     C                   MOVE      BUSG          KASG
     C                   ENDIF
     C     KAVK          IFEQ      *BLANKS
     C                   MOVE      BUVK          KAVK
     C                   ENDIF
     C     KAVAL         IFEQ      *BLANKS
     C                   MOVE      BUVAL         KAVAL
     C                   ENDIF
     C                   Z-ADD     FITAX         WITAX
     C                   Z-ADD     FITAXD        WITAXD
     C                   Z-ADD     FITAX2        WITAX2
     C     BUKDM         IFNE      'P'
     C     BUKDM         ANDNE     'F'
     C     BUKDM         ANDNE     '+'
     C     BUKDM         ANDNE     ' '
     C     BUKDM         ANDNE     'J'
     C     BUKDM         ANDNE     'Y'
     C     KODWKYB       CHAIN     KODWL01                            35
     C     *IN35         IFEQ      *OFF
     C     MVAAVI        DIV       100           WITAX
     C     GMVATW        DIV       100           WITAX2
     C                   ELSE
     C                   Z-ADD     0             WITAX
     C                   Z-ADD     0             WITAX2
     C                   ENDIF
     C                   ENDIF
     C* Legge til moms??
     C     BUKDM         IFEQ      'J'                                           B2
     C     BUKDM         OREQ      'Y'
     C* Datostyrt momssats - hent riktig sats
     C* (anta - hvis bil.dato ikke er gitt- at den matcher periode)
     C     WITAXD        IFNE      *ZEROS                                         B3
     C     WITAX2        ANDNE     *ZEROS
     C     DATOOK        ANDEQ     'N'
     C                   MOVE      WITAX         FITAXU
      *
      * fikser århundre på bilagsdato
      *
     C     WSBDT         IFNE      0                                               B4
     C     WSBDTÅ        IFGT      50
     C     WSBDTÅ        ADD       1900          W2BDTÅ
     C                   ELSE
     C     WSBDTÅ        ADD       2000          W2BDTÅ
     C                   END
     C                   MOVE      WSBDTM        W2BDTM
     C                   MOVE      WSBDTD        W2BDTD
     C                   ELSE                                                      X4
     C     KAPCC         MULT      100           W2BDTÅ
     C                   MOVE      KAPÅR         W2BDTÅ
     C                   MOVE      KAPMN         W2BDTM
     C                   Z-ADD     1             W2BDTD
     C                   END                                                       E4
     C     W2BDT         IFLT      WITAXD                                          B4
     C                   MOVE      WITAX2        FITAXU
     C                   END                                                       E4
     C     FITAXU        ADD       1             FITAXN            5 4
     C                   MOVE      'J'           DATOOK                           = UTFØRT!!
     C                   END                                                      E3
     C                   MULT      FITAXN        BUBL
     C                   END                                                     E2
     C                   ADD       BUBL          XXBL
     C     WSBNR         READE     KOSBU5                                 34
     C                   END
     C*
     C                   Z-SUB     XXBL          KABL
     C  N33              UPDATE    KOSTAR
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
     C* ENDRING VIA ENDELIG BIL.NR ELLER ENDELIG BILNR. VED NYOPPRETTIN
      *
     C     WSBNR         IFEQ      *ZEROS
     C     WSBNR2        ANDGT     *ZEROS
     C     WSBNR2        CHAIN     KOSTA14                            98
     C   98WSBNR2        CHAIN     KOSTA                              98
     C  N98              MOVE      KABNR2        WSBNR2
     C  N98              MOVE      KABNR         WSBNR
     C                   END
     C* VED NY TEST FØRSTEBILDET (VED ENDRING GJØRES DET LENGER NED)
     C                   MOVE      *ZEROS        WSDTE
     C                   MOVE      *ZEROS        WSDTR
     C     WSBNR         IFEQ      *ZEROS
     C                   EXSR      TSTB11
     C                   ELSE
     C     WSBNR         CHAIN     KOSTA                              33
     C*GAMMEL .. UPDATEMODUS=N29  / SPØRREMODUS=29
     C  N33              DO
     C                   MOVE      KABNR2        WSBNR2
     C* STATUS MÅ VÆRE ' ' FOR ENDRING
     C* (UFLAG 1 BETYR AT EN ER KOMMET INN FOR Å LAGE NY..
     C*  MEN EN KAN DER HA OPPGITT BILAGSNR FOR Å ENDRE EN GML)
     C     *IN29         IFEQ      '0'
     C     UTYPE         IFEQ      1
     C     UTYPE         OREQ      2
     C     KAST          IFNE      ' '
     C                   UPDATE    KOSTAR
     C                   MOVE      'JOV0381'     MSGNR
     C                   SETON                                        3098
     C                   GOTO      ENDTB1
     C                   END
     C                   END
     C                   MOVE      'A'           KAST
     C                   END
     C                   UPDATE    KOSTAR
     C                   MOVE      KABDTD        WSBDTD
     C                   MOVE      KABDTM        WSBDTM
     C                   MOVE      KABDTÅ        WSBDTÅ
     C                   MOVE      KAPMN         WSPMN
     C                   MOVE      KAPÅR         WSPÅR
     C                   MOVE      KAPCC         WSPCC
     C                   EXSR      MVKW1
     C                   END
     C                   END
     C*
     C* Hent tekst via kortkode
     C     WSTXT1        IFNE      *BLANKS
     C     WSTXT2        ANDEQ     *BLANKS
     C     WSTXT1        CHAIN     KODTKSB                            33
     C     *IN33         IFEQ      '0'
     C                   MOVE      KOKSTX        WSTXT
     C                   END
     C                   END
     C* Hent tekst via Søk
     C   04              DO
     C                   CALL      'SYKS52A'
     C                   PARM                    WSTXT
     C                   Z-ADD     10            LINNBR
     C                   Z-ADD     38            POSNBR
     C                   END
     C     ENDTB1        ENDSR
     C*
     C***********************************************
     C     TSTB11        BEGSR
     C***********************************************
      *
      * skjekker om gyldig bilagsdato
      *
      *
     C                   MOVE      WSBDTD        UDTD              2 0
     C                   MOVE      WSBDTM        UDTM              2 0
     C                   MOVE      WSBDTÅ        UDTÅ              2 0
     C                   EXSR      SJDATO
     C     UFLAGG        COMP      1                                      97
     C  N97WSBDTÅ        COMP      XÅRTO                              97
     c     *in97         ifeq      '1'
     c     *in30         andeq     '0'
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     38            POSNBR
     C                   seton                                        30
     C                   MOVE      'SPD0001'     MSGNR
     c                   end
      *
      *
      * bilagsdato forskjellig fra periode
      *
     c     *in23         ifeq      '0'
     c     *in97         ifeq      '0'
     C     WSPÅR         ifne      WSBDTÅ
     c     WSPMN         orne      WSBDTM
     C                   MOVE      'SHU1162'     MSGNR
     C                   SETON                                        3097
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     38            POSNBR
     c                   end
     c                   end
     c                   end
      *
      * fikser periodens århundre
      *
     C     WSPMN         IFEQ      0
     C                   MOVE      *ZEROS        WSPCC
     C                   ELSE
     C     WSPÅR         IFGT      50
     C                   MOVE      '19'          WSPCC
     C                   ELSE
     C                   MOVE      '20'          WSPCC
     C                   END
     C                   END
     C     KODTÅK        CHAIN     KODTÅ                              96
     c     *in96         ifeq      '1'
     c     *in30         andeq     '0'
     C                   MOVE      'SPP0001'     MSGNR
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     38            POSNBR
     c                   seton                                        30
     c                   end
     C  N30              EXSR      MOVB2
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     TSTB12        BEGSR
     C***********************************************
     C* REKKEFØLGE PÅ FELTENE/TESTENE SNUDD
     C                   MOVE      WSBDTD        UDTD              2 0
     C                   MOVE      WSBDTM        UDTM              2 0
     C                   MOVE      WSBDTÅ        UDTÅ              2 0
     C                   EXSR      SJDATO
     C     UFLAGG        COMP      1                                      97
     C   97              DO
     C                   MOVE      'SPD0001'     MSGNR
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     38            POSNBR
     C                   SETON                                        30
     C                   END
     C*
     C     WSPMN         IFEQ      0
     C                   MOVE      *ZEROS        WSPCC
     C                   ELSE
     C     WSPÅR         IFGT      50
     C                   MOVE      '19'          WSPCC
     C                   ELSE
     C                   MOVE      '20'          WSPCC
     C                   END
     C                   END
     C     KODTÅK        CHAIN     KODTÅ                              96
     C   96              DO
     C                   MOVE      'SPP0001'     MSGNR
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     38            POSNBR
     C                   SETON                                        30
     C                   END
     C                   ENDSR
     C*
     C***********************************************
     C     TESTB2        BEGSR
     C***********************************************
     C* ÅPNET FOR UPDATE AV "NEDRE DEL AV BILDE01"
     C                   EXSR      TSTB12
     C* HENT LEV.NR DERSOM SØKENAVN UTFYLT
     C     WSSNAV        IFNE      *BLANKS
     C     WSLNR         ANDEQ     *ZEROS
     C                   MOVEL     WSSNAV        UUSNAV           30
     C                   CALL      'SO1LEV'
     C                   PARM                    WSLNR
     C                   PARM                    FIFIRM
     C                   PARM                    UUSNAV           30
     C                   END
     C*
     C     WSLNR         IFNE      0
     C     LEVE1K        CHAIN     LEVEL01                            99
     C  N99AKTKOD        COMP      'A'                                9999
     C     *IN99         IFEQ      '1'
     C                   MOVE      'SPL0029'     MSGNR
     C                   Z-ADD     10            LINNBR
     C                   Z-ADD     38            POSNBR
     C                   SETON                                        30
     C                   ELSE
     C                   MOVEL     LNAVN         WSSNAV
      * HVIS EN HAR BYTTET LEVERANDøR (OG DEN GAMLE VAR ULIK 0/IKKE NY)
      * OG EN IKKE AKTIVT HAR ENDRET/OVERSTYRT NY VALUTASORT (ULIK GML)
      * VIL SYSTEMET-SETTE VAL TIL LEVERANDøRENS DEFAULT (VALKOD)
     C     WSLNRG        IFNE      WSLNR
     C     WSLNRG        ANDNE     *ZEROS
     C     WSVALG        ANDEQ     WSVAL
     C     VALKOD        ANDNE     WSVAL
     C                   MOVE      *BLANKS       WSVAL
     C                   MOVE      *ZEROS        WSVKU
     C                   END
     C                   MOVE      WSLNR         WSLNRG            8 0
     C                   END
     C                   END
     C*
     C     WSLNR         IFEQ      *ZEROS
     C     WSVK          ORNE      *BLANKS
     C     KODGEK        CHAIN     KODTGE                             98
     C     KODG2K        CHAIN     KODTG2                             98
     C  N98WSLNR         IFEQ      *ZEROS
     C     KG2HBO        COMP      0                                      98
     C                   END
     C   98
     CANN30              DO
     C     WSLNR         IFEQ      *ZEROS
     C                   MOVE      'JOV0258'     MSGNR
     C                   ELSE
     C                   MOVE      'SPG0010'     MSGNR
     C                   END
     C                   Z-ADD     11            LINNBR
     C                   Z-ADD     14            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
     C* IKKE SETT VALUTA/KURS MM. DERSOM UFULSTENDIG/FEIL.
     C     *IN30         IFEQ      '1'
     C  N29              GOTO      SLTTS2
     C                   END
     C     WSLNR         IFEQ      0
     C                   MOVE      FICURR        VALKOD
     C     WSTXT         IFEQ      *BLANKS
     C                   MOVE      'TBR0195'     MSGNR
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     38            POSNBR
     C                   SETON                                        30
     C                   ELSE
     C                   MOVE      DIRTXT        LNAVN
     C                   END
     C                   END
     C*
     C     *IN23         IFEQ      '0'
     C     WSBL          COMP      0                                      97
     C   97
     CANN30              DO
     C                   MOVE      'JOV0697'     MSGNR
     C                   Z-ADD     11            LINNBR
     C                   Z-ADD     25            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
     C*
     C     WSVAL         IFEQ      *BLANKS
     C     VALKOD        IFNE      *BLANKS
     C                   MOVE      VALKOD        WSVAL
     C                   ELSE
     C                   MOVE      FICURR        WSVAL
     C                   END
     C                   END
     C     VALU1K        CHAIN     VALUL01                            96
     C   96
     CANN30              DO
     C                   MOVE      'SPV0001'     MSGNR
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     14            POSNBR
     C                   SETON                                        30
     C                   END
      *
      * VED FIRMAVALUTA KAN IKKE KURS FRAVIKE
      *
     C  N96WSVAL         IFEQ      FICURR
S04  C*                  Z-ADD     VALKU2        WSVKU
N04  C                   Z-ADD     VALKU1        WSVKU
     C                   END
     C  N96WSVKU         IFEQ      0
S04  C*                  Z-ADD     VALKU2        WSVKU
N04  C                   Z-ADD     VALKU1        WSVKU
     C                   ELSE
     C     *IN23         IFEQ      '0'
     C     WSVKU         COMP      VALKU1                             9494
     C   94WSVKU         COMP      VALKU2                             9494
     C   94
     CANN30              DO
     C                   MOVE      'JOV0698'     MSGNR
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     31            POSNBR
     C                   SETON                                        30
     C                   END
     C                   END
     C                   END
     C                   MOVE      WSVAL         WSVALG            3
      *
     C  N30WSMVA         IFEQ      ' '
     C     WSBLM         ANDEQ     0
     C                   MOVE      'SPM0012'     MSGNR
     C                   Z-ADD     11            LINNBR
     C                   Z-ADD     65            POSNBR
     C                   SETON                                        3091
     C                   ELSE
     C     WSMVA         IFNE      'F'
     C     WSMVA         ANDNE     ' '
     C     WSBLM         IFEQ      0
     C*
     C     *LIKE         DEFINE    FITAX         FITAXU
     C     *LIKE         DEFINE    FITAX         WITAX
     C     *LIKE         DEFINE    FITAX2        WITAX2
     C                   MOVE      WITAX         FITAXU
     C     WITAXD        IFNE      *ZEROS
     C     WITAX2        ANDNE     *ZEROS
     C     WSBDT         IFEQ      0
     C                   MOVE      *ZEROS        W2BDT
     C                   ELSE
     C     WSBDTÅ        IFGT      50
     C     WSBDTÅ        ADD       1900          W2BDTÅ
     C                   ELSE
     C     WSBDTÅ        ADD       2000          W2BDTÅ
     C                   END
     C                   MOVE      WSBDTM        W2BDTM
     C                   MOVE      WSBDTD        W2BDTD
     C                   END
     C     W2BDT         IFLT      WITAXD
     C                   MOVE      WITAX2        FITAXU
     C                   END
     C                   END
     C     FITAXU        ADD       1             FITAXN            5 4
     C*
     C     WSBL          DIV       FITAXN        XWORK            17 6
     C     XWORK         MULT(H)   FITAXU        WSBLM
     C                   END
     C                   END
     C                   END
     C*
     C  N30WSBB          IFEQ      *BLANKS
     C                   MOVE      BETBET        WSBB
     C                   END
     C  N30WSVAL         COMP      FICURR                                 95
     C  N30
     CANN95WSVKU         DIV       OMRFAK        XFAK              9 6
     C  N30
     CANN95WSBL          MULT(H)   XFAK          WSBLV            13 2
N09  C  N30
N09  CANN95              Z-SUB     WSBLV         WSBLV            13 2
N09  C  N30              Z-SUB     WSBL          WSBLV1
     C*
     C     SLTTS2        TAG
     C                   ENDSR
     C*
     C***********************************************
     C     TSTB3A        BEGSR
     C***********************************************
     C     WSFDT         IFEQ      0
     C                   MOVE      WSBDT         WSFDT
     C                   END
     C                   MOVE      WSFDTD        UDTD              2 0
     C                   MOVE      WSFDTM        UDTM              2 0
     C                   MOVE      WSFDTÅ        UDTÅ              2 0
     C                   EXSR      SJDATO
     C     UFLAGG        COMP      1                                      99
     C   99              MOVE      'SPD0001'     MSGNR
     C   99              SETON                                        30
      *
      * fikser forfallsdato
      *
     C  N99WSFFDT        IFEQ      0
     C                   MOVE      *BLANKS       BETTXT           30
     C                   MOVE      WSFDT         XFFDT             6 0
     C                   CALL      'SYFA20A'
     C                   PARM                    XFFDT
     C                   PARM                    BETTXT
     C                   PARM                    FIFIRM
     C                   PARM                    WSBB
     C                   MOVE      XFFDT         WSFFDT
     C                   END
     C                   MOVE      WSFFDD        UDTD
     C                   MOVE      WSFFDM        UDTM
     C                   MOVE      WSFFDÅ        UDTÅ
     C                   EXSR      SJDATO
     C     UFLAGG        COMP      1                                      98
     C   98
     CANN30              MOVE      'SPD0001'     MSGNR
     C   98              SETON                                        30
     C* KOMBINASJONEN LEVERANDØR / LEVERANDØRS NR ER BENYTTET FØR ??
     C* (PÅ ANNET BILAG ENN DET SOM NÅ BLIR LAGET / ENDRET).
     C     KOSA2K        CHAIN     KOSTA2                             33
     C     *IN33         IFEQ      '0'
N13  C     *in23         ANDEQ     '0'
     C     XABNR         ANDNE     *ZEROS
     C     XABNR         ANDNE     WSBNR
     C     XAST          ANDNE     'D'
     C                   MOVE      'JOV0220'     MSGNR
     C                   SETON                                        3097
     C                   END
N12  C     KEYSF         CHAIN     KODTSF                             87
N12  C     *in87         ifeq      '1'
N12  C                   SETON                                        30
N12  c                   move      'SPS0001'     msgnr
N12  c                   END
     C*
     C     WSLKID        IFNE      *BLANKS
     C                   EVAL      PLKID = WSLKID
     C                   CALL      'HR916'       PARM3
     C                   IF        PRC   =  '1'
     C                   CALL      'HR917'       PARM3
     C                   IF        PRC   =  '1'
     C                   EVAL      *IN93 = *ON
     C                   EVAL      *IN30 = *ON
     C                   MOVE      'SHU0876'     MSGNR
     C                   end
     C                   end
     C                   end
     C                   ENDSR
     C*
     C***********************************************
     C     TSTB3B        BEGSR
     C***********************************************
     C     WSFDT         IFEQ      0
     C                   MOVE      WSBDT         WSFDT
     C                   END
     C                   MOVE      WSFDTD        UDTD              2 0
     C                   MOVE      WSFDTM        UDTM              2 0
     C                   MOVE      WSFDTÅ        UDTÅ              2 0
     C                   EXSR      SJDATO
     C     UFLAGG        COMP      1                                      99
     C   99              MOVE      'SPD0001'     MSGNR
     C   99              SETON                                        30
     C* VED KREDITNOTA - FORFALLSDATO=FAKTURADATO
     C                   MOVE      WSFDT         WSFFDT
     C* KOMBINASJONEN LEVERANDØR / LEVERANDØRS NR ER BENYTTET FØR ??
     C* (PÅ ANNET BILAG ENN DET SOM NÅ BLIR LAGET / ENDRET).
     C     KOSA2K        CHAIN     KOSTA2                             33
     C     *IN33         IFEQ      '0'
N13  C     *in23         andeq     '0'
     C     XABNR         ANDNE     *ZEROS
     C     XABNR         ANDNE     WSBNR
     C     XAST          ANDNE     'D'
     C                   MOVE      'JOV0220'     MSGNR
     C                   SETON                                        3097
     C                   END
     C*
N12  C     KEYSF         CHAIN     KODTSF                             87
N12  C     *in87         ifeq      '1'
N12  C                   SETON                                        30
N12  c                   move      'SPS0001'     msgnr
N12  c                   END
     C*
     C     WSLKID        IFNE      *BLANKS
     C                   EVAL      PLKID = WSLKID
     C                   CALL      'HR916'       PARM3
     C                   IF        PRC   =  '1'
     C                   CALL      'HR917'       PARM3
     C                   IF        PRC   =  '1'
     C                   EVAL      *IN93 = *ON
     C                   EVAL      *IN30 = *ON
     C                   MOVE      'SHU0876'     MSGNR
     C                   end
     C                   end
     C                   end
     C                   ENDSR
     C*
     C***********************************************
     C     MVKW1         BEGSR
     C***********************************************
     C                   MOVE      KALNR         WSLNR
     C                   MOVE      KALNR         WSLNRG
     C                   MOVE      KAVAL         WSVALG
     C                   MOVE      KATXT         WSTXT
     C                   MOVE      KAVK          WSVK
     C                   MOVE      KAVAL         WSVAL
     C                   MOVE      KABL          WSBL
     C                   Z-ADD     KAVKU         WSVKU
     C                   MOVE      KAFNR         WSFNR
     C                   MOVE      KAFDTD        WSFDTD
     C                   MOVE      KAFDTM        WSFDTM
     C                   MOVE      KAFDTÅ        WSFDTÅ
     C                   MOVE      KAFFDD        WSFFDD
     C                   MOVE      KAFFDM        WSFFDM
     C                   MOVE      KAFFDÅ        WSFFDÅ
     C                   MOVE      KABB          WSBB
     C                   MOVE      KASG          WSSG
     C                   MOVE      KALKID        WSLKID
     C                   MOVE      KARNR         WSRNR
     C                   MOVE      KABLM         WSBLM
     C                   MOVE      KAMVA         WSMVA
     C                   MOVE      KADGE         WSDTED
     C                   MOVE      KAMNE         WSDTEM
     C                   MOVE      KAÅRE         WSDTEÅ
     C                   MOVE      KADTRD        WSDTRD
     C                   MOVE      KADTRM        WSDTRM
     C                   MOVE      KADTRÅ        WSDTRÅ
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     MOVB1         BEGSR
     C***********************************************
     C                   MOVE      *ZEROS        WSBNR
     C                   MOVE      *ZEROS        WSBNR2
     C                   MOVE      *ZEROS        WSBDT
     C                   MOVE      *ZEROS        WSPCC             2 0
     C                   MOVE      *ZEROS        WSPÅR
     C                   MOVE      *ZEROS        WSPMN
     C                   MOVE      *BLANKS       WSTXT
     C                   MOVE      *BLANKS       WSMVA
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     MOVB2         BEGSR
     C***********************************************
     C                   MOVE      *ZEROS        WSLNR
     C                   MOVE      *BLANKS       WSSNAV
     C                   MOVE      *BLANKS       WSVK
     C                   MOVE      *BLANKS       WSVAL
     C                   MOVE      *ZEROS        WSBL
     C                   MOVE      *ZEROS        WSVKU
     C                   MOVE      *BLANKS       WSFNR
     C                   MOVE      *ZEROS        WSFDT
     C                   MOVE      *ZEROS        WSFFDT
     C                   MOVE      *BLANKS       WSBB
     C                   MOVE      *BLANKS       WSSG
     C                   MOVE      *BLANKS       WSLKID
     C                   MOVE      *ZEROS        WSRNR
     C                   MOVE      *BLANKS       WSMVA
     C                   MOVE      *ZEROS        WSBLM
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     TILVL         BEGSR
     C***********************************************
     C                   MOVE      *ZEROS        WSLNRG
     C                   MOVE      *BLANKS       WSVALG
     C                   MOVE      *ZEROS        GMBNR
     C                   MOVE      *ZEROS        GMBNR2
     C     WSBNR         IFEQ      *ZEROS
     C* TILDEL PRE.REG.NR (LØPENR FRA FAST TELLER)...
     C     'Ø'           CHAIN     KOSTT                              33
     C   33              MOVE      'Ø'           KTTYP
     C   33              MOVE      2000000       KTNR
     C                   MOVE      KTNR          WSBNR
     C                   ADD       1             KTNR
     C  N33              UPDATE    KOSTTR
     C   33              WRITE     KOSTTR
     C                   MOVE      WSBNR         GMBNR
     C                   END
     C* SKAL ENDELIG BILAGSNR TILDELES FRA TELLER.......
     C* (WSBNR --> WSBNR2 I NESTE 8/10 STATEMENTS (E15))
     C     WSBSR         IFNE      ' '
     C     WSBNR2        IFEQ      *ZEROS
     C     WSBSR         CHAIN     KOSTT                              33
     C   33              GOTO      SLTILV
      * TILDELT BILAGSNR "MELLOMLAGRES" I GMBNR2 INTIL TESTET/GODKJENT
     C                   MOVE      KTNR          GMBNR2
     C                   ADD       1             KTNR
     C                   UPDATE    KOSTTR
     C     GMBNR2        IFNE      *ZEROS
     C     GMBNR2        CHAIN     KOSTA14                            33
     C     *IN33         IFEQ      *OFF
     C                   MOVE      'JOV0387'     MSGNR
     C                   Z-ADD     62            LINNBR
     C                   Z-ADD     42            POSNBR
     C                   MOVE      *ON           *IN98
     C                   MOVE      *ON           *IN30
     C                   GOTO      SLTILV
     C                   ENDIF
     C                   ENDIF
      * TILDELT NR ER OK!
     C                   MOVE      GMBNR2        WSBNR2
     C                   END
     C                   END
     C*
     C     WSBNR         CHAIN     KOSTA                              33
     C     *IN29         IFEQ      '0'                                          IKKE SPØRRING
     C     *IN09         IFEQ      '1'
     C     *IN10         OREQ      '1'
     C                   MOVE      ' '           KAST                           AVSL. 1.GANGS REG
     C                   ELSE
     C                   MOVE      'B'           KAST                           GÅ TIL FORDELING
     C                   END
     C                   END
     C                   MOVE      WSBNR         KABNR
     C                   MOVE      WSBNR2        KABNR2
N06  C                   IF        WSBDT = 0
N06  C                   EVAL      KABDT = 0
N06  C                   ELSE
     C     WSBDTÅ        IFGT      50
     C     WSBDTÅ        ADD       1900          KABDTÅ
     C                   ELSE
     C     WSBDTÅ        ADD       2000          KABDTÅ
     C                   END
N06  C                   END
     C                   MOVE      WSBDTD        KABDTD
     C                   MOVE      WSBDTM        KABDTM
     C                   MOVE      WSTXT         KATXT
     C                   MOVE      WSPCC         KAPCC
     C                   MOVE      WSPÅR         KAPÅR
     C                   MOVE      WSPMN         KAPMN
     C                   MOVE      WSLNR         KALNR
     C                   MOVE      WSVK          KAVK
     C                   MOVE      WSVAL         KAVAL
     C                   MOVE      WSBL          KABL
     C                   Z-ADD     WSVKU         KAVKU
     C                   Z-ADD     OMRFAK        KAOMRF
     C                   MOVE      *ZEROS        KATAVD
     C                   MOVE      WSFNR         KAFNR
     C                   MOVE      WSFDTD        KAFDTD
     C                   MOVE      WSFDTM        KAFDTM
     C     WSFDTÅ        IFGT      50
     C     WSFDTÅ        ADD       1900          KAFDTÅ
     C                   ELSE
     C     WSFDTÅ        ADD       2000          KAFDTÅ
     C                   END
     C                   MOVE      WSFFDD        KAFFDD
     C                   MOVE      WSFFDM        KAFFDM
     C     WSFFDÅ        IFGT      50
     C     WSFFDÅ        ADD       1900          KAFFDÅ
     C                   ELSE
     C     WSFFDÅ        ADD       2000          KAFFDÅ
     C                   END
     C                   MOVE      WSBB          KABB
     C                   MOVE      WSSG          KASG
     C                   MOVE      WSLKID        KALKID
     C                   MOVE      WSRNR         KARNR
     C                   MOVE      WSBLM         KABLM
     C                   MOVE      WSMVA         KAMVA
     C  N29              DO
     C                   TIME                    XTIME
     C                   MOVE      UUSER         KAUSER
     C                   MOVE      XTM           KATME
     C                   MOVE      XDG           KADGE
     C                   MOVE      XMN           KAMNE
     C                   MOVE      XÅR           KAÅRE
     C                   END
     C   33              MOVE      KADTE         KADTR
     C   33              MOVE      KATME         KATDR
     C   33              MOVE      *ZEROS        KAJOUR
     C   33              WRITE     KOSTAR
     C  N33              UPDATE    KOSTAR
     C     UTYPE         IFEQ      1
     C                   MOVE      KABNR         UBNR
     C                   END
     C*
     C* NÅR AVLUTT MED F09...SKRIV ATTESTASJ./HENFØRINGSBILAG          .
     C   09              DO                                                     FØRSTEGANG...
      * Arkivtype + printer far SYPARF "ATTBI"
     c                   move      *blanks       SYVRDA
     c                   movel     'ATTBI'       XXPAID
     c     SYPAKEY       chain     SYPARL1                            33
     C                   movel     KABNR         KABNRA            7
     C                   CALL      'SYKS06C'
     C                   PARM                    KABNRA
     C                   PARM                    Arktype
     C                   PARM                    Attprt
     C                   END
     C     *IN09         IFEQ      '0'                                          TIL FORDELING
     C     *IN10         ANDEQ     '0'
     C                   MOVE      KABDT         UBDT              6 0
     C     KAVKU         DIV       OMRFAK        XFAK              9 6
     C     KABL          MULT(H)   XFAK          UBL              13 2
     C     WSVKU         DIV       OMRFAK        UVKU             10 7
     C  N29              MOVE      *ZEROS        UFLAGG
N09  C     ENDMOD        IFNE      'J'
     C   29              Z-ADD     5             UFLAGG
N09  C                   END
     C                   MOVE      KABNR2        UBNR2             7 0
sh   c*    ubl           div(H)    kabl          uvku
N03  c                   if        kabl <> 0
N03  c     ubl           div(H)    kabl          uvku
N03  c                   endif
N07  C                   MOVE      KATXT         L1BIL             4
N07  C     L1BIL         IFNE      '*L1*'
     C                   CALL      'SYKS03S'
     C                   PARM                    FIFIRM
     C                   PARM                    WSBNR
     C                   PARM                    UBDT
     C                   PARM                    WSPÅR
     C                   PARM                    WSPMN
     C                   PARM                    WSVK
     C                   PARM                    WSVAL
     C                   PARM                    UVKU
     C                   PARM                    WSBL
     C                   PARM                    WSBLM
     C                   PARM                    WSLNR
     C                   PARM                    UBL
     C                   PARM                    WSMVA
     C                   PARM                    UBNR2                          *ENDELIG
     C                   PARM                    UFLAGG
     C                   PARM                    UPARM           512
N07  C                   ELSE
N07  C                   CALL      'SYKS03L1C'
N07  C                   PARM                    WSBNR
N07  C                   PARM                    UBNR2                          *ENDELIG
N07  C                   PARM                    UFLAGG
N07  C                   PARM                    KUNSE             1
N07  C                   END
     C     WSBNR2        IFEQ      *ZEROS
     C     UBNR2         ANDNE     *ZEROS
     C                   MOVE      UBNR2         GMBNR2
     C                   END
     C     UFLAGG        COMP      3                                      03
     C     WSBNR         CHAIN     KOSTA                              33
S09  C* N33
S09  C*NN29UFLAGG        IFEQ      9                                            FERDIGMELDT
N10  C     UFLAGG        IFEQ      9
N09  C     *IN33         IFEQ      '0'
N09  C     *IN29         IFEQ      '0'
N09  C     ENDMOD        OREQ      'J'
     C                   MOVE      'G'           KAST
N10  C                   MOVE      UUSER         KAUSER
N05  C     KABLST        IFEQ      '1'
N05  C                   MOVE      '2'           KABLST
N05  C                   END
N09  C                   END
N09  C                   END
     C                   ELSE
N05  C     UFLAGG        IFEQ      8
N05  C                   MOVE      'G'           KAST
N10  C                   MOVE      UUSER         KAUSER
N05  C                   MOVE      '1'           KABLST
N05  C                   ELSE
s11  C*                  MOVE      ' '           KAST
n11  C  N29              MOVE      ' '           KAST
N05  C                   END
     C                   END
     C  N33              MOVE      UBNR2         KABNR2
     C  N33              UPDATE    KOSTAR
     C                   END
     C*
     C     SLTILV        ENDSR
     C*
     C***********************************************
     C     SJDATO        BEGSR
     C***********************************************
     C                   CALL      'TESTDATO'
     C                   PARM                    UDTD
     C                   PARM                    UDTM
     C                   PARM                    UDTÅ
     C                   PARM                    UFLAGG            1 0
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     SØKLEV        BEGSR
     C***********************************************
     C                   MOVE      *BLANKS       UUSNAV           30
     C                   CALL      'SO1LEV'
     C                   PARM                    WSLNR
     C                   PARM                    FIFIRM
     C                   PARM                    UUSNAV           30
     C     UUSNAV        IFNE      *BLANKS
     C                   MOVEL     UUSNAV        WSSNAV
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     SØKDTA        BEGSR
     C***********************************************
     C                   Z-ADD     1             UFLAGG
     C     LINNBR        IFEQ      10
     C     POSNBR        ANDGE     38
     C     POSNBR        ANDLE     45
     C                   EXSR      SØKLEV
     C                   Z-ADD     11            LINNBR
     C                   Z-ADD     14            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C* VAREKODE - BENYTT INNGÅENDE PARM FOR Å FORTELLE OM
     C*            KUN KOSTNADSKODER/KUN DIREKTEFØRINGSKODER SKAL VISES
     C     LINNBR        IFEQ      11
     C     POSNBR        ANDGE     14
     C     POSNBR        ANDLE     16
     C     WSLNR         IFEQ      *ZEROS
     C     WSSNAV        ANDEQ     *BLANKS
     C                   MOVE      'XXH'         UUVK
     C                   ELSE
     C                   MOVE      'XXK'         UUVK
     C                   END
     C                   CALL      'SYFI10D'
     C                   PARM                    UUVK              3
     C     UUVK          IFNE      'XXK'
     C     UUVK          ANDNE     'XXH'
     C                   MOVE      UUVK          WSVK
     C                   END
     C                   Z-ADD     25            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C* VALUTAKODE
     C     LINNBR        IFEQ      12
     C     POSNBR        ANDGE     14
     C     POSNBR        ANDLE     16
     C                   MOVE      'J'           USØK              1
     C                   CALL      'V200SY'
     C                   PARM                    USØK
     C                   PARM                    WSVAL
     C                   Z-ADD     52            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C*
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
     C*
     C     SLSØK         ENDSR
     C*
     C***********************************************
     C     DIREKT        BEGSR
     C***********************************************
     C  N29              DO                                                     1<-B
     C     WSBNR         CHAIN     KOSTA                              98
     C  N98KAST          IFEQ      ' '                                           2<-B
     C                   MOVE      'A'           KAST
     C                   UPDATE    KOSTAR
     C                   MOVE      *ZEROS        UFLAGG
     C     KAVAL         IFEQ      *BLANKS                                        3<-B
     C                   MOVE      FICURR        WSVAL
     C                   ELSE                                                     3
     C                   MOVE      KAVAL         WSVAL
     C                   END                                                      3<-E
     C     VALU1K        CHAIN     VALUL01                            33
     C                   MOVE      KABDT         UBDT              6 0
     C     KAVKU         DIV       OMRFAK        XFAK              9 6
     C     KABL          MULT(H)   XFAK          UBL              13 2
     C     KAVKU         DIV       OMRFAK        UVKU             10 7
     C                   MOVE      *ZEROS        UFLAGG
sh   c     ubl           div(H)    kabl          uvku
N07  C     L1BIL         IFNE      '*L1*'
     C                   CALL      'SYKS03S'
     C                   PARM                    FIFIRM
     C                   PARM                    WSBNR
     C                   PARM                    UBDT
     C                   PARM                    KAPÅR
     C                   PARM                    KAPMN
     C                   PARM                    KAVK
     C                   PARM                    KAVAL
     C                   PARM                    UVKU
     C                   PARM                    KABL
     C                   PARM                    KABLM
     C                   PARM                    KALNR
     C                   PARM                    UBL
     C                   PARM                    KAMVA
     C                   PARM                    KABNR2                         *ENDELIG
     C                   PARM                    UFLAGG
     C                   PARM                    UPARM           512
N07  C                   ELSE
N07  C                   CALL      'SYKS03L1C'
N07  C                   PARM                    WSBNR
N07  C                   PARM                    UBNR2                          *ENDELIG
N07  C                   PARM                    UFLAGG
N07  C                   PARM                    KUNSE             1
N07  C                   END
     C     WSBNR         CHAIN     KOSTA                              33
     C  N33UFLAGG        IFEQ      9                                              3<-B FERDIGMELDT
     C                   MOVE      'G'           KAST
N10  C                   MOVE      UUSER         KAUSER
     C                   ELSE                                                     3
N05  C     UFLAGG        IFEQ      8
N05  C                   MOVE      '1'           KAST
N05  C                   ELSE
     C                   MOVE      ' '           KAST
N05  C                   END                                                      3<-E
     C                   END                                                      3<-E
     C  N33              UPDATE    KOSTAR
     C                   ELSE                                                    2
     C                   UPDATE    KOSTAR
     C                   SETON                                        98
     C                   END                                                     2<-E
     C   98              SETON                                        30
     C   98              MOVE      'SPB0008'     MSGNR
     C                   END                                                    1<-E
      *
     C   29              DO
     C                   Z-ADD     5             UFLAGG
sh   c     ubl           div(H)    kabl          uvku
N07  C     L1BIL         IFNE      '*L1*'
     C                   CALL      'SYKS03S'
     C                   PARM                    FIFIRM
     C                   PARM                    WSBNR
     C                   PARM                    UBDT
     C                   PARM                    KAPÅR
     C                   PARM                    KAPMN
     C                   PARM                    KAVK
     C                   PARM                    KAVAL
     C                   PARM                    UVKU
     C                   PARM                    KABL
     C                   PARM                    KABLM
     C                   PARM                    KALNR
     C                   PARM                    UBL
     C                   PARM                    KAMVA
     C                   PARM                    KABNR2                         *ENDELIG
     C                   PARM                    UFLAGG
     C                   PARM                    UPARM           512
N07  C                   ELSE
N07  C                   CALL      'SYKS03L1C'
N07  C                   PARM                    WSBNR
N07  C                   PARM                    UBNR2                          *ENDELIG
N07  C                   PARM                    UFLAGG
N07  C                   PARM                    KUNSE             1
N07  C                   END
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
      *
      * PARAMETER FOR CALL-LISTE HR916/HR917
      *
     C     PARM3         PLIST
     C                   PARM                    PARMD3
      *
     C     KOSA2K        KLIST
     C                   KFLD                    WSLNR
     C                   KFLD                    WSFNR
     C                   KFLD                    WSPÅR
     C     KODGEK        KLIST
     C                   KFLD                    YGEUNI
     C                   KFLD                    WSVK
N12  C     KEYSF         KLIST
N12  C                   KFLD                    SFKOD             2
N12  C                   KFLD                    WSSG
N12  C                   move      'SF'          SFKOD
     C     KODG2K        KLIST
     C                   KFLD                    YG2UNI
     C                   KFLD                    WSVK
     C     VALU1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSVAL
     C     LEVE1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSLNR
     C     KODTÅK        KLIST
     C                   KFLD                    YÅUNI
     C                   KFLD                    WSPCC
     C                   KFLD                    WSPÅR
     C                   KFLD                    WSPMN
     C                   MOVE      'K'           YÅUNI             1
      * key for leverandørs fakturadato
     C     KODTÅF        KLIST
     C                   KFLD                    YÅUNI
     C                   KFLD                    WSPCC
     C                   KFLD                    WSFDTÅ
     C                   KFLD                    WSFDTM
     C     KODTÅB        KLIST
     C                   KFLD                    YÅUNI
     C                   KFLD                    WSPCC
     C                   KFLD                    WSBDTÅ
     C                   KFLD                    WSBDTM
     C     KODWKY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WMVAKD
     C                   KFLD                    WSMVA
     C                   MOVE      *BLANKS       WMVAKD            2
     C     KODWKYB       KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WMVAKD
     C                   KFLD                    BUKDM
     C                   MOVE      *BLANKS       WMVAKD            2
     C     SYPAKEY       KLIST
     C                   KFLD                    XXPAKN            8 0
     C                   KFLD                    XXPAID            5
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UBNR              7 0
     C                   PARM                    INISG             3
     C                   PARM                    UTYPE             1 0
     C*
     C                   TIME                    XTIME
     C                   MOVE      'GE'          YGEUNI            2
     C                   MOVE      'G2'          YG2UNI            2
     C*                    MOVE 'SF'      YSFUNI  2
     C     UYEAR         IFGT      50
     C                   MOVE      '19'          WSPCC
     C                   ELSE
     C                   MOVE      '20'          WSPCC
     C                   END
     C                   MOVE      UYEAR         WSPÅR
     C                   MOVE      *ZEROS        WSPMN
     C                   MOVE      *ZEROS        WSBNR
     C                   MOVE      *ZEROS        WSBDT
     C                   MOVE      *ZEROS        KABDT
     C                   MOVE      *ZEROS        WSFDT
     C                   MOVE      *ZEROS        KAFDT
     C                   MOVE      *ZEROS        WSFFDT
     C                   MOVE      *ZEROS        KAFFDT
     C                   MOVE      *ZEROS        KADTE
     C                   MOVE      *ZEROS        KATME
     C                   MOVE      *ZEROS        KADTR
     C                   MOVE      *ZEROS        KATDR
     C                   MOVE      *ZEROS        KAJOUR
     C                   MOVE      'JOV0286'     XMSGNR            7            MELDING-ID
     C                   Z-ADD     3             XLEVEL            1 0          NIVÅ
     C                   Z-ADD     0             XRETUR            1 0          RETURKODE
     C                   Z-ADD     30            XMSGL             4 0          LENGDE PÅ MELDING
     C                   CALL      'SUBR23R3'
     C                   PARM                    XMSGNR
     C                   PARM                    DIRTXT           30
     C                   PARM                    XLEVEL
     C                   PARM                    XRETUR
     C                   PARM                    XMSGL
N01  C                   move      *zeros        witaxd
     C*
     c                   move      'P'           plukk             1
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
      *
     C     UTYPE         IFEQ      1
     C                   MOVE      UBNR          WSBNR2                         *ENDELIG
     C                   ELSE
      *
     C     UTYPE         IFEQ      2
N09  C     UBNR          CHAIN(N)  KOSTA                              33
N09  C     *IN33         IFEQ      '0'
N09  C     KABLST        ANDEQ     '1'
N09  C                   MOVE      UBNR          WSBNR
N09  C                   SETON                                        29
N09  C                   EXSR      TESTB1
N09  C                   MOVE      '5'           UTYPE
N09  C                   MOVE      'J'           ENDMOD            1
N09  C                   ELSE
     C                   MOVE      UBNR          WSBNR                          *INNREG.NR
     C                   SETON                                        28
     C                   EXSR      TESTB1
N09  C                   END
     C                   ELSE
     C     UTYPE         IFEQ      5
     C                   MOVE      UBNR          WSBNR
     C                   SETON                                        2829
     C                   EXSR      TESTB1
     C                   END
     C                   END
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFM1        BEGSR
     C***********************************************
     C                   MOVE      WSBDTD        UDT1              2 0
     C                   MOVE      WSBDTM        UDT2              2 0
     C                   MOVE      WSBDTÅ        UDT3              2 0
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WSBDTD
     C                   MOVE      UDT2          WSBDTM
     C                   MOVE      UDT3          WSBDTÅ
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTF3A        BEGSR
     C***********************************************
     C                   EXSR      KDTFM1
     C                   MOVE      WSFDTD        UDT1
     C                   MOVE      WSFDTM        UDT2
     C                   MOVE      WSFDTÅ        UDT3
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WSFDTD
     C                   MOVE      UDT2          WSFDTM
     C                   MOVE      UDT3          WSFDTÅ
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTF3B        BEGSR
     C***********************************************
     C                   EXSR      KDTFM1
     C                   MOVE      WSFDTD        UDT1
     C                   MOVE      WSFDTM        UDT2
     C                   MOVE      WSFDTÅ        UDT3
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WSFDTD
     C                   MOVE      UDT2          WSFDTM
     C                   MOVE      UDT3          WSFDTÅ
     C*
     C                   MOVE      WSFFDD        UDT1
     C                   MOVE      WSFFDM        UDT2
     C                   MOVE      WSFFDÅ        UDT3
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WSFFDD
     C                   MOVE      UDT2          WSFFDM
     C                   MOVE      UDT3          WSFFDÅ
      *
     C                   MOVE      WSDTED        UDT1
     C                   MOVE      WSDTEM        UDT2
     C                   MOVE      WSDTEÅ        UDT3
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WSDTED
     C                   MOVE      UDT2          WSDTEM
     C                   MOVE      UDT3          WSDTEÅ
      *
     C                   MOVE      WSDTRD        UDT1
     C                   MOVE      WSDTRM        UDT2
     C                   MOVE      WSDTRÅ        UDT3
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WSDTRD
     C                   MOVE      UDT2          WSDTRM
     C                   MOVE      UDT3          WSDTRÅ
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
     C* CHANGES DATE-FORMAT FROM FIRM TO INTERNAL
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C*
     C                   ENDSR
     C*
