      *********************************************************************
      *
      * PROGRAM BEHANDLER INPUT FRA SS002 OG VISER ORDRE
      *
CRTPG+*  CRTPGM SYSPED/SS003 MODULE(*LIBL/SS003
CRTPGM*        *LIBL/CHECKUSR *LIBL/INCGI) ACTGRP(CGI) AUT(*USE)
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 BIAKT=L ER ENDRET TIL Å TESTE AUTORISASJON
10XXX * 02 YBC PTF10 VIS KODE FOR RETUR/STRATEGISK GODS
10XXX * 03 YBC PTF10 ORDRENR, FARLIG GODS
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
12XXX * 04 YBC PTF12 Vis max. 40 vedlegg
12XXX * 05 sh  PTF12 HISTORISK ARKIV
12XXX * 06 YBC PTF12 Glemte å sette USROPN på en del filer
12XXX * 07 sh  PTF12 HENT LOGO FIRMA
12XXX * 08 sh  PTF12 endring grunnet ptf07
      * 09 JOV PTF12 Google arkiv ??
      * 10 sh  PTF12 tillegg google
********************************************************************
      *
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
     FGSSORF    IF   E           K DISK    USROPN
     FGSSPOF    UF   E           K DISK    USROPN
     FGSSPAF    IF   E           K DISK    USROPN
     FGSSOVF    IF   E           K DISK    USROPN
     FGSSFGF    IF   E           K DISK    USROPN
N03  FGSSDGF    IF   E           K DISK    USROPN
     FBRIDF     UF   E           K DISK    USROPN
     FBRPARF    if   e           k disk    usropn
     FFRISOK    IF   E           K DISK    usropn
     FKOFAST    IF   E           K DISK    usropn
E06  FARKIVL11  IF   E           K DISK    USROPN
E06  FARKEXT    IF   E           K DISK    USROPN
E06  FARKTXT    IF   E           K DISK    USROPN
E06  FFIRMARC   IF   E           K DISK    USROPN
N09  FFIRMGOOG  IF   E           K DISK    USROPN
E06  FFIRM      IF   E           K DISK    USROPN
      *--------------------------------------------------------------------
      * Prototype definitions and standard system API error structure
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      * Variables common to CGI programs
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
      * VARIABLES SPECIFIC TO THIS PROGRAM
      *--------------------------------------------------------------------
      * Variables received from the input string
     D lng             s              2
     D BckGnd          s             10
     D UsrSpcName      s             10
     D WSUSER          S             10
     D WINT            S              6
     D WSNA            S             30
     D WSONO           S              7
     D WSTNO           S             11
     D WSCONO          S             20
     D WSSOK           S             40
     D WSSOKURL        S            100
N07  D DftLogo         s             50a   inz('/syspeddev/systematop1.jpg')
     D PGM             C                   CONST('SYSPED/CHECKUSR')
      * Variables used to load the external html source member
     D w1cono          s            720
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
      *
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
     D                 DS
     D  updf1                  1    200
     D  updf2                201    400
     D  updf3                401    600
     D  updf4                601    800
     D  updf5                801   1000
     D  updf6               1001   1200
     D  updf7               1201   1400
     D  updf8               1401   1600
     D  updf9               1601   1800
     D  updf10              1801   2000
     D  updf11              2001   2200
     D  updf12              2201   2400
     D  updf13              2401   2600
     D  updf14              2601   2800
     D  updf15              2801   3000
     D  updf16              3001   3200
     D  updf17              3201   3400
     D  updf18              3401   3600
     D  updf19              3601   3800
     D  updf20              3801   4000
N04  D  updf21              4001   4200
N04  D  updf22              4201   4400
N04  D  updf23              4401   4600
N04  D  updf24              4601   4800
N04  D  updf25              4801   5000
N04  D  updf26              5001   5200
N04  D  updf27              5201   5400
N04  D  updf28              5401   5600
N04  D  updf29              5601   5800
N04  D  updf30              5801   6000
N04  D  updf31              6001   6200
N04  D  updf32              6201   6400
N04  D  updf33              6401   6600
N04  D  updf34              6601   6800
N04  D  updf35              6801   7000
N04  D  updf36              7001   7200
N04  D  updf37              7201   7400
N04  D  updf38              7401   7600
N04  D  updf39              7601   7800
N04  D  updf40              7801   8000
S04  D* updf                   1   4000    DIM(20)
N04  D  updf                   1   8000    DIM(40)
      * Arkivtyper 16 elem. a 3 tegn (sb,si,..) Type er venstrestilt
     D                 DS
     D  ATString               1    192
     D  ATString1              1     48
     D  ATString2             49     96
     D  ATString3             97    144
     D  ATString4            145    192
     D  AT                     1    192    DIM(64)
     D                 DS
     D  A2                     1    128    DIM(64)
      *
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================
      * MAIN PROCESSING LINE
      *=====================================================================
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input string
     C                   exsr      Parse
      *
     C                   EXSR      INIT
     C                   CALLB     PGM
     C                   PARM                    BIBRID
     C                   PARM                    UsrSpcName
     C                   PARM                    UINN              1
     C                   IF        UINN = 'N'
     C                   GOTO      SLUTT
     C                   END
     C     WSUSER        CHAIN     BRIDF                              50
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           BIDTF
     C                   MOVE      WTM           BITIDF
     C                   UPDATE    BRIDFR
      * Set output skeleton html member name
     C                   exsr      SetSkl
      * Read skeleton output html into core
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
      * Retrieve environment variables
     C                   exsr      RtvEnvVar
      *
      * Issue html section /$top
     C                   exsr      SetTop
     C                   callp     wrtsection('top')
      *------------------
     C                   EXSR      HENTDOK
     C                   exsr      SetFound
     C                   callp     wrtsection('found')
S01  C*                  IF        BIAKT <> 'L'
N01  C                   IF        XAUT <> 'L'
     C                   callp     wrtsection('found2')
     C                   ELSE
     C                   callp     wrtsection('found3')
     C                   END
     C                   callp     wrtsection('found4')
      *
     C                   IF        XAGENT = 'J'
     C                   callp     wrtsection('FSTAG1')
     C                   END
     C                   callp     wrtsection('FSTAG2')
N03   *
N03  C                   IF        XFGTYPE = 'C'
N03  C                   callp     wrtsection('DGTAG1')
N03  C                   ELSE
N03  C                   callp     wrtsection('DGTAG2')
N03  C                   END
N03  C                   callp     wrtsection('DGTAG3')
      *
     C                   IF        ORTNO <> 0
     C                   exsr      DspTT
     C                   END
     C                   callp     wrtsection('TTSLUTT')
      *
      * Send output buffer and quit
     C     SLUTT         TAG
     C                   exsr      Exit
      *=====================================================================
      * Send output buffer and quit
      *=====================================================================
     C     Exit          begsr
      * Compute and display run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
     C                   callp     wrtsection('endhtml')
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      *
     C                   close     BRPARF
     C                   close     GSSORF
     C                   close     GSSPOF
     C                   close     GSSPAF
     C                   close     GSSOVF
     C                   close     GSSFGF
N03  C                   close     GSSDGF
     C                   close     FRISOK
     C                   close     KOFAST
     C                   close     BRIDF
     C                   close     ARKIVL11
     C                   close     ARKTXT
     C                   close     ARKEXT
     C                   close     FIRMARC
     C                   close     FIRM
     C                   eval      *inlr = *on
      *
     C                   return
     C                   endsr
      *=====================================================================
      * Parse input string
      *=====================================================================
     C     Parse         begsr
     C                   eval      lng     = zhbgetvar('lng')
     C                   eval      BckGnd  = zhbgetvar('bckgnd')
     C                   EVAL      WSUSER  = zhbgetvar('USER')
     C                   EVAL      WINT    = zhbgetvar('WINT')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   EVAL      WSNA    = zhbgetvar('WSNA')
     C                   EVAL      WSONO   = zhbgetvar('WSONO')
S03  C*                  MOVE      WSONO         ORONO
N03  C                   EVAL      ORONO = c2n2(WSONO)
     C                   EVAL      WSCONO  = zhbgetvar('WSCONO')
     C                   endsr
      *=====================================================================
      * Set html output variables for section /$top
      *=====================================================================
     C     SetTop        begsr
      * Repeat national language for the next invocation
     C                   callp     updhtmlvar('LNG':lng:
     C                             InitHTMLVars)
N07  C                   callp     updHTMLvar('LogoImg':LogoImg)
      *
     C                   callp     updhtmlvar('TXTCOLOR':'black')
     C                   callp     updhtmlvar('BOLD':' ')
     C                   callp     updhtmlvar('BGCOLOR':BIFARG)
     C                   callp     updhtmlvar('LINK':'0000FF')
     C                   callp     updhtmlvar('VLINK':'FF0000')
     C                   callp     updhtmlvar('ALINK':'00FF00')
      * Protocol
     C                   callp     updHtmlVar('PROTOCOL':S_Protocol)
      * KUNDE
     C                   callp     updhtmlvar('WSNA':WSNA)
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updhtmlvar('USER':WSUSER)
     C                   callp     updhtmlvar('WINT':WINT)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHTMLvar('sdato':
     C                             %trim(%editw(BIDTV:'    .  .  ')))
     C                   callp     updHTMLvar('stid':
     C                             %trim(%editw(BITIDV:'  .  .  ')))
     C                   endsr
      *=====================================================================
      * Set html output variables for section /$found (display a boat)
      *=====================================================================
     C     SetFound      begsr
      *
      * Sett inn i HTMLvariabler
     C                   callp     updhtmlvar('WSONO':WSONO)
N02  C                   callp     updhtmlvar('ORRTNG':ORRTNG)
     C                   callp     updhtmlvar('ORONO':
     C                             %trim(%editc(ORONO:'Z')))
     C                   callp     updhtmlvar('ORTNO':
     C                             %trim(%editc(ORTNO:'Z')))
     C                   MOVE      ORTNO         WSTNO
     C                   callp     updhtmlvar('WSTNO':WSTNO)
     C                   callp     updhtmlvar('ORSNO':
     C                             %trim(%editc(ORSNO:'Z')))
     C                   callp     updHtmlVar('ORSNM':ORSNM)
     C                   callp     updhtmlvar('ORCLI':
     C                             %trim(%editc(ORCLI:'Z')))
     C                   callp     updhtmlvar('ORWT':
     C                             %trim(%editc(ORWT:'4')))
     C                   callp     updhtmlvar('ORVOL':
     C                             %trim(%editc(ORVOL:'4')))
     C                   callp     updHtmlVar('ORDSC':ORDSC)
     C                   callp     updHtmlVar('ORLC':ORLC)
     C                   IF        ORDTL = 0
     C                   callp     updhtmlvar('ORDTL':
     C                             %trim(%editw(ORDTWL:'    .  .  ')))
     C                   ELSE
     C                   callp     updhtmlvar('ORDTL':
     C                             %trim(%editw(ORDTL:'    .  .  ')))
     C                   END
     C                   callp     updhtmlvar('ORPOS1':ORPOS1)
     C                   callp     updhtmlvar('ORAMT':
     C                             %trim(%editc(ORAMT:'4')))
     C                   callp     updhtmlvar('ORCURC':ORCURC)
     C                   callp     updhtmlvar('POCONO':POCONO)
     C                   callp     updhtmlvar('w1CONO':w1CONO)
     C                   MOVE      *BLANKS       ORSTAT           30
     C                   SELECT
     C                   WHEN      ORST = 'P'
     C                   EVAL      ORSTAT = 'PRE-REGISTRATIONS'
     C                   WHEN      ((ORST = '0') AND (PAPKD = 'C'))
     C                   EVAL      ORSTAT = 'IN STOCK'
     C                   WHEN      ((ORST = '0') AND (PAPKD = 'P'))
     C                   EVAL      ORSTAT = 'IN STOCK (PARTIAL)'
     C                   WHEN      ((ORST = '0') AND (PAPKD = ' '))
     C                   EVAL      ORSTAT = 'IN STOCK (PARTIAL, NOT COMPL.)'
     C                   WHEN      ((ORST = '1') OR (ORST = '2'))
     C                   IF        PAPKD = 'C'
     C                   EVAL      ORSTAT = 'IN WORK'
     C                   ELSE
     C                   EVAL      ORSTAT = 'IN WORK (PARTIAL)'
     C                   END
     C                   WHEN      ORST > '2'
     C                   IF        PAPKD = 'C'
     C                   EVAL      ORSTAT = 'SHIPPED'
     C                   ELSE
     C                   EVAL      ORSTAT = 'SHIPPED (PARTIAL)'
     C                   END
     C                   ENDSL
     C                   callp     updhtmlvar('ORSTAT':ORSTAT)
     C                   callp     updhtmlvar('PATXT1':PATXT1)
      *
     C                   IF        XAGENT = 'J'
     C     GSSOVFK       CHAIN     GSSOVF                             33
     C                   callp     updhtmlvar('OVAMT':
     C                             %trim(%editc(OVAMT:'4')))
     C                   callp     updhtmlvar('OVCURC':OVCURC)
     C                   callp     updhtmlvar('OVFT':OVFT)
     C                   END
N03  C     ORONO         CHAIN     GSSDGF                             33
N03  C                   IF        *IN33 = *OFF
N03  C                   callp     updhtmlvar('DGUNNR':
N03  C                             %trim(%editc(DGUNNR:'4')))
N03  C                   callp     updhtmlvar('DGPSN':DGPSN)
N03  C                   callp     updhtmlvar('DGCOG':DGCOG)
N03  C                   callp     updhtmlvar('DGPG':DGPG)
N03  C                   callp     updhtmlvar('DGTR':DGTR)
N03  C                   callp     updhtmlvar('DGNOP':
N03  C                             %trim(%editc(DGNOP:'4')))
N03  C                   callp     updhtmlvar('DGKOP':DGKOP)
N03  C                   callp     updhtmlvar('DGGWK':
N03  C                             %trim(%editc(DGGWK:'4')))
N03  C                   MOVE      'H'           XFGTYPE           1            SH TYPE
N03  C                   ELSE
     C     ORONO         CHAIN     GSSFGF                             33
     C                   callp     updhtmlvar('FGFA11':FGFA11)
     C                   callp     updhtmlvar('FGFA12':FGFA12)
     C                   callp     updhtmlvar('FGFLP1':
     C                             %trim(%editc(FGFLP1:'4')))
     C                   callp     updhtmlvar('FGFA21':FGFA21)
     C                   callp     updhtmlvar('FGFA22':FGFA22)
     C                   callp     updhtmlvar('FGFLP2':
     C                             %trim(%editc(FGFLP2:'4')))
N03  C                   EVAL      XFGTYPE = 'C'                                YBC TYPE
N03  C                   END
      *
     C                   endsr
      *=====================================================================
      * Set html output skeleton member before its read into memory
      *=====================================================================
     C     SetSkl        begsr
     C                   eval      lng = uppify(lng)
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC' + lng
     C                   eval      Mbr = 'SS003'
     C                   endsr
      *=====================================================================
      *  Retrieve environment variables
      *=====================================================================
     C     RtvEnvVar     begsr
      * Use getenvp to get this server's protocol
     C                   eval      S_Protocol =getenv('SERVER_PROTOCOL':
     C                             qusec)
      *
     C                   endsr
      ***********************************************
     C     HENTDOK       BEGSR
      ***********************************************
      * Vis kun dokumeter bruker er autorisert for å se...
     C                   move      *blanks       ATString
     C                   MOVE      'ARKTY'       PAID
N08  C                   move      bibrid        pabrid
     C     BrParKey      chain     BRPARF                             33
     c                   dump
     C                   IF        *IN33
     C                   MOVE      'ZO'          A2(1)
     C                   ELSE
     C                   movel     Pavrda        ATstring1
     C     BrParKey      READE     BRPARF                                 33
     C  N33              movel     Pavrda        ATstring2
     C  N33BrParKey      READE     BRPARF                                 33
     C  N33              movel     Pavrda        ATstring3
     C  N33BrParKey      READE     BRPARF                                 33
     C  N33              movel     Pavrda        ATstring4
     C     1             DO        64            ln                2 0
     C                   movea     AT(ln)        A2(ln)
     C                   ENDDO
     C                   END
      *
S04  C*                  Z-ADD     1             XN                3 0
N04  C                   Z-ADD     0             XN                3 0
     C                   MOVEA     *BLANKS       UPDF
     C     ARKIVL11K     SETLL     ARKIVL11
     C     ARKIVL11K     READE     ARKIVL11                               33
     C                   DOW       *IN33 = *OFF
     C     artype        lookup    A2                                     33
     C                   IF        *IN33
     C                   ADD       1             XN
     C                   EXSR      GENBANE
     C                   END
     C     ARKIVL11K     READE     ARKIVL11                               33
     C                   ENDDO
      *
     C                   callp     updHTMLvar('UPDF1':UPDF1)
     C                   callp     updHTMLvar('UPDF2':UPDF2)
     C                   callp     updHTMLvar('UPDF3':UPDF3)
     C                   callp     updHTMLvar('UPDF4':UPDF4)
     C                   callp     updHTMLvar('UPDF5':UPDF5)
     C                   callp     updHTMLvar('UPDF6':UPDF6)
     C                   callp     updHTMLvar('UPDF7':UPDF7)
     C                   callp     updHTMLvar('UPDF8':UPDF8)
     C                   callp     updHTMLvar('UPDF9':UPDF9)
     C                   callp     updHTMLvar('UPDF10':UPDF10)
     C                   callp     updHTMLvar('UPDF11':UPDF11)
     C                   callp     updHTMLvar('UPDF12':UPDF12)
     C                   callp     updHTMLvar('UPDF13':UPDF13)
     C                   callp     updHTMLvar('UPDF14':UPDF14)
     C                   callp     updHTMLvar('UPDF15':UPDF15)
     C                   callp     updHTMLvar('UPDF16':UPDF16)
     C                   callp     updHTMLvar('UPDF17':UPDF17)
     C                   callp     updHTMLvar('UPDF18':UPDF18)
     C                   callp     updHTMLvar('UPDF19':UPDF19)
     C                   callp     updHTMLvar('UPDF20':UPDF20)
N04  C                   callp     updHTMLvar('UPDF21':UPDF21)
N04  C                   callp     updHTMLvar('UPDF22':UPDF22)
N04  C                   callp     updHTMLvar('UPDF23':UPDF23)
N04  C                   callp     updHTMLvar('UPDF24':UPDF24)
N04  C                   callp     updHTMLvar('UPDF25':UPDF25)
N04  C                   callp     updHTMLvar('UPDF26':UPDF26)
N04  C                   callp     updHTMLvar('UPDF27':UPDF27)
N04  C                   callp     updHTMLvar('UPDF28':UPDF28)
N04  C                   callp     updHTMLvar('UPDF29':UPDF29)
N04  C                   callp     updHTMLvar('UPDF30':UPDF30)
N04  C                   callp     updHTMLvar('UPDF31':UPDF31)
N04  C                   callp     updHTMLvar('UPDF32':UPDF32)
N04  C                   callp     updHTMLvar('UPDF33':UPDF33)
N04  C                   callp     updHTMLvar('UPDF34':UPDF34)
N04  C                   callp     updHTMLvar('UPDF35':UPDF35)
N04  C                   callp     updHTMLvar('UPDF36':UPDF36)
N04  C                   callp     updHTMLvar('UPDF37':UPDF37)
N04  C                   callp     updHTMLvar('UPDF38':UPDF38)
N04  C                   callp     updHTMLvar('UPDF39':UPDF39)
N04  C                   callp     updHTMLvar('UPDF40':UPDF40)
      *
     C                   ENDSR
      *
      ***********************************************
     C     genbane       BEGSR
      ***********************************************
     C     ARTYPE        CHAIN     ARKTXT                             33
     C     ARKLAG        IFNE      *blanks
     C                   MOVE      ARKLAG        ARCEXT
     C     ARKEXTK       CHAIN     ARKEXT                             33
     C                   ELSE
     C     FIFIRM        CHAIN     FIRMARC                            33
     C                   END
N05  c  n33arbhis        ifne      *blanks
N05  c                   eval      arcane=arbhis
N05  c                   end
      * genererer bane for lagring
     C                   movel     '<a href="'   UPDF(XN)
     C                   CAT       '/':0         UPDF(XN)
     C                   CAT       ARCANE:0      UPDF(XN)
     C                   CAT       '/':0         UPDF(XN)
     C                   CAT       ARLINK:0      UPDF(XN)
     C                   CAT       '" target="':0UPDF(XN)
     C                   CAT       'SyPDFWind': 0UPDF(XN)
     C                   CAT       '">':0        UPDF(XN)
     C                   IF        ARRFK = *BLANKS
     C                   CAT       'DOC':0       UPDF(XN)
     C                   MOVE      XN            XAN               3
     C                   CAT       XAN:0         UPDF(XN)
     C                   ELSE
     C                   CAT       ARRFK:0       UPDF(XN)
     C                   END
     C                   CAT       '<img src="':0UPDF(XN)
     C                   CAT       '/syspeddev':0UPDF(XN)
     C                   CAT       '/PDF.gif"':0 UPDF(XN)
     C                   CAT       'ALT="':1     UPDF(XN)
     C                   CAT       artxt:0       UPDF(XN)
     C                   CAT       '"></a>':0    UPDF(XN)
      *
n09   * benyttes arkiv i Google Cloud - i så fall vis den lenken (ev innpakke i <a href.... > )
n09  C                   if        %found(FIRMGOOG) and GOBUID <> *blanks
n09  c                   move      *blanks       AH_Pre          100            <A HREF- prefix
n09  c                   move      *blanks       AH_Suf          100            <A HREF- suffix
n09  c                   move      *blanks       ARLINK_X         50
n09  c                   eval      ARLINK_X = ARLINK
n09  C     '.'           SCAN      ARLINK_X                               33
n09  C  N33              eval      ARLINK_X = %trim(ARLINK_X)+'.pdf'            sysped genererte ..
n09   *
n10  c                   move      *blanks       UIFSFull        256
n10  c                   move      *blanks       UIFSNavn         50
n09  C                   eval      UIFSFull= '/'+%trim(ARCANE)+'/'+ARLINK_X
n09  C                   eval      UIFSNavn= ARLINK_X
s10  c*                  call      'SYGE98CL'
s10  c*                  parm                    UIFSFull        256
s10  c*                  parm                    UIFSNavn         50
s10  c*                  parm                    UIFSFins          1
n10  c                   move      'N'           UIFSFins          1
n09   * finnes ikke lokalt vis fra google
n09  c                   if        UifsFins = 'N'
n09  C                   eval      AH_Pre= '<a href="'
n09  C                   eval      AH_Suf= '" target="SyPDFWind">'
n09  C                   IF        ARRFK = *BLANKS
n09  C                   eval      AH_Suf=%trim(AH_Suf)+'DOC'+%editc(XN:'X')
n09  C                   ELSE
n09  C                   eval      AH_Suf=%trim(AH_Suf)+ARRFK
n09  C                   END
n09  C                   eval      AH_Suf=%trim(AH_Suf)+'</a>&nbsp;&nbsp;'
n09   *
n09  C                   eval      UPDF(XN) = %trim(AH_Pre)
n09  C                                      + %trim(GOLENE)+%trim(ARLINK_X)
n09  C                                      + %trim(AH_Suf)
n09  c                   endif
n09  c                   endif
      *
     C                   ENDSR
      *
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
      *
     C                   OPEN      BRIDF
     C     WSUSER        CHAIN(N)  BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   CALLB     'INCGI'
     C                   PARM                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
     C                   open      BRPARF                               50
     C                   open      GSSORF                               50
     C                   open      GSSPOF                               50
     C                   open      GSSPAF                               50
     C                   open      GSSOVF                               50
     C                   open      GSSFGF                               50
N03  C                   open      GSSDGF                               50
     C                   open      FRISOK                               50
     C                   open      KOFAST                               50
     C                   open      ARKIVL11                             50
     C                   open      ARKTXT                               50
     C                   open      ARKEXT                               50
     C                   open      FIRMARC                              50
     C                   open      FIRM                                 50
      *
     C     BrParKey      klist
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
     C                   EVAL      PABRID = WSUSER
     C     BrParFK2      klist
     C                   kfld                    WSUSER
     C                   kfld                    PAKUNR
     C                   kfld                    X1PAID
     C                   MOVE      'SSAGT'       X1PAID            5
N07  c                   move      DftLogo       LogoImg          50
N07  C     BrParFir      klist
N07  C                   kfld                    FIUSER           10
N07  C                   kfld                    PAKUNRF           8 0
N07  C                   kfld                    FIPAID            5
N07  C                   eval      fiuser='*KUNDFT*' + BIFIRM
N07  C                   eval      FIPAID='TLOGO'
N07  C     BrParFir      chain     brparf                             33
N07  c  N33              movel     PAVRDA        LogoImg
     C     GSSOVFK       klist
     C                   kfld                    ORONO
     C                   kfld                    OVLNO
     C     ARKEXTK       KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    ARCEXT
     C     ARKIVL11K     KLIST
     C                   KFLD                    ARSTAT
     C                   KFLD                    ARUNDE
     C                   MOVE      'A'           ARSTAT
     C                   EVAL      ARUNDE = 'SS:'
     C                   MOVE      ORONO         ARUNDE
      *
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   50
      *
N09   * SJEKK OM GOGLE CLOUD ARKIUV BENYTTES (HENT PARAMETRE)
n09  C                   OPEN      FIRMGOOG                             50
n09  C     FIFIRM        chain     FIRMGOOG                           50
n10  c  N50              move      'J'           google            1
n09  C                   CLOSE     FIRMGOOG                             50
      *
     C     ORONO         CHAIN     GSSORF                             50
     C     ORONO         SETLL     GSSPOF
     C     ORONO         READE     GSSPOF                                 50
     C  N50WSCONO        IFNE      *BLANKS
     C                   MOVE      WSCONO        POCONO
     C                   END
     C  N50              UPDATE    GSSPOFR
     c  N50              exsr      hentpo
     C     ORONO         CHAIN     GSSPAF                             50
     C   50              MOVE      'C'           PAPKD
N01   *
N01  C                   MOVE      'AUTOR'       PAID
N01  C     BrParKey      chain     BRPARF                             33
N01  C                   IF        *IN33
N01  C                   MOVE      'N'           XAUT              1
N01  C                   ELSE
N01  C                   MOVEL     PAVRDA        XAUT
N01  C                   END
      *
     C     BRPARFK2      CHAIN     BRPARF                             33
     C  N33              MOVE      'J'           XAGENT            1
      *
     C                   endsr
      *=====================================================================******
      *  Display TRACK & TRACE
      *=====================================================================******
     C     DspTT         begsr

     C     FRISOKKEY     klist
     C                   kfld                    FSAVD
     C                   kfld                    FSOPD
     C                   MOVEL     ORTNO         FSAVD
     C                   MOVE      ORTNO         FSOPD
     C     KOFASTK1      klist
     C                   kfld                    KFTYP1           10
     C                   kfld                    KFKOD
     C                   EVAL      KFTYP1 = 'TRACKPREFI'
     C     KOFASTK2      klist
     C                   kfld                    KFTYP2           10
     C                   kfld                    KFKOD
     C                   EVAL      KFTYP2 = 'TRACKSUFFI'

     C                   MOVE      *ZEROS        XN                3 0
     C     FRISOKKEY     SETLL     FRISOK
     C     FRISOKKEY     READE     FRISOK                                 33
     C                   DOW       *IN33 = *OFF
     C                   EVAL      KFKOD = FSKODE
     C     KOFASTK1      CHAIN     KOFAST                             33
     C                   IF        *IN33 = *OFF
     C                   EVAL      WSSOK = FSKODE
     C                   CAT       FSSOK:1       WSSOK
     C                   EVAL      WSSOKURL = KFTXT
      * append linje 2 (engelsk tekst når siet tegn er A)
     C                   MOVE      KFTXTE        TstAppend         1
     C     TstAppend     IFEQ      'A'
     c                   move      ' '           KFTXTE
     C                   CAT       KFTXTE:0      WSSOKURL
     C                   end
     C                   CAT       FSSOK:0       WSSOKURL
     C     KOFASTK2      CHAIN     KOFAST                             33
     C                   IF        *IN33 = *OFF
     C                   CAT       KFTXT:0       WSSOKURL
     C                   END
     C                   IF        XN = 5
     C                   Z-ADD     1             XN
     C                   callp     wrtsection('TTSTART')
     C                   ELSE
     C                   ADD       1             XN
     C                   END
     C                   SELECT
     C                   WHEN      XN = 1
     C                   callp     updHTMLvar('WSSOK1':WSSOK)
     C                   callp     updHTMLvar('WSSOKURL1':WSSOKURL)
     C                   WHEN      XN = 2
     C                   callp     updHTMLvar('WSSOK2':WSSOK)
     C                   callp     updHTMLvar('WSSOKURL2':WSSOKURL)
     C                   WHEN      XN = 3
     C                   callp     updHTMLvar('WSSOK3':WSSOK)
     C                   callp     updHTMLvar('WSSOKURL3':WSSOKURL)
     C                   WHEN      XN = 4
     C                   callp     updHTMLvar('WSSOK4':WSSOK)
     C                   callp     updHTMLvar('WSSOKURL4':WSSOKURL)
     C                   WHEN      XN = 5
     C                   callp     updHTMLvar('WSSOK5':WSSOK)
     C                   callp     updHTMLvar('WSSOKURL5':WSSOKURL)
     C                   ENDSL
     C                   END
     C     FRISOKKEY     READE     FRISOK                                 33
     C  N33              ENDDO
      *
     C                   IF        XN > 0
     C                   IF        XN < 5
     C                   callp     updHTMLvar('WSSOK5':' ')
     C                   callp     updHTMLvar('WSSOKURL5':' ')
     C                   END
     C                   IF        XN < 4
     C                   callp     updHTMLvar('WSSOK4':' ')
     C                   callp     updHTMLvar('WSSOKURL4':' ')
     C                   END
     C                   IF        XN < 3
     C                   callp     updHTMLvar('WSSOK3':' ')
     C                   callp     updHTMLvar('WSSOKURL3':' ')
     C                   END
     C                   IF        XN < 2
     C                   callp     updHTMLvar('WSSOK2':' ')
     C                   callp     updHTMLvar('WSSOKURL2':' ')
     C                   END
     C                   callp     wrtsection('TTSTART')
     C                   END
      *
     C                   endsr
      *=====================================================================******
      *  Display TRACK & TRACE
      *=====================================================================******
     C     hentpo        begsr
      *
     c                   clear                   w1cono
     c                   movel     pocono        w1cono
     c     *in(50)       doweq     '0'
     C     ORONO         READE     GSSPOF                                 50
     C  n50w1cono        CAT       '<br>':0      w1cono
     C  n50w1cono        CAT       pocono:0      w1cono
     c  n50              enddo
     c                   endsr
