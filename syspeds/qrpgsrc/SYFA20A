      *
      ***********************************************************
      *** PROGRAM SKAL FINNER FORFALLSDATO                    ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01-26                            ***
      *** LEDIGE INDIKATORER 27-32 34-90 93-98                ***
      ***********************************************************
      *
     FKODAL01   IF   E           K DISK
     D                 DS
     Didag                             D   datfmt(*iso)
     D                 DS
     Dforfall                          D   datfmt(*iso)
     D                 DS
     Ddato                     1      8  0
     DDAG                      1      2  0
     DMND                      3      4  0
     DAAR                      5      8  0
     D                 DS
     DdatoX                    1      6  0
     DDAGX                     1      2  0
     DMNDX                     3      4  0
     DAARX                     5      6  0
     D                 DS
     Ddatoi                    1     10
     Daari                     1      4
     Dhyf1                     5      5
     Dmndi                     6      7
     Dhyf2                     8      8
     Ddagi                     9     10
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XUL≈≈                 11     14  0
     C*
     C* PARAMETRE INN TIL PROGRAMMET
     C*
     C*
     C     KODTK         KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    UBETBE
     C*
     c     *entry        plist
     c                   parm                    UDATO             6 0
     C                   PARM                    UBETXT           30
     C                   PARM                    UFIRM             2
     C                   PARM                    UBETBE            2
     C     KODTK         CHAIN     KODAL01                            33
     C     *IN(30)       IFEQ      '1'
     C                   GOTO      SLUTT
     C                   END
     C                   MOVE      BETTXT        UBETXT
     C*
     C* HENTER UDATE
     C*
     C                   TIME                    XULTID
     C
     C*
     C* FLYTTER HVIS DATO HAR PARAMETER
     C*
     C                   CLEAR                   DATO
     C     UDATO         IFNE      *ZEROS
     c                   move      UDATO         datoX
     C                   MOVE      DAGX          DAG
     C                   MOVE      MNDX          MND
     C                   MOVE      AARX          AAR
     C*
     C* HVIS AAR ER < 50 LEGGES 20  TI CENTURY
     C*
     C     AAR           IFLT      50
     C                   MOVEL     20            AAR
     C                   ELSE
     C                   MOVEL     19            AAR
     C                   END
     C*
     C* ELLERS FLYTTES UDATE INN
     C*
     C                   ELSE
     C                   MOVE      XUL≈≈         AAR
     C                   MOVE      XULMM         MND
     C                   MOVE      XULDD         DAG
     C                   END
     C*
     C* FRI LEVERINGSM≈TE KALLER EGEN RUTINE
     C*
     C     FRILEV        IFEQ      'F'
     C                   EXSR      FRISR
     C                   END
     C*
     C*
     C* FLYTTER DAT TIL VARIABEL P≈ DATOFORMAT
     C*
     c                   move      aar           aari
     c                   move      mnd           mndi
     c                   move      dag           dagi
     c                   move      '-'           hyf1
     c                   move      '-'           hyf2
     C* FLYTTER INNG≈ENDE DATO OVER TIL DATOPARAMETRENE
     C*
     c                   MOVE      DATOI         IDAG
     c                   MOVE      DATOI         FORFALL
     C*
     C* LEGGER TIL DAGER HVIS ÿNSKELIG
     C*
     C     TIDBER        IFEQ      'D'
     C     idag          adddur    BETTID:*days  forfall
     C                   END
     C*
     C* LEGGER TIL M≈NED HVIS ÿNSKELIG
     C*
     C     TIDBER        IFEQ      'M'
     C     idag          adddur    BETTID:*MONTHSforfall
     C                   END
     C*
     C* LEGGER BEREGNET DATO TILBAKE I PARAMETER
     C*
     c                   extrct    forfall:*y    aar04             4 0
     C                   MOVE      AAR04         AARX
     c                   extrct    forfall:*m    mndX
     c                   extrct    forfall:*d    dagX
     c                   move      datoX         UDATO
     C     SLUTT         TAG
     c                   seton                                        lr
     c                   return
     C********************************************************
     C     FRISR         BEGSR
     C********************************************************
     C*
     C* VED ≈RSOVERGANG
     C*
     C     MND           IFEQ      01
     C     MND           OREQ      03
     C     MND           OREQ      05
     C     MND           OREQ      07
     C     MND           OREQ      08
     C     MND           OREQ      10
     C     MND           OREQ      12
     C                   Z-ADD     31            DAG
     C                   ELSE
     C                   Z-ADD     30            DAG
     C                   END
     C*
     C* VED M≈NED 2 (SKUDD≈R)
     C*
     C     MND           IFEQ      2
     C     AAR           DIV       4             AARSKU            4 0
     C                   MULT      4             AARSKU
     C*SKUDD≈R
     C     AARSKU        IFEQ      AAR
     C                   Z-ADD     29            DAG
     C                   ELSE
     C                   Z-ADD     28            DAG
     C                   END
     C                   END
     C                   ENDSR
