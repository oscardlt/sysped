     D                 DS
     D  XTXT801                1   1024
     D  XT801                  1   1024    DIM(1024)
     D                 DS
     D  XTXT802                1   1024
     D  XT802                  1   1024    DIM(1024)
     c                   exsr      init
     c                   exsr      knvst
     c                   movel     xtxt802       udat1
     c                   move      xtxt802       udat2
     c                   seton                                        lr
     c                   return
      ***********************************************
     C     KNVST         BEGSR
      ***********************************************
     C                   Z-ADD     1000          XN53              4 0
     C     XN53          SUB       4             XN54              4 0
     C     XN53          SUB       5             XN55              4 0
     C     XN53          SUB       6             XN56              4 0
     C                   Z-ADD     0             XN52              4 0
     C                   MOVE      *BLANKS       XTXT802
     C     1             DO        1024          XN51              4 0
      * TESTER SPESIALTEGNENE
     C                   IF        (((((XT801(XN51) = '&') OR
     C                                 (XT801(XN51) = '"')) OR
     C                                 (XT801(XN51) = XAPS)) OR
     C                                 (XT801(XN51) = '<')) OR
     C                                 (XT801(XN51) = '>'))
     C                   IF        XN52 < XN53
     C                   ADD       1             XN52
     C                   SELECT
     C                   WHEN      XT801(XN51) = '&'
     C                   IF        XN51 < XN55
     C                   MOVEA     '&amp;'       XT802(XN52)
     C                   ADD       4             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = '"'
     C                   IF        XN51 < XN56
     C                   MOVEA     '&quot;'      XT802(XN52)
     C                   ADD       5             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = XAPS
     C                   IF        XN51 < XN56
     C                   MOVEA     '&apos;'      XT802(XN52)
     C                   ADD       5             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = '>'
     C                   IF        XN51 < XN54
     C                   MOVEA     '&gt;'        XT802(XN52)
     C                   ADD       3             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = '<'
     C                   IF        XN51 < XN54
     C                   MOVEA     '&lt;'        XT802(XN52)
     C                   ADD       3             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   ENDSL
     C                   END
     C                   ELSE
     C                   IF        XN52 < XN53
      * ikke blank skrives uansett
     C     XT801(XN51)   IFNE      *BLANKS
     C                   ADD       1             XN52
     C                   MOVE      XT801(XN51)   XT802(XN52)
     C                   END
      *  blank skrives bare hvis forrige ikke er blank
     C     XT801(XN51)   IFEQ      *BLANKS
     C     FORIGE        ANDNE     *BLANKS
     C                   ADD       1             XN52
     C                   MOVE      XT801(XN51)   XT802(XN52)
     C                   END
     C                   MOVE      XT801(XN51)   FORIGE            1
     C                   ELSE
     C                   LEAVE
     C                   END
     C                   END
     C                   ENDDO
      *
     C                   ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
      *
     c     *entry        plist
     c                   parm                    udat1           512
     c                   parm                    udat2           512
     c                   movel     udat1         XTXT801
     c                   move      udat2         XTXT801
     C                   BITON     '123457'      XAPS              1
     C                   BITOFF    '06'          XAPS
     C                   Z-ADD     1000          XN53              4 0
     C     UDAT2         IFEQ      *BLANKS
     C                   Z-ADD     530           XN53
     C                   END
     C                   ENDSR
