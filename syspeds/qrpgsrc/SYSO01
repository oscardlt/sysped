      *********************************************************************
      * PROGRAM BEHANDLER INPUT FRA SYSO00 OG VISER LISTE
      *
CRTPG+*  CRTPGM SYSPED/SYSO01 MODULE(*LIBL/SYSO01
CRTPGM*        *LIBL/CHECKUSR *LIBL/INCGI) ACTGRP(CGI) AUT(*USE)
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 Full omskriving i forb men innføring av TABLESORT mm
10XXX * 02 YBC PTF10 TILDATO PROBLEM
10315 * 03 YBC PTF10 SØK ANDRE REFERANSER UTEN KODE
10XXX * 04 YBC PTF10 TOP OG BUNN
10XXX * 05 YBC PTF10 VIS EN ANNEN FARGE PÅ LINJE HVIS BRUKER HAR GITT FRITEKST
10XXX * 06 JOV PTF10 Ves søk på kolli-ID med foranstilt 00 oppgitt, stripp bort AI
10XXX * 07 YBC PTF10 FEILRETTING PÅ ENDRING 2
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11XXX * 08 YBC PTF11 DIV. SØKING AV SJØ-MODULS
11XXX * 09 YBC PTF11 RETT FEIL I ENDRING 4
11XXX * 10 YBC PTF11 KUN SPESIFISERT AVDELING
********************************************************************
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
     FBRPARF    if   e           k disk    usropn
     FFAIN      IF   E           K DISK    USROPN
     FHEADF     IF   E           K DISK    USROPN
     FHEADDT    IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFRDT)
     FHEAD14    IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFR14)
     FHEAD17    IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFR17)
     FHEAD18    IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFR18)
     FHEAD19    IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFR19)
     FHEAD29    IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFR29)
     FHEAD30    IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFR30)
     FHEAD31    IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFR31)
     FHEAD32    IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFR32)
N08  FBILLOFLG  IF   E           K DISK    USROPN
N08  F                                     RENAME(BILLOFR:BILLOFRG)
N08  FBLJOINLF  IF   E           K DISK    USROPN
     FFRISOL01  IF   E           K DISK    USROPN
     FFRISOL03  IF   E           K DISK    USROPN
     F                                     RENAME(FRISOKR:FRISOKR3)
N03  FFRISOL04  IF   E           K DISK    USROPN
N03  F                                     RENAME(FRISOKR:FRISOKR4)
     FDOKUFM1   IF   E           K DISK    USROPN
     FBRIDF     UF   E           K DISK    USROPN
     FCUNDL01   IF   E           K DISK    USROPN
     FGSSCGL02  IF   E           K DISK    USROPN
     FFREETXT2  IF   E           K DISK    USROPN
      *--------------------------------------------------------------------
      * Prototype defintions and standard system API error structure
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
     D IfsMultIndicators...
     d                 ds
     D  NoErrors                       n
     D  NameTooLong                    n
     D  NotAccessible                  n
     D  NoFilesUsable                  n
     D  DupSections                    n
     D  FileIsEmpty                    n

      *--------------------------------------------------------------------
     D OddEven         s             10
      * Variables received from the input string
     D BckGnd          s             10
     D UsrSpcName      s             10
     D WSUSER          S             10
     D WSNA            S             30
     D WSKN            S              8
     D KN              S              8  0 DIM(30)
     D WSAVD           S              4
     D WSOPD           S              7
     D WSGN            S             15
     D WSAWBN          S             15
     D WSFN            S              7
     D WSDTF           S              8
     D WSDTT           S              8
     D WSDTTN          S              8  0
     D WSKNA           S              8
     D WSDTKNA         S              9
     D*WSRFA           S             15
     D WSRFA           S             35
     D WSPRO           S              8
     D WSHAWB          S              9
     D WSDTHAWB        S              8
     D WSOT            S              2
     D WSDTOT          S              8
     D WSCONT          S             17
     D WSFRI1          S              3
     D WSFRI2          S             35
     D WSDTFS          S              8
     D WSDTFST         S              8
     D WSSAML          S              6
     D WSMRK1          S             35
     D LK_SDF          S              8
     D LK_SDT          S              8
N08  D WSBLNR          S             16
N08  D WSBLCN          S             17
     D lstbrd          s              1
     D GrpNr           s              8
     D VALG01          S             50
     D VALG02          S             50
     D VALG03          S             50
     D VALG04          S             50
     D VALG05          S             50
     D VALG06          S             50
     D VALG07          S             50
     D VALG08          S             50
     D VALG09          S             50
     D VALG10          S             50
     D VALG11          S             50
     D VALG12          S             50
     D VALG13          S             50
     D VALG14          S             50
N08  D VALG15          S             50
N08  D VALG16          S             50
N08  D VALG17          S             50
     D VALG99          S             50
N04  D ANTSND          s              5  0
N04  D MaxSN           s              5
N04  D MaxSND          s              5  0
N04  D ANTRCD          s              5  0
N04  D MaxRC           s              5
N04  D MaxRCD          s              5  0
     D PGM             C                   CONST('SYSPED/CHECKUSR')
N08  D                 DS
N08  D  BLMN                   1     17
N08  D  BVMN                   1     17
N08  D                 DS
N08  D  BLAVD                  1      4  0
N08  D  BVAVD                  1      4  0
N08  D                 DS
N08  D  BLOPD                  1      7  0
N08  D  BVOPD                  1      7  0
N10  D                 DS
N10  D  ParmOS1                1   1024
N10  D  KAV                  198    247    DIM(10)
      * Variables received from the input string
      * and converted to numeric
     D zeros           s             15a   inz('000000000000000')
     D NIER            s             35A   INZ('9999999999999999999999999999999-
     D                                     9999')
     D l1              s              3s 0
     D l2              s              3s 0
      * Number of records matching search criteria
     DRecordCnt        s              5S 0
      *
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
      *
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
      *
      * tekstkonstanter på n=norsk e=engelsk (t=tysk)
     D VALG01no        C                   CONST('Oppdragsref.')
     D VALG01en        C                   CONST('Order ref.')
     D VALG02no        C                   CONST('Fakturanr.')
     D VALG02en        C                   CONST('Invoice no.')
     D VALG03no        C                   CONST('AWB nr.')
     D VALG03en        C                   CONST('AWB no.')
     D VALG04no        C                   CONST('Dato')
     D VALG04en        C                   CONST('Date')
     D VALG05no        C                   CONST('Agent nr.')
     D VALG05en        C                   CONST('Agent no.')
     D VALG06no        C                   CONST('Oppdg.ref.')
     D VALG06en        C                   CONST('Customers ref')
     D VALG07no        C                   CONST('Tur nr.')
     D VALG07en        C                   CONST('Trip no.')
     D VALG08no        C                   CONST('HAWB nr.')
     D VALG08en        C                   CONST('HAWB no.')
     D VALG09no        C                   CONST('Container nr.')
     D VALG09en        C                   CONST('Container no.')
     D VALG10no        C                   CONST('Annen ref')
     D VALG10en        C                   CONST('Other ref')
     D VALG11no        C                   CONST('Samlast')
     D VALG11en        C                   CONST('Coload ')
     D VALG12no        C                   CONST('Kolli id')
     D VALG12en        C                   CONST('Colli id')
     D VALG13no        C                   CONST('Oppdragstype.')
     D VALG13en        C                   CONST('Type of order')
     D VALG14no        C                   CONST('Turnr')
     D VALG14en        C                   CONST('Trip No.')
N08  D VALG15no        C                   CONST('BL-nr')
N08  D VALG15en        C                   CONST('BL No.')
N08  D VALG16no        C                   CONST('Containernr')
N08  D VALG16en        C                   CONST('Container No.')
N08  D VALG17no        C                   CONST('Godsnr')
N08  D VALG17en        C                   CONST('Goods No.')
     D VALG99no        C                   CONST('INGET SØK ANGITT!')
     D VALG99en        C                   CONST('NO SEARCH CRITERIA GIVEN!')
N08  D HEADTXT101NO    C                   CONST('Pr. KD')
N08  D HEADTXT101EN    C                   CONST('Pr. CD')
N08  D HEADTXT102NO    C                   CONST('BL-nr')
N08  D HEADTXT102EN    C                   CONST('BL-No')
N08  D HEADTXT103NO    C                   CONST('Containernr')
N08  D HEADTXT103EN    C                   CONST('ContainerNo')
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================******
      * MAIN PROCESS LINE
      *=====================================================================******
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input
     C                   exsr      Parse
     C                   EXSR      INIT
      *
     C                   CALLB     PGM
     C                   PARM                    BIBRID
     C                   PARM                    UsrSpcName
     C                   PARM                    UINN              1
     C                   IF        UINN = 'N'
     C                   GOTO      SLUTT
     C                   END
     C     WSUSER        CHAIN     BRIDF                              50
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           BIDTF
     C                   MOVE      WTM           BITIDF
     C  N50              UPDATE    BRIDFR
      * Set/READ output skeleton html member name
     C                   exsr      SetSkl
      *------------------                                                   ******
      * Write HTML sections
     C                   exsr      SetTop
     C                   callp     wrtsection('top')
     C                   callp     wrtsection('tablestr')
      * hent/skriv oppdrag
     C                   exsr      HentOpd
      * tableend
     C                   callp     wrtsection('tableend')
S04  C*                  callp     wrtsection('endhtml')
      *
N04  C                   callp     updHTMLvar('ANTSND':
N04  C                             %trim(%editc(ANTSND:'3')))
N04  C                   callp     updHTMLvar('MaxSnd':
N04  C                             %trim(%editc(MaxSnd:'3')))
N04  C                   callp     updHTMLvar('ANTRCD':
N04  C                             %trim(%editc(ANTRCD:'3')))
N04  C                   callp     updHTMLvar('MaxRcd':
N04  C                             %trim(%editc(MaxRcd:'3')))
N04  C                   time                    timedata2
N04  C     timedata2     subdur    timedata1     ms:*ms
N04  C                   eval      sec = ms / 1000000
N04  C                   callp     updhtmlvar('runtime':
N04  C                             %trim(%editw(sec:'     0 .   ')))
N04  C                   callp     wrtsection('bot')
N04  C                   callp     wrtsection('stdbot')
     C                   callp     wrtsection('*fini')
     C     SLUTT         tag
     C                   EXSR      EXIT
     C                   return
      *
      *=====================================================================******
      * Parse input
      *=====================================================================******
     C     Parse         begsr
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   eval      BckGnd  = zhbgetvar('bckgnd')
     C                   eval      lstbrd  = zhbgetvar('lstbrd')
     C                   EVAL      WSUSER  = zhbgetvar('USER')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   EVAL      WSNA    = zhbgetvar('KNAVN')
      *
     C                   EVAL      WSKN    = zhbgetvar('WSKN')
      *
     C                   EVAL      WSAVD   = zhbgetvar('WSAVD')
     C                   EVAL      WSOPD   = zhbgetvar('WSOPD')
     C                   EVAL      WSPRO   = zhbgetvar('WSPRO')
      *
     C                   EVAL      WSFN    = zhbgetvar('WSFN')
      *
     C                   EVAL      WSGN    = zhbgetvar('WSGN')
     C                   eval      WSGN    = uppify(WSGN)
      *
     C                   EVAL      WSAWBN  = zhbgetvar('WSAWBN')
     C                   eval      WSAWBN  = uppify(WSAWBN)
     C                   eval      WSAWBN  = '    ' + %TRIM(WSAWBN)
      *
     C                   EVAL      WSDTF   = zhbgetvar('WSDTF')
      *
     C                   EVAL      WSKNA   = zhbgetvar('WSKNA')
     C                   EVAL      WSDTKNA = zhbgetvar('WSDTKNA')
      *
     C                   EVAL      WSRFA   = zhbgetvar('WSRFA')
     C                   eval      WSRFA   = uppify(WSRFA)
      *
     C                   EVAL      WSPRO   = zhbgetvar('WSPRO')
      *
     C                   EVAL      WSHAWB  = zhbgetvar('WSHAWB')
     C                   eval      WSHAWB  = uppify(WSHAWB)
     C                   EVAL      WSDTHAWB= zhbgetvar('WSDTHAWB')
     C                   IF        WSHAWB <> *BLANKS
     C                   EVAL      WSDTF   = *BLANKS
     C                   END
      *
     C                   EVAL      WSOT    = zhbgetvar('WSOT')
     C                   EVAL      WSDTOT  = zhbgetvar('WSDTOT')
     C                   IF        ((WSOT <> *BLANKS) AND (WSDTOT = *BLANKS))
     C                   EVAL      WSDTOT = WDT
     C                   END
     C                   IF        WSOT   <> *BLANKS
     C                   EVAL      WSDTF   = *BLANKS
     C                   END
      *
     C                   EVAL      WSCONT  = zhbgetvar('WSCONT')
     C                   eval      WSCONT  = uppify(WSCONT)
      *
     C                   EVAL      WSFRI1  = zhbgetvar('FSCD')
     C                   IF        WSFRI2 <> *BLANKS
     C                   EVAL      WSDTF   = *BLANKS
     C                   END
     C                   EVAL      WSFRI2  = zhbgetvar('WSFRI2')
     C                   eval      WSFRI2  = uppify(WSFRI2)
     C                   IF        WSFRI1  = 'IFB'
     C                   MOVEL     WSFRI2        XAN03             3
     C                   IF        XAN03   = '401'
     C                   MOVE      WSFRI2        XAN32            32
     C                   EVAL      WSFRI2  = XAN32
     C                   END
     C                   END
      *
     C                   EVAL      WSDTFS  = zhbgetvar('WSDTFS')
     C                   EVAL      WSDTFST = zhbgetvar('WSDTFST')
      *
     C                   EVAL      WSSAML  = zhbgetvar('WSSAML')
     C                   eval      WSSAML  = uppify(WSSAML)
      *
     C                   EVAL      WSMRK1  = zhbgetvar('WSMRK1')
     C                   eval      WSMRK1  = uppify(WSMRK1)
N06   * 20 lang med foranstilt 00 =EAN/GS1, stripp bort AI=00 (lagres ikke i DOKUFM)
N06  c                   if        %subst(WSMRK1:1:2)='00' and
N06  c                             %subst(WSMRK1:20:1)<>' ' and
N06  c                             %subst(WSMRK1:21:1)=' '
N06  C                   eval      WSMRK1  = %subst(WSMRK1:3:18)
N06  c                   endif
N08   *
N08  C                   EVAL      WSBLNR  = zhbgetvar('WSBLNR')
N08  C                   eval      WSBLNR  = uppify(WSBLNR)
N08   *
N08  C                   EVAL      WSBLCN  = zhbgetvar('WSBLCN')
N08  C                   eval      WSBLCN  = uppify(WSBLCN)
      *
     C                   MOVE      *ZEROS        XSKN              8 0
     C                   EVAL      XSKN  = c2n2(WSKN)
     C                   MOVE      *ZEROS        XSAVD             4 0
     C                   EVAL      XSAVD = c2n2(WSAVD)
     C                   MOVE      *ZEROS        XSOPD             7 0
     C                   EVAL      XSOPD = c2n2(WSOPD)
     C                   MOVE      *ZEROS        XSPRO             8 0
     C                   EVAL      XSPRO = c2n2(WSPRO)
     C                   MOVE      *ZEROS        XSFN              7 0
     C                   EVAL      XSFN = c2n2(WSFN)
     C                   EVAL      WSGNMAX = WSGN
     C                   CAT       NIER:0        WSGNMAX          15
     C                   EVAL      WSAWBNMAX = WSAWBN
     C                   CAT       NIER:0        WSAWBNMAX        15
     C                   MOVE      *ZEROS        XSDTF             8 0
     C                   EVAL      XSDTF  = c2n2(WSDTF)
     C                   EVAL      XSDTFMAX = XSDTF
     C                   ADD       10000         XSDTFMAX          8 0
     C                   EVAL      WSDTT   = zhbgetvar('WSDTT')
     C                   eval      wsdttn  = c2n2(WSDTT)
     C     wsdttn        IFNE      *zeros
S02  C*    wsdttn        andlt     XSDTFMAX
S07  C*    wsdttn        andGt     XSDTFMAX
     C                   EVAL      XSDTFMAX = wsdttn
     c                   end
     C                   MOVE      *ZEROS        XSKNA             8 0
     C                   EVAL      XSKNA = c2n2(WSKNA)
     C                   MOVE      *ZEROS        XSDTKNA           8 0
     C                   EVAL      XSDTKNA  = c2n2(WSDTKNA)
     C                   EVAL      WSRFAMAX = WSRFA
     C*                  CAT       NIER:0        WSRFAMAX         15
     C                   CAT       NIER:0        WSRFAMAX         35
     C                   MOVE      *ZEROS        XSPRO             8 0
     C                   EVAL      XSPRO = c2n2(WSPRO)
     C                   EVAL      WSHAWBMAX = WSHAWB
     C                   CAT       NIER:0        WSHAWBMAX         9
     C                   MOVE      *ZEROS        XSDTHAWB          8 0
     C                   EVAL      XSDTHAWB = c2n2(WSDTHAWB)
     C                   MOVE      *ZEROS        XSDTOT            8 0
     C                   EVAL      XSDTOT   = c2n2(WSDTOT)
     C                   EVAL      WSCONTMAX = WSCONT
     C                   CAT       NIER:0        WSCONTMAX        17
     C                   EVAL      WSFRI2MAX = WSFRI2
     C                   CAT       NIER:0        WSFRI2MAX        35
     C                   MOVE      *ZEROS        XSDTFS            8 0
     C                   EVAL      XSDTFS = c2n2(WSDTFS)
     C                   MOVE      *ZEROS        XSDTFST           8 0
     C                   EVAL      XSDTFST = c2n2(WSDTFST)
     C                   EVAL      WSMRK1MAX = WSMRK1
     C                   CAT       NIER:0        WSMRK1MAX        35
N08  C                   EVAL      WSBLNRMAX = WSBLNR
N08  C                   CAT       NIER:0        WSBLNRMAX        16
N08  C                   EVAL      WSBLCNMAX = WSBLCN
N08  C                   CAT       NIER:0        WSBLCNMAX        17
      *
     C                   endsr
      ******************************************************
     C     SetTop        begsr
      ******************************************************
     C                   callp     updHTMLvar('ROWHEAD':RowHead:
     C                             InitHTMLVars)
     C                   callp     updHTMLvar('LogoImg':LogoImg)
      * Color for text, background, links, visited links, active links
     C                   callp     updhtmlvar('TXTCOLOR':'black')
     C                   callp     updhtmlvar('BOLD':' ')
     C                   callp     updhtmlvar('BGCOLOR':BIFARG)
     C                   callp     updhtmlvar('LINK':'0000FF')
     C                   callp     updhtmlvar('VLINK':'FF0000')
     C                   callp     updhtmlvar('ALINK':'00FF00')
      * KUNDE
     C                   callp     updhtmlvar('WSNA':WSNA)
     C                   callp     updhtmlvar('KNAVN':KNAVN)
     C                   callp     updHtmlVar('KUNDE':
     C                             %trim(%editc(BIKUNR:'Z')))
     C                   callp     updhtmlvar('USER':WSUSER)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHTMLvar('sdato':
     C                             %trim(%editw(BIDTV:'    .  .  ')))
     C                   callp     updHTMLvar('stid':
     C                             %trim(%editw(BITIDV:'  .  .  ')))
      *
     C                   callp     updhtmlvar('WSKN':WSKN)
     C                   callp     updhtmlvar('WSAVD':WSAVD)
     C                   callp     updhtmlvar('WSOPD':WSOPD)
     C                   callp     updhtmlvar('WSFN':WSFN)
     C                   callp     updhtmlvar('WSKNA':WSKNA)
     C                   callp     updhtmlvar('WSRFA':WSRFA)
     C                   callp     updhtmlvar('WSPRO':WSPRO)
     C                   callp     updhtmlvar('WSHAWB':WSHAWB)
     C                   callp     updhtmlvar('WSDTHAWB':WSDTHAWB)
     C                   callp     updhtmlvar('WSOT':WSOT)
     C                   callp     updhtmlvar('WSDTOT':WSDTOT)
     C                   callp     updhtmlvar('WSCONT':WSCONT)
     C                   callp     updhtmlvar('WSFRI1':WSFRI1)
     C                   callp     updhtmlvar('WSFRI2':WSFRI2)
     C                   callp     updhtmlvar('WSDTFS':WSDTFS)
     C                   callp     updhtmlvar('WSDTFST':WSDTFST)
     C                   callp     updhtmlvar('WSSAML':WSSAML)
     C                   callp     updhtmlvar('WSMRK1':WSMRK1)
     C                   callp     updhtmlvar('WSDTF':WSDTF)
N08   *
N08  C                   SELECT
N08  C                   WHEN      WSBLNR <> *BLANKS
N08  c                   IF        XSPRÅK = 'EN'
N08  C                   callp     updhtmlvar('HEADTXT1':HEADTXT102EN)
N08  c                   ELSE
N08  C                   callp     updhtmlvar('HEADTXT1':HEADTXT102NO)
N08  c                   END
N08  C                   WHEN      WSBLCN <> *BLANKS
N08  c                   IF        XSPRÅK = 'EN'
N08  C                   callp     updhtmlvar('HEADTXT1':HEADTXT103EN)
N08  c                   ELSE
N08  C                   callp     updhtmlvar('HEADTXT1':HEADTXT103NO)
N08  c                   END
N08  C                   OTHER
N08  c                   IF        XSPRÅK = 'EN'
N08  C                   callp     updhtmlvar('HEADTXT1':HEADTXT101EN)
N08  c                   ELSE
N08  C                   callp     updhtmlvar('HEADTXT1':HEADTXT101NO)
N08  c                   END
N08  C                   ENDSL
      *
     C                   MOVE      *BLANKS       VALGKODE         50
     C                   SELECT
     C                   WHEN      XSAVD <> 0
     C                   callp     updhtmlvar('VALGTXT':VALG01)
     C                   MOVEL     WSAVD         VALGKODE
     C                   CAT       '/':0         VALGKODE
     C                   CAT       WSOPD:0       VALGKODE
     C                   WHEN      XSPRO <> 0
     C                   callp     updhtmlvar('VALGTXT':VALG14)
     C                   MOVEL     WSPRO         VALGKODE
     C                   WHEN      XSFN <> 0
     C                   callp     updhtmlvar('VALGTXT':VALG02)
     C                   MOVEL     WSFN          VALGKODE
     C                   IF        WSFRI1 <> *BLANKS
     C                   CAT       '/':0         VALGKODE
     C                   CAT       WSFRI1:0      VALGKODE
     C                   CAT       '-':0         VALGKODE
     C                   CAT       WSFRI2:0      VALGKODE
     C                   END
     C                   WHEN      WSGN <> *BLANKS
S08  C*                  callp     updhtmlvar('VALGTXT':VALG03)
N08  C                   callp     updhtmlvar('VALGTXT':VALG17)
     C                   MOVEL     WSGN          VALGKODE
     C                   WHEN      WSAWBN <> *BLANKS
     C                   callp     updhtmlvar('VALGTXT':VALG03)
     C                   MOVEL     WSAWBN        VALGKODE
     C                   WHEN      XSDTF <> 0
     C                   callp     updhtmlvar('VALGTXT':VALG04)
     C                   MOVEL     WSDTF         VALGKODE
     C                   WHEN      XSKNA <> 0
     C                   callp     updhtmlvar('VALGTXT':VALG05)
     C                   MOVEL     WSKNA         VALGKODE
     C                   CAT       '/':0         VALGKODE
     C                   CAT       WSDTKNA:0     VALGKODE
     C                   WHEN      WSRFA <> *BLANKS
     C                   callp     updhtmlvar('VALGTXT':VALG06)
     C                   MOVEL     WSRFA         VALGKODE
     C                   WHEN      XSPRO <> 0
     C                   callp     updhtmlvar('VALGTXT':VALG07)
     C                   MOVEL     WSPRO         VALGKODE
     C                   WHEN      WSHAWB <> *BLANKS
     C                   callp     updhtmlvar('VALGTXT':VALG08)
     C                   MOVEL     WSHAWB        VALGKODE
     C                   CAT       '/':0         VALGKODE
     C                   CAT       WSDTHAWB:0    VALGKODE
     C                   WHEN      WSOT   <> *BLANKS
     C                   callp     updhtmlvar('VALGTXT':VALG13)
     C                   MOVEL     WSOT          VALGKODE
     C                   CAT       '/':0         VALGKODE
     C                   CAT       WSDTOT:0      VALGKODE
     C                   WHEN      WSCONT <> *BLANKS
     C                   callp     updhtmlvar('VALGTXT':VALG09)
     C                   MOVEL     WSCONT        VALGKODE
     C                   WHEN      WSFRI2 <> *BLANKS
     C                   callp     updhtmlvar('VALGTXT':VALG10)
     C                   MOVEL     WSFRI2        VALGKODE
     C                   IF        ((XSDTFS <> 0) OR (XSDTFST <> 0))
     C                   CAT       '/':0         VALGKODE
     C                   CAT       WSDTFS:0      VALGKODE
     C                   IF        XSDTFST <> 0
     C                   CAT       '-':0         VALGKODE
     C                   CAT       WSDTFST:0     VALGKODE
     C                   END
     C                   END
     C                   WHEN      WSSAML <> *BLANKS
     C                   callp     updhtmlvar('VALGTXT':VALG11)
     C                   MOVEL     WSSAML        VALGKODE
     C                   WHEN      WSMRK1 <> *BLANKS
     C                   callp     updhtmlvar('VALGTXT':VALG12)
     C                   MOVEL     WSMRK1        VALGKODE
N08  C                   WHEN      WSBLNR <> *BLANKS
N08  C                   callp     updhtmlvar('VALGTXT':VALG15)
N08  C                   MOVEL     WSBLNR        VALGKODE
N08  C                   WHEN      WSBLCN <> *BLANKS
N08  C                   callp     updhtmlvar('VALGTXT':VALG16)
N08  C                   MOVEL     WSBLCN        VALGKODE
     C                   other
     C                   callp     updhtmlvar('VALGTXT':VALG99)
     C                   ENDSL
     C                   callp     updhtmlvar('VALGKODE':VALGKODE)
      *
     C                   SELECT
     C                   WHEN      WSAVD <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG06)
     C                   WHEN      WSFN <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG02)
     C                   WHEN      WSGN <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG06)
     C                   WHEN      WSAWBN <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG06)
     C                   WHEN      WSDTF <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG06)
     C                   WHEN      WSKNA <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG06)
     C                   WHEN      WSRFA <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG06)
     C                   WHEN      WSPRO <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG06)
     C                   WHEN      WSHAWB <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG08)
     C                   WHEN      WSOT   <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG13)
     C                   WHEN      WSCONT <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG09)
     C                   WHEN      WSFRI1 <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG10)
N03  C                   WHEN      WSFRI2 <> *BLANKS
N03  C                   callp     updhtmlvar('REFTXT':VALG10)
     C                   WHEN      WSSAML <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG05)
     C                   WHEN      WSMRK1 <> *BLANKS
     C                   callp     updhtmlvar('REFTXT':VALG12)
N08  C                   WHEN      WSBLNR <> *BLANKS
N08  C                   callp     updhtmlvar('REFTXT':VALG15)
N08  C                   WHEN      WSBLCN <> *BLANKS
N08  C                   callp     updhtmlvar('REFTXT':VALG16)
     C                   other
     C                   callp     updhtmlvar('REFTXT':VALG06)
     C                   ENDSL
      *
     C                   endsr
      *=====================================================================******
      * HENT OPPDRAG
      *=====================================================================******
     C     HENTOPD       BEGSR
N04   *
N04  C                   Move      *zeros        AntSnd
N04  C                   Move      *zeros        AntRcd
N04  C     MaxSnd        IFEQ      *ZEROS
N04  C                   Z-add     1000          MaxSnd
N04  C                   END
N04  C     MaxRcd        IFEQ      *ZEROS
N04  C                   Z-add     50000         MaxRcd
N04  C                   END
      *
S04  C*                  MOVE      *ZEROS        XN                5 0
     C                   SELECT
     C                   WHEN      XSAVD <> 0
     C     HEADFK        SETLL     HEADF
     C                   WHEN      XSFN <> 0
     C     XSFN          SETLL     FAIN
     C                   WHEN      WSGN <> *BLANKS
     C     WSGN          SETLL     HEAD18
     C                   WHEN      WSAWBN <> *BLANKS
     C     WSAWBN        SETLL     HEAD18
     C                   WHEN      XSKNA <> 0
     C     HEAD29K       SETLL     HEAD29
     C                   WHEN      WSRFA <> *BLANKS
     C     WSRFA         SETLL     HEAD17
     C                   WHEN      XSPRO <> 0
     C     XSPRO         SETLL     HEAD14
     C                   WHEN      WSHAWB <> *BLANKS
     C     HEAD31K       SETLL     HEAD31
     C                   WHEN      WSOT   <> *BLANKS
     C     HEAD30K       SETLL     HEAD30
     C                   WHEN      WSCONT <> *BLANKS
     C     WSCONT        SETLL     HEAD32
     C                   WHEN      WSFRI1 <> *BLANKS
     C     FRISOL01K     SETLL     FRISOL01
N03  C                   WHEN      WSFRI2 <> *BLANKS
N03  C     WSFRI2        SETLL     FRISOL04
     C                   WHEN      WSSAML <> *BLANKS
     C     WSSAML        SETLL     HEAD19
     C                   WHEN      WSMRK1 <> *BLANKS
     C     WSMRK1        SETLL     DOKUFM1
N08  C                   WHEN      WSBLNR <> *BLANKS
N08  C     WSBLNR        SETLL     BILLOFLG
N08  C                   WHEN      WSBLCN <> *BLANKS
N08  C     WSBLCN        SETLL     BLJOINLF
     C                   WHEN      XSDTF <> 0
     C     XSDTF         SETLL     HEADDT
     C                   ENDSL
      *
     C     STHENTOPD     TAG
     C                   SELECT
     C                   WHEN      XSAVD <> 0
     C     HEADFK        READE     HEADF                                  50
     C                   WHEN      XSFN <> 0
     C     XSFN          READE     FAIN                                   50
     C  N50              IF        WSFRI1 <> *BLANKS
     C     FRISOL03K     CHAIN     FRISOL03                           33
     C   33              GOTO      STHENTOPD
     C                   END
     C  N50HEADFK2       CHAIN     HEADF                              50
     C                   WHEN      WSGN <> *BLANKS
     C                   READ      HEAD18                                 50
     C  N50WSGNMAX       COMP      HEGN                                 50
     C                   WHEN      WSAWBN <> *BLANKS
     C                   READ      HEAD18                                 50
     C  N50WSAWBNMAX     COMP      HEGN                                 50
     C                   WHEN      XSKNA <> 0
     C     XSKNA         READE     HEAD29                                 50
     C                   WHEN      WSRFA <> *BLANKS
     C                   READ      HEAD17                                 50
     C  N50WSRFAMAX      COMP      HERFA                                50
     C                   WHEN      XSPRO <> 0
     C     XSPRO         READE     HEAD14                                 50
     C                   WHEN      WSHAWB <> *BLANKS
     C                   READ      HEAD31                                 50
     C  N50WSHAWBMAX     COMP      HEHAWB                               50
     C                   WHEN      WSOT   <> *BLANKS
     C     WSOT          READE     HEAD30                                 50
     C                   WHEN      WSCONT <> *BLANKS
     C                   READ      HEAD32                                 50
     C  N50WSCONTMAX     COMP      HETRCN                               50
     C                   WHEN      WSFRI1 <> *BLANKS
     C     WSFRI1        READE     FRISOL01                               50
     C   50              GOTO      SLHENTOPD
     C     WSFRI2MAX     CABLT     FSSOK         SLHENTOPD
     C     HEADFK3       CHAIN     HEADF                              50
     C   50              GOTO      STHENTOPD
     C     XSDTFS        CABGT     HEDTOP        STHENTOPD
     C                   IF        XSDTFST <> 0
     C     XSDTFST       CABLT     HEDTOP        STHENTOPD
     C                   END
N03  C                   WHEN      WSFRI2 <> *BLANKS
N03  C                   READ      FRISOL04                               50
N03  C   50              GOTO      SLHENTOPD
N03  C     WSFRI2MAX     CABLT     FSSOK         SLHENTOPD
N03  C     HEADFK3       CHAIN     HEADF                              50
N03  C   50              GOTO      STHENTOPD
N03  C     XSDTFS        CABGT     HEDTOP        STHENTOPD
N03  C                   IF        XSDTFST <> 0
N03  C     XSDTFST       CABLT     HEDTOP        STHENTOPD
N03  C                   END
     C                   WHEN      WSSAML <> *BLANKS
     C     WSSAML        READE     HEAD19                                 50
     C                   WHEN      WSMRK1 <> *BLANKS
     C                   READ      DOKUFM1                                50
     C  N50WSMRK1MAX     COMP      FMMRK1                               50
     C  N50HEADFK4       CHAIN     HEADF                              50
N08  C                   WHEN      WSBLNR <> *BLANKS
N08  C                   READ      BILLOFLG                               50
N08  C  N50WSBLNRMAX     COMP      BLBLNR                               50
N08  C                   IF        *IN50 = *OFF
N08  C     HEADFKBL      CHAIN     HEADF                              33
N08  C     *IN33         CABEQ     *ON           STHENTOPD
N08  C                   END
N08  C                   WHEN      WSBLCN <> *BLANKS
N08  C                   READ      BLJOINLF                               50
N08  C  N50WSBLCNMAX     COMP      BLMN                                 50
N08  C                   IF        *IN50 = *OFF
N08  C     HEADFKBL      CHAIN     HEADF                              33
N08  C     *IN33         CABEQ     *ON           STHENTOPD
N08  C                   END
     C                   WHEN      XSDTF <> 0
     C                   READ      HEADDT                                 50
     C  N50XSDTFMAX      COMP      HEDTOP                               50
     C                   OTHER
     C                   MOVE      '1'           *IN50
     C                   ENDSL
      *
     C                   IF        *IN50 = *OFF
N10   *
N10  C                   IF        KAV(1) <> *BLANKS
N10  C                   MOVE      HEAVD         HEAVDA            4
N10  C     1             DO        10            XN2               3 0
N10  C                   MOVEL     KAV(XN2)      XAVD              4
N10  C     XAVD          CABEQ     *BLANKS       STHENTOPD
N10  C     XAVD          CABEQ     HEAVDA        STHENTOPD2
N10  C                   ENDDO
N10  C                   GOTO      STHENTOPD
N10  C     STHENTOPD2    TAG
N10  C                   END
N10   *
N04  C                   Add       1             AntRcd
N04  C     AntRcd        CabGe     MaxRcd        SLHENTOPD
     C     HEST          CABEQ     'S'           STHENTOPD
     C     TRSLAG        CABEQ     'FF'          STHENTOPD
     C     TRSLAG        CABEQ     'VF'          STHENTOPD
     C                   IF        XINTERN <> 'J'
     C                   MOVE      'N'           XOK               1
     C                   IF        XKUNEGEN = 'J'
     C                   IF        HEKNSF = BIKUNR OR HEKNKF = BIKUNR
     C                   MOVE      'J'           XOK
     C                   END
     C                   ELSE
     C     1             DO        30            XN2
     C                   IF        KN(XN2) = 0
     C                   LEAVE
     C                   END
     C     HEKNA         IFNE      KN(XN2)
     C     TRKNFA        ANDNE     KN(XN2)
     C     HEKNS         ANDNE     KN(XN2)
     C     HEKNSF        ANDNE     KN(XN2)
     C     HEKNK         ANDNE     KN(XN2)
     C     HEKNKF        ANDNE     KN(XN2)
     C                   ELSE
     C                   MOVE      'J'           XOK
     C                   LEAVE
     C                   END
     C                   ENDDO
     C                   END
     C     XOK           CABEQ     'N'           STHENTOPD
     C                   END
     C                   END
      * Post er lest som skal medtas..
     C                   IF        *IN50 = *OFF
     C                   exsr      SetTabRow
     C                   callp     wrtsection('tablerow')
S09  C*                  Add       1             AntSnd
S09  C*    AntSnd        CabGe     MaxSnd        SLHENTOPD
     C                   IF        XPODMR = 'N'
     C                   callp     wrtsection('POD01')
     C                   ELSE
     C                   callp     wrtsection('POD02')
     C                   END
     C                   callp     wrtsection('POD03')
S04  C*                  ADD       1             XN
S04  C*    XN            CABGT     500           SLHENTOPD
N09  C                   Add       1             AntSnd
N09  C     AntSnd        CabGe     MaxSnd        SLHENTOPD
     C                   GOTO      STHENTOPD
     C                   END
      *
     C     SLHENTOPD     TAG
     C                   ENDSR
      *
      *=====================================================================******
      *  Set output variables for section /$tablerow (table row)
      *=====================================================================******
     C     SetTabRow     begsr
      *
     C     FREETXT2K     SETLL     FREETXT2
     C     FREETXT2K     READE     FREETXT2                               33
     C                   IF        *IN33 = *OFF
S05  C*                  callp     updHTMLvar('ODDEVEN':'FFFF00')
N05  C                   callp     updHTMLvar('COLOR':'<font COLOR=RED>')
N05  C                   ELSE
N05  C                   callp     updHTMLvar('COLOR':'')
     C                   END
     c* Sequence of this Recd (numeric, converted to char)
     c                   move      HEAVD         HEAVDA            4
     C                   callp     updhtmlvar('HEAVD':HEAVDA)
     C*                  callp     updhtmlvar('HEOPD':
     C*                            %trim(%editc(HEOPD:'Z')))
     C                   MOVE      HEOPD         HEOPDA            7
     C                   callp     updhtmlvar('HEOPD':HEOPDA)
     C                   callp     updhtmlvar('HEDTOP':
     C                             %trim(%editw(HEDTOP:'    .  .  ')))
     C                   IF        WSGN = *BLANKS
     C                   callp     updhtmlvar('HEGN':HEGN)
     C                   ELSE
     C                   IF        WSAWBN = *BLANKS
     C                   callp     updhtmlvar('HEGN':HEGN)
     C                   ELSE
     C                   EVAL      XHEGN = XCITESTR
     C                   CAT       HEGN:0        XHEGN            28
     C                   CAT       XCITEEND:0    XHEGN
     C                   callp     updhtmlvar('HEGN':XHEGN)
     C                   END
     C                   ENDIF
     C                   callp     updhtmlvar('HENAS':HENAS)
     C                   callp     updhtmlvar('HENAK':HENAK)
S08  C*                  callp     updhtmlvar('HEKDPL':HEKDPL)
     C                   callp     updhtmlvar('HEFR':HEFR)
     C                   callp     updhtmlvar('HENT':
     C                             %trim(%editc(HENT:'Z')))
     C                   callp     updhtmlvar('HEVKT':
     C                             %trim(%editc(HEVKT:'Z')))
     C                   callp     updhtmlvar('HEM3':
     C                             %trim(%editc(HEM3:'4')))
     C*                  callp     updhtmlvar('HEM3':
     C*                            %trim(%editw(HEM3:'    .   ')))
     C                   callp     updhtmlvar('HELM':
     C                             %trim(%editc(HELM:'4')))
      * burde her egentlig finne ut om det er postal mm....
     c                   eval      LK_SDF = HESDF
     c                   eval      LK_SDT = HESDT
     c     HEUR          IFEQ      'H'
     c                   eval      LK_SDF = HELKA + ' ' + HESDF
     c                   eval      LK_SDT = HETRI + ' ' + HESDT
     c                   end
     C                   callp     updhtmlvar('HESDF':LK_SDF)
     C                   callp     updhtmlvar('HESDT':LK_SDT)
     C                   callp     updhtmlvar('HEPRO':
     C                             %trim(%editc(HEPRO:'Z')))
      *
     C                   EVAL      XWSREF = XCITESTR
     C                   SELECT
     C                   WHEN      WSFN <> *BLANKS
     C                   MOVE      FIFN          XFIFN             7
     C                   CAT       XFIFN:0       XWSREF           48
     C                   CAT       XCITEEND:0    XWSREF
     C                   callp     updhtmlvar('WSREF':XWSREF)
     C                   WHEN      WSRFA <> *BLANKS
     C                   CAT       HERFA:0       XWSREF           48
     C                   CAT       XCITEEND:0    XWSREF
     C                   callp     updhtmlvar('WSREF':XWSREF)
     C                   WHEN      WSHAWB <> *BLANKS
     C                   CAT       HEHAWB:0      XWSREF           48
     C                   CAT       XCITEEND:0    XWSREF
     C                   callp     updhtmlvar('WSREF':XWSREF)
     C                   WHEN      WSOT   <> *BLANKS
     C                   CAT       HEOT:0        XWSREF           48
     C                   CAT       XCITEEND:0    XWSREF
     C                   callp     updhtmlvar('WSREF':XWSREF)
     C                   WHEN      WSCONT <> *BLANKS
     C                   CAT       HETRCN:0      XWSREF           48
     C                   CAT       XCITEEND:0    XWSREF
     C                   callp     updhtmlvar('WSREF':XWSREF)
     C                   WHEN      WSFRI1 <> *BLANKS
     C                   CAT       FSSOK:0       XWSREF           48
     C                   CAT       XCITEEND:0    XWSREF
     C                   callp     updhtmlvar('WSREF':XWSREF)
N03  C                   WHEN      WSFRI2 <> *BLANKS
N03  C                   CAT       FSSOK:0       XWSREF           48
N03  C                   CAT       XCITEEND:0    XWSREF
N03  C                   callp     updhtmlvar('WSREF':XWSREF)
     C                   WHEN      WSMRK1 <> *BLANKS
     C                   CAT       FMMRK1:0      XWSREF           48
     C                   CAT       XCITEEND:0    XWSREF
     C                   callp     updhtmlvar('WSREF':XWSREF)
     C                   OTHER
     C                   callp     updhtmlvar('WSREF':HERFA)
     C                   ENDSL
     c     HEDTMO        Ifne      *zeros
     c     HEDTMO        andne     *blanks
     C                   move      HEDTMO        PODdato           8 0
     C                   callp     updhtmlvar('PODdato':
     C                             %trim(%editw(PODdato:'    .  .  ')))
     c                   else
     C                   callp     updhtmlvar('PODdato':spaces)
     c                   end
N08  C                   SELECT
N08  C                   WHEN      WSBLNR <> *BLANKS
N08  C                   callp     updhtmlvar('HEKDPL':BLBLNR)
N08  C                   WHEN      WSBLCN <> *BLANKS
N08  C                   callp     updhtmlvar('HEKDPL':BLMN)
N08  C                   OTHER
N08  C                   callp     updhtmlvar('HEKDPL':HEKDPL)
N08  C                   ENDSL
      *
     C                   endsr
      *=====================================================================******
      * Set html output skeleton member/read into memory
      *=====================================================================******
     C     SetSkl        begsr
      *------------------
     c     XSPRÅK        ifeq      'EN'
     C                   eval      IfsMultIndicators = gethtmlifsmult(
S04  C*                            '/syspeddev/html/SYSO02EN.html':
N04  C                             '/syspeddev/html/Header/eSpedTop.html -
N04  C                             /syspeddev/html/SYSO02EN.html -
N04  C                             /syspeddev/html/Footer/eSpedBotEN.html':
     C                             '/CGITAG/')
     c                   else
     C                   eval      IfsMultIndicators = gethtmlifsmult(
S04  C*                            '/syspeddev/html/SYSO02.html':
N04  C                             '/syspeddev/html/Header/eSpedTop.html -
N04  C                             /syspeddev/html/SYSO02.html -
N04  C                             /syspeddev/html/Footer/eSpedBot.html':
     C                             '/CGITAG/')
     c                   endif
     C                   endsr
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   OPEN      BRIDF
     C     WSUSER        CHAIN(N)  BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
OddEv * hent Parametre som går igjen i mange prog:
OddEv *      Odd/Even/Rowhead-farger,Logobilde,Språk,Intern/Ekstern bruker,  mm
OddEvc                   call      'ESGETPAR'
OddEvc                   parm                    BIBRID
OddEvc                   parm                    BIFIRM
OddEvc                   parm                    BIKUNR
OddEvc                   parm                    BIKNG
OddEvc                   parm                    RowHead          10
OddEvc                   parm                    Odd              10
OddEvc                   parm                    Even             10
OddEvc                   parm                    LogoImg          50
OddEvc                   parm                    XSPRÅK            2
OddEvc                   parm                    XINTERN           1
OddEvc                   parm                    ParmDS1        1024
OddEvc                   parm                    ParmDS2        1024
OddEvc                   parm                    ParmDS3        1024
N10   * HENTER PARAMETER
N10  C                   CALL      'ESGETOS'
N10  C                   parm                    BIBRID
N10  C                   parm                    BIFIRM
N10  C                   parm                    BIKUNR
N10  C                   parm                    BIKNG
N10  C                   parm                    ParmOS1        1024
      *
     C                   open      FAIN                                 50
     C                   open      HEADF                                50
     C                   open      HEADDT                               50
     C                   open      HEAD14                               50
     C                   open      HEAD17                               50
     C                   open      HEAD18                               50
     C                   open      HEAD19                               50
     C                   open      HEAD29                               50
     C                   open      HEAD30                               50
     C                   open      HEAD31                               50
     C                   open      HEAD32                               50
N08  C                   open      BILLOFLG                             50
N08  C                   open      BLJOINLF                             50
     C                   open      FRISOL01                             50
     C                   open      FRISOL03                             50
N03  C                   open      FRISOL04                             50
     C                   open      DOKUFM1                              50
     C                   open      GSSCGL02                             50
     C                   open      FREETXT2                             50
     C                   open      BRPARF                               50
     C                   open      CUNDL01                              50
      *
     C     KunKey        klist
     C                   kfld                    BIFIRM
     C                   kfld                    BIKUNR
     C     HEADFK        klist
     C                   kfld                    XSAVD
     C                   kfld                    XSOPD
     C     HEADFK2       klist
     C                   kfld                    FIAVD
     C                   kfld                    FIOPD
     C     HEADFK3       klist
     C                   kfld                    FSAVD
     C                   kfld                    FSOPD
     C     HEADFK4       klist
     C                   kfld                    FMAVD
     C                   kfld                    FMOPD
N08  C     HEADFKBL      klist
N08  C                   kfld                    BLAVD
N08  C                   kfld                    BLOPD
     C     HEAD29K       klist
     C                   kfld                    XSKNA
     C                   kfld                    XSDTKNA
     C     HEAD31K       klist
     C                   kfld                    WSHAWB
     C                   kfld                    XSDTHAWB
     C     HEAD30K       klist
     C                   kfld                    WSOT
     C                   kfld                    XSDTOT
     C     FREETXT2K     klist
     C                   kfld                    HEAVD
     C                   kfld                    HEOPD
     C                   kfld                    FRTKOD
     C                   MOVE      '1'           FRTKOD
     C     FRISOL01K     klist
     C                   kfld                    WSFRI1
     C                   kfld                    WSFRI2
     C                   kfld                    XSDTFS
     C     FRISOL03K     KLIST
     C                   KFLD                    FIAVD
     C                   KFLD                    FIOPD
     C                   KFLD                    WSFRI2
     C                   KFLD                    WSFRI1
      *
     C                   MOVE      *ZEROS        FIFN
     C                   MOVE      '<CITE>'      XCITESTR          6
     C                   MOVE      '</CITE>'     XCITEEND          7
      *
     C     BRPARFK       klist
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
      *
     C                   EVAL      PABRID = WSUSER
     C                   MOVEL     'SPRÅK'       PAID
     C     BRPARFK       chain     BRPARF                             33
     C                   IF        (*IN33 OR (PAVRDA <> 'EN'))
     C                   MOVE      *BLANKS       XSPRÅK            2
     C                   ELSE
     C                   MOVE      'EN'          XSPRÅK            2
     C                   END
      *
     C                   MOVEL     'PODMR'       PAID
     C     BRPARFK       chain     BRPARF                             33
     C                   IF        (*IN33 OR
     C                             ((PAVRDA <> 'j') AND
     C                              (PAVRDA <> 'J')))
     C                   MOVE      'N'           XPODMR            1
     C                   ELSE
     C                   MOVE      'J'           XPODMR            1
     C                   END
      *
     C                   MOVEL     'HEKUN'       PAID
     C     BRPARFK       chain     BRPARF                             33
     C                   IF        (*IN33 OR
     C                             ((PAVRDA <> 'j') AND
     C                              (PAVRDA <> 'J')))
     C                   MOVE      'N'           XKUNEGEN          1
     C                   ELSE
     C                   MOVE      'J'           XKUNEGEN
     C                   END
      *
     C                   MOVE      *ZEROS        KN
     C                   MOVE      *ZEROS        XN2               3 0
     C                   IF        XSKN = 0
     C                   MOVEL     'KUNGR'       PAID
     C     BRPARFK       chain     BRPARF                             33
     C                   IF        (*IN33 OR (PAVRDA = *BLANKS))
     C                   MOVE      BIKUNR        KN(1)
     C                   ELSE
     C                   MOVEL     PAVRDA        CGCG
     C     CGCG          SETLL     GSSCGL02
     C     CGCG          READE     GSSCGL02                               33
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN2
     C                   MOVE      CGCNO         KN(XN2)
     C     CGCG          READE     GSSCGL02                               33
     C                   ENDDO
     C                   END
     C                   ELSE
     C                   MOVE      XSKN          KN(1)
     C                   END
      * sett tekstkonstannter avhengig av språk
     c                   select
     c     XSPRÅK        wheneq    'EN'
     c                   eval      VALG01     =  VALG01en
     c                   eval      VALG02     =  VALG02en
     c                   eval      VALG03     =  VALG03en
     c                   eval      VALG04     =  VALG04en
     c                   eval      VALG05     =  VALG05en
     c                   eval      VALG06     =  VALG06en
     c                   eval      VALG07     =  VALG07en
     c                   eval      VALG08     =  VALG08en
     c                   eval      VALG09     =  VALG09en
     c                   eval      VALG10     =  VALG10en
     c                   eval      VALG11     =  VALG11en
     c                   eval      VALG12     =  VALG12en
     c                   eval      VALG13     =  VALG13en
     c                   eval      VALG14     =  VALG14en
N08  c                   eval      VALG15     =  VALG15en
N08  c                   eval      VALG16     =  VALG16en
N08  c                   eval      VALG17     =  VALG17en
     c                   eval      VALG99     =  VALG99en
     c                   other
     c                   eval      VALG01     =  VALG01no
     c                   eval      VALG02     =  VALG02no
     c                   eval      VALG03     =  VALG03no
     c                   eval      VALG04     =  VALG04no
     c                   eval      VALG05     =  VALG05no
     c                   eval      VALG06     =  VALG06no
     c                   eval      VALG07     =  VALG07no
     c                   eval      VALG08     =  VALG08no
     c                   eval      VALG09     =  VALG09no
     c                   eval      VALG10     =  VALG10no
     c                   eval      VALG11     =  VALG11no
     c                   eval      VALG12     =  VALG12no
     c                   eval      VALG13     =  VALG13no
     c                   eval      VALG14     =  VALG14no
N08  c                   eval      VALG15     =  VALG15no
N08  c                   eval      VALG16     =  VALG16no
N08  c                   eval      VALG17     =  VALG17no
     c                   eval      VALG99     =  VALG99no
     c                   endsl
     c     KunKey        chain     cundl01                            33
      *
     C                   endsr
      *=====================================================================******
      *  AVSLUTT
      *=====================================================================******
     C     EXIT          begsr
     C                   close     BRPARF
     C                   close     BRIDF
     C                   close     FAIN
     C                   close     HEADF
     C                   close     HEADDT
     C                   close     HEAD14
     C                   close     HEAD17
     C                   close     HEAD18
     C                   close     HEAD19
     C                   close     HEAD29
     C                   close     HEAD30
     C                   close     HEAD31
     C                   close     HEAD32
N08  C                   close     BILLOFLG
N08  C                   close     BLJOINLF
     C                   close     FRISOL01
     C                   close     FRISOL03
N03  C                   close     FRISOL04
     C                   close     DOKUFM1
     C                   close     GSSCGL02
     C                   close     FREETXT2
     C                   close     CUNDL01
     C                   eval      *inlr = *on
      *
     C                   endsr
