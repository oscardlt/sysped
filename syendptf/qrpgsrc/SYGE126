********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 SH  PTF12 FELERE UGYLDIGE TEGN
12XXX * 02 SH  PTF12 ikke blanktegn i epostadressen
12XXX * 03 SH  PTF12 også feil ved stor Æ Ø Å
********************************************************************
     D                 DS
     D  CEMAIL                 1     70
     D  CE                     1     70
     D                                     DIM(70)
     D                 DS
     D  CEMAILN                1     70
     D  CEN                    1     70
     D                                     DIM(70)
     c     *entry        plist
     c                   parm                    UCEMAIL          70
     C                   parm                    msgnr             7
     c                   move      *blanks       msgnr
     c                   move      ucemail       cemail
     c                   exsr      tstscr
     c                   seton                                        lr
     c                   return
      ***********************************************************
     C     TSTSCR        BEGSR
      ***********************************************************
      *
      * ikke blank epostadresse når kunde ulik 0
      *
     C     CEMAIL        IFEQ      *BLANKS
     C                   MOVE      'SHU1128'     MSGNR
     C                   GOTO      TSTEND
     C                   end
      *
      * ikke blank 1. tegn i epostadresse
      *
     c     CE(1)         ifeq      ' '
     C                   MOVE      'SHU2029'     MSGNR
     C                   GOTO      TSTEND
     C                   END
N02   *
N02   * må finnes @ tegn i adressen
N02   *
N02  C     ' '           SCAN      CEMAIL        nr                2 0    63
N02  C     *in63         ifeq      '1'
N02  C     nr            add       1             nrn               2 0
N02  C     nr            add       2             nrn2              2 0
N02  C     nr            add       3             nrn3              2 0
N02  C                   movea     ce(nrn)       tib               1
N02  C                   movea     ce(nrn2)      tib2              1
N02  C                   movea     ce(nrn3)      tib3              1
N02  c     tib           ifne      *blanks
N02  c     tib2          orne      *blanks
N02  c     tib3          orne      *blanks
N02  C                   MOVE      'SHU2078'     MSGNR
N02  C                   GOTO      TSTEND
N02  C                   END
N02  C                   END
      *
      * må finnes @ tegn i adressen
      *
     C     '@'           SCAN      CEMAIL        nr                2 0    63
     C     *in63         ifeq      '0'
     C                   MOVE      'SHU2032'     MSGNR
     C                   GOTO      TSTEND
     C                   END
      *
      * ikke 2 @ i en epostadresse
      *
     c                   move      *blanks       cemailn          70
     C     nr            add       1             nrn               2 0
     C                   movea     ce(nrn)       cen
     c     '@'           SCAN      CEMAILN                                64
     c     *in64         ifeq      '1'
     C                   MOVE      'SHU1906'     MSGNR
     C                   GOTO      TSTEND
     C                   endif
      *
      * må ha . etter @
      *
     C                   movea     ce(nrn)       cen
     c     '.'           SCAN      CEMAILN                                64
     c     *in64         ifeq      '0'
     C                   MOVE      'SHU2031'     MSGNR
     C                   GOTO      TSTEND
     C                   endif
      *
      *
      * mange ugyldige tegn
      *
     c     'mailto:'     SCAN      cemail                                 64
     c  N64';'           SCAN      cemail                                 64
     c  N64','           SCAN      cemail                                 64
     C  N64'æ'           SCAN      cemail                                 64
     C  N64'ø'           SCAN      cemail                                 64
     C  N64'å'           SCAN      cemail                                 64
N03  C  N64'Æ'           SCAN      cemail                                 64
N03  C  N64'Ø'           SCAN      cemail                                 64
N03  C  N64'Å'           SCAN      cemail                                 64
     C  N64'|'           SCAN      cemail                                 64
     C  N64'<'           SCAN      cemail                                 64
     C  N64'>'           SCAN      cemail                                 64
     c     *in64         ifeq      '1'
     C                   MOVE      'SHU1128'     MSGNR
     C                   GOTO      TSTEND
     C                   endif
      *
      * tester avslutningsteg
      *
     c                   z-add     70            nr                2 0
     c                   do        70
     c     CE(nr)        ifne      ' '
      *
     c     CE(nr)        IFGE      'a'
     c     CE(nr)        andle     'z'
     c                   goto      ok
     c                   end
     c     CE(nr)        IFGE      'A'
     c     CE(nr)        andle     'Z'
     c                   goto      ok
     c                   end
     C                   SETON                                        3062
     C                   MOVE      'SHU1905'     MSGNR
     C                   GOTO      TSTEND
     C                   endif
     c                   sub       1             nr
     C                   enddo
     c     ok            tag
     C*
     C     TSTEND        ENDSR
     C*
