      *
      **************************************************************
      *** PROGRAM SKAL ARBEIDE MED TRANSPORTØRAVREGNING          ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER       ***
      *** LEDIGE INDIKATORER                                     ***
      **************************************************************
      *
     FFRISOK    IF   E           K DISK
     FTURER14   IF   E           K DISK
     FHEAD14    IF   E           K DISK
     FFAK2      IF   E           K DISK
     F                                     RENAME(FAKTR:FAKTR2)
     FFIRM      IF   E           K DISK
     FLEVEL01   IF   E           K DISK
     FDOKUF     IF   E           K DISK
     FHODE      IF   E           K DISK
     FSYAV01PF  O    E             PRINTER
     FSYAV11FM  CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     D WF              S             16    DIM(15)
     D                 DS
     D  DSF                    1     16
     D  DSAVD                  1      4
     D  DSOPD                  5     11
     D  DSLI                  12     16
     D                 DS
     D  DSSOK                  1     35
     D  DSAVDY                 1      4  0
     D  DSOPDY                 5     11  0
     D  DSRESY                12     35
     D                 DS
     D  TUDT                   1      8  0
     D  TUDTÅ                  1      4  0
     D  TUDTM                  5      6  0
     D  TUDTD                  7      8  0
     D                 DS
     D  SFDATO                 1      6  0
     D  SFDTD                  1      2  0
     D  SFDTM                  3      4  0
     D  SFDTÅ                  5      6  0
     D                 DS
     D  PPARM                  1    218
     D  PPRO                   1      8  0
     D  PWF                    9    218
      *
     C                   EXSR      INIT
      *
     C     CHOISE        TAG
     C                   Z-ADD     0             FX
     C                   CLEAR                   WF
     C                   EXFMT     BILDE1
      **  AVSLUTT
     C     *IN03         IFEQ      *ON
     C                   GOTO      SLUTT
     C                   ENDIF                                                  <*IN03
     C                   MOVE      *OFF          *IN30
      *  SUBFILE CLEAR
     C     START         TAG
     C     W1TTUR        IFEQ      0
     C                   Z-ADD     W1FTUR        W1TTUR
     C                   ENDIF                                                  <W1TTUR
     C                   CLEAR                   SMBELN
     C                   MOVEA     '00'          *IN(91)
     C                   MOVE      *ON           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C                   CLEAR                   ZRECNO
     C                   CLEAR                   MRECNO
      * FINN ALLE OPPDRAG PÅ TUREN
     C     W1FTUR        SETLL     TURER14
     C     TURLES        TAG
     C                   READE     TURER14                                34
     C                   Z-ADD     TUKNT         LEVNR
     C     LEVKY         CHAIN     LEVEL01                            33
     C     *IN34         IFEQ      *ON
     C                   GOTO      START2
     C                   ENDIF                                                  <*IN34
     C     TUPRO         IFGT      W1TTUR
     C                   GOTO      START2
     C                   ENDIF                                                  <TUPRO
      *
     C                   MOVE      TUDTD         SFDTD
     C                   MOVE      TUDTM         SFDTM
     C                   MOVE      TUDTÅ         SFDTÅ
     C                   Z-ADD     TUPRO         SFPRO
     C                   MOVE      TUBILN        SFBILN
      *
     C     TUPRO         SETLL     HEAD14
     C     HELES         TAG
     C     TUPRO         READE     HEAD14                                 35
     C     *IN35         IFEQ      *ON
     C                   GOTO      TURLES
     C                   ENDIF                                                  <*IN34
      *
     C                   Z-ADD     HEAVD         SFAVD
     C                   Z-ADD     HEOPD         SFOPD
     C                   Z-ADD     HENT          SFNT
     C                   Z-ADD     HEVKT         SFVKT
     C                   Z-ADD     HEFBV         SFFBV
     C                   MOVEL     HEADK3        SFPOST
     C                   MOVEL     HENAK         SFNAK
     C                   MOVEL     HEADK3        SFADK3
     C     HEFR          IFEQ      'HPL'
     C                   MOVEL     'HPL'         SFVS1
     C                   ELSE
     C                   MOVEL     'KRT'         SFVS1
     C                   ENDIF                                                  <HEFR
      *
     C     START1        TAG
      * LES ALLE FAKTURALINJENE PÅ OPPDRAGET
     C     FAK2K         SETLL     FAK2
     C                   SETOFF                                           38
      * HENTER BELØP
     C     FALES         TAG
     C     FAK2K         READE     FAK2                                   39
     C     *IN39         IFEQ      *ON
     C                   GOTO      HELES
     C                   ENDIF                                                  <*IN39
      *
     C     FAVK          IFEQ      'AVR'
      * SJEKK OM LINJEN ER SLETTET
     C                   MOVE      FAAVD         DSAVD
     C                   MOVE      FAOPD         DSOPD
     C                   MOVE      FALI          DSLI
     C     DSF           LOOKUP    WF                                     43
     C                   Z-ADD     FALI          SFLI
     C                   Z-ADD     FABELN        SFBELN
     C     *IN43         IFEQ      *OFF
     C                   ADD       FABELN        SMBELN
     C                   ENDIF                                                  <*IN43
      *
     C                   ELSE
     C                   GOTO      FALES
     C                   ENDIF                                                  <FAVK
      *  SKRIV SUBFILE
     C                   ADD       1             ZRECNO
     C                   ADD       1             MRECNO
     C     *IN43         IFEQ      *ON
     C                   MOVE      *ON           *IN44
     C                   MOVE      'D'           SFDEL
     C                   ELSE
     C                   MOVE      *OFF          *IN44
     C                   MOVE      ' '           SFDEL
     C                   ENDIF                                                  <*IN43
     C                   WRITE     SUBFIL
     C                   MOVEA     '100'         *IN(80)
     C                   GOTO      HELES
      *
     C     START2        TAG
      *
      * AVSLUTT
     C     *IN03         IFEQ      *ON
     C                   GOTO      SLUTT
     C                   ENDIF                                                  <*IN03
      * PRØVEUTSKRIFT
     C                   MOVE      *ON           *IN08
      * PRØVEUTSKRIFT
     C     *IN08         IFEQ      *ON
     C                   EXSR      UTSKR
     C                   Z-ADD     07            LINNBR
     C                   Z-ADD     34            POSNBR
     C                   GOTO      CHOISE
     C                   ENDIF                                                  <*IN08
      * FOREGÅENDE BILDE / NYTT SØK
     C     *IN12         IFEQ      *ON
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     34            POSNBR
     C                   GOTO      CHOISE
     C                   ENDIF                                                  <*IN12
      *
     C                   SETOFF                                       94
      *
     C                   GOTO      START
      *
     C     SLUTT         TAG
     C                   MOVE      *ON           *INLR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     *LIKE         DEFINE    ZRECNO        MRECNO
     C     *LIKE         DEFINE    ZRECNO        ZRRN
     C*--------------------------------------------------------------
     C     TRANK         KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    TUKNT
     C     LEVKY         KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    LEVNR
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL FAKT
     C*--------------------------------------------------------------
     C     FAKTK         KLIST
     C                   KFLD                    SFAVD
     C                   KFLD                    SFOPD
     C                   KFLD                    SFLI
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL FAK2
     C*--------------------------------------------------------------
     C     FAK2K         KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C*
     C                   READ      FIRM                                   32
     C                   Z-ADD     0             FX                2 0
     C                   CLEAR                   WF
     C     UTI           ENDSR
     C*
     C*
     C***********************************************
     C     UTSKR         BEGSR
     C***********************************************
     C*
     C                   CALL      'SYAV02CL'
     C                   PARM                    BRUKER           10
      * HENT HEADING
     C     HODEK         KLIST
     C                   KFLD                    YNET
     C                   KFLD                    TUAVD
      *
     C                   MOVE      ' '           YNET              1
     C     HODEK         CHAIN     HODE                               33
     C*
     C                   Z-ADD     0             XPRO              8 0
     C                   MOVE      *BLANKS       XBILN            10
     C*                    READ SUBFIL                   77
      * SKRIV HEADING
     C                   Z-ADD     0             AVPOS
     C                   Z-ADD     44            ANTDET            2 0
     C                   Z-ADD     44            ANTTUR            2 0
     C                   Z-ADD     0             SIDET
     C                   Z-ADD     0             AMBELN
      * LES SUBFIL
     C                   Z-ADD     0             ZRRN
     C     NYSUB         TAG
     C                   ADD       1             ZRRN
     C     ZRRN          CHAIN     SUBFIL                             77
     C     *IN77         IFEQ      *OFF
      * IKKE TA MED SLETTEDE
     C     SFDEL         IFEQ      'D'
     C                   GOTO      NYSUB
     C                   ENDIF                                                  <SFDEL
      * SNU BELØP
     C     SFBELN        MULT      -1            SFBELN
      * BRUDD TUR
     C     SFPRO         IFNE      XPRO
     C     XPRO          IFNE      0
     C                   WRITE     OPDSUM                               77
     C                   Z-ADD     0             AMBELN
     C                   ENDIF                                                  <XPRO
     C                   Z-ADD     SFPRO         H1PRO
     C                   Z-ADD     SFDATO        H1DATO
     C                   MOVEL     SFBILN        H1BILN
     C                   Z-ADD     SFPRO         XPRO
     C                   Z-ADD     44            ANTDET
     C                   Z-ADD     0             SIDET
     C                   Z-ADD     0             AVPOS
     C                   ENDIF                                                  <SFPRO
      * BRUDD BILNR
     C     SFBILN        IFNE      XBILN
     C     XBILN         IFNE      *BLANKS
     C                   ENDIF                                                  <XBILN
     C                   MOVE      SFBILN        XBILN
     C                   ENDIF                                                  <SFBILN
     C     ANTDET        IFGE      43
     C                   ADD       1             SIDET
     C                   WRITE     OPDH1                                66
     C                   WRITE     OPDH2                                66
     C                   Z-ADD     0             ANTDET
     C                   ENDIF                                                  <ANTDET
      *
     C     ANTTUR        IFGE      43
     C                   Z-ADD     0             ANTTUR
     C                   ENDIF                                                  <ANTTUR
      *
     C                   Z-ADD     SFAVD         AVAVD
     C                   Z-ADD     SFOPD         AVOPD
     C                   MOVEL     SFNAK         AVNAK
     C                   MOVEL     SFADK3        AVADK3
     C                   MOVEL     SFVS1         AVVS1
     C                   Z-ADD     SFNT          AVANT
     C                   Z-ADD     SFVKT         AVVKT
     C                   Z-ADD     SFFBV         AVFBV
     C                   Z-ADD     SFBELN        AVBELN
     C                   ADD       SFBELN        AMBELN
      * LES FRAKTBREV
     C     FRISKK        KLIST
     C                   KFLD                    AVAVD
     C                   KFLD                    AVOPD
     C                   KFLD                    YKODE3            3
      *
     C                   MOVE      'GAV'         YKODE3
     C                   MOVE      *BLANKS       AV1004
     C     FRISKK        CHAIN     FRISOK                             62
     C     *IN62         IFEQ      *OFF
     C                   MOVE      FSSOK         DSSOK
     C                   MOVE      DSAVDY        YAVD              4 0
     C                   MOVE      DSOPDY        YOPD              7 0
     C                   ENDIF                                                  <*IN62
     C*
     C     DOKUKY        KLIST
     C                   KFLD                    YKODE1
     C                   KFLD                    YAVD
     C                   KFLD                    YOPD
     C                   MOVE      'F'           YKODE1            1
     C     DOKUKY        SETLL     DOKUF
     C     DOKUKY        READE     DOKUF                                  37
     C     *IN37         IFEQ      *OFF
     C                   MOVEL     DF1004        AV1004
     C                   ENDIF                                                  <*IN37
      **  SKRIV DETALJELINJE
     C                   ADD       1             AVPOS
     C                   WRITE     OPDDET                               66
     C                   ADD       1             ANTDET
     C                   GOTO      NYSUB
     C                   ENDIF                                                  <*IN40
      *
     C                   WRITE     OPDSUM                               77
      *
     C                   ENDSR
