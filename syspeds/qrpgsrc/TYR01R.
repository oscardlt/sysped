********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10037 * 01 YBC PTF10 TOLL BEREGNINGSMÅTE
10172 * 02 SH  PTF10 norsk text til Track and trace
10286 * 03 YBC PTF10 VEKT ER ENDRET FRA 9.0 TIL 12.3
      *              VAREBESKRIVELSE ER ØKT FRA 15A TIL 30A
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11XXX * 03 YBC PTF11 IKKE HENT TOLL OG MOMS FRA TYRING
11XXX * 04 YBC PTF11 IKKE SLÅ SAMME VARELINJER
********************************************************************
      ***********************************************************
      *** PROGRAM SKAL LAGE SAD-IMPORT VIA TYRINGS DATABASE   **
      ***********************************************************
      *
     FSHPDOC    UF   E             DISK
     FCUSHDR    IF   E           K DISK
     FCUSDET    IF   E           K DISK
     FSHPADRH   IF   E           K DISK
     FDOCATTDOCDIF   E           K DISK
     FDOCCLIDM  IF   E           K DISK
     FDOCCLID   IF   E           K DISK
     FDOCAMOUH  IF   E           K DISK
     FDOCAMOUD  IF   E           K DISK
     FTRACKF    O  A E           K DISK
     FFRISOL01  IF A E           K DISK
     FSADH      UF A E           K DISK
     FSADV      UF A E           K DISK
     FSADF      UF A E           K DISK
     FSTANDI    UF   E           K DISK
     FFIRM      IF   E           K DISK
     FSADSD     IF   E           K DISK
     FTARI      IF   E           K DISK
N01  FTARIPVA   IF   E           K DISK
     FKODTSI    IF   E           K DISK
     FKODTS2    IF   E           K DISK
     FKODTS8    IF   E           K DISK
     FKODTA     IF   E           K DISK
     FCUNDL01   IF   E           K DISK    PREFIX(C1_)
     FCUNDMAF   IF   E           K DISK
     FEDIM1     UF A E           K DISK
     FEDIM2     IF   E           K DISK    RENAME(EDIMR:EDIMR2)
     FEDIM4     IF   E           K DISK    RENAME(EDIMR:EDIMR4)
     FEDIC      UF   E             DISK
     FTVIND     UF A E           K DISK
S03  D*FT              S             17    DIM(7)
N03  D FT              S             28    DIM(7)
     D TO              S             17    DIM(5)
     D RF              S              3    DIM(5)
     D                SDS
     D  UUSR                 254    263
     D                 DS
     D  SHPN                   1     10  0
     D  DOCN                  11     20  0
     D  XREF                   1     20
     D                 DS
     D  SIAVD                  1      4  0
     D  SITDN                  5     11  0
     D  SISG                  12     14
     D  X14S                   1     14
     D                 DS
     D  X0068Æ                 1      9  0
     D  X0068A                10     17  0
     D  X0068B                18     23  0
     D  X0068C                24     25  0
     D  X0068Å                 2     25
     D  XN068Å                 1     25
     D                 DS
     D  SITRT                  1      7  0
     D  SISLAA                 1      1  0
     D  SIDFVF                 2      2  0
     D*
     D*** SI28 I SADH ER TATT I BRUK (FØRST 15 POS.)
     D*** PGA. ENDRING AV REGISTER BESKRIVELSE (SE SADH)
     D*** GJØR VI FØLGENDE DOBBEL DEFINISJON.
     D                 DS
     D  SI28                   1     28
     D  SIBELC                 1     11  2
     D  SIRAB                 12     15  2
     D  SIRABX                12     15
     D  SIRABY                15     15
     D  SI27                   1     27
     D* SPLITTER GODSNUMMER
     D                 DS
     D  WSGN                   1     15
     D  XXGN1                  5      5
     D  XXGN11                 5     15
     D  XXGN10                 6     15
     D  XXGN1B                 7      7
     D  XXGN8                  8     15
      *
     D                 DS
     D  C1_SYRG                1     14
     D  C1_SYFORE              1     11
     D                 DS
     D  KS8FTX                 1     52
     D  KS8MIL                52     52
     D  KS8ØRE                51     51
     D                 DS
     D  W2VNT                  1      8  0
     D  W2LK                   9     10
     D  W2TN                  11     11
     D  W2PRE                 12     12
     D  W2AS                  13     17  2
     D  W2PVA                 18     18
     D  W2MFR                 19     19
     D  W2VF                  20     20
     D  W2BRUD                 1     20
      *
     C                   EXSR      INIT
      *
     C                   READ      SHPDOC                                 33
     C                   DOW       *IN33 = *OFF
     C                   IF        ((PROD ='NOIMP') AND (DOCSTATUS='Q1'))
     C                   IF        ((SHPN = 80) AND (DOCN = 85))
      *
     C                   EXSR      OPDHOD
     C                   EXSR      CIFSR
     C                   EXSR      OPDLIN
     C                   EXSR      SNDTVIN
     C                   LEAVE
      *
     C                   ENDIF
     C                   ENDIF
      *
     C                   READ      SHPDOC                                 33
     C                   ENDDO
      *
     C                   MOVE      '1'           *INLR
     C                   RETURN
      *
      ***********************************************
     C     OPDHOD        BEGSR
      ***********************************************
     C                   EVAL      FSSOK = XREF
     C     FRISOL01K     CHAIN     FRISOL01                           33
     C                   IF        *IN33
     C                   EVAL      SIAVD = 1
     C     SIAVD         CHAIN     STANDI                             33
     C                   MOVE      SITDN         XSITDN            7 0
     C                   ADD       1             SITDN
     C                   UPDATE    STANDIR
     C                   MOVE      ' '           SIST
     C                   MOVE      SIAVD         FSAVD
     C                   MOVE      XSITDN        FSOPD
     C                   WRITE     FRISOKR
     C                   MOVE      XSITDN        SITDN
     C                   MOVE      WDT           SIDT
     C                   MOVE      *ZEROS        SIBELC
     C                   MOVE      *ZEROS        SIRAB
N04  C                   Z-ADD     1             SISLAA
N04  C                   Z-ADD     1             SIDFVF
     C                   WRITE     SADHR
     C                   EXSR      TTSR
     C                   ELSE
     C     SADHK         CHAIN     SADH                               33
     C                   CLEAR                   SADHR
     C                   MOVE      FSAVD         SIAVD
     C                   MOVE      FSOPD         SITDN
     C                   MOVE      WDT           SIDT
     C                   MOVE      *ZEROS        SIBELC
     C                   MOVE      *ZEROS        SIRAB
N04  C                   Z-ADD     1             SISLAA
N04  C                   Z-ADD     1             SIDFVF
     C                   UPDATE    SADHR
     C                   EXSR      TTSR2
     C     SADHK         SETLL     SADV
     C     SADHK         READE     SADV                                   33
     C                   DOW       *IN33 = *OFF
     C                   DELETE    SADVR
     C     SADHK         READE     SADV                                   33
     C                   ENDDO
     C     SADHK         SETLL     SADF
     C     SADHK         READE     SADF                                   33
     C                   DOW       *IN33 = *OFF
     C                   DELETE    SADFR
     C     SADHK         READE     SADF                                   33
     C                   ENDDO
     C                   END
      *
     C     SADHK         CHAIN     SADH                               33
     C     KODTAK        CHAIN     KODTA                              33
     C     CUNDL01K      CHAIN     CUNDL01                            33
     C                   MOVE      C1_SYFORE     XSYFORE          11
      *
      * LES HEADING
     C     CUSHDRK       CHAIN     CUSHDR                             33
      *
     C                   EVAL      SIDTY  = DEKL1
     C*                  EVAL      SIDP   = DEKL2
     C                   MOVEL     DEKL2         SIDP
     C                   EVAL      SINTK  = COLLIN
      *
      * AVSENDER
     C     SHPADRHK1     CHAIN     SHPADRH                            33
     C                   IF        *IN33
     C                   EVAL      SINAS  = *BLANKS
     C                   EVAL      SIADS1 = *BLANKS
     C                   EVAL      SIADS2 = *BLANKS
     C                   EVAL      SIADS3 = *BLANKS
     C                   ELSE
     C                   EVAL      SINAS  = FNAME
     C                   EVAL      SIADS1 = ADR1
     C                   EVAL      SIADS2 = ADR2
     C                   EVAL      SIADS3 = %TRIM(ZIP) + ' ' + %TRIM(CITY)
     C                   END
      *
      * MOTTAKER
     C     SHPADRHK2     CHAIN     SHPADRH                            33
     C                   IF        *IN33
     C                   EVAL      SIRG   = *BLANKS
     C                   EVAL      SINAK  = *BLANKS
     C                   EVAL      SIADK1 = *BLANKS
     C                   EVAL      SIADK2 = *BLANKS
     C                   EVAL      SIADK3 = *BLANKS
     C                   ELSE
     C                   EVAL      SIRG   = %TRIM(VATCOUC) + %TRIM(VATNO)
     C                   EVAL      SINAK  = FNAME
     C                   EVAL      SIADK1 = ADR1
     C                   EVAL      SIADK2 = ADR2
     C                   EVAL      SIADK3 = %TRIM(ZIP) + ' '+ %TRIM(CITY)
     C                   END
      *
      * DEKLARANT
     C     SHPADRHK3     CHAIN     SHPADRH                            33
     C                   IF        *IN33
     C                   EVAL      SITLF  = *BLANKS
     C                   EVAL      SINAD  = *BLANKS
     C                   ELSE
     C                   EVAL      SITLF  = TDSCT3TELE
     C                   EVAL      SINAD  = FNAME
     C                   END
      *
     C                   EVAL      SISG   = TDSCT3
     C                   IF        SISG   = *BLANKS
     C                   EVAL      SISG   = 'TYR'
     C                   EVAL      SITARF = 'TYRING'
     C                   ELSE
     C     KODTSIK       CHAIN     KODTSI                             33
     C                   EVAL      SITARF = KSINAV
     C                   END
     C                   EVAL      SILKA  = CODP
     C*                  EVAL      SILKB  = CODES
     C                   EVAL      SITRID = IDMCB
     C                   EVAL      SILKT  = COMCB
      *
     C     DOCAMOUHK     CHAIN     DOCAMOUH                           33
     C                   EVAL      SIVAL3 = CURC
     C                   EVAL      SIBEL3 = AMOUNT
     C                   EVAL      SIVKU  = KURS
     C*                  EVAL      SITST  = TRAART
     C                   IF        TRAART <> ' '
     C                   MOVEL     TRAART        SITST
     C                   END
     C                   MOVEL     TMAB          SITRM
     C                   EVAL      SILS   = AGAU
     C                   EVAL      SIVKB  = GRWG
      *
     C                   UPDATE    SADHR
      *
     C                   ENDSR
      *
      ***********************************************
     C     CIFSR         BEGSR
      ***********************************************
     C     SADHK         CHAIN     SADH                               33
      *
     C                   MOVE      *ZEROS        XBEL8            11 2
      *
      *** OMREGN FAKTURASUM TIL NORSK KRONE
      *** OG LEGG DETTE PÅ CIFSUM (XBEL4)
     C     KENH          IFNE      0
     C     SIBEL3        MULT      SIVKU         XWORK            16 5
      *   AVRUND CIFSUM
     C     XWORK         DIV(H)    KENH          XFAKNO            9 0          DEF. BILDE05
     C                   Z-ADD     XFAKNO        XBEL4             9 0
     C                   END
      *
      *** OMREGN FRAKT TIL NORSK KRONE
      *** OG LEGG DETTE PÅ CIFSUM (XBEL4)
     C*    SIBEL1        IFNE      0
     C*    SIBEL1        MULT(H)   XKRS1         XKOSTN
     C*    XKOSTN        DIV(H)    XOMR1         XKOSTN
     C*                  Z-ADD     XKOSTN        XBEL8
     C*                  ADD(H)    XKOSTN        XBEL4
     C*    SIDP          IFEQ      49
     C*                  MULT(H)   0.2           XKOSTN
     C*                  END
     C*                  ADD(H)    XKOSTN        XBELS             9 0
     C*                  END
     C*                  MOVE      *ZEROS        XKOSTN
     C*
      *** OMREGN ANDRE KOSTNAD TIL NORSK KRONE
      *** OG LEGG DETTE PÅ CIFSUM (XBEL4)
     C*    XBEL2         IFNE      0
     C*    XBEL2         MULT(H)   XKRS2         XKOSTN
     C*    XKOSTN        DIV(H)    XOMR2         XKOSTN
     C*    SIDP          IFEQ      49
     C*                  MULT(H)   0.2           XKOSTN
     C*                  END
     C*    SIFTG2        IFEQ      '+'
     C*    SIFTG2        OREQ      'P'
     C*                  ADD(H)    XKOSTN        XBEL4
     C*                  ELSE
     C*                  SUB(H)    XKOSTN        XBEL4
     C*                  END
     C*                  END
     C*                  Z-ADD(H)  XKOSTN        XBEL9            11 2
     C*
      *** SJEKK OM FORSIKRING SKAL BEREGNES
     C*    KLBFOK        IFEQ      'A'
     C*    XBEL4         MULT      KLBPRM        XWORK
     C*    XWORK         DIV(H)    1000          XBELA             7 0
     C*    SIDP          IFEQ      49
     C*                  MULT(H)   0.2           XBELA
     C*                  END
     C*                  ELSE
     C*                  MOVE      *ZEROS        XBELA
     C*                  END
     C*                  ADD       XBELA         XBEL4
     C*                  ADD       XBELA         XBELS
      *
     C                   MOVE      XBEL4         SIBEL4
     C*                  MOVE      XBEL9         SIBEL9
     C                   UPDATE    SADHR
      *
     C                   ENDSR
      *
      ***********************************************
     C     OPDLIN        BEGSR
      ***********************************************
     C                   EVAL      XSVLI  = 0
     C     CUSDETK       SETLL     CUSDET
     C     CUSDETK       READE     CUSDET                                 33
     C                   DOW       *IN33 = *OFF
     C                   CLEAR                   SADVR
     C                   EVAL      SVAVD = SIAVD
     C                   EVAL      SVTDN = SITDN
     C                   EVAL      XSVLI = XSVLI + 1
     C                   EVAL      SVLI = XSVLI
     C                   EVAL      SVVF = '1'
     C                   MOVEL     COMMCODE      SVVNT
     C     SVVNT         CHAIN     TARI                               33
     C                   IF        *IN33
     C                   MOVE      00            SVVNT
     C                   MOVE      SVVNT         XSVVNT            8 0
     C                   MOVE      99            XSVVNT
     C     SVVNT         SETLL     TARI
     C                   READ      TARI                                   33
     C  N33TATANR        COMP      XSVVNT                             33
     C                   IF        *IN33
     C                   MOVEL     COMMCODE      SVVNT
     C                   ELSE
     C                   MOVE      TATANR        SVVNT
     C                   END
     C                   END
     C                   MOVEL     ORIGCOUC      SVLK
     C                   EVAL      SVPRE = 'B'
     C                   EVAL      SVVKTB = GROSSW
     C                   EVAL      SVVKTN = NETW
     C                   IF        SVVKTN = 0
S03  C*                  EVAL      SVVKTN = SVVKTB * 1,9
N03  C                   EVAL      SVVKTN = SVVKTB * 0,9
     C                   END
      *
     C     DOCAMOUDK     SETLL     DOCAMOUD
     C     DOCAMOUDK     READE     DOCAMOUD                               33
     C                   DOW       *IN33 = *OFF
     C                   IF        CURC = SIVAL3
     C                   EVAL      SVBELT = AMOUNT
     C                   LEAVE
     C                   END
     C     DOCAMOUDK     READE     DOCAMOUD                               33
     C                   ENDDO
      *
     C     LINJEK        CHAIN     DOCATTDOCD                         41
     C                   IF        *IN41 = *OFF
     C                   EVAL      SVCREF = ATTDOCQ
     C                   EVAL      SVTOA  = ATTDOCR
     C                   END
      *
     C     LINJEK        CHAIN     DOCCLIDM                           42
     C  N42              EVAL      SVFT = MARK
      *
     C     LINJEK        CHAIN     DOCCLID                            33
     C  N33              EVAL      SVNT = COLLIN
     C  N33              EVAL      SVEH = COLLI
N03   *
N03   * FJERN TOLL OG MOMS FRA TYRING
N03  C  N511             DO        7             XN03              1 0           2<-B
N03  C                   IF        AKD(XN03) = 'TL' OR AKD(XN03) = 'MV'           3<-B
N03  C                   MOVE      XN03          XN04              1 0
N03  C                   DOW       XN04 < 7                                        4<-B
N03  C     XN04          ADD       1             XN05              1 0
N03  C                   MOVE      AKD(XN05)     AKD(XN04)
N03  C                   MOVE      ASV(XN05)     ASV(XN04)
N03  C                   MOVE      ASS(XN05)     ASS(XN04)
N03  C                   ADD       1             XN04
N03  C                   ENDDO                                                     4<-E
N03  C                   MOVE      *BLANKS       AKD(7)
N03  C                   MOVE      *BLANKS       ASV(7)
N03  C                   MOVE      *ZEROS        ASS(7)
N03  C                   END                                                      3<-E
N03  C                   ENDDO                                                   2<-E
      *
     C                   EXSR      TESTB1
N03   *
N03  C  N51              MOVE      W2MFR         SVMFR
N03  C  N51              EXSR      SRAVG
      *
     C                   WRITE     SADVR
      *
     C                   EVAL      FT = *BLANKS
     C                   EVAL      TO = *BLANKS
     C                   EVAL      RF = *BLANKS
     C                   MOVE      *ZEROS        XN01              1 0
     C                   MOVE      *ZEROS        XN02              1 0
N03  C                   MOVE      *ZEROS        XN03              1 0
     C                   MOVE      *ZEROS        XN11              1 0
     C                   MOVE      *ZEROS        XN12              1 0
N03  C                   Z-ADD     1             XN13              1 0
     C                   DOW       ((*IN41 = *OFF) OR (*IN42 = *OFF))
     C  N41LINJEK        READE     DOCATTDOCD                             41
     C  N41              IF        XN01 = 5
     C                   EVAL      *IN41 = *ON
     C                   ELSE
     C                   EVAL      XN01 = XN01 + 1
     C                   EVAL      TO(XN01) = ATTDOCQ
     C                   EVAL      RF(XN01) = ATTDOCR
     C                   END
     C  N42LINJEK        READE     DOCCLIDM                               42
     C  N42              IF        XN02 = 7
     C                   EVAL      *IN42 = *ON
     C                   ELSE
     C                   EVAL      XN02 = XN02 + 1
     C                   EVAL      FT(XN02) = MARK
     C                   END
     C                   ENDDO
      *
     C                   EXSR      SÆRAVG
      *
     C                   EVAL      SVBELT = 0
     C                   EVAL      SVVKTB = 0
     C                   EVAL      SVVKTN = 0
     C                   EVAL      SVNTM  = 0
     C                   EVAL      SVNT   = 0
     C                   EVAL      SVEH   = *BLANKS
     C                   EVAL      SVVT   = *BLANKS
     C                   DOW       ((XN01 > XN11) OR (XN02 > XN12))
     C                   EVAL      SVFT   = *BLANKS
     C                   EVAL      SVCREF = *BLANKS
     C                   EVAL      SVTOA  = *BLANKS
     C                   IF        XN01 > XN11
     C                   ADD       1             XN11
     C                   EVAL      SVCREF = RF(XN11)
     C                   EVAL      SVTOA  = TO(XN11)
     C                   END
     C                   IF        XN02 > XN12
     C                   ADD       1             XN12
     C                   EVAL      SVFT   = FT(XN12)
     C                   END
     C                   IF        ((SVFT <> *BLANKS) OR (SVTOA <> *BLANKS))
     C                   EVAL      XSVLI = XSVLI + 1
     C                   EVAL      SVLI = XSVLI
     C                   WRITE     SADVR
     C                   END
     C                   ENDDO
      *
     C     CUSDETK       READE     CUSDET                                 33
     C                   ENDDO
      *
     C                   ENDSR
      *
      ***********************************************
     C     TESTB1        BEGSR
      ***********************************************
     C     SIDP          COMP      47                                     46
     C  N46SIDP          COMP      70                                     46
     C  N46SIDP          COMP      71                                     46
     C  N46SIDP          COMP      72                                     46
     C  N46SIDP          COMP      73                                     46
     C  N46SIDP          COMP      74                                     46
     C  N46SIDP          COMP      76                                     46
     C  N46SIDP          COMP      77                                     46
     C   46              MOVE      'F'           SVPVA
     C   46              MOVE      *ZEROS        SVAS
     C   46              MOVE      'F'           SVMFR
      *
     C     SIDP          IFEQ      57
     C     SVCREF        OREQ      'M2'
     C                   MOVE      'F'           SVMFR
     C                   END
     C     SIDP          IFGE      60
     C     SIDP          ANDLE     69
     C                   MOVE      'F'           SVPVA
     C                   END
      *
      *** CHAIN OPPRINNELSESLAND / TARIFFNR (FOR Å KUNNE SETTE PREF)
     C     KODTS2K       CHAIN     KODTS2                             33
     C     TARIKM        SETLL     TARI
     C     TARIK         READPE    TARI                                   87
     C     *IN87         DOWEQ     '0'
     C     TADATO        IFLE      SIDT
     C     TADTS         ANDEQ     0
     C     TADATO        ORLE      SIDT
     C     TADTS         ANDGE     SIDT
     C                   LEAVE
     C                   END
     C     TARIK         READPE    TARI                                   87
     C  N87              ENDDO
      * DERSOM LANDKODEN TILLATER PREFERANSE OG DET IKKE ER BEVISST
      * SATT "N" FOR INGEN PREF. ER PREF "P" DEFAULT (KOLONNE ETTER LK)
      * (MEN PREF SKAL IKKE SETTES DERSOM VARENR ER FRITT "I SEG SELV")
      * (PREF PÅ VARE SOM ER FRI I KOL. 1  GAV FEIL I TVINN - ENNÅ????)
     C     SVTN          IFEQ      ' '
     C     SVPRE         ANDEQ     ' '
     C     SIDP          IFEQ      71
      * TRANSIT/FRILAGER....
     C     KS2PRE        IFEQ      ' '
     C                   MOVE      'N'           SVPRE
     C                   ELSE
     C                   MOVE      'J'           SVPRE
     C                   END
     C                   ELSE
      * ... ANNET (IKKE PROS 71.)
     C* VED REISEGODS BEHOLD ' '(->N) I PREF ELLERS SETT PREF ETTER LK
     C     SVVNT         IFEQ      *ZEROS
     C     SIDP          ANDEQ     44
     C     SITST         ANDEQ     9
     C                   MOVE      'N'           SVPRE
     C                   ELSE
     C                   MOVE      KS2PRE        SVPRE
     C  N87              IF        ((SVPRE ='A') OR (SVPRE = 'B'))
     C                   IF        TAORDB = TAEFB
     C                   EVAL      SVPRE = 'N'
     C                   END
     C                   END
     C                   END
     C     SVPRE         IFEQ      'B'
     C     SVLK          ANDNE     'CH'
     C     SVLK          ANDNE     'LI'
     C     SVLK          ANDNE     'RO'
     C     SVLK          ANDNE     'BG'
     C     TAEØSB        ANDLE     TAEFB
     C                   MOVE      'A'           SVPRE
     C                   END
     C     SVPRE         IFEQ      'C'
     C     SVLK          ANDNE     'CH'
     C     SVLK          ANDNE     'LI'
     C     TAEØSB        ANDLE     TAEFTB
     C                   MOVE      'A'           SVPRE
     C                   END
     C                   END
     C                   END
      *
     C                   IF        SVCREF = 'M2'                                MVA FRITAK
     C                   MOVE      'F'           SVMFR
     C                   END
      *
      * FLYTTEGODS PÅ PROS 44 / TRANSTYPE =9 - OK MED 0 I TARIFFNR
     C     SVVNT         IFEQ      *ZEROS
     C     SITST         ANDEQ     9
     C                   MOVE      'F'           SVPVA                           ALLTID FRI
     C                   MOVE      *OFF          *IN87
     C                   MOVE      *BLANKS       TASTK
     C                   MOVE      *BLANKS       TAKAP
     C                   MOVE      *BLANKS       TAKAPA
     C                   END
      *
      *** TASTET PREF GIS HØYERE PRIORITET ENN M-FRI (OG ORDINÆR-FRI)
      ***   DERSOM "ØVRIGE KAPITAL HENVENDELSE" VISER TIL M BEHANDLES
      ***   VARE SOM MASKIN-FRI
     C                   MOVEL     TAKAPA        TAKAP2            1
     C     TAKAP         IFNE      'M'
     C     TAKAP2        ANDEQ     'M'
     C                   MOVE      'M'           TAKAP
     C                   END
      *
     C     TAKAP         IFEQ      'M'
     C     SVPRE         IFEQ      ' '
     C     SVPRE         OREQ      'N'
     C                   MOVE      'M'           SVTN
     C                   END
     C                   END
      *
     C     SVPRE         IFNE      ' '
     C     SVPRE         ANDNE     'N'
     C     SVPRE         ANDNE     'J'
      * VED 'G'  SETTES FRI VED BLANK KODE
     C     SVPRE         IFEQ      'G'
     C     SVPVA         ANDEQ     ' '
     C                   MOVE      'F'           SVPVA
     C                   END
     C                   END
      *
     C                   IF        ((SVPVA <> 'F') AND (SVAS = 0))
     C*                  CALL      'SAD061H'
     C*                  PARM      TATANR        U2TANR            8 0
     C*                  PARM      TADATO        U2DATO            8 0
     C*                  PARM                    SVPVA
     C*    SVAS          PARM      SVAS          U2SATS            5 2
     C*                  PARM      SVBELT        U2BL             11 2
     C*                  PARM      SVVKTN        U2VKT             9 0
     C*                  PARM      SVNTM         U2STK             7 0
     C*                  PARM                    SVPRE
     C*                  PARM                    SVLK
     C*                  PARM                    KS2MO
     C                   END
      *
     C  N46SVAS          IFEQ      0
     C                   EXSR      TATEST
     C                   END
      *
     C     SVPVA         IFEQ      'P'
     C                   MOVE      '%'           XEH2              1
     C                   ELSE
     C                   MOVE      ' '           XEH2
     C                   END
      *
     C     SVPRE         IFEQ      ' '
     C                   MOVE      'N'           SVPRE
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     TATEST        BEGSR
      ***********************************************
N01  C     TARIPVAK      CHAIN     TARIPVA                            33
N01  C                   IF        *IN33
N01  C                   EVAL      TAEØSK = ' '
N01  C                   EVAL      TATSJK = ' '
N01  C                   EVAL      TATYRK = ' '
N01  C                   EVAL      TAISRK = ' '
N01  C                   EVAL      TAELLK = ' '
N01  C                   EVAL      TABULK = ' '
N01  C                   EVAL      TAPOLK = ' '
N01  C                   EVAL      TAROMK = ' '
N01  C                   EVAL      TAUNGK = ' '
N01  C                   EVAL      TASLOK = ' '
N01  C                   EVAL      TAMULK = ' '
N01  C                   EVAL      TAOULK = ' '
N01  C                   EVAL      TAGRLK = ' '
N01  C                   EVAL      TAFÆRK = ' '
N01  C                   EVAL      TAISTK = ' '
N01  C                   EVAL      TAMARK = ' '
N01  C                   EVAL      TAMEXK = ' '
N01  C                   EVAL      TAVGAK = ' '
N01  C                   EVAL      TAN01K = ' '
N01  C                   EVAL      TAN02K = ' '
N01  C                   EVAL      TAN03K = ' '
N01  C                   EVAL      TAN04K = ' '
N01  C                   EVAL      TAN05K = ' '
N01  C                   EVAL      TAN06K = ' '
N01  C                   EVAL      TAN07K = ' '
N01  C                   EVAL      TAN08K = ' '
N01  C                   EVAL      TAN09K = ' '
N01  C                   EVAL      TAN10K = ' '
N01  C                   END
N01   *
     C     SVPVA         IFEQ      'F'
     C                   MOVE      *ZEROS        SVAS
     C                   ELSE
     C                   MOVE      TAORDK        SVPVA
     C                   MOVE      TAORDB        SVAS
     C     SVPRE         IFEQ      'A'
     C                   MOVE      TAEØSB        SVAS
N01  C                   IF        TAEØSK <> ' '
N01  C                   EVAL      W2PVA = TAEØSK
N01  C                   END
     C                   ELSE
     C     SVPRE         IFEQ      'B'
     C     SVPRE         OREQ      'F'
     C                   MOVE      TAEFB         SVAS
N01  C                   IF        TAEFK <> ' '
N01  C                   EVAL      W2PVA = TAEFK
N01  C                   END
     C                   ELSE
     C     SVPRE         IFEQ      'C'
     C     SVPRE         OREQ      'E'
     C                   MOVE      TAEFTB        SVAS
N01  C                   IF        TAEFTK <> ' '
N01  C                   EVAL      W2PVA = TAEFTK
N01  C                   END
     C                   ELSE
     C     SVPRE         IFNE      'J'
     C     SVPRE         ANDNE     'N'
     C                   EXSR      TATES2
     C                   END
     C                   END
     C                   END
     C                   END
     C                   END
      *
     C     SVAS          IFEQ      0
     C                   MOVE      'F'           SVPVA
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     TATES2        BEGSR
      ***********************************************
      * HELE SUBRUTINE ER OMSKREVET
     C                   SELECT
     C     SVLK          WHENEQ    'HR'                                         KROATIA
     C                   MOVE      TATSJB        SVAS
N01  C                   IF        TATSJK <> ' '
N01  C                   EVAL      W2PVA = TATSJK
N01  C                   END
     C     SVLK          WHENEQ    'TR'                                         TYRKIA
     C                   MOVE      TATYRB        SVAS
N01  C                   IF        TATYRK <> ' '
N01  C                   EVAL      W2PVA = TATYRK
N01  C                   END
     C     SVLK          WHENEQ    'IL'                                         ISRAEL
     C                   MOVE      TAISRB        SVAS
N01  C                   IF        TAISRK <> ' '
N01  C                   EVAL      W2PVA = TAISRK
N01  C                   END
     C     SVLK          WHENEQ    'SG'                                         SINGAPORE
     C                   MOVE      TAELLB        SVAS
N01  C                   IF        TAELLK <> ' '
N01  C                   EVAL      W2PVA = TAELLK
N01  C                   END
     C     SVLK          WHENEQ    'CL'                                         CHILE
     C                   MOVE      TABULB        SVAS
N01  C                   IF        TABULK <> ' '
N01  C                   EVAL      W2PVA = TABULK
N01  C                   END
     C     SVLK          WHENEQ    'MK'                                         MAKEDONIA
     C                   MOVE      TAPOLB        SVAS
N01  C                   IF        TAPOLK <> ' '
N01  C                   EVAL      W2PVA = TAPOLK
N01  C                   END
     C     SVLK          WHENEQ    'KR'                                         SØR KOREA
     C                   MOVE      TAROMB        SVAS
N01  C                   IF        TAROMK <> ' '
N01  C                   EVAL      W2PVA = TAROMK
N01  C                   END
     C     SVLK          WHENEQ    'JO'                                         JORDAN
     C                   MOVE      TAUNGB        SVAS
N01  C                   IF        TAUNGK <> ' '
N01  C                   EVAL      W2PVA = TAUNGK
N01  C                   END
     C     SVLK          WHENEQ    'TN'                                         TUNISIA
     C                   MOVE      TASLOB        SVAS
N01  C                   IF        TASLOK <> ' '
N01  C                   EVAL      W2PVA = TASLOK
N01  C                   END
     C     SVLK          WHENEQ    'GL'                                         GRØNLAND
     C                   MOVE      TAGRLB        SVAS
N01  C                   IF        TAGRLK <> ' '
N01  C                   EVAL      W2PVA = TAGRLK
N01  C                   END
     C     SVLK          WHENEQ    'FO'                                         FÆRØYENE
     C                   MOVE      TAFÆRB        SVAS
N01  C                   IF        TAFÆRK <> ' '
N01  C                   EVAL      W2PVA = TAFÆRK
N01  C                   END
     C     SVLK          WHENEQ    'IN'                                         INDIA
     C     SVLK          OREQ      'LK'                                         SRI LANKA
     C     SVLK          OREQ      'TH'                                         THAILAND
     C                   MOVE      TAISTB        SVAS
N01  C                   IF        TAISTK <> ' '
N01  C                   EVAL      W2PVA = TAISTK
N01  C                   END
     C     SVLK          WHENEQ    'MA'                                         MAROKKO
     C                   MOVE      TAMARB        SVAS
N01  C                   IF        TAMARK <> ' '
N01  C                   EVAL      W2PVA = TAMARK
N01  C                   END
     C     SVLK          WHENEQ    'MX'                                         MEXICO
     C                   MOVE      TAMEXB        SVAS
N01  C                   IF        TAMEXK <> ' '
N01  C                   EVAL      W2PVA = TAMEXK
N01  C                   END
     C     SVLK          WHENEQ    'PS'                                         VESTBREDDEN OG GAZA
     C                   MOVE      TAVGAB        SVAS
N01  C                   IF        TAVGAK <> ' '
N01  C                   EVAL      W2PVA = TAVGAK
N01  C                   END
     C     SVLK          WHENEQ    'LN'                                         LIBANON
     C                   MOVE      TAN01B        SVAS
N01  C                   IF        TAN01K <> ' '
N01  C                   EVAL      W2PVA = TAN01K
N01  C                   END
     C     SVLK          WHENEQ    'EG'                                         EGYPT
     C                   MOVE      TAN03B        SVAS
N01  C                   IF        TAN03K <> ' '
N01  C                   EVAL      W2PVA = TAN03K
N01  C                   END
     C     SVLK          WHENEQ    'CA'                                         CANADA
     C                   MOVE      TAN04B        SVAS
N01  C                   IF        TAN04K <> ' '
N01  C                   EVAL      W2PVA = TAN04K
N01  C                   END
     C     KS2MO         WHENEQ    'M'                                          MINST UTVIKLEDE LAND
     C                   MOVE      TAMULB        SVAS
N01  C                   IF        TAMULK <> ' '
N01  C                   EVAL      W2PVA = TAMULK
N01  C                   END
     C     KS2MO         WHENEQ    'O'                                          ORDINÆRE UTV.LAND
     C                   MOVE      TAOULB        SVAS
N01  C                   IF        TAOULK <> ' '
N01  C                   EVAL      W2PVA = TAOULK
N01  C                   END
     C     KS2MO         WHENEQ    'S'                                          SACU
     C                   MOVE      TAOULB        SVAS
N01  C                   IF        TAOULK <> ' '
N01  C                   EVAL      W2PVA = TAOULK
N01  C                   END
     C                   ENDSL
      *
     C                   ENDSR
      *
      ******************************************
     C     SÆRAVG        BEGSR
      ******************************************
     C     SVMFR         CABEQ     'F'           SLSAV
      * INIT. VERIABLER SOM HAR MED TILLEGGSLINJER Å GJØRE
     C     SIBEL3        IFNE      0
     C     SIBEL4        DIV(H)    SIBEL3        XTVFAK           17 9
     C                   END
     C     SIBELR        IFNE      0
     C     SIBEL3        ANDNE     0
     C     SIBELS        DIV(H)    SIBEL3        XTVFA2           17 9
     C                   ELSE
     C                   MOVE      *ZEROS        XTVFA2
     C                   END
     C     XTVFA2        IFEQ      0
     C     SVBELT        MULT(H)   XTVFAK        XPROGR            9 0
     C                   ELSE
     C     SVBELT        MULT(H)   XTVFA2        XPROGR            9 0
     C                   END
S02  C*                  Z-ADD     SVVKTN        XVEKGR            9 0
N02  C                   Z-ADD     SVVKTN        XVEKGR           12 3
     C                   Z-ADD     SVNTM         XSTKGR            9 0
     C                   MOVE      *BLANKS       XZKDAÆ            2
     C                   MOVE      *ZEROS        SVBELT
     C                   MOVE      *ZEROS        SVVKTB
     C                   MOVE      *ZEROS        SVVKTN
     C                   MOVE      *ZEROS        SVNTM
     C     SVKDAÆ        IFEQ      *BLANKS
     C                   MOVE      'J'           XXHOVL            1
     C                   ELSE
     C                   MOVE      *BLANKS       W2KDAÆ
     C                   MOVE      *BLANKS       W2KDSÆ
     C                   MOVE      *ZEROS        W2BLGÆ
     C                   MOVE      *ZEROS        W2BLSÆ
     C                   MOVE      *ZEROS        W2BLÆ
     C                   MOVE      'N'           XXHOVL
     C                   END
     C                   MOVE      *BLANKS       SVFT
     C                   MOVE      *ZEROS        SVNT
     C                   MOVE      *BLANKS       SVEH
     C                   MOVE      *BLANKS       SVVT
     C                   MOVE      *BLANKS       SVTOA
     C                   MOVE      *BLANKS       SVCREF
      * INIT. ARBEIDSVARIABLER
     C                   MOVE      *BLANKS       XXKDAÆ            2
     C                   MOVE      *BLANKS       XXKDSÆ            3
     C                   MOVE      *ZEROS        XXBLSÆ            7 2
     C                   MOVE      *BLANKS       XXAKTK            1
      *
     C     SVVNT         SETLL     SADSD
     C     STSA1         TAG
      * LES SÆRAVGIFTSFIL FOR Å SJEKKE OM MAN TRENGER LAGE SÆRAVGIFTER.
     C     SVVNT         READE     SADSD                                  33
     C     *IN33         DOWEQ     '0'
     C     XZKDAÆ        IFEQ      *BLANKS
     C     XZKDAÆ        ORNE      *BLANKS
     C     XZKDAÆ        ANDNE     SDKDAÆ
     C     SDDTF         IFLE      SIDT
     C     SDDTT         ANDGE     SIDT
     C                   LEAVE
     C                   END
     C                   END
     C     SVVNT         READE     SADSD                                  33
     C  N33              ENDDO
     C     *IN33         IFEQ      *OFF
     C     SDAKTK        CABEQ     'I'           STSA1
     C*    XSU           IFEQ      'N'
     C*    SDKDAÆ        CABEQ     'SU'          STSA1
     C*                  END
     C     STSA2         TAG
     C     KODTS8K1      CHAIN     KODTS8                             33
     C  N33KS8MIL        IFEQ      'J'
     C     CUNDMAFK      CHAIN     CUNDMAF                            33
     C     *IN33         CABEQ     '1'           STSA1
     C                   END
      * FINN RIKTIG VERDIFASTSETTELSE
     C     SDVF          IFNE      *BLANKS
     C     SDVF          ANDNE     SVVF
     C                   GOTO      STSA1
     C                   ENDIF                                                  <SDVF
      * FINN RIKTIG TRANPORTMÅTE
     C     SDTRM         IFGT      *ZEROS
     C     SDTRM         ANDNE     SITRM
     C                   GOTO      STSA1
     C                   ENDIF                                                  <SDTRM
      *
     C     XXKDAÆ        IFNE      *BLANKS
     C     XXKDAÆ        IFEQ      SDKDAÆ
     C     XXAKTK        OREQ      'V'
      * HVIS DET FINNES FLERE LINJER MED SAMME SÆRAVGIFT, BES BRUKER
      * TIL Å VELGE EN AV DEM.
     C*                  MOVE      *BLANKS       XXKDSÆ
     C*                  CALL      'SAD061D'
     C*    SVVNT         PARM      SVVNT         UVNTS             8 0
     C*                  PARM                    XXKDAÆ
     C*                  PARM                    XXKDSÆ
     C*                  PARM                    XXBLSÆ            7 2
     C*                  PARM                    SIDT
     C*                  PARM                    FIFIRM
     C*                  PARM      SIKNK         UKN               8 0
     C*    XXKDSÆ        IFEQ      *BLANKS
     C*                  MOVE      *BLANKS       XXKDAÆ
     C*                  GOTO      SLSA
     C*                  ENDIF
     C     XXKDAÆ        IFNE      SDKDAÆ
     C     XXKDAÆ        ANDNE     *BLANKS
     C     XXAKTK        ANDNE     'V'
     C     SADSDK        SETLL     SADSD
     C                   MOVE      *BLANKS       XXKDAÆ
     C                   GOTO      STSA1
     C                   END
     C                   ENDIF
      * KOM HIT, HAR BRUKER FÅTT EN SPESIFSERT SÆRAVGIFT MED KODE,
      * SEKVENS OG SATS. KALLE "SÆRAV2" FOR Å BEREGNE GR.LAG OG BELØP
      * OG OPPDATERE SAD-FIL
     C                   EXSR      SÆRAV2
      * LES FORBI ALLE LINJER MED SAMME SÆRAVGIFTSKODE INNTIL NESTE
      * SÆRAVGIFT
     C                   IF        XXKDAÆ > SDKDAÆ
     C                   MOVE      XXKDAÆ        SDKDAÆ
     C     SADSDK        SETLL     SADSD
     C                   END
     C  N33XXKDAÆ        DOWEQ     SDKDAÆ
     C     STSA3         TAG
     C     SVVNT         READE     SADSD                                  33
     C     *IN33         DOWEQ     '0'
     C     XZKDAÆ        IFEQ      *BLANKS
     C     XZKDAÆ        ORNE      *BLANKS
     C     XZKDAÆ        ANDNE     SDKDAÆ
     C     SDDTF         IFLE      SIDT
     C     SDDTT         ANDGE     SIDT
     C                   LEAVE
     C                   END
     C                   END
     C     SVVNT         READE     SADSD                                  33
     C  N33              ENDDO
     C  N33SDAKTK        CABEQ     'I'           STSA3
     C* N33XSU           IFEQ      'N'
     C*    SDKDAÆ        CABEQ     'SU'          STSA3
     C*                  END
     C  N33KODTS8K1      CHAIN     KODTS8                             34
     C  N33
     CANN34KS8MIL        IFEQ      'J'
     C     SIKNK         ANDNE     0
     C     CUNDMAFK2     CHAIN     CUNDMAF                            33
     C     *IN33         CABEQ     '1'           STSA3
     C                   END
     C  N33              ENDDO
     C                   MOVE      *BLANKS       XXKDAÆ
     C   33              GOTO      SLSA
     C                   MOVE      *BLANKS       XXKDSÆ
     C                   MOVE      *BLANKS       XXAKTK
     C                   MOVE      *ZEROS        SVBLGÆ
     C                   MOVE      *ZEROS        SVBLÆ
     C                   GOTO      STSA2
     C                   ENDIF
      *
      * BEVARE INNLESTE SÆRAVGIFTSKODE/SEKVENS/SATS
     C                   MOVE      SDKDAÆ        XXKDAÆ
     C                   MOVE      SDKDSÆ        XXKDSÆ
     C                   MOVE      SDBLSÆ        XXBLSÆ
     C                   MOVE      SDAKTK        XXAKTK
     C                   GOTO      STSA1
     C                   ENDIF
      *
     C     SLSA          TAG
      * HVIS XXKDAÆ<>BLANK --> SISTE LINJE MED SÆRAVGIFT ER LEST.
     C     XXKDAÆ        IFNE      *BLANKS
     C     XXAKTK        IFEQ      'V'
     C                   CALL      'SAD061D'
     C     SVVNT         PARM      SVVNT         UVNTS             8 0
     C                   PARM                    XXKDAÆ
     C                   PARM                    XXKDSÆ
     C                   PARM                    XXBLSÆ            7 2
     C                   PARM                    SIDT
     C                   PARM                    FIFIRM
     C                   PARM      SIKNK         UKN               8 0
     C                   ENDIF
     C     XXKDSÆ        IFNE      *BLANKS
     C                   EXSR      SÆRAV2
     C                   ENDIF
     C                   ENDIF
     C     SLSAV         TAG
     C                   MOVE      '0'           *IN38
      *
     C                   ENDSR
      *
      ******************************************
     C     SÆRAV2        BEGSR
      ******************************************
     C                   MOVE      XXKDAÆ        W2KDAÆ
     C                   MOVE      XXKDSÆ        W2KDSÆ
     C                   MOVE      XXBLSÆ        W2BLSÆ
     C     KODTS8K       CHAIN     KODTS8                             33
     C   33KODTS8K2      CHAIN     KODTS8                             33
     C  N33              IF        KS8AVG <> 'FK'
     C  N33              SELECT
     C     KS8STY        WHENEQ    '%'
     C                   Z-ADD     XPROGR        W2BLGÆ
     C     KS8STY        WHENEQ    'P'
     C     KS8STY        OREQ      'H'
     C     KS8STY        OREQ      'K'
     C                   Z-ADD     XVEKGR        W2BLGÆ
     C     KS8STY        WHENEQ    'G'
     C     XVEKGR        MULT      1000          W2BLGÆ
     C     KS8STY        WHENEQ    'D'
     C                   EVAL(H)   W2BLGÆ = XSTKGR / 12 + 0.5
     C     KS8STY        WHENEQ    'T'
     C                   EVAL(H)   W2BLGÆ = XVEKGR / 1000 + 0.5
     C                   OTHER
     C     KS8STY        IFNE      'M'
     C     KS8STY        ANDNE     'A'
     C     KS8STY        ANDNE     'B'
     C                   Z-ADD     XSTKGR        W2BLGÆ
     C                   END
     C                   ENDSL
     C                   END
     C     W2BLSÆ        IFEQ      0
     C                   Z-ADD     KS8SAT        W2BLSÆ
     C                   END
     C                   MOVE      KS8STY        XEH2Æ             1
     C                   MOVE      KS8ØRE        XS8ØRE            1
     C     W2BLSÆ        IFEQ      99999,99
     C                   MOVE      *ZEROS        W2BLÆ
     C                   ELSE
     C     XEH2Æ         COMP      ' '                                    33
     C  N33XEH2Æ         COMP      'K'                                    33
     C  N33XEH2Æ         COMP      'G'                                    33
     C  N33XEH2Æ         COMP      'M'                                    33
     C  N33XEH2Æ         COMP      'D'                                    33
     C  N33XEH2Æ         COMP      'T'                                    33
     C  N33XEH2Æ         COMP      'L'                                    33
     C  N33XEH2Æ         COMP      'A'                                    33
     C  N33XEH2Æ         COMP      'B'                                    33
     C   33              EVAL      W2BLÆ = W2BLGÆ * W2BLSÆ
     C     XEH2Æ         COMP      '%'                                    33
     C  N33XEH2Æ         COMP      'H'                                    33
     C   33              EVAL      W2BLÆ = W2BLGÆ * W2BLSÆ / 100
     C     XEH2Æ         COMP      'P'                                    33
     C   33              EVAL      W2BLÆ = W2BLGÆ * W2BLSÆ / 1000
     C     XS8ØRE        COMP      '*'                                    33
     C   33              DIV(H)    100           W2BLÆ
     C                   END
      *
     C     XXHOVL        IFEQ      'J'
      * HVIS HOVEDLINJE IKKE HAR SÆRAVGIFT, OPPDATERE FØRSTE AVGIFT PÅ
      * HOVEDLINJEN.
     C     SADVK         CHAIN     SADV                               33
     C                   MOVE      W2KDAÆ        SVKDAÆ
     C                   MOVE      W2KDSÆ        SVKDSÆ
     C                   MOVE      W2BLSÆ        SVBLSÆ
     C                   MOVE      W2BLGÆ        SVBLGÆ
     C                   MOVE      W2BLÆ         SVBLÆ
     C                   UPDATE    SADVR
     C                   MOVE      'N'           XXHOVL
     C                   ELSE
      * HVIS IKKE, LAGE NY LINJE PÅ FIL OG SKJERMEN
     C                   ADD       1             XSVLI
     C                   MOVE      XSVLI         SVLI
     C                   EVAL      SVBELT = 0
     C                   EVAL      SVVKTB = 0
     C                   EVAL      SVVKTN = 0
     C                   EVAL      SVNTM  = 0
     C                   EVAL      SVNT   = 0
     C                   EVAL      SVEH   = *BLANKS
     C                   EVAL      SVFT   = *BLANKS
     C                   EVAL      SVVT   = *BLANKS
     C                   EVAL      SVCREF = *BLANKS
     C                   EVAL      SVTOA  = *BLANKS
     C                   IF        XN01 > XN11
     C                   ADD       1             XN11
     C                   EVAL      SVCREF = RF(XN11)
     C                   EVAL      SVTOA  = TO(XN11)
     C                   END
     C                   IF        XN02 > XN12
     C                   ADD       1             XN12
     C                   EVAL      SVFT   = FT(XN11)
     C                   END
     C                   MOVE      W2KDAÆ        SVKDAÆ
     C                   MOVE      W2KDSÆ        SVKDSÆ
     C                   MOVE      W2BLSÆ        SVBLSÆ
     C                   MOVE      W2BLGÆ        SVBLGÆ
     C                   MOVE      W2BLÆ         SVBLÆ
     C                   WRITE     SADVR
     C                   END
     C                   MOVE      '0'           *IN33
      *
     C                   ENDSR
      *
      ***********************************************
     C     SNDTVIN       BEGSR
      ***********************************************
     C                   EXSR      FINMTY
     C     SADHK         CHAIN     SADH                               33
     C                   MOVE      'Q'           SIST
     C                   EVAL      SIWS = 'TVINR'
     C                   MOVE      *ZEROS        SIMP
     C*                  MOVE      *ZEROS        X9DTØ
     C                   MOVE      *ZEROS        SIDTØ
     C                   MOVE      *ZEROS        SIBELD
     C                   MOVE      'J'           SIPKL
     C                   MOVE      W1N07         SIMF
     C                   MOVE      W9N01         SIMP
     C                   MOVE      'J'           SIPKL
     C                   UPDATE    SADHR
     C                   EXSR      KOMLIN
      *
     C                   ENDSR
      *
      ***********************************************
     C     FINMTY        BEGSR
      ***********************************************
     C                   MOVE      'N'           XBMI              1
     C                   MOVE      'N'           XINST             1
      *
      *** FINNER SANSYNLIG MELDINGSTYPE UTFRA LOGGELEMENT OG
      ***   FUNKSJONTASTER
     C                   Z-ADD     3             W9N01             1 0
      *
     C     M2KDCK        SETLL     EDIM2                              33
     C     STFMTY        TAG
     C     M2KD2K        READPE    EDIM2                                  33
     C  N33M1001         IFEQ      '830'                                        1<-B
     C     MST           OREQ      'D'
     C     MSR           OREQ      'S'
     C     M1N07         OREQ      'DFI'
     C     M1N07         OREQ      'DII'
     C     M1N07         OREQ      'DPU'
     C     M1N07         OREQ      'DKO'
     C     M0068C        OREQ      0
     C     M0068C        CABEQ     0             STFMTY
     C     MSR           IFEQ      'S'
     C     XINST         ANDEQ     'N'
     C     M1N07         IFEQ      'DMA'
     C     M1N07         OREQ      'DEN'
      * DENNE TOLLDEK. KAN VÆRE INNSTIKK HVIS MELDING FØR DENNE
      * ER EN 'DUA' FRA TOLLVESENET.
     C                   MOVE      'J'           XINST             1
     C                   END
     C                   END
     C                   GOTO      STFMTY
     C                   ELSE                                                   1
     C     M1N07         IFEQ      'DME'                                         2<-B
     C     SIMI          IFEQ      'I'                                            3<-B
     C                   GOTO      STFMTY
     C                   ELSE                                                     3
     C                   MOVE      'DKO'         W1N07             3
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     M0065         IFEQ      'NCUMUA'                                       3<-B
     C     M1N07         OREQ      'DUA'
      * INNSTIKK
     C*    *IN28         IFEQ      '1'                                             4<-B
     C*    XINST         OREQ      'J'
     C*                  MOVE      'J'           XBMI
     C*    SIDP          IFEQ      40                                               5<-B
     C*    SIDP          OREQ      41
     C*                  MOVE      'DEN'         W1N07
     C*                  ELSE                                                       5
     C*                  MOVE      'DMA'         W1N07
     C*                  END                                                        5<-E
     C*                  ELSE                                                      4
     C                   MOVE      'DKO'         W1N07
     C*                  END                                                       4<-E
     C                   ELSE                                                     3
     C     M1N07         IFEQ      'DIU'                                           4<-B
     C                   MOVE      '1'           *IN33
     C                   MOVE      '1'           *IN99
     C                   ELSE                                                      4
     C     M1N07         IFEQ      'DTK'                                            5<-B
     C                   MOVE      'DOM'         W1N07
     C                   ELSE                                                       5
     C                   MOVE      '1'           *IN33
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C   33SIDP          IFNE      40
     C     SIDP          ANDNE     41
     C     SIDP          ANDNE     49
     C                   MOVE      'DMA'         W1N07
     C                   ELSE
     C                   MOVE      'DFU'         W1N07
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     KOMLIN        BEGSR
      ***********************************************
      *
      * HENT SISTE DATO/SEKVENSNR./VERSJONSNR.
      *   1. HVIS DET FINNES OG IKKE ER 'IU', ØKER VERSJONSNR. MED 1
      *   2. HVIS DET IKKE PKT.1, HENTER NY DATO/SEKV.NR./VERSJONSNR.
     C     MAKDCK        SETLL     EDIM4                              31
      * FOR Å FÅ UNIK NUMMERERING PÅ ALLE TVINNSAKER SKAL VERSJ.NR ØKER
      * ALLTID (OGSÅ VED FEIL I INP.KTR.!!! - NÅR NY SAK I TVINN (ELLER
      * BARE DFI HITTIL SKAL NY DATO/SEKV.NR./V.NR. ALLTID TILDELES))
     C                   MOVE      *ZEROS        Æ0068C            2 0
     C     STKL          TAG
     C     MAKD2K        READPE    EDIM4                                  31
     C  N31M0065         IFNE      'CUSDEC'                                     1<-B
     C     M0065         ANDNE     'CUSRES'
     C                   GOTO      STKL
     C                   END                                                    1<-E
     C  N31MST           IFEQ      'D'                                          1<-B
     C     M1001         OREQ      '830'
     C     M0068C        OREQ      0
     C                   GOTO      STKL
     C                   END                                                    1<-E
     C  N31Æ0068C        IFEQ      0                                            1<-B
     C                   MOVE      M0068C        Æ0068C
     C                   END                                                    1<-E
     C  N31M1N07         IFEQ      'DFI'                                        1<-B
     C     M1N07         OREQ      'DII'
     C     M1N07         OREQ      'DPU'
     C                   GOTO      STKL
     C                   END                                                    1<-E
     C  N31M1N07         IFEQ      'DIU'                                        1<-B
     C                   MOVE      '1'           *IN31
     C                   ELSE                                                   1
     C     Æ0068C        ADD       1             M0068C
     C                   END                                                    1<-E
      *
      *** HENT NY DATO/SEKVENS/VERSJON
     C   31              DO
     C                   MOVEL     WDT           M0068A
      *** HENT SEKVENSNR.
     C     TVINDK        CHAIN     TVIND                              32
     C   32              Z-ADD     M0068A        D0068A
     C   32              Z-ADD     0             D0068B
     C                   ADD       1             D0068B
     C   32              WRITE     TVINDF
     C  N32              UPDATE    TVINDF
     C                   MOVE      D0068B        M0068B
      *** VERSJONSNR. SETTES LIK 1.
     C                   Z-ADD     1             M0068C
     C                   END
      *
      *** HENTE MELDINGSNR
     C     1             CHAIN     EDIC                               32
     C                   ADD       1             CMN
     C                   UPDATE    EDICR
      *
     C                   EXSR      MOVKD1
     C     TVIM1K        SETLL     EDIM1                              32
     C     STKL3         TAG
     C     TVIM1K        READE     EDIM1                                  32
     C  N32M0065         IFEQ      'CUSDEC'
     C     M1001         ANDEQ     '929'
     C                   DELETE    EDIMR
     C                   ELSE
     C                   UPDATE    EDIMR
     C                   GOTO      STKL3
     C                   END
     C                   EXSR      MOVKD2
      *
     C                   WRITE     EDIMR
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVKD1        BEGSR
      ***********************************************
     C                   MOVE      M0068A        X0068A
     C                   MOVE      M0068B        X0068B
     C                   MOVE      M0068C        X0068C
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVKD2        BEGSR
      ***********************************************
     C                   EVAL      M0004 = 'NO005405'
     C                   EVAL      M0010 = 'NO000101'
     C*                  MOVE      W0035         M0035
     C                   EVAL      M0062 = X14S
     C                   MOVE      'CUSDEC'      M0065
     C                   MOVE      X0068A        M0068A
     C                   MOVE      X0068B        M0068B
     C                   MOVE      X0068C        M0068C
     C                   MOVE      *BLANKS       M0068
     C                   MOVE      XSYFORE       X0068Æ
     C                   MOVEL     XN068Å        M0068
     C                   MOVE      *ZEROS        M0068D
     C                   MOVE      *ZEROS        M0068E
     C                   MOVE      *ZEROS        M0068F
     C                   MOVE      '929'         M1001
     C                   MOVE      *BLANKS       M1004
     C                   SELECT
     C     W1N07         WHENEQ    'DFU'
     C                   MOVEL     '9  '         M1225
     C     W1N07         WHENEQ    'DMA'
     C                   MOVEL     'ZZ '         M1225
     C     W1N07         WHENEQ    'DFO'
     C                   MOVEL     '14 '         M1225
     C     W1N07         WHENEQ    'DEN'
     C                   MOVEL     '2  '         M1225
     C     W1N07         WHENEQ    'DKO'
     C                   MOVEL     '4  '         M1225
     C     W1N07         WHENEQ    'DOM'
     C                   MOVEL     '18 '         M1225
     C                   ENDSL
     C*                  MOVE      SIDTØ         M2005B
     C*                  MOVE      X3039D        M3039D
     C*                  MOVE      W3039E        M3039E
N03  C                   MOVE      *ZEROS        M2005B
N03  C                   Z-ADD     959231591     M3039D
N03  C                   Z-ADD     17531         M3039E
     C                   MOVE      *ZEROS        M5004D
     C                   MOVE      W1N07         M1N07
     C                   MOVE      *BLANKS       M1N08
      *
      *** SJEKK AT BEHANDLINGSPRIORITET ER INNENFOR INTERVALLET
     C     W9N01         IFLT      1
     C                   Z-ADD     1             M9N01
     C                   ELSE
     C     W9N01         IFGT      4
     C                   Z-ADD     4             M9N01
     C                   ELSE
     C                   MOVE      W9N01         M9N01
     C                   END
     C                   END
      *
     C                   MOVE      *ZEROS        MSN
     C                   Z-ADD     CMN           MMN
     C                   MOVE      'S'           MSR
     C                   MOVE      *BLANKS       MST
     C                   MOVE      *ZEROS        MDT
     C                   MOVE      *ZEROS        MTM
     C                   MOVE      SIAVD         MAVD
     C                   MOVE      SITDN         MTDN
     C                   MOVE      SIFRBN        MFFBNR
     C*                  MOVE      WVEN          MVEN
      *
     C                   ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     SADHK         KLIST
     C                   KFLD                    FSAVD
     C                   KFLD                    FSOPD
     C     SADVK         KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C                   KFLD                    SVLI
     C     FRISOL01K     KLIST
     C                   KFLD                    FSKODE
     C                   KFLD                    FSSOK
     C                   EVAL       FSKODE = '*CR'
     C     KODTAK        KLIST
     C                   KFLD                    KOAUNI
     C                   KFLD                    SIAVD
     C                   MOVE      'A'           KOAUNI
     C     CUNDL01K      KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KOAKNR
     C     M2KDCK        KLIST
     C                   KFLD                    FSAVD
     C                   KFLD                    FSOPD
     C                   KFLD                    MAX0B
     C                   KFLD                    MAX0C
     C                   KFLD                    MAX0D
     C     M2KD2K        KLIST
     C                   KFLD                    FSAVD
     C                   KFLD                    FSOPD
     C     MAKDCK        KLIST
     C                   KFLD                    XSR1
     C                   KFLD                    FSAVD
     C                   KFLD                    FSOPD
     C                   KFLD                    MAX0B
     C                   KFLD                    MAX0C
     C                   KFLD                    MAX0D
     C     MAKD2K        KLIST
     C                   KFLD                    XSR1
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C     TVIM1K        KLIST
     C                   KFLD                    X1STA
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C     TVINDK        KLIST
     C                   KFLD                    M0068A
     C     KODTS2K       KLIST
     C                   KFLD                    KS2UNI
     C                   KFLD                    SVLK
     C     TARIK         KLIST
     C                   KFLD                    SVVNT
     C                   KFLD                    TATAR
     C     TARIKM        KLIST
     C                   KFLD                    SVVNT
     C                   KFLD                    TATAR
     C                   KFLD                    XADATO
     C                   MOVE      99999999      XADATO            8 0
N01  C     TARIPVAK      KLIST
N01  C                   KFLD                    TATANR
N01  C                   KFLD                    TADATO
     C     SADSDK        KLIST
     C                   KFLD                    SVVNT
     C                   KFLD                    XXKDAÆ
     C     CUNDMAFK      KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    SIKNK
     C                   KFLD                    SDKDAÆ
     C     CUNDMAFK2     KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    SIKNK
     C                   KFLD                    W2KDAÆ
      *
     C     CUSHDRK       KLIST
     C                   KFLD                    CMPY
     C                   KFLD                    WHSE
     C                   KFLD                    SHPN
     C                   KFLD                    DOCN
     C     SHPADRHK1     KLIST
     C                   KFLD                    CMPY
     C                   KFLD                    WHSE
     C                   KFLD                    SHPN
     C                   KFLD                    ADRCODEAVS
     C     *LIKE         DEFINE    ADRCODE       ADRCODEAVS
     C                   EVAL      ADRCODEAVS = 'CONSIGNOR'
     C     SHPADRHK2     KLIST
     C                   KFLD                    CMPY
     C                   KFLD                    WHSE
     C                   KFLD                    SHPN
     C                   KFLD                    ADRCODEMOT
     C     *LIKE         DEFINE    ADRCODE       ADRCODEMOT
     C                   EVAL      ADRCODEMOT = 'CONSIGNEE'
     C     SHPADRHK3     KLIST
     C                   KFLD                    CMPY
     C                   KFLD                    WHSE
     C                   KFLD                    SHPN
     C                   KFLD                    ADRCODEDEK
     C     *LIKE         DEFINE    ADRCODE       ADRCODEDEK
     C                   EVAL      ADRCODEDEK = 'DECLARANT'
     C     CUSDETK       KLIST
     C                   KFLD                    CMPY
     C                   KFLD                    WHSE
     C                   KFLD                    SHPN
     C                   KFLD                    DOCN
     C     LINJEK        KLIST
     C                   KFLD                    CMPY
     C                   KFLD                    WHSE
     C                   KFLD                    SHPN
     C                   KFLD                    DOCN
     C                   KFLD                    DOCR
     C     DOCAMOUHK     KLIST
     C                   KFLD                    CMPY
     C                   KFLD                    WHSE
     C                   KFLD                    SHPN
     C                   KFLD                    DOCN
     C     DOCAMOUDK     KLIST
     C                   KFLD                    CMPY
     C                   KFLD                    WHSE
     C                   KFLD                    SHPN
     C                   KFLD                    DOCN
     C                   KFLD                    DOCR
     C     KODTSIK       KLIST
     C                   KFLD                    KSIUNI
     C                   KFLD                    SISG
     C     KODTS8K       KLIST
     C                   KFLD                    W2KDAÆ
     C                   KFLD                    W2KDSÆ
     C     KODTS8K1      KLIST
     C                   KFLD                    SDKDAÆ
     C                   KFLD                    SDKDSÆ
     C     KODTS8K2      KLIST
     C                   KFLD                    W2KDAÆ
     C                   KFLD                    YKDSÆ             3
      *
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           WDT80             8 0
     C                   MOVEL     WTM           TTTIME
      *
     C     *LIKE         DEFINE    SVLI          XSVLI
     C     *LIKE         DEFINE    MSR           XSR1
     C     *LIKE         DEFINE    MSR           XSR2
     C     *LIKE         DEFINE    MST           X1STA
     C     *LIKE         DEFINE    SVBLÆ         W2BLÆ
     C     *LIKE         DEFINE    SVBLGÆ        W2BLGÆ
     C     *LIKE         DEFINE    SVBLSÆ        W2BLSÆ
     C     *LIKE         DEFINE    SVKDAÆ        W2KDAÆ
     C     *LIKE         DEFINE    SVKDSÆ        W2KDSÆ
     C*                  MOVE      'S'           XSR               1
     C*                  MOVE      'R'           XSR1              1
     C*                  MOVE      *ZEROS        MIN0B             8 0
     C*                  MOVE      *ZEROS        MIN0C             6 0
     C*                  MOVE      *ZEROS        MIN0D             2 0
     C                   MOVE      '99999999'    MAX0B             8 0
     C                   MOVE      '999999'      MAX0C             6 0
     C                   MOVE      '99'          MAX0D             2 0
     C                   MOVE      *ZEROS        M0068A
     C                   MOVE      'S2 '         KS2UNI
     C                   MOVE      'SI'          KSIUNI
     C                   MOVE      'R'           XSR1
     C                   MOVE      'S'           XSR2
     C                   MOVE      ' '           X1STA
      *
     C                   MOVE      *ZEROS        SIRAB
     C                   MOVE      *ZEROS        SIBELC
      *
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
      *
     C                   ENDSR
      *
      ***********************************************
     C     TTSR          BEGSR
      ***********************************************
     C                   MOVE      SIAVD         TTAVD
     C                   MOVE      SITDN         TTOPD
     C                   MOVE      'STS'         TTACTI
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
     C                   MOVE      UUSR          TTUSER
     C                   EVAL      TTTEXT = 'SAD document entered'
n02  C                   EVAL      TTTEXL = 'SAD dokument opprettet'
     C                   WRITE     TRACKFR
      *
     C                   ENDSR
      *
      ***********************************************
     C     TTSR2         BEGSR
      ***********************************************
     C                   MOVE      SIAVD         TTAVD
     C                   MOVE      SITDN         TTOPD
     C                   MOVE      'STS'         TTACTI
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
     C                   MOVE      UUSR          TTUSER
     C                   EVAL      TTTEXT = 'SAD document changed'
N02  C                   EVAL      TTTEXL = 'SAD dokument endret'
     C                   WRITE     TRACKFR
      *
     C                   ENDSR
      *
