/* FACSIMILESUPPORT */
             PGM        PARM(&BPARM)
             DCL        VAR(&EPOST) TYPE(*CHAR) LEN(70)
             DCL        VAR(&BPARM) TYPE(*CHAR) LEN(260)
             DCL        VAR(&UNIK) TYPE(*CHAR) LEN(7) /* Unikkode */
             DCL        VAR(&PTIME) TYPE(*CHAR) LEN(8)
             DCL        VAR(&PDATE) TYPE(*CHAR) LEN(8)
             DCL        VAR(&DOKNA) TYPE(*CHAR) LEN(8)
             DCL        VAR(&DOKNA2) TYPE(*CHAR) LEN(12)
             DCL        VAR(&QUSER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&MAPPE) TYPE(*CHAR) LEN(20) +
                          VALUE('FAXSAVE')
             DCL        VAR(&NAVN) TYPE(*CHAR) LEN(50)
             DCL        VAR(&KNAVN) TYPE(*CHAR) LEN(30)
             DCL        VAR(&QJOB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&WRKSTN) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QNBR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&FAX) TYPE(*CHAR) LEN(21)
             DCL        VAR(&STD) TYPE(*CHAR) LEN(12)
             DCL        VAR(&STM) TYPE(*CHAR) LEN(20)
             DCL        VAR(&GEN) TYPE(*CHAR) LEN(1)
             DCL        VAR(&AVD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&OPD) TYPE(*CHAR) LEN(7)
             DCL        VAR(&TUR) TYPE(*CHAR) LEN(8)
             DCL        VAR(&KODE) TYPE(*CHAR) LEN(1)
             DCLF       FILE(FAXSEN) RCDFMT(*ALL)
             RCVF       DEV(*FILE) RCDFMT(*FILE)
             CHGVAR     VAR(&DOKNA) VALUE(%SST(&BPARM 1 8))
             CHGVAR     VAR(&FAX) VALUE(%SST(&BPARM 9 21))
             CHGVAR     VAR(&NAVN) VALUE(%SST(&BPARM 30 50))
             CHGVAR     VAR(&PTIME) VALUE(%SST(&BPARM 80 8))
             CHGVAR     VAR(&PDATE) VALUE(%SST(&BPARM 88 8))
             CHGVAR     VAR(&STD) VALUE(%SST(&BPARM  96 12))
             CHGVAR     VAR(&STM) VALUE(%SST(&BPARM 108 20))
             CHGVAR     VAR(&GEN) VALUE(%SST(&BPARM 128 1))
             CHGVAR     VAR(&WRKSTN) VALUE(%SST(&BPARM 129 10))
             CHGVAR     VAR(&KNAVN) VALUE(%SST(&BPARM 139 30))
             CHGVAR     VAR(&AVD) VALUE(%SST(&BPARM 169 4))
             CHGVAR     VAR(&OPD) VALUE(%SST(&BPARM 175 5))
             CHGVAR     VAR(&TUR) VALUE(%SST(&BPARM 180 8))
             CHGVAR     VAR(&EPOST) VALUE(%SST(&BPARM 188 70))
             CHGVAR     VAR(&KODE) VALUE(%SST(&BPARM 260 1))
             RTVJOBA    JOB(&QJOB) USER(&QUSER) NBR(&QNBR)
             CHGVAR     VAR(&UNIK) VALUE('W' *CAT &QNBR)
             CHGVAR     VAR(&DOKNA2) VALUE(&DOKNA)
             OVRDBF     FILE(FHEADF) TOFILE(&DOKNA) +
                          MBR(&DOKNA)

             OVRPRTF    FILE(QSYSPRT) PAGESIZE(72 80) LPI(6) CPI(10) +
                          DRAWER(3) OUTQ(QFAX/QFAXOUTQ)
             IF         COND(&GEN = 'J') THEN(CPYDOC FROMDOC(&STD) +
                          FROMFLR(&STM) TODOC(&DOKNA) +
                          TOFLR(FAXTEMP) REPLACE(*NO))
             PRTDOC     DOC(&DOKNA) FLR(FAXTEMP) OPTIONS(*NO) +
                          OUTPUT(*PRINT) DEV(*USRPRF) +
                          OUTQ(QFAX/QFAXOUTQ) FORMTYPE(*STD) +
                          SAVOUTPUT(*YES) SAVDOC(&DOKNA) +
                          SAVFLR(&MAPPE) JOBQ(*NO)
             DLTDLO     DLO(&DOKNA) FLR(FAXTEMP)
             DLTF       FILE(&DOKNA)
             MONMSG     MSGID(CPF0000)
/* SJEKKER OM SENDING VIA MODEM */
             IF         COND(&FAXMOD = 'Y') THEN(DO)
             RMVM       FILE(DOKUMENT) MBR(&UNIK)
             MONMSG     MSGID(CPF7310 CPF5815 CPF7315)
             CPYSPLF    FILE(&DOKNA) TOFILE(DOKUMENT) +
                          JOB(&QNBR/&QUSER/&QJOB) TOMBR(&UNIK) +
                          MBROPT(*ADD) CTLCHAR(*PRTCTL)

             DLTSPLF    FILE(&DOKNA) JOB(&QNBR/&QUSER/&QJOB)
             MONMSG     MSGID(CPF0000)
             OVRPRTF    FILE(LISTE) DEV(*JOB) DEVTYPE(*AFPDS) +
                          PAGESIZE(72 80) FRONTMGN(0 .5) OVRFLW(72) +
                          OUTQ(QFAX/QFAXOUTQ)


             OVRDBF     FILE(DOKUMENT) TOFILE(DOKUMENT) MBR(&UNIK)
             CALL       PGM(FAXOV)
             RMVM       FILE(DOKUMENT) MBR(&UNIK)
             MONMSG     MSGID(CPF7310 CPF5815 CPF7315)
             CHGVAR     VAR(&DOKNA) VALUE('LISTE       ')
             ENDDO
             CALL       PGM(FAX017) PARM(&FAX)

             /* FAXSYS = F FACSIMILIE-SUPPORTY 400 */
             SNDFAX     TO((&FAX)) FILE(&DOKNA) +
                          JOB(&QNBR/&QUSER/&QJOB) SPLNBR(*LAST) +
                          CRTCVRP(*NO) FAXSNDDQ(SYSPEDF/FAXDTAQ) +
                          SNDTIME(&PTIME) SNDDATE(&PDATE)

             CALL       PGM(FAX013) PARM(&QUSER &QNBR &QJOB +
                          &FAX &DOKNA2 &MAPPE &PTIME &PDATE &NAVN +
                          &AVD &OPD &TUR &KODE)
             DLTOVR     FILE(FHEADF)
             ENDPGM
