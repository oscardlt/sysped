     H DFTACTGRP(*NO)
     FEDIM      UF   E           K DISK
     FEDIM6     IF   E           K DISK    RENAME(EDIMR:EDIMR6)
     FEDIS      UF   E           K DISK
     FEDISE     UF   E           K DISK
     FEDIRE     UF   E           K DISK
     FEDISE1K   UF   E           K DISK    RENAME(EDISER:EDISER1K)
     F                                     PREFIX(K_)
     FEDIRE1K   UF   E           K DISK    RENAME(EDIRER:EDIRER1K)
     F                                     PREFIX(K_)
     FEDISX     UF   E           K DISK
     FXMLRCVF   UF   E           K DISK
     FXMLRCAF   UF   E           K DISK
     FXMLRCLF   UF   E           K DISK
      *
     FFIRM      IF   E           K DISK

     d                 ds
     d  smbr                   1     10A
     d  smbr_1                 1      1A
     d  smbr_2                 2      8A
     d  smbr_3                 9     10A
     d  smbr_4                 4     10A

     d WhereC          s            512a
     d FirstW          s              1A
     d cQuote          C                   const('''')
     d SqlStm          s            512a
     d myrows0         s             10i 0
     d myrows          s             10i 0
     D XDTF            S              8  0
     D XDTP            S              8  0
     D XPOS            S              3  0
     d XAPS            C                   const(X'7D')
     D XMBR            S             10A
     D Error           S            150
     d X               S             10  0
     D ufil            S            256A
     D XSLUTT          S              1
     D XSLT            S              1
      *
      *  Prototype for 'SYREO01C3'
     d SYREO01C3       pr                  extpgm('SYREO01C3')
     d ufil_                               like(ufil)
      *  Prototype for syreo06r
     d syreo06r        pr
     d udtf_                               like(udtf)
     d udtp_                               like(udtp)
      *  *ENTRY Interface for Main Procedure
     d syreo06r        pi
     d udtf                           8
     d udtp                           8
      *
     d MyPoDS0         ds                  Qualified  dim(1)
     d  FIFIRM                        2A
     d MyPoDS          ds                  Qualified  dim(10000)
     d  SSN                           9S 0
     d  SMBR                         10A
     d  SIFS                        256A
     d  SSR                           1A
      /free

         exsr init;

         dow xslutt <> 'J';
           exsr srhoved;
         enddo;

       *inlr = *on;
       return;

       //=====================================================================
       // Hoved logikk
       //=====================================================================
       begsr srhoved;

       clear MyPoDS;
       SqlStm = 'Select SSN, SMBR, SIFS, SSR ' +
                'from EDIS ' +
                'Where SDT <= ' +
                %trim(udtf);
       Exec SQL PREPARE DynSel from :SqlStm;
       EXEC SQL DECLARE  A33  cursor for DynSel;
       Exec SQL OPEN A33;
       Myrows = %elem(MyPoDS);
       exec sql FETCH A33 for :MyRows rows
                  INTO :MyPoDs;
       Exec SQL CLOSE A33;

       if myrows > 0;
         for x = 1 to myrows;
           if mypods(x).ssr = *blanks;
             xslutt = 'J';
             leave;
           endif;

           ssn  = mypods(x).ssn;
           smbr = mypods(x).smbr;
           sifs = mypods(x).sifs;

           xslt = 'J';
           setll ssn edim6;
           reade ssn edim6;
           dow not %eof;
             if mavd <> 0 and mtdn <> 0;
             // Slettes ikke når edi er knyttet til oppdrag.
               xslt = 'N';
               leave;
             endif;
             reade ssn edim6;
           enddo;

           if xslt = 'J';
             chain smbr edisx;
             if %found;
               if sxifsobj <> *blanks and %subst(sxifsobj:1:1) <> '/';
                 sxifsobj = '/' + %trim(sxifsobj);
               endif;
               syreo01c3 (sxifsobj);
               delete edisxr;
             else;
               if smbr_3 = ' ';
                 xmbr = smbr_1 + '00' + smbr_2;
               else;
                 xmbr = smbr_1 + smbr_4 + '  ';
               endif;
               chain xmbr edisx;
               if %found;
                 if sxifsobj <> *blanks and %subst(sxifsobj:1:1) <> '/';
                   sxifsobj = '/' + %trim(sxifsobj);
                 endif;
                 syreo01c3 (sxifsobj);
                 delete edisxr;
               endif;
             endif;

             exec sql
             delete from edim
             where msn = :ssn
             with NC;
             exec sql
             delete from edire
             where rembr = :smbr
             with NC;
             exec sql
             delete from edise
             where sembr = :smbr
             with NC;
             exec sql
             delete from edire1k
             where rembr = :smbr
             with NC;
             exec sql
             delete from edise1k
             where sembr = :smbr
             with NC;

             exec sql
             delete from XMLRCVF
             where xrsn = :ssn
             with NC;
             exec sql
             delete from XMLRCAF
             where xrsn = :ssn
             with NC;
             exec sql
             delete from XMLRCLF
             where xrsn = :ssn
             with NC;

             if sifs <> *blanks;
               if %subst(sifs:1:1) <> '/';
                 sifs = '/' + %trim(sifs);
               endif;
               ufil = sifs;
               syreo01c3 (ufil);
             endif;

           // slett hovedpost
             exec sql
             delete from EDIS
             where ssn = :ssn
             with NC;

           endif;

         endfor;
       endif;

       endsr;

       //***********************************************
       begsr init;
       //***********************************************
       xdtf = %float(udtf);
       xdtp = %float(udtp);

       SqlStm = 'Select * ' +
                'from FIRM ' +
                'FOR READ ONLY ';
       Exec SQL PREPARE DynSel0 from :SqlStm;
       EXEC SQL DECLARE  A30  cursor for DynSel0;
       Exec SQL OPEN A30;
       Myrows0 = %elem(MyPoDS0);
       exec sql FETCH A30   for :MyRows0 rows
                  INTO :MyPoDs0;
       Exec SQL CLOSE A30;
       FIFIRM = mypods0(1).fifirm;

       endsr;

      /end-free
