     FTRACKL06  UF   E           K DISK
     FTRACKL02  IF   E           K DISK    PREFIX(W_)
     F                                     RENAME(TRACKFR:TRACKFR2)
     FTRACKF    O  A E             DISK    PREFIX(X_)
     F                                     RENAME(TRACKFR:TRACKFRX)
     FECMSG     IF   E           K DISK
     FHEADF     IF   E           K DISK
     D                 DS
     D  TTTIME                 1      6S 0
     D  UTIM                   1      4
     D                 DS
     D  TTDATE                 1      8S 0
     D  UDAT                   1      8
     D                 DS
     D  TTTEXT                 1     70
     D  TEXT21_23             21     23
     C                   EXSR      INIT
      * Les kun poster av type= 'S'
     C     'S'           SETLL     TRACKL06
     C     'S'           READE     TRACKL06                               51
     C     *IN51         DOWEQ     '0'
      * Les kun poster med kode TEU eller POD
     C     TTACTI        IFEQ      'POD'
     C     TTACTI        OREQ      'TEI'
     C     TTACTI        OREQ      'TEU'
     C     TTACTI        OREQ      'NEI'                                        AVVIST AV SJÅFØR..
     C     HEADK         CHAIN     HEADF
      * Finnes part som kan ta emot status ?
     C     WCMSGK        CHAIN     ECMSG                              52
     C   52HEKNA         COMP      11116                              5252
     C                   EVAL      TTMANU='X'
     C                   IF        *IN52=*OFF
     C                   IF        HEKNA=11116
      * NEI = oppdrag avvisk fra sjåførs PDA - kun visse koder sendes status på...
     C     TTACTI        IFEQ      'NEI'
     C                   exsr      TstExcuse
     c     TEXT          cabeq     *blanks       NoExcuse
     C                   END
      * Kall på program for å lage statusmelding INDY
     C                   SELECT
     C     TTACTI        WHENEQ    'POD'
     C                   CALL      'INDY11R'
     C                   PARM                    TTACTI
     C                   PARM                    HETRCN
     C                   PARM                    TTDATE
     C                   PARM                    TTTIME
     C                   PARM                    TTNAME
     C     TTACTI        WHENEQ    'TEI'
     C                   CALL      'INDY12R'
     C                   PARM                    TTACTI
     C                   PARM                    HETRCN
     C                   PARM                    TTDATE
     C                   PARM                    TTTIME
     C                   PARM                    TTNAME
     C                   PARM                    HEGM2
     C     TTACTI        WHENEQ    'TEU'
     C                   CALL      'INDY13R'
     C                   PARM                    TTACTI
     C                   PARM                    HETRCN
     C                   PARM                    TTDATE
     C                   PARM                    TTTIME
     C                   PARM                    TTNAME
     C                   PARM                    HEGM2
     C     TTACTI        WHENEQ    'NEI'
     C                   CALL      'INDY14R'
     C                   PARM                    TTACTI
     C                   PARM                    HETRCN
     C                   PARM                    TTDATE
     C                   PARM                    TTTIME
     C                   PARM                    TTNAME
     C                   PARM                    TEXT
     C                   ENDSL
     C                   EVAL      TTMANU='F'
     C                   ENDIF
     C                   ENDIF
      *
     C     NoExcuse      tag
      * Oppdater status på TRACKF
     C                   UPDATE    TRACKFR
     C                   ENDIF

     C     'S'           READE     TRACKL06                               51
     C                   ENDDO

     C                   EVAL      *INLR=*ON
      *____________________________________________________________
      *                                                   TstExcuse*
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     TstExcuse     BEGSR
      * Typisk tekst ved avvisning (21-23 er avtalte koder)
      *  0 ...+... 1 ...+... 2 ...+... 2 ...+... 4 ...+
      *  "Rejected by driver: BAD Rmvd from 90200049"
     c                   move      *blanks       TEXT             70
     c                   select
     c     TEXT21_23     wheneq    'BAD'
     c                   eval      TEXT='Bad address'
     c     TEXT21_23     wheneq    'OOT'
     c                   eval      TEXT='Out of Time'
     c     TEXT21_23     wheneq    'UNL'
     c                   eval      TEXT='Unable to Locate'
     c     TEXT21_23     wheneq    'CLD'
     c                   eval      TEXT='Closed     '
     c     TEXT21_23     wheneq    'NAH'
     c                   eval      TEXT='Not at Home'
     c     TEXT21_23     wheneq    'WRG'
     c                   eval      TEXT='Wrong Routing'
     c                   endsl
     c                   endsr
      *____________________________________________________________
      *                                                      INIT *
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     INIT          BEGSR
     C     WCMSGK        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    TRKNFA
     C                   KFLD                    WCSR
     C                   KFLD                    WC0065
     C     HEADK         KLIST
     C                   KFLD                    TTAVD
     C                   KFLD                    TTOPD
     C     TRACKK2       KLIST
     C                   KFLD                    TTAVD
     C                   KFLD                    TTOPD
     C                   KFLD                    TTFBNR
     C                   KFLD                    UACTI             3
     C                   KFLD                    TTDATE
     C                   KFLD                    TTTIME
     C                   MOVEL     'S'           WCSR              1
     C                   MOVEL     'IFTSTA'      WC0065            6
     C                   MOVEL     '  '          FIFIRM            2
     C                   ENDSR
