********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01
      *
      ***********************************************************
      *** PROGRAM som flytter dokument til historikk arkiv
      ***********************************************************
      *
     FarkivL01  UF   E           K DISK
     Ffirm      IF   E           K DISK
     Farktxt    IF   E           K DISK
     Ffirmarc   IF   E           K DISK
     FARKEXT    IF   E           K DISK
     FARCHST01FMCF   E             WORKSTN
     D                 DS
     D  ardate                 1      8  0
     D  araar                  1      4  0
     C*
     C                   EXSR      INIT
     C*
     C     START         TAG
     c                   exfmt     BILDE01
     c   03              goto      slutt
     c  n10              goto      start
      *
      *
     c                   exsr      lestxt
      *
      * ARKIVERER PDF DOKUMENTER
      *
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     LESTXT        BEGSR
     C***********************************************
     C*
     c                   setoff                                       33
     c     *in(33)       doweq     '0'
     c                   read      arktxt                                 33
     c     *in(33)       ifeq      '0'
      * lage start av bane fra til
     c                   exsr      genbane
      * les detaljer
     c                   exsr      les
     c                   end
     c                   end
     c                   endsr
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     c     keyext        klist
     c                   kfld                    fifirm
     c                   kfld                    arcext
     c     keytyp        klist
     c                   kfld                    ARTYPE
     C*
     C     arklagk       KLIST
     C                   KFLD                    fifirm
     C                   KFLD                    arklag
     C*
     c                   read      firm                                   33
      *
     C                   ENDSR
     C***********************************************
     C     LES           BEGSR
     C***********************************************
     C*
     c                   setoff                                       34
     c     *LOVAL        setll     arkivl01
     c     *in(34)       doweq     '0'
     c                   read      arkivl01                               34
     c* N34ARAAR         comp      wstila                             34
     c     *in(34)       ifeq      '0'
     c     arlink        andne     *blanks
     c     arbhis        andeq     *blanks
      * legger på dokumentnavn
     c*                  exsr      genbaned
     c                   exsr      kopipdf
     c     ok            ifeq      'J'
     c                   eval      arbhis=ArbhisF
     c                   else
     c                   eval      arbhis='MISSING'
     c                   end
     c                   update    arkivr
     c                   endif
     c                   enddo
     c                   endsr
     C*
     C***********************************************
     C     genbane       BEGSR
     C***********************************************
      *
      *    ARBHISF BANE TIL HISTORIKK HENTES HER
     C     ARKLAG        IFNE      *blanks
     c     arklagk       chain     arkext                             35
     c                   else
     c     fifirm        chain     firmarc                            35
     c                   end
      * GENERER TILBANE/DOKUMENT
      *
     c                   MOVE      *BLANKS       WBANET0         120
     C     wbanet0       CAT       arbhisf:0     wbanet0
     C     wbanet0       CAT       '/':0         wbanet0
     c                   endsr
     C***********************************************
     C*    genbaned      BEGSR
     C***********************************************
     c*                  MOVE      *BLANKS       WBANET          120
     c*                  EVAL      wbanet=wbanet0
      *
      * GENERER TIABANE/DOKUMENT
      *
     C*    wbanet        CAT       arlink:0      wbanet
     C*    '.'           SCAN      wbanet                                 35
     C* N35wbanet        CAT       '.pdf':0      wbanet
     c*                  endsr
      *
      ****************************************************************
     C     KOPIPDF       BEGSR
      ****************************************************************
n06  C                   move      *blanks       nyobj            50
n06  C                   move      *blanks       ubanet          256
n06  c                   eval      ubanet=WBANET0
n06  C                   eval      nyobj=arlink
n06  C     '.'           SCAN      nyobj                                  44
n06  c  N44nyobj         CAT       '.pdf':0      nyobj
N06  c                   call      'SYGE98CL'
N06  C                   PARM                    ubanet
N06  C                   PARM                    nyobj
N06  c                   parm                    OK                1
     C                   ENDSR
