********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 Varsel differenmsiert ved kun I-linjer
10XXX * 01 SH  PTF10 SUBR VARSEL RETTET SÅ MYE AT MERKING UGIKK
10XXX * 02 jov PTF10 oppr-kode ved linje skap ti sr TGIHTTP
10XXX * 03 YBC PTF10 FEIL VED BEREGNING AV BRO/VEI AVGIFTER
10XXX * 04 JOV PTF10 V10-7 lang-feil Int-belastn (kjør V10V10RE114 ) OGSÅ SYFM21b/SYTR35 !!!!
10XXX * 05 SH  PTF10 endring omittabell fra AVFRH
10XXX * 06 JOV PTF10 ved ekstar I-linje på intern oppdrag - foreslå overordnet avd..
10XXX * 07 YBC PTF10 HENT PRIS FRA SHIP-SYS VED SIMULERING
10XXX * 08 YBC PTF10 HENT SONE VED Å LESE STED2D
10XXX * 09 SH  PTF10 regenerer valutatillegg ved F7
10XXX * 10 SH  PTF10 IKKE MIN MAX VED NAGATIVE RATER GML FRAKTBEREGNING
10XXX * 11 SH  PTF10 også muliggjøre gebyrtype 'FRA' på fly import 43 som 41
10033 * 12 SH  PTF10 krav til ekstra fritekster på kunder
10033 * 13 SH  PTF10 ny parameter SYGE03
10033 * 14 SH  PTF10 opsjon X  flytter linjer til Shissystemat.
10XXX * 15 YBC PTF10 SETT *IN71 OFF VED NY REGISTRERING
10XXX * 16 SH  PTF10 SETT EU_KONTERING
10XXX * 17 SH  PTF10 arbeid med budsjett beregning
10XXX * 18 SH  PTF10 endring  til valutaomregning ved I-linjer
10XXX * 19 SH  PTF10 rettelse budsjett
10XXX * 20 SH  PTF10 viser kunders avtalenummer
10252 * 21 JOV PTF10 F14-ved Kjøpers/selgers -fmot = vis fritekst/notis
10252 * 22 SH  PTF10 F17 VIS ARKIV
10252 * 23 SH  PTF10 auto budsjett
10252 * 24 SH  PTF10 MULIGGJØR % AV BRUTTO PÅ ALLE HVEM BETALER HVA
10252 * 25 SH  PTF10 lokal currancy til shipsssystem
10XXX * 26 SH  PTF10 også muliggjøre gebyrtype 'FRA' på fly eksport 44 som 41
10XXX * 27 SH  PTF10 sypo09 går via cl nå
10XXX * 28 SH  PTF10 fjerne recordlås på ordre
10328 * 29 jov PTF10 Automatisk Internkontering, avtalelinje m/MVAkod=I
10328 * 30 jov PTF10 staffelerer vareverdi
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
11xxx * 31 sh  PTF11 hente tollpostpris
11xxx * 32 JOV PTF11 Hinder evig loop
11xxx * 33 SH  PTF11 kunne kreditere frakttillegg uten automatisk beregning
11xxx * 34 SH  PTF11 frakttillegg på side 1 kan styrer mot spesifikk
11xxx * 34           FR1 FR2 eller FRA hvis det legges i gebyrtype
11xxx * 35 SH  PTF11 Oppdragsnummer rødt Invoiuce-info  kode I i fritekst
11xxx * 36 SH  PTF11 H IMP/EKS/INN ved TRdisponering
11xxx * 37 SH  PTF11 mindre rettelse til 35
11xxx * 38 SH  PTF11 tester om kunde er epostmottager/singelfaktura
11xxx * 39 SH  PTF11 KORR 38
11xxx * 40 SH  PTF11 produktkode = *PRO
11xxx * 41 SH  PTF11 fjernet PRJOIN + endring
11xxx * 42 SH  PTF11 *FRTI i stedsbegrep
11xxx * 43 SH  PTF11 *TIL  i trafikk for tilleggsgebyrer
11xxx * 44 SH  PTF11 kaller program for tilleggsgebyrer
11xxx * 45 SH  PTF11 SETTER XKDA
11xxx * 46 SH  PTF11 VED UTFYLLING ANTALL FYLL OGSÅ UT FRITEKST
11xxx * 47 SH  PTF11 trans.disp endrede linjer beregnes ikke på nytt av frattillegg
11xxx * 48 SH  PTF11 tilleggsgebyr alltid følge frakt
11xxx * 49 JOV PTF11 Gebyr av type 'FRA' med T(Y)+ angitt pris går IKKE i frakt-avtale..
11xxx * 50 SH  PTF11 REBEREGNER IKKE ENDREDE GEBYRER ALTSY RÅERE ENN  PTF 47
11xxx * 51 SH  PTF11 ikke reberegn hvis ferdigmeldt eller i samlefakturakø eller fakturert
11xxx * 52 SH  PTF11 parameter syge14a
11xxx * 53 SH  PTF11 åpner skjermfil 2 ganger
11xxx * 54 SH  PTF11 MINDRE JUSTERING INCLUDER GEBYRER
11xxx * 55 SH  PTF11 må ikke blanke hest  ved retur
11xxx * 56 SH  PTF11 nye felt i ferdf
11xxx * 57 SH  PTF11 Ved type G ikke bruk fraktrelatert
11132 * 58 YBC PTF11 3 DESIMALER PÅ KALKULATOR
11132 * 59 SH  PTF11 *avd i gebyravtaler
11132 * 60 SH  PTF11 generelt gebyr på alle fakturaer
11132 * 61 SH  PTF11 MINDRE KORR TIL PTF 60
11132 * 62 SH  PTF12 VALUTAKURSENDERING VED 3 VALUTAER
11132 * 63 SH  PTF12 RETTELSE EPOST J/N
12033 * 64 JOV PTF12 VISNING AV DUPER  / RETTING AV PTF35 = NÅ: RØD = FRITXT FINNES(12034)
12043 * 65 JOV PTF12 Parameter for varsel/valgvindu ved flere parter i ferdimelding
12043 * 66 SH  PTF12 gjenskape frakttillegg ved F7
12043 * 67 SH  PTF12 KRREKSJON frakttillegg kredit
********************************************************************
     H DEBUG(*YES)
      ***************************************************************
      *** PROGRAM SKAL VEDLIKEHOLDE FAKTURA                       ***
      ***************************************************************
      ***************************************************************
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER        ***
      *** LEDIGE INDIKATORER 02 09 13 15 17 19 21-23              ***
      *** LEDIGE INDIKATORER 54-60 64-70
      *** INDIKATOR 37-39 BRUKES FOR KALLE FRA SYFF10 (ENDRE FAKT)***
      ***           36 PÅ OG 39 AV = KALLE FRA SYIN10             ***
      ***           99 = 50 I S-36                                ***
      ***           41 PÅ = LAND-IMPORT                           ***
      ***           42 PÅ = LAND-EKSPORT                          ***
      ***           43 PÅ = FLY-IMPORT                            ***
      ***           44 PÅ = FLY-EKSPORT                           ***
      ***           45 PÅ = INNENLANDS-FLY                        ***
      ***           46 PÅ = TRANSPORTOPPDRAG                      ***
      ***           47 PÅ = TRANSPORTOPPDRAG/DUPLIKAT/FORFRAKT    ***
      ***           48 PÅ = TRANSPORTOPPDRAG/DUPLIKAT/VIDEREFRAKT ***
      ***           49 PÅ = SJØ-IMPORT                            ***
      ***           50 PÅ = SJØ-EKSPORT                           ***
      ***************************************************************
      *
N51  FSAML1     IF   E           K DISK
N47  FFAK15     IF   E           K DISK    PREFIX(F_)
     F                                     RENAME(FAKTR:FAKTR15)
N38  FCUNDC03   IF   E           K DISK
N38  FARKTXT    IF   E           K DISK
N35  FFREETXT3  IF   E           K DISK
N17  FTRAN      IF   E           K DISK
N16  FKODTG3    IF   E           K DISK
N46  FKODTG4    IF   E           K DISK
N16  FKODTS2    IF   E           K DISK
N12  FKUFAST    IF   E           K DISK
N07  FGSS052F2  IF   E           K DISK
     Fdokoth    IF   E           K DISK
     Fcum3lm    IF   E           K DISK
     FVEIAVGL2  IF   E           K DISK
     FVEIAVGL3  IF   E           K DISK
     F                                     RENAME(VEIAVGFR:VEIAVG3)
     FCDERAF    IF   E           K DISK
     FVEIAVGFN  IF   E           K DISK
     FFAKT      UF A E           K DISK    USROPN
     FFAK2      IF   E           K DISK    USROPN
     F                                     RENAME(FAKTR:FAKTR2)
     FFAK4      IF   E           K DISK    USROPN
     F                                     RENAME(FAKTR:FAKTR4)
     FFAKTXT    UF A E           K DISK
     FHEADF     UF   E           K DISK    USROPN
     FKODSAM    IF   E           K DISK
     FKODWL01   IF   E           K DISK
     FKAVT      IF   E           K DISK
     FFERDL01   UF A E           K DISK
     FDOKUI     IF   E           K DISK
     FDOKUF     IF   E           K DISK
     FDOKEF     IF   E           K DISK
     FVALUL01   IF   E           K DISK
     FVAIAL01   IF   E           K DISK
     F                                     RENAME(VALUR:VAIAR)
     FLEVEL01   IF   E           K DISK
     FCUNDL01   UF   E           K DISK
     FPRIK      IF   E           K DISK
     FPRIK1D    IF   E           K DISK
     FAVFRHL01  IF   E           K DISK
     FPRIK1     IF   E           K DISK
     F                                     RENAME(PRIKR:PRIKR1)
s41  F*RJOIN    IF   E           K DISK
     FPRIS      IF   E           K DISK
     FPRISVEI   IF   E           K DISK
     F                                     RENAME(PRISR:PRISVEIR)
     FMULTKODT  IF   E           K DISK
     FKODTCC    IF   E           K DISK
     FBILLOF    IF   E           K DISK
     FSTED2D    IF   E           K DISK
     F                                     RENAME(STED2R:STED2DR)
     FSTED2     IF   E           K DISK
     FFRATN     IF   E           K DISK
     FCFRAT     IF   E           K DISK
     FBLV1LF    IF   E           K DISK
     FCDCON4    IF   E           K DISK
     FCUSAAV    IF   E           K DISK
     FFIRM      IF   E           K DISK
     FKOSBU     UF A E           K DISK
     FKOSTT     UF A E           K DISK
     FTURER14   IF   E           K DISK
     FMCAWF     IF   E           K DISK
     FFRISOK    IF A E           K DISK
     FSYPARL1   IF   E           K DISK
     FFRSTTG    IF   E           K DISK
N21  FFRATXT    IF   E           K DISK
     FSYFI10FX  CF   E             WORKSTN USROPN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
     F*
     D                 DS
     D  FADOCN                 1     11
s04  D* FADOCN6_10             6     10
N04  D  FADOCN5_11             5     11
     D*  Include/omit arrays for gebyravtaler
     D GNT             S              3    DIM(20)
     D KN              S              8  0 DIM(10)
     D                SDS
     D  ZUSER                254    263
     D                 DS
     D  HEM3                   1      7  3
     D  HEM3N                  2      6  2
     D                 DS
     D  UR                     1     10
     D                                     DIM(10)                              I/O. ursp.kode
     D  PKUR01                 1      1
     D  PKUR02                 2      2
     D  PKUR03                 3      3
     D  PKUR04                 4      4
     D  PKUR05                 5      5
     D  PKUR06                 6      6
     D  PKUR07                 7      7
     D  PKUR08                 8      8
     D  PKUR09                 9      9
     D  PKUR10                10     10
     D                 DS
     D  TR                     1     40
     D                                     DIM(10)                              I/O. ursp.kode
     D  PTRA01                 1      4
     D  PTRA02                 5      8
     D  PTRA03                 9     12
     D  PTRA04                13     16
     D  PTRA05                17     20
     D  PTRA06                21     24
     D  PTRA07                25     28
     D  PTRA08                29     32
     D  PTRA09                33     36
     D  PTRA10                37     40
     D                 DS
     D  FR                     1     30
     D                                     DIM(10)                              I/O. frankatur
     D  PKFR01                 1      3
     D  PKFR02                 4      6
     D  PKFR03                 7      9
     D  PKFR04                10     12
     D  PKFR05                13     15
     D  PKFR06                16     18
     D  PKFR07                19     21
     D  PKFR08                22     24
     D  PKFR09                25     27
     D  PKFR10                28     30
     D                 DS
     D  GNA                    1     30
     D                                     DIM(10)
     D  GNAT                   1     30
     D  AFGE01                 1      3
     D  AFGE02                 4      6
     D  AFGE03                 7      9
     D  AFGE04                10     12
     D  AFGE05                13     15
     D  AFGE06                16     18
     D  AFGE07                19     21
     D  AFGE08                22     24
     D  AFGE09                25     27
     D  AFGE10                28     30
     D                 DS
     D  OT                     1     20
     D                                     DIM(10)                              I/O. oppd.type
     D  PKOT01                 1      2
     D  PKOT02                 3      4
     D  PKOT03                 5      6
     D  PKOT04                 7      8
     D  PKOT05                 9     10
     D  PKOT06                11     12
     D  PKOT07                13     14
     D  PKOT08                15     16
     D  PKOT09                17     18
     D  PKOT10                19     20
     D                 DS
     D  LK                     1     20
     D                                     DIM(10)                              I/O. landkode
     D  PKLK01                 1      2
     D  PKLK02                 3      4
     D  PKLK03                 5      6
     D  PKLK04                 7      8
     D  PKLK05                 9     10
     D  PKLK06                11     12
     D  PKLK07                13     14
     D  PKLK08                15     16
     D  PKLK09                17     18
     D  PKLK10                19     20
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
      * CURSOR LOKASJON AV AKTIV VINDU
     D  WSCLOW               382    383B 0
     D                 DS
     D  FS                     1     50
     D                                     DIM(10)                              I/O. frasted
     D  PKFS01                 1      5
     D  PKFS02                 6     10
     D  PKFS03                11     15
     D  PKFS04                16     20
     D  PKFS05                21     25
     D  PKFS06                26     30
     D  PKFS07                31     35
     D  PKFS08                36     40
     D  PKFS09                41     45
     D  PKFS10                46     50
     D                 DS
     D  TS                     1     50
     D                                     DIM(10)                              I/O. tilsted
     D  PKTS01                 1      5
     D  PKTS02                 6     10
     D  PKTS03                11     15
     D  PKTS04                16     20
     D  PKTS05                21     25
     D  PKTS06                26     30
     D  PKTS07                31     35
     D  PKTS08                36     40
     D  PKTS09                41     45
     D  PKTS10                46     50
      *
      * lossested
      *
     D                 DS
s41  D* LS                     1     80
s41  D*                                    DIM(3)                               I/O. last/loss
N41  D  LS                     1    100
N41  D                                     DIM(5)                               I/O. last/loss
     D  PKLS01                 1     20
     D  PKLS02                21     40
     D  PKLS03                41     60
N41  D  PKLS04                61     80
N41  D  PKLS05                81    100
      *
      * lastested
      *
N41  D                 DS
N41  D  L2                     1    100
N41  D                                     DIM(5)                               I/O. last/loss
N41  D  PKL201                 1     20
N41  D  PKL202                21     40
N41  D  PKL203                41     60
N41  D  PKL204                61     80
N41  D  PKL205                81    100
      *** KG2XX I KODETGE ER TATT I BRUK        23/11-89
      *** 4 FØRSTE POSISJON PÅ KG2LEV I KODETGE ER TATT I BRUK
      *** SOM PROSENT SATS MEN KG2LEV ER IKKE I BRUK NÅ
     D                 DS
     D  KG2LEV                 1      8  0
     D  KG2PRO                 1      4  4
     D                 DS
     D  KLKPRO                 1      3  0
     D  XPRO                   1      3  3
     D                 DS
     D  HEKNT                  1      8  0
     D  XKNF                   6      8  0
     D                 DS
     D  WSDT                   1      6  0
     D  WSDTD                  1      2  0
     D  WSDTM                  3      4  0
     D  WSDTÅ                  5      6  0
     D                 DS
     D  HEDTOP                 1      8  0
     D  HEDTÅ                  1      4  0
     D  HEDTM                  5      6  0
     D  HEDTD                  7      8  0
     D                 DS
     D  KDIBL1                 1      4  2
     D  XBL1                   1      4  4
     D                 DS
     D  DICCPP                 1      2
     D  XCCPP1                 1      1
     D                 DS
     D  X01B                   1      1
     D  PRKOLL                 1      1
     D  PKKOLL                 1      1
     D  PRINT                  2      6  0
     D  PKINT                  2      6  0
     D  PRANT                  7     11  0
     D  PKPPR                  7     11  0
     D  PRTEGN                12     12
     D  PKTEGN                12     12
     D  PRJUST                13     22  3
     D  PKJUST                13     22  3
     D                 DS
     D  FTKODE                 1      1
     D  PKAVTT                 1      1
     D                 DS
     D  FRVK1                  1      5  0
     D  FRVK2                  6     10  0
     D  FRVK3                 11     15  0
     D  FRVK4                 16     20  0
     D  FRVK5                 21     25  0
     D  FRVK6                 26     30  0
     D  FRVK7                 31     35  0
     D  FRVK8                 36     40  0
     D  FRVK9                 41     45  0
     D  FRVK10                46     50  0
     D  FRVK11                51     55  0
     D  FRVK12                56     60  0
     D  FV                     1     60  0
     D                                     DIM(12) ASCEND                       VEKTGR. AVTALE
     D                 DS
     D  FB01                   1      3P 0
     D  FB02                   4      6P 0
     D  FB03                   7      9P 0
     D  FB04                  10     12P 0
     D  FB05                  13     15P 0
     D  FB06                  16     18P 0
     D  FB07                  19     21P 0
     D  FB08                  22     24P 0
     D  FB09                  25     27P 0
     D  FB10                  28     30P 0
     D  FB11                  31     33P 0
     D  FB12                  34     36P 0
     D  FB                     1     36P 0
     D                                     DIM(12)
     D                 DS
     D  FM                     1     36P 0
     D                                     DIM(12)
     D  FM01                   1      3P 0
     D  FM02                   4      6P 0
     D  FM03                   7      9P 0
     D  FM04                  10     12P 0
     D  FM05                  13     15P 0
     D  FM06                  16     18P 0
     D  FM07                  19     21P 0
     D  FM08                  22     24P 0
     D  FM09                  25     27P 0
     D  FM10                  28     30P 0
     D  FM11                  31     33P 0
     D  FM12                  34     36P 0
     D                 DS
     D  FTMAX1                 1      5  0
     D  FTMAX2                 6     10  0
     D  FTMAX3                11     15  0
     D  AX                     1     15  0
     D                                     DIM(3)
      * PARAMETERSTRENG FOR KALL PÅ SYKS12
     D                 DS
     D  P1DS                   1    256
     D  P1FLAG                 1      1
     D  P1BNR                  2      8  0
     D  P1AVD                  9     12  0
     D  P1TUNR                13     20  0
     D  P1OAVD                21     24  0
     D  P1OPD                 25     31  0
     D  P1BL                  32     44  2
     D                 DS
     D  XMSG2                  1     62
     D  XKN                    7     14
     D  XLIKV                 31     31
     D  XLINAV                33     62
      * Gebyrer som skal/kan mail-adviseres 12 elem. a 4 tegn (FR1,Fr2,..) Geb er venstrest.
     D                 DS
     D  AdvString              1     48
     D  ADV                    1     48    DIM(12)
     D  AdvK01                 4      4
     D  AdvK02                 8      8
     D  AdvK03                12     12
     D  AdvK04                16     16
     D  AdvK05                20     20
     D  AdvK06                24     24
     D  AdvK07                28     28
     D  AdvK08                32     32
     D  AdvK09                36     36
     D  AdvK10                40     40
     D  AdvK11                44     44
     D  AdvK12                48     48
N12   * FRITEKSTLINJEKRAV
N12  D                 DS
N12  D  FRI                    1    200
N12  D                                     DIM(5)                               I/O. frankatur
N12  D  FRI001                 1     40
N12  D  FRI002                41     80
N12  D  FRI003                81    120
N12  D  FRI004               121    160
N12  D  FRI005               161    200
N12  D  FRIX                   1    200
N43   * tilleggsproduketr
N43  D                 DS
N43  D  TP                     1      5
N43  D                                     DIM(5)                               I/O. tillprodu
N43  D  HESTN1                 1      1
N43  D  HESTN2                 2      2
N43  D  HESTN3                 3      3
N43  D  HESTN4                 4      4
N43  D  HESTN5                 5      5
N43  D  TPX                    1      5
     D UCMD            DS          1024
     D                 DS
     D XCMD01          C                   CONST('OVRDBF -
     D                                     FILE(HEADF) -
     D                                     TOFILE(SIDUPA)')
     D XCMD02          C                   CONST('OVRDBF -
     D                                     FILE(FAKT) -
     D                                     TOFILE(SIDUPB)')
     D XCMD03          C                   CONST('OVRDBF -
     D                                     FILE(FAK2) -
     D                                     TOFILE(SIDUPB2)')
     D XCMD04          C                   CONST('OVRDBF -
     D                                     FILE(FAK4) -
     D                                     TOFILE(SIDUPB4)')
      *
      *
      *
     IKUNDR
     I              BANKG                       SYBAGI
     I              POSTG                       SYPOGI
     IPRIKRD
     I              PKKNR                       XXX01
     I              PKAVTN                      XXX02
     I              PKFR01                      XXX03
     I              PKOT01                      XXX04
     I              PKGEBY                      XXX05
     C                   EXSR      INIT
      *
      *
      *
     C     UNYGML        IFEQ      'NY'
     c* ikke reberegn ferdimeldte samlefakturakø fakturert før
N51  C     *in87         andeq     '0'
N51  C     SAMKOE        andne     'J'
N51  C     FAKTFOER      andne     'J'
     C                   EXSR      DELFAK
N12  C                   MOVE      'GM'          UNYGML
     C     XWEBKALK      CABEQ     'J'           SLUTT
     C     USECUR        CABEQ     'SSKALK'      SLUTT
     C                   END
     C     UFLAGG        IFEQ      3
     C     UFLAGG        OREQ      6
     C                   EXSR      KUNFRA
     C                   GOTO      SLUTT2
     C                   END
      *
     C                   OPEN      SYFI10FX
N53  C                   MOVE      'GM'          UNYGML
      *
     C                   EXSR      VARSEL
      *
     C     START         TAG
N29  c                   move      ' '           XSK                            sikre at Ilin. syns.
     C                   MOVE      '1'           *IN83
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(83)
     C                   Z-ADD     *ZEROS        ZRECNO
     C                   MOVE      *ZEROS        KN
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     FAK4K         SETLL     FAK4
     C                   EXSR      SUMBL
N07   *
N07  C     USECUR        IFEQ      '*SECUR'
N07   * HENT UTLEGG FRA SHIP-SYS
N07  C     ZUSER         SETLL     GSS052F2
N07  C     ZUSER         READE     GSS052F2                               33
N07  C                   DOW       *IN33 = *OFF
N07  C                   EVAL      FALIWS = 0
N07  C                   EVAL      FAVK   = G52VK
N07  C                   EVAL      KGENOT = G52VT
N07  C                   EVAL      FAVAL  = G52VAL
N07  C                   EVAL      FABELV = G52BLV
N07  C                   EVAL      FABELN = G52BLN
N07  C                   EVAL      FAKDM  = G52KDM
N07  C                   EVAL      FAKDA  = G52KDA
N07  C                   EVAL      FACD11 = 'T'
N07  C                   ADD       1             ZRECNO
N07  C                   WRITE     SUBFIL
N07  C                   IF        USK    = 'S'
N07  C                   EVAL      WSTOTS = WSTOTS + G52BLN
N07  C                   ELSE
N07  C                   EVAL      WSTOTK = WSTOTK + G52BLN
N07  C                   END
N07  C     ZUSER         READE     GSS052F2                               33
N07  C                   ENDDO
N07  C                   END
     C     START1        TAG
     C     HEADFK        READE     FAK4                                   84
     C   84              MOVE      *BLANKS       KGENOT
     C   84              MOVE      *BLANKS       WSNR
      *
     C     START2        TAG
      *
     C  N84              DO
     C                   DO        9999
     C                   ADD       1             ZRECNO
     C                   MOVE      FAVK          WSVK
     C     KODGEK        CHAIN     KOGER                              32
     C   32              MOVE      ' '           XKDUL
     C  N32              MOVE      KGEUTL        XKDUL
     C  N32FAVT          IFNE      *BLANKS
     C                   MOVE      FAVT          KGENOT
     C                   END
     C     FASK          COMP      'E'                                    51
     C                   MOVE      FALI          FALIWS
      * Test om faktura mottagersnr. i oppdrag er endret.
      * I så fall endres det også på fakturalinjer og oppdateres
      * kredittgrense på kunderegister.
     C                   EXSR      TSTKN
     C                   EXSR      HENTKN
     C                   WRITE     SUBFIL
     C     HEADFK        READE     FAK4                                   84
     C  N84              END
     C                   END
      * Remember last line data. (If more than one page, this is 1.
      * first line on page 2. Screen data for roll will be lost i a
      * line on page 1. is updated before roll to page 2.
     C  N84              EXSR      MOVFAZ
      *
     C                   Z-ADD     ZRECNO        YRECNO            5 0
      * TEST KREDITGRENSE
     C     ZRECNO        IFGT      0
     C                   Z-ADD     1             ZRECNO
     C                   EXSR      TESTKG
     C                   END
      *
     C     START3        TAG
     C                   MOVEA     '11'          *IN(81)
     C   79UMSG          COMP      *BLANKS                                79
     C                   EXSR      KDTFMT
     C     ZRECNO        IFEQ      0
     C                   EXFMT     NYWRK
     C                   ELSE
     C                   SETOFF                                       88
     C                   WRITE     SUBCTL
     C                   EXFMT     BUNN
     C                   END
     C* SET OFF FEILMELDINGSINDIKATORE. (FOR BUNN/NYWRK).
     C                   SETOFF                                       3085
     C                   EXSR      KDTFMT
      * FLYTTE MELDING TILBAKE. (SE SUBRUTINE VARSEL)
     C                   MOVE      XMSG          UMSG
      *
      *
      * FREETEXT
      *
     C   18              DO
     C                   EXSR      VISFRE
     C                   GOTO      START
     C                   END
     C   24              DO
     C                   EXSR      CMDLIN
     C                   GOTO      START3
     C                   END
      *
      * F11 = LOOK AT REQUISITIONS./BUDGETED COSTS
      *
     C   11              DO
     C                   MOVE      'O'           P1FLAG
     C                   MOVE      *ZEROS        P1BNR
     C                   MOVE      *ZEROS        P1AVD
     C                   MOVE      *ZEROS        P1TUNR
     C                   MOVE      UAVD          P1OAVD
     C                   MOVE      UOPD          P1OPD
     C                   MOVE      *ZEROS        P1BL
     C                   MOVE      P1DS          PARM1           256
     C                   CALL      'SYKS12'
     C                   PARM                    PARM1
     C                   GOTO      START
     C                   END
      *
      * F14 = LOOK AT INVOICES - eller InvoiceNotis på kunde
      *
     C   14              DO
N21  C     WSCLOC        DIV       256           LINNBR            3 0
N21  C                   MVR                     POSNBR            3 0
N35   * linje 1   = se på info kode F freetext
s37  C*                  if        LINNBR = 1
S37  C*                  EXSR      VISFRE
S37  C*                  ELSE
N21   * linje 2-5 = se kundens notis for invoice
S64  C*                  if        LINNBR >= 2 and LINNBR <= 5
N21  C                   if        LINNBR >= 1 and LINNBR <= 5
N64  C                   if        POSNBR < 83
N21  C                   select
S64  C*    LINNBR        wheneq    2
N64  C     LINNBR        whenle    2
N21  C                   MOVE      HEKNSF        XSKKNR
N21  C     LINNBR        wheneq    3
N21  C                   MOVE      HEKNSA        XSKKNR
N21  C     LINNBR        wheneq    4
N21  C                   MOVE      HEKNKF        XSKKNR
N21  C     LINNBR        wheneq    5
N21  C                   MOVE      HEKNKA        XSKKNR
N21  C                   endsl
N21  C                   MOVE      *ZEROS        UFLAGG
N21  C                   CALL      'FRITXTSK'
N21  C                   PARM                    FIFIRM
N21  C                   PARM                    XSKKNR            8 0
N21  C                   PARM                    XSKMOT            8
N21  C                   PARM                    UFLAGG
N21  C                   PARM      'I'           DELSYI            1
N64  C                   else
N64   * fra pos 83 og ut = vis dup-faktura
N64  C                   MOVE      *ZEROS        DUAVDXX
N64  C                   MOVE      *ZEROS        DUOPDXX
N64  C                   select
N64  C     LINNBR        wheneq    1
N64  C                   MOVE      DUAVD0        DUAVDXX
N64  C                   MOVE      DUOPD0        DUOPDXX
N64  C     LINNBR        wheneq    2
N64  C                   MOVE      DUAVD1        DUAVDXX
N64  C                   MOVE      DUOPD1        DUOPDXX
N64  C     LINNBR        wheneq    3
N64  C                   MOVE      DUAVD2        DUAVDXX
N64  C                   MOVE      DUOPD2        DUOPDXX
N64  C                   endsl
N64  C                   if        DUOPDXX <> 0
N64  C                   CALL      'SYFM21B'
N64  C                   PARM                    UFIRM
N64  C                   PARM                    DUAVDXX           4 0
N64  C                   PARM                    DUOPDXX           7 0
N64  C                   PARM                    FMDUM             1 0
N64  C                   endif
N64  C                   endif
N21  C                   else
      * ellers= Se invoice(tidligere)
     C                   CALL      'SYFM21B'
     C                   PARM                    UFIRM
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    FMDUM             1 0
N21  C                   endif
S37  C*                  endif
     C                   GOTO      START
     C                   END
      *
      *** FRISK OPP - VIS OGSÅ UTL.PROVISJON
      *
     C   05KO2UTL        IFNE      'N'
     C                   EXSR      UTLSR
     C                   END
N09  C   05hevalt        ifne      *blanks
N09  C     hevalp        andne     *zeros
N09  C                   exsr      REGTIL
N09  C                   end
     C   05              GOTO      START
      *
      *** MAKE NEW INVOICELINE
      * NOT IF SECURED
      *
     C   06USECUR        IFNE      '*SECUR'
     C                   EXSR      MOVW
N15  C                   EVAL      *IN71 = *OFF
     C                   GOTO      START5
     C                   END
     C   07              DO
     C                   MOVEA     *BLANKS       GNT
     C                   MOVE      *ZEROS        GN
     C                   EXSR      DELFAK
     C                   GOTO      START
     C                   END
      *
      *** MAKE NEW INVOICELINE (WAREHOUSE)
     C   02              DO
     C                   MOVE      *ZEROS        UFLAGG
     C                   CALL      'LL052C'
     C                   PARM                    UAVDAN
     C                   PARM                    UOPDAN
     C                   PARM                    UFLAGG
     C     UFLAGG        CABEQ     1             START3
     C                   GOTO      START
     C                   END
      * FERDIGMELDING
      *
     C   10              DO                                                     B1
     C     UMELD         IFEQ      ' '                                           B2
     C* AKTIVERE FERDIGMELDING....
      *
N65  c                   move      ' '           S_fins            1
N65  c                   move      ' '           K_fins            1
      * KAN IKKE FERDIGMELDE HVIS LINJER SOM SKAL BUDSJETTERES/SPLITTES
      *
     C                   MOVE      *ZEROS        KN
     C     HEADFK        SETLL     FAK4
     C     HEADFK        READE     FAK4                                   33
     C     *IN33         DOWEQ     '0'                                            B3
     C     FAKDUK        IFNE      ' '                                             B4
     C     FAKDUK        ANDNE     'N'
N17  C     FAKDUK        ANDNE     'A'
     C     FABELU        ANDEQ     *ZEROS
     C                   MOVE      FAVK          XXVK              3
     C                   MOVE      'JOV0377'     MSGNR
     C                   SETON                                        3085
     C                   END                                                       E4
      * test om krav til tilleggsinfo
      *
N12  c                   exsr      KRAVFRI
      *
     C*Oppdater kundenr på fakt.linjenivå ved ferdigmelding.
     C     FASK          IFEQ      'S'                                             B4
     C     FAKUNR        IFNE      HEKNSF                                           B5
     C  N35              EXSR      MSALDO                                       TREKK SALDO
     C     FAKTK         CHAIN     FAKT                               34
     C  N34              MOVE      HEKNSF        FAKUNR
     C* Ikke ferdimeld agentsiden ved samlast (skal på manifest)
     C  N34              UPDATE    FAKTR
     C  N34
     CANN35              EXSR      PSALDO                                       PLUS SALDO
     C                   END                                                        E5
     C                   ELSE                                                      X4
     C     FASK          IFEQ      'K'                                              B5
     C     FASK          OREQ      'F'
     C     FAKUNR        IFNE      HEKNKF                                            B6
     C  N35              EXSR      MSALDO                                       TREKK SALDO
     C     FAKTK         CHAIN     FAKT                               34
     C  N34              MOVE      HEKNKF        FAKUNR
     C*IKKE MERKE SAMLAST FLY
     C  N34
     CAN 44HERFA         IFNE      *BLANKS                                           B6
     C                   MOVE      *ZEROS        FAKUNR
     C                   END                                                         E6
     C  N34              UPDATE    FAKTR
     C  N34
     CANN35              EXSR      PSALDO                                       PLUS SALDO
     C                   END                                                         E6
     C                   END                                                        E5
     C                   END                                                       E4
     C                   EXSR      HENTKN
N65  c                   if        FASK<>'I' and FASK<>'E'
N65  c                   if        FASK='S'
N65  c                   move      'J'           S_fins
N65  c                   else
N65  c                   move      'J'           K_fins                         K (el X)
N65  c                   endif
N65  c                   endif
     C     HEADFK        READE     FAK4                                   33
     C                   END                                                      E3
     C     *IN30         IFEQ      '1'                                            B3
     C                   MOVE      XXVK          FAVK
     C                   GOTO      START3
     C                   END                                                      E3
     C                   EXSR      TESTKG
     C   30              GOTO      START3
N65   * det finnes FLERE parter - valg/filter på hvilken som skal ferdigmeldes???
N65  c                   move      *blanks       WSSKB                          Selger/kjøper/begge
N65  c                   if        varsleFler = 'J' and
N65  c                             S_fins = 'J' and K_fins = 'J'
N65  c                   move      VarsleFlerDft WSSKB
N65  C     FerdTag       tag
N65  C                   exfmt     FERDFLER
N65  C   12              GOTO      START3
N65  c                   if        WSSKB<>'S' and WSSKB<>'K' and WSSKB<>'B'
N65  c                   goto      FerdTag
N65  c                   endif
N65  c                   if        WSSKB = 'B'
N65  c                   move      *blanks       WSSKB                          = alle/ikke filter
N65  c                   endif
N65  c                   endif
      *
     C                   MOVE      'J'           UMELD
     C*
     C                   ELSE                                                    X2
     C* OPPHEVE FERDIGMELDING....
     C                   MOVE      ' '           UMELD
     C                   END                                                     E2
     C                   EXSR      OPDFER
     C                   GOTO      START3
     C                   END                                                    E1
      *
      * KALLER ENDRE FERDIGMELDTE
      *
     C   20              DO
     C                   MOVE      'N'           ALLWS             1
     C                   MOVE      'J'           UPDATE            1
     C                   MOVE      UAVD          XAVD
     C                   MOVE      UOPD          XOPD
     C                   CALL      'SYFA58'
     C                   PARM                    XAVD
     C                   PARM                    XOPD
     C                   PARM                    ALLWS
     C                   PARM                    UPDATE
      * OPPDATER SKJERMBILDE MED STATUS FOR FERDIGMELDING
     C                   MOVE      ' '           UMELD
     C                   MOVE      '0'           *IN87                          *FERDIGM
     C                   MOVEA     '0'           *IN(90)                        *SINGLE
     C                   MOVEA     '0'           *IN(77)                        *SAMLE
     C     HEADFK        SETLL     FERDL01
     C     HEADFK        READE(N)  FERDL01                                33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      '1'           *IN87                          *FERDIGMELDT
     C                   MOVE      'J'           UMELD
     C     FEKN          IFNE      *ZEROS
     C  N90FESFAK        COMP      ' '                                    90    *SINGLE
     C  N77FESFAK        COMP      ' '                                7777      *SAMLEFAKT
     C                   END
     C     HEADFK        READE(N)  FERDL01                                33
     C                   END
     C                   GOTO      START3
     C                   END
     C   03
     COR 16
     COR 08
     COR 09
     COR 12              DO
     C                   EXSR      KUNFRA
     C     KO2UTL        IFNE      'N'
     C                   EXSR      UTLSR
     C                   END
N09  C     hevalt        ifne      *blanks
N09  C     hevalp        andne     *zeros
N09  C                   exsr      REGTIL
N09  C                   end
     C   03              Z-ADD     3             UFLAGG
     C   16              Z-ADD     6             UFLAGG
     C   08              DO
      *
     C     HEUR          IFEQ      'A'
     C     HEUR          OREQ      'C'
     C     HEUR          OREQ      'F'
     C                   CALL      'SAD61CLD'
     C                   PARM                    UAVDAN
     C                   PARM                    UOPDAN
     C                   GOTO      START3
     C                   END
      *
      *
     C     HEUR          IFEQ      'B'
     C     HEUR          OREQ      'D'
     C     HEUR          OREQ      'G'
     C                   CALL      'SAD52CLD'
     C                   PARM                    UAVDAN
     C                   PARM                    UOPDAN
     C                   PARM                    HESG
     C                   GOTO      START3
     C                   END
      * TRANSP-MODUL
     C     HEUR          IFEQ      'H'
      * Import (fraland ulik NO)
     C     HELKA         IFNE      FILAND
     C                   CALL      'SAD61CLD'
     C                   PARM                    UAVDAN
     C                   PARM                    UOPDAN
     C                   ELSE
      * Eksport(fraland  lik NO)
     C                   CALL      'SAD52CLD'
     C                   PARM                    UAVDAN
     C                   PARM                    UOPDAN
     C                   PARM                    HESG
     C                   END
     C                   GOTO      START3
     C                   END
      *
     C                   Z-ADD     8             UFLAGG
     C                   END
      *
      *
      * SNUDD FORTOLLING
     C   09              DO
      *
     C     HEUR          IFEQ      'A'
     C     HEUR          OREQ      'C'
     C     HEUR          OREQ      'F'
     C                   CALL      'SAD52CLD'
     C                   PARM                    UAVDAN
     C                   PARM                    UOPDAN
     C                   PARM                    HESG
     C                   GOTO      START3
     C                   END
      *
      *
     C     HEUR          IFEQ      'B'
     C     HEUR          OREQ      'D'
     C     HEUR          OREQ      'G'
     C                   CALL      'SAD61CLD'
     C                   PARM                    UAVDAN
     C                   PARM                    UOPDAN
     C                   GOTO      START3
     C                   END
      * TRANSP-MODUL
     C     HEUR          IFEQ      'H'
      * IMPORT (FRALAND ULIK NO)
     C     HELKA         IFNE      FILAND
     C                   CALL      'SAD52CLD'
     C                   PARM                    UAVDAN
     C                   PARM                    UOPDAN
     C                   PARM                    HESG
     C                   ELSE
      * EKSPORT(FRALAND  LIK NO)
     C                   CALL      'SAD61CLD'
     C                   PARM                    UAVDAN
     C                   PARM                    UOPDAN
     C                   END
     C                   GOTO      START3
     C                   END
      *
     C                   Z-ADD     8             UFLAGG
     C                   END
      *
     C   12              Z-ADD     1             UFLAGG
     C   12              MOVE      'GM'          UNYGML
     C   12              MOVE      ' '           UMELD
     C                   CLOSE     SYFI10FX
     C                   GOTO      SLUTT
     C                   END
      *
      *** BLA VIDERE
      *
N22  C   17              DO
N22  C                   EXSR      ARKIVS
N22  C                   END
     C   25              DO
     C                   SETOFF                                       25
     C                   Z-ADD     YRECNO        ZRECNO
      *
      * First line on next is allways read earlier -
      * get back remembered fields (preserved i Z-fields by MOVFAZ)
      *
     C                   EXSR      MOVZFA
     C                   GOTO      START2
     C                   END
      *
     C     ZRECNO        IFEQ      0
     C                   GOTO      START3
     C                   ELSE
     C                   EXSR      HENTFA
     C   88              GOTO      START3
N14  C     WSNR          IFEQ      'X'
N14  C     UFLAGG        IFEQ      0
N14  C     FAKTK         CHAIN     FAKT                               34
N14  C                   MOVE      'X'           FAKDA
N14  C                   UPDATE    FAKTR
N14  C                   END
N14  C                   MOVE      ' '           WSNR
N14  C                   UPDATE    SUBFIL
N14  C                   GOTO      START3
N14  C                   END
     C                   END
      *
      *** SLETT FAKTURALINJE
      *
     C     WSNR          IFEQ      '4'                                          4=SLETTE
     C                   MOVE      ' '           WSNR
     C     STSLE         TAG
     C                   EXFMT     VAREL3
     C  N12              DO
     C     FAKTK         CHAIN     FAKT                               33
     C  N33FAOPKO        IFGE      'D'
     C                   UPDATE    FAKTR
     C                   SETON                                        30
     C                   MOVE      'SHU0683'     MSGNR
     C                   GOTO      STSLE
     C                   ELSE
     C                   DELETE    FAKTR
     C                   EXSR      DLTFTXT
      * SLETT GRUNNLAGLINJER FRA LAGERSYSTEM
     C                   MOVE      UAVD          ULAVD             4
     C                   MOVE      UOPD          ULOPD             7
     C                   MOVE      FALI          ULLI              5
     C                   MOVE      *ZEROS        ULFDT             8
     C                   MOVE      *ZEROS        ULFN              6
     C                   MOVE      ' '           ULKOPI            1
     C                   MOVE      'S'           ULOPT             1
     C                   CALL      'LL054C'
     C                   PARM                    ULAVD
     C                   PARM                    ULOPD
     C                   PARM                    ULLI
     C                   PARM                    ULFDT
     C                   PARM                    ULFN
     C                   PARM                    ULKOPI
     C                   PARM                    ULOPT
     C  N33
     CANN35              EXSR      MSALDO                                       TREKK SALDO
      * SLETT OGSÅ EVT. BUDSJETTERT KOSTNAD
     C     FAJOUR        IFNE      *ZEROS
     C     FAJOUR        CHAIN     KOSBU                              33
     C  N33              DELETE    KOSBUR
     C                   END
     C                   END
      *
      * OPPDATER OGSÅ EVT. FRAKTBELØP I TRANSPORTMODUL
      *
     C     HEUR          IFEQ      'H'
     C     FALI          ANDEQ     0
     C     HEADFK        CHAIN     HEADF                              33
     C     *IN33         IFEQ      *OFF
     C                   MOVE      'N'           TRFRAK
     C                   Z-ADD     0             TRFRAB
     C                   UPDATE    HEADFR
     C                   ENDIF
     C                   ENDIF
     C                   EXSR      MOVF
     C                   MOVEL     '*DLT'        KGENOT
     C                   END
      * SLUTT SLETTING
     C   12              Z-ADD     1             XTOTSG
     C   12              EXSR      TOTSR
     C     FASK          COMP      'E'                                51
     C                   UPDATE    SUBFIL
     C                   GOTO      START3
     C                   END
      *
      * SE PÅ KUNDENS AVTALE
      *
     C     WSNR          IFEQ      '9'
     C                   MOVE      *ZEROS        UUUKUN
     C     FAAGRN        IFEQ      *ZEROS
     C     FASK          IFEQ      'K'
     C                   MOVE      HEKNKF        UUUKUN
     C                   ELSE
     C     FASK          IFEQ      'S'
     C                   MOVE      HEKNSF        UUUKUN
     C                   ELSE
     C     FASK          IFEQ      'X'
     C                   MOVE      FAKUNR        UUUKUN
     C                   ELSE
     C                   GOTO      TAG09
     C                   END
     C                   END
     C                   END
     C                   END
      *
      *
     C                   Z-ADD     1             UFLAGG
s27  C*                  CALL      'SYPO09'
n27  C                   CALL      'SYPO09CL2'
     C                   PARM                    FAAGRN
     C                   PARM                    UUUKUN            8 0
     C                   PARM                    UFLAGG
     C     TAG09         TAG
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   GOTO      START
     C                   END
      *
      *** VISE FAKTURALINJE
      *
     C     WSNR          IFEQ      '5'                                          5=VISE
     C                   MOVE      ' '           WSNR
     C     FAEXRA        ifeq      *zeros
     C     VALUK2        CHAIN     VALUL01                            33
     C     FABELV        IFNE      0
     C     FABELN        DIV(H)    FABELV        XWORK
     C     XWORK         MULT      OMRFAK        WSKURS
     C                   ELSE
     C                   Z-ADD     FAEXRA        WSKURS
     C                   END
     C                   ENDIF
     c                   move      fakunr        wskunr
     C     KUND1K        CHAIN(N)  CUNDL01                            33
     c   33              move      *blanks       KNAVN
     C                   EXFMT     VAREL3
     C                   MOVE      *ZEROS        WSkunr
     C                   MOVE      *ZEROS        WSKURS
     C     FASK          COMP      'E'                                51
     C                   UPDATE    SUBFIL
     C                   GOTO      START3
     C                   END
      *
      *** ARBEID MED FRITEKST
      *
     C     WSNR          IFEQ      'F'
     C                   MOVE      FALI          ULI               5 0
     C                   CALL      'SYFI12'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    ULI
     C                   PARM      '0'           UIN27             1
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   GOTO      START3
     C                   END
      *
      *** LAGE/ENDRE FAKTURALINJE
      *
     C     START5        TAG
     C  N30
     CANN04              Z-ADD     20            LINNBR
     C  N30
     CANN04WSSK          IFEQ      *BLANKS
     C                   Z-ADD     2             POSNBR
     C                   ELSE
     C                   Z-ADD     5             POSNBR
N15  C   71              Z-ADD     13            POSNBR
     C                   END
     C   73UMSG          IFNE      *BLANKS
     C                   MOVE      '0'           *IN30
     C                   END
     C                   EXFMT     VARELI
     C                   MOVE      *BLANKS       UMSG
     C                   SETOFF                                       30
     C                   MOVEA     '000'         *IN(72)
     C                   MOVEA     '0000000'     *IN(92)                        *IN92-*IN98
     C   04              DO
     C                   EXSR      SØKDTA
     C                   GOTO      START5
     C                   END
     C   12              DO
     C   91FASK          COMP      'E'                                    51
     C   91              UPDATE    SUBFIL
     C                   SETOFF                                       91
     C                   Z-ADD     1             XTOTSG
     C                   EXSR      TOTSR
      *
     C                   GOTO      START3
     C                   END
     C                   EXSR      TESTB1
     C   30              GOTO      START5
      * VARSLE AT NÅ ER UTL MANUELT OVERSTYRT,
     C     WSVK          IFEQ      'UTL'
     C                   MOVE      'JOV0886'     MSGNR
     C                   SETON                                        30
     C                   END
      *
     C                   MOVE      ' '           NYLIN             1
     C                   EXSR      MOVWSF
     C                   EXSR      TOTSR
     C                   EXSR      VALUTA
     C                   MOVE      WSSAMM        PKSAMM
      *
     C     NYLIN         IFEQ      'J'
N17  c     wsbelu        ifeq      *zeros
N17  C                   EXSR      SPLISR
n17  c                   end
     C                   EXSR      NYFAK
     C                   ELSE
      * SLETT GRUNNLAGLINJER FRA LAGERSYSTEM
     C                   MOVE      UAVD          ULAVD             4
     C                   MOVE      UOPD          ULOPD             7
     C                   MOVE      FALI          ULLI              5
     C                   MOVE      *ZEROS        ULFDT             8
     C                   MOVE      *ZEROS        ULFN              6
     C                   MOVE      ' '           ULKOPI            1
     C                   MOVE      'E'           ULOPT             1
     C                   CALL      'LL054C'
     C                   PARM                    ULAVD
     C                   PARM                    ULOPD
     C                   PARM                    ULLI
     C                   PARM                    ULFDT
     C                   PARM                    ULFN
     C                   PARM                    ULKOPI
     C                   PARM                    ULOPT
     C                   MOVE      ' '           FACD13
     C                   MOVE      '0'           *IN32
     C                   MOVE      'E'           FAKDA
N17  c     wsbelu        ifeq      *zeros
N17  C                   EXSR      SPLISR
N17  C                   end
     C                   EXSR      UPFAK
     C                   END
     C   91FASK          COMP      'E'                                    51
      *
      * OPPDATER OGSÅ EVT. FRAKTBELØP I TRANSPORTMODUL
      *
     C     HEUR          IFEQ      'H'
     C     FALI          ANDEQ     0
     C     HEADFK        CHAIN     HEADFR                             33
     C     *IN33         IFEQ      *OFF
     C     FASK          IFEQ      'E'
     C                   MOVE      'E'           TRFRAK
     C                   ELSE
     C                   MOVE      'A'           TRFRAK
     C                   END
     C                   Z-ADD     WSBELV        TRFRAB
     C                   MOVE      WSKDM         TRMVA
     C                   UPDATE    HEADFR
     C                   ENDIF
     C                   ENDIF
      *
      * Er det et (tillegs-)gebyr som skal adviseres via mail ??
     c     AdvString     ifne      *blanks
     c                   movel     FAVK          AdvTst            4
     C     AdvTst        LOOKUP    ADV                                    33
      * Vis vindu for sending av adviseringsmail
     C     *in33         ifeq      *on
     C                   move      FAAVD         AdvAvd            4
     C                   move      FAOPD         AdvOpd            7
     C                   move      FALI          AdvLin            5
     C                   move      FAKUNR        AdvKun            8
     C     FASK          ifeq      'S'
     C                   move      HEKNSF        AdvKun
     C                   end
     C     FASK          ifeq      'K'
     C                   move      HEKNKF        AdvKun
     C                   end
     c                   call      'SYFI10XEC'
     C                   parm                    AdvAvd
     C                   parm                    AdvOpd
     C                   parm                    AdvLin
     C                   parm                    AdvKun
     C                   end
     c                   end
      *
      * Ny (N91)  eller endret (90) linje er lagret
     C   91              UPDATE    SUBFIL
     C  N91              ADD       1             YRECNO
     C  N91              Z-ADD     YRECNO        ZRECNO
     C  N91FASK          COMP      'E'                                    51
     C                   MOVE      FALI          FALIWS
     C  N91              WRITE     SUBFIL
     C                   EXSR      KDTFMT
     C                   WRITE     SUBCTL
     C                   EXSR      KDTFMT
     C                   SETOFF                                       91
     C                   EXSR      MOVW
     C                   GOTO      START3
      *
     C     SLUTT         TAG
     C     SLUTT2        TAG
     C                   CLOSE     HEADF
     C                   CLOSE     FAKT
     C                   CLOSE     FAK2
     C                   CLOSE     FAK4
     C                   MOVE      *BLANK        UMELD
     C                   SETON                                        LR
     C                   RETURN
      *
      ***********************************************
     C     HENTKN        BEGSR
      ***********************************************
     C     1             DO        10            XN
     C     KN(XN)        IFEQ      0
     C     KN(XN)        OREQ      FAKUNR
     C                   MOVE      FAKUNR        KN(XN)
     C                   GOTO      SLHKN
     C                   END
     C                   END
      *
     C     SLHKN         ENDSR
      *
      ***********************************************
     C     TESTKG        BEGSR
      ***********************************************
      * TEST KUNDERS KREDITGRENSE
     C     1             DO        10            XN
     C     KN(XN)        CABEQ     0             SLTKG
     C                   MOVE      KN(XN)        WSKUNR
     C     KUND1K        CHAIN(N)  CUNDL01                            33
     C     *IN33         IFEQ      '0'
     C     KGRENS        ANDGT     0
     C     KGRENS        MULT      1000          XKOVER           13 2
     C                   CALL      'SYGE07CL'
     C                   PARM                    FIFIRM
     C                   PARM      WSKUNR        UUKUNR
     C                   PARM                    KSALDO           13 2
     C     KSALDO        COMP      XKOVER                             98
     C   98              MOVE      '1'           *IN30
     C   98              MOVE      'SHU0311'     MSGNR
     C   98              GOTO      SLTKG
     C                   END
     C                   END
      *
     C     SLTKG         ENDSR
      *
      ***********************************************
     C     MSALDO        BEGSR
      ***********************************************
     C     FASK          IFNE      'F'
     C     CUND1K        CHAIN     CUNDL01                            53
     C  N53              SUB       FABELN        SYSALU
     C  N53              EXCEPT    NYSALD
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     PSALDO        BEGSR
      ***********************************************
     C     FASK          IFNE      'F'
     C     CUND1K        CHAIN     CUNDL01                            53
     C  N53              ADD       FABELN        SYSALU
     C  N53              EXCEPT    NYSALD
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     VARSEL        BEGSR
      ***********************************************
      * SENDE VARSEL HVIS FAKTURA ER UTSKREVET.
      * fakturering har første prioritet
     C                   MOVE      ' '           LINTYP            1
     C                   MOVE      UMSG          XMSG             62
     C     FAK2K         SETLL     FAK2                               33
     C     STVARS        TAG
     C     FAK2K         READE     FAK2                                   33
     C     *in33         ifeq      '0'
     C     FAOPKO        IFGT      'C'
     C     FAKDA         IFNE      'K'
     C     FASK          ANDNE     'I'
     C                   Move      'F'           LINTYP
     C                   GOTO      SNDVAR
     C                   else
      * melding om I og K
     C     Lintyp        IFEQ      *blanks
     C     fask          IFEQ      'I'
     C                   MOVE      'I'           LINTYP
     c                   else
     C     FAKDA         IFEQ      'K'
     C                   MOVE      'K'           LINTYP
     c                   end
     c                   end
     c                   end
     c                   end
     c                   end
      * slutt I/K
     C                   GOTO      STVARS
     c                   end
      * skriver varsel melding
     C     SNDVAR        tag
     C                   SELECT
     C     Lintyp        WHENEQ    'F'
     C                   MOVE      'YBC0054'     XMSGNR            7            MELDING-ID
     C     Lintyp        WHENEQ    'I'
     C                   MOVE      'SHU1218'     XMSGNR            7            MELDING-ID
     C     Lintyp        WHENEQ    'K'
     C                   MOVE      'SHU1219'     XMSGNR            7            MELDING-ID
     C                   OTHER
     C                   GOTO      UTVARS
     C                   ENDSL
      *
     C                   Z-ADD     3             XLEVEL            1 0          NIVÅ
     C                   Z-ADD     0             XRETUR            1 0          RETURKODE
     C                   Z-ADD     62            XMSGL             4 0          LENGDE PÅ MELDING
     C                   CALL      'SUBR23R3'
     C                   PARM                    XMSGNR
     C                   PARM                    UMSG             62
     C                   PARM                    XLEVEL
     C                   PARM                    XRETUR
     C                   PARM                    XMSGL
     C     UTVARS        ENDSR
      *
      ***********************************************
     C     OPDFER        BEGSR
      ***********************************************
     C* SETTING AV FERDIGMELDING. DET FINNES DA INGEN POSTER PÅ AVD/OPD
     C* (HVIS MINST EN FINNES BETYR F10 SLETT FERDIGMELDING->UMELD=' ')
     C                   MOVE      '0'           *IN87
     C                   MOVEA     '0'           *IN(90)                        *SINGLE
     C                   MOVEA     '0'           *IN(77)                        *SAMLE
     C     UMELD         IFEQ      'J'                                            B1
     C                   MOVE      '1'           *IN87                          *FERDIGMELDT
     C     *LIKE         DEFINE    FAKUNR        GMKUNR
     C                   MOVE      99999999      GMKUNR
     C     HEADFK        SETLL     FAK4
     C     HEADFK        READE     FAK4                                   33
     C     *IN33         DOWEQ     '0'                                             B2
N65  c                   If        WSSKB <> *blanks
N65  c     FASK          cabne     WSSKB         NextSKB
N65  c                   endif
     C     FAKUNR        IFNE      GMKUNR                                           B3
     C     FAVK          ANDNE     'AME'                                            B3
     C                   MOVE      FAKUNR        WSKUNR
     C     KUND1K        CHAIN(N)  CUNDL01                            33        *S.FAKTKODE
     C     CUSAAK        CHAIN     CUSAAV                             33        *AVVIK SF.KO
     C  N33              MOVE      CASFAK        SFAKT                           PÅ AVDNIVÅ?
     C                   MOVE      *ZEROS        WSKUNR
     C     FERDFK        CHAIN     FERDL01                            33
     C   33              MOVE      UAVD          FEAVD
     C   33              MOVE      UOPD          FEOPD
     C                   MOVE      ZUSER         FEWS
     C   33              MOVE      FAKUNR        FEKN
     C                   MOVE      FASK          FESKX
     C                   MOVE      SFAKT         FESFAK
     C     FESFAK        IFEQ      'N'
     C     KO2KON        OREQ      'D'
     C                   MOVE      ' '           FESFAK
     C                   END
N56  C                   EXSR      EKUNDE
     C   33              WRITE     FERDR
     C  N33              UPDATE    FERDR
     C  N90FESFAK        COMP      ' '                                    90    *SINGLE
     C  N77FESFAK        COMP      ' '                                7777      *SAMLEFAKT
     C                   END                                                        E3
     C                   MOVE      FAKUNR        GMKUNR
N65  c     NextSKB       tag
     C     HEADFK        READE     FAK4                                   33
     C                   END                                                       E2
     C* INGEN(HVERKEN SINGLE/SAML)->MERK FOR 0-FAKTURA (INGEN UTSKRIFT)
     C     *IN90         IFEQ      '0'                                             B2
     C     *IN77         ANDEQ     '0'
     C                   MOVE      UAVD          FEAVD
     C                   MOVE      UOPD          FEOPD
     C   33              MOVE      ZUSER         FEWS
     C                   MOVE      *ZEROS        FEKN
     C                   MOVE      ' '           FESKX
     C                   MOVE      ' '           FESFAK
N56  C                   EXSR      EKUNDE
     C                   WRITE     FERDR
     C                   END                                                      E2
     C                   ELSE                                                    X1
     C* OPPHEVING - ALLE PARTER FJERNES
     C     HEADFK        SETLL     FERDL01
     C     HEADFK        READE     FERDL01                                33
     C     *IN33         DOWEQ     '0'                                            B2
     C                   DELETE    FERDR
     C     HEADFK        READE     FERDL01                                33
     C                   END                                                      E2
     C                   END                                                     E1
     C                   ENDSR
      *
      ***********************************************
     C     HENTFA        BEGSR
      ***********************************************
     C                   MOVEA     '00'          *IN(81)
     C     *IN88         DOWEQ     '0'
     C                   READC     SUBFIL                                 88
     C  N88WSNR          IFEQ      '2'
     C                   MOVEL     KGENOT        XNOT              4
     C     XNOT          COMP      '*DLT'                                 88
     C   88              GOTO      SLHENT
      *
      *** USK <> ' ' KALLE FRA SYFF10 (ENDRE FAKTURA)
      *
     C     USK           IFNE      ' '
     C   37FASK          COMP      'S'                                8888
     C   38FASK          COMP      'K'                                8888
     C   88              GOTO      SLHENT
     C                   END
     C                   Z-SUB     1             XTOTSG            1 0
     C                   EXSR      TOTSR
     C                   EXSR      MOVFWS
      *
     C                   MOVE      ' '           WSNR
     C                   SETON                                        91
     C                   GOTO      SLHENT
     C                   END
     C  N88WSNR          IFEQ      '4'
     C                   MOVEL     KGENOT        XNOT
     C     XNOT          COMP      '*DLT'                                 88
     C  N88              Z-SUB     1             XTOTSG            1 0
     C  N88              EXSR      TOTSR
     C                   GOTO      SLHENT
     C                   END
     C  N88WSNR          IFEQ      '5'
     C                   MOVEL     KGENOT        XNOT
     C     XNOT          COMP      '*DLT'                                 88
     C                   GOTO      SLHENT
     C                   END
N14  C  N88WSNR          IFEQ      'X'
N14  C                   MOVEL     KGENOT        XNOT
N14  C     XNOT          COMP      '*DLT'                                 88
N14  C     *IN88         IFEQ      '0'
s25  C*                  Z-ADD     FABELV        UAMT             11 2
n25  C                   Z-ADD     FABELN        UAMT             11 2
N25  C                   movel     ficurr        trcur             3
N14  C                   CALL      'GSS101R'
N14  C                   PARM                    UAVD
N14  C                   PARM                    UOPD
N14  C                   PARM                    FAVK
s25  C*                  PARM                    FAVAL
n25  C                   PARM                    trcur
N14  C                   PARM                    UAMT
N14  C                   PARM                    FAKDM
N14  C                   PARM                    UFLAGG
N14  C                   END
N14  C                   GOTO      SLHENT
N14  C                   END
     C  N88WSNR          IFEQ      '9'
     C                   MOVEL     KGENOT        XNOT
     C     XNOT          COMP      '*DLT'                                 88
     C                   GOTO      SLHENT
     C                   END
     C  N88WSNR          IFEQ      'F'
     C                   MOVEL     KGENOT        XNOT
     C     XNOT          COMP      '*DLT'                                 88
     C                   GOTO      SLHENT
     C                   END
     C                   END
      *
     C     SLHENT        ENDSR
      *
      ***********************************************
     C     SØKDTA        BEGSR
      ***********************************************
     C     WSCLOC        DIV       256           LINNBR            3 0
     C                   MVR                     POSNBR            3 0
     C                   Z-ADD     WSSUBN        XRECNO            4 0
      *
     C                   Z-ADD     1             UFLAGG
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     5
     C     POSNBR        ANDLE     7
     C     *IN71         ANDNE     '1'
     C                   CALL      'SYFI10D'
     C                   PARM                    WSVK
     C                   Z-ADD     9             POSNBR
     C                   GOTO      SLSØK
     C                   END
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     30
     C     POSNBR        ANDLE     32
     C                   MOVE      'J'           USØK              1
     C                   CALL      'V200SY'
     C                   PARM                    USØK
     C                   PARM                    WSVAL
     C                   Z-ADD     37            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     62
     C     POSNBR        ANDLE     64
     C                   MOVE      'J'           USØK              1
     C                   CALL      'V200SY'
     C                   PARM                    USØK
     C                   PARM                    WSVALU
     C                   Z-ADD     66            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      21
     C     POSNBR        ANDGE     10
     C     POSNBR        ANDLE     17
     C                   MOVE      *BLANKS       UUSNAV           30
     C                   CALL      'SO1LEV'
     C                   PARM                    WSLEVN
     C                   PARM                    FIFIRM
     C                   PARM                    UUSNAV
     C                   Z-ADD     24            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C     LINNBR        IFEQ      21
     C     POSNBR        ANDGE     40
     C     POSNBR        ANDLE     55
     C                   CALL      'SYFM21'
     C                   PARM      'S'           UTYPE2            1
     C                   PARM                    NN40              4 0
     C                   PARM                    NN50              5 0
     C                   PARM                    NN3               3
     C                   GOTO      SLSØK
     C                   END
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDGE     10
     C     POSNBR        ANDLE     17
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    WSKUNR
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN           30
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDEQ     43
     C                   CALL      'SYFA06A'
     C                   PARM                    WSSAMM
     C                   GOTO      SLSØK
     C                   END
     C* KALKULATOR BELØP
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     13
     C     POSNBR        ANDLE     28
S58  C*                  Z-ADD     WSBELV        UNU132           13 2
N58  C                   Z-ADD     WSBELV        UNU133           13 3
     C                   CALL      'SYGE11'
S58  C*                  PARM                    UNU132
N58  C                   PARM                    UNU133
S58  C*                  Z-ADD     UNU132        WSBELV
N58  C                   Z-ADD(H)  UNU133        WSBELV
     C                   Z-ADD     30            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C*
     C* KALKULATOR BELØP UTLEGG
     C     LINNBR        IFEQ      20
     C     POSNBR        ANDGE     66
     C     POSNBR        ANDLE     79
S58  C*                  Z-ADD     WSBELU        UNU132           13 2
N58  C                   Z-ADD     WSBELU        UNU133           13 3
     C                   CALL      'SYGE11'
S58  C*                  PARM                    UNU132
N58  C                   PARM                    UNU133
S58  C*                  Z-ADD     UNU132        WSBELU
N58  C                   Z-ADD(H)  UNU133        WSBELU
     C                   Z-ADD     10            POSNBR
     C                   Z-ADD     21            LINNBR
     C                   GOTO      SLSØK
     C                   END
     C*
     C* KALKULATOR ANTALL
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDGE     23
     C     POSNBR        ANDLE     27
S58  C*                  Z-ADD     WSANT         UNU132           13 2
N58  C                   Z-ADD     WSANT         UNU133           13 3
     C                   CALL      'SYGE11'
S58  C*                  PARM                    UNU132
N58  C                   PARM                    UNU133
S58  C*                  Z-ADD     UNU132        WSANT
N58  C                   Z-ADD(H)  UNU133        WSANT
     C                   GOTO      SLSØK
     C                   END
     C*
     C*
      *
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
      *
     C     SLSØK         TAG
     C                   MOVEA     '11'          *IN(81)
     C                   EXSR      KDTFMT
     C     ZRECNO        IFEQ      0
     C                   WRITE     NYWRK
     C                   ELSE
     C                   WRITE     SUBCTL
     C                   END
     C                   EXSR      KDTFMT
     C   91              DO
     C     ZRECNO        CHAIN     SUBFIL                             91
     C                   SETON                                        91
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     TESTB1        BEGSR
      ***********************************************
     C     WSVAL         IFEQ      *BLANKS
     C                   MOVE      FICURR        WSVAL
     C                   END
      *
      * SKJEKKER AT IKKE LINJEN ER FAKTURERT I MELLOMTIDEN
      *
     C   91FAKTK         CHAIN(N)  FAKT                               33
     C  N33
     CAN 91FAOPKO        IFGT      'C'
     C                   SETON                                        30
     C                   MOVE      'SHU0683'     MSGNR
     C                   GOTO      SLT1
     C                   END
      *
      *** TEST KODE SK  HVEM BELASTES
      *
     C     WSSK          COMP      ' '                                    98
     C  N98
     CAN 41
     CORN98
     CAN 42
     CORN98
     CAN 46WSSK          COMP      'F'                                    98
     C  N98
     CANN41
     CANN42
     CANN46
     CANN49
     CANN50WSSK          COMP      'A'                                    98
     C  N98
     CANN41
     CANN42
     CANN46
     CANN49
     CANN50WSSK          COMP      'T'                                    98
      *
      *** USK <> ' ' KALLE FRA SYFF10 (ENDRE FAKTURA)
      *
     C  N98USK           IFNE      ' '
     C     USK           ANDNE     'O'
     C     USK           COMP      WSSK                               9898
     C                   END
      *
     C                   MOVE      WSSK          XSK1              1
     C     WSSK          COMP      'S'                                    40
     C  N40WSSK          COMP      'K'                                    40
     C  N40WSSK          COMP      'X'                                    40
     C  N40WSSK          COMP      'A'                                    40
     C  N40WSSK          IFEQ      'I'
N06  c     WSavdr        ifeq      *zeros
N06  c                   move      travd0        WSavdr                         Norm=blst overordnet
N06  c                   endif
     C     KOKEY1        CHAIN     KOAR                               74
     C   74              SETON                                        30
     C   74              MOVE      'SPA0029'     MSGNR
     C   74              GOTO      SLT1
     C  N74              SETON                                        40
     C                   END
     C   40WSBELV        COMP      *ZEROS                                 40
     C     *in40         ifeq      '1'
     C                   EXSR      BFAKT0
     C     WSSK          ifeq      'A'
     C                   z-sub     wsbelv        wsbelv
     C                   end
     C                   end
     C                   MOVE      XSK1          WSSK
     C                   MOVE      'M'           XKDA              1
     C  N40              MOVE      ' '           X01B
      *
     C  N98
     CAN 43WSSK          IFEQ      'F'
     C     HEPK5         COMP      'N'                                    98
     C                   END
     C   98              MOVE      'SPS0020'     MSGNR
     C   98              SETON                                        30
     C   98              GOTO      SLT1
      *
     C     WSSK          IFEQ      'S'
     C     HEKDFS        COMP      'X'                                    98
     C                   END
     C  N98HEKDFK        IFEQ      'X'
     C     WSSK          COMP      'K'                                    98
     C  N98
     CAN 43WSSK          COMP      'F'                                    98
     C                   END
     C  N98
     CAN 41
     CORN98
     CAN 42
     CORN98
     CAN 49
     CORN98
     CAN 50
     CORN98
     CAN 46WSSK          IFEQ      'A'
     C     HEKNA         COMP      0                                      98
     C                   END
     C  N98
     CAN 49
     CORN98
     CAN 50
     CORN98
     CAN 41WSSK          IFEQ      'T'
     C     HEKNT         COMP      0                                      98
     C                   END
     C   98              MOVE      'SPS0021'     MSGNR
     C   98              SETON                                        30
     C   98              GOTO      SLT1
      *
      *** TEST GEBYRKODE
      *
     C     KODGEK        CHAIN     KOGER                              97
     C   97              MOVE      'SPG0002'     MSGNR
     C   97              SETON                                        30
     C   97              GOTO      SLT1
     C                   MOVE      KGEUTL        XKDUL
     C     KODG2K        CHAIN     KOG2R                              33
     C     WSVT          IFNE      *BLANKS
     C                   MOVE      WSVT          KGENOT
     C                   END
N16  C  N97EUKODE        IFNE      ' '
N16  C     EUKEY         CHAIN     KODTG3                             97
N16  C                   setoff                                       97
N16  C                   END
      *
      *** TEST VALUTAKODE
      *
     C     WSVAL         IFEQ      *BLANKS
     C                   MOVE      FICURR        WSVAL
     C                   ELSE
     C     VALU1K        CHAIN     VALUL01                            96
     C   96              MOVE      'SPV0001'     MSGNR
     C   96              SETON                                        30
     C   96              GOTO      SLT1
     C                   END
      *
      *** TASTET FAKTURA LINJE ER GODKJENT NÅ
      *
     C     WSANT         IFNE      0
     C     WSBELV        ANDNE     *ZEROS
n46  c                   move      wsant         wsantd            2 0
n46  c                   movel     wsant         wsanth            3 0
n46  c                   move      wsbelv        wsbeld            2 0
n46  c                   movel     wsbelv        wsbelh           11 0
N46  C     WSVT          IFEQ      *BLANKS
N46  C     KODGEK        CHAIN     KODTG4                             33
N46  c                   move      *blanks       enh
N46  C     SPRAAK        IFEQ      ' '
N46  C                   Movel     'Stk'         enh               7
N46  C  N33Kgenhn        ifne      *blanks
N46  c                   move      kgenhn        enh
n46  c                   end
n46  c                   end
N46  C     SPRAAK        IFEQ      'E'
N46  C                   Movel     'Pcs'         enh
N46  C  n33Kgenhe        ifne      *blanks
N46  c                   move      kgenhe        enh
n46  c                   end
n46  c                   end
N46  C     SPRAAK        IFEQ      'T'
N46  C                   Movel     'Anz'         enh
N46  C  N33Kgenht        ifne      *blanks
N46  c                   move      kgenht        enh
n46  c                   end
n46  c                   end
N46  c     wsbeld        ifne      0
N46  C     WSANTD        IFNE      0
N46  C                   EVAL      WSVT = %trim(WSVT )
N46  C                             +  %trim(%editc(WSANT:'4'))
N46  C                             +  ' '
N46  C                             +  %trim( enh )
N46  C                             +  ' a '
N46  C                             + %trim(%editc(WSBELV:'4'))
N46  C                   ELSE
N46  C                   EVAL      WSVT = %trim(WSVT )
N46  C                             +  %trim(%editc(WSANTH:'Z'))
N46  C                             +  ' '
N46  C                             +  %trim( enh )
N46  C                             +  ' a '
N46  C                             + %trim(%editc(WSBELV:'4'))
N46  C                   END
N46  c                   else
N46  C     WSANTD        IFNE      0
N46  C                   EVAL      WSVT = %trim(WSVT )
N46  C                             +  %trim(%editc(WSANT:'4'))
N46  C                             +  ' '
N46  C                             +  %trim( enh )
N46  C                             +  ' a '
N46  C                             + %trim(%editc(WSBELH:'4'))
N46  C                   ELSE
N46  C                   EVAL      WSVT = %trim(WSVT )
N46  C                             +  %trim(%editc(WSANTH:'Z'))
N46  C                             +  ' '
N46  C                             +  %trim( enh )
N46  C                             +  ' a '
N46  C                             + %trim(%editc(WSBELH:'Z'))
N46  c                   end
N46  c                   end
N46  C                   eval      kgenot=wsvt
N46  C                   END
     C                   MULT      WSANT         WSBELV
     C                   MOVE      *ZEROS        WSANT
     C                   END
     C                   EXSR      VALUT2
     C                   Z-ADD     1             XTOTSG
      *
      *** START ENDRING FOR <SPLITT>     23/11-89
      *** TEST MOMS
      *
     C     WSSK          IFNE      'I'                                          1<-B
     C     WSKDM         IFEQ      ' '                                           2<-B
     C     KGEKON        IFEQ      99999                                          3<-B
     C                   MOVE      'N'           WSKDM
     C                   ELSE                                                     3
     C     KG2KON        IFEQ      99999                                           4<-B
     C                   MOVE      'J'           WSKDM
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   else                                                    1
      * ved I-linjer legges N ved blankd
     c     wskdm         ifeq      ' '
     c                   move      'N'           wskdm
     c                   end
     C                   END                                                    1<-E
      *** TEST MOMSKODE
      *
     C     WSKDM         IFNE      'J'
     C     WSKDM         ANDNE     'N'
     C*    WSKDM         ANDNE     ' '
     C     KODWKY        CHAIN     KODWL01                            95                    4
     C   95              MOVE      'TRO0512'     MSGNR
     C   95              SETON                                        30
     C   95              GOTO      SLT1
     C                   END
      *
      ***
     C     WSKDM         IFEQ      'J'                                           1<-B
     C     KGEKON        IFEQ      99999                                          2<-B
     C                   SETON                                        9530
     C                   END                                                      2<-E
     C                   ELSE                                                    1
      *
     C     WSKDM         IFEQ      'N'                                            2<-B
     C     KG2KON        IFEQ      99999                                           3<-B
     C                   SETON                                        9530
     C                   END                                                       3<-E
     C                   ELSE                                                     2
     C                   END                                                      2<-E
      *
     C                   END                                                     1<-E
     C   95              MOVE      'SPM0004'     MSGNR
     C   95              GOTO      SLT1
      *
      *** SPLITT ?
      * TESTER LEVERANDØR
      * (HVIS TASTET OG SPLITTKODE KAN LEV.AVTALE HENTES VIA KUNDNR.)
     C                   MOVE      *ZEROS        KUNDNR
     C     WSLEVN        IFNE      *ZEROS
     C     LEVE1K        CHAIN     LEVEL01                            92
     C  N92AKTKOD        COMP      'A'                                9292
     C   92              SETON                                        30
     C   92              MOVE      'SPM0007'     MSGNR
     C   92              GOTO      SLT1
     C                   END
      * Aldri KRAV om budsj. av frakt på oppdragsnivå i tr-modul
     C     KG2XXX        IFEQ      'B'
     C     HEUR          ANDEQ     'H'
     C     WSVK          ANDEQ     'FRA'
     C                   MOVE      ' '           KG2XXX
     C                   END
      * Evt manuelt tastet B for budsjett skal overstyre verdi på fila
     C     WSKDUK        IFEQ      'B'                                          1B
     C                   MOVE      'B'           KG2XXX
     C                   END                                                    1E
      *
     C     KG2XXX        IFEQ      'J'                                          1<-B
     C     WSKDUK        IFNE      'N'                                           2<-B
     C                   MOVE      'S'           WSKDUK
     C     WSLEVN        COMP      *ZEROS                                 92
      * FINNES AVTALE MED LEVERANDØREN(VIA KUNDENR)?
     C     WSBELU        IFEQ      *ZEROS
     C     KUNDNR        ANDNE     *ZEROS
     C                   EXSR      BFAKLE
     C                   END                                                        6E
     C     WSBELU        IFEQ      0                                              3<-B
     C     KG2PRO        ANDGT     0
     C     KG2PRO        IFEQ      0.0001                                       ALT TIL BUDSJ-POST
     C                   MOVE      *ZEROS        KG2PRO
     C                   END
     C     XBELN         MULT(H)   KG2PRO        WSBELU
     C     XBELN         SUB       WSBELU        WSBELU
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C                   MOVE      *ZEROS        WSBELU
     C                   END                                                     2<-E
     C                   ELSE                                                   1
     C     KG2XXX        IFEQ      'H'                                           2B
     C     WSKDUK        IFNE      'N'                                            3B
     C                   MOVE      'H'           WSKDUK
     C     WSBELU        IFEQ      *ZEROS                                          4B
     C                   Z-ADD     XBELN         WSBELU
     C                   END                                                       4E
      *
     C                   ELSE                                                     3
     C                   MOVE      *ZEROS        WSBELU
      *
     C                   END                                                      3E
     C                   ELSE                                                    2
      *
     C     KG2XXX        IFEQ      'L'                                            3B
     C     WSKDUK        IFNE      'N'                                             4B
     C                   MOVE      'L'           WSKDUK
     C     WSLEVN        COMP      *ZEROS                                 92
      * FINNES AVTALE MED LEVERANDØREN(VIA KUNDENR)?
     C     WSBELU        IFEQ      *ZEROS
     C     KUNDNR        ANDNE     *ZEROS
     C                   EXSR      BFAKLE
     C                   END                                                        6E
     C     WSBELU        IFEQ      *ZEROS                                           5B
     C     KG2PRO        ANDGT     0
     C     KG2PRO        IFEQ      0.0001                                       ALT TIL BUDSJ-POST
     C                   MOVE      *ZEROS        KG2PRO
     C                   END
     C     XBELN         MULT(H)   KG2PRO        WSBELU
     C     XBELN         SUB       WSBELU        WSBELU
     C                   END                                                        5E
     C                   ELSE                                                      4
     C                   MOVE      *ZEROS        WSBELU
     C                   END                                                       4E
     C                   ELSE                                                     3
      *
      *
     C     KG2XXX        IFEQ      'B'                                            4B
     C     WSKDUK        IFNE      'N'                                             5B
     C                   MOVE      'B'           WSKDUK
     C     WSLEVN        COMP      *ZEROS                                 92
      * FINNES AVTALE MED LEVERANDØREN(VIA KUNDENR)?
     C     WSBELU        IFEQ      *ZEROS
     C     KUNDNR        ANDNE     *ZEROS
     C                   EXSR      BFAKLE
     C                   END                                                        6E
     C     WSBELU        IFEQ      *ZEROS                                           6B
     C     KG2PRO        ANDGT     0
     C     KG2PRO        IFEQ      0.0001                                       ALT TIL BUDSJ-POST
     C                   MOVE      *ZEROS        KG2PRO
     C                   END
     C     XBELN         MULT(H)   KG2PRO        WSBELU
     C     XBELN         SUB       WSBELU        WSBELU
     C                   END                                                        6E
     C                   ELSE                                                      5
     C                   MOVE      *ZEROS        WSBELU
     C                   END                                                       5E
     C                   ELSE                                                     4
      *
N23  c     wskduk        ifne      'N'
     C                   MOVE      *BLANKS       WSKDUK
N23  c                   end
     C                   MOVE      *ZEROS        WSBELU
     C                   END                                                      4E
     C                   END                                                      3E
     C                   END                                                     2E
      *
     C                   END                                                    1E
      * VED SPLITT/HOV.B./LEV. MÅ WSBELU FINNES /IKKE STØRRE ENN XBELN
      *
      *
     C     WSKDUK        IFNE      ' '
     C     WSKDUK        ANDNE     'N'
      *
      *** TEST VALUTAKODE UTLEGG
      *
     C     WSVALU        IFEQ      *BLANKS
     C                   MOVE      WSVAL         WSVALU
     C                   ELSE
     C     VALUUK        CHAIN     VALUL01                            72
     C   72              MOVE      'SPV0001'     MSGNR
     C   72              SETON                                        30
     C   72              GOTO      SLT1
     C                   END
      *
      * BUDSJETT IKKE LAGT INN
      *
     C     XBELN         IFGT      *ZEROS
     C     WSBELU        COMP      *ZEROS                               9393
     C   93              SETON                                        30
     C   93              MOVE      'JOV0375'     MSGNR
     C   93              GOTO      SLT1
      *
      *
     C                   Z-ADD     WSBELU        XBELU
     C     WSVALU        IFNE      FICURR
     C     WSBELU        MULT      VALKU1        XWORK
     C     XWORK         DIV(H)    OMRFAK        XBELU
     C                   END
      *INNTEKT MINDRE ENN BUDSJETTERT UTGIFT
     C     XBELU         COMP      XBELN                              93
     C   93              MOVE      'JOV0845'     MSGNR
      * FORSKJELLIG VALUTAKODE PÅ INNTEKT/BUDSJETTERT UTGIFT
     C     *IN93         IFEQ      '0'
     C     WSVAL         COMP      WSVALU                             9393
     C                   MOVE      'SHU0823'     MSGNR
     C                   END
     C                   END
      *
      * SLÅ AV FEILINDIKATOR VED F23
      *
     C     *IN93         IFEQ      '1'
     C     *IN23         ANDEQ     '1'
     C                   MOVE      '0'           *IN93
     C                   END
      *
     C   93              SETON                                        30
     C   93              GOTO      SLT1
     C                   END
      *
      *
      * LEVERANDØR MÅ GIS DERSOM "L"-GEBYR
      *
     C     WSKDUK        IFEQ      'L'
     C     WSLEVN        COMP      *ZEROS                                 92
     C   92              SETON                                        30
     C   92              MOVE      'SPM0007'     MSGNR
     C   92              GOTO      SLT1
     C                   END
      *
      * TESTER KUNDE
      *
     C     WSKUNR        IFNE      *ZEROS
     C     KUND1K        CHAIN(N)  CUNDL01                            73
     C  N73AKTKOD        COMP      'A'                                7373
     C   73              MOVE      'SPK0052'     MSGNR
     C  N73              EXSR      LIKTST
     C   73              SETON                                        30
     C   73              GOTO      SLT1
     C                   END
      *
      * LEVERANDØR MÅ GIS DERSOM "L"-GEBYR
      *
     C     WSSK          IFEQ      'X'
     C     WSKUNR        COMP      *ZEROS                                 73
     C   73              SETON                                        30
     C   73              MOVE      'SPK0052'     MSGNR
     C   73              GOTO      SLT1
     C                   END
      *
      *
     C   41
     COR 42
N11  COR 43
N26  COR 44
     COR 49
     COR 50
     COR 46WSKOM         IFLT      0
     C     WSKOM         ORGT      3
     C                   SETON                                        9430
      *
     C*                    MOVE 'SPK0021' MSGNR
     C                   MOVE      'SPK0034'     MSGNR
      *
     C                   END
      *
     C     WSSK          IFEQ      'I'
     C     KOKEY1        CHAIN     KOAR                               74
     C   74              SETON                                        30
     C   74              MOVE      'SPA0029'     MSGNR
     C     *IN74         IFEQ      *OFF
     C     WSIOPD        ANDNE     *ZEROS
     C     HEADIK        CHAIN(N)  HEADF                              74
     C   74              SETON                                        30
     C   74              MOVE      'JOV1465'     MSGNR
     C     HEADFK        CHAIN(N)  HEADF                              33
     C                   END
     C                   ELSE
     C     WSAVDR        COMP      *ZEROS                             74
     C   74              SETON                                        30
     C   74              MOVE      'SPA0030'     MSGNR
     C                   END
      *
      * TESTER SAMMENSLÅINGSKODE
      *
     C  N30WSSAMM        IFNE      ' '
     C     WSSAMM        CHAIN     KODSAM                             30
     C   30              MOVE      'SHU0309'     MSGNR
     C                   END
      *
     C  N30WSSK          IFEQ      'K'
     C     WSSK          OREQ      'S'
     C     WSSK          OREQ      'X'
     C     XBELN         IFGT      0
     C                   EXSR      KGSR
     C                   END
     C                   END
     C     SLT1          TAG
      *
      * X-part - lagre i fri søkevei
     C     *IN30         ifeq      '0 '
     C     WSSK          andeq     'X'
     C                   MOVE      HEAVD         FSAVD
     C                   MOVE      HEOPD         FSOPD
     C                   MOVE      'XPA'         FSKODE
     C                   eval      FSSOK = %triml(%editc(WSKUNR:'Z'))+' '+KNAVN
     C     FRIKEY        CHAIN     FRISOK                             33
     C   33              MOVE      HEDTOP        FSDTOP
     C   33              WRITE     FRISOKR
     C                   END
      *
     C   30              DO
     C*
     C* START LINJENUMMER
     C*
     C   73
     COR 94              Z-ADD     22            LINNBR
     C   74
N46  COR 93
     COR 92              Z-ADD     21            LINNBR
S46  C*  93
S46  C*R 72
N46  C   72
     COR 95
     COR 96
     COR 97
     COR 98              Z-ADD     20            LINNBR
      *
      * START POSISJONERING
      *
     C   73
     COR 92              Z-ADD     10            POSNBR
     C   74              Z-ADD     40            POSNBR
     C   72              Z-ADD     62            POSNBR
     C   93              Z-ADD     66            POSNBR
     C   94              Z-ADD     22            POSNBR
     C   95              Z-ADD     37            POSNBR
     C   96              Z-ADD     30            POSNBR
     C   97              Z-ADD     5             POSNBR
     C   98              Z-ADD     2             POSNBR
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     DELFAK        BEGSR
     C***********************************************
     C                   EXSR      TEKUAV
     C                   SETOFF                                       3340
     C     XWEBKALK      CABEQ     'J'           SLDELF
     C     FAK4K         SETLL     FAK4
     C                   MOVE      *ZEROS        WSTOTS
     C                   MOVE      *ZEROS        WSTOTK
     C     STDELF        TAG
     C     HEADFK        READE     FAK4                                   33
     C   33              GOTO      SLDELF
     C     FAOPKO        IFNE      ' '
     C                   GOTO      STDELF
     C                   END
      *
     C     FAKTK         CHAIN     FAKT                               32
     C   32              GOTO      STDELF
     C     FAOPKO        IFGT      'C'
      *
      * ikke slett 0 linjen som er frakt fra transportdisponering
      *
     c     fali          oreq      0
     C                   UPDATE    FAKTR
     C                   GOTO      STDELF
     C                   END
      *
      * ikke slett frakttillegg fra ordrebildet transportdisponering
      *
     c     heur          ifeq      'H'
     c     hevalt        andeq     favk
     C                   UPDATE    FAKTR
     C                   GOTO      STDELF
     C                   END
      *
     C     FAKDA         COMP      'A'                                3232
     C   32FAKDA         COMP      'B'                                3232
     C   32FAKDA         COMP      ' '                                3232
     C   32HEKDFS        IFEQ      'X'
     C     FASK          COMP      'S'                                3232
     C                   END
     C   32HEKDFK        IFEQ      'X'
     C     FASK          COMP      'K'                                3232
     C                   END
      *
     C   32              EXSR      UPFAK
     C  N32              DELETE    FAKTR
     C  N32              EXSR      DLTFTXT
     C  N32
     CANN35              EXSR      MSALDO                                       TREKK SALDO
      *
      * SLETT OGSÅ EVT. BUDSJETTERT KOSTNAD
      *
     C  N32FAJOUR        IFNE      *ZEROS
     C     FAJOUR        CHAIN     KOSBU                              32
     C  N32              DELETE    KOSBUR
     C                   SETOFF                                       32
     C                   END
      *  32                MOVE FASK      WSSK
     C                   GOTO      STDELF
      *
     C     SLDELF        TAG
     C                   EXSR      BFAKT0
      *
     C     HEUR          IFEQ      'H'
     C                   MOVE      *ZEROS        FALI
     C     FAKTK         CHAIN(N)  FAKT                               33
     C     *IN33         IFEQ      '0'
      *selger kjøper byttet på oppdrag
     C     FASK          ifeq      'S'
     c     heknsf        andeq     0
     C                   goto      utv
     C                   end
     C     FASK          ifeq      'K'
     c     heknkf        andeq     0
     C                   goto      utv
     C                   end
     C     TRFRAK        ifne      'N'
     C                   EXSR      VEISR
     c                   end
     C                   END
     C                   END
     C     utv           tag
     C     KO2UTL        IFNE      'N'
     C                   EXSR      UTLSR
     C                   END
N09  C     hevalt        ifne      *blanks
N09  C     hevalp        andne     *zeros
N09  C                   exsr      REGTIL
N09  C                   end
      *
N44  C     heur          ifeq      'H'
N44  C                   CALL      'SYFA10T'
N44  c                   parm                    uavd
N44  c                   parm                    uopd
N44  c                   end
      *
N61  C                   Z-ADD     HEFBV         XINT
N60  c     keygenge      chain     prik1                              33
N60  C     *in33         ifeq      '0'
N60  C                   CALL      'SYFA10XG'
N60  c                   parm                    uavd
N60  c                   parm                    uopd
N60  c                   parm                    xint
N60  c                   end
     C                   ENDSR
      *
      ***********************************************
     C     KGSR          BEGSR
      ***********************************************
      *
      * SUBRUTINE FOR KREDITGRENSE-TESTING
      *
     C     UUKUKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    UUKUNR
      *
     C     WSSK          IFEQ      'X'
     C                   MOVE      WSKUNR        UUKUNR            8 0
     C                   END
     C     WSSK          IFEQ      'K'
     C                   MOVE      HEKNKF        UUKUNR
     C     UUKUKE        CHAIN(N)  CUNDL01                            33
     C                   END
     C     WSSK          IFEQ      'S'
     C                   MOVE      HEKNSF        UUKUNR
     C     UUKUKE        CHAIN(N)  CUNDL01                            33
     C                   END
     C     KGRENS        IFGT      0
     C     KGRENS        MULT      1000          XKOVER           13 2
     C                   CALL      'SYGE07CL'
     C                   PARM                    FIFIRM
     C                   PARM                    UUKUNR
     C                   PARM                    KSALDO           13 2
      * VED ENDRING TREKKE GAMMEL BELØP FRA UFAKTURERT SALDO
     C     FAKUNR        IFNE      0
     C     FAKUNR        ANDEQ     WSKUNR
     C                   SUB       FABELN        KSALDO
     C                   END
     C                   ADD       XBELN         KSALDO
     C     KSALDO        COMP      XKOVER                             30
     C   30              SETON                                        98
     C   30              MOVE      'SHU0311'     MSGNR
     C                   END
     C                   ENDSR
      *
     C***********************************************
     C     LIKTST        BEGSR
     C***********************************************
      *
      *** TEST LIKVIDITETSKODE/STOPPEKODE
      *
     C     SYLIKV        IFNE      ' '
     C     KODLIK        KLIST
     C                   KFLD                    KLIUNI
     C                   KFLD                    SYLIKV
     C                   MOVE      'LIKO'        KLIUNI
     C     KODLIK        CHAIN     KOLIKR                             33
     C     *IN33         IFEQ      '0'
     C                   MOVE      'DIV0608'     XMSGNR
     C                   Z-ADD     3             XLEVEL            1 0
     C                   Z-ADD     0             XRETUR            1 0
     C                   Z-ADD     62            XMSGL             4 0
     C                   CALL      'SUBR23R3'
     C                   PARM                    XMSGNR
     C                   PARM                    UMSG             62
     C                   PARM                    XLEVEL
     C                   PARM                    XRETUR
     C                   PARM                    XMSGL
     C                   MOVE      UMSG          XMSG2
     C                   MOVE      WSKUNR        XKN
     C                   MOVE      SYLIKV        XLIKV
     C                   MOVE      KLINAV        XLINAV
     C                   MOVE      XMSG2         UMSG
     C                   END
     C     KLISTO        COMP      'J'                                    73
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     KUNFRA        BEGSR
      ***********************************************
     C                   MOVE      'K'           XSK
     C     FAK4K         SETLL     FAK4
     C                   MOVE      *ZEROS        UKFRA
     C                   SETOFF                                       33
     C     STKFRA        TAG
     C     FAK4K         READE     FAK4                                   33
     C   33              GOTO      SLKFRA
      * Test om faktura mottagersnr. i oppdrag er endret.
      * I så fall endres det også på fakturalinjer og oppdateres
      * kredittgrense på kunderegister.
     C                   EXSR      TSTKN
      *
     C  N42
     CANN44
     CANN50              DO
     C                   MOVE      FAVK          WSVK
     C     KODGEK        CHAIN     KOGER                              32
     C   32              MOVE      ' '           XKDUL
     C  N32              MOVE      KGEUTL        XKDUL
     C  N32KGESAD        IFEQ      'J'
     C                   ADD       FABELN        UKFRA
     C                   END
     C                   END
     C   42KGETYP        IFEQ      'FRA'
     C                   ADD       FABELN        UKFRA
     C                   END
     C   44FAVK          IFEQ      'FFE'
     C                   ADD       FABELN        UKFRA
     C                   END
     C   50KGETYP        IFEQ      'SEA'
     C                   ADD       FABELN        UKFRA
     C                   END
     C                   GOTO      STKFRA
      *
     C     SLKFRA        TAG
     C                   MOVE      ' '           XSK
      *
     C     HEADFK        CHAIN     HEADF                              33
     C  N33              MOVE      UKFRA         HEFBK
s55  C* N33              MOVE      ' '           HEST
     C  N33              UPDATE    HEADFR
     C                   ENDSR
      *
      ***********************************************
     C     FRAPROSR      BEGSR
      ***********************************************
     C                   MOVE      FAVK          GMVK              3
     C                   MOVE      FAKDA         GMKDA             1
     C                   MOVE      WSSK          XSK
     C     FAK4K         SETLL     FAK4
     C                   MOVE      *ZEROS        SUMFRA           11 2
     C                   SETOFF                                       33
     C     *IN33         DOWEQ     '0'
     C     FAK4K         READE     FAK4                                   33
     C     *IN33         IFEQ      '0'
     C                   MOVE      FAVK          WSVK
     C     KODGEK        CHAIN     KOGER                              32
     C  N32KGETYP        IFEQ      'FRA'
     C                   ADD       FABELN        SUMFRA
     C                   END
     C                   END
     C                   END
     C                   MOVE      GMVK          FAVK
     C                   MOVE      GMKDA         FAKDA
     C                   ENDSR
      *
      ***********************************************
     C     TSTKN         BEGSR
      ***********************************************
     C     FASK          IFEQ      'S'
     C     FAKUNR        ANDNE     HEKNSF
     C                   EXSR      MSALDO
     C     FAKTK         CHAIN     FAKT                               32
     C  N32              MOVE      HEKNSF        FAKUNR
     C  N32              EXCEPT    NYKN
     C  N32              EXSR      PSALDO
     C                   END
     C     FASK          IFEQ      'K'
     C     FAKUNR        ANDNE     HEKNKF
     C                   EXSR      MSALDO
     C     FAKTK         CHAIN     FAKT                               32
     C  N32              MOVE      HEKNKF        FAKUNR
     C  N32              EXCEPT    NYKN
     C  N32              EXSR      PSALDO
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     SUMBL         BEGSR
      ***********************************************
     C                   MOVE      *ZEROS        WSUTLS
     C                   MOVE      *ZEROS        WSUTLK
     C                   MOVE      *ZEROS        WSTOTS
     C                   MOVE      *ZEROS        WSTOTK
      *
     C     STSUMB        TAG
     C                   SETOFF                                       33
     C     HEADFK        READE     FAK4                                   33
     C   33FAK4K         SETLL     FAK4
     C   33              GOTO      SLSUMB
     C                   MOVE      FAVK          WSVK
     C     KODGEK        CHAIN     KOGER                              32
     C   32              MOVE      ' '           XKDUL
     C  N32              MOVE      KGEUTL        XKDUL
     C  N32FAVT          IFNE      *BLANKS
     C                   MOVE      FAVT          KGENOT
     C                   END
      *
     C                   Z-ADD     1             XTOTSG
     C                   MOVE      FASK          WSSK
     C                   EXSR      TOTSR
     C                   GOTO      STSUMB
      *
     C     SLSUMB        TAG
     C                   MOVE      *BLANKS       WSSK
     C                   MOVE      *BLANKS       WSVK
      *
     C                   ENDSR
      *
      ***********************************************
     C     TOTSR         BEGSR
      ***********************************************
     C     FABELN        MULT      XTOTSG        XBELN            13 2
     C     FASK          IFEQ      'S'
     C                   ADD       XBELN         WSTOTS
     C     FAKDUL        IFEQ      'J'
     C                   ADD       XBELN         WSUTLS
     C                   END
     C                   END
      *
     C     FASK          IFEQ      'K'
     C                   ADD       XBELN         WSTOTK
     C     FAKDUL        IFEQ      'J'
     C                   ADD       XBELN         WSUTLK
     C                   END
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     UTLSR         BEGSR
      ***********************************************
     C                   MOVE      *BLANKS       KGETYP
     C                   MOVE      *BLANKS       WSSAMM
     C                   MOVE      *BLANKS       PKSAMM
      *TOTALT OMSKREVET
     C* 91 OFF= Nytt linjenr i MOVWSF
     C                   MOVE      *OFF          *IN91
     C                   MOVE      'J'           XKMOMS            1
     C                   MOVE      'N'           XSMOMS            1
     C                   MOVE      'J'           XXMOMS            1
      *
     C     KO2MVK        IFNE      ' '
     C                   MOVE      KO2MVK        XKMOMS
     C                   END
      *
     C     KO2MVS        IFNE      ' '
     C                   MOVE      KO2MVS        XSMOMS
     C                   END
      *
      *
      * NULLSTILLER UTLEGGSGRUNNLAGENE
      *
     C                   MOVE      *ZEROS        WSUTLS
     C                   MOVE      *ZEROS        WSUTLK
     C                   MOVE      *ZEROS        WSUTLX           10 2
     C     FAK4K         SETLL     FAK4
     C                   SETOFF                                       33
      *
      * RUTINE FOR Å SLETTE UTL-POSTER
      *
     C                   MOVE      'N'           UTLSMA            1
     C                   MOVE      'N'           UTLKMA            1
     C                   MOVE      'N'           UTLXMA            1
     C     STUTL1        TAG
     C     HEADFK        READE     FAK4                                   33
     C   33              GOTO      KJØUTL
      *
      *
      *
     C     FAVK          IFEQ      'UTL'                                        1<-B
      *
     C     FAKTK         CHAIN     FAKT                               32
     C     FAOPKO        IFGT      'C'
     C                   UPDATE    FAKTR
     C                   GOTO      STUTL1
     C                   END
     C     FAKDA         IFEQ      'E'
     C     FAKDA         OREQ      'M'
     C                   SELECT
     C     FASK          WHENEQ    'S'
     C                   MOVE      'J'           UTLSMA
     C     FASK          WHENEQ    'K'
     C                   MOVE      'J'           UTLKMA
     C     FASK          WHENEQ    'X'
     C                   MOVE      'J'           UTLXMA
     C                   ENDSL
     C                   UPDATE    FAKTR
     C                   GOTO      STUTL1
     C                   END
     C  N32              DELETE    FAKTR
     C  N32              EXSR      DLTFTXT
     C  N32
     CANN35              EXSR      MSALDO                                       TREKK SALDO
      *
      *
      * TAR VARE PÅ MOMSKODE PÅ DEN AKTUELLE SIDE
      *
      *
     C  N32FASK          IFEQ      'K'                                           2<-B
     C                   MOVE      FAKDM         XKMOMS
     C                   ELSE                                                    2
     C     FASK          IFEQ      'S'                                            3<-B
     C                   MOVE      FAKDM         XSMOMS
     C                   ELSE                                                    2
     C     FASK          IFEQ      'X'                                            3<-B
     C                   MOVE      FAKDM         XXMOMS
     C                   END                                                      3<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   GOTO      STUTL1
     C                   END                                                    1<-E
      *
      * SLUTT PÅ LEST LINJE MED KODE 'UTL'
      *
      *
      * FAKDUL = J SKAL VÆRE MED I GRUNNLAG
      *
     C     FAKDUL        IFEQ      'J'                                          1<-B
     C     FASK          IFEQ      'S'                                           2<-B
     C                   ADD       FABELN        WSUTLS
     C                   ELSE                                                    2
     C     FASK          IFEQ      'K'                                            3<-B
     C                   ADD       FABELN        WSUTLK
     C                   END                                                      3<-E
     C     FASK          IFEQ      'X'                                            3<-B
     C                   ADD       FABELN        WSUTLX
     C                   MOVE      FAKUNR        XXXKUN            8 0
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C                   GOTO      STUTL1
      *
      * FØRST KJØPERSIDEN  'K'
      *
      *
     C     KJØUTL        TAG
      *
      * HVIS GRUNNLAG ER NULL HOPPES OVER
      * ELLER MANUELL/ENTET LINJE FINNE
     C     WSUTLK        IFEQ      *ZEROS
     C     UTLKMA        OREQ      'J'
     C                   GOTO      SELUTL
     C                   END
      *
      * INITIERER FELTER HENTER VERDI FRA KUNDE
      *
     C                   MOVE      HEKNKF        WSKUNR
     C     KUND1K        CHAIN(N)  CUNDL01                            33
      *
     C     SYUTLP        IFEQ      99.99
     C     AVUTPR        OREQ      99.99
     C                   GOTO      SELUTL
     C                   END
      *
      * FINNER AKTUELL SATS
      *
     C                   Z-ADD     FIUPS         UPROSE            4 2
     C                   Z-ADD     FIUPMN        UMINIM            4 0
     C     SYUTLP        IFNE      0
     C                   Z-ADD     SYUTLP        UPROSE
     C                   END
     C     SYMINU        IFNE      *ZEROS
     C                   Z-ADD     SYMINU        UMINIM
     C                   END
      *
      *
     C                   MOVE      *BLANKS       X01B
     C                   MOVE      *BLANKS       WSKDUK
     C                   MOVE      *ZEROS        WSBELU
     C                   MOVE      'K'           WSSK
     C                   MOVE      'UTL'         WSVK
     C                   MOVE      *ZEROS        WSAGRN            9 0
     C                   MOVE      *BLANKS       WSVT
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      ' '           WSKDUK
     C                   MOVE      *ZEROS        WSBELU
     C     WSUTLK        MULT      UPROSE        WSBELV
     C     WSBELV        DIV(H)    100           XBEL11           11 0
     C                   Z-ADD     XBEL11        WSBELV
     C                   Z-ADD     WSBELV        XBELN
      *
      *
      *
      * BELØP MINDRE ENN MINIMUM VED POSITIV
      *
     C     WSUTLK        IFGT      *ZEROS
     C     XBELN         IFLT      UMINIM                                          4<-B
     C                   Z-ADD     UMINIM        XBELN
     C                   Z-ADD     UMINIM        WSBELV
     C                   END                                                       4<-E
     C                   ELSE                                                     3
      *
      * BELØP STØRRE ENN MINIMUM VED NEGATIV
      *
     C                   Z-SUB     UMINIM        UMINIM
     C     XBELN         IFGT      UMINIM                                          4<-B
     C                   Z-ADD     UMINIM        XBELN
     C                   Z-ADD     UMINIM        WSBELV
     C                   END                                                       4<-E
     C                   Z-SUB     UMINIM        UMINIM
     C                   END                                                      3<-E
      *
     C                   MOVE      XKMOMS        WSKDM
     C   46
     COR 47
     COR 48              MOVE      TRMVA         WSKDM
     C                   MOVE      ' '           XKDUL             1
      *
      *
     C                   EXSR      MOVWSF
     C                   EXSR      VALUTA
     C     SYUTLP        IFEQ      *ZEROS                                        2<-B
     C                   MOVE      'B'           XKDA
     C                   ELSE                                                    2
     C                   MOVE      'A'           XKDA
     C                   END                                                     2<-E
     C                   MOVE      XKDA          FAKDA
     C                   EXSR      NYFAK
      *
      *
      * UTLEGGSPROVISJON PÅ SELGERSIDEN
      *
     C     SELUTL        TAG
      *
      *
      * HVIS GRUNNLAG ER NULL HOPPES OVER
      *
     C     WSUTLS        IFEQ      *ZEROS
     C     UTLSMA        OREQ      'J'
     C                   GOTO      FRIUTL
     C                   END
      *
      * INITIERER FELTER HENTER VERDI FRA KUNDE
      *
     C                   MOVE      HEKNSF        WSKUNR
     C     KUND1K        CHAIN(N)  CUNDL01                            33
      *
     C     SYUTLP        IFEQ      99.99
     C     AVUTPR        OREQ      99.99
     C                   GOTO      FRIUTL
     C                   END
      *
      * FINNER AKTUELL SATS
      *
     C                   Z-ADD     FIUPS         UPROSE            4 2
     C                   Z-ADD     FIUPMN        UMINIM            4 0
     C     SYUTLP        IFNE      0
     C                   Z-ADD     SYUTLP        UPROSE
     C                   END
     C     SYMINU        IFNE      *ZEROS
     C                   Z-ADD     SYMINU        UMINIM
     C                   END
     C                   MOVE      'S'           WSSK
     C                   MOVE      'UTL'         WSVK
     C                   MOVE      *BLANKS       WSVT
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      ' '           WSKDUK
     C                   MOVE      *ZEROS        WSBELU
     C     WSUTLS        MULT      UPROSE        WSBELV
     C     WSBELV        DIV(H)    100           XBEL11           11 0
     C                   Z-ADD     XBEL11        WSBELV
     C                   Z-ADD     WSBELV        XBELN
      *
     C     WSUTLS        IFGT      0                                              3<-B
     C     XBELN         IFLT      UMINIM                                          4<-B
     C                   Z-ADD     UMINIM        XBELN
     C                   Z-ADD     UMINIM        WSBELV
     C                   END                                                       4<-E
     C                   ELSE                                                     3
     C                   Z-SUB     UMINIM        UMINIM
     C     XBELN         IFGT      UMINIM                                          4<-B
     C                   Z-ADD     UMINIM        XBELN
     C                   Z-ADD     UMINIM        WSBELV
     C                   END                                                       4<-E
     C                   Z-SUB     UMINIM        UMINIM
     C                   END                                                      3<-E
      *
     C                   MOVE      XSMOMS        WSKDM
     C   46
     COR 47
     COR 48              MOVE      TRMVA         WSKDM
     C                   MOVE      ' '           XKDUL             1
      *
      *
     C                   EXSR      MOVWSF
     C                   EXSR      VALUTA
     C     SYUTLP        IFEQ      *ZEROS                                        2<-B
     C                   MOVE      'B'           XKDA
     C                   ELSE                                                    2
     C                   MOVE      'A'           XKDA
     C                   END                                                     2<-E
     C                   MOVE      XKDA          FAKDA
     C                   EXSR      NYFAK
      *
      *
      *
      * UTLEGGSPROVISJON PÅ FRIE PARTER
      *
      *
      *
     C     FRIUTL        TAG
      *
      *
      * HVIS GRUNNLAG ER NULL HOPPES OVER
      *
     C     WSUTLX        IFEQ      *ZEROS
     C     UTLXMA        OREQ      'J'
     C                   GOTO      ENDUTL
     C                   END
      *
      * INITIERER FELTER HENTER VERDI FRA KUNDE
      *
     C                   MOVE      XXXKUN        WSKUNR
     C     KUND1K        CHAIN(N)  CUNDL01                            33
      *
     C     SYUTLP        IFEQ      99.99
     C     AVUTPR        OREQ      99.99
     C                   GOTO      ENDUTL
     C                   END
      *
      * FINNER AKTUELL SATS
      *
     C                   Z-ADD     FIUPS         UPROSE            4 2
     C                   Z-ADD     FIUPMN        UMINIM            4 0
     C     SYUTLP        IFNE      0
     C                   Z-ADD     SYUTLP        UPROSE
     C                   END
     C     SYMINU        IFNE      *ZEROS
     C                   Z-ADD     SYMINU        UMINIM
     C                   END
     C                   MOVE      'X'           WSSK
     C                   MOVE      'UTL'         WSVK
     C                   MOVE      *BLANKS       WSVT
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      ' '           WSKDUK
     C                   MOVE      *ZEROS        WSBELU
     C     WSUTLX        MULT      UPROSE        WSBELV
     C     WSBELV        DIV(H)    100           XBEL11           11 0
     C                   Z-ADD     XBEL11        WSBELV
     C                   Z-ADD     WSBELV        XBELN
      *
     C     WSUTLX        IFGT      0                                              3<-B
     C     XBELN         IFLT      UMINIM                                          4<-B
     C                   Z-ADD     UMINIM        XBELN
     C                   Z-ADD     UMINIM        WSBELV
     C                   END                                                       4<-E
     C                   ELSE                                                     3
     C                   Z-SUB     UMINIM        UMINIM
     C     XBELN         IFGT      UMINIM                                          4<-B
     C                   Z-ADD     UMINIM        XBELN
     C                   Z-ADD     UMINIM        WSBELV
     C                   END                                                       4<-E
     C                   Z-SUB     UMINIM        UMINIM
     C                   END                                                      3<-E
      *
     C                   MOVE      XXMOMS        WSKDM
     C   46
     COR 47
     COR 48              MOVE      TRMVA         WSKDM
     C                   MOVE      ' '           XKDUL             1
      *
      *
     C                   EXSR      MOVWSF
     C                   EXSR      VALUTA
     C     SYUTLP        IFEQ      0                                             2<-B
     C                   MOVE      'B'           XKDA
     C                   ELSE                                                    2
     C                   MOVE      'A'           XKDA
     C                   END                                                     2<-E
     C                   MOVE      XKDA          FAKDA
     C                   EXSR      NYFAK
      *
      *
      *
     C     ENDUTL        ENDSR
      *
      ***********************************************
     C     VALUTA        BEGSR
      ***********************************************
      * Converts from local currency to whatever currency that is
      * to be used on the invoice.
      * If the invoice is to be written in local currency or the line
      * already is in the right currency, nothing is done.
      *
     C*
     C*CURRENCY INVOICED (BLANK=FICURR)
     C                   MOVE      *BLANKS       FACURI
     C     FASK          IFEQ      'I'
     C                   MOVE      FAVAL         WSVAL
     C                   ELSE
     C     FASK          IFEQ      'S'
     C                   MOVE      HEVALS        WSVAL
     C                   ELSE
     C     FASK          IFEQ      'K'
     C                   MOVE      HEVALK        WSVAL
     C                   ELSE
     C     FASK          IFEQ      'X'
     C                   MOVE      VALKOD        WSVAL
     C                   END
     C                   END
     C                   END
     C                   END
      * SKAL FAKTURERES I "HJEMMEVALUTA" - HOPP UT..
     C     WSVAL         IFEQ      *BLANKS
     C     WSVAL         OREQ      FICURR
     C                   GOTO      SLVAL
     C                   END
      *
      * SKAL FAKTURERES I "FREMMEDVALUTA" MEN LINJA HAR ALT DEN SAMME
      * INGEN OMREGNING - FREMMEDVALUTAEN LAGRES PÅ LINJA -HOPP SÅ UT
      *
     C     FAVAL         IFEQ      WSVAL
     C                   MOVE      WSVAL         FACURI
     C                   GOTO      SLVAL
     C                   END
     C*
     C     VALU1K        CHAIN     VALUL01                            31
     C  N31WSKURS        IFNE      0
     C                   Z-ADD     WSKURS        VALKU1
     C                   END
     C                   MOVE      *ZEROS        FAEXRA
      *
     C     FABELN        MULT      OMRFAK        XWORK            17 5
     C     XWORK         DIV(H)    VALKU1        FABELV
     C                   MOVE      WSVAL         FAVAL
     C*CURRENCY INVOICED (NÅR FORSKJELLIG FRA FICURR)
     C                   MOVE      WSVAL         FACURI
     C*                  DUMP
      *
     C     SLVAL         ENDSR
      *
      ***********************************************
     C     VALUT2        BEGSR
      ***********************************************
      * Converts from currency on entered line or on line in price
      * agreement to local currency (FICURR in file FIRM)
      * The amount i local currency is then stored in "XBELN" (later
      * moved into fiel FABELN) This is the amount for the econ.system.
      * This amount may later be converted into the currency that is
      * to be used on the invoice (By subr. VALUTA) if the invoice
      * currency is not identical with the local currency (FICURR)
      *
      *
      * VED FFI TESTES OM KURS FINNES I IATAREGISTER
      *
      *
      *
      * VED FFI EVENTUELLT IATAKURSER
      *
     C     KGETYP        IFEQ      'FFI'
     C     VALU1K        CHAIN     VAIAL01                            95
     C   95VALU1K        CHAIN     VALUL01                            95
     C                   ELSE
     C     VALU1K        CHAIN     VALUL01                            95
     C                   END
N18   *
N18   * HØYESTE KURS VED I-LINJER
N18   *
N18  C     WSSK          IFEQ      'I'
N18  C                   MOVE      VALKU2        VALKU1
N18  C                   END
      *
      * HØYESTE KURS NÅR FAKTURA ER I NOK
      *
     C     WSSK          IFEQ      'K'
     C     HEVALK        ANDEQ     FICURR
     C                   MOVE      VALKU2        VALKU1
     C                   END
      * 3 valutaer inne i  bildet
S62  C*    WSSK          IFEQ      'K'
S62  C*    HEVALK        ANDNE     FICURR
S62  C*    HEVALK        ANDNE     WSVAL
S62  C*                  MOVE      VALKU2        VALKU1
S62  C*                  END
      *
     C     WSSK          IFEQ      'S'
     C     HEVALS        ANDEQ     FICURR
     C                   MOVE      VALKU2        VALKU1
     C                   END
      * 3 valutaer inne i  bildet
S62  C*    WSSK          IFEQ      'S'
S62  C*    HEVALS        ANDNE     FICURR
S62  C*    HEVALS        ANDne     WSVAL
S62  C*                  MOVE      VALKU2        VALKU1
S62  C*                  END
      *
      * MANUELL KURS TASTET PÅ SKJERMBILDET
      *
     C  N95WSKURS        IFNE      0
     C                   MOVE      WSKURS        VALKU1
     C                   END
      *
      * START HVIS KURS FINNES
      *
      * BEREGNER NORSKEKRONER
      *
     C  N95              DO
      *
      * HAR KUNDE TILLEGG KURSREGISTER ALLE PAKKER
      *
     C                   MOVE      'N'           AVTKUR            1
     C                   CLEAR                   CDERAFR
     C     WSKURS        IFEQ      0
     C     WSVAL         ANDNE     FICURR
     C     WSSK          IFEQ      'S'
     C     VKEY1         CHAIN     CDERAF                             33
     C                   ELSE
     C     WSSK          IFEQ      'K'
     C     VKEY2         CHAIN     CDERAF                             33
     C                   ELSE
     C     VKEY3         CHAIN     CDERAF                             33
     C                   END
     C                   END
     C   33VKEY0         CHAIN     CDERAF                             33
     C  N33              MOVE      'J'           AVTKUR
      *
      * KURSTILLEGG I BELØP
      *
     C  N33              ADD       CEABL         VALKU1
     C                   END
     C*
     C*
     C*
     C     WSBELV        MULT      VALKU1        XWORK
     C     XWORK         DIV(H)    OMRFAK        XBELN
      *
      *** ØKER MED TILLEGG  BANKKURS VED HEUR = C
      *
     C     WSKURS        IFEQ      0
     C     WSVAL         ANDNE     FICURR
      *
      * IKKE TILLEGG BANKKURS VED FAKTURA I UTENLANDSK VALUTA
      * DENNE OMREGNING ER BARE HVIS FAKTURA I NOK
      *
     C     WSSK          IFEQ      'S'
     C     HEVALS        ANDNE     FICURR
     C                   GOTO      UTVALT
     C                   END
      *
     C     WSSK          IFEQ      'K'
     C     HEVALK        ANDNE     FICURR
     C                   GOTO      UTVALT
     C                   END
      *
      *
      *
      * KUNDEN HAR EGET PROSENTAVVIK PÅ VALUTAKODEN
      *
     C     AVTKUR        IFEQ      'J'
     C     XBELN         MULT      CEAPR         XWORK
     C                   DIV       100           XWORK
     C                   ADD       XWORK         XBELN
     C                   ELSE
     C*
      *
      * KUNDEN HAR GENERELLT TILLEGG VALUTAKURS
      *
     C     WSSK          IFEQ      'S'
     C     CCK1          CHAIN     KODTCC                             33
     C                   ELSE
     C     WSSK          IFEQ      'K'
     C     CCK2          CHAIN     KODTCC                             33
     C                   ELSE
     C     CCK3          CHAIN     KODTCC                             33
     C                   END
     C                   END
      *
      * ØKER MED TILLEGG BANKKURS  VED
      *
     C   33              MULT(H)   XTILBA        XBELN
     C  N33KCCVA         DIV       100           YTILBA            5 4
     C  N33              ADD       1             YTILBA
     C  N33              MULT(H)   YTILBA        XBELN
     C                   END
     C                   END
      *
      * SLUTT TILLEGG BANKKURS
      *
      *** ØKER FRAKT MED CCFEE  VED HEUR = C
      *
     C   43KGETYP        IFEQ      'FFI'
     C     WSVAL         ANDNE     FICURR
     C     WSCCF         IFEQ      'J'
     C                   EXSR      CCFEE
     C                   END
     C                   END
      *
     C                   END
      *
      *
     C     UTVALT        TAG
      *
     C                   SETOFF                                       33
     C                   ENDSR
      *
      ***********************************************
     C     BFAKT0        BEGSR
      ***********************************************
      * IND 86 ON I RUTINE BERFRA BETYR DIREKTEFRAKT ER BEREGNET
      * IND 40 ON I RUTINE BERFRA BETYR KALL FRA SKJERMBILDE
      *
     C                   MOVE      *ZEROS        UUAVNR
     C                   MOVE      WSSK          WSSKIN            1
     C   41
     COR 42
N11  COR 43
N26  COR 44
     COR 49
     COR 50
     COR 46              SETOFF                                           86
     C                   MOVE      *BLANKS       X01B
     C   40              MOVE      WSVK          XGEBY
     C  N40              MOVE      *ZEROS        WSKURS
      *
      *** S E L G E R      F A K T U R E R I N G
      *
     C     HEKDFS        COMP      'X'                                    33
      *
      *TRANSPORTOPPDRAG HENTES AVTALE PÅ 'I'
      *
     C   40WSSK          IFEQ      'I'
     C     WSSK          OREQ      'X'
     C   33              MOVE      'K'           WSSK
     C  N33              MOVE      'S'           WSSK
     C                   END
     C   40
     CANN33WSSK          COMP      'K'                                    33
     C   33              GOTO      STBF0
     C   40WSSK          COMP      'A'                                    33
     C   33              GOTO      STBFAG
      *
     C                   MOVE      *ZEROS        XPROS            10 3
      *                    MOVE HEFBV     XINT
     C     HEFBV         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEFBV         XINT
     C                   END
      *
     C  N40              MOVE      'S'           WSSK
     C                   MOVE      'S'           XTSK
     C  N40              MOVE      *BLANKS       WSVT
     C  N40              MOVE      *BLANKS       XGEBY
     C                   MOVE      *BLANKS       XAVTT
     C                   MOVE      *ZEROS        XINT
      *
      * "A-LINJER" FOR AGENT/AMETA KUN NÅR IKKE S/K LINJE MOT AGENTSIDE
      * (S VED IMP. / K VED EKSP.) HVIS S/K FINNES -->"N" I "AGAVRE"
      *
     C                   MOVE      'J'           AGAVRE            1
      *
      ***   H A R   S E L G E R   A V T A L E
      *
     C                   MOVE      HEKDFS        XEKDFS            1
     C                   MOVE      XAKNSF        XKNR
     C     XEKDFS        IFEQ      ' '
     C     KAVTK         CHAIN     KAVT                               33
     C  N33              MOVE      'B'           XEKDFS            1
     C  N33              MOVE      XAKNK         XAKNKF
     C                   END
     C     XEKDFS        IFEQ      ' '
     C   41
     COR 42
N11  COR 43
N26  COR 44
     COR 49
     COR 50
     COR 46              MOVE      XAKNSF        XTKNR
     C                   MOVE      HEANS         XAVTN
     C                   ELSE
     C     XEKDFS        IFEQ      'B'
     C                   MOVE      HEANK         XAVTN
     C     HEKDFK        IFEQ      'E'
     C                   MOVE      XAKNK         XKNR
     C   41
     COR 42
N11  COR 43
N26  COR 44
     COR 49
     COR 50
     COR 46              MOVE      XAKNK         XTKNR
     C                   ELSE
     C                   MOVE      XAKNKF        XKNR
     C   41
     COR 42
N11  COR 43
N26  COR 44
     COR 49
     COR 50
     COR 46              MOVE      XAKNKF        XTKNR
     C                   END
     C                   ELSE
     C     XEKDFS        IFEQ      'E'
     C                   MOVE      XAKNS         XKNR
     C   41
     COR 42
N11  COR 43
N26  COR 44
     COR 49
     COR 50
     COR 46              MOVE      XAKNS         XTKNR
     C                   MOVE      HEANS         XAVTN
     C                   END
     C                   END
     C                   END
     C   40WSSKIN        IFEQ      'I'
     C                   MOVE      KOAKNR        XKNR
     C                   MOVE      KOAKNR        XTKNR
     C                   END
     C   40WSSKIN        IFEQ      'X'
     C                   MOVE      WSKUNR        XKNR
     C                   MOVE      WSKUNR        XTKNR
      *
     C     KUND1K        CHAIN(N)  CUNDL01                            33
     C  N33AKNRKU        IFNE      *ZEROS
     C                   MOVE      AKNRKU        XKNR
     C                   MOVE      AKNRKU        XTKNR
     C                   END
      *
     C                   END
      *
     C                   EXSR      AVTSR
      *
      *** SJEKK BRUTTOTARIFF FOR SELGER
      *
     C   33              MOVE      'S'           XAVTN
     C   33              EXSR      BRUTAR
     C   40              GOTO      SLBF0
      *
      * IMPORT - LINJE MOT SELGER FINNES - IKKE EGEN AGENTKALKULASJON
      *
     C   41
     CANN33              MOVE      'N'           AGAVRE
      *
      *** K J Ø P E R      F A K T U R E R I N G
      *
     C     STBF0         TAG
     C                   MOVEA     *BLANKS       GNT
     C                   MOVE      *ZEROS        GN
     C     HEKDFK        COMP      'X'                                    33
     C   33              GOTO      SLBF0
      *
     C                   MOVE      *ZEROS        XPROS
      *
      *
     C     HEFBV         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEFBV         XINT
     C                   END
      *
     C  N40              MOVE      'K'           WSSK
     C                   MOVE      'K'           XTSK
     C  N40              MOVE      *BLANKS       WSVT
     C  N40              MOVE      *BLANKS       XGEBY
     C                   MOVE      *BLANKS       XAVTT
      *
      ***   H A R   K J Ø P E R   A V T A L E
      *
     C     HEKDFK        IFEQ      ' '
     C     KAVTS         CHAIN     KAVT                               33
     C  N33              MOVE      'B'           HEKDFK
     C  N33              MOVE      XAKNS         XAKNSF
     C                   END
     C     HEKDFK        IFEQ      ' '
     C                   MOVE      XAKNKF        XKNR
     C   41
     COR 42
N11  COR 43
N26  COR 44
     COR 49
     COR 50
     COR 46              MOVE      XAKNKF        XTKNR
     C                   MOVE      HEANK         XAVTN
     C                   ELSE
     C     HEKDFK        IFEQ      'B'
     C                   MOVE      HEANS         XAVTN
     C     HEKDFS        IFEQ      'E'
     C                   MOVE      XAKNS         XKNR
     C   41
     COR 42
N11  COR 43
N26  COR 44
     COR 49
     COR 50
     COR 46              MOVE      XAKNS         XTKNR
     C                   ELSE
     C                   MOVE      XAKNSF        XKNR
     C   41
     COR 42
N11  COR 43
N26  COR 44
     COR 49
     COR 50
     COR 46              MOVE      XAKNSF        XTKNR
     C                   END
     C                   ELSE
     C     HEKDFK        IFEQ      'E'
     C                   MOVE      XAKNK         XKNR
     C   41
     COR 42
N11  COR 43
N26  COR 44
     COR 49
     COR 50
     COR 46              MOVE      XAKNK         XTKNR
     C                   MOVE      HEANK         XAVTN
     C                   END
     C                   END
     C                   END
     C   40WSSKIN        IFEQ      'I'
     C                   MOVE      KOAKNR        XKNR
     C                   MOVE      KOAKNR        XTKNR
     C                   END
     C   40WSSKIN        IFEQ      'X'
     C                   MOVE      WSKUNR        XKNR
     C                   MOVE      WSKUNR        XTKNR
      *
     C     KUND1K        CHAIN(N)  CUNDL01                            33
     C  N33AKNRKU        IFNE      *ZEROS
     C                   MOVE      AKNRKU        XKNR
     C                   MOVE      AKNRKU        XTKNR
     C                   END
      *
     C                   END
      *
     C                   EXSR      AVTSR
      *
      *
      *** SJEKK BRUTTOTARIFF FOR KJØPER
      *
     C   33              MOVE      'K'           XAVTN
     C   33              EXSR      BRUTAR
      *
      * EKSPORT- LINJE MOT KJØPER FINNES - IKKE EGEN AGENTKALKULASJON
      *
     C   42
     CANN33              MOVE      'N'           AGAVRE
      *
     C   40              GOTO      SLBF0
      *
      *** A G E N T        F A K T U R E R I N G
      * KUN LAND IMPORT/LAND EKSPORT
      *
     C     STBFAG        TAG
     C  N41
     CANN42              GOTO      SLBF0
     C     AGAVRE        IFEQ      'N'
     C     HEKNA         OREQ      0
     C                   GOTO      SLBF0
     C                   END
      *
      *
     C                   MOVE      *ZEROS        XPROS
      *
     C     HEFBV         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEFBV         XINT
     C                   END
      *
     C  N40              MOVE      'A'           WSSK
     C                   MOVE      'A'           XTSK
     C  N40              MOVE      *BLANKS       WSVT
     C  N40              MOVE      *BLANKS       XGEBY
     C                   MOVE      *BLANKS       XAVTT
      *
      ***   H A R   A G E N T     A V T A L E
      *
     C                   MOVE      HEKNA         XKNR
     C                   MOVE      HEKNA         XTKNR
     C                   MOVE      '0'           XAVTN
      *
     C                   EXSR      AVTSR
      *
      *** SJEKK BRUTTOTARIFF FOR KJØPER
      *
     C   33              MOVE      'A'           XAVTN
     C   33              EXSR      BRUTAR
      *
     C     SLBF0         ENDSR
      ***********************************************
     C     BFAKLE        BEGSR
      ***********************************************
      * SETT FLAGG FOR VIDERE SUBR.:MANUELL ENTER / GJELDER LEVR.KOST
     C                   MOVE      *ON           *IN40
     C                   MOVE      'J'           LEVAVT            1
     C   41
     COR 42
     COR 49
     COR 50
     COR 46              SETOFF                                           86
     C                   MOVE      *BLANKS       X01B
     C                   MOVE      WSVK          XGEBY
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      *ZEROS        UUAVNR
      *
     C     HEFBV         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEFBV         XINT
     C                   END
      *
     C                   MOVE      *BLANKS       XAVTT
      *
      ***   H A R   A G E N T (LEVERANDØR) AVTALE
      *
     C                   MOVE      KUNDNR        XKNR
     C                   MOVE      KUNDNR        XTKNR
     C                   MOVE      '0'           XAVTN
     C                   MOVE      WSSK          XTSK
      *
     C                   EXSR      AVTSR
      *
      *** SJEKK BRUTTOTARIFF FOR AGENT (LEVERANDØR)
      *
     C   33              MOVE      'A'           XAVTN
     C   33              EXSR      BRUTAR
      *
     C                   MOVE      ' '           LEVAVT
     C                   MOVE      *OFF          *IN40
      *
     C                   ENDSR
      *
      ***********************************************
     C     CCFEE         BEGSR
      ***********************************************
      *
      * CHECKS IF CUSTOMER HAS OWN AGREEMENT
      *
     C     WSSK          IFEQ      'S'
     C     CCK1          CHAIN     KODTCC                             33
     C                   ELSE
     C     WSSK          IFEQ      'K'
     C     CCK2          CHAIN     KODTCC                             33
     C                   ELSE
     C     CCK3          CHAIN     KODTCC                             33
     C                   END
     C                   END
      *
     C   33XBELN         MULT      XBL1          XCCBEL            7 0
     C   33XCCBEL        IFLT      KDIBL2
     C                   Z-ADD     KDIBL2        XCCBEL
     C                   END
     C  N33XBELN         MULT      KCCCC         XCCBEL            7 0
     C  N33              DIV       100           XCCBEL            7 0
     C  N33XCCBEL        IFLT      KCCMI
     C                   Z-ADD     KCCMI         XCCBEL
     C                   END
     C                   ADD       XCCBEL        XBELN
      *
     C                   ENDSR
      *
      ***********************************************
     C     AVTSR         BEGSR
      ***********************************************
      *
      * evt avvikende omregning
      *
     c     headfk        chain(n)  headf                              79
     c  N79cum3k         chain     cum3lm                             79
     c  N79              exsr      kuomr
      *
     C                   MOVE      HEFR          XFRAN
     C   41
     COR 42
N11  COR 43
N26  COR 44
     COR 49
     COR 50
     COR 46              MOVE      HEFR          XTFRAN
     C                   MOVE      HEOT          XOPDT
     C   41
     COR 42
N11  COR 43
N26  COR 44
     COR 49
     COR 50
     COR 46              MOVE      HEOT          XTOT
      * Indic. for 1 or more outdatede price agreement lines
     C                   SETOFF                                       79
     C                   MOVE      'N'           AVTALE            1
     C                   EXSR      BFAKT
      *
     C   33              GOTO      SLAVT
      * At least 1 valid price agreement line is found by BFAKT
     C     STAVT         TAG
     C                   EXSR      FBELØ2
     C                   SETOFF                                       32
     C     INOM01        TAG
     C     XKNR          READE     PRIK                                   32
     C  N32XAVTN         COMP      PKAVTN                             3232
     C  N32              EXSR      TSTGIO
      * This line was omitted - are there more lines??
     C  N32
     CAN 78              GOTO      INOM01
     C  N32              DO
     C                   MOVE      PKTNR         WSTNR
     C  N40              MOVE      PKMVA         WSKDM
N29  C  N40WSKDM         ifeq      'I'
N29  C                   exsr      IntTrekk
N29  c                   endif
     C  N40              GOTO      STAVT
     C                   END
      *
      *
      * Hvis BARE G/H-LINJER funnet-skal brutto gebyrfordeling brukes
      * (33 ON=Gå i brutto gebyrfordeling/"Hvem belastes hva" )
      * (G/H er AVVIK FRA STANDARDPRISER i "Hvem belstes hva.")
      *
     C                   SETOFF                                       33
     C     AVTALE        IFEQ      'N'
     C                   SETON                                        33
     C                   ELSE
      * Kundeavtale (utenom G/H linjer) foreligger......
      * G/H linjer alt laget- (ARRAY GNT SORTERT/ULIK BLANK)- slett de
      * (G/H linjer har ofte INGEN begrensninger da det styres av
      *  "Hvem belastes hva - systemet" om de skal med eller ikke)
     C     GNT(20)       IFNE      *BLANKS
     C                   EXSR      DELGH
     C                   END
     C                   END
     C     SLAVT         ENDSR
      *
      ***********************************************
     C     BRUTAR        BEGSR
      ***********************************************
     C  N40              MOVE      *BLANKS       XGEBY
     C                   MOVE      '    ALLE'    XKNR
     C   40              GOTO      STBRUT
      *
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      HEFR          XFRAN
     C                   MOVE      HEOT          XOPDT
      *
     C                   EXSR      BFAKT
     C   33              GOTO      SLBRUT
      *
     C     STBRUT        TAG
     C  N40PKAVTT        COMP      'X'                                    33
     C  N40
     CAN 33              GOTO      STBRU2
      *
     C   41
     COR 42
     COR 43
     COR 49
     COR 50
     COR 46              DO
      *
      * HENT GEBYRKODE INFO
      *
     C   40KODGEK        CHAIN     KOGER                              99
     C  N40KODGEA        CHAIN     KOGER                              99
N49  c*Frakt-relatert gebyr ??
N49  C                   IF        (PKAVTT='T' or PKAVTT='Y')
N49  c                             and PKBELØ<>0
N49  c                   goto      SkipFraTyp
N49  c                   endif
     C  N41
     CANN42
     CANN46KGETYP        COMP      'SEA'                                  99
     C  N49
     CANN50KGETYP        COMP      'FRA'                                  99
     C  N99KGETYP        COMP      'FR1'                                  99
     C  N99KGETYP        COMP      'FR2'                                  99
     C  N99KGETYP        COMP      'FRI'                                  99
     C  N99KGETYP        COMP      'TGI'                                  99
     C  N99KGETYP        COMP      'TGF'                                  99
     C  N99KGETYP        COMP      'POS'                                  99
N49  c     SkipFraTyp    tag
     C                   END
      *
      * FRAKTTILLEGG KAN LIGGE MED % OGSÅ I HVEM BELASTES HVA...
     C                   MOVE      *ZEROS        XPROS
S24  C*    KGETYP        IFEQ      'FRA'
S24  C*    KGETYP        OREQ      'SEA'
     C     PKAVTT        IFEQ      'P'
     C     *IN40         ANDEQ     '0'                                          IKKE MANUELL
     C                   Z-ADD     PKBELØ        XPROS
     C                   END
S24  C*                  END
      *
     C                   EXSR      FBELØ
      * JOV 05.02.91 - HOPP UT ETTER EN LEST PRIK/PRIS VED MANUELL
      * TASTING (FOR IKKE Å MISTE EVT. D/L I X01B (ANNEN ENHET) )
     C   40              GOTO      SLBRUT
      *
     C     STBRU2        TAG
     C                   SETOFF                                       32
     C     XKNR          READE     PRIK1                                  32
     C  N32XFRAN         COMP      PKFR01                             3232
     C  N32XOPDT         COMP      PKOT01                             3232
     C  N32XAVTN         COMP      PKAVTN                             3232
     C  N32              EXSR      TSTGIO
      * This price line was omitted - are there more lines??
     C  N32
     CAN 78              GOTO      STBRU2
     C  N32              DO
     C                   MOVE      PKTNR         WSTNR
     C  N40              MOVE      PKMVA         WSKDM
N29  C  N40WSKDM         ifeq      'I'
N29  C                   exsr      IntTrekk
N29  c                   endif
     C  N40              GOTO      STBRUT
     C                   END
      *
     C     SLBRUT        ENDSR
      *
      ***********************************************
     C     BFAKT         BEGSR
      ***********************************************
      *  Tests that there is at least one valid price line in the price
      *  agreement system (for a client (AVTSR) or for "ALLE" (BRUTAR))
      *  33 OFF after this subroutine - at least one valid line found.
      *  79 ON  one (or more) line(s) had elapsed datelimit.
      *
      *                    MOVE HEFBV     XINT
     C     HEFBV         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEFBV         XINT
     C                   END
      *
      *  OBS OBS**** INGEN LESING FRA PRIK/PRIS ER FORETATT ENNÅ
      *  OBS OBS**** (I BFAKT0 - AVTSR  /  BFAKT0 - BRUTAR)
      *  OBS OBS**** X01B ER VEL DERFOR UDEFINERT ENNÅ
      *  OBS OBS**** ER DE FØLGENDE 10-15 LINJER BARE TULL ????????
     C     X01B          IFEQ      'F'
     C                   Z-ADD     FORANT        XINT
     C                   END
     C     X01B          IFEQ      'X'
     C                   Z-ADD     HENT          XINT
     C                   END
     C     X01B          IFEQ      'L'
     C                   Z-ADD     HENTF         XINT
     C                   END
     C     X01B          IFEQ      'B'
     C     HEVKT         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEVKT         XINT
     C                   END
     C                   END
      * vareverdi kan også staffeleres
N30  C     X01B          IFEQ      'V'
N30  C     TRVERN        IFGT      99999
N30  C                   Z-ADD     99999         XINT
N30  C                   ELSE
N30  C                   Z-ADD(H)  TRVERN        XINT
N30  C                   END
N30  C                   END
     C     X01B          IFEQ      'T'
     C     ANTTEU        IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     ANTTEU        XINT
     C                   END
     C                   END
     C     X01B          IFEQ      'M'
     C     HEM3          ADD(H)    0.499         XINT
     C                   END
     C     X01B          IFGE      '0'
     C     X01B          ANDLE     '9'
     C                   MOVE      'D'           X01B
     C                   END
     C     X01B          IFEQ      'D'
     C                   Z-ADD     0             XINT
     C                   END
      *
     C                   SETOFF                                       33
      **
     C     XKNR          IFEQ      '    ALLE'
     C     PRIK1K        SETLL     PRIK1
     C                   ELSE
     C     PRIKK         SETLL     PRIK
     C                   END
      **
     C     INOM02        TAG
      **
     C     XKNR          IFEQ      '    ALLE'
     C     XKNR          READE     PRIK1                                  33
     C  N33XFRAN         COMP      PKFR01                             3333
     C  N33XOPDT         COMP      PKOT01                             3333
     C                   ELSE
     C     XKNR          READE     PRIK                                   33
     C                   END
     C  N33XAVTN         COMP      PKAVTN                             3333
     C  N33
     CAN 40XGEBY         COMP      PKGEBY                             3333
     C  N33              EXSR      TSTGIO
      * This line was omitted - are there more ??
     C  N33
     CAN 78              GOTO      INOM02
     C  N33              DO
     C                   MOVE      PKTNR         WSTNR
     C  N40              MOVE      PKMVA         WSKDM
N29  C  N40WSKDM         ifeq      'I'
N29  C                   exsr      IntTrekk
N29  c                   endif
     C                   END
      *
      *
     C** 33                CLEARPRIKR1  -- BURDE VIRKE, MEN...
     C     *IN33         IFEQ      '1'
     C                   CLEAR                   PKKOLL
     C                   CLEAR                   PKINT
     C                   CLEAR                   PKPPR
     C                   CLEAR                   PKTEGN
     C                   CLEAR                   PKJUST
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     FBELØ2        BEGSR
      ***********************************************
      *
      *** KALLES HVIS KUNDEN HAR AVTALE
      *
     C   41
     COR 42
     COR 43
     COR 49
     COR 50
     COR 46              DO
     C     KODGEA        CHAIN     KOGER                              99
N49  C                   IF        (PKAVTT='T' or PKAVTT='Y')
N49  c                             and PKBELØ<>0
N49  c                   goto      SkipFraTyp2
N49  c                   endif
     C  N41
     CANN42
     CANN46KGETYP        COMP      'SEA'                                  99
     C  N49
     CANN50KGETYP        COMP      'FRA'                                  99
     C  N99KGETYP        COMP      'FR1'                                  99
     C  N99KGETYP        COMP      'FR2'                                  99
     C  N99KGETYP        COMP      'FRI'                                  99
     C  N99KGETYP        COMP      'TGI'                                  99
     C  N99KGETYP        COMP      'TGF'                                  99
     C  N99KGETYP        COMP      'POS'                                  99
N57   * Ved type G ikke bruk fraktrelatert
N57  C   99PKAVTT        COMP      'G'                                9999
N49  c     SkipFraTyp2   tag
     C                   END
      *
      * HENTER PRIS I BRUTTOTARIFF VED KODE P OG B OG X H
      *
     C                   MOVE      *ZEROS        XPROS
     C     PKAVTT        COMP      'P'                                    32
     C  N32
     CAN 40PKAVTT        COMP      'X'                                    32
     C  N32PKAVTT        COMP      'H'                                    32
     C   32              Z-ADD     PKBELØ        XPROS
     C  N32PKAVTT        COMP      'B'                                    32
     C   99
     COR 32              EXSR      FBELØ
     C     PKAVTT        COMP      'B'                                    32
     C  N32PKAVTT        COMP      'P'                                    32
     C  N32
     CAN 40PKAVTT        COMP      'X'                                    32
     C  N32PKAVTT        COMP      'H'                                    32
     C  N32
     CAN 99              SETON                                        32
     C   32              EXSR      FYLARR
     C   32              GOTO      SLFBL2
      *
      * BEHANDLER ANDRE KODER ENN B P OG X H
      *
     C                   MOVE      PKGEBY        XGEBY
     C                   MOVE      PKAVTT        XAVTT
      *
      *                    MOVE HEFBV     XINT
     C     HEFBV         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEFBV         XINT
     C                   END
      *
     C     X01B          IFEQ      'F'
     C                   Z-ADD     FORANT        XINT
     C                   END
     C     X01B          IFEQ      'X'
     C                   MOVE      HENT          XINT
     C                   END
     C     X01B          IFEQ      'L'
     C                   Z-ADD     HENTF         XINT
     C                   END
     C     X01B          IFEQ      'B'
     C     HEVKT         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEVKT         XINT
     C                   END
     C                   END
      * vareverdi kan også staffeleres
N30  C     X01B          IFEQ      'V'
N30  C     TRVERN        IFGT      99999
N30  C                   Z-ADD     99999         XINT
N30  C                   ELSE
N30  C                   Z-ADD(H)  TRVERN        XINT
N30  C                   END
N30  C                   END
     C     X01B          IFEQ      'T'
     C     ANTTEU        IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     ANTTEU        XINT
     C                   END
     C                   END
     C     X01B          IFEQ      'M'
     C     HEM3          ADD(H)    0.499         XINT
     C                   END
     C     X01B          IFGE      '0'
     C     X01B          ANDLE     '9'
     C                   MOVE      'D'           X01B
     C                   END
      *
     C     X01B          IFEQ      'D'
     C                   Z-ADD     0             XINT
     C                   END
      *
      *** START BEHANDLING AV T Y OG G
      *
     C     PKAVTT        COMP      'T'                                3232
     C   32PKAVTT        COMP      'G'                                3232
     C   32
     CAN 40PKAVTT        COMP      'Y'                                3232
     C   32              GOTO      STFBL2
      *
     C     PRIKK         SETLL     PRIK
      **
     C     INOM03        TAG
      **
      *   TESTER INCLUDE OMITBEGREPER
      *
     C     XKNR          READE     PRIK                                   32
     C  N32XAVTN         COMP      PKAVTN                             3232
     C  N32              EXSR      TSTGIO
     C  N32
      *  78 = LINJE SKAL IKKE VÆRE MED
     CAN 78              GOTO      INOM03
      *
      * N32 GYLDIG AVTALE ER LEST
      *
      * VED NY GEBYRKODE SKAL DEN UT AV LØKKA
      *
     C  N32XGEBY         COMP      PKGEBY                             3232
     C   32              GOTO      STFBL2
      *
     C                   MOVE      PKBELØ        PRBELØ
     C  N40              MOVE      PKGEBY        WSVK
     C     LEVAVT        IFNE      'J'
     C                   MOVE      PKFVAL        WSVAL
     C                   END
     C                   EXSR      SRTAB
     C  N40
     CANN99PKAVTT        IFEQ      'B'
     C                   MOVE      'B'           XKDA
     C                   ELSE
     C                   MOVE      'A'           XKDA
     C                   END
     C  N40              DO
     C                   MOVE      'J'           NYPXX             1
     C   41              EXSR      NYPA
     C   42              EXSR      NYPB
     C   43              EXSR      NYPC
     C   44              EXSR      NYPD
     C   45              EXSR      NYPE
     C   46              EXSR      NYPH
     C   49              EXSR      NYPF
     C   50              EXSR      NYPG
     C                   MOVE      *ZEROS        WSAGRN
     C                   MOVE      ' '           NYPXX             1
     C                   END
      *
      * VED KODE = G   LATER SOM AVTALE IKKE ER FUNNET
      *
     C                   EXSR      FYLARR
      *
      *** SETTE PEKER TIL NESTE RECORD
     C     STFBL2        TAG
     C                   MOVE      'Z'           XAVTT
     C     PRIKK         SETLL     PRIK
      *
     C     SLFBL2        ENDSR
      *
      ***********************************************
     C     FBELØ         BEGSR
      ***********************************************
      *
      *** HENTE DATA FRA BRUTTOTARIFF      PRIK ER LEST
     C  N40              MOVE      PKGEBY        WSVK
     C     LEVAVT        IFNE      'J'
     C                   MOVE      PKFVAL        WSVAL
     C                   END
      *
     C     HEFBV         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEFBV         XINT
     C                   END
      *
     C                   SETOFF                                       32
      *
      *** HENTE BRUTTO GEBYR
      *
     C  N99              DO
     C     PRISKK        SETLL     PRIS
     C     WSTNR         READE     PRIS                                   32
      *
      *** VED ANNEN ENHET MÅ SETTE LOWER LIMIT MED RIKTIG VERDI
      *
     C  N32X01B          IFNE      ' '
     C                   EXSR      PRSETL
     C                   END
     C  N32PRGEBY        COMP      WSVK                               3232
     C                   END
      *
     C                   MOVE      HEFBV         XXFBV             9 0
     C                   MOVE      'N'           XSJØ              1
     C   99              EXSR      BERFRA
     C     XSJØ          IFEQ      'N'
     C  N32              EXSR      SRTAB
     C                   MOVE      XXFBV         HEFBV
      *
     C  N40
     CANN99PKAVTT        IFEQ      'P'
     C     PKAVTT        OREQ      'H'
     C                   MOVE      'A'           XKDA
     C                   ELSE
     C                   MOVE      'B'           XKDA
     C                   END
     C                   ELSE
     C     XPROS         IFNE      0
     C     LEVAVT        IFNE      'J'
     C     XPROS         IFNE      0.001
     C     WSBELV        DIV       100           XWORK
     C     XWORK         MULT(H)   XPROS         WSBELV
     C                   ELSE                                                   MOTKOSTN.
     C                   Move      *zeros        XWORK
     C                   Move      *zeros        WSBELV
     C                   END
     C                   Z-ADD     WSBELV        XBELN
     C                   ELSE                                                   MOTKOSTN.
     C     XPROS         IFNE      0.001
     C     WSBELU        DIV       100           XWORK
     C     XWORK         MULT(H)   XPROS         WSBELU
     C                   ELSE                                                   MOTKOSTN.
     C                   Move      *zeros        XWORK
     C                   Move      *zeros        WSBELU
     C                   END
     C                   END
     C                   END
     C                   END
      *
     C  N32
     CANN40              DO
     C                   MOVE      'J'           NYPXX             1
     C* FORDELINGSLINJER LEGGES UT I EGET PROGRAM
     C     KGETYP        IFNE      'TGF'
     C   41              EXSR      NYPA
     C   42              EXSR      NYPB
     C   43              EXSR      NYPC
     C   44              EXSR      NYPD
     C   45              EXSR      NYPE
     C   46              EXSR      NYPH
     C   49              EXSR      NYPF
     C   50              EXSR      NYPG
     C                   END
     C                   MOVE      *ZEROS        WSAGRN
     C                   MOVE      ' '           NYPXX             1
     C                   END
      *
     C                   ENDSR
      *
N29   ***********************************************
N29  C     IntTrekk      BEGSR
N29   ***********************************************
N29  C                   MOVE      'I'           WSSK
N29  C                   MOVE      'N'           WSKDM
N29  C                   MOVE      HEAVD         WSAVDR
N29  C                   ENDSR
      ***********************************************
     C     TSTGIO        BEGSR
      ***********************************************
      *
      *    INDIKATOR  78    betyr ikke skal være med
      *
      *          contains all include/omit conditions possible for one
      *          priceline (max. include or omit per condition)
      *
     C                   SETOFF                                       78
n50   * hvis gebyr endret ikke beregn på nytt ved transp disp
n50  c     heur          ifeq      'H'
n50  C     FAK15K        CHAIN     FAK15                              80
n50  C  N80              SETON                                        78
n50  C   78              GOTO      UTGIO
n50  C                   end
N38   *
N38   * TEST OM FAKTGEBYR  MED KODE I/E
N38   *
N38  C     PKKOLL        IFEQ      'I'
N38  C     PKKOLL        OREQ      'E'
      * ALDRI TIL SAMLEFAKTURAKUNDER
N38  C     SFAKT         IFNE      ' '
N38  C                   SETON                                        78
N38  C                   GOTO      UTGIO
N38  C                   END
      * KODE I HOPP UT VED EPOSTKUNDE
N38  C     PKKOLL        IFEQ      'I'
N38  C     WSSK          IFEQ      'K'
N38  C     EPOSTK        ANDEQ     'J'
N38  C                   SETON                                        78
N38  C                   GOTO      UTGIO
N38  C                   END
N38  C     WSSK          IFEQ      'S'
N38  C     EPOSTS        ANDEQ     'J'
N38  C                   SETON                                        78
N38  C                   GOTO      UTGIO
N38  C                   END
N38  C                   END
N38  C                   END
N38   *
N38   * FAKTGEBYR TIL  EPOST KUNDER
N38   *
      *
N38  C     PKKOLL        IFEQ      'E'
N38  C     WSSK          IFEQ      'K'
N38  C     EPOSTK        ANDEQ     'N'
N38  C                   SETON                                        78
N38  C                   GOTO      UTGIO
N38  C                   END
N38  C     WSSK          IFEQ      'S'
N38  C     EPOSTS        ANDEQ     'N'
N38  C                   SETON                                        78
N38  C                   GOTO      UTGIO
N38  C                   END
N38  C                   END
      *
      * HOPPER OVER GENERELLE GEBYRER FRA BRUTTO VED AVTALE
      *
     C     PKGEBY        LOOKUP    GNT                                    80
     C   80              SETON                                            78
     C   78              GOTO      UTGIO
     C     PKAVTT        IFEQ      'G'
     C     PKAVTT        OREQ      'H'
     C     BRUKEY        CHAIN     PRIK1D                             80
     C   80              SETON                                        78
     C   78              GOTO      UTGIO
     C                   END
      *
      * HVIS FRA TRANSP.MOD. OG GEBYR="FRA", IKKE KALKULER FRAKT
      * MEN PLUKK OPP EVT SAMMENSLÅINGSKODE OG OPPDATER PÅ LINJE 00000
      *
     C     HEUR          IFEQ      'H'
     C     PKGEBY        ANDEQ     'FRA'
     C                   MOVE      *ZEROS        FALI
     C     FAKTK         CHAIN     FAKT                               78
     C     *IN78         IFEQ      *OFF
     C     FAOPKO        IFGE      ' '
     C     FAOPKO        ANDLE     'C'
     C                   MOVE      PKSAMM        FACD11
     C                   END
     C                   UPDATE    FAKTR
     C                   END
     C                   SETON                                        78
     C                   GOTO      UTGIO
     C                   END
      *
s41  C*    PRJOIK        CHAIN     PRJOIN                             80
s41  C* N80              DO                                                     I
      * ______________________________
      * Ursprungskode - Include / Omit
      * """"""""""""""""""""""""""""""
     C     PKURIO        IFNE      ' '                                          II
     C     PKURIO        IFEQ      'I'                                          III
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HEUR          LOOKUP    UR                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit må begrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HEUR          LOOKUP    UR                                     80
     C   80              SETON                                        78
     C                   END                                                    III
     C                   END                                                    II
N59   *--------------------------------
N59   * ved *AVD  er det avdelinger
N59   *--------------------------------
N59  C     TR(1)         IFEQ      '*AVD'
N59  C     PTRAIO        ANDNE     ' '                                          III
N59  C                   SETOFF                                       80
N59  C                   movel     heavd         test4             4
N59  C     test4         LOOKUP    TR                                     80
N59  C     PTRAIO        IFEQ      'I'                                          III
N59  C  N80              SETON                                        78
N59  C                   ELSE
N59   * Ved omit må begrepet IKKE finnes i -arrayet (->80 off)
N59  C   80              SETON                                        78
N59  C                   END                                                    III
N59  C                   ELSE                                                   II
      *--------------------------------
N40   * ved *pro  er det produktkode
      *--------------------------------
N40  C     TR(1)         IFEQ      '*PRO'
N40  C     HEKDPL        ANDNE     ' '
N40  C     PTRAIO        ANDNE     ' '                                          III
N40  C                   SETOFF                                       80
N40  C                   movel     hekdpl        test4             4
N40  C     test4         LOOKUP    TR                                     80
N40  C     PTRAIO        IFEQ      'I'                                          III
N40  C  N80              SETON                                        78
N40  C                   ELSE
N40   * Ved omit må begrepet IKKE finnes i -arrayet (->80 off)
N40  C   80              SETON                                        78
N40  C                   END                                                    III
N40  C                   ELSE                                                   II
      *--------------------------------
N43   * ved *TIL  er det tilleggsgebyrer
      *--------------------------------
N43  C     TR(1)         IFEQ      '*TIL'
N43  C     TPX           ANDNE     *BLANKS
N43  C     PTRAIO        ANDNE     ' '                                          III
S50   * hvis gebyr endret ikke beregn på nytt
S50  C*    FAK15K        CHAIN     FAK15                              80
S50  C* N80              SETON                                        78
S50  C*  78              GOTO      UTGIO
      * skal alltid følge frakten
N48  C     WSSK          COMP      TRKDFF                                 80
N48  C  N80              SETON                                        78
N48  C   78              GOTO      UTGIO
      *includetester prøver å finne en gyldig
N43  C                   SETOFF                                       80
N43  C     PTRAIO        IFEQ      'I'                                          III
N43  C     1             do        5             NR
N43  C     TP(NR)        ifne      ' '
N43  C                   movel     TP(NR)        test4             4
N43  C     test4         LOOKUP    TR                                     80
N43  c   80              goto      tilut
N43  C                   end
n43  c                   end
N43  c                   seton                                        78
      *omittester
N43  C                   ELSE
N43   * Ved omit må begrepet IKKE finnes i -arrayet (->80 off)
N43  C     1             do        5             NR
N43  C     TP(NR)        ifne      ' '
N43  C                   movel     TP(NR)        test4             4
N43  C     test4         LOOKUP    TR                                     80
N40  C   80              SETON                                        78
N43  c   80              goto      tilut
N43  C                   end
n43  c                   end
N43  C                   END                                                    III
N43  C                   ELSE                                                   II
      * ______________________________
      * trafikk sjø     Include / Omit
      * transportdisp benyttes til *IMP *EKSP *INN
      * """"""""""""""""""""""""""""""
     C     PTRAIO        IFNE      ' '                                          II
     C     PTRAIO        IFEQ      'I'                                          III
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     BLTR          LOOKUP    TR                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit må begrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     BLTR          LOOKUP    TR                                     80
     C   80              SETON                                        78
     C                   END                                                    III
     C                   END                                                    II
N40  C                   END                                                    II
N43  C                   END                                                    II
N59  C                   END                                                    III
N43  C     TILUT         TAG
      * ___________________________________
      * Frankatur/Oppdt. er låst ved brutto
      * """""""""""""""""""""""""""""""""""
     C     XKNR          IFNE      '    ALLE'                                   II
      * ______________________________
      * Frankatur     - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKFRIO        IFNE      ' '                                          III
     C     PKFRIO        IFEQ      'I'                                          IIII
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HEFR          LOOKUP    FR                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HEFR          LOOKUP    FR                                     80
     C   80              SETON                                        78
     C                   END                                                    IIII
     C                   END                                                    III
      *
      * ______________________________
      * Oppdr.type    - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKOTIO        IFNE      ' '                                          III
     C     PKOTIO        IFEQ      'I'                                          IIII
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HEOT          LOOKUP    OT                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i-arrayet (->80 off)
     C                   SETOFF                                       80
     C     HEOT          LOOKUP    OT                                     80
     C   80              SETON                                        78
     C                   END                                                    IIII
     C                   END                                                    III
      *
     C                   END                                                    II
      *
      * ______________________________
      * Landkode     - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKLKIO        IFNE      ' '                                          II
     C     PKLKIO        IFEQ      'I'                                          III
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     INOMLK        LOOKUP    LK                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit må begrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     INOMLK        LOOKUP    LK                                     80
     C   80              SETON                                        78
     C                   END                                                    III
     C                   END                                                    II
      *
      * ______________________________
      * Frasted      - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKFSIO        IFNE      ' '                                          II
     C     PKFSIO        IFEQ      'I'                                          III
N42  C     FS(1)         IFEQ      '*FRTI'
N42  C     HESDF         IFLT      FS(2)
N42  C     HESDF         ORGT      FS(3)
N42  C                   SETON                                        78
N42  C                   END
N42  C                   ELSE
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HESDF         LOOKUP    FS                                     80
     C  N80              SETON                                        78
N42  C                   END
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
N42  C     FS(1)         IFEQ      '*FRTI'
N42  C     HESDF         IFGE      FS(2)
N42  C     HESDF         ANDLE     FS(3)
N42  C                   SETON                                        78
N42  C                   END
N42  C                   ELSE
     C     HESDF         LOOKUP    FS                                     80
     C   80              SETON                                        78
N42  C                   END
     C                   END                                                    III
     C                   END                                                    II
      *
      * ______________________________
      * Tilsted      - Include / Omit
      * """"""""""""""""""""""""""""""
     C  N78PKTSIO        IFNE      ' '                                          II
     C     PKTSIO        IFEQ      'I'                                          III
N42  C     TS(1)         IFEQ      '*FRTI'
N42  C     HESDT         IFLT      TS(2)
N42  C     HESDT         ORGT      TS(3)
N42  C                   SETON                                        78
N42  C                   END
N42  C                   ELSE
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HESDT         LOOKUP    TS                                     80
     C  N80              SETON                                        78
N42  C                   END
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
N42  C     TS(1)         IFEQ      '*FRTI'
N42  C     HESDT         IFGE      TS(2)
N42  C     HESDT         ANDLE     TS(3)
N42  C                   SETON                                        78
N42  C                   END
N42  C                   ELSE
     C                   SETOFF                                       80
     C     HESDT         LOOKUP    TS                                     80
     C   80              SETON                                        78
N42  C                   END
     C                   END                                                    III
     C                   END                                                    II
      * ______________________________
      * Losssested      - Include / Omit
      *(Gebyrer som er betinget av valgfrie felt tas
      * aldri med dersom feltet i oppdraget er blankt)
      * """"""""""""""""""""""""""""""
     C  N78PKLSIO        IFNE      ' '                                          II
     C     HESDL         IFEQ      *BLANKS                                      III
     C                   SETON                                        78
     C                   ELSE
     C     PKLSIO        IFEQ      'I'                                          IIII
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HESDL         LOOKUP    LS                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HESDL         LOOKUP    LS                                     80
     C   80              SETON                                        78
     C                   END                                                    IIII
     C                   END                                                    III
     C                   END                                                    II
      *
      * ______________________________
      * Lastested      - Include / Omit
      *(Gebyrer som er betinget av valgfrie felt tas
      * aldri med dersom feltet i oppdraget er blankt)
      * """"""""""""""""""""""""""""""
     C  N78PKL2IO        IFNE      ' '                                          II
     C     HESDLA        IFEQ      *BLANKS                                      III
     C                   SETON                                        78
     C                   ELSE
     C     PKL2IO        IFEQ      'I'                                          IIII
      * Ved include må begrepet finnes i -arrayet (->80 on)
     C                   SETOFF                                       80
     C     HESDLA        LOOKUP    L2                                     80
     C  N80              SETON                                        78
     C                   ELSE
      * Ved omit måbegrepet IKKE finnes i -arrayet (->80 off)
     C                   SETOFF                                       80
     C     HESDLA        LOOKUP    L2                                     80
     C   80              SETON                                        78
     C                   END                                                    IIII
     C                   END                                                    III
     C                   END                                                    II
      *
s41  C*                  END                                                    I
      *
      * _______________________________________________________________
      * UTLØPSDATO (indikator 79 varsler at minsten linje i avt utløpt)
      * """""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     PKDT          IFGT      0
     C  N78
     CANN79PKDT          COMP      HEDTOP                               79
     C  N78PKDT          COMP      HEDTOP                               78
     C                   END
      * Linjen ok? (indikator 78 varsler at denne linje ikke gjelder)
      *
     C     UTGIO         ENDSR
      *
      ***********************************************
     C     SRTAB         BEGSR
      ***********************************************
      *
      *** SLÅ OPP I BRUTTOPRIS-TABELL
     C     X01B          IFEQ      'X'                                          1<-B
     C     PRANT         ANDGT     0
     C                   MULT      HENT          PRBELØ
     C                   END                                                    1<-E
     C     X01B          IFEQ      'T'                                          1<-B
     C     PRANT         ANDGT     0
     C                   MULT      ANTTEU        PRBELØ
     C                   END                                                    1<-E
     C     X01B          IFEQ      'F'                                          1<-B
     C     PRANT         ANDGT     0
     C                   MULT      FORANT        PRBELØ
     C                   END                                                    1<-E
      *
     C     X01B          IFEQ      'V'                                          1<-B
     C     PRBELØ        DIV       100           XWORK
     C     XWORK         MULT      TRVERB        PRBELØ
N30  c     prant         ifeq      0
     C                   MOVE      TRVERV        PKFVAL
     C                   MOVE      TRVERV        WSVAL
n30  C                   END                                                    1<-E
     C                   END                                                    1<-E
      *
     C     X01B          IFGE      '0'
     C     X01B          ANDLE     '9'
     C                   MOVE      'D'           X01B
     C                   END
      *
     C     X01B          IFEQ      'D'                                          1<-B
     C                   MOVE      *ZEROS        PRBELØ
     C                   END                                                    1<-E
      * TARRIFERINGSLINJER...
     C     X01B          IFEQ      'L'                                          1<-B
      *                    MULT HENTF     PRBELØ
     C                   MOVE      HENTF         XXNTF             4 0
      * JUST GITT UTEN FORTEGN => JUST. ER ANTALL FRIE LINJER
     C     PRJUST        IFNE      *ZEROS                                        2<-B
     C     PRTEGN        IFEQ      ' '                                           3<-B
     C                   SUB       PRJUST        XXNTF
     C                   ELSE                                                    3X
      * JUST GITT MED FORTEGN => TREKK GITT I KR.
      * PRANT (PRIS PR...) MÅ DA VÆRE GITT FOR Å GÅ I SR OMREGN
     C     PRANT         IFEQ      *ZEROS                                        4<-B
     C                   Z-ADD     1             PRANT
     C                   END                                                     4<-E
     C                   END                                                     3<-E
     C                   END                                                     2<-E
     C     XXNTF         IFLT      0                                             2<-B
     C                   MOVE      *ZEROS        XXNTF
     C                   END                                                     2<-E
     C                   MULT      XXNTF         PRBELØ
     C                   END                                                    1<-E
      *
     C     PRANT         IFGT      0
     C                   EXSR      OMREGN
     C                   END
      *
      * MINIMUM MAKSIMUM VED FRAKTAVTALE (men ikke postal)
      *
     C   99              DO
     C     KOAPOS        IFNE      'J'
     C                   Z-ADD     PRBELØ        XBELØB            7 0
     C     XBELØB        IFLT      FTMIN
     C                   Z-ADD     FTMIN         PRBELØ
     C                   END
     C     XFTMAX        IFNE      *ZEROS
     C     XBELØB        ANDGT     XFTMAX
     C                   Z-ADD     XFTMAX        PRBELØ
     C                   END
     C                   END
     C                   END
      * PROSENT AV FLYFRAKT
     C     KODGEK        CHAIN     KOGER                              75
     C     KGETYP        IFEQ      'FFE'
     C                   Z-ADD     DFBLT         PRBELØ
     C                   ADD       DFBLDC        PRBELØ
     C                   exsr      sumotha
     C                   add       wsblda        PRBELØ
     C     DFVAL         IFNE      *BLANKS
     C                   MOVE      DFVAL         WSVAL
     C                   END
     C                   END
      *
      * due carrier fra flyfraktbrev
      *
     C     KGETYP        IFEQ      'DUC'
     C                   Z-ADD     DFBLDC        PRBELØ
     C     DFVAL         IFNE      *BLANKS
     C                   MOVE      DFVAL         WSVAL
     C                   END
     C                   END
      *
      * due agent   fra flyfraktbrev
      *
     C     KGETYP        IFEQ      'DUA'
     C                   exsr      sumotha
     C                   z-add     wsblda        PRBELØ
     C     DFVAL         IFNE      *BLANKS
     C                   MOVE      DFVAL         WSVAL
     C                   END
     C                   END
      *
      * FFT frakt   fra flyfraktbrev
      *
     C     KGETYP        IFEQ      'FFT'
     C                   Z-ADD     DFBLT         PRBELØ
     C     DFVAL         IFNE      *BLANKS
     C                   MOVE      DFVAL         WSVAL
     C                   END
     C                   END
      *
      * NY GEBYRTYPE FFF SOM GIR FLYFRAKT DIREKTE PÅ FAKTURA
      *
      *
     C     KGETYP        IFEQ      'FFF'
     C                   move      'F'           ufkode
     C                   z-add     FLYVKT        uvekt             5 0
     C     xknr          ifne      '    ALLE'
     C                   MOVE      XKNR          ukunde
     c                   end
     C                   MOVEL     HEGN          HEGN07            7
     C                   MOVE      HEGN07        HEGN03            3
     C                   TESTN                   HEGN03               75
     C                   MOVE      *ZEROS        UFLY
     C   75              MOVE      HEGN03        UFLY
     C                   MOVE      HEKDPL        UPT
      *
     C                   call      'SYGE32'
     c                   parm                    uPT               1
     c                   parm                    ufly              3 0
     c                   parm                    ukunde            8 0
     c                   parm                    HESDF             5
     c                   parm                    HESDT             5
     c                   parm                    ufKODE            1
     c                   parm                    uvekt             5 0
     c                   parm                    UBELOP           13 2
     c                   parm                    UVAL              3
     C                   Z-ADD     UBELOP        PRBELØ
     C     UVAL          IFNE      *BLANKS
     C                   MOVE      UVAL          WSVAL
     C                   END
     C                   END
      *
      *** PROSENTAVTALE ?
      *
     C     XPROS         IFNE      0
     C     XPROS         IFNE      0.001
     C     PRBELØ        DIV       100           XWORK
     C     XWORK         MULT(H)   XPROS         PRBELØ
     C   99              EXSR      MIMASR
     C                   ELSE                                                   MOTKOSTN.
     C                   Move      *zeros        XWORK
     C                   Move      *zeros        PRBELØ
     C                   END
     C                   END
      *
     C     LEVAVT        IFNE      'J'
     C                   Z-ADD(H)  PRBELØ        WSBELV
     C                   Z-ADD(H)  PRBELØ        XBELN
     C                   ELSE                                                   MOTKOSTN.
     C                   Z-ADD(H)  PRBELØ        WSBELU                         LEVERANDØR..
     C                   END
      *
     C                   ENDSR
      *
      ******************************************
     C     BERFRP        BEGSR
      ******************************************
S54  C*                  MOVEA     *BLANKS       GNT
S54  C*                  MOVE      *ZEROS        GN
     C                   MOVE      *ZEROS        WSAGRN
      *
      * Finn frakt i kundersfraktavtale
      *
     C                   MOVE      *ZEROS        UUBELØ           13 2
     C                   MOVE      *BLANKS       WSVAL
     C                   MOVE      XTKNR         UKN               8 0
     C                   CALL      'SYGE04'
     C                   PARM                    KGEKOD
     C                   PARM                    KGETYP
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UKN
     C                   PARM                    WSVAL
     C                   PARM                    UUBELØ
     C                   PARM                    UAVNR             9 0
     C                   PARM                    UAVMSG           50
     C                   PARM                    WSSK
     C     UAVMSG        IFNE      *BLANKS                                      1<-B
     C     KGETYP        ANDEQ     'FRA'
     C                   MOVEL     UAVMSG        UMSG
     C                   END                                                    1<-E
     C     UAVNR         IFNE      *ZEROS                                       1<-B
     C                   MOVE      UAVNR         UUAVNR            9 0
     C                   MOVE      UAVNR         WSAGRN
     C     UAVNR         CHAIN     AVFRHL01                           76
     C     AFBFR1        IFEQ      'N'                                           2<-B
     C                   ADD       1             GN                2 0
     C                   MOVE      'FR1'         GNT(GN)
     C                   END                                                     2<-E
     C     AFBFR2        IFEQ      'N'                                           2<-B
     C                   ADD       1             GN                2 0
     C                   MOVE      'FR2'         GNT(GN)
     C                   END                                                     2<-E
     C     GNAT          IFEQ      *BLANKS                                       2<-B
     C                   SORTA     GNT
     C                   ELSE                                                    2
     C     1             DO        10            GG                2 0            3<-B
     C     GNA(GG)       IFNE      *BLANKS                                         4<-B
     C                   ADD       1             GN                2 0
     C                   MOVE      GNA(GG)       GNT(GN)
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   SORTA     GNT
     C                   EXSR      DELLI
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C                   MOVE      'A'           XKDA
      *
     C     UUBELØ        IFEQ      0
     C     WSVAL         ANDEQ     *BLANKS
     C                   MOVE      *ZEROS        URABAT
     C                   MOVE      'B'           XKDA
     C                   CALL      'SYGE03'
     C                   PARM                    KGETYP
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    WSVAL
     C                   PARM                    UUBELØ
     C                   PARM                    USONE             5
     C                   PARM                    URABAT            5 2
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    UKN
     C                   PARM                    UAVNR             9 0
N13  c                   PARM                    ATDUM             1
     C     UKN           IFNE      *ZEROS
     C     UUBELØ        ANDNE     *ZEROS
     C                   MOVE      'A'           XKDA
     C                   END
     C                   END
     C                   Z-ADD     UUBELØ        PRBELØ
     C     URABAT        IFNE      *ZEROS
     C                   MOVE      'A'           XKDA
     C                   END
      *
     C                   ENDSR
      *
      ******************************************
     C     DELLI         BEGSR
      ******************************************
     C                   SORTA     GNA
      *
     C                   MOVE      WSSK          XSK
     C     FAK4K         SETLL     FAK4
     C     STDELI        TAG
     C     FAK4K         READE     FAK4                                   76
     C   76              GOTO      SLDELI
     C     FAVK          LOOKUP    GNA                                    80
      *
     C   80FAKTK         CHAIN     FAKT                               76
     C   80
     CANN76FAOPKO        IFLT      'D'
     C   80
     CANN76              DELETE    FAKTR
     C   80
     CANN76              EXSR      DLTFTXT
     C   80
     CANN76
     CANN35              EXSR      MSALDO                                       TREKK SALDO
     C                   ELSE
     C                   UPDATE    FAKTR
     C                   END
     C                   GOTO      STDELI
      *
     C     SLDELI        TAG
      *
     C                   ENDSR
      *
      ******************************************
     C     DELGH         BEGSR
      ******************************************
     C                   SORTA     GNT
      *
     C                   MOVE      WSSK          XSK
     C     FAK4K         SETLL     FAK4
     C     FAK4K         READE     FAK4                                   76
      *
     C     *IN76         DOWEQ     '0'
     C     FAVK          LOOKUP    GNT                                    80
     C   80FAKTK         CHAIN     FAKT                               76
      * ALLE REKORD I FAK4 HAR ENTEN BLANK ELLER C I FAOPKO. TEST ER UNØDVENDIG.
     C   80
     CANN76              DELETE    FAKTR
     C   80
     CANN76              EXSR      DLTFTXT
     C   80
     CANN76
     CANN35              EXSR      MSALDO                                       TREKK SALDO
     C     FAK4K         READE     FAK4                                   76
     C                   END
      *
     C                   ENDSR
      *
      ******************************************
     C     BERFRA        BEGSR
      ******************************************
      *
      * BEREGNER TOLLPOST INLANDSFRAKT
      *
     C                   MOVE      *ZEROS        XFTMAX
     C     KGETYP        IFEQ      'TGI'
     C     *LOVAL        SETLL     FRSTTG
     C                   READ      FRSTTG                                 33
     C  N33TGEK          COMP      *BLANKS                                33
     C                   IF        *IN33
     C                   EXSR      TGISR
     C                   ELSE
     C                   EXSR      TGIHTTP
     C                   END
     C                   MOVE      XTKNR         XTKNRG
     C                   GOTO      SLSHF
     C                   END
      *
      *
     C     KGETYP        IFEQ      'TGF'
     C                   CALL      'SYTGF1'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    PKMVA
     C                   PARM                    KGEUTL
     C                   PARM                    WSVK
     C                   GOTO      SLSHF
     C                   END
      * TRANSPORTOPPDRAG...
      * VANLIG FRAKT GEBKOD:"FRA" BLIR IKKE! BEREGNET HER. DET SKJER
      * ALLTID FRA SYTR10 OG BLIR LAGT I FAKT.LINJE 00000
      *(HVEM BELASTES HVA../AVTALE SKAL VED TR.MODUL IKKE INNEHOLDE
      * "FRA" ... HVIS "FRA" ANGITT DER ER DET KUN FOR Å STYRE SAMMEN-
      * SLÅINGSKODE ... SE I SR: TSTGIO )
      * NÅR EN I TRANSP.MODUL LIKEVEL ER KOMMET HIT ER DET ALTSÅ
      * "FRAKTRELATERTE" GEBYR (F.EKS VAL-TILLEGG) DET ER SNAKK OM.
      * ELLER ENDRING AV LINJE-FOR EKS FOR Å HENTE FORV/HENG/KOMPL..
      *(LOGIKKEN FLYTTER FORAN!! TEST MOT POSTAL.....)
     C     HEUR          IFEQ      'H'
     C     WSKOM         ANDEQ     0
     C     TRFRAB        IFNE      *ZEROS
     C     PKAVTT        ANDNE     'T'
N45  C                   MOVE      'A'           XKDA
     C                   Z-ADD     TRFRAB        PRBELØ
     C                   MOVE      TRFRAV        PKFVAL
     C                   MOVE      TRFRAV        WSVAL
     C                   MOVE      XTKNR         XTKNRG
     C                   GOTO      SLBFR
     C                   END
     C                   END
      *
     C     KOAPOS        IFEQ      'J'
     C     KGETYP        ANDNE     'SEA'
     C     HEUR          IFEQ      'A'
     C     HEUR          OREQ      'B'
N26  C     HEUR          OREQ      'C'
N26  C     HEUR          OREQ      'D'
     C     HEUR          OREQ      'H'
     C     HEUR          OREQ      'F'
     C     HEUR          OREQ      'G'
     C                   EXSR      BERFRP
     C                   MOVE      *ZEROS        PRANT
     C                   MOVE      *BLANKS       X01B
     C                   MOVE      XTKNR         XTKNRG
     C                   GOTO      SLSHF
     C                   END
     C                   END
     C                   MOVE      XTKNR         XTKNRG
      *
      * BEREGNER FRAKT
      *
      * FORFRAKT
     C     KGETYP        IFEQ      'FR1'
     C                   MOVE      HESDFF        XTFRA
     C                   MOVE      HESDF         XTTIL
     C                   MOVE      SONEFF        XSONEF
     C                   MOVE      SONEF         XSONET
     C                   END
      * ETTERFRAKT
     C     KGETYP        IFEQ      'FR2'
     C                   MOVE      HESDT         XTFRA
     C                   MOVE      HESDVT        XTTIL
     C                   MOVE      SONET         XSONEF
     C                   MOVE      SONEVT        XSONET
     C                   END
      *
      * HENTER SONETABELL VED INNENLANDSFRAKT
      *
     C     KGETYP        IFEQ      'FRI'
     C     HESDVT        CHAIN     STED2                              32
     C     ST2SOI        IFNE      *ZEROS
     C                   MOVE      ST2SOI        XTTIL
     C                   MOVE      ST2SOI        XTFRA
     C                   MOVEL     'IS'          XTTIL
     C                   MOVEL     'IS'          XTFRA
     C                   MOVE      *BLANKS       XSONEF
     C                   MOVE      *BLANKS       XSONET
     C                   END
     C                   END
      *
      *
     C                   MOVE      HEFR          XTFRAN
     C                   MOVE      HEOT          XTOT
     C                   MOVE      *ZEROS        PRJUST
     C                   MOVE      *ZEROS        PRBELØ
     C                   MOVE      *ZEROS        FTMIN
     C                   MOVE      *BLANKS       X01B
     C* AVDELINGEOPPLYSNING ER BARE DEFAULT VED VEDLIKEHOLD
      *
      *  32 = IKKE FUNNET FRAKTAVTALE
      *
     C                   Z-ADD     1             XN                2 0          VGR.AVD
     C                   SETON                                        32
     C                   MOVE      ' '           XKDA
     C     STBF00        TAG
      *  DERSOM FORFRAKT ALT ER INNKALK I HOVEDFRAKT (86) SKIPP BEREGNING
      *  AV SEPARAT FORFRAKT, MEN ..Bytt navn i heading på bilde (frakt fra)
      *
     C   86KGETYP        IFEQ      'FR1'
     C     HESDFF        CHAIN     STED2                              86
     C  N86              MOVEL     ST2NVN        WSFRA
     C                   SETOFF                                       86
     C                   GOTO      SLBFR
     C                   END
      *  DERSOM FORFRAKT IKKE INNKALK I HOVEDFRAKT (N86) BEREGN FORFRAKT
      *
     C  N86HESDFF        IFNE      *BLANKS
     C     KGETYP        ANDEQ     'FR1'
     C                   MOVE      HEOT          XTOT
     C                   EXSR      CHAINF
     C                   END
      *
      *  ORDINÆR HOVEDFRAKT:
      *  FORSØK FØRST  FRA FORFRAKTSTED TIL HOVEDFRAKTS ENDEDESTINASJON
      *
     C     KGETYP        IFEQ      'FRA'
     C     KGETYP        OREQ      'SEA'
     C                   SETON                                        32
     C  N86
     CANN27HESDFF        IFNE      *BLANKS
     C                   MOVE      HESDFF        XTFRA
     C                   MOVE      SONEFF        XSONEF
     C                   MOVE      HESDT         XTTIL
     C                   MOVE      SONET         XSONET
     C                   MOVE      HEOT          XTOT
     C                   EXSR      CHAINF
     C  N32              SETON                                        86
     C                   END
     C                   END
      *
      * IKKE FORSØKT ELLER IKKE FUNNET FORFRAKT FRA - HOVED FRAKT ENDE
      * FORSØK ORDINÆR.
      *
     C   32
     CANN27KGETYP        IFEQ      'FRA'
     C     KGETYP        OREQ      'SEA'
     C                   MOVE      HESDF         XTFRA
     C                   MOVE      SONEF         XSONEF
     C                   MOVE      HESDT         XTTIL
     C                   MOVE      SONET         XSONET
     C                   MOVE      HEOT          XTOT
     C                   EXSR      CHAINF
     C                   END
     C*
     C* BEREGNER INNLANDSFRAKT
     C*
     C     KGETYP        IFEQ      'FRI'
     C                   EXSR      CHAINF
     C                   END
      *
      *
      * BEREGNER VIDEREFRAKT
      *
     C     KGETYP        IFEQ      'FR2'
     C                   EXSR      CHAINF
     C                   END
      *
      * 32 PÅ INGEN AVTALE
      * B=BRUTTODRATE / A=AVTALEPRIS
      *
     C     XKDA          IFEQ      ' '
     C                   MOVE      'A'           XKDA
     C                   ELSE
     C                   MOVE      'B'           XKDA
     C                   END
     C     *IN32         CABEQ     '1'           STBFR
      *
      * KOMMER HIT KUN VED KUNDEAVTALE
      *
      *
      * SKJEKKER OM AVVIKKENDE FRAKTBEREGNING
      *
     C     FTKOLL        IFNE      *BLANKS
     C                   EXSR      TSTAVV
     C     HOPP          IFEQ      'J'
     C                   GOTO      SLBFR
     C                   END
     C                   ELSE
     C                   MOVE      HEFBV         LOKUPF            9 0
      * SKJEKKER OM DIVERGERENDE OMREGNING
     C     FTM3OM        IFNE      *ZEROS
     C     FTLMOM        ORNE      *ZEROS
     C                   EXSR      BERFVK
     C                   END
     C                   END
      *
      * SJEKK OM KUNDEN HAR EGEN VEKTGR.INNDELING I FRAKTAVTALEN
      *
     C                   Z-ADD     1             XN                2 0          VGR.AVD
     C     LOKUPF        IFGT      99999
     C                   MOVE      99999         LOKUP2            5 0
     C                   ELSE
     C                   Z-ADD     LOKUPF        LOKUP2
     C                   END
     C     LOKUP2        LOOKUP    FV(XN)                             76  76
     C                   SETOFF                                       76
      *
     C     PKAVTT        IFNE      'P'                                          1<-B
     C     PKAVTT        ANDNE     'H'                                          1<-B
     C                   Z-ADD     FB(XN)        PRBELØ
      * BENYTTER ALLTID AVTALENS FTPRPR
     C                   Z-ADD     FTPRPR        PRANT
      * SKJEKKER OM FAST PRIS TIL OG MED
     C     XN            IFLE      FTFAST                                         3<-B
     C                   Z-ADD     0             PRANT
     C                   END                                                      3<-E
      * PRIS PR KOLLI
     C  N76FTKOLL        IFEQ      'X'                                           2<-B
     C                   MULT      HENT          PRBELØ
     C                   Z-ADD     0             PRANT
     C                   END                                                     2<-E
      * PRIS PR KOLLI
     C  N76FTKOLL        IFEQ      'T'                                           2<-B
     C                   MULT      ANTTEU        PRBELØ
     C                   Z-ADD     0             PRANT
     C                   END                                                     2<-E
      * PRIS PR FORDELING
     C  N76FTKOLL        IFEQ      'F'                                           2<-B
     C                   MULT      FORANT        PRBELØ
     C                   Z-ADD     0             PRANT
     C                   END                                                     2<-E
      * PRIS VED VAREVERDI
     C  N76FTKOLL        IFEQ      'V'                                           2<-B
     C     PRBELØ        DIV       10000         XWORK
     C     XWORK         MULT      TRVERB        PRBELØ
N30  c     prant         ifeq      0
     C                   MOVE      TRVERV        PKFVAL
     C                   MOVE      TRVERV        WSVAL
n30  C                   END                                                    1<-E
     C                   Z-ADD     0             PRANT
     C                   END                                                     2<-E
      * PRIS MEN GRUNNPRISLOGIKK
     C  N76FTKOLL        IFEQ      'G'                                           2<-B
     C                   MULT      LOKUPF        PRBELØ
     C                   DIV       100           PRBELØ
     C                   ADD       FTMIN         PRBELØ
     C                   Z-ADD     0             PRANT
     C                   END                                                     2<-E
      * PRIS PR KOLLI
     C  N76FTKOLL        IFEQ      'M'                                           2<-B
     C     FTKOLL        OREQ      'L'
     C     XN            IFGT      FTFAST                                         3<-B
     C                   MULT      LOKUPF        PRBELØ
     C                   DIV       100           PRBELØ
     C                   END                                                      3<-E
     C                   Z-ADD     0             PRANT
     C                   END                                                     2<-E
      *  HA AVTALE MEN IKKE PROSENTAVTALE
      *  KALL PÅ SRMIMA GJORT UAVHENGIG AV KOWMM
     C                   MOVE      FTMM          KOWMM
N10  C     PRBELØ        IFGT      0
     C                   EXSR      SRMIMA
N10  C                   END
      *
      * FOR BRUTTO FLYTTER AVTALEAVHENGING  MIN OG MAX
     C     XTKNR         IFEQ      0
     C     XFTMIN        ANDNE     0
     C                   Z-ADD     XFTMIN        FTMIN
     C                   END
      *
     C                   GOTO      SLBFR
     C                   END                                                    1<-E
      *
      * PROSENTAVTALE START
      *
     C     XTKNR         IFNE      0
     C     XPROS         IFEQ      *ZEROS
     C                   Z-ADD     FB(XN)        XPROS
     C                   ELSE
      * PROSENT AV PROSENTAVTALE
     C     FB(XN)        MULT      XPROS         XPROS
     C                   DIV       100           XPROS
     C                   END
     C                   Z-ADD     FTMIN         XFTMIN            5 0
     C                   END
      *
      * BEREGN SJØ-FRAKT UTFRA KUNDE-AVTALE
     C     STBFR         TAG
     C     KGETYP        IFEQ      'SEA'
     C     HEUR          IFEQ      'G'
     C     HEUR          OREQ      'F'
     C                   EXSR      BFRSJØ
     C     XSJØ          CABEQ     'J'           SLBFR
     C                   END
     C                   END
      *
     C     XTKNR         IFNE      0
      *    *******
      *     BRUTTO
      *    *******
     C                   MOVE      *ZEROS        XTKNR
     C                   MOVE      HEOT          XTOT
     C                   MOVE      HEFR          XTFRAN
     C                   GOTO      STBF00
     C                   END
      *
     C     SLBFR         TAG
     C                   MOVE      XTKNRG        XTKNR
     C     SLSHF         TAG
     C                   SETOFF                                       32
      *
     C                   ENDSR
      *
      ******************************************
     C     BFRSJØ        BEGSR
      * BEREGNER SJØ-FRAKT UTFRA KUNDE-AVTALE
      ******************************************
     C     HEADFK        SETLL     BLV1LF                             75
     C     STBFRS        TAG
     C     HEADFK        READE     BLV1LF                                 75
     C  N75              DO
     C                   MOVE      HEOT          XTOT
     C                   MOVE      BLTR          XTRAF
     C                   MOVE      '1'           XTRRU             1
     C     STBFR1        TAG
      * LASTESTED - LOSSESTED
     C     HESDFF        IFNE      *BLANKS
     C     HESDVT        ANDNE     *BLANKS
     C                   MOVE      HESDFF        YSDF
     C                   MOVE      HESDVT        YSDT
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
      * SE OM DET FINNES AVTALE PÅ STEDSKODE-2
     C     SONEFF        IFNE      *BLANKS                                       2<-B
     C                   MOVE      SONEFF        YSDF
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
     C                   END                                                     2<-E
     C     SONEVT        IFNE      *BLANKS                                       2<-B
     C                   MOVE      HESDFF        YSDF
     C                   MOVE      SONEVT        YSDT
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
     C     SONEFF        IFNE      *BLANKS                                        3<-B
     C                   MOVE      SONEFF        YSDF
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END
      * LASTESTED - LOSSEHAVN
     C     HESDFF        IFNE      *BLANKS
     C     HESDT         ANDNE     *BLANKS
     C                   MOVE      HESDFF        YSDF
     C                   MOVE      HESDT         YSDT
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
      * SE OM DET FINNES AVTALE PÅ STEDSKODE-2
     C     SONEFF        IFNE      *BLANKS                                       2<-B
     C                   MOVE      SONEFF        YSDF
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
     C                   END                                                     2<-E
     C     SONET         IFNE      *BLANKS                                       2<-B
     C                   MOVE      HESDFF        YSDF
     C                   MOVE      SONET         YSDT
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
     C     SONEFF        IFNE      *BLANKS                                        3<-B
     C                   MOVE      SONEFF        YSDF
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END
      * LASTEHAVN - LOSSEHAVN
     C     HESDF         IFNE      *BLANKS
     C     HESDT         ANDNE     *BLANKS
     C                   MOVE      HESDF         YSDF
     C                   MOVE      HESDT         YSDT
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
      * SE OM DET FINNES AVTALE PÅ STEDSKODE-2
     C     SONEF         IFNE      *BLANKS                                       2<-B
     C                   MOVE      SONEF         YSDF
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
     C                   END                                                     2<-E
     C     SONET         IFNE      *BLANKS                                       2<-B
     C                   MOVE      HESDF         YSDF
     C                   MOVE      SONET         YSDT
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
     C     SONEF         IFNE      *BLANKS                                        3<-B
     C                   MOVE      SONEF         YSDF
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END
      * LASTEHAVN - LOSSESTED
     C     HESDF         IFNE      *BLANKS
     C     HESDVT        ANDNE     *BLANKS
     C                   MOVE      HESDF         YSDF
     C                   MOVE      HESDVT        YSDT
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
      * SE OM DET FINNES AVTALE PÅ STEDSKODE-2
     C     SONEF         IFNE      *BLANKS                                       2<-B
     C                   MOVE      SONEF         YSDF
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
     C                   END                                                     2<-E
     C     SONEVT        IFNE      *BLANKS                                       2<-B
     C                   MOVE      HESDF         YSDF
     C                   MOVE      SONEVT        YSDT
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
     C     SONEF         IFNE      *BLANKS                                        3<-B
     C                   MOVE      SONEF         YSDF
     C     CFRATK        CHAIN     CFRAT                              75
     C  N75              GOTO      STBFR2
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END
     C     XTOT          IFNE      'GE'
     C                   MOVE      'GE'          XTOT
     C                   GOTO      STBFR1
     C                   END
     C     XTRAF         IFNE      *blanks
     C     XTRRU         ANDEQ     '1'
     C                   MOVE      *blanks       XTRAF
     C                   MOVE      '2'           XTRRU
     C                   GOTO      STBFR1
     C                   END
     C     STBFR2        TAG
      *
     C  N75              DO
     C     XSJØ          IFEQ      'N'
     C     LEVAVT        IFNE      'J'
     C                   MOVE      *ZEROS        WSBELV
     C                   MOVE      *ZEROS        XBELN
     C                   MOVE      FTVAL         PKFVAL
     C                   MOVE      FTVAL         WSVAL
     C                   MOVE      'J'           XSJØ
     C                   END
     C                   END
     C     BVNT          MULT      FTPRIS        XWORK
     C     LEVAVT        IFNE      'J'
     C                   ADD       XWORK         WSBELV
     C                   ADD       XWORK         XBELN
     C                   ELSE                                                   MOTKOSTNAD
     C                   ADD       XWORK         WSBELU                         FRA LEVERAND
     C                   END
     C                   END
     C                   SETOFF                                       75
     C                   GOTO      STBFRS
     C                   END
      *
     C                   ENDSR
      *
      ******************************************
     C     SRMIMA        BEGSR
      ******************************************
      *
      * KOMPLETT LASS
     C   40WSKOM         IFGT      *ZEROS
     C     WSKOM         ANDLT     4
     C                   Z-ADD     AX(WSKOM)     PRBELØ
     C                   MOVE      *ZEROS        FTMIN
     C                   MOVE      *ZEROS        XFTMAX            5 0
     C                   MOVE      *ZEROS        PRANT
     C                   GOTO      SLMIMA
     C                   END
      *
     C     FTMIN         IFGT      *ZEROS                                       1<-B
     C     XN            ANDEQ     1
     C     KOWMM         IFEQ      2                                             2<-B
     C                   Z-ADD     FM(XN)        XFTMAX
     C                   END                                                     2<-E
     C                   ELSE                                                   1
     C     KOWMM         IFEQ      1                                             2<-B
     C                   Z-ADD     FM(XN)        FTMIN
     C                   ELSE                                                    2
     C     KOWMM         IFEQ      2                                              3<-B
     C                   Z-ADD     FM(XN)        XFTMAX
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
      * LEGGER UT KOMPLETT LASS I MAX HVIS FOREFINNES
      *
     C     AX(3)         IFNE      *ZEROS
     C     XFTMAX        IFGT      AX(3)
     C                   Z-ADD     AX(3)         XFTMAX
     C                   END
     C     XFTMAX        IFEQ      *ZEROS
     C                   Z-ADD     AX(3)         XFTMAX
     C                   END
     C                   END
     C     SLMIMA        ENDSR
      *
      ***********************************************
     C     CHAINF        BEGSR
      ***********************************************
      * CHAINER I FRAKTREGISTER   - HOVEDFRAKT ORDINÆR
      * (SETT INDIKATOR DERSOM IKKE BEHOV FOR Å CHAINE EVT. SONEFRAKT)
     C     XSONEF        COMP      *BLANKS                            2828
N35   * indikator 29 er i denne rutine byttet med indikator 34
E35  C     XSONET        COMP      *BLANKS                            3434
      *
     C     FRATK         CHAIN     FRATN                              32        *RENE STEDSKODER
     C   32
     CAN 28FRATK2        CHAIN     FRATN                              32        *SONE FRA
     C   32
E35  CAN 34FRATK3        CHAIN     FRATN                              32        *SONE TIL
     C   32
     CAN 28
E35  CAN 34FRATK4        CHAIN     FRATN                              32        *SONE FRA/TIL
     C   32              MOVE      'GE'          XTOT
     C   32FRATK         CHAIN     FRATN                              32        *RENE STEDSKODER
     C   32
     CAN 28FRATK2        CHAIN     FRATN                              32        *SONE FRA
     C   32
E35  CAN 34FRATK3        CHAIN     FRATN                              32        *SONE TIL
     C   32
     CAN 28
E35  CAN 34FRATK4        CHAIN     FRATN                              32        *SONE FRA/TIL
      *
      * VALUTAKODE PÅ FRAKAVTALEN (ELLER BRUTTO)??
      *
     C     FTVAL         IFNE      *BLANKS
     C                   MOVE      FTVAL         PKFVAL
     C                   MOVE      FTVAL         WSVAL
     C                   END
     C                   ENDSR
      *
      *
      ***********************************************
     C     TSTAVV        BEGSR
      ***********************************************
      *
      * SKJEKKER AVVIKENDE BERGNINGSMETODE
      *
      * KUBIKKPRIS
      *
     C                   MOVE      *BLANKS       HOPP              1
     C                   MOVE      HEFBV         LOKUPF
     C     FTKOLL        IFEQ      'M'                                          1<-B
     C     HEM3          IFNE      *ZEROS                                        2<-B
     C                   MOVE      *ZEROS        LOKUPF
     C                   MOVE      HEM3N         LOKUPF
     C                   MOVE      0             FTPRPR
     C                   ELSE                                                    2
     C                   MOVE      'J'           HOPP
     C                   GOTO      SLBFRX
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      * LASTEMETERPRIS
     C     FTKOLL        IFEQ      'L'                                          1<-B
     C     HELM          IFNE      *ZEROS                                        2<-B
     C                   MOVE      *ZEROS        LOKUPF
     C                   MOVE      HELM          LOKUPF
     C                   MOVE      0             FTPRPR
     C                   ELSE                                                    2
     C                   MOVE      'J'           HOPP
     C                   GOTO      SLBFRX
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      * ANTALL TEUS
     C     FTKOLL        IFEQ      'T'
     C     ANTTEU        IFNE      0
     C     ANTTEU        IFGT      99999
     C                   Z-ADD     99999         LOKUPF
     C                   ELSE
     C                   Z-ADD     ANTTEU        LOKUPF
     C                   END
     C                   ELSE                                                    2
     C                   MOVE      'J'           HOPP
     C                   GOTO      SLBFRX
     C                   END                                                     2<-E
     C                   END
      * KOLLIPRIS
     C     FTKOLL        IFEQ      'X'                                          1<-B
     C     HENT          IFNE      *ZEROS                                        2<-B
     C                   Z-ADD     HENT          LOKUPF
     C                   ELSE                                                    2
     C                   MOVE      'J'           HOPP
     C                   GOTO      SLBFRX
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      * ANTALL FORDELTE FRAKTBREV
     C     FTKOLL        IFEQ      'F'                                          1<-B
     C     FORANT        IFNE      *ZEROS                                        2<-B
     C                   Z-ADD     FORANT        LOKUPF
     C                   ELSE                                                    2
     C                   MOVE      'J'           HOPP
     C                   GOTO      SLBFRX
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      * KILOPRIS
     C     FTKOLL        IFEQ      'B'                                          1<-B
     C     HEVKT         IFNE      *ZEROS                                        2<-B
     C                   MOVE      HEVKT         LOKUPF
     C                   MOVE      HEVKT         HEFBV
     C                   ELSE                                                    2
     C                   MOVE      'J'           HOPP
     C                   GOTO      SLBFRX
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      * SKJEKKER OM DIVERGERENDE OMREGNING
     C     FTKOLL        IFEQ      'G'                                          1<-B
     C     FTM3OM        IFNE      *ZEROS                                        2<-B
     C     FTLMOM        ORNE      *ZEROS
     C                   EXSR      BERFVK
     C                   MOVE      HEFBV         LOKUPF
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C                   MOVE      LOKUPF        HEFBV
     C     SLBFRX        ENDSR
      ******************************************
     C     BERFVK        BEGSR
      ******************************************
      *
      * FINNER FRAKTBEREGNINGSVEKT
      *
     C     HELM          MULT      FTLMOM        XFBV1             9 0
     C     HEM3          MULT      FTM3OM        XFBV2             9 0
     C     HEVKT         IFGE      XFBV1
     C                   MOVE      HEVKT         HEFBV
     C                   ELSE
     C                   MOVE      XFBV1         HEFBV
     C                   END
     C     HEFBV         IFLT      XFBV2
     C                   MOVE      XFBV2         HEFBV
     C                   END
      *
     C                   MOVE      HEFBV         LOKUPF
      *
     C                   ENDSR
      ***********************************************
     C     PRSETL        BEGSR
      ***********************************************
      *
      *** SETTER LOWER LIMIT MED ANNED VERDI ENN VEKTBEGREPENE
     C     X01B          IFEQ      'X'
     C                   MOVE      HENT          XINT
     C                   END
     C     X01B          IFEQ      'T'
     C                   MOVE      ANTTEU        XINT
     C                   END
     C     X01B          IFEQ      'F'
     C                   MOVE      FORANT        XINT
     C                   END
     C     X01B          IFEQ      'L'
     C                   Z-add     HENTF         XINT
     C                   END
     C     X01B          IFEQ      'B'
     C     HEVKT         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEVKT         XINT
     C                   END
     C                   END
      * vareverdi kan også staffeleres
N30  C     X01B          IFEQ      'V'
N30  C     TRVERN        IFGT      99999
N30  C                   Z-ADD     99999         XINT
N30  C                   ELSE
N30  C                   Z-ADD(H)  TRVERN        XINT
N30  C                   END
N30  C                   END
     C     X01B          IFEQ      'M'
     C     HEM3          ADD(H)    0.499         XINT
     C                   END
     C     X01B          IFGE      '0'
     C     X01B          ANDLE     '9'
     C                   MOVE      'D'           X01B
     C                   END
     C     X01B          IFEQ      'D'
     C                   Z-ADD     0             XINT
     C                   END
     C  N99PRISKK        SETLL     PRIS
     C  N99WSTNR         READE     PRIS                                   32
      *
     C                   ENDSR
      *
      ***********************************************
     C     NYPA          BEGSR
      ***********************************************
      *
      *** LEGGE UT NY POST I FAKTURAREGISTER
      *
     C                   EXSR      MOVWSF
      *
     C     FAVAL         IFEQ      FICURR                                       1<-B
     C                   EXSR      VALUTA
     C                   ELSE                                                   1
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
     C     FASK          IFEQ      'S'                                           2<-B
     C     HEVALS        IFNE      '   '                                          3<-B
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     HEVALK        IFNE      '   '                                          3<-B
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
      * HENT GEBYRKODE INFO
      *
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
      *
      *
      *
     C                   EXSR      SPLISR
      *
     C                   EXSR      NYFAK
      *
      * ADD A LINE DEPENDING ON FREIGHT AMOUNTH
      *
     C     KGETYP        IFEQ      'FRA'                                        1<-B
     C     XPROS         ANDEQ     0
     C     HEVALT        ANDNE     *BLANKS
     C     HEVALP        ANDNE     *ZEROS
     C                   MOVE      HEVALT        FAVK
     C                   MULT(H)   HEVALP        FABELN
     C                   MULT(H)   HEVALP        FABELV
      *
     C                   EXSR      SPLISR
      *
      *ALLTID + 1 TIL FALI VED VALUTATILLEGG ETC
      *DA IKKE MOVWSF KALLES
      *
     C                   ADD       1             FALI
     C                   EXSR      NYFAK
     C                   END                                                    1<-E
     C     KGETYP        IFEQ      'FRA'                                        1<-B
     C     XPROS         ANDEQ     0
     C                   EXSR      VEISR
     C                   END
      *
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ***********************************************
     C     NYPB          BEGSR
      ***********************************************
      *
      *** ADDS NEW RECORD TO INVOICE FILE
      *                    MOVE WSSK      XSK2    1
     C                   EXSR      MOVWSF
      *
     C     FAVAL         IFEQ      FICURR                                       1<-B
     C                   EXSR      VALUTA
     C                   ELSE                                                   1
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
     C     FASK          IFEQ      'S'                                           2<-B
     C     HEVALS        IFNE      '   '                                          3<-B
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     HEVALK        IFNE      '   '                                          3<-B
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
      *
      *
     C                   EXSR      SPLISR
      *
     C                   EXSR      NYFAK
      *
      * ADDS CURRENCYPERCENT TO THE AMOUNTH
      *
     C     KGETYP        IFEQ      'FRA'                                        1<-B
     C     XPROS         ANDEQ     0
     C     HEVALT        ANDNE     *BLANKS
     C     HEVALP        ANDNE     *ZEROS
     C                   MOVE      HEVALT        FAVK
     C                   MULT(H)   HEVALP        FABELN
     C                   MULT(H)   HEVALP        FABELV
      *
     C                   EXSR      SPLISR
      *
      *ALLTID + 1 TIL FALI VED VALUTATILLEGG ETC
      *DA IKKE MOVWSF KALLES
     C                   ADD       1             FALI
     C                   EXSR      NYFAK
     C                   END                                                    1<-E
     C     KGETYP        IFEQ      'FRA'                                        1<-B
     C     XPROS         ANDEQ     0
     C                   EXSR      VEISR
     C                   END
      *
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ***********************************************
     C     NYPC          BEGSR
      ***********************************************
      *
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
     C                   MOVE      FAKDUL        XKDUL
      *
      *** ADD NEW POST TO INVOICE FILE
      *                    MOVE WSSK      XSK2
     C     WSSK          IFEQ      'K'
     C     XCCPP1        ANDEQ     'C'
     C     HEPK5         ANDNE     'N'
     C                   MOVE      'F'           WSSK
     C                   MOVE      'F'           FASK
     C                   END
      *
     C                   EXSR      MOVWSF
      *
     C     FAVAL         IFEQ      FICURR                                       1<-B
     C                   EXSR      VALUTA
     C                   ELSE                                                   1
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
     C     FASK          IFEQ      'S'                                           2<-B
     C     HEVALS        IFNE      '   '                                          3<-B
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     HEVALK        IFNE      '   '                                          3<-B
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C     KGETYP        IFEQ      'FFN'
     C                   Z-ADD     DIFRAK        FABELN
     C                   ADD       DIFS          FABELN
     C                   ADD       DIFUEL        FABELN
     C                   Z-ADD     DIFRAK        FABELV
     C                   ADD       DIFS          FABELV
     C                   ADD       DIFUEL        FABELV
     C                   END
      *
     C                   EXSR      SPLISR
      *
     C                   EXSR      NYFAK
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
      *                    MOVE XSK2      WSSK
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ******************************************
     C     NYPD          BEGSR
      ******************************************
      *
      * Justerer AWB fee med diff mellom default AW fee og
      * AW fee som er valgt for dette oppdraget.
     C     WSVK          IFEQ      'AW '
     C     HEADFK        CHAIN     MCAWF                              33
     C     *IN33         IFEQ      *OFF
     C     'DISPU'       CHAIN     KODTDISR                           33
     C     *IN33         IFEQ      *OFF
     C     TRSTA4        IFEQ      'E'
     C     MCAWFE        SUB       KDSBL4        AWDIFF            5 0
     C                   ELSE
     C     TRSTA4        IFEQ      'I'
     C     MCAWFE        SUB       KDSBL5        AWDIFF
     C                   END
     C                   END
     C     XBELN         ADD       AWDIFF        XBELN
     C                   Z-ADD     XBELN         WSBELV
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *
     C     KODGEK        CHAIN     KOGER                              34
      *
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
     C                   MOVE      FAKDUL        XKDUL
      *
     C     WSSK          IFEQ      'S'
     C     WSVK          ANDEQ     'AW '
     C                   Z-ADD     XBELN         XAWBFE            5 0
     C                   MOVE      WSSK          FASK
     C                   GOTO      UTNYPO
     C                   END
      *
      * ADDS NEW RECORD TO INVOICE FILE
      * IF SINGLE AIR USES F IN STEAD OF K FOR CONSIGNEE
      *
     C     HEHAWB        IFEQ      *ZEROS
     C     WSSK          ANDEQ     'K'
     C                   MOVE      'F'           WSSK
     C                   MOVE      'F'           FASK
     C                   END
      *
     C                   EXSR      MOVWSF
      *
      * ADDS A NEW RECORD
      *
     C     FAVAL         IFEQ      FICURR
     C                   EXSR      VALUTA
     C                   ELSE
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
      *
     C     FASK          IFEQ      'S'
     C     HEVALS        IFNE      '   '
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END
     C                   ELSE
     C     HEVALK        IFNE      '   '
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END
     C                   END
      *
     C                   END
     C                   EXSR      SPLISR
      *
     C                   EXSR      NYFAK
      *
      * SPECIAL FOR FREIGHT EXPORT AIR (FFE)
      * GETS CCFEE FIRST
      * beregner FC = utleggsprovisjon fly
      *
     C     WSVK          IFEQ      'FFE'
     C                   MOVE      FAVK          FAVKW
     C     KODLKK        CHAIN     KODTLKR                            34
     C  N34XPRO          COMP      0                                      34
     C  N34FASK          COMP      'K'                                3434
     C   34              GOTO      STPROS
     C     FABELV        MULT      XPRO          FABELV
     C     FABELV        IFLT      KLKMIN
     C                   Z-ADD     KLKMIN        FABELV
     C                   END
     C                   Z-ADD     FABELV        FABELN
     C                   MOVE      'FC '         FAVK
     C                   MOVE      'FC '         WSVK
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
     C                   EXSR      SPLISR
      *
      *ALLTID + 1 TIL FALI VED VALUTATILLEGG ETC
      *DA IKKE MOVWSF KALLES
     C                   ADD       1             FALI
     C                   EXSR      NYFAK
      *
     C     STPROS        TAG
      *
      * AIR       MC-LINE  CARRIER
      *
     C                   END
      *
     C     UTNYPO        TAG
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ******************************************
     C     NYPE          BEGSR
      ******************************************
      *
      * ADDS NEW POST TO INVOICELINE-FILE
      *
     C     WSSK          IFEQ      'K'
     C     XCCPP1        ANDEQ     'C'
     C     HEPK5         ANDNE     'N'
     C                   MOVE      'F'           WSSK
     C                   MOVE      'F'           FASK
     C                   END
      *
     C                   EXSR      MOVWSF
      *
     C                   EXSR      VALUTA
     C     KODGEK        CHAIN     KOGER                              34
      *
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
     C     KGETYP        IFEQ      'FFN'
     C                   Z-ADD     DIFRAK        FABELN
     C                   ADD       DIFS          FABELN
     C                   ADD       DIFUEL        FABELN
     C                   Z-ADD     DIFRAK        FABELV
     C                   ADD       DIFS          FABELV
     C                   ADD       DIFUEL        FABELV
     C                   END
      *
     C                   EXSR      SPLISR
      *
     C                   EXSR      NYFAK
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ***********************************************
     C     NYPF          BEGSR
      ***********************************************
      *
      *** LEGGE UT NY POST I FAKTURAREGISTER
      *
     C                   EXSR      MOVWSF
      *
     C     FAVAL         IFEQ      FICURR                                       1<-B
     C                   EXSR      VALUTA
     C                   ELSE                                                   1
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
     C     FASK          IFEQ      'S'                                           2<-B
     C     HEVALS        IFNE      '   '                                          3<-B
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     HEVALK        IFNE      '   '                                          3<-B
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
      * HENT GEBYRKODE INFO
      *
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
      *
      *
      *
     C                   EXSR      SPLISR
      *
     C                   EXSR      NYFAK
      *
      * ADD A LINE DEPENDING ON FREIGHT AMOUNTH
      *
     C     KGETYP        IFEQ      'SEA'                                        1<-B
     C     XPROS         ANDEQ     0
     C     HEVALT        ANDNE     *BLANKS
     C     HEVALP        ANDNE     *ZEROS
     C                   MOVE      HEVALT        FAVK
     C                   MULT(H)   HEVALP        FABELN
     C                   MULT(H)   HEVALP        FABELV
      *
     C                   EXSR      SPLISR
      *
      *ALLTID + 1 TIL FALI VED VALUTATILLEGG ETC
      *DA IKKE MOVWSF KALLES
     C                   ADD       1             FALI
     C                   EXSR      NYFAK
     C                   END                                                    1<-E
      *
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ***********************************************
     C     NYPG          BEGSR
      ***********************************************
      *
      *** ADDS NEW RECORD TO INVOICE FILE
      *                    MOVE WSSK      XSK2    1
     C                   EXSR      MOVWSF
      *
     C     FAVAL         IFEQ      FICURR                                       1<-B
     C                   EXSR      VALUTA
     C                   ELSE                                                   1
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
     C     FASK          IFEQ      'S'                                           2<-B
     C     HEVALS        IFNE      '   '                                          3<-B
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     HEVALK        IFNE      '   '                                          3<-B
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
      *
      *
     C                   EXSR      SPLISR
      *
     C                   EXSR      NYFAK
      *
      * ADDS CURRENCYPERCENT TO THE AMOUNTH
     C     KGETYP        IFEQ      'SEA'                                        1<-B
     C     XPROS         ANDEQ     0
     C     HEVALT        ANDNE     *BLANKS
     C     HEVALP        ANDNE     *ZEROS
     C                   MOVE      HEVALT        FAVK
     C                   MULT(H)   HEVALP        FABELN
     C                   MULT(H)   HEVALP        FABELV
      *
     C                   EXSR      SPLISR
      *
      *ALLTID + 1 TIL FALI VED VALUTATILLEGG ETC
      *DA IKKE MOVWSF KALLES
     C                   ADD       1             FALI
     C                   EXSR      NYFAK
     C                   END                                                    1<-E
      *
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      FASK          WSSK
      *
     C                   ENDSR
      *
      ***********************************************
     C     NYPH          BEGSR
      ***********************************************
      *
      *** ADDS NEW RECORD TO INVOICE FILE
      *
      * INTERFAKTURERING AV DUPLIKATOPPDRAG
      *
     C                   MOVE      *ZEROS        FAAVDR
     C   47              MOVE      TRAVD1        FAAVDR
     C   48              MOVE      TRAVD2        FAAVDR
      * MOMSKODE FRA OPPDRAG GJELDER
     C   47
     COR 48              MOVE      'I'           WSSK
      *
     C                   EXSR      MOVWSF
      *
     C     FAVAL         IFEQ      FICURR                                       1<-B
     C                   EXSR      VALUTA
     C                   ELSE                                                   1
     C                   EXSR      VALUT2
     C                   MOVE      XBELN         FABELN
     C     FASK          IFEQ      'S'                                           2<-B
     C     HEVALS        IFNE      '   '                                          3<-B
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     HEVALK        IFNE      '   '                                          3<-B
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C     KODGEK        CHAIN     KOGER                              34
     C   34              MOVE      ' '           FAKDUL
     C  N34              MOVE      KGEUTL        FAKDUL
      *
      *
     C                   EXSR      SPLISR
      *
      * LEGGER INN KODE E I FASK VED ESTIMAT
      *
     C     KGETYP        IFEQ      'FRA'
     C     TRFRAK        ANDEQ     'E'
     C                   MOVE      FASK          FASKFR            1
     C                   MOVE      'E'           FASK
     C                   END
      *
     C                   EXSR      NYFAK
      * FLYTTER TILBAKE KODE S/K
     C     KGETYP        IFEQ      'FRA'
     C     TRFRAK        ANDEQ     'E'
     C                   MOVE      FASKFR        FASK
     C                   END
      * SLUTT FLYTTER TILBAKE KODE S/K
      *
      * HVIS DET ER FRAKT LEGGES DET PÅ EVT FRAKTILLEGG (FRA OPPDRAGET)
      * (MEN IKKE NÅR LINJEN SELV ER FRAKTTILLEGG (FRA M/XPROS ULIK 0))
     C     KGETYP        IFEQ      'FRA'                                        1<-B
     C     XPROS         ANDEQ     0
     C     HEVALT        ANDNE     *BLANKS
     C     HEVALP        ANDNE     *ZEROS
     C                   move      *blanks       FAVT
     C                   MOVE      HEVALT        FAVK
     C                   MULT(H)   HEVALP        FABELN
     C                   MULT(H)   HEVALP        FABELV
      *
     C                   EXSR      SPLISR
      *
      *
      * LEGGER INN KODE E I FASK VED ESTIMAT
      *
     C     KGETYP        IFEQ      'FRA'
     C     TRFRAK        ANDEQ     'E'
     C                   MOVE      FASK          FASKFR            1
     C                   MOVE      'E'           FASK
     C                   END
      *
      *ALLTID + 1 TIL FALI VED VALUTATILLEGG ETC
      *DA IKKE MOVWSF KALLES
     C                   ADD       1             FALI
     C                   EXSR      NYFAK
      * FLYTTER TILBAKE KODE S/K
     C     KGETYP        IFEQ      'FRA'
     C     TRFRAK        ANDEQ     'E'
     C                   MOVE      FASKFR        FASK
     C                   END
      *
     C                   END                                                    1<-E
      *
     C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        XPROS
     C                   MOVE      FASK          WSSK
     C                   MOVE      *ZEROS        FAAVDR
      *
     C                   ENDSR
      *
      ******************************************
     C     SPLISR        BEGSR
      ******************************************
      * LINE TO SPLITT OR DIRECT TO GENERAL LEDGER
      * KG2PRO = % andel som skal til INNTEKT - RESTEN går til KOSTN.
     C     KODG2K        CHAIN     KOG2R                              34
N17   * AUTOBEREGN KOSTNAD
N17  C     KG2XXX        IFEQ      'A'
n23  c     WSKDUK        andne     'N'
N17  C     HEPRO         CHAIN     TURER14                            34
N17  C  N34KEYTRAN       CHAIN     TRAN                               34
N17  C  N34              Z-ADD     VMTRLE        WSLEVN
N17  C  N34              Z-ADD     VMTRLE        FALEVN
N17  C  N34LEVE1K        CHAIN     LEVEL01                            34
N17  c     *IN34         ifeq      '0'
N17  C                   MOVE      KUNDNR        KUNDGM            8 0
N17  c                   move      heavd         uavda             4
N17  c                   move      heopd         uopda             7
N17  c                   move      kundnr        uknr
N17  c                   move      favk          ugeby
N17  C                   move      '0'           XAVTNL            1
N17  C     *IN99         IFEQ      '0'
N17  C                   CALL      'SYFI10W'
N17  C                   PARM                    UAVDA
N17  C                   PARM                    UOPDA
N17  C                   PARM                    UKNR              8
N17  C                   PARM                    UGEBY             3
N17  C                   PARM                    UVAL              3
N17  C                   PARM                    UBEL             11 2
N17  C                   PARM                    ANTTEU            9 0
N17  C                   PARM                    FORANT            5 0
N17  C                   PARM                    BLTR              4
N17  C                   PARM                    INOMLK            2
N17  C                   PARM                    KOWMM             1 0
N17  C                   PARM                    UAVR              1
N17  C                   PARM                    XAVTNL            1
N17  C                   ELSE
N17  C                   MOVE      *BLANKS       UVAL              3
N17  C                   MOVE      FAVK          UGEB              3
N52  C                   MOVE      FAVK          UGEBKO            3
N17  C                   MOVE      *ZEROS        UUBELØ           13 2
N17  C                   MOVE      KUNDNR        UUKN              8 0
N17  C                   MOVE      FASK          USKA              1
N17  C                   CALL      'SYGE14A'
N17  C                   PARM                    UAVDA
N17  C                   PARM                    UOPDA
N17  C                   PARM                    UKNR
N17  C                   parm                    uska
N17  C                   PARM                    UGEB
N52  C                   PARM                    UGEBKO
N17  C                   PARM                    UVAL
N17  C                   PARM                    UUBELØ
N17  C                   Z-ADD     UUBELØ        UBEL
N17  C                   END
N17  C                   MOVE      KUNDGM        KUNDNR            8 0
N17  C     UBEL          IFNE      0
N17  C                   Z-ADD(H)  UBEL          WSBELU                         LEVERANDØR..
N17  C                   Z-add     UBEL          FABELU
N17  C                   MOVE      UVAL          FACU33
N17  C                   MOVE      UVAL          WSVALU
N17  C                   MOVE      'A'           FAKDUK
N17  C                   MOVE      'A'           WSKDUK
N17  C                   end
N17  C                   end
N17  C                   ELSE
      * Aldri KRAV om budsj. av frakt på oppdragsnivå i tr-modul
     C     KG2XXX        IFEQ      'B'
     C     HEUR          ANDEQ     'H'
     C     WSVK          ANDEQ     'FRA'
     C                   MOVE      ' '           KG2XXX
     C                   END
      *
     C     KG2XXX        IFEQ      'J'                                          1B
     C                   MOVE      'S'           WSKDUK
     C     KG2PRO        IFNE      *ZEROS
     C     KG2PRO        IFEQ      0.0001                                       ALT TIL BUDSJ-POST
     C                   MOVE      *ZEROS        KG2PRO
     C                   END
     C     XBELN         MULT(H)   KG2PRO        WSBELU
     C     XBELN         SUB       WSBELU        WSBELU
     C                   END
     C                   ELSE                                                   1
      * DIREKTE MOT HOVEDBOK - KOSTNADSFØRING
     C     KG2XXX        IFEQ      'H'                                           2B
     C                   MOVE      'H'           WSKDUK
     C     WSBELU        IFEQ      *ZEROS                                         3B
     C                   Z-ADD     XBELN         WSBELU
     C                   END                                                      3E
     C                   ELSE                                                    2
      *  BUDSJETTERTE KOSTNADER
     C     KG2XXX        IFEQ      'B'                                             4B
N19  c     wskduk        andne     'N'
     C                   MOVE      'B'           WSKDUK
     C     KG2PRO        IFNE      *ZEROS
     C     KG2PRO        IFEQ      0.0001                                       ALT TIL BUDSJ-POST
     C                   MOVE      *ZEROS        KG2PRO
     C                   END
     C     XBELN         MULT(H)   KG2PRO        WSBELU
     C     XBELN         SUB       WSBELU        WSBELU
     C                   END
     C                   ELSE                                                      4
      *  HVA ER DETTE ???????
     C     KG2XXX        IFEQ      'F'                                            3B
     C                   MOVE      'F'           WSKDUK
     C     KG2PRO        IFNE      *ZEROS
     C     KG2PRO        IFEQ      0.0001                                       ALT TIL BUDSJ-POST
     C                   MOVE      *ZEROS        KG2PRO
     C                   END
     C     XBELN         MULT(H)   KG2PRO        WSBELU
     C     XBELN         SUB       WSBELU        WSBELU
     C                   END
     C                   ELSE                                                     3
      *
N19  c     wskduk        ifne      'N'
     C                   MOVE      *BLANKS       WSKDUK
N19  c                   end
     C                   MOVE      *BLANKS       WSVALU
     C                   MOVE      *ZEROS        WSBELU
      *
     C                   END                                                       4E
     C                   END                                                      3E
     C                   END                                                     2E
     C                   END                                                    1E
     C                   MOVE      WSBELU        FABELU
     C                   MOVE      WSVALU        FACU33
     C                   MOVE      WSKDUK        FAKDUK
N17  C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     OMREGN        BEGSR
      ***********************************************
      *
      *** AJUSTING VEIGHT        - LESS THAN 1000 TO NEAREST  10 KILO
      *** ELSE TO NEAREST     100 KG, BUT IF PRICE IS GIVEN   PR. 2-10
      *** TO NEAREST  10 KG. NOT IF PRICE PR 1 KILO
      *
      *** IF FIRM HAVE DEFINED NO AJUSTMENT
      *** (INGAVR = 'J') NO AJUSTMENT IS PERFORMED
      *
     C     X01B          IFEQ      'B'
     C                   Z-ADD     HEVKT         XVEKT             9 0
     C                   MOVE      *BLANKS       X01B
     C                   ELSE
     C                   Z-ADD     HEFBV         XVEKT
     C                   END
      *
     C     X01B          IFEQ      ' '                                          NOT PR LINE/PIESES
      * 1
     C     UAVR          IFNE      'J'
      * 2
     C     KOWMM         IFNE      3
      * 2B
     C     PRANT         IFNE      1
      * 3
     C     XVEKT         IFLT      1000                                         WEIGHT <   1000 KG
     C     XVEKT         ADD       9             XVEKT2            9 0          AJUST TO NEARES
     C                   MOVE      '0'           XVEKT2                         10 KG
     C                   ELSE                                                   WEIGHT >=     1000 K
     C     PRANT         IFGT      10                                           PRICE IS GIVEN PR 10
     C     XVEKT         ADD       99            XVEKT2                         KG OR MORE  , AJUST
     C                   MOVE      '00'          XVEKT2                         TO NEAREST   100 KG
     C                   ELSE
     C     XVEKT         ADD       9             XVEKT2                         PRICE GIVEN PR
     C                   MOVE      '0'           XVEKT2                         2-9 KG, AJUST TO
     C                   END                                                    NEAREST  10 KG
     C                   END
      * 3
     C                   ELSE                                                   NO AJUSTMENT
     C                   Z-ADD     XVEKT         XVEKT2
     C                   END
      * 2B
     C                   ELSE                                                   PRICE PR 1 AND NOT P
     C                   Z-ADD     XVEKT         XVEKT2                         LINEPRICE/PIESESPRIC
     C                   END
      * 2
     C                   ELSE                                                   PRICE PR 1 AND NOT P
     C                   Z-ADD     XVEKT         XVEKT2                         LINEPRICE/PIESESPRIC
     C                   END
      * 1
     C     PRBELØ        DIV       PRANT         XWORK
     C     XWORK         MULT(H)   XVEKT2        PRBELØ
     C                   END
     C  N99X01B          IFEQ      'M'
     C     PRANT         IFNE      *ZEROS
     C                   MULT(H)   HEM3          PRBELØ
     C                   DIV(H)    PRANT         PRBELØ
     C                   END
     C                   END
      *
     C     X01B          IFNE      'D'
     C     X01B          IFNE      'L'
     C     HENTF         ORGT      0
     C     PRTEGN        IFEQ      '-'
     C                   SUB       PRJUST        PRBELØ
     C                   ELSE
     C     PRTEGN        IFEQ      '+'
     C                   ADD       PRJUST        PRBELØ
     C                   ELSE
      * flyttet linjene til egen subrutine
     C                   exsr      mimasr
      *
     C                   END
     C                   END
     C                   END
     C                   END
      *
     C                   ENDSR
      ***********************************************
     C     MIMASR        BEGSR
      ***********************************************
S03   * hent record ved 99  fraktrelatert avtale
S03  c*    *in99         ifeq      '1'
S03  c*                  z-add     PRBELØ        belfor           13 2
S03  C*    PRISKK        SETLL     PRIS
S03  C*    WSTNR         READE     PRIS                                   75
S03  C*                  z-add     belfor        PRBELØ
S03  C*                  end
      *
      * M = MINIMUM
     C     PRTEGN        IFEQ      'M'
S30  C*    X01B          IFNE      'V'
     C     PRBELØ        IFLT      PRJUST
     C                   Z-ADD     PRJUST        PRBELØ
     C                   END
     C                   ELSE
     C                   MOVE      'M'           KODEMM            1
     C                   END
S30  C*                  END
      * N = MAXIMUM
     C     PRTEGN        IFEQ      'N'
S30  C*    X01B          IFNE      'V'
     C     PRBELØ        IFGT      PRJUST
     C                   Z-ADD     PRJUST        PRBELØ
     C                   END
s30  C*                  ELSE
s30  C*                  MOVE      'N'           KODEMM            1
s30  C*                  END
     C                   END
N03   * hent record ved 99  fraktrelatert avtale
N03  c     *in99         ifeq      '1'
N03  c                   z-add     PRBELØ        belfor           13 2
N03  C     PRISKK        SETLL     PRIS
N03  C     WSTNR         READE     PRIS                                   75
N03  C                   z-add     belfor        PRBELØ
N03  C                   end
N03   *
     C                   ENDSR
      ***********************************************
     C     MOVFWS        BEGSR
      ***********************************************
     C     FALI          COMP      0                                      71     PROTEC WSVK
     C                   MOVE      FASK          WSSK
     C                   MOVE      FAVK          WSVK
     C                   MOVE      FACD11        WSSAMM
     C                   MOVE      *BLANKS       WSTNR
     C                   MOVE      FABELV        WSBELV
     C                   MOVE      FAVAL         WSVAL
     C                   MOVE      FAKDM         WSKDM
     C                   MOVE      FAVT          WSVT
     C                   MOVE      FAKDUK        WSKDUK
     C                   MOVE      FABELU        WSBELU
     C                   MOVE      FACU33        WSVALU
     C                   MOVE      FALEVN        WSLEVN
     C                   MOVE      FAKUNR        WSKUNR
     C                   MOVE      FAEXRA        WSKURS
     C                   MOVE      *ZEROS        WSANT
     C  N41
     CANN42
     CANN46
     CANN49
     CANN50              MOVE      'J'           WSCCF
     C  N43
     CANN44
     CANN45              MOVE      *ZEROS        WSKOM
     C                   MOVE      FAAVDR        WSAVDR
     C                   MOVE      *zeros        WSIOPD
s04  C*                  TESTN                   FADOCN6_10           31
n04  C                   TESTN                   FADOCN5_11           31
     C     *IN31         IFEQ      '1'
s04  C*                  MOVE      FADOCN6_10    WSIOPD
n04  C                   MOVE      FADOCN5_11    WSIOPD
     C                   END
     C                   MOVE      FAAGRN        WSAGRN
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVWSF        BEGSR
      ***********************************************
      *  91 ON=endring(da er FALI kjent) ) 91 OFF=ny(hent neste FALI)
      *  NYPXX ="J" - Kommer fra NYPA, NYPB.... skal ikke chaine opp
     C  N91              DO
     C                   CALL      'SYGE06'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    FALI
     C                   END
     C     NYPXX         IFNE      'J'
     C     FAKTK         CHAIN     FAKT                               33
     C  N33FAOPKO        IFGT      'C'
     C                   GOTO      SLUPDF
     C                   END
     C   33              MOVE      'J'           NYLIN
     C  N33
     CANN35              EXSR      MSALDO                                       TREKK SALDO
     C                   END
     C                   MOVE      UAVD          FAAVD
     C                   MOVE      UOPD          FAOPD
     C                   MOVE      WSSK          FASK
     C                   MOVE      WSVK          FAVK
     C                   MOVE      WSVT          FAVT
     C     WSVAL         IFEQ      '   '                                        I
     C     WSSK          IFEQ      'S'                                          II
     C     HEVALS        IFEQ      '   '                                        IIII
     C                   MOVE      FICURR        FAVAL
     C                   ELSE
     C                   MOVE      HEVALS        FAVAL
     C                   END                                                    IIII
     C                   ELSE
     C     HEVALK        IFEQ      '   '                                        IIII
     C                   MOVE      FICURR        FAVAL
     C                   ELSE
     C                   MOVE      HEVALK        FAVAL
     C                   END                                                    IIII
     C                   END                                                    II
     C                   ELSE
     C                   MOVE      WSVAL         FAVAL
     C                   END                                                    I
     C                   MOVE      FAVAL         WSVAL
      * SIKRE RIKTIG "UTSTEDELSESVAL"(OVERSTYRES OFTEST AV SR:VALUTA)
     C     FAVAL         IFEQ      FICURR
     C                   MOVE      *BLANKS       FACURI
     C                   ELSE
     C                   MOVE      FAVAL         FACURI
     C                   END
     C                   MOVE      WSKURS        FAEXRA
     C                   MOVE      *ZEROS        WSKURS
     C                   MOVE      WSBELV        FABELV
     C                   MOVE      WSKDM         FAKDM
     C                   MOVE      XBELN         FABELN
     C                   MOVE      XKDA          FAKDA
     C                   MOVE      XKDUL         FAKDUL
     C                   MOVE      X01B          FA01B
     C                   MOVE      WSKDUK        FAKDUK
     C                   MOVE      WSVALU        FACU33
     C                   MOVE      WSBELU        FABELU
     C                   MOVE      WSLEVN        FALEVN
     C                   MOVE      WSKUNR        FAKUNR
     C                   MOVE      WSAVDR        FAAVDR
     C     WSIOPD        IFNE      *ZEROS
s04  C*                  MOVE      WSIOPD        FADOCN6_10
n04  C                   MOVE      WSIOPD        FADOCN5_11
     C                   ELSE
S04  C*                  MOVE      *BLANKS       FADOCN6_10
N04  C                   MOVE      *BLANKS       FADOCN5_11
     C                   END
     C                   MOVE      WSAGRN        FAAGRN
     C                   MOVE      WSSAMM        FACD11
      *
     C     SLUPDF        ENDSR
      *
      ***********************************************
     C     MOVF          BEGSR
      ***********************************************
     C                   SETOFF                                           71
     C                   MOVE      *ZEROS        FALI
     C                   MOVE      *BLANKS       FASK
     C                   MOVE      *BLANKS       FAVK
     C                   MOVE      *BLANKS       KGENOT
     C                   MOVE      *BLANKS       FAVAL
     C                   MOVE      *ZEROS        FAEXRA
     C                   MOVE      *BLANKS       FAVT
     C                   MOVE      *ZEROS        FABELV
     C                   MOVE      *BLANKS       FAKDM
     C                   MOVE      *ZEROS        FABELN
     C                   MOVE      *BLANKS       FAKDA
     C                   MOVE      *BLANKS       FAKDUK
     C                   MOVE      *BLANKS       FACU33
     C                   MOVE      *ZEROS        FABELU
     C                   MOVE      *ZEROS        FALEVN
     C                   MOVE      *ZEROS        WSKURS
     C                   MOVE      *ZEROS        WSANT
     C  N41
     CANN42
     CANN46
     CANN49
     CANN50              MOVE      'J'           WSCCF
     C  N43
     CANN44
     CANN45              MOVE      *ZEROS        WSKOM
S04  C*                  MOVE      *BLANKS       FADOCN6_10
N04  C                   MOVE      *BLANKS       FADOCN5_11
     C                   MOVE      *ZEROS        FAAVDR
     C                   MOVE      *ZEROS        FAAGRN
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVW          BEGSR
      ***********************************************
     C                   MOVE      *BLANKS       WSSK
      *                    MOVE '0'       *IN85
      * JUST CONSIGNEE - K (AIR EXPORT (44 on) singel(ag.ref=blank)->F)
     C     HEKDFS        IFEQ      'X'
     C     HEKDFK        ANDNE     'X'
      *                    MOVE '1'       *IN85            Plasser cursor
     C                   MOVE      'K'           WSSK
     C   44HERFA         IFEQ      *BLANKS
     C                   MOVE      'F'           WSSK
     C                   END
     C                   END
      * Kun mot selger - K
     C     HEKDFK        IFEQ      'X'
     C     HEKDFS        ANDNE     'X'
     C                   MOVE      'S'           WSSK
     C                   END
     C                   MOVE      *BLANKS       WSVK
     C                   MOVE      *BLANKS       WSSAMM
     C                   MOVE      *BLANKS       WSTNR
s35  C*                  MOVE      *BLANKS       WSVAL
N35  C                   MOVE      FICURR        WSVAL
     C                   MOVE      *ZEROS        WSBELV
     C                   MOVE      *BLANKS       WSKDM
     C                   MOVE      *BLANKS       WSVT
     C                   MOVE      *BLANKS       WSKDUK
     C                   MOVE      *ZEROS        WSBELU
     C                   MOVE      *ZEROS        WSLEVN
     C                   MOVE      *ZEROS        WSKUNR
     C                   MOVE      *ZEROS        FAKUNR
     C                   MOVE      *ZEROS        WSKURS
     C                   MOVE      *ZEROS        WSANT
     C  N41
     CANN42
     CANN46
     CANN49
     CANN50              MOVE      'J'           WSCCF
     C  N43
     CANN44
     CANN45              MOVE      *ZEROS        WSKOM
     C                   MOVE      *ZEROS        WSAVDR
     C                   MOVE      *ZEROS        WSIOPD
      *
      * SPESIAL TRANSPORTOPPDRAG
      *
     C   46
     COR 47
     COR 48              MOVE      TRMVA         WSKDM
     C   47
     COR 48              MOVE      'I'           WSSK
      * AVD. INTERNBELASTNING VED FOR/ETTERFRAKT=HOV.OPPDRAGETS AVD.
     C   47              MOVE      TRAVD1        WSAVDR
     C   48              MOVE      TRAVD2        WSAVDR
     C                   MOVE      *ZEROS        WSAGRN
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVFAZ        BEGSR
      ***********************************************
     C                   MOVE      FALI          ZLI               5 0
     C                   MOVE      FAAVD         ZAVD              4 0
     C                   MOVE      FAOPD         ZOPD              7 0
     C                   MOVE      FASK          ZSK               1
     C                   MOVE      FAVK          ZVK               3
     C                   MOVE      FAVAL         ZVAL              3
     C                   MOVE      FAEXRA        ZEXRA             7 4
     C                   MOVE      FABELV        ZBELV            13 2
     C                   MOVE      FABELN        ZBELN            13 2
     C                   MOVE      FAKDM         ZKDM              1
     C                   MOVE      FAKDUL        ZKDUL             1
     C                   MOVE      FACU33        ZCU33             3
     C                   MOVE      FABELU        ZBELU            13 2
     C                   MOVE      FAKUNR        ZKUNR             8 0
     C                   MOVE      FALEVN        ZLEVN             8 0
     C                   MOVE      KGENOT        ZGENOT           20
     C                   MOVE      FAVT          ZAVT             20
     C                   MOVE      FAAVDR        ZAVDR             4 0
     C                   MOVE      FAAGRN        ZAGRN             9 0
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVZFA        BEGSR
      ***********************************************
     C                   MOVE      ZLI           FALI
     C                   MOVE      ZAVD          FAAVD
     C                   MOVE      ZOPD          FAOPD
     C                   MOVE      ZSK           FASK
     C                   MOVE      ZVK           FAVK
     C                   MOVE      ZVAL          FAVAL
     C                   MOVE      ZEXRA         FAEXRA
     C                   MOVE      ZBELV         FABELV
     C                   MOVE      ZBELN         FABELN
     C                   MOVE      ZKDM          FAKDM
     C                   MOVE      ZKDUL         FAKDUL
     C                   MOVE      ZCU33         FACU33
     C                   MOVE      ZBELU         FABELU
     C                   MOVE      ZKUNR         FAKUNR
     C                   MOVE      ZLEVN         FALEVN
     C                   MOVE      ZGENOT        KGENOT
     C                   MOVE      ZAVT          FAVT
     C                   MOVE      ZAVDR         FAAVDR
     C                   MOVE      ZAGRN         FAAGRN
      *
     C                   ENDSR
      *
      ***********************************************
     C     CMDLIN        BEGSR
      ***********************************************
      * CHANGES SHOWING OF POSSIBLE KEYS ON SCREEN
      *
     C* INDIKATOR 89 KAN IKKE VÆRE I BRUK
     C   35              DO
     C                   MOVE      'DIV0020'     MSGC1                          CMD-3
     C                   GOTO      UTCMDT
     C                   END
     C     XCMD          IFEQ      0
     C                   MOVE      'DIV0020'     MSGC1                          CMD-3
     C                   MOVE      'DIV0021'     MSGC2                          CMD-5
     C                   MOVE      'DIV1005'     MSGC3                          CMD-10
     C                   Z-ADD     1             XCMD              1 0
     C                   ELSE
     C     XCMD          IFEQ      1
s37  C* N36              MOVE      'DIV1006'     MSGC1                          CMD-4
N37  C*  36              MOVE      'DIV3572'     MSGC1                          CMD-4
n37  C                   MOVE      'DIV1006'     MSGC1                          CMD-4
     C                   MOVE      'DIV0022'     MSGC2                          CMD-6
     C                   MOVE      'DIV2051'     MSGC3
     C                   ADD       1             XCMD
     C   39              Z-ADD     3             XCMD
     C                   ELSE
     C     XCMD          IFEQ      2
     C                   MOVE      'DIV1007'     MSGC1                          CMD-7
     C                   MOVE      'JOV1133'     MSGC2                          CMD-8
     C                   MOVE      'DIV0024'     MSGC3                          CMD-12
     C                   ADD       1             XCMD
     C                   ELSE
N22  C     XCMD          IFEQ      3
     C                   MOVE      'SHU0023'     MSGC1                          CMD-20
     C                   MOVE      'DIV4098'     MSGC2                          CMD-11
     C                   MOVE      'YBC0787'     MSGC3                          CMD-2
N33  C                   ADD       1             XCMD
     C                   ELSE
N23  C                   MOVE      'SHU1393'     MSGC1                          CMD-20
S37  C*                  MOVE      'DIV0000'     MSGC2                          CMD-11
N37  C                   MOVE      'DIV3572'     MSGC2                          CMD-11
N23  C                   MOVE      'DIV0000'     MSGC3                          CMD-2
     C                   Z-ADD     0             XCMD
N22  C                   END
     C                   END
     C                   END
     C                   END
      *
     C     UTCMDT        ENDSR
      *
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
      * INITIALIZATION OF VARIABLES, KEYS ETC.
      *
     C     *LIKE         DEFINE    FAVK          FAVKW
     C     *LIKE         DEFINE    XTKNR         XTKNRG
     C     *LIKE         DEFINE    HEAVD         XAVD
     C     *LIKE         DEFINE    HEOPD         XOPD
     C     *LIKE         DEFINE    FABELU        XBELU
      *
     C     cum3k         klist
     C                   kfld                    fifirm
     C                   kfld                    xtknr
      *
      * NØKKEL FOR AVTALEBYTE
      *
     C     KAVTK         KLIST
     C                   KFLD                    XAKNK
     C                   KFLD                    WSSK
     C                   KFLD                    HEOT
     C                   KFLD                    HEFR
      *
      * NØKKEL FOR BRUTTOPRIS
      *
     C     BRUKEY        KLIST
     C                   KFLD                    WSSK
     C                   KFLD                    HEFR
     C                   KFLD                    HEOT
     C                   KFLD                    PKGEBY
      *
N60  C     KEYGENGE      KLIST
N60  C                   KFLD                    ALLE              8
N60  C                   KFLD                    HEFRGE            3
N60  C                   KFLD                    HEOTGE            2
N60  C                   move      '    ALLE'    ALLE
N60  C                   move      'GEN'         HEFRGE
N60  C                   move      'GE'          HEOTGE
      *
      * NØKKEL FOR AVTALEBYTE
      *
     C     KAVTS         KLIST
     C                   KFLD                    XAKNS
     C                   KFLD                    WSSK
     C                   KFLD                    HEOT
     C                   KFLD                    HEFR
N35   *
N35   * Fritekst med F
N35   *
S64  C*    FREETK        KLIST
S64  C*                  KFLD                    UAVD
S64  C*                  KFLD                    UOPD
S64  C*                  KFLD                    FRTKOD
S64  C*                  MOVE      'F'           FRTKOD
      *
      * NØKKEL FOR KUNDERS VEKTGRUPPE-INNDELING
      *
     C     FAKTK         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    FALI
N47  C     FAK15K        KLIST
N47  C                   KFLD                    UAVD
N47  C                   KFLD                    UOPD
N47  C                   KFLD                    PKGEBY
N47  C                   KFLD                    WSSK
     C     FAK4K         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    XSK
      *
     C     FAK2K         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
      *
      *
     C     HEADFK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     HEADIK        KLIST
     C                   KFLD                    WSAVDR
     C                   KFLD                    WSIOPD
     C     FERDFK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    FAKUNR
     C     CUSAAK        KLIST
     C                   KFLD                    WSKUNR
     C                   KFLD                    UAVD
     C     DOKEFK        KLIST
     C                   KFLD                    XRI
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     DOKUIK        KLIST
     C                   KFLD                    XDISTA
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    XFBNR
     C     DOKUI2        KLIST
     C                   KFLD                    XDISTA
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     DOKUF2        KLIST
     C                   KFLD                    XDISTF
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     VALU1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSVAL
N30  C     VALUVER       KLIST
N30  C                   KFLD                    UFIRM
N30  C                   KFLD                    TRVERV
     C     VALUK2        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    FAVAL
     C     VALUUK        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSVALU
     C     CCK1          KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    HEKNSF
     C     CCK2          KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    HEKNKF
     C     CCK3          KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSKUNR
     C     VKEY0         KLIST
     C                   KFLD                    CEAKN
     C                   KFLD                    WSVAL
     C     VKEY1         KLIST
     C                   KFLD                    HEKNSF
     C                   KFLD                    WSVAL
     C     VKEY2         KLIST
     C                   KFLD                    HEKNKF
     C                   KFLD                    WSVAL
     C     VKEY3         KLIST
     C                   KFLD                    WSKUNR
     C                   KFLD                    WSVAL
     C     LEVE1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSLEVN
     C     KUND1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSKUNR
N38  C     'fa'          chain     arktxt                             33
N38  C                   MOVE      ARTXT         MAIL16           16
N38  C                   MOVEL     '*'           MAIL16
N38  c                   movel     MAIL16        mail30           30
     C     CUND1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    FAKUNR
     C     KODTVK        KLIST
     C                   KFLD                    XVUNI
     C                   KFLD                    HEAVD
     C     KOKEY1        KLIST
     C                   KFLD                    XAUNI
     C                   KFLD                    WSAVDR
     C     KOKEY2        KLIST
     C                   KFLD                    XAUNI
     C                   KFLD                    UAVD
     C     KODTWK        KLIST
     C                   KFLD                    XWUNI
     C                   KFLD                    HEAVD
     C     KODGEK        KLIST
     C                   KFLD                    XGEUNI
     C                   KFLD                    WSVK
     C     KODGEA        KLIST
     C                   KFLD                    XGEUNI
     C                   KFLD                    PKGEBY
     C     KODG2K        KLIST
     C                   KFLD                    XG2UNI
     C                   KFLD                    WSVK
     C     KODLKK        KLIST
     C                   KFLD                    XLKUNI
     C                   KFLD                    HELKA
     C     KODFSK        KLIST
     C                   KFLD                    XFSUNI
     C                   KFLD                    XKNF
     C     KODDIK        KLIST
     C                   KFLD                    XDIUNI
     C     PRISKK        KLIST
     C                   KFLD                    WSTNR
     C                   KFLD                    WSVK
     C                   KFLD                    XINT
     C     PRIKK         KLIST
     C                   KFLD                    XKNR
     C                   KFLD                    XAVTN
     C                   KFLD                    XGEBY
     C                   KFLD                    XAVTT
     C                   KFLD                    XINT
     C                   KFLD                    XLNR
     C     PRIK1K        KLIST
     C                   KFLD                    XKNR
     C                   KFLD                    XFRAN
     C                   KFLD                    XOPDT
     C                   KFLD                    XAVTN
     C                   KFLD                    XGEBY
     C                   KFLD                    XLNR
     C     PRJOIK        KLIST
     C                   KFLD                    PKKNR
     C                   KFLD                    PKAVTN
     C                   KFLD                    PKLNR
      * KEYS FOR FRAKT - HOVEDRELASJON
     C     FRATK         KLIST
     C                   KFLD                    XTKNR
     C                   KFLD                    XTFRAN
     C                   KFLD                    XTOT
     C                   KFLD                    XTSK
     C                   KFLD                    XTFRA
     C                   KFLD                    XTTIL
     C                   KFLD                    XTAVTN
     C     FRATK2        KLIST
     C                   KFLD                    XTKNR
     C                   KFLD                    XTFRAN
     C                   KFLD                    XTOT
     C                   KFLD                    XTSK
     C                   KFLD                    XSONEF
     C                   KFLD                    XTTIL
     C                   KFLD                    XTAVTN
     C     FRATK3        KLIST
     C                   KFLD                    XTKNR
     C                   KFLD                    XTFRAN
     C                   KFLD                    XTOT
     C                   KFLD                    XTSK
     C                   KFLD                    XTFRA
     C                   KFLD                    XSONET
     C                   KFLD                    XTAVTN
     C     FRATK4        KLIST
     C                   KFLD                    XTKNR
     C                   KFLD                    XTFRAN
     C                   KFLD                    XTOT
     C                   KFLD                    XTSK
     C                   KFLD                    XSONEF
     C                   KFLD                    XSONET
     C                   KFLD                    XTAVTN
     C     CFRATK        KLIST
     C                   KFLD                    XTKNR
     C                   KFLD                    XTRAF             4
     C                   KFLD                    HEFR
     C                   KFLD                    XTOT
     C                   KFLD                    XTSK
     C                   KFLD                    YSDF              5
     C                   KFLD                    YSDT              5
     C                   KFLD                    BVKDC
     C     WSSDFK        KLIST
     C                   KFLD                    FIRLKF            2
     C                   KFLD                    HESDF
N08  C     WSSDFKFF      KLIST
N08  C                   KFLD                    FIRLKF
N08  C                   KFLD                    HESDFF
     C     KODO2K        KLIST
     C                   KFLD                    XO2UNI
     C                   KFLD                    HEOT
     C     WSSDTK        KLIST
     C                   KFLD                    FIRLKT            2
     C                   KFLD                    HESDT
N08  C     WSSDTKVT      KLIST
N08  C                   KFLD                    FIRLKT
N08  C                   KFLD                    HESDVT
     C     KODWKY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WMVAKD
     C                   KFLD                    WSKDM
     C                   MOVE      *BLANKS       WMVAKD            2
     C     FRIKEY        KLIST
     C                   KFLD                    FSAVD
     C                   KFLD                    FSOPD
     C                   KFLD                    FSKODE
     C                   KFLD                    FSSOK
S65  C*    AdvKey        KLIST
N65  C     SyparKey      KLIST
     C                   KFLD                    XXPAKN            8 0
     C                   KFLD                    XXPAID            5
     C                   movel     'GEADV'       XXPAID
N17  C     KEYTRAN       KLIST
N17  C                   KFLD                    FIFIRM
N17  C                   KFLD                    TUKNT2
N12  C     EXTKEY        KLIST
N12  C                   KFLD                    FAKUNR            8 0
N12  C                   KFLD                    XXPAIDE           5
N12  C                   KFLD                    EXTGEB           50
N12  C                   movel     'GETXT'       XXPAIDE
N12  C     EXTKEY2       KLIST
N12  C                   KFLD                    FAKUNR            8 0
N12  C                   KFLD                    XXPAIDE           5
N12  C     EXTKEYA       KLIST
N12  C                   KFLD                    AKNRKU            8 0
N12  C                   KFLD                    XXPAIDE           5
N12  C                   KFLD                    EXTGEB           50
N12  C     EXTKEY2A      KLIST
N12  C                   KFLD                    AKNRKU            8 0
N12  C                   KFLD                    XXPAIDE           5
N12   *
N12  C                   movel     'GETXT'       XXPAIDE
N12  C     FASTIK        KLIST
N12  C                   KFLD                    KFTYPI           10
N12  C                   KFLD                    KFKOD
      *
     C     *ENTRY        PLIST
     C                   PARM                    UFIRM             2
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD
     C                   PARM                    UNYGML            2
     C                   PARM                    XYZ0              1
     C                   PARM                    XYZ1              4 2
     C                   PARM                    XYZ2              4 2
     C                   PARM                    XYZ3              2 0
     C                   PARM                    XYZ4              2 0
     C                   PARM                    XYZ5              1
     C                   PARM                    XYZ6              1
     C                   PARM                    UKFRA             7 0
     C                   PARM                    UAVR              1
     C                   PARM                    UMSG
      * UMELD IS NOT IN USE
     C                   PARM                    UMELD             1
     C                   PARM                    UFLAGG            1 0
      *** USK = 'O' CALL FROM SYFF10CLO
      *** USK = 'S' CALL FROM SYFF10CLS
      *** USK = 'K' CALL FROM SYFF10CLK
      *** USK = 'A' CALL FROM ?????????
     C                   PARM                    USK               1
     C                   PARM                    USECUR            6
     c*                  dump
      *
     C                   IF        UFLAGG = 9
     C                   MOVE      'J'           XWEBKALK          1
     C                   Z-ADD     1024          UCMDL            15 5
     C                   EVAL      UCMD = XCMD01
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     C                   EVAL      UCMD = XCMD02
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     C                   EVAL      UCMD = XCMD03
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     C                   EVAL      UCMD = XCMD04
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     C                   END
     C                   OPEN      HEADF
     C                   OPEN      FAKT
     C                   OPEN      FAK2
     C                   OPEN      FAK4
      *** (UFLAGG = 1)  =  CALL FROM SYIN10
      *
      * HVIS AVDELINGSNUMMER ER NEGATIVT SÅ ER DET ET KALL IFRA SPØRRIN
s21   * sette av alle indikatore i INIT ??? dette må vel være fra en tid UTEN *INLR ??
s21   * tar bort for å få oversikt over brukte indikatore
s21  C*                  MOVEA     *ZEROS        *IN(1)
     C     UFLAGG        COMP      1                                      36
     C     USK           IFEQ      'A'
     C                   SETON                                        3738
     C                   ELSE
     C     USK           COMP      'K'                                    37    KUN KJØPER
     C     USK           COMP      'S'                                    38    KUN SELGER
     C                   END
     C     USK           IFNE      ' '
     C                   SETON                                        3639
     C                   END
     C     USECUR        IFEQ      '*SECUR'
     C     USECUR        OREQ      'SSKALK'
     C                   SETON                                        35
     C                   END
      *
      * TESTS om ferdigmeldt
      *
     C                   MOVE      '0'           *IN87                          *FERDIGM
     C                   MOVEA     '0'           *IN(90)                        *SINGLE
     C                   MOVEA     '0'           *IN(77)                        *SAMLE
     C     HEADFK        SETLL     FERDL01
     C     HEADFK        READE(N)  FERDL01                                33
     C     *IN33         DOWEQ     '0'
     C                   MOVE      '1'           *IN87                          *FERDIGMELDT
     C                   MOVE      'J'           UMELD
     C     FEKN          IFNE      *ZEROS
     C  N90FESFAK        COMP      ' '                                    90    *SINGLE
     C  N77FESFAK        COMP      ' '                                7777      *SAMLEFAKT
     C                   END
     C     HEADFK        READE(N)  FERDL01                                33
     C                   END
      *
n51   * TESTS om ordre er fakturert
n51   *
n51  c                   setoff                                       33
n51  C     HEADFK        SETLL     fakt
n51  C     *IN33         DOWEQ     '0'
n51  C     HEADFK        READE(N)  fakt                                   33
n51  c     *in33         ifeq      '0'
n51  c     faopko        andgt     'C'
n51  c     fakda         andne     'K'
n51  c                   move      'J'           faktfoer          1
n51  c                   seton                                        33
n51  C                   ENDIF
n51  C                   ENDDO
N51   *
N51   * ligger den i samlefakturakø ?
N51   *
N51  C     HEADFK        CHAIN     SAML1                              33
N51  c  N33              move      'J'           SAMKOE            1
      *
     C                   MOVE      ' '           XSK               1
      * INIT-TESTER DUPLIKATOPPDRAG SLUTT
      *
     C                   MOVE      'F'           XRI               1
     C                   MOVE      'V'           XVUNI             1
     C                   MOVE      'W'           XWUNI             1
     C                   MOVE      'A'           XAUNI             1
     C                   MOVE      'GE'          XGEUNI            2
     C                   MOVE      'G2'          XG2UNI            2
     C                   MOVE      'VA'          XVAUNI            2
     C                   MOVE      'FS'          XFSUNI            2
     C                   MOVE      'LK '         XLKUNI            3
     C                   MOVE      'DINNF'       XDIUNI            5
     C                   MOVE      'O2Y'         XO2UNI            3
     C                   MOVE      'I'           XDISTA            1
     C                   MOVE      'F'           XDISTF            1
     C                   MOVE      '001'         XFBNR             3 0
     C                   MOVE      *ZEROS        XINT              5 0
     C                   MOVE      *BLANKS       XKNR              8
     C                   MOVE      *BLANKS       XFRAN             3
     C                   MOVE      *BLANKS       XOPDT             2
     C                   MOVE      *BLANKS       XAVTN             1
     C                   MOVE      *BLANKS       XGEBY             3
     C                   MOVE      *BLANKS       XAVTT             1
     C                   MOVE      *ZEROS        PRANT
     C                   MOVE      *ZEROS        XLNR              4 0
     C                   MOVE      *ZEROS        XTKNR             8 0
     C                   MOVE      '   '         XTFRAN            3
     C                   MOVE      '  '          XTOT              2
     C                   MOVE      ' '           XTSK              1
     C                   MOVE      '     '       XTFRA             5
     C                   MOVE      '     '       XTTIL             5
     C                   MOVE      *ZEROS        XTAVTN            1 0
     C                   MOVE      'DIV0029'     MSGC4                          CMD-24
     C                   EXSR      CMDLIN
     C                   MOVE      *ZEROS        AX
     C                   MOVE      *ZEROS        LOKUPF
     C                   MOVE      *ZEROS        HEM3
     C                   MOVE      *ZEROS        HEFBV
     C                   MOVE      *ZEROS        HEDTOP
     C                   MOVE      UAVD          UAVDAN            4
     C                   MOVE      UOPD          UOPDAN            7
N64  c     *like         define    HEAVD         GMAVD
N64  c     *like         define    HEOPD         GMOPD
N64  C     OphKey        KLIST
N64  C                   KFLD                    DUAVD0
N64  C                   KFLD                    DUOPD0
N64  C     InhKey        KLIST
N64  C                   KFLD                    DUAVD1
N64  C                   KFLD                    DUOPD1
N64  C     UtkKey        KLIST
N64  C                   KFLD                    DUAVD2
N64  C                   KFLD                    DUOPD2
      *
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
     C                   SETOFF                                       33
     C     KOKEY2        CHAIN     KOAR                               33
     C     DOKUIK        CHAIN     DOKUI                              33
     C   33              Z-ADD     0             DIFRAK
     C   33              Z-ADD     0             DIFS
     C   33              Z-ADD     0             DIFUEL
     C     KODDIK        CHAIN     KODTDINR                           33
     C     KDIPRO        DIV       100           XTILBA            5 4
     C                   ADD       1             XTILBA
     C     HEADFK        CHAIN(N)  HEADF                              33
     C                   Z-ADD     HEFBV         FLYVKT            5 0
     C                   MOVE      HEAVD         WSAVDR
     C     KOKEY1        CHAIN     KOAR                               33
     C                   MOVE      *ZEROS        WSAVDR
     C     HEUR          COMP      'A'                                    41
     C     HEUR          COMP      'B'                                    42
     C     HEUR          COMP      'C'                                    43
     C     HEUR          COMP      'D'                                    44
     C     HEUR          COMP      'E'                                    45
     C     HEUR          COMP      'F'                                    49
     C     HEUR          COMP      'G'                                    50
     C   49              MOVE      FIURBI        XURB              1
     C   50              MOVE      FIURBE        XURB              1
      *
      *** INITIERER CCFEE VED IMPORT FLY
      *
     C   43              MOVE      'J'           WSCCF
      *
      *** HENTE VALUTAKURS VED SJØFRAKT
      *
     C     HEADFK        CHAIN     BILLOF                             33
     C     *IN(33)       IFEQ      '0'
     C                   CALL      'SYGE44'
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    ANTTEU            9 0
     C                   END
      *
      * SPESIALTESTER TRANSPORTOPPDRAG
N64  c                   if        TROPD1 <> 0 or TROPD2<>0
N64  c                             or TROPD0 <> 0
N64  c                   move      HEAVD         GMAVD
N64  c                   move      HEOPD         GMOPD
N64  c                   move      TRAVD0        DUAVD0
N64  c                   move      TROPD0        DUOPD0
N64  c                   move      TRAVD1        DUAVD1
N64  c                   move      TROPD1        DUOPD1
N64  c                   move      TRAVD2        DUAVD2
N64  c                   move      TROPD2        DUOPD2
N64  c                   if        TRSLAG = 'FF'
N64  c                   eval      DUTYPE = 'DUP FF'
N64  c                   endif
N64  c                   if        TRSLAG = 'VF'
N64  c                   eval      DUTYPE = 'DUP VF'
N64  c                   endif
N64   * opphav til dup..
N64  c                   if        DUOPD0 <> 0
N64  C     OphKey        CHAIN(N)  HEADF                              33
N64  C                   if        *in33 = '0'
N64  c                   eval      *in63  = *on
N64  c                   eval      DUTUR0 = HEPRO
N64  c                   eval      DUBIL0 = HEHAWB
N64  c                   endif
N64  c                   endif
N64   * innh.
N64  c                   if        DUOPD1 <> 0
N64  C     InhKey        CHAIN(N)  HEADF                              33
N64  C                   if        *in33 = '0'
N64  c                   eval      *in64  = *on
N64  c                   eval      DUTUR1 = HEPRO
N64  c                   eval      DUBIL1 = HEHAWB
N64  c                   endif
N64  c                   endif
N64   * utkj.
N64  c                   if        DUOPD2 <> 0
N64  C     UtkKey        CHAIN(N)  HEADF                              33
N64  C                   if        *in33 = '0'
N64  c                   eval      *in65  = *on
N64  c                   eval      DUTUR2 = HEPRO
N64  c                   eval      DUBIL2 = HEHAWB
N64  c                   endif
N64  c                   endif
N64   * hent tilbake selve oppdraget
N64  c                   move      GMAVD         HEAVD
N64  c                   move      GMOPD         HEOPD
N64  C     HEADFK        CHAIN(N)  HEADF                              33
N64  c                   endif
     c
     C                   SETOFF                                       464748
     C                   SETOFF                                       33
     C  N33HEUR          COMP      'H'                                    46
     C  N33
     CAN 46TRSLAG        IFEQ      'FF'
     C                   SETON                                        47
     C                   END
     C  N33
     CAN 46TRSLAG        IFEQ      'VF'
     C                   SETON                                        48
     C                   END
      *****      HEUR      COMP 'H'  SETTES PÅ I INITRUTINE  46/47/48
     C   41
     COR 43
     COR 45
     COR 49              MOVE      HELKA         FIRLKF
     C   41
     COR 43
     COR 45
     COR 49KOAPOS        IFEQ      'J'
     C                   MOVE      FILAND        FIRLKT
     C                   ELSE
     C     HESDT         CHAIN     STED2                              33
     C                   MOVE      ST2LK         FIRLKT
     C                   END
     C   42
     COR 44
     COR 50KOAPOS        IFEQ      'J'
     C                   MOVE      FILAND        FIRLKF
     C                   ELSE
     C     HESDF         CHAIN     STED2                              33
     C                   MOVE      ST2LK         FIRLKF
     C                   END
     C   42
     COR 44
     COR 50              MOVE      HELKA         FIRLKT
      *
      * TEST LK INC/OMIT PÅ "UTENLANDS-SIDEN" (=HELKA VED SPEDISJ.OPPD)
     C                   MOVE      HELKA         INOMLK            2
      * TRANSP.OPPD: HELKA=FRASIDE/HETRI=TILSIDE (HVIS NORGE, BRUK TIL)
     C     HEUR          IFEQ      'H'
     C     HELKA         IFEQ      FILAND
     C                   MOVE      HETRI         INOMLK            2
     C                   ELSE
     C     HETRI         IFNE      FILAND
     C                   MOVE      HETRI         INOMLK            2
     C                   END
     C                   END
      * Ved IKKE postal klargjør key for evt. FRAKT-SONE-KEY
     C                   MOVE      HELKA         FIRLKF
     C                   MOVE      HETRI         FIRLKT
     C                   END
N36  C     HEUR          IFEQ      'H'
N36  C     HELKA         IFEQ      FILAND
N36  C     HETRI         IFNE      FILAND
N36  C                   MOVE      '*EKS'        BLTR
N36  C                   ELSE
N36  C                   MOVE      '*INN'        BLTR
N36  C                   END
N36  C                   ELSE
N36  C     HETRI         IFEQ      FILAND
N36  C                   MOVE      '*IMP'        BLTR
N36  C                   ELSE
N36  C                   MOVE      '*TRA'        BLTR
N36  C                   END
N36  C                   END
N36  C                   END
      *
      * CHAINER I AVDELINGSREGISTER UANSETT PGA UTLEGGSPRVISJON
      *
      *** HENT OPPDRAGSTYPE
     C                   Z-ADD     FIUPM         FIUPMN
     C     KODO2K        CHAIN     KOOT2R                             33
     C   47
     COR 48              MOVE      'N'           KO2UTL
     C     KODTVK        CHAIN     KOVR                               33
     C     AVUTPR        IFNE      *ZEROS
     C                   Z-ADD     AVUTPR        FIUPS
     C                   Z-ADD     AVUTMI        FIUPMN            4 0
     C                   END
     C   41
     COR 42
N11  COR 43
N26  COR 44
     COR 49
     COR 50
     COR 46              DO
     C     KODTWK        CHAIN     KOWR                               33
     C                   MOVE      99999         FRVK12
     C                   END
     C   44
     COR 45KODFSK        CHAIN     KODTFSR                            33
     C     *IN44         IFEQ      *ON
     C     HEADFK        CHAIN     MCAWF                              33
     C     *IN33         IFEQ      *OFF
     C                   Z-ADD     MCMCFE        KFSMC
     C                   ENDIF
     C                   ENDIF
     C   44KODDIK        CHAIN     KODTDINR                           33
     C     DOKEFK        CHAIN     DOKEF                              33
      * Fetch From/To name.   If destination codes have a  onblank
      * alternate dest.code for freightcalculation, use that code
      * for a second try (when chaining up surface freight prices)
      * Destination from:
     C     WSSDFK        CHAIN     STED2D                             33
     C  N33              MOVEL     ST2NVN        WSFRA
     C  N33              MOVE      ST2KO2        SONEF             5
      * Destination to:
     C     WSSDTK        CHAIN     STED2D                             33
     C  N33              MOVEL     ST2NVN        WSTIL
     C  N33              MOVE      ST2KO2        SONET             5
      * Destination pre freight from:
N08  C                   IF        FIRLKF = *BLANKS
     C     HESDFF        CHAIN     STED2                              33
N08  C                   ELSE
N08  C     WSSDFKFF      CHAIN     STED2D                             33
N08  C                   END
     C  N33              MOVE      ST2KO2        SONEFF            5
      * Destination post freight to:
N08  C                   IF        FIRLKT = *BLANKS
     C     HESDVT        CHAIN     STED2                              33
N08  C                   ELSE
N08  C     WSSDTKVT      CHAIN     STED2D                             33
N08  C                   END
     C  N33              MOVE      ST2KO2        SONEVT            5
     C                   MOVE      *BLANKS       XSONEF            5
     C                   MOVE      *BLANKS       XSONET            5
      *
      * Priceagreement is done with invoice reciever (default) or
      * with goods owner. (Value "G" in FIAVTE  in fil FIRM ->goodsown.
      *
      *
      * SKJEKKER ANNEN KUNDES AVTALE
     C                   EXSR      TEKUAV
      *
      *
      * IND. 27 AV  -->  STYKKGODS
      * IND. 27 PÅ  -->  CONTAINER
     C                   SETOFF                                       27
     C     HEUR          IFEQ      'F'
     C     HEUR          OREQ      'G'
     C     HEADFK        SETLL     BLV1LF                             33
     C     STINIT        TAG
     C     HEADFK        READE     BLV1LF                                 33
     C  N33              DO
     C     BVKDC         CHAIN     CDCON4                             33
     C   33              GOTO      STINIT
     C                   SETON                                        27
     C                   END
     C     HEADFK        chain     BILLOF                             33
     C                   END
      *
     C                   MOVE      '*****'       STAR5             5
     C                   MOVE      '**'          STAR2             2
      * summerer antall fraktbrev
     C                   exsr      fordfr
      * Sjekk om firmaparameter for mailadvisering av visse gebyr er satt
     c                   move      *blanks       AdvString
S65  c*    AdvKey        chain     SYPARL1                            33
N65  C                   move      *zeros        XXPAKN
N65  C                   move      'GEADV'       XXPAID
N65  c     SyparKey      chain     SYPARL1                            33
     c     *in33         ifeq      *off
     c                   movel     SYVRDA        AdvString
     c                   move      ' '           AdvK01
     c                   move      ' '           AdvK02
     c                   move      ' '           AdvK03
     c                   move      ' '           AdvK04
     c                   move      ' '           AdvK05
     c                   move      ' '           AdvK06
     c                   move      ' '           AdvK07
     c                   move      ' '           AdvK08
     c                   move      ' '           AdvK09
     c                   move      ' '           AdvK10
     c                   move      ' '           AdvK11
     c                   move      ' '           AdvK12
     c                   end
N65   * Firmaparameter for varsel/valg ved flere parter i ferdigmelding
N65  C                   move      *zeros        XXPAKN
N65  C                   move      'FERFL'       XXPAID
N65  c     SyparKey      chain     SYPARL1                            33
N65  c     *in33         ifeq      *off
N65  C                   move      'J'           VarsleFler        1
N65  C                   move      ' '           VarsleFlerDft     1
N65  c                   if        %subst(SYVRDA:1:1)='S' or
N65  c                             %subst(SYVRDA:1:1)='K' or
N65xxc*                            %subst(SYVRDA:1:1)='K'
N65xxc                             %subst(SYVRDA:1:1)='B'
N65  C                   movel     SYVRDA        VarsleFlerDft
N65  c                   endif
N65  c                   endif
      *
N16  c                   exsr      eusr
n20  c                   move      heknkf        wskunr
s28  c*    kund1k        chain     cundl01                            33
n28  c     kund1k        chain(N)  cundl01                            33
n20  c  n33aknrku        ifne      *zeros
n20  c                   move      aknrku        wskunr
s28  c*    kund1k        chain     cundl01                            33
n28  c     kund1k        chain(N)  cundl01                            33
n20  c  n33              move      kundnr        heknka
n20  c  n33              move      knavn         henaka
n20  c                   end
     C*
n20  c                   move      heknsf        wskunr
s28  c*    kund1k        chain     cundl01                            33
n28  c     kund1k        chain(N)  cundl01                            33
n20  c  n33aknrku        ifne      *zeros
n20  c                   move      aknrku        wskunr
s28  c*    kund1k        chain     cundl01                            33
n28  c     kund1k        chain(N)  cundl01                            33
n20  c  n33              move      kundnr        heknsa
n20  c  n33              move      knavn         henasa
n20  c                   end
N21
N21   * sjekker om det finnes oppdragsnotis på en av kundenr..
N21  C     FRATXK        KLIST
N21  C                   KFLD                    FXKNR
N21  C                   KFLD                    DELSYI            1
N21  C                   MOVE      'I'           DELSYI                         I = invoice
N21  C     FRAT2K        KLIST
N21  C                   KFLD                    FXKNR
N21  C                   KFLD                    DELSYB            1
N21   * selgers f.mot
N21  C                   MOVE      HEKNSF        FXKNR
s35  C*    FRATXK        CHAIN     FRATXT                             33
n35  C     FRATXK        CHAIN     FRATXT                             61
N35  c     *in61         ifeq      '1'
N21  C   33FRAT2K        CHAIN     FRATXT                             33
N21  C  N33              SETON                                        67
N35  C                   END
N21   * selgers avt.kundenr
N21  C                   MOVE      HEKNSA        FXKNR
N21  C     FRATXK        CHAIN     FRATXT                             33
N21  C   33FRAT2K        CHAIN     FRATXT                             33
N21  C  N33              SETON                                        68
N21   * kjøpers f.mot
N21  C                   MOVE      HEKNKF        FXKNR
s35  C*    FRATXK        CHAIN     FRATXT                             33
n35  C     FRATXK        CHAIN     FRATXT                             62
n35  c     *in62         ifeq      '1'
N21  C   33FRAT2K        CHAIN     FRATXT                             33
N21  C  N33              SETON                                        69
n35  C                   end
N21   * selgers avt.kundenr
N21  C                   MOVE      HEKNKA        FXKNR
N21  C     FRATXK        CHAIN     FRATXT                             33
N21  C   33FRAT2K        CHAIN     FRATXT                             33
N21  C  N33              SETON                                        70
      *
      * omregne vareverdi
N30  C                   z-add     trverb        trvern           13 0
N30  C     trverb        ifne      *zeros
N30  C     trverv        ifne      ficurr
N30  c     VALUVER       chain     VALUL01                            33
N30  c     *in33         ifeq      '0'
N30  C     trverb        MULT      VALKU1        XWORK            17 5
N30  C     XWORK         DIV(H)    omrfak        trvern           13 0
N30  C                   END
N30  C                   END
N30  C                   END
N35  C*** TEST OM DET ER OPPLYSNINGER TIL OPPDRAG
N35  C*    FREETK        CHAIN     FREETXT3                           29
N64  C     HEADFK        CHAIN     FREETXT3                           29
     C                   ENDSR
      *
      ***********************************************
     C     NYFAK         BEGSR
      ***********************************************
     C     KODEMM        IFEQ      'M'
     C     X01B          IFEQ      'V'
     C     FABELN        IFLT      PRJUST
     C                   Z-ADD     PRJUST        FABELN
     C                   END
     C                   END
     C                   END
      * N = MAXIMUM
     C     KODEMM        IFEQ      'N'
     C     X01B          IFEQ      'V'
     C     FABELN        IFGT      PRJUST
     C                   Z-ADD     PRJUST        FABELN
     C                   END
     C                   END
     C                   END
     C                   MOVE      *BLANKS       KODEMM
     C                   EXSR      DECI
      * DERSOM BUDSJETTERT KOSTNAD - LEGG UT NY OGSÅ I KOSBU
     C                   MOVE      *ZEROS        FAJOUR
     C     FAKDUK        IFEQ      'B'
N17  C     FAKDUK        OREQ      'A'
     C                   EXSR      KOST
     C                   END
      *
     C  N47
     CANN48              MOVE      *ZEROS        FAAVDR
     C  N47
     CANN48FASK          IFEQ      'I'
     C                   Z-ADD     WSAVDR        FAAVDR
     C                   END
     C     FASK          IFEQ      'I'
     C   47              MOVE      TRAVD1        FAAVDR
     C   48              MOVE      TRAVD2        FAAVDR
     C     WSIOPD        IFNE      *ZEROS
     C                   Z-ADD     WSAVDR        FAAVDR
S04  C*                  MOVE      WSIOPD        FADOCN6_10
N04  C                   MOVE      WSIOPD        FADOCN5_11
     C                   ELSE
S04  C*                  MOVE      *BLANKS       FADOCN6_10
N04  C                   MOVE      *BLANKS       FADOCN5_11
     C                   END
     C                   END
      *
     C   49
     COR 50KGETYP        IFEQ      'SEA'                                        1<-B
     C     FAVAL         ANDNE     FICURR
     C     BLOB          ANDNE     *BLANKS
     C     BLREIS        ANDNE     *BLANKS
     C     FAKDA         IFEQ      'A'                                           2<-B
     C     FAKDA         OREQ      'B'
     C     FASK          IFEQ      'S'                                            3<-B
     C     FASK          OREQ      'K'
     C     FASK          IFEQ      'S'                                             4<-B
     C                   MOVE      HEKNSF        UKN               8 0
     C                   ELSE                                                      4
     C                   MOVE      HEKNKF        UKN
     C                   END                                                       4<-E
     C                   MOVE      BLDTA         ULDTA             6 0
     C                   CALL      'SYSJ30B'
     C                   PARM                    BLOB
     C                   PARM                    BLREIS
     C                   PARM                    FAVAL
     C                   PARM                    ULDTA
     C                   PARM                    FASK
     C                   PARM                    UKN
     C                   PARM                    FABELV
     C                   PARM                    FABELN
     C                   PARM                    VALKU1
     C                   PARM                    OMRFAK
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C                   MOVE      PKSAMM        FACD11
     C                   EXSR      SRKUNR
     C                   EXCEPT    NYFAKU
N12  C*    UNYGML        IFNE      'NY'
N12  C                   EXSR      KRAVFRI
N12  C*                  END
     C                   MOVE      *BLANKS       PKSAMM
     C                   EXSR      HENTKN
     C  N35              EXSR      PSALDO                                       PLUS SALDO
     C*
     C                   ENDSR
      *
      ***********************************************
     C     UPFAK         BEGSR
      ***********************************************
      * TEST NUBER OF DECIMALS
     C                   EXSR      DECI
      * DERSOM BUDSJETTERT KOSTNAD - LEGG UT/OPPDATER I KOSBU
     C     FAKDUK        IFEQ      'B'
N17  C     FAKDUK        OREQ      'A'
     C                   EXSR      KOST
     C                   ELSE
     C     FAJOUR        IFNE      *ZEROS
     C     FAJOUR        CHAIN     KOSBU                              34
     C  N34              DELETE    KOSBUR
     C  N34              MOVE      *ZEROS        FAJOUR
     C                   END
     C                   END
     C     FASK          IFEQ      'I'
     C                   Z-ADD     WSAVDR        FAAVDR
     C     WSIOPD        IFNE      *ZEROS
S04  C*                  MOVE      WSIOPD        FADOCN6_10
N04  C                   MOVE      WSIOPD        FADOCN5_11
     C                   ELSE
S04  C*                  MOVE      *BLANKS       FADOCN6_10
N04  C                   MOVE      *BLANKS       FADOCN5_11
     C                   END
     C                   END
      * UPDATES INVOICELINES
     C                   MOVE      ' '           FAOPKO
     C                   EXSR      SRKUNR
     C                   EXCEPT    GMFAKU
     C  N32
     CANN35              EXSR      PSALDO                                       PLUS SALDO
N12  C                   EXSR      KRAVFRI
      *
     C                   SETOFF                                           71     PROTEC WSVK
     C                   ENDSR
      *
      ***********************************************
     C     KOST          BEGSR
      ***********************************************
      *  BRUKER FAJOUR - TIL Å LAGRE X-REF TIL KOSBU
      *  FAJOUR ER "LEDIG" HELT TIL OVERFØRING TIL REGNSKAP.
      *
     C                   Z-ADD     FAJOUR        KTNR
      * TILDELER REFNUMMER
      *
     C     KTNR          CHAIN(N)  KOSBU                              34
     C   34              MOVE      *ZEROS        FAJOUR
     C     FAJOUR        IFEQ      *ZEROS
     C     'Å'           CHAIN     KOSTT                              34
     C   34              MOVE      'Å'           KTTYP
     C   34              Z-ADD     1000000       KTNR
     C   34              WRITE     KOSTTR
     C  N34              ADD       1             KTNR
     C  N34              UPDATE    KOSTTR
     C                   END
      *
     C     KTNR          CHAIN     KOSBU                              34
     C   34              MOVE      ' '           BUST
     C   34              MOVE      *ZEROS        BUBNR2
     C* IKKE OPPDATER HVIS FØRT/PLUKKET TIL KOSTN.BILAG..
     C     BUST          IFEQ      ' '
     C     BUBNR2        ANDEQ     *ZEROS
     C                   MOVE      KTNR          BUBNR
     C                   MOVEL     HEDTÅ         BUPCC
     C                   MOVE      HEDTÅ         BUPÅR
     C                   MOVE      HEDTM         BUPMN
     C                   MOVE      *ZEROS        BUTNR
     C                   MOVE      FALEVN        BULNR
     C                   MOVE      FACU33        BUVAL
     C     BUVAL         IFEQ      '   '
     C                   MOVE      FICURR        BUVAL
     C                   END
     C                   Z-ADD     FABELU        BUBL
     C                   MOVE      FAVK          BUVK
     C                   MOVE      HESG          BUSG
      * Sikre riktig BUTAVD (kan være ulik HEAVD hvis samlast)
     C                   MOVE      *ZEROS        TUAVD
     C                   MOVE      *ZEROS        TUPRO
     C     HEPRO         IFNE      *ZEROS
     C     HEPRO         CHAIN     TURER14                            31
     C                   MOVE      TUAVD         BUTAVD
     C                   MOVE      TUPRO         BUTUNR
     C                   END
     C                   MOVE      HEAVD         BUOAVD
     C                   MOVE      HEOPD         BUOPD
     C* + VISSE FELTER "INITIERES" KUN VED NY (BETING  34 LAGT PÅ)
     C   34              MOVE      'E'           BUBLST
     C   34              MOVE      'E'           BUTYPE
     C   34              MOVE      *BLANKS       BUTXT
     C   34              MOVE      *BLANKS       BUBILK                         *BILKODE
     C   34              MOVE      *BLANKS       BUBILN                         *BILNUMMER
     C   34              MOVE      *ZEROS        BUFEDT                         *FERJ/TURDTO
     C   34              MOVE      'O'           BUFER                          *O = OPPDRAG
     C   34              MOVE      *ZEROS        BUBNR2                         *FØRT BNR
     C   34              MOVE      *ZEROS        BUBNR3                         *"SLAVE" AV.
     C   34              MOVE      *ZEROS        BULNR3                         SLAVE-LØPENR
     C   34              MOVE      *ZEROS        BUBLFD                         *FORDELT BEL
     C                   END
     C                   MOVE      *BLANKS       XXAWB2
     C                   MOVE      *BLANKS       XXAWB3
     C                   SELECT
     C     HEUR          WHENEQ    'C'
     C                   MOVEL     HERFA         XXAWB2           15              FULLE 15
     C     HEUR          WHENEQ    'D'
     C     HEUR          OREQ      'E'
     C                   MOVE      HEGN          XXAWB3           11              11 SISTE
     C                   MOVEL     XXAWB3        XXAWB2
     C                   ENDSL
     C   34HEUR          IFEQ      'C'
     C     HEUR          OREQ      'D'
     C     HEUR          OREQ      'E'
     C                   MOVEL     'AWB:'        BUTXT
     C                   END
     C                   MOVEL     BUTXT         XXAWB1            4
     C     XXAWB1        IFEQ      'AWB:'
     C     XXAWB2        ANDNE     *BLANKS
     C                   MOVEL     XXAWB1        XXAWB            19
     C                   MOVE      XXAWB2        XXAWB
     C                   MOVEL     XXAWB         BUTXT
     C                   END
     C   34              WRITE     KOSBUR
     C  N34              UPDATE    KOSBUR
     C                   MOVE      KTNR          FAJOUR
     C                   ENDSR
      ***********************************************
     C     DECI          BEGSR
      ***********************************************
      * TEST FIRMS NUMBER OF DECIMALS
      *
      * NO DECIMALS
     C     FIDECI        IFEQ      0
     C                   Z-ADD(H)  FABELN        FABEL0           11 0
     C                   Z-ADD     FABEL0        FABELN
     C                   Z-ADD(H)  FABELU        FABEL0           11 0
     C                   Z-ADD     FABEL0        FABELU
     C                   ELSE
      * 1 DECIMAL
     C     FIDECI        IFEQ      1
     C                   Z-ADD(H)  FABELN        FABEL1           12 1
     C                   Z-ADD     FABEL1        FABELN
     C                   Z-ADD(H)  FABELU        FABEL1           12 1
     C                   Z-ADD     FABEL1        FABELU
     C                   END
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     KDTFMT        BEGSR
      ***********************************************
      * CHANGES DATE-FORMAT FROM FIRM TO INTERNAL
     C                   MOVE      HEDTD         UDT1              2 0
     C                   MOVE      HEDTM         UDT2              2 0
     C                   MOVE      HEDTÅ         UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          WSDTD
     C                   MOVE      UDT2          WSDTM
     C                   MOVE      UDT3          WSDTÅ
      *
     C                   ENDSR
      ***********************************************
     C     VISFRE        BEGSR
      ***********************************************
     C                   Z-ADD     0             UFLAGG
     C                   CALL      'SYFA31CL'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    UFLAGG
     C                   ENDSR
      *
      ***********************************************
     C     FYLARR        BEGSR
      ***********************************************
     C     PKAVTT        IFEQ      'G'
     C     PKAVTT        OREQ      'H'
     C                   SETON                                        32
     C                   ADD       1             GN                2 0
     C                   MOVE      PKGEBY        GNT(GN)
     C                   SORTA     GNT
     C                   ELSE
     C                   MOVE      'J'           AVTALE            1
     C                   END
     C                   ENDSR
      ***********************************************
     C     TGISR         BEGSR
      ***********************************************
     C                   MOVE      '0101'        FRAII             4 0
     C                   MOVEL     HESDVT        TILII             4 0
     C     HEUR          IFEQ      'C'
     C     WSSDTK        CHAIN     STED2D                             33
     C  N33              MOVE      ST2PNR        TILII
     C                   END
     C                   Z-ADD     HELM          IILM              7 3
     C                   Z-ADD     HEM3          IIM3              7 3
     C                   Z-ADD     HENT          IIANT             7 0
     C                   Z-ADD     XTKNR         IIKUND
     C*BURDE EN HATT 2 PARAM FOR OVERST?? 1 FOR STED, 1 FOR PRIS/RABATT
     C                   MOVE      'J'           UOVERS                          OVERST.STED
     C                   MOVE      *ZEROS        URAB
     C                   MOVE      *ZEROS        NULLTR
     C                   MOVE      *ZEROS        UFBN
     C                   CALL      'SYFB03'
     C                   PARM                    FRAII
     C                   PARM                    TILII
     C                   PARM                    HEVKT
     C                   PARM                    IILM
     C                   PARM                    IIM3
     C                   PARM                    NULLTR            8 0
     C                   PARM                    INLFRA            9 0
     C                   PARM                    HEFBV
     C                   PARM                    IFLAGG            1 0
     C                   PARM                    UOVERS            1
     C                   PARM                    IIKUND            8 0
     C                   PARM                    IIANT             7 0
     C                   PARM                    UTGSON            3
     C                   PARM                    UBL2              9 0           *BRUTTO
     C                   PARM                    URAB              3 1           *BEN. RAB
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD              7 0           IKKE I BR.
     C                   PARM                    UFBN              3 0           IKKE I BR.
     C                   Z-ADD     INLFRA        PRBELØ
     C                   MOVE      FICURR        WSVAL
     C                   ENDSR
      ***********************************************
     C     TGIHTTP       BEGSR
      ***********************************************
     C                   MOVE      'N'           UOVERS
     C                   MOVE      '0101'        U2PNF             4
     C                   MOVEL     HESDVT        U2PNT             4
     C     HEUR          IFEQ      'C'
     C     WSSDTK        CHAIN     STED2D                             33
     C  N33              MOVE      ST2PNR        U2PNT
     C                   END
     C                   MOVE      HENT          U2NT              7
     C                   MOVE      HEVKT         U2VKT             9
     C                   MOVE      HEM3          U2DM3             7
     C                   MOVE      *ZEROS        U2KNT             8
     C                   MOVE      *ZEROS        U2RAB             3
     C                   MOVE      '0'           U2FLAGG           1
     C                   MOVE      UAVD          U2AVD             4
     C                   MOVE      UOPD          U2OPD             7
     C                   MOVE      XTKNR         U2KN              8
     C                   CALL      'SYFB05C'
     C                   PARM                    U2PNF
     C                   PARM                    U2PNT
     C                   PARM                    U2NT
     C                   PARM                    U2VKT
     C                   PARM                    U2DM3
     C                   PARM                    U2KNT
     C                   PARM                    U2BRTBL           9
     C                   PARM                    U2NETBL           9
     C                   PARM                    U2RAB
     C                   PARM                    U2FLAGG
     C                   PARM                    U2AVD
     C                   PARM                    U2OPD
     C                   PARM                    U2KN
N31  C                   PARM                    U2KS             12
N31  C                   PARM                    U2tra             8
N31  C                   PARM                    U2pro             5
     C                   IF        U2FLAGG = '0'
     C                   MOVE      U2BRTBL       U2BRTBL2          9 0
     C                   Z-ADD     U2BRTBL2      PRBELØ
N02  C                   MOVE      'A'           XKDA
     C                   END
     C                   MOVE      FICURR        WSVAL
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRKUNR        BEGSR
     C****************************************************
      *
     C     FASK          IFEQ      'S'
     C                   MOVE      HEKNSF        FAKUNR
     C                   END
     C     FASK          IFEQ      'K'
     C                   MOVE      HEKNKF        FAKUNR
     C                   END
     C     FASK          IFEQ      'A'
     C                   MOVE      HEKNA         FAKUNR
     C                   END
     C                   ENDSR
      ***********************************************
     C     FORDFR        BEGSR
     C****************************************************
     C                   Z-ADD     0             FORANT            5 0
     C                   MOVE      '0'           *IN34
     C     DOKUI2        SETLL     DOKUI
     C     *IN34         DOWEQ     '0'
     C     DOKUI2        READE     DOKUI                                  34
     C  N34              ADD       1             FORANT
     C                   END
     C                   MOVE      '0'           *IN34
     C     DOKUF2        SETLL     DOKUF
     C     *IN34         DOWEQ     '0'
     C     DOKUF2        READE     DOKUF                                  34
     C  N34              ADD       1             FORANT
     C                   END
     C                   ENDSR
      ***********************************************
     C     TEKUAV        BEGSR
     C****************************************************
      * DISSE LINJENE ER FLYTTET FRA INITRUTINEN
      * Priceagreement is done with invoice reciever (default) or
      * with goods owner. (Value "G" in FIAVTE  in fil FIRM ->goodsown.
      *
     C     FIAVTE        IFEQ      'G'
      * Goodsowner (swapp values in workfields )
     C     HEKNS         IFNE      *ZEROS
     C                   MOVE      HEKNS         XAKNSF
     C                   ELSE
     C                   MOVE      HEKNSF        XAKNSF
     C                   END
     C     HEKNK         IFNE      *ZEROS
     C                   MOVE      HEKNK         XAKNKF
     C                   ELSE
     C                   MOVE      HEKNKF        XAKNKF
     C                   END
     C                   MOVE      HEKNSF        XAKNS
     C                   MOVE      HEKNKF        XAKNK
     C                   ELSE
      * Invoicereciever (default)
     C                   MOVE      HEKNS         XAKNS             8 0
     C                   MOVE      HEKNSF        XAKNSF            8 0
     C                   MOVE      HEKNK         XAKNK             8 0
     C                   MOVE      HEKNKF        XAKNKF            8 0
     C                   END
      *
     C     KUKEY1        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    XAKNS
     C     KUKEY2        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    XAKNSF
N38  C     EPOKEYS       KLIST
N38  C                   KFLD                    UFIRM
N38  C                   KFLD                    mail30
N38  C                   KFLD                    XAKNSF
     C     KUKEY3        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    XAKNK
     C     KUKEY4        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    XAKNKF
N38  C     EPOKEYk       KLIST
N38  C                   KFLD                    UFIRM
N38  C                   KFLD                    mail30
N38  C                   KFLD                    XAKNKF
      *
     C     KUKEY1        CHAIN(N)  CUNDL01                            33
     C  N33AKNRKU        IFNE      *ZEROS
     C                   MOVE      AKNRKU        XAKNS
     C                   END
      *
N38  C                   MOVE      'N'           EPOSTS            1
N38  c     epokeys       CHAIN     cundc03                            33
N38  c  N33              MOVE      'J'           epostS
     C     KUKEY2        CHAIN(N)  CUNDL01                            33
     C  N33AKNRKU        IFNE      *ZEROS
     C                   MOVE      AKNRKU        XAKNSF
     C                   END
      *
      *
     C     KUKEY3        CHAIN(N)  CUNDL01                            33
     C  N33AKNRKU        IFNE      *ZEROS
     C                   MOVE      AKNRKU        XAKNK
     C                   END
      *
N38  C                   MOVE      'N'           EPOSTK            1
N38  c     epokeyk       CHAIN     cundc03                            33
N38  c  N33              MOVE      'J'           epostk
     C     KUKEY4        CHAIN(N)  CUNDL01                            33
     C  N33AKNRKU        IFNE      *ZEROS
     C                   MOVE      AKNRKU        XAKNKF
     C                   END
     C                   ENDSR
      ***********************************************
     C     VEISR         BEGSR
      ****************************************************
      * finner aktuelle gebyrer på HEUR landet
      *
     C     VEIKE0A       KLIST
     C                   KFLD                    HEUR
     C     VEIKE0B       KLIST
     C                   KFLD                    HEUR
     C                   KFLD                    VEIGK
     C                   setoff                                       32
     C     VEIKE0A       setll     veiavgl3
     C     stvei         tag
     C     VEIKE0A       reade     veiavgl3                               32
     C     *in(32)       ifeq      '0'
     C                   move      veigeb        veigk             3
     C     firlkf        ifeq      veilko
     C     firlkt        oreq      veilko
     C                   exsr      veisr0
     c                   setoff                                       32
     c     VEIKE0B       setgt     veiavgl3
     C                   end
     c                   goto      stvei
     c                   end
     c                   endsr
      ***********************************************
     C     VEISR0        BEGSR
      ****************************************************
     C                   move      fakunr        VEIKUN            8 0
     C     AKNRKU        IFNE      *ZEROS
     C                   MOVE      AKNRKU        VEIKUN
     C                   END
     C     HEFBV         IFGT      99999
     C                   Z-ADD     99999         XINT
     C                   ELSE
     C                   Z-ADD     HEFBV         XINT
     C                   END
      *
     c                   move      *zeros        veinul
     c     st0           tag
      *
     c                   move      *blanks       veifor            3
     C     VEIKE         KLIST
     C                   KFLD                    HEUR
     C                   KFLD                    VEINUL
     C                   KFLD                    landko            2
     C                   KFLD                    sone
     C                   KFLD                    veigk
     C     VEIKES        KLIST
     C                   KFLD                    HEUR
     C                   KFLD                    VEINUL
     C                   KFLD                    landko            2
     C                   KFLD                    sone
     C                   KFLD                    veigk
     c                   move      firlkf        landko
     c                   move      sonef         sone              5
     c     veike         setll     veiavgl2
     c     veike         reade     veiavgl2                               31
     c   31              move      star5         sone
     c   31veike         setll     veiavgl2
     c   31veike         reade     veiavgl2                               31
     c   31              move      firlkt        landko
     c   31              move      sonet         sone              5
     c   31veike         setll     veiavgl2
     c   31veike         reade     veiavgl2                               31
     c   31              move      star5         sone
     c   31veike         setll     veiavgl2
     c   31veike         reade     veiavgl2                               31
     c*
     c* skjekker også forfrakt viderefraktsoner
     c*
     c   31              move      firlkf        landko
     c   31              move      soneff        sone              5
     c   31veike         setll     veiavgl2
     c   31veike         reade     veiavgl2                               31
     c   31              move      star5         sone
     c   31veike         setll     veiavgl2
     c   31veike         reade     veiavgl2                               31
     c   31              move      firlkt        landko
     c   31              move      sonevt        sone              5
     c   31veike         setll     veiavgl2
     c   31veike         reade     veiavgl2                               31
     c   31              move      star5         sone
     c   31veike         setll     veiavgl2
     c   31veike         reade     veiavgl2                               31
     c   31veinul        ifeq      0
N32  c     veikun        andne     0
     c                   move      veikun        veinul
     c                   goto      st0
     c                   end
      *
      * tabell funnet ved N31
     c  N31              exsr      veisr1
      *
     C                   endsr
      ***********************************************
     C     VEISR1        BEGSR
      ****************************************************
     C* TESTER OM LAND HAR VEIAVGIFT
     C     *LIKE         DEFINE    FAKUNR        VEINUL
      *
     C     UTELATK1      KLIST
     C                   KFLD                    VEIGEB
     C                   KFLD                    HEUR
     C                   KFLD                    FIRLKF
     C                   kfld                    FASK
     C                   KFLD                    HEFR
      *
     C     UTELATK2      KLIST
     C                   KFLD                    VEIGEB
     C                   KFLD                    HEUR
     C                   KFLD                    FIRLKT
     C                   kfld                    FASK
     C                   KFLD                    HEFR
      *
      *
      * BRUTTONØKLER
      *
      *
      * KUNDENØKLER
      *
     C     VEIKK1        KLIST
     C                   KFLD                    HEUR
     C                   KFLD                    VEIKUN
     C                   KFLD                    VEILKO
     C                   KFLD                    VEISON
     C                   KFLD                    VEIGK
     C     VEIKK2        KLIST
     C                   KFLD                    HEUR
     C                   KFLD                    VEIKUN
     C                   KFLD                    VEILKO
     C                   KFLD                    STAR5
     C                   KFLD                    VEIGK
     C     VEIKK3        KLIST
     C                   KFLD                    HEUR
     C                   KFLD                    VEIKUN
     C                   KFLD                    STAR2
     C                   KFLD                    STAR5
     C                   KFLD                    VEIGK
     C     VEITKE        KLIST
     C                   KFLD                    VEITAB
     C                   KFLD                    VEIGK
     C                   KFLD                    XINT
     C     VEITK2        KLIST
     C                   KFLD                    VEITAB
     C                   KFLD                    VEIGK
      *
      * test om den skal utelates N32 SKAL UTELATES
      *
     C     UTELATK1      CHAIN     VEIAVGFN                           32
     C   32UTELATK2      CHAIN     VEIAVGFN                           32
      *
      *
      * N34 FINNES BRUTTOTABELL
      *
     C     *IN32         IFEQ      '1'
      *
      *
      * N34 TEST OM KUNDE ER UNNTATT ELLER HAR EGEN AVTALE
      *
     C     VEIKK1        CHAIN     VEIAVGL2                           32
     C   32VEIKK2        CHAIN     VEIAVGL2                           32
     C   32VEIKK3        CHAIN     VEIAVGL2                           32
     C  N32VEITAB        IFEQ      '*'
     C                   GOTO      VEIUT
     C                   END
     C     VEITKE        SETLL     PRISVEI
     C     VEITK2        READE     PRISVEI                                34
     C     *IN34         IFEQ      '0'
      *
      * TA VARE PÅ SISTE GEBYRKODE
      *
     C                   MOVE      VEIGEB        FAVK
     C                   MOVE      'B'           FAKDA
     C  N32              MOVE      'A'           FAKDA
      * beregne som prosent av frakt
     C     PRKOLL        IFEQ      'P'
     C                   exsr      FRAPROSR
     C     SUMFRA        MULT      PRBELØ        SUMFRA
     C     SUMFRA        DIV(H)    100           PRBELØ
     C                   else
     C     PRANT         IFGT      0
     C                   EXSR      OMREGN
     C                   END
     C                   end
     C                   Z-ADD(H)  PRBELØ        FABELN
     C                   Z-ADD(H)  PRBELØ        FABELV
     C                   Z-ADD(H)  PRBELØ        WSBELV
      *
      * SKAL EVT. BYTTES MED ØNSKET VALUTA VED INNLEGGING
      *
     C                   move      FICURR        WSVAL
     C                   move      fask          wssk
     C     FAVAL         IFEQ      FICURR                                       1<-B
     C                   EXSR      VALUTA
     C                   ELSE                                                   1
     C                   EXSR      VALUT2
     C                   move      FICURR        FAVAL
     C     FASK          IFEQ      'S'                                           2<-B
     C     HEVALS        IFNE      '   '                                          3<-B
     C     HEVALS        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     HEVALK        IFNE      '   '                                          3<-B
     C     HEVALK        ANDNE     FAVAL
     C                   EXSR      VALUTA
     C                   END                                                     2<-E
     C                   END                                                    1<-E
     C                   MOVE      XBELN         FABELN
     C                   END                                                    1<-E
      *
     C                   EXSR      SPLISR
     C                   CALL      'SYGE06'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    FALI
     C     heur          ifeq      'H'
     c                   move      trmva         fakdm
     c                   end
     c     fakdm         ifne      'N'
     c     fakdm         andne     'J'
     C                   move      'N'           fakdm
     c                   end
     C                   EXSR      NYFAK
     C                   END
     C                   END
     C     VEIUT         ENDSR
     C******************************************
     C     KUOMR         BEGSR
     C******************************************
     C*
     C* FINNER FRAKTBEREGNINGSVEKT
     C*
     C     HELM          MULT      MLLM          XFBV1             9 0
     C     HEM3          MULT      M3M3          XFBV2             9 0
     C     HEVKT         IFGE      XFBV1
     C                   Z-ADD     HEVKT         HEFBV             9 0
     C                   ELSE
     C                   Z-ADD     XFBV1         HEFBV
     C                   END
     C     HEFBV         IFLT      XFBV2
     C                   Z-ADD     XFBV2         HEFBV
     C                   END
     C*
     C                   ENDSR
      ******************************************
     C     DLTFTXT       BEGSR
      ******************************************
     C     FAKTXTK       KLIST
     C                   KFLD                    FAAVD
     C                   KFLD                    FAOPD
     C                   KFLD                    FALI
      *
     C     FAKTXTK       SETLL     FAKTXT
     C     FAKTXTK       READE     FAKTXT                                 31
     C                   DOW       *IN31 = *OFF
     C                   DELETE    FAKTXTR
     C     FAKTXTK       READE     FAKTXT                                 31
     C                   ENDDO
      *
     C                   ENDSR
      *
     C***********************************************
     C     SUMOTHA       BEGSR
     C***********************************************
      * summerer other charges due agent
      *
     C                   Z-ADD     0             wsblda            9 2
     c                   setoff                                       66
      *
      *
     C     HEADFK        SETLL     DOKOTH
     C     HEADFK        READE     DOKOTH                                 66
     C     *in(66)       doweq     '0'
      *
     C     DO1332        IFEQ      'A'
     C                   ADD       DO1333        wsblda
     C                   ENDIF
      *
     C     HEADFK        READE     DOKOTH                                 66
     C  N66              ENDDO
     C                   ENDSR
n09  c***********************************************************************
n09  c     REGTIL        begsr
n09  c***********************************************************************
n34   * finn om tillegg er låst til FRA,FR1 ELLER FR2
n34  C                   MOVE      HEVALT        WSVK
n34  C     KODGEK        CHAIN     KOGER                              36
n34  c                   move      kgetyp        ffftyp            3
n09  C                   MOVE      'K'           xsk
n09  C     HEKDFK        IFEQ      'X'
n09  C                   MOVE      'S'           xsk
n09  c                   end
n09  c     heur          ifeq      'H'
n09  c     trslag        andne     'HO'
n09  c                   move      'I'           xsk
n09  c                   end
n66  c     heur          ifeq      'H'
n66  c                   move      TRKDFF        xsk
n66  c                   end
n09  C*
n09  C* summerer varelinjer av type fra fr1 fr2
n09  C* (SOM IKKE ER FAKTURERT)
n09  C*
n09  c                   move      *zeros        fr12no           13 2
n09  c                   move      *zeros        fr12va           13 2
n09  c                   z-add     0             tillli            5 0
n09  C                   SETOFF                                       33
n09  C     fak4k         SETLL     FAK4
n09  C     *IN33         DOWEQ     '0'
n09  C     fak4k         READE     FAK4                                   33
n09  c     *in(33)       ifeq      '0'
n09  C     FAVK          IFEQ      HEVALT
s67   * ikke autoberegne kreditlinjer
s67  c*    fabeln        andge     0
n09  c                   z-add     fali          tillli
n09  c                   else
n09  C                   MOVE      FAVK          WSVK
n09  C     KODGEK        CHAIN     KOGER                              36
n34   * summerer alle FRA FR1 FR2 når tillegg hra blank type
n34  c  N36ffftyp        ifeq      *blanks
n09  C  N36KGETYP        ifeq      'FR1'
n09  c     KGETYP        oreq      'FR2'
n09  c     KGETYP        oreq      'FRA'
n09  c                   add       fabeln        fr12no
n09  c                   add       fabelv        fr12va
n09  c                   end
n34  c                   else
n34   * summerer type lig tilleggets type
n34  c     ffftyp        ifeq      KGETYP
n34  c                   add       fabeln        fr12no
n34  c                   add       fabelv        fr12va
n34  C                   END
n34  C                   END
n09  C                   END
n09  C                   END
n09  C                   END
      * oppdaterer hvis linjen eksisterer
n09  c     tillli        ifne      *zeros
N66   * ved heur H  og null i summering hent frakt fra linje null som da er fakturert
N66  c     fr12no        ifeq      0
N66  C     heur          andeq     'H'
N66  C                   z-add     0             fali
N66  c     faktk         chain(n)  fakt                               33
N66  c     *in33         ifeq      '0'
n66  c                   add       fabeln        fr12no
n66  c                   add       fabelv        fr12va
N66  c                   end
N66  c                   end
n09  c                   z-add     tillli        fali
n09  c     faktk         chain     fakt                               33
n09  c  N33faopko        iflt      'D'
n09  c     favk          andeq     hevalt
n09  c                   z-add     fr12no        fabeln
n09  c                   z-add     fr12va        fabelv
n09  C     FABELV        MULT      HEVALP        FABELV
n09  C     FABELN        MULT      HEVALP        FABELN
n09  C                   exsr      deci
n09  c                   update    faktr
n09  c                   end
N66   * skriv ny
N66  c                   else
N66  C                   move      *zeros        fajour
N66  C                   MOVE      *ZEROS        FABELU
N66  C                   MOVE      *BLANKS       FACU33
N66  C                   MOVE      *BLANKS       FAKDUK
N66  c                   move      *blanks       favt
N66  c                   MOVE      hevalt        favk
N66  c                   z-add     fr12no        fabeln
N66  c                   z-add     fr12va        fabelv
N66  C     FABELV        MULT      HEVALP        FABELV
N66  C     FABELN        MULT      HEVALP        FABELN
N66  C     FABELN        IFNE      *zeros
N66  C                   exsr      deci
N66  C                   CALL      'SYGE06'
N66  C                   PARM                    UAVD
N66  C                   PARM                    UOPD
N66  C                   PARM                    FALI
N66  C                   EXCEPT    NYFAKU
n66  c                   end
n09  c                   end
n09  c                   endsr
n12   *
n12   ***********************************************
n12  C     KRAVFRI       BEGSR
n12   ***********************************************
n12   * IN34 av vil si krav
n12   *
n12   *
S46  C*    FAVT          IFEQ      *BLANKS
S46  C*    UFLAGG        andne     3
N46  C     UFLAGG        IFNE      3
N12  C     UFLAGG        andne     6
N12  C     UFLAGG        andne     9
N12  C     FAKTXTK       CHAIN(N)  FAKTXT                             34
n12  c     *in34         ifeq      '1'
n12  c                   MOVEL     FAVK          EXTGEB
n12  c     extkey        setll     syparl1
n12  c     extkey2       reade     syparl1                                34
n12  c   34extkeya       setll     syparl1
n12  c   34extkey2a      reade     syparl1                                34
      *
n12  c     *in34         ifeq      '0'
n12  c                   movel     SYVRDA        GEB3              3
n12  c     geb3          comp      favk                               3434
N12  C  N34              EXSR      EXTLIN
n12  c                   end
      *
N12  C                   END
N12  C                   END
n12  c                   endsr
n12   *
n12   ***********************************************
n12  C     EXTLIN        BEGSR
n12   ***********************************************
N12  C     UNYGML        IFEQ      'NY'
N12  C                   OPEN      SYFI10FX
N12  C                   END
n12  c                   move      favk          favkti            3
N46  C                   EVAL      FRI000=FAVT
n12  c     frifeil       tag
N12  C
n12  c                   exfmt     FRITXT
n12  C     WSCLOW        DIV       256           LINNBR            3 0
n12  C                   MVR                     POSNBR            3 0
n12   *
N12   * F4 = SØK
n12   *
N12  C     *IN04         IFEQ      '1'
N12  C     LINNBR        ANDGE     3
N12  C     LINNBR        ANDLE     7
N12  C     LINNBR        SUB       2             NR
N12  C                   EXSR      EXTLINS
n12  c                   goto      frifeil
N12  C                   END
n12   *
n12  c     fri000        ifeq      *blanks
N12  C     FRIX          ANDEQ     *BLANKS
n12  c                   goto      frifeil
n12  c                   end
      *
N12   *OPPDARTERER FAKTURALINJEN
      *
n12  c     fri000        ifne      *blanks
n12  c     FAKTXTK       chain     FAKT                               34
n12  c                   movel     fri000        favt
n12  c  N34              update    faktr
n12  c                   end
N12   *OPPDARTERER TILLEGGSTEKSTER
N12  C     FRIX          IFNE      *BLANKS
n12  c                   move      faavd         fxavd
n12  c                   move      faopd         fxopd
n12  c                   move      fali          fxli
N12   *
N12  C     1             DO        5             NR                2 0
n12  c     fri(NR)       ifne      *blanks
n12  c                   move      fri(NR)       fxvt
n12  c                   write     faktxtr
n12  c                   end
N12  C                   END
N12   *
n12  c                   end
     C                   CLEAR                   FRITXT
N12  C     UNYGML        IFEQ      'NY'
N12  C                   CLOSE     SYFI10FX
N12  C                   END
n12  c                   endsr
n12   *
n12   ***********************************************
n12  C     EXTLINS       BEGSR
n12   ***********************************************
n12   * søke på linjer
N12  C                   MOVE      'E'           UUPDAT            1
N12  C                   MOVEL     'GETXTKOD'    KFTYPI           10
n12  C                   CALL      'SYKUKD'
n12  C                   PARM                    KFTYPI
n12  C                   PARM                    UUPDAT
n12  C                   PARM                    KFKOD             5
N12  C     FASTIK        CHAIN     KUFAST                             34
     C  N34SPRAAK        IFEQ      ' '
N12  C                   MOVEL     KFTXT         FRI(NR)
N12  C                   ELSE
N12  C                   MOVEL     KFTXTE        FRI(NR)
N12  C                   END
N12  C     LINNBR        IFLT      6
N12  C                   ADD       1             LINNBR
N12  C                   END
n16  C                   ENDSR
N16  C***********************************************
N16  C     EUSR          BEGSR
N16  C***********************************************
N16  C     EUKEY         KLIST
N12  C                   KFLD                    EUKODE
N12  C                   KFLD                    WSVK
N16  C                   MOVE      *BLANKS       EUKODE            1
N16   * SPESIALKONTERING EU
N16  C     KODTS2K       KLIST
N16  C                   KFLD                    KS2UNI
N16  C                   KFLD                    KS2LK
N16  C                   MOVEL     'S2'          KS2UNI
N16  C
N16   *
N16   * unntak for eu (KS2PRE=B)
N16   *
N16  C                   MOVE      FILAND        KS2LK
N16  C     KODTS2K       CHAIN     KODTS2                             33
N16   *
N16   * EGET LAND ER EU
N16   *
N16  C  N33KS2PRE        IFEQ      'B'
N16   *
N16   *
N16   * DOMESTIC
N16   *
N16  C     FILAND        IFEQ      FIRLKF
N16  C     FILAND        ANDEQ     FIRLKT
N16  C                   MOVE      'D'           EUKODE
N16  C                   END
N16   *
N16   *
N16   * TRANSIT  BEGGE LAND I EU
N16   *
N16  C     FIRLKF        IFNE      FIRLKT
N16  C                   MOVE      FIRLKF        KS2LK
N16  C     KODTS2K       CHAIN     KODTS2                             33
N16  C  N33KS2PRE        IFEQ      'B'
N16  C                   MOVE      FIRLKT        KS2LK
N16  C     KODTS2K       CHAIN     KODTS2                             33
N16  C  N33KS2PRE        IFEQ      'B'
N16  C                   MOVE      'T'           EUKODE
N16  C                   END
N16  C                   END
N16  C                   END
N16   *
N16  C                   END
N16  C                   SETOFF                                       33
N16  C                   ENDSR
N22   ***********************************************
N22  C     ARKIVS        BEGSR
N22   ***********************************************
N22  C                   CALL      'ARC003'
N22  C                   PARM                    UAVD
N22  C                   PARM                    UOPD
N22  C                   PARM                    URUNDE           10
N22  C                   ENDSR
N56   *********************************************************************
N56  c     ekunde        begsr
N56   *********************************************************************
N56   * er det epostkunde
N56   *
N56  C     EPOKEYSI      KLIST
N56  C                   KFLD                    FIFIRM
N56  C                   KFLD                    mail30B          30
N56  C                   KFLD                    FEKN
N56  C                   eval      mail30B='*SINGELFAKTURA'
N56  C     EPOKEYSA      KLIST
N56  C                   KFLD                    FIFIRM
N56  C                   KFLD                    mail30S          30
N56  C                   KFLD                    FEKN
N56  C                   eval      mail30S='*SAMLEFAKTURA'
N63  C     EPOKEYSI0     KLIST
N63  C                   KFLD                    FIFIRM
N63  C                   KFLD                    mail30B          30
N63  C                   KFLD                    NULLKU            8 0
N63  C     EPOKEYSA0     KLIST
N63  C                   KFLD                    FIFIRM
N63  C                   KFLD                    mail30S          30
N63  C                   KFLD                    NULLKU
N56  c*
N56  C                   MOVE      'N'           FVENT
N56  C                   MOVE      'N'           EPOJN
      *
      * SINGELFAKTURA
      *
N56  C     FESFAK        IFEQ      ' '
N56  c     epokeySI      CHAIN     cundc03                            34
N63  C     *IN34         IFEQ      '0'
E63  C                   MOVE      'J'           EPOJN
N63  C                   ELSE
N56  c     epokeySI0     CHAIN     cundc03                            34
N53  C  N34CEMAIL        IFEQ      '@user'
E63  C                   MOVE      'J'           EPOJN
N63  C                   END
N63  C                   END
      *
N56  C                   ELSE
      *
      * SAMLEFAKTURA
      *
N56  c     epokeySA      CHAIN     cundc03                            34
N63  C     *IN34         IFEQ      '0'
E63  C                   MOVE      'J'           EPOJN
N63  C                   ELSE
N56  c     epokeySA0     CHAIN     cundc03                            34
N63  C  N34CEMAIL        IFEQ      '@user'
E63  C                   MOVE      'J'           EPOJN
N63  C                   END
N63  C                   END
N56  C                   END
N56  C                   ENDsr
      *
     OFAKTR     EADD         NYFAKU
     O                       FA01
     O                       FALI
     O                       FAAVD
     O                       FAOPD
     O                       FASK
     O                       FAVK
     O                       FAVT
     O                       FAVAL
     O                       FABELV
     O                       FAKDM
     O                       FABELN
     O                       FAKDA
     O                       FAKDUL
     O                       FA01B
     O                       FAKDUK
     O                       FA01B
     O                       FABELU
     O                       FALEVN
     O                       FAKUNR
     O                       FAAVDR
     O                       FAJOUR
     O                       FAAGRN
     O                       FAEXRA
     O                       FACD11
     O                       FACURI
     O                       FACU33
     O                       FADOCN
     OFAKTR     E            GMFAKU
     O                       FA01
     O                       FASK
     O                       FAVK
     O                       FAVT
     O                       FAVAL
     O                       FABELV
     O                       FAKDM
     O                       FABELN
     O                       FAKDA
     O                       FAKDUL
     O                       FAOPKO
     O                       FA01B
     O                       FAKDUK
     O                       FA01B
     O                       FABELU
     O                       FALEVN
     O                       FAKUNR
     O                       FAAVDR
     O                       FAJOUR
     O                       FAAGRN
     O                       FAEXRA
     O                       FACD11
     O                       FACD13
     O                       FACURI
     O                       FACU33
     O                       FADOCN
     OFAKTR     E            NYKN
     O                       FAKUNR
     OKUNDR     E            NYSALD
     O                       SYSALU
