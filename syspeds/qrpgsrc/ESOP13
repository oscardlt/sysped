      *********************************************************************
      *     Kun MODUL - Benyttes av ESOP11
      *********************************************************************
ODDEV *ODDEV   PTF9 ODDEVEN-logikk
      *********************************************************************
oddevFBRIDF     IF   E           K DISK
     FWRKCGI    UF   E           K DISK
      *********************************************************************
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      /copy syspeds/qrpgsrcpy,variables3
      *
OddEvD OddEven         s             10
      *
     D AntKLL          s              5  0
     D AntSND          s              5  0
     D AntKG           s              7  0
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
     D FEILTXT         s             80
     D ItemCount       s             10i 0
     D i               s             10i 0
     D                 DS
     D  Wkey2                  1     30
     D  SNDNR                  1     20
     D  WSSNEA                 1      3
     D  WSSN17                 4     20
     D                 DS
     D  DataDS                 1    220
     D  WDsANT                 1      4  0
     D  WDsVKT                 5     10  0
     D  WDsM3                 11     17  3
     D  WDsLM                 18     21  2
     D  WDsREF                22     36
     D  WDsMNavn              37     66
     D  WDsMAdr1              67     96
     D  WDsMPnSt              97    126
     D  WDsSndnr             127    146
     D  WDsSndnr17           130    146
     D                 DS
     D  WDsD≈MD                1      8
     D  WDsD≈                  1      4
     D  WDsDM                  5      6
     D  WDsDD                  7      8
     D                 DS
     D  TimeTmp                1     26
     D  TimeTmp≈               1      4
     D  TimeTmpM               6      7
     D  TimeTmpD               9     10
     D  TimeTmpT              12     16
     D  TimeTmpTT             12     13
     D  TimeTmpTM             15     16
     D  TimeTmpTS             18     18
     D                 DS
     D  Idag                   1      8
     D  IdagTmp≈               1      4
     D  IdagTmpM               5      6
     D  IdagTmpD               7      8
     D                 DS
     D  IdagTID                1      6
     D  IdagTT                 1      2
     D  IdagTM                 3      4
     D  IdagTTM                3      4
     D  IdagTS                 5      6
     D                 DS
     D  TID                    1     16
     D  Time1D                 1      2
     D  Time1P1                3      3
     D  Time1M                 4      5
     D  Time1P2                6      6
     D  Time1≈                 7     10
     D  Time1B                11     11
     D  Time1T                12     16
     D  Time1P3               14     14
     D                 DS
     D  TTTXTA                 1     70
     D  TXBY                   1     10
     D  XXSGM                 11     40
     D  TXWEBU                41     44
     D  XXWEBU                46     70
      *
     C     *entry        Plist
     c                   parm                    WSUSER           10
     c                   parm                    UsrSpcName       10
     c                   parm                    WSBESK           30
     c                   parm                    FIRMA            30
     c                   parm                    WSBIL            10
     c                   parm                    KNAVN            30
     c                   parm                    ADR1             30
     c                   parm                    POSTNR            4 0
     c                   parm                    ADR3             24
     c                   parm                    LISTENR          20
     C                   PARM                    WINTEG            6 0
oddevC     WSUSER        CHAIN     BRIDF                              50
OddEv * hent Parametre som gÂr igjen i mange prog:
OddEv *      Odd/Even/Rowhead-farger,Logobilde,SprÂk,Intern/Ekstern bruker,  mm
OddEvc                   call      'ESGETPAR'
OddEvc                   parm                    BIBRID
OddEvc                   parm                    BIFIRM
OddEvc                   parm                    BIKUNR
OddEvc                   parm                    BIKNG
OddEvc                   parm                    RowHead          10
OddEvc                   parm                    Odd              10
OddEvc                   parm                    Even             10
OddEvc                   parm                    LogoImg          50
OddEvc                   parm                    XSPR≈K            2
OddEvc                   parm                    XINTERN           1
OddEvc                   parm                    ParmDS1        1024
OddEvc                   parm                    ParmDS2        1024
OddEvc                   parm                    ParmDS3        1024
      *
      ****** MIDLERTIDIG ***
     C     LISTENR       IFEQ      *BLANKS
     C                   MOVEL     WINTEG        LISTENR
     C                   END
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Read output skeleton html member into memory
     C                   exsr      LoadHtml
      * Set section variables
     C                   exsr      Settop
     C                   callp     wrtsection('top')
      * Vis liste over registrete leveringer
     C                   Move      *zeros        AntSnd
     C                   Move      *zeros        AntKll
     C                   Move      *zeros        AntKg
     c     WINTEG        setLL     WRKCGI
     c     WINTEG        ReadE     WRKCGI                                 35
     c     *IN35         doweq     '0'
     C                   exsr      Setrow
     C                   callp     wrtsection('row')
     C                   Add       1             AntSnd
     C                   Add       WDsANT        AntKll
     C                   Add       WDsVKT        AntKg
     C                   delete    WRKCGIR
     c     WINTEG        ReadE     WRKCGI                                 35
     c                   end
     C                   callp     updHTMLvar('ANTSND':
     C                             %trim(%editc(ANTSND:'Z')))
     C                   callp     updHTMLvar('ANTKLL':
     C                             %trim(%editc(ANTKLL:'Z')))
     C                   callp     updHTMLvar('ANTKG':
     C                             %trim(%editc(ANTKG:'Z')))
      * Quit
      * Compute run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   callp     wrtsection('bot')
      *
     C                   exsr      Exit
      *
     C                   eval      *inlr = *on
     C                   return
      *
      *
      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      * Quit
     C                   return
     C                   endsr
      *=====================================================================
      * Read output skeleton html member into memory
      *=====================================================================
     C     LoadHtml      begsr
     C                   callp     gethtml('HTMLSRC':
     C                             '*LIBL':
     C                             'ESOP13':'/CGITAG/')
     C                   endsr
      *=====================================================================
      *  Set variable data for section /$top
      *=====================================================================
     C     SetTop        begsr
      *
OddEvC                   callp     updHTMLvar('ROWHEAD':RowHead)
OddEvC                   callp     updHTMLvar('LogoImg':LogoImg)
     C                   movel     timedata1     TimeTmp
     c                   movel     TimeTmp≈      Time1≈
     c                   movel     TimeTmpM      Time1M
     c                   movel     TimeTmpD      Time1D
     c                   movel     TimeTmpT      Time1T
     c                   move      '.'           Time1P1
     c                   move      '.'           Time1P2
     c                   move      ' '           Time1B
     c                   move      ':'           Time1P3
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updHTMLvar('USER':WSUSER)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHTMLvar('BESK':WSBESK)
     C     WSBIL         IFEQ      *BLANKS
     C                   callp     updHTMLvar('BIL':'....................')
     C                   ELSE
     C                   callp     updHTMLvar('BIL':WSBIL)
     C                   END
     C                   callp     updHTMLvar('TID':TID)
     C                   callp     updHTMLvar('FIRMA':FIRMA)
     C                   callp     updHTMLvar('LISTNR':LISTENR)
     C                   callp     updHTMLvar('ANAVN':KNAVN)
     C                   callp     updHTMLvar('AGATE':ADR1 )
     C                   movel     Postnr        Asted            29
     C                   movel     ADR3          Asted
     C                   callp     updHTMLvar('ASTED':ASTED)
      *
     C                   endsr
      *=====================================================================
      *  Set variable data for section /$row
      *=====================================================================
     C     Setrow        begsr
OddEvc     OddEven       IFEQ      ODD
OddEvc                   eval      OddEven = EVEN
OddEvc                   else
OddEvc                   eval      OddEven = ODD
OddEvc                   end
OddEvC                   callp     updHTMLvar('ODDEVEN':OddEven)
OddEv *
     c                   movel     WData         DataDS
     C                   callp     updHTMLvar('SNDNRL':WDsSndnr17)
     C                   callp     updHTMLvar('MNAVN':WDsMNavn)
     C                   callp     updHTMLvar('MGATE':WDsMAdr1)
     C                   callp     updHTMLvar('MSTED':WDsMPnSt)
     C                   callp     updHTMLvar('REFL':WDsREF)
     C                   callp     updHTMLvar('ANTL':
     C                             %trim(%editc(WDsANT:'Z')))
     C                   callp     updHTMLvar('VKTL':
     C                             %trim(%editc(WDsVKT:'Z')))
     C     WDsM3         MULT(H)   1000          DM3               7 0
     C                   callp     updHTMLvar('VOLL':
     C                             %trim(%editc(DM3:'Z')))
     C                   callp     updhtmlvar('LML':
     C                             %trim(%editc(WDsLm:'M')))
      *
     C                   endsr
