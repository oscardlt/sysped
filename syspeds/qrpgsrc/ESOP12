      *********************************************************************
      * ARBEID MED ORDRE
      * PROGRAM BEHANDLER INPUT FRA ESOP12
      *
CRTPG+*  CRTPGM SYSPED/ESOP12 MODULE(*LIBL/ESOP12
CRTPGM*        *LIBL/CHECKUSR *LIBL/INCGI) ACTGRP(CGI) AUT(*USE)
      *
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 Produktkoder kan være gitt i espedparm (HEPRO)
10XXX * 02 YBC PTF10 ANDRE ARBEIDSGIVER OG FAKTURAMOTTAKER
10XXX * 03 YBC PTF10 HENT LANDKODE FRA VADR
10XXX * 04 ??? PTF10 INGEN FORKLARING???? ENDRING BLE GJORT 18.08.2010
10015 * 05 YBC PTF10 OPPDATER T & T
10XXX * 06 YBC PTF10 KOPIERING AV OPPDRAG
10XXX * 07 YBC PTF10 TAKLE DATO MED MER ENN 8-SIFRE
10XXX * 08 YBC PTF10 HENT BANE FOR OPPLASTING FRA *KUNDFT*
10XXX * 09 YBC PTF10 BEVAR WSOT OG WSFR I HTML, OG OPPDATER LANSKODER
10172 * 10 SH  PTF10 norsk text til Track and trace
10172 * 11 JOV PTF10 FEIL PÅ PLUKK AV LK/UTANLANDSK POSTNR
10XXX * 12 YBC PTF10 TEST OGSÅ ADRESSE 2
10XXX * 13 jov PTF10 krav om mailadresse (avsender) ved henting innland
10XXX * 14 jov PTF10 tlf/sms under mailadresse ved henting, Oppdrgiver ved TR-MOD
10XXX * 15 YBC PTF10 LANDKODE SKAL SKILLES PÅ IMPORT OG EKSPORT
10XXX * 16 JOV JOV10 Ta med teksten fra type oppdrag som bestilles - overskrift
10XXX * 17 JOV JOV10 Andre ledetekster for mail/melding til sped ved henting
10XXX * 18 YBC PTF10 Sett XXNY='N' når nytt oppdrag er registrert
10314 * 19 YBC PTF10 Test status. KUN status='E' for endring
      * %%%%%%%%% V11 %%%%%%%%%%%%
10331 * 20 JOV PTF11 Kan angi at en gitt part skal betale når kundenr oppgitt (forskj. fra BRIDF)
12026 * 20YB   PTF11 YBC - korreksjon på ptf 20
10333 * 21 YBC PTF11 Leveringsdato og ekstra referanse
10333 * 22 JOV PTF11 BÅDE hente/lev.adresse åpne
10XXX * 13 JOV PTF10 FEIL i PTF 15  Trmodul - land imp/eksp var byttet
11XXX * 24 YBC PTF11 ENGELSK TEKST
********************************************************************
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
      * Boats for sale data base file (LF on BOATSALE by boat serial number)
     FBRIDF     UF   E           K DISK    USROPN
     FFIRM      IF   E           k disk    usropn
     Fzeadl05   UF A E           K DISK    USROPN
     Fzreetxt1  UF A E           K DISK    USROPN
     FZRISOL02  UF A E           K DISK    USROPN
N05  FZTRACKF   O  A E             DISK    USROPN
     FCUNDL01   IF   E           K DISK    USROPN
     Fkunko1    IF   E           k disk    usropn
     FKUNKO2    IF   E           k disk    usropn
     F                                     RENAME(KUNKOR:KUNKOR2)
     F                                     PREFIX(K2_)
     Fvadr      IF   E           k disk    usropn
     FSTED2     IF   E           K DISK    USROPN
     FSTED2D    IF   E           K DISK    USROPN
     F                                     RENAME(STED2R:STED2RD)
     FBRPARF    if   e           k disk    usropn
     FKODTOTY   if   e           k disk    usropn
     FKODTFR    if   e           k disk    usropn
     FZTELL     UF   E           K DISK    USROPN
     FKUFAST    IF   E           K DISK    USROPN
     FAVFRH     IF   E           K DISK    USROPN
      *--------------------------------------------------------------------
      * Prototype definitions and standard system API error structure
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      * Variables common to CGI programs
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
      * VARIABLES SPECIFIC TO THIS PROGRAM
      *--------------------------------------------------------------------
      * Variables received from the input string
     D SubmPressed     s              1
N06  D KOPIBUTTON      S             80
N06  D XKOPIOPD        S              1
     D lng             s              2
     D BckGnd          s             10
     D UsrSpcName      s             10
     D WSUSER          S             10
     D WSNA            S             30
     D XXENDRE         S              1
     D XXADR           S             17
     D XXADRS          S             17
     D XXADRK          S             17
     D XXNY            S              1
     D AVVIKSK         S              1
     D GMAVVIKSK       S              1
     D PRTFBR          S              1
     D PRTCMR          S              1
     D PRTLAB          S              1
     D XXPK1           S              1
     D XXPK2           S              1
     D XXPK3           S              1
     D WSREFF          S             17
     D GMREFF          S             17
     D WSUNIK          S              9  0
     D WSDTOP          S             10
N21  D WSSDTD          S             10
N21  D WSOREF          S             17
     D WSKNS           S              8
     D BSKNS           S              8  0
     D WSKNSVA         S              5
     D WSNAS           S             30
     D WSADS1          S             30
     D WSADS2          S             30
     D WSADS3          S             30
     D GMNAS           S             30
     D GMADS1          S             30
     D GMADS2          S             30
     D GMADS3          S             30
     D WSKNK           S              8
     D BSKNK           S              8  0
     D WSKNKVA         S              5
     D WSNAK           S             30
     D WSADK1          S             30
     D WSADK2          S             30
     D WSADK3          S             30
     D GMNAK           S             30
     D GMADK1          S             30
     D GMADK2          S             30
     D GMADK3          S             30
     D WSGN            S             15
     D WSLKF           S              2
     D WSSDF           S              5
     D WSLKT           S              2
     D WSSDT           S              5
     D WSOT            S              2
     D WSFR            S              3
     D WSPROD          S              1
     D WSNT            S              7
     D BSNT            S              7  0
     D WSVKT           S              9
     D BSVKT           S              9  0
     D WSM3            S              8
     D BSM3            S              7  3
     D BSM3BIG         S             15  3
     D WSLM            S              5
     D BSLM            S              4  2
     D BSLMBIG         S             15  2
     D WSVS1           S             25
     D WSVS2           S             25
     D WSGM1           S             15
     D WSGM2           S             15
     D WSMTxt          S           6300
     D WSTTxt          S           6300
     D WSSTxt          S           6300
S20  D*NavnAdr         S             60
N20  D NavnAdr         S             80
     D VelgOtFr        S              1
     D VelgLK          S              1
     D WSUPLOAD        S              1
     D AVVKNR          S              8
     D AVVKNRN         S              8  0
     D WSEP1           S             70
N14  D WSTLF1          S             15
N14  D WSSMS1          S             15
N14  D HENTLF          S            256
N17  D SPEDTXT         S             50
N17  D EMtxt1          S             50
N17  D EMtxt2          S             50
N20  D WSSELBET        S              1
N20  D WSKJOBET        S              1
N20  D SELGBET         S            200
N20  D KJOPBET         S            200
      *Array for fri-tekster
     D TX              S             70    DIM(90)
     D PGM             C                   CONST('SYSPED/CHECKUSR')
      * Variables used to load the external html source member
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
      *
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
     D FMELDNR         S              2
     D FEILMELDING     S             80

     D                 DS
     D  ADR                    1    127
     D  VADRNA                 1     30
     D  VADRN1                31     60
     D  VADRN2                61     90
     D  VADRN3                91    120
     D  VADKNR               121    127
     D                 DS
S07  D*BSDTOP                  1      8  0
S07  D*WSDTÅÅ                  1      4
S07  D*WSDTMM                  5      6
S07  D*WSDTDD                  7      8
S07  D*WSDT                    1      8
N07  D BSDTOP                  1     10  0
N07  D BSDTOP8                 3     10  0
N07  D WSDTÅÅ                  3      6
N07  D WSDTMM                  7      8
N07  D WSDTDD                  9     10
N07  D WSDT                    3     10
N21  D                 DS
N21  D BSSDTD                  1     10  0
N21  D BSSDTD8                 3     10  0
N21  D WSSDTDAA                3      6
N21  D WSSDTDMM                7      8
N21  D WSSDTDDD                9     10
     D                 DS
     D FSUNIK                  1      9  0
     D XFSUNIK                 1      9
     D                 DS
     D  WTIME                  1     14  0
     D  WTID                   1      6  0
     D  WDD                    7      8  0
     D  WMM                    9     10  0
     D  WÅÅ                   11     14  0
     D                 DS
N16  D*TYPE                    1      9
N16  D TYPE                    1     54
     D TYPAVD                  1      4
     D TYPMODUL                5      5
     D TYPMODUL2               6      6
     D TypMod12                5      6
     D TYPLand                 7      8
     D TYPSK                   9      9
N16  D TYPTEKST               10     54
      * DS for test HEURO/F, om bruker kan velge (mer enn 1) oppdt./franka.
     D                 DS
     D TstOtFrank              1     50
     D TstMod12                1      2
     D OTFRANK                 3     50
     D PrtDftFbr               3      3
     D PrtDftCmr               4      4
     D PrtDftLab               5      5
      * Oppdragstyper 16 elem. a 3 tegn (O1,O2,..) Oppdr.type er venstrest.
     D                 DS
     D  OtString               1     48
     D  OT                     1     48    DIM(16)
      * Frankaturer 12 elem. a 4 tegn (FR1,Fr2,..) Frankat. er venstrest.
     D                 DS
     D  FrString               1     48
     D  FR                     1     48    DIM(12)
      * Produktkoder  25 elem. a 2 tegn (' ,P,E,...) Prod kod er venstrest.
N01  D  PrString               1     50                                         Prod-kode
N01  D  PR                     1     50    DIM(25)
     D                 DS
     D  PAVRDA                 1     50
N16  D  PAVRDM1                1      1
N16  D  PAVRDM2                2      2
     D  PAVRDA1                1      2
     D  PAVRDA2                5      5
N22  D  PAVRDA50              50     50
      *
     D                 DS
     D  WSAVD                  1      7
     D  WSAVD1                 1      2
     D  WSAVD2                 3      3
     D  WSAVD3                 4      7
     D                 DS
     D  KVTXT                  1   6300
     D  KVT                    1   6300    DIM(6300)
     D                 DS
     D  TXT70                  1     70
     D  T70                    1     70    DIM(70)
      *
     D FEIL01          C                   CONST('Ordrenr. må oppgis.')
     D FEIL02          C                   CONST('Oppgitt ordrenr. finnes -
     D                                     allerede.')
     D FEIL02B         C                   CONST('Ordrenr er NØKKEL, kan  -
     D                                     ikke endres (du kan evt. slette/-
     D                                     lage ny). ')
     D FEIL03          C                   CONST('Oppgitt dato er ugyldig.-
     D                                      (format åååå.mm.dd)')
     D FEIL04          C                   CONST('Oppgitt avsendersnr finn-
     D                                     es ikke.')
     D FEIL05          C                   CONST('Avsendersnavn og adresse-
     D                                      må oppgis')
     D FEIL10          C                   CONST('Adresse 1 for avsender -
     D                                      må oppgis')
     D FEIL06          C                   CONST('Oppgitt mottakersnr finn-
     D                                     es ikke.')
     D FEIL07          C                   CONST('Mottakersnavn og adresse-
     D                                      må oppgis')
     D FEIL11          C                   CONST('Adresse 1 for mottaker -
     D                                      må oppgis')
     D FEIL08          C                   CONST('Oppgitt frasted er ugyld-
     D                                     ig.')
     D FEIL09          C                   CONST('Oppgitt tilsted er ugyld-
     D                                     ig.')
     D FEIL13          C                   CONST('Antall kolli må oppgis.')
     D FEIL14          C                   CONST('Vekt må oppgis.')
     D FEIL15          C                   CONST('Godsbeskrivelse må oppgi-
     D                                     s.')
     D FEIL16          C                   CONST('Total antall linjer av -
     D                                     meldinger kan ikke være flere -
     D                                     enn 90.')
     D FEIL17          C                   CONST('Oppgitt kundenr er ugyldig.')
     D FEIL18          C                   CONST('Kubikk kan ikke være større -
     D                                     enn 9999,999.')
     D FEIL19          C                   CONST('Lastmeter kan ikke være -
     D                                     større enn 99,99.')
N13  D FEIL20          C                   CONST('Mailadresse(avsender) må -
N13  D                                     angis ved henting/direkte.')
N13  D FEIL21          C                   CONST('Mailadresse må inneholde @.')
N16  D FEIL22          C                   CONST('Tilsted må være en terminal.')
N20  D FEIL23          C                   CONST('Kun en fraktbetaler kan -
N20  D                                     angis')
N21  D FEIL24          C                   CONST('Leveringsdato er ugyldig.-
N21  D                                      (format åååå.mm.dd)')
      *
     D FEIL01EN        C                   CONST('Order No. has to given.')
     D FEIL02EN        C                   CONST('Order No. is registred -
     D                                     before.')
     D FEIL02BEN       C                   CONST('Order No. is a KEY, can  -
     D                                     not be changed (you can delete this -
     D                                     order/create a new one). ')
     D FEIL03EN        C                   CONST('Date is not valid.-
     D                                      (format CCYY.MM.DD)')
     D FEIL04EN        C                   CONST('Shipper No. is not valid-
     D                                     .')
     D FEIL05EN        C                   CONST('Shippers name and address-
     D                                      has to be given.')
     D FEIL10EN        C                   CONST('Address 1 of shipper can -
     D                                      not be blank.')
     D FEIL06EN        C                   CONST('Consignee No. is not -
     D                                     valid.')
     D FEIL07EN        C                   CONST('Consignees name and address-
     D                                      has to be given.')
     D FEIL11EN        C                   CONST('Address 1 of consignee can-
     D                                      not be blank.')
     D FEIL08EN        C                   CONST('From place is not valid.')
     D FEIL09EN        C                   CONST('To place is not valid.')
     D FEIL13EN        C                   CONST('Colli can not be 0.')
     D FEIL14EN        C                   CONST('Weight can not be 0.')
     D FEIL15EN        C                   CONST('Goods description can not -
     D                                     be blank.')
     D FEIL16EN        C                   CONST('Max number of lines of -
     D                                     messages can"t be more then 90.')
     D FEIL17EN        C                   CONST('Given custom no. is not -
     D                                     valid.')
     D FEIL18EN        C                   CONST('Cubic can not be more then -
     D                                     9999,999.')
     D FEIL19EN        C                   CONST('Loadingmeter can not be more -
     D                                     then 99,99.')
N13  D FEIL20EN        C                   CONST('Mail address(shipper) is -
N13  D                                     required on collect orders.')
N13  D FEIL21EN        C                   CONST('Mail address must contain @.')
N16  D FEIL22EN        C                   CONST('Destination must be a -
n16  D                                     terminal.')
N20  D FEIL23EN        C                   CONST('Only one freightpayer can -
N20  D                                     be filled in.')
N21  D FEIL24EN        C                   CONST('Deliveringsdate is not valid.-
N21  D                                      (format CCYY.MM.DD)')
      * For xlate mellom Upper Case og Lower Case
     D UC              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZÆØÅ')
     D LC              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzæøå')
     D                 DS
      * FOR KORT STRENG, 120->200  INGEN MERKING.
     D  updf1                  1    400
     D  updf2                401    800
     D  updf3                801   1200
     D  updf4               1201   1600
     D  updf5               1601   2000
     D  updf6               2001   2400
     D  updf7               2401   2800
     D  updf8               2801   3200
     D  updf9               3201   3600
     D  updf10              3601   4000
     D  updf11              4001   4400
     D  updf12              4401   4800
     D  updf13              4801   5200
     D  updf14              5201   5600
     D  updf15              5601   6000
     D  updf16              6001   6400
     D  updf17              6401   6800
     D  updf18              6801   7200
     D  updf19              7201   7600
     D  updf20              7601   8000
     D  updf21              8001   8400
     D  updf22              8401   8800
     D  updf23              8801   9200
     D  updf24              9201   9600
     D  updf25              9601  10000
     D  updf26             10001  10400
     D  updf27             10401  10800
     D  updf28             10801  11200
     D  updf29             11201  11600
     D  updf30             11601  12000
     D  updf31             12001  12400
     D  updf32             12401  12800
     D  updf33             12801  13200
     D  updf34             13201  13600
     D  updf35             13601  14000
     D  updf36             14001  14400
     D  updf37             14401  14800
     D  updf38             14801  15200
     D  updf39             15201  15600
     D  updf40             15601  16000
     D  updf                   1  16000    DIM(40)
      *
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================
      * MAIN PROCESSING LINE
      *=====================================================================
      * Parse input string
     C                   exsr      Parse
      *
     C                   EXSR      INIT
      *
      * Hvis første kall OG en...
     c     SubmPressed   IFNE      'Y'
     C     XXENDRE       ANDEQ     ' '
     c     wsreff        IFNE      *blanks
      *      kommer inn med nøkkel - hent data fra fil, klar for vedlikehold
     c                   exsr      GetData
     C                   MOVE      'N'           XXNY
     c                   else
      *      kommer inn uten nøkkel - Blankt bilde, klar for ny post
     c                   exsr      GetDft
     C                   MOVE      'Y'           XXNY
     c                   end
     c                   end
     C                   IF        XXENDRE <> ' '
     C                   EXSR      GETOTFR
     C                   END
      *
      * Avslutt = V - "passiv vis bilde på ny" etter åpning/lukking felt..
     c     AVSLUTT       IFEQ      'V'
     c                   move      ' '           AVSLUTT
     C                   else
      *Om en har tastet submit fra vedlikeholdsbilde, test evt lagre/avslutt
      * (Test-sr setter AVSLUTT=Y hvis feilfritt -> automatisk close...)
     c     SubmPressed   IFEQ      'Y'
     C     XXENDRE       OREQ      'S'
     C     XXENDRE       OREQ      'K'
     C                   EXSR      TESTB
     c                   end
     C                   end
      *
     C     AVSLUTT       IFEQ      'Y'
     C     AVSLUTT       OREQ      'J'
     C                   EXSR      OPDORDRE
     C                   End
N06   *
N06  C                   IF        ((FEILMELDING=*BLANKS) AND (XKOPIOPD='J'))
N06  C                   MOVE      *BLANKS       WSREFF
N06  C                   MOVE      *BLANKS       GMREFF
N06  C                   MOVE      *BLANKS       HEREFF
N06  C                   MOVE      *ZEROS        WSUNIK
N06  C                   MOVE      *ZEROS        HEUNIK
N06  C                   MOVE      'Y'           XXNY
N06  C                   MOVE      *BLANKS       AVSLUTT
N06  C                   END
      *
      * Vis skjermbidet på ny
      * (hvis AVSLUTT=Y så autocloses vinduet umiddelbart ved load..)
      * Set output skeleton html member name
     C                   exsr      SetSkl
      * Read skeleton output html into core
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
      * Issue html section /$top
     C                   exsr      SetTop
     C                   callp     wrtsection('top')
     C                   IF        VelgOtFr = 'J'
     C                   callp     wrtsection('VisInv1')
     C                   END
     C                   callp     wrtsection('VisInv2')
      * protect den siden av oppdraget som er oppdragsgiver(web-kunde.)
     C     AvvikSK       Ifne      'Y'
     C     TYPSK         Ifeq      'K'
      * Oppdrag der webkunde er KJØPER - protect mottakerside
     C                   callp     wrtsection('motprotect')
     C                   callp     wrtsection('avsinput1')
     C
      * vis pulldown for vareadr på avsender/Selgerside
     c                   move      'S'           VadrSK            1
     C                   IF        XADRLIST = 'J'
     c                   exsr      DSPADR
     C                   ELSE
     C                   exsr      DSPADR2
     C                   END
     C                   callp     wrtsection('avsinput2')
     C                   else
      * alt annet enn K regnes som S=Selger/avsenderside - protect denne
     C                   callp     wrtsection('avsprotect')
     C                   callp     wrtsection('motinput1')
      * vis pulldown for vareadr på mottaker/kjøperside
     c                   move      'K'           VadrSK            1
     C                   IF        XADRLIST = 'J'
     c                   exsr      DSPADR
     C                   ELSE
     C                   exsr      DSPADR2
     C                   END
     C                   callp     wrtsection('motinput2')
     C                   end
     C                   else
      * avvikende... Begge sider åpne...
     C                   callp     wrtsection('avsinput1')
      * vis pulldown for vareadr på avsender/Selgerside
     c                   move      'S'           VadrSK            1
     C                   IF        XADRLIST = 'J'
     c                   exsr      DSPADR
     C                   ELSE
     C                   exsr      DSPADR2
     C                   END
     C                   callp     wrtsection('avsinput2')
     C                   callp     wrtsection('motinput1')
      * vis pulldown for vareadr på mottaker/kjøperside
     c                   move      'K'           VadrSK            1
     C                   IF        XADRLIST = 'J'
     c                   exsr      DSPADR
     C                   ELSE
     C                   exsr      DSPADR2
     C                   END
     C                   callp     wrtsection('motinput2')
     C                   end
      * Vis del 2 av skjermbildet (med tiden ulikt pr modul....
     C                   callp     wrtsection('del2Trans')
     C                   IF        ((TYPMODUL <> 'C') AND (TYPMODUL <> 'D'))
     C                   callp     wrtsection('del2LKF1')
     C                   ELSE
     C                   callp     wrtsection('del2LKF2')
     C                   END
     C                   callp     wrtsection('del2LKF3')
     C                   IF        ((TYPMODUL <> 'C') AND (TYPMODUL <> 'D'))
     C                   callp     wrtsection('del2LKT1')
     C                   ELSE
     C                   callp     wrtsection('del2LKT2')
     C                   END
     C                   callp     wrtsection('del2LKT3')
     C     VelgOtFr      ifeq      'J'
     c                   exsr      DSPOtFr
     C                   ELSE
S09  C*                  callp     updhtmlvar('WSOT':'')
S09  C*                  callp     updhtmlvar('WSFR':'')
N09  C                   callp     updhtmlvar('WSOT':WSOT)
N09  C                   callp     updhtmlvar('WSFR':WSFR)
S16  C*                  callp     wrtsection('OTFRNOSELECT')
     C                   end
      *
     C                   IF        XVISFAKT = 'J'
     C                   EXSR      DSPPROD
     C                   ELSE
     C                   callp     updhtmlvar('WSPROD':'')
     C                   callp     wrtsection('PRODNOSELECT')
     C                   END
     C                   callp     wrtsection('OTFRPRBot')
      *
      * Vis bokser for merking til kunde / transportør      ...
     C                   callp     wrtsection('merking')
      *
      * Vis opplastet dokumenter
     C                   IF        XOPPLAST = 'J'
     C                   EXSR      HENTDOK
     C                   callp     wrtsection('Dokument')
     C                   END
     C                   callp     wrtsection('BUNN')
N19  C                   IF        HEST = 'E' or XXNY = 'Y'
N19  C                   callp     wrtsection('BUNN2')
N19  C                   END
     C                   IF        XVISFAKT = 'J'
     C                   callp     wrtsection('VisInv3')
     C                   END
     C                   callp     wrtsection('VisInv4')

      *
     C                   exsr      SetEnd
     C                   callp     wrtsection('end')
      *
      * Send output buffer and quit
     C     SLUTT         TAG
     C                   exsr      Exit
      *
      *
      *
      *=====================================================================
      * Parse input string
      *=====================================================================
     C     Parse         begsr
     C                   eval      SubmPressed = zhbgetvar('SubmPressed')
N06  C                   eval      XKOPIOPD = zhbgetvar('XKOPIOPD')
     C                   eval      lng     = zhbgetvar('lng')
     C                   eval      BckGnd  = zhbgetvar('bckgnd')

     C                   eval      WSUSER  = zhbgetvar('USER')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   EVAL      XXENDRE = zhbgetvar('XENDRE')
     C                   EVAL      XXADR   = zhbgetvar('XXADR')
     C                   EVAL      XXADRS  = zhbgetvar('ADRS')
     C     LC:UC         XLATE     XXADRS        XXADRS
     C                   EVAL      XXADRK  = zhbgetvar('ADRK')
     C     LC:UC         XLATE     XXADRK        XXADRK
     C                   eval      WSNA    = zhbgetvar('WSNA')
     C                   eval      XXNY    = zhbgetvar('XXNY')
     C                   eval      TYPE    = zhbgetvar('TYPE')
     C                   eval      AvvikSK = zhbgetvar('AVVIKSK')
     C                   eval      GMAvvikSK = zhbgetvar('GMAVVIKSK')
N14  c*    TYPAVD        ifeq      '9998'
N14  c*    AvvikSK       ifeq      ' '
N14  C*                  eval      AvvikSK = 'Y'
N14  c*                  endif
N14  c*                  endif
      *
     C                   eval      WSREFF  = zhbgetvar('WSREFF')
     C     LC:UC         XLATE     WSREFF        WSREFF
     C                   eval      GMREFF  = zhbgetvar('GMREFF')
     C     LC:UC         XLATE     GMREFF        GMREFF
     C                   eval      WSDTOP  = zhbgetvar('WSDTOP')
     C                   eval      BSDTOP  = c2n2(WSDTOP)
N21  C                   eval      WSSDTD  = zhbgetvar('WSSDTD')
N21  C                   eval      BSSDTD  = c2n2(WSSDTD)
N21  C                   eval      WSOREF  = zhbgetvar('WSOREF')
N21  C     LC:UC         XLATE     WSOREF        WSOREF
      *
     C                   eval      WSKNS   = zhbgetvar('WSKNS')
     C                   eval      BSKNS   = c2n2(WSKNS)
     C                   eval      WSKNSVA = zhbgetvar('WSKNSVA')
     C                   eval      WSNAS   = zhbgetvar('WSNAS')
     C     LC:UC         XLATE     WSNAS         WSNAS
     C                   eval      WSADS1  = zhbgetvar('WSADS1')
     C     LC:UC         XLATE     WSADS1        WSADS1
     C                   eval      WSADS2  = zhbgetvar('WSADS2')
     C     LC:UC         XLATE     WSADS2        WSADS2
     C                   eval      WSADS3  = zhbgetvar('WSADS3')
     C     LC:UC         XLATE     WSADS3        WSADS3
     C                   eval      GMNAS   = zhbgetvar('GMNAS')
     C                   eval      GMADS1  = zhbgetvar('GMADS1')
     C                   eval      GMADS2  = zhbgetvar('GMADS2')
     C                   eval      GMADS3  = zhbgetvar('GMADS3')
     C                   IF        ((XXENDRE = 'S') AND (GMNAS = *BLANKS))
     C                   EVAL      GMNAS   = WSNAS
     C                   EVAL      GMADS1  = WSADS1
     C                   EVAL      GMADS2  = WSADS2
     C                   EVAL      GMADS3  = WSADS3
     C                   END
      *
     C                   eval      WSKNK   = zhbgetvar('WSKNK')
     C                   eval      BSKNK   = c2n2(WSKNK)
     C                   eval      WSKNKVA = zhbgetvar('WSKNKVA')
     C                   eval      WSNAK   = zhbgetvar('WSNAK')
     C     LC:UC         XLATE     WSNAK         WSNAK
     C                   eval      WSADK1  = zhbgetvar('WSADK1')
     C     LC:UC         XLATE     WSADK1        WSADK1
     C                   eval      WSADK2  = zhbgetvar('WSADK2')
     C     LC:UC         XLATE     WSADK2        WSADK2
     C                   eval      WSADK3  = zhbgetvar('WSADK3')
     C     LC:UC         XLATE     WSADK3        WSADK3
     C                   eval      GMNAK   = zhbgetvar('GMNAK')
     C                   eval      GMADK1  = zhbgetvar('GMADK1')
     C                   eval      GMADK2  = zhbgetvar('GMADK2')
     C                   eval      GMADK3  = zhbgetvar('GMADK3')
     C                   IF        ((XXENDRE = 'K') AND (GMNAK = *BLANKS))
     C                   EVAL      GMNAK   = WSNAK
     C                   EVAL      GMADK1  = WSADK1
     C                   EVAL      GMADK2  = WSADK2
     C                   EVAL      GMADK3  = WSADK3
     C                   END
N20  C                   eval      WSSELBET= zhbgetvar('WSSELBET')
N20  C                   eval      WSKJOBET= zhbgetvar('WSKJOBET')
      *
     C                   eval      WSGN    = zhbgetvar('WSGN')
     C                   eval      WSGN    = uppify(WSGN)
     C                   eval      WSLKF   = zhbgetvar('WSLKF')
     C                   eval      WSLKF   = uppify(WSLKF)
     C                   eval      WSSDF   = zhbgetvar('WSSDF')
     C                   eval      WSSDF   = uppify(WSSDF)
     C                   eval      WSLKT   = zhbgetvar('WSLKT')
     C                   eval      WSLKT   = uppify(WSLKT)
     C                   eval      WSSDT   = zhbgetvar('WSSDT')
     C                   eval      WSSDT   = uppify(WSSDT)
     C                   eval      WSOT    = zhbgetvar('WSOT')
     C                   eval      WSOT    = uppify(WSOT)
     C                   eval      WSFR    = zhbgetvar('WSFR')
     C                   eval      WSFR    = uppify(WSFR)
     C                   eval      WSPROD  = zhbgetvar('WSPROD')
     C                   eval      VelgOtFr= zhbgetvar('VelgOtFr')
     C                   eval      OtString= zhbgetvar('OtString')
     C                   eval      FrString= zhbgetvar('FrString')
      *
     C                   eval      WSNT    = zhbgetvar('WSNT')
     C                   eval      BSNT    = c2n2(WSNT)
     C                   eval      WSVKT   = zhbgetvar('WSVKT')
     C                   eval      BSVKT   = c2n2(WSVKT)
     C                   eval      WSM3    = zhbgetvar('WSM3')
     C                   eval      BSM3BIG = c2n2(WSM3)
     C                   IF        BSM3BIG <= 9999,999
     C                   EVAL      BSM3    = BSM3BIG
     C                   END
     C                   eval      WSLM    = zhbgetvar('WSLM')
     C                   eval      BSLMBIG = c2n2(WSLM)
     C                   IF        BSLMBIG <= 99,99
     C                   EVAL      BSLM    = BSLMBIG
     C                   END
      *
     C                   eval      WSVS1   = zhbgetvar('WSVS1')
     C     LC:UC         XLATE     WSVS1         WSVS1
     C                   eval      WSVS2   = zhbgetvar('WSVS2')
     C     LC:UC         XLATE     WSVS2         WSVS2
     C                   eval      WSGM1   = zhbgetvar('WSGM1')
     C     LC:UC         XLATE     WSGM1         WSGM1
     C                   eval      WSGM2   = zhbgetvar('WSGM2')
     C     LC:UC         XLATE     WSGM2         WSGM2
     C                   eval      WSMtxt  = zhbgetvar('mTxta')
     C     LC:UC         XLATE     WSMtxt        WSMtxt
     C                   eval      WSTtxt  = zhbgetvar('tTxta')
     C     LC:UC         XLATE     WSTtxt        WSTtxt
     C                   eval      WSStxt  = zhbgetvar('sTxta')
     C     LC:UC         XLATE     WSStxt        WSStxt
     C                   eval      PRTFBR  = zhbgetvar('PRTFBR')
     C                   eval      PRTCMR  = zhbgetvar('PRTCMR')
     C                   eval      PRTLAB  = zhbgetvar('PRTLAB')
     C                   eval      XXPK1   = zhbgetvar('XXPK1')
     C                   eval      XXPK2   = zhbgetvar('XXPK2')
     C                   eval      XXPK3   = zhbgetvar('XXPK3')
     C                   eval      WSUPLOAD= zhbgetvar('WSUPLOAD')
     C                   eval      AVVKNR  = zhbgetvar('AVVKNR')
     C                   eval      AVVKNRN = c2n2(AVVKNR)
     C                   eval      WSEP1   = zhbgetvar('WSEP1')
N14  C                   eval      WSTLF1  = zhbgetvar('WSTLF1')
N14  C                   eval      WSSMS1  = zhbgetvar('WSSMS1')

     C                   endsr
      *=====================================================================
      * Set html output skeleton VED FEIL
      *=====================================================================
     C     SetSkl        begsr
     C                   eval      lng = uppify(lng)
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC' + lng
     C                   eval      Mbr = 'ESOP12'
     C                   CAT       XSPRÅK:0      MBR
     C                   endsr
      *=====================================================================
      * Set html output variables for section /$top
      *=====================================================================
     C     SetTop        begsr
N16  c     TYPAVD        ifeq      '9998'
N16  c     TYPAVD        oreq      '9997'
N16  c     AvvikSK       ifeq      ' '
N16  C                   eval      AvvikSK = 'Y'
N16  c                   endif
N16  c                   endif
      * Repeat national language for the next invocation
     C                   callp     updhtmlvar('LNG':lng:
     C                             InitHTMLVars)
      * Repeat background color for the next invocation
     C                   callp     updhtmlvar('TXTCOLOR':'black')
     C                   callp     updhtmlvar('BOLD':' ')
     C                   callp     updhtmlvar('BGCOLOR':BIFARG)
     C                   callp     updhtmlvar('LINK':'0000FF')
     C                   callp     updhtmlvar('VLINK':'FF0000')
     C                   callp     updhtmlvar('ALINK':'00FF00')
      * KUNDE
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updhtmlvar('LOGOIMG':LogoImg)
     C                   callp     updHtmlVar('USER':WSUSER)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHtmlVar('WSNA':WSNA)
     C                   callp     updHtmlVar('KUNDE':
     C                             %trim(%editc(BIKUNR:'Z')))
     C                   callp     updhtmlvar('AVVKNR':
     C                             %trim(%editc(AVVKNRN:'Z')))
     C                   callp     updHTMLvar('sdato':
     C                             %trim(%editw(BIDTV:'    .  .  ')))
     C                   callp     updHTMLvar('stid':
     C                             %trim(%editw(BITIDV:'  .  .  ')))
      *
      * ved ny visning av en checkbox er det ikke value som settes men..
     C     AVVIKSK       IFEQ      'Y'
     C                   callp     updHtmlVar('AVVCHECKED':'Checked')
     c                   else
     C                   callp     updHtmlVar('AVVCHECKED':'')
     c                   end
     C                   callp     updHtmlVar('XXNY':XXNY)
     C                   callp     updHtmlVar('TYPE':TYPE)
N16  C                   callp     updHtmlVar('TYPTEKST':TYPTEKST)
      * evt vilkår for om OtY/frank skal vises er hentet opp ved 1. syklus
     C                   callp     updHtmlVar('VelgOtFr':VelgOtFr)
     C                   IF        ((TYPMODUL <> 'C') AND (TYPMODUL <> 'D'))
     C                   MOVE      'J'           VELGLK
     C                   ELSE
     C                   MOVE      'N'           VELGLK
     C                   END
     C                   callp     updHtmlVar('VelgLK':VelgLK)
     C                   callp     updHtmlVar('OtString':OtString)
     C                   callp     updHtmlVar('FrString':FrString)
      *
      *
     C                   callp     updHtmlVar('WSREFF':WSREFF)
     C                   callp     updHtmlVar('GMREFF':GMREFF)
     C                   callp     updHtmlVar('GMAVVIKSK':AVVIKSK)
     C                   callp     updhtmlvar('HEUNIK':
     C                             %trim(%editc(WSUNIK:'Z')))
N07  C                   IF        BSDTOP > 99999999
N07  C                   callp     updHtmlVar('WSDTOP':WSDTOP)
N07  C                   ELSE
     C                   callp     updHTMLvar('WSDTOP':
N07  C                             %trim(%editw(BSDTOP8:'    .  .  ')))
N07  C                   END
S07  C*                            %trim(%editw(BSDTOP:'    .  .  ')))
N21  C                   IF        BSSDTD > 99999999
N21  C                   callp     updHtmlVar('WSSDTD':WSSDTD)
N21  C                   ELSE
N21  C                   callp     updHTMLvar('WSSDTD':
N21  C                             %trim(%editw(BSSDTD8:'    .  .  ')))
N21  C                   END
N21  C                   callp     updHtmlVar('WSOREF':WSOREF)
     C                   callp     updhtmlvar('WSKNS':
     C                             %trim(%editc(BSKNS:'Z')))
N20  c                   eval      SELGBET = '<input type="hidden" '
N20  c                             +'name="WSSELBET">'
N20  c                   if        BSKNS <> *zeros and  BSKNS <> XKNFAKTM
N20  c                   if        WSSELBET='Y'
N20  c                   movel     'Checked'     ChkTxt            7
N20  c                   else
N20  c                   move      *blanks       ChkTxt
N20  c                   endif
N20  c                   eval      SELGBET = '<b>Betaler.? </b>'
N20  c                             +'<input type="checkbox" name="WSSELBET" '
N20  c                             +'value="Y" ' + ChkTxt + '/>&nbsp;&nbsp;'
N20  c                   endif
N20  C                   callp     updHtmlVar('SELGBET':SELGBET)
     C                   callp     updHtmlVar('WSKNSVA':WSKNSVA)
     C                   callp     updHtmlVar('WSNAS':WSNAS)
     C                   callp     updHtmlVar('ADRS':'')
     C                   callp     updHtmlVar('WSADS1':WSADS1)
     C                   callp     updHtmlVar('WSADS2':WSADS2)
     C                   callp     updHtmlVar('WSADS3':WSADS3)
     C                   callp     updHtmlVar('GMNAS':GMNAS)
     C                   callp     updHtmlVar('GMADS1':GMADS1)
     C                   callp     updHtmlVar('GMADS2':GMADS2)
     C                   callp     updHtmlVar('GMADS3':GMADS3)
     C                   callp     updhtmlvar('WSKNK':
     C                             %trim(%editc(BSKNK:'Z')))
N20  c                   eval      KJOPBET = '<input type="hidden" '
N20  c                             +'name="WSKJOBET">'
N20  c                   if        BSKNK <> *zeros and  BSKNK <> XKNFAKTM
N20  c                   if        WSKJOBET='Y'
N20  c                   movel     'Checked'     ChkTxt            7
N20  c                   else
N20  c                   move      *blanks       ChkTxt
N20  c                   endif
N20  c                   eval      KJOPBET = '<b>Betaler.? </b>'
N20  c                             +'<input type="checkbox" name="WSKJOBET" '
N20  c                             +'value="Y" ' + ChkTxt + '/>&nbsp;&nbsp;'
N20  c                   endif
N20  C                   callp     updHtmlVar('KJOPBET':KJOPBET)
     C                   callp     updHtmlVar('WSKNKVA':WSKNKVA)
     C                   callp     updHtmlVar('WSNAK':WSNAK)
     C                   callp     updHtmlVar('ADRK':'')
     C                   callp     updHtmlVar('WSADK1':WSADK1)
     C                   callp     updHtmlVar('WSADK2':WSADK2)
     C                   callp     updHtmlVar('WSADK3':WSADK3)
     C                   callp     updHtmlVar('GMNAK':GMNAK)
     C                   callp     updHtmlVar('GMADK1':GMADK1)
     C                   callp     updHtmlVar('GMADK2':GMADK2)
     C                   callp     updHtmlVar('GMADK3':GMADK3)
     C                   callp     updHtmlVar('WSLKF':WSLKF)
     C                   callp     updHtmlVar('WSSDF':WSSDF)
     C                   callp     updHtmlVar('WSLKT':WSLKT)
     C                   callp     updHtmlVar('WSSDT':WSSDT)
      *
     C                   callp     updhtmlvar('WSNT':
     C                             %trim(%editc(BSNT:'Z')))
     C                   callp     updhtmlvar('WSVKT':
     C                             %trim(%editc(BSVKT:'Z')))
     C                   callp     updhtmlvar('WSM3':
     C                             %trim(%editc(BSM3BIG:'M')))
     C                   callp     updhtmlvar('WSLM':
     C                             %trim(%editc(BSLMBIG:'M')))
     C                   callp     updhtmlvar('WSVS1':WSVS1)
     C                   callp     updhtmlvar('WSVS2':WSVS2)
     C                   callp     updhtmlvar('WSGM1':WSGM1)
     C                   callp     updhtmlvar('WSGM2':WSGM2)
     C                   callp     updhtmlvar('WSMtxt':WSMtxt)
     C                   callp     updhtmlvar('WSTtxt':WSTtxt)
     C                   callp     updhtmlvar('WSStxt':WSStxt)
     C                   callp     updhtmlvar('WSEP1':WSEP1)
N17  c                   eval      SPEDTXT='Melding til avsender'
N17  c                   eval      EMtxt1 ='E-mail adresse:'
N17  c                   eval      EMtxt2 ='(ekstra booking bekreftelse)'
N17  c     XSPRÅK        ifeq      'EN'
S24  c*                  eval      SPEDTXT='Melding til avsender'
N24  C                   eval      SPEDTXT='Message to shipper'
N17  c                   eval      EMtxt1 ='E-mail address:'
N17  c                   eval      EMtxt2 ='(extra booking confirmation)'
N17  c                   endif
N14  c                   move      *blanks       HENTLF
N14  c     TYPAVD        ifeq      '9998'
N14  c     TYPAVD        oreq      '9997'
N17  c                   eval      EMtxt1 ='E-mail avsender:'
N17  c                   eval      EMtxt2 ='(obligatorisk)'
N17  c     XSPRÅK        ifeq      'EN'
N17  c                   eval      EMtxt1 ='E-mail sender:'
N17  c                   eval      EMtxt2 ='(mandatory)'
N17  c                   endif
N14  c                   eval      HENTLF ='<tr><td>Tfl.avsender:</td>'
N14  c                             +'<td><input type="text" name="WSTLF1" '
N14  c                             +'value="'+%trim(WSTLF1)+'" size="15" '
N14  c                             +'maxlength="15"> &nbsp;&nbsp;&nbsp;&nbsp;'
N14  c                             +'SMS avsender:'
N14  c                             +'<input type="text" name="WSSMS1" '
N14  c                             +'value="'+%trim(WSSMS1)+'" size="15" '
N14  c                             +'maxlength="15"> </td></tr>'
N14  c                   endif
N17  C                   callp     updhtmlvar('SPEDtxt':SPEDtxt)
N17  C                   callp     updhtmlvar('EMtxt1':EMtxt1)
N17  C                   callp     updhtmlvar('EMtxt2':EMtxt2)
N14  C                   callp     updhtmlvar('HENTLF':HENTLF)
     C                   callp     updhtmlvar('FEILMELDING':
     C                             FEILMELDING)
     C                   callp     updhtmlvar('FMELDNR':FMELDNR)
     C                   callp     updhtmlvar('AVSLUTT':AVSLUTT)
     C     PRTFBR        IFEQ      'Y'
     C                   callp     updHtmlVar('PRTFBRCHECKED':'Checked')
     c                   else
     C                   callp     updHtmlVar('PRTFBRCHECKED':'')
     c                   end
     C     PRTCMR        IFEQ      'Y'
     C                   callp     updHtmlVar('PRTCMRCHECKED':'Checked')
     c                   else
     C                   callp     updHtmlVar('PRTCMRCHECKED':'')
     c                   end
     C     PRTLAB        IFEQ      'Y'
     C                   callp     updHtmlVar('PRTLABCHECKED':'Checked')
     c                   else
     C                   callp     updHtmlVar('PRTLABCHECKED':'')
     c                   end
     C                   callp     updhtmlvar('XXPK1':XXPK1)
     C                   callp     updhtmlvar('XXPK2':XXPK2)
     C                   callp     updhtmlvar('XXPK3':XXPK3)
      *
     C     WSUPLOAD      IFEQ      'Y'
     C                   callp     updHtmlVar('UPLOADCHECKED':'Checked')
     C                   else
     C                   callp     updHtmlVar('UPLOADCHECKED':'')
     C                   end
      *
     C                   MOVE      *BLANKS       WSAVD
     C                   EVAL      PAID = 'HEUR'
     C     BrParKey      setll     BRPARF
     C     BrParKey      reade     BRPARF                                 33
     C                   DOW       *IN33 = *OFF
     C                   IF        HEAVD = PAVRDN
     C                   MOVEL     PAVRDA1       WSAVD1
     C                   MOVEL     PAVRDA2       WSAVD2
     C                   MOVE      HEAVD         WSAVD3
     C                   LEAVE
     C                   END
     C     BrParKey      reade     BRPARF                                 33
     C                   ENDDO
     C                   callp     updhtmlvar('WSAVD':WSAVD)
N06   *
N06  c                   IF        XXNY <> 'J'
N06  C                   IF        XSPRÅK = 'EN'
N06  c                   eval      KOPIButton = '<INPUT TYPE="button" '
N06  c                             + 'NAME="CopyButton" Value="   Copy   " '
N06  c                             + 'OnClick=CpyOrd()>'
N06  C                   ELSE
N06  c                   eval      KOPIButton = '<INPUT TYPE="button" '
N06  c                             + 'NAME="CopyButton" Value="   Kopi   " '
N06  c                             + 'OnClick=CpyOrd()>'
N06  c                   END
N06  c                   ELSE
N06  c                   EVAL      KOPIBUTTON = *BLANKS
N06  c                   END
N06  C                   callp     updhtmlvar('XKOPIOPD':XKOPIOPD)
N06  C                   callp     updhtmlvar('KOPIBUTTON':KOPIBUTTON)
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$end
      *=====================================================================******
     C     SetEnd        begsr
      * Compute run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   endsr
      *
      *////////////////////////////////////////////////////////////
     C     TESTB         BEGSR
      *////////////////////////////////////////////////////////////
      * TEST ORDRENR
      *
     C     WSREFF        IFEQ      *BLANKS
     C                   EXSR      TSTAVS
     C                   EXSR      TSTMOT
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL01EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL01        FEILMELDING
     C                   END
     C                   MOVE      '01'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     C     XXNY          IFEQ      'Y'
      * Ved NY Kan ikke finnes fra før
     C     Zead5Key      CHAIN     ZEADL05                            33
     C     *IN33         IFEQ      '0'
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL02EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL02        FEILMELDING
     C                   END
     C                   MOVE      '01'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     C                   ELSE
      * Ved endring - Ref kan ikke endres
     C     WSREFF        IFNE      GMREFF
     C     GMREFF        ANDNE     *BLANKS
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL02BEN     FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL02B       FEILMELDING
     C                   END
     C                   MOVE      '01'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     C                   END
      * TEST DATO
N07  C                   IF        BSDTOP > 99999999
N07  C                   EVAL      UFLAGG = 1
N07  C                   ELSE
     C                   MOVE      WSDTDD        UDD               2 0
     C                   MOVE      WSDTMM        UMM               2 0
     C                   MOVE      WSDTÅÅ        UÅÅ               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
N07  C                   END
     C     UFLAGG        IFEQ      1
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL03EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL03        FEILMELDING
     C                   END
     C                   MOVE      '03'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
N21   * TEST DATO
N21  C                   SELECT
N21  C                   WHEN      BSSDTD > 99999999
N21  C                   EVAL      UFLAGG = 1
N21  C                   WHEN      BSSDTD <> 0
N21  C                   MOVE      WSSDTDDD      UDD               2 0
N21  C                   MOVE      WSSDTDMM      UMM               2 0
N21  C                   MOVE      WSSDTDAA      UÅÅ               2 0
N21  C                   CALL      'TESTDATO'
N21  C                   PARM                    UDD
N21  C                   PARM                    UMM
N21  C                   PARM                    UÅÅ
N21  C                   PARM                    UFLAGG            1 0
N21  C                   ENDSL
N21  C     UFLAGG        IFEQ      1
N21  C                   IF        XSPRÅK = 'EN'
N21  C                   MOVEL     FEIL24EN      FEILMELDING
N21  C                   ELSE
N21  C                   MOVEL     FEIL24        FEILMELDING
N21  C                   END
N21  C                   MOVE      '24'          FMELDNR
N21  C                   GOTO      SLTBDT
N21  C                   ENDIF
      * TEST AVSENDER
     C                   EXSR      TSTAVS
     C     FMELDNR       CABNE     '  '          SLTBDT
     C     WSNAS         IFEQ      *BLANKS
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL05EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL05        FEILMELDING
     C                   END
     C                   MOVE      '05'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     C     WSADS1        IFEQ      *BLANKS
N12  C     WSADS2        ANDEQ     *BLANKS
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL10EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL10        FEILMELDING
     C                   END
     C                   MOVE      '10'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
      * TEST MOTTAKER
     C                   EXSR      TSTMOT
     C     FMELDNR       CABNE     '  '          SLTBDT
     C     WSNAK         IFEQ      *BLANKS
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL07EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL07        FEILMELDING
     C                   END
     C                   MOVE      '07'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
     C     WSADK1        IFEQ      *BLANKS
N12  C     WSADK2        ANDEQ     *BLANKS
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL11EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL11        FEILMELDING
     C                   END
     C                   MOVE      '11'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
N20
N20   * kan ikke overstyrer betaler både på selger/kjøpresiden samtidig
N20  c     WSSelBet      Ifeq      'Y'
N20  c     WSKjoBet      andeq     'Y'
N20  C                   IF        XSPRÅK = 'EN'
N20  C                   MOVEL     FEIL23EN      FEILMELDING
N20  C                   ELSE
N20  C                   MOVEL     FEIL23        FEILMELDING
N20  C                   END
N20  C                   MOVE      '23'          FMELDNR
N20  C                   GOTO      SLTBDT
N20  c                   endif
      *
      * TEST FRA/TILSTED
      * Fra
     C     WSSDF         IFEQ      *blanks
     C     TYPMODUL      andeq     'H'
     C                   movel     WSADS3        WSSDF
     C                   END
     C                   IF        ((TYPMODUL <> 'C') AND (TYPMODUL <> 'D'))
     C     StedFraKey    CHAIN     STED2D                             33
     C                   ELSE
     C     WSSDF         CHAIN     STED2                              33
     C  N33              MOVE      ST2LK         WSLKF
     C                   END
     C     *IN33         IFEQ      '1'
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL08EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL08        FEILMELDING
     C                   END
     C                   MOVE      '08'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
      * Siste adresselinje avsender
     C     WSADS3        Ifeq      *blanks
     c     WSSDF         cat       ST2NVN:1      WSADS3
     C                   end
      * Til
     C     WSSDT         IFEQ      *blanks
     C     TYPMODUL      andeq     'H'
     C                   movel     WSADK3        WSSDT
     C                   END
     C                   IF        ((TYPMODUL <> 'C') AND (TYPMODUL <> 'D'))
     C     StedTilKey    CHAIN     STED2D                             33
     C                   ELSE
     C     WSSDT         CHAIN     STED2                              33
     C  N33              MOVE      ST2LK         WSLKT
     C                   END
     C     *IN33         IFEQ      '1'
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL09EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL09        FEILMELDING
     C                   END
     C                   MOVE      '09'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
N16   * til - må være terminalpostnr
N16  c     TYPAVD        ifeq      '9997'                                       Inngående til Term.
N16  C     WSSDT         IFNE      '1000'
N16  C                   IF        XSPRÅK = 'EN'
N16  C                   MOVEL     FEIL22EN      FEILMELDING
N16  C                   ELSE
N16  C                   MOVEL     FEIL22        FEILMELDING
N16  C                   END
N16  C                   MOVE      '09'          FMELDNR
N16  C                   GOTO      SLTBDT
N16  C                   ENDIF
N16  C                   ENDIF
      * Siste adresselinje mottaker
     C     WSADK3        Ifeq      *blanks
     c     WSSDT         cat       ST2NVN:1      WSADK3
     C                   end
      *
      * TEST KOLLI
     C     BSNT          IFEQ      0
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL13EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL13        FEILMELDING
     C                   END
     C                   MOVE      '13'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
      *
      * TEST VEKT
     C     BSVKT         IFEQ      0
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL14EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL14        FEILMELDING
     C                   END
     C                   MOVE      '14'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
      * TEST M3
     C                   IF        BSM3BIG > 9999,999
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL18EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL18        FEILMELDING
     C                   END
     C                   MOVE      '18'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
      * TEST LM
     C                   IF        BSLMBIG > 99,99
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL19EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL19        FEILMELDING
     C                   END
     C                   MOVE      '19'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
      *
      * TEST VAREBESKRIVELSE
     C     WSVS1         IFEQ      *BLANKS
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL15EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL15        FEILMELDING
     C                   END
     C                   MOVE      '15'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
      *
      * MAX 90 LINJER AV ALLE MELDINGER
     C                   EXSR      SRTESTL
     C                   IF        XANTL > 90
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL16EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL16        FEILMELDING
     C                   END
     C                   MOVE      '16'          FMELDNR
     C                   GOTO      SLTBDT
     C                   END
      *
N13   * dersom type er Innland Henting så er det krav om mailadresse (avsender/ merking)
N13  c     TYPAVD        ifeq      '9998'
N16  c     TYPAVD        oreq      '9997'
N13  c*    WSEP1         andeq     *blanks
N16  c     WSEP1         ifeq      *blanks
N13  C                   IF        XSPRÅK = 'EN'
N13  C                   MOVEL     FEIL20EN      FEILMELDING
N13  C                   ELSE
N13  C                   MOVEL     FEIL20        FEILMELDING
N13  C                   END
N13  C                   MOVE      '20'          FMELDNR
N13  C                   GOTO      SLTBDT
N16  c                   endif
N13  c                   endif
      * mailadresse MÅ inneholde @
N13  c     WSEP1         ifne      *blanks
N13  c     '@'           scan      WSEP1                                  33
N13  c     *in33         ifne      *on
N13  C                   IF        XSPRÅK = 'EN'
N13  C                   MOVEL     FEIL21EN      FEILMELDING
N13  C                   ELSE
N13  C                   MOVEL     FEIL21        FEILMELDING
N13  C                   END
N13  C                   MOVE      '21'          FMELDNR
N13  C                   GOTO      SLTBDT
N13  c                   endif
N13  c                   endif
      *
      * alle tester passert - Avlsutt med lagring / close windu..
     C     AvvikSK       Ifne      'Y'
     C     GMAvvikSK     OREQ      'Y'
     C                   move      'Y'           AVSLUTT
     C                   END
      *
     C     SLTBDT        ENDSR
      *
      *=====================================================================
      *  TEST ANTALL MELDINGSLINJER
      *=====================================================================
     C     SRTESTL       begsr
      *
     C                   Z-ADD     0             XANTL             3 0
     C                   EVAL      KVTXT = WSMTXT
     C                   EXSR      SRTESTL2
      *
     C                   EVAL      KVTXT = WSTTXT
     C                   EXSR      SRTESTL2
      *
     C                   EVAL      KVTXT = WSSTXT
     C                   EXSR      SRTESTL2
      *
     C                   ENDSR
      *
      *=====================================================================
      *  TEST ANTALL MELDINGSLINJER
      *=====================================================================
     C     SRTESTL2      begsr
      *
     C                   EVAL      TXT70 = *BLANKS
     C                   Z-ADD     0             XN2
     C     1             DO        6300          XN
     C                   ADD       1             XN2
     C                   SELECT
     C                   WHEN      XN2 = 70
     C                   IF        KVT(XN) = XSTEGN1
     C                   EVAL      XN3 = XN + 1
     C                   IF        KVT(XN3) = XSTEGN2
     C                   EVAL      XN = XN3
     C                   ELSE
     C                   MOVE      KVT(XN)       T70(XN2)
     C                   END
     C                   ELSE
     C                   MOVE      KVT(XN)       T70(XN2)
     C                   END
     C                   IF        TXT70 <> *BLANKS
     C                   ADD       1             XANTL
     C                   END
     C                   Z-ADD     0             XN2
     C                   EVAL      TXT70 = *BLANKS
     C                   WHEN      KVT(XN) = XSTEGN1
     C                   EVAL      XN3 = XN + 1
     C                   IF        KVT(XN3) = XSTEGN2
     C                   EVAL      XN = XN3
     C                   IF        TXT70 <> *BLANKS
     C                   ADD       1             XANTL
     C                   END
     C                   Z-ADD     0             XN2
     C                   EVAL      TXT70 = *BLANKS
     C                   ELSE
     C                   MOVE      KVT(XN)       T70(XN2)
     C                   END
     C                   OTHER
     C                   MOVE      KVT(XN)       T70(XN2)
     C                   ENDSL
     C                   ENDDO
      *
     C                   ENDSR
      *
      *=====================================================================
      *  Oppdater heading
      *=====================================================================
     C     OPDORDRE      begsr
      *
     C     XXNY          IFEQ      'N'
     C     Zead5Key      CHAIN     ZEADL05                            33
     C     *in33         CABEQ     '1'           UtOppd
      * NY
N15  C                   ELSE
N15  C                   MOVE      TYPMODUL      HEUR
N15  C                   MOVE      TYPMODUL2     HE01
     c                   end
      *
     C                   EXSR      MOVEWSH
      * Ny post
     C     XXNY          IFEQ      'Y'
     C                   MOVE      TYPMODUL      HEUR
     C                   MOVE      TYPMODUL2     HE01
     C                   eval      HEAVD   = c2n2(TYPAVD)
     c     Heur          IFEQ      'H'
N02  c                   IF        BIKUNR = XKNGIVER
     c     typsk         IFEQ      'K'
     c                   move      'K'           TRKDFF
n04  c                   move      'X'           HEKDFS
n04  c                   move      *zeros        HEKNSF
     c                   else
     c                   move      'S'           TRKDFF
n04  c                   move      'X'           HEKDFK
n04  c                   move      *zeros        HEKNKF
     c                   end
N02  C                   ELSE
N02  C                   MOVE      ' '           TRKDFF
N02  C                   END
     c                   end
N20  c                   exsr      AvvFbet
     C                   MOVE      'E'           HEST
     C     BIFIRM        chain     ZTELL                              33
     C     *in33         CABEQ     '1'           UtOppd
     C                   Z-ADD     zunik         HEUNIK
     c                   add       1             zunik
     c                   update    ztellr
     C                   WRITE     HEADFR
N18  C                   EVAL      XXNY = 'N'
N05  C                   EXSR      OPDLOG
     C                   ELSE
      *endring
N20  c                   exsr      AvvFbet
     C                   UPDATE    HEADFR
     C                   ENDIF
     C                   Z-ADD     HEUNIK        WSUNIK
      *
      * Oppdater Fritekst.
     c                   move      HEREFF        FRREFF
     c                   move      HEUNIK        FRUNIK
     C     ZREEKey       SETLL     Zreetxt1
     C     ZREEKey       Reade     Zreetxt1                               33
     C     *in33         doweq     '0'
     c                   delete    freetxtr
     C     ZREEKey       Reade     Zreetxt1                               33
     c                   end
     c                   move      *zeros        FRTLI
     c                   move      HEDTOP        FRTDT
      * Melding til mottaker....
     c     WSMtxt        Ifne      *blanks
     c                   move      'R'           FRTKOD
     C                   EVAL      KVTXT = WSMTXT
     C                   Z-ADD     70            XLINL             3 0
     C                   EXSR      KVTLIN
     c                   exsr      SkrivFrt
     c                   end
      * Melding til Transportør.
     c     WSTtxt        Ifne      *blanks
     c                   move      'G'           FRTKOD
     C                   EVAL      KVTXT = WSTTXT
     C                   Z-ADD     70            XLINL             3 0
     C                   EXSR      KVTLIN
     c                   exsr      SkrivFrt
     c                   end
      * Melding til SPEDITØR
     C     WSStxt        Ifne      *blanks
     C                   move      ' '           FRTKOD
     C                   EVAL      KVTXT = WSSTXT
     C                   Z-ADD     70            XLINL             3 0
     C                   EXSR      KVTLIN
     C                   exsr      SkrivFrt
     C                   end
      * Epost adresse
     C     WSEP1         Ifne      *blanks
     C                   move      'M'           FRTKOD
     c                   add       1             FRTLI
     c                   movel     WSEP1         FRTTXT
     c                   write     freetxtr
     C                   end
N14   * tlf/sms ved henting
N14  C     WSTLF1        Ifne      *blanks
N14  C     WSSMS1        orne      *blanks
N14  C                   move      'T'           FRTKOD
N14  c                   add       1             FRTLI
N14  c                   move      *blanks       FRTTXT
N14  c                   movel     WSTLF1        FRTTXT
N14  c                   move      WSSMS1        FRTTXT
N14  c                   write     freetxtr
N14  C                   end
      *
      * Oppdater ordreref.
     C                   MOVEL     'ORD'         FSKODE
     C     ZRISOL02K     SETLL     ZRISOL02
     C     ZRISOL02K     READE     ZRISOL02                               33
     C                   DOW       *IN33 = *OFF
     C                   DELETE    FRISOKR
     C     ZRISOL02K     READE     ZRISOL02                               33
     C                   ENDDO
      *
     C                   MOVE      HEAVD         FSAVD
     C                   MOVE      HEOPD         FSOPD
     C                   EVAL      FSSOK = HEREFF
     C                   MOVE      HEDTOP        FSDTOP
     C                   MOVE      HEREFF        FSREFF
     C                   MOVE      HEUNIK        FSUNIK
     C                   WRITE     FRISOKR
N21   *
N21  C                   MOVEL     'ORF'         FSKODE
N21  C     ZRISOL02K     CHAIN     ZRISOL02                           33
N21  C                   SELECT
N21  C                   WHEN      *IN33 AND WSOREF <> *BLANKS
N21  C                   EVAL      FSSOK = WSOREF
N21  C                   WRITE     FRISOKR
N21  C                   WHEN      *IN33 = *OFF AND WSOREF = *BLANKS
N21  C                   DELETE    FRISOKR
N21  C                   WHEN      *IN33 = *OFF AND WSOREF <> *BLANKS
N21  C                   EVAL      FSSOK = WSOREF
N21  C                   UPDATE    FRISOKR
N21  C                   ENDSL
N21   *
     C                   MOVEL     '#VD'         FSKODE
      *
      * TEST OPPLASTING
     C                   IF        ((XOPPLAST = 'J') AND (WSUPLOAD = 'Y'))
     C                   MOVE      'J'           AVSLUTT
     C                   END
      *
     C     UtOppd        endsr
N20   *********************************************
N20  C     AvvFbet       begsr
N20   *********************************************
N20   * Selger betaler
N20  c     WSSELBET      IFEQ      'Y'
N20  c                   move      'S'           TRKDFF
N20  c                   move      'X'           HEKDFK
N20YBc                   move      ' '           HEKDFS
N20  c                   move      *zeros        HEKNKF
N20  c                   move      HEKNS         HEKNSF
N20  c                   end
N20   * Kjøper betaler
N20  c     WSKJOBET      IFEQ      'Y'
N20  c                   move      'K'           TRKDFF
N20  c                   move      'X'           HEKDFS
N20YBc                   move      ' '           HEKDFK
N20  c                   move      *zeros        HEKNSF
N20  c                   move      HEKNK         HEKNKF
N20  c                   endif
N20  c                   ENDSR
      *
      *=====================================================================
      *  Skriv fritekst til fil
      *=====================================================================
     C     SKRIVFRT      begsr
     C     1             Do        90            NR                2 0
     c     TX(NR)        Ifne      *blanks
     c                   add       1             FRTLI
     c                   move      TX(NR)        FRTTXT
     c                   write     freetxtr
     c                   end
     c                   end
      *
     C                   endsr
      *
      *=====================================================================
      *  OPPDATER FELTER I FIL
      *=====================================================================
     C     MOVEWSH       begsr
     C                   MOVE      WSREFF        HEREFF
     C                   MOVE      BSDTOP        HEDTOP
N21  C                   MOVE      BSSDTD        TRSDTD
     C                   MOVE      BIBRID        HEFILE
S02  C*                  MOVE      BIKUNR        TRKNFA
N02  C                   MOVE      XKNGIVER      TRKNFA
N14  C     TYPMODUL      ifeq      'H'
N14  C     OpdgiKey      Chain     Cundl01                            33
N14  C  N33              MOVEL     KNAVN         HENAA
N14  C                   endif
     C                   MOVE      BSKNS         HEKNS
     C     KODTFRK       CHAIN     KODTFR                             33
     C                   SELECT
     C                   WHEN      KFRCP = 'CC'
     C                   MOVE      'X'           HEKDFS
     C                   MOVE      ' '           HEKDFK
     C                   WHEN      KFRCP = 'PP'
     C                   MOVE      ' '           HEKDFS
     C                   MOVE      'X'           HEKDFK
     C                   OTHER
     C                   MOVE      ' '           HEKDFS
     C                   MOVE      ' '           HEKDFK
     C                   ENDSL
     C                   IF        (XXNY = 'Y')
S02  C*                  MOVE      BIKUNR        HEKNSF
N02  C                   MOVE      XKNFAKTM      HEKNSF
     C                   END
     C                   MOVE      WSNAS         HENAS
     C                   MOVE      WSADS1        HEADS1
     C                   MOVE      WSADS2        HEADS2
     C                   MOVE      WSADS3        HEADS3
     C                   MOVE      BSKNK         HEKNK
     C                   IF        (XXNY = 'Y')
S02  C*                  MOVE      BIKUNR        HEKNKF
N02  C                   MOVE      XKNFAKTM      HEKNKF
     C                   END
     C                   MOVE      WSNAK         HENAK
     C                   MOVE      WSADK1        HEADK1
     C                   MOVE      WSADK2        HEADK2
     C                   MOVE      WSADK3        HEADK3
     C                   MOVE      WSGN          HEGN
     C                   MOVEL     WSREFF        HERFA
S15  C*                  MOVE      WSLKF         HELKA
     C                   MOVE      WSSDF         HESDF
S15  C*                  MOVE      WSLKT         HETRI
N15  C                   SELECT
N15  C                   WHEN      HEUR = 'A' OR HEUR = 'C' OR HEUR = 'F'
N15  C                   EVAL      HELKA  = WSLKF
N15  C                   EVAL      HETRI  = WSLKT
N15  C                   WHEN      HEUR = 'B' OR HEUR = 'D' OR HEUR = 'G'
N15  C                   EVAL      HELKA  = WSLKT
N15  C                   EVAL      HETRI  = WSLKF
N15  C                   OTHER
N15  C                   SELECT
N15  C                   WHEN      HE01 = 'D'
N15  C                   EVAL      HELKA  = WSLKF
N15  C                   EVAL      HETRI  = WSLKT
N15  C                   WHEN      HE01 = 'I'
N15  C                   EVAL      HELKA  = WSLKF
N15  C                   EVAL      HETRI  = WSLKT
N15  C                   OTHER
s23  C*                  EVAL      HELKA  = WSLKT
S23  C*                  EVAL      HETRI  = WSLKF
N23  C                   EVAL      HELKA  = WSLKF
N23  C                   EVAL      HETRI  = WSLKT
N15  C                   ENDSL
N15  C                   ENDSL
     C                   MOVE      WSSDT         HESDT
     C                   MOVE      WSOT          HEOT
     C                   MOVE      WSFR          HEFR
     C                   MOVE      WSPROD        HEKDPL
     C                   MOVE      BSNT          HENT
     C                   MOVE      BSVKT         HEVKT
     C                   MOVE      BSM3          HEM3
     C                   MOVE      BSLM          HELM
     C                   MOVE      WSVS1         HEVS1
     C                   MOVE      WSVS2         HEVS2
     C                   MOVE      WSGM1         HEGM1
     C                   MOVE      WSGM2         HEGM2
     C                   MOVE      PRTFBR        HEPK1
     C     XXPK1         IFEQ      'P'
     C                   MOVE      XXPK1         HEPK1
     C                   END
     C                   MOVE      PRTCMR        HEPK2
     C     XXPK2         IFEQ      'P'
     C                   MOVE      XXPK2         HEPK2
     C                   END
     C                   MOVE      PRTLAB        HEPK3
     C     XXPK3         IFEQ      'P'
     C                   MOVE      XXPK3         HEPK3
     C                   END
     C     HEUR          IFEQ      'H'
     C                   move      'HO'          trslag
     C                   move      hedtop        trsdfd
N21  C                   IF        TRSDTD = 0
     C                   move      hedtop        trsdtd
N21  C                   END
     C                   end
      *
     C                   endsr
      *=====================================================================
      *  Hent data fra fra fil ved først "syklus"  / endring av post
      *=====================================================================
     C     GetData       begsr
     C     Zead5Key      CHAIN     ZEADL05                            33
     C     *IN33         CABEQ     '1'           UtGetData
      *
N16   * ENDRING - HENT TYPE-PARAMETER FRA PARAM-FIL
N16  C*    TYPE          IFEQ      *BLANKS
N16  C                   EVAL      PAID = 'HEUR'
N16  C     BrParKey      setll     BRPARF
N16  C     BrParKey      reade     BRPARF                                 33
N16  C                   DOW       *IN33 = *OFF
N16  C                   IF        HEAVD=PAVRDN AND
N16  C                             HEUR=PAVRDM1 AND HE01=PAVRDM2
N16  C                   MOVEL     HEAVD         TYPE
N16  C                   MOVE      PAVRDA        TYPE
N16  C                   LEAVE
N16  C                   END
N16  C     BrParKey      reade     BRPARF                                 33
N16  C                   ENDDO
N16  C*                  ENDIF
      *
     C                   MOVE      HEREFF        WSREFF
     C                   MOVE      HEREFF        GMREFF
     C                   MOVE      HEUNIK        WSUNIK
S07  C*                  MOVE      HEDTOP        BSDTOP
N07  C                   EVAL      BSDTOP = HEDTOP
N21  C                   EVAL      BSSDTD = TRSDTD
N21  C                   MOVEL     'ORF'         FSKODE
N21  C     ZRISOL02K     CHAIN(N)  ZRISOL02                           33
N21  C  N33              EVAL      WSOREF = FSSOK
N21  C                   MOVEL     '#VD'         FSKODE
     C                   MOVE      HEKNS         BSKNS
     C                   MOVE      HENAS         WSNAS
     C                   MOVE      HEADS1        WSADS1
     C                   MOVE      HEADS2        WSADS2
     C                   MOVE      HEADS3        WSADS3
     C                   MOVE      HEKNK         BSKNK
     C                   MOVE      HENAK         WSNAK
     C                   MOVE      HEADK1        WSADK1
     C                   MOVE      HEADK2        WSADK2
     C                   MOVE      HEADK3        WSADK3
N20  c                   if        HEKNSF<>0 and HEKNSF<>XKNFAKTM
N20  c                   eval      WSSELBET = 'Y'
N20  c                   endif
N20  c                   if        HEKNKF<>0 and HEKNKF<>XKNFAKTM
N20  c                   eval      WSKJOBET = 'Y'
N20  c                   endif
     C                   MOVE      HEGN          WSGN
S15  C*                  MOVE      HELKA         WSLKF
     C                   MOVE      HESDF         WSSDF
S15  C*                  MOVE      HETRI         WSLKT
N15  C                   SELECT
N15  C                   WHEN      HEUR = 'A' OR HEUR = 'C' OR HEUR = 'F'
N15  C                   EVAL      WSLKF  = HELKA
N15  C                   EVAL      WSLKT  = HETRI
N15  C                   WHEN      HEUR = 'B' OR HEUR = 'D' OR HEUR = 'G'
N15  C                   EVAL      WSLKT  = HELKA
N15  C                   EVAL      WSLKF  = HETRI
N15  C                   OTHER
N15  C                   SELECT
N15  C                   WHEN      HE01 = 'D'
N15  C                   EVAL      WSLKF  = HELKA
N15  C                   EVAL      WSLKT  = HETRI
N15  C                   WHEN      HE01 = 'I'
N15  C                   EVAL      WSLKF  = HELKA
N15  C                   EVAL      WSLKT  = HETRI
N15  C                   OTHER
s23  C*                  EVAL      WSLKT  = HELKA
s23  C*                  EVAL      WSLKF  = HETRI
n23  C                   EVAL      WSLKF  = HELKA
n23  C                   EVAL      WSLKT  = HETRI
N15  C                   ENDSL
N15  C                   ENDSL
     C                   MOVE      HESDT         WSSDT
     C                   MOVE      HEOT          WSOT
     C                   MOVE      HEFR          WSFR
     C                   IF        WSPROD = *BLANKS
     C                   MOVE      HEKDPL        WSPROD
     C                   END
     C                   MOVE      HENT          BSNT
     C                   MOVE      HEVKT         BSVKT
     C                   MOVE      HEM3          BSM3
     C                   Z-ADD     HEM3          BSM3BIG
     C                   MOVE      HELM          BSLM
     C                   Z-ADD     HELM          BSLMBIG
     C                   MOVE      HEVS1         WSVS1
     C                   MOVE      HEVS2         WSVS2
     C                   MOVE      HEGM1         WSGM1
     C                   MOVE      HEGM2         WSGM2
      * Låner prt-kode 1-2-3 til fbr/cmr/label
      *  CHECKBOX ticked hvis "Y" el. "P",  Hjelpefelt vises KUN hvis P.
     C     HEPK1         IFEQ      'P'
     C                   MOVE      'Y'           PRTFBR
     C                   MOVE      HEPK1         XXPK1
     C                   ELSE
     C                   MOVE      HEPK1         PRTFBR
     C                   MOVE      ' '           XXPK1
     C                   END
     C     HEPK2         IFEQ      'P'
     C                   MOVE      'Y'           PRTCMR
     C                   MOVE      HEPK2         XXPK2
     C                   ELSE
     C                   MOVE      HEPK2         PRTCMR
     C                   MOVE      ' '           XXPK2
     C                   END
     C     HEPK3         IFEQ      'P'
     C                   MOVE      'Y'           PRTLAB
     C                   MOVE      HEPK3         XXPK3
     C                   ELSE
     C                   MOVE      HEPK3         PRTLAB
     C                   MOVE      ' '           XXPK3
     C                   END
      * Ved endring protect part som er lik eget kundenr..
     c                   MOVE      HEUR          TYPMODUL
     C                   MOVE      HEAVD         TYPAVD
     C                   select
     C     HE01          WHENEQ    'E'
     C                   Move      'S'           TYPSK
     C     HE01          WHENEQ    'I'
     C                   Move      'K'           TYPSK
     C     BIKUNR        WHENEQ    HEKNS
     C                   Move      'S'           TYPSK
     C     BIKUNR        WHENEQ    HEKNK
     C                   Move      'K'           TYPSK
     C                   OTHER
     C                   Move      'Y'           AVVIKSK
     c                   endsl
     c                   MOVE      HE01          TYPMODUL2
      *
      * lov å velge oppdr.type/franka. via pulldown?
     c                   exsr      GetOtFr
      *
      * Hent Fritekst.
     c                   move      HEREFF        FRREFF
     c                   move      HEUNIK        FRUNIK
     C                   MOVE      *BLANKS       TX
     C                   MOVE      *ZEROS        NR
     C                   MOVE      'J'           X1LIN             1
      * HENT MELDING TIL AVSENDER
     C     ZREEKey       SETLL     Zreetxt1
     C     ZREEKey       Reade(N)  Zreetxt1                               33
     C     *in33         doweq     '0'
     c     frtkod        IFEQ      'R'
     C                   IF        X1LIN = 'J'
     C                   EVAL      X1LIN = 'N'
     C                   ELSE
     C                   CAT       XSTEGN1:0     WSMTXT
     C                   CAT       XSTEGN2:0     WSMTXT
     C                   END
     C                   CAT       FRTTXT:0      WSMTXT
     c                   end
     C     ZREEKey       Reade(N)  Zreetxt1                               33
     c                   end
      * HENT MELDING TIL TRANSPORTØR
     C                   MOVE      *BLANKS       TX
     C                   MOVE      *ZEROS        NR
     C                   MOVE      'J'           X1LIN             1
     C     ZREEKey       SETLL     Zreetxt1
     C     ZREEKey       Reade(N)  Zreetxt1                               33
     C                   DOW       *IN33 = *OFF
     C     FRTKOD        IFEQ      'G'
     C                   IF        X1LIN = 'J'
     C                   EVAL      X1LIN = 'N'
     C                   ELSE
     C                   CAT       XSTEGN1:0     WSTTXT
     C                   CAT       XSTEGN2:0     WSTTXT
     C                   END
     C                   CAT       FRTTXT:0      WSTTXT
     C                   END
     C     ZREEKey       Reade(N)  Zreetxt1                               33
     C                   END
      * HENT MELDING TIL SPEDITØR
     C                   MOVE      *BLANKS       TX
     C                   MOVE      *ZEROS        NR
     C                   MOVE      'J'           X1LIN             1
     C     ZREEKey       SETLL     Zreetxt1
     C     ZREEKey       Reade(N)  Zreetxt1                               33
     C                   DOW       *IN33 = *OFF
     C     FRTKOD        IFEQ      ' '
     C                   IF        X1LIN = 'J'
     C                   EVAL      X1LIN = 'N'
     C                   ELSE
     C                   CAT       XSTEGN1:0     WSSTXT
     C                   CAT       XSTEGN2:0     WSSTXT
     C                   END
     C                   CAT       FRTTXT:0      WSSTXT
     C                   END
     C     ZREEKey       Reade(N)  Zreetxt1                               33
     C                   END
      * HENT epost adresse
     C                   MOVE      *BLANKS       TX
     C                   MOVE      *ZEROS        NR
     C                   MOVE      'J'           X1LIN             1
     C     ZREEKey       SETLL     Zreetxt1
     C     ZREEKey       Reade(N)  Zreetxt1                               33
     C                   DOW       *IN33 = *OFF
     C     FRTKOD        IFEQ      'M'
     C                   EVAL      WSEP1=FRTTXT
     C                   END
N14  C     FRTKOD        IFEQ      'T'
N14  C                   movel     FRTTXT        WSTLF1
N14  C                   move      FRTTXT        WSSMS1
N14  C                   END
     C     ZREEKey       Reade(N)  Zreetxt1                               33
     C                   END
      *
     C     UtgetData     endsr
      *
      *=====================================================================
      *  Hent data fra fra param.fil mm ved første "syklus"  / Ny post
      *=====================================================================
     C     GetDft        begsr
     C                   MOVE      *blanks       GMREFF
      * Foreslå dagens dato
     C                   TIME                    WTIME
     C                   MOVE      WÅÅ           WSDTÅÅ
     C                   MOVE      WMM           WSDTMM
     C                   MOVE      WDD           WSDTDD
N21   *
N21  C                   MOVE      *ZEROS        WSSDTD
      * Oppdr.giver er K-Kjøper
     C     TYPSK         IFEQ      'K'
     C     BSKNK         IFEQ      *ZEROS
     c                   move      BIKUNR        WSKNK
     c                   move      BIKUNR        BSKNK
     C                   EXSR      TSTMOT
     C     TYPMODUL      IFEQ      'H'
     C                   movel     WSADK3        WSSDT
     c     TYPAVD        ifeq      '9997'                                       Inngående til Term.
     C                   movel     '1000 '       WSSDT                          bør param-settes
     c                   endif
     C                   END
     C                   END
     C                   Else
      *alt annet en K oppfattes som S=Selger/avsender
N22  c                   IF        %subst(TYPE:54:1)='B'
N22  C                   eval      AvvikSK = 'Y'
N22  c                   else
     C     BSKNS         IFEQ      *ZEROS
     c                   move      BIKUNR        WSKNS
     c                   move      BIKUNR        BSKNS
     C                   EXSR      TSTAVS
     C     TYPMODUL      IFEQ      'H'
     C                   movel     WSADS3        WSSDF
     C                   END
     C                   END
N22  c                   endif
     C                   END
      * ULIK INITIERIG FOR ULIKE MODULER...
     C                   SELECT
     C     TYPMODUL      WHENEQ    'H'
      * sett landkode etter domestic - hvor
     C                   SELECT
     C     TYPMODUL2     WHENEQ    'D'
     C                   MOVEL     FILAND        WSLKF
     C                   MOVEL     FILAND        WSLKT
     C     TYPMODUL2     WHENEQ    'I'
     C                   MOVEL     TYPLand       WSLKF
     C                   MOVEL     FILAND        WSLKT
     C                   OTHER
     C                   MOVEL     FILAND        WSLKF
     C                   MOVEL     TYPLand       WSLKT
     C                   ENDSL
     C     TYPMODUL      WHENEQ    'A'
N09  C                   MOVEL     TYPLand       WSLKF
N09  C                   MOVEL     FILAND        WSLKT
     C* ...
     C     TYPMODUL      WHENEQ    'B'
N09  C                   MOVEL     FILAND        WSLKF
N09  C                   MOVEL     TYPLand       WSLKT
     C* ...
     C     TYPMODUL      WHENEQ    'C'
N09  C                   MOVEL     TYPLand       WSLKF
N09  C                   MOVEL     FILAND        WSLKT
     C* ...
     C     TYPMODUL      WHENEQ    'D'
N09  C                   MOVEL     FILAND        WSLKF
N09  C                   MOVEL     TYPLand       WSLKT
     C* ...
     C     TYPMODUL      WHENEQ    'E'
N09  C                   MOVEL     FILAND        WSLKF
N09  C                   MOVEL     FILAND        WSLKT
     C* ...
     C     TYPMODUL      WHENEQ    'F'
N09  C                   MOVEL     TYPLand       WSLKF
N09  C                   MOVEL     FILAND        WSLKT
     C* ...
     C     TYPMODUL      WHENEQ    'G'
N09  C                   MOVEL     FILAND        WSLKF
N09  C                   MOVEL     TYPLand       WSLKT
     C* ...
     C                   OTHER
     C* ...
     C                   ENDSL
      * lov å velge oppdr.type/franka. via pulldown?
     c                   exsr      GetOtFr
      * Hent printdefaulter
     c                   exsr      GetPrtDft
      *
     C     UtgetDft      endsr
      *
      *=====================================================================******
      *  Get print defaults for this type of order
      *=====================================================================******
     C     GetPrtDft     begsr
     C                   MOVE      'HEURP'       PAID
     C     BrParKey      setll     BRPARF
     C     BrParKey      reade     BRPARF                                 33
     C     *in33         doweq     '0'
     C                   move      Pavrda        TstOtFrank
     C     TstMod12      ifeq      TYPMOD12
     c                   move      PrtDftFbr     PRTFBR
     c                   move      PrtDftCmr     PRTCMR
     c                   move      PrtDftLab     PRTLAB
     C                   leave
     c                   end
     C     BrParKey      reade     BRPARF                                 33
     c                   end
      *
     C                   endsr
      *
      *
      *=====================================================================******
      * lov å velge oppdr.type/franka. via pulldown?
      *=====================================================================******
     C     GetOtFr       begsr
      * (Parm HEURO / HEURF med mer enn ett element...)
      * Oppdragstyper - finn rett parameter post flytt over i array
     C                   move      *blanks       OtString
     C                   MOVE      'HEURO'       PAID
     C     BrParKey      setll     BRPARF
     C     BrParKey      reade     BRPARF                                 33
     C     *in33         doweq     '0'
     C                   move      Pavrda        TstOtFrank
     C     TstMod12      ifeq      TYPMOD12
     C                   Move      OtFrank       OtString
     C                   leave
     c                   end
     C     BrParKey      reade     BRPARF                                 33
     c                   end
      *
      * Frankatur     - finn rett parameter post flytt over i array
     C                   move      *blanks       FrString
     C                   MOVE      'HEURF'       PAID
     C     BrParKey      setll     BRPARF
     C     BrParKey      reade     BRPARF                                 33
     C     *in33         doweq     '0'
     C                   move      Pavrda        TstOtFrank
     C     TstMod12      ifeq      TYPMOD12
     C                   Move      OtFrank       FRString
     C                   leave
     c                   end
     C     BrParKey      reade     BRPARF                                 33
     c                   end
     C     WSOT          IFEQ      *blanks
     c                   Movel     OT(1)         WSOT
     c                   end
     C     WSFR          IFEQ      *blanks
     c                   Movel     FR(1)         WSFR
     c                   end
     c                   move      'N'           VelgOtFr
     c     OT(2)         IFNE      *Blanks
     c     FR(2)         orne      *blanks
     c                   move      'J'           VelgOtFr
     c                   end
      *
     C                   endsr
      *
      *
      *
      *=====================================================================******
      *  Display end Customer Adress to select from
      *=====================================================================******
     C     DspAdr        begsr
      * Top inneholder WSKNS eller WSKNK, derfor 2 ulike format...
     C     VadrSK        IFEQ      'S'
     C                   callp     wrtsection('VadrtopS')
     c                   else
     C                   callp     wrtsection('VadrtopK')
     c                   end
     C     BIKUNR        setll     kunko1
     C     BIKUNR        reade     kunko1                                 40
     C     *in40         doweq     '0'
     c                   exsr      GetNavAdr
     c     VADRNA        ifne      *blanks
     C                   callp     wrtsection('Vadrrow')
     c                   end
     C     BIKUNR        reade     kunko1                                 40
     C                   enddo
      *
     C     VadrSK        IFEQ      'S'
     C                   callp     wrtsection('VadrBotS')
     C                   ELSE
     C                   callp     wrtsection('VadrBotK')
     C                   END
      *
     C                   endsr
      *=====================================================================******
      *  Display end Customer Adress to select from
      *=====================================================================******
     C     DspAdr2       begsr
      * Top inneholder WSKNS eller WSKNK, derfor 2 ulike format...
     C     VadrSK        IFEQ      'S'
     C                   callp     wrtsection('EnVadrS')
     c                   else
     C                   callp     wrtsection('EnVadrK')
     c                   end
      *
     C                   endsr
      *=====================================================================
      *  Hent navn adresse enten var VADR eller fra CUNDL01
      *=====================================================================
     C     GetNavAdr     begsr
      *
     c                   clear                   ADR
      *
     c     KUVADR        IFNE      *zeros
     C     VadrKey       Chain     Vadr                               33
     c     *in33         cabeq     '1'           NextAdr
     c                   else
     C     Cund1Key      Chain     Cundl01                            33
     c     *in33         cabeq     '1'           NextAdr
     C                   MOVE      KNAVN         VADRNA
     C                   MOVE      ADR1          VADRN1
     C                   MOVE      ADR2          VADRN2
     C     POSTNR        IFEQ      0
     C                   MOVEL     ADR3          VADRN3
     C                   ELSE
     C                   MOVEL     POSTNR        VADRN3
     C                   MOVE      ADR3          VADRN3
     C                   END
     C                   END
      *
      * Avvikende kundenr
      * (OBS! avvikende kundenr OG avvik. levadr. tas PR NÅ ikke hensyn til
      *       WSKNK/WSKNS overstyerer alltid det som ligger i WSNAVK/S...)
     C     KUKUN2        IFNE      BIKUNR
     C                   MOVE      KUKUN2        VADKNR
     C                   END
      *
S20  c*                  eval      NavnAdr = VADRNA + ' ' + VADRN3
N20  c                   eval      NavnAdr=%trim(VADRNA)+',&nbsp;&nbsp;'+VADRN3
N20   * Highligt kunder med eget kundenr..
N20  C     KUKUN2        IFNE      BIKUNR
N20  c                   eval      NavnAdr = %trim(NavnAdr)+'&nbsp;&nbsp;(Knr: '
N20  c                                     + %trim(%editc(KUKUN2:'Z'))+')'
N20  c                   endif
     C                   callp     updhtmlvar('SLADR':KUINTN)
     C                   callp     updhtmlvar('SLADRT':NavnAdr)
      *
     C     NextAdr       endsr
      *=====================================================================******
      *  Display OppdType Frankatur  to select from
      *=====================================================================******
     C     DspOtFr       begsr
      * Oppdrags-type.
     c                   move      *zeros        OtAnt             2 0
     C                   callp     wrtsection('Optytop')
     C     1             DO        16            N                 2 0
     C                   MOVEL     OT(N)         SlOt              2
     C     SlOt          Ifne      *blanks
     C                   callp     updhtmlvar('SLOT':SlOt)
     C     OtyKey        chain     KODTOTY                            33
     C     *in33         Ifeq      '0'
     C                   add       1             OtAnt
     C                   IF        XSPRÅK = 'EN'
     C                   callp     updhtmlvar('SLOTT':KO1ETX)
     C                   ELSE
     C                   callp     updhtmlvar('SLOTT':KO1NTX)
     C                   END
     C     WSOT          IFEQ      SlOt
     C                   callp     updhtmlvar('SLOTSEL':'SELECTED')
     C                   else
     C                   callp     updhtmlvar('SLOTSEL':spaces)
     C                   end
     C                   callp     wrtsection('Optyrow')
     c                   end
     c                   end
     c                   enddo
     C     OtAnt         Ifeq      *zeros
     C                   callp     updhtmlvar('SLOT':'  ')
     C                   callp     updhtmlvar('SLOTT':' -- blank -- ')
     C                   callp     updhtmlvar('SLOTSEL':'SELECTED')
     C                   callp     wrtsection('Optyrow')
     c                   end
     C                   callp     wrtsection('OptyBot')
      *
      * Frankatur
     c                   move      *zeros        FrAnt             2 0
     C                   callp     wrtsection('Franktop')
     C     1             DO        12            N                 2 0
     C                   MOVEL     FR(N)         SlFr              3
     C     SlFr          Ifne      *blanks
     C                   callp     updhtmlvar('SLFR':SlFr)
     C     FraKey        chain     KODTFR                             33
     C     *in33         Ifeq      '0'
     C                   add       1             FrAnt
     C                   IF        XSPRÅK = 'EN'
     C                   callp     updhtmlvar('SLFRT':KFRTTX)
     C                   ELSE
     C                   callp     updhtmlvar('SLFRT':KFRNTX)
     C                   END
     C     WSFR          IFEQ      SlFr
     C                   callp     updhtmlvar('SLFRSEL':'SELECTED')
     C                   else
     C                   callp     updhtmlvar('SLFRSEL':spaces)
     C                   end
     C                   callp     wrtsection('Frankrow')
     c                   end
     c                   end
     c                   enddo
     C     FrAnt         Ifeq      *zeros
     C                   callp     updhtmlvar('SLFR':'   ')
     C                   callp     updhtmlvar('SLFRT':' -- blank -- ')
     C                   callp     updhtmlvar('SLFRSEL':'SELECTED')
     C                   callp     wrtsection('Frankrow')
     c                   end
     C                   callp     wrtsection('FrankBot')
      *
     C                   endsr
      *
      *=====================================================================******
      *  Display Product codes to select from
      *=====================================================================******
     C     DspProd       begsr
      *
     C                   callp     wrtsection('Prodtop')
n01   * Vis kun de kunden har i param HEPRO i ESPEDPARM..
n01  C                   MOVE      'HEPRO'       PAID
     C     BrParKey      chain     BRPARF                             33
n01  c     *in33         ifeq      '0'
n01  c                   exsr      DspProdP
n01  c                   goto      Utprod
n01  c                   end
      * Vis kun de kunden har i postal pkt 9
     C     KufasKey      setll     KUFAST
     C     kufasKey      reade     KUFAST                                 40
     C     *in40         doweq     '0'
     C                   movel     KFKOD         AFPROD
     C     BIKUNR        IFEQ      *zeros
     C                   eval      *IN33 = *OFF
     C                   else
     C     KuProKey      chain     AVFRH                              33
     C                   end
     C     *in33         Ifeq      '0'
     C     KFKOD         andne     ' DEFN'
     C                   MOVEL     KFTXT         PRODTXT          20
     C                   IF        WSPROD = AFPROD
     C                   callp     updhtmlvar('SLPRSEL':'selected')
     C                   ELSE
     C                   callp     updhtmlvar('SLPRSEL':'')
     C                   END
     C                   callp     updhtmlvar('SLPR':AfProd)
     C                   callp     updhtmlvar('SLPRT':prodtxt)
     C                   callp     wrtsection('Prodrow')
     C                   end
     C     KufasKey      reade     KUFAST                                 40
     C                   enddo
      *
N01  c     UtProd        tag
     C                   callp     wrtsection('ProdBot')
      *
     C                   endsr
N01   *=====================================================================******
N01   *  Display Product codes to select from  - NÅR angitt i parameter
N01   *=====================================================================******
N01  C     DspProdP      begsr
N01   ****************************************************************************
N01  C                   Move      PAVRDA        PrString
N01   *
N01  C     1             DO        25            N
N01  C                   MOVEL     PR(N)         AFPROD
N01  C                   IF        ((AFPROD=*BLANKS) and (N > 1))
N01  c                   leave
N01  c                   end
N01  c                   eval      KFKOD  = AFPROD
N01  C     KufaskeyK     chain     KUFAST                             33        Kun gyldige koder..
N01  C     *in33         Ifeq      '0'
N01  C                   MOVEL     KFTXT         PRODTXT          20
N01  C                   IF        WSPROD = AFPROD
N01  C                   callp     updhtmlvar('SLPRSEL':'selected')
N01  C                   ELSE
N01  C                   callp     updhtmlvar('SLPRSEL':'')
N01  C                   END
N01  C                   callp     updhtmlvar('SLPR':AfProd)
N01  C                   callp     updhtmlvar('SLPRT':prodtxt)
N01  C                   callp     wrtsection('Prodrow')
N01  C                   end
N01  C                   END
N01  C                   callp     wrtsection('OTSltend')
N01   *
N01  C                   endsr
      *
      *=====================================================================
      *  TEST AVSENDER / HENT FRA KUNDEFIL.....
      *=====================================================================
     C     TSTAVS        begsr
      *
     C                   IF        XADRLIST = 'J'
      *
     C                   SELECT
     C                   WHEN      XXENDRE = 'S'
     C     KUNKO2K       CHAIN     KUNKO2                             33
     C                   MOVE      K2_KUKUN2     WSKNS
     C                   MOVE      K2_KUKUN2     BSKNS
     C                   MOVE      K2_KUVADR     XXVAD1
     C                   OTHER
     C                   MOVE      WSKNSVA       XXVAD1
     C                   ENDSL
      *
     C                   ELSE
      *
     C                   IF        XXADRS <> *BLANKS
     C     KUNKO2KS      CHAIN     KUNKO2                             33
     C                   IF        *IN33 = *OFF
     C                   MOVE      K2_KUKUN2     WSKNS
     C                   MOVE      K2_KUKUN2     BSKNS
     C                   MOVE      K2_KUVADR     XXVAD1
     C                   MOVE      ' '           AVVIKSK
     C                   MOVE      *BLANKS       WSNAS
     C                   MOVE      *BLANKS       WSADS1
     C                   MOVE      *BLANKS       WSADS2
     C                   MOVE      *BLANKS       WSADS3
     C                   MOVE      *BLANKS       GMNAS
     C                   MOVE      *BLANKS       GMADS1
     C                   MOVE      *BLANKS       GMADS2
     C                   MOVE      *BLANKS       GMADS3
     C                   ELSE
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL17EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL17        FEILMELDING
     C                   END
     C                   MOVE      '17'          FMELDNR
     C                   GOTO      SLTSTAVS
     C                   END
     C                   END
      *
     C                   END
      *
      *
     C     WSKNS         IFNE      *BLANKS
     C     CUND1KS       CHAIN     CUNDL01                            33
     C     *IN33         IFEQ      '1'
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL04EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL04        FEILMELDING
     C                   END
     C                   MOVE      '04'          FMELDNR
     C                   ELSE
      *
     C                   IF        ((XXADRS <> *BLANKS) AND (BSKNS <> BIKUNR))
      * HENT ADRESSE FRA SPØRRING
     C                   IF        XXVAD1 <> 0
      * HVIS VAREADRESSE IKKE ER 0.
     C     VADR1KS       CHAIN     VADR                               33
     C     *IN33         IFEQ      *OFF
     C                   MOVE      VADRNA        WSNAS
     C                   MOVE      VADRN1        WSADS1
     C                   MOVE      VADRN2        WSADS2
     C                   MOVE      VADRN3        WSADS3
     C                   MOVE      VADRNR        WSKNSVA
N03  C                   IF        VALAND = *BLANKS
N03  C                   MOVE      'NO'          WSLKF
N03  C                   ELSE
N03  C                   MOVE      VALAND        WSLKF
N03  C                   END
     C                   ELSE
     C                   MOVE      *ZEROS        XXVAD1
     C                   END
     C                   END
     C                   IF        XXVAD1 = 0
      * HVIS VAREADRESSE ER 0.
     C                   MOVE      KNAVN         WSNAS
     C                   MOVE      ADR1          WSADS1
     C                   MOVE      ADR2          WSADS2
     C                   MOVE      *BLANKS       WSADS3
     C     POSTNR        IFEQ      0
     C                   MOVEL     ADR3          WSADS3
     C                   ELSE
     C                   MOVEL     POSTNR        WSADS3
     C                   MOVE      ADR3          WSADS3
     C                   END
     C                   END
      *
     C                   MOVEL     WSADS3        WSSDF
     C                   ELSE
      *
     C                   IF        ((((WSNAS = GMNAS) AND
     C                                (WSADS1 = GMADS1)) AND
     C                                (WSADS2 = GMADS2)) AND
     C                                (WSADS3 = GMADS3))
     C                   MOVE      KNAVN         WSNAS
     C                   MOVE      ADR1          WSADS1
     C                   MOVE      ADR2          WSADS2
     C                   MOVE      *BLANKS       WSADS3
S11  C*    POSTNR        IFEQ      0
S11  C*                  MOVEL     ADR3          WSADS3
S11  C*                  ELSE
S11  C*                  MOVEL     POSTNR        WSADS3
S11  C*                  MOVE      ADR3          WSADS3
S11  C*                  END
N11  C                   SELECT
N11  C     POSTNR        WHENEQ    0
N11  C     SYPOGE        ANDEQ     *BLANKS
N11  C                   MOVEL     ADR3          WSADS3
N11  C     POSTNR        WHENEQ    0
N11  C                   MOVEL     SYPOGE        WSADS3
N11  C                   CAT       ADR3:1        WSADS3
N11  C                   OTHER
N11  C                   MOVEL     POSTNR        WSADS3
N11  C                   MOVE      ADR3          WSADS3
N11  C                   ENDSL
N11  C                   IF        SYLAND = *BLANKS
N11  C                   MOVE      'NO'          WSLKF
N11  C                   ELSE
N11  C                   MOVE      SYLAND        WSLKF
N11  C                   END
      * Hvis vareadr 1 finnes -bruk den.
     C                   IF        XXVAD1 = 0
     C                   Z-ADD     1             XXVAD1            5 0
     C                   END
     C     VADR1KS       CHAIN     VADR                               33
     C     *IN33         IFEQ      *OFF
     C                   MOVE      VADRNA        WSNAS
     C                   MOVE      VADRN1        WSADS1
     C                   MOVE      VADRN2        WSADS2
     C                   MOVE      VADRN3        WSADS3
     C                   MOVE      VADRNR        WSKNSVA
N03  C                   IF        VALAND = *BLANKS
N03  C                   MOVE      'NO'          WSLKF
N03  C                   ELSE
N03  C                   MOVE      VALAND        WSLKF
N03  C                   END
     C                   END
     C                   MOVEL     WSADS3        WSSDF
     C                   END
      *
     C                   END
     C                   END
     C                   END
     C                   IF        WSSDF = *BLANKS
     C                   movel     WSADS3        WSSDF
     C                   END
     C                   IF        XXENDRE = 'S'
     C                   END
      *
     C     SLTSTAVS      TAG
      *
     C                   endsr
      *
      *=====================================================================
      *  TEST MOTTAKER / HENT FRA KUNDEFIL.....
      *=====================================================================
     C     TSTMOT        begsr
      *
     C                   IF        XADRLIST = 'J'
      *
     C                   SELECT
     C                   WHEN      XXENDRE = 'K'
     C     KUNKO2K       CHAIN     KUNKO2                             33
     C                   MOVE      K2_KUKUN2     WSKNK
     C                   MOVE      K2_KUKUN2     BSKNK
     C                   MOVE      K2_KUVADR     XXVAD1
     C                   OTHER
     C                   MOVE      WSKNKVA       XXVAD1
     C                   ENDSL
      *
     C                   ELSE
      *
     C                   IF        XXADRK <> *BLANKS
     C     KUNKO2KK      CHAIN     KUNKO2                             33
     C                   IF        *IN33 = *OFF
     C                   MOVE      K2_KUKUN2     WSKNK
     C                   MOVE      K2_KUKUN2     BSKNK
     C                   MOVE      K2_KUVADR     XXVAD1
     C                   MOVE      ' '           AVVIKSK
     C                   MOVE      *BLANKS       WSNAK
     C                   MOVE      *BLANKS       WSADK1
     C                   MOVE      *BLANKS       WSADK2
     C                   MOVE      *BLANKS       WSADK3
     C                   MOVE      *BLANKS       GMNAK
     C                   MOVE      *BLANKS       GMADK1
     C                   MOVE      *BLANKS       GMADK2
     C                   MOVE      *BLANKS       GMADK3
     C                   ELSE
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL17EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL17        FEILMELDING
     C                   END
     C                   MOVE      '18'          FMELDNR
     C                   GOTO      SLTSTMOT
     C                   END
     C                   END
      *
     C                   END
      *
      *
     C     WSKNK         IFNE      *BLANKS
     C     CUND1KK       CHAIN     CUNDL01                            33
     C     *IN33         IFEQ      '1'
     C                   IF        XSPRÅK = 'EN'
     C                   MOVEL     FEIL06EN      FEILMELDING
     C                   ELSE
     C                   MOVEL     FEIL06        FEILMELDING
     C                   END
     C                   MOVE      '06'          FMELDNR
     C                   ELSE
      *
     C                   IF        ((XXADRK <> *BLANKS) AND (BSKNK <> BIKUNR))
      * HENT ADRESSE FRA SPØRRING
     C                   IF        XXVAD1 <> 0
      * HVIS VAREADRESSE IKKE ER 0.
     C     VADR1KK       CHAIN     VADR                               33
     C     *IN33         IFEQ      *OFF
     C                   MOVE      VADRNA        WSNAK
     C                   MOVE      VADRN1        WSADK1
     C                   MOVE      VADRN2        WSADK2
     C                   MOVE      VADRN3        WSADK3
     C                   MOVE      VADRNR        WSKNKVA
N03  C                   IF        VALAND = *BLANKS
N03  C                   MOVE      'NO'          WSLKT
N03  C                   ELSE
N03  C                   MOVE      VALAND        WSLKT
N03  C                   END
     C                   ELSE
     C                   MOVE      *ZEROS        XXVAD1
     C                   END
     C                   END
     C                   IF        XXVAD1 = 0
      * HVIS VAREADRESSE ER 0.
     C                   MOVE      KNAVN         WSNAK
     C                   MOVE      ADR1          WSADK1
     C                   MOVE      ADR2          WSADK2
     C                   MOVE      *BLANKS       WSADK3
     C     POSTNR        IFEQ      0
     C                   MOVEL     ADR3          WSADK3
     C                   ELSE
     C                   MOVEL     POSTNR        WSADK3
     C                   MOVE      ADR3          WSADK3
     C                   END
     C                   END
      *
     C                   MOVEL     WSADK3        WSSDT
     C                   ELSE
      *
     C                   IF        ((((WSNAK = GMNAK) AND
     C                                (WSADK1 = GMADK1)) AND
     C                                (WSADK2 = GMADK2)) AND
     C                                (WSADK3 = GMADK3))
     C                   MOVE      KNAVN         WSNAK
     C                   MOVE      ADR1          WSADK1
     C                   MOVE      ADR2          WSADK2
     C                   MOVE      *BLANKS       WSADK3
     C                   SELECT
     C     POSTNR        WHENEQ    0
     C     SYPOGE        ANDEQ     *BLANKS
     C                   MOVEL     ADR3          WSADK3
     C     POSTNR        WHENEQ    0
     C                   MOVEL     SYPOGE        WSADK3
     C                   CAT       ADR3:1        WSADK3
     C                   OTHER
     C                   MOVEL     POSTNR        WSADK3
     C                   MOVE      ADR3          WSADK3
     C                   ENDSL
N11  C                   IF        SYLAND = *BLANKS
N11  C                   MOVE      'NO'          WSLKT
N11  C                   ELSE
N11  C                   MOVE      SYLAND        WSLKT
N11  C                   END
      * Hvis vareadr 1 finnes -bruk den.
     C                   IF        XXVAD1 = 0
     C                   Z-ADD     1             XXVAD1            5 0
     C                   END
     C     VADR1KK       CHAIN     VADR                               33
     C     *IN33         IFEQ      *OFF
     C                   MOVE      VADRNA        WSNAK
     C                   MOVE      VADRN1        WSADK1
     C                   MOVE      VADRN2        WSADK2
     C                   MOVE      VADRN3        WSADK3
     C                   MOVE      VADRNR        WSKNKVA
N03  C                   IF        VALAND = *BLANKS
N03  C                   MOVE      'NO'          WSLKT
N03  C                   ELSE
N03  C                   MOVE      VALAND        WSLKT
N03  C                   END
     C                   END
     C                   MOVEL     WSADK3        WSSDT
     C                   END
      *
     C                   END
     C                   END
     C                   END
     C                   IF        WSSDT = *BLANKS
     C                   MOVEL     WSADK3        WSSDT
     C                   END
     C                   IF        XXENDRE = 'K'
     C                   END
      *
     C     SLTSTMOT      TAG
      *
     C                   endsr
      *=====================================================================
      *  HENT DOKUMENTER
      *=====================================================================
     C     HENTDOK       BEGSR
     C     Zead5Key      CHAIN(N)  ZEADL05                            33
     C                   Z-ADD     HEUNIK        WSUNIK
     C     ZRISOL02K     SETLL     ZRISOL02
     C     ZRISOL02K     READE(N)  ZRISOL02                               33
     c                   MOVE      *BLANKS       UPDF
     c                   MOVE      *ZEROS        XN                5 0
     C                   DOW       *IN33 = *OFF
     c                   ADD       1             XN
      *
     C                   EVAL      UPDF(XN) = '<a href="'
     C                             + %trim(XBANE) + %trim(XFSUNIK)
     C                             + %trim(FSDOKK) + %trim(FSSOK)
     C                             + '" target="SyPDFWindN">'
     C                             + %trim(FSSOK)
     C                             + '<img src="/syspeddev/PDF.gif" ALT="'
     C                             + %trim(FSSOK)
     C                             + '"></a>'
     C                   IF        ((FSSOK <> 'Fraktbrev.pdf') AND
     C                              (FSSOK <> 'CMRFrbrev.pdf'))
     C                   EVAL      UPDF(XN) = %trim(UPDF(XN))
     C                             + ' <a href="#" OnClick="DltDoc('
     C                             + %trim(XAPSTR)
     C                             + %trim(XBANE) + %trim(XFSUNIK)
     C                             + %trim(FSDOKK) + %trim(FSSOK)
     C                             + %trim(XAPSTR)
     C                             + ')"> <img src="/syspeddev/DeleteX.gif"'
     C                             + ' width=13 height=13 border=0>'
     C                   END
      *
     C     ZRISOL02K     READE(N)  ZRISOL02                               33
     C                   ENDDO
      *
     C                   callp     updHTMLvar('UPDF1':UPDF1)
     C                   callp     updHTMLvar('UPDF2':UPDF2)
     C                   callp     updHTMLvar('UPDF3':UPDF3)
     C                   callp     updHTMLvar('UPDF4':UPDF4)
     C                   callp     updHTMLvar('UPDF5':UPDF5)
     C                   callp     updHTMLvar('UPDF6':UPDF6)
     C                   callp     updHTMLvar('UPDF7':UPDF7)
     C                   callp     updHTMLvar('UPDF8':UPDF8)
     C                   callp     updHTMLvar('UPDF9':UPDF9)
     C                   callp     updHTMLvar('UPDF10':UPDF10)
     C                   callp     updHTMLvar('UPDF11':UPDF11)
     C                   callp     updHTMLvar('UPDF12':UPDF12)
     C                   callp     updHTMLvar('UPDF13':UPDF13)
     C                   callp     updHTMLvar('UPDF14':UPDF14)
     C                   callp     updHTMLvar('UPDF15':UPDF15)
     C                   callp     updHTMLvar('UPDF16':UPDF16)
     C                   callp     updHTMLvar('UPDF17':UPDF17)
     C                   callp     updHTMLvar('UPDF18':UPDF18)
     C                   callp     updHTMLvar('UPDF19':UPDF19)
     C                   callp     updHTMLvar('UPDF20':UPDF20)
     C                   callp     updHTMLvar('UPDF21':UPDF21)
     C                   callp     updHTMLvar('UPDF22':UPDF22)
     C                   callp     updHTMLvar('UPDF23':UPDF23)
     C                   callp     updHTMLvar('UPDF24':UPDF24)
     C                   callp     updHTMLvar('UPDF25':UPDF25)
     C                   callp     updHTMLvar('UPDF26':UPDF26)
     C                   callp     updHTMLvar('UPDF27':UPDF27)
     C                   callp     updHTMLvar('UPDF28':UPDF28)
     C                   callp     updHTMLvar('UPDF29':UPDF29)
     C                   callp     updHTMLvar('UPDF30':UPDF30)
     C                   callp     updHTMLvar('UPDF31':UPDF31)
     C                   callp     updHTMLvar('UPDF32':UPDF32)
     C                   callp     updHTMLvar('UPDF33':UPDF33)
     C                   callp     updHTMLvar('UPDF34':UPDF34)
     C                   callp     updHTMLvar('UPDF35':UPDF35)
     C                   callp     updHTMLvar('UPDF36':UPDF36)
     C                   callp     updHTMLvar('UPDF37':UPDF37)
     C                   callp     updHTMLvar('UPDF38':UPDF38)
     C                   callp     updHTMLvar('UPDF39':UPDF39)
     C                   callp     updHTMLvar('UPDF40':UPDF40)
      *
     C                   ENDSR
      *
      *=====================================================================
      *  FINNE LINJE
      *=====================================================================
     C     KVTLIN        BEGSR
     C                   MOVE      *BLANKS       T70
     C                   MOVE      *BLANKS       TX
     C                   MOVE      *ZEROS        XN1               5 0
     C                   MOVE      *ZEROS        XN2               5 0
     C     XLINL         MULT      90            XN5               5 0
     C     1             DO        XN5           XN3               5 0
     C                   ADD       1             XN2
     C                   SELECT
     C                   WHEN      XN2 > XLINL
     C                   ADD       1             XN1
     C                   MOVEL     TXT70         TX(XN1)
     C     XN1           CABEQ     90            SLKVTLIN
     C                   MOVE      *BLANKS       T70
     C                   IF        KVT(XN3) = XSTEGN1
     C     XN3           ADD       1             XN4               5 0
     C                   IF        KVT(XN4) = XSTEGN2
     C                   EVAL      XN3 = XN4
     C                   Z-ADD     0             XN2
     C                   ELSE
     C                   Z-ADD     1             XN2
     C                   MOVE      KVT(XN3)      T70(XN2)
     C                   END
     C                   ELSE
     C                   Z-ADD     1             XN2
     C                   MOVE      KVT(XN3)      T70(XN2)
     C                   END
     C                   WHEN      KVT(XN3) = XSTEGN1
     C     XN3           ADD       1             XN4               5 0
     C                   IF        KVT(XN4) = XSTEGN2
     C                   ADD       1             XN1
     C                   MOVEL     TXT70         TX(XN1)
     C     XN1           CABEQ     90            SLKVTLIN
     C                   MOVE      *BLANKS       T70
     C                   MOVE      *ZEROS        XN2
     C                   EVAL      XN3 = XN4
     C                   ELSE
     C                   MOVE      KVT(XN3)      T70(XN2)
     C                   END
     C                   OTHER
     C                   MOVE      KVT(XN3)      T70(XN2)
     C                   ENDSL
     C                   ENDDO
      *
     C     SLKVTLIN      ENDSR
      *
N05   *////////////////////////////////////////////////////////////
N05  C     OPDLOG        BEGSR
N05   *////////////////////////////////////////////////////////////
N05   *
N05  C                   CALL      'SYGE15C'
N05  C                   PARM                    WDT               8
N05  C                   PARM                    WTM               6
N05  C                   MOVE      HEAVD         TTAVD
N05  C                   MOVE      HEOPD         TTOPD
N05  C                   MOVE      WDT           TTDATE
N05  C                   MOVE      WTM           TTTIME
N05  C                   MOVE      WDT           TTDATL
N05  C                   MOVE      WTM           TTTIML
N05  C                   MOVE      'ED1'         TTACTI
N05  C                   MOVE      WSUSER        TTUSER
N05  C                   EVAL      TTTEXT = 'Incoming EDI prepared from sender'
N10  C                   EVAL      TTTEXL = 'Inkommede EDI forberedt av '+
N10  C                             'avsender'
N05  C                   MOVE      'WEB'         TTEDEV
N05  C                   MOVE      HEUNIK        TTUNIK
N05  C                   MOVE      HEREFF        TTREFF
N05  C                   WRITE     TRACKFR
N05   *
N05  C                   ENDSR
N05   *
      *=====================================================================
      *  Initier
      *=====================================================================
     C     INIT          begsr
      * Get program start time for calculating execution time
     C                   time                    timedata1
      *
     C                   open      BRIDF                                50
     C     WSUSER        CHAIN(N)  BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
     C                   EXSR      TSTUSER
OddEv *      Odd/Even/Rowhead-farger,Logobilde,Språk,Intern/Ekstern bruker,  mm
OddEvc                   call      'ESGETPAR'
OddEvc                   parm                    BIBRID
OddEvc                   parm                    BIFIRM
OddEvc                   parm                    BIKUNR
OddEvc                   parm                    BIKNG
OddEvc                   parm                    RowHead          10
OddEvc                   parm                    Odd              10
OddEvc                   parm                    Even             10
OddEvc                   parm                    LogoImg          50
OddEvc                   parm                    XSPRÅK            2
OddEvc                   parm                    XINTERN           1
OddEvc                   parm                    ParmDS1        1024
OddEvc                   parm                    ParmDS2        1024
OddEvc                   parm                    ParmDS3        1024
     C                   open      FIRM
     C                   open      zeadl05                              50
     C                   open      zreetxt1                             50
     C                   open      ZRISOL02                             50
N05  C                   OPEN      ZTRACKF
     C                   open      CUNDL01                              50
     C                   OPEN      kunko1
     C                   OPEN      KUNKO2
     C                   OPEN      vadr
     C                   open      STED2                                50
     C                   open      STED2D                               50
     C                   OPEN      BRPARF
     C                   OPEN      KODTOTY
     C                   OPEN      KODTFR
     C                   OPEN      ZTELL
     C                   OPEN      KUFAST                               50
     C                   OPEN      AVFRH                                50
      * hent landkode
     C     *loval        setll     Firm
     C                   read      Firm
      * DERSOM AVVIKENDE KUNDENR OPPGITT...
     C     AVVKNRN       ifne      *zeros
     c                   move      AVVKNRN       BIKUNR
     C                   end
      * Innen Z-filer skapt fra WEB forventes unik kund/reff
     C     ZEAD5KEY      klist
S02  C*                  kfld                    BIKUNR
N02  C                   kfld                    XKNGIVER
     C                   kfld                    WSREFF
     C     ZRISOL02K     klist
     C                   kfld                    WSUNIK
     C                   kfld                    WSREFF
     C                   kfld                    FSKODE
     C                   MOVEL     '#VD'         FSKODE
      *
     c     CUND1KS       klist
     c                   kfld                    BIFIRM
     c                   kfld                    BSKNS
     c     VADR1KS       klist
     c                   kfld                    BIFIRM
     c                   kfld                    BSKNS
     c                   kfld                    XXVAD1
     c                   Z-ADD     1             XXVAD1            5 0
     c     CUND1KK       klist
     c                   kfld                    BIFIRM
     c                   kfld                    BSKNK
     C     KUNKO2K       klist
     C                   kfld                    BIKUNR
     C                   kfld                    XXADR
     C     KUNKO2KS      klist
     C                   kfld                    BIKUNR
     C                   kfld                    XXADRS
     C     KUNKO2KK      klist
     C                   kfld                    BIKUNR
     C                   kfld                    XXADRK
     c     VADR1KK       klist
     c                   kfld                    BIFIRM
     c                   kfld                    BSKNK
     c                   kfld                    XXVAD1
     C     VadrKey       klist
     C                   kfld                    BIFIRM
     C                   kfld                    KUKUN2
     C                   kfld                    KUVADR
     C     CUND1Key      klist
     C                   kfld                    BIFIRM
     C                   kfld                    KUKUN2
N14  C     OpdgiKey      klist
N14  C                   kfld                    BIFIRM
n14  C                   kfld                    XKNGIVER
     c     StedFraKey    klist
     c                   kfld                    WSLKF
     c                   kfld                    WSSDF
     c     StedTilKey    klist
     c                   kfld                    WSLKT
     c                   kfld                    WSSDT
     c     ZreeKey       klist
     c                   kfld                    FRUNIK
     c                   kfld                    FRREFF
     C     BrParKey      klist
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
     C                   MOVE      BIBRID        PABRID
     C                   MOVE      *zeros        PAKUNR
     c     OtyKey        klist
     c                   kfld                    KO1UNI
     c                   kfld                    SlOt
     c                   MOVE      'OTY'         KO1UNI
     c     FraKey        klist
     c                   kfld                    KFRUNI
     c                   kfld                    SlFr
     c                   MOVE      'FR'          KFRUNI
     C     KODTFRK       KLIST
     C                   KFLD                    KFRUNI
     C                   KFLD                    WSFR
     C     KufasKey      klist
     C                   kfld                    KFTYP
     C                   movel     'PRODTYPE'    KFTYP
n01  c     KufasKeyK     klist
n01  c                   kfld                    KFTYP
n01  c                   kfld                    KFKOD
     C     KuProKey      klist
     C                   kfld                    BIKUNR
     C                   kfld                    AFPROD
N02   * ARBEIDSGIVER
N02  C                   MOVE      'HEKN1'       PAID
N02  C     BrParKey      CHAIN     BRPARF                             33
N02  C  N33              Z-ADD     PAVRDN        XKNGIVER          8 0
N02  C   33              Z-ADD     BIKUNR        XKNGIVER
N02   * FAKURAMOTTAKER
N02  C                   MOVE      'HEKN2'       PAID
N02  C     BrParKey      CHAIN     BRPARF                             33
N02  C  N33              Z-ADD     PAVRDN        XKNFAKTM          8 0
N02  C   33              Z-ADD     BIKUNR        XKNFAKTM
      * HENT SPRÅKKODE
     C                   MOVEL     'SPRÅK'       PAID
     C     BrParKey      Chain     BRPARF                             33
     C                   IF        (*IN33 OR (PAVRDA <> 'EN'))
     C                   MOVE      *BLANKS       XSPRÅK            2
     C                   ELSE
     C                   MOVE      'EN'          XSPRÅK            2
     C                   END
      *
     C                   MOVE      'OLBAN'       PAID
     C     BrParKey      CHAIN     BRPARF                             33
N08  C                   IF        *IN33
N08  C                   EVAL      PABRID = '*KUNDFT*' + %TRIM(FIFIRM)
N08  C     BrParKey      CHAIN     BRPARF                             33
N08  C                   EVAL      PABRID = BIBRID
N08  C                   END
     C  N33              MOVE      'J'           XOPPLAST          1
     C  N33              MOVEL     PAVRDA        XBANE            50
      *
     C                   EVAL      PAID = 'LLVML'
     C     BrParKey      CHAIN     BRPARF                             33
     C                   IF        *IN33
     C                   MOVE      '*KUNDFT*  '  PABRID
     C                   MOVE      BIFIRM        PABRID
     C                   MOVE      BIKUNR        PAKUNR
     C     BrParKey      CHAIN     BRPARF                             33
     C                   IF        *IN33
     C                   MOVE      *ZEROS        PAKUNR
     C     BrParKey      CHAIN     BRPARF                             33
     C                   END
     C                   END
     C                   IF        (*IN33 OR (PAVRDA = 'J') OR (PAVRDA = 'j'))
     C                   MOVE      'J'           XADRLIST          1
     C                   ELSE
     C                   MOVE      'N'           XADRLIST
     C                   END
     C                   MOVE      BIBRID        PABRID
     C                   MOVE      *zeros        PAKUNR
      *
     C                   EVAL      PAID = 'VISFA'
     C     BrParKey      CHAIN     BRPARF                             33
     C                   IF        *IN33
     C                   MOVE      '*KUNDFT*  '  PABRID
     C                   MOVE      BIFIRM        PABRID
     C                   MOVE      BIKUNR        PAKUNR
     C     BrParKey      CHAIN     BRPARF                             33
     C                   IF        *IN33
     C                   MOVE      *ZEROS        PAKUNR
     C     BrParKey      CHAIN     BRPARF                             33
     C                   END
     C                   END
     C  N33              IF        ((PAVRDA = 'J') OR (PAVRDA = 'j'))
     C                   MOVE      'J'           XVISFAKT          1
     C                   ELSE
     C                   MOVE      'N'           XVISFAKT
     C                   END
      * reset key slik at det er på USERID...
     C                   MOVE      BIBRID        PABRID
     C                   MOVE      *zeros        PAKUNR
      *
     C                   MOVE      'N'           AVSLUTT           1
     c                   move      *blanks       feilmelding
     c                   move      *blanks       fmeldnr
      *
     C                   BITON     '457'         XSTEGN1           1
     C                   BITOFF    '01236'       XSTEGN1
     C                   BITON     '257'         XSTEGN2           1
     C                   BITOFF    '01346'       XSTEGN2
     C                   BITON     '123457'      XAPSTR            1
     C                   BITOFF    '06'          XAPSTR
      *
      *
     C                   endsr
      *////////////////////////////////////////////////////////////
     C     TSTUSER       BEGSR
      *////////////////////////////////////////////////////////////
      /copy syspeds/qrpgsrcpy,tstuser
      *
     C                   endsr
      *=====================================================================
      * Send output buffer and quit
      *=====================================================================
     C     Exit          begsr
      * Compute and display run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
     C                   callp     wrtsection('endhtml')
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      *
     C                   close     BRIDF
     C                   close     FIRM
     C                   close     zeadl05
     C                   close     zreetxt1
     C                   close     ZRISOL02
N05  C                   close     ZTRACKF
     C                   close     CUNDL01
     C                   close     kunko1
     C                   close     KUNKO2
     C                   close     vadr
     C                   close     STED2
     C                   close     STED2D
     C                   close     BRPARF
     C                   close     KODTOTY
     C                   close     KODTFR
     C                   close     ZTELL
     C                   close     KUFAST
     C                   close     AVFRH
     C                   eval      *inlr = *on
     C                   return
     C                   endsr
