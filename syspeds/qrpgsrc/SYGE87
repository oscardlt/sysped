********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX * 01 SH  PTF11 rekvisisjonsnummer inn
11XXX * 02 SH  PTF11 fraktbrevnummer inn  turnummer til budsjett
********************************************************************
      *
      ***************************************************************
      *** PROGRAM SKAL SKRIVE FRAKT TIL BUDSJETT                  ***
      *
N01  FKOSTT     UF   E           K DISK
N02  Fturer14   IF   E           K DISK
     FKOSBU12   UF A E           K DISK
     FHEADF     IF   E           K DISK
     FDOKUF     IF   E           K DISK
     FTRAN      IF   E           K DISK
     FFIRM      IF   E           K DISK
     FTRACKF    O  A E           K DISK
     D                SDS
     D  ZUSER                254    263
     D                 DS
     D                 DS
     D  HEDTAA                 1      4  0
     D  HEDTMM                 5      6  0
     D  HEDTDD                 7      8  0
     D  HEDTOP                 1      8  0
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XUL≈≈                 11     14  0
     D                 DS
     D  UL≈≈                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
      *
     c                   exsr      init
      *
     C     KEYHEA        CHAIN     HEADF                              33
     C  N33KEYDOKUF      CHAIN     DOKUF                              33
     c  N33KEYTRAN       CHAIN     TRAN                               34
N02  c  N33HEPRO         CHAIN     TURER14                            34
     C  N33              EXSR      BUDSR
     C  N33              EXSR      TTSR
     C                   SETON                                        LR
     C                   RETURN
     c**************************************************************************
     c     budsr         begsr
     c**************************************************************************
     c                   clear                   kosbur
     c                   move      UAVD          BUOAVD
     c                   move      UOPD          BUOPD
      * skal de busjetteres fra stykkgodsfraktbrev
     C                   EVAL      utxt='*tb*'
s02  c*                  move      '001'         ufbnra            3
n02  c                   move      ufbnr         ufbnra            3
     c                   CAT       UFBNRA:0      utxt
     c     kosbuk        chain     kosbu12                            34
      *
      * hopp ut hvis budsjett er avkrysset
      *
     c  n34bust          ifne      ' '
     C                   UPDATE    kosbur
     c                   goto      utbud
     c                   end
      *
      *
      * flytter data til budsjett record
      *
     c                   move      FICURR        buval
     c                   z-add     ubud          bubl
     c                   z-add     dftran        butnr
     c                   z-add     vmtrle        bulnr
     C                   MOVEL     HEDTAA        BUPCC
     C                   MOVE      HEDTAA        BUP≈R
     C                   MOVE      HEDTMM        BUPMN
     C                   MOVE      'FRA'         BUVK
     C                   MOVE      HESG          BUSG
     C                   MOVE      'O'           BUFER                          *O = OPPDRAG
     C                   MOVE      'E'           BUBLST
     C                   MOVE      'E'           BUTYPE
     c                   move      utxt          butxt
n02  c                   move      tuavd         butavd
n02  c                   move      tupro         butunr
      * endre gammelt budsjett
      *
     c     *in34         ifeq      '0'
     c                   update    kosbur
      * logikk ved skrive ny
     c                   else
N01  C     YBNRT         CHAIN     KOSTT                              41
N01  C  N41              ADD       1             KTNR
N01  C  N41              UPDATE    KOSTTR
N01  C  N41              MOVE      KTNR          BUBNR
     c                   write     kosbur
     c                   end
     c     utbud         endsr
     c**************************************************************************
     c     init          begsr
     c**************************************************************************
     c     *entry        plist
     c                   parm                    uavd              4
     c                   parm                    uopd              7
N02  c                   parm                    ufbnr             3
     c                   parm                    ubud             13 2
      *
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XUL≈≈         UL≈≈
      *
     C     KEYHEA        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   MOVE      UAVD          HEAVD
     C                   MOVE      UOPD          HEOPD
     C     KEYDOKUF      KLIST
     C                   kfld                    dfri
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   kfld                    dffbnr
     c                   move      'F'           dfri
S02  c*                  z-add     1             dffbnr
N02  c                   move      ufbnr         dffbnr
     C     KEYTRAN       KLIST
     C                   kfld                    FIFIRM
     C                   KFLD                    DFTRAN
      *
     C     KOSBUK        KLIST
     C                   KFLD                    BUOAVD
     C                   KFLD                    BUOPD
     C                   KFLD                    UTXT             35
N01  C                   MOVE      '≈'           YBNRT             1
      *
     c                   read      firm                                   34
      *
     c                   endsr
     C***********************************************
     C     TTSR          BEGSR
     C***********************************************
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XUL≈≈         UL≈≈
     C                   MOVE      'TBU'         TTACTI
     C                   MOVE      ULDT          TTDATE
     C                   MOVE      XULTM         TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
     C                   MOVE      ZUSER         TTUSER
     C                   MOVE      *blanks       TTTEXT
     c                   move      *blanks       FIFNA             7
     C                   eval      TTTEXT = 'Budget from:'
     C                             +  %trim( DFNAT )
     C                             + ' Amount: '
     c                             + %triml(%editc(UBUD:'J'))
     C*
     C                   eval      TTTEXL = 'Budsjett fra:'
     C                             +  %trim( DFNAT )
     C                             + ' Bel¯p: '
     c                             + %triml(%editc(UBUD:'J'))
N02  C                   z-add     dffbnr        ttfbnr
     C                   WRITE     TRACKFR
     C                   ENDSR
     C*
