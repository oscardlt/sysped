10XXX * kontroll på et det er ok å rekalkulere påhviler programmet i front
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 brushe opp litt
10XXX * 02 sh  PTF10 ny parameter syge03
********************************************************************
      *
     FFAKT      UF A E           K DISK
     FHEADF     UF   E           K DISK
     FFIRM      IF   E           K DISK
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UUAVD             4 0
     C                   PARM                    UUOPD             7 0
     C                   EXSR      BERFRA
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     BERFRA        BEGSR
     C***********************************************
     C                   MOVE      UUAVD         HEAVD
     C                   MOVE      UUOPD         HEOPD
     C     HEADK         KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     HEADK         CHAIN(N)  HEADF                              33
     C*
     C* BEREGNER FRAKT
     C*
     C                   Z-ADD     0             FALI
     C                   MOVE      HEAVD         FAAVD
     C                   MOVE      HEOPD         FAOPD
     C     FAKTKE        KLIST
     C                   KFLD                    FAAVD
     C                   KFLD                    FAOPD
     C                   KFLD                    FALI
     C*
     C* POSTNUMMERBASERT KALKULASJON
      * Finn frakt i kundersfraktavtale
     C     HEKNSF        IFNE      *ZEROS
     C                   MOVE      HEKNSF        UUKNR
     C                   ELSE
     C                   MOVE      HEKNKF        UUKNR
     C                   END
     C                   MOVE      *BLANKS       UUVAL             3
     C                   MOVE      'FRA'         UGEB              3
     C                   MOVE      'FRA'         UGEBY             3
     C                   MOVE      *ZEROS        UUBELØ           13 2
     C                   MOVE      'S'           USKA              1
     C                   CALL      'SYGE04'
     C                   PARM                    UGEBY
     C                   PARM                    UGEB
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    UUKNR             8 0
     C                   PARM                    UUVAL
     C                   PARM                    UUBELØ
     C                   PARM                    UAVNR             9 0
     C                   PARM                    UAVMSG           50
     C                   PARM                    USKA
     C                   MOVE      'A'           XKDA
      *
     C     UUBELØ        IFEQ      0
     C                   MOVE      'B'           XKDA              1
     C                   MOVE      *BLANKS       UUVAL
     C                   MOVE      *ZEROS        URABAT
     C                   CALL      'SYGE03'
     C                   PARM                    UGEB
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    UUVAL
     C                   PARM                    UUBELØ
     C                   PARM                    USONE             5
     C                   PARM                    URABAT            5 2
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    N5                5 0
     C                   PARM                    UUKNR
     C                   PARM                    UAVNR             9 0
n02  c                   parm                    atdum             1
     C                   END
     C*******-******
     C     UUBELØ        IFNE      *ZEROS
     C     HEADK         CHAIN     HEADF                              33
     C                   MOVE      UUVAL         TRFRAV
     C                   MOVE      'M'           TRFRAK
     C                   Z-ADD     UUBELØ        TRFRAB
     C     HELKA         IFEQ      'NO'
     C     HETRI         ANDEQ     'NO'
N01  C     TRSLAG        ANDEQ     'HO'
     C                   MOVE      'J'           TRMVA
     C                   ELSE
     C                   MOVE      'N'           TRMVA
     C                   END
     C  N33              UPDATE    HEADFR
     C                   END
     C*
     C* SLUTT MAKINELL BEREGNING
     C*
     C*
     C*
     C* OPPDATERER VARELINJE FRAKT
     C* der ER førstelinja som skal være FRA..
s01  C*                  SETOFF                                       33
s01  C*    FAKTKE        SETLL     FAKT
s01  C*    *IN33         DOWEQ     '0'
s01  C*    FAKTKE        READE     FAKT                                   33
s01  C* N33FAVK          IFEQ      'FRA'
s01  C*                  GOTO      UTFR1
s01  C*                  END
s01  C*                  END
s01  C*
s01  C*    UTFR1         TAG
     C*
N01  C     FAKTKE        chain     FAKT                               33
     C  N33FAOPKO        IFNE      *BLANKS
     C  N33FAOPKO        IFNE      'C'
     C     FAFAKT        IFNE      *ZEROS
     C                   GOTO      UTOPDF
     C                   END
     C                   END
     C                   END
     C*
     C*
     C                   Z-ADD     UUBELØ        FABELV
     C                   MOVE      'FRA'         FAVK
     C                   MOVE      TRFRAV        FAVAL
     C                   MOVE      TRKDFF        FASK
     C                   MOVE      TRMVA         FAKDM
     C                   MOVE      'M'           FAKDA
     C*
     C*
     C* BEREGNET FRAKT
     C                   Z-ADD     UUBELØ        FABELN
     C*
     C     TRSLAG        IFEQ      'HO'
     C                   MOVE      *ZEROS        FAAVDR
     C                   ELSE
     C                   MOVE      'I'           FASK
     C                   Z-ADD     TRAVD0        FAAVDR
     C                   END
     C                   Z-ADD     UAVNR         FAAGRN
     C                   MOVE      *ZEROS        FAEXRA
     C                   MOVE      *ZEROS        FATAXA
     C                   MOVE      *ZEROS        FAAMOU
     C                   MOVE      *BLANKS       FAMADE
     C                   MOVE      *BLANKS       FACURI
     C                   MOVE      *BLANKS       FACD11
     C                   MOVE      *BLANKS       FACD12
     C                   MOVE      *BLANKS       FACD13
     C                   MOVE      *BLANKS       FACD21
     C                   MOVE      *BLANKS       FACD22
     C                   MOVE      *BLANKS       FACD23
     C                   MOVE      *BLANKS       FACD31
     C                   MOVE      *BLANKS       FACD32
     C                   MOVE      *BLANKS       FACU33
     C  N33              EXSR      DECI
     C  N33              UPDATE    FAKTR
     C     FABELV        IFNE      *ZEROS
     C   33              EXSR      DECI
     C   33              EXCEPT    NYFAKU
     C                   END
     C*
     C     UTOPDF        ENDSR
     C*
     C***********************************************
     C     DECI          BEGSR
     C***********************************************
     C* TEST FIRMS NUMBER OF DECIMALS
     C                   READ      FIRM                                   35
     C* NO DECIMALS
     C     FIDECI        IFEQ      0
     C                   Z-ADD(H)  FABELN        FABEL0           11 0
     C                   Z-ADD     FABEL0        FABELN
     C                   Z-ADD(H)  FABELU        FABEL0           11 0
     C                   Z-ADD     FABEL0        FABELU
     C                   ELSE
     C* 1 DECIMAL
     C     FIDECI        IFEQ      1
     C                   Z-ADD(H)  FABELN        FABEL1           12 1
     C                   Z-ADD     FABEL1        FABELN
     C                   Z-ADD(H)  FABELU        FABEL1           12 1
     C                   Z-ADD     FABEL1        FABELU
     C                   END
     C                   END
     C*
     C                   ENDSR
     C*
     OFAKTR     EADD         NYFAKU
     O                       FA01
     O                       FALI
     O                       FAAVD
     O                       FAOPD
     O                       FASK
     O                       FAVK
     O                       FAVT
     O                       FAVAL
     O                       FABELV
     O                       FAKDM
     O                       FABELN
     O                       FAKDA
     O                       FAAVDR
