/* N01     FÅTT MED CVP1 */
/* N02     NY PAR SYFA37 */
/* N03     SKJERM=X XLS  */
/*           PGM        PARM(&PRT &A4 &IN01 &UFAKT &WSSAML &LAS &STR +
                          &KOPI &PTY &HOLD &SAVE &EPOST)   */
             PGM        PARM(&BPARM)
/*N03*/      DCL        VAR(&FILE) TYPE(*CHAR) LEN(10) +
                          VALUE('SYFA37XL')
/*N03*/      DCL        VAR(&MBR) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DUPP) TYPE(*CHAR) LEN(1)
             DCL        VAR(&BPARM) TYPE(*CHAR) LEN(123)
             DCL        VAR(&SKJERM) TYPE(*CHAR) LEN(1)
             DCL        VAR(&EPOST) TYPE(*CHAR) LEN(70)
             DCL        VAR(&EMNE) TYPE(*CHAR) LEN(40) +
                          VALUE('UFAKTURERTE SENDINGER PÅ EPOST')
             DCL        VAR(&PDF) TYPE(*CHAR) LEN(4) VALUE('*YES')
             DCL        VAR(&QUSER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QJOB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QNBR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&F1) TYPE(*CHAR) LEN(10) +
                          VALUE('SYFA37PF')
             DCL        VAR(&F2) TYPE(*CHAR) LEN(10) +
                          VALUE('SYFA37PS')
/*N03*/      DCL        VAR(&CVPX) TYPE(*CHAR) LEN(70) +
                          VALUE('Purring ufakturerte oppdrag')
             DCL        VAR(&CVPN) TYPE(*CHAR) LEN(70)
             DCL        VAR(&CVP1) TYPE(*CHAR) LEN(70)
             DCL        VAR(&CVP2) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP3) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP4) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP5) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP6) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP7) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP8) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP9) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP) TYPE(*CHAR) LEN(1) VALUE('J')
             DCL        VAR(&HOLD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&CPI) TYPE(*CHAR) LEN(2) VALUE('10')
             DCL        VAR(&SAVE) TYPE(*CHAR) LEN(4)
             DCL        VAR(&STR) TYPE(*CHAR) LEN(5)
             DCL        VAR(&LAS) TYPE(*CHAR) LEN(10)
             DCL        VAR(&KOPI) TYPE(*CHAR) LEN(2)
             DCL        VAR(&UKOPI) TYPE(*CHAR) LEN(2)
             DCL        VAR(&PTY) TYPE(*CHAR) LEN(10)
             DCL        VAR(&UNIK) TYPE(*CHAR) LEN(7) /* Unikkode +
                          til register SORT. */
             DCL        VAR(&UNIK2) TYPE(*CHAR) LEN(6)
             DCL        VAR(&IN01) TYPE(*CHAR) LEN(1) /* Hvis &in01 +
                          på, betyr det avslutt program fra +
                          avdelingsvalg. */
             DCL        VAR(&PRT) TYPE(*CHAR) LEN(10) /* Printernavn. +
                          */
             DCL        VAR(&A4) TYPE(*CHAR) LEN(1) /* Om man velger +
                          A4-format. */
             DCL        VAR(&UFAKT) TYPE(*CHAR) LEN(1)  /* +
                          &UFAKT = 'J'betyr at purrer på ufakturerte +
                          oppdrag ellers ufortollede oppdrag. */
             DCL        VAR(&WSSAML) TYPE(*CHAR) LEN(1)
             DCL        VAR(&WSSAM) TYPE(*CHAR) LEN(1)
    /* */
             CHGVAR     VAR(&PRT) VALUE(%SST(&BPARM 1 10))
             CHGVAR     VAR(&A4) VALUE(%SST(&BPARM 11 1))
             CHGVAR     VAR(&IN01) VALUE(%SST(&BPARM 12 1))
             CHGVAR     VAR(&UFAKT) VALUE(%SST(&BPARM 13 1))
             CHGVAR     VAR(&WSSAML) VALUE(%SST(&BPARM 14 1))
             CHGVAR     VAR(&LAS) VALUE(%SST(&BPARM 15 10))
             CHGVAR     VAR(&STR) VALUE(%SST(&BPARM 25 5))
             CHGVAR     VAR(&KOPI) VALUE(%SST(&BPARM 30 2))
             CHGVAR     VAR(&PTY) VALUE(%SST(&BPARM 32 10))
             CHGVAR     VAR(&HOLD) VALUE(%SST(&BPARM 42 4))
             CHGVAR     VAR(&SAVE) VALUE(%SST(&BPARM 46 4))
             CHGVAR     VAR(&EPOST) VALUE(%SST(&BPARM 50 70))
             CHGVAR     VAR(&SKJERM) VALUE(%SST(&BPARM 120 1))
             CHGVAR     VAR(&WSSAM) VALUE(%SST(&BPARM 121 1))
             CHGVAR     VAR(&DUPP) VALUE(%SST(&BPARM 122 1))
             RTVJOBA    JOB(&QJOB) USER(&QUSER) NBR(&QNBR)
             CHGVAR     VAR(&UKOPI) VALUE(&KOPI)
             IF         COND(&LAS = 'A') THEN(DO)
             CHGVAR     VAR(&UKOPI) VALUE(1)
             ENDDO
             IF         COND(&A4 = 'J') THEN(DO)
             OVRPRTF    FILE(SYFA37PF) PAGESIZE(72 120) CPI(15) +
                          OVRFLW(70) OUTQ(&PRT) FORMTYPE(&PTY) +
                          COPIES(&UKOPI) HOLD(&HOLD) SAVE(&SAVE)
/*N10*/      OVRPRTF    FILE(SYFA37PS) PAGESIZE(72 120) CPI(15) +
                          OVRFLW(72) OUTQ(&PRT) FORMTYPE(&PTY) +
                          COPIES(&UKOPI) HOLD(&HOLD) SAVE(&SAVE)

                        ENDDO
             ELSE       CMD(DO)
             IF         COND(&LAS = 'J') THEN(CHGVAR VAR(&CPI) +
                          VALUE('12'))
             IF         COND(&SKJERM = 'J') THEN(CHGVAR VAR(&HOLD) +
                          VALUE('*YES'))
/*N03*/      IF         COND(&SKJERM = 'X') THEN(CHGVAR VAR(&HOLD) +
                          VALUE('*YES'))
/*N03*/      IF         COND(&SKJERM = 'X') THEN(CHGVAR VAR(&PRT) +
                          VALUE('OUTMAIL'))
             IF         COND(&EPOST = '                        ') +
                          THEN(OVRPRTF FILE(SYFA37PF) PAGESIZE(48 +
                          132) CPI(&CPI) OVRFLW(46) OUTQ(&PRT) +
                          FORMTYPE(&PTY) COPIES(&UKOPI) HOLD(&HOLD) +
                          SAVE(&SAVE))
             IF         COND(&EPOST = '                        ') +
                          THEN(OVRPRTF FILE(SYFA37PS) PAGESIZE(72 +
                          120) CPI(15) OVRFLW(72) OUTQ(&PRT) +
                          FORMTYPE(&PTY) COPIES(&UKOPI) HOLD(&HOLD) +
                          SAVE(&SAVE))
             IF         COND(&EPOST *NE '                        ') +
                          THEN(OVRPRTF FILE(SYFA37PF) PAGESIZE(48 +
                          132) CPI(&CPI) OVRFLW(46) OUTQ(OUTMAIL) +
                          FORMTYPE(&PTY) COPIES(&UKOPI) HOLD(*YES) +
                         SAVE(*NO))
             IF         COND(&EPOST *NE '                        ') +
                    THEN(OVRPRTF    FILE(SYFA37PS) PAGESIZE(72 120) CPI(15) +
                                       OVRFLW(72) OUTQ(OUTMAIL) FORMTYPE(&PTY) +
                                       COPIES(&UKOPI) HOLD(&HOLD) SAVE(&SAVE))
                        ENDDO
             OVRMSGF    MSGF(QUSERMSG) TOMSGF(SYMSGF)
    /* */
             RTVJOBA    NBR(&UNIK2)
             CHGVAR     VAR(&UNIK) VALUE('W' *CAT &UNIK2)
/*N03*/      CHGVAR     VAR(&MBR) VALUE(&UNIK)
             CLRPFM     FILE(WRKHE) MBR(&UNIK)
             MONMSG     MSGID(CPF3141) EXEC(ADDPFM FILE(WRKHE) +
                          MBR(&UNIK))
             OVRDBF     FILE(WRKHE) TOFILE(WRKHE) MBR(&UNIK) +
                          FRCRATIO(1)
             ADDLFM     FILE(WRKHE1) MBR(&UNIK) DTAMBRS((WRKHE +
                          (&UNIK)))
             MONMSG     MSGID(CPF0000)
             OVRDBF     FILE(WRKHE1) TOFILE(WRKHE1) MBR(&UNIK)  +
                          FRCRATIO(1)
             ADDLFM     FILE(WRKHE2) MBR(&UNIK) DTAMBRS((WRKHE +
                          (&UNIK)))
             MONMSG     MSGID(CPF0000)
             OVRDBF     FILE(WRKHE2) TOFILE(WRKHE2) MBR(&UNIK) +
                          FRCRATIO(1)
/*  N03   NY FIL FOR EXCEL  */
             CLRPFM     FILE(SYFA37XL) MBR(&UNIK)
             MONMSG     MSGID(CPF3141) EXEC(ADDPFM FILE(SYFA37XL) +
                          MBR(&UNIK))
             OVRDBF     FILE(SYFA37XL) TOFILE(SYFA37XL) MBR(&UNIK) +
                          FRCRATIO(1)
    /* */
/* S01       CALL PGM(SYFA37) PARM(&WSSAML &LAS &STR &KOPI|  */
/* S02       CALL PGM(SYFA37) PARM(&WSSAML &LAS &STR &KOPI &CVP1 &WSSAM) */
/* S03       CALL PGM(SYFA37) PARM(&WSSAML &LAS &STR &KOPI &CVP1 &CVPN +
                              &WSSAM &DUPP)  */
/* N03 */    CALL PGM(SYFA37) PARM(&WSSAML &LAS &STR &KOPI &CVP1 &CVPN +
                              &WSSAM &DUPP &SKJERM)
             RMVM       FILE(WRKHE2) MBR(&UNIK)
             RMVM       FILE(WRKHE1) MBR(&UNIK)
             RMVM       FILE(WRKHE) MBR(&UNIK)
             IF         COND(&SKJERM = 'J') THEN(DO)
             DSPSPLF    FILE(SYFA37PF) SPLNBR(*LAST)
             MONMSG     MSGID(CPF0000)
             DLTSPLF    FILE(SYFA37PF) SPLNBR(*LAST)
             MONMSG     MSGID(CPF0000)
             RETURN
             ENDDO
             IF         COND(&EPOST = '                        ') +
                          THEN(RETURN)
/*N03*/      IF         COND(&SKJERM = 'J') +
                          THEN(DO)
             SNDPGMMSG  MSG('Liste ufakturerte oppdrag er sendt som +
                          epost til:' *BCAT &EPOST) TOUSR(&QUSER) +
                          MSGTYPE(*INFO)
             CALL       PGM(FAXEPMMCL) PARM(&QUSER &QNBR &QJOB &F1 +
                          &EPOST +
                          &CVP1 &CVP2 &CVP3 &CVP4 &CVP5 +
                          &CVP6 &CVP7 &CVP8 &CVP9 &PDF)
             CALL       PGM(FAXEPMMCL) PARM(&QUSER &QNBR &QJOB &F2 +
                          &EPOST +
                          &CVPN &CVP2 &CVP3 &CVP4 &CVP5 +
                          &CVP6 &CVP7 &CVP8 &CVP9 &PDF)
/*N03*/      ENDDO
/*N03*/      IF         COND(&SKJERM = 'X') +
                          THEN(DO)
/*N03*/      CALL       PGM(SYGE55XCLB) PARM(&FILE &MBR  &EPOST &CVPX)
/*N03*/      ENDDO
SLUTT:       ENDPGM
