/* *********************************************************************   */
/*       * RETTINGER I DETTE PROGRAM:                                      */
/* PTFnr:*Sek Sig Vers  Beskrivelse..........................              */
/* """"""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""    */
/*       * 01 JOV PTV11 bruk TOSTMF('xxx') WSCST(*PDF) for PDF-konvertering*/
/*       *              RYDDET GAMMELT TJAFS                               */
/* *********************************************************************   */
             PGM        PARM(&UNIK &TYPE)
             DCL        VAR(&UNIK) TYPE(*CHAR) LEN(9)
             DCL        VAR(&TYPE) TYPE(*CHAR) LEN(5)
             DCL        VAR(&LIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&MBR) TYPE(*CHAR) LEN(10)
             DCL        VAR(&NBR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&EMNE)   TYPE(*CHAR) LEN(70)
             DCL        VAR(&AVNA)   TYPE(*CHAR) LEN(50)
             DCL        VAR(&AVAD)   TYPE(*CHAR) LEN(50)
             DCL        VAR(&INTAD1) TYPE(*CHAR) LEN(50)
             DCL        VAR(&INTAD2) TYPE(*CHAR) LEN(50)
             DCL        VAR(&INTAD3) TYPE(*CHAR) LEN(50)
             DCL        VAR(&INTAD4) TYPE(*CHAR) LEN(50)
             DCL        VAR(&INTAD5) TYPE(*CHAR) LEN(50)
             DCL        VAR(&OK) TYPE(*CHAR) LEN(1)
             DCL        VAR(&USER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&JOB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&STMF) TYPE(*CHAR) LEN(50)

             RTVDTAARA  DTAARA(FIRMDT (141 10)) RTNVAR(&LIB)
             RTVJOBA    JOB(&JOB) USER(&USER) NBR(&NBR)
             CHGVAR     VAR(&MBR) VALUE('W' *CAT &NBR)

             ADDPFM     FILE(ARKSRC160) MBR(&MBR)
             MONMSG     MSGID(CPF0000)
             CLRPFM     FILE(ARKSRC160) MBR(&MBR)
             OVRDBF     FILE(ARKSRC160) TOFILE(&LIB/ARKSRC160) +
                          MBR(&MBR)

             CALL       PGM(ESOP11R) PARM(&UNIK &TYPE &EMNE &AVNA +
                          &AVAD &INTAD1 &INTAD2 &INTAD3 &INTAD4 +
                          &INTAD5 &OK)

             IF         COND(&TYPE = 'WEBPR') THEN(DO)
             CHGVAR     VAR(&STMF) VALUE('/syspeddev/temp/BOOKING' +
                          *CAT &UNIK *CAT '.pdf')
             RMVLNK     OBJLNK(&STMF)
             MONMSG     MSGID(CPF0000)
             OVRPRTF    FILE(LISTE) DEV(FAX3812) DEVTYPE(*AFPDS) +
                          PAGESIZE(70 85) LPI(6) CPI(10) OVRFLW(70) +
                          OUTQ(SYCGIOUTQ) FORMTYPE(*STD) HOLD(*YES) +
                          SPLFOWN(*JOB) TOSTMF(&STMF) WSCST(*PDF)
             CALL       PGM(ESOP11R2)
             DLTSPLF    FILE(LISTE) JOB(&NBR/&USER/&JOB) +
                          SPLNBR(*LAST)
             MONMSG     MSGID(CPF0000)
             ENDDO

             ELSE       CMD(DO)

             IF         COND(&OK = 'J') THEN(DO)
             ADDLIBLE   LIB(MMAIL)
             MONMSG     MSGID(CPF0000)

             EMLMSG     SUBJECT(&EMNE) FROMNAME(&AVNA) +
                          FROMADDR(&AVAD) TO(&INTAD1/&INTAD1/*TO) +
                          TXTF(&LIB/ARKSRC160) TXTMBR(&MBR) EDTMBR(*NO)
             IF         COND(&INTAD2 *NE ' ') THEN(DO)
             EMLMSG     SUBJECT(&EMNE) FROMNAME(&AVNA) +
                          FROMADDR(&AVAD) TO(&INTAD2/&INTAD2/*TO) +
                          TXTF(&LIB/ARKSRC160) TXTMBR(&MBR) EDTMBR(*NO)
             ENDDO
             IF         COND(&INTAD3 *NE ' ') THEN(DO)
             EMLMSG     SUBJECT(&EMNE) FROMNAME(&AVNA) +
                          FROMADDR(&AVAD) TO(&INTAD3/&INTAD3/*TO) +
                          TXTF(&LIB/ARKSRC160) TXTMBR(&MBR) EDTMBR(*NO)
             ENDDO
             IF         COND(&INTAD4 *NE ' ') THEN(DO)
             EMLMSG     SUBJECT(&EMNE) FROMNAME(&AVNA) +
                          FROMADDR(&AVAD) TO(&INTAD4/&INTAD4/*TO) +
                          TXTF(&LIB/ARKSRC160) TXTMBR(&MBR) EDTMBR(*NO)
             ENDDO
             IF         COND(&INTAD5 *NE ' ') THEN(DO)
             EMLMSG     SUBJECT(&EMNE) FROMNAME(&AVNA) +
                          FROMADDR(&AVAD) TO(&INTAD5/&INTAD5/*TO) +
                          TXTF(&LIB/ARKSRC160) TXTMBR(&MBR) EDTMBR(*NO)
             ENDDO

             RMVLIBLE   LIB(MMAIL)
             ENDDO

             ENDDO

             RMVM       FILE(ARKSRC160) MBR(&MBR)
             MONMSG     MSGID(CPF0000)

             ENDPGM
