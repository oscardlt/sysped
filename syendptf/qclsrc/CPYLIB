/*N01 - SKAPER FIL FILNVNP MED *ATR (IKEK *BAS) FOR Å FÅ TILGANG TIL FRCRATIO */
/*N01 - VARIABLER ATFILE, ATLIB, ATNOMB, ATDTAT  ENDRET TIL PH...UTEN MERKING */
/*N02 - XMLRCVF OG XMLRCAF, INGEN MERKING */
/*N03 - INGEN MERKING:      EDIRE_, EDISE_, EDIRE1K_, EDISE1K OG */
/*N04 - INGEN MERKING:      IKKE KOPIERE ARBEIDSFIL SYGE07W  */
/*N05 - ENDRING 02 FJERNE                 */
/*N06 - FLYTT PRIK,,,                     */
/*N07 - SPESIELL KONVERTERINGSPROGRAMMER FOR SADV OG SAEV I V12 */
/*      KODTS8NY, KODTVANY, PONRNNY, SADSDNY, TARINY, EUNB, EUNH */
             PGM        PARM(&FRALIB &TILLIB &TOMME &BEHAN)
             DCL        VAR(&FRALIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&TILLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PROFIL) TYPE(*CHAR) LEN(10)
             DCL        VAR(&FORSTE) TYPE(*CHAR) LEN(1)
             DCL        VAR(&FINNES) TYPE(*CHAR) LEN(1)
             DCL        VAR(&TOMME)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&BEHAN)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&MESS)   TYPE(*CHAR) LEN(20)
             DCL        VAR(&EDIDAT) TYPE(*CHAR) LEN(256)
             DCL        VAR(&BACK) TYPE(*CHAR) LEN(256)
/*S07        DCL        VAR(&TESTUSER) TYPE(*CHAR) LEN(256)   */
/*S01        DCLF       FILE(*LIBL/FILNVNP) RCDFMT(QWHFDBAS)  */
/*N01*/      DCLF       FILE(*LIBL/FILNVNP) RCDFMT(QWHFDPHY)

/*S07        CALL       PGM(V11001C) PARM(&FRALIB)  */
             IF         COND(&BEHAN = 'J') THEN(DO)
             CALL       PGM(CPYLIBS) PARM(&FRALIB) /* Spesialer +
                          foran cpy. */
             ENDDO

             OVRDBF     FILE(FILNVNP) TOFILE(&TILLIB/FILNVNP)

             CHGJOB     JOB(*) LOG(4 00 *SECLVL) LOGCLPGM(*YES)

             CHKOBJ     OBJ(&TILLIB/PROGRESS) OBJTYPE(*DTAARA)
             MONMSG     MSGID(CPF9801 CPF9810) EXEC(CHGVAR +
                          VAR(&FORSTE) VALUE('J')) /* 'FORSTE får +
                          verdien 'J' hvis PROGRESS ikke finnes fra +
                          før av' */

             IF         COND(&FORSTE = 'J') THEN(DO)
             CRTDTAARA  DTAARA(&TILLIB/PROGRESS) TYPE(*CHAR) LEN(20) +
                          VALUE(' ') TEXT('Inneholder filnavn på +
                          siste OK kopierte fil')
             SNDPGMMSG  MSGID(CPF9898) MSGF(QCPFMSG) MSGDTA('Lager +
                          filoversikt i FILNVNP i til-bibliotek') +
                          TOPGMQ(*EXT) MSGTYPE(*STATUS)

/*S01        DSPFD      FILE(&FRALIB/*ALL) TYPE(*BASATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(&TILLIB/FILNVNP)   */
/*N01*/      DSPFD      FILE(&FRALIB/*ALL) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(&TILLIB/FILNVNP)
             SNDPGMMSG  MSGID(CPF9801) MSGF(QCPFMSG) TOPGMQ(*EXT) +
                          MSGTYPE(*STATUS) /* Blanker ut melding på +
                          skjerm med "tom" melding */
             ENDDO
LOOP1:
             RCVF       DEV(*FILE) RCDFMT(*FILE)
             MONMSG     MSGID(CPF0864) EXEC(GOTO CMDLBL(SLUTT))

             IF         COND(&FORSTE *NE 'J') THEN(DO)
             RTVDTAARA  DTAARA(&TILLIB/PROGRESS (1 10)) RTNVAR(&PROFIL)
             IF         COND(&PHFILE *LE &PROFIL) THEN(GOTO +
                          CMDLBL(LOOP1))
             ENDDO

             IF         COND(&PHNOMB *EQ 0) THEN(GOTO CMDLBL(LOOP1)) +
                          /* Kopierer ikke filen hvis antall +
                          komponenter er null */

             IF         COND(&PHDTAT *NE 'D') THEN(GOTO +
                          CMDLBL(LOOP1)) /* Kopierer bare +
                          datafiler, ikke src filer             */

             CHGVAR     VAR(&FINNES) VALUE('J')
             CHKOBJ     OBJ(&TILLIB/&PHFILE) OBJTYPE(*FILE) +
                          MBR(*NONE) /* Hvis fil ikke finnes i +
                          til-bibliotek opprettes den, hvis finnes +
                          (som den bør gjøre ved normal +
                          oppgradering) kopieres filen med +
                          *replace, - først forsøkes uten FMTOPT - +
                          dersom nødvendig sett FMTOPT(*MAP/*DROP) +
                          (for å kopiere hurtigst mulig) */

             MONMSG     MSGID(CPF9801) EXEC(CHGVAR VAR(&FINNES) +
                          VALUE('N'))
/*S01 OVRDBF FUNKER KUN I PROGRAM  */
/*S01        OVRDBF     FILE(&ATFILE) FRCRATIO(*NONE) */

             IF         COND(&PHFILE *EQ 'EDIRE') THEN(DO)
             DLTF       FILE(&TILLIB/EDIRE)
             MONMSG     MSGID(CPF0000)
             MOVOBJ     OBJ(&FRALIB/EDIRE) OBJTYPE(*FILE) +
                          TOLIB(&TILLIB)
             GOTO       CMDLBL(OPDDTAARA)
             ENDDO
             IF         COND(&PHFILE *EQ 'EDIRE_') THEN(DO)
             DLTF       FILE(&TILLIB/EDIRE_)
             MONMSG     MSGID(CPF0000)
             MOVOBJ     OBJ(&FRALIB/EDIRE_) OBJTYPE(*FILE) +
                          TOLIB(&TILLIB)
             GOTO       CMDLBL(OPDDTAARA)
             ENDDO
             IF         COND(&PHFILE *EQ 'EDISE') THEN(DO)
             DLTF       FILE(&TILLIB/EDISE)
             MONMSG     MSGID(CPF0000)
             MOVOBJ     OBJ(&FRALIB/EDISE) OBJTYPE(*FILE) +
                          TOLIB(&TILLIB)
             GOTO       CMDLBL(OPDDTAARA)
             ENDDO
             IF         COND(&PHFILE *EQ 'EDISE_') THEN(DO)
             DLTF       FILE(&TILLIB/EDISE_)
             MONMSG     MSGID(CPF0000)
             MOVOBJ     OBJ(&FRALIB/EDISE_) OBJTYPE(*FILE) +
                          TOLIB(&TILLIB)
             GOTO       CMDLBL(OPDDTAARA)
             ENDDO
             IF         COND(&PHFILE *EQ 'EDIRE1K') THEN(DO)
             DLTF       FILE(&TILLIB/EDIRE1K)
             MONMSG     MSGID(CPF0000)
             MOVOBJ     OBJ(&FRALIB/EDIRE1K) OBJTYPE(*FILE) +
                          TOLIB(&TILLIB)
             GOTO       CMDLBL(OPDDTAARA)
             ENDDO
             IF         COND(&PHFILE *EQ 'EDIRE1K_') THEN(DO)
             DLTF       FILE(&TILLIB/EDIRE1K_)
             MONMSG     MSGID(CPF0000)
             MOVOBJ     OBJ(&FRALIB/EDIRE1K_) OBJTYPE(*FILE) +
                          TOLIB(&TILLIB)
             GOTO       CMDLBL(OPDDTAARA)
             ENDDO
             IF         COND(&PHFILE *EQ 'EDISE1K') THEN(DO)
             DLTF       FILE(&TILLIB/EDISE1K)
             MONMSG     MSGID(CPF0000)
             MOVOBJ     OBJ(&FRALIB/EDISE1K) OBJTYPE(*FILE) +
                          TOLIB(&TILLIB)
             GOTO       CMDLBL(OPDDTAARA)
             ENDDO
             IF         COND(&PHFILE *EQ 'EDISE1K_') THEN(DO)
             DLTF       FILE(&TILLIB/EDISE1K_)
             MONMSG     MSGID(CPF0000)
             MOVOBJ     OBJ(&FRALIB/EDISE1K_) OBJTYPE(*FILE) +
                          TOLIB(&TILLIB)
             GOTO       CMDLBL(OPDDTAARA)
             ENDDO
             IF         COND(&PHFILE *EQ 'EDI.BACK') THEN(DO)
             DLTF       FILE(&TILLIB/EDI.BACK)
             MONMSG     MSGID(CPF0000)
             MOVOBJ     OBJ(&FRALIB/EDI.BACK) OBJTYPE(*FILE) +
                          TOLIB(&TILLIB)
             GOTO       CMDLBL(OPDDTAARA)
             ENDDO
             IF         COND(&PHFILE *EQ 'EDI.BACK1K') THEN(DO)
             DLTF       FILE(&TILLIB/EDI.BACK1K)
             MONMSG     MSGID(CPF0000)
             MOVOBJ     OBJ(&FRALIB/EDI.BACK1K) OBJTYPE(*FILE) +
                          TOLIB(&TILLIB)
             GOTO       CMDLBL(OPDDTAARA)
             ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'PRLK') THEN(DO)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'PRLS') THEN(DO)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'PRTR') THEN(DO)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'PRTS') THEN(DO)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'PRBFS') THEN(DO)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'PRBGE') THEN(DO)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'PRBLK') THEN(DO)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'PRBLS') THEN(DO)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'PRBTR') THEN(DO)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'PRBTS') THEN(DO)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'SADV') THEN(DO)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'SAEV') THEN(DO)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'XMLRCVF') THEN(DO)
/*N07*/      CLRPFM     FILE(&TILLIB/XMLRCVF)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'XMLRCAF') THEN(DO)
/*N07*/      CLRPFM     FILE(&TILLIB/XMLRCAF)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*N07*/      IF         COND(&PHFILE *EQ 'XMLRCLF') THEN(DO)
/*N07*/      CLRPFM     FILE(&TILLIB/XMLRCLF)
/*N07*/      GOTO       CMDLBL(OPDDTAARA)
/*N07*/      ENDDO
/*S05        IF         COND(&PHFILE *EQ 'XMLRCVF') THEN(DO)    */
/*S05        DLTF       FILE(&TILLIB/XMLRCVL01)                 */
/*S05        DLTF       FILE(&TILLIB/XMLRCVF)                   */
/*S05        MONMSG     MSGID(CPF0000)                          */
/*S05        MOVOBJ     OBJ(&FRALIB/XMLRCVF) OBJTYPE(*FILE) +   */
/*S05                     TOLIB(&TILLIB)                        */
/*S05        MOVOBJ     OBJ(&FRALIB/XMLRCVL01) OBJTYPE(*FILE) + */
/*S05                     TOLIB(&TILLIB)                        */
/*S05        GOTO       CMDLBL(OPDDTAARA)                       */
/*S05        ENDDO                                              */
/*S05        IF         COND(&PHFILE *EQ 'XMLRCAF') THEN(DO)    */
/*S05        DLTF       FILE(&TILLIB/XMLRCAF)                   */
/*S05        MONMSG     MSGID(CPF0000)                          */
/*S05        MOVOBJ     OBJ(&FRALIB/XMLRCAF) OBJTYPE(*FILE) +   */
/*S05                     TOLIB(&TILLIB)                        */
/*S05        GOTO       CMDLBL(OPDDTAARA)                       */
/*S05        ENDDO                                              */
             IF         COND(&PHFILE *EQ 'SYGE07W') THEN(DO)
             GOTO       CMDLBL(OPDDTAARA)
             ENDDO

             IF         COND(&PHFILE *EQ 'KODTS8NY') THEN(DO)
             RNMM       FILE(&FRALIB/KODTS8NY) MBR(KODTS8) +
                          NEWMBR(KODTS8NY)
             MONMSG     MSGID(CPF9815 CPF3178)
             ENDDO
             IF         COND(&PHFILE *EQ 'KODTVANY') THEN(DO)
             RNMM       FILE(&FRALIB/KODTVANY) MBR(KODTVA) +
                          NEWMBR(KODTVANY)
             MONMSG     MSGID(CPF9815 CPF3178)
             ENDDO
             IF         COND(&PHFILE *EQ 'PONRNNY') THEN(DO)
             RNMM       FILE(&FRALIB/PONRNNY) MBR(PONRN) +
                          NEWMBR(PONRNNY)
             MONMSG     MSGID(CPF9815 CPF3178)
             ENDDO
             IF         COND(&PHFILE *EQ 'SADSDNY') THEN(DO)
             RNMM       FILE(&FRALIB/SADSDNY) MBR(SADSD) +
                          NEWMBR(SADSDNY)
             MONMSG     MSGID(CPF9815 CPF3178)
             ENDDO
             IF         COND(&PHFILE *EQ 'TARINY') THEN(DO)
             RNMM       FILE(&FRALIB/TARINY) MBR(TARI) NEWMBR(TARINY)
             MONMSG     MSGID(CPF9815 CPF3178)
             ENDDO
             IF         COND(&PHFILE *EQ 'EUNB') THEN(DO)
             RNMM       FILE(&FRALIB/EUNB) MBR(EUNB902) NEWMBR(EUNB)
             MONMSG     MSGID(CPF9815 CPF3178)
             ENDDO
             IF         COND(&PHFILE *EQ 'EUNH') THEN(DO)
             RNMM       FILE(&FRALIB/EUNH) MBR(EUNH902) NEWMBR(EUNH)
             MONMSG     MSGID(CPF9815 CPF3178)
             ENDDO

             IF         COND(&PHFILE *EQ 'FAXQLOG') THEN(DO)
             MOVOBJ     OBJ(&FRALIB/FAXQLOG) OBJTYPE(*FILE) +
                          TOLIB(&TILLIB)
             MONMSG     MSGID(CPF2105)
             ENDDO
             IF         COND(&PHFILE *EQ 'FAXQLOG1') THEN(DO)
             MOVOBJ     OBJ(&FRALIB/FAXQLOG1) OBJTYPE(*FILE) +
                          TOLIB(&TILLIB)
             MONMSG     MSGID(CPF2105)
             ENDDO

             IF         COND(&FINNES *EQ 'J') THEN(DO)
/* SETT FRCRATIO TIL *NONE FOR RASKERE KOPIERING*/
/*N01*/      IF         COND(&PHFRCR *NE 0) THEN(DO)
             CHGPF      FILE(&TILLIB/&PHFILE) FRCRATIO(*NONE)
             MONMSG     MSGID(CPF0000)
             ENDDO
/*N07*/      CHGPF      FILE(&TILLIB/&PHFILE) FRCRATIO(*NONE)
/*N07*/      MONMSG     MSGID(CPF0000)
             CPYF       FROMFILE(&FRALIB/&PHFILE) +
                          TOFILE(&TILLIB/&PHFILE) FROMMBR(*ALL) +
                          TOMBR(*FROMMBR) MBROPT(*REPLACE) FROMRCD(1)
/*DERSOM FMTOPT *MAP, *DROP ELLER *MAP/*DROP TRENGS VIL DE FØRSTE */
/*TEGN AV MELDINGSTEKSTEN VÆRE 'FMTOPT..'(se CMPDTA)->Ny CPYF     */
/*CPF2869= Kopiering av tomt framember med replace */
/*CPF2817= Div.andre feil,som kan passere */
             MONMSG     MSGID(CPF2962 CPF2965 CPF2969 CPF2869 +
                          CPF2870 CPF2817) EXEC(DO)
             CPYF       FROMFILE(&FRALIB/&PHFILE) +
                          TOFILE(&TILLIB/&PHFILE) FROMMBR(*ALL) +
                          TOMBR(*FROMMBR) MBROPT(*REPLACE) +
                          FMTOPT(*MAP *DROP) FROMRCD(1)
             MONMSG     MSGID(CPF2869 CPF2870 CPF2817) /* Kopiering +
                          av tomt fra-member med replace + diverse +
                          feil i CPF2817 */
             ENDDO
/*N07*/      CHGPF      FILE(&TILLIB/&PHFILE) FRCRATIO(1)
/*N07*/      MONMSG     MSGID(CPF0000)
             ENDDO
             ELSE       CMD(DO)
             CPYF       FROMFILE(&FRALIB/&PHFILE) +
                          TOFILE(&TILLIB/&PHFILE) FROMMBR(*ALL) +
                          TOMBR(*FROMMBR) MBROPT(*ADD) CRTFILE(*YES) +
                          FROMRCD(1)
             MONMSG     MSGID(CPF2869 CPF2817) /* Kopiering av tomt +
                          fra-member med replace + diverse feil i +
                          CPF2817 */
             ENDDO

             IF         COND(&TOMME = 'J') THEN(DO)
             CLRPFM     FILE(&FRALIB/&PHFILE) MBR(*FIRST)
             MONMSG     MSGID(CPF3133) /* Filen inneholder ingen +
                          komponenter */
             CHGVAR     VAR(&MESS) VALUE(&PHFILE *CAT &FRALIB)
             IF         COND(&PHNOMB *GT 1) THEN(SNDUSRMSG +
                          MSGID(BBA0050) MSGF(SYMSGF) +
                          MSGDTA(&MESS) MSGTYPE(*INFO) +
                          TOUSR(*REQUESTER))
             ENDDO

 OPDDTAARA:
             CHGDTAARA  DTAARA(&TILLIB/PROGRESS (1 10)) VALUE(&PHFILE)
             CHGDTAARA  DTAARA(&TILLIB/PROGRESS (11 10)) VALUE(&TILLIB)

/*N01*/      IF         COND(&PHFRCR *NE 0) THEN(DO)
             CHGPF      FILE(&TILLIB/&PHFILE) FRCRATIO(&PHFRCR)
             MONMSG     MSGID(CPF0000)
             ENDDO

             GOTO       CMDLBL(LOOP1)

SLUTT:
        /* DIVERSE TING SOM SKAL UTFØRES ETTER KONVERTERING    */

             IF         COND(&BEHAN = 'J') THEN(DO)
             CALL       PGM(CPYLIBE) PARM(&FRALIB &TILLIB) /* +
                          Spesialer ETTER cpy. */
        /* FLYTT DATA FRA EDIDTA*/
/*S07        RTVDTAARA  DTAARA(&FRALIB/EDIDTA) RTNVAR(&EDIDAT)     */
/*S07        MONMSG     MSGID(CFP0000)                             */
/*S07        CHGDTAARA  DTAARA(&TILLIB/EDIDTA) VALUE(&EDIDAT)      */
/*S07        MONMSG     MSGID(CFP0000)                             */
        /* FLYTT DATA FRA BACK */
/*S07        RTVDTAARA  DTAARA(&FRALIB/BACK) RTNVAR(&BACK)         */
/*S07        MONMSG     MSGID(CFP0000)                             */
/*S07        CHGDTAARA  DTAARA(&TILLIB/BACK) VALUE(&BACK)          */
/*S07        MONMSG     MSGID(CFP0000)                             */
             ENDDO

/*S07        CALL       PGM(V11FKC01)    */
/*N07*/      CALL       PGM(V12FKC01) PARM(&TILLIB)
             RCLRSC
ENDPGM:
