/* FJERNET OPEN LOGIKK   IKKE MERKET */
/* TATT BORT DATO FRA TIL            */
             PGM        PARM(&PARM)
     /*___________________*/
     /* Beskriv variabler */
     /*"""""""""""""""""""*/
             DCL        VAR(&EMNE) TYPE(*CHAR) LEN(70) +
                          VALUE('Tollagerregnskap sendt som epost +
                          (CSV-fil til EXCEL)')
             DCL        VAR(&EMFAX) TYPE(*CHAR) LEN(70) +
                          VALUE('Tollagerregnskap sendt som epost +
                          I PDF-FORMAT')
             DCL        VAR(&PARM) TYPE(*CHAR) LEN(160)
             DCL        VAR(&PS) TYPE(*CHAR) LEN(1)
             DCL        VAR(&CVP1) TYPE(*CHAR) LEN(40) +
                          VALUE('Tollagerregnskap')
             DCL        VAR(&CVP1) TYPE(*CHAR) LEN(40) +
                          VALUE('Tollagerregnskap')
             DCL        VAR(&CVP2) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP3) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP4) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP5) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP6) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP7) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP8) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP9) TYPE(*CHAR) LEN(40)
             DCL        VAR(&PDF) TYPE(*CHAR) LEN(4) VALUE('*YES')
             DCL        VAR(&FILEN) TYPE(*CHAR) LEN(10) +
                          VALUE('SYIM03P')
             DCL        VAR(&QUSER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QJOB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QNBR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&FILE) TYPE(*CHAR) LEN(10) VALUE('SYIM03F')
             DCL        VAR(&UNIK) TYPE(*CHAR) LEN(10)
             DCL        VAR(&UNIK2) TYPE(*CHAR) LEN(6)
             DCL        VAR(&EPOST) TYPE(*CHAR) LEN(70)
             DCL        VAR(&ZAVDF) TYPE(*DEC) LEN(4 0)
             DCL        VAR(&ZAVDT) TYPE(*DEC) LEN(4 0)
             DCL        VAR(&ZGNF) TYPE(*CHAR) LEN(15)
             DCL        VAR(&ZGNT) TYPE(*CHAR) LEN(15)
/*           DCL        VAR(&ZDTF) TYPE(*DEC) LEN(6 0)     */
/*           DCL        VAR(&ZDTT) TYPE(*DEC) LEN(6 0)     */
             DCL        VAR(&ZOT) TYPE(*CHAR) LEN(20)
             DCL        VAR(&ZST) TYPE(*CHAR) LEN(5)
             DCL        VAR(&ZUNG) TYPE(*CHAR) LEN(1)
             DCL        VAR(&ZDEV) TYPE(*CHAR) LEN(10)
             DCL        VAR(&ZA4) TYPE(*CHAR) LEN(1)
             DCL        VAR(&ZBRUDD) TYPE(*CHAR) LEN(1)
             DCL        VAR(&ZAVF) TYPE(*CHAR) LEN(4)
             DCL        VAR(&ZAVT) TYPE(*CHAR) LEN(4)
/*           DCL        VAR(&ZDF) TYPE(*CHAR) LEN(6)  */
/*           DCL        VAR(&ZDT) TYPE(*CHAR) LEN(6)  */
             DCL        VAR(&BLANK) TYPE(*CHAR) LEN(5) VALUE('     ')
             DCL        VAR(&ZLNRF) TYPE(*CHAR) LEN(1)
             DCL        VAR(&ZLNRT) TYPE(*CHAR) LEN(1)
             RTVJOBA    JOB(&QJOB) USER(&QUSER) NBR(&QNBR)
     /*____________________*/
     /* PAKK OPP PARAMETRE */
     /*""""""""""""""""""""*/
             CHGVAR     VAR(&ZAVF) VALUE(%SST(&PARM 1 4))
             CHGVAR     VAR(&ZAVT) VALUE(%SST(&PARM 5 4))
             CHGVAR     VAR(&ZGNF) VALUE(%SST(&PARM 9 15))
             CHGVAR     VAR(&ZGNT) VALUE(%SST(&PARM 24 15))
/* DATO FRA TIL ER BORTE */
/*           CHGVAR     VAR(&ZDF) VALUE(%SST(&PARM 39 6)) */
/*           CHGVAR     VAR(&ZDT) VALUE(%SST(&PARM 45 6)) */
             CHGVAR     VAR(&ZOT) VALUE(%SST(&PARM 39 20))
             CHGVAR     VAR(&ZST) VALUE(%SST(&PARM 59 5))
             CHGVAR     VAR(&ZUNG) VALUE(%SST(&PARM 64 1))
             CHGVAR     VAR(&ZDEV) VALUE(%SST(&PARM 65 10))
             CHGVAR     VAR(&ZA4) VALUE(%SST(&PARM 75 1))
             CHGVAR     VAR(&ZBRUDD) VALUE(%SST(&PARM 76 1))
             CHGVAR     VAR(&ZLNRF) VALUE(%SST(&PARM 77 1))
             CHGVAR     VAR(&ZLNRT) VALUE(%SST(&PARM 78 1))
             CHGVAR     VAR(&EPOST) VALUE(%SST(&PARM 79 70))
             CHGVAR     VAR(&PS) VALUE(%SST(&PARM 149 1))
             DMPCLPGM
     /*____________________*/
     /* Forandre variabler */
     /*""""""""""""""""""""*/
             CHGVAR     VAR(&ZAVDF) VALUE(&ZAVF)
             CHGVAR     VAR(&ZAVDT) VALUE(&ZAVT)
/*           CHGVAR     VAR(&ZDTF) VALUE(&ZDF)    */
/*           CHGVAR     VAR(&ZDTT) VALUE(&ZDT)    */
    /* */
     /*____________________*/
     /* FINNER UNIK VERDIr */
     /*""""""""""""""""""""*/
             RTVJOBA    NBR(&UNIK2)
             CHGVAR     VAR(&UNIK) VALUE('W' *CAT &UNIK2)
 NYFORS:     DLYJOB     DLY(5)
             RMVM       FILE(SYIM03F) MBR(&UNIK)
             MONMSG     MSGID(CPF0000)
             ADDPFM     FILE(SYIM03F) MBR(&UNIK)
             MONMSG     MSGID(CPF7306) EXEC(GOTO CMDLBL(NYFORS))
             OVRDBF     FILE(SYIM03F) TOFILE(SYIM03F) MBR(&UNIK)
             MONMSG     MSGID(CPF0000)
     /*________________*/
     /* Skriv ut liste */
     /*""""""""""""""""*/
             IF         COND(&EPOST *EQ '                        ') +
                          THEN(DO)
             IF         COND(&ZA4 *EQ 'N') THEN(OVRPRTF +
                          FILE(SYIM03P) PAGESIZE(48 120) CPI(10) +
                          OVRFLW(40) OUTQ(&ZDEV))
             IF         COND(&ZA4 *EQ 'J') THEN(OVRPRTF +
                          FILE(SYIM03P) PAGESIZE(70 120) CPI(15) +
                          OVRFLW(62) OUTQ(&ZDEV))
             ENDDO
             IF         COND(&EPOST *NE '                        ') +
                          THEN(DO)
             IF         COND(&ZA4 *EQ 'N') THEN(OVRPRTF +
                          FILE(SYIM03P) DEVTYPE(*AFPDS) PAGESIZE(48 +
                          120) CPI(10) OVRFLW(40) OUTQ(OUTMAIL))
             IF         COND(&ZA4 *EQ 'J') THEN(OVRPRTF +
                          FILE(SYIM03P) DEVTYPE(*AFPDS) PAGESIZE(70 +
                          120) CPI(15) OVRFLW(62) OUTQ(OUTMAIL))
             ENDDO
             OVRDBF     FILE(HEADFDUM) TOFILE(HEADF)
             CALL       PGM(SYIM03R) PARM(&ZAVDF &ZAVDT &ZGNF &ZGNT +
                          &ZOT +
                          &ZST &ZUNG &ZBRUDD &ZLNRF &ZLNRT &EPOST &PS)
             IF         COND(&EPOST *NE '                        ') +
                          THEN(DO)
             IF         COND(&PS *EQ 'X') THEN(DO)
/*           CALL       PGM(SYGE55CLE) PARM(&FILE &UNIK &EPOST)  */
/*           CALL       PGM(SYGE55CLE) PARM(&FILE &UNIK &EPOST &EMNE &CVP1) */
             CALL       PGM(SYGE55XCL2) PARM(&FILE &UNIK &EPOST &EMNE)
             ENDDO
             IF         COND(&PS *EQ 'P') THEN(DO)
             CALL       PGM(FAXEPMMCL) PARM(&QUSER &QNBR &QJOB &FILEN +
                          &EPOST +
                          &EMFAX &CVP2 &CVP3 &CVP4 &CVP5 +
                          &CVP6 &CVP7 &CVP8 &CVP9 &PDF)
             ENDDO
             ENDDO
             ENDPGM
