********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 SH  PTF12 ARRAY INDEX FEIL
12XXX * 02 SH  PTF12 henter telefon
12XXX * 03 SH  PTF12 rettet dato på print
12XXX * 04 SH  PTF12 vår ref
12XXX * 05 SH  PTF12 tatt bort boxh
********************************************************************
N02  FSVTHA1    IF   E           K DISK
     FSADF      IF   E           K DISK
     Ffirm      IF   E           K DISK
     Fkodta     IF   E           K DISK
s04  F*risok    UF A E           K DISK
n04  Ffrisok    IF A E           K DISK
     Fcundl01   IF   E           K DISK
     FEDIM4     IF   E           K DISK
     FSADH      IF   E           K DISK
     FKODTSI    IF   E           K DISK
     FSAD070P   O    E             PRINTER
     D                 DS
     D  FA                     1    180
     D                                     DIM(4)                               I/O. frankatur
     D  fakt01                 1     45
     D  fakt02                46     90
     D  fakt03                91    135
     D  fakt04               136    180
     D                 DS
s03  D* MDT                    1      8  0
     D  M0068A                 1      8  0
     D  MDTA                   1      4  0
     D  MDTM                   5      6  0
     D  MDTD                   7      8  0
     D                 DS
s03  D  MDTPR                  1      8  0
     D  MDTDP                  1      2  0
     D  MDTMP                  3      4  0
     D  MDTAP                  5      8  0
     c     *entry        plist
     c                   parm                    uavda             4
     c                   parm                    utdna             7
     C                   MOVE      *ZEROS        MDT
     C                   MOVE      *ZEROS        MDTPR
     c                   move      uavda         uavd              4 0
     c                   move      utdna         utdn              7 0
     c     keykda        klist
     c                   kfld                    fasta             1
     c                   kfld                    uavd
     c                   move      'A'           fasta
     c     key2          klist
     c                   kfld                    fifirm
     c                   kfld                    koaknr
     C     TVIM4K        KLIST
     C                   KFLD                    X4SR
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C                   KFLD                    MAX0B
     C     KEYFRI        KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C                   KFLD                    KODE              3
     C                   move      'MRN'         kode
     C     KEYFRI2       KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C                   KFLD                    KODE2             3
     C                   move      '*CR'         kode2
     C     TVI41K        KLIST
     C                   KFLD                    X4SR
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C                   MOVE      'R'           X4SR              1
     C                   MOVE      '99999999'    MAX0B             8 0
     C     KEYSIGN       KLIST
     C                   KFLD                    KSIUNI
     C                   KFLD                    SISG
     C                   MOVE      'SI'          KSIUNI
n02  C     KEYSIG2       KLIST
n02  C                   KFLD                    SISG
     c     key           klist
     c                   kfld                    uavd
     c                   kfld                    utdn
     c                   read      firm                                   33
     c     keykda        chain     kodta                              33
     c     key2          chain     cundl01                            33
     c     key           chain     sadh                               33
     c     *in33         ifeq      '0'
n04  c                   exsr      refsr
     C     TVIM4K        SETLL     EDIM4
     C     TVI41K        READPE    EDIM4                                  33
     c     *in33         ifeq      '0'
     C     KEYSIGN       CHAIN     KODTSI                             33
n02  C     KEYSIG2       CHAIN     SVTHA1                             36
s04  C*    keyfri        CHAIN(N)  frisok                             35
n04  C     keyfri        CHAIN     frisok                             35
      * fakturanummer
     C                   MOVEL     SIFIF         SIFIF3            3
     C     SIFIF3        IFNE      'F15'
     c                   eval      fakt01=SIFIF
     c                   else
     c                   exsr      hentfak
     c                   end
     C                   MOVE      MDTD          MDTDP
     C                   MOVE      MDTM          MDTMP
     C                   MOVE      MDTA          MDTAP
      * lager barcode
     C                   call      'BARCODSI'
     C                   parm                    fifirm
     C                   parm                    siavd
     C                   parm                    sitdn
     C                   PARM                    BARCOD           25
     C                   write     side
s05  C*                  write     boxh
      * Skriv til frisok
     C                   CLEAR                   FRISOKR
     C                   EVAL      FSAVD=SIAVD
     C                   EVAL      FSOPD=SITDN
     C                   EVAL      FSKODE='TIN'
     C                   MOVEL     SIDT          FSDTOP
     C                   EVAL      FSDOKK='G'
     C                   MOVEL     BARCOD        FSSOK
     C                   WRITE     FRISOKR
     c                   end
     c                   end
     C                   SETON                                        LR
     C                   RETURN
      *********************************************************************
     c     hentfak       begsr
      *********************************************************************
     c                   setoff                                       90
     c                   z-add     0             nr                3 0
     c                   z-add     0             nrakku            3 0
     c                   z-add     0             nrnest            3 0
     c                   move      *blanks       faktxx           45
     C     key           SETLL     SADF
     c     *in90         doweq     '0'
     C     key           READE     SADF                                   90
     C     *in90         IFeq      '0'
     c     nr            andlt     4
     C                   EVAL      NRNEST = %len(%trim(SFTXT))
     c     nrnest        add       nrakku        nrsum             3 0
      * innenfor 45 tegn
     C     nrsum         IFLE      45
     c     faktxx        cat       sftxt:1       faktxx
     c                   add       nrnest        nrakku
     c                   add       1             nrakku
     c                   else
      * ny linje
     c                   add       1             nr
N01  c                   if        nr < 5
     c                   move      faktxx        fa(nr)
N01  c                   endif
     c                   eval      faktxx=*blanks
     c     faktxx        cat       sftxt:1       faktxx
     c                   z-add     nrnest        nrakku
     C                   END
     C                   END
     C                   ENDDO
     c     faktxx        ifne      *blanks
     c                   add       1             nr
N01  c                   if        nr < 5
     c                   move      faktxx        fa(nr)
N01  c                   endif
     c                   end
     c                   endsr
n04   *********************************************************************
n04  c     refsr         begsr
n04   *********************************************************************
n04  c     keyfri2       chain     frisok                             66
n04  c     *in66         ifeq      '0'
n04  c                   eval      VARREF =%trim(%editc(SIAVD:'Z'))+'/'
n04  c                             +%trim(%editc(SITDN:'Z'))+'/' +
n04  c                             %trim(fssok)
n04  c                   else
n04  c                   eval      VARREF =%trim(%editc(SIAVD:'Z'))+'/'
n04  c                             +%trim(%editc(SITDN:'Z'))
n04  c                   end
n04  c                   move      *blanks       fssok
n04  c                   endsr
