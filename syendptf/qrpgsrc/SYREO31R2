     H DFTACTGRP(*NO)
      * Dette programmet kjøres KUN på lørdag eller hellig dag før kl. 12.00.
     FSYREO31F2 UF   E           K DISK
     FKALENDER  IF   E           K DISK

     d wdt             s              8a
     d wtm             s              6a
     d xdt             s              8s 0
     d xtm             s              6s 0
     d xtid            S              6s 0
     D xfil            S             10A
     D xok             S              1A
     d x_r312mod       S                   like(r312mod)
     d x_r312st        S                   like(r312st)
      *
      *  Prototype for 'SYGE15C'
     d syge15c         pr                  extpgm('SYGE15C')
     d wdt_                                like(wdt)
     d wtm_                                like(wtm)
      *  Prototype for 'SYREO31C2'
     d SYREO31C2       pr                  extpgm('SYREO31C2')
     d xfil_                               like(xfil)
     d xok_                                like(xok)
      *  Prototype for syreo31r2
     d syreo31r2       pr
     d uok_                                like(uok)
      *  *ENTRY Interface for Main Procedure
     d syreo31r2       pi
     d uok                            1a
      *
      /free

         exsr init;

         x_r312mod = 'SV-TULL';
         setll (x_r312mod:x_r312st) syreo31f2;
         reade (x_r312mod:x_r312st) syreo31f2;
         dow not %eof;
           syreo31c2 (r312fil:xok);
           if xok = 'J';
             r312st = 'O';
           else;
             r312st = 'E';
           endif;
           xtm = %dec(%time(): *hms);
           r312dt = xdt;
           r312tm = xtm;
           update syreo31f2r;
           if xtm > 120000;
             *inlr = *on;
             return;
           endif;
           reade (x_r312mod:x_r312st) syreo31f2;
         enddo;

         x_r312st = 'E';
         setll (x_r312mod:x_r312st) syreo31f2;
         reade (x_r312mod:x_r312st) syreo31f2;
         dow not %eof;
           syreo31c2 (r312fil:xok);
           if xok = 'J';
             r312st = 'O';
           else;
             r312st = 'E';
           endif;
           xtm = %dec(%time(): *hms);
           r312dt = xdt;
           r312tm = xtm;
           update syreo31f2r;
           if xtm > 120000;
             *inlr = *on;
             return;
           endif;
           reade (x_r312mod:x_r312st) syreo31f2;
         enddo;

       uok = 'J';
       *inlr = *on;
       return;

      //***********************************************
       begsr init;
      //***********************************************
       uok = 'N';
       syge15c (wdt:wtm);
       xdt = %float(wdt);
       xtm = %float(wtm);

       if xtm > 120000;
       // Ikke kjør etter kl. 12.00
         *inlr = *on;
         return;
       endif;

       chain xdt kalender;
       if %found;
         if kaudg <> 'Lø' and kahell <> 'X' or xtm > 120000;
       // Ikke kjør hvis ikke er lørdag og ikke hellig dag
           *inlr = *on;
           return;
         endif;
       endif;

       endsr;

      /end-free
