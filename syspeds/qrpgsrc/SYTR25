      *
      ***********************************************************
      ***                    74-78 82-87 92-96 98             ***
     FFERDL01   UF A E           K DISK
     FFAK4      UF   E           K DISK
     FSAML      UF A E           K DISK
     FHEAD11    IF   E           K DISK
     FCUSAAV    IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FFIRM      IF   E           K DISK
     D                 DS
     D  TIDDAT                 1     14  0
     D  TID                    1      6  0
     D  DD                     7      8  0
     D  MM                     9     10  0
     D  AA                    11     14  0
     D                 DS
     D  UDATA                  1     10
     D  INNLAN                 1      2
     D  UAA                    3      6  0
     D  UMM                    7      8  0
     D  UDD                    9     10  0
      *
      *
     C                   EXSR      INIT
      *
     C     HEPRO         IFEQ      0
     C                   GOTO      SLUTT
     C                   END
      *
      *
      *
     C     HEAKEY        SETLL     HEAD11
      *
     C     *IN30         DOUEQ     '1'
     C     HEAKEY        READE     HEAD11                                 30
     C     *IN30         IFEQ      '0'
     C                   EXSR      MERK
     C                   END
     C                   END
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C***********************************************
     C     MERK          BEGSR
     C***********************************************
     C                   MOVE      HEAVD         FEAVD
     C                   MOVE      HEOPD         FEOPD
      *
      * -------------------------------------------------------
      * FØRST KJØPER
      * -------------------------------------------------------
      *
      *
     C                   MOVE      'K'           YSK
     C                   MOVE      HEKNKF        YKN               8 0
     C                   MOVE      HEKNKF        FEKN
     C     FAKKEY        CHAIN     FAK4                               35
      *
     C     *IN35         IFEQ      '0'
     C     KUNKEY        CHAIN     CUNDL01                            50
      *
      * AVVIK PÅ AVD.NIVÅ?
      *
     C     CUSAAK        CHAIN     CUSAAV                             50        *AVVIK SF.KO
     C  N50              MOVE      CASFAK        SFAKT                           PÅ AVDNIVÅ?
     C     SFAKT         COMP      ' '                                5050
      * 50 ON = SKAL HA SAMLEFAKTURA
     C                   MOVE      YKN           SAKN
     C     HEVALK        IFEQ      FICURR
     C                   MOVE      *BLANKS       SAVAL
     C                   ELSE
     C                   MOVE      HEVALK        SAVAL
     C                   END
     C                   MOVE      HEAVD         SAAVD
     C                   MOVE      HEOPD         SAOPD
     C     SAMLK         CHAIN     SAML                               33
      *
      * IKKE SAMLEFAKTURA - 50 OFF
      *
     C     *IN50         IFEQ      '0'
      * SLETT I SAML / LEGG TIL I FERDF
     C  N33              DELETE    SAMLR
     C     FERKEY        CHAIN     FERDL01                            40
     C     *IN40         IFEQ      '1'
     C                   MOVE      UDATA         FEWS
     C                   MOVE      '  '          OVBETB
     C                   MOVE      ' '           FESFAK
     C                   MOVE      'K'           FESKX
     C                   WRITE     FERDR
     C                   ELSE
     C                   UPDATE    FERDR
     C                   END
     C                   ELSE
      *
      * SAMLEFAKTURA      - 50 ON
      * LEGG TIL I SAML / SLETT I FERDF.
      *
     C                   MOVE      HEPRO         SAPRO
     C                   MOVE      SFAKT         SAGRP
     C                   MOVE      HEDTOP        SADATO
     C                   MOVE      HEUR          SAUR
     C  N33              UPDATE    SAMLR
     C   33              WRITE     SAMLR
     C     FERKEY        CHAIN     FERDL01                            40
     C  N40              DELETE    FERDR
     C                   END
      * OPPDATER KUNDENR (PÅ DEN LESTE LINJE + EVT FLERE...)
     C     *IN35         DOWEQ     '0'
     C                   MOVE      HEKNKF        FAKUNR
     C                   UPDATE    FAKTR
     C     FAKKEY        READE     FAK4                                   35
     C                   END
     C                   END
      *
      * -------------------------------------------------------
      * DERETTER SELGER
      * -------------------------------------------------------
      *
      *
     C                   MOVE      'S'           YSK
     C                   MOVE      HEKNSF        YKN               8 0
     C                   MOVE      HEKNSF        FEKN
     C     FAKKEY        CHAIN     FAK4                               35
      *
     C     *IN35         IFEQ      '0'
     C     KUNKEY        CHAIN     CUNDL01                            50
      *
      * AVVIK PÅ AVD.NIVÅ?
      *
     C     CUSAAK        CHAIN     CUSAAV                             50        *AVVIK SF.KO
     C  N50              MOVE      CASFAK        SFAKT                           PÅ AVDNIVÅ?
     C     SFAKT         COMP      ' '                                5050
      * 50 ON = SKAL HA SAMLEFAKTURA
     C                   MOVE      YKN           SAKN
     C     HEVALS        IFEQ      FICURR
     C                   MOVE      *BLANKS       SAVAL
     C                   ELSE
     C                   MOVE      HEVALS        SAVAL
     C                   END
     C                   MOVE      HEAVD         SAAVD
     C                   MOVE      HEOPD         SAOPD
     C     SAMLK         CHAIN     SAML                               33
      *
      * IKKE SAMLEFAKTURA - 50 OFF
      *
     C     *IN50         IFEQ      '0'
      * SLETT I SAML / LEGG TIL I FERDF
     C  N33              DELETE    SAMLR
     C     FERKEY        CHAIN     FERDL01                            40
     C     *IN40         IFEQ      '1'
     C                   MOVE      UDATA         FEWS
     C                   MOVE      '  '          OVBETB
     C                   MOVE      ' '           FESFAK
     C                   MOVE      'S'           FESKX
     C                   WRITE     FERDR
     C                   ELSE
     C                   UPDATE    FERDR
     C                   END
      *
      * SAMLEFAKTURA      - 50 ON
      *
     C                   ELSE
     C                   MOVE      HEPRO         SAPRO
     C                   MOVE      SFAKT         SAGRP
     C                   MOVE      HEDTOP        SADATO
     C                   MOVE      HEUR          SAUR
     C  N33              UPDATE    SAMLR
     C   33              WRITE     SAMLR
     C     FERKEY        CHAIN     FERDL01                            40
     C  N40              DELETE    FERDR
     C                   END
      * OPPDATER KUNDENR (PÅ DEN LESTE LINJE + EVT FLERE...)
     C     *IN35         DOWEQ     '0'
     C                   MOVE      HEKNSF        FAKUNR
     C                   UPDATE    FAKTR
     C     FAKKEY        READE     FAK4                                   35
     C                   END
     C                   END
      *
      * -------------------------------------------------------
      * DERETTER ALLE EVENTUELLE X-PARTER
      * -------------------------------------------------------
      *
      *
      *
     C                   SETOFF                                       36
     C                   MOVE      'X'           YSK
     C                   MOVE      *ZEROS        FORIGE            8 0
     C     FAKKEY        SETLL     FAK4
     C     *IN36         DOUEQ     '1'
     C     FAKKEY        READE     FAK4                                   36
     C     *IN36         IFEQ      '0'
     C     FAKUNR        ANDNE     FORIGE
     C                   MOVE      FAKUNR        FORIGE            8 0
      *
     C                   MOVE      FAKUNR        YKN               8 0
     C                   MOVE      FAKUNR        FEKN
      *
      *
     C     KUNKEY        CHAIN     CUNDL01                            50        *AVVIK SF.KO
      *
      * AVVIK PÅ AVD.NIVÅ?
      *
     C     CUSAAK        CHAIN     CUSAAV                             50        *AVVIK SF.KO
     C  N50              MOVE      CASFAK        SFAKT                           PÅ AVDNIVÅ?
     C     SFAKT         COMP      ' '                                5050
      * 50 ON = SKAL HA SAMLEFAKTURA
     C                   MOVE      YKN           SAKN
     C     FACURI        IFEQ      FICURR
     C                   MOVE      *BLANKS       SAVAL
     C                   ELSE
     C                   MOVE      FACURI        SAVAL
     C                   END
     C                   MOVE      HEAVD         SAAVD
     C                   MOVE      HEOPD         SAOPD
     C     SAMLK         CHAIN     SAML                               33
      *
      * IKKE SAMLEFAKTURA
      *
     C     *IN50         IFEQ      '0'
      * SLETT I SAML / LEGG TIL I FERDF
     C  N33              DELETE    SAMLR
     C     FERKEY        CHAIN     FERDL01                            40
     C     *IN40         IFEQ      '1'
     C                   MOVE      UDATA         FEWS
     C                   MOVE      '  '          OVBETB
     C                   MOVE      ' '           FESFAK
     C                   MOVE      'X'           FESKX
     C                   WRITE     FERDR
     C                   ELSE
     C                   UPDATE    FERDR
     C                   END
      *
      * SAMLEFAKTURA
      *
     C                   ELSE
     C                   MOVE      HEPRO         SAPRO
     C                   MOVE      SFAKT         SAGRP
     C                   MOVE      HEDTOP        SADATO
     C                   MOVE      HEUR          SAUR
     C  N33              UPDATE    SAMLR
     C   33              WRITE     SAMLR
     C     FERKEY        CHAIN     FERDL01                            40
     C  N40              DELETE    FERDR
     C                   END
      *
     C                   END
     C                   END
      *
     C                   ENDSR
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    UPRO              8
      *
     C     HEAKEY        KLIST
     C                   KFLD                    HEPRO
      *
     C     FAKKEY        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    YSK               1
      *
     C     CUSAAK        KLIST
     C                   KFLD                    YKN
     C                   KFLD                    HEAVD
      *
     C     KUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    YKN
      *
     C     SAMLK         KLIST
     C                   KFLD                    SAKN
     C                   KFLD                    SAVAL
     C                   KFLD                    SAAVD
     C                   KFLD                    SAOPD
      *
      *
     C     FERKEY        KLIST
     C                   KFLD                    FEAVD
     C                   KFLD                    FEOPD
     C                   KFLD                    FEKN
      *
     C                   MOVE      UPRO          HEPRO
      *
      *
     C                   READ      FIRM                                   34
      *
     C                   TIME                    TIDDAT
     C                   MOVE      AA            UAA
     C                   MOVE      MM            UMM
     C                   MOVE      DD            UDD
     C                   MOVE      '*I'          INNLAN
      *
     C                   ENDSR
