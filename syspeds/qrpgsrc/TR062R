      *
      **************************************************************
      *** PROGRAM SKAL ARBEIDE MED EL.TRANSITTERING (LINJE)      ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER       ***
      *** LEDIGE INDIKATORER 01 02 09-11 13-16 18 20 23 24
      *** LEDIGE INDIKATORER 49-59 61-63 95-97
      *** ALLE VARIABLER SOM STARTER MED 'X' ER ARBERDSVAR.      ***
      ***   OG DEFINERES I PROGRAM                               ***
      **************************************************************
      *
     FTRIV      UF A E           K DISK
     FTRIVCN    UF   E           K DISK
     FTRIVFS    UF   E           K DISK
     FTRKODL01  IF   E           K DISK
     FKODTS2    IF   E           K DISK
     FTR062D    CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     SFILE(SUBFIL2:ZRECN2)
     F                                     INFDS(FBAREA)
     D LI              S              5  0 DIM(200)
      *
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  TVGDT                  1      8  0
     D  TVGDTÅ                 1      4  0
     D  TVGDTM                 5      6  0
     D  TVGDTD                 7      8  0
     D                 DS
     D  WSGDT                  1      6  0
     D  WSGDTD                 1      2  0
     D  WSGDTM                 3      4  0
     D  WSGDTÅ                 5      6  0
     D                 DS
     D  WXGDT                  1      6  0
     D  WXGDTD                 1      2  0
     D  WXGDTM                 3      4  0
     D  WXGDTÅ                 5      6  0
     D                 DS
     D  TVGODT                 1      8  0
     D  TVGODÅ                 1      4  0
     D  TVGODM                 5      6  0
     D  TVGODD                 7      8  0
     D                 DS
     D  WSGODT                 1      6  0
     D  WSGODD                 1      2  0
     D  WSGODM                 3      4  0
     D  WSGODÅ                 5      6  0
     D                 DS
     D  WXGODT                 1      6  0
     D  WXGODD                 1      2  0
     D  WXGODM                 3      4  0
     D  WXGODÅ                 5      6  0
     D                 DS
     D  UAVD                   1      4  0
     D  UTDN                   5     11  0
     D  UIN27                 12     12
     D  UIN34                 13     13
     D  UIN36                 14     14
     D  U1N07                 15     17
     D  UWS2                  18     27
      * OBS! HUSK INITIERE ALLE FELTER PÅ TR061R
     D  UPARM2                 1    128
      *
     C                   EXSR      INIT
      *
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     0             ZRECNO
     C                   MOVE      W3LIGM        W3LI
     C                   MOVE      *ZEROS        XLI
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     TRV1K         SETLL     TRIV
     C     START1        TAG
     C     TRHK          READE(N)  TRIV                                   94
     C  N94              MOVE      TVLI          W3LI
     C   94              MOVE      *BLANKS       WSNR
      *
     C     START2        TAG
      *
     C  N94              DO
     C                   DO        99998
     C                   ADD       1             ZRECNO
     C                   MOVE      TVLI          XLI               5 0
     C                   WRITE     SUBFIL
     C     TRHK          READE(N)  TRIV                                   94
     C  N94              MOVE      TVLI          W3LI
     C  N94              END
     C                   END
      *
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C                   Z-ADD     4             LINNBR
     C                   Z-ADD     2             POSNBR
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   EXFMT     NYWRK
     C                   ELSE
     C                   WRITE     SUBCTL
     C                   EXFMT     BUNN
     C                   END
      *
      ***
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   END
      ***
      *
     C                   SETOFF                                       989930
      *
      *** F03 OG 27 PÅ ---> AVBRYTTE SPØRRING
     C   03
     CAN 27              MOVE      *ZEROS        UFLAGG
     C   03
     CAN 27              GOTO      SLUTT
      *
      *** F12 ---> AVBRYTTE REGISTRERING AV DETALJE LINJER
     C   12              Z-ADD     1             UFLAGG
     C   12              GOTO      SLUTT
      *  07 = SØKE OPPDRAG
     C   07              DO
     C                   MOVE      'S'           UTYPE             1
     C                   CALL      'SYFM21'
     C                   PARM                    UTYPE
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    USG               3
     C                   GOTO      START3
     C                   END
      *
      *** F3  ---> BE OM UTSKRIFT ELLER SENDE MED TVINN
      *** F17 ---> SOM F3 + BEHOLDE EN DEL OPPLYSN. FOR NESTE TOLLDEK.
     C   03
     COR 17              DO
     C                   EXSR      SNDTET
      *** F12 ---> AVBRYTTE F3/F17
     C   12              Z-ADD     4             LINNBR
     C   12              Z-ADD     2             POSNBR
     C   12              GOTO      START3
     C                   GOTO      SLUTT
     C                   END
      *
      *** F5  ---> VISE 1. SIDE PÅ SUBFIL.
     C   05              GOTO      START
      *** F6  ---> LAGE NYE DETALJE LINJER
     C   06              GOTO      START5
      *** F8  ---> VELGE SORTERINGSMÅTE OG START POST FOR SUBFIL
     C   08              GOTO      START7
      *
      *** ROLL UP ---> BLA TIL NESTE SIDE
     C   25              DO
     C                   Z-ADD     YRECNO        ZRECNO
     C                   SETOFF                                       25
     C  N94TRVK          SETLL     TRIV
     C  N94TRHK          READE(N)  TRIV                                   94
     C                   GOTO      START2
     C                   END
      *
      *** SJEKKE OM BRUKER HAR VALGT OPSJONER. HIVS SÅ,T UTFØRE DISSE.
     C     ZRECNO        IFNE      0
     C                   EXSR      HENTSR
     C                   END
      *** 98 PÅ ---> BRUKER HAR IKKE VALGT OPSJON. VISE SAMME POSTER
      ***            I SUBFIL DVS. SAMME RECORDNR.
     C   98XRECNO        IFNE      0
     C                   Z-ADD     XRECNO        ZRECNO
     C                   END
      *** 41 AV ---> BRUKER HAR SLETTET NOEN DETALJE LINJER.
      ***            VISE 1. SIDE PÅ SUBFIL
     C  N41              GOTO      START
     C                   GOTO      START3
      *
      *** LAGE NYE DETALJE LINJER
     C     START5        TAG
     C                   Z-ADD     4             LINNBR
     C                   Z-ADD     12            POSNBR
     C                   EXSR      MOVB2
      *
     C     START6        TAG
     C  N30WSLI          IFGT      0
     C                   EXSR      TSTOPL
     C                   END
     C                   EXFMT     VARELI
     C                   MOVEA     '00000000'    *IN(83)
     C                   MOVEA     '00000000'    *IN(75)
     C                   MOVE      '0'           *IN74
     C                   MOVE      '0'           *IN30
      *  07 = SØKE OPPDRAG
     C   07              DO
     C                   MOVE      'S'           UTYPE             1
     C                   CALL      'SYFM21'
     C                   PARM                    UTYPE
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    USG               3
     C                   GOTO      START6
     C                   END
      *
      *** F4  ---> SØKE DATA FOR ET ELLER ANNET FELT.
     C   04              DO
     C                   EXSR      SØKDTA
     C                   GOTO      START6
     C                   END
      *
     C   12WSLI          IFGT      0
     C                   EXSR      DLTOPL
     C                   END
      *
      *** F12 --> AVBRYTTE REGISTRERING AV NYE DETALJE LINJER.
     C  N12              DO
      *** TESTE INNTASTEDE DATA. HVIS FEIL, SETTE IND. PÅ OG VISE
      *** FEILMELDING.
     C                   EXSR      TESTB1
     C   30              GOTO      START6
      *
     C     WSLI          IFEQ      0
     C                   ADD       1             XLI
     C                   MOVE      XLI           WSLI
     C                   END
      *
     C   15              DO
     C                   EXSR      TILKOD
     C                   GOTO      START6
     C                   END
      *
      *** HVIS IKKE FEIL, OPPDATERE FIL, SUBFIL OG VISE DEN PÅ SKJERMEN
     C                   EXSR      OPDTRV
     C                   MOVEA     '11'          *IN(91)
     C                   WRITE     SUBCTL
     C                   GOTO      START5
     C                   END
     C                   Z-ADD     4             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   GOTO      START3
      *
      *** VELGE SORTERINGSMÅTE OG START POST FOR SUBFIL
      *** 31 PÅ    ---> SORTERE PÅ TARIFFNR. + STATUS       (TRUV02)
      *** 31 AV    ---> SORTERE PÅ REGISTRERINGS REKKEFØLGE (TRUV)
     C     START7        TAG
     C                   EXFMT     VAREL2
     C   12              GOTO      START3
     C                   MOVE      W3LI          W3LIGM            5 0
     C                   GOTO      START
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
     C     WSST          COMP      *BLANKS                                90
     C     *IN90         IFEQ      '1'
     C                   Z-ADD     4             LINNBR
     C                   Z-ADD     12            POSNBR
     C                   MOVE      'YBC1769'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
      *
     C                   MOVE      WSSTLK        KS2LK
     C     KODS2K        CHAIN     KODTS2                             89
     C     *IN89         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     4             LINNBR
     C                   Z-ADD     62            POSNBR
     C                   MOVE      'SPL0001'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
      *
     C     WSSTSK        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSSTSK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           88
     C     *IN88         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     4             LINNBR
     C                   Z-ADD     76            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     WSINSK        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSINSK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           87
     C     *IN87         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     22            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     WSGDT         IFNE      0
     C                   CALL      'TESTDATO'
     C                   PARM      WSGDTD        UDD               2 0
     C                   PARM      WSGDTM        UMM               2 0
     C                   PARM      WSGDTÅ        UÅÅ               2 0
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      86
     C     *IN86         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   MOVE      'SPD0001'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     WSGMSK        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSGMSK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           85
     C     *IN85         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     77            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     WSGMLK        IFNE      *BLANKS
     C                   MOVE      WSGMLK        KS2LK
     C     KODS2K        CHAIN     KODTS2                             84
     C     *IN84         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   MOVE      'SPL0001'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     WSGMSS        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSGMSS        YKODE
     C     TRK01K        CHAIN     TRKODL01                           83
     C     *IN83         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     77            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     WSDANT        IFNE      0
     C     WSDFKD        ORNE      *BLANKS
     C     WSDANT        COMP      0                                      82
     C     *IN82         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     15            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   MOVE      'YBC1770'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
      *
     C     WSDFKD        COMP      *BLANKS                                81
     C     *IN81         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     15            LINNBR
     C                   Z-ADD     30            POSNBR
     C                   MOVE      'YBC0840'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
      *
     C     WSDFSK        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSDFSK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           80
     C     *IN80         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     15            LINNBR
     C                   Z-ADD     77            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
     C                   END
      *
     C     WSTALK        IFNE      *BLANKS
     C     WSTAID        ORNE      *BLANKS
     C                   MOVE      WSTALK        KS2LK
     C     KODS2K        CHAIN     KODTS2                             79
     C     *IN79         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     17            LINNBR
     C                   Z-ADD     52            POSNBR
     C                   MOVE      'SPL0001'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     WSTASK        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSTASK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           78
     C     *IN78         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     17            LINNBR
     C                   Z-ADD     72            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     WSGODT        IFNE      0
      * VED NY FORSEGLING MÅ MAN OGSÅ GI OMLASTING
     C*          WSDANT    ORNE 0
     C*          WSDFKD    ORNE *BLANKS
     C                   CALL      'TESTDATO'
     C                   PARM      WSGODD        UDD               2 0
     C                   PARM      WSGODM        UMM               2 0
     C                   PARM      WSGODÅ        UÅÅ               2 0
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      77
     C     *IN77         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   MOVE      'SPD0001'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     WSOMSK        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSOMSK        YKODE
     C     TRK01K        CHAIN     TRKODL01                           76
     C     *IN76         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     77            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     WSOMLK        IFNE      *BLANKS
     C     WSOM          ORNE      *BLANKS
     C                   MOVE      WSOMLK        KS2LK
     C     KODS2K        CHAIN     KODTS2                             75
     C     *IN75         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   MOVE      'SPL0001'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C     WSOMSS        IFNE      *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVE      *BLANKS       YKODE
     C                   MOVEL     WSOMSS        YKODE
     C     TRK01K        CHAIN     TRKODL01                           74
     C     *IN74         IFEQ      '1'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     77            POSNBR
     C                   MOVE      'YBC0810'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   END
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     HENTSR        BEGSR
     C***********************************************
      *** SJEKKE OM BRUKER HAR VALGT NOEN OPSJONER. HVIS IKKE, SETTER
      *** IND. 98 PÅ OG GIR FEILMELDING TIL BRUKER.
      *** OPSJON 2 ---> ENDRE DETALJE LINJE.
      *** OPSJON 4 ---> SLETTE DETALJE LINJE.
      *** OPSJON 5 ---> VISE DETALJE LINJE
      *** LINNBR, POSNBR ---> RETUR POSISJON AV CURSOR
     C                   SETON                                        41
     C                   SETOFF                                       919299
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C   98              DO
     C   99              SETOFF                                       98
     C   98              MOVE      'DIV0012'     MSGNR
     C   98              SETON                                            30
     C                   Z-ADD     1             LINNBR
     C                   GOTO      SLHENT
     C                   END
     C     ZRECNO        DIV       15            LINNBR
     C                   MVR                     XLIN              2 0
     C     XLIN          IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C  N27WSNR          IFEQ      '2'
     C                   MOVE      ' '           WSNR
     C                   EXSR      CHGTRV
     C   12              GOTO      SLHENT
     C                   END
     C  N27WSNR          IFEQ      '4'
     C                   EXSR      DLTTRV
     C                   GOTO      SLHENT
     C                   END
     C     WSNR          IFEQ      '5'
     C                   MOVE      ' '           WSNR
     C                   EXSR      VISTRV
     C   12              GOTO      SLHENT
     C                   END
     C                   END
      *
     C     SLHENT        TAG
     C                   ADD       3             LINNBR
     C                   Z-ADD     2             POSNBR
      *
     C                   ENDSR
      *
     C***********************************************
     C     VISTRV        BEGSR
     C***********************************************
     C                   SETON                                        99
      *
     C                   MOVE      TVLI          WSLI
     C                   MOVE      TVDANT        WSDANT
     C                   MOVE      TVDFKD        WSDFKD
     C                   MOVE      TVDFSK        WSDFSK
     C                   MOVE      TVCNR         WSCNR
     C                   EXSR      TSTOPL
     C                   MOVE      WSLI          TVLI
     C                   MOVE      WSDANT        TVDANT
     C                   MOVE      WSDFKD        TVDFKD
     C                   MOVE      WSDFSK        TVDFSK
     C                   MOVE      WSCNR         TVCNR
     C                   MOVE      TVGDTD        WXGDTD
     C                   MOVE      TVGDTM        WXGDTM
     C                   MOVE      TVGDTÅ        WXGDTÅ
     C                   MOVE      TVGODD        WXGODD
     C                   MOVE      TVGODM        WXGODM
     C                   MOVE      TVGODÅ        WXGODÅ
     C     STVIS         TAG
     C                   EXFMT     VAREL3
      *
     C   15              DO
     C                   MOVE      '1'           UIN27
     C                   EXSR      TILKOD
     C                   MOVE      *IN27         UIN27
     C                   GOTO      STVIS
     C                   END
      *
     C     XLIN          IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C                   UPDATE    SUBFIL
      *
     C                   ENDSR
      *
     C***********************************************
     C     DLTTRV        BEGSR
     C***********************************************
     C                   Z-ADD     ZRECNO        XRECN2            4 0
     C                   MOVE      *ZEROS        LI
      *** OPERASJON 1
     C                   MOVE      TVLI          LI(1)
     C                   Z-ADD     1             XN                3 0
     C     *IN98         DOWEQ     '0'                                          1<-B
     C     STDLT1        TAG
     C                   READC     SUBFIL                                 98
     C  N98WSNR          IFEQ      '4'                                           2<-B
     C                   MOVE      *ZEROS        XN2               3 0
     C     XN2           DOWLT     XN                                             3<-B
     C                   ADD       1             XN2
     C                   END                                                      3<-E
     C                   ADD       1             XN
     C                   MOVE      TVLI          LI(XN)
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
      *** OPERASJON 2
     C                   MOVE      '1'           *IN43
     C                   WRITE     SUBCTL2
     C                   MOVEA     '00'          *IN(43)
     C                   Z-ADD     *ZEROS        ZRECN2
     C                   MOVE      *ZEROS        XN2
     C     XN2           DOWLT     XN                                           1<-B
     C                   ADD       1             XN2
     C                   MOVE      LI(XN2)       WSLI
     C     TRVK          CHAIN(N)  TRIV                               44
     C  N44              ADD       1             ZRECN2
     C  N44              WRITE     SUBFIL2
     C                   END                                                    1<-E
      *
      *** OPERASJON 3
     C                   Z-ADD     1             ZRECN2
     C     STDLT3        TAG
     C                   MOVEA     '11'          *IN(41)
     C                   WRITE     SUBCTL2
     C                   EXFMT     BUNN2
     C   25              GOTO      STDLT3
     C   12              Z-ADD     XRECN2        ZRECNO
     C  N12              DO                                                     1<-B
     C                   MOVE      *ZEROS        ZRECN2
     C     STDLT4        TAG
     C                   ADD       1             ZRECN2
     C     ZRECN2        CHAIN     SUBFIL2                            98
     C  N98              DO                                                      2<-B
     C     TRVK2         CHAIN     TRIV                               41
     C  N41              DO                                                       3<-B
     C                   DELETE    TRIVR
     C                   MOVE      TVLI          WSLI
     C                   EXSR      DLTOPL
     C                   END
     C                   GOTO      STDLT4                                         3<-E
     C                   END                                                     2<-E
     C                   EXSR      MOVB1
     C                   END                                                    1<-E
     C                   SETOFF                                       4198
      *
     C                   ENDSR
      *
     C***********************************************
     C     CHGTRV        BEGSR
     C***********************************************
      *** FLYTTE DATA FRA SUBFIL TIL ARBEIDSVARIABLER
     C                   EXSR      MOVTRW
      *
     C     STCHG         TAG
     C  N30              EXSR      TSTOPL
     C                   EXFMT     VARELI
     C                   MOVEA     '00000000'    *IN(83)
     C                   MOVEA     '00000000'    *IN(75)
     C                   MOVE      '0'           *IN74
     C                   MOVE      '0'           *IN30
     C   04              DO
     C                   EXSR      SØKDTA
     C                   GOTO      STCHG
     C                   END
      *  07 = SØKE OPPDRAG
     C   07              DO
     C                   MOVE      'S'           UTYPE             1
     C                   CALL      'SYFM21'
     C                   PARM                    UTYPE
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    USG               3
     C                   GOTO      STCHG
     C                   END
      *
     C   15              DO
     C                   EXSR      TILKOD
     C                   GOTO      STCHG
     C                   END
      *
     C     *IN12         IFEQ      '1'
      *** F12 ---> AVBRYTTE ENDRING
     C                   UPDATE    SUBFIL
     C                   ELSE
      *** TESTE INNTASTEDE TADA. HVIS IKKE NOE FEIL, OPPDRATERE PÅ FIL
     C                   EXSR      TESTB1
     C   30              GOTO      STCHG
     C                   EXSR      OPDTRV
     C                   END
      *
     C     XLIN          IFEQ      0
     C                   Z-ADD     15            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     OPDTRV        BEGSR
     C***********************************************
      *** 33 PÅ ---> NY LINJE.        33 AV ---> ENDRE EN LINJE
     C     TRVK          CHAIN     TRIV                               33
      *** FLYTTE INNTASTET DATA TIL FIL-VARIABLER OG OPPDATERE DEM.
     C                   EXSR      MOVWTR
     C     *IN33         IFEQ      '0'
     C                   UPDATE    TRIVR
     C                   ELSE
     C                   WRITE     TRIVR
     C                   END
      *
      *** OPPDATERE PÅ SUBFIL
      *
     C   40              UPDATE    SUBFIL
     C  N40              ADD       1             YRECNO
     C  N40              Z-ADD     YRECNO        ZRECNO
     C  N40              WRITE     SUBFIL
      *
     C                   ENDSR
      *
     C***********************************************
     C     TILKOD        BEGSR
     C***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
     C     LINNBR        IFEQ      15
     C                   CALL      'TR066R'
     C                   PARM                    TVAVD
     C                   PARM                    TVTDN
     C                   PARM                    WSLI
     C                   PARM                    WSDFKD
     C                   PARM                    WSDFSK
     C                   PARM                    UIN27
     C                   END
      *
     C     LINNBR        IFEQ      20
     C                   CALL      'TR067R'
     C                   PARM                    TVAVD
     C                   PARM                    TVTDN
     C                   PARM                    WSLI
     C                   PARM                    WSCNR
     C                   PARM                    UIN27
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVTRW        BEGSR
     C***********************************************
     C                   SETON                                        99
     C                   Z-ADD     4             LINNBR
     C                   Z-ADD     12            POSNBR
     C                   SETON                                        40
      *
     C                   MOVE      TVLI          WSLI
     C                   MOVE      TVST          WSST
     C                   MOVE      TVSTSK        WSSTSK
     C                   MOVE      TVSTLK        WSSTLK
     C                   MOVE      TVCTL         WSCTL
     C                   MOVE      TVINF1        WSINF1
     C                   MOVE      TVINF2        WSINF2
     C                   MOVE      TVINF3        WSINF3
     C                   MOVE      TVINF4        WSINF4
     C                   MOVE      TVINSK        WSINSK
     C                   MOVE      TVGDTD        WSGDTD
     C                   MOVE      TVGDTM        WSGDTM
     C                   MOVE      TVGDTÅ        WSGDTÅ
     C                   MOVE      TVGM          WSGM
     C                   MOVE      TVGMSK        WSGMSK
     C                   MOVE      TVGMST        WSGMST
     C                   MOVE      TVGMSS        WSGMSS
     C                   MOVE      TVGMLK        WSGMLK
     C                   MOVE      TVDANT        WSDANT
     C                   MOVE      TVDFKD        WSDFKD
     C                   MOVE      TVDFSK        WSDFSK
     C                   MOVE      TVTAID        WSTAID
     C                   MOVE      TVTASK        WSTASK
     C                   MOVE      TVTALK        WSTALK
     C                   MOVE      TVGODD        WSGODD
     C                   MOVE      TVGODM        WSGODM
     C                   MOVE      TVGODÅ        WSGODÅ
     C                   MOVE      TVOM          WSOM
     C                   MOVE      TVOMSK        WSOMSK
     C                   MOVE      TVOMST        WSOMST
     C                   MOVE      TVOMSS        WSOMSS
     C                   MOVE      TVOMLK        WSOMLK
     C                   MOVE      TVCNR         WSCNR
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVWTR        BEGSR
     C***********************************************
     C                   MOVE      UAVD          TVAVD
     C                   MOVE      UTDN          TVTDN
     C                   MOVE      ' '           TV01
     C                   MOVE      WSLI          TVLI
     C                   MOVE      WSST          TVST
     C                   MOVE      WSSTSK        TVSTSK
     C                   MOVE      WSSTLK        TVSTLK
     C                   MOVE      WSCTL         TVCTL
     C     WSINF1        IFEQ      *BLANKS
     C                   Z-ADD     0             TVFLG
     C                   ELSE
     C                   Z-ADD     1             TVFLG
     C                   END
     C                   MOVE      WSINF1        TVINF1
     C                   MOVE      WSINF2        TVINF2
     C                   MOVE      WSINF3        TVINF3
     C                   MOVE      WSINF4        TVINF4
     C                   MOVE      WSINSK        TVINSK
     C     WSGDT         IFEQ      0
     C                   MOVE      *ZEROS        TVGDT
     C                   ELSE
     C                   MOVE      WSGDTD        TVGDTD
     C                   MOVE      WSGDTM        TVGDTM
     C     WSGDTÅ        ADD       2000          TVGDTÅ
     C                   END
     C                   MOVE      WSGM          TVGM
     C                   MOVE      WSGMSK        TVGMSK
     C                   MOVE      WSGMST        TVGMST
     C                   MOVE      WSGMSS        TVGMSS
     C                   MOVE      WSGMLK        TVGMLK
     C                   MOVE      WSDANT        TVDANT
     C                   MOVE      WSDFKD        TVDFKD
     C                   MOVE      WSDFSK        TVDFSK
     C                   MOVE      WSTAID        TVTAID
     C                   MOVE      WSTASK        TVTASK
     C                   MOVE      WSTALK        TVTALK
     C     WSGODT        IFEQ      0
     C                   MOVE      *ZEROS        TVGODT
     C                   ELSE
     C                   MOVE      WSGODD        TVGODD
     C                   MOVE      WSGODM        TVGODM
     C     WSGODÅ        ADD       2000          TVGODÅ
     C                   END
     C                   MOVE      WSOM          TVOM
     C                   MOVE      WSOMSK        TVOMSK
     C                   MOVE      WSOMST        TVOMST
     C                   MOVE      WSOMSS        TVOMSS
     C                   MOVE      WSOMLK        TVOMLK
     C                   MOVE      WSCNR         TVCNR
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVB1         BEGSR
     C***********************************************
     C                   MOVE      *BLANKS       TV01
     C                   MOVE      *ZEROS        TVLI
     C                   MOVE      *BLANKS       TVST
     C                   MOVE      *BLANKS       TVSTSK
     C                   MOVE      *BLANKS       TVSTLK
     C                   MOVE      *ZEROS        TVCTL
     C                   MOVE      *ZEROS        TVFLG
     C                   MOVE      *BLANKS       TVINF1
     C                   MOVE      *BLANKS       TVINF2
     C                   MOVE      *BLANKS       TVINF3
     C                   MOVE      *BLANKS       TVINF4
     C                   MOVE      *BLANKS       TVINSK
     C                   MOVE      *ZEROS        TVGDT
     C                   MOVE      *BLANKS       TVGM
     C                   MOVE      *BLANKS       TVGMSK
     C                   MOVE      *BLANKS       TVGMST
     C                   MOVE      *BLANKS       TVGMSS
     C                   MOVE      *BLANKS       TVGMLK
     C                   MOVE      *ZEROS        TVDANT
     C                   MOVE      *BLANKS       TVDFKD
     C                   MOVE      *BLANKS       TVDFSK
     C                   MOVE      *BLANKS       TVTAID
     C                   MOVE      *BLANKS       TVTASK
     C                   MOVE      *BLANKS       TVTALK
     C                   MOVE      *ZEROS        TVGODT
     C                   MOVE      *BLANKS       TVOM
     C                   MOVE      *BLANKS       TVOMSK
     C                   MOVE      *BLANKS       TVOMST
     C                   MOVE      *BLANKS       TVOMSS
     C                   MOVE      *BLANKS       TVOMLK
     C                   MOVE      *BLANKS       TVCNR
      *
     C                   ENDSR
      *
     C***********************************************
     C     MOVB2         BEGSR
     C***********************************************
     C                   SETOFF                                       40
     C                   MOVEA     '00'          *IN(28)
     C                   MOVE      *ZEROS        WSLI
     C                   MOVE      *BLANKS       WSST
     C                   MOVE      *BLANKS       WSSTSK
     C                   MOVE      *BLANKS       WSSTLK
     C                   MOVE      *ZEROS        WSCTL
     C                   MOVE      *BLANKS       WSINF1
     C                   MOVE      *BLANKS       WSINF2
     C                   MOVE      *BLANKS       WSINF3
     C                   MOVE      *BLANKS       WSINF4
     C                   MOVE      *BLANKS       WSINSK
     C                   MOVE      *ZEROS        WSGDT
     C                   MOVE      *BLANKS       WSGM
     C                   MOVE      *BLANKS       WSGMSK
     C                   MOVE      *BLANKS       WSGMST
     C                   MOVE      *BLANKS       WSGMSS
     C                   MOVE      *BLANKS       WSGMLK
     C                   MOVE      *ZEROS        WSDANT
     C                   MOVE      *BLANKS       WSDFKD
     C                   MOVE      *BLANKS       WSDFSK
     C                   MOVE      *BLANKS       WSTAID
     C                   MOVE      *BLANKS       WSTASK
     C                   MOVE      *BLANKS       WSTALK
     C                   MOVE      *ZEROS        WSGODT
     C                   MOVE      *BLANKS       WSOM
     C                   MOVE      *BLANKS       WSOMSK
     C                   MOVE      *BLANKS       WSOMST
     C                   MOVE      *BLANKS       WSOMSS
     C                   MOVE      *BLANKS       WSOMLK
     C                   MOVE      *BLANKS       WSCNR
      *
     C                   ENDSR
      *
     C***********************************************
     C     SNDTET        BEGSR
     C***********************************************
     C   17              Z-ADD     2             UFLAGG            1 0
     C   03              Z-ADD     3             UFLAGG            1 0
      *
     C     UTYPE         IFNE      'DSP'
     C     UIN34         IFEQ      '1'
     C                   MOVE      '007'         U1N07
     C                   ELSE
     C                   MOVE      '   '         U1N07
     C                   END
     C                   CALL      'TR063R'
     C                   PARM      UPARM2        UPARM1
     C                   PARM                    UFLAGG
      *
     C     UFLAGG        COMP      1                                      12
     C                   END
      *
     C     SLSND         ENDSR
      *
     C***********************************************
     C     SØKDTA        BEGSR
     C***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
     C     LINNBR        IFEQ      4
     C     POSNBR        ANDGE     76
     C     POSNBR        ANDLE     77
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSSTSK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         WSSTSK
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      4
     C     POSNBR        ANDGE     62
     C     POSNBR        ANDLE     63
     C                   CALL      'SYFI10L'
     C                   PARM                    WSSTLK
     C                   PARM                    USPED
     C                   Z-ADD     76            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      7
     C     POSNBR        ANDGE     32
     C     POSNBR        ANDLE     33
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSINSK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         WSINSK
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     10            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      12
     C     POSNBR        ANDGE     77
     C     POSNBR        ANDLE     78
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSGMSK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         WSGMSK
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      13
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     13
     C                   CALL      'SYFI10L'
     C                   PARM                    WSGMLK
     C                   PARM                    USPED
     C                   Z-ADD     30            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      13
     C     POSNBR        ANDGE     77
     C     POSNBR        ANDLE     78
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSGMSS        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         WSGMSS
     C                   Z-ADD     15            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      15
     C     POSNBR        ANDGE     72
     C     POSNBR        ANDLE     73
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSDFSK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         WSDFSK
     C                   Z-ADD     17            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      17
     C     POSNBR        ANDGE     72
     C     POSNBR        ANDLE     73
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSTASK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         WSTASK
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      17
     C     POSNBR        ANDGE     52
     C     POSNBR        ANDLE     53
     C                   CALL      'SYFI10L'
     C                   PARM                    WSTALK
     C                   PARM                    USPED
     C                   Z-ADD     72            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      18
     C     POSNBR        ANDGE     77
     C     POSNBR        ANDLE     78
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSOMSK        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         WSOMSK
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      19
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     13
     C                   CALL      'SYFI10L'
     C                   PARM                    WSOMLK
     C                   PARM                    USPED
     C                   Z-ADD     30            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      19
     C     POSNBR        ANDGE     77
     C     POSNBR        ANDLE     78
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSOMSS        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE2            3
     C                   MOVEL     UKODE         WSOMSS
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     12            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
      *
     C     SLSØK         ENDSR
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     TRHK          KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C     TRVK          KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    WSLI
     C     TRV1K         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    W3LI
     C     TRVK2         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    TVLI
     C     TRK01K        KLIST
     C                   KFLD                    YUNIK             3
     C                   KFLD                    YKODE            10
     C     KODS2K        KLIST
     C                   KFLD                    KS2UNI
     C                   KFLD                    KS2LK
     C                   MOVE      'S2 '         KS2UNI
      *
     C     *ENTRY        PLIST
     C     UPARM2        PARM      UPARM2        UPARM1          128
     C                   PARM                    UFLAGG            1 0
      *
     C                   MOVE      UIN27         *IN27
     C                   MOVE      UIN36         *IN36
     C                   MOVE      *ZEROS        XLI
     C                   MOVE      *ZEROS        WSGDT
     C                   MOVE      *ZEROS        WSGODT
     C                   MOVE      *ZEROS        TVGDT
     C                   MOVE      *ZEROS        TVGODT
     C                   MOVE      *BLANKS       UUNIK             3
     C                   MOVE      *BLANKS       UKODE            10
      *
     C                   MOVE      *ZEROS        TVLI
     C                   MOVE      'N'           USPED             1
      *
     C                   ENDSR
      *
     C***********************************************
     C     TSTOPL        BEGSR
     C***********************************************
     C                   MOVEA     '00'          *IN(28)
      *** TEST OM FLERE CONTAINERNR
     C     TRVK          SETLL     TRIVCN
     C     TRVK          READE(N)  TRIVCN                                 33
     C  N33              SETON                                        28
      *** TEST OM FLERE FORSEGLING
     C     TRVK          SETLL     TRIVFS
     C     TRVK          READE(N)  TRIVFS                                 33
     C  N33              SETON                                        29
      *
     C                   ENDSR
      *
     C***********************************************
     C     DLTOPL        BEGSR
     C***********************************************
      *** SLETTE CONTAINERNR PGA. AVBRYT NY REGISTRERING
     C     TRVK          SETLL     TRIVCN
     C     TRVK          READE     TRIVCN                                 33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    TRIVCNR
     C     TRVK          READE     TRIVCN                                 33
     C  N33              ENDDO
      *** SLETTE FORSEGLING PGA. AVBRYT NY REGISTRERING
     C     TRVK          SETLL     TRIVFS
     C     TRVK          READE     TRIVFS                                 33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    TRIVFSR
     C     TRVK          READE     TRIVFS                                 33
     C  N33              ENDDO
      *
     C                   ENDSR
      *
