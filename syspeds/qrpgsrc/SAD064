""""‚ * kompiler med DFTACTGRP(*NO)
****‚***************************************************************
     ‚* RETTINGER I DETTE PROGRAM:
PTFn‚:*Sek Sig Vers  Beskrivelse...........................
""""‚"*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11108‚* 01 YBC PTF11 OMBEREGNING PÅ OMBEREGNING
     ‚*              MYE ENDRINGER. INGEN MERKING.
****‚***************************************************************

     ‚***********************************************************
     ‚*** PROGRAM SKAL KOPIERE OPPDRAG TIL OMBEREGNING        ***
     ‚*** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
     ‚*** LEDIGE INDIKATORER 01 05 06 09 11 16 18-22 25 56
     ‚*** LEDIGE INDIKATORER 27 34 37-60 63-67 74 75          ***
     ‚***********************************************************

     fsadh      uf a e           k disk
     fsadhom    uf a e           k disk    rename(sadhr:sadhrom)
     fsadf      uf a e           k disk
     fsadv      uf a e           k disk
     fsadvj     uf a e           k disk
     fsadw      uf a e           k disk
     fsadomt    uf a e           k disk
     fsadomth   uf a e           k disk
     fsadomtf   uf a e           k disk
     fsadomtv   uf a e           k disk
     fsadomtvj  uf a e           k disk
     fsadomtw   uf a e           k disk
     ‚*  Prototype for sad064
     d sad064          pr
     d uavd_                               like(uavd)
     d utdn_                               like(utdn)
     d usg_                                like(usg)
     d utype_                              like(utype)
     ‚*  Prototype for 'SYGE15C'
     d syge15c         pr                  extpgm('SYGE15C')
     d wdt_                                like(wdt)
     d wtm_                                like(wtm)
     ‚*  *ENTRY Interface for Main Procedure
     d sad064          pi
     d uavd                           4  0
     d utdn                           7  0
     d usg                            3
     d utype                          3
     ‚*----------------------------------------------------------------------
     ‚* Stand Alone Fields - TOP
     ‚*----------------------------------------------------------------------
     d wdt             s              8
     d wtm             s              6
     d x_siavd         s                   like(siavd)
     d x_sidtg         s                   like(sidtg)
     d x_siombn        s                   like(siombn)
     d x_sitdn         s                   like(sitdn)
     d x_sitle         s                   like(sitle)
     d x_sitll         s                   like(sitll)
     ‚*----------------------------------------------------------------------
     ‚* Stand Alone Fields - BOTTOM
     ‚*----------------------------------------------------------------------

      /free
       exsr init;

       select;
       when utype = 'NYS';                                                      // Ny omberegning
         exsr srnyomb;                                                          // basert sist omb.
       when utype = 'NYO';                                                      // Ny omberegning
         exsr srnyombori;                                                       // basert original
       when utype = 'NYA';                                                      // ANGRE NY OMBEREGN
         exsr srangomb;
       endsl;

       chain(n) ( uavd : utdn ) sadhom;
       select;
       when not %found and utype <> 'OMS';

         chain(n) ( uavd : x_sitdn ) sadh;
         sitdn  = utdn;
         sist   = ' ';
         sisg   = usg;
         simf   = *blanks;
         sidt   = %dec(wdt:8:0);
         write sadhr;
         write sadhrom;

         setll ( uavd : x_sitdn ) sadf;
         reade ( uavd : x_sitdn ) sadf;
         dow not %eof;
           sfopdn = utdn;
           write sadfr;
           reade ( uavd : x_sitdn ) sadf;
         enddo;

         setll ( uavd : x_sitdn ) sadv;
         reade(n) ( uavd : x_sitdn ) sadv;
         dow not %eof;
           svtdn = utdn;
           write sadvr;
           reade(n) ( uavd : x_sitdn ) sadv;
         enddo;

         setll ( uavd : x_sitdn ) sadvj;
         reade(n) ( uavd : x_sitdn ) sadvj;
         dow not %eof;
           sjtdn = utdn;
           write sadvjr;
           reade(n) ( uavd : x_sitdn ) sadvj;
         enddo;

         setll ( uavd : x_sitdn ) sadw;
         reade(n) ( uavd : x_sitdn ) sadw;
         dow not %eof;
           swtdn = utdn;
           write sadwr;
           reade(n) ( uavd : x_sitdn ) sadw;
         enddo;

         // OMSTART: SLETT GAMLE OG LAGE NYE I OMBEREGNINGSOPPDRAG
       when %found and utype = 'OMS';
         // SLETT GAMLE LINJE I OMBEREGNINGSOPPDRAG (SITDN < 0)
         setll ( uavd : utdn ) sadv;
         reade ( uavd : utdn ) sadv;
         dow not %eof;
           delete sadvr;
           reade ( uavd : utdn ) sadv;
         enddo;
         setll ( uavd : utdn ) sadvj;
         reade ( uavd : utdn ) sadvj;
         dow not %eof;
           delete sadvjr;
           reade ( uavd : utdn ) sadvj;
         enddo;
         setll ( uavd : utdn ) sadw;
         reade ( uavd : utdn ) sadw;
         dow not %eof;
           delete sadwr;
           reade ( uavd : utdn ) sadw;
         enddo;
         // LAGE NYE LINJER
         siombn = 99;
         setll ( uavd : utdn : siombn ) sadomt;
         readpe(n) ( uavd : utdn ) sadomt;

         if not %eof and sisomb = 'J';
           exsr srcpy;
         else;
           exsr srcpyori;
         endif;

       endsl;

       *inlr = *on;
       return;

       //**********************************************
       begsr init;
         //**********************************************
         sitdn = utdn;
         x_siavd = uavd;
         x_sitdn = utdn * -1;
         syge15c ( wdt : wtm );

       endsr;

       //**********************************************
       begsr srcpy;
         //**********************************************
         setll ( uavd : utdn : siombn ) sadomtv;
         reade(n) ( uavd : utdn : siombn ) sadomtv;
         dow not %eof;
           write sadvr;
           reade(n) ( uavd : utdn : siombn ) sadomtv;
         enddo;

         setll ( uavd : utdn : siombn ) sadomtvj;
         reade(n) ( uavd : utdn : siombn ) sadomtvj;
         dow not %eof;
           write sadvjr;
           reade(n) ( uavd : utdn : siombn ) sadomtvj;
         enddo;

         setll ( uavd : utdn : siombn ) sadomtw;
         reade(n) ( uavd : utdn : siombn ) sadomtw;
         dow not %eof;
           write sadwr;
           reade(n) ( uavd : utdn : siombn ) sadomtw;
         enddo;

       endsr;

       //**********************************************
       begsr srcpyori;
         //**********************************************
         setll ( uavd : x_sitdn ) sadv;
         reade(n) ( uavd : x_sitdn ) sadv;
         dow not %eof;
           svtdn = utdn;
           write sadvr;
           reade(n) ( uavd : x_sitdn ) sadv;
         enddo;

         setll ( uavd : x_sitdn ) sadvj;
         reade(n) ( uavd : x_sitdn ) sadvj;
         dow not %eof;
           sjtdn = utdn;
           write sadvjr;
           reade(n) ( uavd : x_sitdn ) sadvj;
         enddo;

         setll ( uavd : x_sitdn ) sadw;
         reade(n) ( uavd : x_sitdn ) sadw;
         dow not %eof;
           swtdn = utdn;
           write sadwr;
           reade(n) ( uavd : x_sitdn ) sadw;
         enddo;

       endsr;

       //**********************************************
       begsr srnyomb;
         //**********************************************
         siombn = 99;
         setll ( uavd : utdn : siombn ) sadomt;
         readpe(n) ( uavd : utdn ) sadomt;
         if %eof;
           x_siombn = 1;
         else;
           x_siombn = siombn + 1;
         endif;
         clear sadomtr;
         sidtsl = %dec(wdt:8:0);
         sitmsl = %dec(wtm:8:0);
         chain ( uavd : utdn ) sadhom;
         siombn = x_siombn;
         sisomb = 'J';
         write sadomtr;
         clear sadhrom;
         siavd  = uavd;
         sitdn  = utdn;
         update sadhrom;
         chain(n) ( x_siavd : x_sitdn ) sadh;
         x_sitll  = sitll;
         x_sitle  = sitle;
         x_sidtg  = sidtg;
         chain ( uavd : utdn ) sadh;
         siombn = x_siombn;
         write sadomthr;
         sist   = ' ';
         sitll  = x_sitll;
         sitle  = x_sitle;
         sidtg  = x_sidtg;
         simf   = *blanks;
         update sadhr;
         setll ( uavd : utdn ) sadf;
         reade(n) ( uavd : utdn ) sadf;
         sfombn = x_siombn;
         dow not %eof;
           write sadomtfr;
           reade(n) ( uavd : utdn ) sadf;
         enddo;
         setll ( uavd : utdn ) sadv;
         reade(n) ( uavd : utdn ) sadv;
         svombn = x_siombn;
         dow not %eof;
           write sadomtvr;
           reade(n) ( uavd : utdn ) sadv;
         enddo;
         setll ( uavd : utdn ) sadvj;
         reade(n) ( uavd : utdn ) sadvj;
         svombn = x_siombn;
         dow not %eof;
           write sadomtvjr;
           reade(n) ( uavd : utdn ) sadvj;
         enddo;
         setll ( uavd : utdn ) sadw;
         reade(n) ( uavd : utdn ) sadw;
         swombn = x_siombn;
         dow not %eof;
           write sadomtwr;
           reade(n) ( uavd : utdn ) sadw;
         enddo;

         *inlr = *on;
         return;

       endsr;

       //**********************************************
       begsr srnyombori;
         //**********************************************
         siombn = 99;
         setll ( uavd : utdn : siombn ) sadomt;
         readpe(n) ( uavd : utdn ) sadomt;
         if %eof;
           x_siombn = 1;
         else;
           x_siombn = siombn + 1;
         endif;
         clear sadomtr;
         sidtsl = %dec(wdt:8:0);
         sitmsl = %dec(wtm:8:0);
         chain ( uavd : utdn ) sadhom;
         siombn = x_siombn;
         sisomb = 'N';
         write sadomtr;
         delete sadhrom;
         clear sadhrom;
         chain ( uavd : utdn ) sadh;
         siombn = x_siombn;
         write sadomthr;
         delete sadhr;
         clear sadhr;
         setll ( uavd : utdn ) sadf;
         reade ( uavd : utdn ) sadf;
         sfombn = x_siombn;
         dow not %eof;
           write sadomtfr;
           delete sadfr;
           reade ( uavd : utdn ) sadf;
         enddo;
         clear sadfr;
         setll ( uavd : utdn ) sadv;
         reade ( uavd : utdn ) sadv;
         svombn = x_siombn;
         dow not %eof;
           write sadomtvr;
           delete sadvr;
           reade ( uavd : utdn ) sadv;
         enddo;
         clear sadvr;
         setll ( uavd : utdn ) sadvj;
         reade ( uavd : utdn ) sadvj;
         svombn = x_siombn;
         dow not %eof;
           write sadomtvjr;
           delete sadvjr;
           reade ( uavd : utdn ) sadvj;
         enddo;
         clear sadvjr;
         setll ( uavd : utdn ) sadw;
         reade ( uavd : utdn ) sadw;
         swombn = x_siombn;
         dow not %eof;
           write sadomtwr;
           delete sadwr;
           reade ( uavd : utdn ) sadw;
         enddo;
         clear sadwr;

         utype = 'OMB';

       endsr;

       //**********************************************
       begsr srangomb;
         //**********************************************
         // SJEKK OM TIDLIGERE OMBEREGNING FINNES
         siombn = 99;
         setll ( uavd : utdn : siombn ) sadomt;
         readpe(n) ( uavd : utdn ) sadomt;

         if not %eof;
           x_siombn = siombn;

         // SLETT UFERDIG OMBEREGNING
           chain ( uavd : utdn ) sadhom;
           delete sadhrom;
           chain ( uavd : utdn ) sadh;
           delete sadhr;
           setll ( uavd : utdn ) sadf;
           reade ( uavd : utdn ) sadf;
           dow not %eof;
             delete sadfr;
             reade ( uavd : utdn ) sadf;
           enddo;
           setll ( uavd : utdn ) sadv;
           reade ( uavd : utdn ) sadv;
           dow not %eof;
             delete sadvr;
             reade ( uavd : utdn ) sadv;
           enddo;
           setll ( uavd : utdn ) sadvj;
           reade ( uavd : utdn ) sadvj;
           dow not %eof;
             delete sadvjr;
             reade ( uavd : utdn ) sadvj;
           enddo;
           setll ( uavd : utdn ) sadw;
           reade ( uavd : utdn ) sadw;
           dow not %eof;
             delete sadwr;
             reade ( uavd : utdn ) sadw;
           enddo;

         // FLYTT SISTE OMBEREGNING TILBAKE

           chain ( uavd : utdn : siombn ) sadomt;
           write sadhrom;
           delete sadomtr;
           chain ( uavd : utdn : siombn ) sadomth;
           write sadhr;
           delete sadomthr;
           setll ( uavd : utdn : siombn ) sadomtf;
           reade ( uavd : utdn : siombn ) sadomtf;
           dow not %eof;
             write sadfr;
             delete sadomtfr;
             reade ( uavd : utdn : siombn ) sadomtf;
           enddo;
           setll ( uavd : utdn : siombn ) sadomtv;
           reade ( uavd : utdn : siombn ) sadomtv;
           dow not %eof;
             write sadvr;
             delete sadomtvr;
             reade ( uavd : utdn : siombn ) sadomtv;
           enddo;
           setll ( uavd : utdn : siombn ) sadomtvj;
           reade ( uavd : utdn : siombn ) sadomtvj;
           dow not %eof;
           write sadvjr;
             delete sadomtvjr;
             reade ( uavd : utdn : siombn ) sadomtvj;
           enddo;
           setll ( uavd : utdn : siombn ) sadomtw;
           reade ( uavd : utdn : siombn ) sadomtw;
           dow not %eof;
             write sadwr;
             delete sadomtwr;
             reade ( uavd : utdn : siombn ) sadomtw;
           enddo;

         endif;

         *inlr = *on;
         return;

       endsr;

      /end-free
