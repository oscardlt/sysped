     FDKEH      IF   E           K DISK
     FDKEV      IF   E           K DISK
     FDKEA      IF   E           K DISK
     FSVTKD     IF   E           K DISK
     FKODTP     IF   E           K DISK
     FDKZ002P   O    E             PRINTER USROPN
     D A1              S             17    DIM(99)
     D A2              S             42    DIM(99)
      *________________________________________
      * DS for å venstrestille numeriske felter
      *""""""""""""""""""""""""""""""""""""""""
     D                 DS
     D  ØN164                  1     16  4
     D  ØA164H                 1     12
     D  ØA164D                13     16
     D                 DS
     D  ØA17                   1     17
     D  Ø17                    1     17
     D                                     DIM(17)                              Num edit
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    UKEHASYAV         4
     C                   PARM                    UKEHASYOP         7
     C                   PARM                    UCALLTYP          1
     C                   MOVE      UKEHASYAV     UKEH_SYAV
     C                   MOVE      UKEHASYOP     UKEH_SYOP
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    KOPUNI        UOPUNI
     C     *LIKE         DEFINE    KOPAVD        UOPAVD
     C     *LIKE         DEFINE    KOPLNR        UOPLNR
     C     *LIKE         DEFINE    DKEV_314      WVZV_314
     C     *LIKE         DEFINE    DKEH_SYAV     UKEH_SYAV
     C     *LIKE         DEFINE    DKEH_SYOP     UKEH_SYOP
     C                   Z-ADD     0             ØX                2 0
     C                   MOVE      *BLANKS       ØAN              12
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYA          KLIST
     C                   KFLD                    UKEH_SYAV
     C                   KFLD                    UKEH_SYOP
     C     KEYP          KLIST
     C                   KFLD                    UOPUNI
     C                   KFLD                    UOPAVD
     C                   KFLD                    UOPLNR
     C     SVTKDKEY      KLIST
     C                   KFLD                    UIE               1
     C                   KFLD                    UTYP              3
     C                   KFLD                    UKD              10
      *_____________
      * Init av felt
      *"""""""""""""
     C                   EVAL      UOPUNI='P'
     C                   EVAL      UOPLNR=259
     C                   Z-ADD     1024          UCMDL            15 5
     C                   MOVE      *BLANKS       UCMD           1024
      *______________________________
      * Hente avdeling fra TDS export
      *""""""""""""""""""""""""""""""
     C                   EVAL      UOPAVD=UKEH_SYAV
      *_____________________
      * Hente printerstyring
      *"""""""""""""""""""""
     C     KEYP          CHAIN     KODTP                              33
      *_______________
      * Printerstyring
      *"""""""""""""""
     C                   EVAL      UCMD='OVRPRTF FILE(DKZ002P) OUTQ('
     C     UCMD          CAT       KOPNVN:0      UCMD
     C     UCMD          CAT       ')':0         UCMD
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     C                   OPEN      DKZ002P
      * Hvor mange vareposter ?
     C                   EVAL      *IN33=*OFF
     C     KEYA          SETLL     DKEV
     C     KEYA          READE     DKEV                                   33
     C     *IN33         DOWEQ     *OFF
     C                   ADD       1             WKEH_ANTV
     C     KEYA          READE     DKEV                                   33
     C                   ENDDO
      *________________
      * Hente avdelning
      *""""""""""""""""
     C     UKEH_SYAV     CHAIN     DKEA
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Hovedark                                             SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR

     C     KEYA          CHAIN     DKEH                               51
      *_____________________
      * Rubrik MRN Stræckkod
      *"""""""""""""""""""""
     C                   WRITE     A
      *___________________________________
      * Rubrik 2 - S28 (huvudupplysningar)
      *"""""""""""""""""""""""""""""""""""
      * Finns sækerhetsrelaterad information ?
     C*    DKEH_SAOM     IFEQ      *BLANKS
     C     DKEH_S29      IFEQ      *BLANKS
     C*    DKEH_RES1     ANDEQ     *BLANKS
     C     DKEH_D011     ANDEQ     *BLANKS
     C                   EVAL      WVZV_S00=*BLANKS
     C                   ELSE
     C                   EVAL      WVZV_S00='S'
     C                   ENDIF
      * Hur många sidor behøvs ?
     C     WKEH_ANTV     DIV(H)    2             WX                5 0
     C                   ADD       1             WX
     C                   EVAL      WVZV_R3=WX
     C     WKEH_ANTV     IFEQ      1
     C                   EVAL      WVZV_R3=1
     C                   ENDIF
      * S13 Ruttordning
     C                   EVAL      WVZH_S13=DKEH_S131 + ' ' +
     C                                      DKEH_S132 + ' ' +
     C                                      DKEH_S133 + ' ' +
     C                                      DKEH_S134 + ' ' +
     C                                      DKEH_S135
      * Rubrik S32
     C*                  IF        DKEH_SAOM=*BLANKS
     C                   EVAL      WVZH_SAOM='- - -'
     C*                  ELSE
     C*                  EVAL      WVZH_SAOM=DKEH_SAOM
     C*                  ENDIF
      * Rubrik 7
     C                   IF        DKEH_07=*BLANKS
     C                   EVAL      DKEH_07='- - -'
     C                   ENDIF
      * Rubrik S29
     C                   IF        DKEH_S29=*BLANKS
     C                   EVAL      DKEH_S29='- - -'
     C                   ENDIF
      * Rubrik 18
     C                   IF        DKEH_181=*BLANKS
     C                   EVAL      DKEH_181='- - -'
     C                   ENDIF
     C                   EXSR      SRB2
     C                   WRITE     B
      *___________________
      * Varulinjer HEADING
      *"""""""""""""""""""
     C     WKEH_ANTV     IFEQ      1
     C                   EXSR      SRB1
     C                   ENDIF
      *____________________________________
      * Tomma linjer om fler æn 1 varulinje
      *""""""""""""""""""""""""""""""""""""
     C     WKEH_ANTV     IFGT      1
     C                   EXSR      SRB4
     C                   ENDIF
      *_________
      * Rubrik E
      *"""""""""
     C*                  SELECT
     C*    DKEH_KON1     WHENEQ    'A1'
     C*                  EVAL      WVZH_KON1='Konform           '
     C*    DKEH_KON1     WHENEQ    'A2'
     C*                  EVAL      WVZH_KON1='Ansedd som konform'
     C*    DKEH_KON1     WHENEQ    'A3'
     C*                  EVAL      WVZH_KON1='Godkænd exportør  '
     C*                  ENDSL
     C                   SELECT
     C     DKEH_D011     WHENNE    *BLANKS
     C                   CAT       '-':1         DKEH_D011
     C                   CAT       DKEH_D014:1   DKEH_D011
     C     DKEH_D013     WHENNE    *BLANKS
     C                   CAT       '-':1         DKEH_D011
     C                   CAT       DKEH_D013:1   DKEH_D011
     C     DKEH_D012     WHENNE    *BLANKS
     C                   CAT       '-':1         DKEH_D011
     C                   CAT       DKEH_D012:1   DKEH_D011
     C                   ENDSL
     C                   WRITE     Z
      *___________________
      * Varulinjer Eget ark
      *"""""""""""""""""""
     C     WKEH_ANTV     IFGT      1
     C                   EXSR      SRB3
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Linjer på hovedark (1 varupost)                     SRB1 /
      *////////////////////////////////////////////////////////////
     C     SRB1          BEGSR
     C     KEYA          CHAIN     DKEV                               51
      *_________________
      * Rubrik 31 och 32
      *"""""""""""""""""
     C                   EVAL      WVZV_VPNR=1
     C                   EVAL      WVZV_VASL=DKEV_315
     C                   EVAL      WVZV_GODM=DKEV_311
     C                   EVAL      UKD=DKEV_314
     C                   EVAL      UTYP='KLI'
     C                   EVAL      UIE='A'
     C     SVTKDKEY      CHAIN     SVTKD                              52
     C   52              EVAL      WVZV_KOSLT=*BLANKS
     C                   EVAL      ØN164=DKEV_313
     C                   EXSR      SRNE
     C     DKEV_314      IFEQ      'NE'
     C     DKEV_314      OREQ      'NF'
     C     DKEV_314      OREQ      'NG'
     C                   EVAL      WVZV_KOSLT=%trimr(ØAN)+' '+'delar' +
     C                                        ' ' + %trimr(DKEV_314) + ' ' +
     C                                        %trimr(SVKD_LBS)
     C                   ELSE
     C                   EVAL      WVZV_KOSLT=%trimr(ØAN) + ' ' +
     C                                        %trimr(DKEV_314) + ' ' +
     C                                        %trimr(SVKD_LBS)
     C                   ENDIF
     C                   WRITE     C

     C     CTAG          TAG
      *_______________
      * Rubrik 2 och 8
      *"""""""""""""""
     C                   WRITE     D
     C                   WRITE     E
     C                   WRITE     F
     C                   WRITE     D
     C                   WRITE     E
      *_________________
      * Rubrik 18 och 33
      *"""""""""""""""""
     C                   MOVEL     DKEV_331      WVZV_R33
     C                   WRITE     G
     C                   WRITE     D2
     C                   WRITE     E
      *________________
      * Rubrik 7 och 40
      *""""""""""""""""
     C                   EVAL      WVZV_R7='- - -'
     C                   EVAL      WVZV_R40=%trimr(DKEV_401A) + ' ' +
     C                                        %trimr(DKEV_402A) + ' ' +
     C                                        %trimr(DKEV_403A)
     C                   WRITE     H

     C     HTAG          TAG
     C                   WRITE     D
     C                   EVAL      *IN81=*ON
     C                   WRITE     E
      *____________
      * Rubrik 44-1
      *""""""""""""
     C*                  EVAL      UKD=DKEV_BIT1
     C*                  EVAL      UTYP='MCF'
     C*                  EVAL      UIE='A'
     C*    SVTKDKEY      CHAIN     SVTKD                              52
     C*  52              EVAL      SVKD_LBS=*BLANKS
     C                   EVAL      WVZV_S28='- - -'
     C                   EVAL      WVZV_R441A=%trimr(DKEV_445A) + ' ' +
     C                                        %trimr(DKEV_445B)
     C                   EVAL      WVZV_R441B=%trimr(DKEV_4422) + ' ' +
     C                                        %trimr(DKEV_442B)
     C                   WRITE     I

     C     DKEV_312B     IFEQ      *BLANKS
     C                   GOTO      ITAG
     C                   ENDIF
     C                   EVAL      WVZV_R312=*BLANKS
     C                   EVAL      WVZV_R312=DKEV_312B
     C                   WRITE     I

     C     DKEV_312C     IFEQ      *BLANKS
     C                   GOTO      ITAG
     C                   ENDIF
     C                   EVAL      WVZV_R312=*BLANKS
     C                   EVAL      WVZV_R312=DKEV_312C
     C                   WRITE     I

     C     DKEV_312D     IFEQ      *BLANKS
     C                   GOTO      ITAG
     C                   ENDIF
     C                   EVAL      WVZV_R312=*BLANKS
     C                   EVAL      WVZV_R312=DKEV_312D
     C                   WRITE     I

     C     DKEV_312E     IFEQ      *BLANKS
     C                   GOTO      ITAG
     C                   ENDIF
     C                   EVAL      WVZV_R312=*BLANKS
     C                   EVAL      WVZV_R312=DKEV_312E
     C                   WRITE     I

     C     ITAG          TAG
     C                   WRITE     D
     C                   EVAL      *IN82=*ON
     C                   EVAL      *IN83=*ON
     C                   WRITE     E
      *____________
      * Rubrik 44-2
      *""""""""""""
     C                   EVAL      UKD=DKEV_4421
     C                   EVAL      UTYP='SAL'
     C                   EVAL      UIE='A'
     C     SVTKDKEY      CHAIN     SVTKD                              52
     C   52              EVAL      SVKD_LBS=*BLANKS
     C                   EVAL      WVZV_R15A='- - -'
     C                   EVAL      WVZV_R17A='- - -'
     C                   EVAL      WVZV_R35=DKEV_35
     C                   EVAL      WVZV_R37=*BLANKS
     C                   EVAL      WVZV_R37=DKEV_37
     C                   EVAL      WVZV_R38=DKEV_38
     C                   EVAL      WVZV_R442A=*BLANKS
     C                   EVAL      WVZV_R442A=DKEV_442A + ' ' + SVKD_LBS
     C                   EVAL      WVZV_R4421=*BLANKS
     C                   EVAL      WVZV_R4421=DKEV_4421
     C                   EVAL      WVZV_R46=DKEV_46
     C                   EVAL      WVZV_R444=DKEV_444
     C                   WRITE     J
     C     JTAG          TAG
     C                   WRITE     D
     C                   EVAL      *IN83=*OFF
     C                   EVAL      *IN84=*ON
     C                   WRITE     E
      *____________
      * Rubrik 44-4
      *""""""""""""
     C*    DKEV_BETK     IFEQ      *BLANKS
     C                   EVAL      WVZV_S29='- - -'
     C*                  ELSE
     C*                  EVAL      WVZV_S29=*BLANKS
     C*                  EVAL      WVZV_S29=DKEV_BETK
     C*                  ENDIF
     C                   WRITE     K
     C                   EVAL      *IN86=*ON
     C                   WRITE     D
     C                   EVAL      *IN81=*OFF
     C                   EVAL      *IN82=*OFF
     C                   EVAL      *IN83=*OFF
     C                   EVAL      *IN84=*OFF
     C                   EVAL      *IN86=*OFF
     C                   WRITE     E

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Hæmta all containernummer                           SRB2 /
      *////////////////////////////////////////////////////////////
     C     SRB2          BEGSR
     C     KEYA          SETLL     DKEV
     C     KEYA          READE     DKEV                                   52
     C     *IN52         DOWEQ     *OFF
     C     DKEV_312A     IFNE      *BLANKS
     C                   ADD       1             X1                2 0
     C                   MOVE      DKEV_312A     A1(X1)
     C                   EVAL      *IN91=*ON
     C                   ENDIF
     C     DKEV_312B     IFNE      *BLANKS
     C                   ADD       1             X1
     C                   MOVE      DKEV_312B     A1(X1)
     C                   ENDIF
     C     DKEV_312C     IFNE      *BLANKS
     C                   ADD       1             X1
     C                   MOVE      DKEV_312C     A1(X1)
     C                   ENDIF
     C     DKEV_312D     IFNE      *BLANKS
     C                   ADD       1             X1
     C                   MOVE      DKEV_312D     A1(X1)
     C                   ENDIF
     C     DKEV_312E     IFNE      *BLANKS
     C                   ADD       1             X1
     C                   MOVE      DKEV_312E     A1(X1)
     C                   ENDIF
     C     DKEV_311      IFNE      *BLANKS
     C                   ADD       1             Y1                2 0
     C                   MOVE      DKEV_311      A2(Y1)
     C                   EVAL      *IN92=*ON
     C                   ENDIF
     C     KEYA          READE     DKEV                                   52
     C                   ENDDO
     C                   IF        *IN91
     C                   EVAL      WR31A='C O N T A I N E R ------>'
     C     1             DO        X1            Z1                2 0
     C                   MOVE      A1(Z1)        WR31A17          17
     C                   CAT       WR31A17:1     WR31A
     C                   IF        Z1=9
     C                   LEAVE
     C                   ENDIF
     C                   ENDDO
     C     10            DO        X1            Z1
     C                   MOVE      A1(Z1)        WR31A17
     C                   CAT       WR31A17:1     WR31B
     C                   IF        Z1=19
     C                   LEAVE
     C                   ENDIF
     C                   ENDDO
     C                   IF        *IN92
     C                   EVAL      WR31C='M Æ R K E N ------>'
     C     1             DO        Y1            Z1
     C                   MOVE      A2(Z1)        WR31A42          42
     C                   CAT       WR31A42:1     WR31C
     C                   IF        Z1=3
     C                   LEAVE
     C                   ENDIF
     C                   ENDDO
     C     4             DO        Y1            Z1
     C                   MOVE      A2(Z1)        WR31A42
     C                   CAT       WR31A42:1     WR31D
     C                   IF        Z1=8
     C                   LEAVE
     C                   ENDIF
     C                   ENDDO
     C     9             DO        Y1            Z1
     C                   MOVE      A2(Z1)        WR31A42
     C                   CAT       WR31A42:1     WR31E
     C                   IF        Z1=13
     C                   LEAVE
     C                   ENDIF
     C                   ENDDO
     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Linjer på tillæggsark (>1 varupost)                 SRB3 /
      *////////////////////////////////////////////////////////////
     C     SRB3          BEGSR
     C                   CALL      'DKZ004R'
     C                   PARM                    UKEHASYAV
     C                   PARM                    UKEHASYOP
     C                   PARM                    UCALLTYP
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Linjer på tillæggsark, tomma linjer på huvud        SRB4 /
      *////////////////////////////////////////////////////////////
     C     SRB4          BEGSR
     C                   EVAL      WVZV_VPNR=0
     C                   EVAL      DKEV_46=*ZEROS
     C                   EVAL      DKEV_38=*ZEROS
     C                   WRITE     C
     C                   WRITE     D
     C                   WRITE     E
     C                   EVAL      *IN87=*ON
     C                   WRITE     F
     C                   WRITE     D
     C                   WRITE     E
     C                   WRITE     G
     C                   WRITE     D2
     C                   WRITE     E
     C                   WRITE     H
     C                   WRITE     D
     C                   EVAL      *IN81=*ON
     C                   WRITE     E
     C                   WRITE     I
     C                   WRITE     D
     C                   EVAL      *IN82=*ON
     C                   EVAL      *IN83=*ON
     C                   WRITE     E
     C                   WRITE     J
     C                   WRITE     D
     C                   EVAL      *IN83=*OFF
     C                   EVAL      *IN84=*ON
     C                   WRITE     E
     C                   WRITE     K
     C                   EVAL      *IN86=*ON
     C                   WRITE     D
     C                   EVAL      *IN81=*OFF
     C                   EVAL      *IN82=*OFF
     C                   EVAL      *IN83=*OFF
     C                   EVAL      *IN84=*OFF
     C                   EVAL      *IN86=*OFF
     C                   WRITE     E
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Venstrestill numeriske verdier                      SRNE /
      *////////////////////////////////////////////////////////////
     C     SRNE          BEGSR
      * Flytte in rett verdi i Alfa 12-felt
     C                   MOVE      *ZEROS        ØA17
     C     ØA164D        IFEQ      '0000'                                       <-------------I
     C                   MOVE      ØA164H        ØA17                                         I
     C                   ELSE                                                   <-------------I
     C                   MOVEL     ØA164H        ØA17                                         I
     C                   MOVE      ',    '       ØA17                                         I
     C                   MOVE      ØA164D        ØA17                                         I
     C     Ø17(17)       IFEQ      '0'
     C                   MOVE      ' '           Ø17(17)
     C     Ø17(16)       IFEQ      '0'
     C                   MOVE      ' '           Ø17(16)
     C                   END
     C                   END
     C                   END                                                    <-------------I
      * lete fra venstre og finn foerste siffer over 0
     C     1             DO        16            ØX                             <-------------I
     C     Ø17(ØX)       IFNE      '0'                                           <-----------II
     C     Ø17(ØX)       IFEQ      ','                                           <-----------II
     C                   SUB       1             ØX
     C                   ENDIF                                                   <-----------II
     C                   GOTO      SRNE1                                                     II
     C                   END                                                     <-----------II
     C                   END                                                    <-------------I
     C     SRNE1         TAG
      * Venstrestill til et nytt felt
     C                   MOVE      *BLANKS       ØAN
     C                   MOVEA     Ø17(ØX)       ØAN
      *
     C                   ENDSR
