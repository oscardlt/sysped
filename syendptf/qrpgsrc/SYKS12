      **************************************************************
      *** PROGRAM SKAL VEDLIKEHOLDE REKVISISJON                  ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER       ***
      **************************************************************
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 RETTELSE ETTER UTVIDELSE AV OPPDRAGSNR
10XXX * 02 SH  PTF10 test oppdrtagsnummer
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * 03 JOV PTF11 Opt O/F = se oppdrag/faktura
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
10XXX * 04 JOV PTF12 F4 i beløp = kalkulator
12136 * 05 JOV PTF12 Må bekrefte med F23 dersom en ignorerer Budsjettpost
      * 06 JOV PTF12 Når en plukke budsjettpost - ta vara på originalt budsjettert beløp
********************************************************************
      *
     FKOSTA     IF   E           K DISK
     FKOSTA14   IF   E           K DISK
     F                                     RENAME(KOSTAR:KOST14R)
     FKOSTT     UF A E           K DISK
     FKOSBU     UF A E           K DISK
     FKOSBU1    IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSB1R)
     FKOSBU2    IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSB2R)
     FKOSBU3    IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSB3R)
     FKOSBU4    IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSB4R)
     FKOSBU5    IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSB5R)
     FKOSBU6    IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSB6R)
     FKOSBU7    IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSB7R)
     FKOSBU9    IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSB9R)
     FKOSBU14   IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSB14R)
     FKOSBU15   IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSB15R)
N06  FKOSBUX    UF A E           K DISK
     FTURER     UF   E           K DISK
     FTURER14   IF   E           K DISK
     F                                     RENAME(TURERR:TUR14R)
     FDISP      IF   E           K DISK
     FTRAN      IF   E           K DISK
     FUNITL01   IF   E           K DISK
     FHEADF     UF   E           K DISK
     FHEAD11    IF   E           K DISK
     F                                     RENAME(HEADFR:HEA11R)
     FKODTGE    IF   E           K DISK
     FKODTG2    IF   E           K DISK
     FKODTÅ     IF   E           K DISK
     FLEVEL01   IF   E           K DISK
     FVALUL01   IF   E           K DISK
     FFIRM      IF   E           K DISK
     FFAK2      IF   E           K DISK
     FHETRIU    UF A E           K DISK
     FSYKS12FM  CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
     D FBAREA          DS
     D  WSID                 197    206
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  KABDT                  1      8  0
     D  KABDTÅ                 1      4  0
     D  KABDTM                 5      6  0
     D  KABDTD                 7      8  0
     D                 DS
     D  HEDTOP                 1      8  0
     D  HEDTÅ                  1      4  0
     D  HEDTM                  5      6  0
     D  HEDTD                  7      8  0
     D                 DS
     D  W1FED1                 1      6  0
     D  WS1DTD                 1      2  0
     D  WS1DTM                 3      4  0
     D  WS1DTÅ                 5      6  0
     D                 DS
     D  X1FED1                 1      8  0
     D  XS1DTÅ                 1      4  0
     D  XS1DTM                 5      6  0
     D  XS1DTD                 7      8  0
     D                 DS
     D  W1FED2                 1      6  0
     D  WS2DTD                 1      2  0
     D  WS2DTM                 3      4  0
     D  WS2DTÅ                 5      6  0
     D                 DS
     D  X1FED2                 1      8  0
     D  XS2DTÅ                 1      4  0
     D  XS2DTM                 5      6  0
     D  XS2DTD                 7      8  0
     D                 DS
     D  WSFEDT                 1      6  0
     D  WSFEDD                 1      2  0
     D  WSFEDM                 3      4  0
     D  WSFEDÅ                 5      6  0
     D                 DS
     D  BUFEDT                 1      8  0
     D  BUFEDÅ                 1      4  0
     D  BUFEDM                 5      6  0
     D  BUFEDD                 7      8  0
     D                 DS
     D  XXFEDT                 1      6  0
     D  XXFEDD                 1      2  0
     D  XXFEDM                 3      4  0
     D  XXFEDÅ                 5      6  0
     D                 DS
     D  BUDPER                 1      6  0
     D  WSPCC                  1      2  0
     D  WSPÅR                  3      4  0
     D  WSPMN                  5      6  0
     D                 DS
     D  MINPER                 1      6  0
     D  KOÅCC                  1      2  0
     D  KOÅÅR                  3      4  0
     D  KOÅMND                 5      6  0
     D                 DS
     D  HESDF                  1      5
     D  HESDFF                 7     11
     D  INNHDS                 1     11
     D                 DS
     D  HESDVT                 1      5
     D  HESDT                  7     11
     D  UTKJDS                 1     11
     D                 DS
     D  BUTXT                  1     35
     D  DSAVD                 14     17
     D  DSOPD                 19     25
     D  BUTXTT                 1      7
     D  BUTX_7                29     35
     D                 DS
     D  PARMDS                 1    256
     D  U1FLAG                 1      1
     D  U1BNR                  2      8  0
     D  U1TAVD                 9     12  0
     D  U1TUNR                13     20  0
     D  U1OAVD                21     24  0
     D  U1OPD                 25     31  0
     D  U1BL                  32     44  2
     D  U1GN                  45     63
     D  U1KDM                 64     64
      *
     D                 DS
     D  DSW1N                  1     52
     D  DSW1A                101    122
     D  DSW1                   1    122
     D  W1LNR                  1      8  0
     D  WXFED1                 9     14  0
     D  W1TNR                 15     22  0
     D  W1TUNR                23     30  0
     D  W1BNR                 31     37  0
     D  WXFED2                38     43  0
     D  W1OAVD                44     47  0
     D  W1OPD                 48     54  0
     D  W1BIL1               101    110
     D  W1BIL2               111    120
     D  W1BUST               121    121
     D  W1FEYN               122    122
     D                 DS
     D  DSGMN                  1     52
     D  DSGMA                101    122
     D  DSGM                   1    122
     D  GMLNR                  1      8  0
     D  GMFED1                 9     14  0
     D  GMTNR                 15     22  0
     D  GMTUNR                23     30  0
     D  GMBNR                 31     37  0
     D  GMFED2                38     43  0
     D  GMOAVD                44     47  0
     D  GMOPD                 48     54  0
     D  GMBIL1               101    110
     D  GMBIL2               111    120
     D  GMBUST               121    121
     D  GMFEYN               122    122
     D LDADTA          DS
     D  UDSFIR                 1      2
     D  UDSAVD                15     18  0
     D  UDSAVA                15     18
     D  UUSG                  19     21
     C*
     C                   EXSR      INIT
     C     SKIPP         CABEQ     'J'           START0
     C*
     C*
     C     CHOISE        TAG
     C                   EXSR      KDTFM1
     C                   EXFMT     BILDE1
     C                   EXSR      KDTFM1
     C   03              GOTO      SLUTT
     C* SØK ETTER TUR PLUKK
     C   04              DO
     C                   EXSR      SØKDTA
     C                   GOTO      CHOISE
     C                   END
     C* TEST BILDE
     C     START0        TAG
     C                   EXSR      TESTB0
     C   30              GOTO      CHOISE
     C*
     C* HVIS EN KOM VIA "TVUNGEN INNGANG" GI MELDING TIL BRUKER
     C* (MELDINGEN ER FORBEREDT I TESTB0...)
     C     OKMSG         IFEQ      'X'
     C                   MOVE      'Y'           OKMSG
     C                   SETON                                        30
     C                   END
     C*
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
     C                   Z-ADD     *ZEROS        ANTSFL            2 0
     C     STARTB        TAG
     C* 51 ON : BILAGSNR (REKVNR)        -  KOSBU1 = BUST/BUBNR
     C* 52 ON : AVD/TURNR                -  KOSBU2 = BUST/BUTAVD/BUTUNR....
     C* 53 ON : LEVER. (UTEN BILNR/DATO) -  KOSBU3 = BUST/BULNR
     C* 53/60 : LEVER./FRITEKST(AWBNR)   -  KOSBU14= BUST/BULNR/BUTXT
     C* 54 ON : TRANSPORTØR NR           -  KOSBU4 = BUST/BUTRN....
     C* 55 ON : HENFØRT KOSTADSBILAGSNR  -  KOSBU5 = BUBNR2
     C* 56 ON : LEVER. + BILNR/DATO      -  KOSBU6 = BUST/BULNR/BUBILN/BUFED
     C* 57 ON : BILNUMMER + DATO         -  KOSBU7 = BUST/BUBILN/BUFED
     C* 57/60 : FRITEKST (AWBNR)         -  KOSBU15= BUST/BUTXT
     C* 59 ON : AVDELING  + OPPDRAGSNR   -  KOSBU9 = BUST/BUBILN/BUFED
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C   51KOS1K         SETLL     KOSBU1
     C   52KOS2K         SETLL     KOSBU2
     C   53
     CANN60KOS3K         SETLL     KOSBU3
     C   53
     CAN 60KOS14K        SETLL     KOSBU14
     C   54KOS4K         SETLL     KOSBU4
     C   55W1KBNR        SETLL     KOSBU5                             94
     C   56KOS6K         SETLL     KOSBU6
     C   57
     CANN60KOS7K         SETLL     KOSBU7
     C   57
     CAN 60KOS15K        SETLL     KOSBU15
     C   59KOS9K         SETLL     KOSBU9
     C     START1        TAG
     C   51              READ      KOSBU1                                 94
     C   52              READ      KOSBU2                                 94
     C   53
     CANN60              READ      KOSBU3                                 94
     C   53
     CAN 60              READ      KOSBU14                                94
     C   54              READ      KOSBU4                                 94
     C   55
     CANN94W1KBNR        READE     KOSBU5                                 94
     C   56              READ      KOSBU6                                 94
     C   57
     CANN60              READ      KOSBU7                                 94
     C   57
     CAN 60              READ      KOSBU15                                94
     C   59              READ      KOSBU9                                 94
     C  N94
     CANN55BUST          COMP      W1BUST                             94
     C  N94
     CAN 52BUTUNR        COMP      W1TUNR                             94
     C  N94
     CAN 53W1LNR         IFNE      *ZEROS
     C     BULNR         COMP      W1LNR                              94
     C                   END
     C  N94
     CAN 54BUTNR         COMP      W1TNR                              94
     C  N94
     CAN 56BULNR         COMP      W1LNR                              94
     C  N94
     CAN 56W1BIL1        IFNE      *BLANKS
     C     BUBILN        COMP      W1BIL1                             94
     C                   END
     C     *IN60         IFEQ      *OFF
     C  N94
     CAN 57BUBILN        COMP      W1BIL2                             94
     C                   ELSE
     C  N94
     CAN 57
     CAN 95BUTXT         COMP      W1TXT2                             94        95="KASTET INN"
     C                   END
     C  N94
     CAN 59BUOAVD        COMP      W1OAVD                             94
     C  N94
     CAN 59BUOPD         COMP      W1OPD                              94
     C* DESOM Y(J)/N FOR VIS FERGE- SJEKK O RIKTIG TYPE REKV.
     C  N94W1FEYN        IFEQ      'Y'
     C     W1FEYN        OREQ      'J'
     C     BUFER         IFNE      'F'
     C                   GOTO      START1
     C                   END
     C                   ELSE
     C     W1FEYN        IFEQ      'N'
     C     BUFER         ANDEQ     'F'
     C                   GOTO      START1
     C                   END
     C                   END
      * Når en arbeider med plukk til et bilagsnr skal de som alt
      * er plukket ikke vises uten at en aktivt ber om det.....
     C  N94*IN55         IFNE      '1'                                          B1
     C     W1KBNR        ANDNE     *ZEROS
     C     BUBNR2        IFNE      *ZEROS                                        B2
      * Plukket... Til dette bilag... Vis??
     C     BUBNR2        IFEQ      W1KBNR                                         B3
     C     W1VIS1        IFNE      'J'                                             B4
     C     W1VIS1        ANDNE     'Y'
     C                   GOTO      START1
     C                   END                                                       E4
     C                   ELSE                                                     X3
      * Plukket... Til annet bilag... Vis??
     C     W1VIS2        IFNE      'J'                                             B4
     C     W1VIS2        ANDNE     'Y'
     C                   GOTO      START1
     C                   END                                                       E4
     C                   END                                                      E3
     C                   END                                                     E2
     C                   END                                                    E1
      *
     C     START2        TAG
      *
     C  N94              DO
     C     ANTSFL        DOWLT     5
     C                   ADD       1             ANTSFL
     C                   ADD       1             ZRECNO
     C                   MOVE      BUKDM         XXKDM
     C                   EXSR      KDTFM2
     C     BUST          COMP      ' '                                3232
     C   32BUST          COMP      'S'                                3232
     C     BUST          IFEQ      'D'
     C                   EXSR      SUMDUP
     C                   END
     C     W1KBNR        COMP      *ZEROS                             3131
     C   31W1KBNR        COMP      BUBNR2                                 31
     C     LEVEFK        CHAIN     LEVEL01                            33
     C   33              MOVE      *BLANKS       LNAVN
     C     TRANKF        CHAIN     TRAN                               33
     C   33              MOVE      *BLANKS       VMNAVN
     C                   WRITE     SUBFIL
     C     STAR22        TAG
     C   51              READ      KOSBU1                                 94
     C   52              READ      KOSBU2                                 94
     C   53
     CANN60              READ      KOSBU3                                 94
     C   53
     CAN 60              READ      KOSBU14                                94
     C   54              READ      KOSBU4                                 94
     C   55W1KBNR        READE     KOSBU5                                 94
     C   56              READ      KOSBU6                                 94
     C   57
     CANN60              READ      KOSBU7                                 94
     C   57
     CAN 60              READ      KOSBU15                                94
     C   59              READ      KOSBU9                                 94
     C  N94
     CANN55BUST          COMP      W1BUST                             94
     C  N94
     CAN 52BUTUNR        COMP      W1TUNR                             94
     C  N94
     CAN 53W1LNR         IFNE      *ZEROS
     C     BULNR         COMP      W1LNR                              94
     C                   END
     C  N94
     CAN 54BUTNR         COMP      W1TNR                              94
     C  N94
     CAN 56BULNR         COMP      W1LNR                              94
     C  N94
     CAN 56W1BIL1        IFNE      *BLANKS
     C     BUBILN        COMP      W1BIL1                             94
     C                   END
     C     *IN60         IFEQ      *OFF
     C  N94
     CAN 57BUBILN        COMP      W1BIL2                             94
     C                   ELSE
     C  N94
     CAN 57
     CAN 95BUTXT         COMP      W1TXT2                             94        95="KASTET INN"
     C                   END
     C  N94
     CAN 59BUOAVD        COMP      W1OAVD                             94
     C  N94
     CAN 59BUOPD         COMP      W1OPD                              94
     C  N94W1FEYN        IFEQ      'Y'
     C     W1FEYN        OREQ      'J'
     C     BUFER         IFNE      'F'
     C                   GOTO      STAR22
     C                   END
     C                   ELSE
     C     W1FEYN        IFEQ      'N'
     C     BUFER         ANDEQ     'F'
     C                   GOTO      STAR22
     C                   END
     C                   END
      * Når en arbeider med plukk til et bilagsnr skal de som alt
      * er plukket ikke vises uten at en aktivt ber om det.....
     C  N94*IN55         IFNE      '1'                                          B1
     C     W1KBNR        ANDNE     *ZEROS
     C     BUBNR2        IFNE      *ZEROS                                        B2
      * Plukket... Til dette bilag... Vis??
     C     BUBNR2        IFEQ      W1KBNR                                         B3
     C     W1VIS1        IFNE      'J'                                             B4
     C     W1VIS1        ANDNE     'Y'
     C                   GOTO      STAR22
     C                   END                                                       E4
     C                   ELSE                                                     X3
      * Plukket... Til annet bilag... Vis??
     C     W1VIS2        IFNE      'J'                                             B4
     C     W1VIS2        ANDNE     'Y'
     C                   GOTO      STAR22
     C                   END                                                       E4
     C                   END                                                      E3
     C                   END                                                     E2
     C                   END                                                    E1
     C*
     C  N94              END
     C                   END
     C*
     C* INDIKATOR 50 ON - "*" = ALLE STATUSER ER VALGT
     C* GÅ TIL NESTE STATUS (MEN BARE DERSOM ALLE AV FOREGÅENDE LEST)
     C   50
     CAN 94
     CANN55W1BUST        IFEQ      ' '
     C                   MOVE      'F'           W1BUST
     C                   GOTO      STARTB
     C                   END
     C   50
     CAN 94
     CANN55W1BUST        IFEQ      'F'
     C                   MOVE      'A'           W1BUST
     C                   GOTO      STARTB
     C                   END
     C   50
     CAN 94
     CANN55W1BUST        IFEQ      'A'
     C                   MOVE      'D'           W1BUST
     C                   GOTO      STARTB
     C                   END
     C   50
     CAN 94
     CANN55W1BUST        IFEQ      'D'
     C                   MOVE      'S'           W1BUST
     C                   GOTO      STARTB
     C                   END
     C   50
     CAN 94
     CANN55W1BUST        IFEQ      'S'
     C                   MOVE      'I'           W1BUST
     C                   GOTO      STARTB
     C                   END
      * FERDIG MED ALLE,VIDERE/KLARGJØRE STATUS FOR EVT F5
     C   50
     CAN 94
     CANN55              MOVE      ' '           W1BUST
     C*
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     2             POSNBR
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   Z-ADD     4             POSNBR
     C                   EXFMT     NYWRK
     C                   ELSE
     C                   WRITE     SUBCTL
     C                   EXFMT     BUNN
     C                   END
     C*
S05   * FLYTTET .. VASEL SLÅS AV KUN DERSOM EN PLUKKER MINST EN POST
S05  C* EVT MELDING OM HVORFOR BRUKER ER KASTET INN I SYKS12 ER NÅ GITT
S05  C* SLÅ AV RØDINDIKATOR FOR HEADING OG MELDING
s05  C*                  MOVE      *OFF          *IN95
     C***
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   END
     C***
     C*
     C                   SETOFF                                       9899
     C*
     C*** AVSLUTT
S05  C*  03              GOTO      SLUTT
N05  c                   if        *in03 = *on
N05  c                   if        *in95 = *off                                 normal
N05  c                   goto      SLUTT
N05  c                   else                                                   "kastet inn" pga bud
N05  C                   EXFMT     BEKREFTF3
N05  C   12              GOTO      START3
N05  C   23              GOTO      SLUTT
N05  c                   endif
N05  c                   endif
     C*
     C*** FRISK OPP
     C     *IN05         IFEQ      *ON
     C     *IN50         ANDEQ     *ON
     C                   MOVE      ' '           W1BUST
     C                   END
     C   05              GOTO      START
S05   * FLYTTET LENGER NED
S05  C* EVT MELDING OM HVORFOR BRUKER ER KASTET INN I SYKS12 ER NÅ GITT
S05  C* SLÅ AV RØDINDIKATOR FOR HEADING OG MELDING
s05  C*                  MOVE      *OFF          *IN95
      ** BYTT MODUS
     C     *IN02         IFEQ      '1'                                          B1
     C     *IN97         ANDEQ     '1'
     C*Hvis en er i plukkmodus for et visst bilag betyr Frisk opp
     C* å switche mellom Vis hittil plukket/sist brukte utvalg
     C     *IN55         IFEQ      '1'
      * 55 ER ON: Fra VIS PLUKKET -> VIS SØKEUTVALG
     C                   MOVE      DSGM          DSW1
     C                   MOVE      WXFED1        W1FED1
     C                   MOVE      WXFED2        W1FED2
     C                   ELSE
      * 55 ER OFF: Fra VIS SØKEUTValg -> VIS PLUKKET
     C                   MOVE      *ZEROS        DSW1N
     C                   MOVE      *BLANKS       DSW1A
     C                   MOVE      *ZEROS        W1FED1
     C                   MOVE      *ZEROS        W1FED2
     C                   END                                                      E3
     C                   EXSR      TESTB0
     C                   GOTO      START
     C                   END                                                    E1
      *
      * BYTTE MODUS TIL/FRA AWB-NR.SORTERING
     C     *IN07         IFEQ      '1'                                          B1
     C                   MOVE      *BLANKS       W1TXT1
     C                   MOVE      *BLANKS       W1TXT2
     C                   MOVE      *BLANKS       W1BIL1
     C                   MOVE      *BLANKS       W1BIL2
     C                   MOVE      *ZEROS        W1FED1
     C                   MOVE      *ZEROS        W1FED2
     C     *IN60         IFEQ      '1'
      * 60 ER ON: Fra AWB MODUS ---> NORMAL SØK
     C     U1FLAG        IFEQ      'K'
     C     W1LNR         ANDEQ     *ZEROS
     C                   Z-ADD     KALNR         W1LNR
     C                   END
     C                   MOVE      '0'           *IN60
     C                   ELSE
      * 60 ER OFF: Fra NORMAL SØK  -> AWBNR-MODUS (EVT. M/INPUT-AWB.NR)
     C     W1LNR         IFNE      *ZEROS
     C     U1GN          IFEQ      *BLANKS
     C                   MOVEL     'AWB:'        W1TXT1
     C                   ELSE
     C                   MOVEL     U1GN          W1TXT1
     C                   END
     C                   ELSE
     C     U1GN          IFEQ      *BLANKS
     C                   MOVEL     'AWB:'        W1TXT2
     C                   ELSE
     C                   MOVEL     U1GN          W1TXT2
     C                   END
     C                   END
     C                   MOVE      '1'           *IN60
     C                   END
     C                   EXSR      TESTB0
     C                   GOTO      START
     C                   END                                                    E1
     C*
     C*** LAGE NY
     C   06              DO
     C                   MOVE      *OFF          *IN30
     C                   MOVE      'DIV0000'     MSGNR
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     14            POSNBR
     C                   EXSR      MOVB2
     C                   GOTO      START5
     C                   END
     C*** DIVERSEBOOKING FERJE
     C   09              DO
     C                   MOVE      'Y'           XXKOST
     C                   CALL      'SYTR15'
     C                   PARM                    XXKOST
     C                   GOTO      START
     C                   END
     C*** FOREGÅENDE BILDE / NYTT SØK
     C   08              EXSR      MOVB0
     C   08              GOTO      CHOISE
     C*
     C*** BLA VIDERE
     C   25              DO
     C                   SETOFF                                       25
     C                   Z-ADD     YRECNO        ZRECNO
     C                   MOVE      *ZEROS        ANTSFL
     C   51
     CANN94              READP     KOSBU1                                 94
     C   52
     CANN94              READP     KOSBU2                                 94
     C   53
     CANN94
     CANN60              READP     KOSBU3                                 94
     C   53
     CANN94
     CAN 60              READP     KOSBU14                                94
     C   54
     CANN94              READP     KOSBU4                                 94
     C   55
     CANN94W1KBNR        READPE    KOSBU5                                 94
     C   56
     CANN94              READP     KOSBU6                                 94
     C   57
     CANN94
     CANN60              READP     KOSBU7                                 94
     C   57
     CANN94
     CAN 60              READP     KOSBU15                                94
     C   59
     CANN94              READP     KOSBU9                                 94
     C     STAR23        TAG
     C   51
     CANN94              READ      KOSBU1                                 94
     C   52
     CANN94              READ      KOSBU2                                 94
     C   53
     CANN94
     CANN60              READ      KOSBU3                                 94
     C   53
     CANN94
     CAN 60              READ      KOSBU14                                94
     C   54
     CANN94              READ      KOSBU4                                 94
     C   55
     CANN94W1KBNR        READE     KOSBU5                                 94
     C   56
     CANN94              READ      KOSBU6                                 94
     C   57
     CANN94
     CANN60              READ      KOSBU7                                 94
     C   57
     CANN94
     CAN 60              READ      KOSBU15                                94
     C   59
     CANN94              READ      KOSBU9                                 94
     C  N94
     CANN55BUST          COMP      W1BUST                             94
     C  N94
     CAN 52BUTUNR        COMP      W1TUNR                             94
     C  N94
     CAN 53W1LNR         IFNE      *ZEROS
     C     BULNR         COMP      W1LNR                              94
     C                   END
     C  N94
     CAN 54BUTNR         COMP      W1TNR                              94
     C  N94
     CAN 56BULNR         COMP      W1LNR                              94
     C  N94
     CAN 56W1BIL1        IFNE      *BLANKS
     C     BUBILN        COMP      W1BIL1                             94
     C                   END
     C  N94
     CAN 57
     CANN60BUBILN        COMP      W1BIL2                             94
     C  N94
     CAN 59BUOAVD        COMP      W1OAVD                             94
     C  N94
     CAN 59BUOPD         COMP      W1OPD                              94
     C  N94W1FEYN        IFEQ      'Y'
     C     W1FEYN        OREQ      'J'
     C     BUFER         IFNE      'F'
     C                   GOTO      STAR23
     C                   END
     C                   ELSE
     C     W1FEYN        IFEQ      'N'
     C     BUFER         ANDEQ     'F'
     C                   GOTO      STAR23
     C                   END
     C                   END
     C*
     C                   GOTO      START2
     C                   END
     C*
     C     ZRECNO        IFNE      0
     C                   EXSR      HENTSR
     C                   END
     C   98XRECNO        IFNE      0
     C                   Z-ADD     XRECNO        ZRECNO
     C                   END
     C*
     C*
     C                   GOTO      START3
     C*
     C*** LAGE NY
     C     START5        TAG
     C                   EXSR      KDTFM4
     C                   EXFMT     VARELI
     C                   EXSR      KDTFM4
     C                   SETOFF                                       309089
     C   04              DO
     C                   EXSR      SØKDT2
     C                   GOTO      START5
     C                   END
     C   12              EXSR      MOVB2
     C  N12              EXSR      TESTB1
     C  N12
     CAN 30              GOTO      START5
      * VARSEL VED J=JUSTER
     C  N12BUBLST        IFEQ      'J'
      * NEGATIVT BELØP ER TREKK (PÅ PARTEN ANGITT I TRANS)
     C     BUBL          IFLT      0
     C                   MOVE      'JOV1320'     MSGNR
     C                   ELSE
     C                   MOVE      'JOV1321'     MSGNR
     C                   END
     C                   SETON                                        30
     C                   END
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   GOTO      START3
     C*
     C*
     C     SLUTT         TAG
     C*
     C* RETURNER PARAMETRE..../ OPPDATER LDA
     C                   MOVE      PARMDS        UUPARM
     C                   OUT       LDADTA
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     SØKDTA        BEGSR
     C***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
     C***
     C                   SETOFF                                       30
     C* LEVERANDØR
     C     LINNBR        IFEQ      8
     C     POSNBR        IFGE      29
     C     POSNBR        ANDLE     37
      * W1LNR inngår nå i DS - Unngå Desim data error -> XXLNR
     C                   Z-ADD     W1LNR         XXLNR             8 0
     C                   MOVE      *BLANKS       UUSNAV           30
     C                   CALL      'SO1LEV'
     C                   PARM                    XXLNR
     C                   PARM                    FIFIRM
     C                   PARM                    UUSNAV
     C                   Z-ADD     XXLNR         W1LNR
     C                   END
     C     POSNBR        IFGE      38
     C     POSNBR        ANDLE     47
     C                   CALL      'SYTR19'
     C                   PARM                    W1BIL1
     C                   END
     C                   GOTO      SLSØK1
     C                   END
     C* TRANSPORTØRNR
     C     LINNBR        IFEQ      9
     C                   CALL      'SYTR04A'
     C     W1TNR         PARM      W1TNR         UTRNR             8 0
     C                   GOTO      SLSØK1
     C                   END
     C*
     C*TURER
     C     LINNBR        IFEQ      10
     C                   MOVE      'N'           UIMP              1
     C                   MOVE      'N'           U10               1
     C                   MOVE      *ZEROS        XOPD              7 0
      * MANGE PARAMETERENDRINGER - GAMLE LINJER SLETTET(IKKE STJERNET)
     C                   MOVE      'O'           USPØR             1
     C                   MOVE      0             UFLAGG
     C                   MOVE      *ZEROS        XXRUND
     C                   Z-ADD     W1TUNR        XXTUNR
     C                   MOVE      UDSAVD        XXAVD
     C                   CALL      'SYTR88'
     C                   PARM                    XXTUNR
     C                   PARM                    XXRUND
     C                   PARM                    XXAVD
     C                   PARM                    XOPD
     C                   PARM                    USPØR
     C                   PARM                    UFLAGG
     C     XXTUNR        IFNE      *ZEROS
     C                   MOVE      XXAVD         UDSAVD
     C                   Z-ADD     XXTUNR        W1TUNR            8 0
     C                   END
     C                   GOTO      SLSØK1
     C                   END
     C*
     C* VIS MELDING OM FEIL CURSORPOSISJON
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     29            POSNBR
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
     C*
     C     SLSØK1        ENDSR
     C*
     C***********************************************
     C     SØKDT2        BEGSR
     C***********************************************
     C***
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   END
     C***
     C* VAREKODE
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDGE     16
     C     POSNBR        ANDLE     18
     C                   CALL      'SYFI10D'
     C                   PARM                    WSVK
     C                   Z-ADD     20            POSNBR
     C                   GOTO      SLSØK2
     C                   END
N04  C* Beløp/KALKULATOR VERDI
N04  C     LINNBR        IFEQ      22
N04  C     POSNBR        ANDGE     20
N04  C     POSNBR        ANDLE     30
N04  C                   Z-ADD     WSBL          UNU133           13 3
N04  C                   CALL      'SYGE11'
N04  C                   PARM                    UNU133
N04  C                   Z-ADD(H)  UNU133        WSBL
N04  C                   Z-ADD     32            POSNBR
N04  C                   GOTO      SLSØK2
N04  C                   END
     C* VALUTAKODE
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDGE     32
     C     POSNBR        ANDLE     34
     C                   MOVE      'J'           USØK              1
     C                   CALL      'V200SY'
     C                   PARM                    USØK
     C                   PARM                    WSVAL
     C                   Z-ADD     36            POSNBR
     C                   GOTO      SLSØK2
     C                   END
     C* LEVERANDØR
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDGE     36
     C     POSNBR        ANDLE     43
     C                   MOVE      *BLANKS       UUSNAV           30
     C                   CALL      'SO1LEV'
     C                   PARM                    WSLNR
     C                   PARM                    FIFIRM
     C                   PARM                    UUSNAV
     C                   Z-ADD     45            POSNBR
     C                   GOTO      SLSØK2
     C                   END
     C* BILNR
     C     LINNBR        IFEQ      23
     C     POSNBR        ANDGE     40
     C     POSNBR        ANDLE     49
     C                   CALL      'SYTR19'
     C                   PARM                    WSBILN
     C                   Z-ADD     51            POSNBR
     C                   GOTO      SLSØK2
     C                   END
     C*
     C* TRANSPORTØRNR
     C     LINNBR        IFEQ      23
     C     POSNBR        ANDGE     60
     C     POSNBR        ANDLE     67
     C                   CALL      'SYTR04A'
     C                   PARM                    WSTNR
     C                   Z-ADD     14            POSNBR
     C                   GOTO      SLSØK2
     C                   END
     C*
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
     C*
     C     SLSØK2        ENDSR
     C*
     C***********************************************
     C     SUMDUP        BEGSR
     C***********************************************
     C     DSAVD         IFGE      '0000'
     C     DSAVD         ANDLE     '9999'
     C                   MOVE      DSAVD         FAAVD
     C                   ELSE
     C                   MOVE      *ZEROS        FAAVD
     C                   END
     C     DSOPD         IFGE      '0000000'
     C     DSOPD         ANDLE     '9999999'
     C                   MOVE      DSOPD         FAOPD
     C                   ELSE
     C                   MOVE      *ZEROS        FAOPD
     C                   END
      *
     C     FAAVD         IFNE      0
     C     FAOPD         ANDNE     *ZEROS
     C                   MOVE      *ZEROS        BUBL
     C     FAK2K         CHAIN     FAK2                               33
     C     *IN33         DOWNE     '1'
     C                   ADD       FABELN        BUBL
     C     FAK2K         READE     FAK2                                   33
     C  N33              END
     C                   END
     C                   ENDSR
     C***********************************************
     C     TESTB0        BEGSR
     C***********************************************
     C*
     C                   SETOFF                                       30
     C                   MOVEA     '00000000'    *IN(70)
     C* TLLATE PLUKKE/ATTESTERE TIL BILAGSNR....
     C     W1KBNR        IFEQ      *ZEROS                                        B1
     C                   MOVE      *OFF          *IN97
     C                   ELSE                                                    X1
     C                   MOVE      *ON           *IN97
     C     W1KBNR        IFNE      GMKBNR                                         B2
     C*  - FINN HITTIL ATTESTERT FOR BILAGET
     C                   MOVE      *ZEROS        XXBUBL           13 2
     C     W1KBNR        CHAIN     KOSTA                              72
      * Hvis ikke tilslag på Innreg.nr/ prøv om det er endelig BNR
     C     *IN72         IFEQ      '1'                                             B3
     C     W1KBNR        CHAIN     KOSTA14                            72
     C     *IN72         IFEQ      '0'                                             B3
     C                   MOVE      KABNR         W1KBNR
     C                   END
     C                   END
     C* Evt. avvikende moms kan en kun ta stilling til hvis bilagsdato
     C     *IN72         IFEQ      '0'                                             B3
     C     KABDT         IFNE      *ZEROS                                           B4
     C                   MOVE      UFITAX        FITAX
     C     FITAXD        IFNE      *ZEROS                                            B5
     C     FITAX2        ANDNE     *ZEROS
     C     KABDT         ANDLT     FITAXD
     C                   MOVE      FITAX2        FITAX
     C                   END                                                         E5
     C                   END                                                        E4
     C     FITAX         ADD       1             FITAXN            5 4
     C*
      * NÅR KOSTNADSBILAGETS MVA ER ' ' TILLATES OVERSTYRING AV DFT
     C     KAMVA         IFNE      ' '
     C                   SETON                                        96
     C     KAMVA         IFEQ      'P'
     C     KAMVA         OREQ      '+'
     C                   MOVE      'J'           W1MVA
     C                   END
     C     KAMVA         IFEQ      'F'
     C                   MOVE      'N'           W1MVA
     C                   END
     C                   ELSE
     C                   SETOFF                                       96
     C                   END
      *
     C     KALNR         IFNE      *ZEROS                                           B4
     C                   MOVE      KALNR         W1LNR                           *SØKEVEI
     C                   END                                                        E4
      * STATUS ULIK BLANK/A/B - IKKE TILLAT PLUKK-OPTION
      * SØKEVEI/UTVALG BLIR DA HVA SOM ER ATTESTERT - IKKE ÅPNE PÅ LEV.
     C     KAST          IFGT      'B'                                              B4
     C                   MOVE      *OFF          *IN97
     C                   MOVE      *ZEROS        W1LNR                           *SØKEVEI
     C                   END                                                        E4
     C                   MOVE      KAVAL         XXVAL             3             *FOR DSPF
     C                   Z-SUB     KABL          XXKABL           13 2           POS.FORTEGN
     C                   Z-SUB     KABL          UREST            13 2
      * IND 99 - tekst Hittil attestert/henført i stedet for Rest...
     C     KABL          COMP      *ZEROS                                 88
     C* VED "TVUNGEN INNGANG" (MANUELL HENFØRING I KOSTPGM MOT BEGREP
     C* SOM HAR ÅPNE BUDSJ.POSTER) GI VARSEL OM HVORFOR KOMMET HIT
     C     U1FLAG        IFEQ      'K'                                              B4
     C     U1BL          ANDNE     *ZEROS
     C     OKMSG         ANDEQ     ' '
     C                   MOVE      *ZEROS        W1LNR                           IKKE SØKEV.
     C                   MOVE      'X'           OKMSG             1
     C                   MOVE      'JOV0323'     MSGNR
     C                   END                                                         E4
     C     W1KBNR        SETLL     KOSBU5                             33
     C  N33W1KBNR        READE     KOSBU5                                 33
     C     *IN33         DOWEQ     '0'                                               B4
     C* Hvis et uferdig bilag (f8 fra side 1) bygges videre på...
     C*  periode ikke gitt på bilaget -> 1 budpost styrer periode
     C     KAPMN         IFEQ      *ZEROS                                             B5
     C                   MOVE      BUPMN         KAPMN
     C                   MOVE      BUPÅR         KAPÅR
     C                   MOVE      BUPCC         KAPCC
     C                   ENDIF                                                        E5
     C     KALNR         IFEQ      *ZEROS
     C                   MOVE      BULNR         KALNR
     C                   ENDIF
     C     KAVAL         IFEQ      *BLANKS
     C                   MOVE      BUVAL         KAVAL
     C                   MOVE      KAVAL         XXVAL
     C                   ENDIF
     C* Hvis bilagsdato er 0 er momskode ennå ikke satt....
     C     KABDT         IFEQ      *ZEROS                                             B5
     C                   Z-ADD     1             KABDTD
     C                   MOVE      KAPMN         KABDTM
     C     KAPCC         MULT      100           KABDTÅ
     C                   MOVE      KAPÅR         KABDTÅ
     C                   MOVE      UFITAX        FITAX
     C     FITAXD        IFNE      *ZEROS                                              B6
     C     FITAX2        ANDNE     *ZEROS
     C     KABDT         ANDLT     FITAXD
     C                   MOVE      FITAX2        FITAX
     C                   END                                                           E6
     C     FITAX         ADD       1             FITAXN            5 4
     C                   ENDIF                                                        E5
     C     BUKDM         IFEQ      'J'                                                B5
     C     BUBL          MULT(H)   FITAXN        BUBL                            * I FICURR
     C                   END                                                          E5
     C     UREST         SUB       BUBL          UREST
     C     W1KBNR        READE     KOSBU5                                 33
     C                   END                                                         E4
     C                   MOVE      W1KBNR        GMKBNR            7 0
     C                   ELSE                                                       X3
     C                   MOVE      'JOV0320'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     4             LINNBR
     C                   Z-ADD     29            POSNBR
     C                   GOTO      SLTB0
     C                   END                                                        E3
     C                   END                                                       E2
     C                   END                                                      E1
     C* DATO1
     C     W1FED1        IFNE      *ZEROS
     C                   MOVE      WS1DTD        UDTD              2 0
     C                   MOVE      WS1DTM        UDTM              2 0
     C                   MOVE      WS1DTÅ        UDTÅ              2 0
     C                   EXSR      SJDATO
     C     UFLAGG        COMP      1                                      71
     C   71              DO
     C                   MOVE      'SPD0001'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     49            POSNBR
     C                   GOTO      SLTB0
     C                   END
     C                   END
     C* DATO2
     C     W1FED2        IFNE      *ZEROS
     C                   MOVE      WS2DTD        UDTD              2 0
     C                   MOVE      WS2DTM        UDTM              2 0
     C                   MOVE      WS2DTÅ        UDTÅ              2 0
     C                   EXSR      SJDATO
     C     UFLAGG        COMP      1                                      70
     C   70              DO
     C                   MOVE      'SPD0001'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     40            POSNBR
     C                   GOTO      SLTB0
     C                   END
     C                   END
     C* STATUSKODE (* - GÅ I LOOP VIS ALLE)
     C     W1BUST        COMP      '*'                                    50
     C* VED ALLE STATUSER VALGT. VIS STATUS BLANK ALLTID FØRST
     C   50              MOVE      ' '           W1BUST
     C* BILDE ER OK
     C                   MOVE      WS1DTD        XS1DTD
     C                   MOVE      WS1DTM        XS1DTM
     C                   MOVE      WS1DTÅ        XS1DTÅ
     C     W1FED1        IFEQ      *ZEROS
     C                   MOVE      *ZEROS        XS1DTÅ
     C                   ELSE
     C     XS1DTÅ        IFGT      50
     C                   MOVEL     '19'          XS1DTÅ
     C                   ELSE
     C                   MOVEL     '20'          XS1DTÅ
     C                   END
     C                   END
     C                   MOVE      WS2DTD        XS2DTD
     C                   MOVE      WS2DTM        XS2DTM
     C                   MOVE      WS2DTÅ        XS2DTÅ
     C     W1FED2        IFEQ      *ZEROS
     C                   MOVE      *ZEROS        XS2DTÅ
     C                   ELSE
     C     XS2DTÅ        IFGT      50
     C                   MOVEL     '19'          XS2DTÅ
     C                   ELSE
     C                   MOVEL     '20'          XS2DTÅ
     C                   END
     C                   END
     C*
     C* SETT INDIKATOR FOR HVILKEN FIL SOM SKAL LESES
     C                   MOVEA     '00000000'    *IN(51)
     C                   MOVEA     '0'           *IN(59)
     C     W1LNR         COMP      *ZEROS                             53        KOSBU3 LEV
      *                                                    EL. KOSBU14
     C  N53W1TNR         COMP      *ZEROS                             54        KOSBU4 TRAN
     C  N53
     CANN54W1OPD         COMP      *ZEROS                             59        KOSBU9 OPPDRAG
     C  N53
     CANN54
     CANN59W1TUNR        COMP      *ZEROS                             52        KOSBU2 TURN
     C  N53
     CANN54
     CANN59
     CANN52W1BNR         COMP      *ZEROS                             51        KOSBU1 BILAGSNR
     C*                                                     (REKV.NR)  DAT
     C     *IN60         IFEQ      '0'
     C  N53
     CANN54
     CANN59
     CANN52
     CANN51W1BIL2        COMP      *BLANKS                            57        KOSBU7
     C*                                                    -STAT/BILNR/DAT
     C                   ELSE
     C  N53
     CANN54
     CANN59
     CANN52
     CANN51W1TXT2        COMP      *BLANKS                            57        KOSBU15
     C                   END
     C  N53
     CANN54
     CANN59
     CANN52
     CANN51
     CANN57W1KBNR        COMP      *ZEROS                             55        KOSBU5 BILAG
     C*                                                    (HENFØRT...)DAT
     C  N53
     CANN54
     CANN59                                                                     *VED ALLE BLANK
     CANN55
     CANN52
     CANN51
     CANN57              SETON                                        53        *LEVNR 0->
     C*
     C* VED  LEVNR - ER OGSÅ BILNR FYLT UT ??
     C   53W1BIL1        COMP      *BLANKS                            56        KOSBU6
     C   56              SETOFF                                       53        -ST/LEV/BIL/DAT
     C*
     C*
     C*
     C     SLTB0         TAG
     C* HUSK SISTE AKTIVE SØKEPARAMETRE NÅR DET ER PLUKK..
     C     *IN97         IFEQ      '1'
     C     DSW1N         IFNE      *ZEROS
     C     DSW1A         ORNE      *BLANKS
     C                   MOVE      W1FED1        WXFED1
     C                   MOVE      W1FED2        WXFED2
     C                   MOVE      DSW1          DSGM
     C                   END
     C                   END
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
     C*
     C                   Z-ADD     22            LINNBR
     C                   MOVEA     '00000000'    *IN(70)
     C                   MOVEA     '00000000'    *IN(78)
     C* GENERELLE TESTER VED BÅDE ENDRING OG NY
     C* ENTEN KODE ELLER TEKST
     C     WSVK          IFNE      *BLANKS
     C     KODGEK        CHAIN     KODTGE                             70
     C  N70KODG2K        CHAIN     KODTG2                             70
     C                   ELSE
     C     WSTXT         COMP      *BLANKS                                70
     C                   END
     C   70              DO
     C                   MOVE      'DIV2219'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     16            POSNBR
     C                   GOTO      SLTB
     C                   END
     C*
     C     WSBL          COMP      *ZEROS                                 71
     C   71              DO
     C                   MOVE      'DIV2220'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     20            POSNBR
     C                   GOTO      SLTB
     C                   END
     C*
     C     WSVAL         IFEQ      *BLANKS
     C                   MOVE      FICURR        WSVAL
     C                   END
     C     VALKEY        CHAIN     VALUL01                            72
     C   72              DO
     C                   MOVE      'SPV0001'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     32            POSNBR
     C                   GOTO      SLTB
     C                   END
     C*
     C*
     C* LEVERANDØR
     C* FORENKLING  HVIS VIA KOSTN.BILAG
     C     W1KBNR        IFNE      *ZEROS
     C     WSLNR         ANDEQ     *ZEROS
     C                   MOVE      KALNR         WSLNR
     C                   END
     C     WSLNR         IFNE      *ZEROS
     C     LEVE1K        CHAIN     LEVEL01                            73
     C  N73AKTKOD        COMP      'A'                                7373
     C   73              DO
     C                   MOVE      'SPL0029'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     36            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
     C* Ved transputlegg skal det være T (eller O tatt igjen)
     C     WSTUNR        IFEQ      *ZEROS
     C     WSOPD         ANDEQ     *ZEROS
     C     WSBLST        IFNE      'O'
     C                   MOVE      'T'           WSBLST
     C                   END
     C     WSTYPE        IFEQ      ' '
     C                   MOVE      'A'           WSTYPE
     C                   END
     C                   END
     C*
     C* AVTALE /ESTIMAT
     C     WSTYPE        COMP      'A'                                7676
     C   76WSTYPE        COMP      'E'                                7676
     C*
     C     WSBLST        COMP      'E'                                7474
     C   74WSBLST        COMP      'T'                                7474
     C   74WSBLST        COMP      'K'                                7474
     C   74WSBLST        COMP      'U'                                7474
     C   74WSBLST        COMP      'O'                                7474
     C   74WSBLST        COMP      'J'                                7474
     C   74WSBLST        COMP      'P'                                7474
     C*
     C* BÅDE AVTALE/EST.   OG BELASTING  MANGLER ???     FORESLÅ:
     C   76
     CAN 74              DO
     C     W1TUNR        IFNE      *ZEROS                                       TUR-REKV??
     C                   MOVE      'DIV2292'     MSGNR                          Y--> E / T
     C                   MOVE      'T'           WSBLST
     C                   ELSE
     C                   MOVE      'DIV2293'     MSGNR                          N--> E / E
     C                   MOVE      'E'           WSBLST
     C                   END
     C                   SETON                                        30
     C                   Z-ADD     45            POSNBR
     C                   MOVE      'E'           WSTYPE
     C                   GOTO      SLTB
     C                   END
     C   76              DO
     C                   MOVE      'DIV2234'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     45            POSNBR
     C                   MOVE      'E'           WSTYPE
     C                   GOTO      SLTB
     C                   END
     C   74              DO
     C     W1TUNR        IFNE      *ZEROS                                       TUR-REKV??
     C                   MOVE      'DIV2308'     MSGNR                          Y --> T
     C                   MOVE      'T'           WSBLST
     C                   ELSE
     C                   MOVE      'DIV2225'     MSGNR                          Y --> E
     C                   MOVE      'E'           WSBLST
     C                   END
     C                   SETON                                        30
     C                   Z-ADD     48            POSNBR
     C                   GOTO      SLTB
     C                   END
      *
      * HENTING AV TURNR VIA OPPDRAG FLYTTET OPP
     C     WSOPD         IFNE      *ZEROS                                       1B
     C     WSOAVD        IFEQ      *ZEROS                                        2B
     C                   MOVE      WSTAVD        WSOAVD
     C                   END                                                     2E
     C     HEADFK        CHAIN     HEADF                              75
     C  N75WSTUNR        IFEQ      *ZEROS                                        2B
     C     HEPRO         ANDNE     *ZEROS
     C     HEADFK        CHAIN     DISP                               33
     C  N33              MOVE      DITUAV        WSTAVD
     C  N33              MOVE      HEPRO         WSTUNR
     C                   END                                                     2E
     C                   END                                                    1E
     C* TURNR -
     C     WSTUNR        IFNE      *ZEROS
     C     TURKEY        CHAIN(N)  TURER                              78
     C   78WSTUNR        CHAIN(N)  TURER14                            78
     C* DERSOM GYLDIG TUR ER OPPGITT - DEFAULTVERDIER DERFRA
     C  N78              DO
     C     WSPMN         IFEQ      *ZEROS
     C                   MOVE      TUAVD         WSTAVD
     C                   END
     C     WSPMN         IFEQ      *ZEROS
     C                   MOVE      TURMND        WSPMN
     C                   MOVE      TURAAR        WSPÅR
     C                   MOVE      TURACC        WSPCC
     C                   END
     C     WSBILN        IFEQ      *BLANKS
     C     WSTNR         ANDEQ     *ZEROS
     C                   MOVE      TUBILN        WSBILN
     C                   END
     C     WSBILK        IFEQ      *BLANKS
     C     WSTNR         ANDEQ     *ZEROS
     C                   MOVE      TUBILK        WSBILK
     C                   END
      * VED TURNR SOM ER AVREGNET, KODE J=JUSTER
     C     WSBLST        IFEQ      'T'
     C     TUAVRE        ANDEQ     'X'
     C                   MOVE      'J'           WSBLST
     C                   END
     C                   END
     C* OM IKKE TURRECORD -(LAND IMPORT) MINIM. 1 OPPDR. PÅ DENNE TUR
     C   78              DO
     C                   SETOFF                                       78
     C     WSTUNR        SETLL     HEAD11
     C     WSTUNR        READE     HEAD11                                 78
     C                   END
     C   78              DO
     C                   MOVE      'SPT0002'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     60            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
      *
     C     WSBLST        IFEQ      'J'
     C     WSTUNR        IFEQ      *ZEROS
     C                   MOVE      'JOV1221'     MSGNR
     C                   SETON                                        3074
     C                   Z-ADD     48            POSNBR
     C                   GOTO      SLTB
     C                   ELSE
     C     TUAVRE        IFNE      'X'
     C                   MOVE      'JOV1221'     MSGNR
     C                   SETON                                        3074
     C                   Z-ADD     48            POSNBR
     C                   GOTO      SLTB
     C                   END
     C     WSTNR         IFEQ      *ZEROS
     C                   END
     C                   END
     C                   END
     C*
     C* HENT BILKODE FRA UNITREGISTER NÅR BILNR ER TASTET - ELLERS FRA TUR
     C                   MOVE      *ZEROS        UNTRAN
     C     WSBILN        IFNE      *BLANKS
     C     WSBILN        CHAIN     UNITL01                            33
     C  N33              MOVE      UNTRME        WSBILK
     C                   END
     C*
     C* HENFØRES TIL ETT OPPDRAG??  (CHAIN FLYTTET FORAN TUR)
     C     WSOPD         IFNE      *ZEROS                                       1B
     C     *IN75         IFEQ      '1'
     C                   MOVE      'SPO0001'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     74            POSNBR
     C                   GOTO      SLTB
     C                   ELSE
     C                   MOVEL     WSTXT         XXAWB1            4
     C     XXAWB1        IFEQ      *BLANKS
     C     XXAWB1        OREQ      'AWB:'
     C                   MOVE      'AWB:'        XXAWB1
     C                   MOVE      *BLANKS       XXAWB2           15
     C                   SELECT
     C     HEUR          WHENEQ    'C'
     C                   MOVEL     HERFA         XXAWB2
     C     HEUR          WHENEQ    'D'
     C     HEUR          OREQ      'E'
     C                   MOVE      HEGN          XXAWB3           11
     C                   MOVEL     XXAWB3        XXAWB2
     C                   ENDSL
     C*
     C     XXAWB2        IFNE      *BLANKS
     C                   MOVEL     XXAWB1        XXAWB            19
     C                   MOVE      XXAWB2        XXAWB
     C                   MOVEL     XXAWB         WSTXT
     C                   END
     C                   END
     C                   END                                                     2E
     C  N75WSPMN         IFEQ      *ZEROS                                        2B
     C                   MOVE      HEDTM         WSPMN
     C                   MOVE      HEDTÅ         WSPÅR
     C                   MOVEL     HEDTÅ         WSPCC
     C                   END                                                     2E
     C                   END                                                    1E      (OPD)
     C*
     C* KODE FOR Å HENTE TRANSPORTØR FRA UNIT ?
     C     WSTNR         IFEQ      *ZEROS
     C     WSTNRB        ANDEQ     'B'
     C                   MOVE      UNTRAN        WSTNR
     C                   END
     C*
     C* TRANSPORTØR (NÅR TILFELDIG INNLEID - AVVIKENDE FRA TURENS)
     C     WSTNR         IFNE      *ZEROS
     C     TRANK         CHAIN     TRAN                               79
     C   79              DO
     C                   MOVE      'SPT0105'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     60            POSNBR
     C                   GOTO      SLTB
     C                   END
      *
     C     WSBLST        IFNE      'J'
     C* Når ikke henvisning til tur/oppdrag er det et utlegg for
     C* transportøren som SKAL TREKKES I AVREGNING (LEV. UAVHENGIG)
     C* Når det henvises til tur/oppdrag er det en utført innh/utk e.l.
     C* (utført AV transportøren) som KAN FORVENTE FAKTURA FRA TRANSP.
     C* (ELLER HAN GODSKRIVES I AVREGNING)
     C     WSTUNR        IFNE      *ZEROS
     C     WSOPD         ORNE      *ZEROS
     C  N79              Z-ADD     VMTRLE        WSLNR
     C* Når transp er oppgitt (og tur/oppdr (=godskriv)) krav BILNR
     C     WSBILN        IFEQ      *BLANKS
     C                   MOVE      'JOV0184'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN79
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     40            POSNBR
     C                   GOTO      SLTB
     C                   END
      * Når transp. type 2 (egen) MÅ GYLDIG EGEN BIL OPPGIS
      * (fordi godskriving av konto for internbiler (SYRE35) baserer
      *  seg på gjennomløp av alle biler tilhørende transp. av type 2
      *  og den henter konto fra bilkoden/bilen som er benyttet.)
     C     VMINCR        IFEQ      2
     C     WSBILN        CHAIN     UNITL01                            79
     C  N79WSTNR         COMP      UNTRAN                             7979
     C     *IN79         IFEQ      '1'
     C                   MOVE      'JOV0507'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     40            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
     C* Når transp er oppgitt (og tur/oppdr (=godskriv)) krav BIKODE
     C     WSBILK        IFEQ      *BLANKS
     C     BUTX_7        ANDNE     '* OPD *'
     C                   MOVE      'JOV0185'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN79
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     75            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
     C                   END
     C                   END
      *
      *
     C* Krav om transp.nr når transp.utlegg
     C     WSTUNR        IFEQ      *ZEROS
     C     WSOPD         ANDEQ     *ZEROS
     C*G&B - FORENKLING  VED LEV.UTLEGG
     C     WSTXT         IFEQ      *BLANKS
     C                   MOVEL     LNAVN         WSTXT
     C                   MOVE      *BLANKS       BLAN10           10
     C                   MOVE      BLAN10        WSTXT
     C                   MOVE      KAFNR         WSTXT
     C                   END
     C     WSTNR         IFEQ      *ZEROS
     C                   MOVE      'JOV0160'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN79
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     60            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
      *
     C* Krav om transp.nr når JUSTERING AV TIDL. AVREGN.
     C     WSBLST        IFEQ      'J'
     C     WSTNR         ANDEQ     *ZEROS
     C                   MOVE      'JOV1322'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN79
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     60            POSNBR
     C                   GOTO      SLTB
     C                   END
      *
      *
     C* DATO3
     C     WSFEDT        IFNE      *ZEROS
     C                   MOVE      WSFEDD        UDTD              2 0
     C                   MOVE      WSFEDM        UDTM              2 0
     C                   MOVE      WSFEDÅ        UDTÅ              2 0
     C                   EXSR      SJDATO
     C     UFLAGG        COMP      1                                      80
     C   80              DO
     C                   MOVE      'SPD0001'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     51            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
     C*
     C* FORENKLING  HVIS VIA KOSTN.BILAG
     C     W1KBNR        IFNE      *ZEROS
     C     WSPMN         ANDEQ     *ZEROS
     C                   MOVE      KAPMN         WSPMN
     C                   MOVE      KAPÅR         WSPÅR
     C                   MOVE      KAPCC         WSPCC
     C                   END
     C     WSPMN         IFEQ      *ZEROS
     C                   MOVE      *ZEROS        WSPCC
     C                   ELSE
     C     WSPÅR         IFGT      50
     C                   MOVE      '19'          WSPCC
     C                   ELSE
     C                   MOVE      '20'          WSPCC
     C                   END
     C                   END
     C* PERIODISERING  (MÅ VÆRE STØRRE EN MINSTE ÅPNE)
     C     BUDPER        COMP      MINPE2                               77
     C  N77WSPMN         COMP      12                                 77
     C   77              DO
     C                   MOVE      'DIV2295'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     69            POSNBR
     C                   GOTO      SLTB
     C                   END
      *
      * DFT. MOMSKODE VED JUSTERING = "J" (OFTEST INNH./UTKJØRING)
     C     WSBLST        IFEQ      'J'
     C     WSKDM         ANDNE     'N'
     C                   MOVE      'J'           WSKDM
     C                   END
      * DFT. MOMSKODE VED RENT TRANSPORTØR-UTLEGG ER "N"
      * (ER "ALLTID" BLITT HÅNDTERT SLIK AV SYKR35, NÅ TYDELIGERE!!)
     C     WSBLST        IFEQ      'T'
     C     WSTUNR        ANDEQ     *ZEROS
     C     WSOPD         ANDEQ     *ZEROS
     C     WSKDM         ANDNE     'J'
     C                   MOVE      'N'           WSKDM
     C                   END
     C*
     C* ETTER ALLE ANDRE TESTER .....
     C* ER DETTE FØRING AV REKV. INNHENTING/UTKJØRING
     C                   MOVE      ' '           TRSTAF
     C                   MOVE      ' '           TRSTAF
     C  N15WSOPD         IFNE      *ZEROS                                        2B
     C     HEADFK        CHAIN     HEADF                              33
     C  N33              DO                                                       3B
     C     TRSTAF        IFNE      'R'
     C     TRSTAE        ANDNE     'R'
     C     TRSTAF        ANDNE     'A'
     C     TRSTAE        ANDNE     'A'
     C                   UPDATE    HEADFR
     C                   GOTO      SLTBOP
     C                   END
     C* KVITTERT MED F13- INNHENTING
     C   13TRSTAF        IFEQ      'R'                                             4B
     C     TRSTAF        OREQ      'A'
     C     WSTNR         COMP      *ZEROS                                 79
     C   79WSLNR         COMP      *ZEROS                                 79
     C   79              DO
     C                   MOVE      'DIV2355'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     60            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   MOVE      'F'           TRSTAF
     C                   UPDATE    HEADFR
     C*
     C     WSTXT         IFEQ      *BLANKS
     C                   MOVEL     INNHDS        WSTXT
     C                   END
     C                   GOTO      SLTBOP
     C                   END                                                       4E
     C* KVITTERT F14... UTJ
     C   14TRSTAE        IFEQ      'R'                                             4B
     C     TRSTAE        OREQ      'A'
     C     WSTNR         COMP      *ZEROS                                 79
     C   79WSLNR         COMP      *ZEROS                                 79
     C   79              DO
     C                   MOVE      'DIV2355'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     23            LINNBR
     C                   Z-ADD     60            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   MOVE      'F'           TRSTAE
     C                   UPDATE    HEADFR
     C     WSTXT         IFEQ      *BLANKS
     C                   MOVEL     UTKJDS        WSTXT
     C                   END
     C                   GOTO      SLTBOP
     C                   END                                                       4E
     C*
     C* MELDING SKAL GIS.... (DUMMY)OPPDATER  HEADTR
     C                   UPDATE    HEADFR
     C* FEILKVITTERT F13...
     C   13TRSTAF        IFNE      'R'                                             4B
     C     TRSTAF        ANDNE     'A'                                             4B
     C                   MOVE      'DIV2333'     MSGNR
     C                   SETON                                        3075
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     74            POSNBR
     C                   GOTO      SLTB
     C                   END                                                       4E
     C* FEILKVITTERT F14...
     C   14TRSTAE        IFNE      'R'                                             4B
     C     TRSTAE        ANDNE     'A'                                             4B
     C                   MOVE      'DIV2334'     MSGNR
     C                   SETON                                        3075
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     74            POSNBR
     C                   GOTO      SLTB
     C                   END                                                       4E
     C* BÅDE INNHENTING /UTKJØRING REKVIRERES
     C     TRSTAF        IFNE      ' '
     C     TRSTAF        ANDNE     'O'
     C     TRSTAF        ANDNE     'F'
     C     TRSTAE        ANDNE     ' '
     C     TRSTAE        ANDNE     'O'
     C     TRSTAE        ANDNE     'F'
      *(BEGGE ER DA ENTEN R ELLER A)
     C                   MOVE      'DIV2332'     MSGNR
     C                   SETON                                        3075
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     74            POSNBR
     C                   GOTO      SLTB
     C                   END
     C* KUN REKV. INNHENT
     C     TRSTAF        IFEQ      'R'
     C     TRSTAF        OREQ      'A'
     C                   MOVE      'DIV2330'     MSGNR
     C                   SETON                                        3075
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     74            POSNBR
     C                   GOTO      SLTB
     C                   END
     C* KUN REKV. UTKJ
     C     TRSTAE        IFEQ      'R'
     C     TRSTAE        OREQ      'A'
     C                   MOVE      'DIV2331'     MSGNR
     C                   SETON                                        3075
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     74            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END                                                      3E    (N33 DO)
     C                   END                                                     2E     (N15 DO)
     C     SLTBOP        TAG
     C*
     C*
     C*** OPPDATERE PÅ REGISTER OG SUBFIL
     C* HENT NYTT (SKJULT)LØPENR DERSOM NY - BRUK 7-SIFRET LØPENR
     C  N40              DO
     C     YBNRT         CHAIN     KOSTT                              33
     C   33              MOVE      'Å'           KTTYP
     C   33              Z-ADD     1000000       KTNR
     C   33              WRITE     KOSTTR
     C  N33              ADD       1             KTNR
     C  N33              UPDATE    KOSTTR
     C                   MOVE      KTNR          WSBNR
     C                   END
     C*
     C     KODSIK        CHAIN     KOSBU                              33
     C* ENDRING PÅ LINJE SOM ER PLUKKET - JUSTER REST TIL PLUKKING
     C* DET GAMLE BELØPET LEGGES FØRST PÅ "REST TIL ATTESTASJON"
     C  N33BUBNR2        IFNE      *ZEROS
     C     BUBNR2        ANDEQ     W1KBNR
     C     BUKDM         IFEQ      'J'
     C     BUBL          MULT(H)   FITAXN        XXBUBL
     C                   ELSE
     C                   Z-ADD     BUBL          XXBUBL
     C                   END
     C     UREST         ADD       XXBUBL        UREST
     C                   END
     C                   EXSR      MOVWSI
     C* "REST TIL ATTESTASJON" REDUSERES MED DET NYE BELØPET
     C  N33BUBNR2        IFNE      *ZEROS
     C     BUBNR2        ANDEQ     W1KBNR
     C* OGSÅ MVAKODE KAN VÆRE ENDRET....
     C     BUKDM         IFEQ      'J'
     C     BUBL          MULT(H)   FITAXN        XXBUBL
     C                   ELSE
     C                   Z-ADD     BUBL          XXBUBL
     C                   END
     C     UREST         SUB       XXBUBL        UREST
     C                   END
     C*
     C     BUST          COMP      ' '                                3232
     C   32BUST          COMP      'S'                                3232
     C     *IN33         IFEQ      *OFF
     C                   EXSR      SYNCTU
     C                   END
     C  N33              UPDATE    KOSBUR
     C   33              WRITE     KOSBUR
      ****
      * OPPDATER LINK MELLOM OPPDRAG OG REKVISISJON...
     C     *IN13         IFEQ      '1'
     C     *IN14         OREQ      '1'
      *
     C     *IN13         IFEQ      '1'
     C                   MOVE      'FF'          XXSLAG
     C                   ELSE
     C                   MOVE      'VF'          XXSLAG
     C                   END
      *
     C     TRIKEY        CHAIN     HETRIU                             33
     C     *IN33         IFEQ      '1'
     C                   CLEAR                   HETRIUR
     C                   MOVE      HEAVD         TIAVD
     C                   MOVE      HEOPD         TIOPD
     C                   MOVE      XXSLAG        TISLAG
     C                   MOVE      BUBNR         TIBURF
     C                   WRITE     HETRIUR
     C                   ELSE
     C                   MOVE      BUBNR         TIBURF
     C                   UPDATE    HETRIUR
     C                   END
     C                   END
      *
     C                   EXSR      KDTFM2
     C   40              UPDATE    SUBFIL
     C  N40              ADD       1             YRECNO
     C  N40              Z-ADD     YRECNO        ZRECNO
     C  N40              WRITE     SUBFIL
     C                   WRITE     SUBCTL
     C                   EXSR      MOVB2
     C*
     C     SLTB          ENDSR
     C*
     C***********************************************
     C     HENTSR        BEGSR
     C***********************************************
     C                   Z-ADD     0             LINNBR
     C                   SETOFF                                       30
     C                   SETOFF                                       919299
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C   98              DO
     C   99              SETOFF                                       98
     C                   Z-ADD     1             LINNBR
     C                   GOTO      SLHENT
     C                   END
     C     ZRECNO        DIV       7             LINNBR
     C                   MVR                     XLIN              2 0
     C     XLIN          IFEQ      0
     C                   Z-ADD     7             LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C     WSNRO         IFEQ      ' '                                          DIREKTE MVA R PÅ TUR
     C                   EXSR      DIRMVA
     C                   END
     C   97WSNRO         IFEQ      '1'                                          PLUKKE (FRA SYKS02)
     C                   MOVE      ' '           WSNRO
     C                   EXSR      PICKSR
     C   30              GOTO      SLHENT                                       IKKE FEIL-ALLE
N05  C* SLÅ AV RØDINDIKATOR FOR HEADING OG MELDING OM KASTET INN HVIS MINST 1 ER PLUKKET
N05  C                   MOVE      *OFF          *IN95
N06   * Skal en returnere etter første plukkede eller skal en bli værende for å plukke flere
N06  C                   if        U1BLRet1 = 'J'
N06  C* RETURNER PARAMETRE..../ OPPDATER LDA
N06  C                   MOVE      PARMDS        UUPARM
N06  C                   OUT       LDADTA
N06  C                   SETON                                        LR
N06  C                   RETURN
N06  C                   endif
     C                   END
     C     WSNRO         IFEQ      '2'                                          ENDRE
     C                   MOVE      ' '           WSNRO
     C                   EXSR      CHGSI
     C   12              GOTO      SLHENT
     C                   END
     C     WSNRO         IFEQ      '4'                                          SLETTE
     C                   MOVE      ' '           WSNRO
     C* 4 ORDINÆRT=SLETT/"USLETT"(STAT S) - NÅR PLUKKET-->FJERN PLUKKE
     C     BUBNR2        IFEQ      *ZEROS
     C                   EXSR      DLTSI
     C   12              GOTO      SLHENT
     C                   ELSE
     C                   EXSR      PICKDL
     C                   END
     C                   END
     C     WSNRO         IFEQ      '6'                                          GÅ TIL FERJER PÅ TUR
     C                   MOVE      ' '           WSNRO
     C                   EXSR      FERRY
     C                   END
     C     WSNRO         IFEQ      '7'                                          LAG SLAVE
     C                   MOVE      ' '           WSNRO
     C     BUBNR3        IFGT      *ZEROS                                       KAN IKKE LAGE
     C     BUBNR3        ANDLT     9999999                                      SLAVE PÅ SLAVE
     C                   SETON                                        98
     C                   END
     C                   EXSR      COPSI
     C   12              GOTO      SLHENT
     C                   END
     C     WSNRO         IFEQ      '8'                                          EN TURS AVR.R PÅ TUR
     C                   MOVE      ' '           WSNRO
     C                   EXSR      AVRTUR
     C                   END
N03  C     WSNRO         IFEQ      'O'                                          Vis oppdrag
N03  C                   MOVE      ' '           WSNRO
N03  C                   EXSR      SEOPD
N03  C                   END
N03   *
N03  C     WSNRO         IFEQ      'F'                                          Vis faktura
N03  C                   MOVE      ' '           WSNRO
N03  C                   EXSR      SEFAK
N03  C                   END
N03   *
     C                   END
     C*
     C     SLHENT        TAG
     C*
     C   98              MOVE      'DIV0012'     MSGNR
     C   98              SETON                                            30
     C                   ADD       5             LINNBR
     C                   Z-ADD     2             POSNBR
     C*
     C                   ENDSR
     C*
N03  C***********************************************
N03  C     SEOPD         BEGSR
N03  C***********************************************
N03  C     BUOPD         IFNE      *zeros
N03  C                   MOVE      *ZEROS        DUMFLA            1 0
N03  C                   CALL      'SYFM21A'
N03  C                   PARM                    FIFIRM
N03  C                   PARM                    BUOAVD
N03  C                   PARM                    BUOPD
N03  C                   PARM                    DUMFLA
N03  C                   END
N03  C                   SETON                                        99
N03  C     BUST          COMP      ' '                                3232
N03  C   32BUST          COMP      'S'                                3232
N03  C                   UPDATE    SUBFIL
N03  C                   ENDSR
N03  C*
N03  C***********************************************
N03  C     SEFAK         BEGSR
N03  C***********************************************
N03  C     BUOPD         IFNE      *zeros
N03  C                   MOVE      *ZEROS        DUMFLA            1 0
N03  C                   CALL      'SYFM21B'
N03  C                   PARM                    FIFIRM
N03  C                   PARM                    BUOAVD
N03  C                   PARM                    BUOPD
N03  C                   PARM                    DUMFLA
N03  C                   END
N03  C                   SETON                                        99
N03  C     BUST          COMP      ' '                                3232
N03  C   32BUST          COMP      'S'                                3232
N03  C                   UPDATE    SUBFIL
N03  C                   ENDSR
N03  C*
     C***********************************************
     C     PICKSR        BEGSR
     C***********************************************
      *WPLNR = VALGT KODE FOR HANDLING HVIS DIFF ER OPPDAGET I PLUKK
     C                   MOVE      '0'           WPLNR
     C                   SETON                                        99
      * Er posten alt plukket .. til dette/annet bilagsnr
     C     BUBNR2        IFNE      *ZEROS
     C     BUBNR2        IFEQ      W1KBNR
     C                   MOVE      'JOV0511'     MSGNR
     C                   ELSE
     C                   MOVE      'JOV0512'     MSGNR
     C                   END
     C                   SETON                                        30
     C                   GOTO      SLPICK
     C                   END
      *
      * Hvis levnr gitt på rekvis. må det matche kostn.bilaget
     C     BULNR         IFNE      KALNR
     C     BULNR         ANDNE     *ZEROS
     C     KALNR         ANDNE     *ZEROS
     C                   MOVE      'JOV0321'     MSGNR
     C                   SETON                                        30
     C                   GOTO      SLPICK
     C                   END
     C     BUVAL         IFNE      KAVAL
     C     KAVAL         ANDNE     *BLANKS
     C                   MOVE      'JOV0321'     MSGNR
     C                   SETON                                        30
     C                   GOTO      SLPICK
     C                   END
      *
      * MOMSKODE UDEFINERT. VELG DFT...
     C     XXKDM         IFEQ      ' '
      * ER "KASTET INN" PGA KONTERING. MOMSKODE ETTER KONTERING
     C     U1BL          IFNE      *ZEROS
     C     U1KDM         IFEQ      'P'
     C                   MOVE      'J'           XXKDM
     C                   ELSE
     C                   MOVE      'N'           XXKDM
     C                   END
      *
     C                   ELSE
      * ELLERS MOMSKODE  DFT FRA KOSTN.BILAG/EVT.FRA F8-BILDET
     C                   MOVE      W1MVA         XXKDM
     C                   END
     C                   END
      *
     C* IKKE SAMSVAR MOMSKODE ??
     C     XXKDM         IFEQ      'J'
     C     W1MVA         ANDEQ     'N'
     C                   MOVE      'JOV0321'     MSGNR
     C                   SETON                                        30
     C                   GOTO      SLPICK
     C                   END
     C     XXKDM         IFEQ      'N'
     C     W1MVA         ANDEQ     'J'
     C                   MOVE      'JOV0321'     MSGNR
     C                   SETON                                        30
     C                   GOTO      SLPICK
     C                   END
      *
      * ER "KASTET INN" PGA KONTERING...- FINN NETTO KONTERINGSBELØP
     C     U1BL          IFNE      *ZEROS
      * FINN NETTO KONTERINGSBELØP
     C     XXKDM         IFEQ      'J'
     C     BUBL          MULT(H)   FITAXN        BRTBUB
     C                   Z-ADD(H)  U1BL          BRTKOB
     C     U1BL          DIV(H)    FITAXN        NETKOB
     C                   ELSE
     C                   MOVE      *ZEROS        BRTBUB
     C                   MOVE      *ZEROS        BRTKOB
     C                   Z-ADD     U1BL          NETKOB
     C                   END
      *
     C     NETKOB        IFNE      BUBL
     C                   MOVE      '1'           WPLNR
     C     BUBL          SUB       NETKOB        WPLDIF
      *
     C     FEILF         TAG
     C                   EXFMT     PLDIFF
     C     *IN12         IFEQ      *ON
     C                   SETOFF                                       30
     C                   GOTO      SLPICK
     C                   END
     C*
     C     WPLNR         IFNE      '1'
     C     WPLNR         ANDNE     '2'
     C     WPLNR         ANDNE     '3'
     C                   GOTO      FEILF
     C                   END
      *
     C                   END
     C                   END
      *
      *
     C*  OPPDATER
     C     BUBNR         CHAIN     KOSBU                              33
     C  N33              DO
N06  C     BUBNR         CHAIN     KOSBUX
N06  c                   eval      BUVAO = BUVAL
N06  c                   eval      BUBLO = BUBL
N06  C                   if        not %found
N06  c                   write     KOSBUXR
N06  C                   else
N06  c                   update    KOSBUXR
N06  C                   endif
      * HVIS BILAGET EN KOMMER FRA ER MANGELFULT.... SETT VEDIER
      * FRA FØRSTE PLUKEDE BUDSJ.POST SOM MAL FOR SENERE GYLDIGH.TEST
     C     KAPMN         IFEQ      *ZEROS
     C                   MOVE      BUPMN         KAPMN
     C                   MOVE      BUPÅR         KAPÅR
     C                   MOVE      BUPCC         KAPCC
     C                   ENDIF
     C     KALNR         IFEQ      *ZEROS
     C                   MOVE      BULNR         KALNR
     C                   ENDIF
     C     KAVAL         IFEQ      *BLANKS
     C                   MOVE      BUVAL         KAVAL
     C                   MOVE      KAVAL         XXVAL
     C                   ENDIF
     C* Hvis bilaget ikke har dato er momssats ennå ikke satt
     C     KABDT         IFEQ      *ZEROS
     C                   Z-ADD     1             KABDTD
     C                   MOVE      KAPMN         KABDTM
     C     KAPCC         MULT      100           KABDTÅ
     C                   MOVE      KAPÅR         KABDTÅ
     C                   MOVE      UFITAX        FITAX
     C     FITAXD        IFNE      *ZEROS
     C     FITAX2        ANDNE     *ZEROS
     C     KABDT         ANDLT     FITAXD
     C                   MOVE      FITAX2        FITAX
     C                   END
     C     FITAX         ADD       1             FITAXN            5 4
     C                   ENDIF
     C     KALNR         IFEQ      *ZEROS
     C                   MOVE      BULNR         KALNR
     C                   ENDIF
     C     WSVAL         IFEQ      *BLANKS
     C                   MOVE      BUVAL         WSVAL
     C                   ENDIF
     C* SETT ALLTID PERIODE ETTER KOSTNADSBILAGET
      *(Periode kan igjen være hentet fra 1. bud.post.)
     C                   MOVE      KAPCC         BUPCC
     C                   MOVE      KAPÅR         BUPÅR
     C                   MOVE      KAPMN         BUPMN
      *
     C* IKKE VALGT LEVERANDØR PÅ REKV... HENT FRA KOSTA
     C     BULNR         IFEQ      *ZEROS
     C     KALNR         ANDNE     *ZEROS
     C                   MOVE      KALNR         BULNR
     C                   END
      *
     C*KOMMET INN MED BELØP(AUTOM. "KASTET OVER" VED FORSØK PÅ FØRING)
      * WPLNR ULIK 0 = DIFF KONTERINGSBELØP PLUKKET BUDSJETTBELØP
      *  HVIS 1 VALGT -> BENYTT KONTERINGSBELØP (NETKOB=NETTO KONT.BEL)
      *  HVIS 2 VALGT -> BENYTT K.BEL.,SKAP ÅPEN NY POST AV REST...
      *  HVIS 3 VALGT -> BENYTT BUDSJETT-BELØP (INGEN HANDLING)
     C     U1BL          IFNE      *ZEROS
     C     WPLNR         IFEQ      '1'
     C     WPLNR         OREQ      '2'
     C                   Z-ADD     NETKOB        BUBL
     C                   END
     C                   MOVE      *ZEROS        U1BL
     C                   END
      *
      * REST TIL ATTESTASJON INKLUDERER MVA...
     C                   MOVE      XXKDM         BUKDM
     C     BUKDM         IFEQ      'J'
     C     BUBL          MULT(H)   FITAXN        XXBUBL
     C                   ELSE
     C                   Z-ADD     BUBL          XXBUBL
     C                   END
     C     UREST         SUB       XXBUBL        UREST
      * OPPDATER BUDSJ.POSTEN
     C                   MOVE      W1KBNR        BUBNR2                           *PLUKKET
     C                   EXSR      SYNCTU
     C                   UPDATE    KOSBUR
     C                   END
      * FLAGG TILBAKE TIL SYKS03 - NOE ER PLUKKET
     C                   MOVE      'P'           U1FLAG
      *
      *
     C     SLPICK        TAG
      *
     C     BUST          COMP      ' '                                3232
     C   32BUST          COMP      'S'                                3232
     C     W1KBNR        COMP      *ZEROS                             3131
     C   31W1KBNR        COMP      BUBNR2                                 31
     C                   UPDATE    SUBFIL
      *
      * WPLNR ULIK 0 = DIFF KONTERINGSBELØP PLUKKET BUDSJETTBELØP
      *   HVIS 2 VALGT -> SKAP ÅPEN NY POST AV RESTBELØPET
     C     WPLNR         IFEQ      '2'
     C                   MOVE      *ZEROS        BUBNR2
     C                   Z-ADD     WPLDIF        BUBL
     C     YBNRT         CHAIN     KOSTT                              33
     C  N33              ADD       1             KTNR
     C  N33              UPDATE    KOSTTR
     C                   MOVE      KTNR          BUBNR
     C                   WRITE     KOSBUR
     C                   MOVE      'JOV0850'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     PICKDL        BEGSR
     C***********************************************
     C                   SETON                                        99
      * kun slette fra "eget bilagsnr"
     C     BUBNR2        IFNE      W1KBNR
     C                   MOVE      'JOV0513'     MSGNR
     C                   SETON                                        30
     C                   GOTO      SLDEL
     C                   END
     C     BUBNR         CHAIN     KOSBU                              33
     C  N33              DO
     C                   MOVE      *ZEROS        BUBNR2                           *U-PLUKKET
     C                   UPDATE    KOSBUR
     C     BUKDM         IFEQ      'J'
     C     BUBL          MULT(H)   FITAXN        XXBUBL
     C                   ELSE
     C                   Z-ADD     BUBL          XXBUBL
     C                   END
     C     UREST         ADD       XXBUBL        UREST
     C                   END
     C     BUST          COMP      ' '                                3232
     C   32BUST          COMP      'S'                                3232
     C     W1KBNR        COMP      *ZEROS                             3131
     C   31W1KBNR        COMP      BUBNR2                                 31
     C                   UPDATE    SUBFIL
     C*
     C     SLDEL         ENDSR
     C*
     C*
     C***********************************************
     C     DLTSI         BEGSR
     C***********************************************
     C* KAN "UNDELETE" VED Å TA OPT 4 PÅ EN SOM ER SLETTET
     C                   SETON                                        99
     C     HELP1         TAG
     C                   EXFMT     VAREL3

     C                   MOVE      BUBNR         WSBNR
     C  N12              DO
     C     KODSIK        CHAIN     KOSBU                              33
     C     BUST          IFNE      'S'
     C                   MOVE      'S'           BUST
     C                   ELSE
     C                   MOVE      ' '           BUST
     C                   END
     C  N33              UPDATE    KOSBUR
     C                   END
     C     XLIN          IFEQ      0
     C                   Z-ADD     7             LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C     BUST          COMP      ' '                                3232
     C   32BUST          COMP      'S'                                3232
     C     W1KBNR        COMP      *ZEROS                             3131
     C   31W1KBNR        COMP      BUBNR2                                 31
     C                   UPDATE    SUBFIL
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     DIRMVA        BEGSR
     C***********************************************
     C                   SETON                                        99
     C                   MOVE      BUBNR         WSBNR
     C     KODSIK        CHAIN     KOSBU                              33
     C*ENDRING AV MOMSKODE PÅ BILAG SOM ER PLUKKET???? KORRIGER REST
     C     BUBNR2        IFNE      *ZEROS
     C     BUBNR2        ANDEQ     W1KBNR
     C     BUBL          MULT      FITAX         XXBUBL                           *REN MVA
     C     BUKDM         IFEQ      'J'                                            *GML KODE
     C     XXKDM         ANDNE     'J'                                            *NY KODE
     C     UREST         ADD       XXBUBL        UREST
     C                   END
     C     BUKDM         IFNE      'J'                                            *GML KODE
     C     XXKDM         ANDEQ     'J'                                            *NY KODE
     C     UREST         SUB       XXBUBL        UREST
     C                   END
     C                   END
     C                   MOVE      XXKDM         BUKDM
     C  N33              UPDATE    KOSBUR
     C     XLIN          IFEQ      0
     C                   Z-ADD     7             LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C     BUST          COMP      ' '                                3232
     C   32BUST          COMP      'S'                                3232
     C     W1KBNR        COMP      *ZEROS                             3131
     C   31W1KBNR        COMP      BUBNR2                                 31
     C                   UPDATE    SUBFIL
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     CHGSI         BEGSR
     C***********************************************
     C                   MOVE      *OFF          *IN30
     C                   MOVE      'DIV0000'     MSGNR
     C                   EXSR      MOVSIW
     C                   SETON                                        99
     C     STCHG         TAG
     C                   EXSR      KDTFM4
     C                   EXFMT     VARELI
     C                   EXSR      KDTFM4
     C                   SETOFF                                       309089
     C   04              DO
     C                   EXSR      SØKDT2
     C                   GOTO      STCHG
     C                   END
     C   12              DO
     C     BUST          COMP      ' '                                3232
     C   32BUST          COMP      'S'                                3232
     C     W1KBNR        COMP      *ZEROS                             3131
     C   31W1KBNR        COMP      BUBNR2                                 31
     C                   UPDATE    SUBFIL
     C                   EXSR      MOVB2
     C                   END
     C  N12              EXSR      TESTB1
     C  N12
     CAN 30              GOTO      STCHG
      * VARSEL VED J=JUSTER
     C  N12BUBLST        IFEQ      'J'
      * NEGATIVT BELØP ER TREKK (PÅ PARTEN ANGITT I TRANS)
     C     BUBL          IFLT      0
     C                   MOVE      'JOV1320'     MSGNR
     C                   ELSE
     C                   MOVE      'JOV1321'     MSGNR
     C                   END
     C                   SETON                                        30
     C                   END
     C     XLIN          IFEQ      0
     C                   Z-ADD     7             LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     FERRY         BEGSR
     C***********************************************
     C* OPTON 6 PÅ SUBFIL
     C* GÅ TIL FERJEOVERSIKT FOR TUREN - FOR Å LEGGE TIL NYE/ENDRE TID-PRISER
     C* DIVERSEBOOKING (= AVD 0 / TURNR=TRANSPØRNR.)
     C* DERSOM TUR = 0 TILLATES IKKE OPTION 6.
     C*
     C     BUTUNR        IFNE      *ZEROS
     C                   MOVE      BUTAVD        WSTAVD
     C                   MOVE      BUTUNR        WSTUNR
     C     TURKEY        CHAIN(N)  TURER                              33
     C                   MOVE      *ZEROS        WSTAVD
     C                   MOVE      *ZEROS        WSTUNR
     C  N33              DO
     C                   MOVE      TUAVD         XXAVD             4 0
     C                   MOVE      TUPRO         XXTUNR            8 0
     C                   MOVE      TURUND        XXRUND            8 0
     C                   MOVE      'Y'           XXKOST            1
     C* GÅ I MODUL FOR FERGEOVERSIKT / PLUKK
     C     XXAVD         IFNE      *ZEROS
     C                   CALL      'SYTR17'
     C                   PARM                    XXAVD
     C                   PARM                    XXTUNR
     C                   PARM                    XXRUND
     C                   PARM                    XXKOST
     C                   ELSE
     C                   CALL      'SYTR17A'
     C                   PARM                    XXAVD
     C                   PARM                    XXTUNR
     C                   PARM                    XXRUND
     C                   PARM                    XXKOST
     C                   END
     C                   SETON                                        99
     C* HENT FRISKE VERDIER FRA FIL FOR VISING I SUBFIL
     C                   MOVE      BUBNR         WSBNR
     C     KODSIK        CHAIN     KOSBU                              33
     C  N33              UPDATE    KOSBUR
     C                   EXSR      KDTFM2
     C                   END
     C                   END
     C     BUST          COMP      ' '                                3232
     C   32BUST          COMP      'S'                                3232
     C                   UPDATE    SUBFIL
     C*
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     AVRTUR        BEGSR
     C***********************************************
     C* OPTON 8 PÅ SUBFIL
     C* VISE / ENDRE AVREGNING FOR EN TUR                              PRISER
     C                   MOVE      BUTAVD        XXAVD             4 0
     C                   MOVE      BUTUNR        XXTUNR            8 0
     C                   MOVE      'J'           XXVIS             1
     C     XXTUNR        IFNE      *ZEROS
     C                   CALL      'SYTR12A'
     C                   PARM                    XXAVD
     C                   PARM                    XXTUNR
     C                   PARM                    XXVIS
     C                   PARM                    N4                4 0
S01  C*                  PARM                    N5                5 0
N01  C                   PARM                    N7                7 0
     C                   PARM                    N8                8 0
     C                   SETON                                        99
     C                   MOVE      BUBNR         WSBNR
     C     KODSIK        CHAIN     KOSBU                              33
     C  N33              UPDATE    KOSBUR
     C                   EXSR      KDTFM2
     C     BUST          COMP      ' '                                3232
     C   32BUST          COMP      'S'                                3232
     C                   UPDATE    SUBFIL
     C                   END
     C*
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     COPSI         BEGSR
     C***********************************************
     C                   MOVE      *OFF          *IN30
     C                   MOVE      'DIV0000'     MSGNR
     C                   EXSR      MOVSIW
     C                   MOVE      *BLANKS       WSST
     C                   MOVE      *ZEROS        WSBNR
     C                   MOVE      *ZEROS        WSBL
     C                   MOVE      *BLANKS       WSTXT
     C                   MOVE      *BLANKS       WSKDM
     C                   SETOFF                                       31        OPD. LØPENR ??
     C                   SETOFF                                       40        *NY
     C                   SETON                                        99
     C     STCOP         TAG
     C                   EXSR      KDTFM4
     C                   EXFMT     VARELI
     C                   EXSR      KDTFM4
     C                   SETOFF                                       309089
     C   04              DO
     C                   EXSR      SØKDT2
     C                   GOTO      STCOP
     C                   END
     C   12              DO
     C                   EXSR      MOVB2
     C                   GOTO      SLCOP
     C                   END
     C* OPPDATER LØPENR PÅ HOVEDBILAGSNR - MEN KUN 1. GANG
     C  N31              DO
     C                   MOVE      BUBNR         WSBNR
     C     KODSIK        CHAIN     KOSBU                              31
     C                   Z-ADD     9999999       BUBNR3
     C                   ADD       1             BULNR3
     C     BUST          COMP      ' '                                3232
     C   32BUST          COMP      'S'                                3232
     C     W1KBNR        COMP      *ZEROS                             3131
     C   31W1KBNR        COMP      BUBNR2                                 31
     C                   UPDATE    SUBFIL
     C  N31              UPDATE    KOSBUR
     C                   MOVE      *ZEROS        WSBNR
     C                   MOVE      BUBNR         XUBNR3
     C                   MOVE      BULNR3        XULNR3
     C                   SETON                                        31
     C                   END
     C*
     C                   EXSR      TESTB1
     C   30              GOTO      STCOP
      * VARSEL VED J=JUSTER
     C  N12BUBLST        IFEQ      'J'
      * NEGATIVT BELØP ER TREKK (PÅ PARTEN ANGITT I TRANS)
     C     BUBL          IFLT      0
     C                   MOVE      'JOV1320'     MSGNR
     C                   ELSE
     C                   MOVE      'JOV1321'     MSGNR
     C                   END
     C                   SETON                                        30
     C                   END
     C*
     C                   SETOFF                                       40        *NY
     C     SLCOP         TAG
     C     XLIN          IFEQ      0
     C                   Z-ADD     7             LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     SYNCTU        BEGSR
     C***********************************************
     C     BUTXTT        IFEQ      '* TUR *'
     C     BUTAVD        ANDNE     *ZEROS
     C     BUTUNR        ANDNE     *ZEROS
     C                   MOVE      BUTAVD        WSTAVD
     C                   MOVE      BUTUNR        WSTUNR
     C     TURKEY        CHAIN     TURER                              34
     C     *IN34         IFEQ      '0'
     C     TUTREF        ANDEQ     BUBNR
     C                   MOVE      BUVAL         TUTVAL
     C                   MOVE      BUTYPE        TUTAKO
     C                   Z-ADD     BUBL          TUTBEL
     C                   UPDATE    TURERR
     C                   END
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     MOVB0         BEGSR
     C***********************************************
     C                   Z-ADD     8             LINNBR
     C     W1LNR         IFEQ      *ZEROS
     C                   Z-ADD     29            POSNBR
     C                   ELSE
     C                   Z-ADD     38            POSNBR
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     MOVB2         BEGSR
     C***********************************************
     C                   SETOFF                                       40
     C* BLANKER ALLE VARIABLE TIL BILDE VARELI
     C                   MOVE      *BLANKS       WSST
     C                   MOVE      *BLANKS       WSKDM
     C                   MOVE      *ZEROS        WSBNR
     C                   MOVE      *BLANKS       WSVK
     C                   MOVE      *ZEROS        WSBL
     C                   MOVE      *BLANKS       WSVAL
     C                   MOVE      *ZEROS        WSLNR
     C                   MOVE      *ZEROS        WSTNR
     C                   MOVE      *BLANKS       WSTYPE
     C                   MOVE      *BLANKS       WSBLST
     C     U1FLAG        IFEQ      'J'
     C     U1FLAG        OREQ      'B'
     C                   MOVE      *BLANKS       WSSG
     C                   ELSE
     C                   MOVE      UUSG          WSSG
     C                   END
     C                   MOVE      *BLANKS       WSTXT
     C                   MOVE      W1OAVD        WSOAVD
     C                   MOVE      W1OPD         WSOPD
     C                   MOVE      U1TAVD        WSTAVD
     C                   MOVE      W1TUNR        WSTUNR
     C                   MOVE      *ZEROS        WSPMN
     C                   MOVE      *ZEROS        WSPÅR
     C                   MOVE      *ZEROS        WSPCC
     C                   MOVE      *BLANKS       WSBILN
     C                   MOVE      *BLANKS       WSTNRB
     C                   MOVE      *ZEROS        WSFEDT
     C                   MOVE      *BLANKS       WSBILK
     C                   MOVE      *ZEROS        XUBNR3
     C                   MOVE      *ZEROS        XULNR3
     C* SETTER INN DEFAULT
     C                   MOVE      FICURR        WSVAL
     C     *IN97         IFEQ      '1'
     C                   MOVE      KAVAL         WSVAL
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     MOVSIW        BEGSR
     C***********************************************
     C* FLYTTER FRA FIL TIL VARELI
     C*
     C*
     C                   MOVE      BUBNR         WSBNR
     C                   MOVE      XXKDM         WSKDM
     C                   MOVE      BUVK          WSVK
     C                   MOVE      BUBL          WSBL
     C                   MOVE      BUVAL         WSVAL
     C                   MOVE      BULNR         WSLNR
     C                   MOVE      BUTNR         WSTNR
     C                   MOVE      BUTYPE        WSTYPE
     C     BUTX_7        IFEQ      '* OPD *'
     C     BUTYPE        ANDEQ     'E'
     C                   MOVE      'A'           WSTYPE
     C                   end
     C                   MOVE      BUBLST        WSBLST
     C                   MOVE      BUSG          WSSG
     C                   MOVE      BUTXT         WSTXT
     C                   MOVE      BUOAVD        WSOAVD
     C                   MOVE      BUOPD         WSOPD
     C                   MOVE      BUTAVD        WSTAVD
     C                   MOVE      BUTUNR        WSTUNR
     C                   MOVE      BUPMN         WSPMN
     C                   MOVE      BUPÅR         WSPÅR
     C                   MOVE      BUPCC         WSPCC
     C                   MOVE      BUBILN        WSBILN
     C                   MOVE      BUFEDD        WSFEDD
     C                   MOVE      BUFEDM        WSFEDM
     C                   MOVE      BUFEDÅ        WSFEDÅ
     C                   MOVE      BUBILK        WSBILK
     C                   SETON                                        40
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     14            POSNBR
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     MOVWSI        BEGSR
     C***********************************************
     C* FIX KEY IF NOT FOUND
     C   33              DO
     C                   MOVE      *BLANK        BUST
     C                   MOVE      WSBNR         BUBNR
     C                   MOVE      *ZEROS        BUBNR2
     C                   MOVE      XUBNR3        BUBNR3
     C                   MOVE      XULNR3        BULNR3
     C* DERSOM "SLAVELINJE" BEHOLD FERJEKODE FRA LINJEN SOM KOPIERES
     C     BULNR3        IFEQ      *ZEROS
     C                   MOVE      ' '           BUFER
     C                   END
     C                   MOVE      *ZEROS        BUBLFD
     C                   END
     C*
     C* FIXES VARIABLES
     C                   MOVE      WSKDM         BUKDM
     C                   MOVE      WSKDM         XXKDM
     C                   MOVE      WSVK          BUVK
     C                   MOVE      WSBL          BUBL
     C                   MOVE      WSVAL         BUVAL
     C                   MOVE      WSLNR         BULNR
     C                   MOVE      WSTYPE        BUTYPE
     C                   MOVE      WSBLST        BUBLST
     C                   MOVE      WSSG          BUSG
     C                   MOVE      WSTXT         BUTXT
     C                   MOVE      WSOAVD        BUOAVD
     C                   MOVE      WSOPD         BUOPD
     C                   MOVE      WSTAVD        BUTAVD
     C                   MOVE      WSTUNR        BUTUNR
     C* DERSOM GYLDIG TUR ER OPPGITT -MED VERDIER DERFRA DERSOM BLANK I WS...
     C     WSTUNR        IFNE      *ZEROS
     C     WSPMN         IFEQ      *ZEROS
     C                   MOVE      TURMND        WSPMN
     C                   MOVE      TURAAR        WSPÅR
     C                   MOVE      TURACC        WSPCC
     C                   END
     C     WSBILN        IFEQ      *BLANKS
     C                   MOVE      TUBILN        WSBILN
     C                   END
     C     WSBILK        IFEQ      *BLANKS
     C                   MOVE      TUBILK        WSBILK
     C                   END
     C                   END
     C                   MOVE      WSPMN         BUPMN
     C                   MOVE      WSPÅR         BUPÅR
     C     WSPÅR         IFGT      50
     C                   MOVE      '19'          WSPCC
     C                   ELSE
     C                   MOVE      '20'          WSPCC
     C                   END
     C                   MOVE      WSPCC         BUPCC
     C                   MOVE      WSTNR         BUTNR
     C                   MOVE      WSBILN        BUBILN
     C                   MOVE      WSBILK        BUBILK
     C     WSFEDT        IFEQ      *ZEROS
     C     WSTUNR        IFNE      *ZEROS                                       *HENT FRA TUR
     C                   MOVE      TUDT          BUFEDT
     C                   ELSE
     C     WSOPD         IFNE      *ZEROS                                       *HENT FRA OPPDRAG
     C                   MOVE      HEDTOP        BUFEDT
     C                   ELSE                                                   *IKKE GITT / KAN
     C                   MOVE      *ZEROS        BUFEDT                          IKKE HENTES
     C                   MOVE      *ZEROS        XXFEDT
     C                   END
     C                   END
     C                   ELSE                                                   *GITT PÅ LINJA
     C                   MOVE      WSFEDD        BUFEDD
     C                   MOVE      WSFEDM        BUFEDM
     C     WSFEDÅ        IFGT      50
     C     WSFEDÅ        ADD       1900          BUFEDÅ
     C                   ELSE
     C     WSFEDÅ        ADD       2000          BUFEDÅ
     C                   END
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFM1        BEGSR
     C***********************************************
     C                   MOVE      WS1DTD        UDT1              2 0
     C                   MOVE      WS1DTM        UDT2              2 0
     C                   MOVE      WS1DTÅ        UDT3              2 0
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WS1DTD
     C                   MOVE      UDT2          WS1DTM
     C                   MOVE      UDT3          WS1DTÅ
     C*
     C                   MOVE      WS2DTD        UDT1              2 0
     C                   MOVE      WS2DTM        UDT2              2 0
     C                   MOVE      WS2DTÅ        UDT3              2 0
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WS2DTD
     C                   MOVE      UDT2          WS2DTM
     C                   MOVE      UDT3          WS2DTÅ
     C*
     C                   ENDSR
     C***********************************************
     C     KDTFM2        BEGSR
     C***********************************************
     C                   MOVE      BUFEDD        UDT1              2 0
     C                   MOVE      BUFEDM        UDT2              2 0
     C                   MOVE      BUFEDÅ        UDT3              2 0
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          XXFEDD
     C                   MOVE      UDT2          XXFEDM
     C                   MOVE      UDT3          XXFEDÅ
     C*
     C                   ENDSR
     C***********************************************
     C     KDTFM4        BEGSR
     C***********************************************
     C                   MOVE      WSFEDD        UDT1              2 0
     C                   MOVE      WSFEDM        UDT2              2 0
     C                   MOVE      WSFEDÅ        UDT3              2 0
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WSFEDD
     C                   MOVE      UDT2          WSFEDM
     C                   MOVE      UDT3          WSFEDÅ
     C*
     C                   ENDSR
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
     C* CHANGES DATE-FORMAT FROM FIRM TO INTERNAL
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     SJDATO        BEGSR
     C***********************************************
     C                   CALL      'TESTDATO'
     C                   PARM                    UDTD
     C                   PARM                    UDTM
     C                   PARM                    UDTÅ
     C                   PARM                    UFLAGG            1 0
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C* INITIERE DATASTRUKTURER
     C* (N02 HELE FELT-INIT FLYTTET FØR!! MANIPULERING MED W1..-FELTER)
     C                   MOVE      *ZEROS        DSW1N
     C                   MOVE      *ZEROS        DSGMN
     C                   MOVE      *ZEROS        W1FED1
     C                   MOVE      *ZEROS        W1FED2
     C                   MOVE      *ZEROS        X1FED1
     C                   MOVE      *ZEROS        X1FED2
     C                   MOVE      *ZEROS        WSFEDT
     C                   MOVE      *ZEROS        XXFEDT
     C                   MOVE      *ZEROS        BUFEDT
     C                   MOVE      *ZEROS        BUDPER
     C                   MOVE      *ZEROS        MINPER
     C                   MOVE      *ZEROS        TUDT
     C* INNPARAMETER SPLITTES I DS  "PARMDS"
     C     *ENTRY        PLIST
     C                   PARM                    UUPARM          256
     C                   MOVE      UUPARM        PARMDS
     C* UPARM = C KOMMER KOMMER FRA KOSTNADSPROG - MEN FRA BLANK
     C*         FØRSTESIDE PÅ BILAGET (KUN INNREGNR + ??? FYLT UT)
      * (SKILLER IKKE LENGER FUNKSJONALITET I PLUKK)
      * (MEN NÅR FRA FØRSTE SIDE ER KABL ALLTID 0 - DA ER TEKST
      *  IKKE "REST TIL ATTESTASJ." MEN "HITTIL HENFØRT")
      * (HJELPEFLAGG FRKS02 (FRA SYKS02) ER NÅ UTEN PRAKTISK BETYDNING)
     C     U1FLAG        IFEQ      'C'
     C                   MOVE      'J'           FRKS02            1
     C     U1BNR         CHAIN     KOSTA                              33
     C                   MOVE      'K'           U1FLAG
     C                   END
     C* UPARM = K KOMMER KOMMER FRA KOSTNADSPROG - PLUKKMODUS
      * chainer kosta for å finne om bilaget mangler lev.nr
      * Skal i så fall vise inng.bilde / ellers rett på åpent for lev..
     C     U1FLAG        COMP      'K'                                    97
      * SKAL INNGANGSBILDE SKIPPES....
     C                   MOVE      'N'           SKIPP             1
     C     *IN97         IFEQ      '1'
     C                   MOVE      ' '           W1FEYN
     C     U1BNR         CHAIN     KOSTA                              33
     C     *IN33         IFEQ      '0'
     C     KALNR         ANDNE     *ZEROS
     C                   MOVE      'J'           SKIPP
     C                   END
     C                   END
     C* Ved inngang fra tur/oppdrag vis ALLE rekv. - ikke bare åpne
     C* (MEN IKKE FERJER)
     C     U1FLAG        IFEQ      'T'
     C     U1FLAG        OREQ      'O'
     C                   MOVE      '*'           W1BUST
     C                   MOVE      *ON           *IN50
     C                   MOVE      'N'           W1FEYN
     C                   MOVE      'J'           SKIPP
     C                   END
     C*
     C     U1TUNR        IFEQ      *ZEROS
     C                   MOVE      *ZEROS        U1TAVD
     C                   END
     C                   MOVE      U1BNR         W1KBNR
     C                   MOVE      U1TUNR        W1TUNR
     C                   MOVE      U1OAVD        W1OAVD
     C                   MOVE      U1OPD         W1OPD
     C     U1GN          IFNE      *BLANKS
     C                   MOVE      *ON           *IN60
     C                   MOVEL     U1GN          W1TXT2
     C                   END
     C**
     C* DERSOM U1BL ER ULIK NULL BETYR DET AT OPERATØREN ER "KASTET"
     C* AUTOMATISK OVER I SYKS12 ETTER Å HA FORSØKT Å HENFØRE I SYKS03
     C* KOSTNADER TIL OPPDRAG/TUR SOM HAR ÅPNE KOSTNADER
     C* OPERATØREN MÅ VARSLES MED RØDT OM HVA I H... SOM HAR SKJEDD...
     C     U1BL          COMP      *ZEROS                             9595
     C                   MULT      -1            U1BL
      * senere parametersette?-Om en KASTES inn med konteringsbeløp
      * Skal en returnere etter første plukkede eller skal en bli værende for å plukke flere
     c                   MOVE      'J'           U1BLRet1          1
     C**
     C**
     C     *LIKE         DEFINE    KTTYP         YBNRT
     C                   MOVE      'Å'           YBNRT
     C     *LIKE         DEFINE    BUBNR         XUBNR3
     C     *LIKE         DEFINE    BUBNR         XULNR3
     C     *LIKE         DEFINE    BULNR         YLNR
     C     *LIKE         DEFINE    BUBNR         YBNR
     C                   MOVE      *ZEROS        YLNR
     C                   MOVE      *ZEROS        YBNR
     C                   MOVE      ' '           WSST
     C                   MOVE      'GE'          YGEUNI            2
     C                   MOVE      'G2'          YG2UNI            2
     C*
     C* KEY FOR CHAIN/UPDATE
     C     KODSIK        KLIST
     C                   KFLD                    WSBNR
     C* KEY FOR Å FYLLE SUBFIL VED INNGANG - SØK STAT/BUDSJ.BILAGSNR.
     C     KOS1K         KLIST
     C                   KFLD                    W1BUST
     C                   KFLD                    W1BNR
     C* KEY FOR Å FYLLE SUBFIL VED INNGANG - SØK STAT/AVD/TURNR....
     C     KOS2K         KLIST
     C                   KFLD                    W1BUST
     C                   KFLD                    W1TUNR
     C                   KFLD                    YLNR
     C                   KFLD                    YBNR
     C* KEY FOR Å FYLLE SUBFIL VED INNGANG - SØK STAT/LEVNR
     C     KOS3K         KLIST
     C                   KFLD                    W1BUST
     C                   KFLD                    W1LNR
     C* KEY FOR Å FYLLE SUBFIL VED INNGANG - SØK STAT/TRANSP.NR
     C     KOS4K         KLIST
     C                   KFLD                    W1BUST
     C                   KFLD                    W1TNR
     C* KEY FOR Å FYLLE SUBFIL VED INNGANG - SØK STAT/LEVNR/BILNR/DATO
     C     KOS6K         KLIST
     C                   KFLD                    W1BUST
     C                   KFLD                    W1LNR
     C                   KFLD                    W1BIL1
     C                   KFLD                    X1FED1
     C* KEY FOR Å FYLLE SUBFIL VED INNGANG - SØK STAT/BILNR/DATO
     C     KOS7K         KLIST
     C                   KFLD                    W1BUST
     C                   KFLD                    W1BIL2
     C                   KFLD                    X1FED2
     C* KEY FOR Å FYLLE SUBFIL VED INNGANG - SØK STAT/AVD/OPPD.NR..
     C     KOS9K         KLIST
     C                   KFLD                    W1BUST
     C                   KFLD                    W1OAVD
     C                   KFLD                    W1OPD
     C* KEY FOR Å FYLLE SUBFIL VED INNGANG - SØK STAT/LEVNR
     C     KOS14K        KLIST
     C                   KFLD                    W1BUST
     C                   KFLD                    W1LNR
     C                   KFLD                    W1TXT1
     C* KEY FOR Å FYLLE SUBFIL VED INNGANG - SØK STAT/LEVNR
     C     KOS15K        KLIST
     C                   KFLD                    W1BUST
     C                   KFLD                    W1TXT2
     C*
     C     VALKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSVAL
     C     KODGEK        KLIST
     C                   KFLD                    YGEUNI
     C                   KFLD                    WSVK
     C     KODG2K        KLIST
     C                   KFLD                    YG2UNI
     C                   KFLD                    WSVK
     C     LEVE1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSLNR
     C     LEVEFK        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    BULNR
     C     HEADFK        KLIST
     C                   KFLD                    WSOAVD
     C                   KFLD                    WSOPD
     C     TURKEY        KLIST
     C                   KFLD                    WSTAVD
     C                   KFLD                    WSTUNR
     C     TURERK        KLIST
     C                   KFLD                    BUTAVD
     C                   KFLD                    BUTUNR
     C     TRANK         KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSTNR
     C     TRANKF        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    BUTNR
     C     KODÅKE        KLIST
     C                   KFLD                    KOÅUNI
     C                   KFLD                    KOÅCC
     C                   KFLD                    KOÅÅR
     C                   KFLD                    KOÅMND
     C     FAK2K         KLIST
     C                   KFLD                    FAAVD
     C                   KFLD                    FAOPD
     C     TRIKEY        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    XXSLAG            2
     C*
     C*
     C* HENTER MINSTE ÅPNE PERIODE (FOR KOSTNADER!!)
     C                   MOVE      'K'           KOÅUNI
     C                   MOVE      *ZEROS        KOÅMND
     C                   MOVE      *ZEROS        KOÅÅR
     C                   MOVE      *ZEROS        KOÅCC
     C     KODÅKE        SETLL     KODTÅ
     C     KOÅUNI        READE     KODTÅ                                  33
     C     *IN33         IFEQ      '1'
     C     UYEAR         IFGT      50
     C     UYEAR         ADD       1900          MINPE2            6 0
     C                   ELSE
     C     UYEAR         ADD       2000          MINPE2
     C                   END
     C                   MULT      100           MINPE2
     C                   MOVE      UMONTH        MINPE2
     C                   ELSE
     C                   MOVE      MINPER        MINPE2
     C                   END
     C*
     C                   READ      FIRM                                   33
     C     *LIKE         DEFINE    FITAX         UFITAX
     C                   MOVE      FITAX         UFITAX
     C     FITAX         ADD       1             FITAXN            5 4
     C*
     C                   MOVE      FIFIRM        UDSFIR
     C* HVIS UDS UDEFINERT - SETT AVD 0000/ SIGN BLANK
     C     *DTAARA       DEFINE    *LDA          LDADTA
     C                   IN        LDADTA
     C     UDSAVA        IFLT      '0000'
     C     UDSAVA        ORGT      '9999'
     C                   MOVE      *ZEROS        UDSAVD
     C                   MOVE      *BLANKS       UUSG
     C                   OUT       LDADTA
     C                   END
     C*
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     29            POSNBR
     C*
     C     UTI           ENDSR
     C*
