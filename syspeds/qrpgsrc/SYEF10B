********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 to MC priser       .....
10XXX * 02 SH  PTF10 ny logikk SPX
10115 * 03 CB  PTF10 Flere parameter til TDV Booking
10XXX * 04 SH  PTF10 innført coloader
10194 * 05 SH  PTF10 norsk text til Track and trace
      * 06 SH  PTF10 beregning av gebyrer kun hvis linje mangler
      * 07 SH  PTF10 byttet Æ Ø Å gebyrer kun hvis linje mangler
      * 08 SH  PTF10 MINIMUM HAR NÅ 2 DESIMALER PÅ SECURITU FUEL OG WAR
      * 09 SH  PTF10 tester security etc trenger vekttotaler
11022 * 10 CB  PTF11 støtte for eAWB
      * 11 SH  PTF11 ved endrede vekter beregnes charges på nytt
      * 12 SH  PTF11 Endring merke nummer
11051 * 13 CB  PTF11 Other Customs Information
11051 * 14 sh  PTF11 fri kode på fuel surcharge
11051 * 15 sh  PTF11 5 nye linjer side 2
********************************************************************
      ***************************************************************
      *** PROGRAM SKAL VEDL./SPORRE FLYFRAKTBREV (EKSPORT)        ***
      *** INDIKATOR 27 PA = SPORRING                              ***
      *** INDIKATOR 27 AV = VEDLIKEHOLD                           ***
      ***********************************************************
N02  FKODTASID  IF   E           K DISK
     FAIRSONE   IF   E           K DISK
     FGSSTWL02  IF   E           K DISK
     FKODTV     IF   E           K DISK
     FKODTLK    IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FVALUL01   IF   E           K DISK
     FFRISOK    IF A E           K DISK
     FKODFRI    IF   E           K DISK
     FKODTFLP   IF   E           K DISK
     FTRACKF    O  A E           K DISK
     FDOKEF     UF A E           K DISK
     FDOKEFIM   UF A E           K DISK
     FKODTW     IF   E           K DISK
     FSTED2     IF   E           K DISK
     FDOKEQ     UF A E           K DISK
     FHEADF     IF   E           K DISK
     FKODTFR    IF   E           K DISK
     FKODTFFR   IF   E           K DISK
     FKODTFT    IF   E           K DISK
     FKODTAR    IF   E           K DISK
     FSAMLB     IF   E           K DISK
     FFIRM      IF   E           K DISK
     FLOCL01    IF   E           K DISK    USROPN
     FFFR01L    IF   E           K DISK    USROPN
     FFFA01L    IF   E           K DISK    USROPN
     FKODTA     IF   E           K DISK
     FAIRLDL1   IF   E           K DISK
     FAIRNRD    IF   E           K DISK
     FISUL01    IF   E           K DISK    USROPN
     FLOGL05    IF   E           K DISK    USROPN
     FRATCDF    IF   E           K DISK
     FDIMM      UF A E           K DISK
     FKODTFS    IF   E           K DISK
     FKODTFC    IF   E           K DISK
     FKODTDIS   IF   E           K DISK
     FDOKOTH    UF A E           K DISK
     FKODTSEC   IF   E           K DISK
     FKODTWAR   IF   E           K DISK
     FSYEF10FB  CF   E             WORKSTN
     F                                     INFDS(FBAREA)
E07  D HO              S              3  2 DIM(12)
     D LE              S              3  2 DIM(12)
     D BR              S              3  2 DIM(12)
     D AN              S              3  0 DIM(12)
     D NAV             S              3    DIM(12) CTDATA PERRCD(1)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  HESAML                 1      6
     D  YSD                    1      3
     D  XLNR                   4      6
     D                 DS
     D  XVS                    1     25
     D  XAN                    1      3  0
     D  XTG1                   4      4
     D  XLE                    5      7  0
     D  XTG2                   8      8
     D  XBR                    9     11  0
     D  XTG3                  12     12
E07  D  XHO                   13     15  0
     D  XCM                   17     18
     D                 DS
     D  WSINFA                 1     71
     D  XINFA1                 1      2
     D  XINFA2                 3     71
     D                 DS
     D  KA                     1     24
     D                                     DIM(6)
     D  WSNT1                  1      4
     D  WSNT2                  5      8
     D  WSNT3                  9     12
     D  WSNT4                 13     16
     D  WSNT5                 17     20
     D  WSNT6                 21     24
     D                 DS
     D  KA1                    1     24
     D                                     DIM(6)
     D  DFNT1                  1      4
     D  DFNT2                  5      8
     D  DFNT3                  9     12
     D  DFNT4                 13     16
     D  DFNT5                 17     20
     D  DFNT6                 21     24
     D                 DS
     D  VE                     1     42  1
     D                                     DIM(6)
     D  WSVKT1                 1      7  1
     D  WSVKT2                 8     14  1
     D  WSVKT3                15     21  1
     D  WSVKT4                22     28  1
     D  WSVKT5                29     35  1
     D  WSVKT6                36     42  1
     D                 DS
     D  VE1                    1     42  1
     D                                     DIM(6)
     D  DFVKT1                 1      7  1
     D  DFVKT2                 8     14  1
     D  DFVKT3                15     21  1
     D  DFVKT4                22     28  1
     D  DFVKT5                29     35  1
     D  DFVKT6                36     42  1
     D                 DS
     D  RA                     1      6
     D                                     DIM(6)
     D  WSRC1                  1      1
     D  WSRC2                  2      2
     D  WSRC3                  3      3
     D  WSRC4                  4      4
     D  WSRC5                  5      5
     D  WSRC6                  6      6
     D                 DS
     D  RA1                    1      6
     D                                     DIM(6)
     D  DFRC1                  1      1
     D  DFRC2                  2      2
     D  DFRC3                  3      3
     D  DFRC4                  4      4
     D  DFRC5                  5      5
     D  DFRC6                  6      6
     D                 DS
     D  IT                     1     24
     D                                     DIM(6)
     D  WSCOM1                 1      4
     D  WSCOM2                 5      8
     D  WSCOM3                 9     12
     D  WSCOM4                13     16
     D  WSCOM5                17     20
     D  WSCOM6                21     24
     D                 DS
     D  IT1                    1     24
     D                                     DIM(6)
     D  DFCOM1                 1      4
     D  DFCOM2                 5      8
     D  DFCOM3                 9     12
     D  DFCOM4                13     16
     D  DFCOM5                17     20
     D  DFCOM6                21     24
     D                 DS
     D  FV                     1     42  1
     D                                     DIM(6)
     D  WSFBV1                 1      7  1
     D  WSFBV2                 8     14  1
     D  WSFBV3                15     21  1
     D  WSFBV4                22     28  1
     D  WSFBV5                29     35  1
     D  WSFBV6                36     42  1
     D                 DS
     D  FV1                    1     42  1
     D                                     DIM(6)
     D  DFFBV1                 1      7  1
     D  DFFBV2                 8     14  1
     D  DFFBV3                15     21  1
     D  DFFBV4                22     28  1
     D  DFFBV5                29     35  1
     D  DFFBV6                36     42  1
     D                 DS
     D  MI                     1      6
     D                                     DIM(6)
     D  WSRK1                  1      1
     D  WSRK2                  2      2
     D  WSRK3                  3      3
     D  WSRK4                  4      4
     D  WSRK5                  5      5
     D  WSRK6                  6      6
     D                 DS
     D  MI1                    1      6
     D                                     DIM(6)
     D  DFRK1                  1      1
     D  DFRK2                  2      2
     D  DFRK3                  3      3
     D  DFRK4                  4      4
     D  DFRK5                  5      5
     D  DFRK6                  6      6
     D                 DS
     D  PR                     1     48  2
     D                                     DIM(6)
     D  WSRPR1                 1      8  2
     D  WSRPR2                 9     16  2
     D  WSRPR3                17     24  2
     D  WSRPR4                25     32  2
     D  WSRPR5                33     40  2
     D  WSRPR6                41     48  2
     D                 DS
     D  PR1                    1     48  2
     D                                     DIM(6)
     D  DFRPR1                 1      8  2
     D  DFRPR2                 9     16  2
     D  DFRPR3                17     24  2
     D  DFRPR4                25     32  2
     D  DFRPR5                33     40  2
     D  DFRPR6                41     48  2
     D                 DS
     D  BE                     1     60  2
     D                                     DIM(6)
     D  WSBLT1                 1     10  2
     D  WSBLT2                11     20  2
     D  WSBLT3                21     30  2
     D  WSBLT4                31     40  2
     D  WSBLT5                41     50  2
     D  WSBLT6                51     60  2
     D                 DS
     D  BE1                    1     60  2
     D                                     DIM(6)
     D  DFBLT1                 1     10  2
     D  DFBLT2                11     20  2
     D  DFBLT3                21     30  2
     D  DFBLT4                31     40  2
     D  DFBLT5                41     50  2
     D  DFBLT6                51     60  2
     D                 DS
     D  VA                     1    250
     D                                     DIM(10)
     D  WSVS1                  1     25
     D  WSVS2                 26     50
     D  WSVS3                 51     75
     D  WSVS4                 76    100
     D  WSVS5                101    125
     D  WSVS6                126    150
     D  WSVS7                151    175
     D  WSVS8                176    200
     D  WSVS9                201    225
     D  WSVS10               226    250
     D                 DS
     D  VA1                    1    250
     D                                     DIM(10)
     D  DFVS1                  1     25
     D  DFVS2                 26     50
     D  DFVS3                 51     75
     D  DFVS4                 76    100
     D  DFVS5                101    125
     D  DFVS6                126    150
     D  DFVS7                151    175
     D  DFVS8                176    200
     D  DFVS9                201    225
     D  DFVS10               226    250
     D                 DS
     D  HESDF                  1      5
     D  WSSDF                  1      3
     D                 DS
     D  HESDT                  1      5
     D  WSSDT                  1      3
     D                 DS
     D  HEKNT                  1      8  0
     D  HEKNF                  6      8  0
     D                 DS
     D  M3TXT                  1     12
     D  M3FAS1                 1      3
     D  M3FAS2                 5      8
     D  M3FAS3                 9      9
     D  M3FAS4                10     12
     D                 DS
     D  WSGM12                 1     71
     D  MARKNO                 1      9
     D  HEGM1                 11     25
     D  HEGM2                 27     41
      *____________________________________________________________
      * Definisjon av parameterlisten som brukes ved kall av SM220R
      * (automatisk booking via linje). TdV IS må være installert
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     D                 DS
      * AUTTRM = '1' ---> automatisk sending uten å se ekstra bildet
      * AUTTRM = annet ---> visning av ekstra bildet med opplysninger
      * OBS. Finnes det syntax feil vises ekstra bildet uansett
     D  AUTTRM                 1      1
     D  AUTPID                 2     18
     D  AUTALN                19     21  0
     D  AUTAWB                22     29  0
     D  AUTORI                30     32
     D  AUTDES                33     35
     D  AUTSDC                36     36
     D  AUTNPI                37     40  0
     D  AUTWCD                41     41
     D  AUTWGH                42     50  1
     D  AUTTPI                51     54  0
     D  AUTMAN                55     69
     D  AUTPAR                70     72
     D  AUTPCD                73     89
     D  AUTPAI                90     92
     D  AUTOFD                93     94
     D  AUTCOD                95     96
     D  AUTRAI                97     99
      * First Flight Detail
     D  AUTCAR               100    101
     D  AUTFLN               102    106
     D  AUTDAY               107    108  0
     D  AUTMND               109    111
     D  AUTDEP               112    114
     D  AUTARR               115    117
     D  AUTSPC               118    119
     D  AUTAID               120    133
      * Second Flight Detail
     D  AU2CAR               134    135
     D  AU2FLN               136    140
     D  AU2DAY               141    142  0
     D  AU2MND               143    145
     D  AU2DEP               146    148
     D  AU2ARR               149    151
     D  AU2SPC               152    153
     D  AU2AID               154    167
     D  AU2                  134    167
      * Third Flight Detail
     D  AU3CAR               168    169
     D  AU3FLN               170    174
     D  AU3DAY               175    176  0
     D  AU3MND               177    179
     D  AU3DEP               180    182
     D  AU3ARR               183    185
     D  AU3SPC               186    187
     D  AU3AID               188    201
     D  AU3                  168    201
      * Special Handling codes (parameter values)
     D  AUSPE1               202    204
     D  AUSP11               202    202
     D  AUSP12               203    203
     D  AUSP13               204    204
     D  AUSPE2               205    207
     D  AUSP21               205    205
     D  AUSP22               206    206
     D  AUSP23               207    207
      * Future Dimensions Information
      * Instead used to Volume
     D  AUDIM                208    240
      * Volume and Volume Measurements
     D  AUVOL                208    218
     D  AUVOLM               219    220
      * Shipment Reference Information
     D  AUTREF               221    234
     D  AUTSI1               235    246
     D  AUTSI2               247    258
N03   * 09. Product Information
N03  D  AU093                301    301
N03   * 12. Customer Identification
N03  D  AU1222               302    315
N03  D  AU1224               316    322  0
N03  D  AU1226               323    326  0
N03  D  AU1228               327    329
N03  D  AU1242               330    364
N03  D  AU1252               365    382
      *
     D  AUTINF                 1    512
      *
     D                 DS
E07  D  WHO                    1     55  0
     D                                     DIM(11)
E07  D  WHO01                  1      5  0
E07  D  WHO02                  6     10  0
E07  D  WHO03                 11     15  0
E07  D  WHO04                 16     20  0
E07  D  WHO05                 21     25  0
E07  D  WHO06                 26     30  0
E07  D  WHO07                 31     35  0
E07  D  WHO08                 36     40  0
E07  D  WHO09                 41     45  0
E07  D  WHO10                 46     50  0
E07  D  WHO11                 51     55  0
     D                 DS
     D  WLE                    1     55  0
     D                                     DIM(11)
     D  WLE01                  1      5  0
     D  WLE02                  6     10  0
     D  WLE03                 11     15  0
     D  WLE04                 16     20  0
     D  WLE05                 21     25  0
     D  WLE06                 26     30  0
     D  WLE07                 31     35  0
     D  WLE08                 36     40  0
     D  WLE09                 41     45  0
     D  WLE10                 46     50  0
     D  WLE11                 51     55  0
     D                 DS
     D  WBR                    1     55  0
     D                                     DIM(11)
     D  WBR01                  1      5  0
     D  WBR02                  6     10  0
     D  WBR03                 11     15  0
     D  WBR04                 16     20  0
     D  WBR05                 21     25  0
     D  WBR06                 26     30  0
     D  WBR07                 31     35  0
     D  WBR08                 36     40  0
     D  WBR09                 41     45  0
     D  WBR10                 46     50  0
     D  WBR11                 51     55  0
     D                 DS
     D  WAN                    1     55  0
     D                                     DIM(11)
     D  WAN01                  1      5  0
     D  WAN02                  6     10  0
     D  WAN03                 11     15  0
     D  WAN04                 16     20  0
     D  WAN05                 21     25  0
     D  WAN06                 26     30  0
     D  WAN07                 31     35  0
     D  WAN08                 36     40  0
     D  WAN09                 41     45  0
     D  WAN10                 46     50  0
     D  WAN11                 51     55  0
     D                 DS
     D  HEGN                   1     15
     D  WHEGN3                 5      7
     D  WHEGN8                 8     15
     D  HEGN11                 5     15
     D                 DS
     D  WSROB1                 1      7
     D  WSRO21                 1      2
     D  WSRO41                 3      7
     D                 DS
     D  WSROB2                 1      7
     D  WSRO22                 1      2
     D  WSRO42                 3      7
     D                 DS
     D  WSROB3                 1      7
     D  WSRO23                 1      2
     D  WSRO43                 3      7
      *____________________________________________________________
      * Definisjon av parameterlisten som brukes ved kall av TDV51C
      * (Schedule Request). TdV IS må være installert
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     D                 DS
     D  BUTTRM                 1      1
     D  BUTAOR                 2      4
     D  BUTADE                 5      7
     D  BUTDA1                 8      9  0
     D  BUTMN1                10     12
     D  BUTPID                13     29
     D  BUTRA1                30     32
     D  BUTRB1                33     39
     D  BUTRC1                40     41  0
     D  BUTRA2                42     44
     D  BUTRB2                45     51
     D  BUTRC2                52     53  0
     D  BUTRA3                54     56
     D  BUTRB3                57     63
     D  BUTRC3                64     65  0
     D  BUTYKL                66     69  0
     D  BUTYAI                70     72
     D  BUTINF                 1     72
      *____________________________________________________________
      * Definition of the parameter CUTINF
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     D                 DS
     D  CUTTRM                 1      1
     D  CUTAOR                 2      4
     D  CUTADE                 5      7
     D  CUTDA1                 8      9
     D  CUTMN1                10     12
     D  CUTYE1                13     14
     D  CUTPID                15     31
     D  CUTINF                 1     31
     D                 DS
     D  WREF2                  1     12
     D  WREF2A                 1      3
     D  WREF2B                 4      4
     D  WREF2C                 5     12
     D                 DS
     D  FLIG                   1      7
     D  FAA                    1      1
     D  FAB                    2      2
     D  FBA                    3      3
     D  FBB                    4      4
     D  FBC                    5      5
     D  FCC                    6      6
     D                 DS
     D  WW112                  1     11  2
     D                 DS
N02  D  XULTIT                 1      2
N02  D  XULTIM                 3      4
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
E07  D  XULAA                 11     14  0
N02  D  XULDDA                 7      8
N02  D  XULMMA                 9     10
E07  D  XULAAA                11     14
     D                 DS
     D  ULAA                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     D                 DS            11
     D NUM             C                   CONST(' 0123456789')
     D LDADS          UDS
     D  DSTINF               801    872
      *___________________
      * DS for System Data
      *"""""""""""""""""""
     D                SDS
     D  WUSER                254    263
      *
     C                   EXSR      INIT
     C                   EXSR      UTCMDL
     C                   EXSR      TESTB
      *
     C     START         TAG
     C  N30
     CANN04              Z-ADD     2             LINNBR
     C  N30
     CANN04              Z-ADD     9             POSNBR
     C     WWWRK1        IFEQ      'A'
     C                   MOVE      'A'           WSRK1
     C                   ENDIF
      *
      * GEBYR:    EXPORT TERMINAL = CH
      *           VED SINGEL FRAKTBREV
      *           IKKE VED INNLANDSFRAKTBREV
      *
     C     HEHAWB        IFEQ      *ZEROS
     C     HELKA         IFEQ      'NO'
     C     HELKK         ANDEQ     'NO'
     C                   GOTO      UTMO
     C                   END
     C                   EXSR      SRMO
     C                   END
     C     UTMO          TAG
      *
      *----------------------------------------------
      * GEBYR:    SECURITY CHARGE = SC
      *           kan nå ha datodifferensierte records
      *----------------------------------------------
     C     KOFMK6        IFEQ      'J'
     C                   SETOFF                                       66
     C     KODSCK        SETLL     KODTSEC
     C     *in66         doweq     '0'
     C     KODSCK        READE     KODTSEC                                66
     C     *IN66         IFEQ      *OFF
     C                   MOVEL     KFCOTH        WO1331
      * SJEKK GYLDIGHETSDATO
     C     KFCTIL        IFEQ      *ZEROS
     C                   MOVE      99999999      KFCTIL
     C                   END
     C     HEDTOP        IFLE      KFCTIL
     C     HEDTOP        ANDGE     KFCFRA
     C                   EXSR      BEREGN
     C                   ENDIF
     C                   ENDIF
     C                   ENDDO
     C                   ENDIF
      *---------------------------------------------------
      * GEBYR:    FUEL SUR CHARGE = MY
      *           kan nå ha datodifferensierte records
      *---------------------------------------------------
      *
     C     KOFMK3        IFEQ      'J'
s14  C*                  MOVEL     'MY'          WO1331
     C                   move      'N'           BERFC             1
     C     HESDT         CHAIN     STED2                              73
     C  N73KEYSON        chain     airsone                            73
     C  N73              MOVEL     AIRSON        XXSONE            2
     C   73              MOVE      *blanks       XXSONE            2
     c     xxsone        ifne      *blanks
     C                   movel     xxsone        yfcuni
     C                   else
     C                   move      'FC'          yfcuni
     C                   end
      *
     C                   SETOFF                                       66
     c     nyfc          tag
     C     KODFCK        SETLL     KODTFC
     C     *in66         doweq     '0'
     C     KODFCK        READE     KODTFC                                 66
     C     *in66         ifeq      '0'
     C                   MOVEL     KFCOTH        WO1331
      * SJEKK GYLDIGHETSDATO
     C     KFCTIL        IFEQ      *ZEROS
     C                   MOVE      99999999      KFCTIL
     C                   END
     C     HEDTOP        IFLE      KFCTIL
     C     HEDTOP        ANDGE     KFCFRA
     C                   EXSR      BEREGN
     C                   ENDIF
     C                   ENDIF
     C                   ENDDO
     C                   ENDIF
      * ny løkke på standardtabell uten sone
     C     yfcuni        ifne      'FC'
     c     berfc         andeq     'N'
     c                   move      'FC'          yfcuni
     c                   setoff                                       66
     c                   goto      nyfc
     c                   end
      *
      * GEBYR:    WAR RISK SURCHARGE
      *
     C     KOFMK7        IFEQ      'J'
     C                   SETOFF                                       66
     C     KODSCK        SETLL     KODTWAR
     C     *in66         doweq     '0'
     C     KODSCK        READE     KODTWAR                                66
     C     *IN66         IFEQ      *OFF
      * SJEKK GYLDIGHETSDATO
     C     KFCTIL        IFEQ      *ZEROS
     C                   MOVE      99999999      KFCTIL
     C                   END
     C     HEDTOP        IFLE      KFCTIL
     C     HEDTOP        ANDGE     KFCFRA
     C                   MOVEL     KFCOTH        WO1331
     C                   EXSR      BEREGN
     C                   ENDIF
     C                   ENDIF
     C                   ENDDO
     C                   ENDIF
      *
      * GEBYR:    AWBFEE VED PP  LIGGER I
      *
     C     WSCCPP        IFEQ      'PP'
     C                   MOVEL     'AW'          WO1331
     C                   EXSR      BEREGNA
     C                   END
      *
      * SUMMER OTHER CHARGES
      *
     C                   EXSR      SUMOTH
      *
n11  c                   move      wsvktt        wsvkttx           7 1
n11  c                   move      wsftot        wsftotx           7 1
     C                   EXFMT     BILDE01
     C     FITDVI        IFEQ      'J'
     C     WDFCMN        ANDEQ     'J'
     C     HEGN          ANDNE     *BLANKS
     C     *IN27         ANDEQ     *OFF
     C     *IN03         IFEQ      *ON
     C     *IN05         OREQ      *ON
      * SJEKK OM AWB NUMMERET ER BOOKET VIA TDV IS.
     C                   MOVEL     'FFR'         WWMSID           17
     C                   MOVEL     WHEGN3        WREF2A
     C                   MOVEL     '-'           WREF2B
     C                   MOVEL     WHEGN8        WREF2C
     C     LOGKY         SETLL     LOGL05                                 90
     C     *IN90         IFEQ      *OFF                                         <IKKE FUNNET
     C                   EXSR      SFFR
     C                   ENDIF                                                  <*IN90
     C                   ENDIF                                                  <*IN03
     C                   ENDIF                                                  <FITDVI
     C                   MOVE      *BLANKS       WREF2
     C                   SETOFF                                       30
     C   03              Z-ADD     3             UFLAGG
     C   03
     CAN 27              GOTO      SLUTT
      *
      * SHOWS AIRFREIGHT RATES (NETTO)
      *
     C   09              DO
     C                   MOVE      'F'           UMOD              1
     C                   CALL      'SYEF63R'
     C                   PARM      WSSDF         USDF              3
     C                   PARM      WSSDT         USDT              3
     C                   PARM                    WSFSN             3 0
     C                   PARM      HEKNS         UKN               8 0
     C                   PARM                    WSRC1             1
     C                   PARM                    WSCOM1            4
     C     WSFBV1        PARM      WSFBV1        UFBV              5 0
     C                   PARM                    WSRK1             1
     C     WSRPR1        PARM      WSRPR1        URATE            13 2
     C                   PARM                    UMOD
     C                   GOTO      START
     C                   END
      *
      * MORE INFORMATIONS
      *
     C   10              DO
     C     ny10          tag
     C                   EXFMT     BILDE02
N10  C     *IN04         IFEQ      '1'
N10  C                   EXSR      SOKDTA2
N10  C                   GOTO      NY10
N10  C                   ENDIF
     c     *in(05)       ifeq      '1'
     C                   MOVE      HENAK         WSNA
     C                   MOVE      HEADK1        WSAD1
     C                   MOVE      HEADK2        WSAD2
     C                   MOVE      HEADK3        WSAD3
     c                   goto      ny10
     c                   end
N04  c                   exsr      colsr
N04  c   30              goto      ny10
     C  N12              EXSR      OPDDOQ
     C                   GOTO      START
     C                   END
      *
      * WORK WITH OTHER CHARGES
      *
     C   11              DO
     C                   CALL      'SYEF10O'
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD              7 0
     c                   PARM                    ulop
     C                   PARM                    UFLAGG
     C                   EXSR      SUMOTH
     C                   GOTO      START
     C                   ENDDO
N13   * Other Customs Information
N13  C   13              DO
N13  C                   CALL      'SYEF10I'
N13  C                   PARM                    UAVD              4 0
N13  C                   PARM                    UOPD              7 0
N13  c                   PARM                    ULOP
N13  C                   PARM                    UFLAGG
N13  C                   GOTO      START
N13  C                   ENDDO
      *
     C   12              Z-ADD     1             UFLAGG
     C   12              GOTO      SLUTT
      *
      * WORK WITH MAWB
      *
     C   14              DO
     C     YSD           IFNE      *BLANKS
     C                   CALL      'SYEF15'
     C                   PARM                    YSD
     C                   PARM                    XLNR
     C                   GOTO      START
     C                   END
     C                   END
     C     *IN19         IFEQ      '1'
     C     *IN20         OREQ      '1'
     C     *IN21         OREQ      '1'
     C     *IN22         OREQ      '1'
     C     *IN23         OREQ      '1'
     C     *IN18         OREQ      '1'
     C     FITDVI        IFNE      'J'
     C                   MOVEL     'BBA0035'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   GOTO      START
     C                   ENDIF
     C                   ENDIF
      *
      * KALL PA TDVIS RATE FORESPORSEL
      *
     C     *IN19         IFEQ      '1'
     C                   EXSR      SFTR
     C                   GOTO      START
     C                   END
      *
      * SEND BOOKING VIA TDV IS
      *
     C     *IN20         IFEQ      '1'
     C     *IN21         OREQ      '1'
     C                   EXSR      SFFR
     C                   GOTO      START
     C                   END
      *
      * KALL PA TDVIS LOGGFUNKSJON (SM040C)
      *
     C     *IN22         IFEQ      '1'
     C                   EXSR      VLOG
     C                   GOTO      START
     C                   END
      *
      * KALL PA TDVIS SCHEDUEL REQUEST
      *
     C     *IN23         IFEQ      '1'
     C                   EXSR      SFIR
     C                   GOTO      START
     C                   END
      *
      * F24=FLERE TASTER
      *
     C     *IN24         IFEQ      '1'
     C                   EXSR      UTCMDL
     C                   GOTO      START
     C                   END
      *
      * GETS CURSORPOSITION
      *
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
      *_______________
      * Prompt Routing
      *"""""""""""""""
      *
      * SOKING  (ALLE SOKINGER ER FLYTTET TIL SUBRUTINE SOKDTA)
      *
     C     *IN04         IFEQ      '1'
E07  C                   EXSR      SOKDTA
     C     LINNBR        CABNE     9             START
     C                   END
      *
      *
     C                   EXSR      TESTB
     C   30
     CORN03
     CANN05
     CANN18              GOTO      START
      *
     C     *IN27         IFEQ      *OFF
     C                   EXSR      OPDDOK
     C                   ENDIF
     C   05              Z-ADD     5             UFLAGG
      *
      * KALL PA TDVIS POWER COMM AGENT OVERFORING
      *
     C     *IN18         IFEQ      '1'
     C                   EXSR      SCOMM
     C                   GOTO      START
     C                   END
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
      ******************************************
     C     TESTB         BEGSR
      ******************************************
      *
      * TESTER BILDE NUMMER 1
      *
      * Hvis HWB og WSRK1=A --> utskrift av 'AS AGREED'
      * WSRK1=A bare tillatt for HWB
      * WSRK1=D bare tillatt for SINGEL
     C     WSRK1         IFEQ      'D'
     C     HEHAWB        ANDNE     *ZEROS
     C                   SETON                                        30
     C                   MOVE      'BBA0150'     MSGNR
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     31            POSNBR
     C                   GOTO      SLFB
     C                   END
      *
      * HVIS AS AGREAD LEGGER ' ' I WSRK1 I KEY RUBRIKK
      *
     C     WSRK1         IFEQ      'A'
     C                   MOVE      'A'           WWWRK1            1
     C                   MOVE      *BLANK        WSRK1
     C                   ELSE
     C                   MOVE      *BLANK        WWWRK1
     C                   END
     C                   MOVE      *ZEROS        WSBLT
     C                   MOVE      *ZEROS        WSNTT
     C                   MOVE      *ZEROS        WSVKTT
     C                   MOVE      *ZEROS        WSFTOT
      *
      *
      * FYLLER WORKFELTER
      *
     C                   Z-ADD     1             XN                2 0
     C     XN            DOWLE     6
     C                   EXSR      TESTVA
     C                   ADD       1             XN
     C   30              GOTO      SLFB
     C                   ENDDO                                                  <XN
      *
     C     XINFA2        IFEQ      *BLANKS
     C     XINFA1        IFNE      *BLANKS
     C                   Z-ADD     3             YLN               1 0
     C     KODFTK        CHAIN     KODTFT                             39
     C                   MOVE      *BLANKS       WSINFC
     C  N39              DO
     C                   MOVEL     KFTFTX        WSINFC
     C                   END
     C                   SUB       1             YLN
     C     KODFTK        CHAIN     KODTFT                             39
     C                   MOVE      *BLANKS       WSINFB
     C  N39              DO
     C                   MOVEL     KFTFTX        WSINFB
     C                   END
     C                   SUB       1             YLN
     C     KODFTK        CHAIN     KODTFT                             39
     C                   MOVE      *BLANKS       WSINFA
     C  N39              DO
     C                   MOVEL     KFTFTX        WSINFA
     C                   END
     C                   END
     C                   END
      *
      * TESTER OM SKAL HA MERKLAPPER
      *
     C     WSKDME        IFEQ      ' '
     C                   MOVE      'S'           WSKDME
     C                   END
      *
     C                   Z-ADD     1             XWW               2 0
     C                   Z-ADD     WSFTOT        XVKTBR            6 0
      *
     C                   MOVEA     '000'         *IN(92)
     C     WDFCMN        IFEQ      'J'
     C     WSROB1        IFEQ      *BLANKS
     C                   MOVE      *ON           *IN92
     C                   MOVE      *ON           *IN30
     C                   MOVE      'BBA0062'     MSGNR
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     25            POSNBR
     C                   ENDIF
     C     WSROA2        IFNE      *BLANKS
     C     WSROB2        ORNE      *BLANKS
     C     WSROC2        ORNE      *ZEROS
     C     WSROA2        IFEQ      *BLANKS
     C                   MOVE      *ON           *IN93
     C                   MOVE      *ON           *IN30
     C                   MOVE      'BBA0062'     MSGNR
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     43            POSNBR
     C                   ENDIF
     C                   ENDIF
     C     WSROA3        IFNE      *BLANKS
     C     WSROB3        ORNE      *BLANKS
     C     WSROC3        ORNE      *ZEROS
     C     WSROA3        IFEQ      *BLANKS
     C                   MOVE      *ON           *IN94
     C                   MOVE      *ON           *IN30
     C                   MOVE      'BBA0062'     MSGNR
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     61            POSNBR
     C                   ENDIF
     C                   ENDIF
     C     WSROB1        IFNE      *BLANKS
     C                   MOVEL     WSROB1        FLIG
     C                   Z-ADD     1             FLIGNR            1 0
     C                   EXSR      FLIGTS
     C                   ENDIF
     C     WSROB2        IFNE      *BLANKS
     C                   MOVEL     WSROB2        FLIG
     C                   Z-ADD     2             FLIGNR
     C                   EXSR      FLIGTS
     C                   ENDIF
     C     WSROB3        IFNE      *BLANKS
     C                   MOVEL     WSROB3        FLIG
     C                   Z-ADD     3             FLIGNR
     C                   EXSR      FLIGTS
     C                   ENDIF
     C                   ENDIF                                                  <WDFCMN
     C                   MOVE      UMSG          WSMSG
n02  c                   movel     WSINFB        secman            2
N02  C     secman        ifeq      '*S'
N02  C                   exsr      secsr
N02  C                   end
      *
     C     SLFB          ENDSR
      *
      ******************************************
     C     TESTVA        BEGSR
      ******************************************
      *
      * FLYTTER VEKT TIL FRAKTBEREGNINGSVEKT
      * IKKE VED RATECLASS X
      *
     C     FV(XN)        IFEQ      0
     C     RA(XN)        ANDNE     'X'
     C                   Z-ADD     VE(XN)        FV(XN)
     C                   END
      *
      * SJEKKER KUNDEAVTALER
      *
     C     BE(XN)        IFEQ      0
     C     PR(XN)        ANDEQ     0
     C     XN            ANDEQ     1
     C                   MOVE      WSFLY         XXFLY
     C                   EXSR      TSTKU
     C     FINNPRI       IFEQ      'N'
     C                   MOVE      *ZEROS        XXFLY
     C                   EXSR      TSTKU
     C                   END
     C                   END
      *
     C     STTV          TAG
     C                   MOVEL     KA(XN)        XKA               1
      *
      * TESTER VARELINJENE PA BILDET
      *
      * PROVER A TA UT NESTE LONJER DA IKKE B TASTES I RUBRUKK 1 LENGER
      *
      *
      * SKJEKKER AT RATEKLASSE FINNES I FIL
      *
     C     RA(XN)        IFNE      *BLANKS
     C     RA(XN)        SETLL     RATCDF                                 90
     C     *IN90         IFEQ      *OFF                                         <IKKE FUNNET
     C                   MOVE      *ON           *IN30
     C                   MOVE      'BBA0098'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   END
     C                   END
      *
      *   --------------------------------------------------
      *
      * FINNER RATER HVIS IKKE NOEN KODE ER TASTET
      *
      * KUN VED LINJE 1  KODENE M Q N
      *
      * F07 BEREGN PA NYTT
      *
     C   07XN            IFEQ      1
     C                   MOVE      *ZEROS        PR(1)
     C                   MOVE      *BLANKS       RA(1)
     C                   END
     C     PR(XN)        IFEQ      0                                             2<-B
     C     XN            ANDEQ     1
     C     RA(XN)        IFEQ      'M'                                            3<-B
     C     RA(XN)        OREQ      'Q'
     C     RA(XN)        OREQ      'N'
     C     RA(XN)        OREQ      ' '
     C                   MOVE      WSFSN         WSFSNQ
     C     WSRK1         IFEQ      'X'
     C                   MOVE      'P'           WSRK1
     C                   EXSR      FINNRP
     C                   MOVE      'X'           WSRK1
     c                   ELSE
     C                   EXSR      FINNRP
     c                   end
      *
      * HVIS IKKE FUNNET PROVER FLYSELSKAP 0
      *
     C     PR(XN)        IFEQ      *ZEROS
     C     BE(XN)        ANDEQ     *ZEROS
     C                   MOVE      *ZEROS        WSFSNQ
     C                   EXSR      FINNRP
     C                   END
     C  N34              GOTO      STTV2
     C                   END                                                      3<-E
     C                   END                                                     2<-E
      *
      * HENTER NETTOPRIS
      *
     C     WSNETB        IFEQ      0                                             2<-B
     C     XN            ANDEQ     1
     C                   EXSR      FINNET
     C                   END
      *
      * Regner ut totalen på hver enkelt ratelinje
      *
     C     PR(XN)        IFGT      0
     C     FV(XN)        ANDGT     0
     C     BE(XN)        ANDEQ     *ZEROS
     C     RA(XN)        IFEQ      'N'
     C     RA(XN)        OREQ      'Q'
     C     RA(XN)        OREQ      'K'
     C     RA(XN)        OREQ      'C'
     C     FV(XN)        MULT      PR(XN)        XWORK
     C                   Z-ADD(H)  XWORK         BE(XN)
     C                   ENDIF
      *
      * VED MINIMUM BASEPRIS LEGGES RATE I TOTALBELOP
      *
     C     RA(XN)        IFEQ      'M'
     C     RA(XN)        OREQ      'B'
     C                   Z-ADD     PR(XN)        XWORK
     C                   Z-ADD(H)  XWORK         BE(XN)
     C                   ENDIF
      *
      * SPESIAL VED R S
      *
     C     RA(XN)        IFEQ      'R'
     C     RA(XN)        OREQ      'S'
     C     FV(XN)        MULT      PR(XN)        XWORK
     C                   Z-ADD(H)  XWORK         BE(XN)
     C                   ENDIF
      *
      * SPESIAL VED X E U Y
      *
     C     RA(XN)        IFEQ      'X'
     C     RA(XN)        OREQ      'E'
     C     RA(XN)        OREQ      'U'
     C     RA(XN)        OREQ      'Y'
     C                   Z-ADD     BE(XN)        XWORK
     C                   ENDIF
     C                   ELSE
     C                   Z-ADD     BE(XN)        XWORK
     C                   ENDIF
     C     WSVAL         COMP      FICURR                                 36
     C   36FIDECI        IFEQ      0
     C     XWORK         ADD       0.50          BE(XN)
     C                   MOVE      '00'          BE(XN)
     C                   ELSE
     C     FIDECI        IFEQ      1
     C     XWORK         ADD       0.05          BE(XN)
     C                   MOVE      '0'           BE(XN)
     C                   END
     C                   END
      *
      *   --------------------------------------------------
      * HVIS HAWB OG RATE CODE = A (AGREEMENT) HOPPES DET OVER
      * RESTEN AV TESTENE
      * RATE COMBINATION POINT OG TEKSTLINJER ER SPESIELLE LINJER SOM
      * ER LOVLIGE PA LINJENE 2 -6 SJEKKES HER. ER DET EN AV DISSE TO
      * TYPER LINJER HOPPES DET OVER RESTEN AV DISSE TESTENE.
      *
     C     XN            IFGT      1
     C     KA(XN)        IFEQ      *BLANKS
     C     VE(XN)        ANDEQ     *ZEROS
     C     RA(XN)        ANDEQ     *BLANKS
     C     FV(XN)        ANDEQ     *ZEROS
     C     PR(XN)        ANDEQ     *ZEROS
     C     BE(XN)        ANDEQ     *ZEROS
     C     VA(XN)        ANDNE     *BLANKS
     C                   GOTO      STTV2
     C                   ENDIF
     C     KA(XN)        IFNE      *BLANKS
     C     NUM           CHECK     KA(XN)        NUMCHK            1 0
     C     NUMCHK        IFGT      0
      * Da er det IKKE bare tall og blanke i dette feltet.
      * Hvis gross weight er null skal dette tolkes som
      * Rate Combination Point linje.
     C     VE(XN)        IFEQ      0
     C                   GOTO      STTV2
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      * Alle andre typer skal ha med rate class code.
     C     KA(XN)        IFNE      *BLANKS
     C     VE(XN)        ORNE      *ZEROS
     C     IT(XN)        ORNE      *BLANKS
     C     FV(XN)        ORNE      *ZEROS
     C     PR(XN)        ORNE      *ZEROS
     C     BE(XN)        ORNE      *ZEROS
     C     RA(XN)        SETLL     RATCDF                                 90
     C     *IN90         IFEQ      *OFF                                         <IKKE FUNNET
     C                   SETON                                        30
     C                   MOVE      'BBA0106'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF
      *
      * TESTER INNHOLDET AV RATELINJE 1. DET ER SPESIELLE REGLER FOR
      * DENNE LINJEN.
      *
     C     XN            IFEQ      1
     C     RA(XN)        IFEQ      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'DIV1127'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   END
      *
      * FORSTE RATELINJE MA VÆRE EN AV DISSE
      *
     C     RA(XN)        IFNE      'M'
     C     RA(XN)        ANDNE     'A'
     C     RA(XN)        ANDNE     'N'
     C     RA(XN)        ANDNE     'Q'
     C     RA(XN)        ANDNE     'B'
     C     RA(XN)        ANDNE     'C'
     C     RA(XN)        ANDNE     'R'
     C     RA(XN)        ANDNE     'S'
     C     RA(XN)        ANDNE     'U'
     C                   SETON                                        30
     C                   MOVE      'BBA0099'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   END
      *
     C     RA(XN)        IFEQ      'M'
     C     RA(XN)        OREQ      'N'
     C     RA(XN)        OREQ      'Q'
     C     RA(XN)        OREQ      'B'
     C     KA(XN)        IFEQ      *BLANKS
     C     VE(XN)        OREQ      *ZEROS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C     VA(XN)        OREQ      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0100'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C     IT(XN)        IFNE      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0101'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
      *
      * SPESIAL VED RATEKLASSE C
      *
     C     RA(XN)        IFEQ      'C'
     C     KA(XN)        IFEQ      *BLANKS
     C     VE(XN)        OREQ      *ZEROS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C     VA(XN)        OREQ      *BLANKS
     C     IT(XN)        OREQ      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0102'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
      *
      * SPESIAL VED RATEKLASSE U
      *
     C     RA(XN)        IFEQ      'U'
     C     KA(XN)        IFEQ      *BLANKS
     C     VE(XN)        OREQ      *ZEROS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C     VA(XN)        OREQ      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0100'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
     C                   ENDIF                                                  <XN
      *
      * GENERELLE TESTER FOR RATELINJENE 1 - 6.
      *
     C     RA(XN)        IFEQ      'N'
     C     RA(XN)        OREQ      'Q'
     C     VE(XN)        IFEQ      *ZEROS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C                   SETON                                        30
     C                   MOVE      'BBA0109'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C     IT(XN)        IFNE      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0101'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
      *
      * TESTER VED RATEKLASSE M/C/U  START
      *
     C     RA(XN)        IFEQ      'M'
     C     RA(XN)        OREQ      'C'
     C     RA(XN)        OREQ      'U'
     C     VE(XN)        IFEQ      *ZEROS
     C     KA(XN)        OREQ      *BLANKS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C                   SETON                                        30
     C                   MOVE      'BBA0100'     MSGNR
     C     RA(XN)        IFEQ      'C'
     C                   MOVE      'BBA0102'     MSGNR
     C                   ENDIF
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
      *
      * KAN IKKE HA RATEKLASSE M=MINIMUM VED TASTET ITEMNUMMER
      *
     C     RA(XN)        IFEQ      'M'
     C     IT(XN)        ANDNE     *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0101'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
      *
      * MA HA ITEMNUMMER VED RATEKLASSE C
      *
     C     RA(XN)        IFEQ      'C'
     C     IT(XN)        ANDEQ     *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0107'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
      *
      * TESTER VED RATEKLASSE M/C/U  SLUTT
      *
      *
      * TESTER RATEKLASSE B = BASIS
      *
     C     RA(XN)        IFEQ      'B'
     C     VE(XN)        IFEQ      *ZEROS
     C     KA(XN)        OREQ      *BLANKS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C     VA(XN)        OREQ      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0100'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C     IT(XN)        IFNE      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0101'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     17            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
     C     RA(1)         IFEQ      'B'
     C     RA(2)         ANDNE     'K'
     C                   SETON                                        30
     C                   MOVE      'BBA0108'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C     RA(XN)        IFEQ      'E'
     C     VE(XN)        IFNE      *ZEROS
     C     KA(XN)        ORNE      *BLANKS
     C     IT(XN)        ORNE      *BLANKS
     C     FV(XN)        OREQ      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C                   SETON                                        30
     C                   MOVE      'BBA0103'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
     C     RA(XN)        IFEQ      'X'
     C     VA(XN)        IFEQ      *BLANKS
     C     KA(XN)        ORNE      *BLANKS
     C     PR(XN)        ORNE      *ZEROS
     C     BE(XN)        ORNE      *ZEROS
     C                   SETON                                        30
     C                   MOVE      'BBA0104'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
     C     RA(XN)        IFEQ      'Y'
     C     FV(XN)        IFEQ      *ZEROS
     C     KA(XN)        ORNE      *BLANKS
     C     VE(XN)        ORNE      *ZEROS
     C     PR(XN)        OREQ      *ZEROS
     C     BE(XN)        OREQ      *ZEROS
     C     IT(XN)        ORNE      *BLANKS
     C                   SETON                                        30
     C                   MOVE      'BBA0105'     MSGNR
     C     XN            ADD       12            LINNBR
     C                   Z-ADD     15            POSNBR
     C                   GOTO      SLTV
     C                   ENDIF
     C                   ENDIF                                                  <RA,XN
      *
     C     STTV2         TAG
     C                   ADD       BE(XN)        WSBLT
     C     XKA           IFNE      'R'
     C     NUM           CHECK     KA(XN)        NUMCHK
     C     NUMCHK        IFEQ      0
     C                   MOVE      KA(XN)        XKAKA             4 0
     C                   ADD       XKAKA         WSNTT
     C                   ENDIF
     C                   END
      *
n09  c     sltv          tag
     C                   ADD       VE(XN)        WSVKTT
     C                   ADD       FV(XN)        WSFTOT
      *
s09  C*    SLTV          ENDSR
n09  C                   ENDSR
      ******************************************
     C     FINNRP        BEGSR
      ******************************************
      *
      * VED Z/P/B I P - RUBRIKK
      * KODEN GAR TIL NOKKELBEGREP
      * HVIS IKKE GAR RC TIL NOKKELBEGREP
      * YRCOD ER FELTET I KEYBEGREPET
      * DETTE SKAL KUNNE VÆRE Q M N K
      *
     C                   MOVE      RA(1)         YRCOD             1
      *
     C                   Z-ADD(H)  FV(XN)        YRWEI
      *
     C     STFIRP        TAG
     C     AIRL1K        SETLL     AIRLDL1                            34
     C     STFIR2        TAG
     C     AIR1K1        READE     AIRLDL1                                34
      *
      * GJELDER HAWB VED SAMLAST
      *
     C  N34
     CAN 41              Z-ADD     AIRHAW        AIRAWB
     C  N34
     CAN 41              Z-ADD     AIRHAM        AIRGRN
      *
      *
      * VED N/Q MA SAMME KODE VÆRE FUNNET I PRISTABELL
      * LES NESTE HVIS IKKE KLASSE N OG Q SAMSVARER
      *
     C  N34YRCOD         IFEQ      'N'
     C     YRCOD         OREQ      'Q'
     C     AIRCOD        IFNE      'N'
     C     AIRCOD        ANDNE     'Q'
      *EVT LES NESTE
     C                   GOTO      STFIR2
     C                   END
     C                   END
      *
      * VED KODE M BENYTTES MINIMUMSPRIS UANSETT
      *
     C  N34YRCOD         IFEQ      'M'                                          1<-B
     C                   MOVE      *ZEROS        PR(XN)
     C                   Z-ADD(H)  AIRGRN        BE(XN)
     C                   MOVE      'M'           RA(XN)
     C                   Z-ADD     AIRGRN        PR(XN)
     C                   GOTO      UTFRA
     C                   ELSE                                                   1
      *
      * LOGIKK VED N/Q RATER
      *
     C     YRCOD         IFEQ      'N'
     C     YRCOD         OREQ      'Q'
     C     YRCOD         OREQ      *BLANK
     C     AIRCOD        IFEQ      'N'
     C     AIRCOD        OREQ      'Q'
     C                   Z-ADD     AIRAWB        PR(1)
     C                   MOVE      AIRCOD        RA(1)
     C                   ENDIF
     C                   ENDIF
      *
      * LOGIKK VED K RATER / GENERERER 2 LINJER
      *
     C     AIRCOD        IFEQ      'K'
     C                   MOVEL     WSROB2        TESTW1            2
     C                   MOVEL     WSROB2        TESTW2            2
     C     TESTW1        IFEQ      'WF'
     C     TESTW2        OREQ      'WF'
     C                   ADD       8             AIRAWB
     C                   END
     C                   Z-ADD     AIRAWB        PR(2)
     C                   Z-ADD(H)  AIRGRN        BE(1)
     C                   Z-ADD(H)  AIRGRN        PR(1)
     C                   MOVE      'B'           RA(1)
     C                   MOVE      AIRCOD        RA(2)
     C     FV(1)         IFGT      AIRHAW
     C     FV(1)         SUB       AIRHAW        FV(2)
     C                   END
     C     AIRAWB        MULT(H)   FV(2)         BE(2)
     C                   Z-ADD     1             FV(1)
     C                   GOTO      BKTAG
     C                   ENDIF
      *
      *
     C     AIRAWB        MULT      FV(XN)        XWORK
      *
      * VED B/P PLUSSES PA GRUNNLAG
      *
      *
      * SJEKKES OM MINDRE ENN MINIMUMSPRIS
      *
     C     XN            IFEQ      1
     C     YRCOD         IFEQ      *BLANK
     C     YRCOD         OREQ      'N'
     C     YRCOD         OREQ      'Q'
     C     AIRCOD        IFEQ      'N'
     C     AIRCOD        OREQ      'Q'
     C     XWORK         IFLT      AIRGRN                                         3<-B
     C                   Z-ADD(H)  AIRGRN        BE(XN)
     C                   MOVE      'M'           RA(XN)
     C                   Z-ADD(H)  AIRGRN        PR(XN)
     C                   GOTO      UTFRA
     C                   ELSE                                                     3
     C     YRCOD         IFEQ      ' '                                             4<-B
     C                   MOVE      AIRCOD        RA(XN)
     C                   END                                                       4<-E
     C                   Z-ADD(H)  XWORK         BE(XN)
E07  C                   Z-ADD(H)  XWORK         YBELOP           13 2
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   END
     C                   END
      *
      * HVIS IKKE VEKTGRUPPE ER 99999  SJEKKER PRIS I NESTE VEKTINT
      *
     C     AIRWEI        IFNE      99999                                         2<-B
     C     AIRWEI        ADD       1             YRWEI
     C     AIR1K1        READE     AIRLDL1                                34
     C     *IN34         IFEQ      *OFF
     C                   ENDIF
      *
      * GJELDER HAWB
      *
     C  N34
     CAN 41              Z-ADD     AIRHAW        AIRAWB
     C  N34
     CAN 41              Z-ADD     AIRHAM        AIRGRN
      *
      * TESTER MOT MINIMUM
      *
     C  N34AIRCOD        IFNE      'M'                                            3<-B
     C     AIRAWB        MULT      YRWEI         XWORK
     C     XWORK         IFLT      AIRGRN                                           5<-B
E07  C                   Z-ADD(H)  AIRGRN        XBELOP           13 2
     C                   ELSE                                                       5
E07  C                   Z-ADD(H)  XWORK         XBELOP
     C                   END                                                        5<-E
E07  C     XBELOP        IFLT      YBELOP                                          4<-B
     C                   MOVE      AIRCOD        RA(1)
     C     XN            IFEQ      1
     C                   Z-ADD     YRWEI         FV(XN)
E07  C                   Z-ADD     XBELOP        BE(XN)
     C                   Z-ADD     AIRAWB        PR(XN)
     C                   ENDIF
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C     BKTAG         TAG
     C     WSVAL         COMP      FICURR                                 34
     C   34FIDECI        IFEQ      0                                             2<-B
     C                   ADD       0.50          BE(XN)
     C                   MOVE      '00'          BE(XN)
     C                   ELSE                                                    2
     C     FIDECI        IFEQ      1                                              3<-B
     C                   ADD       0.05          BE(XN)
     C                   MOVE      '0'           BE(XN)
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   SETOFF                                       34
     C                   END                                                    1<-E
      *
     C     UTFRA         ENDSR
      *
      ******************************************
     C     FINNET        BEGSR
      ******************************************
      * FINNER NETTOPRIS
      * VED Z/P I P - RUBRIKK
      * KODEN GAR TIL NOKKELBEGREP
      * HVIS IKKE GAR RC TIL NOKKELBEGREP
      * YRCOD ER FELTET I KEYBEGREPET
      * DETTE SKAL KUNNE VÆRE Q M N
      *
     C                   MOVE      WSFSN         WSFSNQ
     C                   MOVE      RA(1)         YRCOD             1
      *
     C                   Z-ADD(H)  FV(XN)        YRWEI
      *
     C     STNETP        TAG
     C     AIR1K1        SETLL     AIRNRD                             34
     C     STNET2        TAG
     C     AIR1K1        READE     AIRNRD                                 34
      *
      * PROVER OGSA FLYSELSKAP 0
      *
     C   34WSFSNQ        IFNE      *ZEROS
     C                   MOVE      *ZEROS        WSFSNQ
     C                   GOTO      STNETP
     C                   ELSE
     C                   GOTO      UTNET
     C                   END
      *
      *
      * VED N/Q MA SAMME KODE VÆRE FUNNET I PRISTABELL
      * LES NESTE HVIS IKKE KLASSE N OG Q SAMSVARER
      *
     C  N34YRCOD         IFEQ      'N'
     C     YRCOD         OREQ      'Q'
     C     AIRCOD        IFNE      'N'
     C     AIRCOD        ANDNE     'Q'
     C                   GOTO      STNET2
     C                   END
     C                   END
      *
      * VED KODE M BENYTTES MINIMUMSPRIS UANSETT
      *
     C  N34YRCOD         IFEQ      'M'                                          1<-B
     C                   Z-ADD(H)  AIRGRN        WSNETB
     C                   GOTO      UTNET
     C                   ELSE                                                   1
      *
     C     YRCOD         IFEQ      'N'
     C     YRCOD         OREQ      'Q'
     C     YRCOD         OREQ      *BLANK
     C     AIRCOD        IFEQ      'N'
     C     AIRCOD        OREQ      'Q'
     C     AIRAWB        MULT      FV(XN)        WSNETB
     C     WSNETB        IFLT      AIRGRN                                         3<-B
     C                   Z-ADD     AIRGRN        WSNETB
     C                   GOTO      UTNET
     C                   END
     C                   END
     C                   ENDIF
     C                   ENDIF
      *
      *
     C     UTNET         ENDSR
      *
      ***********************************************
     C     MOVDFW        BEGSR
      ***********************************************
     C     *IN41         IFEQ      '0'
s02  c*                  move      *blanks       secuns           13
n02  c                   move      *blanks       secuns           71
     C     KEYSEL        CHAIN     CUNDL01                            34
     C     *IN34         IFEQ      '0'
     C     SYFR04        IFEQ      'Y '
S02  C*                  MOVEL     '"SPX"'       SECUNS
N02  c                   exsr      secsr
     C                   END
     C                   END
     C                   END
     C     HEGN          IFEQ      *ZEROS
     C     HEGN          OREQ      *BLANKS
     C                   MOVE      *ZEROS        WSFSN
     C                   ELSE
     C                   MOVEL     WHEGN3        WSFSN
     C                   END
      *
     C                   MOVE      KFRCP         WSCCPP
      *
      * VED ENDRING AV FRAKTBREV
      *
     C  N33              DO
     C                   MOVE      DFTLFS        WSTLFS
     C                   MOVE      DFTLFK        WSTLFK
     C                   MOVE      DFINF1        WSINF1
     C                   MOVE      DFINF2        WSINF2
     C                   MOVE      DFROA1        WSROA1
     C                   MOVE      DFROB1        WSROB1
     C                   MOVE      DFROC1        WSROC1
     C                   MOVE      DFROA2        WSROA2
     C                   MOVE      DFROB2        WSROB2
     C                   MOVE      DFROC2        WSROC2
     C                   MOVE      DFROA3        WSROA3
     C                   MOVE      DFROB3        WSROB3
     C                   MOVE      DFROC3        WSROC3
     C                   MOVE      DFVAL         WSVAL
     C                   MOVE      DFDVCA        WSDVCA
     C                   MOVE      DFDVCU        WSDVCU
     C                   MOVE      DFBELF        WSBELF
     C                   MOVE      DFINFA        WSINFA
     C                   MOVE      DFINFB        WSINFB
     C                   MOVEL     DFINFC        WSINFC
     C                   MOVE      KA1           KA
     C                   MOVE      VE1           VE
     C                   MOVE      RA1           RA
     C                   MOVE      IT1           IT
     C                   MOVE      FV1           FV
     C                   MOVE      MI1           MI
     C                   MOVE      PR1           PR
     C                   MOVE      BE1           BE
     C                   MOVE      VA1           VA
     C                   MOVE      DFNTT         WSNTT
     C                   MOVE      DFVKTT        WSVKTT
     C                   MOVE      DFBLT         WSBLT
     C                   MOVE      DFNETT        WSNETB
     C     WSKDDC        IFEQ      *BLANKS
     C     WSCCPP        IFEQ      'CC'
     C                   MOVE      'C'           WSKDDC
     C                   ENDIF                                                  <WSCCPP
     C     WSCCPP        IFEQ      'PP'
     C                   MOVE      'P'           WSKDDC
     C                   ENDIF                                                  <WSCCPP
     C                   ENDIF                                                  <WSCCPP
     C*
     C*
     C*
     C*
     C                   MOVE      DFBLDC        WSBLDC
     C                   MOVE      DFBLA         WSBLA
     C                   MOVE      DFKDME        WSKDME
     C                   MOVE      DFBLAV        WSBLAV
     C                   MOVE      DFFT          WSFT
     C                   MOVE      UMSG          WSMSG
     C                   MOVE      DFCMN         WDFCMN
     C     HEHAWB        IFEQ      *ZEROS
     C                   MOVE      'J'           WDFCMN
     C                   ELSE
     C                   MOVE      'N'           WDFCMN
     C                   ENDIF
     C                   MOVE      DFTOLS        WSTOLS
     C                   Z-ADD     DFETD1        WFETD1
     C                   Z-ADD     DFETA1        WFETA1
     C                   Z-ADD     DFEDA1        WFEDA1
     C                   Z-ADD     DFETD2        WFETD2
     C                   Z-ADD     DFETA2        WFETA2
     C                   Z-ADD     DFEDA2        WFEDA2
     C                   Z-ADD     DFETD3        WFETD3
     C                   Z-ADD     DFETA3        WFETA3
     C                   Z-ADD     DFEDA3        WFEDA3
N10  C                   EVAL      WSSPH1=DFSPH1
N10  C                   EVAL      WSSPH2=DFSPH2
N10  C                   EVAL      WSSPH3=DFSPH3
N10  C                   EVAL      WSSPH4=DFSPH4
N10  C                   EVAL      WSSPH5=DFSPH5
N10  C                   EVAL      WSSPH6=DFSPH6
N10  C                   EVAL      WSSPH7=DFSPH7
N10  C                   EVAL      WSSPH8=DFSPH8
N10  C                   EVAL      WSSPH9=DFSPH9
     C                   END
      *-------------------------------------------------------
      * VED NYTT FRAKTBREV
      *-----------------------------------------------------
s02  C*                  MOVE      SECUNS        WSINFB
n02  C     SECUNS        IFNE      *BLANKS
n02  C                   MOVEL     SECUNS        WSINFB
n02  C                   END
     C   33              DO
     C                   MOVE      *BLANKS       KA
     C                   MOVE      *ZEROS        VE
     C                   MOVE      *BLANKS       RA
     C                   MOVE      *BLANKS       IT
     C                   MOVE      *ZEROS        FV
     C                   MOVE      *BLANKS       MI
     C                   MOVE      *ZEROS        PR
     C                   MOVE      *ZEROS        BE
     C                   MOVE      *BLANKS       VA
     C     FITDVI        IFEQ      'J'
     C     HEHAWB        ANDEQ     *ZEROS
     C                   MOVE      'J'           WDFCMN
     C                   ELSE
     C                   MOVE      'N'           WDFCMN
     C                   ENDIF
     C     UFLYTM        COMP      'J'                                    35
     C   35              DO
E07  C                   MOVE      HO(1)         XHO
     C                   MOVE      LE(1)         XLE
     C                   MOVE      BR(1)         XBR
     C                   MOVE      AN(1)         XAN
     C                   MOVE      XVS           VA(3)
     C     AN(2)         IFNE      0
E07  C                   MOVE      HO(2)         XHO
     C                   MOVE      LE(2)         XLE
     C                   MOVE      BR(2)         XBR
     C                   MOVE      AN(2)         XAN
     C                   MOVE      XVS           VA(4)
     C                   END
     C     AN(3)         IFNE      0
E07  C                   MOVE      HO(3)         XHO
     C                   MOVE      LE(3)         XLE
     C                   MOVE      BR(3)         XBR
     C                   MOVE      AN(3)         XAN
     C                   MOVE      XVS           VA(5)
     C                   END
     C     AN(4)         IFNE      0
E07  C                   MOVE      HO(4)         XHO
     C                   MOVE      LE(4)         XLE
     C                   MOVE      BR(4)         XBR
     C                   MOVE      AN(4)         XAN
     C                   MOVE      XVS           VA(6)
     C                   END
     C     AN(5)         IFNE      0
E07  C                   MOVE      HO(5)         XHO
     C                   MOVE      LE(5)         XLE
     C                   MOVE      BR(5)         XBR
     C                   MOVE      AN(5)         XAN
     C                   MOVE      XVS           VA(7)
     C                   END
     C     AN(6)         IFNE      0
E07  C                   MOVE      HO(6)         XHO
     C                   MOVE      LE(6)         XLE
     C                   MOVE      BR(6)         XBR
     C                   MOVE      AN(6)         XAN
     C                   MOVE      XVS           VA(8)
     C                   END
     C     AN(7)         IFNE      0
E07  C                   MOVE      HO(7)         XHO
     C                   MOVE      LE(7)         XLE
     C                   MOVE      BR(7)         XBR
     C                   MOVE      AN(7)         XAN
     C                   MOVE      XVS           VA(9)
     C                   END
     C     AN(8)         IFNE      0
E07  C                   MOVE      HO(8)         XHO
     C                   MOVE      LE(8)         XLE
     C                   MOVE      BR(8)         XBR
     C                   MOVE      AN(8)         XAN
     C                   MOVE      XVS           VA(10)
     C                   END
     C     AN(9)         IFNE      0
E07  C                   MOVE      HO(9)         XHO
     C                   MOVE      LE(9)         XLE
     C                   MOVE      BR(9)         XBR
     C                   MOVE      AN(9)         XAN
     C                   MOVE      XVS           WSVS11
     C                   END
     C     AN(10)        IFNE      0
E07  C                   MOVE      HO(10)        XHO
     C                   MOVE      LE(10)        XLE
     C                   MOVE      BR(10)        XBR
     C                   MOVE      AN(10)        XAN
     C                   MOVE      XVS           WSVS12
     C                   END
     C     AN(11)        IFNE      0
E07  C                   MOVE      HO(11)        XHO
     C                   MOVE      LE(11)        XLE
     C                   MOVE      BR(11)        XBR
     C                   MOVE      AN(11)        XAN
     C                   MOVE      XVS           WSVS13
     C                   END
     C                   END
     C  N35              DO
     C     HEM3          IFNE      *ZEROS
     C                   MOVEL     M3TXT         VA(3)
     C                   END
     C                   END
      *
      * TAR ROUTING FRA SAMLAST HVIS SATT PA SAMLAST
     C     HEHAWB        COMP      *ZEROS                             4141
      *
      * TAR ELLERS ANBEFALT ROUTING
     C     UANRUT        COMP      'J'                                    42
     C     KODFRK        CHAIN     KODTFR                             39
     C  N41
     CAN 42KODARK        CHAIN     KODTAR                             39
      *
     C                   MOVE      USTLF         WSTLFS
     C                   MOVE      UKTLF         WSTLFK
     C  N41
     CAN 42              DO
     C                   MOVE      KARRA1        WSROA1
     C                   MOVE      KARRB1        WSROB1
     C                   MOVE      KARRA2        WSROA2
     C                   MOVE      KARRB2        WSROB2
     C                   MOVE      KARRA3        WSROA3
     C                   MOVE      KARRB3        WSROB3
     C                   END
     C   41              DO
     C                   MOVE      SMROA1        WSROA1
     C                   MOVEl     SMROB1        WSROB1
     C                   MOVE      SMROC1        WSROC1
     C                   MOVE      SMROA2        WSROA2
     C                   MOVEl     SMROB2        WSROB2
     C                   MOVE      SMROC2        WSROC2
     C                   MOVE      SMROA3        WSROA3
     C                   MOVEl     SMROB3        WSROB3
     C                   MOVE      SMROC3        WSROC3
     C                   MOVE      SMETD1        WFETD1
     C                   MOVE      SMETA1        WFETA1
     C                   MOVE      SMEDA1        WFEDA1
     C                   MOVE      SMETD2        WFETD2
     C                   MOVE      SMETA2        WFETA2
     C                   MOVE      SMEDA2        WFEDA2
     C                   MOVE      SMETD3        WFETD3
     C                   MOVE      SMETA3        WFETA3
     C                   MOVE      SMEDA3        WFEDA3
     C                   END
     C                   MOVE      FICURR        WSVAL
     C                   MOVEL     'NVD'         WSDVCA
     C                   MOVEL     'NVD'         WSDVCU
     C     ulop          ifle      1
     C                   MOVE      HENT          KA(1)
     C                   Z-ADD     HEVKT         VE(1)
     C                   Z-ADD     HEFBV         FV(1)
     C                   end
     C                   MOVE      HEVS1         VA(1)
     C                   MOVE      HEVS2         VA(2)
     C     TRSTA4        IFNE      'E'
     C     TRSTA4        IFEQ      'P'
     C     TRSTA4        OREQ      'X'
     C                   move      TRSTA4        WSRK1
     c                   END
     C                   Z-ADD     1             XN
     C                   MOVE      WSFSN         WSFSNQ
     C                   EXSR      FINNRP
     C                   END
     C     HEGM1         IFNE      *BLANKS
     C     HEGM2         ORNE      *BLANKS
n12  C                   MOVEL     'Marks/no'    MARKNO
n12  C                   MOVE      ':'           MARKNO
     C                   MOVE      WSGM12        WSINFA
     C                   END
     C     HEKNSF        IFEQ      0
     C                   MOVE      KARTXT        WSMSG
     C                   ELSE
     C                   MOVE      UMSG          WSMSG
     C                   END
     C                   END
      * henter fra skipssystem web
     C     sskey         chain     GSSTWL02                           34
     c     *in34         ifeq      '0'
     c                   exsr      shiweb
     c                   end
      *
      * Henter AWB Fee
     C     'DISPU'       CHAIN     KODTDIS                            33
     C     *IN33         IFEQ      *OFF
     C     KOFMK5        IFNE      'N'
     C     HELKA         IFEQ      'NO'
     C     HELKK         ANDEQ     'NO'
     C                   Z-ADD     KDSBL5        MCAWFE            5 0
     C                   ELSE
     C                   Z-ADD     KDSBL4        MCAWFE
     C                   ENDIF
     C                   ENDIF
     C                   Z-ADD     HEKNT         WFLY              3 0
      *
     C                   ENDIF
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVDQW        BEGSR
      ***********************************************
N04  C                   MOVE      DQCOL         WSCONR
N04  C     WSCONR        IFNE      *ZEROS
N04  C                   exsr      colsr
N04  c                   end
     C                   MOVE      DQNA          WSNA
     C                   MOVE      DQAD1         WSAD1
     C                   MOVE      DQAD2         WSAD2
     C                   MOVE      DQAD3         WSAD3
     C                   MOVE      DQAD4         WSAD4
     C                   MOVEL     DQINFD        WSINFD
     C                   MOVE      DQINF3        WSINF3
     C                   MOVE      DQINF4        WSINF4
     C                   MOVE      DQINF5        WSINF5
     C                   MOVE      DQINF6        WSINF6
     C                   MOVE      DQINF7        WSINF7
     C                   MOVE      DQINF8        WSINF8
     C                   MOVE      DQINF9        WSINF9
     C                   MOVE      DQVS11        WSVS11
     C                   MOVE      DQVS12        WSVS12
     C                   MOVE      DQVS13        WSVS13
N15  C                   MOVE      DQVS14        WSVS14
N15  C                   MOVE      DQVS15        WSVS15
N15  C                   MOVE      DQVS16        WSVS16
N15  C                   MOVE      DQVS17        WSVS17
N15  C                   MOVE      DQVS18        WSVS18
      *
     C                   ENDSR
      *
N04   ***********************************************
N04  C     COLSR         BEGSR
N04   ***********************************************
N04   *
N04   * COLOADER
N04  C                   SETOFF                                       8930
N04  C                   move      *blanks       wscona
N04  C     WSCONR        IFNE      *ZEROS
N04  C     KEYCOL        CHAIN     CUNDL01                            89
N04  C  N89              MOVE      KNAVN         WSCONA
N04  C   89              SETON                                        30
N04  C   30              MOVE      'SPK0001'     MSGNR
N04  C                   END
N04  C                   ENDSR
      ***********************************************
     C     OPDDOK        BEGSR
      ***********************************************
     C     DOKEFK        CHAIN     DOKEF                              33
      *
     C   33              DO
     C                   MOVE      YRI           DFRI
     C                   MOVE      UAVD          DFAVD
     C                   MOVE      UOPD          DFOPD
     C                   MOVE      ULOP          DFLOP
     C                   END
      *
     C                   MOVE      ' '           DFST
     C                   MOVE      HESG          DFSG
     C                   MOVE      WSTLFS        DFTLFS
     C                   MOVE      WSTLFK        DFTLFK
     C                   MOVE      WSINF1        DFINF1
     C                   MOVE      WSINF2        DFINF2
     C                   MOVE      WSCCPP        DFCCPP
     C                   MOVE      WSFSN         DFFSN
     C                   MOVE      WSROA1        DFROA1
     C                   MOVE      WSROB1        DFROB1
     C                   MOVE      WSROC1        DFROC1
     C                   MOVE      WSROA2        DFROA2
     C                   MOVE      WSROB2        DFROB2
     C                   MOVE      WSROC2        DFROC2
     C                   MOVE      WSROA3        DFROA3
     C                   MOVE      WSROB3        DFROB3
     C                   MOVE      WSROC3        DFROC3
     C                   MOVE      WSVAL         DFVAL
     C                   MOVE      WSDVCA        DFDVCA
     C                   MOVE      WSDVCU        DFDVCU
     C                   MOVE      WSBELF        DFBELF
     C                   MOVE      WSINFA        DFINFA
     C                   MOVE      WSINFB        DFINFB
     C                   MOVEL     WSINFC        DFINFC
     C                   MOVE      KA            KA1
     C                   MOVE      VE            VE1
     C                   MOVE      RA            RA1
     C                   MOVE      IT            IT1
     C                   MOVE      FV            FV1
     C                   MOVE      MI            MI1
     C                   MOVE      PR            PR1
     C                   MOVE      BE            BE1
     C                   MOVE      VA            VA1
     C                   MOVE      WSNTT         DFNTT
     C                   MOVE      WSVKTT        DFVKTT
     C                   MOVE      WSBLT         DFBLT
     C                   MOVE      WSNETB        DFNETT
     C                   MOVE      WSKDDC        DFKDDC
     C                   MOVE      WSBLDC        DFBLDC
     C                   MOVE      WSBLA         DFBLA
     C                   MOVE      WSKDME        DFKDME
     C                   MOVE      WSBLAV        DFBLAV
     C                   MOVE      WSFT          DFFT
     C                   MOVE      WDFCMN        DFCMN
     C                   MOVE      WSTOLS        DFTOLS
     C                   Z-ADD     WFETD1        DFETD1
     C                   Z-ADD     WFETA1        DFETA1
     C                   Z-ADD     WFEDA1        DFEDA1
     C                   Z-ADD     WFETD2        DFETD2
     C                   Z-ADD     WFETA2        DFETA2
     C                   Z-ADD     WFEDA2        DFEDA2
     C                   Z-ADD     WFETD3        DFETD3
     C                   Z-ADD     WFETA3        DFETA3
     C                   Z-ADD     WFEDA3        DFEDA3
N10  C                   EVAL      DFSPH1=WSSPH1
N10  C                   EVAL      DFSPH2=WSSPH2
N10  C                   EVAL      DFSPH3=WSSPH3
N10  C                   EVAL      DFSPH4=WSSPH4
N10  C                   EVAL      DFSPH5=WSSPH5
N10  C                   EVAL      DFSPH6=WSSPH6
N10  C                   EVAL      DFSPH7=WSSPH7
N10  C                   EVAL      DFSPH8=WSSPH8
N10  C                   EVAL      DFSPH9=WSSPH9
      *
     C     WWWRK1        IFEQ      'A'
     C                   MOVE      'A'           DFRK1
     C                   ENDIF
      *
     C   33              WRITE     DOKEFR
     C   33FIURBL        IFEQ      'J'
     C                   EXSR      TTSR
     C                   END
     C  N33              UPDATE    DOKEFR
      *
     C                   ENDSR
      *
      ***********************************************
     C     OPDDOQ        BEGSR
      ***********************************************
     C     DOKEQK        CHAIN     DOKEQ                              33
      *
     C   33              DO
     C                   MOVE      YRIQ          DQRI
     C                   MOVE      UAVD          DQAVD
     C                   MOVE      UOPD          DQOPD
     C                   MOVE      ULOP          DQLOP
     C                   END
      *
     C                   MOVE      ' '           DQST
     C                   MOVE      WSNA          DQNA
     C                   MOVE      WSAD1         DQAD1
     C                   MOVE      WSAD2         DQAD2
     C                   MOVE      WSAD3         DQAD3
     C                   MOVE      WSAD4         DQAD4
     C                   MOVEL     WSINFD        DQINFD
     C                   MOVE      WSINF3        DQINF3
     C                   MOVE      WSINF4        DQINF4
     C                   MOVE      WSINF5        DQINF5
     C                   MOVE      WSINF6        DQINF6
     C                   MOVE      WSINF7        DQINF7
     C                   MOVE      WSINF8        DQINF8
     C                   MOVE      WSINF9        DQINF9
     C                   MOVE      WSVS11        DQVS11
     C                   MOVE      WSVS12        DQVS12
     C                   MOVE      WSVS13        DQVS13
N15  C                   MOVE      WSVS14        DQVS14
N15  C                   MOVE      WSVS15        DQVS15
N15  C                   MOVE      WSVS16        DQVS16
N15  C                   MOVE      WSVS17        DQVS17
N15  C                   MOVE      WSVS18        DQVS18
N15  C                   MOVE      WSCONR        DQCOL
      *
     C   33              WRITE     DOKEQR
     C  N33              UPDATE    DOKEQR
      *
     C                   ENDSR
      *
      ***********************************************
     C     TSTKU         BEGSR
      ***********************************************
     C                   MOVE      'N'           FINNPRI           1
      * TEST IF CUSTOMER HAVE SPESIAL AGREEMENT
      *
     C                   Z-ADD(H)  FV(XN)        XVKT
     C     HEHAWB        IFNE      *ZEROS
     C                   MOVE      'H'           YFFKD
     C                   ELSE
     C                   MOVE      'S'           YFFKD
     C                   END
      *
     C     KUAVKE        SETLL     KODTFFR
     C                   READ      KODTFFR                                87
     C  N87HEKNSF        IFEQ      KFFKN
     C     HESDF         IFEQ      KFFSDF
     C     HESDT         IFEQ      KFFSDT
      *
     C     HEHAWB        IFNE      *ZEROS
     C     KFFKD         IFEQ      'H'
     C     KFFBL2        IFEQ      0
     C                   Z-ADD     KFFBL         BE(XN)
     C                   MOVE      'M'           RA(XN)
     C                   Z-ADD     BE(XN)        PR(XN)
     C                   ELSE
     C                   Z-ADD     KFFBL         PR(XN)
     C     XVKT          IFLT      45
     C                   MOVE      'N'           RA(XN)
     C                   ELSE
     C                   MOVE      'Q'           RA(XN)
     C                   ENDIF
     C                   EXSR      TSTKU2
     C                   END
     C                   END
     C                   ELSE
     C     KFFKD         IFEQ      'S'
     C     KFFBL2        IFEQ      0
     C                   Z-ADD     KFFBL         BE(XN)
     C                   MOVE      'M'           RA(XN)
     C                   Z-ADD     BE(XN)        PR(XN)
     C                   ELSE
     C                   Z-ADD     KFFBL         PR(XN)
     C     XVKT          IFLT      45
     C                   MOVE      'N'           RA(XN)
     C                   ELSE
     C                   MOVE      'Q'           RA(XN)
     C                   ENDIF
     C                   EXSR      TSTKU2
     C                   END
     C                   END
     C                   END
      *
     C                   END
     C                   END
     C                   END
     C                   ENDSR
      ***********************************************
     C     TSTKU2        BEGSR
      ***********************************************
     C                   MOVE      'J'           FINNPRI           1
      * TEST IF LOWER PRICE IN NEXT RATECLASS
      *
     C     KFFTVK        ADD       1             KFFTV2            5 0
     C                   READ      KODTFFR                                87
     C  N87HEKNSF        IFEQ      KFFKN
     C     HESDF         IFEQ      KFFSDF
     C     HESDT         IFEQ      KFFSDT
     C     YFFKD         IFEQ      KFFKD
     C                   Z-ADD(H)  FV(XN)        XVKTBR
     C     PR(XN)        MULT      XVKTBR        PRICE1           13 2
     C     KFFBL         MULT      KFFTV2        PRICE2           13 2
     C     PRICE2        IFLT      PRICE1
     C                   Z-ADD     KFFBL         PR(XN)
     C                   Z-ADD     KFFTV2        FV(XN)
     C                   END
     C                   END
     C                   END
     C                   END
     C                   END
     C                   ENDSR
      ***********************************************
     C     SFFR          BEGSR
      ***********************************************
     C                   OPEN      LOCL01                               91
     C  N91              OPEN      FFR01L                               91
     C  N91              OPEN      FFA01L                               91
     C     *IN91         IFEQ      '1'
     C                   MOVEL     'BBA0035'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   GOTO      SFFR99
     C                   ENDIF
      * Blanker hele parameterstrengen
     C                   MOVEL     *BLANKS       AUTINF                         <AUTOMATISK
     C     *IN20         IFEQ      '1'                                          <AUTOMATISK
     C                   MOVE      '1'           AUTTRM
     C                   ELSE                                                   <MED BILDE
     C                   MOVE      ' '           AUTTRM
     C                   ENDIF
     C     WREF2         IFNE      *BLANKS
     C                   MOVE      '3'           AUTTRM
     C                   ENDIF
     C                   MOVEL     WSRO21        AUTPID                         <ADRESSE
     C                   Z-ADD     WSFSN         AUTALN                         <AIRLINE
     C     HEGN          IFNE      *BLANKS
     C                   MOVEL     WHEGN8        AUTAWB                         <AWB
     C                   ENDIF
     C                   MOVEL     WSSDF         AUTORI                         <ORIGIN AIRPORT
     C                   MOVEL     WSSDT         AUTDES                         <DEST. AIRPORT
     C                   MOVE      'T'           AUTSDC                         <SHIP.DESC.CODE
     C                   Z-ADD     WSNTT         AUTNPI                         <NO. OF PIECES
     C                   MOVE      'K'           AUTWCD                         <WEIGHT CODE
     C                   Z-ADD     WSVKTT        AUTWGH                         <WEIGHT
     C                   Z-ADD     0             AUTTPI                         <T.NO.PIECES
     C     HEM3          IFNE      *ZEROS
     C                   Z-ADD(H)  HEM3          WW112
     C                   MOVEL     WW112         AUVOL
     C                   ELSE
     C                   MOVEL     *BLANKS       AUVOL
     C                   ENDIF
     C                   MOVEL     WSVS1         AUTMAN                         <MANIFEST DESC
     C                   MOVEL     *BLANKS       AUTPAR                         <PART ID
     C                   MOVEL     *BLANKS       AUTPCD                         <PART CODE
     C                   MOVEL     *BLANKS       AUTPAI                         <PART AIRPORT
     C                   MOVEL     *BLANKS       AUTRAI                         <REQ.AIRPORT
     C                   MOVEL     *BLANKS       AUTOFD                         <REQ.OFFICE
     C                   MOVEL     *BLANKS       AUTCOD                         <REQ.COMPANY
      *
     C                   MOVE      WSRO21        AUTCAR                         <CARRIER
     C                   MOVEL     WSRO41        AUTFLN                         <FLIGHT NO.
     C                   Z-ADD     WSROC1        AUTDAY                         <FLIGHT DAY
     C                   Z-ADD     UMONTH        ZZ                2 0
     C     AUTDAY        IFLT      UDAY
     C                   ADD       1             ZZ
     C     ZZ            IFGT      12
     C                   Z-ADD     1             ZZ
     C                   ENDIF
     C                   ENDIF
     C                   MOVEA     NAV(ZZ)       AUTMND
     C                   MOVEL     WSSDF         AUTDEP                         <DEP.AIRPORT
     C                   MOVEL     WSROA1        AUTARR                         <ARR.AIRPORT
     C                   MOVE      'NN'          AUTSPC                         <SPACE ALL.CODE
     C                   MOVEL     *BLANKS       AUTAID                         <ALLOTMENT ID.
      *
     C     WSROB2        IFNE      *BLANKS
     C                   MOVE      WSRO22        AU2CAR                         <CARRIER
     C                   MOVEL     WSRO42        AU2FLN                         <FLIGHT NO.
     C                   Z-ADD     WSROC2        AU2DAY                         <FLIGHT DAY
     C                   Z-ADD     UMONTH        ZZ
     C     AU2DAY        IFLT      UDAY
     C                   ADD       1             ZZ
     C     ZZ            IFGT      12
     C                   Z-ADD     1             ZZ
     C                   ENDIF
     C                   ENDIF
     C                   MOVEA     NAV(ZZ)       AU2MND
     C                   MOVEL     WSROA1        AU2DEP                         <DEP.AIRPORT
     C                   MOVEL     WSROA2        AU2ARR                         <ARR.AIRPORT
     C                   MOVE      'NN'          AU2SPC                         <SPACE ALL.CODE
     C                   MOVEL     *BLANKS       AU2AID                         <ALLOTMENT ID.
     C                   ENDIF
      *
     C     WSROB3        IFNE      *BLANKS
     C                   MOVE      WSRO23        AU3CAR                         <CARRIER
     C                   MOVEL     WSRO43        AU3FLN                         <FLIGHT NO.
     C                   Z-ADD     WSROC3        AU3DAY                         <FLIGHT DAY
     C                   Z-ADD     UMONTH        ZZ
     C     AU3DAY        IFLT      UDAY
     C                   ADD       1             ZZ
     C     ZZ            IFGT      12
     C                   Z-ADD     1             ZZ
     C                   ENDIF
     C                   ENDIF
     C                   MOVEA     NAV(ZZ)       AU3MND
     C                   MOVEL     WSROA2        AU3DEP                         <DEP.AIRPORT
     C                   MOVEL     WSROA3        AU3ARR                         <ARR.AIRPORT
     C                   MOVE      'NN'          AU3SPC                         <SPACE ALL.CODE
     C                   MOVEL     *BLANKS       AU3AID                         <ALLOTMENT ID.
     C                   ENDIF
     C     WSRK1         IFEQ      'P'
     C                   MOVEL     'P  '         AUSPE1
     C                   ENDIF
     C     WSRK1         IFEQ      'D'
     C                   MOVEL     'PAD'         AUSPE1
     C                   ENDIF
      * Eventuell logikk for nye felt i bookingen (SRI)
     C                   MOVE      *BLANKS       AUTREF
     C                   MOVE      *BLANKS       AUTSI1
     C                   MOVE      *BLANKS       AUTSI2
N03   * 09. Product Information
N03  C                   MOVE      *BLANKS       AU093
N03   * 12. Customer Identification
N03  C                   MOVE      *BLANKS       AU1222
N03  C                   Z-ADD     0             AU1224
N03  C                   Z-ADD     0             AU1226
N03  C                   MOVE      *BLANKS       AU1228
N03  C                   MOVE      *BLANKS       AU1242
N03  C                   MOVE      *BLANKS       AU1252
      * Sjekker om det finnes dimmension info som skal sendes over
     C     HEADFK        SETLL     DIMM
     C     HEADFK        READE(N)  DIMM                                   90
     C                   Z-ADD     0             X
     C                   MOVEA     *ZEROS        WAN
     C                   MOVEA     *ZEROS        WBR
     C                   MOVEA     *ZEROS        WLE
     C                   MOVEA     *ZEROS        WHO
     C     *IN90         DOWEQ     *OFF
     C                   ADD       1             X
     C     X             IFGT      11
     C                   LEAVE
     C                   ENDIF
     C                   Z-ADD     DIMANT        WAN(X)
     C                   Z-ADD     DIMBRE        WBR(X)
     C                   Z-ADD     DIMLEN        WLE(X)
E07  C                   Z-ADD     DIMHOY        WHO(X)
     C     HEADFK        READE(N)  DIMM                                   90
     C                   ENDDO
      * Programmet venter på svar i et vist antall sekunder.
      * Kommer ikke svaret fortsetter man uten å vite det.
     C                   CALL      'SM220C2'
     C                   PARM                    AUTINF
     C                   PARM                    AUTREC            9 0
     C                   PARM                    WAN
     C                   PARM                    WBR
     C                   PARM                    WLE
E07  C                   PARM                    WHO
      *
      * Routingen på fraktbrevbildet skal oppdateres hvis flyselskapet
      * svarer med en annen routing enn det som var ønsket.
      *
     C                   Z-ADD     0             ZZ
     C     AUTREC        SETLL     FFR03R
     C     AUTREC        READE     FFR03R                                 90
     C     *IN90         DOWEQ     '0'
     C     ZZ            ANDLE     3
     C                   ADD       1             ZZ
      * F035 = 'NA' --> Godtar alternativ flight om nødvendig
     C     F035          IFEQ      'NA'
      *
      * Hvis svaret ikke har kommet finnes det ingen poster i FFA03R
      *
     C                   Z-ADD     0             YY                1 0
     C     AUTREC        SETLL     FFA03R
     C     AUTREC        READE     FFA03R                                 90
     C     *IN90         DOWEQ     '0'
     C     YY            ANDLE     3
     C                   ADD       1             YY
     C     B0331         IFEQ      F0331
     C     B0331         ANDEQ     F0331
      *
      * Har funnet det tilhørende svaret til den forespurte
      * "Flight Detail". Oppdaterer fraktbrevbildet hvis "Consigment"
      * er booket på en annen flight enn det som var ønsket.
      *
      * B035 = 'KK' --> Booking er bekreftet
      *
     C     B035          IFEQ      'KK'
     C                   MOVEL     'BBA0036'     MSGNR
     C                   MOVE      *ON           *IN30
     C     ZZ            IFEQ      1
     C                   MOVEL     B0332         WSROA1
     C                   MOVEL     B0311         WSRO21
     C                   MOVEL     B0312         WSRO41
     C                   Z-ADD     B0314         WSROC1
     C                   ENDIF                                                  <ZZ=1
     C     ZZ            IFEQ      2
     C                   MOVEL     B0332         WSROA2
     C                   MOVEL     B0311         WSRO22
     C                   MOVEL     B0312         WSRO42
     C                   Z-ADD     B0314         WSROC2
     C                   ENDIF                                                  <ZZ=2
     C     ZZ            IFEQ      3
     C                   MOVEL     B0332         WSROA3
     C                   MOVEL     B0311         WSRO23
     C                   MOVEL     B0312         WSRO43
     C                   Z-ADD     B0314         WSROC3
     C                   ENDIF                                                  <ZZ=2
     C                   ENDIF                                                  <B035
     C                   ENDIF                                                  <B0331
     C     AUTREC        READE     FFA03R                                 90
     C                   ENDDO                                                  <READE,FFA03R
      *
     C                   ENDIF
     C     AUTREC        READE     FFR03R                                 90
     C                   ENDDO                                                  <READE,FFR03R
      *
     C     SFFR99        TAG
     C                   CLOSE     LOCL01                               91
     C                   CLOSE     FFR01L                               91
     C                   CLOSE     FFA01L                               91
      *
     C                   ENDSR
      *
      ***********************************************
     C     VLOG          BEGSR
      ***********************************************
     C                   OPEN      LOCL01                               91
     C     *IN91         IFEQ      '1'
     C                   MOVEL     'BBA0035'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   GOTO      VLOG99
     C                   ENDIF
     C                   CLOSE     LOCL01                               91
      *
     C                   CALL      'SM040C'
      *
     C     VLOG99        ENDSR
      ***********************************************
     C     UTCMDL        BEGSR
      ***********************************************
     C                   SELECT
     C     XCMD          WHENEQ    0
     C                   MOVE      'DIV0020'     MSGLN1
     C  N27              MOVE      'DIV0032'     MSGLN2
     C   27              MOVE      'DIV0000'     MSGLN2
     C                   MOVE      'DIV0030'     MSGLN3
     C                   MOVE      'DIV0029'     MSGLN4
     C                   ADD       1             XCMD
     C     XCMD          WHENEQ    1
     C                   MOVE      'DIV2131'     MSGLN1
     C                   MOVE      'DIV0024'     MSGLN2
     C  N27              MOVE      'DIV2077'     MSGLN3
     C   27              MOVE      'DIV0000'     MSGLN3
     C                   MOVE      'DIV0029'     MSGLN4
     C                   ADD       1             XCMD
     C     XCMD          WHENEQ    2
     C                   MOVE      'BBA0117'     MSGLN1                         18
     C                   MOVE      'BBA0045'     MSGLN2                         19
     C                   MOVE      'BBA0033'     MSGLN3                         20
     C                   MOVE      'DIV0029'     MSGLN4
     C                   ADD       1             XCMD
     C     XCMD          WHENEQ    3
     C                   MOVE      'BBA0034'     MSGLN1                         21
     C                   MOVE      'BBA0040'     MSGLN2                         22
     C                   MOVE      'BBA0042'     MSGLN3                         23
     C                   MOVE      'DIV0029'     MSGLN4
     C                   ADD       1             XCMD              1 0
N13  C     XCMD          WHENEQ    4
N13  C                   MOVE      'CBA0410'     MSGLN1                         21
N13  C                   MOVE      'DIV0029'     MSGLN4
N13  C                   ADD       1             XCMD              1 0
     C                   OTHER
     C                   MOVE      'SHU0633'     MSGLN1                         21
     C                   MOVE      'CBA0320'     MSGLN2                         22
     C   27              MOVE      'DIV0000'     MSGLN3                         23
     C  N27              MOVE      'DIV1007'     MSGLN3                         23
     C                   MOVE      'DIV0029'     MSGLN4
     C                   Z-ADD     0             XCMD              1 0
     C                   ENDSL
      *
     C                   ENDSR
      *
      ***********************************************
     C     SFIR          BEGSR
      ***********************************************
     C                   OPEN      LOCL01                               91
     C  N91              OPEN      ISUL01                               91
     C     *IN91         IFEQ      '1'
     C                   MOVEL     'BBA0035'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   GOTO      SFIR99
     C                   ENDIF
      * Blanker hele parameterstrengen
     C                   MOVEL     *BLANKS       BUTINF
     C     WSFSN         CHAIN     ISUL01                             90
     C     *IN90         IFEQ      '0'
     C                   MOVEL     ISPART        BUTPID
     C                   ELSE
     C     WWUSER        CHAIN     LOCL01                             90
     C     *IN90         IFEQ      '0'
     C                   MOVEL     LODEFA        BUTPID                         <ADRESSE
     C                   ELSE
     C                   MOVEL     *BLANKS       BUTPID                         <ADRESSE
     C                   ENDIF
     C                   ENDIF                                                  <*IN90
     C                   MOVEL     WSSDF         BUTAOR                         <ORIGIN AIRPORT
     C                   MOVEL     WSSDT         BUTADE                         <DEST. AIRPORT
     C                   Z-ADD     UDAY          BUTDA1
     C                   Z-ADD     UMONTH        ZZ
     C     BUTDA1        IFLT      UDAY
     C                   ADD       1             ZZ
     C     ZZ            IFGT      12
     C                   Z-ADD     1             ZZ
     C                   ENDIF
     C                   ENDIF
     C                   MOVEA     NAV(ZZ)       BUTMN1                         <FLIGHT MND
     C                   Z-ADD     0             BUTYKL
      * Kaller på program for å sende og motta Schedule Request
      * Parameter inneholder routing hvis plukket av bruker
     C                   CALL      'TDV51C'
     C                   PARM                    BUTINF
      *
      * Routingen på fraktbrevbildet skal oppdateres etter den
      * routing som bruker har valgt i TDV51R
      *
     C     BUTRA1        IFNE      *BLANKS
     C     BUTRA2        ORNE      *BLANKS
     C     BUTRA3        ORNE      *BLANKS
     C                   MOVEL     'BBA0036'     MSGNR
     C                   MOVE      *ON           *IN30
     C     BUTRA1        IFNE      *BLANKS
     C                   MOVEL     BUTRA1        WSROA1
     C                   MOVEL     BUTRB1        WSROB1
     C                   Z-ADD     BUTRC1        WSROC1
     C                   ENDIF                                                  <BUTRA1
     C     BUTRA2        IFNE      *BLANKS
     C                   MOVEL     BUTRA2        WSROA2
     C                   MOVEL     BUTRB2        WSROB2
     C                   Z-ADD     BUTRC2        WSROC2
     C                   ENDIF                                                  <BUTRA2
     C     BUTRA3        IFNE      *BLANKS
     C                   MOVEL     BUTRA3        WSROA3
     C                   MOVEL     BUTRB3        WSROB3
     C                   Z-ADD     BUTRC3        WSROC3
     C                   ENDIF                                                  <BUTRA3
     C                   ENDIF                                                  <BUTRA1
      *
     C     SFIR99        TAG
     C                   CLOSE     LOCL01                               91
     C                   CLOSE     ISUL01                               91
      *
     C                   ENDSR
      *
      ***********************************************
     C     SFTR          BEGSR
      ***********************************************
     C                   OPEN      LOCL01                               91
     C  N91              OPEN      ISUL01                               91
     C     *IN91         IFEQ      '1'
     C                   MOVEL     'BBA0035'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   GOTO      SFTR99
     C                   ENDIF
      * Blanker hele parameterstrengen
     C                   MOVEL     *BLANKS       CUTINF
     C     WSFSN         CHAIN     ISUL01                             90
     C     *IN90         IFEQ      '0'
     C                   MOVEL     ISPART        CUTPID
     C                   ENDIF
     C     WWUSER        CHAIN     LOCL01                             90
     C     *IN90         IFEQ      *OFF
     C                   MOVEL     LODEFA        CUTPID                         <ADRESSE
     C                   ENDIF
     C                   MOVEL     WSSDF         CUTAOR                         <ORIGIN AIRPORT
     C                   MOVEL     WSSDT         CUTADE                         <DEST. AIRPORT
     C     WSROC1        IFNE      *ZEROS
     C                   MOVE      WSROC1        CUTDA1
     C                   ELSE
     C                   MOVE      UDAY          CUTDA1
     C                   ENDIF
     C                   Z-ADD     UMONTH        ZZ
     C                   MOVE      CUTDA1        WRKDAY            2 0
     C     WRKDAY        IFLT      UDAY
     C                   ADD       1             ZZ
     C     ZZ            IFGT      12
     C                   Z-ADD     1             ZZ
     C                   ENDIF
     C                   ENDIF
     C                   MOVEA     NAV(ZZ)       CUTMN1                         <FLIGHT MND
     C                   MOVE      UYEAR         CUTYE1
     C                   CLOSE     LOCL01                               91
     C                   CLOSE     ISUL01                               91
      *
     C                   CALL      'SM240C2'
     C                   PARM                    CUTINF           31
      *
     C     SFTR99        ENDSR
      ***********************************************
     C     SCOMM         BEGSR
      ***********************************************
      * Sending av singel fraktbrev som FWB til agent/kunde
      * sending av house AWB som AZB til agent/kunde
     C                   CALL      'TDV20R'
     C                   PARM                    HEAVD
     C                   PARM                    HEOPD
     C                   PARM                    WDUM1             3
     C                   PARM                    WDUM2             3 0
     C                   ENDSR
      ******************************************
     C     FLIGTS        BEGSR
      ******************************************
      *
      * SJEKKER FLIGHT NUMMERETS SYNTAX
      *
     C     FLIGNR        IFEQ      1
      * Carrier code must exist but flight number may be blank
     C     FAA           IFNE      *BLANKS
     C     FBA           ANDEQ     *BLANK
     C     FBB           ANDEQ     *BLANK
     C     FBC           ANDEQ     *BLANK
     C     FCC           ANDEQ     *BLANK
     C                   GOTO      FLIG99
     C                   ENDIF
     C                   ELSE
      * Carrier code and flight number may be blank
     C     FLIG          IFEQ      *BLANKS
     C     FAA           ORNE      ' '
     C     FBA           ANDEQ     *BLANK
     C     FBB           ANDEQ     *BLANK
     C     FBC           ANDEQ     *BLANK
     C     FCC           ANDEQ     *BLANK
     C                   GOTO      FLIG99
     C                   ENDIF
     C                   ENDIF
      *
     C                   MOVE      '0'           FLIERR            1
     C                   SELECT
     C     FBB           WHENLT    '0'
     C     FBB           ORGT      '9'
     C                   MOVE      '1'           FLIERR
     C     FBC           WHENLT    '0'
     C     FBC           ORGT      '9'
     C                   MOVE      '1'           FLIERR
     C     FCC           WHENLT    'A'
     C     FCC           ORGT      'Z'
     C     FCC           IFLT      '0'
     C     FCC           ORGT      '9'
     C     FCC           IFNE      *BLANKS
     C                   MOVE      '1'           FLIERR
     C                   ENDIF
     C                   ENDIF
     C                   ENDSL
     C     FLIERR        IFEQ      '1'
     C                   MOVE      *ON           *IN30
     C                   MOVE      'BBA0094'     MSGNR
     C                   Z-ADD     6             LINNBR
     C                   SELECT
     C     FLIGNR        WHENEQ    1
     C                   Z-ADD     29            POSNBR
     C     FLIGNR        WHENEQ    2
     C                   Z-ADD     47            POSNBR
     C     FLIGNR        WHENEQ    3
     C                   Z-ADD     65            POSNBR
     C                   ENDSL
     C                   ENDIF
      *
     C     FLIG99        TAG
     C                   ENDSR
      ***********************************************
     C     UPDDIM        BEGSR
      ***********************************************
      * Oppdaterer dimmensjoner på fraktbrevet.
      * Oppdatering skjer både ved ny og endring.
     C     AN(1)         IFGT      0
E07  C     HO(1)         ANDGT     0
     C     LE(1)         ANDGT     0
     C     BR(1)         ANDGT     0
      * Sletter først de linjer som ligger inne
     C     HEADFK        SETLL     DIMM
     C     HEADFK        READE     DIMM                                   90
     C     *IN90         DOWEQ     *OFF
     C                   DELETE    DIMMR
     C     HEADFK        READE     DIMM                                   90
     C                   ENDDO
      * Skriver så de nye linjer. Satt en praktisk begrensing på 11 linjer
     C                   Z-ADD     UAVD          DIMAVD
     C                   Z-ADD     UOPD          DIMOPD
     C                   Z-ADD     AN(1)         DIMANT
E07  C     HO(1)         MULT      100           DIMHOY
     C     LE(1)         MULT      100           DIMLEN
     C     BR(1)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(2)         IFGT      0
E07  C     HO(2)         ANDGT     0
     C     LE(2)         ANDGT     0
     C     BR(2)         ANDGT     0
     C                   Z-ADD     AN(2)         DIMANT
E07  C     HO(2)         MULT      100           DIMHOY
     C     LE(2)         MULT      100           DIMLEN
     C     BR(2)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(3)         IFGT      0
E07  C     HO(3)         ANDGT     0
     C     LE(3)         ANDGT     0
     C     BR(3)         ANDGT     0
     C                   Z-ADD     AN(3)         DIMANT
E07  C     HO(3)         MULT      100           DIMHOY
     C     LE(3)         MULT      100           DIMLEN
     C     BR(3)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(4)         IFGT      0
E07  C     HO(4)         ANDGT     0
     C     LE(4)         ANDGT     0
     C     BR(4)         ANDGT     0
     C                   Z-ADD     AN(4)         DIMANT
E07  C     HO(4)         MULT      100           DIMHOY
     C     LE(4)         MULT      100           DIMLEN
     C     BR(4)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(5)         IFGT      0
E07  C     HO(5)         ANDGT     0
     C     LE(5)         ANDGT     0
     C     BR(5)         ANDGT     0
     C                   Z-ADD     AN(5)         DIMANT
E07  C     HO(5)         MULT      100           DIMHOY
     C     LE(5)         MULT      100           DIMLEN
     C     BR(5)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(6)         IFGT      0
E07  C     HO(6)         ANDGT     0
     C     LE(6)         ANDGT     0
     C     BR(6)         ANDGT     0
     C                   Z-ADD     AN(6)         DIMANT
E07  C     HO(6)         MULT      100           DIMHOY
     C     LE(6)         MULT      100           DIMLEN
     C     BR(6)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(7)         IFGT      0
E07  C     HO(7)         ANDGT     0
     C     LE(7)         ANDGT     0
     C     BR(7)         ANDGT     0
     C                   Z-ADD     AN(7)         DIMANT
E07  C     HO(7)         MULT      100           DIMHOY
     C     LE(7)         MULT      100           DIMLEN
     C     BR(7)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(8)         IFGT      0
E07  C     HO(8)         ANDGT     0
     C     LE(8)         ANDGT     0
     C     BR(8)         ANDGT     0
     C                   Z-ADD     AN(8)         DIMANT
E07  C     HO(8)         MULT      100           DIMHOY
     C     LE(8)         MULT      100           DIMLEN
     C     BR(8)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(9)         IFGT      0
E07  C     HO(9)         ANDGT     0
     C     LE(9)         ANDGT     0
     C     BR(9)         ANDGT     0
     C                   Z-ADD     AN(9)         DIMANT
E07  C     HO(9)         MULT      100           DIMHOY
     C     LE(9)         MULT      100           DIMLEN
     C     BR(9)         MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(10)        IFGT      0
E07  C     HO(10)        ANDGT     0
     C     LE(10)        ANDGT     0
     C     BR(10)        ANDGT     0
     C                   Z-ADD     AN(10)        DIMANT
E07  C     HO(10)        MULT      100           DIMHOY
     C     LE(10)        MULT      100           DIMLEN
     C     BR(10)        MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C     AN(11)        IFGT      0
E07  C     HO(11)        ANDGT     0
     C     LE(11)        ANDGT     0
     C     BR(11)        ANDGT     0
     C                   Z-ADD     AN(11)        DIMANT
E07  C     HO(11)        MULT      100           DIMHOY
     C     LE(11)        MULT      100           DIMLEN
     C     BR(11)        MULT      100           DIMBRE
     C                   WRITE     DIMMR
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
      ***********************************************
E07  C     SOKDTA        BEGSR
      ***********************************************
     C     LINNBR        IFEQ      6
     C     POSNBR        ANDGE     25
     C     POSNBR        ANDLE     27
     C                   MOVE      *BLANKS       UNVN             30
     C                   MOVE      *BLANKS       ULK               2
     C                   MOVE      *BLANKS       USD               5
     C                   MOVEL     WSROA1        USD
     C                   CALL      'SYFI10F'
     C                   PARM                    USD
     C                   PARM                    UNVN
     C                   PARM                    ULK
     C     USD           IFNE      *BLANKS
     C                   MOVEL     USD           WSROA1
     C                   END
     C                   Z-ADD     29            POSNBR
E07  C                   GOTO      SLSOK
     C                   END
      *
     C     LINNBR        IFEQ      6
     C     POSNBR        ANDGE     43
     C     POSNBR        ANDLE     45
     C                   MOVE      *BLANKS       UNVN             30
     C                   MOVE      *BLANKS       ULK               2
     C                   MOVE      *BLANKS       USD               5
     C                   MOVEL     WSROA2        USD
     C                   CALL      'SYFI10F'
     C                   PARM                    USD
     C                   PARM                    UNVN
     C                   PARM                    ULK
     C     USD           IFNE      *BLANKS
     C                   MOVEL     USD           WSROA2
     C                   END
     C                   Z-ADD     47            POSNBR
     C                   GOTO      SLSOK
     C                   END
      *
     C     LINNBR        IFEQ      6
     C     POSNBR        ANDGE     61
     C     POSNBR        ANDLE     63
     C                   MOVE      *BLANKS       UNVN             30
     C                   MOVE      *BLANKS       ULK               2
     C                   MOVE      *BLANKS       USD               5
     C                   MOVEL     WSROA3        USD
     C                   CALL      'SYFI10F'
     C                   PARM                    USD
     C                   PARM                    UNVN
     C                   PARM                    ULK
     C     USD           IFNE      *BLANKS
     C                   MOVEL     USD           WSROA3
     C                   END
     C                   Z-ADD     65            POSNBR
E07  C                   GOTO      SLSOK
     C                   END
      *
     C     LINNBR        IFEQ      9
     C                   CALL      'SYFI10I'
     C                   PARM                    XINFA1
     C     XINFA1        IFNE      *BLANKS
     C                   MOVE      *BLANKS       XINFA2
     C                   END
E07  C                   GOTO      SLSOK
     C                   END
      *
     C     LINNBR        IFGE      13
     C     LINNBR        ANDLE     18
     C     POSNBR        ANDEQ     15
     C     POSNBR        ANDLE     18
     C                   CALL      'SYFA74A'
     C                   PARM                    WRCCDE            1
     C     WRCCDE        IFNE      *BLANKS
     C                   SELECT
     C     LINNBR        WHENEQ    13
     C                   MOVE      WRCCDE        RA(1)
     C     LINNBR        WHENEQ    14
     C                   MOVE      WRCCDE        RA(2)
     C     LINNBR        WHENEQ    15
     C                   MOVE      WRCCDE        RA(3)
     C     LINNBR        WHENEQ    16
     C                   MOVE      WRCCDE        RA(4)
     C     LINNBR        WHENEQ    17
     C                   MOVE      WRCCDE        RA(5)
     C     LINNBR        WHENEQ    18
     C                   MOVE      WRCCDE        RA(6)
     C                   ENDSL
     C                   ENDIF
E07  C                   GOTO      SLSOK
     C                   END
      *
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
      *
E07  C     SLSOK         ENDSR
N10   ***********************************************
N10  C     SOKDTA2       BEGSR
     C     WSCLOC        DIV       256           LINNBR2
     C                   MVR                     POSNBR2
N10  C     LINNBR2       IFEQ      23
N10  C     POSNBR2       ANDGE     35
N10  C     POSNBR2       ANDLE     67

N10  C                   CALL      'SYFAKDA'
N10  C                   PARM      'AIRSPH'      WFTYP1           10
N10  C                   PARM                    UUPDAT            1
N10  C                   PARM      *BLANKS       WFKOD1            5

N10  C     WFKOD1        IFNE      *BLANKS
N10  C                   SELECT
N10  C     POSNBR2       WHENEQ    35
N10  C                   MOVEL     WFKOD1        WSSPH1
N10  C     POSNBR2       WHENEQ    39
N10  C                   MOVEL     WFKOD1        WSSPH2
N10  C     POSNBR2       WHENEQ    43
N10  C                   MOVEL     WFKOD1        WSSPH3
N10  C     POSNBR2       WHENEQ    47
N10  C                   MOVEL     WFKOD1        WSSPH4
N10  C     POSNBR2       WHENEQ    51
N10  C                   MOVEL     WFKOD1        WSSPH5
N10  C     POSNBR2       WHENEQ    55
N10  C                   MOVEL     WFKOD1        WSSPH6
N10  C     POSNBR2       WHENEQ    59
N10  C                   MOVEL     WFKOD1        WSSPH7
N10  C     POSNBR2       WHENEQ    63
N10  C                   MOVEL     WFKOD1        WSSPH8
N10  C     POSNBR2       WHENEQ    67
N10  C                   MOVEL     WFKOD1        WSSPH9
N10  C                   ENDSL
N10  C                   ENDIF

N10  C                   ENDIF
N10  C                   ENDSR
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     KEYSON        KLIST
     C                   KFLD                    WSFSN
     C                   KFLD                    ST2LK
     C                   KFLD                    ST2KOD
      *
     C     KODTVK        KLIST
     C                   KFLD                    vunik             1
     C                   KFLD                    uavd
     C                   MOVE      'V'           vunik
     C     KEYLK         KLIST
     C                   KFLD                    UNILK             3
     C                   KFLD                    HELKA
     C                   MOVEL     'LK'          UNILK
      *
     C     KEYSEL        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    HEKNS
N04  C     KEYCOL        KLIST
N04  C                   KFLD                    FIFIRM
N04  C                   KFLD                    WSCONR
     C     KODFCK        KLIST
     C                   KFLD                    YFCUNI
     C                   KFLD                    WSFSN
     C                   MOVE      'FC'          YFCUNI            2
     C     KODSCK        KLIST
     C                   KFLD                    YFCUN2
     C                   KFLD                    WSFSN
     C                   MOVE      'FC'          YFCUNI            2
     C     KODFSK        KLIST
     C                   KFLD                    YFSUNI
     C                   KFLD                    WFLY
     C                   MOVE      'FS'          YFSUNI            2
     C     KUAVKE        KLIST
     C                   KFLD                    HEKNSF
     C                   KFLD                    HEKDPL
     C                   KFLD                    XXFLY             3 0
     C                   KFLD                    HESDF
     C                   KFLD                    HESDT
     C                   KFLD                    YFFKD
     C                   KFLD                    XVKT              5 0
     C                   MOVE      'H'           YFFKD             1
     C     DOKEFK        KLIST
     C                   KFLD                    YRI
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    ULOP
     C     DOKEQK        KLIST
     C                   KFLD                    YRIQ
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    ULOP
     C     HEADFK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     IMPKEY        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    ULOP
     C     KODFRK        KLIST
     C                   KFLD                    YFRUNI
     C                   KFLD                    HEFR
     C     KODFTK        KLIST
     C                   KFLD                    XINFA1
     C                   KFLD                    YLN
     C     KODARK        KLIST
     C                   KFLD                    YARUNI
     C                   KFLD                    WSSDF
     C                   KFLD                    WSSDT
     C     SAMLBK        KLIST
     C                   KFLD                    YSD
     C                   KFLD                    YLNR
     C     KODTAK        KLIST
     C                   KFLD                    YAUNI
     C                   KFLD                    UAVD
     C     KODTWK        KLIST
     C                   KFLD                    YWUNI
     C                   KFLD                    UAVD
     C     AIRL1K        KLIST
     C                   KFLD                    WSFSNQ
     C                   KFLD                    WSSDF
     C                   KFLD                    WSSDT
     C                   KFLD                    WSRK1
     C                   KFLD                    YRWEI             5 0
     C     AIR1K1        KLIST
     C                   KFLD                    WSFSNQ            3 0
     C                   KFLD                    WSSDF
     C                   KFLD                    WSSDT
     C                   KFLD                    WSRK1
     C     LOGKY         KLIST
     C                   KFLD                    WREF2
     C                   KFLD                    WWMSID
      *
     C     KEYFLP        KLIST
     C                   KFLD                    YFLPUN
     C                   KFLD                    TRSTA4
     C                   MOVE      'FLPR'        YFLPUN            4
     C     OTHKEY        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    ULOP
     C                   KFLD                    WO1331
     C                   KFLD                    WO1332
     C     OTHKEY2       KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    ULOP
     C                   KFLD                    WO1331
     C     OTHKEY3       KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    ULOP
     C     SSKEY         KLIST
     C                   KFLD                    UAVDOP           11 0
     C     *LIKE         DEFINE    DO1331        WO1331
     C     *LIKE         DEFINE    DO1332        WO1332
     C                   MOVEL     'MY'          WO1331
      *
     C     *ENTRY        PLIST
     C                   PARM                    UFIRM             2
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD              7 0
     C                   PARM                    Ulop              3 0
     C                   PARM                    USTLF            15
     C                   PARM                    UKTLF            15
     C                   PARM                    UANRUT            1
     C                   PARM                    UFLYTM            1
E07  C                   PARM                    HO
     C                   PARM                    LE
     C                   PARM                    BR
     C                   PARM                    AN
     C                   PARM                    UMSG             62
      *   (UFLAGG = 0)  =  KALLE FRA SYEF10 (REG. OPPDRAG)
      *   (UFLAGG = 1)  =  KALLE FRA SYFM21 (SPORRING PA OPPDRAG)
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      27
      *
     c                   movel     uavd          uavdop
     c                   move      uopd          uavdop
     C                   MOVE      'F'           YRI               1
     C                   MOVE      'Q'           YRIQ              1
      *
     C     DOKEFK        CHAIN     DOKEF                              33
     C  N33              UPDATE    DOKEFR
      *
      * HVEN QUESTIONING RETURNS IF NOT FOUND
      *
     C   27
     CAN 33              MOVE      0             UFLAGG
     C   27
     CAN 33              SETON                                        LR
     C   27
     CAN 33              RETURN
      *
      *
     C                   MOVE      'FR'          YFRUNI            2
     C                   MOVE      'AR'          YARUNI            2
     C                   MOVE      'A'           YAUNI             1
     C                   MOVE      'W'           YWUNI             1
     C                   MOVE      '/'           XTG1
     C                   MOVE      'x'           XTG2
     C                   MOVE      'x'           XTG3
     C                   MOVE      'CM'          XCM
     C                   Z-ADD     0             WSNTT
     C                   Z-ADD     0             WSVKTT
     C                   Z-ADD     0             WSFTOT            7 1
     C                   Z-ADD     0             WSBLT
     C                   Z-ADD     0             XWORK            15 4
     C     KODTWK        CHAIN     KODTW                              32
     C     UFIRM         CHAIN     FIRM                               33
     C     HEADFK        CHAIN     HEADF                              33
      *
      * innlands flyfraktbrev
      *
     C     HEUR          IFNE      'D'
     C                   EXSR      FLYANN
     C                   END
     C     KEYFLP        CHAIN     KODTFLP                            32
     C     KODTAK        CHAIN     KODTA                              32
      * TAR ROUTING FRA SAMLAST HVIS SATT PA SAMLAST
     C     HEHAWB        COMP      *ZEROS                             4141
      * TAR ELLERS ANBEFALT ROUTING
     C     UANRUT        COMP      'J'                                    42
     C     KODFRK        CHAIN     KODTFR                             39
     C  N41
     CAN 42KODARK        CHAIN     KODTAR                             39
      *
     C                   MOVE      'M3='         M3FAS1
     C                   MOVEL     HEM3          M3FAS2
     C     M3FAS2        IFEQ      '0000'
     C                   MOVE      *BLANKS       M3FAS2
     C                   END
     C                   MOVE      ','           M3FAS3
     C                   MOVE      HEM3          M3FAS4
      *
      * CONSOLLIDATION   41
      *
     C   41XLNR          IFGT      '000'
     C     XLNR          ANDLE     '999'
     C                   MOVE      XLNR          YLNR              3 0
     C     SAMLBK        CHAIN     SAMLB                              33
     C                   END
     C     DOKEFK        CHAIN     DOKEF                              33
     C  N33              UPDATE    DOKEFR
     C                   MOVE      *IN33         *IN90
      *
      * FLYTTER VARIABLE TIL SKJERMBILDE
      *
     C                   EXSR      MOVDFW
      *
      * OPPDTARERER DIMENSJONER PA FRAKTBREV
      *
     C                   EXSR      UPDDIM
      *
      * FLYTETT FRA TILLEGGSFIL TIL SKJERMBILDET
      *
     C     DOKEQK        CHAIN     DOKEQ                              33
     C  N33              UPDATE    DOKEQR
     C  N33              EXSR      MOVDQW
     C   33              DO
     C                   MOVE      HENAK         WSNA
     C                   MOVE      HEADK1        WSAD1
     C                   MOVE      HEADK2        WSAD2
     C                   MOVE      HEADK3        WSAD3
     C                   END
     C                   MOVEL     WUSER         WWUSER           17
     C                   Z-ADD     0             X                 3 0
     C     *DTAARA       DEFINE    *LDA          LDADS
     C                   IN        LDADS
     C     UFLAGG        IFEQ      0
     C     DSTINF        ANDNE     *BLANKS
     C     *IN90         ANDEQ     '1'                                          <NY DOKEFR
     C                   MOVE      *OFF          *IN90
     C                   MOVEL     DSTINF        BUTINF
     C     BUTRA1        IFNE      *BLANKS
     C                   MOVEL     BUTRA1        WSROA1
     C                   MOVEL     BUTRB1        WSROB1
     C                   Z-ADD     BUTRC1        WSROC1
     C                   ENDIF                                                  <BUTRA1
     C     BUTRA2        IFNE      *BLANKS
     C                   MOVEL     BUTRA2        WSROA2
     C                   MOVEL     BUTRB2        WSROB2
     C                   Z-ADD     BUTRC2        WSROC2
     C                   ENDIF                                                  <BUTRA2
     C     BUTRA3        IFNE      *BLANKS
     C                   MOVEL     BUTRA3        WSROA3
     C                   MOVEL     BUTRB3        WSROB3
     C                   Z-ADD     BUTRC3        WSROC3
     C                   ENDIF                                                  <BUTRA3
     C                   ENDIF                                                  <UFLAGG
     C                   MOVEL     *BLANKS       BUTINF
     C                   MOVEL     *BLANKS       DSTINF
     C                   OUT       LDADS
     C     FITDVI        IFEQ      'J'
     C                   OPEN      LOGL05                               99
     C                   ENDIF
      *
s12  C*                  MOVEL     'Marks/no'    MARKNO
s12  C*                  MOVE      ':'           MARKNO
      * ORDNER FUEL SURECHARGE M.H.T. EKSPORT/INNLAND
     C     TRSTA4        IFEQ      'I'
     C                   MOVE      'FI'          YFCUN2
     C                   ELSE
     C                   MOVE      'FC'          YFCUN2            2
     C                   END
     C                   ENDSR
      *
     C***********************************************
     C     FLYANN        BEGSR
     C***********************************************
     C                   MOVE      'AR'          YARUNI            2
     C* KALL FRA ANDRE MODULER
     C                   MOVE      'DIV0032'     MSGLN1
     C                   MOVE      'DIV0039'     MSGLN3
     C                   MOVE      'DIV0024'     MSGLN4
     C                   CLEAR                   DOKEFIMR
     C     IMPKEY        CHAIN     DOKEFIM                            32
     C   32              MOVE      'J'           DOMOMS
     C   32KODTAK        CHAIN     KODTA                              33
     C   32              MOVE      koaknr        hekns
     C     keysel        chain     cundl01                            33
     C     *IN27         IFNE      '1'
     C     HEGN11        IFNE      *BLANKS
     C                   MOVEL     HEGN11        WSFLY
     C                   END
      *
      *
     C     STANN         TAG
     C                   EXFMT     BILDE03
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN12         IFEQ      '1'
     C                   Z-ADD     1             UFLAGG
     C                   SETON                                        LR
     C                   RETURN
     C                   END
     C     TRSTA4        IFEQ      *BLANKS
     C                   MOVE      'I'           TRSTA4
     C                   END
     C     KEYFLP        CHAIN     KODTFLP                            33
     C*
     C* SOKING
     C*
     C     *IN04         IFEQ      '1'
     C*
     C                   EXSR      FLYSOK
     c                   goto      stann
     C                   END
      *
      * TILDEL AWBNUMMER
      *
     C   09HEGN11        IFEQ      *BLANKS
     C                   CALL      'SYIN10C'
     C                   PARM                    WSFLY
     C                   PARM                    WSMAWB           11 0
     C                   PARM                    UFLAGG
     C                   PARM                    KOWLAS
     C                   PARM                    KOFMK2
     C                   MOVE      WSMAWB        HEGN11
     C                   END
      *
      * TEST DATA
      *
     C                   EXSR      FLYTST
     C   30              GOTO      STANN
     C   09              GOTO      STANN
      *
      * 05 = VIDERE
      *
     C                   MOVE      *ZEROS        HEHAWB
     C  N32              UPDATE    DOKEFIMR
     C   32              MOVE      HEAVD         IMAVD
     C   32              MOVE      HEOPD         IMOPD
     C   32              MOVE      ULOP          IMLOP
     C   32              WRITE     DOKEFIMR
     C     HEGN11        IFNE      *BLANKS
     C     HEGN11        ANDNE     *ZEROS
     C                   EXSR      FRISR
     C                   END
     C                   END
     C                   MOVE      'J'           UANRUT
     C                   ENDSR
     C***********************************************
     C     FRISR         BEGSR
     C***********************************************
      *  FRI SOKEVEI..
     C     FRIKEY        KLIST
     C                   KFLD                    FSAVD
     C                   KFLD                    FSOPD
     C                   KFLD                    FSKODE
     C                   KFLD                    FSSOK
     C                   MOVE      'IAW'         FSKODE
     C                   MOVE      UAVD          FSAVD
     C                   MOVE      UOPD          FSOPD
     C                   MOVEL     HEGN11        FSSOK
     C     FRIKEY        CHAIN     FRISOK                             88
     C   88FSKODE        CHAIN     KODFRI                             33
     C   88              IF        *IN33
     C                   MOVE      *BLANKS       FSDOKK
     C                   ELSE
     C                   MOVE      KFSODK        FSDOKK
     C                   END
     C   88              MOVE      HEDTOP        FSDTOP
     C   88              WRITE     FRISOKR
     C                   ENDSR
     C***********************************************
     C     FLYSOK        BEGSR
     C***********************************************
     C*
     C* PRODUKTKODE
     C*
     C     LINNBR        IFEQ      07
     C     POSNBR        ANDEQ     31
     C                   CALL      'SYEF55'
     C                   Z-ADD     08            LINNBR
     C                   Z-ADD     31            POSNBR
     C                   GOTO      SLFLY
     C                   END
     C*
     C*
     C* FLYSELSKAP
     C*
     C*
     C     LINNBR        IFEQ      8
     C     POSNBR        ANDGE     31
     C     POSNBR        ANDLE     33
     C                   CALL      'SYFI10K'
     C                   PARM                    WSFLY
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     31            POSNBR
     C                   GOTO      SLFLY
     C                   END
     C*
     C*
     C* FRA FLYPLASS
     C*
     C     LINNBR        IFEQ      9
     C     POSNBR        ANDGE     31
     C     POSNBR        ANDLE     35
     C                   MOVE      *BLANKS       UNVN
     C                   MOVE      'NO'          ULK
     C                   CALL      'SYFI10F'
     C                   PARM                    HESDF
     C                   PARM                    UNVN             30
     C                   PARM                    ULK               2
     C                   Z-ADD     10            LINNBR
     C                   Z-ADD     31            POSNBR
     C                   GOTO      SLFLY
     C                   END
     C*
     C*
     C* TIL FLYPLASS
     C*
     C     LINNBR        IFEQ      10
     C     POSNBR        ANDGE     31
     C     POSNBR        ANDLE     35
     C                   MOVE      *BLANKS       UNVN
     C                   MOVE      'NO'          ULK
     C                   CALL      'SYFI10F'
     C                   PARM                    HESDT
     C                   PARM                    UNVN             30
     C                   PARM                    ULK               2
     C                   Z-ADD     11            LINNBR
     C                   Z-ADD     31            POSNBR
     C                   GOTO      SLFLY
     C                   END
     C*
     C     LINNBR        IFEQ      12
     C     POSNBR        ANDGE     31
     C     POSNBR        ANDLE     33
     C                   MOVE      'J'           USPED             1
     C                   CALL      'SYFI10G'
     C                   PARM                    HEFR
     C                   PARM                    USPED
     C                   GOTO      SLFLY
     C                   END
     C     LINNBR        IFEQ      14
E07  C                   MOVE      *BLANKS       USOKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    HEKNS
     C                   PARM                    FIFIRM
E07  C                   PARM                    USOKKN           30
     C                   END
     C     SLFLY         ENDSR
     C***********************************************
     C     FLYTST        BEGSR
     C***********************************************
     C                   MOVEA     '0'           *IN(30)
     C                   MOVEA     '000000'      *IN(70)
      *
      *  PRODUKTKODE
      *
     C     KEYFLP        CHAIN     KODTFLP                            70
     C     *IN70         IFEQ      '1'
     C                   MOVE      'SHU0644'     MSGNR
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     31            POSNBR
     C                   SETON                                        30
     C                   GOTO      UTFT
     C                   END
      *
      *  FLYSELSKAP
      *
     C                   MOVE      WSFLY         WFLY
     C     KODFSK        CHAIN     KODTFS                             71
     C     *IN71         IFEQ      '1'
     C                   MOVE      'SPK0017'     MSGNR
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     31            POSNBR
     C                   SETON                                        30
     C                   GOTO      UTFT
     C                   END
      *
      *  FRA STED
      *
     C     HESDF         CHAIN     STED2                              72
     C  N72              MOVE      ST2LK         HELKA
     C     *IN72         IFEQ      '1'
     C                   MOVE      'SPS0012'     MSGNR
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     31            POSNBR
     C                   SETON                                        30
     C                   GOTO      UTFT
     C                   END
     C*
      *
      *  TIL STED
      *
     C     HESDT         CHAIN     STED2                              73
     c     *in73         ifeq      '0'
     C                   MOVE      ST2LK         HELKK
     C     KEYSON        chain     airsone                            33
     C  N33              MOVEL     AIRSON        XXSONE            2
     C   33              MOVE      *blanks       XXSONE            2
     C                   END
     C     *IN73         IFEQ      '1'
     C                   MOVE      'SPS0013'     MSGNR
     C                   Z-ADD     10            LINNBR
     C                   Z-ADD     31            POSNBR
     C                   SETON                                        30
     C                   GOTO      UTFT
     C                   END
      *
      *  FRANKATUR
      *
     C     KODFRK        CHAIN     KODTFR                             74
     C     *IN74         IFEQ      '1'
     C                   MOVE      'SPF0006'     MSGNR
     C                   Z-ADD     12            LINNBR
     C                   Z-ADD     31            POSNBR
     C                   SETON                                        30
     C                   GOTO      UTFT
     C                   END
     C*
      *
      *  kunde avsender
      *
     C     keysel        CHAIN     CUNDL01                            75
     C     *IN75         IFEQ      '1'
     C                   MOVE      'SPK0126'     MSGNR
     C                   Z-ADD     14            LINNBR
     C                   Z-ADD     31            POSNBR
     C                   SETON                                        30
     C                   GOTO      UTFT
     C                   END
     C*
     C     UTFT          ENDSR
     C***********************************************
     C     TTSR          BEGSR
     C***********************************************
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
E07  C                   MOVE      XULAA         ULAA
     C                   MOVE      'STA'         TTACTI
     C                   MOVE      ULDT          TTDATE
     C                   MOVE      XULTM         TTTIME
     C                   MOVE      TTDATE        TTDATL            8 0
     C                   MOVE      TTTIME        TTTIML            6 0
     C                   MOVE      WUSER         TTUSER
     C                   MOVEL     'Airwaybi'    XXTE16           16
     C                   MOVE      'll enter'    XXTE16
     C                   MOVEL     XXTE16        XXTE32           32
     C                   MOVEL     'ed (int)'    XXTE16
     C                   MOVE      '        '    XXTE16
     C                   MOVE      XXTE16        XXTE32
     C                   MOVEL     XXTE32        TTTEXT
s05  C*                  MOVEL     HEGN          TTTEXT
n05  C                   CAT       HEGN:1        TTTEXT
n05  C                   MOVEL     'Flyfrakt'    XXTE16           16
n05  C                   MOVE      'brev lag'    XXTE16
n05  C                   MOVEL     XXTE16        XXTE32           32
n05  C                   MOVEL     'et (int)'    XXTE16
n05  C                   MOVE      '        '    XXTE16
n05  C                   MOVE      XXTE16        XXTE32
n05  C                   MOVEL     XXTE32        TTTEXL
n05  C                   CAT       HEGN:1        TTTEXL
     C                   WRITE     TRACKFR
     C                   ENDSR
     C***********************************************
     C     BEREGN        BEGSR
     C***********************************************
      *
      * AUTOMATISK BEREGNING AV GEBYR MOT CARRIER
      *
      * SJEKK MINIMUMSVEKT AKTUELL VEKT
     C     KFCSTA        IFNE      'F'
     C     KFCSTA        ANDNE     '+'
     C     KFCSTA        ANDNE     'M'
     C     KFCVKT        IFEQ      'A'
     C     WSVKTT        ANDLT     KFCMIN
     C                   GOTO      FSCSL
     C                   ENDIF                                                  <KFCVKT
      * SJEKK MINIMUMSVEKT FRAKTBEREGNINGSVEKT
     C     KFCVKT        IFEQ      'C'
     C     WSFTOT        ANDLT     KFCMIN
     C                   GOTO      FSCSL
     C                   ENDIF                                                  <KFCVKT
     C                   ENDIF                                                  <KFCVKT
     C     KEYLK         CHAIN     KODTLK                             33
      * SJEKK LANDKODE - INCLUDE
     C     KFCIO1        IFEQ      'I'
     C     HELKA         IFNE      KFCLK1
     C     HELKA         ANDNE     KFCLK2
     C     HELKA         ANDNE     KFCLK3
     C     HELKA         ANDNE     KFCLK4
     C     HELKA         ANDNE     KFCLK5
     C     KLKLK2        ANDNE     KFCLK1
     C     KLKLK2        ANDNE     KFCLK2
     C     KLKLK2        ANDNE     KFCLK3
     C     KLKLK2        ANDNE     KFCLK4
     C     KLKLK2        ANDNE     KFCLK5
     C                   GOTO      FSCSL
     C                   ENDIF                                                  <HELKA
     C                   ENDIF                                                  <KFCIO1
      * SJEKK LANDKODE - OMIT
     C     KFCIO1        IFEQ      'O'
     C     HELKA         IFEQ      KFCLK1
     C     HELKA         OREQ      KFCLK2
     C     HELKA         OREQ      KFCLK3
     C     HELKA         OREQ      KFCLK4
     C     HELKA         OREQ      KFCLK5
     C     KLKLK2        OREQ      KFCLK1
     C     KLKLK2        OREQ      KFCLK2
     C     KLKLK2        OREQ      KFCLK3
     C     KLKLK2        OREQ      KFCLK4
     C     KLKLK2        OREQ      KFCLK5
     C                   GOTO      FSCSL
     C                   ENDIF                                                  <HELKA
     C                   ENDIF                                                  <KFCIO1
      * SJEKK GYLDIGHETSDATO
     C     KFCTIL        IFEQ      *ZEROS
     C                   MOVE      99999999      KFCTIL
     C                   END
      * START DATOTEST
     C     HEDTOP        IFLE      KFCTIL
     C     HEDTOP        ANDGE     KFCFRA
      * START FAST PRIS
     C     KFCSTA        IFEQ      'F'
     C                   Z-ADD     KFCMIN        WSCARR
     C                   ELSE
      * SJEKK FRAKTBEREGNINGSVEKT ELLER AKTUELL VEKT
     C     KFCVKT        IFEQ      'A'
     C     WSVKTT        MULT      KFCAVG        WSCARR            9 2
     C                   ELSE
     C     WSFTOT        MULT      KFCAVG        WSCARR
     C                   ENDIF                                                  <DFCVKT
     C     KFCSTA        IFEQ      '+'
     C                   ADD       KFCMIN        WSCARR
     C                   END
N08  C     KFCMIN        DIV       100           KFCMIND           7 2
     C     KFCSTA        IFEQ      'M'
S08  C*    WSCARR        ANDLT     KFCMIN
N08  C     WSCARR        ANDLT     KFCMIND
S08  C*                  Z-ADD     KFCMIN        WSCARR
N08  C                   Z-ADD     KFCMIND       WSCARR
     C                   END
     C                   ENDIF                                                  <DFCVKT
      * SLUTT ELSE TIL FASTPRIS
     C     WSKDDC        IFEQ      ' '
     C     WSCCPP        IFEQ      'CC'
     C                   MOVE      'C'           WSKDDC
     C                   ENDIF                                                  <WSCCPP
     C     WSCCPP        IFEQ      'PP'
     C                   MOVE      'P'           WSKDDC
     C                   ENDIF                                                  <WSCCPP
     C                   ENDIF                                                  <WSCCPP
      * OPPDATER EGEN FIL MED OTHER CHARGES
      *
     C                   EXSR      OPDOTH
     C                   ENDIF                                                  <HEDTOP
     C     FSCSL         ENDSR
      *
     C***********************************************
     C     OPDOTH        BEGSR
     C***********************************************
      *
      * OPPDATERER ANDRE GEBYRER
      *
     C                   move      'J'           BERFC             1
     C                   MOVEL     'C'           WO1332
     C     OTHKEY        CHAIN     DOKOTH                             66
s06  C*    *IN66         IFEQ      *OFF
s06  C*    DO1333        ANDGT     0
s06  C*                  DELETE    DOKOTR
s06  C*                  MOVE      *ON           *IN66
s06  C*                  END
      * hvi verkter endret beregn på nytt
n11  C     *IN66         IFEQ      *OFF
n11  C     DO1333        ANDGT     0
n11  c     wsftot        ifne      wsftotx
n11  c     wsvktt        orne      wsvkttx
n11  C                   DELETE    DOKOTR
n11  C                   MOVE      *ON           *IN66
n11  C                   END
n11  C                   END
     C     *IN66         IFEQ      *ON
     C                   CLEAR                   DOKOTR
     C                   Z-ADD     UAVD          DOAVD
     C                   Z-ADD     UOPD          DOOPD
     C                   Z-add     Ulop          DOLOP
     C                   MOVEL     WO1331        DO1331
      * SKJEKK COLLECT PREPAID
     C     WSCCPP        IFEQ      'CC'
     C                   MOVEL     'C'           DO1322
     C                   ELSE
     C     WSCCPP        IFEQ      'PP'
     C                   MOVEL     'P'           DO1322
     C                   ENDIF                                                  <WSCCPP
     C                   ENDIF                                                  <WSCCPP
      *
     C                   MOVEL     'C'           DO1332
     C                   Z-ADD     WSCARR        DO1333
     C*
     C     WSVAL         IFNE      FICURR
     C     VALU1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSVAL
     C     VALU1K        CHAIN     VALUL01                            33
     C  N33VALKU2        IFNE      0
     C                   Z-ADD     VALKU2        VALKU1
     C                   END
      *
     C     DO1333        MULT      OMRFAK        XWORKY           17 5
     C     XWORKY        DIV(H)    VALKU1        DO1333
     C                   END
     C     DO1333        ifne      *zeros
     C                   WRITE     DOKOTR
     C                   end
     C                   ENDIF
     C                   ENDSR
     C***********************************************
     C     BEREGNA       BEGSR
     C***********************************************
      *
      * OPPDATERER GEBYRER MOT AGENT
      *
     C                   MOVEL     'A'           WO1332
     C     OTHKEY2       CHAIN     DOKOTH                             66
     C     MCAWFE        IFNE      *ZEROS
     C     *IN66         ANDEQ     '1'
     C                   CLEAR                   DOKOTR
     C                   Z-ADD     UAVD          DOAVD
     C                   Z-ADD     UOPD          DOOPD
     C                   Z-ADD     ULOP          DOLOP
     C                   MOVEL     WO1331        DO1331
     C     WSCCPP        IFEQ      'CC'
     C                   MOVEL     'C'           DO1322
     C                   ELSE
     C     WSCCPP        IFEQ      'PP'
     C                   MOVEL     'P'           DO1322
     C                   ENDIF                                                  <WSCCPP
     C                   ENDIF                                                  <WSCCPP
     C                   MOVEL     'A'           DO1332
     C                   Z-ADD     MCAWFE        DO1333
     C*
     C     WSVAL         IFNE      FICURR
     C     VALU1K        CHAIN     VALUL01                            33
     C  N33VALKU2        IFNE      0
     C                   Z-ADD     VALKU2        VALKU1
     C                   END
      *
     C     DO1333        MULT      OMRFAK        XWORKY           17 5
     C     XWORKY        DIV(H)    VALKU1        DO1333
     C                   END
     C                   WRITE     DOKOTR
     C                   ENDIF
     C     UTAG          ENDSR
     C***********************************************
     C     SRMO          BEGSR
     C***********************************************
      *
      * AUTOMATISK BEREGNING AV MISCELLANOUS DUE ISSUING CARRIER
      *
      * Henter DATA FRA FLYSELSKAP
     C                   Z-ADD     HEKNT         WFLY              3 0
     C     WFLY          IFGT      0
     C     KODFSK        CHAIN     KODTFS                             33
     C     *IN33         IFEQ      *OFF
N01  C     KFSMCO        IFNE      0
N01  C     WSFTOT        ANDGT     KFSMCO
N01  C                   Z-ADD     KFSMC2        WSCARR
N01  C                   ELSE
     C                   Z-ADD     KFSMC         WSCARR            9 2
N01  C                   END
      *
      * OPPDATER EGEN FIL MED OTHER CHARGES
     C                   MOVEL     'CH'          WO1331
      *
     C                   EXSR      OPDOTH
     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
     C***********************************************
     C     SUMOTH        BEGSR
     C***********************************************
     C                   Z-ADD     0             WSBLDC
     C                   Z-ADD     0             WSBLDA
      *
      * SUMMER OTHER CHARGES DUE CARRIER
      *
     C     OTHKEY3       SETLL     DOKOTH
     C     OTHKEY3       READE(N)  DOKOTH                                 66
     C     *IN66         DOWEQ     *OFF
      *
     C     DO1332        IFEQ      'C'
     C                   ADD       DO1333        WSBLDC
     C                   ELSE
     C                   ADD       DO1333        WSBLDA
     C                   ENDIF
      *
     C     othkey3       READE(N)  DOKOTH                                 66
     C  N66              ENDDO
     C                   ENDSR
     C***********************************************
     C     shiweb        BEGSR
     C***********************************************
     c     twval         ifne      *blanks
     c                   move      TWVAL         WSVAL
     c                   end
     c     twfn11        ifne      *blanks
     c                   move      TWFN11        WSROA1
     c                   move      TWFN12        WSROB1
     c                   move      TWFN13        WSROC1
     c                   move      TWFN21        WSROA2
     c                   move      TWFN22        WSROB2
     c                   move      TWFN23        WSROC2
     c                   move      TWFN31        WSROA3
     c                   move      TWFN32        WSROB3
     c                   move      TWFN33        WSROC3
     c                   end
      * frakt
      * surcharge
     c     TWBLC         ifne      *zeros
     c* slett gamle hvis finnes
     c     twblc         ifne      *zeros
     c                   setoff                                       66
     C     OTHKEY3       SETLL     DOKOTH
     c     *in66         doweq     '0'
     C     OTHKEY3       READE     DOKOTH                                 66
     C  N66              delete    dokotr
     c                   enddo
     c                   move      uavd          doavd
     c                   move      uopd          doopd
     c                   z-add     1             dolop
     c                   move      'CH'          do1331
     c                   move      'C'           do1332
      * 1 linje med 0 kroner på CH
     c                   move      'C'           do1322
     c                   move      *zeros        do1333
     c                   write     dokotr
      * 1 linje med surcharges
     c                   z-add     twblc         do1333
     c                   write     dokotr
      * 1 linje med 0 kroner på MY
     c                   move      'MY'          do1331
     c                   move      'C'           do1322
     c                   move      *zeros        do1333
     c                   write     dokotr
      * 1 linje med 0 kroner på SC
     c                   move      'SC'          do1331
     c                   move      'C'           do1322
     c                   move      *zeros        do1333
     c                   write     dokotr
     c                   end
     c                   end
     c*                  move      TWBLC         WSBELF
     C*
      * Vekt
     c     twwt          ifne      *zeros
     c                   z-add     TWWT          WSVKT1
     c                   z-add     TWWT          WSFBV1
     c                   end
      * Kubikk
     c     twm3          ifne      *zeros
     c     kodtvk        chain     kodtv                              34
     C*** GETS FREIGHTWEIGHT
     C     twm3          MULT      KOVKKG        XM3DE            12 3
     C                   ADD       0.999         XM3DE
     C                   Z-ADD     XM3DE         XM3M3             9 0
     C     WSFBV1        COMP      XM3M3                              34
     C  N34              Z-ADD     XM3M3         WSFBV1
     c                   move      TWM3          HEM3
     C                   MOVE      'M3='         M3FAS1
     C                   MOVEL     HEM3          M3FAS2
     C     M3FAS2        IFEQ      '0000'
     C                   MOVE      *BLANKS       M3FAS2
     C                   END
     C                   MOVE      ','           M3FAS3
     C                   MOVE      HEM3          M3FAS4
     C     HEM3          IFNE      *ZEROS
     C                   MOVEL     M3TXT         VA(3)
     C                   END
     c                   end
     C                   ENDSR
N02   *****************************************************************
N02  C     SECSR         BEGSR
N02   *****************************************************************
N02  C                   MOVEL     '"SPX/KC/'    SECUNS
N02  C                   CALL      'SYGE12CB'
N02  C                   PARM                    WUSER
N02  C                   PARM                    ZNVN             50
N02  C                   PARM                    ZFINS             1
N02  C     SECUNS        CAT       ZNVN:0        SECUNS
N02  C                   TIME                    XULTID
N02  C     SECUNS        CAT       '/':0         SECUNS
N02  C     SECUNS        CAT       XULDDA:0      SECUNS
N02  C     SECUNS        CAT       '.':0         SECUNS
N02  C     SECUNS        CAT       XULMMA:0      SECUNS
N02  C     SECUNS        CAT       '.':0         SECUNS
E07  C     SECUNS        CAT       XULAAA:0      SECUNS
N02  C     SECUNS        CAT       '/':0         SECUNS
N02  C     SECUNS        CAT       XULTIT:0      SECUNS
N02  C     SECUNS        CAT       ':':0         SECUNS
N02  C     SECUNS        CAT       XULTIM:0      SECUNS
N02  C     SECUNS        CAT       '/':0         SECUNS
N02  C     UAVD          CHAIN     KODTASID                           35
N02  C     SECUNS        CAT       KSIDNR:0      SECUNS
N02  C     SECUNS        CAT       '"':0         SECUNS
n02  C                   MOVEL     SECUNS        WSINFB
N02  C                   ENDSR
**    TABELL  (NAV)  ENDRING 03
JAN
FEB
MAR
APR
MAY
JUN
JUL
AUG
SEP
OCT
NOV
DEC
