********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 JOV PTF12 Bring gått tolbake til x'05' tab som skilletegn
********************************************************************
      * Forutsetning:  - gå til http://www.bring.no/postnummer
      *                - last ned Tab-separet / Ansi txt-fil
      *                - flytt/rename denne til : '/HOME/SYTOLL/POSTNR.TXT'
      *                 cl SYTIPO1C  konveretrer den så til DB-fil QTEMP/SYTIRCV
      * eks (?=Hex05=tab)
      * 9960?KIBERG?2002?VARDØ?G
      * 9980?BERLEVÅG?2024?BERLEVÅG?G
      * 9981?BERLEVÅG?2024?BERLEVÅG?P
      * 9982?KONGSFJORD?2024?BERLEVÅG?B
      * 9990?BÅTSFJORD?2028?BÅTSFJORD?G
      *
      * postnr/stedsnavn/kommunenr/kommunenavn/postnr-type
      *
      * Pr okt. 2019 - finnes følgende typer
      * B = Både gateadresser og postbokser
      * F = Flere bruksområder (felles)
      * G = Gateadresser (og stedsadresser), dvs. "grønne postkasser"
      * P = Postbokser
      * S = Servicepostnummer (disse postnumrene er ikke i bruk til postadresser)
      *
      * UTFIL PONRN har annet format historisk med flere felt
      *       PONBES, Pontyp kunne med fordel kuttes ut  (og PONTYK kortes til 1 ..)
      *
     FSYTIRCV   ip   F 1024        DISK
     FPONRNNY   o    e             DISK
     D                 DS
     D  dtafld                 1  54000
     D                                     DIM(180)
     D                 DS
     D  ZDEC                   1      7  6
     D  ZDEC6                  2      7
     D  ZHEL                  11     22  0
N05  D                 DS
N05  D  UNDER                  1     40
N05  D  UNDERT                 1      5
N05  D  UNDER1                 1      4
N05  D  UNDER2                 6     40
     D                 DS
     D  A                      1     79
     D                                     DIM(79)
     D                 DS
     D  B                      1     18
     D                                     DIM(18)
     ISYTIRCV   NC  01
     I                                  1 1024  DATAINN
     I
     c                   if        ini = ' '
     c                   exsr      INIT
     c                   move      'X'           ini               1
     c                   endif
      *
     c                   exsr      DETSR
      *
      **************************************************************
     C     DETSR         BEGSR
      **************************************************************
      *
      * Kaller eksternt program og legger felt i array
      *
     c                   MOVE      *BLANKS       UDATA
     C                   MOVEL     DATAINN       UDATA          4096
     C                   MOVEL     *BLANKS       UARRA         54000
     C*                  MOVE      X'05'         SKILLET           1            Hex 05 = TAB
s01  C*                  MOVE      X'5E'         SKILLET           1            Hex 5E = TAB
N01  C                   MOVE      X'05'         SKILLET           1            Hex 05 = TAB
     C                   CALL      'SYGE111'
     C                   PARM                    SKILLET
     C                   PARM                    UDATA
     C                   PARM                    UARRA
     c                   movea     uarra         dtafld
      *
      * tømmer flt i utdatafil
      *
      *
      *
      *
      * felt 1 alfa   postnr
      *
     C                   EVAL      PONNR =dtafld(1)
      *
      * felt 2 alfa   poststed
      *
      *
      *
     C                   EVAL      PONNAV=dtafld(2)
      *
      * felt 3 alfa   kommunenr
      *
     C*                  EVAL      PONKNR=dtafld(1)
     C                   EVAL      PONKNR=dtafld(3)
      *
      * felt 4 alfa   kommenunavn
      *
      *
      *
     C                   EVAL      PONKNA=dtafld(4)
      *
      *
      * felt 5 alfa  Kode
      *
      *
     C                   EVAL      PONTYK=dtafld(5)
      *
     c                   select
     c                   when      PONTYK='B'
     c                   eval      PONTYP='Både gateadresser og postbokser'
     c                   when      PONTYK='F'
     C                   eval      PONTYP='Flere bruksområder (felles) '
     c                   when      PONTYK='G'
     C                   eval      PONTYP='Gateadresser (og stedsadresser), '
     C                             +'dvs. "grønne postkasser"'
     c                   when      PONTYK='P'
     c                   eval      PONTYP='Postbokser'
     c                   when      PONTYK='S'
     c                   eval      PONTYP='Servicepostnummer (disse postnumrene'
     C                             +' er ikke i bruk til postadresser)'
     c                   other
     c                   eval      PONTYP=PONTYK +' ** Ukjent type **'
     c                   endsl
      *
      *skriv til utfil
     C                   WRITE     PONRNR
      * sett flagg for at post er skrevet
     C                   MOVE      '0'           INST
      *
     C                   ENDSR
      *
     c*****************************************
     c     getnum        begsr
     c*****************************************
     C                   MOVE      *ZEROS        ZHEL
     C                   MOVE      *ZEROS        ZDEC
     C                   MOVE      *ZEROS        B
     C                   Z-ADD     1             AX                2 0
     C                   Z-ADD     1             BX                2 0
      * Get Integer
     C     A(AX)         DOWGE     '0'
     C     ZHEL          MULT      10            ZHEL
     C                   MOVE      A(AX)         ZHEL
     C                   ADD       1             AX
     C                   ENDDO
      * Decimal point ?
     C     A(AX)         IFEQ      '.'
     C     A(AX)         OREQ      ','
     C                   ADD       1             AX
     C     A(AX)         DOWGE     '0'
     C                   MOVE      A(AX)         B(BX)
     C                   ADD       1             AX
     C                   ADD       1             BX
     C                   ENDDO
     C                   MOVEA     B             ZDEC6
     C                   ENDIF
      * Concatenate
     C                   Z-ADD     ZHEL          ZNUM             18 6
     C                   ADD       ZDEC          ZNUM
     C                   ENDSR
     c
      **************************************************************
     C     INIT          BEGSR
      **************************************************************
      *
     C     *ENTRY        PLIST
     C                   PARM                    INST              1
      * ER MODUL INSTALLERT - ikke returner me flagg =1
     C                   MOVEL     'SYTADINT'    UMODUL           15
     C                   MOVE      '       '     UMODUL
     C                   CALL      'SYPRODT'
     C                   PARM                    UMODUL
     C                   PARM                    UMFLAG            1 0
     C     UMFLAG        IFEQ      1
     C                   MOVE      UMFLAG        INST
     C                   SETON                                        LR
     C                   RETURN
     C                   END
      *
     C                   ENDSR
