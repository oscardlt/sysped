      *
      ***********************************************************
      *** PROGRAM SKAL SPØRRE PÅ BRUKTE LAGERPOS. WEB         ***
      ***********************************************************
      *
     FBRPARF    IF   E           K DISK
     FKUFAST    IF   E           K DISK
     FLLVADR    IF   E           K DISK
     FLLAGJS03  IF   E           K DISK
     FLLAGJS04  IF   E           K DISK
     F                                     RENAME(LLAGJR:LLAGJRS4)
     FLLVARE01  IF   E           K DISK
     FLLMRF     IF   E           K DISK
     FLLW042    UF A E           K DISK
     D VE              S              5    DIM(500)
     D LEV             S             17    DIM(500)
     D                 DS
     D  PAVRDA                 1     50
     D  VV                     1     50    DIM(10)
      *
     C                   EXSR      INIT
      *
     C                   MOVE      *BLANKS       VE
     C                   IF        UVE = '*ALL'
     C                   EXSR      HENTVE
     C                   ELSE
     C                   MOVE      UVE           VE(1)
     C                   END
      *
     C                   MOVE      *BLANKS       LEV
     C                   IF        ULEV = '*ALL'
     C                   EXSR      HENTLEV
     C                   ELSE
     C                   MOVE      ULEV          LEV(1)
     C                   END
      *
     C                   EXSR      LESPOS
      *
     C                   SETON                                        LR
     C                   RETURN
      *
     C***********************************************
     C     HENTVE        BEGSR
     C***********************************************
     C                   MOVE      UUSER         PABRID
     C                   MOVE      *ZEROS        PAKUNR
     C                   EVAL      PAID = 'LLVE'
     C     BRPARFK       CHAIN     BRPARF                             33
     C                   IF        *IN33
     C                   MOVE      '*KUNDFT*  '  PABRID
     C                   MOVE      UFIRM         PABRID
     C                   MOVE      UPNR          PAKUNR
     C     BRPARFK       CHAIN     BRPARF                             33
     C                   IF        *IN33
     C                   MOVE      *ZEROS        PAKUNR
     C     BRPARFK       CHAIN     BRPARF                             33
     C                   END
     C                   END
      *
     C                   MOVE      *ZEROS        XN                3 0
     C                   IF        *IN33
     C     KUFASTK       SETLL     KUFAST
     C     KUFASTK       READE     KUFAST                                 33
     C  N33              IF        KFKOD = ' DEFN'
     C     KUFASTK       READE     KUFAST                                 33
     C                   END
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   MOVE      KFKOD         VE(XN)
     C     KUFASTK       READE     KUFAST                                 33
     C                   ENDDO
      *
     C                   ELSE
     C                   MOVEA     VV            VE
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     HENTLEV       BEGSR
     C***********************************************
     C                   MOVE      UUSER         PABRID
     C                   MOVE      *ZEROS        PAKUNR
     C                   EVAL      PAID = 'LLLEV'
     C     BRPARFK       CHAIN     BRPARF                             40
      *
     C                   MOVE      *ZEROS        XN                3 0
     C                   IF        *IN40
      *
     C     LLVADRK       SETLL     LLVADR
     C     LLVADRK       READE     LLVADR                                 40
     C                   DOW       *IN40 = *OFF
     C                   ADD       1             XN
     C                   MOVE      VAKURE        LEV(XN)
     C     LLVADRK       READE     LLVADR                                 40
     C                   ENDDO
      *
     C                   ELSE
      *
     C                   DOW       *IN40 = *OFF
     C                   ADD       1             XN
     C                   MOVEL     PAVRDA        LEV(XN)
     C     BRPARFK       READE     BRPARF                                 40
     C  N40              ENDDO
      *
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     LESPOS        BEGSR
     C***********************************************
     C                   IF        UANR = *BLANKS
     C     LLAGJS04K     SETLL     LLAGJS04
     C     LLAGJS04K     READE     LLAGJS04                               33
     C                   ELSE
     C     LLAGJS03K     SETLL     LLAGJS03
     C     LLAGJS03K     READE     LLAGJS03                               33
     C                   END
     C                   DOW       *IN33 = *OFF
      *
     C     LLVARE01K     CHAIN     LLVARE01                           33
     C     1             DO        500           XN
     C                   IF        VE(XN) = *BLANKS
     C                   GOTO      SLOPD
     C                   ELSE
     C     VE(XN)        CABEQ     LVEIER        STOPD1
     C                   END
     C                   ENDDO
      *
     C     STOPD1        TAG
     C     LLMRFK        CHAIN     LLMRF                              33
     C     1             DO        500           XN
     C                   IF        LEV(XN) = *BLANKS
     C                   GOTO      SLOPD
     C                   ELSE
     C     LEV(XN)       CABEQ     MRLNR         STOPD2
     C                   END
     C                   ENDDO
      *
     C     STOPD2        TAG
     C     LW042K        CHAIN     LLW042                             34
     C     *IN34         IFEQ      '0'
     C                   ADD       1             L42ANT
     C                   UPDATE    LLW042R
     C                   ELSE
     C                   MOVE      VAGRUP        L42GRU
     C                   MOVE      VAKJED        L42KN
     C                   MOVE      VALLOK        L42LOK
     C                   MOVE      VALLT         L42LLT
     C                   Z-ADD     1             L42ANT
     C                   WRITE     LLW042R
     C                   END
     C     SLOPD         TAG
     C                   IF        UANR = *BLANKS
     C     LLAGJS04K     READE     LLAGJS04                               33
     C                   ELSE
     C     LLAGJS03K     READE     LLAGJS03                               33
     C                   END
     C  N33              ENDDO
      *
     C                   ENDSR
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    UUSER            10
     C                   PARM                    UFIRM             2
     C                   PARM                    UGRP              8
     C                   PARM                    UPNR              8
     C                   PARM                    UVE               5
     C                   PARM                    ULEV             17
     C                   PARM                    UANR             15
      *
     C     LLAGJS03K     KLIST
     C                   KFLD                    VAGRUP
     C                   KFLD                    VAKJED
     C                   KFLD                    UANR
     C     LLAGJS04K     KLIST
     C                   KFLD                    VAGRUP
     C                   KFLD                    VAKJED
     C     LW042K        KLIST
     C                   KFLD                    VAGRUP
     C                   KFLD                    VAKJED
     C                   KFLD                    VALLOK
     C     LLVARE01K     KLIST
     C                   KFLD                    VAGRUP
     C                   KFLD                    VAKJED
     C                   KFLD                    VAANR
     C     LLMRFK        KLIST
     C                   KFLD                    VAGRUP
     C                   KFLD                    VAKJED
     C                   KFLD                    VAMRNR
     C     LLVADRK       klist
     C                   kfld                    UFIRM
     C                   kfld                    VAKJED
     C     BRPARFK       klist
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
     C     KUFASTK       klist
     C                   kfld                    KFTYP
     C                   MOVEL     'VE'          KFTYP
     C                   MOVE      UPNR          KFTYP
      *
     C                   MOVE      'B'           WSOMRF            1
     C                   MOVE      UGRP          VAGRUP
     C                   MOVE      UPNR          VAKJED
      *
     C                   ENDSR
      *
