********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 KOMPLETT.NO/Tollager-XML-typer lagt inn + Gjort om UTYPE til UPROG
10XXX * 02 YBC PTF10 BRING TET-EKSPORT
10XXX * 03 YBC PTF10 BRING SYSPED-OPPDRAG
      *%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * 04 JOV PTF11 Kingsrød DK BondedWarehouseMessage  fra Kingsland
11XXX * 05 YBC PTF11 DEFAULT PGM ER BLANK.
11XXX * 06 JOV PTF11 MyBring nedlastet XML-faktura
11065 * 07 YBC PTF11 SJEKK EHF-KVITTERINGSFIL FRA EVRY
11XXX * 08 JOV PTF11 e2b-faktura - f.eks fra annen SYSPEBRUKER
11XXX * 09 YBC PTF11 RETT FEIL I ENDRING 07 (AVSENDER/MOTTAKER BYTTET OM)
11092 * 10 CB  PTF11 Mottak TDS Tulltaxa
11XXX * 11 YBC PTF11 BRING AIR & SEA: FORTOLLINGS OPPDRAG
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
12XXX * 12 YBC PTF12 BRING C-3248
12XXX * 13 SH  PTF12 interchange blank fra tollvesenet
12XXX * 14 SH  PTF12 rettelse tollvesen
12XXX * 15 YBC PTF12 Rettelse tollvesen pga andre E2B
12XXX * 16 sh  PTF12 flere tollvesenparter
12XXX * 17 YBC PTF12 Mottak av EHF
12XXX * 18 JOV PTF12 Hvis foret-nr (EHF) ikke finnes i EDII bruk "EVRY" - Lagre UIFS i EDIS
12XXX * 19 sh  PTF12 flere tollvesenparter
12161 * 20 YBC Fast edi-avsender/mottaker (EHF på begge sider)
12165 * 21 CB  Les inn fortollingsoppdrag fra CW for DHL
12234 * 22 YBC Konvertere CW1 til SYSPED
12244 * 23 CB  Konvertere Dachser faktura/fortolling til SYSPED
12XXX * 24 YBC PTF12 EHF starter med ns4:Invoice
12287 * 25 YBC PTF12 Konverter NCTS tilbakemelding for fase 5
12XXX * 26 CB  PTF12 Les inn xml for Schenker fakturascanning
12XXX * 27 CB  PTF12 Les inn xml for Schenker (HP)
********************************************************************
      *
      ***********************************************************
      *** PROGRAM SKAL TEST XML OG KALLE KONV.PROGRAMMER      ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01 02 04 07 09-11 13-24          ***
      *** LEDIGE INDIKATORER 27-29 31 32 34-39 41-88 95-97    ***
      ***********************************************************
      *
     FXMLRCVF   IF   E           K DISK
     FXMLRCAF   IF   E           K DISK
N18  FEDII      IF   E           K DISK
     FEDIS      O  A E             DISK
      *
     C                   EXSR      INIT
      *
      * FINN MELDINGSNAVN
     C     XMLRCVFK      CHAIN     XMLRCVF                            33
     C     *IN33         CABEQ     *ON           SLUTT
      *
N08   * Finn Type via første record i XMLfil
     C                   SELECT
S15  C*                  WHEN      XRNV = 'Interchange'
S15  C*                  EXSR      SRTOLL
     C                   WHEN      XRNV = 'Transport'
     C                   EXSR      SR001
N26  C                   WHEN      XRNV = 'Declaration'
N26  C                   EXSR      SR001CUS
N27  C                   WHEN      XRNV = 'n0:ImportDeclarationRequest'
N27  C                   EXSR      SR001HPI
N27  C                   WHEN      XRNV = 'n0:ExportDeclarationRequest'
N27  C                   EXSR      SR001HPI
      *
N06  C                   WHEN      XRNV = 'Report'
N06  C                   EXSR      SR001BRING
N01   * Komplett.no, SAP -> Syepsed Logistill / Tollager B
N01  C                   WHEN      XRNV = 'ZSYSPED01'                           Inngang+(korr ut)
N01  C                             or XRNV = 'ZDELVRY03'                        Utgang NO
N01  C                             or XRNV = 'ZSHPMNT02'                        Utgang Exp
N01  C                             or XRNV = 'ZSYSPED_MIRO01'                   Korriger verdi
N01  C                   EXSR      SR001KOMP
N04   * Kingsland Navision -> Kings DK Syesped Logistikk / Tollager B
N04  C                   WHEN      XRNV = 'BondedWarehouseMessage'
N04  C                   EXSR      SR001KINGS
N07  C                   WHEN      XRNV = 'ApplicationResponse'
N07  C                   EXSR      SREHFRES
N12  C                   WHEN      XRNV = 'ns2:DistributeCustomerPartyCDHRespo'
N12  C                   EXSR      SRBC3248_1
N12  C                   WHEN      XRNV = 'ns1:InvoiceStatus'
N12  C                   EXSR      SRBC3248_2
N13  C                   WHEN      XRNV = 'ECOSupplierInvoice'
N13  C                   EXSR      SRBAC
N13  C                   WHEN      XRNV = 'ns1:TMSSupplierInformation'
N13  C                   EXSR      SRLEVE
N17  C                   WHEN      XRNV = 'Invoice' OR XRNV = 'CreditNote' OR
N17  C                             XRNV = 'inv:Invoice'
N24  C                             OR XRNV = 'ns4:Invoice'
N17  C                   EXSR      SR001EHF
N21  C                   WHEN      XRNV = 'CustomsFiling'
N21  C                   EXSR      SRCWDHL
N22  C                   WHEN      XRNV = 'UniversalShipment'
N22  C                   EXSR      SRCW1SYS
N23  C                   WHEN      XRNV = 'DachserInvoice'
N23  C                   EXSR      SRDACSYS
N25  C                   WHEN      XRNV = 'ns2:CC004C' OR XRNV = 'ns2:CC028C' OR
N25  C                             XRNV = 'CC004C' OR XRNV = 'CC028C' OR
N25  C                             XRNV = 'ns2:CC009C' OR XRNV = 'ns2:CC029C' OR
N25  C                             XRNV = 'CC009C' OR XRNV = 'CC029C' OR
N25  C                             XRNV = 'ns2:CC035C' OR XRNV = 'ns2:CC140C' OR
N25  C                             XRNV = 'CC035C' OR  XRNV = 'CC140C' OR
N25  C                             XRNV = 'ns2:CC045C' OR XRNV = 'ns2:CC051C' OR
N25  C                             XRNV = 'CC045C' OR XRNV = 'CC051C' OR
N25  C                             XRNV = 'ns2:CC055C' OR XRNV = 'ns2:CC056C' OR
N25  C                             XRNV = 'CC055C' OR XRNV = 'CC056C' OR
N25  C                             XRNV = 'ns2:CC060C' OR XRNV = 'ns2:CC182C' OR
N25  C                             XRNV = 'CC060C' OR XRNV = 'CC182C' OR
N25  C                             XRNV = 'CC057C' OR XRNV = 'ns2:CC057C' OR
N25  C                             XRNV = 'ns2:CC043C' OR XRNV = 'ns2:CC025C' OR
N25  C                             XRNV = 'CC043C' OR XRNV = 'CC025C' OR
N25  C                             XRNV = 'ns2:CC928C' OR XRNV = 'ns2:CC019C' OR
N25  C                             XRNV = 'CC928C' OR XRNV = 'CC019C' OR
N25  C                             %SUBST(XRNV:1:10) = 'ns2:CC917C' OR
N25  C                             %SUBST(XRNV:1:10) = 'ns2:CD917C' OR
N25  C                             %SUBST(XRNV:1:6) = 'CC917C' OR
N25  C                             %SUBST(XRNV:1:6) = 'CD917C' OR
N25  C                             XRNV = 'ns2:CC906C' OR XRNV = 'ns2:CD906C' OR
N25  C                             XRNV = 'ns2:CC906C' OR XRNV = 'CD906C'
N25  C                   EXSR      SRNCTS_5
N08  c                   OTHER
N08   * Finn Type via første record i XMLfil
N08  C     XMLRCVFK      CHAIN     XMLRCAF                            33
N10  C                   MOVEL     XRATV         XXRATV           27
N08  C                   SELECT
N08  C                   WHEN      XRATV = 'http://www.e2b.no/XMLN26ema'
N08  C                   EXSR      SR001E2B
N10  C                   WHEN      XXRATV= 'http://www.arcticgroup.se/t'
N10  C                   EXSR      SR001TDS
N08  C                   ENDSL
N08   *
     C                   ENDSL
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
      ***********************************************
     C     SR001         BEGSR
      ***********************************************
      *
     C     XMLKEY0010    SETLL     XMLRCAF
     C     XMLKEY0010    READE     XMLRCAF                                33
     C                   DOW       *IN33 = *OFF
      *
     C                   SELECT
     C                   WHEN      XRATN  = 'messageId'
     C                   EVAL      S0020  = XRATV
     C                   WHEN      XRATN  = 'messageFunction'
     C                   EVAL      S0026  = 'XML-' + XRATV
N11  C                   WHEN      XRATN  = 'collaboration'
N11  C                   EVAL      XCOLL  = XRATV
     C                   ENDSL
      *
     C     XMLKEY0010    READE     XMLRCAF                                33
     C                   ENDDO
      *
      * HENT AVSENDER/MOTTAKERS UTVEKSLINGS-ID
     C                   Z-ADD     1             X0010_XRLEV1
     C     XMLKEY0010    SETLL     XMLRCVF
     C     XMLKEY0010    READE     XMLRCVF                                33
     C                   DOW       *IN33 = *OFF
      *
     C                   SELECT
     C                   WHEN      XRNV = 'MessageSender'
     C     XMLKEY0012    SETLL     XMLRCAF
     C     XMLKEY0012    READE     XMLRCAF                                33
     C                   DOW       *IN33 = *OFF
     C                   IF        XRATN  = 'partyId'
     C                   EVAL      S0004  = XRATV
     C                   END
     C     XMLKEY0012    READE     XMLRCAF                                33
     C                   ENDDO
     C                   WHEN      XRNV = 'MessageRecipient'
     C     XMLKEY0012    SETLL     XMLRCAF
     C     XMLKEY0012    READE     XMLRCAF                                33
     C                   DOW       *IN33 = *OFF
     C                   IF        XRATN  = 'partyId'
     C                   EVAL      S0010  = XRATV
     C                   END
     C     XMLKEY0012    READE     XMLRCAF                                33
     C                   ENDDO
     C                   ENDSL
      *
     C     XMLKEY0010    READE     XMLRCVF                                33
     C                   ENDDO
      *
      * FINN ANTALL MELDINGER I FILEN
     C                   Z-ADD     1             X001_XRLEV1
     C                   MOVE      *BLANKS       X001_XRNV
     C     XMLRCVFK1     CHAIN     XMLRCVF                            33
     C                   DOW       *IN33 = *OFF
     C                   SELECT
     C                   WHEN      X001_XRNV = *BLANKS
     C                   EVAL      X001_XRNV = XRNV
     C                   EVAL      S0036 = 1
     C                   ADD       1             X001_XRLEV1
     C                   WHEN      X001_XRNV = XRNV
     C                   EVAL      S0036 = S0036 + 1
     C                   ADD       1             X001_XRLEV1
     C                   OTHER
     C                   LEAVE
     C                   ENDSL
     C     XMLRCVFK1     CHAIN     XMLRCVF                            33
     C                   ENDDO
      *
      * FINN MELDINGSTYPE
S03  C*                  IF        S0026 = 'XML-Transit'
S03  C*                  EVAL      UPROG = 'SYXML19C'                           TET-EKSPORT
S03  C*                  ELSE
N03  C                   SELECT
N03  C                   WHEN      S0026 = 'XML-Transit'
N03  C                   EVAL      UPROG = 'SYXML19C'                           TET-EKSPORT
N03  C                   WHEN      S0026 = 'XML-BondedCarg'
N03  C                   EVAL      UPROG = 'SYXML20C'                           SYSPED-OPPDRAG
N11  C                   WHEN      S0026 = 'XML-CustomsCle'
N11  C                             AND XCOLL = 'Booking'
N11  C                   EVAL      UPROG = 'SYXML28C'                           AIR & SEA OPPD
N03  C                   OTHER
     C     SSN           SETLL     XMLRCVF
     C     SSN           READE     XMLRCVF                                33
     C                   DOW       *IN33 = *OFF                                 1<-B
     C                   SELECT                                                  2<-B
     C                   WHEN      XRNV = 'CustomsClearance'
     C     XMLRCVFK2     CHAIN     XMLRCAF                            33
     C                   DOW       *IN33 = *OFF                                   3<-B
     C                   IF        XRATN = 'status'                                4<-B
     C                   SELECT                                                     5<-B
     C                   WHEN      XRATV = 'Import'
s01  C*                  EVAL      UTYPE = 'SAD-IMP'
N01  C                   EVAL      UPROG = 'SYXML15C'
     C                   LEAVE
     C                   WHEN      XRATV = 'Export'
s01  C*                  EVAL      UTYPE = 'SAD-EXP'
N01  C                   EVAL      UPROG = 'SYXML18C'
     C                   LEAVE
     C                   ENDSL                                                      5<-E
     C                   ENDIF                                                     4<-E
     C     XMLRCVFK2     READE     XMLRCAF                                33
     C                   ENDDO                                                    3<-E
     C                   ENDSL                                                   2<-E
     C     SSN           READE     XMLRCVF                                33
     C                   ENDDO                                                  1<-E
N02  C                   END
      *
     C                   IF        ((S0004 <> *BLANKS) OR (S0010 <> *BLANKS))
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           SDT
     C                   MOVE      WTM           STM
     C                   MOVE      ULIB          SLIB
     C                   MOVE      UFILE         SFILE
     C                   MOVE      UMBR          SMBR
     C                   MOVE      'R'           SSR
     C                   MOVE      'C'           SST
N18  C                   EVAL      SIFS=UIFS
     C                   WRITE     EDISR
     C                   END
      *
     C                   ENDSR
      *
N01
N01   ***********************************************
N01  C     SR001KOMP     BEGSR
N01   ***********************************************
N01   *
N01  C                   MOVEL     XRNV          IDOCNVN          50
N01  C                   EVAL      S0004 = 'KOMPSAP'                            Avsender
N01  C                   EVAL      S0010 = 'KOMPSYSP'                           Mottaker
N01  C                   EVAL      S0020  = IDOCNVN                             Interchg Ref
N01   * ER TYPE  ZSYSPED01 MOVEMENTTYPE KORR (= IKKE VAREINNGANG,MEN KORREKSJON/UTGANG)
N01  C     IDOCNVN       IFEQ      'ZSYSPED01'
N01  C                   Z-ADD     1             X001_XRLEV1
N01  C     XMLRCVFK1     SETGT     XMLRCVF
N01  C     XMLRCVFK1     READPE    XMLRCVF                                33
N01  C     XRVERD        IFEQ      'KORR'
N01  C                   EVAL      S0020  = 'ZSYSPED01_KORR'
N01  C                   END
N01  C                   END
N01   * Sett  UTYPE for rett behandl-prog
N01  C                   select
N01  C                   WHEN      S0020  = 'ZSYSPED01'                         Vareinngang
N01  C                   EVAL      UPROG = 'SYXML17AC'
N01  C                   WHEN      S0020  = 'ZDELVRY03'                         Vareutg. NO
N01  C                   EVAL      UPROG = 'SYXML17CC'
N01  C                   WHEN      S0020  = 'ZSHPMNT02'                         Vareutg Exp.
N01  C                   EVAL      UPROG = 'SYXML17DC'
N01  C                   WHEN      S0020  = 'ZSYSPED01_KORR'                    Korr(Uttak Komplett)
N01  C                   EVAL      UPROG = 'SYXML17EC'
N01  C                   WHEN      S0020  = 'ZSYSPED_MIRO01'                    EtterBer/Korr pris
N01  C                   EVAL      UPROG = 'SYXML17HC'
N01  C                   endsl
N01  C                   EVAL      S0026 = UPROG                                Appl.ref
N01   *
N01   * FINN ANTALL MELDINGER I FILEN
N01  C                   Z-ADD     1             X001_XRLEV1
N01  C                   MOVE      *BLANKS       X001_XRNV
N01  C     XMLRCVFK1     CHAIN     XMLRCVF                            33
N01  C                   DOW       *IN33 = *OFF
N01  C                   SELECT
N01  C                   WHEN      X001_XRNV = *BLANKS
N01  C                   EVAL      X001_XRNV = XRNV
N01  C                   EVAL      S0036 = 1
N01  C                   ADD       1             X001_XRLEV1
N01  C                   WHEN      X001_XRNV = XRNV
N01  C                   EVAL      S0036 = S0036 + 1
N01  C                   ADD       1             X001_XRLEV1
N01  C                   OTHER
N01  C                   LEAVE
N01  C                   ENDSL
N01  C     XMLRCVFK1     CHAIN     XMLRCVF                            33
N01  C                   ENDDO
N01   *
N01   * SKRIV TIL EDIS..
N01  C                   CALL      'SYGE15C'
N01  C                   PARM                    WDT               8
N01  C                   PARM                    WTM               6
N01  C                   MOVE      WDT           SDT
N01  C                   MOVE      WTM           STM
N01  C                   MOVE      ULIB          SLIB
N01  C                   MOVE      UFILE         SFILE
N01  C                   MOVE      UMBR          SMBR
N01  C                   MOVE      'R'           SSR
N01  C                   MOVE      'C'           SST
N18  C                   EVAL      SIFS=UIFS
N01  C                   WRITE     EDISR
N01   *
N01  C                   ENDSR
N01
N06   ***********************************************
N06  C     SR001BRING    BEGSR
N06   ***********************************************
N06   * Invoice lastet ned som XML fra MyBring kundesider
N06  C                   EVAL      S0004 = 'MYBRINGINV'                         Avsender
N06  C                   EVAL      S0010 = 'MYBRINGINV'                         Mottaker
N06  C                   EVAL      S0020 = 'SNR:'+%trim(%editc(XRSN:'3'))       Interchg Ref
N06  C                   Z-ADD     1             X001_XRLEV1
N06  C     XMLRCVFK1     setll     XMLRCVF
N06  C     XMLRCVFK1     reade     XMLRCVF                                33    'MetaData'
N06  C  N33XMLRCVFK1     reade     XMLRCVF                                33    'ReportName'
N06  C                   if        XRNV  <> 'ReportName'
N06  C                             and XRVERD <> 'Spesifisert faktura'
N06  c                   goto      UtMybring
N06  c                   endif
N06   * Bruk faktnr som interchgref
N06  c     *in33         doweq     '0'
N06  C                   if        XRNV   = 'InvoiceNumber'
N06  C                   EVAL      S0020  = XRVERD
N06  c                   leave
N06  c                   endif
N06  C     XMLRCVFK1     reade     XMLRCVF                                33
N06  C                   enddo
N06  C*
N06  C                   EVAL      UPROG = 'SYXML25C'
N06  C                   EVAL      S0026 = UPROG                                Appl.ref    omplett)
N06   *
N06   *
N06   * FINN ANTALL MELDINGER I FILEN
N06  C                   Z-ADD     1             X001_XRLEV1
N06  C                   MOVE      *BLANKS       X001_XRNV
N06  C     XMLRCVFK1     CHAIN     XMLRCVF                            33
N06  C                   DOW       *IN33 = *OFF
N06  C                   SELECT
N06  C                   WHEN      X001_XRNV = *BLANKS
N06  C                   EVAL      X001_XRNV = XRNV
N06  C                   EVAL      S0036 = 1
N06  C                   ADD       1             X001_XRLEV1
N06  C                   WHEN      X001_XRNV = XRNV
N06  C                   EVAL      S0036 = S0036 + 1
N06  C                   ADD       1             X001_XRLEV1
N06  C                   OTHER
N06  C                   LEAVE
N06  C                   ENDSL
N06  C     XMLRCVFK1     CHAIN     XMLRCVF                            33
N06  C                   ENDDO
N06   *
N06   * SKRIV TIL EDIS..
N06  C                   CALL      'SYGE15C'
N06  C                   PARM                    WDT               8
N06  C                   PARM                    WTM               6
N06  C                   MOVE      WDT           SDT
N06  C                   MOVE      WTM           STM
N06  C                   MOVE      ULIB          SLIB
N06  C                   MOVE      UFILE         SFILE
N06  C                   MOVE      UMBR          SMBR
N06  C                   MOVE      'R'           SSR
N06  C                   MOVE      'C'           SST
N18  C                   EVAL      SIFS=UIFS
N06  C                   WRITE     EDISR
N06   *
N06  C     UtMybring     ENDSR
N06
N04   ***********************************************
N04  C     SR001KINGS    BEGSR
N04   ***********************************************
N04   *
N04  C                   MOVEL     XRNV          IDOCNVN          50
N04  C                   EVAL      S0004 = 'KINGSLAND'                          Avsender
N04  C                   EVAL      S0010 = 'KINGSRODDK'                         Mottaker
N04  C                   EVAL      S0020  = IDOCNVN                             Interchg Ref
N04   * finne meldingstype 1. post på level 1
N04  C                   Z-ADD     1             X001_XRLEV1
N04  C     XMLRCVFK1     chain     XMLRCVF                            33
N04  C                   EVAL      S0020  = XRVERD
N04   * Sett  UTYPE for rett behandl-prog
N04  C                   select
N04  C                   WHEN      S0020  = 'Receipt'                           Vareinngang
N04  C                   EVAL      UPROG = 'SYXML23AC'
N04  C                   WHEN      S0020  = 'Shipment'                          Vareutg.
N04  C                   EVAL      UPROG = 'SYXML23BC'
N04  C                   endsl
N04  C                   EVAL      S0026 = UPROG                                Appl.ref
N04   *
N04   * FINN ANTALL MELDINGER I FILEN
N04  C                   Z-ADD     1             X001_XRLEV1
N04  C                   MOVE      *BLANKS       X001_XRNV
N04  C     XMLRCVFK1     CHAIN     XMLRCVF                            33
N04  C                   DOW       *IN33 = *OFF
N04  C                   SELECT
N04  C                   WHEN      X001_XRNV = *BLANKS
N04  C                   EVAL      X001_XRNV = XRNV
N04  C                   EVAL      S0036 = 1
N04  C                   ADD       1             X001_XRLEV1
N04  C                   WHEN      X001_XRNV = XRNV
N04  C                   EVAL      S0036 = S0036 + 1
N04  C                   ADD       1             X001_XRLEV1
N04  C                   OTHER
N04  C                   LEAVE
N04  C                   ENDSL
N04  C     XMLRCVFK1     CHAIN     XMLRCVF                            33
N04  C                   ENDDO
N04   *
N04   * SKRIV TIL EDIS..
N04  C                   CALL      'SYGE15C'
N04  C                   PARM                    WDT               8
N04  C                   PARM                    WTM               6
N04  C                   MOVE      WDT           SDT
N04  C                   MOVE      WTM           STM
N04  C                   MOVE      ULIB          SLIB
N04  C                   MOVE      UFILE         SFILE
N04  C                   MOVE      UMBR          SMBR
N04  C                   MOVE      'R'           SSR
N04  C                   MOVE      'C'           SST
N18  C                   EVAL      SIFS=UIFS
N04  C                   WRITE     EDISR
N04   *
N04  C                   ENDSR
N08   ***********************************************
N08  C     SR001E2B      BEGSR
N08   ***********************************************
N15   * Test om <From>NO991733043</From> (tollvesenet). Hvis ja, kaller SRTOLL
N15  C                   Z-ADD     1             X001_XRLEV1
N15  C     XMLRCVFK1     SETLL     XMLRCVF
N15  C     XMLRCVFK1     READE     XMLRCVF                                33
N15  C                   DOW       *IN33 = *OFF
N15  C                   IF        XRNV = 'From'
s16  C*    XRVERD        IFEQ      'NO991733043'                                DAGSOPPGJØR
s16  c*    XRVERD        oreq      'NO991733078'
s16  c*    XRVERD        oreq      'NO991733108'
s16  c*    XRVERD        oreq      'NO991733116'
s16  c*    XRVERD        oreq      'NO991733175'
N16  c                   movel     xrverd        xrverd8           8
N16  c     xrverd8       ifeq      'NO991733'
N19  c     xrverd8       oreq      'NO974761'
N15  C                   EXSR      SRTOLL
N15  C                   GOTO      UTE2B
N15  C                   END
N15  C                   LEAVE
N15  C                   END
N15  C     XMLRCVFK1     READE     XMLRCVF                                33
N15  C                   ENDDO
N15   *
N08   * XML på e2b-format (fra annen SYSPED-bruker??)
N08   * <Envelope>
N08   * <InterchangeId>F3496555</InterchangeId>
N08   * <From>RIKSGODS</From>
N08   * <To>22801700-E2B</To>
N08   * <Date>2015-06-25</Date>
N08   * <Time>09:47:21</Time>
N08   * <NumberOfMessages>1</NumberOfMessages>
N08   * </Envelope>
N08  C                   EVAL      S0004 = 'RIKSGODS'                           Avsender
N08  C                   EVAL      S0010 = '22801700-E2B'                       Mottaker
N08  C                   Z-ADD     1             X001_XRLEV1
N06  C*                  Z-ADD     1             X001_XRLEV1
N06  C     XMLRCVFK1     setll     XMLRCVF
N08  C  N33XMLRCVFK1     reade     XMLRCVF                                33
N08  c     *in33         doweq     '0'
N08  c                   select
N08  C                   when      XRNV   = 'InterchangeId'
N08  C                   EVAL      S0020  = XRVERD
N08  C                   when      XRNV   = 'From'
N08  C                   EVAL      S0004  = XRVERD
N08  C                   when      XRNV   = 'To'
N08  C                   EVAL      S0010  = XRVERD
N08  C                   when      XRNV   = 'NumberOfMessages'
N08  C                   EVAL      S0036  = %float(XRVERD)
N08  c                   leave
N08  c                   endsl
N08  C     XMLRCVFK1     reade     XMLRCVF                                33
N08  C                   enddo
N08  C*
N08  C                   EVAL      UPROG = 'SYXML25BC'
N08  C                   EVAL      S0026 = UPROG                                Appl.ref
N08   *
N08   * SKRIV TIL EDIS..
N08  C                   CALL      'SYGE15C'
N08  C                   PARM                    WDT               8
N08  C                   PARM                    WTM               6
N08  C                   MOVE      WDT           SDT
N08  C                   MOVE      WTM           STM
N08  C                   MOVE      ULIB          SLIB
N08  C                   MOVE      UFILE         SFILE
N08  C                   MOVE      UMBR          SMBR
N08  C                   MOVE      'R'           SSR
N08  C                   MOVE      'C'           SST
N18  C                   EVAL      SIFS=UIFS
N08  C                   WRITE     EDISR
N08   *
N08  C     UtE2B         ENDSR
N17   ***********************************************
N17  C     SR001EHF      BEGSR
N17   ***********************************************
N17  C                   Z-ADD     1             X001_XRLEV1
N17  C     XMLRCVFK1     SETLL     XMLRCVF
N17  C     XMLRCVFK1     READE     XMLRCVF                                33
N17  C                   DOW       *IN33 = *OFF
N17  C                   SELECT
N17  C                   WHEN      XRNV = 'cbc:ID' and XRPATH='/Invoice' or
N17  C                             XRNV = 'cbc:ID' and XRPATH='/inv:Invoice'
N24  C                             or XRNV = 'cbc:ID' and XRPATH='/ns4:Invoice'
N17JOC*                  EVAL      S0020 = XRVERD
N17JOC                   EVAL      S0020 = 'EHF'+XRVERD
N17  C                   WHEN      XRNV = 'cbc:CompanyID' and
N17  C                             XRPATH='/Invoice/cac:AccountingSupplierParty'
N17  C                             +'/cac:Party/cac:PartyLegalEntity ' or
N17  C                             XRNV = 'cbc:CompanyID' and
N17  C                             XRPATH='/inv:Invoice'
N17  C                             +'/cac:AccountingSupplierParty'
N17  C                             +'/cac:Party/cac:PartyLegalEntity '
N24  C                             or XRNV = 'cbc:CompanyID' and
N24  C                             XRPATH='/ns4:Invoice'
N24  C                             +'/cac:AccountingSupplierParty'
N24  C                             +'/cac:Party/cac:PartyLegalEntity '
N17  C                   EVAL      S0004 = XRVERD                               Avsender
N17  C                   IF        S0010 <> *BLANKS
N17  C                   LEAVE
N17  C                   END
N17  C                   WHEN      XRNV = 'cbc:CompanyID' and
N17  C                             XRPATH='/Invoice/cac:AccountingCustomerParty'
N17  C                             +'/cac:Party/cac:PartyLegalEntity' or
N17  C                             XRNV = 'cbc:CompanyID' and
N17  C                             XRPATH='/inv:Invoice'
N17  C                             +'/cac:AccountingCustomerParty'
N17  C                             +'/cac:Party/cac:PartyLegalEntity'
N24  C                             OR XRNV = 'cbc:CompanyID' and
N24  C                             XRPATH='/ns4:Invoice'
N24  C                             +'/cac:AccountingCustomerParty'
N24  C                             +'/cac:Party/cac:PartyLegalEntity'
N17  C                   EVAL      S0010 = XRVERD                               Mottaker
N17  C                   IF        S0004 <> *BLANKS
N17  C                   LEAVE
N17  C                   END
N17  C                   ENDSL
N17  C     SSN           READE     XMLRCVF                                33
N17  C                   ENDDO
N18  C     S0004         chain     EDII
N18  C                   if        not %found
N18  C                   eval      S0004 = 'EVRY'
N18  C                   endif
N18  C     S0010         chain     EDII
N18  C                   if        not %found
N18  C                   eval      S0010 = 'EVRY'
N18  C                   endif
N17   *
N17  C                   EVAL      S0036  = 1
N17   *
N17  C                   EVAL      UPROG = 'SYXML25E'
N17  C                   EVAL      S0026 = UPROG                                Appl.ref
N17   *
N17   * SKRIV TIL EDIS..
N17  C                   CALL      'SYGE15C'
N17  C                   PARM                    WDT               8
N17  C                   PARM                    WTM               6
N17  C                   MOVE      WDT           SDT
N17  C                   MOVE      WTM           STM
N17  C                   MOVE      ULIB          SLIB
N17  C                   MOVE      UFILE         SFILE
N17  C                   MOVE      UMBR          SMBR
N17  C                   MOVE      'R'           SSR
N17  C                   MOVE      'C'           SST
N18  C                   EVAL      SIFS=UIFS
N17  C                   WRITE     EDISR
N17   *
N17  C                   ENDSR
N17   *
      ***********************************************
     C     SREHFRES      BEGSR
N07   ***********************************************
N07   * EHF-FAKTURA KVITTERING
N07  C     SSN           SETLL     XMLRCVF
N07  C     SSN           READE     XMLRCVF                                33
N07  C                   DOW       *IN33 = *OFF
N07  C                   SELECT
N07  C                   WHEN      XRNV = 'cbc:ResponseCode'
N07  C                   EVAL      S0026  = XRVERD                              ACCEPT/REJECT
N07  C                   IF        S0020  <> *BLANKS
N07  C                   LEAVE
N07  C                   END
N07  C                   WHEN      XRNV = 'cbc:ReferenceID'
N07   *
N07  C     '-'           SCAN      XRVERD        XPOS              3 0    33
N07  C                   IF        *IN33
N07  C                   ADD       1             XPOS
S09  C*                  EVAL      S0004  = %SUBST(XRVERD:XPOS:9)               AVSENDER
N09  C                   EVAL      S0010  = %SUBST(XRVERD:XPOS:9)               AVSENDER
N07  C     '-'           SCAN      XRVERD:XPOS   XPOS              3 0    33
N07  C                   IF        *IN33
N07  C                   ADD       1             XPOS
S09  C*                  EVAL      S0010  = %SUBST(XRVERD:XPOS:9)               MOTTAKER
N09  C                   EVAL      S0004  = %SUBST(XRVERD:XPOS:9)               MOTTAKER
N07  C                   ELSE
S09  C*                  EVAL      S0004  = %SUBST(XRVERD:9:9)                  AVSENDER
S09  C*                  EVAL      S0010  = %SUBST(XRVERD:19:9)                 MOTTAKER
N09  C                   EVAL      S0010  = %SUBST(XRVERD:9:9)                  AVSENDER
N09  C                   EVAL      S0004  = %SUBST(XRVERD:19:9)                 MOTTAKER
N07  C                   END
N07  C                   ELSE
S09  C*                  EVAL      S0004  = %SUBST(XRVERD:9:9)                  AVSENDER
S09  C*                  EVAL      S0010  = %SUBST(XRVERD:19:9)                 MOTTAKER
N09  C                   EVAL      S0010  = %SUBST(XRVERD:9:9)                  AVSENDER
N09  C                   EVAL      S0004  = %SUBST(XRVERD:19:9)                 MOTTAKER
N07  C                   END
N20  C                   EVAL      S0010  = 'EHF'                               AVSENDER
N20  C                   EVAL      S0004  = 'EHF'                               MOTTAKER
N07   *
N07  C     '-'           SCAN      XRVERD        XPOS              3 0    33
N07  C   33              ADD       1             XPOS
N07  C   33'-'           SCAN      XRVERD:XPOS   XPOS                     33
N07  C   33              ADD       1             XPOS
N07  C   33'-'           SCAN      XRVERD:XPOS   XPOS                     33
N07  C  N33              Z-ADD     28            XPOS
N07  C                   EVAL      XN07 = 0
N07  C                   DO        7
N07  C                   ADD       1             XPOS
N07  C                   IF        %SUBST(XRVERD:XPOS:1) = '_'
N07  C                   LEAVE
N07  C                   END
N07  C                   EVAL      XAN01 = %SUBST(XRVERD:XPOS:1)
N07  C                   IF        XAN01 >= '0' AND XAN01 <= '9'
N07  C                   EVAL      XN07 = XN07 * 10
N07  C                   MOVE      XAN01         XN07
N07  C                   END
N07  C                   ENDDO
N07   *
N07  C                   MOVEL     XN07          S0020                          FAKTURANR
N07  C                   IF        S0026  <> *BLANKS
N07  C                   LEAVE
N07  C                   END
N07  C                   ENDSL
N07  C     SSN           READE     XMLRCVF                                33
N07  C                   ENDDO
N07   *
N07  C                   EVAL      UPROG = 'SYXML32C'
N07  C                   EVAL      S0026 = UPROG                                Appl.ref
N07  C                   EVAL      S0036 = 1
N07  C                   CALL      'SYGE15C'
N07  C                   PARM                    WDT               8
N07  C                   PARM                    WTM               6
N07  C                   MOVE      WDT           SDT
N07  C                   MOVE      WTM           STM
N07  C                   MOVE      ULIB          SLIB
N07  C                   MOVE      UFILE         SFILE
N07  C                   MOVE      UMBR          SMBR
N07  C                   MOVE      'R'           SSR
N07  C                   MOVE      'C'           SST
N18  C                   EVAL      SIFS=UIFS
N07  C                   WRITE     EDISR
N07   *
N07  C                   ENDSR
N07
N10   ***********************************************
N10  C     SR001TDS      BEGSR
N10   ***********************************************
N10  C                   MOVEL     XRNV          IDOCNVN          50
N10  C                   EVAL      S0004 = 'TULLTAXAN'                          Avsender
N10  C                   EVAL      S0010 = 'OMBUD'                              Mottaker
N10  C                   EVAL      S0020  = IDOCNVN                             Interchg Ref
N10   * finne meldingstype 1. post på level 1
N10  C                   Z-ADD     2             X001_XRLEV1
N10  C     XMLRCVFK1     chain     XMLRCVF                            33
N10  C                   Z-ADD     1             X001_XRLEV1
N10  C                   EVAL      S0020  = XRVERD
N10   * Sett  UTYPE for rett behandl-prog
N10  C                   select
010  C                   WHEN      XRVERD = 'AdditionalCodeObject'
N10  C                   EVAL      UPROG = 'SVT101R'
N10  C                   WHEN      XRVERD = 'CertificateObject'
N10  C                   EVAL      UPROG = 'SVT102R'
010  C                   WHEN      XRVERD = 'CodeListObject'
N10  C                   EVAL      UPROG = 'SVT103R'
N10  C                   WHEN      XRVERD = 'DeclarableGoodsNomenclatureObject'
N10  C                   EVAL      UPROG = 'SVT104R'
N10  C                   WHEN      XRVERD = 'DutyExpressionObject'
N10  C                   EVAL      UPROG = 'SVT105R'
N10  C                   WHEN      XRVERD = 'ExportRefundNomenclatureObject'
N10  C                   EVAL      UPROG = 'SVT106R'
N10  C                   WHEN      XRVERD = 'FootnoteObject'
N10  C                   EVAL      UPROG = 'SVT107R'
N10  C                   WHEN      XRVERD = 'GeographicalAreaObject'
N10  C                   EVAL      UPROG = 'SVT108R'
N10  C                   WHEN      XRVERD = 'GoodsNomenclatureObject'
N10  C                   EVAL      UPROG = 'SVT109R'
N10  C                   WHEN      XRVERD = 'GoodsNomenclatureGroupObject'
N10  C                   EVAL      UPROG = 'SVT110R'
N10  C                   WHEN      XRVERD = 'LookupTableObject'
N10  C                   EVAL      UPROG = 'SVT111R'
N10  C                   WHEN      XRVERD = 'MeasureObject'
N10  C                   EVAL      UPROG = 'SVT112R'
N10  C                   WHEN      XRVERD = 'MeasureActionObject'
N10  C                   EVAL      UPROG = 'SVT113R'
N10  C                   WHEN      XRVERD = 'MeasureConditionCodeObject'
N10  C                   EVAL      UPROG = 'SVT114R'
N10  C                   WHEN      XRVERD = 'MeasurementObject'
N10  C                   EVAL      UPROG = 'SVT115R'
N10  C                   WHEN      XRVERD = 'MeasurementUnitObject'
N10  C                   EVAL      UPROG = 'SVT116R'
N10  C                   WHEN      XRVERD = 'MeasurementUnitQualifierObject'
N10  C                   EVAL      UPROG = 'SVT117R'
N10  C                   WHEN      XRVERD = 'MeasureTypeObject'
N10  C                   EVAL      UPROG = 'SVT118R'
N10  C                   WHEN      XRVERD = 'MeursingAdditionalCodeObject'
N10  C                   EVAL      UPROG = 'SVT119R'
N10  C                   WHEN      XRVERD = 'MeursingHeaderObject'
N10  C                   EVAL      UPROG = 'SVT120R'
N10  C                   WHEN      XRVERD = 'MeursingSubheaderObject'
N10  C                   EVAL      UPROG = 'SVT121R'
N10  C                   WHEN      XRVERD = 'MeursingTablePlanObject'
N10  C                   EVAL      UPROG = 'SVT122R'
N10  C                   WHEN      XRVERD = 'MonetaryExchangePlanObject'
N10  C                   EVAL      UPROG = 'SVT123R'
N10  C                   WHEN      XRVERD = 'PreferenceCodeObject'
N10  C                   EVAL      UPROG = 'SVT124R'
N10  C                   WHEN      XRVERD = 'QuotaBalanceEventObject'
N10  C                   EVAL      UPROG = 'SVT125R'
N10  C                   WHEN      XRVERD = 'QuotaDefinitionObject'
N10  C                   EVAL      UPROG = 'SVT126R'
N10  C                   WHEN      XRVERD = 'QuotaEventObject'
N10  C                   EVAL      UPROG = 'SVT127R'
N10  C                   WHEN      XRVERD = 'QuotaOrderNumberObject'
N10  C                   EVAL      UPROG = 'SVT128R'
N10  C                   WHEN      XRVERD = 'RegulationObject'
N10  C                   EVAL      UPROG = 'SVT129R'
N10  C                   WHEN      XRVERD = 'ReliefCodeObject'
N10  C                   EVAL      UPROG = 'SVT130R'
N10  C                   WHEN      XRVERD = 'TaxcodeObject'
N10  C                   EVAL      UPROG = 'SVT131R'
N10  C                   endsl
N10  C                   EVAL      S0026 = UPROG                                Appl.ref
N10   *
N10   * FINN ANTALL MELDINGER I FILEN
N10  C                   Z-ADD     1             X001_XRLEV1
N10  C                   MOVE      *BLANKS       X001_XRNV
N10  C     XMLRCVFK1     CHAIN     XMLRCVF                            33
N10  C                   DOW       *IN33 = *OFF
N10  C                   SELECT
N10  C                   WHEN      X001_XRNV = *BLANKS
N10  C                   EVAL      X001_XRNV = XRNV
N10  C                   EVAL      S0036 = 1
N10  C                   ADD       1             X001_XRLEV1
N10  C                   WHEN      X001_XRNV = XRNV
N10  C                   EVAL      S0036 = S0036 + 1
N10  C                   ADD       1             X001_XRLEV1
N10  C                   OTHER
N10  C                   LEAVE
N10  C                   ENDSL
N10  C     XMLRCVFK1     CHAIN     XMLRCVF                            33
N10  C                   ENDDO
N10   *
N10   * SKRIV TIL EDIS..
N10  C                   CALL      'SYGE15C'
N10  C                   PARM                    WDT               8
N10  C                   PARM                    WTM               6
N10  C                   MOVE      WDT           SDT
N10  C                   MOVE      WTM           STM
N10  C                   MOVE      ULIB          SLIB
N10  C                   MOVE      UFILE         SFILE
N10  C                   MOVE      UMBR          SMBR
N10  C                   MOVE      'R'           SSR
N10  C                   MOVE      'C'           SST
N18  C                   EVAL      SIFS=UIFS
N10  C                   WRITE     EDISR
N10
N10  C                   ENDSR
N12   ***********************************************
N12  C     SRBC3248_1    BEGSR
N12   ***********************************************
N12   *
N12  C                   MOVEL     XRNV          IDOCNVN          50
N12  C                   EVAL      S0004 = 'C-3248_OTHER'                       Avsender
N12  C                   EVAL      S0010 = 'C-3248_OWN'                         Mottaker
N12  C                   EVAL      UPROG = 'SYXML41C'                           KONV. KUNDE
N12  C                   EVAL      S0026 = UPROG                                Appl.ref
N12   *
N12   * FINN ANTALL MELDINGER I FILEN
N12  C                   EVAL      S0036 = 0
N12  C                   Z-ADD     1             XRLEV1
N12  C                   Z-ADD     0             XRLEV2
N12  C     XMLKEY0012    CHAIN     XMLRCVF                            33
N12  C                   DOW       *IN33 = *OFF
N12  C                   IF        XRNV = 'ns2:CustomerParty'
N12  C                   EVAL      S0036 = S0036 + 1
N12  C                   END
N12  C                   ADD       1             XRLEV1
N12  C     XMLKEY0012    CHAIN     XMLRCVF                            33
N12  C                   ENDDO
N12   *
N12   * SKRIV TIL EDIS..
N12  C                   CALL      'SYGE15C'
N12  C                   PARM                    WDT               8
N12  C                   PARM                    WTM               6
N12  C                   MOVE      WDT           SDT
N12  C                   MOVE      WTM           STM
N12  C                   MOVE      ULIB          SLIB
N12  C                   MOVE      UFILE         SFILE
N12  C                   MOVE      UMBR          SMBR
N12  C                   EVAL      S0020  = SMBR                                Interchg Ref
N12  C                   MOVE      'R'           SSR
N12  C                   MOVE      'C'           SST
N18  C                   EVAL      SIFS=UIFS
N12  C                   WRITE     EDISR
N12   *
N12  C                   ENDSR
N12   ***********************************************
N12  C     SRBC3248_2    BEGSR
N12   ***********************************************
N12   *
N12  C                   MOVEL     XRNV          IDOCNVN          50
N12  C                   EVAL      S0004 = 'C-3248_OTHER'                       Avsender
N12  C                   EVAL      S0010 = 'C-3248_OWN'                         Mottaker
N12  C                   EVAL      UPROG = 'SYXML43C'                           KONV. STATUS
N12  C                   EVAL      S0026 = UPROG                                Appl.ref
N12   *
N12   * FINN ANTALL MELDINGER I FILEN
N12  C                   EVAL      S0036 = 0
N12  C                   Z-ADD     1             XRLEV1
N12  C                   Z-ADD     0             XRLEV2
N12  C     XMLKEY0012    CHAIN     XMLRCVF                            33
N12  C                   DOW       *IN33 = *OFF
N12  C                   IF        XRNV = 'ns1:OrderSource'
N12  C                   EVAL      S0036 = S0036 + 1
N12  C                   END
N12  C                   ADD       1             XRLEV1
N12  C     XMLKEY0012    CHAIN     XMLRCVF                            33
N12  C                   ENDDO
N12   *
N12   * SKRIV TIL EDIS..
N12  C                   CALL      'SYGE15C'
N12  C                   PARM                    WDT               8
N12  C                   PARM                    WTM               6
N12  C                   MOVE      WDT           SDT
N12  C                   MOVE      WTM           STM
N12  C                   MOVE      ULIB          SLIB
N12  C                   MOVE      UFILE         SFILE
N12  C                   MOVE      UMBR          SMBR
N12  C                   EVAL      S0020  = SMBR                                Interchg Ref
N12  C                   MOVE      'R'           SSR
N12  C                   MOVE      'C'           SST
N18  C                   EVAL      SIFS=UIFS
N12  C                   WRITE     EDISR
N12   *
N12  C                   ENDSR
N13   ***********************************************
N13  C     SRBAC         BEGSR
N13   ***********************************************
N13   *  ACTUAL COST
N13   *
N13  C                   MOVEL     XRNV          IDOCNVN          50
N13  C                   EVAL      S0004 = 'BRINGAC'                            CUSTOMER PARTY
N13  C                   EVAL      S0010 = 'BRINGPRO'                           C-3248 PROJECT
N13  C                   EVAL      UPROG = 'SYXMLACC'                           KONV. KUNDE
N13  C                   EVAL      S0026 = UPROG                                Appl.ref
N13   *
N13   * FINN ANTALL MELDINGER I FILEN
N13  C                   EVAL      S0036 = 0
N13  C                   Z-ADD     1             XRLEV1
N13  C                   Z-ADD     0             XRLEV2
N13  C     XMLKEY0012    CHAIN     XMLRCVF                            33
N13  C                   DOW       *IN33 = *OFF
N13  C                   IF        XRNV = 'ECOSupplierInvoice'
N13  C*                            OR XRNV = 'ns3:PersonCustomer'
N13  C                   EVAL      S0036 = S0036 + 1
N13  C                   END
N13  C                   ADD       1             XRLEV1
N13  C     XMLKEY0012    CHAIN     XMLRCVF                            33
N13  C                   ENDDO
N13   *
N13   * SKRIV TIL EDIS..
N13  C                   CALL      'SYGE15C'
N13  C                   PARM                    WDT               8
N13  C                   PARM                    WTM               6
N13  C                   MOVE      WDT           SDT
N13  C                   MOVE      WTM           STM
N13  C                   MOVE      ULIB          SLIB
N13  C                   MOVE      UFILE         SFILE
N13  C                   MOVE      UMBR          SMBR
N13  C                   EVAL      S0020  = SMBR                                Interchg Ref
N13  C                   MOVE      'R'           SSR
N13  C                   MOVE      'C'           SST
N13  C                   WRITE     EDISR
N13   *
N13  C                   ENDSR
N13   ***********************************************
N13  C     SRLEVE        BEGSR
N13   ***********************************************
N13   *  Oppdateringer leverandørfil
N13   *
N13  C                   MOVEL     XRNV          IDOCNVN          50
N13  C                   EVAL      S0004 = 'BRINGSI'                            CUSTOMER PARTY
N13  C                   EVAL      S0010 = 'BRINGPRO'                           C-3248 PROJECT
N13  C                   EVAL      UPROG = 'SYXMLSI'                            KONV. LEVERANDØR
N13  C                   EVAL      S0026 = UPROG                                Appl.ref
N13   *
N13   * FINN ANTALL MELDINGER I FILEN
N13  C                   EVAL      S0036 = 0
N13  C                   Z-ADD     1             XRLEV1
N13  C                   Z-ADD     0             XRLEV2
N13  C     XMLKEY0012    CHAIN     XMLRCVF                            33
N13  C                   DOW       *IN33 = *OFF
N13  C*                  IF        XRNV = 'TMSSupplierInformation'
N13  C                   IF        XRNV = 'ns1:TMSSupplierInformation'
N13  C                   EVAL      S0036 = S0036 + 1
N13  C                   END
N13  C                   ADD       1             XRLEV1
N13  C     XMLKEY0012    CHAIN     XMLRCVF                            33
N13  C                   ENDDO
N13   * levnbr
N13  C                   Z-ADD     3             XRLEV1
N13  C                   Z-ADD     1             XRLEV2
N13  C     XMLKEY0012    CHAIN     XMLRCVF                            33
N13  C  N33              movel     xrverd        s0020
N13   *
N13   * levnavn
N13  C                   Z-ADD     3             XRLEV1
N13  C                   Z-ADD     2             XRLEV2
N13  C     XMLKEY0012    CHAIN     XMLRCVF                            33
N13  C  N33s0020         cat       xrverd:1      s0020
N13   *
N13   * SKRIV TIL EDIS..
N13  C                   CALL      'SYGE15C'
N13  C                   PARM                    WDT               8
N13  C                   PARM                    WTM               6
N13  C                   MOVE      WDT           SDT
N13  C                   MOVE      WTM           STM
N13  C                   MOVE      ULIB          SLIB
N13  C                   MOVE      UFILE         SFILE
N13  C                   MOVE      UMBR          SMBR
N13  C*                  EVAL      S0020  = SMBR                                Interchg Ref
N13  C                   MOVE      'R'           SSR
N13  C                   MOVE      'C'           SST
N13  C                   WRITE     EDISR
N13   *
N13  C                   ENDSR
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    USN               9
     C                   PARM                    ULIB             10
     C                   PARM                    UFILE            10
     C                   PARM                    UMBR             10
s01  C*                  PARM                    UTYPE            10
N01  C                   PARM                    UPROG            10
N13  C                   PARM                    UIFS            256
      *
     C     XMLRCVFK      KLIST
     C                   KFLD                    SSN
     C                   KFLD                    X000_XRLEV1
     C     XMLRCVFK1     KLIST
     C                   KFLD                    SSN
     C                   KFLD                    X001_XRLEV1
N13  C     XMLRCVFK1E    KLIST
N13  C                   KFLD                    SSN
     C     XMLRCVFK2     KLIST
     C                   KFLD                    SSN
     C                   KFLD                    XRLEV1
     C                   KFLD                    XRLEV2
     C                   KFLD                    XRLEV3
     C     XMLKEY0010    KLIST
     C                   KFLD                    SSN
     C                   KFLD                    X0010_XRLEV1
     C     XMLKEY0012    KLIST
     C                   KFLD                    SSN
     C                   KFLD                    XRLEV1
     C                   KFLD                    XRLEV2
      *
     C     *LIKE         DEFINE    XRLEV1        X000_XRLEV1
     C     *LIKE         DEFINE    XRLEV1        X001_XRLEV1
     C     *LIKE         DEFINE    XRNV          X001_XRNV
     C     *LIKE         DEFINE    XRLEV1        X0010_XRLEV1
      *
     C                   MOVE      USN           SSN
s01  C*                  EVAL      UTYPE = 'INHOUSE'
S05  C*                  EVAL      UPROG = 'SYXML13C'
N05  C                   EVAL      UPROG = *BLANKS
N07  C                   MOVE      *BLANKS       XAN01             1
N07  C                   MOVE      *ZEROS        XN07              7 0
N11  C                   MOVE      *BLANKS       XCOLL            20
      *
     C                   ENDSR
N13
N13   ***********************************************
N13  C     SRTOLL        BEGSR
N13   ***********************************************
N13   *
N13  c                   EVAL      S0004='ALTINN'
N13  C                   Z-ADD     1             X001_XRLEV1
N13  C                   setoff                                       33
N13  C     XMLRCVFK1     SETLL     XMLRCVF
N13  C     *in33         doweq     '0'
s14  C*                  READ      XMLRCVF                                33
n14  C     ssn           READE     XMLRCVF                                33
N13  C     *in33         ifeq      '0'
N13  C                   select
N13  C                   WHEN      XRNV   = 'InterchangeId'                     Vareinngang
N13  c                   EVAL      S0020=xrverd
N13  C                   WHEN      XRNV   = 'To'                                Vareinngang
N13  c                   EVAL      S0010=xrverd
N13  C                   WHEN      XRNV   = 'Name'                              Vareinngang
N14  C                   movel     xrverd        xrverd5           5
s14  C*                  if        XRVERD='Skatt Øst'
n14  C                   if        XRVERD5='Skatt'
N13  c                   EVAL      UPROG='SYXMLDAOP'
n13  c                   END
n13  C                   WHEN      XRNV = 'InvoiceNumber'
N13  c                   eval      s0026=XRVERD
N13  C                   endsl
N13  C                   ENDIF
N13  C                   ENDDO
N13   *
N13   * UPROG funnet
N13   *
N13  C     uprog         ifne      *blanks
N13  C                   CALL      'SYGE15C'
N13  C                   PARM                    WDT               8
N13  C                   PARM                    WTM               6
N13  C                   MOVE      WDT           SDT
N13  C                   MOVE      WTM           STM
N13  C                   MOVE      ULIB          SLIB
N13  C                   MOVE      UFILE         SFILE
N13  C                   MOVE      UMBR          SMBR
N13  C                   MOVE      'R'           SSR
N13  C                   MOVE      'C'           SST
N13  C                   EVAL      SIFS=UIFS
N13  C                   WRITE     EDISR
N13  C                   end
N13   *
N13  C                   ENDSR
N13
      *
N21   ***********************************************
N21  C     SRCWDHL       BEGSR
N21   ***********************************************
N21  C                   Z-ADD     1             X0010_XRLEV1
N21  C     XMLKEY0010    SETLL     XMLRCVF
N21  C     XMLKEY0010    READE     XMLRCVF                                33
N21  C                   DOW       *IN33 = *OFF
N21
N21  C                   SELECT
N21  C                   WHEN      XRNV = 'SenderID'
N21  C                   EVAL      S0004  = XRVERD
N21  C                   WHEN      XRNV = 'ReceiverID'
N21  C                   EVAL      S0010  = XRVERD
N21  C                   WHEN      XRNV = 'MessageId'
N21  C                   EVAL      S0026  = 'XML-' + XRVERD
N21  C                   LEAVE
N21  C                   ENDSL
N21
N21  C     XMLKEY0010    READE     XMLRCVF                                33
N21  C                   ENDDO
N21
N21  C                   Z-ADD     2             X0010_XRLEV1
N21  C     XMLKEY0010    SETLL     XMLRCVF
N21  C     XMLKEY0010    READE     XMLRCVF                                33
N21  C                   DOW       *IN33 = *OFF
N21
N21  C                   SELECT
N21  C                   WHEN      XRNV = 'ShipmentFileNumber'
N21  C                   EVAL      S0020  = XRVERD
N21  C                   GOTO      STSRDHL
N21  C                   ENDSL
N21
N21  C     XMLKEY0010    READE     XMLRCVF                                33
N21  C                   ENDDO
N21
N21  C                   Z-ADD     3             X0010_XRLEV1

N21  C     XMLKEY0010    SETLL     XMLRCVF
N21  C     XMLKEY0010    READE     XMLRCVF                                33
N21  C                   DOW       *IN33 = *OFF
N21
N21  C                   SELECT
N21  C                   WHEN      XRNV = 'ShipmentId'
N21  C                   EVAL      S0020  = XRVERD
N21  C                   GOTO      STSRDHL
N21  C                   ENDSL
N21
N21  C     XMLKEY0010    READE     XMLRCVF                                33
N21  C                   ENDDO
N21
N21  C     STSRDHL       TAG
N21
N21   * FINN ANTALL MELDINGER I FILEN
N21  C                   EVAL      S0036 = 0
N21  C     SSN           SETLL     XMLRCVF
N21  C     SSN           READE     XMLRCVF                                33
N21  C                   DOW       *IN33 = *OFF
N21  C                   IF        XRNV = 'Housebill'
N21  C                   EVAL      S0036 = S0036 + 1
N21  C                   END
N21  C     SSN           READE     XMLRCVF                                33

N21  C                   ENDDO
N21
N21  C                   CALL      'SYGE15C'
N21  C                   PARM                    WDT               8
N21  C                   PARM                    WTM               6
N21  C                   MOVE      WDT           SDT
N21  C                   MOVE      WTM           STM
N21  C                   MOVE      ULIB          SLIB
N21  C                   MOVE      UFILE         SFILE
N21  C                   MOVE      UMBR          SMBR
N21  C                   MOVE      'R'           SSR
N21  C                   MOVE      'C'           SST
N21  C                   WRITE     EDISR
N21
N21  C                   EVAL      UPROG = 'SYXML44C'
N21
N21  C                   ENDSR
N22   ***********************************************
N22  C     SRCW1SYS      BEGSR
N22   ***********************************************
N22  C                   Z-ADD     1             X0010_XRLEV1
N22  C                   MOVE      *BLANKS       X_MOTT_OK         1
N22  C     XMLKEY0010    SETLL     XMLRCVF
N22  C     XMLKEY0010    READE     XMLRCVF                                33
N22  C                   DOW       *IN33 = *OFF
N22
N22  C                   SELECT
N22  C                   WHEN      XRNV = 'DataProvider'
N22  C                   EVAL      S0004  = XRVERD
N22  C                   IF        S0010 <> *BLANKS AND S0026 <> *BLANKS
N22  C                   LEAVE
N22  C                   END
N22  C*                  WHEN      XRNV = 'ReceiverID'
N22  C                   WHEN      XRNV = 'Company'
N22  C                   EVAL      X_MOTT_OK = 'J'
N22  C                   WHEN      XRNV = 'Code' AND X_MOTT_OK = 'J'
N22  C                   EVAL      S0010  = XRVERD
N22  C                   EVAL      X_MOTT_OK = 'X'
N22  C                   IF        S0004 <> *BLANKS AND S0026 <> *BLANKS
N22  C                   LEAVE
N22  C                   END
N22  C                   WHEN      XRNV = 'Key'
N22  C                   EVAL      S0026  = 'CW1-' + XRVERD
N22  C                   EVAL      S0020  = XRVERD
N22  C                   IF        S0004 <> *BLANKS AND S0010 <> *BLANKS
N22  C                   LEAVE
N22  C                   END
N22  C                   ENDSL
N22
N22  C     XMLKEY0010    READE     XMLRCVF                                33
N22  C                   ENDDO
N22
N22  C                   EVAL      S0036 = 1
N22
N22  C                   CALL      'SYGE15C'
N22  C                   PARM                    WDT               8
N22  C                   PARM                    WTM               6
N22  C                   MOVE      WDT           SDT
N22  C                   MOVE      WTM           STM
N22  C                   MOVE      ULIB          SLIB
N22  C                   MOVE      UFILE         SFILE
N22  C                   MOVE      UMBR          SMBR
N22  C                   MOVE      'R'           SSR
N22  C                   MOVE      'C'           SST
N22  C                   WRITE     EDISR
N22
N22   * Finn import eller eksport
N22  C                   MOVE      *BLANKS       CW1_TYPE          3
N22  C     XMLKEY0010    SETLL     XMLRCVF
N22  C     XMLKEY0010    READE     XMLRCVF                                33
N22  C                   DOW       *IN33 = *OFF
N22  C                   SELECT
N22  C                   WHEN      XRNV = 'MessageType'
N22  C                   EVAL      CW1_TYPE = 'OK'
N22  C                   WHEN      XRNV = 'Code' AND CW1_TYPE = 'OK'
N22  C                   EVAL      CW1_TYPE = XRVERD
N22  C                   LEAVE
N22  C                   ENDSL
N22  C     XMLKEY0010    READE     XMLRCVF                                33
N22  C                   ENDDO
N22
N22  C                   SELECT
N22  C                   WHEN      CW1_TYPE = 'IMP'
N22  C                   EVAL      UPROG = 'SYXML51CI'
N22  C                   WHEN      CW1_TYPE = 'EXP'
N22  C                   EVAL      UPROG = 'SYXML51CE'
N22  C                   ENDSL
N22
N22  C                   ENDSR
N23   ***********************************************
N23  C     SRDACSYS      BEGSR
N23   ***********************************************
N23  C                   Z-ADD     1             X0010_XRLEV1
N23  C     XMLKEY0010    SETLL     XMLRCVF
N23  C     XMLKEY0010    READE     XMLRCVF                                33
N23  C                   DOW       *IN33 = *OFF
N23
N23  C                   SELECT
N23  C*                  WHEN      XRNV = 'SenderID'
N23  C*                  EVAL      S0004  = XRVERD
N23  C*                  WHEN      XRNV = 'ReceiverID'
N23  C*                  EVAL      S0010  = XRVERD
N23  C                   WHEN      XRNV = 'ShipmentNo'
N23  C                   EVAL      S0026  = 'XML-' + XRVERD
N23  C                   LEAVE
N23  C                   ENDSL
N23  C                   EVAL      S0004  = 'DADE0101'
N23  C                   EVAL      S0010  = 'DADK0101'
N23
N23  C     XMLKEY0010    READE     XMLRCVF                                33
N23  C                   ENDDO
N23
N23  C                   Z-ADD     2             X0010_XRLEV1
N23  C     XMLKEY0010    SETLL     XMLRCVF
N23  C     XMLKEY0010    READE     XMLRCVF                                33
N23  C                   DOW       *IN33 = *OFF
N23
N23  C                   SELECT
N23  C                   WHEN      XRNV = 'ShipmentNo'
N23  C                   EVAL      S0020  = XRVERD
N23  C                   GOTO      STSRDAC
N23  C                   ENDSL
N23
N23  C     XMLKEY0010    READE     XMLRCVF                                33
N23  C                   ENDDO
N23
N23  C                   Z-ADD     3             X0010_XRLEV1
N23
N23  C     XMLKEY0010    SETLL     XMLRCVF
N23  C     XMLKEY0010    READE     XMLRCVF                                33
N23  C                   DOW       *IN33 = *OFF
N23
N23  C                   SELECT
N23  C                   WHEN      XRNV = 'ShipmentNo'
N23  C                   EVAL      S0020  = XRVERD
N23  C                   GOTO      STSRDAC
N23  C                   ENDSL
N23
N23  C     XMLKEY0010    READE     XMLRCVF                                33
N23  C                   ENDDO
N23
N23  C     STSRDAC       TAG
N23
N23   * FINN ANTALL MELDINGER I FILEN
N23  C*                  EVAL      S0036 = 0
N23  C*    SSN           SETLL     XMLRCVF
N23  C*    SSN           READE     XMLRCVF                                33
N23  C*                  DOW       *IN33 = *OFF
N23  C*                  IF        XRNV = 'Housebill'
N23  C*                  EVAL      S0036 = S0036 + 1
N23  C*                  END
N23  C*    SSN           READE     XMLRCVF                                33
N23
N23  C*                  ENDDO
N23  C                   EVAL      S0036 = 1
N23
N23  C                   CALL      'SYGE15C'
N23  C                   PARM                    WDT               8
N23  C                   PARM                    WTM               6
N23  C                   MOVE      WDT           SDT
N23  C                   MOVE      WTM           STM
N23  C                   MOVE      ULIB          SLIB
N23  C                   MOVE      UFILE         SFILE
N23  C                   MOVE      UMBR          SMBR
N23  C                   MOVE      'R'           SSR
N23  C                   MOVE      'C'           SST
N23  C                   WRITE     EDISR
N23
N23  C                   EVAL      UPROG = 'SYXML64C'
N23
N23  C                   ENDSR
N25   ***********************************************
N25  C     SRNCTS_5      BEGSR
N25   ***********************************************
N25  C                   IF        %SUBST(XRNV:1:10) = 'ns2:CC917C' OR
N25  C                             %SUBST(XRNV:1:10) = 'ns2:CD917C' OR
N25  C                             %SUBST(XRNV:1:6) = 'CC917C' OR
N25  C                             %SUBST(XRNV:1:6) = 'CD917C'
N25  C                   MOVE      'J'           X_CC917C          1
N25  C                   ELSE
N25  C                   MOVE      'N'           X_CC917C
N25  C                   END
N25   *
N25  C                   Z-ADD     1             X0010_XRLEV1
N25  C     XMLKEY0010    SETLL     XMLRCVF
N25  C     SSN           READE     XMLRCVF                                33
N25  C                   DOW       *IN33 = *OFF
N25
N25  C                   SELECT
N25  C                   WHEN      XRNV = 'messageSender'
N25  C                   EVAL      S0004  = XRVERD
N25  C                   WHEN      XRNV = 'messageRecipient'
N25  C                   EVAL      S0010  = XRVERD
N25  C                   WHEN      XRNV = 'messageIdentification'
N25  C                   EVAL      S0020  = XRVERD
N25  C                   WHEN      XRNV = 'messageType'
N25  C                   IF        X_CC917C = 'J'
N25  C                   EVAL      S0026  = 'XML-CC917C'
N25  C                   ELSE
N25  C                   EVAL      S0026  = 'XML-' + XRVERD
N25  C                   END
N25  C                   LEAVE
N25  C                   ENDSL
N25
N25  C     SSN           READE     XMLRCVF                                33
N25  C                   ENDDO
N25  C                   EVAL      S0036 = 1
N25
N25  C                   CALL      'SYGE15C'
N25  C                   PARM                    WDT               8
N25  C                   PARM                    WTM               6
N25  C                   MOVE      WDT           SDT
N25  C                   MOVE      WTM           STM
N25  C                   MOVE      ULIB          SLIB
N25  C                   MOVE      UFILE         SFILE
N25  C                   MOVE      UMBR          SMBR
N25  C                   MOVE      'R'           SSR
N25  C                   MOVE      'C'           SST
N25  C                   WRITE     EDISR
N25
N25  C                   SELECT
N25  C                   WHEN      S0026 = 'XML-CC004C' OR S0026 = 'XML-CC028C'
N25  C                   EVAL      UPROG = 'NCTS104C1'
N25  C                   WHEN      S0026 = 'XML-CC009C'
N25  C                   EVAL      UPROG = 'NCTS104C2'
N25  C                   WHEN      S0026 = 'XML-CC019C'
N25  C                   EVAL      UPROG = 'NCTS104CD'
N25  C                   WHEN      S0026 = 'XML-CC029C'
N25  C                   EVAL      UPROG = 'NCTS104C3'
N25  C                   WHEN      S0026 = 'XML-CC035C'
N25  C                   EVAL      UPROG = 'NCTS104CF'
N25  C                   WHEN      S0026 = 'XML-CC045C'
N25  C                   EVAL      UPROG = 'NCTS104C4'
N25  C                   WHEN      S0026 = 'XML-CC051C'
N25  C                   EVAL      UPROG = 'NCTS104C5'
N25  C                   WHEN      S0026 = 'XML-CC055C'
N25  C                   EVAL      UPROG = 'NCTS104C6'
N25  C                   WHEN      S0026 = 'XML-CC056C'
N25  C                   EVAL      UPROG = 'NCTS104C7'
N25  C                   WHEN      S0026 = 'XML-CC060C'
N25  C                   EVAL      UPROG = 'NCTS104C8'
N25  C                   WHEN      S0026 = 'XML-CC140C'
N25  C                   EVAL      UPROG = 'NCTS104CE'
N25  C                   WHEN      S0026 = 'XML-CC182C'
N25  C                   EVAL      UPROG = 'NCTS104CB'
N25  C                   WHEN      S0026 = 'XML-CC928C'
N25  C                   EVAL      UPROG = 'NCTS104C9'
N25  C                   WHEN      S0026 = 'XML-CC917C' OR S0026 = 'XML-CD917C'
N25  C                   EVAL      UPROG = 'NCTS104CA'
N25  C                   WHEN      S0026 = 'XML-CC906C' OR S0026 = 'XML-CD906C'
N25  C                   EVAL      UPROG = 'NCTS104CC'
N25  C                   WHEN      S0026 = 'XML-CC057C'
N25  C                   EVAL      UPROG = 'NCTS154C3'
N25  C                   WHEN      S0026 = 'XML-CC043C'
N25  C                   EVAL      UPROG = 'NCTS154C1'
N25  C                   WHEN      S0026 = 'XML-CC025C'
N25  C                   EVAL      UPROG = 'NCTS154C2'
N25  C                   ENDSL
N25
N25  C                   ENDSR
N26   ***********************************************
N26  C     SR001CUS      BEGSR
N26   ***********************************************
N26   * CUSTOMITE
N26  C                   MOVEL     XRNV          IDOCNVN          50
N26  C                   EVAL      S0004 = 'CUSTOMITE'
N26  C                   EVAL      S0010 = 'NO146201'
N26   * unique_order_number
N26  C                   EVAL      X001_XRLEV1 = 2
N26  C     XMLRCVFK1     CHAIN     XMLRCVF                            33
N26  C     *IN33         IFEQ      '0'
N26  C                   EVAL      UPROG = 'SYXMLCUS'
N26  C                   EVAL      S0020 = XRVERD
N26  C                   EVAL      S0036 = 1
N26  C                   EVAL      S0026  = IDOCNVN
N26  C                   EVAL      S0026  = XRVERD
N26   * SKRIV TIL EDIS..
N26  C                   CALL      'SYGE15C'
N26  C                   PARM                    WDT               8
N26  C                   PARM                    WTM               6
N26  C                   MOVE      WDT           SDT
N26  C                   MOVE      WTM           STM
N26  C                   MOVE      ULIB          SLIB
N26  C                   MOVE      UFILE         SFILE
N26  C                   MOVE      UMBR          SMBR
N26  C                   MOVE      'R'           SSR
N26  C                   MOVE      'C'           SST
N18  C                   EVAL      SIFS=UIFS
N26  C                   WRITE     EDISR
N26  C                   END
N26   *
N26  C                   ENDSR
N26   ***********************************************
N26  C     SR001HPI      BEGSR
N26   ***********************************************
N26   * CUSTOMITE
N26  C                   MOVEL     XRNV          IDOCNVN          50
N26  C                   EVAL      S0004 = 'HPI'
N26  C                   EVAL      S0010 = 'NO146201'
N26   * unique_order_number
N26  C                   EVAL      X001_XRLEV1 = 1
N26  C     XMLRCVFK1     CHAIN     XMLRCVF                            33
N26  C     *IN33         IFEQ      '0'
N26  C                   EVAL      UPROG = 'SYXMLHPI'
N26  C                   EVAL      S0020 = XRVERD
N26  C                   EVAL      S0036 = 1
N26  C                   EVAL      S0026  = IDOCNVN
N26   * SKRIV TIL EDIS..
N26  C                   CALL      'SYGE15C'
N26  C                   PARM                    WDT               8
N26  C                   PARM                    WTM               6
N26  C                   MOVE      WDT           SDT
N26  C                   MOVE      WTM           STM
N26  C                   MOVE      ULIB          SLIB
N26  C                   MOVE      UFILE         SFILE
N26  C                   MOVE      UMBR          SMBR
N26  C                   MOVE      'R'           SSR
N26  C                   MOVE      'C'           SST
N18  C                   EVAL      SIFS=UIFS
N26  C                   WRITE     EDISR
N26  C                   END
N26   *
N26  C                   ENDSR
