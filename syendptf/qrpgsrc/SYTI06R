     H DFTACTGRP(*NO)
      *
      ***********************************************************
      *** PROGRAM SKAL KONVERTER R≈VARETOLLSATS FRA TVINN     ***
      ***********************************************************
      *
     FXMLRCVF   IF   E           K DISK
     FSADSD     IF A E           K DISK
     FKODTS8    IF A E           K DISK
      *
     D                sds
     D ZUSER                 254    263
      *  Prototype for syti06r
     d syti06r         pr
     d usn_                                like(usn)
      *  *ENTRY Interface for Main Procedure
     d syti06r         pi
     d usn                            9
      *  Prototype for 'SYGE15C'
     d syge15c         pr                  extpgm('SYGE15C')
     d wdt_                                like(wdt)
     d wtm_                                like(wtm)
      *----------------------------------------------------------------------
      * Stand Alone Fields - TOP
      *----------------------------------------------------------------------
     d wdt             s              8
     d wtm             s              6
     d xan08           s              8A
     d xlandgr         s              5A
     d x1_xrlev1       s                   like(xrlev1)
     d x1_xrlev2       s                   like(xrlev2)
     d x2_xrlev1       s                   like(xrlev1)
     d x2_xrlev2       s                   like(xrlev2)
     d x2_xrlev3       s                   like(xrlev3)
     d x3_xrlev1       s                   like(xrlev1)
     d x3_xrlev2       s                   like(xrlev2)
     d x3_xrlev3       s                   like(xrlev3)
     d x3_xrlev4       s                   like(xrlev4)
     d x4_xrlev1       s                   like(xrlev1)
     d x4_xrlev2       s                   like(xrlev2)
     d x4_xrlev3       s                   like(xrlev3)
     d x4_xrlev4       s                   like(xrlev4)
     d x4_xrlev5       s                   like(xrlev5)
     d x5_xrlev1       s                   like(xrlev1)
     d x5_xrlev2       s                   like(xrlev2)
     d x5_xrlev3       s                   like(xrlev3)
     d x5_xrlev4       s                   like(xrlev4)
     d x5_xrlev5       s                   like(xrlev5)
     d x5_xrlev6       s                   like(xrlev6)
     d x6_xrlev1       s                   like(xrlev1)
     d x6_xrlev2       s                   like(xrlev2)
     d x6_xrlev3       s                   like(xrlev3)
     d x6_xrlev4       s                   like(xrlev4)
     d x6_xrlev5       s                   like(xrlev5)
     d x6_xrlev6       s                   like(xrlev6)
     d x6_xrlev7       s                   like(xrlev7)
     d x_sdtnrf        s                   like(sdtnrf)
     d x_sdkda∆        s                   like(sdkda∆)
     d x_sdkds∆        s                   like(sdkds∆)
     d x_sddtf         s                   like(sddtf)
     d x_sddtt         s                   like(sddtt)
     d x_sdbls∆        s                   like(sdbls∆)
     d x_ks8ftx        s                   like(ks8ftx)
     d x_ks8ftx1       s                   like(ks8ftx)
     d x_ks8sty        s                   like(ks8sty)
     D UP              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZ∆ÿ≈')
     D LO              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzÊ¯Â')

      *----------------------------------------------------------------------
      /free

       exsr init;

       exsr srxml1;

       *inlr = *on;
       return;

       //**********************************************                ------
       begsr srxml1;
       //**********************************************

         X1_XRLEV1 = 1;
         X1_XRLEV2 = 0;

         chain (xrsn:x1_xrlev1:x1_xrlev2) xmlrcvf;
         dow %found;
           select;
           when xrnv = 'versjon';
           when xrnv = 'vare';
             exsr srxml2;
           endsl;
           x1_xrlev1 = x1_xrlev1 + 1;
           chain (xrsn:x1_xrlev1:x1_xrlev2) xmlrcvf;
         enddo;

         endsr;

       //**********************************************
       begsr srxml2;
       //**********************************************

         x2_xrlev1 = xrlev1;
         x2_xrlev2 = 1;
         x2_xrlev3 = 0;

         chain (xrsn:x2_xrlev1:x2_xrlev2:x2_xrlev3) xmlrcvf;
         dow %found;
           select;
           when xrnv = 'id';
             x_sdtnrf = %float(xrverd);
           when xrnv = 'enhet';
             select;
             when xrverd = 'Kg';
               x_ks8sty = 'K';
             endsl;
           when xrnv = 'enhetbeskrivelse';
           when xrnv = 'avtalesatser';
         //  exsr srxml3;
           endsl;
           x2_xrlev2 = x2_xrlev2 + 1;
           chain (xrsn:x2_xrlev1:x2_xrlev2:x2_xrlev3) xmlrcvf;
         enddo;

         exsr opdavg;

       endsr;

       //**********************************************
       begsr srxml3;
       //**********************************************

         x3_xrlev1 = xrlev1;
         x3_xrlev2 = xrlev2;
         x3_xrlev3 = 1;
         x3_xrlev4 = 0;

         chain (xrsn:x3_xrlev1:x3_xrlev2:x3_xrlev3:x3_xrlev4) xmlrcvf;
         dow %found;
           select;
           when xrnv = 'avgiftsats';
             exsr srxml4;
           endsl;
           x3_xrlev2 = x3_xrlev2 + 1;
           chain (xrsn:x3_xrlev1:x3_xrlev2:x3_xrlev3:x3_xrlev4) xmlrcvf;
         enddo;

       endsr;

       //**********************************************
       begsr srxml4;
       //**********************************************

         x4_xrlev1 = xrlev1;
         x4_xrlev2 = xrlev2;
         x4_xrlev3 = xrlev3;
         x4_xrlev4 = 1;
         x4_xrlev5 = 0;

         chain (xrsn:x4_xrlev1:x4_xrlev2:x4_xrlev3:x4_xrlev4:x4_xrlev5) xmlrcvf;
         dow %found;
           select;
           when xrnv = 'avtale';
             exsr srxml5;
           endsl;
           x4_xrlev4 = x4_xrlev4 + 1;
           chain (xrsn:x4_xrlev1:x4_xrlev2:x4_xrlev3:x4_xrlev4:x4_xrlev5)
                 xmlrcvf;
         enddo;

       endsr;

       //**********************************************
       begsr srxml5;
       //**********************************************

         x5_xrlev1 = xrlev1;
         x5_xrlev2 = xrlev2;
         x5_xrlev3 = xrlev3;
         x5_xrlev4 = xrlev4;
         x5_xrlev5 = 1;
         x5_xrlev6 = 0;

         chain (xrsn:x5_xrlev1:x5_xrlev2:x5_xrlev3:x5_xrlev4:x5_xrlev5
               :x5_xrlev6) xmlrcvf;
         dow %found;
           select;
           when xrnv = 'sats';
             exsr srxml6;
           endsl;
           x5_xrlev5 = x5_xrlev5 + 1;
           chain (xrsn:x5_xrlev1:x5_xrlev2:x5_xrlev3:x5_xrlev4:x5_xrlev5
                 :x5_xrlev6) xmlrcvf;
         enddo;

       endsr;

       //**********************************************
       begsr srxml6;
       //**********************************************

         x6_xrlev1 = xrlev1;
         x6_xrlev2 = xrlev2;
         x6_xrlev3 = xrlev3;
         x6_xrlev4 = xrlev4;
         x6_xrlev5 = xrlev5;
         x6_xrlev6 = 1;
         x6_xrlev7 = 0;

         chain (xrsn:x6_xrlev1:x6_xrlev2:x6_xrlev3:x6_xrlev4:x6_xrlev5
               :x6_xrlev6:x6_xrlev7) xmlrcvf;
         dow %found;
           select;
           when xrnv = 'satsVerdi';
           when xrnv = 'satsEnhet';
             x_ks8sty = xrverd;
           when xrnv = 'satsEnhetBeskrivelse';
           when xrnv = 'fomdato';
             xan08    = %subst(xrverd:1:4) + %subst(xrverd:6:2)
                      + %subst(xrverd:9:2);
             x_sddtf  = %dec(xan08:8:0);
           when xrnv = 'tomdato';
             if xrverd = *blanks;
               x_sddtt  = 99991231;
             else;
               xan08    = %subst(xrverd:1:4) + %subst(xrverd:6:2)
                        + %subst(xrverd:9:2);
               x_sddtt  = %dec(xan08:8:0);
             endif;
           endsl;
           x6_xrlev6 = x6_xrlev6 + 1;
           chain (xrsn:x6_xrlev1:x6_xrlev2:x6_xrlev3:x6_xrlev4:x6_xrlev5
                 :x6_xrlev6:x6_xrlev7) xmlrcvf;
         enddo;

         exsr opdavg;

       endsr;

       //**********************************************
       begsr opdavg;
       //**********************************************

         chain ('RT': '   ') kodts8;
         if not %found;
           ks8ftx = 'RÂvaretoll';
           ks8sat = 99999,99;
           ks8sty = x_ks8sty;
           ks8avg = 'RT';
           ks8skv = *blanks;
           ks8sta = ' ';
           write kos8r;
         endif;

         chain ('RT': '100') kodts8;
         if not %found;
           ks8ftx = 'RÂvaretoll';
           ks8sat = 99999,99;
           ks8sty = x_ks8sty;
           ks8avg = 'RT';
           ks8skv = '100';
           ks8sta = ' ';
           write kos8r;
         endif;

         chain (x_sdtnrf: 'RT': '100') sadsd;
         if not %found;
           sdaktk = 'A';
           sdtnrf = x_sdtnrf;
           sdkda∆ = 'RT';
           sdkds∆ = '100';
           sdbls∆ = 99999,99;
           sddtf  = %dec(wdt:8:0);
           sddtt  = 99991231;
           write sadsdr;
         endif;

       endsr;

       //**********************************************
       begsr init;
       //**********************************************

         xrsn = %dec(usn:9:0);
         syge15c ( wdt : wtm );

       endsr;

      /end-free
