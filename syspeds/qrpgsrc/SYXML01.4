      *
      ***********************************************************
      *** PROGRAM SKAL SENDE XML-FAKTURA                      ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01-26                            ***
      *** LEDIGE INDIKATORER 27-32 34-49 51-99                ***
      ***********************************************************
     FFIRM      IF   E           K DISK
     FXMLUFL1   UF   E           K DISK
     FECMSG     IF   E           K DISK    USROPN
     FKODWL01   IF   E           K DISK    USROPN
     FKODTA     IF   E           K DISK    USROPN
     FKODTGE    IF   E           K DISK    USROPN
     FKODTG2    IF   E           K DISK    USROPN
     FKODTSF    IF   E           K DISK    USROPN
     FKODTFR    IF   E           K DISK    USROPN
     FCUNDL01   IF   E           K DISK    USROPN
     FFAIN      IF   E           K DISK    USROPN
     FHEADF     IF   E           K DISK    USROPN
     FFAK8      IF   E           K DISK    USROPN
     FFRISOK    IF   E           K DISK    USROPN
     FKODFRI    IF   E           K DISK    USROPN
     FFREETXT2  IF   E           K DISK
     FEDIC      UF A E             DISK    USROPN
     FEDIS      O  A E             DISK    USROPN
     FEDIM      O  A E             DISK    USROPN
     FEDISE     O  A E             DISK    USROPN
     D TXT             S             80    DIM(202) CTDATA PERRCD(1)
     D TXT01           S             80    DIM(3) CTDATA PERRCD(1)
     D                 DS
     D  ØN152                  1     15  2
     D  ØA152H                 1     13
     D  ØA152X                 5     13
     D  ØA152D                14     15
     D                 DS
     D  ØA12                   1     12
     D  Ø12                    1     12
     D                                     DIM(12)                              Num edit
     D                 DS
     D  XMBR                   1     10
     D  XMBRA                  1      1
     D  XMBRB                  2      8S 0
     D                 DS
     D  WDT                    1      8
     D  WDTÅ                   1      4
     D  WDTM                   5      6
     D  WDTD                   7      8
     D                 DS
     D  WTM                    1      6
     D  WTMH                   1      2
     D  WTMM                   3      4
     D  WTMS                   5      6
     D                 DS
     D  HEAVD                  1      4  0
     D  XXSTREKK1              5      5
     D  HEOPD                  6     10  0
     D  XXSTREKK2             11     11
     D  HESG                  12     14
     D  SYSPEDREF              1     14
     D                 DS
     D  HEDTOP                 1      8  0
     D  HEDTOPÅ                1      4
     D  HEDTOPM                5      6
     D  HEDTOPD                7      8
     D                 DS
     D  FADATO                 1      8  0
     D  FADATOÅ                1      4
     D  FADATOM                5      6
     D  FADATOD                7      8
     D                 DS
     D  FADAFF                 1      8  0
     D  FADAFFÅ                1      4
     D  FADAFFM                5      6
     D  FADAFFD                7      8
     D                 DS
     D  SYKT8                  1      8
     D  SYFR02                 1      1
     D  SYKT7                  2      7
     D  SYKONT                 2      8  0
     D                 DS
     D  XMLT1                  1     44  2 DIM(11)
     D  XFMS01                 1      4  2
     D  XFMS02                 5      8  2
     D  XFMS03                 9     12  2
     D  XFMS04                13     16  2
     D  XFMS05                17     20  2
     D  XFMS06                21     24  2
     D  XFMS07                25     28  2
     D  XFMS08                29     32  2
     D  XFMS09                33     36  2
     D  XFMS10                37     40  2
     D  XFMS11                41     44  2
     D                 DS
     D  XMLT2                  1     33    DIM(11)
     D  XFMV01                 1      3
     D  XFMV02                 4      6
     D  XFMV03                 7      9
     D  XFMV04                10     12
     D  XFMV05                13     15
     D  XFMV06                16     18
     D  XFMV07                19     21
     D  XFMV08                22     24
     D  XFMV09                25     27
     D  XFMV10                28     30
     D  XFMV11                31     33
     D                 DS
     D  XMLT3                  1    143  2 DIM(11)
     D  XFMGN1                 1     13  2
     D  XFMGN2                14     26  2
     D  XFMGN3                27     39  2
     D  XFMGN4                40     52  2
     D  XFMGN5                53     65  2
     D  XFMGN6                66     78  2
     D  XFMGN7                79     91  2
     D  XFMGN8                92    104  2
     D  XFMGN9               105    117  2
     D  XFMGNA               118    130  2
     D  XFMGNB               131    143  2
     D                 DS
     D  XMLT4                  1    143  2 DIM(11)
     D  XFMGV1                 1     13  2
     D  XFMGV2                14     26  2
     D  XFMGV3                27     39  2
     D  XFMGV4                40     52  2
     D  XFMGV5                53     65  2
     D  XFMGV6                66     78  2
     D  XFMGV7                79     91  2
     D  XFMGV8                92    104  2
     D  XFMGV9               105    117  2
     D  XFMGVA               118    130  2
     D  XFMGVB               131    143  2
     D                 DS
     D  FSDOKK                 1     10
     D  DFS                    1     10    DIM(10)
      *
     C                   EXSR      INIT
      *
     C     START         TAG
     C     XMLUFL1K      SETLL     XMLUFL1
     C     XMLUFL1K      READE     XMLUFL1                                50
     C   50              GOTO      SLUTT
      *
     C                   EXSR      SRINIT
      *
     C                   EXSR      SRSTART
     C                   DOW       *IN50 = *OFF
     C                   EXSR      SREMSG
     C     XMLUFL1K      READE     XMLUFL1                                50
     C  N50              IF        XFKN <> XXKN
     C                   UPDATE    XMLUFFR
     C                   LEAVE
     C                   END
     C  N50              ENDDO
     C                   EXSR      SRSLUTT
     C  N50              EXSR      SRCLOSE
     C  N50              GOTO      START
      *
     C     SLUTT         TAG
     C                   MOVE      *ON           *INLR
     C                   RETURN
      *
      ***********************************************
     C     SRINIT        BEGSR
      ***********************************************
     C                   OPEN      ECMSG
     C                   OPEN      KODWL01
     C                   OPEN      KODTA
     C                   OPEN      KODTGE
     C                   OPEN      KODTG2
     C                   OPEN      KODTSF
     C                   OPEN      KODTFR
     C                   OPEN      CUNDL01
     C                   OPEN      FAIN
     C                   OPEN      HEADF
     C                   OPEN      FAK8
     C                   OPEN      FRISOK
     C                   OPEN      KODFRI
     C                   OPEN      EDIC
     C                   OPEN      EDIS
     C                   OPEN      EDIM
     C                   OPEN      EDISE
      *
     C     ECMSGK        CHAIN     ECMSG                              33
     C     1             CHAIN     EDIC                               33
     C                   ADD       1             CSN
     C                   UPDATE    EDICR
      *
     C                   MOVE      XFKN          XXKN              8 0
     C                   MOVE      *BLANKS       XXA80            80
     C                   MOVE      *ZEROS        XNPOS             3 0
     C                   MOVE      *BLANKS       XMBR
     C                   MOVE      'F'           XMBRA
     C                   MOVE      CSN           XMBRB
     C                   MOVE      XMBR          SEMBR
     C                   MOVE      *BLANKS       SDATA
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT
     C                   PARM                    WTM
      *
     C                   EVAL      S0004 = ECIIDI
     C                   EVAL      S0010 = ECIIDC
     C                   EVAL      S0020 = SEMBR
     C                   EVAL      S0036 = 0
     C                   EVAL      SSN   = CSN
     C                   EVAL      SSR   = 'S'
     C                   EVAL      SST   = 'X'
     C                   MOVE      WDT           SDT
     C                   MOVE      WTM           STM
     C                   EVAL      SLIB  = '*LIBL'
     C                   EVAL      SFILE = 'EDISE'
     C                   EVAL      SMBR  = SEMBR
     C                   EVAL      SMBRS  = 0
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRSTART       BEGSR
      ***********************************************
     C                   EVAL      SDATA = TXT(001)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(002)
     C                   CAT       TXT01(1):0    SDATA
     C*                  CAT       TXT01(2):0    SDATA
     C*                  CAT       TXT01(3):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT01(2)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT01(3)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(004)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(005)
     C                   WRITE     EDISER
      * Orginator
     C                   EVAL      SDATA = TXT(006)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(008)
     C                   CAT       S0004:0       SDATA
     C                   CAT       TXT(009):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(010)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(013)
     C                   CAT       'OrgNr-Avd':0 SDATA
     C                   CAT       TXT(014):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(007)
     C                   WRITE     EDISER
      * Recipient (alltid Posten)
     C                   EVAL      SDATA = TXT(015)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(008)
     C                   CAT       '976117840':0 SDATA
     C                   CAT       TXT(009):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(011)
     C                   CAT       'eFaktura':0  SDATA
     C                   CAT       TXT(012):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(013)
     C                   CAT       'OrgNr-Avd':0 SDATA
     C                   CAT       TXT(014):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(016)
     C                   WRITE     EDISER
      * InterchangeID
     C                   EVAL      SDATA = TXT(017)
     C                   CAT       SEMBR:0       SDATA
     C                   CAT       TXT(018):0    SDATA
     C                   WRITE     EDISER
      * InterchangeTime
     C                   EVAL      SDATA = TXT(019)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(021)
     C                   CAT       'year="':1    SDATA
     C                   CAT       WDTÅ:0        SDATA
     C                   CAT       '" month="':0 SDATA
     C                   CAT       WDTM:0        SDATA
     C                   CAT       '" day="':0   SDATA
     C                   CAT       WDTD:0        SDATA
     C                   CAT       '">':0        SDATA
     C                   CAT       WDTÅ:0        SDATA
     C                   CAT       '-':0         SDATA
     C                   CAT       WDTM:0        SDATA
     C                   CAT       '-':0         SDATA
     C                   CAT       WDTD:0        SDATA
     C                   CAT       TXT(022):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(023)
     C                   CAT       'hour="':1    SDATA
     C                   CAT       WTMH:0        SDATA
     C                   CAT       '" minute="':0SDATA
     C                   CAT       WTMM:0        SDATA
     C                   CAT       '" second="':0SDATA
     C                   CAT       WTMS:0        SDATA
     C                   CAT       '" fraction':0SDATA
     C                   CAT       '="050">':0   SDATA
     C                   CAT       WTMH:0        SDATA
     C                   CAT       ':':0         SDATA
     C                   CAT       WTMM:0        SDATA
     C                   CAT       ':':0         SDATA
     C                   CAT       WTMS:0        SDATA
     C                   CAT       TXT(024):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(020)
     C                   WRITE     EDISER
      *
     C                   ENDSR
      *
      ***********************************************
     C     SREMSG        BEGSR
      ***********************************************
     C                   MOVE      XFFN          FIFN
     C     FIFN          SETLL     FAIN
     C     FIFN          READE     FAIN                                   33
      * eMessage start
     C                   EVAL      SDATA = TXT(025)
     C                   WRITE     EDISER
      * MessageType
     C                   EVAL      SDATA = TXT(027)
     C                   CAT       'Invoice':0   SDATA
     C                   CAT       TXT(028):0    SDATA
     C                   WRITE     EDISER
      * MessageVersion
     C                   EVAL      SDATA = TXT(029)
     C                   CAT       'PS-14':0     SDATA
     C                   CAT       TXT(030):0    SDATA
     C                   WRITE     EDISER
      * DokumentType
     C                   EVAL      SDATA = TXT(031)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(033)
     C                   IF        XFFK = 'F'
     C                   CAT       '380':0       SDATA
     C                   ELSE
     C                   CAT       '381':0       SDATA
     C                   END
     C                   CAT       TXT(034):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(035)
     C                   IF        XFFK = 'F'
     C                   CAT       'FAKTURA':0   SDATA
     C                   ELSE
     C                   CAT       'KREDITNOTA':0SDATA
     C                   END
     C                   CAT       TXT(036):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(032)
     C                   WRITE     EDISER
      * MessageReferance
     C                   EXSR      OPDEDIM
      *
     C                   EVAL      SDATA = TXT(037)
     C                   MOVE      MMN           XXA07             7
     C                   CAT       XXA07:0       SDATA
     C                   CAT       TXT(38):0     SDATA
     C                   WRITE     EDISER
      * MessageOriginator
     C                   EVAL      SDATA = TXT(039)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(008)
     C     KODTAK        CHAIN     KODTA                              33
     C                   MOVE      KOAKNR        KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            33
     C                   CAT       SYRG:0        SDATA
     C                   CAT       TXT(009):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(010)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(013)
     C                   CAT       'OrgNr-Avd':0 SDATA
     C                   CAT       TXT(014):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(040)
     C                   WRITE     EDISER
      * MessageRecipient
     C                   EVAL      SDATA = TXT(041)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(008)
     C                   MOVE      FAKUNR        KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            33
     C                   CAT       SYRG:0        SDATA
     C                   CAT       TXT(009):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(010)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(013)
     C                   CAT       'OrgNr-Avd':0 SDATA
     C                   CAT       TXT(014):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(042)
     C                   WRITE     EDISER
      * MessageContant start
     C                   EVAL      SDATA = TXT(043)
     C                   WRITE     EDISER
      *
     C                   EXSR      SREINV
      * MessageContant slutt
     C                   EVAL      SDATA = TXT(044)
     C                   WRITE     EDISER
      * eMessage slutt
     C                   EVAL      SDATA = TXT(026)
     C                   WRITE     EDISER
      * Oppdater XMLUFF
     C*                  MOVE      'C'           XFST
     C                   MOVE      WDT           XFDTS
     C                   MOVE      WTM           XFTDS
     C                   UPDATE    XMLUFFR
      *
     C                   ENDSR
      *
      ***********************************************
     C     SREINV        BEGSR
      ***********************************************
     C     STSREINV      TAG
     C     HEADFK        CHAIN     HEADF                              33
     C     FAK8K         SETLL     FAK8
     C     FAK8K         READE     FAK8                                   33
     C  N33              DOW       FAOPKO = 'D'
     C     FAK8K         READE     FAK8                                   33
     C  N33              ENDDO
     C                   IF        *IN33
     C     FIFN          READE     FAIN                                   33
     C   33              GOTO      SLSREINV
     C                   GOTO      STSREINV
     C                   END
     C                   IF        FAVAL = *BLANKS
     C                   EVAL      FAVAL = FICURR
     C                   END
      * Invoice start
     C                   EVAL      SDATA = TXT(045)
     C                   WRITE     EDISER
      * InvoiceDates
     C                   EVAL      SDATA = TXT(047)
     C                   WRITE     EDISER
      *
     C                   EVAL      SDATA = TXT(049)
     C                   CAT       'year="':1    SDATA
     C                   CAT       FADATOÅ:0     SDATA
     C                   CAT       '" month="':0 SDATA
     C                   CAT       FADATOM:0     SDATA
     C                   CAT       '" day="':0   SDATA
     C                   CAT       FADATOD:0     SDATA
     C                   CAT       '">':0        SDATA
     C                   CAT       FADATOÅ:0     SDATA
     C                   CAT       '-':0         SDATA
     C                   CAT       FADATOM:0     SDATA
     C                   CAT       '-':0         SDATA
     C                   CAT       FADATOD:0     SDATA
     C                   CAT       TXT(050):0    SDATA
     C                   WRITE     EDISER
      *
     C                   EVAL      SDATA = TXT(051)
     C                   CAT       'year="':1    SDATA
     C                   CAT       FADAFFÅ:0     SDATA
     C                   CAT       '" month="':0 SDATA
     C                   CAT       FADAFFM:0     SDATA
     C                   CAT       '" day="':0   SDATA
     C                   CAT       FADAFFD:0     SDATA
     C                   CAT       '">':0        SDATA
     C                   CAT       FADAFFÅ:0     SDATA
     C                   CAT       '-':0         SDATA
     C                   CAT       FADAFFM:0     SDATA
     C                   CAT       '-':0         SDATA
     C                   CAT       FADAFFD:0     SDATA
     C                   CAT       TXT(052):0    SDATA
     C                   WRITE     EDISER
      *
     C                   EVAL      SDATA = TXT(048)
     C                   WRITE     EDISER
      * InvoiceReferance start
     C                   EVAL      SDATA = TXT(053)
     C                   WRITE     EDISER
      *
     C                   EVAL      SDATA = TXT(055)
     C                   MOVE      FIFN          XXA06             6
     C                   CAT       XXA06:0       SDATA
     C                   CAT       TXT(056):0    SDATA
     C                   WRITE     EDISER
      * DispatchAdviceNo
     C                   IF        HEGM1 <> *BLANKS
     C                   EVAL      SDATA = TXT(201)
     C                   CAT       HEGM1:0       SDATA
     C                   CAT       ',':0         SDATA
     C                   CAT       HEGM2:0       SDATA
     C                   CAT       TXT(202):0    SDATA
     C                   WRITE     EDISER
     C                   END
      * OtherReferance start
     C                   IF        XFSAML = 'N'
     C                   EVAL      SDATA = TXT(183)
     C                   WRITE     EDISER
      * Turnr
     C                   IF        HEPRO <> 0
     C                   EVAL      SDATA = TXT(185)
     C                   CAT       'type="Turn':1SDATA
     C                   CAT       'r">':0       SDATA
     C                   MOVE      HEPRO         XAN08             8
     C                   CAT       XAN08:0       SDATA
     C                   CAT       TXT(186):0    SDATA
     C                   WRITE     EDISER
     C                   END
      * Rundturnr
     C                   IF        TRRUND <> 0
     C                   EVAL      SDATA = TXT(185)
     C                   CAT       'type="Rund':1SDATA
     C                   CAT       'turnr">':0   SDATA
     C                   MOVE      TRRUND        XAN08             8
     C                   CAT       XAN08:0       SDATA
     C                   CAT       TXT(186):0    SDATA
     C                   WRITE     EDISER
     C                   END
      * Laste/lossested
     C                   IF        HESDL <> *BLANKS
     C                   EVAL      SDATA = TXT(185)
     C                   CAT       'type="Last':1SDATA
     C                   CAT       '/lossested':0SDATA
     C                   CAT       '">':0        SDATA
     C                   CAT       HESDL:0       SDATA
     C                   CAT       TXT(186):0    SDATA
     C                   WRITE     EDISER
     C                   END
      * Andre referanser
     C     HEADFK        SETLL     FRISOK
     C                   MOVE      *OFF          *IN33
     C                   DOW       *IN33 = *OFF
     C                   IF        FSSOK <> *BLANKS
     C                   SORTA     DFS
     C                   MOVE      '0'           *IN34
     C     DFS(10)       IFNE      ' '
     C     FASK          LOOKUP    DFS                                    34
     C                   IF        *IN34
     C     FSKODE        CHAIN     KODFRI                             34
     C                   EVAL      SDATA = TXT(185)
     C                   CAT       'type="':1    SDATA
     C                   CAT       KFSOTX:0      SDATA
     C                   CAT       '">':0        SDATA
     C                   CAT       FSSOK:0       SDATA
     C                   CAT       TXT(186):0    SDATA
     C                   WRITE     EDISER
     C                   END
     C                   END
     C                   END
     C     HEADFK        READE     FRISOK                                 33
     C  N33              ENDDO
      * Vekt
     C                   EVAL      SDATA = TXT(185)
     C                   CAT       'type="Weig':1SDATA
     C                   CAT       'ht">':0      SDATA
     C                   Z-ADD     HEVKT         ØN152
     C                   MOVE      'N'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(186):0    SDATA
     C                   WRITE     EDISER
      * Kubikk
     C                   IF        HEM3 <> 0
     C                   EVAL      SDATA = TXT(185)
     C                   CAT       'type="Cubi':1SDATA
     C                   CAT       'c">':0       SDATA
     C                   Z-ADD(H)  HEM3          ØN152
     C                   MOVE      'N'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(186):0    SDATA
     C                   WRITE     EDISER
     C                   END
      * Lastemeter
     C                   IF        HEM3 <> 0
     C                   EVAL      SDATA = TXT(185)
     C                   CAT       'type="Load':1SDATA
     C                   CAT       'ingmeter">':0SDATA
     C                   Z-ADD(H)  HELM          ØN152
     C                   MOVE      'N'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(186):0    SDATA
     C                   WRITE     EDISER
     C                   END
      * Beskrivelse
     C                   IF        HEM3 <> 0
     C                   EVAL      SDATA = TXT(185)
     C                   CAT       'type="Good':1SDATA
     C                   CAT       'sDesc">':0   SDATA
     C                   CAT       HEVS1:0       SDATA
     C                   IF        HEVS2 <> *BLANKS
     C                   CAT       ',':0         SDATA
     C                   CAT       HEVS2:0       SDATA
     C                   END
     C                   CAT       TXT(186):0    SDATA
     C                   WRITE     EDISER
     C                   END
      * OtherReferance slutt
     C                   EVAL      SDATA = TXT(184)
     C                   WRITE     EDISER
     C                   END
      * InvoiceReferance slutt
     C                   EVAL      SDATA = TXT(054)
     C                   WRITE     EDISER
      *
     C                   IF        XFFK = 'K'
     C                   GOTO      STPARTIES
     C                   END
      * PaymentInfo start
     C                   EVAL      SDATA = TXT(057)
     C                   WRITE     EDISER
      *
     C                   EVAL      SDATA = TXT(059)
     C                   CAT       XFBB:0        SDATA
     C                   CAT       TXT(060):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(061)
     C                   CAT       XFBBT:0       SDATA
     C                   CAT       TXT(062):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(063)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(065)
     C                   CAT       XFKT:0        SDATA
     C                   CAT       TXT(066):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(064)
     C                   WRITE     EDISER
      * PaymentDueDate
     C                   EVAL      SDATA = TXT(67)
     C                   CAT       'year="':1    SDATA
     C                   CAT       FADAFFÅ:0     SDATA
     C                   CAT       '" month="':0 SDATA
     C                   CAT       FADAFFM:0     SDATA
     C                   CAT       '" day="':0   SDATA
     C                   CAT       FADAFFD:0     SDATA
     C                   CAT       '">':0        SDATA
     C                   CAT       FADAFFÅ:0     SDATA
     C                   CAT       '-':0         SDATA
     C                   CAT       FADAFFM:0     SDATA
     C                   CAT       '-':0         SDATA
     C                   CAT       FADAFFD:0     SDATA
     C                   CAT       TXT(068):0    SDATA
     C                   WRITE     EDISER
      * PaymentAmount
     C                   EVAL      SDATA = TXT(069)
     C                   CAT       'currencyId':1SDATA
     C                   CAT       '="':0        SDATA
     C                   CAT       XFVAL:0       SDATA
     C                   CAT       '">':0        SDATA
     C                   Z-ADD     XFTOT         ØN152
     C                   MOVE      'J'           XBELØP            1
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(070):0    SDATA
     C                   WRITE     EDISER
      * Kid
     C                   EVAL      SDATA = TXT(071)
     C                   CAT       XFKID:0       SDATA
     C                   CAT       TXT(072):0    SDATA
     C                   WRITE     EDISER
      * CheckDigit
     C*                  Z-ADD     21            XN
     C*                  EVAL      SDATA = XFKID
     C*                  DOW       XN > 1
     C*                  IF        A80(XN) <> ' '
     C*                  MOVE      A80(XN)       XXA01             1
     C*                  LEAVE
     C*                  END
     C*                  EVAL      XN = XN - 1
     C*                  ENDDO
     C*                  EVAL      SDATA = TXT(073)
     C*                  CAT       XXA01:0       SDATA
     C*                  CAT       TXT(074):0    SDATA
     C*                  WRITE     EDISER
      * PaymentInfo slutt
     C                   EVAL      SDATA = TXT(058)
     C                   WRITE     EDISER
      * DeliveryInfo start
     C                   EVAL      SDATA = TXT(075)
     C                   WRITE     EDISER
      * DeliveryTermsCode
     C                   EVAL      SDATA = TXT(077)
     C                   CAT       HEFR:0        SDATA
     C                   CAT       TXT(078):0    SDATA
     C                   WRITE     EDISER
      * DeliveryTermsText
     C     KODTFRK       CHAIN     KODTFR                             33
     C                   EVAL      SDATA = TXT(079)
     C                   IF        SPRAAK = ' '
     C                   CAT       KFRNTX:0      SDATA
     C                   ELSE
     C                   CAT       KFRTTX:0      SDATA
     C                   END
     C                   CAT       TXT(080):0    SDATA
     C                   WRITE     EDISER
      * DeliveryMethodCode
     C*                  EVAL      SDATA = TXT(081)
     C*                  CAT       TXT(082):1    SDATA
     C*                  WRITE     EDISER
      * DeliveryMethodText
     C                   IF        HEHAWB <> *BLANKS
     C                   EVAL      SDATA = TXT(083)
     C                   CAT       HEHAWB:0      SDATA
     C                   CAT       TXT(084):0    SDATA
     C                   WRITE     EDISER
     C                   END
      * DeliveryInfo slutt
     C                   EVAL      SDATA = TXT(076)
     C                   WRITE     EDISER
      *
      * Parties
     C     STPARTIES     TAG
     C                   EXSR      SRPART
      * Summery
     C                   EXSR      SRSUM
      * FreeText
     C                   EXSR      SRFRTEKST
      * Details
     C                   MOVE      *OFF          *IN33
     C                   MOVE      *ZEROS        XXANTOPPD         5 0
     C                   DOW       *IN33 = *OFF
     C                   EXSR      SRDET
     C     STSREINV2     TAG
     C     FIFN          READE     FAIN                                   33
     C                   IF        *IN33 = *OFF
     C     HEADFK        CHAIN     HEADF                              33
     C     FAK8K         SETLL     FAK8
     C     FAK8K         READE     FAK8                                   33
     C  N33              DOW       FAOPKO = 'D'
     C     FAK8K         READE     FAK8                                   33
     C  N33              ENDDO
     C   33              GOTO      STSREINV2
     C                   IF        FAVAL = *BLANKS
     C                   EVAL      FAVAL = FICURR
     C                   END
     C                   END
     C  N33              ENDDO
      * Invoice slutt
     C                   EVAL      SDATA = TXT(046)
     C                   WRITE     EDISER
      *
     C     SLSREINV      TAG
     C                   ENDSR
      *
      ***********************************************
     C     SRPART        BEGSR
      ***********************************************
      * Parties start
     C                   EVAL      SDATA = TXT(085)
     C                   WRITE     EDISER
      * Invoicer start
     C                   EVAL      SDATA = TXT(087)
     C                   WRITE     EDISER
      *
     C     KODTAK        CHAIN     KODTA                              33
     C                   MOVE      KOAKNR        KUNDNR
     C                   EXSR      SRHENTK
      * Contact start
     C                   EVAL      SDATA = TXT(089)
     C                   WRITE     EDISER
      * Reference
     C     KODTSFK       CHAIN     KODTSF                             33
     C                   EVAL      SDATA = TXT(091)
     C                   CAT       SYSPEDREF:0   SDATA
     C                   CAT       '/':0         SDATA
     C                   CAT       KOSFNV:0      SDATA
     C                   CAT       TXT(092):0    SDATA
     C                   WRITE     EDISER
      * Email
     C*                  IF        SYEPOS <> *BLANKS
     C*                  EVAL      SDATA = TXT(093)
     C*                  CAT       SYEPOS:0      SDATA
     C*                  CAT       TXT(094):0    SDATA
     C*                  WRITE     EDISER
     C*                  END
      * Phone
     C                   IF        TLF <> *BLANKS
     C                   EVAL      SDATA = TXT(095)
     C                   CAT       TLF:0         SDATA
     C                   CAT       TXT(096):0    SDATA
     C                   WRITE     EDISER
     C                   END
      * Fax
     C                   IF        TFAXNR <> *BLANKS
     C                   EVAL      SDATA = TXT(097)
     C                   CAT       TFAXNR:0      SDATA
     C                   CAT       TXT(098):0    SDATA
     C                   WRITE     EDISER
     C                   END
      * Contact slutt
     C                   EVAL      SDATA = TXT(090)
     C                   WRITE     EDISER
      * Invoicer slutt
     C                   EVAL      SDATA = TXT(088)
     C                   WRITE     EDISER
      * Invoicee start
     C                   EVAL      SDATA = TXT(121)
     C                   WRITE     EDISER
      *
     C                   MOVE      FAKUNR        KUNDNR
     C                   EXSR      SRHENTK
      * Contact start
     C                   EVAL      SDATA = TXT(089)
     C                   WRITE     EDISER
      * Reference
     C                   EVAL      SDATA = TXT(091)
     C                   CAT       HERFA:0       SDATA
     C                   CAT       TXT(092):0    SDATA
     C                   WRITE     EDISER
      * Contact slutt
     C                   EVAL      SDATA = TXT(090)
     C                   WRITE     EDISER
      * Invoicee slutt
     C                   EVAL      SDATA = TXT(122)
     C                   WRITE     EDISER
      *
     C                   IF        XFSAML = 'J'
     C                   GOTO      SLSRPARTIES
     C                   END
      * Supplier start
     C                   EVAL      SDATA = TXT(123)
     C                   WRITE     EDISER
      *
     C                   IF        HEKNS = 0
     C                   EXSR      SRHENTKS
     C                   ELSE
     C                   MOVE      HEKNS         KUNDNR
     C                   EXSR      SRHENTK
      *
     C                   END
      * Supplier slutt
     C                   EVAL      SDATA = TXT(124)
     C                   WRITE     EDISER
      * Buyer start
     C                   EVAL      SDATA = TXT(125)
     C                   WRITE     EDISER
      *
     C                   IF        HEKNK = 0
     C                   EXSR      SRHENTKK
     C                   ELSE
     C                   MOVE      HEKNK         KUNDNR
     C                   EXSR      SRHENTK
     C                   END
      * Buyer slutt
     C                   EVAL      SDATA = TXT(126)
     C                   WRITE     EDISER
      * Delivery start
     C                   EVAL      SDATA = TXT(127)
     C                   WRITE     EDISER
      *
     C                   EXSR      SRHENTKK
      * Delivery slutt
     C                   EVAL      SDATA = TXT(128)
     C                   WRITE     EDISER
      * OtherParty start
     C                   EVAL      SDATA = TXT(129)
     C                   CAT       'type="':1    SDATA
     C                   CAT       'Pickup">':0  SDATA
     C                   WRITE     EDISER
      * Pickup
     C                   EXSR      SRHENTKS
      * OtherParty slutt
     C                   EVAL      SDATA = TXT(130)
     C                   WRITE     EDISER
      * Parties slutt
     C     SLSRPARTIES   TAG
     C                   EVAL      SDATA = TXT(86)
     C                   WRITE     EDISER
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRHENTK       BEGSR
      ***********************************************
     C     CUNDL01K      CHAIN     CUNDL01                            33
      *
     C                   EVAL      SDATA = TXT(101)
     C                   WRITE     EDISER
      *
     C                   EVAL      SDATA = TXT(103)
     C                   CAT       SYRG:0        SDATA
     C                   CAT       TXT(104):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(105)
     C                   CAT       'NO':0        SDATA
     C                   CAT       SYRG:0        SDATA
     C                   CAT       'MVA':0       SDATA
     C                   CAT       TXT(106):0    SDATA
     C                   WRITE     EDISER
      *
     C                   EVAL      SDATA = TXT(102)
     C                   WRITE     EDISER
      *
     C                   EVAL      SDATA = TXT(107)
     C                   CAT       KNAVN:0       SDATA
     C                   CAT       TXT(108):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(109)
     C                   WRITE     EDISER
     C                   IF        ADR1 <> *BLANKS
     C                   EVAL      SDATA = TXT(111)
     C                   CAT       ADR1:0        SDATA
     C                   CAT       TXT(112):0    SDATA
     C                   WRITE     EDISER
     C                   END
     C                   IF        ADR2 <> *BLANKS
     C                   EVAL      SDATA = TXT(113)
     C                   CAT       ADR2:0        SDATA
     C                   CAT       TXT(114):0    SDATA
     C                   WRITE     EDISER
     C                   END
     C                   IF        ADR3 <> *BLANKS
     C                   EVAL      SDATA = TXT(115)
     C                   CAT       ADR3:0        SDATA
     C                   CAT       TXT(116):0    SDATA
     C                   WRITE     EDISER
     C                   END
     C                   IF        POSTNR <> 0
     C                   EVAL      SDATA = TXT(117)
     C                   MOVE      POSTNR        XXA04             4
     C                   CAT       XXA04:0       SDATA
     C                   CAT       TXT(118):0    SDATA
     C                   WRITE     EDISER
     C                   ELSE
     C                   IF        SYPOGE <> *BLANKS
     C                   EVAL      SDATA = TXT(117)
     C                   CAT       SYPOGE:0      SDATA
     C                   CAT       TXT(118):0    SDATA
     C                   WRITE     EDISER
     C                   END
     C                   END
     C                   EVAL      SDATA = TXT(119)
     C                   IF        SYLAND = *BLANKS
     C                   CAT       FILAND:0      SDATA
     C                   ELSE
     C                   CAT       SYLAND:0      SDATA
     C                   END
     C                   CAT       TXT(120):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(110)
     C                   WRITE     EDISER
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRHENTKS      BEGSR
      ***********************************************
     C                   EVAL      SDATA = TXT(107)
     C                   CAT       HENAS:0       SDATA
     C                   CAT       TXT(108):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(109)
     C                   WRITE     EDISER
     C                   IF        HEADS1 <> *BLANKS
     C                   EVAL      SDATA = TXT(111)
     C                   CAT       HEADS1:0      SDATA
     C                   CAT       TXT(112):0    SDATA
     C                   WRITE     EDISER
     C                   END
     C                   IF        HEADS2 <> *BLANKS
     C                   EVAL      SDATA = TXT(113)
     C                   CAT       HEADS2:0      SDATA
     C                   CAT       TXT(114):0    SDATA
     C                   WRITE     EDISER
     C                   END
     C                   IF        HEADS3 <> *BLANKS
     C                   EVAL      SDATA = TXT(115)
     C                   CAT       HEADS3:0      SDATA
     C                   CAT       TXT(116):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(117)
     C                   MOVEL     HEADS3        XXA04             4
     C                   CAT       XXA04:0       SDATA
     C                   CAT       TXT(118):0    SDATA
     C                   WRITE     EDISER
     C                   END
     C                   EVAL      SDATA = TXT(110)
     C                   WRITE     EDISER
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRHENTKK      BEGSR
      ***********************************************
     C                   EVAL      SDATA = TXT(107)
     C                   CAT       HENAK:0       SDATA
     C                   CAT       TXT(108):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(109)
     C                   WRITE     EDISER
     C                   IF        HEADK1 <> *BLANKS
     C                   EVAL      SDATA = TXT(111)
     C                   CAT       HEADK1:0      SDATA
     C                   CAT       TXT(112):0    SDATA
     C                   WRITE     EDISER
     C                   END
     C                   IF        HEADK2 <> *BLANKS
     C                   EVAL      SDATA = TXT(113)
     C                   CAT       HEADK2:0      SDATA
     C                   CAT       TXT(114):0    SDATA
     C                   WRITE     EDISER
     C                   END
     C                   IF        HEADK3 <> *BLANKS
     C                   EVAL      SDATA = TXT(115)
     C                   CAT       HEADK3:0      SDATA
     C                   CAT       TXT(116):0    SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(117)
     C                   MOVEL     HEADK3        XXA04             4
     C                   CAT       XXA04:0       SDATA
     C                   CAT       TXT(118):0    SDATA
     C                   WRITE     EDISER
     C                   END
     C                   EVAL      SDATA = TXT(110)
     C                   WRITE     EDISER
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRSUM         BEGSR
      ***********************************************
      * Summary start
     C                   EVAL      SDATA = TXT(131)
     C                   WRITE     EDISER
      *
     C                   MOVE      *ZEROS        XXMVAT           13 2
     C     1             DO        11            XN01              3 0
     C                   IF        XMLT1(XN01) > 0
     C                   IF        XMLT2(XN01) = *BLANKS
     C                   EVAL      XMLT2(XN01) = FICURR
     C                   END
     C                   IF        XMLT2(XN01) = FICURR
     C                   EVAL(H)   XXMVAT = XXMVAT+XMLT1(XN01)*XMLT3(XN01)/100
     C                   ELSE
     C                   EVAL(H)   XXMVAT = XXMVAT+XMLT1(XN01)*XMLT4(XN01)/100
     C                   END
     C                   END
     C                   ENDDO
      * Taxes start
     C                   EVAL      SDATA = TXT(133)
     C                   WRITE     EDISER
      *
     C                   MOVE      *ZEROS        XXMVA            13 2
     C     1             DO        11            XN01
     C                   IF        XMLT1(XN01) > 0
      * Tax start
     C                   EVAL      SDATA = TXT(135)
     C                   WRITE     EDISER
      * TaxType
     C                   EVAL      SDATA = TXT(137)
     C                   CAT       'MVA':0       SDATA
     C                   CAT       TXT(138):0    SDATA
     C                   WRITE     EDISER
      * TaxBase
     C                   EVAL      SDATA = TXT(139)
     C                   IF        XMLT2(XN01) = FICURR
     C                   EVAL      ØN152 = XMLT3(XN01)
     C                   ELSE
     C                   EVAL      ØN152 = XMLT4(XN01)
     C                   END
     C                   MOVE      'J'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(140):0    SDATA
     C                   WRITE     EDISER
      * TaxPercent
     C                   EVAL      SDATA = TXT(141)
     C                   EVAL      ØN152 = XMLT1(XN01)
     C                   MOVE      'N'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(142):0    SDATA
     C                   WRITE     EDISER
      * TaxAmount
     C                   EVAL      SDATA = TXT(143)
     C                   CAT       'currencyId':1SDATA
     C                   CAT       '="':0        SDATA
     C                   CAT       XMLT2(XN01):0 SDATA
     C                   CAT       '">':0        SDATA
     C                   IF        XMLT2(XN01) = FICURR
     C                   EVAL      ØN152 = XMLT3(XN01) * XMLT1(XN01) / 100
     C                   ELSE
     C                   EVAL      ØN152 = XMLT4(XN01) * XMLT1(XN01) / 100
     C                   END
     C                   MOVE      'J'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(144):0    SDATA
     C                   WRITE     EDISER
      * Tax slutt
     C                   EVAL      SDATA = TXT(136)
     C                   WRITE     EDISER
      *
     C                   END
     C                   ENDDO
      * Taxes slutt
     C                   EVAL      SDATA = TXT(134)
     C                   WRITE     EDISER
      * TotalTax
     C                   EVAL      SDATA = TXT(145)
     C                   CAT       'currencyId':1SDATA
     C                   CAT       '="':0        SDATA
     C                   CAT       XFVAL:0       SDATA
     C                   CAT       '">':0        SDATA
     C                   EVAL      ØN152 = XXMVAT
     C                   MOVE      'J'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(146):0    SDATA
     C                   WRITE     EDISER
      * TotalExclTaxes
     C                   EVAL      SDATA = TXT(147)
     C                   CAT       'currencyId':1SDATA
     C                   CAT       '="':0        SDATA
     C                   CAT       XFVAL:0       SDATA
     C                   CAT       '">':0        SDATA
     C                   EVAL      ØN152 = XFTOT - XXMVAT
     C                   MOVE      'J'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(148):0    SDATA
     C                   WRITE     EDISER
      * TotalInclTax
     C                   EVAL      SDATA = TXT(149)
     C                   CAT       'currencyId':1SDATA
     C                   CAT       '="':0        SDATA
     C                   CAT       XFVAL:0       SDATA
     C                   CAT       '">':0        SDATA
     C                   EVAL      ØN152 = XFTOT
     C                   MOVE      'J'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(150):0    SDATA
     C                   WRITE     EDISER
      * Summary slutt
     C                   EVAL      SDATA = TXT(132)
     C                   WRITE     EDISER
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRFRTEKST     BEGSR
      ***********************************************
     C     FREETK        SETLL     FREETXT2
     C     FREETK        READE     FREETXT2                               33
     C                   IF        *IN33 = *OFF
      * FreeText start
     C                   EVAL      SDATA = TXT(151)
     C                   WRITE     EDISER
      * Text start
     C                   EVAL      SDATA = TXT(153)
     C                   WRITE     EDISER
      *
     C                   DOW       *IN33 = *OFF
     C                   EVAL      SDATA = TXT(155)
     C                   CAT       'name="Free':1SDATA
     C                   CAT       'Text"':0     SDATA
     C                   WRITE     EDISER
     C                   EVAL      SDATA = 'value="'
     C                   CAT       FRTTXT:0      SDATA
     C                   CAT       '"/>':0       SDATA
     C                   WRITE     EDISER
     C     FREETK        READE     FREETXT2                               33
     C  N33              ENDDO
      *
      * Text slutt
     C                   EVAL      SDATA = TXT(154)
     C                   WRITE     EDISER
      * FreeText slutt
     C                   EVAL      SDATA = TXT(152)
     C                   WRITE     EDISER
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRDET         BEGSR
      ***********************************************
     C                   MOVE      *ZEROS        XXBEL            13 2
      * Details start
     C                   EVAL      SDATA = TXT(157)
     C                   WRITE     EDISER
      * DetailNumber
     C                   EVAL      SDATA = TXT(159)
     C                   ADD       1             XXANTOPPD
     C                   EVAL      ØN152 = XXANTOPPD
     C                   MOVE      'N'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(160):0    SDATA
     C                   WRITE     EDISER
      *
     C                   MOVE      *ZEROS        XXLINNR           5 0
     C     STLIN         TAG
      * LineDetails start
     C                   EVAL      SDATA = TXT(161)
     C                   WRITE     EDISER
      * LineNumber
     C                   EVAL      SDATA = TXT(163)
     C                   ADD       1             XXLINNR
     C                   EVAL      ØN152 = XXLINNR
     C                   MOVE      'N'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(164):0    SDATA
     C                   WRITE     EDISER
      * ProductDetails start
     C                   EVAL      SDATA = TXT(165)
     C                   WRITE     EDISER
      * SupplierProductCode
     C                   EVAL      SDATA = TXT(167)
     C                   CAT       FAVK:0        SDATA
     C                   CAT       TXT(168):0    SDATA
     C                   WRITE     EDISER
      * SupplierProductText
     C                   EVAL      SDATA = TXT(169)
     C                   CAT       FAVT:0        SDATA
     C     KODTGEK       CHAIN     KODTGE                             33
     C     KODTG2K       CHAIN     KODTG2                             33
     C                   IF        FAVT <> *BLANKS
     C                   CAT       ',':0         SDATA
     C                   END
     C                   SELECT
     C                   WHEN      SPRAAK = 'E'
     C                   CAT       KGEENT:0      SDATA
     C                   WHEN      SPRAAK = 'T'
     C                   CAT       KG2TYT:0      SDATA
     C                   OTHER
     C                   CAT       KGENOT:0      SDATA
     C                   ENDSL
     C                   CAT       TXT(170):0    SDATA
     C                   WRITE     EDISER
      * ProductDetails slutt
     C                   EVAL      SDATA = TXT(166)
     C                   WRITE     EDISER
      * Quantities start
     C                   EVAL      SDATA = TXT(171)
     C                   WRITE     EDISER
      * QuantitiyOrdered
     C                   EVAL      SDATA = TXT(173)
     C                   CAT       'qtyType="':1 SDATA
     C                   CAT       'PCE">1':0    SDATA
     C                   CAT       TXT(174):0    SDATA
     C                   WRITE     EDISER
      * QuantitiyDeliveried
     C                   EVAL      SDATA = TXT(175)
     C                   CAT       'qtyType="':1 SDATA
     C                   CAT       'PCE">1':0    SDATA
     C                   CAT       TXT(176):0    SDATA
     C                   WRITE     EDISER
      * Quantities slutt
     C                   EVAL      SDATA = TXT(172)
     C                   WRITE     EDISER
      * LineDates start
     C                   EVAL      SDATA = TXT(177)
     C                   WRITE     EDISER
      * OtherDates start
     C                   EVAL      SDATA = TXT(179)
     C                   WRITE     EDISER
     C                   EVAL      SDATA = TXT(021)
     C                   CAT       'type="':1    SDATA
     C                   SELECT
     C                   WHEN      SPRAAK = 'E'
     C                   CAT       'OrderDate"':0SDATA
     C                   WHEN      SPRAAK = 'T'
     C                   CAT       'AuftragDat':0SDATA
     C                   CAT       'm"':0        SDATA
     C                   OTHER
     C                   CAT       'OppdragDat':0SDATA
     C                   CAT       'o"':0        SDATA
     C                   ENDSL
     C                   CAT       'year="':1    SDATA
     C                   CAT       HEDTOPÅ:0     SDATA
     C                   CAT       '" month="':0 SDATA
     C                   CAT       HEDTOPM:0     SDATA
     C                   CAT       '" day="':0   SDATA
     C                   CAT       HEDTOPD:0     SDATA
     C                   CAT       '">':0        SDATA
     C                   CAT       HEDTOPÅ:0     SDATA
     C                   CAT       '-':0         SDATA
     C                   CAT       HEDTOPM:0     SDATA
     C                   CAT       '-':0         SDATA
     C                   CAT       HEDTOPD:0     SDATA
     C                   CAT       TXT(022):0    SDATA
     C                   WRITE     EDISER
      * OtherDates slutt
     C                   EVAL      SDATA = TXT(180)
     C                   WRITE     EDISER
      * LineDates slutt
     C                   EVAL      SDATA = TXT(178)
     C                   WRITE     EDISER
      * LineReference start
     C*                  EVAL      SDATA = TXT(181)
     C*                  WRITE     EDISER
      * OtherReference start
     C*                  EVAL      SDATA = TXT(183)
     C*                  WRITE     EDISER
      * Reference
     C*                  EVAL      SDATA = TXT(185)
     C*                  CAT       'type="Our':1 SDATA
     C*                  CAT       'Reference"':0SDATA
     C*                  CAT       '>':0         SDATA
     C*                  CAT       SYSPEDREF:0   SDATA
     C*                  CAT       TXT(186):0    SDATA
     C*                  WRITE     EDISER
      * OtherReference slutt
     C*                  EVAL      SDATA = TXT(186)
     C*                  WRITE     EDISER
      * LineReference slutt
     C*                  EVAL      SDATA = TXT(182)
     C*                  WRITE     EDISER
      * PriceDetails start
     C                   EVAL      SDATA = TXT(187)
     C                   WRITE     EDISER
     C                   IF        FAVAL = FICURR
     C                   EVAL      XXBEL = FABELN
     C                   ELSE
     C                   EVAL      XXBEL = FABELV
     C                   END
      * Price
     C*                  EVAL      SDATA = TXT(189)
     C*                  CAT       'type="NET"':1SDATA
     C*                  CAT       '>':0         SDATA
     C*                  EVAL      ØN152 = XXBEL
     C*                  MOVE      'J'           XBELØP
     C*                  EXSR      SRNE
     C*                  CAT       ØAN:0         SDATA
     C*                  CAT       TXT(190):0    SDATA
     C*                  WRITE     EDISER
      *
      * LineTotTaxBase
     C                   EVAL      SDATA = TXT(191)
     C                   CAT       'currencyId':1SDATA
     C                   CAT       '="':0        SDATA
     C                   CAT       FAVAL:0       SDATA
     C                   CAT       '">':0        SDATA
     C                   EVAL      ØN152 = XXBEL
     C                   MOVE      'J'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(192):0    SDATA
     C                   WRITE     EDISER
      * TaxPercent
     C                   EVAL      SDATA = TXT(193)
     C                   SELECT
     C                   WHEN      FAKDM = 'N'
     C                   EVAL      MVAAVI = 0
     C                   WHEN      FAKDM = 'J'
     C                   EVAL      MVAAVI = FITAX * 100
     C                   OTHER
     C     KODWL01K      CHAIN     KODWL01                            33
     C   33              EVAL      MVAAVI = 0
     C                   END
     C                   EVAL      ØN152 = MVAAVI
     C                   MOVE      'N'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(194):0    SDATA
     C                   WRITE     EDISER
      * LineTotTax
     C                   EVAL      SDATA = TXT(195)
     C                   CAT       'currencyId':1SDATA
     C                   CAT       '="':0        SDATA
     C                   CAT       FAVAL:0       SDATA
     C                   CAT       '">':0        SDATA
     C                   EVAL      XXMVA = XXBEL * MVAAVI / 100
     C                   EVAL      ØN152 = XXMVA
     C                   MOVE      'J'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(196):0    SDATA
     C                   WRITE     EDISER
      * LineTotExclTax
     C                   EVAL      SDATA = TXT(197)
     C                   CAT       'currencyId':1SDATA
     C                   CAT       '="':0        SDATA
     C                   CAT       FAVAL:0       SDATA
     C                   CAT       '">':0        SDATA
     C                   EVAL      ØN152 = XXBEL
     C                   MOVE      'J'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(198):0    SDATA
     C                   WRITE     EDISER
      * LineTotInclTax
     C                   EVAL      SDATA = TXT(199)
     C                   CAT       'currencyId':1SDATA
     C                   CAT       '="':0        SDATA
     C                   CAT       FAVAL:0       SDATA
     C                   CAT       '">':0        SDATA
     C                   EVAL      ØN152 = XXBEL + XXMVA
     C                   MOVE      'J'           XBELØP
     C                   EXSR      SRNE
     C                   CAT       ØAN:0         SDATA
     C                   CAT       TXT(200):0    SDATA
     C                   WRITE     EDISER
      * PriceDetails slutt
     C                   EVAL      SDATA = TXT(188)
     C                   WRITE     EDISER
      * LineDetails slutt
     C                   EVAL      SDATA = TXT(162)
     C                   WRITE     EDISER
     C     FAK8K         READE     FAK8                                   33
     C  N33              GOTO      STLIN
      * Details slutt
     C                   EVAL      SDATA = TXT(158)
     C                   WRITE     EDISER
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRSLUTT       BEGSR
      ***********************************************
      * PostenInterChange
     C                   EVAL      SDATA = TXT(003)
     C                   WRITE     EDISER
      *
      * Oppdater EDIS
     C                   WRITE     EDISR
      *
     C                   ENDSR
      *
      ***********************************************
     C     SRCLOSE       BEGSR
      ***********************************************
     C                   CLOSE     ECMSG
     C                   CLOSE     KODWL01
     C                   CLOSE     KODTA
     C                   CLOSE     KODTGE
     C                   CLOSE     KODTG2
     C                   CLOSE     KODTSF
     C                   CLOSE     KODTFR
     C                   CLOSE     CUNDL01
     C                   CLOSE     FAIN
     C                   CLOSE     HEADF
     C                   CLOSE     FAK8
     C                   CLOSE     FRISOK
     C                   CLOSE     KODFRI
     C                   CLOSE     EDIC
     C                   CLOSE     EDIS
     C                   CLOSE     EDIM
     C                   CLOSE     EDISE
      *
     C                   ENDSR
      *
      ***********************************************
     C     OPDEDIM       BEGSR
      ***********************************************
     C     1             CHAIN     EDIC                               33
     C                   ADD       1             CMN
     C                   UPDATE    EDICR
      *
     C                   EVAL      M0004 = S0004
     C                   EVAL      M0010 = S0010
     C                   MOVEL     CMN           M0062
     C                   EVAL      M0065 = 'INVXML'
     C                   MOVEL     XFFN          M0068
     C                   IF        XFFK = 'F'
     C                   MOVEL     '380'         M1001
     C                   ELSE
     C                   MOVEL     '381'         M1001
     C                   END
     C                   MOVEL     XFFN          M1004
     C                   EVAL      MSN = SSN
     C                   EVAL      MMN = CMN
     C                   EVAL      MSR = 'S'
     C                   EVAL      MST = 'C'
     C                   MOVE      WDT           MDT
     C                   MOVE      WTM           MTM
     C                   WRITE     EDIMR
      *
     C                   EVAL      S0036 = S0036 + 1
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Venstrestill numeriske verdier                      SRNE /
      *////////////////////////////////////////////////////////////
     C     SRNE          BEGSR
     C                   IF        ØN152 < 0
     C                   MOVE      '-'           XAN01             1
     C                   Z-SUB     ØN152         ØN152
     C                   ELSE
     C                   MOVE      ' '           XAN01
     C                   END
      * Flytte in rett verdi i Alfa 12-felt
     C                   MOVE      *ZEROS        ØA12
     C     ØA152D        IFEQ      '00'                                         <-------------I
     C     XBELØP        ANDEQ     'N'                                                        I
     C                   MOVE      ØA152H        ØA12                                         I
     C                   ELSE                                                   <-------------I
     C                   MOVEL     ØA152X        ØA12                                         I
     C                   MOVE      '.  '         ØA12                                         I
     C                   MOVE      ØA152D        ØA12                                         I
     C     XBELØP        IFEQ      'N'
     C     Ø12(12)       IFEQ      '0'
     C                   MOVE      ' '           Ø12(12)
     C     Ø12(11)       IFEQ      '0'
     C                   MOVE      ' '           Ø12(11)
     C                   END
     C                   END
     C                   END
     C                   END                                                    <-------------I
      * lete fra venstre og finn foerste siffer over 0
     C     1             DO        11            ØX                             <-------------I
     C     Ø12(ØX)       IFNE      '0'                                           <-----------II
     C                   GOTO      SRNE1                                                     II
     C                   END                                                     <-----------II
     C                   END                                                    <-------------I
     C     SRNE1         TAG
      * Venstrestill til et nytt felt
     C                   MOVE      *BLANKS       XXA12            12
     C     Ø12(ØX)       IFEQ      '.'
     C                   SUB       1             ØX
     C                   END
     C                   MOVEA     Ø12(ØX)       XXA12
     C                   IF        XAN01 = '-'
     C                   EVAL      ØAN = XAN01
     C                   CAT       XXA12:0       ØAN
     C                   ELSE
     C                   EVAL      ØAN = XXA12
     C                   END
      *
     C                   ENDSR
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     XMLUFL1K      KLIST
     C                   KFLD                    XXST
     C                   KFLD                    FIFIRM
     C     ECMSGK        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    XFKN
     C                   KFLD                    ECSR
     C                   KFLD                    EC0065
     C     HEADFK        KLIST
     C                   KFLD                    FIAVD
     C                   KFLD                    FIOPD
     C     FAK8K         KLIST
     C                   KFLD                    FIAVD
     C                   KFLD                    FIOPD
     C                   KFLD                    FIFN
     C     KODWL01K      KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    MOMSTW
     C                   KFLD                    FAKDM
     C     KODTAK        KLIST
     C                   KFLD                    KOAUNI
     C                   KFLD                    FIAVD
     C     KODTGEK       KLIST
     C                   KFLD                    KGEUNI
     C                   KFLD                    FAVK
     C     KODTG2K       KLIST
     C                   KFLD                    KG2UNI
     C                   KFLD                    FAVK
     C     KODTSFK       KLIST
     C                   KFLD                    KOSFUN
     C                   KFLD                    HESG
     C     KODTFRK       KLIST
     C                   KFLD                    KFRUNI
     C                   KFLD                    HEFR
     C     CUNDL01K      KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C     FREETK        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    FASK
     C                   KFLD                    FIFN
      *
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
      *
     C                   Z-ADD     0             ØX                2 0
     C                   MOVE      *BLANKS       ØAN              12
     C                   MOVE      ' '           XXST              1
     C                   MOVE      'A'           KOAUNI
     C                   MOVEL     'GE'          KGEUNI
     C                   MOVEL     'G2'          KG2UNI
     C                   MOVEL     'SF'          KOSFUN
     C                   MOVEL     'FR'          KFRUNI
     C                   MOVEL     'S'           ECSR
     C                   MOVEL     'INVXML'      EC0065
     C                   MOVE      '/'           XXSTREKK1
     C                   MOVE      '/'           XXSTREKK2
      *
     C                   ENDSR
      *
** TXT
<?xml version="1.0" encoding="ISO-8859-1" ?>                                    001
<PostenInterchange                                                              002
</PostenInterchange>                                                            003
<InterchangeType>PostenInterchange</InterchangeType>                            004
<Version>1.4-rev3</Version>                                                     005
<Originator>                                                                    006
</Originator>                                                                   007
<Address>                                                                       008
</Address>                                                                      009
<SubAddress/>                                                                   010
<SubAddress>                                                                    011
</SubAddress>                                                                   012
<AddressQualifier>                                                              013
</AddressQualifier>                                                             014
<Recipient>                                                                     015
</Recipient>                                                                    016
<InterchangeId>                                                                 017
</InterchangeId>                                                                018
<InterchangeTime>                                                               019
</InterchangeTime>                                                              020
<Date                                                                           021
</Date>                                                                         022
<Time                                                                           023
</Time>                                                                         024
<eMessage>                                                                      025
</eMessage>                                                                     026
<MessageType>                                                                   027
</MessageType>                                                                  028
<MessageVersion>                                                                029
</MessageVersion>                                                               030
<DocumentType>                                                                  031
</DocumentType>                                                                 032
<DocumentCode>                                                                  033
</DocumentCode>                                                                 034
<DocumentDescriptiveName>                                                       035
</DocumentDescriptiveName>                                                      036
<MessageReference>                                                              037
</MessageReference>                                                             038
<MessageOriginator>                                                             039
</MessageOriginator>                                                            040
<MessageRecipient>                                                              041
</MessageRecipient>                                                             042
<MessageContent>                                                                043
</MessageContent>                                                               044
<Invoice>                                                                       045
</Invoice>                                                                      046
<InvoiceDates>                                                                  047
</InvoiceDates>                                                                 048
<InvoiceDate                                                                    049
</InvoiceDate>                                                                  050
<DueDate                                                                        051
</DueDate>                                                                      052
<InvoiceReferences>                                                             053
</InvoiceReferences>                                                            054
<InvoiceNo>                                                                     055
</InvoiceNo>                                                                    056
<PaymentInfo>                                                                   057
</PaymentInfo>                                                                  058
<PaymentTermsCode>                                                              059
</PaymentTermsCode>                                                             060
<PaymentTermsText>                                                              061
</PaymentTermsText>                                                             062
<PaymentAccountInfo>                                                            063
</PaymentAccountInfo>                                                           064
<AccountNumber>                                                                 065
</AccountNumber>                                                                066
<PaymentDueDate                                                                 067
</PaymentDueDate>                                                               068
<PaymentAmount                                                                  069
</PaymentAmount>                                                                070
<KID>                                                                           071
</KID>                                                                          072
<CheckDigit>                                                                    073
</CheckDigit>                                                                   074
<DeliveryInfo>                                                                  075
</DeliveryInfo>                                                                 076
<DeliveryTermsCode>                                                             077
</DeliveryTermsCode>                                                            078
<DeliveryTermsText>                                                             079
</DeliveryTermsText>                                                            080
<DeliveryMethodCode>                                                            081
</DeliveryMethodCode>                                                           082
<DeliveryMethodText>                                                            083
</DeliveryMethodText>                                                           084
<Parties>                                                                       085
</Parties>                                                                      086
<Invoicer>                                                                      087
</Invoicer>                                                                     088
<Contact>                                                                       089
</Contact>                                                                      090
<Reference>                                                                     091
</Reference>                                                                    092
<Email>                                                                         093
</Email>                                                                        094
<Phone>                                                                         095
</Phone>                                                                        096
<Fax>                                                                           097
</Fax>                                                                          098
<WebAddress>                                                                    099
</WebAddress>                                                                   100
<Identifications>                                                               101
</Identifications>                                                              102
<CompanyRegNo>                                                                  103
</CompanyRegNo>                                                                 104
<CompanyVATNo>                                                                  105
</CompanyVATNo>                                                                 106
<Name>                                                                          107
</Name>                                                                         108
<PostalAddress>                                                                 109
</PostalAddress>                                                                110
<Address1>                                                                      111
</Address1>                                                                     112
<Address2>                                                                      113
</Address2>                                                                     114
<City>                                                                          115
</City>                                                                         116
<PostCode>                                                                      117
</PostCode>                                                                     118
<CountryCode>                                                                   119
</CountryCode>                                                                  120
<Invoicee>                                                                      121
</Invoicee>                                                                     122
<Supplier>                                                                      123
</Supplier>                                                                     124
<Buyer>                                                                         125
</Buyer>                                                                        126
<Delivery>                                                                      127
</Delivery>                                                                     128
<OtherParty                                                                     129
</OtherParty>                                                                   130
<Summary>                                                                       131
</Summary>                                                                      132
<Taxes>                                                                         133
</Taxes>                                                                        134
<Tax>                                                                           135
</Tax>                                                                          136
<TaxType>                                                                       137
</TaxType>                                                                      138
<TaxBase>                                                                       139
</TaxBase>                                                                      140
<TaxPercent>                                                                    141
</TaxPercent>                                                                   142
<TaxAmount                                                                      143
</TaxAmount>                                                                    144
<TotalTax                                                                       145
</TotalTax>                                                                     146
<TotalExclTax                                                                   147
</TotalExclTax>                                                                 148
<TotalInclTax                                                                   149
</TotalInclTax>                                                                 150
<FreeText>                                                                      151
</FreeText>                                                                     152
<Text>                                                                          153
</Text>                                                                         154
<FTValueParameter                                                               155
</FTValueParameter>                                                             156
<Details>                                                                       157
</Details>                                                                      158
<DetailNumber>                                                                  159
</DetailNumber>                                                                 160
<LineDetails>                                                                   161
</LineDetails>                                                                  162
<LineNumber>                                                                    163
</LineNumber>                                                                   164
<ProductDetails>                                                                165
</ProductDetails>                                                               166
<SupplierProductCode>                                                           167
</SupplierProductCode>                                                          168
<SupplierProductText>                                                           169
</SupplierProductText>                                                          170
<Quantities>                                                                    171
</Quantities>                                                                   172
<QuantityOrdered                                                                173
</QuantityOrdered>                                                              174
<QuantityDelivered                                                              175
</QuantityDelivered>                                                            176
<LineDates>                                                                     177
</LineDates>                                                                    178
<OtherDates>                                                                    179
</OtherDates>                                                                   180
<LineReferences>                                                                181
</LineReferences>                                                               182
<OtherReferences>                                                               183
</OtherReferences>                                                              184
<Reference                                                                      185
</Reference>                                                                    186
<PriceDetails>                                                                  187
</PriceDetails>                                                                 188
<Price                                                                          189
</Price>                                                                        190
<LineTotTaxBase                                                                 191
</LineTotTaxBase>                                                               192
<TaxPercent>                                                                    193
</TaxPercent>                                                                   194
<LineTotTax                                                                     195
</LineTotTax>                                                                   196
<LineTotExclTax                                                                 197
</LineTotExclTax>                                                               198
<LineTotInclTax                                                                 199
</LineTotInclTax>                                                               200
<DispatchAdviceNo>                                                              201
</DispatchAdviceNo>                                                             202
** TXT01
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"                          001
 xsi:noNamespaceSchemaLocation="D:\Bruker\Dok\Format\PostenInterchange-Complete-002
PS14C-rev3.xsd">                                                                003
