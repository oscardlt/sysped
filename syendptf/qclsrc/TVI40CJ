             PGM        PARM(&PARM)
             DCL        VAR(&NAVNF) TYPE(*CHAR) LEN(30)
             DCL        VAR(&ARBAN0) TYPE(*CHAR) LEN(30)
             DCL        VAR(&EPOST) TYPE(*CHAR) LEN(70)
             DCL        VAR(&USER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&AV) TYPE(*CHAR) LEN(4)
             DCL        VAR(&OP) TYPE(*CHAR) LEN(7)
             DCL        VAR(&MRG) TYPE(*CHAR) LEN(1)
             DCL        VAR(&EMNE) TYPE(*CHAR) LEN(40)
             DCL        VAR(&BANE1) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BANE2) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BANE3) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BANE4) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BANE5) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BANE6) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BANE7) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BANE8) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BANE9) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN10) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN11) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN12) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN13) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN14) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN15) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN16) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN17) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN18) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN19) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN20) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN21) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN22) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN23) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN24) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN25) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN26) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN27) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN28) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN29) TYPE(*CHAR) LEN(140)
             DCL        VAR(&BAN30) TYPE(*CHAR) LEN(140)
             DCL        VAR(&PARM) TYPE(*CHAR) LEN(500)
             DCL        VAR(&EPOSTF) TYPE(*CHAR) LEN(70)
             DCL        VAR(&RPLNA) TYPE(*CHAR) LEN(8) +
                          VALUE('*CURRENT')
             DCL        VAR(&RPLAD) TYPE(*CHAR) LEN(8)
             DCL        VAR(&DOKMER) TYPE(*CHAR) LEN(40)
             DCL        VAR(&UNIK) TYPE(*CHAR) LEN(7) /* Unikkode */
             DCL        VAR(&ARKK) TYPE(*CHAR) LEN(8) +
                          VALUE('ARKIVMRG')
             DCL        VAR(&ARKN) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&ARKA) TYPE(*CHAR) LEN(7)
             DCL        VAR(&QUSER) TYPE(*CHAR) LEN(40)
             DCL        VAR(&LIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&NBR) TYPE(*CHAR) LEN(6)
/*______________*/
/* LES FIRMAFIL */
/*""""""""""""""*/
             DCLF       FILE(FIRMARC) RCDFMT(*ALL)
             RCVF       DEV(*FILE) RCDFMT(*FILE)
             RTVJOBA    USER(&QUSER) NBR(&NBR)
             CRTDUPOBJ  OBJ(ARKEPOW) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) NEWOBJ(WRKEPOW)
             MONMSG     MSGID(CPF0000)
   /*        CPYF       FROMFILE(*LIBL/ARKEPOW) TOFILE(WRKEPOW) +
                          MBROPT(*REPLACE) INCREL((*IF EPUSER *EQ +
                          &QUSER))  */
TAGF:        CHGVAR     VAR(&UNIK) VALUE('W' *CAT &NBR)
             CHGVAR     VAR(&EPOST) VALUE(%SST(&PARM 1 70))
             CHGVAR     VAR(&USER) VALUE(%SST(&PARM 71 10))
             CHGVAR     VAR(&AV) VALUE(%SST(&PARM 81 4))
             CHGVAR     VAR(&OP) VALUE(%SST(&PARM 85 7))
             CHGVAR     VAR(&MRG) VALUE(%SST(&PARM 92 1))
/*                      */
             CHGVAR     VAR(&RPLNA) VALUE(&QUSER)
             RTVNETA    SYSNAME(&RPLAD)
/*                      */
/* HENT REPLYADRESSE    */
/*                      */
/*                      */
             CALL       PGM(EPOS04N) PARM(&QUSER &RPLNA &RPLAD +
                          &EPOSTF &NAVNF)
/*                      */
/* LEGGER UT COVERPAGE  */
/* I SOURCE             */
/*                      */
             RTVDTAARA  DTAARA(FIRMDT (141 10)) RTNVAR(&LIB)
/*                      */
/* LEGGER UT QUSER      */
/* I ARKSRC             */
/*                      */
             ADDPFM     FILE(ARKSRC) MBR(&UNIK)
             MONMSG     MSGID(CPF0000)
             CLRPFM     FILE(ARKSRC) MBR(&UNIK)
             OVRDBF     FILE(ARKSRC) TOFILE(&LIB/ARKSRC) MBR(&UNIK)
             OVRDBF     FILE(ARKEPO) TOFILE(ARKEPOW)
             OVRDBF     FILE(ARKEPOL2) TOFILE(ARKEPOWL2)
/*                                     */
/* EVT SLÅ SAMMEN PDF                  */
/*                                     */
             IF         COND(&MRG *EQ 'J') THEN(DO)
             CALL       PGM(SYGE49) PARM(&ARKK &ARKN)
             CHGVAR     VAR(&ARKA) VALUE(&ARKN)
             CHGVAR     VAR(&ARBAN0) VALUE(&ARCANE *TCAT '/mrg')
             MD         DIR(&ARBAN0) DTAAUT(*RWX) OBJAUT(*ALL)
             MONMSG     MSGID(CPF0000)
             CHGVAR     VAR(&DOKMER) VALUE(&ARCANE *TCAT '/mrg/' *CAT +
                          &ARKA *CAT '.pdf')
             DEL        OBJLNK(&DOKMER)
             MONMSG     MSGID(CPF0000)
             CALL       PGM(TVI40R3) PARM(&USER &DOKMER)
             ENDDO

             CALL       PGM(TVI40R2) PARM(&USER &EMNE &AV &OP +
                          &BANE1 &BANE2 &BANE3 &BANE4 &BANE5 &BANE6 +
                          &BANE7 &BANE8 &BANE9 &BAN10 &BAN11 &BAN12 +
                          &BAN13 &BAN14 &BAN15 &BAN16 &BAN17 &BAN18 +
                          &BAN19 &BAN20 &BAN21 &BAN22 &BAN23 &BAN24 +
                          &BAN25 &BAN26 &BAN27 &BAN28 &BAN29 &BAN30)
/*                                       */
             ADDLIBLE   LIB(MMAIL)
             MONMSG     MSGID(CPF0000)
/*                                     */
/* SEND SOM VEDLEGG                    */
/*                                     */
             IF         COND(&BANE1 *NE '            ') THEN(DO)
             EMLSTMF    SUBJECT(&EMNE) FROMNAME(&NAVNF) +
                          FROMADDR(&EPOSTF) TO(&EPOST/'TVINN +
                          ekspressfortolling'/*TO) STMF(&BANE1 +
                          &BANE2 &BANE3 &BANE4 &BANE5 &BANE6 &BANE7 +
                          &BANE8 &BANE9 &BAN10 &BAN11 &BAN12 &BAN13 +
                          &BAN14 &BAN15 &BAN16 &BAN17 &BAN18 &BAN19 +
                          &BAN20 &BAN21 &BAN22 &BAN23 &BAN24 &BAN25 +
                          &BAN26 &BAN27 &BAN28 &BAN29 &BAN30) +
                          MSGM(&LIB/ARKSRC/&UNIK)
             RMVLIBLE   LIB(MMAIL)
             RMVM       FILE(ARKSRC) MBR(&UNIK)
             MONMSG     MSGID(CPF0000)
             ENDDO

             ENDPGM
