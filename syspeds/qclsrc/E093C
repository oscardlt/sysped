/* *********************************************************************   */
/*       * RETTINGER I DETTE PROGRAM:                                      */
/* PTFnr:*Sek Sig Vers  Beskrivelse..........................              */
/* """"""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""    */
/* 10XXX * 01 CB  PTF10 FJERNET ALL MERKING                                */
/* 10XXX * 02 JOV PTF10 NYTT SVAR (UNIX EMULATED BY FILEZILLA)           */
/* 12XXX * 03 YBC PTF10 FEIL MAPPE VED OPPDATERING AV EDISX              */
/* ********************************************************************    */
             PGM        PARM(&LIB &FILE &MBR &IIDS &IIDR &OK)
             /*_____________________*/
             /* Deklarere Variabler */
             /*"""""""""""""""""""""*/
             DCL        VAR(&LIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&FILE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&MBR) TYPE(*CHAR) LEN(10)
             DCL        VAR(&IIDR) TYPE(*CHAR) LEN(35)
             DCL        VAR(&IIDS) TYPE(*CHAR) LEN(35)
             DCL        VAR(&RMTSYS) TYPE(*CHAR) LEN(64)
             DCL        VAR(&WRKTCP) TYPE(*CHAR) LEN(80)
             DCL        VAR(&STS1) TYPE(*CHAR) LEN(20) VALUE('226 +
                          Transfer complet')
             DCL        VAR(&STS2) TYPE(*CHAR) LEN(20) VALUE('250 +
                          File transfer co')   /*AS/400 V 5.3 */
             DCL        VAR(&STS21) TYPE(*CHAR) LEN(20) VALUE('250 +
                          Transfer complet')
             DCL        VAR(&STS22) TYPE(*CHAR) LEN(20) VALUE('226 +
                          TRANSFERT TERMIN')
             DCL        VAR(&STS23) TYPE(*CHAR) LEN(20) VALUE('226 +
                          TRANSFER COMPLET')
             DCL        VAR(&STS24) TYPE(*CHAR) LEN(20) VALUE('226-+
                          File successfull')
             DCL        VAR(&STS25) TYPE(*CHAR) LEN(20) VALUE('226 +
                          File received ok')
             DCL        VAR(&STS26) TYPE(*CHAR) LEN(20) VALUE('226 +
                          Transfer OK     ')
             DCL        VAR(&STS27) TYPE(*CHAR) LEN(20) VALUE('226 +
                          File receive OK.')
             DCL        VAR(&STS28) TYPE(*CHAR) LEN(20) VALUE('226 +
                          File transfer co')   /*AS/400 V 5.4 */
             DCL        VAR(&STS29) TYPE(*CHAR) LEN(20) VALUE('226 +
                          Transfer Complet')
             DCL        VAR(&STS2A) TYPE(*CHAR) LEN(20) VALUE('226 +
                          transfer complet')
/*N02*/      DCL        VAR(&STS2B) TYPE(*CHAR) LEN(20) VALUE('226 +
                          Successfully tra')
             DCL        VAR(&STS2C) TYPE(*CHAR) LEN(20) VALUE('226 +
                          CCCCCCCCCCCCCCCC')
             DCL        VAR(&STS2D) TYPE(*CHAR) LEN(20) VALUE('226 +
                          DDDDDDDDDDDDDDDD')
             DCL        VAR(&STS2E) TYPE(*CHAR) LEN(20) VALUE('226 +
                          EEEEEEEEEEEEEEEE')
             DCL        VAR(&STS2F) TYPE(*CHAR) LEN(20) VALUE('226 +
                          FFFFFFFFFFFFFFFF')
             DCL        VAR(&STS2G) TYPE(*CHAR) LEN(20) VALUE('226 +
                          GGGGGGGGGGGGGGGG')
             DCL        VAR(&STS2H) TYPE(*CHAR) LEN(20) VALUE('226 +
                          HHHHHHHHHHHHHHHH')
             DCL        VAR(&STS2I) TYPE(*CHAR) LEN(20) VALUE('226 +
                          IIIIIIIIIIIIIIII')
             DCL        VAR(&STS2J) TYPE(*CHAR) LEN(20) VALUE('226 +
                          JJJJJJJJJJJJJJJJ')
             DCL        VAR(&STS3) TYPE(*CHAR) LEN(20)
             DCL        VAR(&OK) TYPE(*CHAR) LEN(2) VALUE('  ')
             DCL        VAR(&IFS) TYPE(*CHAR) LEN(1)
             DCL        VAR(&TIL) TYPE(*CHAR) LEN(256) VALUE('  ')
             DCL        VAR(&SSN) TYPE(*DEC) LEN(9 0)
             DCL        VAR(&SST) TYPE(*CHAR) LEN(1) VALUE(C)
             DCL        VAR(&NBRCURRCD) TYPE(*DEC) LEN(10 0)
             DCL        VAR(&TIL256B) TYPE(*CHAR) LEN(256) VALUE('  ')
             /*_______________*/
             /* Deklarere Fil */
             /*"""""""""""""""*/
             DCLF       FILE(EDI07C3S)
             CHGVAR     VAR(&SSN) VALUE(%SST(&MBR 2 9))
             /*____________________________________*/
             /* Hvilket bibliotek ligger filen i ? */
             /*""""""""""""""""""""""""""""""""""""*/
             IF         COND(&LIB *EQ '*LIBL     ' *AND &FILE *EQ +
                          'EDISE     ') THEN(DO)
             RTVDTAARA  DTAARA(EDIDTA (171 10)) RTNVAR(&LIB)
             ENDDO
             IF         COND(&LIB *EQ '*LIBL     ' *AND &FILE *EQ +
                          'EDISE1K   ') THEN(DO)
             RTVDTAARA  DTAARA(EDIDTA (171 10)) RTNVAR(&LIB)
             ENDDO
             IF         COND(&LIB *EQ '          ') THEN(RTVDTAARA +
                          DTAARA(EDIDTA (171 10)) RTNVAR(&LIB))
             /*_________________*/
             /* Lage streamfile */
             /*"""""""""""""""""*/
             IF         COND(&FILE *NE '*IFS      ') THEN(DO)
             CHGVAR     VAR(&TIL) VALUE(&LIB *TCAT '/' *TCAT &FILE +
                          *TCAT '/' *TCAT &MBR)
             CHGVAR     VAR(&TIL256B) VALUE('/' *TCAT &LIB *TCAT '/' +
                          *TCAT &FILE *TCAT '/BACKUP/' *TCAT &MBR)
             RMVLNK     OBJLNK(&TIL256B)
             MONMSG CPF0000
             IF         COND(&FILE *NE 'EDISE     ') THEN(DO)
             CALL       PGM(E093R31K) PARM(&IIDR &MBR &TIL)
             ENDDO
             IF         COND(&FILE *EQ 'EDISE     ') THEN(DO)
             CALL       PGM(E093R3) PARM(&IIDR &MBR &TIL)
             ENDDO
             CHGAUT     OBJ(&TIL) USER(*PUBLIC) DTAAUT(*RWX) +
                          OBJAUT(*ALL)
/*S03        CALL       PGM(EDISXR3) PARM(&MBR &TIL) */
/*N03*/      CALL       PGM(EDISXR3) PARM(&MBR &TIL256B)
             ENDDO
             /*_____________________________________________*/
             /* Generere fil for tcpip kommandoer og output */
             /*"""""""""""""""""""""""""""""""""""""""""""""*/
             DLTF       FILE(QTEMP/EDI07C3R)
             MONMSG     MSGID(CPF0000)
             CRTPF      FILE(QTEMP/EDI07C3R) RCDLEN(256) FRCRATIO(1) +
                          LVLCHK(*NO) AUT(*ALL)
             DLTF       FILE(QTEMP/EDI07C3S)
             MONMSG     MSGID(CPF0000)
             CRTPF      FILE(QTEMP/EDI07C3S) RCDLEN(256) FRCRATIO(1) +
                          LVLCHK(*NO) AUT(*ALL)
             CALL PGM(E093R) PARM(&LIB &FILE &MBR &IIDS &IIDR &RMTSYS &IFS &SSN)
             /*_______________*/
             /* Send VIA IFS ?*/
             /*"""""""""""""""*/
             IF         COND(&IFS *EQ 'Y') THEN(DO)
             CALL PGM(EDI46C) PARM(&LIB &FILE &MBR &IIDR &OK)
             CALL PGM(EDI46CG) PARM(&LIB &FILE &MBR &IIDR &OK)
             GOTO       CMDLBL(EXIT)
             ENDDO
             /*_______________*/
             /* Send over fil */
             /*"""""""""""""""*/
             /*VENT HVIS MOTPART ER ??? */
             IF COND(&IIDR *EQ '7080001240011') THEN(DLYJOB DLY(8))
             OVRDBF     FILE(INPUT) TOFILE(QTEMP/EDI07C3R)
             OVRDBF     FILE(OUTPUT) TOFILE(QTEMP/EDI07C3S)
             STRTCPFTP  RMTSYS(&RMTSYS) TBLFTPOUT(QTCPASCNO) +
                          TBLFTPIN(QTCPEBCNO)
             /*__________________*/
             /* Flytt streamfile */
             /*""""""""""""""""""*/
             IF         COND(&FILE *NE '*IFS') THEN(DO)
             MOV        OBJ(&TIL) TOOBJ(&TIL256B)
             MONMSG CPF0000
             ENDDO
             /*_____________________*/
             /* Status for sendning */
             /*"""""""""""""""""""""*/
             CHGVAR     VAR(&OK) VALUE('  ')
 READ:       RCVF       RCDFMT(*FILE)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(EXIT))
             CHGVAR     VAR(&STS3) VALUE(%SUBSTRING(&EDI07C3S 1 20))
             IF         COND((&STS3 *EQ &STS1) *OR (&STS3 *EQ &STS2) +
                          *OR (&STS3 *EQ &STS21) *OR (&STS3 *EQ +
                          &STS22) *OR (&STS3 *EQ &STS23) *OR (&STS3 +
                          *EQ &STS24) *OR (&STS3 *EQ &STS25) *OR +
                          (&STS3 *EQ &STS26) *OR (&STS3 *EQ &STS27) +
                          *OR (&STS3 *EQ &STS28) *OR (&STS3 *EQ &STS29) +
                          *OR (&STS3 *EQ &STS2A) *OR (&STS3 *EQ &STS2B) +
                          *OR (&STS3 *EQ &STS2C) *OR (&STS3 *EQ &STS2D) +
                          *OR (&STS3 *EQ &STS2E) *OR (&STS3 *EQ &STS2F) +
                          *OR (&STS3 *EQ &STS2G) *OR (&STS3 *EQ &STS2H) +
                          *OR (&STS3 *EQ &STS2I) *OR (&STS3 *EQ &STS2J) +
                        ) THEN(DO)
             CHGVAR     VAR(&OK) VALUE('OK')
             GOTO       CMDLBL(EXIT)
             ENDDO
             GOTO       CMDLBL(READ)
 EXIT:       IF         COND(&OK *EQ 'OK') THEN(CALL PGM(EDI06R) +
                          PARM(&SSN &SST &NBRCURRCD))
             IF         COND(&OK *NE 'OK') THEN(CALL PGM(EDI05R) +
                          PARM(&SSN))
             CALL       PGM(EDI054R) PARM(&SSN)
             ENDPGM
