             PGM        PARM(&AVD &FANR)
             DCL        VAR(&IN01) TYPE(*LGL) LEN(1) VALUE('0') /* +
                          Hvis &in01 på, AVBRYT PROGRAM               -
        */
             DCL        VAR(&FANR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&AVD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&P1) TYPE(*CHAR) LEN(2) VALUE('00')
             DCL        VAR(&P1E) TYPE(*CHAR) LEN(2) VALUE('00')
             DCL        VAR(&P1S) TYPE(*CHAR) LEN(2) VALUE('00')
             DCL        VAR(&P2) TYPE(*CHAR) LEN(1) VALUE('N')
             DCL        VAR(&P3) TYPE(*LGL) LEN(1) VALUE('0')
             DCL        VAR(&P4) TYPE(*LGL) LEN(1) VALUE('0')
             DCL        VAR(&P5) TYPE(*LGL) LEN(1) VALUE('0')
             DCL        VAR(&P6) TYPE(*LGL) LEN(1) VALUE('0')
             DCL        VAR(&P7) TYPE(*CHAR) LEN(1) VALUE('J')
             DCL        VAR(&P8) TYPE(*CHAR) LEN(1) VALUE('N')
             DCL        VAR(&P9) TYPE(*CHAR) LEN(1)
             DCL        VAR(&PRT) TYPE(*CHAR) LEN(10) /* Printernavn +
                          til fakturaer. */
             DCL        VAR(&PT) TYPE(*CHAR) LEN(10) /* Papirtype til +
                          fakturaer. */
             DCL        VAR(&PRTS) TYPE(*CHAR) LEN(10) /* Printernavn +
                          til fakturaer SJØ */
             DCL        VAR(&PTS) TYPE(*CHAR) LEN(10) /* Papirtype til+
                          fakturaer SJØ */
             DCL        VAR(&PRANT) TYPE(*CHAR) LEN(2) /* Antall +
                          utskrifter. */
             DCL        VAR(&UNIK) TYPE(*CHAR) LEN(10) /* Unikkode +
                          til register SORT. */
             DCL        VAR(&TIME) TYPE(*CHAR) LEN(9)
             DCL        VAR(&TYPE) TYPE(*CHAR) LEN(1)
             DCL        VAR(&GIRO) TYPE(*DEC) LEN(3 0) VALUE(027)
             DCL        VAR(&AVD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&GIRON) TYPE(*CHAR) LEN(10)
             DCL        VAR(&GIROP) TYPE(*CHAR) LEN(10)
             DCL        VAR(&FAKT) TYPE(*DEC) LEN(3 0) VALUE(004)
             DCL        VAR(&LASER) TYPE(*CHAR) LEN(1)
             DCL        VAR(&LPI) TYPE(*DEC) LEN(2 0) VALUE(06)
             DCL        VAR(&LPI2) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&LPP) TYPE(*DEC) LEN(3 0) VALUE(72)
             DCL        VAR(&PRT19) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PT19) TYPE(*CHAR) LEN(10)
             DCL        VAR(&NR19) TYPE(*DEC) LEN(3 0) VALUE(019)
             DCL        VAR(&LTYPE) TYPE(*CHAR) LEN(1)
             DCL        VAR(&LIB) TYPE(*CHAR) LEN(10)
    /* */
    /* */
    /* FIXER UDS                             */
    /* */
             CALL       PGM(SYFABKD) PARM(&AVD &FANR)
             IF         COND(&IN01 = '1') THEN(GOTO CMDLBL(SLUTT)) /* +
                          Hvis &IN01 på, avslutter program. */
    /* */
    /* */
    /* */
    /* TESTER LASER OG LPI                   */
    /* */
             RTVDTAARA  DTAARA(*LDA (15 4)) RTNVAR(&AVD)
             CALL       PGM(GETPR2) PARM(&AVD &FAKT &LASER &LPI2)

    /* */
    /* SETTER LPI TIL 08                     */
    /* */
             IF         COND(&LPI2 = 08) THEN(DO)
             CHGVAR     VAR(&LPP) VALUE(096)
             CHGVAR     VAR(&LPI) VALUE(08)
             ENDDO
    /* */
    /* */
    /* SETTEL ANTALL LINJER TIL 70/93 VED LASER */
    /* */
             IF         COND(&LASER = 'J') THEN(DO)
             CHGVAR     VAR(&LPP) VALUE('070')
             IF         COND(&LPI = 08) THEN(DO)
             CHGVAR     VAR(&LPP) VALUE('093')
             ENDDO
             ENDDO
    /*                                    */
    /* */
    /* */
    /* SKRIVER UT FAKTURAKOPI             */
    /*                                    */
             RTVDTAARA  DTAARA(*LDA (681 10)) RTNVAR(&PRT)
             RTVDTAARA  DTAARA(*LDA (691 10)) RTNVAR(&PT)
             RTVDTAARA  DTAARA(*LDA (961 10)) RTNVAR(&PRTS)
             RTVDTAARA  DTAARA(*LDA (971 10)) RTNVAR(&PTS)
             RTVDTAARA  DTAARA(*LDA (81 1)) RTNVAR(&LTYPE)
    /*                                    */
             OVRPRTF    FILE(FAKTURA) OUTQ(&PRT) PAGESIZE(72 85) +
                          CPI(10) OVRFLW(72) FORMTYPE(&PT)
             RTVDTAARA  DTAARA(*LDA (48 1)) RTNVAR(&TYPE)
             IF         COND(&TYPE *EQ B) THEN(OVRPRTF FILE(SYFA20P) +
                          DEVTYPE(*IPDS) PAGESIZE(&LPP 80) +
                          LPI(&LPI) CPI(10) OVRFLW(&LPP) FONT(011) +
                          CHRID(590 340) OUTQ(&PRT) FORMTYPE(&PT))
             ELSE       CMD(OVRPRTF FILE(SYFA20P) DEVTYPE(*SCS) +
                          PAGESIZE(&LPP 80) LPI(&LPI) CPI(10) +
                          OVRFLW(&LPP) OUTQ(&PRT) FORMTYPE(&PT))
             IF         COND(&LTYPE = 'S') THEN( +
             OVRPRTF    FILE(SYFA20PS) OUTQ(&PRTS) PAGESIZE(96 80) +
                          CPI(10) OVRFLW(96) FORMTYPE(&PTS))
             ELSE       CMD( +
             OVRPRTF    FILE(SYFA20PS) OUTQ(&PRTS) PAGESIZE(72 80) +
                          CPI(10) OVRFLW(72) FORMTYPE(&PTS))
             OVRPRTF    FILE(SYFA20PT) PAGESIZE(&LPP 80) LPI(&LPI) +
                          CPI(10) OVRFLW(&LPP) OUTQ(&PRTS) +
                          FORMTYPE(&PTS)
             OVRPRTF    FILE(SYFA20PD) OUTQ(&PRT) PAGESIZE(96 80) +
                          CPI(10) OVRFLW(96) FORMTYPE(&PT)
    /* FIX SEPARATE GIRO */
             RTVDTAARA  DTAARA(*LDA (15 4)) RTNVAR(&AVD)
             CALL       PGM(GETPRT) PARM(&AVD &GIRO &GIROP &GIRON)
    /* RETRIVE DEVICEDESCRIPTION */
             IF         COND(&TYPE *EQ B) THEN(OVRPRTF +
                          FILE(SYFA20PG) OUTQ(&GIROP) DEVTYPE(*IPDS) +
                          PAGESIZE(24 80) CPI(10) OVRFLW(24) +
                          FONT(011) CHRID(590 340) +
                          FORMTYPE(&GIRON))
             ELSE       CMD(OVRPRTF FILE(SYFA20PG) OUTQ(&GIROP) +
                          DEVTYPE(*SCS) PAGESIZE(24 80) CPI(10) +
                          OVRFLW(24) FORMTYPE(&GIRON))

    /* OGSÅ KOPI AV SAMLEFAKTURA KAN SKRIVES FRA SYFA20 */
             IF         COND(&TYPE *EQ B) THEN(OVRPRTF +
                          FILE(SYFA27PF) DEVTYPE(*IPDS) +
                          PAGESIZE(&LPP 80) LPI(&LPI) CPI(10) +
                          OVRFLW(&LPP) FONT(011) CHRID(590 340) +
                          OUTQ(&PRT) FORMTYPE(&PT))
             IF         COND(&TYPE *NE B) THEN(OVRPRTF +
                          FILE(SYFA27PF) DEVTYPE(*SCS) +
                          PAGESIZE(&LPP 80) LPI(&LPI) CPI(10) +
                          OVRFLW(&LPP) OUTQ(&PRT) FORMTYPE(&PT))
    /* OVERRIDE SPESIFICATION  */
             CALL       PGM(GETPRT) PARM(&AVD &NR19 &PRT19 &PT19)
             OVRPRTF    FILE(SYFA27PS) OUTQ(&PRT19) PAGESIZE(72 80) +
                          CPI(10) OVRFLW(63) PAGRTT(0) +
                          FORMTYPE(&PT19) SHARE(*YES) /* Pirnterfil +
                          av samlefaktura liste */
             OVRPRTF    FILE(SYFA27PP) OUTQ(&PRT19) PAGESIZE(72 80) +
                          CPI(10) OVRFLW(72) +
                          FORMTYPE(&PT19) /* Pirnterfil av +
                          samlefaktura liste */
    /* FIX SEPARATE GIRO */
             IF         COND(&TYPE *EQ B) THEN(OVRPRTF +
                          FILE(SYFA27PG) OUTQ(&GIROP) DEVTYPE(*IPDS) +
                          PAGESIZE(24 80) CPI(10) OVRFLW(24) +
                          FONT(011) CHRID(590 340) +
                          FORMTYPE(&GIRON))
             ELSE       CMD(OVRPRTF FILE(SYFA27PG) OUTQ(&GIROP) +
                          DEVTYPE(*SCS) PAGESIZE(24 80) CPI(10) +
                          OVRFLW(24) FORMTYPE(&GIRON))
    /* */
    /* */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&TIME)
    /*                                    */
             CHGVAR     VAR(&UNIK) VALUE('W' *CAT &TIME)
    /*                                    */
/* SORT OGSÅ I LØSNING 1 - INLIBL FOR Å SIKRE SORT I RIKTIG BIBL.*/
             RTVDTAARA  DTAARA(FIRMDT (141 10)) RTNVAR(&LIB)
             OVRDBF     FILE(SORT) TOFILE(&LIB/SORT)

             RMVM       FILE(SORT) MBR(&UNIK)
             MONMSG     MSGID(CPF7310)
             ADDPFM     FILE(SORT) MBR(&UNIK)
             OVRDBF     FILE(SORT) TOFILE(SORT) MBR(&UNIK)
    /* */
    /*                                    */
    /* */
             OVRMSGF    MSGF(QUSERMSG) TOMSGF(SYMSGF)
             CALL       PGM(SYFA20) PARM(&P1 &P1E &P1S &P2 &P3 &P4 +
                          &P5 &P6 &P7 &P8 &P9)
             SNDPGMMSG  MSG(' ' *BCAT &P1 *BCAT 'fakturakopierer er +
                          klare til utskrift på printer ' *BCAT &PRT +
                          *BCAT '.') MSGTYPE(*INFO)
             RMVM       FILE(SORT) MBR(&UNIK)
    /* */
 SLUTT:      ENDPGM
