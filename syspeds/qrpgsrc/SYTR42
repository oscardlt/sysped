********************************************************************
      *    Fremmede bilers bruk av VÅRE traller
      *    (tralle må tilhøre transp av type 2 = egen )
********************************************************************
     FHODE      IF   E           K DISK
     FUNITL01   IF   E           K DISK
     FTURER4    IF   E           K DISK
     FWRKCGI    UF A E           K DISK
     FSYTR42PF  O    E             PRINTER
     FFIRM      IF   E           K DISK
     FTRAN      IF   E           K DISK
     D                SDS
     D  ZJOB                 244    253
     D  ZUSER                254    263
     D  ZJOBNR               264    269  0
     D                 DS
     D  ENGAD3                 1     30
     D  SYPOGE                 1      9
     D  ADR3                  11     34
     D                 DS
     D  TUSJN1                 1     30
     D  TUSJ15                 1     15
     D                 DS
     D  XCÅM                   1      6  0
     D  TURACC                 1      2  0
     D  TURAAR                 3      4  0
     D  TURMND                 5      6  0
     D                 DS
     D  UCÅMT                  1      6  0
     D  UACC                   1      2  0
     D  UAARTds                3      4  0
     D  UPERTds                5      6  0
     D                 DS
     D  WDATA                  1    220
     D  VMNAVN                 1     30
     D  DSRMND                31     32
     D  DSRAAR                33     34
     D  TUBILN                35     44
     D  TUHENG                45     54
     D  TUSTEF                55     59
     D  DSTOFR                60     65
     D  TUSTET                66     70
     D  DSTOTI                71     76
     D  TUBILK                77     79
     D  DSAVD                 80     83
     D  DSPRO                 91     98
     D  DSRUND               101    108
     D  DSKNT2               111    118
     C*
     C                   EXSR      INIT
     C*
     C*
     C     UHEAD         IFEQ      'J'
     C     UHEAD         OREQ      'Y'
     C                   WRITE     HEADP
     C                   Z-ADD     9             ANTL              2 0
     C                   ELSE
     C                   WRITE     HEAD0
     C                   Z-ADD     4             ANTL
     C                   END
     C*
     C     TURKEY        SETLL     TURER4
     C*
     C     START         TAG
     C*
     C     *IN66         IFEQ      '0'
     C     UTRAN         READE     TURER4                                 32
     C  N32XCÅM          COMP      UCÅMT                              32
     C                   ELSE
      * 66 PÅ = ALLE TRANSPORTØRER
     C                   READ      TURER4                                 32
     C  N32UTRAN         IFNE      TUKNT2
     C                   MOVE      TUKNT2        UTRAN
     C     TURKEY        SETLL     TURER4
     C                   GOTO      START
     C                   END
      * Lest forbi tilperiode - finn neste transp..
     C  N32XCÅM          IFGT      UCÅMT
     C                   ADD       1             UTRAN
     C     TURKEY        SETLL     TURER4
     C                   GOTO      START
     C                   END
     C                   END
     C   32              GOTO      SLUTT
     C*
     C* TESTER BILKODE
     C*
     C     UBILK         IFNE      *BLANKS
     C     UBILK         ANDNE     TUBILK
     C                   GOTO      START
     C                   END
     C*
     C* TESTER Henger
     C*
     C     UHENG         IFNE      *BLANKS
     C     UHENG         ANDNE     TUHENG
     C                   GOTO      START
     C                   END
     C*
     C* SKJEKKER HENGER I UNITREGISTER
     C*
     C     HENGKE        CHAIN     UNITL01                            33
     C   33              GOTO      START
     C*
     C* SKJEKKER HENGERS TRANSPORTØR HAR KODE 2
     C*
     C     TRANK2        CHAIN     TRAN                               33
     C   33              GOTO      START
     C     VMINCR        IFNE      2
     C                   GOTO      START
     C                   END
     C*
     C* TRANSPORTØR NAVN HENTES
     C*
     C     TRANKE        CHAIN     TRAN                               33
     C*
     C     ANTL          IFGT      44
     C     UHEAD         IFEQ      'J'
     C     UHEAD         OREQ      'Y'
     C                   WRITE     HEADP
     C                   Z-ADD     9             ANTL
     C                   ELSE
     C                   WRITE     HEAD0
     C                   Z-ADD     4             ANTL
     C                   END
     C                   END
     C*
     C                   MOVE      TUDT          DATOFR            6 0
     C                   MOVE      TUDTT         DATOTI            6 0
     C     FIDTFM        IFNE      3
     C                   CALL      'DATFM3'
     C                   PARM                    FIDTFM
     C                   PARM                    DATOFR
     C                   CALL      'DATFM3'
     C                   PARM                    FIDTFM
     C                   PARM                    DATOTI
     C                   END
     C*
      * sort via legg ut i workfil / vent med skriving
     c     USORT         ifeq      'H'
     C                   MOVEL     TURMND        DSRMND
     C                   MOVEL     TURAAR        DSRAAR
     C                   MOVEL     DATOFR        DSTOFR
     C                   MOVEL     DATOTI        DSTOTI
     C                   MOVEL     TUAVD         DSAVD
     C                   MOVEL     TUPRO         DSPRO
     C                   MOVEL     TURUND        DSRUND
     C                   MOVEL     TUKNT2        DSKNT2
     C                   eval      WKEY2 = TUHENG+ ' ' + DSTOFR
     C                   write     WRKCGIR
     c                   else
      * normal sortering på stigende transportør
     C                   WRITE     DET
     C                   ADD       1             ANTL
     c                   end
     C*
     C                   GOTO      START
     C*
     C     SLUTT         TAG
      * sort via Hengernr
     c     USORT         ifeq      'H'
     C                   exsr      HENGSORT
     c                   end
     C                   SETON                                        LR
     C                   RETURN
     C*
     C*
     C*****************************************************************
     C     HENGSORT      BEGSR
     C*****************************************************************
      * Hvis vis vare siste slett andre en den med høyest dato pr Henger
     c     KunSiste      IFEQ      'J'
     C                   exsr      HENGDEL
     c                   end
      * List innhold fra hengersortert fil
     c     WINTEG        setLL     WRKCGI
     c     WINTEG        ReadE     WRKCGI                                 35
     c     *IN35         doweq     '0'
     C                   MOVEL     DSRMND        TURMND
     C                   MOVEL     DSRAAR        TURAAR
     C                   MOVEL     DSTOFR        DATOFR
     C                   MOVEL     DSTOTI        DATOTI
     C                   MOVEL     DSAVD         TUAVD
     C                   MOVEL     DSPRO         TUPRO
     C                   MOVEL     DSRUND        TURUND
     C                   MOVEL     DSKNT2        TUKNT2
     C     ANTL          IFGT      44
     C     UHEAD         IFEQ      'J'
     C     UHEAD         OREQ      'Y'
     C                   WRITE     HEADP
     C                   Z-ADD     9             ANTL
     C                   ELSE
     C                   WRITE     HEAD0
     C                   Z-ADD     4             ANTL
     C                   END
     C                   END
     C                   WRITE     DET
     C                   ADD       1             ANTL
     C                   delete    WRKCGIR
     c     WINTEG        ReadE     WRKCGI                                 35
     c                   end
     C                   ENDSR
     C*****************************************************************
     C     HENGdel       BEGSR
     C*****************************************************************
     c                   move      *blanks       GmlHeng          10
     c     WINTEG        setgt     WRKCGI
     c     WINTEG        ReadPE    WRKCGI                                 35
     c     *IN35         doweq     '0'
     c                   movel     WKey2         WrkHeng          10
     c     WrkHeng       ifeq      GmlHeng
     C                   delete    WRKCGIR
     c                   else
     C                   update    WRKCGIR
     c                   end
     c                   movel     WrkHeng       GmlHeng
     c     WINTEG        ReadPE    WRKCGI                                 35
     c                   end
     C                   ENDSR
     C*****************************************************************
     C     INIT          BEGSR
     C*****************************************************************
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UPER              2 0
     C                   PARM                    UAAR              2 0
     C                   PARM                    UPERT             2 0
     C                   PARM                    UAART             2 0
     C                   PARM                    UTRAN             8 0
     C                   PARM                    UBILK             3
     C                   PARM                    UHEAD             1
     C                   PARM                    UANT              3 0
     C                   PARM                    UHENG            10
     C                   PARM                    USORT             1
     C     UPERT         IFEQ      *ZEROS
     C                   MOVE      UAAR          UAART
     C                   MOVE      UPER          UPERT
     C                   END
     C                   MOVE      UAARt         UAARTds
     C                   MOVE      UPERt         UPERTds
      * sort via Hengernr
     c                   move      'N'           KunSiste          1
     c     USORT         ifeq      'S'
     c                   move      'J'           KunSiste          1
     c                   move      'H'           USORT
     c                   end
     c     USORT         ifeq      'H'
     C                   move      ZJOBNR        WINTEG            6 0
     c     WINTEG        setLL     WRKCGI
     c     WINTEG        ReadE     WRKCGI                                 35
     c     *IN35         doweq     '0'
     C                   delete    WRKCGIR
     c     WINTEG        ReadE     WRKCGI                                 35
     c                   end
     c                   end
      *
     C     TURKEY        KLIST
     C                   KFLD                    UTRAN
     C                   KFLD                    UACC
     C                   KFLD                    UAAR
     C                   KFLD                    UPER
     C     TRANKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    TUKNT2
     C     HENGKE        KLIST
     C                   KFLD                    TUHENG
     C     TRANK2        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    UNTRAN
     C     HODEK         KLIST
     C                   KFLD                    YNET
     C                   KFLD                    TUAVD
     C*
     C     UPER          IFEQ      0
     C                   MOVE      *ZEROS        UCÅM              6 0
     C                   MOVE      *ZEROS        UACC              2 0
     C                   ELSE
     C     UAAR          IFGT      50
     C     UAAR          ADD       1900          UCÅM
     C                   MOVE      19            UACC
     C                   ELSE
     C     UAAR          ADD       2000          UCÅM
     C                   MOVE      20            UACC
     C                   END
     C                   MULT      100           UCÅM
     C                   MOVE      UPER          UCÅM
     C                   END
      *
     C                   MOVE      ' '           YNET              1
     C                   MOVE      'K'           KODEKO            1
     C                   MOVE      'Y'           STAT              1
     C*
     C     UTRAN         COMP      *ZEROS                                 66
     C   66              Z-ADD     1             UTRAN
     C*
     C     UHEAD         IFEQ      'J'
     C     HODEK         CHAIN     HODE                               33
     C                   END
     C                   READ      FIRM                                   33
     C                   ENDSR
