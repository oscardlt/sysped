********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10199 * 01 YBC PTF10 TO NYE DATO FOR GATE IN OG OUT, OPSJON FOR ENDRING AV B/L
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11XXX * 02 YBC PTF11 beholde indikator etter ulike opsjoner
********************************************************************
      *
      **************************************************************
      *** PROGRAM SKAL SPØRRE PÅ CONTANERE                       ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER       ***
      *** LEDIGE INDIKATORER 01 02 04 06 07 09-11 13-24          ***
      *** LEDIGE INDIKATORER 27-29 32 34-40 45-90 99             ***
      **************************************************************
      *
S01  F*BLJOINLF  IF   E           K DISK
N01  FBLJOINL2  IF   E           K DISK
N01  FBLV1GATE  UF A E           K DISK    RENAME(BLV1GTR:BLV1R1)
N01  F                                     PREFIX(BV1_)
     FBILLOF    IF   E           K DISK    RENAME(BILLOFR:BILLOFPR)
N01  FHEADF     IF   E           K DISK
     FSYSJ18FM  CF   E             WORKSTN SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  BLDTAÅ                 1      4  0
     D  BLDTAM                 5      6  0
     D  BLDTAD                 7      8  0
     D  BLDTA                  1      8  0
     D                 DS
     D  XDTAD                  1      2  0
     D  XDTAM                  3      4  0
     D  XDTAÅ                  5      6  0
     D  XDTA                   1      6  0
     D                 DS
     D  BLMN                   1     17
     D  BVMN                   1     17
     D  BLMN15                 1     15
     D                 DS
     D  BLAVD                  1      4  0
     D  BVAVD                  1      4  0
     D                 DS
     D  BLOPD                  1      7  0
     D  BVOPD                  1      7  0
N01  D                 DS
N01  D  BV1_BVGTIN             1      8  0
N01  D  BV1_BVGTINA            1      4  0
N01  D  BV1_BVGTINM            5      6  0
N01  D  BV1_BVGTIND            7      8  0
N01  D                 DS
N01  D  BV1_BVGTUT             1      8  0
N01  D  BV1_BVGTUTA            1      4  0
N01  D  BV1_BVGTUTM            5      6  0
N01  D  BV1_BVGTUTD            7      8  0
N01  D                 DS
N01  D  WSGTIN                 1      6  0
N01  D  WSGTIND                1      2  0
N01  D  WSGTINM                3      4  0
N01  D  WSGTINA                5      6  0
N01  D                 DS
N01  D  WSGTUT                 1      6  0
N01  D  WSGTUTD                1      2  0
N01  D  WSGTUTM                3      4  0
N01  D  WSGTUTA                5      6  0
     D                UDS
     D  UFIRM                  1      2
N01  D  USG                   19     21
     C*
     C                   EXSR      INIT
     C*
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '0000'        *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
      *_____________
      * Fyll Subfile
      *"""""""""""""
S01  C*    BLJOIK        SETLL     BLJOINLF
N01  C     BLJOIK        SETLL     BLJOINL2
     C     START1        TAG
S01  C*                  READ      BLJOINLF                               94
N01  C                   EVAL      BVLI = 0
N01  C                   READ      BLJOINL2                               94
     C  N94              DO
     C                   MOVE      BLMN          XMNG             17
     C                   MOVE      BLAVD         XAVDG             4 0
     C                   MOVE      BLOPD         XOPDG             7 0
     C     BILLK         CHAIN     BILLOF                             33
     C   33              GOTO      START1
     C                   END
      *
     C     START2        TAG
      *
     C  N94              DO
     C                   DO        16
     C                   MOVE      XMNG          BLMN
     C                   MOVE      XAVDG         BLAVD
     C                   MOVE      XOPDG         BLOPD
     C                   ADD       1             ZRECNO
     C     BLST          COMP      'S'                                    31
     C                   EXSR      KDTFMT
     C                   WRITE     SUBFIL
     C     ST21          TAG
S01  C*                  READ      BLJOINLF                               94
N01  C                   EVAL      BVLI = 0
N01  C                   READ      BLJOINL2                               94
     C  N94              DO
     C                   MOVE      BLMN          XMNG             17
     C                   MOVE      BLAVD         XAVDG             4 0
     C                   MOVE      BLOPD         XOPDG             7 0
     C     BILLK         CHAIN     BILLOF                             33
     C   33              GOTO      ST21
     C                   END
     C  N94              END
     C                   END
     C*
     C                   MOVE      ZRECNO        XRECNO            4 0
     C     START3        TAG
     C  N30              Z-ADD     5             LINNBR
     C  N30              Z-ADD     2             POSNBR
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   WRITE     NYVARE
     C                   ELSE
     C                   WRITE     SUBCTL
     C                   END
     C                   EXFMT     BUNN
     C*** AVSLUTT
     C   03              GOTO      SLUTT
     C*** FRISK OPP
     C   05              GOTO      START
     C*** SØK FRA
     C   08              GOTO      START6
     C*
     C*** BLA VIDERE
     C   25              DO
     C                   Z-ADD     XRECNO        ZRECNO
N01  C                   MOVE      XMNG          BLMN
N01  C                   MOVE      XAVDG         BLAVD
N01  C                   MOVE      XOPDG         BLOPD
     C  N94BILLK         CHAIN     BILLOF                             33
     C                   SETOFF                                       25
     C                   GOTO      START2
     C                   END
     C*
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
S01  C*                  Z-ADD     WSSUBN        XRECNO            4 0
S01  C*    XRECNO        IFEQ      0
S01  C*                  Z-ADD     ZRECNO        XRECNO            4 0
S01  C*                  END
     C***
     C*
     C                   SETOFF                                       9830
     C*
     C     ZRECNO        IFEQ      0
     C                   GOTO      START3
     C                   ELSE
     C                   EXSR      BHENT
     C   98              GOTO      START3
     C                   END
     C*
N01  C                   IF        WSNR <> '2'
N02  C     BLST          COMP      'S'                                    31
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
N01  C                   END
     C*
N01  C                   SELECT
N01  C                   WHEN      XWSNR = '2'
N02  C     BLST          COMP      'S'                                    31
N01  C     BLST          IFNE      ' '
N01  C     BLST          ANDNE     'P'
N01  C                   MOVE      '1'           *IN98
N01  C                   MOVE      'SPO0006'     MSGNR
N01  C                   GOTO      START3
N01  C                   END
N01  C                   EXSR      CHGBL
N01  C                   GOTO      START3
N01  C                   WHEN      XWSNR = '9'
N01   *** ENDRE DATO FOR GATE IN/OUT
N01  C                   EXSR      CHGGTINUT
N01  C                   GOTO      START3
N01   *
N01  C                   WHEN      XWSNR = '5'
     C                   EXSR      UTBL
     C   03              GOTO      SLUTT
     C                   GOTO      START3
N01  C                   ENDSL
     C*
     C*** SØK FRA
     C     START6        TAG
     C                   EXFMT     VAREL3
     C   12              GOTO      START3
     C     W2MN          IFEQ      *BLANKS
     C                   GOTO      START6
     C                   END
     C                   GOTO      START
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
N01   ***********************************************
N01  C     CHGBL         BEGSR
N01   ***********************************************
N01  C                   MOVE      BLAVD         UAVD2
N01  C                   MOVE      BLOPD         UOPD2
N01  C                   MOVE      USG           USG2
N01  C                   MOVE      'N'           UKUNB
N01  C                   MOVE      *ZEROS        UAVD3
N01  C                   MOVE      *ZEROS        UOPD3
N01  C     BLUR          IFEQ      'F'
N01  C                   Z-ADD     1             UFLAGG
N01  C                   ELSE
N01  C                   Z-ADD     2             UFLAGG
N01  C                   END
N01  C     BILLK         CHAIN     HEADF                              33
N01  C     HEUR          IFEQ      'H'
N01  C     BLUR          IFEQ      'F'
N01  C                   Z-ADD     8             UFLAGG
N01  C                   ELSE
N01  C                   Z-ADD     9             UFLAGG
N01  C                   END
N01  C                   END
N01   *
N01  C                   EXSR      WRKBL
N01   *
N01  C     *IN90         IFEQ      '0'
N01  C                   MOVE      BLMN          XMNG2            17
N01  C     BILLK         CHAIN     BILLOF                             33
N01  C                   MOVE      XMNG2         BLMN
N01  C                   MOVE      *BLANKS       WSNR
N01  C                   UPDATE    SUBFIL
N01  C                   END
N01   *
N01  C                   ENDSR
N01   *
N01   ***********************************************
N01  C     WRKBL         BEGSR
N01   ***********************************************
N01  C                   CALL      'SYSJ50I'
N01  C                   PARM                    UAVD2             4 0
N01  C                   PARM                    UOPD2             7 0
N01  C                   PARM                    USG2              3
N01  C                   PARM                    UKUNB             1
N01  C                   PARM                    UAVD3             4 0
N01  C                   PARM                    UOPD3             7 0
N01  C                   PARM                    UFLAGG
N01  C                   PARM      0             ULUNIK            9 0
N01   *
N01  C                   ENDSR
N01   *
N01   ***********************************************
N01  C     CHGGTINUT     BEGSR
N01   ***********************************************
N01  C     BLV1K         CHAIN(N)  BLV1GATE                           33
N01  C                   IF        *IN33
N01  C                   EVAL      WSGTIN  = 0
N01  C                   EVAL      WSGTUT  = 0
N01  C                   ELSE
N01  C                   MOVE      BV1_BVGTINA   WSGTINA
N01  C                   EVAL      WSGTINM = BV1_BVGTINM
N01  C                   EVAL      WSGTIND = BV1_BVGTIND
N01  C                   MOVE      BV1_BVGTUTA   WSGTUTA
N01  C                   EVAL      WSGTUTM = BV1_BVGTUTM
N01  C                   EVAL      WSGTUTD = BV1_BVGTUTD
N01  C                   END
N01   *
N01  C     STCHG         TAG
N01  C                   EXFMT     BILDE01
N01  C                   MOVEA     '00'          *IN(89)
N01   *
N01   * TEST GATE OUT
N01  C                   IF        WSGTUT <> 0
N01  C                   MOVE      WSGTUTA       UAA               2 0
N01  C                   MOVE      WSGTUTM       UMM               2 0
N01  C                   MOVE      WSGTUTD       UDD               2 0
N01  C                   CALL      'TESTDATO'
N01  C                   PARM                    UDD
N01  C                   PARM                    UMM
N01  C                   PARM                    UAA
N01  C                   PARM                    UFLAGG            1 0
N01  C                   IF        UFLAGG = 1
N01  C                   EVAL      *IN90 = *ON
N01  C                   EVAL      *IN30 = *ON
N01  C                   MOVE      'SPD0001'     MSGNR
N01  C                   GOTO      STCHG
N01  C                   END
N01  C                   END
N01   * TEST GATE IN
N01  C                   IF        WSGTIN <> 0
N01  C                   MOVE      WSGTINA       UAA               2 0
N01  C                   MOVE      WSGTINM       UMM               2 0
N01  C                   MOVE      WSGTIND       UDD               2 0
N01  C                   CALL      'TESTDATO'
N01  C                   PARM                    UDD
N01  C                   PARM                    UMM
N01  C                   PARM                    UAA
N01  C                   PARM                    UFLAGG            1 0
N01  C                   IF        UFLAGG = 1
N01  C                   EVAL      *IN89 = *ON
N01  C                   EVAL      *IN30 = *ON
N01  C                   MOVE      'SPD0001'     MSGNR
N01  C                   GOTO      STCHG
N01  C                   END
N01  C                   END
N01   *
N01  C     BLV1K         CHAIN     BLV1GATE                           33
N01  C                   IF        WSGTIN = 0
N01  C                   EVAL      BV1_BVGTIN = 0
N01  C                   ELSE
N01  C                   EVAL      BV1_BVGTIN = 20000000 +
N01  C                             WSGTINA * 10000 + WSGTINM * 100 + WSGTIND
N01  C                   END
N01  C                   IF        WSGTUT = 0
N01  C                   EVAL      BV1_BVGTUT = 0
N01  C                   ELSE
N01  C                   EVAL      BV1_BVGTUT = 20000000 +
N01  C                             WSGTUTA * 10000 + WSGTUTM * 100 + WSGTUTD
N01  C                   END
N01  C                   IF        *IN33
N01  C                   EVAL      BV1_BVAVD = BLAVD
N01  C                   EVAL      BV1_BVOPD = BLOPD
N01  C                   EVAL      BV1_BVLI  = BVLI
N01  C                   EVAL      BV1_BVMN  = BLMN
N01  C                   WRITE     BLV1R1
N01  C                   ELSE
N01  C                   UPDATE    BLV1R1
N01  C                   END
N01   *
N01  C                   ENDSR
N01   *
     C***********************************************
     C     UTBL          BEGSR
     C***********************************************
     C                   Z-ADD     1             UFLAGG            1 0
     C                   MOVE      BLAVD         UAVD              4 0
     C                   MOVE      BLOPD         UOPD              7 0
     C                   CALL      'SYSJ52I'
     C                   PARM                    UAVD
     C                   PARM                    UOPD
     C                   PARM                    BLSG
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      3                                      03
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     BHENT         BEGSR
     C***********************************************
N01  C                   MOVE      *BLANKS       XWSNR             1
     C                   MOVEA     '00'          *IN(91)
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C  N98WSNR          IFEQ      '5'
N01  C     WSNR          OREQ      '2'
N01  C     WSNR          OREQ      '9'
N01  C                   MOVE      WSNR          XWSNR
     C                   GOTO      SLHENT
     C                   END
     C                   END
     C*
     C     SLHENT        TAG
     C   98              DO
     C                   MOVE      'DIV0012'     MSGNR
     C                   SETON                                            30
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     BILLK         KLIST
     C                   KFLD                    BLAVD
     C                   KFLD                    BLOPD
N01  C     BLV1K         KLIST
N01  C                   KFLD                    BLAVD
N01  C                   KFLD                    BLOPD
N01  C                   KFLD                    BVLI
     C     BLJOIK        KLIST
     C                   KFLD                    W2MN
     C                   KFLD                    W2AVD
     C                   KFLD                    W2OPD
     C*
     C                   MOVE      *ZEROS        BLDTA
     C                   MOVE      *ZEROS        XDTA
     C                   MOVE      *ZEROS        BLAVD
     C                   MOVE      *ZEROS        BLOPD
     C                   MOVE      *BLANKS       BLMN
     C*
     C                   WRITE     NYVARE
     C                   EXFMT     VAREL3
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
     C                   MOVE      BLDTAD        UDT1              2 0
     C                   MOVE      BLDTAM        UDT2              2 0
     C                   MOVE      BLDTAÅ        UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          XDTAD
     C                   MOVE      UDT2          XDTAM
     C                   MOVE      UDT3          XDTAÅ
     C*
     C                   ENDSR
     C*
