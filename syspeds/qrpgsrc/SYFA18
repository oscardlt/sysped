      *   PTF-TIPS!
      *   OBS! VED DATOENDRING BØR EN SJEKK OM DET ER TR.MODUL OG I SÅ FALL: FRA-TIL-DATO
      ***********************************************************
      *** PROGRAM SKAL SETTE GODSNR. OG DATO PÅ ETT TURNR.    ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01 02 04-26                      ***
      *** LEDIGE INDIKATORER 27-29 31 34-49 55-92             ***
      ***********************************************************
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 nå også bilnr (avd/tur/cont flyttet 2 linjer opp i DDS)
10XXX * 02 JOV PTF10 tving oppdatering hvis godsnummer finnes
10XXX * 03 JOV PTF10 Tur på tvers av avdeling + rette feil i PTF02 / dafault J i Overskriv G.nr
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
10XXX * 04 JOV PTF11 F4 = SØK I GODSJOURNAL (HVIS LISENS)  ETTER GODS NR
11040 * 05 SH  PTF11 sette posisjonsnumre på en hel tur
11040 * 06 JOV PTF11 Oppdater også turdato dersom oppdragsdato endres
      *              OBS! VED DATOENDRING BØR EN SJEKK OM DET ER TR.MODUL OG I SÅ FALL: FRA-TIL-DATO
********************************************************************
      *
     FHEADF     UF   E           K DISK
s03  F*HEAD8     IF   E           K DISK
s03  F*                                     RENAME(HEADFR:HEAD8R)
N03  FHEAD14    IF   E           K DISK
N03  F                                     RENAME(HEADFR:HEAD14R)
N06  FTURER14   UF   E           K DISK
N06  FFIRM      IF   E           K DISK
     FKODTA     IF   E           K DISK
     FKODTS4    IF   E           K DISK
     FKODTS2    IF   E           K DISK
N04  FSYPROD    IF   E           K DISK
     FSYFA18FM  CF   E             WORKSTN
S06  D*                DS
S06  D* HEDTÅ                  1      4  0
S06  D* HEDTM                  5      6  0
S06  D* HEDTD                  7      8  0
S06  D* HEDTOP                 1      8  0
N06  D                 DS
N06  D  WSDT8                  1      8  0
N06  D   WsDTÅCC               1      2  0
N06  D   WsDTÅ                 3      4  0
N06  D   WsDTM                 5      6  0
N06  D   WsDTD                 7      8  0
     C*
     C                   EXSR      INIT
     C*
     C     START         TAG
     C                   EXSR      KDTFMT
     C                   EXFMT     BILDE
     C                   EXSR      KDTFMT
     C                   SETOFF                                       305251
     C                   MOVEA     '000000'      *IN(94)
     C*
     C   03              GOTO      SLUTT
      * SØK
N04  C     *IN04         IFEQ      *ON
N04   *  etter godnr i godsregistreringen
N04  C     *IN55         IFEQ      *OFF                                         GODSJOUR-LISENS
N04  C                   MOVE      'P'           UPLUKK            1
N04  C                   MOVEL     WSGN          XXXGN            15
N04  C                   MOVEL     *BLANKS       XXXMOT           15
N04  C                   MOVEL     *BLANKS       XXXMRN           18
N04  C                   CALL      'SYTL01CL'
N04  C                   PARM                    UPLUKK
N04  C                   PARM                    XXXGN
N04  C                   PARM                    XXXMOT
N04  C                   PARM                    XXXMRN
N04  C     XXXGN         IFNE      *BLANKS
N04  C                   MOVEL     XXXGN         WSGN
N04  C                   END
N04  c                   SETOFF                                       30
N04  C                   GOTO      START
N04  C                   ENDIF                                                  end 55 oFF=GNR
NO¤   *
N04  C                   ENDIF
      *
     C                   EXSR      TESTB
     C   30              GOTO      START
N05  C                   move      wspro         upro              8 0
     C*
     C                   EXSR      MERK
N05  C     wsbytt        ifeq      'J'
N05  C     wsbytt        oreq      'M'
N05  C                   exsr      possr
N05  c                   end
     C                   GOTO      START
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     TESTB         BEGSR
     C***********************************************
     C                   Z-ADD     0             WSANT
N02  C                   Z-ADD     0             WSANTI
     C                   SETOFF                                       9596
     C                   SETOFF                                       93
     C*
     C**** TEST AVDELING
N03  c     WSAVD         IFNE      *ZEROS
     C     KODTAK        CHAIN     KODTA                              99
     C   99              MOVE      'SPA0001'     MSGNR
     C   99              SETON                                        30
     C   99              GOTO      SLTB
N03  c                   endif
      **** TEST TURNR.
     C     WSPRO         COMP      0                                      94
N03  C  N94WSPRO         chain     HEAD14                             94
     C   94              MOVE      'SPT0014'     MSGNR
     C   94              SETON                                        30
     C   94              GOTO      SLTB
     C*
     C*** SYINN 230492  TEST TRANSPORTMÅTE OG SJEKK OM ENTEN GODSNR,
     C*                 DATO ELLER TRANSPORTMÅTE ER FYLT INN
     C*
     C*** TEST TRANSPORTMÅTE
     C     WSTRM         IFNE      0
     C                   SETON                                        54
     C     KODS4K        CHAIN     KODTS4                             96
     C   96
     CANN30              MOVE      'SPT0003'     MSGNR
     C   96              SETON                                        30
     C   96              GOTO      SLTB
     C                   ELSE
     C                   SETOFF                                       54
     C                   END                                                    <WSTRM
     C*** TEST TRANSPORTIDENTITET LANDKODE
     C     WSTRI         IFNE      *BLANKS
     C                   SETON                                        50
     C     KODS2K        CHAIN     KODTS2                             93
     C   93
     CANN30              MOVE      'SPL0016'     MSGNR
     C   93              SETON                                        30
     C   93              GOTO      SLTB
     C                   ELSE
     C                   SETOFF                                       50
     C                   END                                                    <WSTRM
     C*
     C*** TEST OM INGEN AV GODSNR/DATO/TRANS.MÅTE ER TASTET
     C     WSGN          COMP      *BLANKS                            5252
     C*
     C     WSTRM         IFEQ      0
     C     WSGN          ANDEQ     *BLANKS
     C     WSDT          ANDEQ     0
N03  C     WSBILN        ANDEQ     *BLANKS
     C                   MOVE      'SPG0001'     MSGNR
     C                   SETON                                        3095
     C                   GOTO      SLTB
     C                   END                                                    <WSTRM
     C*** SYUT  230492
     C*
     C*** TEST DATO
     C                   MOVE      '0'           *IN51
     C     WSDT          IFNE      0
     C                   MOVE      WSDT          XMMÅÅ             4 0
     C                   MOVE      XMMÅÅ         UDTÅ              2 0
     C                   MOVEL     XMMÅÅ         UDTM              2 0
     C                   MOVEL     WSDT          UDTD              2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDTD
     C                   PARM                    UDTM
     C                   PARM                    UDTÅ
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      97
     C   97              MOVE      'SPD0001'     MSGNR
     C   97              SETON                                        30
     C   97              GOTO      SLTB
N06  C                   MOVE      20            WsDTÅCC
N06  C                   MOVE      UDTÅ          WsDTÅ
N06  C                   MOVE      UDTM          WsDTM
N06  C                   MOVE      UDTD          WsDTD
     C                   MOVE      '1'           *IN51
     C                   END
     C*
     C     WSTRCN        COMP      *BLANKS                            5353
     C*
     C     SLTB          ENDSR
     C*
     C***********************************************
     C     MERK          BEGSR
     C***********************************************
      *
N06  C                   MOVE      'I'           IMEX              1
     C                   SETOFF                                       33
S03  C*    HEAD8K        SETLL     HEAD8
N03  C     WSPRO         SETLL     HEAD14
     C*
     C     STM           TAG
s03  C*    HEAD8K        READE     HEAD8                                  33
N03  C     WSPRO         READE     HEAD14                                 33
      * slutt leseloop
     C   33              GOTO      SLM
      *
      * ikke ta med eksport
     C     HEUR          IFEQ      'B'
     C     HEUR          OREQ      'D'
     C     *IN50         IFEQ      '1'
     C     *IN52         OREQ      '1'
     C     *IN53         OREQ      '1'
     C     *IN54         OREQ      '1'
     C                   GOTO      STM
     C                   END
     C                   END
N03   * KUN AVD
N03  C     WSAVD         IFNE      *ZEROS
N03  C     HEAVD         ANDNE     WSAVD
N03  C                   GOTO      STM
N03  C                   END
     C*
     C   53WSTRCN        IFNE      HETRCN
     C                   GOTO      STM
     C                   END
      *
      * ikke bytte hvis godsnummer finnes
      *
N03  c     WSGN          ifne      *blanks
N02  c     wstvin        ifeq      'N'
N02  c     hegn          andne     *blanks
N02  c                   add       1             wsanti
n02  c                   goto      stm
n02  c                   end
N03  c                   endif
      *
     C     HEADFK        CHAIN     HEADF                              32
     C  N32              DO
     C   54              MOVE      WSTRM         HETRM
     C   50              MOVE      WSTRI         HETRI
     C   52              MOVE      WSGN          HEGN
S06  C*  51              MOVE      UDTD          HEDTD
S06  C*  51              MOVE      UDTM          HEDTM
S06  C*  51              MOVE      UDTÅ          HEDTÅ
S06  C*  51UDTÅ          IFGT      50
S06  C*                  MOVEL     '19'          HEDTÅ
S06  C*                  ELSE
S06  C*                  MOVEL     '20'          HEDTÅ
S06  C*                  END
N06  C   51              MOVE      WSDT8         HEDTOP
N06  C   51              IF        HEUR = 'H'
N06  C                             AND HELKA = FILAND                           FRA NO=EXP/INNL.
N06  C                   MOVE      'E'           IMEX
N06  C                   MOVE      WSDT8         TRSDFD
N06  C                   Else                                                   ellers IMP
N06  C                   MOVE      'I'           IMEX
N06  C                   MOVE      WSDT8         TRSDTD
N06  C                   ENDIF
N01  c     WSBILN        ifne      *blanks
N01  c                   movel     WSBILN        HEHAWB
N01  c                   endif
      *
     C                   UPDATE    HEADFR
     C                   ADD       1             WSANT
     c   52              call      'SYFA18B'
     C                   parm                    HEAVD
     C                   parm                    HEOPD
     C                   END
     C                   GOTO      STM
     C*
     C     SLM           TAG
      * DATO ENDRET ? - ENDRE AVT OGSÅ PÅ TURHEADER  - IMPORT=TILDATO ELLERS FRADATO
N06  C     WSDT          IFNE      0
N06  C     WSPRO         chain     TURER14                            33
N06  C     *IN33         IFeq      '0'
N06  C                   IF        IMEX='I'
N06  C                   move      WSDT8         TUDTT
N06  C                   ELSE
N06  C                   move      WSDT8         TUDT
N06  C                   ENDIF
N06  C                   UPDATE    TURERR
N06  C                   ENDIF
N06  C                   ENDIF
     C*
     C     WSANT         COMP      0                                      30
     C   30              MOVE      'DIV0392'     MSGNR
     C  N30              MOVE      *BLANKS       WSGN
     C  N30              MOVE      *ZEROS        WSTRM
     C  N30              MOVE      *ZEROS        WSDT
     C  N30              MOVE      *ZEROS        WSPRO
     C  N30              MOVE      *BLANKS       WSTRCN
N01  C  N30              MOVE      *BLANKS       WSBILN
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
N02  c*                  move      'N'           wstvin
N03  c                   move      'J'           wstvin
     C     HEADFK        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
s03  C*    HEAD8K        KLIST
s03  C*                  KFLD                    WSAVD
s03  C*                  KFLD                    WSPRO
     C     KODTAK        KLIST
     C                   KFLD                    YAUNI
     C                   KFLD                    WSAVD
     C     KODS4K        KLIST
     C                   KFLD                    XS4UNI
     C                   KFLD                    WSTRM
     C     KODS2K        KLIST
     C                   KFLD                    XS2UNI
     C                   KFLD                    WSTRI
     C*
     C                   MOVE      'A'           YAUNI             1
     C                   MOVE      *ZEROS        WSDT
     C                   MOVE      *ZEROS        HEDTOP
N06  C                   MOVE      *ZEROS        WSDT8
     C*
     C                   MOVE      'S4 '         XS4UNI            3
     C                   MOVE      'S2 '         XS2UNI            3
      *
N06  C     *LOVAL        SETLL     FIRM
N06  C                   READ      FIRM
N04   * 55 OFF = GODSJOURNAL I BRUK
N04  C                   MOVEL     'SYGODS  '    PRODNA           15
N04  C     PRODNA        CHAIN     SYPROD                             55
N06  C  N55PRINST        COMP      'J'                                5555
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
     C                   MOVE      WSDT          XDTFMT            4 0
     C                   MOVEL     WSDT          UDT1              2 0
     C                   MOVEL     XDTFMT        UDT2              2 0
     C                   MOVE      XDTFMT        UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVEL     UDT1          WSDT
     C                   MOVEL     UDT2          XDTFMT
     C                   MOVE      UDT3          XDTFMT
     C                   MOVE      XDTFMT        WSDT
     C*
     C                   ENDSR
     C*
     C*
n05  C***********************************************
n05  C     possr         BEGSR
n05  C***********************************************
n05  c                   call      'SYGE77'
n05  c                   parm                    upro
n05  c                   parm                    wsbytt
n05  c                   parm                    wsleng
n05  c                   endsr
