      *
      ***********************************************************
      *** PROGRAM SKAL kopiere til cdbrenning
      ***********************************************************
      *
     Farkivl07  UF   E           K DISK
     Ffirm      IF   E           K DISK
     Ffirmarc   IF   E           K DISK
     Farktxt    IF   E           K DISK
     FARKEXT    IF   E           K DISK    PREFIX(Y_)
     FARC041FM  CF   E             WORKSTN
     D                 DS
     D  DSTID                  1     14  0
     D  UDATO                  1      6  0
     D  UDAG                   7      8  0
     D  UMND                   9     10  0
     D  UAAR                  11     14  0
     D                 DS
     D  tilpera                1      8
     D  tilper                 1      8s 0
     D  wsatil                 1      4s 0
     D  wsptil                 5      6s 0
     D  wsdtil                 7      8s 0
     C*
     C                   EXSR      INIT
     C*
     C     START         TAG
     c                   exfmt     BILDE01
     c   03              goto      slutt
     c                   exsr      testb1
     c  n10              goto      start
     c   30              goto      start
      *
      * sletter PDF
      *
     c     artype        ifeq      '**'
     C                   EXSR      LESTXT
     c                   else
     c                   EXSR      DELPDF
     c                   end
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     testb1        BEGSR
     C***********************************************
     c* test
     c*
     c                   setoff                                       707130
     c     wsatil        ifgt      uaar
     c                   seton                                        7030
     C                   MOVE      'SHU1005'     MSGNR
     C                   end
     c     wsatil        ifeq      uaar
     c     wsptil        andge     umnd
     c                   seton                                        7030
     C                   MOVE      'SHU1006'     MSGNR
     c                   end
      *
     c     artype        ifne      '**'
     c     artype        chain     arktxt                             71
     c     *in(71)       ifeq      '1'
     c                   seton                                        30
     C                   MOVE      'SHU1007'     MSGNR
     c                   end
     c                   end
     C     SLTB          ENDSR
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     c     keypdf0       klist
     c                   kfld                    fifirm
     c                   kfld                    artype
     c                   kfld                    stdato
     c     keypdf1       klist
     c                   kfld                    fifirm
     c                   kfld                    artype
     C     LagKey        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    ARKLAG
     C                   TIME                    DSTID            14 0
     c                   move      *blanks       bane             40
     c                   move      *blanks       umappe           15
     c                   move      *zeros        tilper
     C*
     c                   read      firm                                   33
     c                   read      firmarc                                33
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     LESTXT        BEGSR
     C***********************************************
      *
     C                   SETOFF                                       33
     C     *IN(33)       DOWEQ     '0'
     C                   READ      ARKTXT                                 33
     C     *IN(33)       IFEQ      '0'
     c                   exsr      DELPDF
     c                   end
     c                   end
     c                   endsr
     C*
     C***********************************************
     C     DELPDF        BEGSR
     C***********************************************
     C* hvis eksternt lager som ikke finnes el. er på annen server / ikke delete link ...
     c                   move      *blanks       Y_ARCANE
     c                   move      *off          *in36
     C     ARKLAG        IFNE      *BLANKS
     C     LagKey        CHAIN     ARKEXT                             36
     c  N36Y_ARCPAD      comp      ARCPAD                             3636
     c                   END
     c     *in36         cabeq     '1'           UtDel
     c                   setoff                                       34
     c                   move      *zeros        stdato            8 0
     c     keypdf0       setll     arkivl07
     c     *in(34)       doweq     '0'
     c     keypdf1       reade     arkivl07                               34
     c  N34ARDATE        comp      tilper                             34
     c     *in(34)       ifeq      '0'
     c     arlink        andne     *blanks
     c                   delete    arkivr
     c     arlink        ifne      arlinkfo
     c     arlink        andne     *blanks
     c                   exsr      delpdf2
     c                   end
     c                   move      arlink        arlinkfo         40
     c                   end
     c                   end
     c     UtDel         endsr
     C*
     C***********************************************
     C     DELPDF2       BEGSR
     C***********************************************
     C*
     c                   move      *blanks       fradok           70
     c     Y_ARCANE      ifeq      *blanks
     c                   movel     arcane        fradok
     c                   else
     c                   movel     Y_ARCANE      fradok                         annet lager/samme IP
     c                   end
     C     fradok        CAT       '/':0         fradok
     C     fradok        CAT       arlink:0      fradok
     C     '.'           SCAN      arlink                                 35
     C     *in35         ifeq      '0'
     C     fradok        CAT       '.pdf':0      fradok
     c                   end
     c                   call      'ARC041C1'
     c                   parm                    fradok
     c                   endsr
