NC    * KUNDENR I ECMSG SKAL LEGGES I OPPDRAGSGIVER (TRKNFA)
XXX   * MIDLETID ENDRINGER
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
      * BL Rettinger merket BL er laget av Bring IT
      *****
P9XXX * 01 YBC PTF9 SKILLE Booking OG Instruction
P9XXX * 02 YBC PTF9 OPPDATERING PÅ REFERANSE, SE E-POST 6/5-08
      *             + DIVERSE ENDRINGER.  SE E-POST 7/5-08
P9XXX * 03 YBC PTF9 UTEN KUBIKK
P9XXX * 04 YBC PTF9 ENDRE ROT-ELEMENT
P9XXX * 05 YBC PTF9 OPPDATER ARBEIDSGIVENR PÅ FRISØKEVEI
P9XXX * 06 YBC PTF9 DET KAN VÆRE FLERE ROTTE TEGN.
P9XXX * 07 YBC PTF9 AUTOOPPDATERING VED "INSTRUCTION"
P9XXX * 08 YBC PTF9 FEILRETTING PÅ <TermsOfDelivery>
P9XXX * 09 YBC PTF9 Konverter <TransportLegId>
P9XXX * 10 YBC PTF9 Oppdater "DeliveryParty" og "DespatchParty"
P9XXX * 11 YBC PTF9 Nye rettelser
P9XXX * 12 YBC PTF9 <NoOfCharacters>
P9XXX * 13 YBC PTF9 FEILRETTING PÅ KOLLI-ID
P9XXX * 14 YBC PTF9 OPPDATER ADRESSEINFO. PÅ ZNADSF
P9XXX * 15 YBC PTF9 KONVERTERE LASTEMETER
P9XXX * 16 YBC PTF9 SISTE BLANK AV POST BEVARES
10XXX * 17 YBC PTF9 MESSAGE DETAILS
10XXX * 18 YBC PTF9 SUMMARY SET
10XXX * 19 YBC PTF9 FEILRETTING PÅ DATO
10XXX * 20 YBC PTF9 <TarriffReference> --> PREFIX TIL REFERANSE
10XXX * 21 YBC PTF9 RETT FEIL LESREC
10XXX * 22 YBC PTF9 OPPDATER CONTAINERNR PÅ FRISOK
10XXX * 23 YBC PTF9 OPPDRAGSDATO=ArrivalDateEstimated I SummarySet
10XXX * 24 YBC PTF9 KUBIKK SETTES TIL 0 VED <Volum> IKKE FINNES.
      *             NYE ENHETKODER FOR <Height>, <Length> og <Width>
10XXX * 25 YBC PTF9 FLY-MODUL summaryIdType = 741
NC    * 25 AMT Oversjø=704, samme regler som for 741
10XXX * 26 YBC PTF9 MOTTAKERS LK=NO, AVSENDERS LK<>NO --> OPPD.TYPE=BI
10XXX * 27 YBC PTF10 OPPDATE CONTAINER-INFO PÅ BLV1
10XXX * 28 YBC PTF10 <ns0:Transport erstater <Transport etter hvert
10XXX * 29 YBC PTF10 ReceivingAgent --> Finne HEKNA
10XXX * 30 YBC PTF10 FEIL I LESREC, TEST < ETTER LESE REKORD
10XXX * 31 YBC PTF10 FEIL OPPDATERT VOLUM I ZLV1
10XXX * 32 YBC PTF10 TAKLE <Consignment> med id, type og uten
10XXX * 33 YBC PTF10 OPPDRAGSTYPE: MAIL FRA ANNE 14.10.2011
10XXX * 34 YBC PTF10 OPPDATER DespatchingAgent/ReceivingAgent på FRISOK
10XXX * 35 YBC PTF10 FLYMODUL: AWB OG HAWB
10XXX * 36 YBC PTF10 TransportOrderDate oppdateres på firsøkevei
10XXX * 37 YBC PTF10 Linenr på ZOKUFM
10XXX * 38 YBC PTF10 SEND FEIL VED <SummarySet> ikke finnes
10XXX * 39 YBC PTF10 TEST LENGDE PÅ PACKAGE
10XXX * 40 YBC PTF10 MESSAGE DETAILS UTEN >
10XXX * 41 YBC PTF10 FEIL POSISJON VED <Consignment>
10XXX * 42 YBC PTF10 messageFunction = Expediting. --> HEREFF=XP+ref(med TIN)
10XXX * 43 YBC PTF10 Oppdater <PickupDateEarliest> på TRACKT
10XXX * 44 YBC PTF10 Hvis <PickupDate> og <DocumentDate> kommer sammentidig,
10XXX *              prioritere <PickupDate>.       Ref. Anne Teisbo, mail 18.02.2013
10XXX *              Tilbake kalles av Ref. Anne Teisbo, mail 18.02.2013
10XXX * 45 YBC PTF10 OPPDATER HXEDIK FOR Å SENERE SENDE InstructionConfirmation
10XXX *              P for Booking/Expediting --> SEND IC ved SYOP21R/SYFI10X
10XXX *                        messageFunction = BookingConfirmation
10XXX *              B for Booking            --> SEND IC ved SYOP21R
10XXX *                        messageFunction = BookingConfirmation
10XXX *              X for Instruction        --> SEND IC ved SYOP21R/SYFI10X
10XXX *                        messageFunction = InstructionConfirmation
10XXX *             VED SYOP21R MÅ XMLCMR DEFINERT. VED SYFI10X MÅ XMLINH DEFINERT
10XXX * 46 YBC PTF10 HAK-FRISØKEVEI SKAL IKKE OPPDATERES VED KVÆRNER 916297807
10XXX * 47 YBC PTF10 OPPDATER CMR-FRISØKEVEI PÅ IFB-FRISØKEVEI HVIS IFB IKKE FINNES
10XXX * 48 YBC PTF10 OPPDATER FORPAKNINGSTYPE PÅ FMLEDI I ZOKUFM
10XXX * 49 YBC PTF10 DK: BasicServiceCode=0336 --> HEOT=PD
10XXX * 50 YBC PTF10 OPPDATER FORPAKNINGSTYPE PÅ FMLEDI I ZOKUFM
      *              VED DANMARK OG OPPDRAGSTYPE=PD
10XXX * 51 YBC PTF10 FEILKODE PÅ N3035 VED DespatchParty og DeliveryParty
10XXX * 52 YBC PTF10 DK: BasicServiceCode=3568 --> HEOT=PD  som endring 49
10XXX * 53 YBC PTF10 Bruke <Street> og <AddressLine> i stedet for <POBox>
10XXX * 54 YBC PTF10 VED DK: Prepaid = DDP Collect  = EXW ThirdParty= EXW
10XXX * 55 YBC PTF10 OPPDATER <FreeText> på DOK29
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11XXX * 56 YBC PTF11 AVVIS OPPDRAG NÅR testIndicator="YES"
11XXX * 57 YBC PTF11 OPPDATER HEKNKF/TRKDFF VED <Party> FreightPayer/87
11XXX * 58 YBC PTF11 OXP OPPDRAG OPPDATERES DIREKTE I HEADF (KALL PÅ SYXML13D)
11XXX * 59 YBC PTF11 IKKE OPPDATER FRISØKEVEI VED KODE=PCI
11XXX * 60 YBC PTF11 OPPDATER HEGM1/2 FRA <Reference> MED KODE = AAQ
11XXX * 61 YBC PTF11 <Text> MED KODE=DEL KAN VÆRE VELDIG LANG.
********************************************************************
     FFIRM      IF   E           K DISK
     FEDIRE1K   IF   E           K DISK
     FECMSG3    IF   E           K DISK
     FEDIC      UF   E             DISK
     FEDIS      UF A E           K DISK
     FEDIM      O  A E             DISK
S14  F*CUNDL01   UF   E           K DISK
N14  FCUNDL01   IF   E           K DISK
N14  FVADR      IF   E           K DISK
N14  FKUNKO2    IF   E           K DISK
N27  FCDCON4    IF   E           K DISK
N07  FFERDL01   IF   E           K DISK
     FFIRFB     UF   E           K DISK
     FFRISOL01  IF   E           K DISK    RENAME(FRISOKR:FRISOKR1)
     F                                     PREFIX(FS1_)
N08  FHEADF     IF   E           K DISK    RENAME(HEADFR:HEADFRDRI)
N08  F                                     PREFIX(DRI_)
N29  FSYPARL1   IF   E           K DISK    RENAME(SYPARFR:SYPARFR1)
N29  FSYPARL3   IF   E           K DISK    RENAME(SYPARFR:SYPARFR3)
N58  FEDIAVD    IF   E           K DISK
     FZTELL     UF A E           K DISK
     FZEADL01   UF A E           K DISK
     FZRISOK    O  A E             DISK
N47  FZRISOL02  IF   E           K DISK    RENAME(FRISOKR:ZRISOKR2)
N47  F                                     PREFIX(ZS2_)
     FZREETXT   O  A E             DISK
     FZOKUFM    O  A E             DISK
     FZOKUFV    O  A E             DISK
N55  FZOK29     O  A E             DISK
N14  FZNADSF    O  A E             DISK
N43  FZTRACKT   O  A E             DISK
N27  FZLV1      O  A E             DISK
N08   *
N08  D REF             S             35    DIM(200)
      *
     D*XINHOUSE        C                   CONST('<InHouse version')
S04  D*XINHOUSE        C                   CONST('<InHouse ')
N04  D XINHOUSE        C                   CONST('<Transport ')
N28  D XINHOUSENY      C                   CONST('<ns0:Transport ')
     D  XINHOUSE1      C                   CONST('messageId="')
N01  D  XINHOUSE2      C                   CONST('collaboration="')
N36  D  XINHOUSE3      C                   CONST('messageFunction="')
N56  D  XINHOUSE4      C                   CONST('testIndicator="YES"')
S40  D*XMSGDETAIL      C                   CONST('<MessageDetails>')
N40  D XMSGDETAIL      C                   CONST('<MessageDetails')
N17  D  XMSGDET1       C                   CONST('<MessageSender')
N17  D  XMSGDET2       C                   CONST('<MessageRecipient')
N17  D  XMSGDET3       C                   CONST('<MessageDate')
     D XSPARTY         C                   CONST('<PartyStructure>')
     D  XSPARTY1       C                   CONST('<PartySet>')
     D  XSPARTY1END    C                   CONST('</PartySet>')
     D* XSPARTY2       C                   CONST('<Party subClass')
     D  XSPARTY2       C                   CONST('<Party')
     D  XSPARTY3       C                   CONST('<ReferenceNo>')
     D  XSPARTY4       C                   CONST('partyId="')
     D  XSPARTY5       C                   CONST('subClass="')
     D XDATSTR         C                   CONST('<DateAndTimeStructure>')
     D  XDATSTR1       C                   CONST('<DateAndTimesSet>')
     D  XDATSTR2       C                   CONST('<DateAndTimes subClass')
     D  XDATSTR3       C                   CONST('<Year>')
     D  XDATSTR4       C                   CONST('<Month>')
     D  XDATSTR5       C                   CONST('<Day>')
     D  XDATSTR6       C                   CONST('<Hour>')
     D  XDATSTR7       C                   CONST('<Minute>')
     D XCONSTR         C                   CONST('<ConsignmentStructure>')
N18  D XCONSTR1        C                   CONST('<ConsignmentStructure')
N08  D XCONSTREND      C                   CONST('</ConsignmentStructure>')
N25  D XSUMSET         C                   CONST('<SummarySet')
N25  D  XSUMSET1       C                   CONST('summaryId="')
N25  D  XSUMSET2       C                   CONST('summaryIdType="')
N25  D  XSUMSET3       C                   CONST('subClass="')
N33  D XLOCATION       C                   CONST('<Location')
N33XXD  XLOCATION0     C                   CONST('<Location>')
N33  D  XLOCATION1     C                   CONST('subClass="')
N33  D  XLOCATION2     C                   CONST('locationId="')
N33  D  XLOCATION3     C                   CONST('idType="')
N33  D  XLOCATION4     C                   CONST('<LocationName>')
N33  D  XLOCATION5     C                   CONST('<CountryCode>')
N33  D XLOCATIONE      C                   CONST('</Location>')
     D XCONSET         C                   CONST('<ConsignmentSet>')
     D XCONSIGNM       C                   CONST('<Consignment')
N32  D XCONSIGNMA      C                   CONST('<Consignment>')
     D  XCONSIGNM1     C                   CONST('<TotalGrossWeight')
     D  XCONSIGNM2     C                   CONST('<TotalVolume')
     D  XCONSIGNM3     C                   CONST('<NumberOfPackages>')
     D  XCONSIGNM3A    C                   CONST('<NumberOfPackages')
N15  D  XCONSIGNM4     C                   CONST('<LoadingMetres')
E08  D XCONSIGNMEND    C                   CONST('</Consignment>')
     D XPACKAGE        C                   CONST('<Package>')
     D XPACKAGEX       C                   CONST('<Package')
     D  XPACKAGE1      C                   CONST('<Marking>')
N03  D  XPACKAGE1E     C                   CONST('</Marking>')
     D  XPACKAGE2      C                   CONST('<GrossWeight')
     D  XPACKAGE2E     C                   CONST('</GrossWeight>')
     D  XPACKAGE3      C                   CONST('<Volume')
     D  XPACKAGE3E     C                   CONST('</Volume>')
     D  XPACKAGE3F     C                   CONST('<Volume/>')
     D  XPACKAGE4      C                   CONST('packageId="')
     D  XPACKAGE5      C                   CONST('<FreeText>')
     D  XPACKAGE5E     C                   CONST('</FreeText>')
     D  XPACKAGE5F     C                   CONST('<FreeText/>')
     D  XPACKAGE6      C                   CONST('<Reference>')
     D  XPACKAGE6E     C                   CONST('</Reference>')
     D  XPACKAGE6F     C                   CONST('<Reference/>')
     D  XPACKAGE7      C                   CONST('idType="')
     D  XPACKAGE8      C                   CONST('<Height')
     D  XPACKAGE8E     C                   CONST('</Height>')
     D  XPACKAGE8F     C                   CONST('<Height/>')
     D  XPACKAGE9      C                   CONST('<Width')
     D  XPACKAGE9E     C                   CONST('</Width>')
     D  XPACKAGE9F     C                   CONST('<Width/>')
     D  XPACKAGEA      C                   CONST('<Length')
     D  XPACKAGEAE     C                   CONST('</Length>')
     D  XPACKAGEAF     C                   CONST('<Length/>')
     D  XPACKAGEB      C                   CONST('<PackageTypeCode>')
     D  XPACKAGEBE     C                   CONST('</PackageTypeCode>')
     D  XPACKAGEBF     C                   CONST('<PackageTypeCode/>')
     D  XPACKAGEC      C                   CONST('<PackageTypeText>')
     D  XPACKAGECE     C                   CONST('</PackageTypeText>')
     D  XPACKAGECF     C                   CONST('<PackageTypeText/>')
N15  D  XPACKAGED      C                   CONST('<LoadingMetres')
N15  D  XPACKAGEDE     C                   CONST('</LoadingMetres>')
N15  D  XPACKAGEDF     C                   CONST('<LoadingMetres/>')
N15  D  XPACKAGEEND    C                   CONST('</Package>')
S01  D*XFREETEXT       C                   CONST('<Freetext>')
N01  D XFREETEXT       C                   CONST('<FreeText>')
     D  XFREETEXT1     C                   CONST('<Usage>')
     D  XFREETEXT2     C                   CONST('<Text>')
N12  D  XFREETEXT3     C                   CONST('<NoOfCharacters>')
N12  D  XFREETEXT3F    C                   CONST('<NoOfCharacters/>')
     D XREF            C                   CONST('<Reference>')
     D  XREF1          C                   CONST('<ReferenceNo>')
     D  XREF2          C                   CONST('<ReferenceType>')
     D XCGISET         C                   CONST('<ConsignmentGoodsItemSet>')
     D XCGISETT        C                   CONST('<ConsignmentGoodsItemSet/>')
     D XGOODSI         C                   CONST('<GoodsItem>')
     D XGOODSIX        C                   CONST('<GoodsItem')
     D  XGOODSI1       C                   CONST('<GoodsDescription>')
     D  XGOODSI2       C                   CONST('<NumberOfPackages>')
     D  XGOODSI3       C                   CONST('<PackageTypeCode>')
     D  XGOODSI4       C                   CONST('<Reference>')
     D  XGOODSI5       C                   CONST('<GrossWeight')
     D XMPARTY         C                   CONST('<Party')
     D  XMPARTY01      C                   CONST('subClass="')
     D  XMPARTY02      C                   CONST('partyId="')
     D  XMPARTY03      C                   CONST('idType="')
     D  XMPARTY1       C                   CONST('<Name>')
     D  XMPARTY2       C                   CONST('<AccountNo>')
     D  XMPARTY3       C                   CONST('<Address')
     D  XMPARTY4       C                   CONST('<PostalCode>')
     D  XMPARTY5       C                   CONST('<City>')
     D  XMPARTY6       C                   CONST('<AddressLine>')
     D  XMPARTY7       C                   CONST('<POBox>')
     D  XMPARTY8       C                   CONST('<PostOffice>')
     D  XMPARTY9       C                   CONST('<CountryCode>')
     D  XMPARTYA       C                   CONST('<Street>')
     D XEQUIPM         C                   CONST('<Equipment>')
     D XEQUIPMTOM      C                   CONST('<Equipment/>')
     D  XEQUIPM1       C                   CONST('<EquipmentType>')
     D  XEQUIPM2       C                   CONST('<Height')
     D  XEQUIPM3       C                   CONST('<Width')
     D  XEQUIPM4       C                   CONST('<Length')
N22  D  XEQUIPM5       C                   CONST('<EquipmentId>')
N22  D  XEQUIPM6       C                   CONST('<EquipmentQuantity>')
N27  D  XEQUIPM7       C                   CONST('<EquipmentCode>')
N27  D  XEQUIPM8       C                   CONST('<Weight')
N27  D  XEQUIPM9       C                   CONST('<Volume')
     D XCOD            C                   CONST('<Cod>')
     D XCODTOM         C                   CONST('<Cod/>')
     D  XCOD1          C                   CONST('<CodType')
     D  XCOD2          C                   CONST('<CodAmount')
     D XDGOODS         C                   CONST('<DangerousGoods>')
     D XDGOODSTOM      C                   CONST('<DangerousGoods/>')
     D  XDGOODS1       C                   CONST('<UNNo>')
     D  XDGOODS2       C                   CONST('<Commodity>')
     D  XDGOODS3       C                   CONST('<Class>')
     D  XDGOODS4       C                   CONST('<Group>')
     D XTRALEG         C                   CONST('<TransportLeg>')
     D XTRALEGTOM      C                   CONST('<TransportLeg/>')
     D  XTRALEG1       C                   CONST('<TransportLegId>')
N25  D  XTRALEG2       C                   CONST('<Location')
N25  D  XTRALEG3       C                   CONST('subClass="')
     D XTOD            C                   CONST('<TermsOfDelivery>')
     D  XTOD1          C                   CONST('<TODConditionCode>')
     D  XTOD2          C                   CONST('<TODConditionCodeList>')
N08  D  XTOD2A         C                   CONST('<TODConditionCodeList')
     D  XTOD3          C                   CONST('<TODLocation>')
     D XCHARGE         C                   CONST('<Charges>')
     D XCHARGETOM      C                   CONST('<Charges/>')
     D  XCHARGE1       C                   CONST('<ChargeItem>')
     D  XCHARGE2       C                   CONST('<ChargeCode>')
     D  XCHARGE3       C                   CONST('<ChargeText>')
     D  XCHARGE4       C                   CONST('<VATCode>')
     D  XCHARGE5       C                   CONST('<GrossAmount>')
     D  XCHARGE6       C                   CONST('<Comment>')
     D XSERVIC         C                   CONST('<Service>')
     D XSERVICTOM      C                   CONST('<Service/>')
     D  XSERVIC1       C                   CONST('<BasicServiceCode')
N49  D  XSERVIC1X      C                   CONST('<BasicServiceCode>')
N20  D  XSERVIC2       C                   CONST('<TariffReference>')
     D XMDAT           C                   CONST('<DateAndTimes')
     D XMDATTOM        C                   CONST('<DateAndTimes/>')
     D  XMDAT1         C                   CONST('<Year>')
     D  XMDAT2         C                   CONST('<Month>')
     D  XMDAT3         C                   CONST('<Day>')
     D  XMDAT4         C                   CONST('<Hour>')
     D  XMDAT5         C                   CONST('<Minute>')
     D XCUSINF         C                   CONST('<CustomsInformation>')
     D XCUSINFTOM      C                   CONST('<CustomsInformation/>')
     D  XCUSINF1       C                   CONST('<CustomsClearanceNo>')
     D  XCUSINF2       C                   CONST('<CustomsValue')
     D XOFFER          C                   CONST('<Offer>')
     D XOFFERTOM       C                   CONST('<Offer/>')
     D  XOFFER1        C                   CONST('<FreeText>')
     D XINSUR          C                   CONST('<Insurance>')
     D XINSURTOM       C                   CONST('<Insurance/>')
     D  XINSUR1        C                   CONST('<InsuranceValue')
     D  XINSUR2        C                   CONST('<GoodsDescription>')
     D                 DS
     D  RDATA1                 1   1024
N03  D  RDATA1X              600   1024
     D  RDATA2              1025   2048
N03  D  RDATA2X             1625   2048
     D  RDATA3                 1   2048
     D  RDATAXX              900   1024
     D  IN                     1   2048    DIM(2048)
N12  D                 DS
N12  D  RDATA                  1   1024
N12  D  RDATAX               700   1024
N12  D                 DS
N12  D  RDATA10                1   2048
SXX  D* RDATA10X            1700   2048
NXX  D  RDATA10X            1500   2048
NXX  D  RDATA10Y            1025   2048
     D                 DS
     D  XTXT                   1   1024
     D  XT80                   1   1024    DIM(1024)
     D                 DS
     D  XSTEGN                 1     10
     D  XST10                  1     10    DIM(10)
     D                 DS
     D  XTAL                   1     15  5
     D  XTALH                  1     10  0
     D  XTALD                 11     15  0 DIM(5)
     D                 DS
     D  XMDT                   1      8  0
     D  XMDTÅ                  1      4  0
     D  XMDTM                  5      6  0
     D  XMDTD                  7      8  0
     D                 DS
     D  XMTM                   1      6  0
     D  XMTMT                  1      2  0
     D  XMTMM                  3      4  0
N17  D  XMTMS                  5      6  0
     D                 DS
     D  XT17                   1     17
     D  XT                     1     17    DIM(17)
     D                 DS
     D  HEDTOP                 1      8  0
     D  HEDTOPÅ                1      4  0
     D  HEDTOPM                5      6  0
     D  HEDTOPD                7      8  0
N23  D                 DS
N23  D  XARRDATE               1      8  0
N23  D  XARRDATEA              1      4  0
N23  D  XARRDATEM              5      6  0
N23  D  XARRDATED              7      8  0
     D                 DS
     D  TRSDFD                 1      8  0
     D  TRSDFDÅ                1      4  0
     D  TRSDFDM                5      6  0
     D  TRSDFDD                7      8  0
     D                 DS
     D  TRSDTD                 1      8  0
     D  TRSDTDÅ                1      4  0
     D  TRSDTDM                5      6  0
     D  TRSDTDD                7      8  0
N43  D                 DS
N43  D  TXEX2D                 1      8  0
N43  D  TXEX2DÅ                1      4  0
N43  D  TXEX2DM                5      6  0
N43  D  TXEX2DD                7      8  0
     D                 DS
     D  UFN17A                 1      2
     D  UFN17B                 3      7
     D  UFN17C                 8     17
     D  UFN17                  1     17
NC   D                 DS
NC   D  NCXT35                 1     35
NC   D  NCXT                   1     35    DIM(35)
N18  D UC              C                   CONST('ABCDEFGHIJKLMNOPQRST-
N18  D                                     UVWXYZÆØÅ')
N18  D LC              C                   CONST('abcdefghijklmnopqrst-
N18  D                                     uvwxyzæøå')
      *
      *
     C                   EXSR      SRINIT
      *
     C     WMBR          SETLL     EDIRE1K
     C     WMBR          READE     EDIRE1K                                50
     C     *IN50         CABEQ     *ON           SLUTT
     C                   MOVE      RDATA         RDATA2
     C                   EXSR      LESREC
     C                   Z-ADD     1             WPOS
     C*    XINHOUSE      SCAN      RDATA         WPOS              4 0    51
     C     XINHOUSE      SCAN      RDATA3        WPOS              4 0    51
N28  C  N51XINHOUSENY    SCAN      RDATA3        WPOS              4 0    51
NC   C                   IF        *IN51 = *OFF
NC   C                   EVAL      XMSGTXT = 'DET ER IKKE EN INHOUSE XML.'
NC   C                   END
     C     *IN51         CABEQ     *OFF          SLUTT
N56   * TEST OM testIndicator="YES"
N56  C                   MOVE      WPOS          XWPOS             4 0
N56  C     XINHOUSE4     SCAN      RDATA3:WPOS   WPOS                     51
N56  C                   IF        *IN51
N56  C                   EVAL      XMSGTXT = 'testIndicator="YES"'
N56  C                   GOTO      SLUTT
N56  C                   END
N56  C                   MOVE      XWPOS         WPOS
N01   * LES collaboration="
N01  C     XINHOUSE2     SCAN      RDATA3:WPOS   WPOS              4 0    51
N01  C                   DOW       *IN51 = *OFF
N01  C                   EXSR      LESREC
N01  C     XSLUTTLES     CABEQ     'J'           SLUTT
N01  C     XINHOUSE2     SCAN      RDATA3:WPOS   WPOS              4 0    51
N01  C  N51              ENDDO
N01  C                   ADD       15            WPOS
N01  C                   EXSR      GETTXT
N01  C                   MOVEL     XTXT          XCOLLA           15
N36   * LES messageFunction="
N36  C     XINHOUSE3     SCAN      RDATA3:WPOS   WPOS              4 0    51
N36  C                   DOW       *IN51 = *OFF
N36  C                   EXSR      LESREC
N36  C     XSLUTTLES     CABEQ     'J'           SLUTT
N36  C     XINHOUSE3     SCAN      RDATA3:WPOS   WPOS              4 0    51
N36  C  N51              ENDDO
N36  C                   ADD       17            WPOS
N36  C                   EXSR      GETTXT
N36  C                   MOVEL     XTXT          XMSGFUN          15
      * LES messageId="
     C     XINHOUSE1     SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLUTT
     C     XINHOUSE1     SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
     C                   ADD       11            WPOS
     C                   EXSR      GETTXT
     C                   MOVEL     XTXT          XMSGID           30
N17   *
N17   * SJEKK OM DET FINNES <MessageDetails>
N17  C     XMSGDETAIL    SCAN      RDATA3:WPOS   WPOS              4 0    51
N17  C                   IF        *IN51
N17  C                   EXSR      SRMSGDET
N17  C                   ELSE
      *
S08   * Hent avsenders postnr
S08  C*                  EXSR      HENTAVSPN
      * LES <PartyStructure>
N17  C                   Z-ADD     1             WPOS
     C     XSPARTY       SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLUTT
     C     XSPARTY       SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
      * LES meldingsavsender/mottaker
     C                   MOVE      *BLANKS       XXREFNR          35
     C                   EXSR      SRSPARTY
NC   C                   IF        XFEIL = 'J'
NC   C                   EVAL      XMSGTXT = 'MELDINGS AVSENDER ER FEIL.'
NC   C                   END
     C     XFEIL         CABEQ     'J'           SLUTT
     C     XSLUTTLES     CABEQ     'J'           SLUTT
     C                   EXSR      SRSPARTY
NC   C                   IF        XFEIL = 'J'
NC   C                   EVAL      XMSGTXT = 'MELDINGS MOTTAKER ER FEIL.'
NC   C                   END
     C     XFEIL         CABEQ     'J'           SLUTT
     C     XSLUTTLES     CABEQ     'J'           SLUTT
      *
      * LES meldingsdato/tid
     C                   MOVE      *BLANKS       XXREFNR          35
     C                   EXSR      SRDATSTR
NC   C                   IF        XSLUTTLES = 'J'
NC   C                   EVAL      XMSGTXT = 'MELDINGS DATA/TID ER FEIL.'
NC   C                   END
N17   *
N17  C                   END
N17   *
     C     XSLUTTLES     CABEQ     'J'           SLUTT
      * Oppdater EDI-LOGG
     C                   EXSR      OPDEDIS
     C     ECMSG3K       CHAIN     ECMSG3                             33
NC   C                   IF        *IN33
NC   C                   EVAL      XMSGTXT = 'AVSENDERS-ID (' + %TRIM(S0004)
NC   C                             + ') ELLER MOTTAKERS-ID (' + %TRIM(S0010)
NC   C                             + ') ER IKKE DEFINERT.'
NC   C                             + ' ELLER MELDING ER IKKE DEFINERT.'
NC   C                   EXSR      SRERROR
NC   C                   END
     C     *IN33         CABEQ     *ON           SLUTT
      *
N08   * Hent referanse
N42  C                   IF        XMSGFUN = 'Expediting'
N42  C                   EXSR      HENTREFTIN
N42  C                   ELSE
NC   C                   EXSR      HENTTRALEG
N42  C                   END
NC   C                   IF        XREFOK = 'N'
N20  C                   EXSR      HENTTARREF
N08  C                   EVAL      XSLUTTLES = 'N'
N08  C     WMBR          SETLL     EDIRE1K
N08  C     WMBR          READE     EDIRE1K                                50
N08  C                   MOVE      RDATA         RDATA2
N08  C                   EXSR      LESREC
N08  C                   Z-ADD     1             WPOS
NC    * Hent referanse med kode = 'CU'
NC   C                   IF        S0004 = '879932262'                          KRIFON
NC   C                   EXSR      HENTREFCU
NC   C                   ELSE
N08   * Hent avsenders postnr
N08  C                   EXSR      HENTAVSPN
NC   C                   END
NC   C                   END
N08   *
N08  C                   EVAL      XSLUTTLES = 'N'
N08  C                   EVAL      XNREF = 1
N08  C                   EVAL      XREFF = REF(XNREF)
      *
      * Start konvertering
     C     WMBR          SETLL     EDIRE1K
     C     WMBR          READE     EDIRE1K                                50
     C                   MOVE      RDATA         RDATA2
     C                   EXSR      LESREC
     C                   Z-ADD     1             WPOS
      *
      * LES <ConsignmentStructure>
     C     STARTCONSTR   TAG
N18  C                   MOVE      *BLANKS       XSTRTYP          15
N18  C                   MOVE      WPOS          XPOS
     C     XCONSTR       SCAN      RDATA3:WPOS   WPOS              4 0    51
N18  C                   IF        *IN51 = *OFF
N18  C                   MOVE      XPOS          WPOS
N18  C     XCONSTR1      SCAN      RDATA3:WPOS   WPOS              4 0    51
N18  C                   IF        *IN51
N18  C                   ADD       37            WPOS
N18  C                   EXSR      GETTXT
N18  C                   MOVEL     XTXT          XSTRTYP          15
N18  C                   END
N18  C                   END
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLUTT
     C     XCONSTR       SCAN      RDATA3:WPOS   WPOS              4 0    51
N18  C                   IF        *IN51 = *OFF
N18  C                   MOVE      XPOS          WPOS
N18  C     XCONSTR1      SCAN      RDATA3:WPOS   WPOS              4 0    51
N18  C                   IF        *IN51
N18  C                   ADD       37            WPOS
N18  C                   EXSR      GETTXT
N18  C                   MOVEL     XTXT          XSTRTYP          15
N18  C                   END
N18  C                   END
     C  N51              ENDDO
N18   * LES <SummarySet>
N23  C                   MOVE      *ZEROS        XARRDATE
N29  C                   MOVE      *BLANKS       XHESDL           20
N33  C                   MOVE      *BLANKS       XLOCSTRLK         2
N33  C                   MOVE      *BLANKS       XLOCENDLK         2
N34  C                   MOVE      *BLANKS       XFSSOKAFB1       35
N34  C                   MOVE      *BLANKS       XFSSOKAFB2       35
N34  C                   MOVE      *BLANKS       XFSSOKRAGT       35
N34  C                   MOVE      *BLANKS       XFSSOKDAGT       35
N36  C                   MOVE      *BLANKS       XTODT            10
N18  C                   IF        XSTRTYP = 'Summary'
N18  C                   EXSR      SRSUMSET
N38  C     XFEIL         CABEQ     'J'           SLUTT
N18  C                   END
      * LES <ConsignmentSet>
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
N08  C     STARTCONSET   TAG
N08  C                   IF        XXTAG = XCONSET
N08  C                   EVAL      WPOS = WPOS - 16
N08  C                   ELSE
     C     XCONSET       SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLUTT
     C     XCONSET       SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
N08  C                   END
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
      *
N07  C                   MOVE      'N'           XAUTOOPD          1
     C                   EXSR      SRCONSET
N07  C                   IF        XAUTOOPD = 'J'
N07  C                   CALL      'NC001R'
N07  C                   PARM                    FS1_XFSAVD
N07  C                   PARM                    FS1_XFSOPD
N07  C                   PARM                    HEREFF
N07  C                   PARM                    HEUNIK
N07  C     ZEADL01K      CHAIN     ZEADL01                            33
N07  C                   MOVE      'XMA'         HESG
N07  C                   UPDATE    HEADFR
N58  C                   ELSE
N58  C                   IF        XHEREFFPRE = 'OX'
N58  C                   EXSR      SROXP
N58  C                   END
N07  C                   END
     C                   EXSR      OPDEDIM
S08  C*                  GOTO      STARTCONSTR
N08  C                   EVAL      XNREF = XNREF +1
N18  C                   IF        XSTRTYP = 'Summary'
N18  C                   EVAL      XREFF = REF(1)
N18  C                   ELSE
N08  C                   EVAL      XREFF = REF(XNREF)
N18  C                   END
N08  C                   GOTO      STARTCONSET
      *
     C     SLUTT         TAG
     C     SSN           CHAIN     EDIS                               33
     C                   IF        *IN33 = *OFF
NC   C                   EVAL      XNREF = XS0036 + 2
NC   C                   IF        REF(XNREF) <> *BLANKS
NC   C                   EXSR      SRERROR2
NC   C                   END
     C                   MOVE      XS0036        S0036
S08  C*                  IF        S0020 = *BLANKS
S08  C*                  MOVE      M0068         XAN21            21
S08  C*                  IF        XAN21 = *BLANKS
S08  C*                  MOVEL     M0068         S0020
S08  C*                  ELSE
S08  C*                  MOVE      M0068         XAN32            32
S08  C*                  MOVEL     XAN32         S0020
S08  C*                  END
S08  C*                  IF        XCOLLA = 'Booking'
S08  C*                  CAT       '-B':0        S0020
S08  C*                  ELSE
S08  C*                  IF        XAUTOOPD = 'J'
S08  C*                  CAT       '-I':0        S0020
S08  C*                  ELSE
S08  C*                  CAT       XAUTOTYP:0    S0020
S08  C*                  END
S08  C*                  END
S08  C*                  END
     C                   UPDATE    EDISR
NC    *
NC   C                   ELSE
N56  C                   IF        XMSGTXT <> 'testIndicator="YES"'
NC   C                   IF        XMSGTXT = *BLANKS
NC   C                   EVAL      XMSGTXT = 'SYNTAKS AV XML ER FEIL.'
NC   C                   END
NC   C                   EXSR      SRERROR
N56  C                   END
NC    *
     C                   END
     C                   MOVE      *ON           *INLR
     C                   RETURN
      *
      *////////////////////////////////////////////////////////////
      * SR for Oppdatering av EDIS                        OPDEDIS /
      *////////////////////////////////////////////////////////////
     C     OPDEDIS       BEGSR
      *
     C*                  MOVEL     WMBR          XAN08             8
     C*                  MOVE      XAN08         SSN
     C                   MOVE      WMBR          SSN
     C     SSN           CHAIN     EDIS                               33
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           SDT
     C                   MOVE      WTM           STM
     C                   MOVE      'R'           SSR
     C                   MOVE      'C'           SST
S08  C*                  MOVEL     XXSNDREF      S0020
NC   C*                  EVAL      S0020 = %SUBST(XMSGID:1:12)
NC   C                   EVAL      NCXT35 = XMSGID
NC   C                   Z-ADD     35            XNEND             3 0
NC   C                   DO        35
NC   C                   IF        NCXT(XNEND) <> *BLANKS
NC   C                   LEAVE
NC   C                   END
NC   C                   SUB       1             XNEND             3 0
NC   C                   ENDDO
NC   C     XNEND         SUB       11            XNSTR             3 0
NC   C                   IF        XNSTR < 1
NC   C                   Z-ADD     1             XNSTR
NC   C                   END
NC   C                   EVAL      S0020 = %SUBST(NCXT35:XNSTR:12)
N08  C                   IF        XCOLLA = 'Booking'
N08  C                   CAT       '-B':0        S0020
N08  C                   ELSE
N08  C                   CAT       '-I':0        S0020
N08  C                   END
     C                   MOVEL     WLIB          SLIB
     C                   MOVEL     WFIL          SFILE
     C                   MOVEL     WMBR          SMBR
     C                   EVAL      S0026 = 'XML-CVINHOUSE'
     C*    1             CHAIN     EDIC                               33
     C*                  ADD       1             CSN
     C*                  UPDATE    EDICR
     C*                  Z-ADD     CSN           SSN
     C   33              WRITE     EDISR
     C  N33              UPDATE    EDISR
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Oppdatering av EDIM                        OPDEDIM /
      *////////////////////////////////////////////////////////////
     C     OPDEDIM       BEGSR
      *
     C                   MOVE      S0004         M0004
     C                   MOVE      S0010         M0010
     C                   MOVE      SSN           MSN
     C                   MOVE      'R'           MSR
     C                   MOVE      'C'           MST
     C                   MOVEL     WDT           MDT
     C                   MOVEL     WTM           MTM
     C                   MOVEL     'XMLINH'      M0065
      *
     C                   Z-ADD     CMN           MMN
     C                   MOVEL     MMN           M0062
     C*                  MOVEL     HERFK         M0068
     C                   MOVE      'INH'         M1001
     C                   MOVEL     XXREFNR       M1004
     C                   MOVE      '1.0'         M1225
     C                   MOVE      *BLANKS       MAVD
     C                   MOVE      *BLANKS       MTDN
     C                   MOVE      XMDT          M0068A
     C                   MOVE      XMTM          M0068B
     C                   WRITE     EDIMR
     C                   ADD       1             XS0036            7 0
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Oppdatering av ZEADF og ZOKUF              OPDOPPD /
      *////////////////////////////////////////////////////////////
     C     OPDOPPD       BEGSR
      *
      * OPPDATER ZEADF
     C     1             CHAIN     EDIC                               33
     C                   ADD       1             CMN
     C                   UPDATE    EDICR
      *
     C                   MOVE      *ZEROS        HEDTOP
     C                   MOVE      *ZEROS        TRSDFD
     C                   MOVE      *ZEROS        TRSDTD
NC   C*                  MOVE      'H'           HEUR
     C                   MOVE      'XML'         HESG
     C                   MOVEL     SLIB          HELIB
     C                   MOVEL     SFILE         HEFILE
     C                   MOVEL     SMBR          HEMBR
     C                   MOVE      'XMLINH'      HETYPE
     C                   MOVE      '1.0'         HELVL
BL   C*                  MOVE      'J'           HEPK1
BL   C                   MOVE      'N'           HEPK1
N01  C                   IF        XCOLLA = 'Booking'
N45  C*                  MOVE      ' '           HXEDIK
N45   * SEND InstructionConfirmation med messageFunction=BookingConfirmation
N45  C                   IF        XMSGFUN = 'Expediting'
N45   * SEND InstructionConfirmation ved F10 (klar til faktura)
N45  C                   MOVE      'P'           HXEDIK
N45  C                   ELSE
N45  C                   MOVE      'B'           HXEDIK
N45  C                   END
N01  C                   ELSE
N45   * SEND InstructionConfirmation med messageFunction=InstructionConfirmation
N45   * SEND InstructionConfirmation ved F10 (klar til faktura)
     C                   MOVE      'X'           HXEDIK
N01  C                   END
N02  C     CUNDL01K      CHAIN     CUNDL01                            33
NC   C*                  MOVE      ECCNO         HEKNA
NC   C                   MOVE      ECCNO         TRKNFA
N02  C                   MOVE      KNAVN         HENAA
N23  C                   IF        XARRDATE <> 0
N23  C                   MOVE      XARRDATE      HEDTOP
N23  C                   IF        TRSDFD = 0
N23  C                   MOVE      XARRDATE      TRSDFD
N23  C                   END
N23  C                   END
NC   C*                  IF        XSUMSETTYP = '741'
NC   C                   IF        ((XSUMSETTYP = '741') OR
NC   C                                (XSUMSETTYP = '704'))
N25  C*                  MOVE      XMAWB         HEGN
N25  C* eksport          MOVE      XHAWB         HEHAWB
N25  C* eksport          MOVE      XMAWB         HEGN
N25  C                   MOVEL     XMAWB         HERFA
N25  C                   END
N29  C                   EVAL      HESDL = XHESDL
     C                   WRITE     HEADFR
      *
      * OPPDATER ZRISOK
     C                   EVAL      FSUNIK = HEUNIK
     C                   EVAL      FSREFF = HEREFF
N36   *
N36  C                   IF        XTODT <> *BLANKS
N36  C                   EVAL      FSKODE = '111'
N36  C                   EVAL      FSSOK  = XTODT
N36  C                   WRITE     FRISOKR
N36  C                   END
N34   * ReferenceNo (AFB)
N34  C                   IF        XFSSOKAFB2 <> *BLANKS
N34  C                   EVAL      FSKODE = 'AFB'
N34  C                   EVAL      FSSOK  = XFSSOKAFB2
N34  C                   WRITE     FRISOKR
N34  C                   END
N34   * DespatchingAgent
N34  C                   IF        XFSSOKDAGT <> *BLANKS
N34  C                   EVAL      FSKODE = 'CS'
N34  C                   EVAL      FSSOK  = XFSSOKDAGT
N34  C                   WRITE     FRISOKR
N34  C                   END
N34   * ReceivingAgentnt
N34  C                   IF        XFSSOKRAGT <> *BLANKS
N34  C                   EVAL      FSKODE = 'DC'
N34  C                   EVAL      FSSOK  = XFSSOKRAGT
N34  C                   WRITE     FRISOKR
N34  C                   END
N34   *
S08   * BEVARE AVSENDERS KUNDENR
S08  C*                  EVAL      FSKODE = 'INH'
S08  C*                  MOVE      *BLANKS       FSSOK
S08  C*                  MOVEL     ECCNO         FSSOK
S08  C*                  CAT       WDT:3         FSSOK
S08  C*                  CAT       WTM:2         FSSOK
S08  C*                  WRITE     FRISOKR
S08   *
     C*                  EVAL      FSKODE = 'IFB'
     C                   IF        ((((XXKODE = '730') OR
     C                                (XXKODE = '700')) OR
     C                                (XXKODE = '705')) OR
     C                                (XXKODE = '740'))
     C                   EVAL      FSKODE = '730'
     C                   ELSE
     C                   EVAL      FSKODE = XXKODE
     C                   END
     C                   EVAL      FSSOK  = M0068
N32  C                   IF        FSSOK <> *BLANKS
     C                   WRITE     FRISOKR
N32  C                   END
      *
     C                   IF        FSKODE = '730'
     C*                  EVAL      FSKODE = 'IFB'
     C*                  WRITE     FRISOKR
     C                   ELSE
     C                   EVAL      FSKODE = 'CMR'
     C     FIFIRM        CHAIN     FIRFB                              33
     C                   ADD       1             FIRECN
     C                   UPDATE    FIRFBR
     C                   MOVE      *BLANKS       UFN17
     C                   MOVEL     FIRECN        UFN17C
     C                   MOVE      FISNLA        UFN17A
     C                   MOVE      FISNLE        UFN17B
     C                   MOVE      *ZEROS        UAN22            22
     C                   MOVE      *ZEROS        XBAK              1 0
     C                   MOVE      UFN17         UAN22
     C                   CALL      'SYGE08'
     C                   PARM                    UAN22
     C                   MOVE      UAN22         UFN17
     C                   EVAL      FSSOK = UFN17
     C                   WRITE     FRISOKR
N47  C                   MOVE      FSSOK         CMRFSSOK
     C                   END
      *
NC   C*                  IF        XSUMSETTYP = '741'
NC   C                   IF        ((XSUMSETTYP = '741') OR
NC   C                                (XSUMSETTYP = '704'))
N25  C                   IF        XREFAWB2 <> *BLANKS
N25  C                   EVAL      FSKODE = XREFAWB1
N25  C                   EVAL      FSSOK  = XREFAWB2
N25  C                   WRITE     FRISOKR
N25  C                   END
N25  C                   END
      *
     C                   EVAL      FMUNIK = HEUNIK
     C                   EVAL      FMREFF = HEREFF
     C                   MOVE      'F'           FMRI
     C                   Z-ADD     1             FMFBNR
     C                   MOVE      'E'           FMST
S37  C*                  Z-ADD     1             FMMKNR
N37  C                   Z-ADD     0             FMMKNR
     C                   Z-ADD     1             FMLONR
     C                   EVAL      FVUNIK = HEUNIK
     C                   EVAL      FVREFF = HEREFF
     C                   EVAL      FVRI   = 'F'
     C                   Z-ADD     1             FVFBNR
     C                   MOVE      *ZEROS        FVLINR
     C                   Z-ADD     1             FVANT
     C                   MOVE      *ZEROS        FMLINR
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for PartyStructure                            SRSPARTY /
      *////////////////////////////////////////////////////////////
     C     SRSPARTY      BEGSR
     C                   MOVE      'N'           XFEIL             1
      *
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
      * LES <PartySet>
     C     XSPARTY1      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLSRSPARTY
     C     XSPARTY1      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
      *
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
      * LES <Party
     C                   ADD       1             WPOS
     C     XSPARTY2      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLSRSPARTY
     C     XSPARTY2      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
      *
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
      * LES MessageSender
     C                   MOVE      WPOS          XPOS              4 0
     C     XSPARTY5      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C*                  ADD       17            WPOS
     C                   ADD       10            WPOS
     C                   EXSR      GETTXT
     C                   MOVEL     XTXT          XAVSMOT          30
      * LES partyId="
     C                   MOVE      XPOS          WPOS
     C     XSPARTY4      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLSRSPARTY
     C     XSPARTY4      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
      * LES avsender/mottakers-id
     C                   ADD       9             WPOS
     C                   EXSR      GETTXT
      *
     C                   SELECT
     C                   WHEN      XAVSMOT = 'MessageSender'
     C                   EVAL      S0004 = XTXT
     C                   EXSR      SRMSGREF
     C                   WHEN      XAVSMOT = 'MessageRecipient'
     C                   EVAL      S0010 = XTXT
     C                   ENDSL
      *
     C     SLSRSPARTY    ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for DateAndTime                               SRDATSTR /
      *////////////////////////////////////////////////////////////
     C     SRDATSTR      BEGSR
      * LES <DateAndTimeSet>
     C     XDATSTR1      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLSRDATSTR
     C     XDATSTR1      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
      *
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
      * LES <DateAndTimes
     C     XDATSTR2      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLSRDATSTR
     C     XDATSTR2      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
      *
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
      * LES <Year>
     C     XDATSTR3      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLSRDATSTR
     C     XDATSTR3      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
      *
     C                   ADD       6             WPOS
     C                   EXSR      GETTAL
     C                   Z-ADD     XTAL          XMDTÅ
      * LES <Month>
     C     XDATSTR4      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLSRDATSTR
     C     XDATSTR4      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
      *
     C                   ADD       7             WPOS
     C                   EXSR      GETTAL
     C                   Z-ADD     XTAL          XMDTM
      * LES <Day>
     C     XDATSTR5      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLSRDATSTR
     C     XDATSTR5      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
      *
     C                   ADD       5             WPOS
     C                   EXSR      GETTAL
     C                   Z-ADD     XTAL          XMDTD
      * LES <Hour>
     C     XDATSTR6      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLSRDATSTR
     C     XDATSTR6      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
      *
     C                   ADD       6             WPOS
     C                   EXSR      GETTAL
     C                   Z-ADD     XTAL          XMTMT
      * LES <Minute>
     C     XDATSTR7      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLSRDATSTR
     C     XDATSTR7      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
      *
     C                   ADD       8             WPOS
     C                   EXSR      GETTAL
     C                   Z-ADD     XTAL          XMTMM
      *
     C     SLSRDATSTR    ENDSR
      *
N17   *////////////////////////////////////////////////////////////
N17   * SR for MessageDetails                            SRMSGDET /
N17   *////////////////////////////////////////////////////////////
N17  C     SRMSGDET      BEGSR
N17  C                   MOVE      'N'           XFEIL             1
N17   *
N17  C                   IF        WPOS > 1024
N17  C                   SUB       1024          WPOS
N17  C                   EXSR      LESREC
N17  C                   END
N17  C                   MOVE      WPOS          XPOS
N17   * LES <MessageSender
N17  C     XMSGDET1      SCAN      RDATA3:WPOS   WPOS              4 0    51
N17  C                   DOW       *IN51 = *OFF
N17  C                   EXSR      LESREC
N17  C     XSLUTTLES     CABEQ     'J'           SLSRMSGDET
N17  C     XMSGDET1      SCAN      RDATA3:WPOS   WPOS              4 0    51
N17  C  N51              ENDDO
N17   *
N17  C                   IF        WPOS > 1024
N17  C                   SUB       1024          WPOS
N17  C                   EXSR      LESREC
N17  C                   END
N17   * LES partyId="
N17  C                   MOVE      XPOS          WPOS
N17  C     XSPARTY4      SCAN      RDATA3:WPOS   WPOS              4 0    51
N17  C                   DOW       *IN51 = *OFF
N17  C                   EXSR      LESREC
N17  C     XSLUTTLES     CABEQ     'J'           SLSRMSGDET
N17  C     XSPARTY4      SCAN      RDATA3:WPOS   WPOS              4 0    51
N17  C  N51              ENDDO
N17   * LES SENDERS ID
N17  C                   ADD       9             WPOS
N17  C                   EXSR      GETTXT
N17  C                   EVAL      S0004 = XTXT
N17   *
N17   * LES <MessageRecipient
N17  C                   MOVE      WPOS          XPOS
N17  C     XMSGDET2      SCAN      RDATA3:WPOS   WPOS              4 0    51
N17  C                   DOW       *IN51 = *OFF
N17  C                   EXSR      LESREC
N17  C     XSLUTTLES     CABEQ     'J'           SLSRMSGDET
N17  C     XMSGDET2      SCAN      RDATA3:WPOS   WPOS              4 0    51
N17  C  N51              ENDDO
N17   *
N17  C                   IF        WPOS > 1024
N17  C                   SUB       1024          WPOS
N17  C                   EXSR      LESREC
N17  C                   END
N17   * LES partyId="
N17  C                   MOVE      XPOS          WPOS
N17  C     XSPARTY4      SCAN      RDATA3:WPOS   WPOS              4 0    51
N17  C                   DOW       *IN51 = *OFF
N17  C                   EXSR      LESREC
N17  C     XSLUTTLES     CABEQ     'J'           SLSRMSGDET
N17  C     XSPARTY4      SCAN      RDATA3:WPOS   WPOS              4 0    51
N17  C  N51              ENDDO
N17   * LES MOTTAKERS ID
N17  C                   ADD       9             WPOS
N17  C                   EXSR      GETTXT
N17  C                   EVAL      S0010 = XTXT
N17   *
N17   * LES <MessageDate
N17  C     XMSGDET3      SCAN      RDATA3:WPOS   WPOS              4 0    51
N17  C                   DOW       *IN51 = *OFF
N17  C                   EXSR      LESREC
N17  C     XSLUTTLES     CABEQ     'J'           SLSRMSGDET
N17  C     XMSGDET3      SCAN      RDATA3:WPOS   WPOS              4 0    51
N17  C  N51              ENDDO
N17   *
N17  C                   IF        WPOS > 1024
N17  C                   SUB       1024          WPOS
N17  C                   EXSR      LESREC
N17  C                   END
N17   * LES ÅR
N17  C*                  ADD       13            WPOS
N17  C                   ADD       1             WPOS
N17  C                   DOW       IN(WPOS) <> '>'
N17  C                   ADD       1             WPOS
N17  C                   ENDDO
N17  C                   ADD       1             WPOS
N17  C                   EXSR      GETTAL2
N17  C                   Z-ADD     XTAL          XMDTÅ
N17   * LES MÅNED
N17  C                   ADD       1             WPOS
N17  C                   EXSR      GETTAL2
N17  C                   Z-ADD     XTAL          XMDTM
N17   * LES DAG
N17  C                   ADD       1             WPOS
N17  C                   EXSR      GETTAL2
N17  C                   Z-ADD     XTAL          XMDTD
N17   * LES TIME
N17  C                   ADD       1             WPOS
N17  C                   EXSR      GETTAL2
N17  C                   Z-ADD     XTAL          XMTMT
N17   * LES MINUTT
N17  C                   ADD       1             WPOS
N17  C                   EXSR      GETTAL2
N17  C                   Z-ADD     XTAL          XMTMM
N17   * LES SEKUND
N17  C                   ADD       1             WPOS
N17  C                   EXSR      GETTAL2
N17  C                   Z-ADD     XTAL          XMTMS
N17   *
N17  C     SLSRMSGDET    ENDSR
N17   *
N18   *////////////////////////////////////////////////////////////
N18   * SR for SummarySet                                SRSUMSET /
N18   *////////////////////////////////////////////////////////////
N18  C     SRSUMSET      BEGSR
N38  C                   EVAL      XFEIL = 'N'
N25   * <SummarySet
N25  C                   MOVE      *BLANKS       XSUMSETTYP        3
N25  C                   DOW       XXTAG <> XSUMSET
N25  C                   EXSR      LESTAG
N38  C                   IF        XSLUTTLES = 'J'
N38  C                   EVAL      XMSGTXT = 'Avsenders-ID (' + %TRIM(S0004)
N38  C                             + '). Det mangler SummarySet i filen.'
N38  C                   EXSR      SRERROR
N38  C                   EVAL      XFEIL = 'J'
N38  C                   GOTO      SLSRSUMSET
N38  C                   END
N25  C                   ENDDO
N25  C                   MOVE      WPOS          XPOS
N25   * FINN SUMSETTYPE
N25  C     XSUMSET2      SCAN      RDATA3:WPOS   WPOS                     51
N25  C                   IF        *IN51
N25  C                   ADD       15            WPOS
N25  C                   EXSR      GETTXT
N25  C                   MOVEL     XTXT          XSUMSETTYP
N25  C                   ELSE
N25  C                   MOVE      XPOS          WPOS
N25  C                   END
NC   C*                  IF        XSUMSETTYP = '741'
NC   C                   IF        ((XSUMSETTYP = '741') OR
NC   C                                (XSUMSETTYP = '704'))
N25  C                   MOVE      *BLANKS       XHAWB             9
N25  C                   MOVE      XPOS          WPOS
N25   * HAWB
N25  C     XSUMSET1      SCAN      RDATA3:WPOS   WPOS                     51
N25  C                   IF        *IN51
N25  C                   ADD       11            WPOS
N25  C                   EXSR      GETTXT
N25  C                   MOVEL     XTXT          XHAWB
N25  C                   END
N25  C                   MOVE      XPOS          WPOS
N25  C                   END
N18   *
N18   * HENT REFERANSE
N18  C     STSRSUMSET    TAG
N18  C                   MOVE      'N'           XREFJA            1
N18  C                   MOVE      'N'           XRTYJA            1
N18  C                   MOVE      *BLANKS       XREFTYP           3
N18  C                   MOVE      *BLANKS       XREFNR           17
N25  C                   MOVE      *BLANKS       XREFAWB1          3
N25  C                   MOVE      *BLANKS       XREFAWB2         17
N18   *
N18  C                   DOW       XXTAG <> XREF
N18  C                   EXSR      LESTAG
N18  C     XSLUTTLES     CABEQ     'J'           SLSRSUMSET
N33  C                   IF        XXTAG = XTRALEG
N33  C                   IF        ((XSUMSETTYP = '741') OR
N33  C                                (XSUMSETTYP = '704'))
N33  C                   EXSR      SRHENTLK
N33  C                   END
N33  C                   END
S23  C*    XXTAG         CABEQ     XMPARTY       SLSRSUMSET
S23  C*    XXTAG         CABEQ     XMDAT         SLSRSUMSET
S34  C*    XXTAG         CABEQ     XMPARTY       STSUMSET02
N34  C     XXTAG         CABEQ     XMPARTY       STSUMSET021
N23  C     XXTAG         CABEQ     XMDAT         STSUMSET02
N18  C                   ENDDO
N18   *
N18  C     STSUMSET01    TAG
N18  C                   EXSR      LESTAG
N18  C     XSLUTTLES     CABEQ     'J'           SLSRSUMSET
N18   *
N18  C                   SELECT
N18   * <ReferenceNo>
N18  C                   WHEN      XXTAG = XREF1
N18  C                   EXSR      GETTXT
N34  C                   IF        XFSSOKAFB2 = *BLANKS
N34  C                   EVAL      XFSSOKAFB1 = XTXT
N34  C                   END
N18  C                   SELECT
N18  C                   WHEN      XRTYJA = 'N'
N18  C                   MOVEL     XTXT          XREFNR
N18  C                   MOVE      'J'           XREFJA
N18  C                   GOTO      STSUMSET01
N18  C                   WHEN      XREFTYP = 'AFB'
N18  C     LC:UC         XLATE     XTXT          XTXT
N18  C                   EVAL      REF(1) = XTXT
N34  C                   EVAL      XFSSOKAFB2 = XTXT
N18  C                   EVAL      XREFF  = XTXT
N18  C                   EVAL      HEREFF = XREFF
N18  C                   GOTO      STSRSUMSET
N25  C                   WHEN      XTXT = 'AWB'
N25  C                   MOVEL     XTXT          XREFAWB1          3
N25  C                   MOVEL     XREFNR        XREFAWB2         17
N25  C                   MOVEL     XREFNR        XMAWB            11
N25  C                   EVAL      XREFNR = *BLANKS
N25  C                   MOVE      'N'           XREFJA
N25  C                   GOTO      STSRSUMSET
N32  C                   WHEN      XTXT = 'AGO'
N32  C                   MOVEL     XREFNR        XMAWB            11
N32  C                   EVAL      XREFNR = *BLANKS
N32  C                   MOVE      'N'           XREFJA
N32  C                   GOTO      STSRSUMSET
N18  C                   ENDSL
N18   * <ReferenceType>
N18  C                   WHEN      XXTAG = XREF2
N18  C                   EXSR      GETTXT
N34  C                   IF        XTXT = 'AFB' AND XFSSOKAFB1 <> *BLANKS
N34  C                   EVAL      XFSSOKAFB2 = XFSSOKAFB1
N34  C                   EVAL      XFSSOKAFB1 = *BLANKS
N34  C                   END
N18  C                   IF        XREFJA = 'N'
N18  C                   MOVEL     XTXT          XREFTYP
N18  C                   MOVE      'J'           XRTYJA
N18  C                   GOTO      STSUMSET01
N18  C                   ELSE
N18  C                   IF        XTXT = 'AFB'
N18  C     LC:UC         XLATE     XREFNR        XREFNR
N18  C                   EVAL      REF(1) = XREFNR
N18  C                   EVAL      XREFF  = XREFNR
N18  C                   EVAL      HEREFF = XREFF
S23  C*                  GOTO      SLSRSUMSET
N25  C                   ELSE
N25  C                   IF        XTXT = 'AWB'
N25  C                   MOVEL     XTXT          XREFAWB1          3
N25  C                   MOVEL     XREFNR        XREFAWB2         17
N25  C                   MOVEL     XREFNR        XMAWB            11
N25  C                   EVAL      XREFNR = *BLANKS
N25  C                   MOVE      'N'           XREFJA
N25  C                   END
N18  C                   END
N18  C                   GOTO      STSRSUMSET
N18  C                   END
N18  C                   OTHER
N18  C                   GOTO      STSRSUMSET
N18  C                   ENDSL
N23   *
N23  C     STSUMSET02    TAG
N23  C                   ADD       1             WPOS
N23  C                   EXSR      LESTAG
S29  C*                  DOW       (((XXTAG <> XREF) AND
N29  C                   DOW       ((((XXTAG <> XREF) AND
N23  C                                (XXTAG <> XMDAT)) AND
N29  C                                (XXTAG <> XSPARTY2)) AND
N23  C                                (XXTAG <> XCONSET))
N23  C                   ADD       1             WPOS
N23  C                   EXSR      LESTAG
N23  C     XSLUTTLES     CABEQ     'J'           SLSRSUMSET
N23  C                   ENDDO
N23  C     XXTAG         CABEQ     XCONSET       SLSRSUMSET
N23  C     XXTAG         CABEQ     XREF          STSUMSET01
N29   *
N34  C     STSUMSET021   TAG
N29  C                   IF        XXTAG = XSPARTY2
N29  C                   ADD       10            WPOS
N29  C                   EXSR      GETTXT
N29   * ReceivingAgent
N29  C                   IF        XTXT = 'ReceivingAgent'
N29  C                   ADD       11            WPOS
N29  C                   EXSR      GETTXT
N29  C                   MOVEL     XTXT          SYVRDA
N34  C                   EVAL      XFSSOKRAGT = XTXT
N29  C                   ADD       10            WPOS
N29  C                   EXSR      GETTXT
N29  C                   SELECT
N29  C                   WHEN      XTXT = '9'
N29  C                   EVAL      SYPAID = 'ZGLN'
N29  C     SYPARL3K      CHAIN     SYPARL3                            33
N29  C  N33              EVAL      SYPAID = 'ZAGT'
N29  C  N33SYPARL1K      CHAIN     SYPARL1                            33
N29  C                   EVAL      XHESDL = SYVRDA
N29  C                   WHEN      XTXT = 'BPN'
N29  C                   EVAL      XHESDL = SYVRDA
N29  C                   ENDSL
N29  C                   END
N34   * ReceivingAgent
N34  C                   IF        XTXT = 'DespatchingAgent'
N34  C                   ADD       11            WPOS
N34  C                   EXSR      GETTXT
N34  C                   EVAL      XFSSOKDAGT = XTXT
N34  C                   END
N34   *
N29  C                   GOTO      STSUMSET02
N29  C                   END
N23   *
N23  C     STSUMSET03    TAG
N23   *
N23   * Type of date and time
N23  C                   ADD       10            WPOS
N23  C                   EXSR      GETTXT
N23   *
N23  C                   SELECT
N23  C                   WHEN      XTXT = 'ArrivalDateEstimated'
N36  C                             OR (XTXT = 'TransportOrderDate' AND
N36  C                             XMSGFUN='Manifest')
N36  C                   IF        XTXT = 'TransportOrderDate'
N36  C                   MOVE      'J'           XTODATE           1
N36  C                   ELSE
N36  C                   MOVE      'N'           XTODATE
N36  C                   END
N23  C     STSUMSET04    TAG
N23  C                   ADD       1             WPOS
N23  C                   EXSR      LESTAG
N23  C     XSLUTTLES     CABEQ     'J'           SLSRSUMSET
N23   *
N23  C                   SELECT
N23   * <Year>
N23  C                   WHEN      XXTAG = XMDAT1
N36  C                   IF        XTODATE = 'J'
N36  C                   EXSR      GETTXT
N36  C                   EVAL      XTODT = %TRIM(XTXT) + '-'
N36  C                   ELSE
N23  C                   EXSR      GETTAL
N23  C                   Z-ADD     XTAL          XARRDATEA
N36  C                   END
N23  C                   GOTO      STSUMSET04
N23   * <Month>
N23  C                   WHEN      XXTAG = XMDAT2
N36  C                   IF        XTODATE = 'J'
N36  C                   EXSR      GETTXT
N36  C                   EVAL      XTODT = %TRIM(XTODT) + %TRIM(XTXT) + '-'
N36  C                   ELSE
N23  C                   EXSR      GETTAL
N23  C                   Z-ADD     XTAL          XARRDATEM
N36  C                   END
N23  C                   GOTO      STSUMSET04
N23   * <Day>
N23  C                   WHEN      XXTAG = XMDAT3
N36  C                   IF        XTODATE = 'J'
N36  C                   EXSR      GETTXT
N36  C                   EVAL      XTODT = %TRIM(XTODT) + %TRIM(XTXT)
N36  C                   ELSE
N23  C                   EXSR      GETTAL
N23  C                   Z-ADD     XTAL          XARRDATED
N36  C                   END
S36  C*                  GOTO      SLSRSUMSET
N36   *
N36  C                   ADD       1             WPOS
N36  C                   EXSR      LESTAG
N36  C     XSLUTTLES     CABEQ     'J'           SLSRSUMSET
N36  C     XXTAG         CABEQ     XMDAT         STSUMSET03
N36  C     XXTAG         CABEQ     XREF          STSUMSET01
N36  C                   GOTO      SLSRSUMSET
N36   *
N23  C                   ENDSL
N23  C                   OTHER
N23  C                   ADD       1             WPOS
N23  C                   EXSR      LESTAG
N23  C                   DOW       (((XXTAG = XMDAT1) OR
N23  C                               (XXTAG = XMDAT2)) OR
N23  C                               (XXTAG = XMDAT3))
N23  C                   ADD       1             WPOS
N23  C                   EXSR      LESTAG
N23  C     XSLUTTLES     CABEQ     'J'           SLSRSUMSET
N23  C                   ENDDO
N23  C     XXTAG         CABEQ     XMDAT         STSUMSET03
N23  C     XXTAG         CABEQ     XREF          STSUMSET01
N23  C                   GOTO      SLSRSUMSET
N23  C                   ENDSL
N18   *
N18  C     SLSRSUMSET    ENDSR
N18   *
N33   *////////////////////////////////////////////////////////////
N33   * SR for TransportLeg                              SRHENTLK /
N33   *////////////////////////////////////////////////////////////
N33  C     SRHENTLK      BEGSR
N33   *
N33XXC     STHENTLK1     TAG
N33  C                   MOVE      WPOS          XPOS
N33  C     XLOCATION1    SCAN      RDATA3:WPOS   WPOS                     51
N33  C  N51              MOVE      XPOS          WPOS
N33  C  N51              GOTO      SLSRHENTLK
N33XXC*                  ADD       9             WPOS
N33XXC                   ADD       10            WPOS
N33  C                   EXSR      GETTXT
N33  C                   MOVEL     XTXT          XLOCCLASS        25
N33   *
N33XXC     STHENTLK2     TAG
N33  C                   EXSR      LESTAG
N33  C     XSLUTTLES     CABEQ     'J'           SLSRHENTLK
N33  C     XXTAG         CABEQ     XREF1         SLSRHENTLK
N33  C     XXTAG         CABEQ     XMPARTY       SLSRHENTLK
N33  C     XXTAG         CABEQ     XMDAT         SLSRHENTLK
N33   *
N33  C                   SELECT
N33XXC                   WHEN      XXTAG = XLOCATION OR XXTAG = XLOCATION0
N33XXC                   GOTO      STHENTLK1
N33XX * <Location>
N33  C                   WHEN      XXTAG = XLOCATION4
N33   * <LocationName>
N33  C                   WHEN      XXTAG = XLOCATION5
N33   * <CountryCode>
N33XXC**                 ADD       13            WPOS
N33  C                   EXSR      GETTXT
N33  C                   SELECT
N33  C                   WHEN      XLOCCLASS = 'StartLocation'
N33  C                   MOVEL     XTXT          XLOCSTRLK         2
N33  C                   WHEN      XLOCCLASS = 'EndLocation'
N33  C                   MOVEL     XTXT          XLOCENDLK         2
N33  C                   ENDSL
N33  C                   ENDSL
N33XXC                   GOTO      STHENTLK2
N33   *
N33  C     SLSRHENTLK    ENDSR
N33   *
      *////////////////////////////////////////////////////////////
      * SR for ConsignmentSet                            SRCONSET /
      *////////////////////////////////////////////////////////////
     C     SRCONSET      BEGSR
N47  C                   MOVE      *BLANKS       CMRFSSOK         35
N08  C                   MOVE      'N'           XFULLCMR          1
N33  C                   MOVE      *BLANKS       XDESAGTLK         2
N33  C                   MOVE      *BLANKS       XRECAGTLK         2
N33  C                   MOVE      *BLANKS       XEQTYPE           3
N42  C     *LIKE         DEFINE    HEGM1         XHEGM1
N42  C                   MOVE      *BLANKS       XHEGM1
N60  C                   MOVE      *BLANKS       XXGM             15
N60  C                   MOVE      *BLANKS       XXGM1            15
N60  C                   MOVE      *BLANKS       XXGM2            15
      *
      * LES <Consignment
     C                   ADD       16            WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
N32  C                   IF        XXTAG <> XCONSIGNMA
     C                   IF        XXTAG <> XCONSIGNM
     C                   EVAL      M0068 = '*UKJENT FRA'
     C                   CAT       S0004:1       M0068
     C                   GOTO      SLSRCONSET
     C                   END
      *
      * LES consignmentId
     C                   ADD       15            WPOS
     C                   EXSR      GETTXT
     C                   EVAL      FS1_FSSOK = XTXT
     C                   EVAL      M0068     = XTXT
     C                   EVAL      M1004     = XTXT
      * LES idType
     C                   ADD       10            WPOS
     C                   EXSR      GETTXT
     C                   MOVEL     XTXT          XXKODE            3
      *
      * TEST OM DENNE HAR VÆRT FØR
     C     FRISOL01K     CHAIN     FRISOL01                           33
XXX  C*    *IN33         CABEQ     *OFF          SLSRCONSET
N41  C                   ELSE
N41  C                   EVAL      WPOS = WPOS - 1
N32  C                   END
      * HEREFF = 'OX' + AVSENDERS POSTNR
     C                   EVAL      HEREFF = XREFF
     C     HEREFF        CHAIN     ZEADL01                            33
XXX  C*    *IN33         CABEQ     *OFF          SLSRCONSET
XXX  C  N33              CLEAR                   HEADFR
XXX  C  N33              EVAL      HEREFF = XREFF
      *
      * HENT UNIK-NR
     C     FIFIRM        CHAIN     ZTELL                              33
      * ZUNIK INNHOLDER NESTE NR.
     C                   IF        *IN33
     C                   EVAL      FIRMA = FIFIRM
     C                   EVAL      ZUNIK = 10000001
     C                   MOVE      ZUNIK         HEUNIK
     C                   EVAL      ZUNIK = ZUNIK + 1
     C                   WRITE     ZTELLR
     C                   ELSE
     C                   MOVE      ZUNIK         HEUNIK
     C                   EVAL      ZUNIK = ZUNIK + 1
     C                   UPDATE    ZTELLR
     C                   END
     C                   EVAL      FRUNIK = HEUNIK
     C                   EVAL      FRREFF = HEREFF
     C                   Z-ADD     0             FRTLI
      * LES <TotalGrossWeight / <TotalVolume / <NumberOfPackages>
     C                   ADD       1             WPOS
     C                   EVAL      HEVKT = -1
     C                   EVAL      HEM3  = -1
N15  C                   EVAL      HELM  = 0
     C                   EVAL      HENT  = -1
     C     STSRCONSET1   TAG
     C                   DOW       (((((XXTAG <> XCONSIGNM1) AND
     C                                 (XXTAG <> XCONSIGNM2)) AND
     C                                 (XXTAG <> XCONSIGNM3)) AND
N15  C                                 (XXTAG <> XCONSIGNM4)) AND
     C                                 (XXTAG <> XCONSIGNM3A))
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
     C                   SELECT
     C                   WHEN      XXTAG = XREF
N03  C                   IF        XCOLLA <> 'Booking'
N03  C                   EXSR      OPDOPPD
N03  C                   END
     C                   GOTO      STSRCONSET2
     C                   WHEN      ((XXTAG = XPACKAGE) OR (XXTAG = XPACKAGEX))
N03  C                   IF        XCOLLA <> 'Booking'
N03  C                   EXSR      OPDOPPD
N03  C                   END
     C                   GOTO      STSRCONSET2
     C*                  WHEN      XXTAG = XCGISET
     C                   WHEN      ((XXTAG = XCGISET) OR (XXTAG = XCGISETT))
N03  C                   IF        XCOLLA <> 'Booking'
N03  C                   EXSR      OPDOPPD
N03  C                   END
     C                   GOTO      STSRCONSET2
     C                   WHEN      XXTAG = XMPARTY
N03  C                   IF        XCOLLA <> 'Booking'
N03  C                   EXSR      OPDOPPD
N03  C                   END
     C                   GOTO      STSRCONSET2
     C                   ENDSL
     C                   ENDDO
      *
     C                   SELECT
     C                   WHEN      XXTAG = XCONSIGNM1
     C                   DOW       IN(WPOS) <> '>'
     C                   ADD       1             WPOS
     C                   ENDDO
     C                   ADD       1             WPOS
     C                   MOVE      WPOS          XPOS
     C                   EXSR      GETTAL
     C                   IF        ((XTAL > 999999999) OR (XFEILTALL = 'J'))
     C                   Z-ADD     0             HEVKT
     C                   MOVE      'V'           XFEILTYPE         1
     C                   EXSR      OPDFEIL
     C                   ELSE
     C                   ADD       0,49999       XTAL
     C                   Z-ADD(H)  XTAL          HEVKT
     C                   END
      *
     C                   WHEN      XXTAG = XCONSIGNM2
     C                   ADD       10            WPOS
     C                   EXSR      GETTXT
     C                   ADD       2             WPOS
     C                   MOVE      WPOS          XPOS
     C                   EXSR      GETTAL
     C                   ADD       0,00049       XTAL
     C                   SELECT
     C                   WHEN      XTXT = 'MTQ'
     C                   IF        ((XTAL >= 9999.9995) OR (XFEILTALL = 'J'))
     C                   Z-ADD     9999.999      HEM3
     C                   MOVE      'M'           XFEILTYPE         1
     C                   EXSR      OPDFEIL
     C                   ELSE
     C                   Z-ADD(H)  XTAL          HEM3
     C                   END
     C                   WHEN      XTXT = 'DMQ'
     C                   IF        ((XTAL >= 9999999.5) OR (XFEILTALL = 'J'))
     C                   Z-ADD     0             HEM3
     C                   MOVE      'M'           XFEILTYPE         1
     C                   EXSR      OPDFEIL
     C                   ELSE
     C                   EVAL(H)   HEM3 = XTAL / 1000
     C                   END
     C                   OTHER
     C*                  Z-ADD(H)  XTAL          HEM3
     C                   Z-ADD     0             HEM3
     C                   MOVE      'M'           XFEILTYPE         1
     C                   EXSR      OPDFEIL
     C                   ENDSL
N15   *
N15  C                   WHEN      XXTAG = XCONSIGNM4
N15  C                   DOW       IN(WPOS) <> '>'
N15  C                   ADD       1             WPOS
N15  C                   ENDDO
N15  C                   ADD       1             WPOS
N15  C                   MOVE      WPOS          XPOS
N15  C                   EXSR      GETTAL
N15  C                   ADD       0,00499       XTAL
N15  C                   IF        ((XTAL >= 99.995) OR (XFEILTALL = 'J'))
N15  C                   Z-ADD     99.99         HELM
N15  C                   MOVE      'L'           XFEILTYPE         1
N15  C                   EXSR      OPDFEIL
N15  C                   ELSE
N15  C                   Z-ADD(H)  XTAL          HELM
N15  C                   END
      *
     C                   WHEN      XXTAG = XCONSIGNM3
     C                   MOVE      WPOS          XPOS
     C                   EXSR      GETTAL
     C                   IF        ((XTAL >= 9999999) OR (XFEILTALL = 'J'))
     C                   Z-ADD     0             HENT
     C                   MOVE      'K'           XFEILTYPE         1
     C                   EXSR      OPDFEIL
     C                   ELSE
     C                   Z-ADD     XTAL          HENT
     C                   END
      *
     C                   WHEN      XXTAG = XCONSIGNM3A
     C                   DOW       IN(WPOS) <> '>'
     C                   ADD       1             WPOS
     C                   ENDDO
     C                   ADD       1             WPOS
     C                   MOVE      WPOS          XPOS
     C                   EXSR      GETTAL
     C                   IF        ((XTAL >= 9999999) OR (XFEILTALL = 'J'))
     C                   Z-ADD     0             HENT
     C                   MOVE      'K'           XFEILTYPE         1
     C                   EXSR      OPDFEIL
     C                   ELSE
     C                   Z-ADD     XTAL          HENT
     C                   END
     C                   ENDSL
      *
     C                   IF        (((HEVKT = -1) OR
     C                               (HEM3  = -1)) OR
     C                               (HENT  = -1))
     C                   MOVE      *BLANKS       XXTAG
     C                   GOTO      STSRCONSET1
     C                   END
      *
     C                   EXSR      OPDOPPD
      *
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
      *
     C                   MOVE      WPOS          XPOS              4 0
     C     XCONSIGNMEND  SCAN      RDATA3:WPOS   WPOS              4 0    51
N11  C   51WPOS          SUB       XPOS          XPOS2             4 0
N11  C   51XPOS2         COMP      30                                   5151
     C   51              IF        RDATAXX <> *BLANKS
     C     WPOS          SUB       20            XPOS2             4 0
     C                   IF        XPOS2 > XPOS
     C                   MOVE      *OFF          *IN51
     C                   END
     C                   END
      *
     C                   DOW       *IN51 = *OFF
     C                   MOVE      XPOS          WPOS
     C                   EXSR      LESTAG
     C     STSRCONSET2   TAG
N01   *
N01  C                   IF        XCOLLA = 'Booking'
N01  C                   IF        (((HEVKT = -1) OR
N01  C                               (HEM3  = -1)) OR
N01  C                               (HENT  = -1))
N01  C                   IF        HEVKT = -1
N01  C                   Z-ADD     0             HEVKT
N01  C                   END
N01  C                   IF        HEM3 = -1
N01  C                   Z-ADD     0             HEM3
N01  C                   END
N01  C                   IF        HENT = -1
N01  C                   Z-ADD     0             HENT
N01  C                   END
N01  C                   EXSR      OPDOPPD
N01  C                   END
N01  C                   END
N01   *
     C                   SELECT
     C                   WHEN      XXTAG = XREF
     C                   EXSR      SRREF
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
     C                   GOTO      STSRCONSET2
N01  C                   WHEN      XXTAG = XFREETEXT
S02  C*                  IF        XCOLLA = 'Booking'
N01  C                   EXSR      SRFREET
N01  C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
S02  C*                  ELSE
S02  C*                  EXSR      LESTAG
S02  C*                  END
N01  C                   GOTO      STSRCONSET2
     C                   WHEN      ((XXTAG = XPACKAGE) OR (XXTAG = XPACKAGEX))
     C                   GOTO      STSRCONSET3
     C*                  WHEN      XXTAG = XCGISET
     C                   WHEN      ((XXTAG = XCGISET) OR (XXTAG = XCGISETT))
     C                   GOTO      STSRCONSET3
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      STSRCONSET3
     C                   OTHER
     C*                  EXSR      LESREC
     C                   ENDSL
     C                   MOVE      WPOS          XPOS              4 0
     C     XCONSIGNMEND  SCAN      RDATA3:WPOS   WPOS              4 0    51
     C   51              IF        RDATAXX <> *BLANKS
     C     WPOS          SUB       20            XPOS2             4 0
     C                   IF        XPOS2 > XPOS
     C                   MOVE      *OFF          *IN51
     C                   END
     C                   END
     C                   ENDDO
N08  C   51              GOTO      SLSRCONSET
      *
     C                   EXSR      LESTAG
      *
     C     STSRCONSET3   TAG
     C                   IF        ((XXTAG = XPACKAGE) OR (XXTAG = XPACKAGEX))
     C                   MOVE      'J'           XPACKNIVÅ         1
     C                   EXSR      SRPACKAG
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
     C                   ELSE
     C                   MOVE      'N'           XPACKNIVÅ
     C                   END
      *
      *
     C     STSRCONSET    TAG
      *
     C                   SELECT
     C                   WHEN      XXTAG = XCGISET
     C                   EXSR      SRGISET
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
     C                   WHEN      XXTAG = XCGISETT
     C                   EXSR      LESTAG
      *
     C                   WHEN      XXTAG = XMPARTY
     C                   EXSR      SRMPARTY
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
      *
     C                   WHEN      ((XXTAG = XEQUIPM) OR (XXTAG = XEQUIPMTOM))
     C                   EXSR      SREQUIPM
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
      *
     C                   WHEN      ((XXTAG = XCOD) OR (XXTAG = XCOD))
     C                   EXSR      SRCOD
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
      *
     C                   WHEN      ((XXTAG = XDGOODS) OR (XXTAG = XDGOODSTOM))
     C                   EXSR      SRDGOODS
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
      *
     C                   WHEN      ((XXTAG = XTRALEG) OR (XXTAG = XTRALEGTOM))
     C                   EXSR      SRTRALEG
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
      *
     C                   WHEN      XXTAG = XTOD
     C                   EXSR      SRTOD
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
      *
     C                   WHEN      ((XXTAG = XCHARGE) OR (XXTAG = XCHARGETOM))
     C                   EXSR      SRCHARGE
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
      *
     C                   WHEN      ((XXTAG = XSERVIC) OR (XXTAG = XSERVICTOM))
     C                   EXSR      SRSERVIC
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
      *
     C                   WHEN      ((XXTAG = XMDAT) OR (XXTAG = XMDATTOM))
     C                   EXSR      SRMDAT
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
      *
     C                   WHEN      ((XXTAG = XCUSINF) OR (XXTAG = XCUSINFTOM))
     C                   EXSR      SRCUSINF
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
      *
     C                   WHEN      ((XXTAG = XOFFER) OR (XXTAG = XOFFERTOM))
     C                   EXSR      SROFFER
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
      *
     C                   WHEN      ((XXTAG = XINSUR) OR (XXTAG = XINSURTOM))
     C                   EXSR      SRINSUR
     C     XSLUTTLES     CABEQ     'J'           SLSRCONSET
      *
     C                   WHEN      XXTAG = XSPARTY
     C                   GOTO      SLSRCONSET
N08   *
N08  C                   WHEN      XXTAG = XCONSET
N08  C                   GOTO      SLSRCONSET
      *
     C                   ENDSL
     C                   GOTO      STSRCONSET
      *
S47  C*    SLSRCONSET    ENDSR
N47  C     SLSRCONSET    TAG
N47  C                   IF        CMRFSSOK <> *BLANKS
N47  C     ZRISOL02K     CHAIN     ZRISOL02                           33
N47  C                   IF        *IN33
N47  C                   EVAL      FSREFF = HEREFF
N47  C                   EVAL      FSUNIK = HEUNIK
N47  C                   EVAL      FSKODE = 'IFB'
N47  C                   EVAL      FSSOK  = CMRFSSOK
N47  C                   WRITE     FRISOKR
N47  C                   END
N47  C                   END
N47   *
N47  C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Package                                   SRPACKAG /
      *////////////////////////////////////////////////////////////
     C     SRPACKAG      BEGSR
      *
     C     ZEADL01K      CHAIN     ZEADL01                            33
      *
      * LES <Package
     C     STSRPACKAG    TAG
     C                   SELECT
     C                   WHEN      XXTAG = *BLANKS
     C                   DOW       ((XXTAG<>XPACKAGE) AND (XXTAG<>XPACKAGEX))
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRPACKAG
     C                   ENDDO
     C                   WHEN      ((XXTAG<>XPACKAGE) AND (XXTAG<>XPACKAGEX))
     C                   GOTO      SLSRPACKAG
     C                   ENDSL
      *
      * LES idType="
     C                   Z-ADD     WPOS          XPOS
     C     XPACKAGE7     SCAN      RDATA3:WPOS   WPOS              4 0    51
N32  C                   IF        *IN51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLSRPACKAG
     C     XPACKAGE7     SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
S08  C*                  IF        WPOS > 1024
S08  C*                  SUB       1024          WPOS
S08  C*                  EXSR      LESREC
S08  C*                  END
      * LES idType
     C                   ADD       8             WPOS
     C                   EXSR      GETTXT
     C                   MOVEL     XTXT          XIDTYPE          10
N32  C                   ELSE
N32  C                   MOVEL     *BLANKS       XIDTYPE          10
N32  C                   END
     C                   Z-ADD     XPOS          WPOS
      * LES packageId="
     C     XPACKAGE4     SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLSRPACKAG
     C     XPACKAGE4     SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
      * LES packageId
     C                   ADD       11            WPOS
     C                   EXSR      GETTXT
      *
NC   C*                  ADD       1             FMLINR
NC   C****               ADD       1             FMLINR       altid linjenr 0
     C                   MOVEL     XTXT          FMMRK1
     C                   ADD       1             FVLINR
     C                   Z-ADD     0             FVVKT
     C                   Z-ADD     0             FVVOL
N48  C                   EVAL      FVPAKN = *BLANKS
      * Oppdater på FRISOK
     C                   SELECT
     C                   WHEN      ((XIDTYPE = '24') OR (XIDTYPE = '40'))
     C                   EVAL      FSKODE = 'HAK'
     C                   WHEN      ((XIDTYPE = '30') OR (XIDTYPE = 'EANSSCC'))
     C                   EVAL      FSKODE = 'PCI'
     C                   OTHER
     C                   EVAL      FSKODE = 'XXX'
     C                   ENDSL
     C                   MOVEL     XTXT          FSSOK
     C                   IF        FSKODE <> 'HAK'
     C                   MOVE      XIDTYPE       FSSOK
S59  C*                  IF        ((FSKODE <> 'PCI') OR (XFULLCMR = 'N'))
N59  C                   IF        FSKODE <> 'PCI'
     C                   WRITE     FRISOKR
N08  C                   END
     C                   END
      *
     C     STSRPACKAG2   TAG
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRPACKAG
      *
     C                   SELECT
      * Ny <Package
     C                   WHEN      ((XXTAG = XPACKAGE) OR (XXTAG = XPACKAGEX))
     C                   MOVE      *OFF          *IN51
     C                   GOTO      STSRPACKAG3
      * LES <Marking>
     C                   WHEN      XXTAG = XPACKAGE1
N03  C     XPACKAGE1E    SCAN      RDATA3:WPOS   WPOS              4 0    51
N11  C                   ADD       9             WPOS
S11  C*                  ADD       10            WPOS
S11  C*                  DOW       IN(WPOS) = *BLANKS
S11  C*                  ADD       1             WPOS
S11  C*                  END
S11  C*                  SUB       1             WPOS
      * LES <GrossWeight
     C                   WHEN      XXTAG = XPACKAGE2
     C                   ADD       15            WPOS
S46  C*                  IF        FSKODE = 'HAK'
N46  C                   IF        FSKODE = 'HAK' AND S0004 <> '916297807'      *IKKE KVÆRNER
     C                   MOVE      WPOS          XPOS
     C                   EXSR      GETTXT
     C                   MOVEL     XTXT          XAN10            10
     C                   MOVE      XAN10         FSSOK
     C                   WRITE     FRISOKR
     C                   MOVE      XPOS          WPOS
     C                   END
     C                   EXSR      GETTAL
     C                   ADD       0,49999       XTAL
     C                   Z-ADD(H)  XTAL          FVVKT
     C                   MOVE      *OFF          *IN51
     C                   DOW       *IN51 = *OFF
     C     XPACKAGE2E    SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              EXSR      LESREC
     C                   ENDDO
     C                   ADD       13            WPOS
      * LES <Volume
     C                   WHEN      XXTAG = XPACKAGE3
     C                   ADD       10            WPOS
     C                   EXSR      GETTXT
     C                   ADD       2             WPOS
     C                   EXSR      GETTAL
     C                   SELECT
     C                   WHEN      XTXT = 'MTQ'
     C                   ADD       0,49          XTAL
     C                   Z-ADD(H)  XTAL          FVVOL
     C                   WHEN      XTXT = 'DMQ'
     C                   ADD       0,00049       XTAL
     C                   EVAL(H)   FVVOL = XTAL / 1000
     C                   OTHER
     C                   EVAL      FVVOL = 0
     C                   ENDSL
     C                   MOVE      *OFF          *IN51
     C                   DOW       *IN51 = *OFF
     C     XPACKAGE3E    SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              EXSR      LESREC
     C                   ENDDO
     C                   ADD       8             WPOS
      * LES <Volume/>
     C                   WHEN      XXTAG = XPACKAGE3F
     C                   SUB       1             WPOS
N15   * LES <LoadingMetres
N15  C                   WHEN      XXTAG = XPACKAGED
N15  C                   ADD       10            WPOS
N15  C                   EXSR      GETTXT
N15  C                   ADD       2             WPOS
N15  C                   EXSR      GETTAL
N15  C                   Z-ADD(H)  XTAL          FVLM
N15  C                   MOVE      *OFF          *IN51
N15  C                   DOW       *IN51 = *OFF
N15  C     XPACKAGEDE    SCAN      RDATA3:WPOS   WPOS              4 0    51
N15  C  N51              EXSR      LESREC
N15  C                   ENDDO
N15  C                   ADD       8             WPOS
N15   * LES <LoadingMetres/>
N15  C                   WHEN      XXTAG = XPACKAGEDF
N15  C                   SUB       1             WPOS
      * LES <Height
     C                   WHEN      XXTAG = XPACKAGE8
S24  C*                  ADD       15            WPOS
N24  C                   ADD       10            WPOS
N24  C                   EXSR      GETTXT
N24  C                   MOVEL     XTXT          XENHET            3
N24  C                   ADD       2             WPOS
     C                   EXSR      GETTAL
     C                   ADD       0,00499       XTAL
N24  C                   SELECT
N24  C                   WHEN      XENHET = 'DMT'
     C                   IF        XTAL > 999,99
     C                   EVAL      FVHOY = 9999,9
     C                   ELSE
     C                   EVAL(H)   FVHOY = XTAL * 10
     C                   END
N24  C                   WHEN      XENHET = 'CMT'
S39  C*                  IF        XTAL > 9999,99
N39  C                   IF        XTAL > 9999,9
     C                   EVAL      FVHOY = 9999,9
     C                   ELSE
N24  C                   EVAL(H)   FVHOY = XTAL
     C                   END
N24  C                   OTHER
N24  C                   ENDSL
     C                   MOVE      *OFF          *IN51
     C                   DOW       *IN51 = *OFF
     C     XPACKAGE8E    SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              EXSR      LESREC
     C                   ENDDO
     C                   ADD       8             WPOS
      * LES <Height/>
     C                   WHEN      XXTAG = XPACKAGE8F
     C                   SUB       1             WPOS
      * LES <Width
     C                   WHEN      XXTAG = XPACKAGE9
S24  C*                  ADD       15            WPOS
N24  C                   ADD       10            WPOS
N24  C                   EXSR      GETTXT
N24  C                   MOVEL     XTXT          XENHET            3
N24  C                   ADD       2             WPOS
     C                   EXSR      GETTAL
     C                   ADD       0,00499       XTAL
N24  C                   SELECT
N24  C                   WHEN      XENHET = 'DMT'
     C                   IF        XTAL > 999,99
     C                   EVAL      FVBRD = 9999,9
     C                   ELSE
     C                   EVAL(H)   FVBRD = XTAL * 10
     C                   END
N24  C                   WHEN      XENHET = 'CMT'
N39  C                   IF        XTAL > 9999,9
N39  C                   EVAL      FVBRD = 9999,9
N39  C                   ELSE
N24  C                   EVAL(H)   FVBRD = XTAL
N39  C                   END
N24  C                   OTHER
N24  C                   ENDSL
     C                   MOVE      *OFF          *IN51
     C                   DOW       *IN51 = *OFF
     C     XPACKAGE9E    SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              EXSR      LESREC
     C                   ENDDO
     C                   ADD       7             WPOS
      * LES <Width/>
     C                   WHEN      XXTAG = XPACKAGE9F
     C                   SUB       1             WPOS
      * LES <Length
     C                   WHEN      XXTAG = XPACKAGEA
S24  C*                  ADD       15            WPOS
N24  C                   ADD       10            WPOS
N24  C                   EXSR      GETTXT
N24  C                   MOVEL     XTXT          XENHET            3
N24  C                   ADD       2             WPOS
     C                   EXSR      GETTAL
     C                   ADD       0,00499       XTAL
N24  C                   SELECT
N24  C                   WHEN      XENHET = 'DMT'
N39  C                   IF        XTAL > 999,99
N39  C                   EVAL      FVLEN = 9999,9
N39  C                   ELSE
     C                   EVAL(H)   FVLEN = XTAL * 10
N39  C                   END
N24  C                   WHEN      XENHET = 'CMT'
S39  C*                  IF        XTAL > 999,99
N39  C                   IF        XTAL > 9999,9
     C                   EVAL      FVLEN = 9999,9
     C                   ELSE
N24  C                   EVAL(H)   FVLEN = XTAL
     C                   END
N24  C                   OTHER
N24  C                   ENDSL
     C                   MOVE      *OFF          *IN51
     C                   DOW       *IN51 = *OFF
     C     XPACKAGEAE    SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              EXSR      LESREC
     C                   ENDDO
     C                   ADD       8             WPOS
      * LES <Length/>
     C                   WHEN      XXTAG = XPACKAGEAF
     C                   SUB       1             WPOS
      * LES <PackageTypeCode
     C                   WHEN      XXTAG = XPACKAGEB
     C                   EXSR      GETTXT
     C*                  EVAL      FVVT = XTXT
     C                   EVAL      FVPAKN = XTXT
     C                   MOVE      *OFF          *IN51
     C                   DOW       *IN51 = *OFF
     C     XPACKAGEBE    SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              EXSR      LESREC
     C                   ENDDO
     C                   ADD       17            WPOS
      * LES <PackageTypeCode/>
     C                   WHEN      XXTAG = XPACKAGEBF
     C                   SUB       1             WPOS
      * LES <PackageTypeText
     C                   WHEN      XXTAG = XPACKAGEC
     C                   EXSR      GETTXT
     C*                  CAT       XTXT:1        FVVT
     C*                  EVAL      FVVT = XTXT
     C                   MOVE      *OFF          *IN51
     C                   DOW       *IN51 = *OFF
     C     XPACKAGECE    SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              EXSR      LESREC
     C                   ENDDO
     C                   ADD       17            WPOS
      * LES <PackageTypeText/>
     C                   WHEN      XXTAG = XPACKAGECF
     C                   SUB       1             WPOS
      * LES <FreeText>
     C                   WHEN      XXTAG = XPACKAGE5
     C                   EVAL      XXTAG = *BLANKS
     C*                  EVAL      FVVT  = *BLANKS
     C                   DOW       XXTAG = *BLANKS
     C                   EXSR      LESTAG
     C                   SELECT
     C                   WHEN      XXTAG = XFREETEXT1
     C                   EXSR      GETTXT
     C*                  EVAL      FVVT  = XTXT
     C                   WHEN      XXTAG = XFREETEXT2
     C                   EXSR      GETTXT
     C*                  IF        FVVT  = *BLANKS
     C*                  EVAL      FVVT  = XTXT
     C*                  ELSE
     C*                  CAT       XTXT:1        FVVT
     C*                  END
     C                   LEAVE
     C                   ENDSL
     C                   ENDDO
     C                   MOVE      *OFF          *IN51
     C                   DOW       *IN51 = *OFF
     C     XPACKAGE5E    SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              EXSR      LESREC
     C                   ENDDO
     C                   ADD       10            WPOS
      * LES <FreeText/>
     C                   WHEN      XXTAG = XPACKAGE5F
     C                   SUB       1             WPOS
      * LES <Reference>
     C                   WHEN      XXTAG = XPACKAGE6
     C                   MOVE      *OFF          *IN51
     C                   DOW       *IN51 = *OFF
     C     XPACKAGE6E    SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              EXSR      LESREC
     C                   ENDDO
     C                   ADD       11            WPOS
      * LES <Reference/>
     C                   WHEN      XXTAG = XPACKAGE6F
     C                   SUB       1             WPOS
NXX   *
NXX  C                   WHEN      XXTAG = XMPARTY
NXX  C*                  GOTO      SLSRPACKAG
NXX  C                   GOTO      STSRPACKAG3
N60   * LES <ConsignmentGoodsItemSet>
N60  C                   WHEN      XXTAG = XCGISET
N60  C                   GOTO      STSRPACKAG3
      *
     C                   OTHER
      *
     C                   ENDSL
      *
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
     C                   ADD       1             WPOS
     C                   DOW       IN(WPOS) = ' '
     C                   ADD       1             WPOS
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
     C                   ENDDO
      *
     C                   MOVE      WPOS          XPOS              4 0
     C     XPACKAGEEND   SCAN      RDATA3:WPOS   WPOS              4 0    51
S06  C*  51              SUB       1             WPOS
S06  C*  51              SUB       1             WPOS
S08  C*  511             DO        7
N08  C   51              IF        WPOS > 1
N06  C     1             DO        7
N06  C                   SUB       1             WPOS
N06  C                   IF        WPOS = 1
N06  C                   LEAVE
N06  C                   END
N06  C                   ENDDO
N08  C                   END
     C   51WPOS          COMP      XPOS                                 5151
     C  N51              EVAL      WPOS = XPOS - 1
     C  N51              GOTO      STSRPACKAG2
      *
     C     STSRPACKAG3   TAG
     C*                  IF        XIDTYPE <> '28'
S08  C*                  IF        XIDTYPE <> '24'
N08  C                   SELECT
N08  C                   WHEN      XIDTYPE = '24'
N08  C                   WHEN      XIDTYPE = '30'
N08  C                   WHEN      XIDTYPE = 'SSCC'
N13  C                   WHEN      XIDTYPE = 'HAK'
N13  C                   WHEN      XIDTYPE = 'PCI'
N13  C                   WHEN      XIDTYPE = 'XXX'
N08  C                   OTHER
     C                   MOVE      *BLANKS       FMMRK1
     C                   END
NXX  C                   IF        FMMRK1 <> *BLANKS
N37  C                   ADD       1             FMMKNR
N48  C                   IF        FVPAKN = *BLANKS
N48  C                   EVAL      FMLEDI = XXPKTYPE
N48  C                   ELSE
N48  C                   EVAL      FMLEDI = FVPAKN
N48  C                   END
N50  C                   IF        FIFIRM = '51' AND HEOT = 'PD'
N50  C                   SELECT
N50  C                   WHEN      %SUBST(HEVS1:1:2) = 'P1'
N50  C                   EVAL      FMLEDI = '201'
N50  C                   WHEN      %SUBST(HEVS1:1:2) = 'P2'
N50  C                   EVAL      FMLEDI = 'Z1G'
N50  C                   WHEN      %SUBST(HEVS1:1:2) = 'P4'
N50  C                   EVAL      FMLEDI = 'Z1R'
N50  C                   ENDSL
N50  C                   END
     C                   WRITE     DOKUFMR
NXX  C                   END
     C                   WRITE     DOKUFVR
NXX  C                   IF        XXTAG = XMPARTY
NXX  C                   GOTO      SLSRPACKAG
NXX  C                   END
N60  C                   IF        XXTAG = XCGISET
N60  C                   GOTO      SLSRPACKAG
N60  C                   END
      *
     C*                  ADD       1             HENT
     C                   IF        ((XXTAG<>XPACKAGE) AND (XXTAG<>XPACKAGEX))
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRPACKAG
     C                   END
     C                   IF        ((XXTAG = XPACKAGE) OR (XXTAG = XPACKAGEX))
     C                   GOTO      STSRPACKAG
     C                   END
      *
     C     SLSRPACKAG    TAG
     C                   UPDATE    HEADFR
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Reference                                    SRREF /
      *////////////////////////////////////////////////////////////
     C     SRREF         BEGSR
      *
     C                   EVAL      FSKODE = 'ORD'
     C                   MOVE      'N'           XREFJA            1
     C                   MOVE      *BLANKS       FSSOK
      * LES TAG
     C     STSRREF       TAG
     C*                  ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRREF
      *
     C                   SELECT
      * <ReferenceNo>
     C                   WHEN      XXTAG = XREF1
     C                   EXSR      GETTXT
     C*                  IF        M0068 <> XTXT
     C                   MOVEL     XTXT          FSSOK
     C                   MOVE      'J'           XREFJA
     C*                  END
     C                   GOTO      STSRREF
      * <ReferenceType>
     C                   WHEN      XXTAG = XREF2
     C                   IF        XREFJA = 'J'
     C                   EXSR      GETTXT
     C                   SELECT
     C                   WHEN      XTXT = 'CMR'
     C                   EVAL      FSKODE = 'IFB'
N08  C                   EVAL      XFULLCMR = 'J'
     C                   WHEN      ((XTXT = 'CU') OR (XTXT = 'SRN'))
     C                   EVAL      FSKODE = XTXT
N42  C                   IF        XTXT = 'CU' AND XMSGFUN = 'Expediting'
N42  C                   EVAL      XHEGM1 = FSSOK
N42  C                   END
N08  C                   WHEN      XTXT = 'AQY'
N08  C                   EVAL      FSKODE = XTXT
N02  C                   WHEN      ((XTXT = 'ANT') OR (XTXT = 'AEP'))
N02  C                   EVAL      FSKODE = XTXT
     C                   OTHER
S32  C*                  MOVEL     XTXT          XAN10            10
S32  C*                  MOVE      XAN10         FSSOK
N32  C                   EVAL      FSKODE = XTXT
     C                   ENDSL
????? * ALLE REFERANSE BLIR OPPDATERT.
N35  C                   IF        XXKODE <> '704' OR XXKODE <> '741' OR
N35  C                             FSKODE <> 'AWB'
     C                   WRITE     FRISOKR
N35  C                   END
N07   *
N07  C                   IF        FSKODE = 'CU'
N07  C                   EXSR      SJEKKOPD
N07  C                   END
N02   *
N02  C                   SELECT
N02  C                   WHEN      FSKODE = 'ANT'
N02  C                   ADD       1             FRTLI
N02  C                   EVAL      FRTTXT = 'Mottaks Ref: '
N02  C                             + FSSOK
N02  C                   WRITE     FREETXTR
N02  C                   WHEN      FSKODE = 'AEP'
N02  C                   ADD       1             FRTLI
N02  C                   EVAL      FRTTXT = 'Faktura Ref: '
N02  C                             + FSSOK
N02  C                   WRITE     FREETXTR
N02  C                   ENDSL
N02   *
     C                   MOVE      'N'           XREFJA
S35  C*                  IF        XTXT = 'CU'
N35  C                   IF        (FSKODE = 'CU' AND XXKODE <> '704' AND
N35  C                              XXKODE <> '741') OR FSKODE = 'HWB' OR
N35  C                              FSKODE = 'AWB'
     C     ZEADL01K      CHAIN     ZEADL01                            33
N35  C                   SELECT
N35  C                   WHEN      FSKODE = 'AWB'
N35  C                   MOVEL     FSSOK         HERFA
N35  C                   WHEN      FSKODE = 'HWB'
N35  C                   MOVEL     FSSOK         HEHAWB
N35  C                   OTHER
     C                   MOVEL     FSSOK         HERFA
N35  C                   ENDSL
     C                   UPDATE    HEADFR
     C                   END
N08  C                   IF        ((FSKODE = 'IFB') AND (XFULLCMR = 'J'))
N08  C     ZEADL01K      CHAIN     ZEADL01                            33
N08  C*                  EVAL      HERFK = '401' + FSSOK
N08  C                   EVAL      HXSNDN = '401' + FSSOK
N08  C                   UPDATE    HEADFR
N08  C                   END
     C                   EVAL      FSKODE = 'ORD'
     C                   END
     C                   GOTO      STSRREF
      *
     C                   ENDSL
      *
     C                   IF        XREFJA = 'J'
     C                   WRITE     FRISOKR
N07   *
N07  C                   IF        FSKODE = 'CU'
N07  C                   EXSR      SJEKKOPD
N07  C                   END
N02   *
N02  C                   SELECT
N02  C                   WHEN      FSKODE = 'ANT'
N02  C                   ADD       1             FRTLI
N02  C                   EVAL      FRTTXT = 'Mottaks Ref: '
N02  C                             + FSSOK
N02  C                   WRITE     FREETXTR
N02  C                   WHEN      FSKODE = 'AEP'
N02  C                   ADD       1             FRTLI
N02  C                   EVAL      FRTTXT = 'Faktura Ref: '
N02  C                             + FSSOK
N02  C                   WRITE     FREETXTR
N02  C                   ENDSL
N02   *
     C                   END
     C                   MOVE      *BLANKS       FSSOK
     C     XXTAG         CABEQ     XREF          STSRREF
      *
     C     SLSRREF       ENDSR
      *
N60   *////////////////////////////////////////////////////////////
N60   * SR for Reference  OPPDATER HEGM1/2                 SRREF2 /
N60   *////////////////////////////////////////////////////////////
N60  C     SRREF2        BEGSR
N60  C                   MOVE      'N'           XREFJA
N60  C                   MOVE      *BLANKS       XXGM
N60   * LES TAG
N60  C     STSRREF2      TAG
N60  C                   EXSR      LESTAG
N60  C     XSLUTTLES     CABEQ     'J'           SLSRREF2
N60   *
N60  C                   SELECT
N60   * <ReferenceNo>
N60  C                   WHEN      XXTAG = XREF1
N60  C                   EXSR      GETTXT
N60  C                   EVAL      XXGM = XTXT
N60  C                   MOVE      'J'           XREFJA
N60  C                   GOTO      STSRREF2
N60   * <ReferenceType>
N60  C                   WHEN      XXTAG = XREF2
N60  C                   IF        XREFJA = 'J'
N60  C                   EXSR      GETTXT
N60  C                   IF        XTXT = 'AAQ'
N60  C                   SELECT
N60  C                   WHEN      XXGM1 = *BLANKS
N60  C                   EVAL      XXGM1 = XXGM
N08  C                   WHEN      XXGM2 = *BLANKS
N60  C                   EVAL      XXGM2 = XXGM
N60  C                   ENDSL
N60  C                   MOVE      'N'           XREFJA
N60  C                   END
N60  C                   END
N60  C                   OTHER
N60  C                   GOTO      SLSRREF2
N60  C                   ENDSL
N60   *
N60  C                   GOTO      STSRREF2
N60   *
N60  C     SLSRREF2      ENDSR
N60   *
N01   *////////////////////////////////////////////////////////////
N01   * SR for Freetext                                   SRFREET /
N01   *////////////////////////////////////////////////////////////
N01  C     SRFREET       BEGSR
N02  C                   MOVE      *BLANKS       XAN03             3
N02  C                   MOVE      *BLANKS       XOPDFRT1          1
N02  C                   MOVE      *BLANKS       XOPDFRT2         70
N01   * LES TAG
N01  C     STSRFREET     TAG
N01  C                   EXSR      LESTAG
N01  C     XSLUTTLES     CABEQ     'J'           SLSRFREET
N01   *
N01  C                   SELECT
N01  C                   WHEN      XXTAG = XFREETEXT1
N02  C                   EXSR      GETTXT
N02  C                   MOVEL     XTXT          XAN03             3
N02  C                   IF        XOPDFRT1 = 'J'
N02  C                   EVAL      XTXT = XOPDFRT2
N02  C                   EXSR      SRFREET2
N02  C                   ELSE
N02  C                   MOVE      'J'           XOPDFRT1
N02  C                   END
N01  C                   GOTO      STSRFREET
N02   *
N01  C                   WHEN      XXTAG = XFREETEXT2
S61  C*                  EXSR      GETTXT
N02  C                   IF        XOPDFRT1 = 'J'
N61  C                   IF        XAN03 = 'DEL'
N61  C                   EXSR      SRFREET3
N61  C                   ELSE
N61  C                   EXSR      GETTXT
N02  C                   EXSR      SRFREET2
N61  C                   END
N02  C                   ELSE
N61  C                   EXSR      GETTXT
N02  C                   MOVE      'J'           XOPDFRT1
N02  C                   EVAL      XOPDFRT2 = XTXT
N02  C                   END
S02  C*                  MOVE      *ON           *IN33
S02  C*                  Z-ADD     1             XPOS1             4 0
S02  C*                  DOU       *IN33 = *OFF
S02  C*                  MOVE      XPOS1         XPOS3             4 0
S02  C*    '|'           SCAN      XTXT:XPOS1    XPOS2             4 0    33
S02  C*                  IF        *IN33
S02  C*                  ADD       1             FRTLI
S02  C*                  EVAL      FRTTXT = %SUBST(XTXT:XPOS1:XPOS2-XPOS1)
S02  C*                  WRITE     FREETXTR
S02  C*                  ELSE
S02  C*                  EVAL      FRTTXT = %SUBST(XTXT:XPOS3:70)
S02  C*                  IF        FRTTXT <> *BLANKS
S02  C*                  ADD       1             FRTLI
S02  C*                  WRITE     FREETXTR
S02  C*                  END
S02  C*                  END
S02  C*                  EVAL      XPOS1 = XPOS2 + 1
S02  C*                  ENDDO
N12   * LES <NoOfCharacters>
N12  C                   WHEN      XXTAG = XFREETEXT3
N12  C                   EXSR      GETTAL
N12   * LES <NoOfCharacters/>
N12  C                   WHEN      XXTAG = XFREETEXT3F
N02   *
N01  C                   OTHER
N01  C                   GOTO      SLSRFREET
N01  C                   ENDSL
N01  C                   GOTO      STSRFREET
N01   *
N01  C     SLSRFREET     ENDSR
N01   *
N02   *////////////////////////////////////////////////////////////
N02   * SR for Freetext                                  SRFREET2 /
N02   *////////////////////////////////////////////////////////////
N02  C     SRFREET2      BEGSR
N02  C                   SELECT
N02  C                   WHEN      XAN03 = 'AGW'
N02  C                   ADD       1             FRTLI
N02  C                   EVAL      FRTTXT = 'Rigg: '
N02  C                             + XTXT
N02  C                   WRITE     FREETXTR
N02  C                   EVAL      FSKODE = 'RIG'
N02  C                   EVAL      FSSOK  = XTXT
N02  C                   WRITE     FRISOKR
N08  C                   WHEN      XAN03 = 'ICN'
N08  C                   ADD       1             FRTLI
N08  C                   EVAL      FRTTXT = XTXT
N08  C                   EVAL      FRTKOD = 'C'
N08  C                   WRITE     FREETXTR
N08  C                   EVAL      FRTKOD = ' '
N08   *
N02   *
N02  C                   WHEN      XAN03 = 'DEL'
N02  C                   MOVE      *ON           *IN33
N02  C                   Z-ADD     1             XPOS1             4 0
N02  C                   DOU       *IN33 = *OFF
N02  C                   MOVE      XPOS1         XPOS3             4 0
N02  C     '|'           SCAN      XTXT:XPOS1    XPOS2             4 0    33
N02  C                   IF        *IN33
N02  C                   ADD       1             FRTLI
N02  C                   EVAL      FRTTXT = %SUBST(XTXT:XPOS1:XPOS2-XPOS1)
N02  C                   WRITE     FREETXTR
N02  C                   ELSE
N02  C                   EVAL      FRTTXT = %SUBST(XTXT:XPOS3:70)
N02  C                   IF        FRTTXT <> *BLANKS
N02  C                   ADD       1             FRTLI
N02  C                   WRITE     FREETXTR
N02  C                   END
N02  C                   END
N02  C                   EVAL      XPOS1 = XPOS2 + 1
N02  C                   ENDDO
N55  C                   WHEN      XAN03  = 'SIC'
N55  C                   EVAL      D29UNI = HEUNIK
N55  C                   EVAL      D29REF = HEREFF
N55  C                   EVAL      D29FNR = 1
N55  C                   EVAL      D29TXT = XTXT
N55  C                   WRITE     DOK29R
N02  C                   ENDSL
N02   *
N02  C                   MOVE      *BLANKS       XAN03
N02  C                   MOVE      *BLANKS       XOPDFRT1
N02   *
N02  C                   ENDSR
N02   *
N61   *////////////////////////////////////////////////////////////
N61   * SR for Freetext                                  SRFREET3 /
N61   *////////////////////////////////////////////////////////////
N61  C     SRFREET3      BEGSR
N61   *
N61  C     STSRFREET3    TAG
N61  C                   MOVE      *BLANKS       XTXT
N61  C                   MOVE      *ZEROS        XN                4 0
N61  C                   DOW       IN(WPOS) <> '<' AND IN(WPOS) <> '"'
N61  C                             AND IN(WPOS) <> '|'
N61  C                   IF        IN(WPOS) = '&'
N61  C                   EXSR      KVTTEGN
N61  C                   END
N61  C                   ADD       1             XN
N61  C                   MOVE      IN(WPOS)      XT80(XN)
N61  C                   ADD       1             WPOS
N61  C                   ENDDO
N61   *
N61  C                   IF        WPOS > 1024
N61  C                   SUB       1024          WPOS
N61  C                   EXSR      LESREC
N61  C                   END
N61   *
N61  C                   IF        XTXT <> *BLANKS
N61  C                   ADD       1             FRTLI
N61  C                   EVAL      FRTTXT = XTXT
N61  C                   WRITE     FREETXTR
N61  C                   END
N61  C                   IF        IN(WPOS) = '|'
N61  C                   ADD       1             WPOS
N61  C                   GOTO      STSRFREET3
N61  C                   END
N61   *
N61  C                   MOVE      *BLANKS       XAN03
N61  C                   MOVE      *BLANKS       XOPDFRT1
N61   *
N61  C                   ENDSR
N61   *
      *////////////////////////////////////////////////////////////
      * SR for GoodsItemSet                               SRGISET /
      *////////////////////////////////////////////////////////////
     C     SRGISET       BEGSR
      *
      * LES TAG
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRGISET
      *
     C     STSRGISET     TAG
     C                   MOVE      XXTAG         XXTAGGM          50
     C                   SELECT
      * <GoodsItem>
     C                   WHEN      ((XXTAG = XGOODSI) OR (XXTAG = XGOODSIX))
     C                   EXSR      SRGOODSI
      * <Package>
     C                   WHEN      ((XXTAG = XPACKAGE) OR (XXTAG = XPACKAGEX))
     C                   EXSR      SRPACKAG
     C     XSLUTTLES     CABEQ     'J'           SLSRGISET
      *
     C*                  WHEN      XXTAG = XCGISET
     C                   WHEN      ((XXTAG = XCGISET) OR (XXTAG = XCGISETT))
     C                   GOTO      SLSRGISET
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      SLSRGISET
     C                   WHEN      XXTAG = XXTAGGM
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
     C                   ENDSL
      *
     C                   GOTO      STSRGISET
      *
     C     SLSRGISET     ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for GoodsItem                                 SRGOODSI /
      *////////////////////////////////////////////////////////////
     C     SRGOODSI      BEGSR
      *
     C                   MOVE      *BLANKS       XXPKTYPE          5
     C                   MOVE      *BLANKS       XXVS1            25
     C                   MOVE      *BLANKS       XXVS2            25
S42  C*                  MOVE      *BLANKS       XXGM1            15
S42  C*                  MOVE      *BLANKS       XXGM2            15
      *
      * LES TAG
     C     STSRGOODSI    TAG
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRGOODSI
      *
     C                   SELECT
      * <GoodsDescription>
     C                   WHEN      XXTAG = XGOODSI1
     C                   EXSR      GETTXT
     C                   EVAL      FRTTXT = XTXT
     C                   EVAL      FVVT   = XTXT
     C                   SELECT
     C                   WHEN      XXVS1 = *BLANKS
     C                   MOVEL     XTXT          XXVS1
     C                   WHEN      XXVS2 = *BLANKS
     C                   MOVEL     XTXT          XXVS2
     C                   ENDSL
      * <NumberOfPackage>
     C                   WHEN      XXTAG = XGOODSI2
     C                   EXSR      GETTXT
     C                   CAT       XTXT:1        FRTTXT
      * <PackageTypeCode>
     C                   WHEN      XXTAG = XGOODSI3
     C                   EXSR      GETTXT
     C                   CAT       XTXT:1        FRTTXT
     C                   IF        XXPKTYPE = *BLANKS
     C                   MOVEL     XTXT          XXPKTYPE
     C                   END
      * <Reference>
     C                   WHEN      XXTAG = XGOODSI4
XXX   * NOR-CARGO VIL IKKE HA DET
XXX  C*                  EXSR      GETTXT
XXX  C*                  SELECT
XXX  C*                  WHEN      XXGM1 = *BLANKS
XXX  C*                  MOVEL     XTXT          XXGM1
XXX  C*                  WHEN      XXGM2 = *BLANKS
XXX  C*                  MOVEL     XTXT          XXGM2
XXX  C*                  ENDSL
N60  C                   EXSR      SRREF2
N60  C                   IF        (XXTAG = XCGISET OR XXTAG = XCGISETT)
N60  C                             OR (XXTAG = XPACKAGE OR XXTAG = XPACKAGEX)
N60  C                             OR XXTAG = XMPARTY
N60  C                   GOTO      STSRGOODSI2
N60  C                   END
      * <GrossWeight
     C                   WHEN      XXTAG = XGOODSI5
      *
      * <Package>
     C                   WHEN      ((XXTAG = XPACKAGE) OR (XXTAG = XPACKAGEX))
     C                   GOTO      STSRGOODSI2
      * <ConsignmentGoodsItemSet>
     C*                  WHEN      XXTAG = XCGISET
     C                   WHEN      ((XXTAG = XCGISET) OR (XXTAG = XCGISETT))
     C                   GOTO      STSRGOODSI2
      * <Party
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      STSRGOODSI2
     C                   ENDSL
      *
     C                   GOTO      STSRGOODSI
      *
     C     STSRGOODSI2   TAG
     C     ZEADL01K      CHAIN     ZEADL01                            33
     C                   IF        XXPKTYPE = *BLANKS
     C                   EVAL      HEVS1 = XXVS1
     C                   ELSE
     C                   EVAL      HEVS1 = XXPKTYPE
     C                   CAT       XXVS1:1       HEVS1
     C                   END
     C                   EVAL      HEVS2 = XXVS2
S42  C*                  EVAL      HEGM1 = XXGM1
S42  C*                  EVAL      HEGM2 = XXGM2
N42  C                   EVAL      HEGM1 = XHEGM1
N60  C                   IF        HEGM1 = *BLANKS
N60  C                   EVAL      HEGM1 = XXGM1
N60  C                   END
N60  C                   IF        HEGM2 = *BLANKS
N60  C                   EVAL      HEGM2 = XXGM2
N60  C                   END
     C                   UPDATE    HEADFR
      *
     C     SLSRGOODSI    ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Party                                     SRMPARTY /
      *////////////////////////////////////////////////////////////
     C     SRMPARTY      BEGSR
      *
     C     ZEADL01K      CHAIN     ZEADL01                            33
N10  C                   MOVE      'N'           XXDELIVERY        1
N10  C                   MOVE      'N'           XXDESPATCH        1
      *
      * LES TAG
     C     STSRMPARTY    TAG
      *
     C                   MOVE      *BLANKS       XXSUBCLASS       30
     C                   MOVE      *BLANKS       XXPARTYID        17
     C                   MOVE      *BLANKS       XXIDTYPE          2
     C                   MOVE      *BLANKS       XXKNA            30
     C                   MOVE      *BLANKS       XXADRTYPE        30
     C                   MOVE      *BLANKS       XXPN              9
     C                   MOVE      *BLANKS       XXPS             30
     C                   MOVE      *BLANKS       XXADR1           30
     C                   MOVE      *BLANKS       XXPNP             9
     C                   MOVE      *BLANKS       XXPSP            30
     C                   MOVE      *BLANKS       XXPOBOX          30
     C                   MOVE      *BLANKS       XXPKONTOR        30
     C                   MOVE      *BLANKS       XXLK              2
      *
     C*                  ADD       1             WPOS
     C*                  EXSR      LESTAG
     C*    XSLUTTLES     CABEQ     'J'           SLSRMPARTY
      * LES subClass
     C                   MOVE      WPOS          XPOS              4 0
     C     XMPARTY01     SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   ADD       10            WPOS
     C                   EXSR      GETTXT
     C                   EVAL      XXSUBCLASS = XTXT
      *
      * LES partyId
NXX  C                   ADD       1             WPOS
NXX  C                   IF        IN(WPOS) <> '>'
     C                   MOVE      XPOS          WPOS              4 0
     C     XMPARTY02     SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   IF        WPOS <> 0
     C                   ADD       9             WPOS
     C                   EXSR      GETTXT
     C                   EVAL      XXPARTYID = XTXT
     C                   END
      *
      * LES idType
     C                   MOVE      XPOS          WPOS              4 0
     C     XMPARTY03     SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   IF        WPOS <> 0
     C                   ADD       8             WPOS
     C                   EXSR      GETTXT
     C                   EVAL      XXIDTYPE = XTXT
     C                   END
     C                   MOVE      XPOS          WPOS              4 0
NXX  C                   END
      * LES TAG
     C     STSRMPARTY2   TAG
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRMPARTY
      *
     C                   SELECT
      * <Name>
     C                   WHEN      XXTAG = XMPARTY1
     C                   EXSR      GETTXT
     C                   EVAL      XXKNA = XTXT
      * <AccountCode>
     C                   WHEN      XXTAG = XMPARTY2
      * <Address
     C                   WHEN      XXTAG = XMPARTY3
     C                   ADD       10            WPOS
     C                   EXSR      GETTXT
     C                   EVAL      XXADRTYPE = XTXT
      * <PostalCode>
     C                   WHEN      XXTAG = XMPARTY4
     C                   EXSR      GETTXT
     C                   IF        XXADRTYPE = 'PhysicalAddress'
     C                   EVAL      XXPN = XTXT
     C                   ELSE
     C                   EVAL      XXPNP = XTXT
     C                   END
      * <City>
     C                   WHEN      XXTAG = XMPARTY5
     C                   EXSR      GETTXT
     C                   IF        XXADRTYPE = 'PhysicalAddress'
     C                   EVAL      XXPS = XTXT
     C                   ELSE
     C                   EVAL      XXPSP = XTXT
     C                   END
      * <CountryCode>
     C                   WHEN      XXTAG = XMPARTY9
     C                   EXSR      GETTXT
     C                   EVAL      XXLK = XTXT
      * <Street>
     C                   WHEN      XXTAG = XMPARTYA
     C                   EXSR      GETTXT
     C                   EVAL      XXADR1 = XTXT
      * <AddressLine>
     C                   WHEN      XXTAG = XMPARTY6
     C                   EXSR      GETTXT
S53  C*                  EVAL      XXADR1 = XTXT
N53  C                   EVAL      XXPOBOX = XTXT
      * <POBox>
     C                   WHEN      XXTAG = XMPARTY7
     C                   EXSR      GETTXT
S53  C*                  EVAL      XXPOBOX = 'P.B.'
S53  C*                  CAT       XTXT:1        XXPOBOX
      * <PostOffice>
     C                   WHEN      XXTAG = XMPARTY8
     C                   EXSR      GETTXT
     C                   EVAL      XXPKONTOR = XTXT
      * <Address
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      STSRMPARTY3
     C                   WHEN      ((XXTAG = XEQUIPM) OR (XXTAG = XEQUIPMTOM))
     C                   GOTO      STSRMPARTY3
     C                   WHEN      ((XXTAG = XCOD) OR (XXTAG = XCODTOM))
     C                   GOTO      STSRMPARTY3
     C                   WHEN      ((XXTAG = XDGOODS) OR (XXTAG = XDGOODSTOM))
     C                   GOTO      STSRMPARTY3
     C                   WHEN      ((XXTAG = XTRALEG) OR (XXTAG = XTRALEGTOM))
     C                   GOTO      STSRMPARTY3
     C                   WHEN      XXTAG = XTOD
     C                   GOTO      STSRMPARTY3
     C                   WHEN      ((XXTAG = XCHARGE) OR (XXTAG = XCHARGETOM))
     C                   GOTO      STSRMPARTY3
     C                   WHEN      ((XXTAG = XSERVIC) OR (XXTAG = XSERVICTOM))
     C                   GOTO      STSRMPARTY3
     C                   WHEN      ((XXTAG = XMDAT) OR (XXTAG = XMDATTOM))
     C                   GOTO      STSRMPARTY3
     C                   WHEN      ((XXTAG = XCUSINF) OR (XXTAG = XCUSINFTOM))
     C                   GOTO      STSRMPARTY3
     C                   WHEN      ((XXTAG = XOFFER) OR (XXTAG = XOFFERTOM))
     C                   GOTO      STSRMPARTY3
     C                   WHEN      ((XXTAG = XINSUR) OR (XXTAG = XINSURTOM))
     C                   GOTO      STSRMPARTY3
     C                   WHEN      XXTAG = XSPARTY
     C                   GOTO      STSRMPARTY3
     C*                  WHEN      XXTAG = XMPARTY
     C*                  GOTO      STSRMPARTY2
     C                   ENDSL
     C                   GOTO      STSRMPARTY2
      *
     C     STSRMPARTY3   TAG
     C                   IF        XXIDTYPE = '87'
     C                   MOVEL     XXPARTYID     XT17
     C                   EXSR      KVTTAL
     C                   ELSE
     C                   MOVE      *ZEROS        XTAL2
     C                   END
     C                   SELECT
     C                   WHEN      XXSUBCLASS = 'Consignor'
N14  C                   EXSR      SRUPDNAD
     C                   EVAL      HEKNS  = XTAL2
     C                   EVAL      HEKNSF = XTAL2
N08   * BEVARE AVSENDERS KUNDENR
N08  C                   EVAL      FSKODE = 'INH'
N08  C                   MOVE      *BLANKS       FSSOK
N08  C                   MOVEL     HEKNS         FSSOK
N08  C                   CAT       WDT:3         FSSOK
N08  C                   CAT       WTM:2         FSSOK
N08  C                   WRITE     FRISOKR
N08   *
N10  C                   IF        XXDESPATCH = 'N'
     C                   EVAL      HENAS  = XXKNA
     C                   EVAL      HEADS1 = XXADR1
     C                   EVAL      HEADS2 = XXPOBOX
     C                   CAT       XXPKONTOR:1   HEADS2
     C                   EVAL      HEADS3 = XXPN
     C                   CAT       XXPS:1        HEADS3
     C                   EVAL      HELKA  = XXLK
     C                   EVAL      HESDF  = XXPN
N10  C                   END
     C*                  GOTO      STSRMPARTY
     C                   WHEN      XXSUBCLASS = 'Consignee'
N14  C                   EXSR      SRUPDNAD
     C                   EVAL      HEKNK  = XTAL2
     C                   EVAL      HEKNKF = XTAL2
N10  C                   IF        XXDELIVERY = 'N'
     C                   EVAL      HENAK  = XXKNA
     C                   EVAL      HEADK1 = XXADR1
     C                   EVAL      HEADK2 = XXPOBOX
     C                   CAT       XXPKONTOR:1   HEADK2
     C                   EVAL      HEADK3 = XXPN
     C                   CAT       XXPS:1        HEADK3
     C                   EVAL      HETRI  = XXLK
     C                   EVAL      HESDT  = XXPN
N10  C                   END
     C*                  GOTO      STSRMPARTY
N10  C                   WHEN      XXSUBCLASS = 'DespatchParty'
N14  C                   EXSR      SRUPDNAD
N10  C                   EVAL      XXDESPATCH = 'J'
N10  C                   EVAL      HENAS  = XXKNA
N10  C                   EVAL      HEADS1 = XXADR1
N10  C                   EVAL      HEADS2 = XXPOBOX
N10  C                   CAT       XXPKONTOR:1   HEADS2
N10  C                   EVAL      HEADS3 = XXPN
N10  C                   CAT       XXPS:1        HEADS3
N10  C                   EVAL      HELKA  = XXLK
N10  C                   EVAL      HESDF  = XXPN
N10  C                   WHEN      XXSUBCLASS = 'DeliveryParty'
N14  C                   EXSR      SRUPDNAD
N10  C                   EVAL      XXDELIVERY = 'J'
N10  C                   EVAL      HENAK  = XXKNA
N10  C                   EVAL      HEADK1 = XXADR1
N10  C                   EVAL      HEADK2 = XXPOBOX
N10  C                   CAT       XXPKONTOR:1   HEADK2
N10  C                   EVAL      HEADK3 = XXPN
N10  C                   CAT       XXPS:1        HEADK3
N10  C                   EVAL      HETRI  = XXLK
N10  C                   EVAL      HESDT  = XXPN
N14  C                   WHEN      XXSUBCLASS = 'TransportCompany'
N33  C                   WHEN      XXSUBCLASS = 'DespatchingAgent'
N33  C                   EXSR      SRUPDNAD
N33  C                   MOVE      XXLK          XDESAGTLK         2
N33  C                   WHEN      XXSUBCLASS = 'ReceivingAgent'
N33  C                   EXSR      SRUPDNAD
N33  C                   MOVE      XXLK          XRECAGTLK         2
N57  C                   WHEN      XXSUBCLASS = 'FreightPayer' AND XXIDTYPE='87'
N57  C                   EVAL      HEKNKF = 0
N57  C                   EVAL      HENAKF = XXKNA
N57  C                   EVAL      TRKDFF = 'K'
N57  C     1             DO        8             XN
N57  C                   EVAL      XAN01 = %SUBST(XXPARTYID:XN:1)
N57  C                   IF        XAN01 = ' '
N57  C                   LEAVE
N57  C                   END
N57  C                   MULT      10            HEKNKF
N57  C                   MOVE      XAN01         HEKNKF
N57  C                   ENDDO
     C                   ENDSL
     C                   IF        XXTAG = XMPARTY
     C                   GOTO      STSRMPARTY
     C                   END
      *
     C     SLSRMPARTY    TAG
N24  C                   IF        HEM3 = -1
N24  C                   EVAL      HEM3 = 0
N24  C                   END
N26  C                   IF        (((HETRI ='NO') AND
N26  C                               (HELKA <> 'NO')) AND
N26  C                               (HELKA <> *BLANKS))
N26  C                   EVAL      HEOT = 'BI'
N26  C                   END
N33   *
N33  C*                  IF        WLIB = 'SYSPEDFNAS'                          1<-B
N33XXC                   IF        FIFIRM = 'NC' AND XEQTYPE <> *BLANKS         1<-B
N33  C                   SELECT                                                  2<-B
N33  C                   WHEN      XSUMSETTYP = '704'                            2
N33  C                   IF        XEQTYPE = 'CN'                                 3<-B
N33  C                   SELECT                                                    4<-B
N33  C                   WHEN      XLOCSTRLK <> 'NO' AND XLOCENDLK = 'NO'          4
N33  C                   EVAL      HEOT = 'IO'                                  OVERSJØ IMP CONT.
N33  C                   WHEN      XDESAGTLK <> 'NO' AND XRECAGTLK = 'NO'          4
N33  C                   EVAL      HEOT = 'IO'                                  OVERSJØ IMP CONT.
N33  C                   WHEN      XLOCSTRLK = 'NO' AND XLOCENDLK <> 'NO'          4
N33  C                   EVAL      HEOT = 'EO'                                  OVERSJØ EKS CONT.
N33  C                   WHEN      XDESAGTLK = 'NO' AND XRECAGTLK <> 'NO'          4
N33  C                   EVAL      HEOT = 'EO'                                  OVERSJØ EKS CONT.
N33  C                   WHEN      XLOCSTRLK <> 'NO' AND XLOCENDLK <> 'NO'         4
N33  C                   EVAL      HEOT = 'UO'                                  OVERSJØ UTLAND
N33  C                   WHEN      XDESAGTLK <> 'NO' AND XRECAGTLK <> 'NO'         4
N33  C                   EVAL      HEOT = 'UO'                                  OVERSJØ UTLAND
N33  C                   ENDSL                                                     4<-E
N33  C                   ELSE                                                     3
N33  C                   SELECT                                                    4<-B
N33  C                   WHEN      XLOCSTRLK <> 'NO' AND XLOCENDLK = 'NO'          4
N33  C                   EVAL      HEOT = 'IS'                                  OVERSJØ IMP STK
N33  C                   WHEN      XDESAGTLK <> 'NO' AND XRECAGTLK = 'NO'          4
N33  C                   EVAL      HEOT = 'IS'                                  OVERSJØ IMP STK
N33  C                   WHEN      XLOCSTRLK = 'NO' AND XLOCENDLK <> 'NO'          4
N33  C                   EVAL      HEOT = 'ES'                                  OVERSJØ EKS STK
N33  C                   WHEN      XDESAGTLK = 'NO' AND XRECAGTLK <> 'NO'          4
N33  C                   EVAL      HEOT = 'ES'                                  OVERSJØ EKS STK
N33  C                   WHEN      XLOCSTRLK <> 'NO' AND XLOCENDLK <> 'NO'         4
N33  C                   EVAL      HEOT = 'UO'                                  OVERSJØ UTLAND
N33  C                   WHEN      XDESAGTLK <> 'NO' AND XRECAGTLK <> 'NO'         4
N33  C                   EVAL      HEOT = 'UO'                                  OVERSJØ UTLAND
N33  C                   ENDSL                                                     4<-E
N33  C                   END                                                      3<-E
N33  C                   WHEN      XSUMSETTYP = '741'                            2
N33  C                   SELECT                                                   3<-B
N33  C                   WHEN      XLOCSTRLK <> 'NO' AND XLOCENDLK = 'NO'         3
N33  C                   EVAL      HEOT = 'IU'                                  FLY IMPORT
N33  C                   WHEN      XDESAGTLK <> 'NO' AND XRECAGTLK = 'NO'         3
N33  C                   EVAL      HEOT = 'IU'                                  FLY IMPORT
N33  C                   WHEN      XLOCSTRLK = 'NO' AND XLOCENDLK <> 'NO'         3
N33  C                   EVAL      HEOT = 'EU'                                  FLY EKSPORT
N33  C                   WHEN      XDESAGTLK = 'NO' AND XRECAGTLK <> 'NO'         3
N33  C                   EVAL      HEOT = 'EU'                                  FLY EKSPORT
N33  C                   WHEN      XLOCSTRLK <> 'NO' AND XLOCENDLK <> 'NO'        3
N33  C                   EVAL      HEOT = 'UU'                                  FLY UTLAND
N33  C                   WHEN      XDESAGTLK <> 'NO' AND XRECAGTLK <> 'NO'        3
N33  C                   EVAL      HEOT = 'UU'                                  FLY UTLAND
N33  C                   ENDSL                                                    3<-E
N33  C                   ENDSL                                                   2<-E
N33  C                   END                                                    1<-E
N33   *
     C                   UPDATE    HEADFR
      *
     C                   ENDSR
      *
N14   *////////////////////////////////////////////////////////////
N14   * SR for oppdatering av adresse på ZNADSF          SRUPDNAD /
N14   *////////////////////////////////////////////////////////////
N14  C     SRUPDNAD      BEGSR
N14   *
N14  C                   EVAL      NREFF  = HEREFF
N14  C                   EVAL      NUNIK  = HEUNIK
N14  C                   EVAL      NMN    = 0
N14  C                   EVAL      NKN    = TRKNFA
N14   *
N14  C                   SELECT
N14  C                   WHEN      XXSUBCLASS = 'Consignor'
N14  C                   EVAL      N3035  = 'CZ'
N14  C                   WHEN      XXSUBCLASS = 'Consignee'
N14  C                   EVAL      N3035  = 'CN'
N14  C                   WHEN      XXSUBCLASS = 'DespatchParty'
S51  C*                  EVAL      N3035  = 'CN'
N51  C                   EVAL      N3035  = 'PW'
N14  C                   WHEN      XXSUBCLASS = 'DeliveryParty'
S51  C*                  EVAL      N3035  = 'PW'
N51  C                   EVAL      N3035  = 'DL'
N14  C                   WHEN      XXSUBCLASS = 'TransportCompany'
N14  C                   EVAL      N3035  = 'AF'
N33  C                   WHEN      XXSUBCLASS = 'DespatchingAgent'
N33  C                   EVAL      N3035  = 'SR'
N33  C                   WHEN      XXSUBCLASS = 'ReceivingAgent'
N33  C                   EVAL      N3035  = 'CX'
N14  C                   ENDSL
N14  C                   EVAL      N3039  = XXPARTYID
N14  C                   EVAL      N1131  = XXIDTYPE
N14  C                   EVAL      N3036A = XXKNA
N14  C                   EVAL      N3042A = XXADR1
N14  C                   EVAL      N3164  = XXPS
N14  C                   EVAL      N3251  = XXPN
N14  C                   EVAL      N3207  = XXLK
N14  C                   EVAL      N3124A = XXKNA
N14  C                   EVAL      N3124B = XXPOBOX
N14  C                   EVAL      N3124C = XXPKONTOR
N14  C                   EVAL      N3124D = XXPNP
N14  C                   EVAL      N3124E = XXPSP
N14   *
N14  C                   WRITE     NADSR
N14   *
N14  C                   IF        ((XTAL2 = 0) AND (XXPARTYID <> *BLANKS))     1<-B
N14  C     KUNKO2K       CHAIN     KUNKO2                             33
N14  C                   IF        *IN33 = *OFF                                  2<-B
N14  C                   Z-ADD     KUKUN2        XTAL2
N14  C                   IF        XXKNA  = *BLANKS                               3<-B
N14  C                   IF        KUVADR = 0                                      4<-B
N14  C     CUNDL01K2     CHAIN     CUNDL01                            33
N14  C                   IF        *IN33 = *OFF                                     5<-B
N14  C                   EVAL      XXKNA  = KNAVN
N14  C                   EVAL      XXADR1 = ADR1
N14  C                   EVAL      XXPS   = ADR3
N14  C                   IF        POSTNR = 0                                        6<-B
N14  C                   EVAL      XXPN   = SYPOGE
N14  C                   ELSE                                                        6
N14  C                   EVAL      XXPN   = *BLANKS
N14  C                   MOVEL     POSTNR        XXPN
N14  C                   END                                                         6<-E
N14  C                   EVAL      XXLK   = SYLAND
N14  C                   END                                                        5<-E
N14  C                   ELSE                                                      4
N14  C     VADRK         CHAIN     VADR                               33
N14  C                   IF        *IN33 = *OFF                                     5<-B
N14  C                   EVAL      XXKNA  = VADRNA
N14  C                   EVAL      XXADR1 = VADRN1
N14  C                   EVAL      XXPS   = VADRN3
N14  C                   EVAL      XXLK   = VALAND
N14  C                   END                                                        5<-E
N14  C                   END                                                       4<-E
N14  C                   END                                                      3<-E
N14  C                   END                                                     2<-E
N14  C                   END                                                    1<-E
N14   *
N14  C                   ENDSR
N14   *
N42   *////////////////////////////////////////////////////////////
N42   * SR for henting av referanse med kode=TIN       HENTREFTIN /
N42   *////////////////////////////////////////////////////////////
N42  C     HENTREFTIN    BEGSR
N42  C                   MOVE      'N'           XREFOK            1
N42  C                   EVAL      XSLUTTLES = 'N'
N42  C     WMBR          SETLL     EDIRE1K
N42  C     WMBR          READE     EDIRE1K                                50
N42  C                   MOVE      RDATA         RDATA2
N42  C                   EXSR      LESREC
N42  C                   Z-ADD     1             WPOS
N42  C                   EVAL      XXTAG = *BLANKS
N42  C                   DOW       XXTAG <> XREF
N42  C                   EXSR      LESTAG
N42  C     XSLUTTLES     CABEQ     'J'           SLHREFTIN
N42  C                   ENDDO
N42   * LES TAG
N42  C     STHREFTIN1    TAG
N42  C                   EXSR      LESTAG
N42  C     XSLUTTLES     CABEQ     'J'           SLHREFTIN
N42  C                   SELECT
N42   * <ReferenceNo>
N42  C                   WHEN      XXTAG = XREF1
N42  C                   EXSR      GETTXT
N42  C                   MOVEL     XTXT          XREFF
N42  C                   MOVE      'J'           XREFJA
N42  C                   GOTO      STHREFTIN1
N42   * <ReferenceType>
N42  C                   WHEN      XXTAG = XREF2
N42  C                   IF        XREFJA = 'J'
N42  C                   EXSR      GETTXT
N42  C                   IF        XTXT = 'TIN'
N42  C                   EVAL      XREFF = 'XP' + %TRIM(XREFF)
N42  C                   GOTO      STHREFTIN2
N42  C                   END
N42  C                   END
N42  C                   MOVE      'N'           XREFJA
N42  C                   WHEN      XXTAG <> XREF
N42  C                   GOTO      SLHREFTIN
N42  C                   ENDSL
N42  C                   GOTO      STHREFTIN1
N42   *
N42  C     STHREFTIN2    TAG
N42  C                   EVAL      XNREF  = XNREF + 1
N42  C                   EVAL      REF(XNREF) = XREFF
N42  C                   MOVE      'J'           XREFOK            1
N42  C                   GOTO      STHREFTIN1
N42   *
N42  C     SLHREFTIN     ENDSR
N42   *
NC    *////////////////////////////////////////////////////////////
NC    * SR for henting av TransportLeg                 HENTTRALEG /
NC    *////////////////////////////////////////////////////////////
NC   C     HENTTRALEG    BEGSR
NC   C                   MOVE      'N'           XREFOK            1
NC   C                   EVAL      XSLUTTLES = 'N'
NC   C     WMBR          SETLL     EDIRE1K
NC   C     WMBR          READE     EDIRE1K                                50
NC   C                   MOVE      RDATA         RDATA2
NC   C                   EXSR      LESREC
NC   C                   Z-ADD     1             WPOS
NC   C     STHTRALEG     TAG
NC   C                   EVAL      XXTAG = *BLANKS
NC   C                   DOW       XXTAG <> XTRALEG1
NC   C                   EXSR      LESTAG
NC   C     XSLUTTLES     CABEQ     'J'           SLHTRALEG
NC   C     XXTAG         CABEQ     XCONSTREND    SLHTRALEG
NC   C                   ENDDO
NC    * <TransportLegId>
NC   C                   EXSR      GETTXT
NC   C                   EVAL      XREFF = XTXT
NC    *
NC   C                   EVAL      XNREF  = XNREF + 1
NC   C                   EVAL      REF(XNREF) = XREFF
NC   C                   MOVE      'J'           XREFOK            1
NC   C                   GOTO      STHTRALEG
NC    *
NC   C     SLHTRALEG     ENDSR
NC    *
N20   *////////////////////////////////////////////////////////////
N20   * SR for henting av <TariffReference>            HENTTARREF /
N20   *////////////////////////////////////////////////////////////
N20  C     HENTTARREF    BEGSR
N20  C                   MOVE      'BE'          XHEREFFPRE        2
N20  C                   EVAL      XSLUTTLES = 'N'
N20  C     WMBR          SETLL     EDIRE1K
N20  C     WMBR          READE     EDIRE1K                                50
N20  C                   MOVE      RDATA         RDATA2
N20  C                   EXSR      LESREC
N20  C                   Z-ADD     1             WPOS
N20  C     STHTARREF     TAG
N20  C                   EVAL      XXTAG = *BLANKS
N20  C                   DOW       XXTAG <> XSERVIC2
N20  C                   EXSR      LESTAG
N20  C     XSLUTTLES     CABEQ     'J'           SLHTARREF
N20  C     XXTAG         CABEQ     XCONSTREND    SLHTARREF
N20  C                   ENDDO
N20   * <TariffReference>
N20  C                   EXSR      GETTXT
N20  C                   IF        XTXT = 'OXP'
N20  C                   EVAL      XHEREFFPRE = 'OX'
N20  C                   END
N20   *
N20  C     SLHTARREF     ENDSR
N20   *
      *////////////////////////////////////////////////////////////
      * SR for henting av avsenders postnr              HENTAVSPN /
      *////////////////////////////////////////////////////////////
     C     HENTAVSPN     BEGSR
N08   *
N08  C                   MOVE      *BLANKS       REF
N08  C                   MOVE      *ZEROS        XNREF             3 0
      *
     C     STHAVSPN      TAG
     C                   EVAL      XXTAG = *BLANKS
     C                   DOW       XXTAG <> XMPARTY
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLHAVSPN
N08  C     XXTAG         CABEQ     XCONSTREND    SLHAVSPN
     C                   ENDDO
      * LES subClass
     C     XMPARTY01     SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   ADD       10            WPOS
     C                   EXSR      GETTXT
     C     XTXT          CABNE     'Consignor'   STHAVSPN
      *
     C                   EVAL      XXTAG = *BLANKS
     C                   DOW       XXTAG <> XMPARTY4
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLHAVSPN
     C                   ENDDO
      * <PostalCode>
     C                   EXSR      GETTXT
     C*                  MOVEL     'OX'          XREFF            17
     C*                  CAT       XTXT:0        XREFF
S20  C*                  EVAL      XREFF = 'OX' + %trim(XTXT) + '-'
N20  C                   EVAL      XREFF = %trim(XHEREFFPRE) + %trim(XTXT) + '-'
     C                             + %trimr(XMSGID)
N01  C                   IF        XCOLLA = 'Booking'
N01  C                   CAT       '-B':0        XREFF            17
N01  C                   ELSE
N01  C                   CAT       '-I':0        XREFF
N01  C                   END
N08   *
N08  C                   EVAL      XNREF  = XNREF + 1
N08  C                   EVAL      REF(XNREF) = XREFF
N08  C                   GOTO      STHAVSPN
      *
     C     SLHAVSPN      ENDSR
      *
NC    *////////////////////////////////////////////////////////////
NC    * SR for henting av referanse med CU              HENTREFCU /
NC    *////////////////////////////////////////////////////////////
NC   C     HENTREFCU     BEGSR
NC    *
NC   C                   MOVE      *BLANKS       REF
NC   C                   MOVE      *ZEROS        XNREF             3 0
NC    *
NC   C     STHREFCU0     TAG
NC   C*                  DOW       XXTAG <> XCONSIGNM
NC   C                   DOW       XXTAG <> XCONSIGNM AND XXTAG <> XCONSIGNMA
NC   C                   EXSR      LESTAG
NC   C     XSLUTTLES     CABEQ     'J'           SLHREFCU
NC   C     XXTAG         CABEQ     XCONSTREND    SLHREFCU
NC   C                   ENDDO
NC    *
NC   C     STHREFCU      TAG
NC   C                   EXSR      LESTAG
NC   C     XSLUTTLES     CABEQ     'J'           SLHREFCU
NC    *
NC   C                   SELECT
NC    * <ReferenceNo>
NC   C                   WHEN      XXTAG = XREF1
NC   C                   EXSR      GETTXT
NC   C                   EVAL      XREFF2 = 'BE3200-'
NC   C                   IF        XCOLLA = 'Booking'
NC   C                   CAT       'B-':0        XREFF2
NC   C                   ELSE
NC   C                   CAT       'I-':0        XREFF2
NC   C                   END
NC   C                   EVAL      NCXT35 = XTXT
NC    *
NC   C                   Z-ADD     35            XNEND             3 0
NC   C                   DO        35
NC   C                   IF        NCXT(XNEND) <> *BLANKS
NC   C                   LEAVE
NC   C                   END
NC   C                   SUB       1             XNEND             3 0
NC   C                   ENDDO
NC   C     XNEND         SUB       7             XNSTR             3 0
NC   C                   IF        XNSTR < 1
NC   C                   Z-ADD     1             XNSTR
NC   C                   END
NC   C                   EVAL      XTXT = %SUBST(NCXT35:XNSTR:8)
NC    *
NC   C                   CAT       XTXT:0        XREFF2           17
NC   C                   MOVE      'J'           XREFJA
NC   C                   GOTO      STHREFCU
NC    * <ReferenceType>
NC   C                   WHEN      XXTAG = XREF2
NC   C                   IF        XREFJA = 'J'
NC   C                   EXSR      GETTXT
NC   C                   MOVE      'N'           XREFJA
NC   C                   IF        XTXT   = 'CU'
NC   C                   EVAL      XNREF  = XNREF + 1
NC   C                   EVAL      REF(XNREF) = XREFF2
NC   C                   ELSE
NC   C                   GOTO      STHREFCU
NC   C                   END
NC   C                   END
NC   C                   GOTO      STHREFCU0
NC    * </Consignment>
NC   C                   WHEN      XXTAG = XCONSIGNMEND
NC   C                   EVAL      XREFF2 = 'BE3200-*UKJENT'
NC   C                   IF        XTXT   = 'CU'
NC   C                   EVAL      XNREF  = XNREF + 1
NC   C                   EVAL      REF(XNREF) = XREFF2
NC   C                   GOTO      STHREFCU0
NC   C                   END
NC    *
NC   C                   OTHER
NC   C                   GOTO      STHREFCU
NC   C                   ENDSL
NC    *
NC   C     SLHREFCU      ENDSR
NC    *
      *////////////////////////////////////////////////////////////
      * SR for Equipment                                 SREQUIPM /
      *////////////////////////////////////////////////////////////
     C     SREQUIPM      BEGSR
      *
N27  C                   MOVE      *BLANKS       XEQTYPE           3
N27  C                   MOVE      *BLANKS       BVKDC
N27  C                   MOVE      *ZEROS        BVLI
N27  C                   EVAL      BVUNIK = HEUNIK
N27  C                   EVAL      BVREFF = HEREFF
      * LES TAG
     C     STSREQUIPM    TAG
S22  C*                  ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSREQUIPM
      *
     C                   SELECT
      * <EquipmentType>
     C                   WHEN      XXTAG = XEQUIPM1
N27   *
N27  C                   IF        XEQTYPE = 'CN'
N27  C                   EVAL      BVLI   = BVLI + 10
N27  C                   EVAL      BVSORT = BVLI
N27  C                   WRITE     BLV1R
N27  C                   EVAL      BVMN   = *BLANKS
N27  C                   EVAL      BVKDC  = *BLANKS
N27  C                   EVAL      BVVS   = *BLANKS
N27  C                   EVAL      BVVKT  = 0
N27  C                   EVAL      BVM3   = 0
N27  C                   EVAL      BVNT   = 0
N27  C                   EVAL      BVENH  = 0
N27  C                   END
N27   *
     C                   EXSR      GETTXT
N22  C                   IF        (((XTXT = 'CN') OR
N22  C                               (XTXT = 'EFP')) OR
N22  C                               (XTXT = 'PA'))
N22  C                   MOVEL     XTXT          XEQTYPE           3
N22  C                   ELSE
N22  C                   MOVE      *BLANKS       XEQTYPE
     C                   EVAL      FRTTXT = 'EQUIPMENTTYPE ='
     C                   CAT       XTXT:1        FRTTXT
     C                   ADD       1             FRTLI
     C                   WRITE     FREETXTR
N22  C                   END
     C                   EVAL      FRTTXT = *BLANKS
     C                   GOTO      STSREQUIPM
N22   * <EquipmentId>
N22  C                   WHEN      XXTAG = XEQUIPM5
N22  C                   EXSR      GETTXT
N22  C                   IF        XEQTYPE = 'CN'
N22  C                   EVAL      FSKODE = 'CNT'
N22  C                   EVAL      FSSOK  = XTXT
N22  C                   WRITE     FRISOKR
N27  C                   EVAL      BVMN   = XTXT
N22  C                   ELSE
N22  C                   EVAL      FRTTXT = 'EQUIPMENTTYPE ='
N22  C                   IF        XEQTYPE = 'EFR'
N22  C                   CAT       'EUROPALLE':1 FRTTXT
N22  C                   ELSE
N22  C                   CAT       'PALLE':1     FRTTXT
N22  C                   END
N22  C                   END
N22   * <EquipmentQuantity>
N22  C                   WHEN      XXTAG = XEQUIPM6
N27  C                   MOVE      WPOS          XPOS
N22  C                   EXSR      GETTXT
N22  C                   CAT       'ANTALL =':5  FRTTXT
N22  C                   CAT       XTXT:1        FRTTXT
N22  C                   ADD       1             FRTLI
N22  C                   WRITE     FREETXTR
N27  C                   IF        XEQTYPE = 'CN'
N27  C                   MOVE      XPOS          WPOS
N27  C                   EXSR      GETTAL
N27  C                   EVAL      BVNT   = XTAL
N27  C                   END
      * <Height
     C                   WHEN      XXTAG = XEQUIPM2
     C                   ADD       10            WPOS
     C                   EXSR      GETTXT
     C                   IF        FRTTXT = *BLANKS
     C                   EVAL      FRTTXT = 'HEIGHT:'
     C                   ELSE
     C                   CAT       'HEIGHT:':5   FRTTXT
     C                   END
     C                   CAT       XTXT:1        FRTTXT
     C                   ADD       2             WPOS
     C                   EXSR      GETTXT
     C                   CAT       XTXT:1        FRTTXT
     C                   GOTO      STSREQUIPM
      * <Width
     C                   WHEN      XXTAG = XEQUIPM3
     C                   ADD       10            WPOS
     C                   EXSR      GETTXT
     C                   IF        FRTTXT = *BLANKS
     C                   EVAL      FRTTXT = 'WIDTH:'
     C                   ELSE
     C                   CAT       'WIDTH:':5    FRTTXT
     C                   END
     C                   CAT       XTXT:1        FRTTXT
     C                   ADD       2             WPOS
     C                   EXSR      GETTXT
     C                   CAT       XTXT:1        FRTTXT
     C                   GOTO      STSREQUIPM
      * <Length
     C                   WHEN      XXTAG = XEQUIPM4
     C                   ADD       10            WPOS
     C                   EXSR      GETTXT
     C                   IF        FRTTXT = *BLANKS
     C                   EVAL      FRTTXT = 'WIDTH:'
     C                   ELSE
     C                   CAT       'WIDTH:':5    FRTTXT
     C                   END
     C                   CAT       XTXT:1        FRTTXT
     C                   ADD       2             WPOS
     C                   EXSR      GETTXT
     C                   CAT       XTXT:1        FRTTXT
     C                   GOTO      STSREQUIPM
N27   * <EquipmentCode>
N27  C                   WHEN      XXTAG = XEQUIPM7
N27  C                   IF        XEQTYPE = 'CN'
N27  C                   EXSR      GETTXT
N27  C                   EVAL      BVKDC  = XTXT
N27  C     BVKDC         CHAIN     CDCON4                             33
N27  C                   IF        *IN33
N27  C                   EVAL      BVVS   = *BLANKS
N27  C                   EVAL      BVENH  = *ZEROS
N27  C                   ELSE
N27  C                   EVAL      BVVS   = CC4FT
N27  C                   EVAL      BVENH  = CC4NT
N27  C                   END
N27  C                   END
N27   * <Weight
N27  C                   WHEN      XXTAG = XEQUIPM8
N27  C                   IF        XEQTYPE = 'CN'
S31  C*                  ADD       10            WPOS
N31  C                   ADD       15            WPOS
N27  C                   EXSR      GETTAL
N27  C                   Z-ADD     XTAL          BVVKT
N27  C                   END
N27  C                   GOTO      STSREQUIPM
N27   * <Volume
N27  C                   WHEN      XXTAG = XEQUIPM9
N27  C                   IF        XEQTYPE = 'CN'
N31  C                   ADD       15            WPOS
N31  C                   EXSR      GETTAL
N27  C                   EVAL(H)   BVM3   = XTAL / 1000
N27  C                   END
N27  C                   GOTO      STSREQUIPM
      *
     C                   ENDSL
      *
     C                   IF        FRTTXT <> *BLANKS
     C                   ADD       1             FRTLI
     C                   WRITE     FREETXTR
     C                   END
      *
     C                   SELECT
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      SLSREQUIPM
     C                   WHEN      ((XXTAG = XEQUIPM) OR (XXTAG = XEQUIPMTOM))
     C                   GOTO      SLSREQUIPM
     C                   WHEN      ((XXTAG = XCOD) OR (XXTAG = XCODTOM))
     C                   GOTO      SLSREQUIPM
     C                   WHEN      ((XXTAG = XDGOODS) OR (XXTAG = XDGOODSTOM))
     C                   GOTO      SLSREQUIPM
     C                   WHEN      ((XXTAG = XTRALEG) OR (XXTAG = XTRALEGTOM))
     C                   GOTO      SLSREQUIPM
     C                   WHEN      XXTAG = XTOD
     C                   GOTO      SLSREQUIPM
     C                   WHEN      ((XXTAG = XCHARGE) OR (XXTAG = XCHARGETOM))
     C                   GOTO      SLSREQUIPM
     C                   WHEN      ((XXTAG = XSERVIC) OR (XXTAG = XSERVICTOM))
     C                   GOTO      SLSREQUIPM
     C                   WHEN      ((XXTAG = XMDAT) OR (XXTAG = XMDATTOM))
     C                   GOTO      SLSREQUIPM
     C                   WHEN      ((XXTAG = XCUSINF) OR (XXTAG = XCUSINFTOM))
     C                   GOTO      SLSREQUIPM
     C                   WHEN      ((XXTAG = XOFFER) OR (XXTAG = XOFFERTOM))
     C                   GOTO      SLSREQUIPM
     C                   WHEN      ((XXTAG = XINSUR) OR (XXTAG = XINSURTOM))
     C                   GOTO      SLSREQUIPM
     C                   WHEN      XXTAG = XSPARTY
     C                   GOTO      SLSREQUIPM
     C                   ENDSL
     C                   GOTO      STSREQUIPM
N27   *
N27  C     SLSREQUIPM    TAG
N27  C                   IF        XEQTYPE = 'CN'
N27  C                   EVAL      BVLI   = BVLI + 10
N27  C                   EVAL      BVSORT = BVLI
N27  C                   WRITE     BLV1R
N27  C                   EVAL      BVMN   = *BLANKS
N27  C                   EVAL      BVKDC  = *BLANKS
N27  C                   EVAL      BVVS   = *BLANKS
N27  C                   EVAL      BVVKT  = 0
N27  C                   EVAL      BVM3   = 0
N27  C                   EVAL      BVNT   = 0
N27  C                   EVAL      BVENH  = 0
N27  C                   END
N33XX *
N33XXC                   IF        FIFIRM = 'NC'                                1<-B
N33XXC     ZEADL01K      CHAIN     ZEADL01                            33
N33XXC                   SELECT                                                  2<-B
N33XXC                   WHEN      XSUMSETTYP = '704'                            2
N33XXC                   IF        XEQTYPE = 'CN'                                 3<-B
N33XXC                   SELECT                                                    4<-B
N33XXC                   WHEN      XLOCSTRLK <> 'NO' AND XLOCENDLK = 'NO'          4
N33XXC                   EVAL      HEOT = 'IO'                                  OVERSJØ IMP CONT.
N33XXC                   WHEN      XDESAGTLK <> 'NO' AND XRECAGTLK = 'NO'          4
N33XXC                   EVAL      HEOT = 'IO'                                  OVERSJØ IMP CONT.
N33XXC                   WHEN      XLOCSTRLK = 'NO' AND XLOCENDLK <> 'NO'          4
N33XXC                   EVAL      HEOT = 'EO'                                  OVERSJØ EKS CONT.
N33XXC                   WHEN      XDESAGTLK = 'NO' AND XRECAGTLK <> 'NO'          4
N33XXC                   EVAL      HEOT = 'EO'                                  OVERSJØ EKS CONT.
N33XXC                   WHEN      XLOCSTRLK <> 'NO' AND XLOCENDLK <> 'NO'         4
N33XXC                   EVAL      HEOT = 'UO'                                  OVERSJØ UTLAND
N33XXC                   WHEN      XDESAGTLK <> 'NO' AND XRECAGTLK <> 'NO'         4
N33XXC                   EVAL      HEOT = 'UO'                                  OVERSJØ UTLAND
N33XXC                   ENDSL                                                     4<-E
N33XXC                   ELSE                                                     3
N33XXC                   SELECT                                                    4<-B
N33XXC                   WHEN      XLOCSTRLK <> 'NO' AND XLOCENDLK = 'NO'          4
N33XXC                   EVAL      HEOT = 'IS'                                  OVERSJØ IMP STK
N33XXC                   WHEN      XDESAGTLK <> 'NO' AND XRECAGTLK = 'NO'          4
N33XXC                   EVAL      HEOT = 'IS'                                  OVERSJØ IMP STK
N33XXC                   WHEN      XLOCSTRLK = 'NO' AND XLOCENDLK <> 'NO'          4
N33XXC                   EVAL      HEOT = 'ES'                                  OVERSJØ EKS STK
N33XXC                   WHEN      XDESAGTLK = 'NO' AND XRECAGTLK <> 'NO'          4
N33XXC                   EVAL      HEOT = 'ES'                                  OVERSJØ EKS STK
N33XXC                   WHEN      XLOCSTRLK <> 'NO' AND XLOCENDLK <> 'NO'         4
N33XXC                   EVAL      HEOT = 'UO'                                  OVERSJØ UTLAND
N33XXC                   WHEN      XDESAGTLK <> 'NO' AND XRECAGTLK <> 'NO'         4
N33XXC                   EVAL      HEOT = 'UO'                                  OVERSJØ UTLAND
N33XXC                   ENDSL                                                     4<-E
N33XXC                   END                                                      3<-E
N33XXC                   WHEN      XSUMSETTYP = '741'                            2
N33XXC                   SELECT                                                   3<-B
N33XXC                   WHEN      XLOCSTRLK <> 'NO' AND XLOCENDLK = 'NO'         3
N33XXC                   EVAL      HEOT = 'IU'                                  FLY IMPORT
N33XXC                   WHEN      XDESAGTLK <> 'NO' AND XRECAGTLK = 'NO'         3
N33XXC                   EVAL      HEOT = 'IU'                                  FLY IMPORT
N33XXC                   WHEN      XLOCSTRLK = 'NO' AND XLOCENDLK <> 'NO'         3
N33XXC                   EVAL      HEOT = 'EU'                                  FLY EKSPORT
N33XXC                   WHEN      XDESAGTLK = 'NO' AND XRECAGTLK <> 'NO'         3
N33XXC                   EVAL      HEOT = 'EU'                                  FLY EKSPORT
N33XXC                   WHEN      XLOCSTRLK <> 'NO' AND XLOCENDLK <> 'NO'        3
N33XXC                   EVAL      HEOT = 'UU'                                  FLY UTLAND
N33XXC                   WHEN      XDESAGTLK <> 'NO' AND XRECAGTLK <> 'NO'        3
N33XXC                   EVAL      HEOT = 'UU'                                  FLY UTLAND
N33XXC                   ENDSL                                                    3<-E
N33XXC                   ENDSL                                                   2<-E
N33XXC  N33              UPDATE    HEADFR
N33XXC                   END                                                    1<-E
      *
S27  C*    SLSREQUIPM    ENDSR
N27  C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Cod                                          SRCOD /
      *////////////////////////////////////////////////////////////
     C     SRCOD         BEGSR
      *
      * LES TAG
     C     STSRCOD       TAG
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRCOD
      *
     C                   SELECT
      * <CodType
     C                   WHEN      XXTAG = XCOD1
     C                   GOTO      STSRCOD
      * <CodAmount
     C                   WHEN      XXTAG = XCOD2
     C                   ADD       28            WPOS
     C                   EXSR      GETTXT
     C                   EVAL      FRTTXT = 'CODAMOUNT:'
     C                   CAT       'CURRENCY=':5 FRTTXT
     C                   CAT       XTXT:0        FRTTXT
     C                   ADD       2             WPOS
     C                   EXSR      GETTXT
     C                   CAT       'AMOUNT=':5   FRTTXT
     C                   CAT       XTXT:0        FRTTXT
     C                   ADD       1             FRTLI
     C                   WRITE     FREETXTR
     C                   GOTO      STSRCOD
      *
     C                   ENDSL
      *
     C                   SELECT
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      SLSRCOD
     C                   WHEN      ((XXTAG = XEQUIPM) OR (XXTAG = XEQUIPMTOM))
     C                   GOTO      SLSRCOD
     C                   WHEN      ((XXTAG = XCOD) OR (XXTAG = XCODTOM))
     C                   GOTO      SLSRCOD
     C                   WHEN      ((XXTAG = XDGOODS) OR (XXTAG = XDGOODSTOM))
     C                   GOTO      SLSRCOD
     C                   WHEN      ((XXTAG = XTRALEG) OR (XXTAG = XTRALEGTOM))
     C                   GOTO      SLSRCOD
     C                   WHEN      XXTAG = XTOD
     C                   GOTO      SLSRCOD
     C                   WHEN      ((XXTAG = XCHARGE) OR (XXTAG = XCHARGETOM))
     C                   GOTO      SLSRCOD
     C                   WHEN      ((XXTAG = XSERVIC) OR (XXTAG = XSERVICTOM))
     C                   GOTO      SLSRCOD
     C                   WHEN      ((XXTAG = XMDAT) OR (XXTAG = XMDATTOM))
     C                   GOTO      SLSRCOD
     C                   WHEN      ((XXTAG = XCUSINF) OR (XXTAG = XCUSINFTOM))
     C                   GOTO      SLSRCOD
     C                   WHEN      ((XXTAG = XOFFER) OR (XXTAG = XOFFERTOM))
     C                   GOTO      SLSRCOD
     C                   WHEN      ((XXTAG = XINSUR) OR (XXTAG = XINSURTOM))
     C                   GOTO      SLSRCOD
     C                   WHEN      XXTAG = XSPARTY
     C                   GOTO      SLSRCOD
     C                   ENDSL
     C                   GOTO      STSRCOD
      *
     C     SLSRCOD       ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for DangerousGoods                            SRDGOODS /
      *////////////////////////////////////////////////////////////
     C     SRDGOODS      BEGSR
      *
     C                   EVAL      FRTTXT = *BLANKS
      * LES TAG
     C     STSRDGOODS    TAG
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRDGOODS
      *
     C                   SELECT
      * <UNNo>
     C                   WHEN      XXTAG = XDGOODS1
     C                   EXSR      GETTXT
     C                   IF        FRTTXT = *BLANKS
     C                   EVAL      FRTTXT = 'UNNO:'
     C                   ELSE
     C                   CAT       'UNNO:':2     FRTTXT
     C                   END
     C                   CAT       XTXT:1        FRTTXT
     C                   GOTO      STSRDGOODS
      * <Commodity>
     C                   WHEN      XXTAG = XDGOODS2
     C                   EXSR      GETTXT
     C                   IF        FRTTXT = *BLANKS
     C                   EVAL      FRTTXT = 'Commodity:'
     C                   ELSE
     C                   CAT       'Commodity:':2FRTTXT
     C                   END
     C                   CAT       XTXT:1        FRTTXT
     C                   GOTO      STSRDGOODS
      * <Class>
     C                   WHEN      XXTAG = XDGOODS3
     C                   EXSR      GETTXT
     C                   IF        FRTTXT = *BLANKS
     C                   EVAL      FRTTXT = 'Class:'
     C                   ELSE
     C                   CAT       'Class:':2    FRTTXT
     C                   END
     C                   CAT       XTXT:1        FRTTXT
     C                   GOTO      STSRDGOODS
      * <Group>
     C                   WHEN      XXTAG = XDGOODS4
     C                   EXSR      GETTXT
     C                   IF        FRTTXT = *BLANKS
     C                   EVAL      FRTTXT = 'Group:'
     C                   ELSE
     C                   CAT       'Group:':2    FRTTXT
     C                   END
     C                   CAT       XTXT:1        FRTTXT
     C                   GOTO      STSRDGOODS
      *
     C                   ENDSL
      *
     C                   IF        FRTTXT <> *BLANKS
     C                   ADD       1             FRTLI
     C                   WRITE     FREETXTR
     C                   END
      *
     C                   SELECT
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      SLSRDGOODS
     C                   WHEN      ((XXTAG = XEQUIPM) OR (XXTAG = XEQUIPMTOM))
     C                   GOTO      SLSRDGOODS
     C                   WHEN      ((XXTAG = XCOD) OR (XXTAG = XCODTOM))
     C                   GOTO      SLSRDGOODS
     C                   WHEN      ((XXTAG = XDGOODS) OR (XXTAG = XDGOODSTOM))
     C                   GOTO      SLSRDGOODS
     C                   WHEN      ((XXTAG = XTRALEG) OR (XXTAG = XTRALEGTOM))
     C                   GOTO      SLSRDGOODS
     C                   WHEN      XXTAG = XTOD
     C                   GOTO      SLSRDGOODS
     C                   WHEN      ((XXTAG = XCHARGE) OR (XXTAG = XCHARGETOM))
     C                   GOTO      SLSRDGOODS
     C                   WHEN      ((XXTAG = XSERVIC) OR (XXTAG = XSERVICTOM))
     C                   GOTO      SLSRDGOODS
     C                   WHEN      ((XXTAG = XMDAT) OR (XXTAG = XMDATTOM))
     C                   GOTO      SLSRDGOODS
     C                   WHEN      ((XXTAG = XCUSINF) OR (XXTAG = XCUSINFTOM))
     C                   GOTO      SLSRDGOODS
     C                   WHEN      ((XXTAG = XOFFER) OR (XXTAG = XOFFERTOM))
     C                   GOTO      SLSRDGOODS
     C                   WHEN      ((XXTAG = XINSUR) OR (XXTAG = XINSURTOM))
     C                   GOTO      SLSRDGOODS
     C                   WHEN      XXTAG = XSPARTY
     C                   GOTO      SLSRDGOODS
     C                   ENDSL
     C                   GOTO      STSRDGOODS
      *
     C     SLSRDGOODS    ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for TransportLeg                              SRTRALEG /
      *////////////////////////////////////////////////////////////
     C     SRTRALEG      BEGSR
      *
      * LES TAG
     C     STSRTRALEG    TAG
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRTRALEG
      *
     C                   SELECT
      * <TransportLegId>
     C                   WHEN      XXTAG = XTRALEG1
N09  C                   EXSR      GETTXT
N09  C                   EVAL      FSKODE = 'VON'
N09  C                   EVAL      FSSOK = XTXT
N09  C                   WRITE     FRISOKR
     C                   GOTO      STSRTRALEG
N25   * <<Location
N25  C                   WHEN      XXTAG = XTRALEG2
NC   C*                  IF        XSUMSETTYP = '741'
NC   C                   IF        ((XSUMSETTYP = '741') OR
NC   C                                (XSUMSETTYP = '704'))
N25  C                   MOVE      WPOS          XPOS
N25  C     XTRALEG3      SCAN      RDATA3:WPOS   WPOS                     51
N25  C                   IF        *IN51
N25  C                   ADD       10            WPOS
N25  C                   EXSR      GETTXT
N25  C                   MOVEL     XTXT          XLOKTYP          15
N25  C                   ADD       14            WPOS
N25  C                   EXSR      GETTXT
N25  C     ZEADL01K      CHAIN     ZEADL01                            33
N25  C                   SELECT
N25  C                   WHEN      XLOKTYP = 'StartLocation'
N25  C                   MOVEL     XTXT          HESDF
N25  C                   WHEN      XLOKTYP = 'EndLocation'
N25  C                   MOVEL     XTXT          HESDT
N25  C                   ENDSL
N25  C  N33              UPDATE    HEADFR
N25  C                   ELSE
N25  C                   MOVE      XPOS          WPOS
N25  C                   END
N25  C                   GOTO      STSRTRALEG
N25  C                   END
      *
     C                   ENDSL
      *
     C                   SELECT
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      SLSRTRALEG
     C                   WHEN      ((XXTAG = XEQUIPM) OR (XXTAG = XEQUIPMTOM))
     C                   GOTO      SLSRTRALEG
     C                   WHEN      ((XXTAG = XCOD) OR (XXTAG = XCODTOM))
     C                   GOTO      SLSRTRALEG
     C                   WHEN      ((XXTAG = XDGOODS) OR (XXTAG = XDGOODSTOM))
     C                   GOTO      SLSRTRALEG
     C                   WHEN      ((XXTAG = XTRALEG) OR (XXTAG = XTRALEGTOM))
     C                   GOTO      SLSRTRALEG
     C                   WHEN      XXTAG = XTOD
     C                   GOTO      SLSRTRALEG
     C                   WHEN      ((XXTAG = XCHARGE) OR (XXTAG = XCHARGETOM))
     C                   GOTO      SLSRTRALEG
     C                   WHEN      ((XXTAG = XSERVIC) OR (XXTAG = XSERVICTOM))
     C                   GOTO      SLSRTRALEG
     C                   WHEN      ((XXTAG = XMDAT) OR (XXTAG = XMDATTOM))
     C                   GOTO      SLSRTRALEG
     C                   WHEN      ((XXTAG = XCUSINF) OR (XXTAG = XCUSINFTOM))
     C                   GOTO      SLSRTRALEG
     C                   WHEN      ((XXTAG = XOFFER) OR (XXTAG = XOFFERTOM))
     C                   GOTO      SLSRTRALEG
     C                   WHEN      ((XXTAG = XINSUR) OR (XXTAG = XINSURTOM))
     C                   GOTO      SLSRTRALEG
     C                   WHEN      XXTAG = XSPARTY
     C                   GOTO      SLSRTRALEG
     C                   ENDSL
     C                   GOTO      STSRTRALEG
      *
     C     SLSRTRALEG    ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for TermsOfDelivery                              SRTOD /
      *////////////////////////////////////////////////////////////
     C     SRTOD         BEGSR
      *
     C                   MOVE      'N'           XXOPDTOD          1
      * LES TAG
     C     STSRTOD       TAG
     C*                  ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRTOD
      *
     C                   SELECT
      * <TODConditionCode>
     C                   WHEN      XXTAG = XTOD1
     C                   EXSR      GETTXT
     C     ZEADL01K      CHAIN     ZEADL01                            33
N54  C                   IF        FIFIRM = '51'                                DANMARK
N54  C                   SELECT
N54  C                   WHEN      XTXT = 'Prepaid'
N54  C                   EVAL      HEFR = 'DDP'
N54  C                   WHEN      XTXT = 'Collect' OR XTXT = 'ThirdParty'
N54  C                   EVAL      HEFR = 'EXW'
N54  C                   OTHER
N54  C                   EVAL      HEFR = XTXT
N54  C                   ENDSL
N54  C                   ELSE
     C                   EVAL      HEFR = XTXT
N54  C                   END
NC    *
NC   C                   SELECT
NC   C     HEFR          WHENEQ    'DDU'
NC   C     HEFR          OREQ      'DDP'
NC   C     HEFR          OREQ      'CFR'
NC   C     HEFR          OREQ      'CPT'
NC   C     HEFR          OREQ      'CIP'
NC   C     HEFR          OREQ      'CIF'
NC   C     HEFR          OREQ      'DES'
NC   C     HEFR          OREQ      'DEQ'
NC   C                   MOVE      ' '           HEKDFS
NC   C                   MOVE      'X'           HEKDFK
NC   C                   MOVE      *ZEROS        HEKNKF
NC   C     HEFR          WHENEQ    'EXW'
NC   C     HEFR          OREQ      'FCA'
NC   C     HEFR          OREQ      'FAS'
NC   C     HEFR          OREQ      'FOB'
NC   C                   MOVE      ' '           HEKDFK
NC   C                   MOVE      'X'           HEKDFS
NC   C                   MOVE      *ZEROS        HEKNSF
NC   C                   ENDSL
NC    *
     C                   UPDATE    HEADFR
     C                   GOTO      STSRTOD
      * <TODConditionCodeList>
S08  C*                  WHEN      XXTAG = XTOD2
N08  C                   WHEN      ((XXTAG = XTOD2) OR (XXTAG = XTOD2A))
     C*                  EVAL      FSKODE = 'TOD'
     C*                  EXSR      GETTXT
     C*                  EVAL      FSSOK = HEFR
     C*                            + '     ' + %trim(XTXT)
     C*                  WRITE     FRISOKR
     C*                  GOTO      STSRTOD
      * <TODLocation>
     C                   WHEN      XXTAG = XTOD3
     C                   EVAL      FSKODE = 'TOD'
     C                   EXSR      GETTXT
     C                   EVAL      FSSOK = XTXT
     C                   WRITE     FRISOKR
     C                   MOVE      'J'           XXOPDTOD
     C                   GOTO      STSRTOD
     C                   OTHER
S09  C*                  IF        XXOPDTOD = 'N'
S09  C*                  EVAL      FSSOK = HEFR
S09  C*                  WRITE     FRISOKR
S09  C*                  END
      *
     C                   ENDSL
      *
     C                   SELECT
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      SLSRTOD
     C                   WHEN      ((XXTAG = XEQUIPM) OR (XXTAG = XEQUIPMTOM))
     C                   GOTO      SLSRTOD
     C                   WHEN      ((XXTAG = XCOD) OR (XXTAG = XCODTOM))
     C                   GOTO      SLSRTOD
     C                   WHEN      ((XXTAG = XDGOODS) OR (XXTAG = XDGOODSTOM))
     C                   GOTO      SLSRTOD
     C                   WHEN      ((XXTAG = XTRALEG) OR (XXTAG = XTRALEGTOM))
     C                   GOTO      SLSRTOD
     C                   WHEN      XXTAG = XTOD
     C                   GOTO      SLSRTOD
     C                   WHEN      ((XXTAG = XCHARGE) OR (XXTAG = XCHARGETOM))
     C                   GOTO      SLSRTOD
     C                   WHEN      ((XXTAG = XSERVIC) OR (XXTAG = XSERVICTOM))
     C                   GOTO      SLSRTOD
     C                   WHEN      ((XXTAG = XMDAT) OR (XXTAG = XMDATTOM))
     C                   GOTO      SLSRTOD
     C                   WHEN      ((XXTAG = XCUSINF) OR (XXTAG = XCUSINFTOM))
     C                   GOTO      SLSRTOD
     C                   WHEN      ((XXTAG = XOFFER) OR (XXTAG = XOFFERTOM))
     C                   GOTO      SLSRTOD
     C                   WHEN      ((XXTAG = XINSUR) OR (XXTAG = XINSURTOM))
     C                   GOTO      SLSRTOD
     C                   WHEN      XXTAG = XSPARTY
     C                   GOTO      SLSRTOD
     C                   ENDSL
     C                   GOTO      STSRTOD
      *
     C     SLSRTOD       ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Charges                                   SRCHARGE /
      *////////////////////////////////////////////////////////////
     C     SRCHARGE      BEGSR
      *
     C                   EVAL      FRTTXT = *BLANKS
      * LES TAG
     C     STSRCHARGE    TAG
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRCHARGE
      *
     C                   SELECT
      * <ChargeItem>
     C                   WHEN      XXTAG = XCHARGE1
     C                   GOTO      STSRCHARGE
      * <ChargeCode>
     C                   WHEN      XXTAG = XCHARGE2
     C                   EXSR      GETTXT
     C                   IF        FRTTXT = *BLANKS
     C                   EVAL      FRTTXT = 'Charge  Code:'
     C                   ELSE
     C                   CAT       'Code:':2     FRTTXT
     C                   END
     C                   CAT       XTXT:1        FRTTXT
     C                   GOTO      STSRCHARGE
      * <ChargeText>
     C                   WHEN      XXTAG = XCHARGE3
     C                   EXSR      GETTXT
     C                   IF        FRTTXT = *BLANKS
     C                   EVAL      FRTTXT = 'Charge  Text:'
     C                   ELSE
     C                   CAT       'Text:':2     FRTTXT
     C                   END
     C                   CAT       XTXT:1        FRTTXT
     C                   GOTO      STSRCHARGE
      * <VATCode>
     C                   WHEN      XXTAG = XCHARGE4
     C                   EXSR      GETTXT
     C                   IF        FRTTXT = *BLANKS
     C                   EVAL      FRTTXT = 'Charge  VATCode:'
     C                   ELSE
     C                   CAT       'VATCode:':2  FRTTXT
     C                   END
     C                   CAT       XTXT:1        FRTTXT
     C                   GOTO      STSRCHARGE
      * <GrossAmount>
     C                   WHEN      XXTAG = XCHARGE5
     C                   EXSR      GETTXT
     C                   IF        FRTTXT = *BLANKS
     C                   EVAL      FRTTXT = 'Charge  Amount:'
     C                   ELSE
     C                   CAT       'Amount:':2   FRTTXT
     C                   END
     C                   CAT       XTXT:1        FRTTXT
     C                   GOTO      STSRCHARGE
      * <Comment>
     C                   WHEN      XXTAG = XCHARGE6
     C                   IF        FRTTXT <> *BLANKS
     C                   ADD       1             FRTLI
     C                   WRITE     FREETXTR
     C                   END
     C                   EXSR      GETTXT
     C                   EVAL      FRTTXT = 'Comment:'
     C                   CAT       XTXT:1        FRTTXT
     C                   ADD       1             FRTLI
     C                   WRITE     FREETXTR
     C                   MOVE      *BLANKS       FRTTXT
     C                   GOTO      STSRCHARGE
      *
     C                   ENDSL
      *
     C                   IF        FRTTXT <> *BLANKS
     C                   ADD       1             FRTLI
     C                   WRITE     FREETXTR
     C                   END
      *
     C                   SELECT
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      SLSRCHARGE
     C                   WHEN      ((XXTAG = XEQUIPM) OR (XXTAG = XEQUIPMTOM))
     C                   GOTO      SLSRCHARGE
     C                   WHEN      ((XXTAG = XCOD) OR (XXTAG = XCODTOM))
     C                   GOTO      SLSRCHARGE
     C                   WHEN      ((XXTAG = XDGOODS) OR (XXTAG = XDGOODSTOM))
     C                   GOTO      SLSRCHARGE
     C                   WHEN      ((XXTAG = XTRALEG) OR (XXTAG = XTRALEGTOM))
     C                   GOTO      SLSRCHARGE
     C                   WHEN      XXTAG = XTOD
     C                   GOTO      SLSRCHARGE
     C                   WHEN      ((XXTAG = XCHARGE) OR (XXTAG = XCHARGETOM))
     C                   GOTO      SLSRCHARGE
     C                   WHEN      ((XXTAG = XSERVIC) OR (XXTAG = XSERVICTOM))
     C                   GOTO      SLSRCHARGE
     C                   WHEN      ((XXTAG = XMDAT) OR (XXTAG = XMDATTOM))
     C                   GOTO      SLSRCHARGE
     C                   WHEN      ((XXTAG = XCUSINF) OR (XXTAG = XCUSINFTOM))
     C                   GOTO      SLSRCHARGE
     C                   WHEN      ((XXTAG = XOFFER) OR (XXTAG = XOFFERTOM))
     C                   GOTO      SLSRCHARGE
     C                   WHEN      ((XXTAG = XINSUR) OR (XXTAG = XINSURTOM))
     C                   GOTO      SLSRCHARGE
     C                   WHEN      XXTAG = XSPARTY
     C                   GOTO      SLSRCHARGE
     C                   ENDSL
     C                   GOTO      STSRCHARGE
      *
     C     SLSRCHARGE    ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Service                                   SRSERVIC /
      *////////////////////////////////////////////////////////////
     C     SRSERVIC      BEGSR
      *
      * LES TAG
     C     STSRSERVIC    TAG
S49  C*                  ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRSERVIC
      *
     C                   SELECT
N49   * <BasicServiceCode>
N49  C                   WHEN      XXTAG = XSERVIC1X
N49  C                   EXSR      GETTXT
N49  C                   MOVEL     XTXT          XAN20            20
S51  C*                  IF        FIFIRM = '51' AND XAN20 = '0336'
N51  C                   IF        (FIFIRM = '51' AND XAN20 = '0336') OR
N51  C                             (FIFIRM = '51' AND XAN20 = '3568')
N49  C     ZEADL01K      CHAIN     ZEADL01                            33
N49  C                   EVAL      HEOT = 'PD'
N49  C  N33              UPDATE    HEADFR
N49  C                   END
N49  C                   GOTO      STSRSERVIC
      * <BasicServiceCode
     C                   WHEN      XXTAG = XSERVIC1
     C                   ADD       20            WPOS
     C                   EXSR      GETTXT
     C                   MOVEL     XTXT          XXNATR           30
     C                   ADD       2             WPOS
     C                   EXSR      GETTXT
     C                   GOTO      STSRSERVIC
N20   * <TariffReference>
N20  C                   WHEN      XXTAG = XSERVIC2
S49  C*                  ADD       17            WPOS
N20  C                   EXSR      GETTXT
N20  C                   MOVEL     XTXT          XXTARC           30
S49  C*                  ADD       2             WPOS
S49  C*                  EXSR      GETTXT
N20  C                   GOTO      STSRSERVIC
      *
     C                   ENDSL
      *
     C                   SELECT
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      SLSRSERVIC
     C                   WHEN      ((XXTAG = XEQUIPM) OR (XXTAG = XEQUIPMTOM))
     C                   GOTO      SLSRSERVIC
     C                   WHEN      ((XXTAG = XCOD) OR (XXTAG = XCODTOM))
     C                   GOTO      SLSRSERVIC
     C                   WHEN      ((XXTAG = XDGOODS) OR (XXTAG = XDGOODSTOM))
     C                   GOTO      SLSRSERVIC
     C                   WHEN      ((XXTAG = XTRALEG) OR (XXTAG = XTRALEGTOM))
     C                   GOTO      SLSRSERVIC
     C                   WHEN      XXTAG = XTOD
     C                   GOTO      SLSRSERVIC
     C                   WHEN      ((XXTAG = XCHARGE) OR (XXTAG = XCHARGETOM))
     C                   GOTO      SLSRSERVIC
     C                   WHEN      ((XXTAG = XSERVIC) OR (XXTAG = XSERVICTOM))
     C                   GOTO      SLSRSERVIC
     C                   WHEN      ((XXTAG = XMDAT) OR (XXTAG = XMDATTOM))
     C                   GOTO      SLSRSERVIC
     C                   WHEN      ((XXTAG = XCUSINF) OR (XXTAG = XCUSINFTOM))
     C                   GOTO      SLSRSERVIC
     C                   WHEN      ((XXTAG = XOFFER) OR (XXTAG = XOFFERTOM))
     C                   GOTO      SLSRSERVIC
     C                   WHEN      ((XXTAG = XINSUR) OR (XXTAG = XINSURTOM))
     C                   GOTO      SLSRSERVIC
     C                   WHEN      XXTAG = XSPARTY
     C                   GOTO      SLSRSERVIC
N32  C                   WHEN      XXTAG = XCONSET
N32  C                   GOTO      SLSRSERVIC
     C                   ENDSL
     C                   GOTO      STSRSERVIC
      *
     C     SLSRSERVIC    ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for DateAndTime                                 SRMDAT /
      *////////////////////////////////////////////////////////////
     C     SRMDAT        BEGSR
     C                   MOVE      'N'           XPICKDATE         1
     C                   MOVE      'N'           XDELDATE          1
N08  C                   MOVE      'N'           XDOCDATE          1
N43  C                   MOVE      'N'           XPDEDATE          1
      *
      * Type of date and time
     C                   ADD       10            WPOS
     C                   EXSR      GETTXT
     C                   EVAL      FRTTXT = XTXT
     C                   CAT       ':':0         FRTTXT
     C                   MOVE      ' '           XMINUT            1
     C                   SELECT
     C                   WHEN      XTXT = 'PickupDate'
     C                   MOVE      'J'           XPICKDATE
     C     ZEADL01K      CHAIN     ZEADL01                            33
     C                   WHEN      XTXT = 'DeliveryDate'
     C                   MOVE      'J'           XDELDATE
     C     ZEADL01K      CHAIN     ZEADL01                            33
N08  C                   WHEN      XTXT = 'DocumentDate'
N44  C***                IF        XPICKDATE = 'J'
N44  C***                MOVE      'j'           XPICKDATE
N44  C***                ELSE
N08  C                   MOVE      'J'           XDOCDATE
N44  C***                END
N08  C     ZEADL01K      CHAIN     ZEADL01                            33
N43  C                   WHEN      XTXT = 'PickupDateEarliest'
N43  C                   MOVE      'J'           XPDEDATE
     C                   ENDSL

      *
      * LES TAG
     C     STSRMDAT      TAG
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
S19  C*    XSLUTTLES     CABEQ     'J'           SLSRMDAT
N19  C                   IF        XSLUTTLES = 'J'
N19  C                   IF        XPICKDATE = 'J' OR
N44  C***                          XPICKDATE = 'j' OR
N19  C                             XDELDATE = 'J' OR
N19  C                             XDOCDATE = 'J'
N19  C                   UPDATE    HEADFR
N19  C                   END
N19  C                   GOTO      SLSRMDAT
N19  C                   END
      *
     C                   SELECT
      * <Year>
     C                   WHEN      XXTAG = XMDAT1
     C                   EXSR      GETTXT
     C                   CAT       XTXT:1        FRTTXT
     C                   CAT       '.':0         FRTTXT
     C                   SELECT
S08  C*                  WHEN      XPICKDATE = 'J'
N08  C                   WHEN      ((XPICKDATE = 'J') OR
N08  C                             ((XDOCDATE = 'J') AND (XPICKDATE = 'N')))
     C                   MOVEL     XTXT          HEDTOPÅ
     C                   MOVEL     XTXT          TRSDFDÅ
     C                   WHEN      XDELDATE = 'J'
     C                   MOVEL     XTXT          TRSDTDÅ
N43  C                   WHEN      XPDEDATE = 'J'
N43  C                   MOVEL     XTXT          TXEX2DÅ
     C                   ENDSL
     C                   GOTO      STSRMDAT
      * <Month>
     C                   WHEN      XXTAG = XMDAT2
     C                   EXSR      GETTXT
     C                   IF        XT80(2) = *BLANKS
     C                   CAT       '0':0         FRTTXT
     C                   END
     C                   CAT       XTXT:0        FRTTXT
     C                   CAT       '.':0         FRTTXT
     C                   SELECT
S08  C*                  WHEN      XPICKDATE = 'J'
N08  C                   WHEN      ((XPICKDATE = 'J') OR
N08  C                             ((XDOCDATE = 'J') AND (XPICKDATE = 'N')))
     C                   MOVEL     XTXT          HEDTOPM
     C                   MOVEL     XTXT          TRSDFDM
     C                   WHEN      XDELDATE = 'J'
     C                   MOVEL     XTXT          TRSDTDM
N43  C                   WHEN      XPDEDATE = 'J'
N43  C                   MOVEL     XTXT          TXEX2DM
     C                   ENDSL
     C                   GOTO      STSRMDAT
      * <Day>
     C                   WHEN      XXTAG = XMDAT3
     C                   EXSR      GETTXT
     C                   IF        XT80(2) = *BLANKS
     C                   CAT       '0':0         FRTTXT
     C                   END
     C                   CAT       XTXT:0        FRTTXT
     C                   SELECT
S08  C*                  WHEN      XPICKDATE = 'J'
N08  C                   WHEN      ((XPICKDATE = 'J') OR
N08  C                             ((XDOCDATE = 'J') AND (XPICKDATE = 'N')))
     C                   MOVEL     XTXT          HEDTOPD
N23  C                   IF        XARRDATE <> 0
N23  C                   MOVE      XARRDATE      HEDTOP
N23  C                   END
     C                   MOVEL     XTXT          TRSDFDD
     C                   WHEN      XDELDATE = 'J'
     C                   MOVEL     XTXT          TRSDTDD
N43  C                   WHEN      XPDEDATE = 'J'
N43  C                   MOVEL     XTXT          TXEX2DD
     C                   ENDSL
     C                   GOTO      STSRMDAT
      * <Hour>
     C                   WHEN      XXTAG = XMDAT4
     C                   EXSR      GETTXT
     C                   SELECT
S08  C*                  WHEN      XPICKDATE = 'J'
N08  C                   WHEN      ((XPICKDATE = 'J') OR
N08  C                             ((XDOCDATE = 'J') AND (XPICKDATE = 'N')))
     C                   IF        XT80(2) = *BLANKS
     C                   MOVE      *ZEROS        TRSDFK
     C                   ELSE
     C                   MOVEL     XTXT          XAN02             2
     C                   MOVEL     XAN02         TRSDFK
     C                   END
     C                   WHEN      XDELDATE = 'J'
     C                   IF        XT80(2) = *BLANKS
     C                   MOVE      *ZEROS        TRSDTK
     C                   ELSE
     C                   MOVEL     XTXT          XAN02             2
     C                   MOVEL     XAN02         TRSDTK
     C                   END
N43  C                   WHEN      XPDEDATE = 'J'
N43  C                   IF        XT80(2) = *BLANKS
N43  C                   MOVE      *ZEROS        TXEX2K
N43  C                   ELSE
N43  C                   MOVEL     XTXT          XAN02             2
N43  C                   MOVEL     XAN02         TXEX2K
N43  C                   END
     C                   ENDSL
     C                   CAT       'Time:':5     FRTTXT
     C                   IF        XT80(2) = *BLANKS
     C                   CAT       '0':1         FRTTXT
     C                   CAT       XTXT:0        FRTTXT
     C                   ELSE
     C                   CAT       XTXT:1        FRTTXT
     C                   END
     C                   CAT       '.':0         FRTTXT
     C                   MOVE      'N'           XMINUT
     C                   GOTO      STSRMDAT
      * <Minute>
     C                   WHEN      XXTAG = XMDAT5
     C                   EXSR      GETTXT
     C                   SELECT
S08  C*                  WHEN      XPICKDATE = 'J'
N08  C                   WHEN      ((XPICKDATE = 'J') OR
N08  C                             ((XDOCDATE = 'J') AND (XPICKDATE = 'N')))
     C                   IF        XT80(2) = *BLANKS
     C                   MOVE      '00'          TRSDFK
     C                   ELSE
     C                   MOVEL     XTXT          XAN02             2
     C                   MOVE      XAN02         TRSDFK
     C                   END
     C                   WHEN      XDELDATE = 'J'
     C                   IF        XT80(2) = *BLANKS
     C                   MOVE      '00'          TRSDTK
     C                   ELSE
     C                   MOVEL     XTXT          XAN02             2
     C                   MOVE      XAN02         TRSDTK
     C                   END
N43  C                   WHEN      XPDEDATE = 'J'
N43  C                   IF        XT80(2) = *BLANKS
N43  C                   MOVE      *ZEROS        TXEX2K
N43  C                   ELSE
N43  C                   MOVEL     XTXT          XAN02             2
N43  C                   MOVEL     XAN02         TXEX2K
N43  C                   END
     C                   ENDSL
     C                   IF        XT80(2) = *BLANKS
     C                   CAT       '0':0         FRTTXT
     C                   END
     C                   CAT       XTXT:0        FRTTXT
     C                   MOVE      'J'           XMINUT
     C                   GOTO      STSRMDAT
      *
     C                   ENDSL
      *
     C                   IF        FRTTXT <> *BLANKS
     C                   IF        XMINUT = 'N'
     C                   CAT       '00':0        FRTTXT
     C                   END
     C                   ADD       1             FRTLI
     C                   WRITE     FREETXTR
     C                   END
      *
S08  C*                  IF        ((XPICKDATE = 'J') OR (XDELDATE = 'J'))
N08  C                   IF        XPICKDATE = 'J' OR
N44  C***                          XPICKDATE = 'j' OR
N08  C                             XDELDATE = 'J' OR
N08  C                             XDOCDATE = 'J'
     C                   UPDATE    HEADFR
     C                   END
N43  C                   IF        XPDEDATE = 'J'
N43  C                   EVAL      TXUNIK = HEUNIK
N43  C                   EVAL      TXREFF = HEREFF
N43  C                   WRITE     TRACKTR
N43  C                   EVAL      XPDEDATE = 'N'
N43  C                   END
      *
     C                   SELECT
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      SLSRMDAT
     C                   WHEN      ((XXTAG = XEQUIPM) OR (XXTAG = XEQUIPMTOM))
     C                   GOTO      SLSRMDAT
     C                   WHEN      ((XXTAG = XCOD) OR (XXTAG = XCODTOM))
     C                   GOTO      SLSRMDAT
     C                   WHEN      ((XXTAG = XDGOODS) OR (XXTAG = XDGOODSTOM))
     C                   GOTO      SLSRMDAT
     C                   WHEN      ((XXTAG = XTRALEG) OR (XXTAG = XTRALEGTOM))
     C                   GOTO      SLSRMDAT
     C                   WHEN      XXTAG = XTOD
     C                   GOTO      SLSRMDAT
     C                   WHEN      ((XXTAG = XCHARGE) OR (XXTAG = XCHARGETOM))
     C                   GOTO      SLSRMDAT
     C                   WHEN      ((XXTAG = XSERVIC) OR (XXTAG = XSERVICTOM))
     C                   GOTO      SLSRMDAT
     C                   WHEN      ((XXTAG = XMDAT) OR (XXTAG = XMDATTOM))
     C                   GOTO      SLSRMDAT
     C                   WHEN      ((XXTAG = XCUSINF) OR (XXTAG = XCUSINFTOM))
     C                   GOTO      SLSRMDAT
     C                   WHEN      ((XXTAG = XOFFER) OR (XXTAG = XOFFERTOM))
     C                   GOTO      SLSRMDAT
     C                   WHEN      ((XXTAG = XINSUR) OR (XXTAG = XINSURTOM))
     C                   GOTO      SLSRMDAT
     C                   WHEN      XXTAG = XSPARTY
     C                   GOTO      SLSRMDAT
N08  C                   WHEN      XXTAG = XCONSET
N08  C                   GOTO      SLSRMDAT
     C                   ENDSL
     C                   GOTO      STSRMDAT
      *
     C     SLSRMDAT      ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for CustomInformation                         SRCUSINF /
      *////////////////////////////////////////////////////////////
     C     SRCUSINF      BEGSR
      *
     C                   EVAL      FRTTXT = *BLANKS
      *
      * LES TAG
     C     STSRCUSINF    TAG
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRCUSINF
      *
     C                   SELECT
      * <CustomsClearanceNo>
     C                   WHEN      XXTAG = XCUSINF1
     C                   EXSR      GETTXT
     C                   EVAL      FRTTXT = 'CustomsClearanceNo:'
     C                   CAT       XTXT:1        FRTTXT
     C                   GOTO      STSRCUSINF
      * <CustomsValue>
     C                   WHEN      XXTAG = XCUSINF2
     C                   ADD       28            WPOS
     C                   EXSR      GETTXT
     C                   CAT       'Currency:':3 FRTTXT
     C                   CAT       XTXT:1        FRTTXT
     C                   ADD       2             WPOS
     C                   EXSR      GETTXT
     C                   CAT       'Amount:':3   FRTTXT
     C                   CAT       XTXT:1        FRTTXT
     C                   GOTO      STSRCUSINF
      *
     C                   ENDSL
      *
     C                   IF        FRTTXT <> *BLANKS
     C                   ADD       1             FRTLI
     C                   WRITE     FREETXTR
     C                   END
      *
     C                   SELECT
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      SLSRCUSINF
     C                   WHEN      ((XXTAG = XEQUIPM) OR (XXTAG = XEQUIPMTOM))
     C                   GOTO      SLSRCUSINF
     C                   WHEN      ((XXTAG = XCOD) OR (XXTAG = XCODTOM))
     C                   GOTO      SLSRCUSINF
     C                   WHEN      ((XXTAG = XDGOODS) OR (XXTAG = XDGOODSTOM))
     C                   GOTO      SLSRCUSINF
     C                   WHEN      ((XXTAG = XTRALEG) OR (XXTAG = XTRALEGTOM))
     C                   GOTO      SLSRCUSINF
     C                   WHEN      XXTAG = XTOD
     C                   GOTO      SLSRCUSINF
     C                   WHEN      ((XXTAG = XCHARGE) OR (XXTAG = XCHARGETOM))
     C                   GOTO      SLSRCUSINF
     C                   WHEN      ((XXTAG = XSERVIC) OR (XXTAG = XSERVICTOM))
     C                   GOTO      SLSRCUSINF
     C                   WHEN      ((XXTAG = XMDAT) OR (XXTAG = XMDATTOM))
     C                   GOTO      SLSRCUSINF
     C                   WHEN      ((XXTAG = XCUSINF) OR (XXTAG = XCUSINFTOM))
     C                   GOTO      SLSRCUSINF
     C                   WHEN      ((XXTAG = XOFFER) OR (XXTAG = XOFFERTOM))
     C                   GOTO      SLSRCUSINF
     C                   WHEN      ((XXTAG = XINSUR) OR (XXTAG = XINSURTOM))
     C                   GOTO      SLSRCUSINF
     C                   WHEN      XXTAG = XSPARTY
     C                   GOTO      SLSRCUSINF
     C                   ENDSL
     C                   GOTO      STSRCUSINF
      *
     C     SLSRCUSINF    ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Offer                                      SROFFER /
      *////////////////////////////////////////////////////////////
     C     SROFFER       BEGSR
      *
      * LES TAG
     C     STSROFFER     TAG
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSROFFER
      *
     C                   SELECT
      * <FreeText>
     C                   WHEN      XXTAG = XOFFER1
     C                   EXSR      GETTXT
     C                   EVAL      FRTTXT = XTXT
     C                   ADD       1             FRTLI
     C                   WRITE     FREETXTR
     C                   GOTO      STSROFFER
      *
     C                   ENDSL
      *
     C                   SELECT
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      SLSROFFER
     C                   WHEN      ((XXTAG = XEQUIPM) OR (XXTAG = XEQUIPMTOM))
     C                   GOTO      SLSROFFER
     C                   WHEN      ((XXTAG = XCOD) OR (XXTAG = XCODTOM))
     C                   GOTO      SLSROFFER
     C                   WHEN      ((XXTAG = XDGOODS) OR (XXTAG = XDGOODSTOM))
     C                   GOTO      SLSROFFER
     C                   WHEN      ((XXTAG = XTRALEG) OR (XXTAG = XTRALEGTOM))
     C                   GOTO      SLSROFFER
     C                   WHEN      XXTAG = XTOD
     C                   GOTO      SLSROFFER
     C                   WHEN      ((XXTAG = XCHARGE) OR (XXTAG = XCHARGETOM))
     C                   GOTO      SLSROFFER
     C                   WHEN      ((XXTAG = XSERVIC) OR (XXTAG = XSERVICTOM))
     C                   GOTO      SLSROFFER
     C                   WHEN      ((XXTAG = XMDAT) OR (XXTAG = XMDATTOM))
     C                   GOTO      SLSROFFER
     C                   WHEN      ((XXTAG = XCUSINF) OR (XXTAG = XCUSINFTOM))
     C                   GOTO      SLSROFFER
     C                   WHEN      ((XXTAG = XOFFER) OR (XXTAG = XOFFERTOM))
     C                   GOTO      SLSROFFER
     C                   WHEN      ((XXTAG = XINSUR) OR (XXTAG = XINSURTOM))
     C                   GOTO      SLSROFFER
     C                   WHEN      XXTAG = XSPARTY
     C                   GOTO      SLSROFFER
     C                   ENDSL
     C                   GOTO      STSROFFER
      *
     C     SLSROFFER     ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Insurance                                  SRINSUR /
      *////////////////////////////////////////////////////////////
     C     SRINSUR       BEGSR
      *
      * LES TAG
     C     STSRINSUR     TAG
     C                   ADD       1             WPOS
     C                   EXSR      LESTAG
     C     XSLUTTLES     CABEQ     'J'           SLSRINSUR
      *
     C                   SELECT
      * <InsuranceValue>
     C                   WHEN      XXTAG = XINSUR1
     C                   ADD       28            WPOS
     C                   EXSR      GETTXT
     C                   EVAL      FRTTXT = 'InsuranceValue:'
     C                   CAT       XTXT:1        FRTTXT
     C                   ADD       2             WPOS
     C                   EXSR      GETTXT
     C                   CAT       'Amount:':3   FRTTXT
     C                   CAT       XTXT:1        FRTTXT
     C                   ADD       1             FRTLI
     C                   WRITE     FREETXTR
     C                   GOTO      STSRINSUR
      * <GoodsDescription>
     C                   WHEN      XXTAG = XINSUR2
     C                   EXSR      GETTXT
     C                   EVAL      FRTTXT = 'GoodsDescription:'
     C                   CAT       XTXT:1        FRTTXT
     C                   ADD       1             FRTLI
     C                   WRITE     FREETXTR
     C                   GOTO      STSRINSUR
      *
     C                   ENDSL
      *
     C                   SELECT
     C                   WHEN      XXTAG = XMPARTY
     C                   GOTO      SLSRINSUR
     C                   WHEN      ((XXTAG = XEQUIPM) OR (XXTAG = XEQUIPMTOM))
     C                   GOTO      SLSRINSUR
     C                   WHEN      ((XXTAG = XCOD) OR (XXTAG = XCODTOM))
     C                   GOTO      SLSRINSUR
     C                   WHEN      ((XXTAG = XDGOODS) OR (XXTAG = XDGOODSTOM))
     C                   GOTO      SLSRINSUR
     C                   WHEN      ((XXTAG = XTRALEG) OR (XXTAG = XTRALEGTOM))
     C                   GOTO      SLSRINSUR
     C                   WHEN      XXTAG = XTOD
     C                   GOTO      SLSRINSUR
     C                   WHEN      ((XXTAG = XCHARGE) OR (XXTAG = XCHARGETOM))
     C                   GOTO      SLSRINSUR
     C                   WHEN      ((XXTAG = XSERVIC) OR (XXTAG = XSERVICTOM))
     C                   GOTO      SLSRINSUR
     C                   WHEN      ((XXTAG = XMDAT) OR (XXTAG = XMDATTOM))
     C                   GOTO      SLSRINSUR
     C                   WHEN      ((XXTAG = XCUSINF) OR (XXTAG = XCUSINFTOM))
     C                   GOTO      SLSRINSUR
     C                   WHEN      ((XXTAG = XOFFER) OR (XXTAG = XOFFERTOM))
     C                   GOTO      SLSRINSUR
     C                   WHEN      ((XXTAG = XINSUR) OR (XXTAG = XINSURTOM))
     C                   GOTO      SLSRINSUR
     C                   WHEN      XXTAG = XSPARTY
     C                   GOTO      SLSRINSUR
     C                   WHEN      XXTAG = XCONSET
     C                   GOTO      SLSRINSUR
     C                   ENDSL
     C                   GOTO      STSRINSUR
      *
     C     SLSRINSUR     ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Hent sendingsref.                         SRMSGREF /
      *////////////////////////////////////////////////////////////
     C     SRMSGREF      BEGSR
      *
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
      * LES <ReferenceNo>
     C                   MOVE      WPOS          XPOS
     C     XSPARTY3      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   DOW       *IN51 = *OFF
     C                   MOVE      XPOS          WPOS
     C     XSPARTY1END   SCAN      RDATA3:WPOS   WPOS              4 0    51
     C                   IF        *IN51
     C                   MOVEL     M0068         XXSNDREF         35
     C                   GOTO      SLSRMSGREF
     C                   END
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLSRMSGREF
     C                   MOVE      WPOS          XPOS
     C     XSPARTY3      SCAN      RDATA3:WPOS   WPOS              4 0    51
     C  N51              ENDDO
      *
     C                   ADD       13            WPOS
     C                   EXSR      GETTXT
     C                   MOVEL     XTXT          XXSNDREF         35
      *
     C     SLSRMSGREF    ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Hent tekst                                  GETTXT /
      *////////////////////////////////////////////////////////////
     C     GETTXT        BEGSR
      *
     C                   MOVE      *BLANKS       XTXT
     C                   MOVE      *ZEROS        XN                4 0
     C                   DOW       ((IN(WPOS) <> '<') AND (IN(WPOS) <> '"'))
     C                   IF        IN(WPOS) = '&'
     C                   EXSR      KVTTEGN
     C                   END
     C                   ADD       1             XN
     C                   MOVE      IN(WPOS)      XT80(XN)
     C                   ADD       1             WPOS
     C                   ENDDO
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Hent tall                                   GETTAL /
      *////////////////////////////////////////////////////////////
     C     GETTAL        BEGSR
      *
     C                   MOVE      'N'           XFEILTALL         1
     C                   MOVE      *ZEROS        XTAL
     C                   DOW       ((IN(WPOS) <> '<') AND (IN(WPOS) <> '"'))
     C                   IF        ((IN(WPOS) = '.') OR (IN(WPOS) = ','))
     C                   LEAVE
     C                   END
     C                   IF        XTALH > 999999999
     C                   MOVE      'J'           XFEILTALL
     C                   GOTO      SLGETTAL
     C                   END
     C                   MULT      10            XTALH
     C                   MOVE      IN(WPOS)      XTALH
     C                   ADD       1             WPOS
     C                   ENDDO
      *
     C                   IF        ((IN(WPOS) = '.') OR (IN(WPOS) = ','))
     C                   ADD       1             WPOS
     C                   MOVE      *ZEROS        XN
     C                   DOW       ((IN(WPOS) <> '<') AND (IN(WPOS) <> '"'))
     C                   ADD       1             XN
     C                   MOVE      IN(WPOS)      XTALD(XN)
     C                   ADD       1             WPOS
     C                   IF        XN >= 5
     C                   LEAVE
     C                   END
     C                   ENDDO
     C                   END
      *
     C     SLGETTAL      ENDSR
      *
N17   *////////////////////////////////////////////////////////////
N17   * SR for Hent tall 2                                GETTAL2 /
N17   *////////////////////////////////////////////////////////////
N17  C     GETTAL2       BEGSR
N17   *
N17  C                   MOVE      'N'           XFEILTALL         1
N17  C                   MOVE      *ZEROS        XTAL
N17  C                   DOW       ((IN(WPOS) <> '<') AND (IN(WPOS) <> '"'))
N17  C                   IF        (((((IN(WPOS) = '-') OR
N17  C                                 (IN(WPOS) = '+')) OR
N17  C                                 (IN(WPOS) = 'T')) OR
N17  C                                 (IN(WPOS) = '.')) OR
N17  C                                 (IN(WPOS) = ':'))
N17  C                   LEAVE
N17  C                   END
N17  C                   MULT      10            XTALH
N17  C                   MOVE      IN(WPOS)      XTALH
N17  C                   ADD       1             WPOS
N17  C                   ENDDO
N17   *
N17  C                   ENDSR
N17   *
      *////////////////////////////////////////////////////////////
      * SR for oppdatering av tall                        OPDFEIL /
      *////////////////////////////////////////////////////////////
     C     OPDFEIL       BEGSR
      *
     C                   MOVE      XPOS          WPOS
     C                   MOVEL     XTXT          XTXT2            10
     C                   EXSR      GETTXT
     C                   SELECT
     C                   WHEN      XFEILTYPE = 'V'
     C                   EVAL      FRTTXT = 'VEKT ER FOR STOR:   VEKT ='
     C                   CAT       XTXT:1        FRTTXT
     C                   WHEN      XFEILTYPE = 'K'
     C                   EVAL      FRTTXT = 'ANTALL KOLLI ER FOR STOR:'
     C                   CAT       'ANTALL =':3  FRTTXT
     C                   CAT       XTXT:1        FRTTXT
     C                   WHEN      XFEILTYPE = 'M'
     C                   EVAL      FRTTXT = 'VOLUM ER FOR STOR:   VOLUM ='
     C                   CAT       XTXT:1        FRTTXT
     C                   CAT       XTXT2:1       FRTTXT
N15  C                   WHEN      XFEILTYPE = 'L'
N15  C                   EVAL      FRTTXT = 'LASTEMETER ER FOR STOR:   LM ='
N15  C                   CAT       XTXT:1        FRTTXT
N15  C                   CAT       XTXT2:1       FRTTXT
     C                   ENDSL
     C                   ADD       1             FRTLI
     C                   WRITE     FREETXTR
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Konvertering av tall                        KVTTAL /
      *////////////////////////////////////////////////////////////
     C     KVTTAL        BEGSR
      *
     C                   MOVE      *ZEROS        XTAL2            17 0
     C     1             DO        17            XN2               3 0
     C                   IF        ((XT(XN2) >= '0') AND (XT(XN2) <= '9'))
     C                   MULT      10            XTAL2
     C                   MOVE      XT(XN2)       XTAL2
     C                   END
     C                   ENDDO
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for Konvertering av spesiale tegn              KVTTEGN /
      *////////////////////////////////////////////////////////////
     C     KVTTEGN       BEGSR
      *
     C                   MOVE      *BLANKS       XSTEGN
     C                   MOVE      *ZEROS        XN2               3 0
     C                   DOW       IN(WPOS) <> ';'
     C                   ADD       1             XN2
     C                   MOVE      IN(WPOS)      XST10(XN2)
     C                   ADD       1             WPOS
     C                   ENDDO
      *
     C                   SELECT
     C                   WHEN      XSTEGN = '&amp'
     C                   MOVE      '&'           IN(WPOS)
     C                   WHEN      XSTEGN = '&quot'
     C                   MOVE      '"'           IN(WPOS)
     C                   WHEN      XSTEGN = '&apos'
     C                   MOVE      XAPOS         IN(WPOS)
     C                   WHEN      XSTEGN = '&gt'
     C                   MOVE      '>'           IN(WPOS)
     C                   WHEN      XSTEGN = '&lt'
     C                   MOVE      '>'           IN(WPOS)
     C                   ENDSL
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * SR for HENTING AV POSTER                           LESREC /
      *////////////////////////////////////////////////////////////
     C     LESREC        BEGSR
      *
     C                   IF        ((RDATA2 = *BLANKS) AND
     C                              (XSLUTTLES <> *BLANKS))
     C                   MOVE      'J'           XSLUTTLES         1
     C                   ELSE
N21  C                   IF        XERLEST <> 'J'
     C     WMBR          READE     EDIRE1K                                50
     C  N50              DOW       RDATA = *BLANKS
     C     WMBR          READE     EDIRE1K                                50
     C  N50              ENDDO
N21  C                   END
N21  C                   MOVE      'N'           XERLEST           1
     C                   MOVE      RDATA2        RDATA1
N03  C     STLESREC1     TAG
     C                   IF        *IN50 = *OFF
S21  C*                  MOVE      RDATA         RDATA2
N03   *
S12  C* N50              IF        ((RDATA1X = *BLANKS) AND (RDATA2X = *BLANKS))
S12  C*                  CAT       RDATA2:1      RDATA1
S12  C*    WMBR          READE     EDIRE1K                                50
S12  C* N50              DOW       RDATA = *BLANKS
S12  C*    WMBR          READE     EDIRE1K                                50
S12  C* N50              ENDDO
S12  C*  50              MOVE      *BLANKS       RDATA
S12  C*                  GOTO      STLESREC1
S12  C*                  END
S12   *
S21  C* N50              IF        RDATAX = *BLANKS
N12  C                   EVAL      RDATA2  = *BLANKS
S21  C*                  END
N16  C                   MOVE      RDATA1        XSISTTEGN         1
S21  C* N50              DOW       RDATAX = *BLANKS
N21  C  N50              DOW       ((RDATAX = *BLANKS) OR (RDATA2 = *BLANKS))
N12  C                   EVAL      RDATA10 = RDATA3
S30  C*                  MOVE      RDATA         XAN01             1
N30  C                   MOVEL     RDATA         XAN01             1
N12  C*                  IF        XAN01 = '<'
N12  C                   IF        ((XAN01 = '<') AND (XSISTTEGN = ' '))
N12  C                   CAT       RDATA:1       RDATA10
N12  C                   ELSE
N12  C                   MOVEL     RDATA         XAN01             1
N16  C                   SELECT
N16  C                   WHEN      XAN01 = '>'
N16  C                   CAT       RDATA:0       RDATA10
NXX  C                   WHEN      XSISTBLANK <> 'J'
NXX  C                   CAT       RDATA:0       RDATA10
N16  C                   WHEN      XSISTTEGN = ' '
N16  C                   CAT       RDATA:1       RDATA10
N16  C                   OTHER
N12  C                   CAT       RDATA:0       RDATA10
N16  C                   ENDSL
N12  C                   END
N12  C                   EVAL      RDATA3  = RDATA10
N12  C                   IF        RDATA10X <> *BLANKS
N12  C                   LEAVE
N12  C                   END
N12  C     WMBR          READE     EDIRE1K                                50
N12  C  N50              DOW       RDATA = *BLANKS
N12  C     WMBR          READE     EDIRE1K                                50
N12  C  N50              ENDDO
N12  C   50              MOVE      *BLANKS       RDATA
N12  C  N50              ENDDO
N12   *
N21  C  N50              IF        (((RDATAX <> *BLANKS) AND
N21  C                               (RDATA2 <> *BLANKS)) AND
N21  C                               (RDATA10X = *BLANKS))
N21  C                   MOVE      'J'           XERLEST           1
N21  C                   END
     C                   ELSE
     C                   MOVE      *BLANKS       RDATA2
     C                   MOVE      'S'           XSLUTTLES         1
     C                   END
     C                   END
     C                   IF        WPOS = 0
     C                   Z-ADD     1             WPOS
     C                   END
NXX   *
NXX  C   50              MOVE      'J'           XSISTBLANK        1
NXX  C  N50              IF        %SUBST(RDATA:1024) = ' '
NXX  C                   MOVE      'J'           XSISTBLANK
NXX  C                   ELSE
NXX  C                   MOVE      'N'           XSISTBLANK
NXX  C                   END
      *
     C                   ENDSR
      *
      *__________________________________________________________
      * SR for å hente neste tag                           LESTAG
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     LESTAG        BEGSR
      * Les til først <
     C     STLESTAG      TAG
     C                   DOW       IN(WPOS) <> '<'
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
     C                   ADD       1             WPOS
     C     XSLUTTLES     CABEQ     'J'           SLLESTAG
     C                   ENDDO
      *
     C                   ADD       1             WPOS
     C                   IF        IN(WPOS) = '/'
     C                   GOTO      STLESTAG
     C                   END
      *
      * Les til først > ELLER blank
     C                   SUB       1             WPOS
     C                   MOVE      *BLANKS       XTXT
     C                   MOVE      *ZEROS        XN                4 0
     C                   DOW       IN(WPOS) <> '>'
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C     XSLUTTLES     CABEQ     'J'           SLLESTAG
     C                   END
     C                   ADD       1             XN
     C                   MOVE      IN(WPOS)      XT80(XN)
     C                   ADD       1             WPOS
      *
     C                   IF        IN(WPOS) = *BLANKS
     C                   DOW       IN(WPOS) = *BLANKS
     C                   ADD       1             WPOS
     C                   IF        WPOS > 1024
     C                   SUB       1024          WPOS
     C                   EXSR      LESREC
     C                   END
     C                   ENDDO
     C                   LEAVE
     C                   END
      *
     C                   ENDDO
      *
     C                   IF        IN(WPOS) = '>'
     C                   ADD       1             XN
     C                   MOVE      IN(WPOS)      XT80(XN)
     C                   ADD       1             WPOS
     C                   END
      *
N02  C                   MOVEL     XTXT          XAN04             4
N02  C     XAN04         CABEQ     '<!--'        STLESTAG
     C                   MOVEL     XTXT          XXTAG            50
S02  C*    XXTAG         CABEQ     '<!--'        STLESTAG
      *
     C     SLLESTAG      ENDSR
      *
N07   *__________________________________________________________
N07   * SR SKAL SJEKKE OM OPPDRAG SKAL OPPDATERING         LESTAG
N07   *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
N07  C     SJEKKOPD      BEGSR
N07  C                   MOVE      FSKODE        XFSKODE           3
N07  C                   MOVE      FSSOK         XFSSOK           35
N07  C                   MOVEL     S0004         FS1_2FSSOK
N07  C                   MOVEL     FSSOK         XAN20            20
N07  C                   MOVE      XAN20         FS1_2FSSOK
N07  C                   MOVE      '-I'          XAUTOTYP          2            REJECTED
N07   *
N07  C     FRISOL01K2    CHAIN     FRISOL01                           33
N08  C                   DOW       *IN33 = *OFF
N08  C     HEADFK        CHAIN     HEADF                              34
N08  C                   IF        DRI_HEST <> 'S'
N08  C                   LEAVE
N08  C                   END
N08  C     FRISOL01K2    READE     FRISOL01                               33
N08  C                   ENDDO
N08   *
N07  C                   SELECT                                                 1<-B
N07  C                   WHEN      (*IN33 AND (XCOLLA = 'Booking'))             1
N07  C                   EVAL      FSKODE = 'INB'
N07  C                   EVAL      FSSOK  = FS1_2FSSOK
N07  C                   WRITE     FRISOKR
N07  C                   WHEN      (*IN33 AND (XCOLLA = 'Instruction'))         1
N07  C                   EVAL      FSKODE = 'INB'
N07  C                   EVAL      FSSOK  = FS1_2FSSOK
N07  C                   WRITE     FRISOKR
N07  C                   EVAL      FSKODE = 'INS'
N07  C                   WRITE     FRISOKR
N07  C                   WHEN      ((*IN33=*OFF) AND (XCOLLA='Instruction'))    1
N07  C     FRISOL01K3    CHAIN     FRISOL01                           33
N07  C                   IF        *IN33                                         2<-B
N07  C     FERDL01K      SETLL     FERDL01
N07  C     FERDL01K      READE     FERDL01                                33
N07  C                   IF        *IN33                                          3<-B
N07  C                   EVAL      FSKODE = 'INS'
N07  C                   EVAL      FSSOK  = FS1_2FSSOK
N07  C                   WRITE     FRISOKR
N07  C                   EVAL      XAUTOOPD = 'J'
N07  C                   MOVE      FS1_FSAVD     FS1_XFSAVD        4 0
N07  C                   MOVE      FS1_FSOPD     FS1_XFSOPD        7 0
N07  C                   ELSE                                                     3
N08  C                   EVAL      FSKODE = 'INS'
N08  C                   EVAL      FSSOK  = FS1_2FSSOK
N08  C                   WRITE     FRISOKR
N07  C                   EVAL      FSKODE = 'SLT'
N07  C                   EVAL      FSSOK  = 'Oppdraget er fakturert'
N07  C                   WRITE     FRISOKR
N07  C                   EVAL      XAUTOTYP = '-R'                              REJECTED
N07  C                   END                                                      3<-E
N07  C                   ELSE                                                    2
N07  C                   EVAL      FSKODE = 'SLT'
N07  C                   EVAL      FSSOK  = 'Oppdraget er oppdatert med INS'
N07  C                   WRITE     FRISOKR
N07  C                   EVAL      XAUTOTYP = '-R'                              REJECTED
N07  C                   END                                                     2<-E
N07  C                   ENDSL                                                  1<-E
N07   *
N07  C                   MOVE      XFSKODE       FSKODE
N07  C                   MOVE      XFSSOK        FSSOK
N07   *
N07  C                   ENDSR
N07   *
N58   *__________________________________________________________
N58   * SR OPPDATE OPPDRAG DIREKTE PÅ HEADF
N58   *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
N58  C     SROXP         BEGSR
N58   *
N58  C     ZEADL01K      CHAIN     ZEADL01                            33
N58  C     EDIAVDK       KLIST
N58  C                   KFLD                    EATERM
N58  C                   KFLD                    HESDF
N58  C                   EVAL      EATERM = 'OXP'
N58   *
N58   * SJEKK FRA OG TIL STED ER INNE EN STEDSINTERVAL
N58  C     EDIAVDK       SETLL     EDIAVD
N58  C                   READP     EDIAVD                                 33
N58  C                   DOW       *IN33 = *OFF
N58  C  N33EAPNF1        COMP      HESDF                              33
N58  C  N33              IF        EAPNF2 < HESDF OR
N58  C                             EAPNT1 > HESDF OR EAPNF2 < HESDF
N58  C                   READE     EDIAVD                                 33
N58  C                   ELSE
N58   * OPPDTER AVDELING HVIS INTERVAL FINNES
N58  C                   EVAL      HEAVD  = EAAVD
N58  C                   LEAVE
N58  C                   END
N58  C                   ENDDO
N58  C                   UPDATE    HEADFR
N58   * KALL PROGRAM FOR OPPDATERING FRA Z-FILER TIL PRODUKSJONSFILER
N58  C                   IF        *IN33 = *OFF
N58  C                   MOVE      HEUNIK        UUNIK             9
N58  C                   CALL      'SYXML13D'
N58  C                   PARM                    HEREFF
N58  C                   PARM                    UUNIK
N58  C                   PARM                    XCOLLA
N58  C                   END
N58   *
N58  C                   ENDSR
N58   *
      *////////////////////////////////////////////////////////////
      * SR for init                                        SRINIT /
      *////////////////////////////////////////////////////////////
     C     SRINIT        BEGSR
     C     ECMSG3K       KLIST
     C                   KFLD                    ECSR
     C                   KFLD                    EC0065
     C                   KFLD                    EC0054
     C                   KFLD                    S0004
     C                   KFLD                    S0010
     C     ZEADL01K      KLIST
     C                   KFLD                    HEREFF
     C                   KFLD                    HEUNIK
N47  C     ZRISOL02K     KLIST
N47  C                   KFLD                    HEUNIK
N47  C                   KFLD                    HEREFF
N47  C                   KFLD                    ZS2_FSKODE
N47  C                   MOVE      'IFB'         ZS2_FSKODE
N08  C     HEADFK        KLIST
N08  C                   KFLD                    FS1_FSAVD
N08  C                   KFLD                    FS1_FSOPD
N02  C     CUNDL01K      KLIST
N02  C                   KFLD                    FIFIRM
N02  C                   KFLD                    ECCNO
N14  C     CUNDL01K2     KLIST
N14  C                   KFLD                    FIFIRM
N14  C                   KFLD                    KUKUN2
N14  C     VADRK         KLIST
N14  C                   KFLD                    FIFIRM
N14  C                   KFLD                    KUKUN2
N14  C                   KFLD                    KUVADR
N14  C     KUNKO2K       KLIST
N14  C                   KFLD                    ECCNO
N14  C                   KFLD                    XXPARTYID
     C     FRISOL01K     KLIST
     C                   KFLD                    FS1_FSKODE
     C                   KFLD                    FS1_FSSOK
N07  C     FRISOL01K2    KLIST
N07  C                   KFLD                    FS1_2FSKODE       3
N07  C                   KFLD                    FS1_2FSSOK       35
N07  C     FRISOL01K3    KLIST
N07  C                   KFLD                    FS1_3FSKODE       3
N07  C                   KFLD                    FS1_2FSSOK
N07  C     FERDL01K      KLIST
N07  C                   KFLD                    FS1_FSAVD
N07  C                   KFLD                    FS1_FSOPD
N29  C     SYPARL1K      KLIST
N29  C                   KFLD                    SYKUNR
N29  C                   KFLD                    SYPAID
N29  C     SYPARL3K      KLIST
N29  C                   KFLD                    SYPAID
N29  C                   KFLD                    SYVRDA
      *
     C     *ENTRY        PLIST
     C                   PARM                    WLIB             10
     C                   PARM                    WFIL             10
     C                   PARM                    WMBR             10
      *
     C                   MOVE      'R'           ECSR
     C                   MOVE      'XMLINH'      EC0065
     C                   MOVE      '1.1'         EC0054
     C                   MOVE      *ZEROS        XMDT
     C                   MOVE      *ZEROS        XMTM
NC   C                   MOVE      *BLANKS       XMSGTXT         150
     C                   MOVE      'IFB'         FS1_FSKODE
N07  C                   MOVE      'INB'         FS1_2FSKODE
N07  C                   MOVE      'INS'         FS1_3FSKODE
     C                   BITON     '123457'      XAPOS             1
     C                   BITOFF    '06'          XAPOS
      *
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
      *
     C                   ENDSR
      *
NC    *////////////////////////////////////////////////////////////
NC    * SR for håndtering av feil                           *PSSR /
NC    *////////////////////////////////////////////////////////////
NC   C     *PSSR         BEGSR
NC   C                   EVAL      XMSGTXT = 'SYNTAKS AV XML ER FEIL.'
NC   C                   EXSR      SRERROR
NC    *
NC   C                   ENDSR     '*CANCL'
NC    *
NC    *////////////////////////////////////////////////////////////
NC    * SR for håndtering av feil                         SRERROR /
NC    *////////////////////////////////////////////////////////////
NC   C     SRERROR       BEGSR
NC   C                   CALL      'SYGE15C'
NC   C                   PARM                    WDT               8
NC   C                   PARM                    WTM               6
NC   C                   MOVE      WDT           XDT               8 0
NC   C                   MOVE      WTM           XTM               6 0
NC   C                   EVAL      XMSG = 'FEIL I BOOKING/INSTRUCTION. '
NC   C                             + 'PROGRAM = SYXML13, '
NC   C                             + 'FILNAVN = EDIRE1K, '
NC   C                             + 'KOMPONENT = ' + %TRIM(WMBR) + ', '
NC   C                             + 'DATO = ' + %TRIM(%EDITW(XDT:'    .  .  '))
NC   C                             + ', '
NC   C                             + 'TID = ' + %TRIM(%EDITW(XTM:'  :  :  '))
NC   C                             + '. '
NC   C                             + %TRIM(XMSGTXT)
NC   C                   CALL      'EDIERRC'
NC   C                   PARM                    XMSG            256
NC    *
NC   C                   ENDSR
NC    *
NC    *////////////////////////////////////////////////////////////
NC    * SR for håndtering av feil                         SRERROR /
NC    *////////////////////////////////////////////////////////////
NC   C     SRERROR2      BEGSR
NC   C                   CALL      'SYGE15C'
NC   C                   PARM                    WDT               8
NC   C                   PARM                    WTM               6
NC   C                   MOVE      WDT           XDT               8 0
NC   C                   MOVE      WTM           XTM               6 0
NC   C                   EVAL      XMSG = 'MINST ET OPPDRAG IKKE KONV. '
NC   C                             + 'PROGRAM = SYXML13, '
NC   C                             + 'FILNAVN = EDIRE1K, '
NC   C                             + 'KOMPONENT = ' + %TRIM(WMBR) + ', '
NC   C                             + 'DATO = ' + %TRIM(%EDITW(XDT:'    .  .  '))
NC   C                             + ', '
NC   C                             + 'TID = ' + %TRIM(%EDITW(XTM:'  :  :  '))
NC   C                             + '. '
NC   C                             + %TRIM(XMSGTXT)
NC   C                   CALL      'EDIERRC2'
NC   C                   PARM                    XMSG            256
NC    *
NC   C                   ENDSR
NC    *
