********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 rettet feil i dette program
10XXX * 02 SH  PTF10 arc009cl nye parametre
10XXX * 03 SH  PTF10 merge J/N
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11XXX * 04 YBC PTF11 SEND SAD TIL EMMA PÅ NYTT VED NY DOKUMENT
11XXX * 05 YBC PTF11 ARC009CL HAR FÅTT 4 EKSTRA PARAMTRE
11XXX * 06 SH  PTF11 EVT SENDE TIL FLERE
11XXX * 07 SH  PTF12 feil ved resend
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
12197 * 08 YBC PTF12 Proteria er på samme måte som EMMA
12197 * 09 SH  PTF12 rettelse 06/09
12197 * 10 SH  PTF12 tekst ettersending scannet vedlegg
12197 * 11 SH  PTF12 ettersending til faktura/samlefaktura
12197 * 12 SH  PTF12 kutter ut kall på arc002v
12197 *              skrivern isteden rett til arkepo
12197 * 13 SH  PTF12 innparametre alfa
********************************************************************
      *
N03  Ffirmarc   IF   E           K DISK
     FSADH      IF   E           K DISK
     FSAEH      IF   E           K DISK
     FARUSERL1  IF   E           K DISK
     FARKTXT    IF   E           K DISK
     FARKEPO    UF A E           K DISK
     Ffirm      IF   E           K DISK
     FARKIVL02  IF   E           K DISK
     FARKIVL13  IF   E           K DISK
     F                                     RENAME(arkivr:ark13)
     FARKVEDK   IF   E           K DISK
     FCUNDC03   IF   E           K DISK
N04  FEDIM2     IF   E           K DISK
     D                SDS
     D  UUSR                 254    263
     D                 DS
     D  uuvedl                 1     60
     D  V01                    1      2
     D  V02                    3      4
     D  V03                    5      6
     D  V04                    7      8
     D  V05                    9     10
     D  V06                   11     12
     D  V07                   13     14
     D  V08                   15     16
     D  V09                   17     18
     D  V10                   19     20
     D  V11                   21     22
     D  V12                   23     24
     D  V13                   25     26
     D  V14                   27     28
     D  V15                   29     30
     D  V16                   31     32
     D  V17                   33     34
     D  V18                   35     36
     D  V19                   37     38
     D  V20                   39     40
     D  V21                   41     42
     D  V22                   43     44
     D  V23                   45     46
     D  V24                   47     48
     D  V25                   49     50
     D  V26                   51     52
     D  V27                   53     54
     D  V28                   55     56
     D  V29                   57     58
     D  V30                   59     60
     D  ako                    1     60
     D                                     DIM(30)
      *
     C     *entry        plist
S13  c*                  parm                    avd               4 0
N13  c                   parm                    avdALF            4
S13  c*                  parm                    opd               7 0
N13  c                   parm                    opdALF            7
     c                   parm                    typein            2
S13  C*                  PARM                    UdatO             8 0
n13  C                   PARM                    UdatOALF          8
     C                   PARM                    ULINK            40
N13  C                   MOVE      AVDALF        AVD               4 0
N13  C                   MOVE      OPDALF        OPD               7 0
N13  C                   MOVE      UDATOALF      UDATO             8 0
n13  C                   MOVE      UDATO         ARDATEI
n13  C                   MOVE      ULINK         ARLINKI
      *
     C                   READ      FIRM                                   33
      *
N03  C                   READ      FIRMARC                                33
n12  c                   move      uusr          epuser
      *
     C     KEYVED        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    ARKUND
     C                   KFLD                    ARTYPE
     c     mailk         klist
     c                   kfld                    fifirm
     c                   kfld                    mail30
     c                   kfld                    tuknt             8 0
     C     KEYHEA        KLIST
     C                   KFLD                    ARAVD
     C                   KFLD                    AROPD
      *
     c     key           klist
     c                   kfld                    stat              1
     c                   kfld                    avd
     c                   kfld                    opd
     c                   kfld                    artype            2
     c                   move      'A'           stat              1
N12  c     key13         klist
N12  c                   kfld                    ardatei           8 0
N12  c                   kfld                    arlinki          40
      *
      * import
      *
     c                   move      'si'          artype
     c     key           chain     ARKIVL02                           33
     c  N33keyhea        chain     sadh                               33
     C  N33              MOVE      'I'           TDTYP             1
      *
      * eksport
      *
     c     *in33         ifeq      '1'
     c                   move      'se'          artype
     c     key           chain     ARKIVL02                           33
     c  N33keyhea        chain     saeh                               33
     C  N33              MOVE      'E'           TDTYP             1
     c                   end
     c  N33              exsr      Pdfsad
N11   *
N11   * faktura
N11   *
N11  c     *in33         ifeq      '1'
N11  c                   move      'fa'          artype
N11  c     key           chain     ARKIVL02                           33
N11  c   33              move      'fs'          artype
N11  c   33key           chain     ARKIVL02                           33
N11  c     *in33         ifeq      '0'
N11  c                   exsr      pdffak
N11  c                   end
N11  c                   end
     C                   SETON                                        LR
     C***********************************************
     C     PDFSad        BEGSR
     C***********************************************
     C     ARTYPE        CHAIN     ARKTXT                             33
     c                   move      arkund        tuknt
      * SKJEKK OM AVTALE OM VEDLEGG
N01  C                   MOVE      ARKVED        uuvedl
     C     KEYVED        CHAIN     ARKVEDK                            33
     C     *IN33         IFEQ      '0'
N01  C                   MOVE      AVKVED        uuvedl
N01  C                   END
N01  C     UUVEDL        IFNE      *blanks
     C     TYPEIN        LOOKUP    ako                                    30
S01  C* N30              DO
N01  C   30              DO
      *
S01  C*    *IN33         IFEQ      '0'
N04   * SJEKK OM SAD ER SENDT TIL EMMA FØR
N04  C     KEYHEA        SETLL     EDIM2
N04  C     KEYHEA        READE     EDIM2                                  44
N04  C                   DOW       *IN44 = *OFF
N04  C                   IF        M0010 = 'EMMA' OR M0065 = 'XMLEMA'
N08  C                             OR M0010 = 'PROTERIA'
N04  C                   LEAVE
N04  C                   END
N04  C     KEYHEA        READE     EDIM2                                  44
N04  C                   ENDDO
N04   *
N04  C                   IF        *IN44 = *OFF
N04  C                   MOVE      ARAVD         AAVD              4
N04  C                   MOVE      AROPD         AOPD              7
N04  C                   CALL      'PDF001CL3'
N04  C                   PARM                    AAVD
N04  C                   PARM                    AOPD
N04  C                   PARM                    TDTYP
N04  C                   END
N04   *
     C
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c                   setoff                                       44
S06  c*    mailk         chain     cundc03                            44
N06  c     mailk         SETLL     cundc03
S06  c*    *in(44)       ifeq      '0'
N06  c     *in(44)       DOWEQ     '0'
N06  c     mailk         READE     cundc03                                44
N06  C     *IN44         IFEQ      '0'
N04  c     CCONTA        ANDNE     'EMMA-XML'
S09  C*    *IN44         OREQ      '0'
N08  c     CCONTA        ANDNE     'PROTERIA-XML'
      *
N03  C     CMERGE        IFNE      ' '
N03  C                   MOVE      CMERGE        ARCMRG
N03  C                   END
      * coverpage
      *
N10  C                   eval      wscvp2='ettersending scannet vedlegg'
     C                   move      *blanks       wscvp1
     C                   eval      wscvp1='Tolldokument:'
     C     TDTYP         IFEQ      'I'
     C     wscvp1        cat       SITLE:1       wscvp1
     C     wscvp1        cat       SITLL:0       wscvp1
     c                   else
     C     wscvp1        cat       SETLE:1       wscvp1
     C     wscvp1        cat       SETLL:0       wscvp1
     c                   end
     C                   MOVE      ARAVD         AAVD              4
     C                   MOVE      AROPD         AOPD              7
     C     CEMAIL        CHAIN     ARUSERL1                           33
s12  C*                  CALL      'ARC002V'
s12  C*                  PARM                    ARTYPE
s12  C*                  PARM                    Aavd
s12  C*                  PARM                    Aopd
s12  C*                  PARM                    ARKVED
s12  C*                  PARM                    CLIVE
s12  C*                  PARM                    arinek
s12  C*                  PARM                    tuknt
n12  c                   exsr      srepo
N12  C     *IN55         IFEQ      '0'
      *
N02  C                   MOVE      tuknt         AKUN              8
N02  C                   MOVE      *ZEROS        ATUR              8
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           80
S07  c*                  parm                    wscvp2           40
S07  c*                  parm                    wscvp3           40
S07  c*                  parm                    wscvp4           40
S07  c*                  parm                    wscvp5           40
S07  c*                  parm                    wscvp6           40
S07  C*                  parm                    wscvp7           40
S07  c*                  parm                    wscvp8           40
S07  c*                  parm                    wscvp9           40
S07  c*                  parm                    wscvp10          40
S07  c*                  parm                    wscvp11          40
S07  C*                  parm                    wscvp12          40
N07  c                   parm                    wscvp2           80
N07  c                   parm                    wscvp3           80
N07  c                   parm                    wscvp4           80
N07  C                   parm                    wscvp5           80
N07  C                   parm                    wscvp6           80
N07  C                   parm                    wscvp7           80
N07  C                   parm                    wscvp8           80
N07  C                   parm                    wscvp9           80
N07  C                   parm                    wscvp10          80
N07  C                   parm                    wscvp11          80
N07  C                   parm                    wscvp12          80
     C                   parm                    ARINEK
N02  C                   PARM                    AAVD
N02  C                   PARM                    AOPD
N02  C                   PARM                    ATUR              8
N02  C                   PARM                    AKUN              8
N03  C                   PARM                    ARCMRG            1
     c                   eval      wscvp3 = '.'
s01  c*                  end
     c                   end
     c                   end
     c                   end
     c                   end
n12  c                   end
     C                   ENDSR
     C*
N11  C***********************************************
N11  C     PDFFAK        BEGSR
N11  C***********************************************
N11  C     ARTYPE        CHAIN     ARKTXT                             33
N11  c                   move      arkund        tuknt
N11   * SKJEKK OM AVTALE OM VEDLEGG
N11  C                   MOVE      ARKVED        uuvedl
N11  C     KEYVED        CHAIN     ARKVEDK                            33
N11  C     *IN33         IFEQ      '0'
N11  C                   MOVE      AVKVED        uuvedl
N11  C                   END
N11  C     UUVEDL        IFNE      *blanks
N11  C     TYPEIN        LOOKUP    ako                                    30
N11   *
N11   * SKAL SENDE DENNE TYPEN MED FAKTURA
N11   *
N11  C   30              DO
N11   *
N11  C
N11  C                   MOVE      ARTXT         MAIL16           16
N11  C                   MOVEL     '*'           MAIL16
N11  c                   movel     MAIL16        mail30           30
N11  c                   moveL     artxt         wstex1           30
N11  c                   setoff                                       44
N11  c     mailk         SETLL     cundc03
N11  c     *in(44)       DOWEQ     '0'
N11  c     mailk         READE     cundc03                                44
N11  C     *IN44         IFEQ      '0'
N11  C     CMERGE        IFNE      ' '
N11  C                   MOVE      CMERGE        ARCMRG
N11  C                   END
N11   * coverpage
N11   *
N11  C                   eval      wscvp2='Vedlegg scannet etter faktura sendt'
N11  C                   move      *blanks       wscvp1
N11  C                   eval      wscvp1='Ettersending til fakturanr:'
N11  C     wscvp1        cat       ARUNDE:1      wscvp1
N11  C     wscvp1        cat       'Fra:':1      wscvp1
N11  C     wscvp1        cat       FIFT:1        wscvp1
N11  C                   MOVE      ARAVD         AAVD              4
N11  C                   MOVE      AROPD         AOPD              7
N11  C     CEMAIL        CHAIN     ARUSERL1                           33
s12  C*                  CALL      'ARC002V'
s12  C*                  PARM                    ARTYPE
s12  C*                  PARM                    Aavd
s12  C*                  PARM                    Aopd
s12  C*                  PARM                    ARKVED
s12  C*                  PARM                    CLIVE
s12  C*                  PARM                    arinek
s12  C*                  PARM                    tuknt
n12  c                   exsr      srepo
N11   *
N12  C     *IN55         IFEQ      '0'
N11  C                   MOVE      tuknt         AKUN              8
N11  C                   MOVE      *ZEROS        ATUR              8
     c                   return
N11  c                   call      'ARC009CL'
N11  c                   parm                    CEMAIL
N11  c                   parm                    wscvp1           80
N11  c                   parm                    wscvp2           80
N11  c                   parm                    wscvp3           80
N11  c                   parm                    wscvp4           80
N11  C                   parm                    wscvp5           80
N11  C                   parm                    wscvp6           80
N11  C                   parm                    wscvp7           80
N11  C                   parm                    wscvp8           80
N11  C                   parm                    wscvp9           80
N11  C                   parm                    wscvp10          80
N11  C                   parm                    wscvp11          80
N11  C                   parm                    wscvp12          80
N11  C                   parm                    ARINEK
N11  C                   PARM                    AAVD
N11  C                   PARM                    AOPD
N11  C                   PARM                    ATUR              8
N11  C                   PARM                    AKUN              8
N11  C                   PARM                    ARCMRG            1
N11  c                   end
N11  c                   end
N11  c                   end
N11  c                   end
N12  c                   end
N11  C                   ENDSR
n12   *******************************************************************
n12  c     srepo         begsr
n12   *******************************************************************
n12  c                   move      typein        artype
n12  c                   move      *blanks       ubane            50
n12  c                   move      *blanks       ubanel           76
N12  C     KEY13         CHAIN     ARKIVL13                           55
N12  C     *IN44         IFEQ      '0'
n12  C                   exsr      fixbane
n12   * tester om vedlegg finnes
n12  C                   move      *blanks       nyobj            50
n12  C                   move      *blanks       ubanet          256
n12  c                   eval      ubanet=ubane
n12  C                   eval      nyobj=arlink
n12  C     '.'           SCAN      nyobj                                  44
n12  c  N44nyobj         CAT       '.pdf':0      nyobj
n12  c                   call      'SYGE98CL'
n12  C                   PARM                    ubanet
n12  C                   PARM                    nyobj
n12  c                   parm                    fins              1
n12  c                   move      'N'           epmain
n12  c     fins          ifeq      'J'
n12  c                   exsr      fixlink2
n12  c                   write     arkepor
n12  c                   end
n12  c                   end
n12   *
n12  c                   endsr
n12   *
n12   **********************************************************************************
n12  c     fixbane       begsr
n12   **********************************************************************************
n12  c     arbhis        ifne      *blanks
n12  c                   eval      arcane=arbhis
n12  c                   end
n12  c                   move      *blanks       ubane
n12  c                   movel     '/'           ubane
n12  c     arcane        ifne      *blanks
n12  C     ubane         CAT       arcane:0      ubane
n12  C     ubane         CAT       '/':0         ubane
n12  c                   end
n12  C     ubane         CAT       arlink:0      ubane
n12  C     ARKLAG        IFeq      *blanks
n12  c
n12  C     '.'           SCAN      ubane                                  44
n12  c  N44ubane         CAT       '.pdf':0      ubane
n12  c                   end
n12  c                   eval      epbane=ubane
n12  c                   endsr
n12   **********************************************************************************
n12  c     fixlink2      begsr
n12   **********************************************************************************
n12  c     arbhis        ifne      *blanks
n12  c                   eval      arcane=arbhis
n12  c                   end
n12   *
n12   * intern
n12   *
n12  c                   move      *blanks       eplink
n12  c                   move      *blanks       epline
n12   *
n12  c                   movel     'http://'     eplink
n12  c                   if        ARCPSI='J'
n12  c                   eval      eplink = 'https://'
n12  c                   endif
n12  C     eplink        CAT       arcpad:0      eplink
n12  C     eplink        CAT       '/':0         eplink
n12  C     eplink        CAT       arcane:0      eplink
n12  C     eplink        CAT       '/':0         eplink
n12  C     eplink        cat       arlink:0      eplink
n12  C     '.'           SCAN      eplink                                 44
n12  c  N44eplink        CAT       '.pdf':0      eplink
n12   *
n12   * ekstern
n12   *
n12  c                   movel     'http://'     epline
n12  c                   if        ARCPSE='J'
n12  c                   eval      epline = 'https://'
n12  c                   endif
n12  C     epline        CAT       arcpae:0      epline
n12  C     epline        CAT       '/':0         epline
n12  C     epline        CAT       arcane:0      epline
n12  C     epline        CAT       '/':0         epline
n12  C     epline        cat       arlink:0      epline
n12  C     '.'           SCAN      epline                                 44
n12  c  N44epline        CAT       '.pdf':0      epline
n12  c                   endsr
n12   *
n12   *
