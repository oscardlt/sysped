********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX * 01 SH  PTF11 Backuptid i mappe BACKUP
********************************************************************
     FEDI33D    CF   E             WORKSTN
     FEDIC      UF   E             DISK
     D                 DS
     D  DSTM                   1      6
     D  DSTMH                  1      2
     D  DSTMM                  3      4
     D  DSTMS                  5      6
     D EDIDTA          DS           256
     D  UDEV1                  2     11
     D  UDEV2                 12     21
     D  UDEV3                 22     31
     D  UDEV4                 32     41
     D  UDEV5                 42     51
     D  UDEV6                 52     61
     D  ULIND                 62     71
     D  UCTLD                 72     81
     D  UDEVD                 82     91
     D  UIBSTR               154    159
     D  UIBEND               160    165
     D  UIBDLY               166    170
     D  UELIBF               171    180
     D  UELIBO               181    190
     D  UESYSP               191    191
     D  UETDV                192    192
     D  UEL1                 193    193
     D  UEL1FI               194    195
     D  UCLRF                196    196
     D  UTOTM                197    201  0
N10  D  UIFSD                202    206
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
     C                   OUT       EDIDTA
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    ZDEV1         WDEV
     C     *LIKE         DEFINE    *IN30         WIN30
     C     *DTAARA       DEFINE                  EDIDTA
      *_________________
      * Output paramtrer
      *"""""""""""""""""
     C     PLISTC        PLIST
     C                   PARM      WDEV          WDEV
     C     *IN30         PARM                    WIN30
     C                   PARM      OBJTYP        OBJTYP           10
     C                   MOVEL     '*MSGQ'       OBJTYP
      *__________________
      * Hente firmarecord
      *""""""""""""""""""
     C     1             CHAIN     EDIC                               51
     C                   Z-ADD     CSN           ZSN
     C                   Z-ADD     CMN           ZMN
      *_______________
      * Hente dataarea
      *"""""""""""""""
     C     *LOCK         IN        EDIDTA
     C                   MOVE      UDEV1         ZDEV1
     C                   MOVE      UDEV2         ZDEV2
     C                   MOVE      UDEV3         ZDEV3
     C                   MOVE      UDEV4         ZDEV4
     C                   MOVE      UDEV5         ZDEV5
     C                   MOVE      UDEV6         ZDEV6
     C                   MOVE      ULIND         ZLIND
     C                   MOVE      UCTLD         ZCTLD
     C                   MOVE      UDEVD         ZDEVD
     C                   MOVE      UIBSTR        ZIBSTR
     C                   MOVE      UIBEND        ZIBEND
     C                   MOVE      UIBDLY        ZIBDLY
     C                   MOVE      UELIBF        ZELIBF
     C                   MOVE      UELIBO        ZELIBO
     C                   MOVE      UESYSP        ZESYSP
     C                   MOVE      UETDV         ZETDV
     C                   MOVE      UEL1          ZEL1
     C                   MOVE      UEL1FI        ZEL1FI
     C                   MOVE      UCLRF         ZCLRF
     C                   MOVE      UTOTM         ZTOTM
N01  C     UIFSD         ifeq      '     '
N01  C                   Z-add     7             ZIFSD
N01  c                   else
N01  C                   MOVE      UIFSD         ZIFSD
N01  C                   END
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Oppdatere firmaopplysninger                          SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
      *
     C     SRB1          TAG
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     EDI33DØ
     C                   EXFMT     EDI33DA
     C                   MOVE      '0'           *IN30
     C                   MOVEA     '00000000'    *IN(32)
     C                   MOVEA     '000'         *IN(40)
     C                   MOVEA     '000'         *IN(46)
     C     *IN03         CABEQ     '1'           SRB9
     C     *IN12         CABEQ     '1'           SRB9
      * Sendningsnummer får ikke vare lavere en forrige.
     C     ZSN           IFLT      CSN
     C                   MOVE      'SPS0010'     ZMSGNO
     C                   GOTO      SRB1
     C                   END
      * Meldingsnummer får ikke vare lavere en forrige.
     C     ZMN           IFLT      CMN
     C                   MOVEA     '1001'        *IN(30)
     C                   MOVE      'SPM0002'     ZMSGNO
     C                   GOTO      SRB1
     C                   END
      * Finnes enhet ?
     C     ZDEV1         IFNE      *BLANKS
     C                   MOVE      ZDEV1         WDEV
     C                   CALL      'EDI33C'      PLISTC
     C     *IN30         IFEQ      '1'
     C                   MOVE      '1'           *IN34
     C                   MOVE      'JOV0407'     ZMSGNO
     C                   GOTO      SRB1
     C                   END
     C                   END
      *
     C     ZDEV2         IFNE      *BLANKS
     C                   MOVE      ZDEV2         WDEV
     C                   CALL      'EDI33C'      PLISTC
     C     *IN30         IFEQ      '1'
     C                   MOVE      '1'           *IN35
     C                   MOVE      'JOV0407'     ZMSGNO
     C                   GOTO      SRB1
     C                   END
     C                   END
      *
     C     ZDEV3         IFNE      *BLANKS
     C                   MOVE      ZDEV3         WDEV
     C                   CALL      'EDI33C'      PLISTC
     C     *IN30         IFEQ      '1'
     C                   MOVE      '1'           *IN36
     C                   MOVE      'JOV0407'     ZMSGNO
     C                   GOTO      SRB1
     C                   END
     C                   END
      *
     C     ZDEV4         IFNE      *BLANKS
     C                   MOVE      ZDEV4         WDEV
     C                   CALL      'EDI33C'      PLISTC
     C     *IN30         IFEQ      '1'
     C                   MOVE      '1'           *IN37
     C                   MOVE      'JOV0407'     ZMSGNO
     C                   GOTO      SRB1
     C                   END
     C                   END
      *
     C     ZDEV5         IFNE      *BLANKS
     C                   MOVE      ZDEV5         WDEV
     C                   CALL      'EDI33C'      PLISTC
     C     *IN30         IFEQ      '1'
     C                   MOVE      '1'           *IN38
     C                   MOVE      'JOV0407'     ZMSGNO
     C                   GOTO      SRB1
     C                   END
     C                   END
      *
     C     ZDEV6         IFNE      *BLANKS
     C                   MOVE      ZDEV6         WDEV
     C                   CALL      'EDI33C'      PLISTC
     C     *IN30         IFEQ      '1'
     C                   MOVE      '1'           *IN39
     C                   MOVE      'JOV0407'     ZMSGNO
     C                   GOTO      SRB1
     C                   END
     C                   END
      * Linedescription
     C     ZLIND         IFEQ      *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN40
     C                   MOVE      'CBA0010'     ZMSGNO
     C                   GOTO      SRB1
     C                   END
      * Controllerdescription
     C     ZCTLD         IFEQ      *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN41
     C                   MOVE      'CBA0020'     ZMSGNO
     C                   GOTO      SRB1
     C                   END
      * Starttid for POLLING.
     C     ZIBSTR        IFNE      '*IMMED'
     C                   MOVE      ZIBSTR        DSTM
     C     DSTMH         COMP      '00'                                 30
     C  N30DSTMH         COMP      '23'                               30
     C  N30DSTMM         COMP      '00'                                 30
     C  N30DSTMM         COMP      '59'                               30
     C  N30DSTMS         COMP      '00'                                 30
     C  N30DSTMS         COMP      '59'                               30
     C   30              MOVE      '1'           *IN46
     C   30              MOVE      'SPT0120'     ZMSGNO
     C   30              GOTO      SRB1
     C                   END
      * Sluttid for POLLING.
     C     ZIBEND        IFNE      '*NONE '
     C                   MOVE      ZIBEND        DSTM
     C     DSTMH         COMP      '00'                                 30
     C  N30DSTMH         COMP      '23'                               30
     C  N30DSTMM         COMP      '00'                                 30
     C  N30DSTMM         COMP      '59'                               30
     C  N30DSTMS         COMP      '00'                                 30
     C  N30DSTMS         COMP      '59'                               30
     C   30              MOVE      '1'           *IN47
     C   30              MOVE      'SPT0130'     ZMSGNO
     C   30              GOTO      SRB1
     C                   END
      * Oppdatere record:
     C                   Z-ADD     ZSN           CSN
     C                   Z-ADD     ZMN           CMN
     C                   UPDATE    EDICR
      * Oppdatere dataarea
     C                   MOVE      ZDEV1         UDEV1
     C                   MOVE      ZDEV2         UDEV2
     C                   MOVE      ZDEV3         UDEV3
     C                   MOVE      ZDEV4         UDEV4
     C                   MOVE      ZDEV5         UDEV5
     C                   MOVE      ZDEV6         UDEV6
     C                   MOVE      ZLIND         ULIND
     C                   MOVE      ZCTLD         UCTLD
     C                   MOVE      ZDEVD         UDEVD
     C                   MOVE      ZIBSTR        UIBSTR
     C                   MOVE      ZIBEND        UIBEND
     C                   MOVE      ZIBDLY        UIBDLY
     C                   MOVE      ZELIBF        UELIBF
     C                   MOVE      ZELIBO        UELIBO
     C                   MOVE      ZESYSP        UESYSP
     C                   MOVE      ZETDV         UETDV
     C                   MOVE      ZEL1          UEL1
     C                   MOVE      ZEL1FI        UEL1FI
     C                   MOVE      ZCLRF         UCLRF
     C                   MOVE      ZTOTM         UTOTM
     C                   MOVE      ZIFSD         UIFSD
      *
     C     SRB9          ENDSR
