     FECMSG     IF   E           K DISK
     FFIRM      IF   E             DISK
     FEDIC      UF   E             DISK
     FEUNH      O  A E             DISK
     FEDIM      O  A E             DISK
     D                 DS
     D  WTIME                  1     14  0
     D  WTID                   1      6  0
     D  WDD                    7      8  0
     D  WMM                    9     10  0
     D  W≈≈                   11     14  0
     D                 DS
     D  WDATO                  1      8  0
     D  W≈                     1      4  0
     D  WM                     5      6  0
     D  WD                     7      8  0
     D                 DS
     D  W1004                  1     20
     D  WUAVD                  1      4  0
     D  WUPRO                  5     12  0
     D  WUKNA                 13     20  0
     D  WUMN                  21     29  0
     D  WUMNA                 21     29
     D                 DS
     D  W1004B                 1     20
      */////////////
      * MAIN LOGIC /
      */////////////
     C                   EXSR      SRINIT
     C                   EXSR      SRA
     C     *IN41         CASEQ     '1'           SRB
     C                   END
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      * SR for init                                        SRINIT /
      *////////////////////////////////////////////////////////////
     C     SRINIT        BEGSR
      * INPUT PARAMETERS
     C     *ENTRY        PLIST
     C                   PARM                    WMTRKU            8
     C*                  MOVE      WAVD          WUAVD
     C*                  MOVE      WPRO          WUPRO
     C*                  MOVE      WKNA          WUKNA
     C                   Z-ADD     1             WUAVD
     C                   Z-ADD     99999999      WUPRO
     C                   MOVE      WMTRKU        WUKNA
      * HENTE DAGENS DATO OG TID
     C                   TIME                    WTIME
     C                   Z-ADD     W≈≈           W≈
     C                   Z-ADD     WDD           WD
     C                   Z-ADD     WMM           WM
      * INIT AV ARBEIDSFELT
     C     *LIKE         DEFINE    ECSR          WCSR
     C     *LIKE         DEFINE    EC0065        WC0065
     C                   MOVE      'S'           WCSR
     C                   MOVEL     'IFCSUM'      WC0065
     C                   READ      FIRM                                   51
     C     *LIKE         DEFINE    UMN           WMN
      * DEF AV KEYS
     C     ECMKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WUKNA
     C                   KFLD                    WCSR
     C                   KFLD                    WC0065
      * SKAL/BÿR MED TIDEN V∆RE LAGRET P≈ TUR/AGENT-NIV≈
     C                   MOVEL     '40270123'    W1004B
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * SR                                                    SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *__________________________
      * Retreive trip information
      *""""""""""""""""""""""""""
     C                   MOVE      WMTRKU        WUKNA
      *_________________________________
      * Send IFCSUM ? and wich release ?
      *"""""""""""""""""""""""""""""""""
     C     ECMKEY        CHAIN     ECMSG                              51
     C     *IN51         CABEQ     '1'           SRA9
      *________________________
      * Retreive message number
      *""""""""""""""""""""""""
     C     1             CHAIN     EDIC                               51
     C     *IN51         CABEQ     '1'           SRA9
     C                   ADD       1             CMN
     C                   UPDATE    EDICR
     C                   Z-ADD     CMN           WMN
     C                   MOVE      '1'           *IN41
     C     SRA9          ENDSR
      *////////////////////////////////////////////////////////////
      * SR                                                    SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
      *_____________
      * ADD SEGMENTS
      *"""""""""""""
     C                   EXSR      SRBA
     C     WANTO         IFGT      0
     C                   EXSR      UNH00
      *______________
      * WRITE TO EDIM
      *""""""""""""""
     C                   EXSR      TVINM0
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * SR                                                   SRBA /
      *////////////////////////////////////////////////////////////
     C     SRBA          BEGSR
     C                   MOVEL     'E310R_'      WPGM              9
     C                   MOVE      EC0054        WPGM
     C                   Z-ADD     WMN           WUMN
     C                   Z-ADD     0             WANTO             5 0
     C                   CALL      WPGM
     C                   PARM                    WMN
     C                   PARM                    WANTO
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * UNH00                                               UNH00 /
      *////////////////////////////////////////////////////////////
     C     UNH00         BEGSR
     C                   CLEAR                   UNHR
     C                   Z-ADD     WMN           UMN
     C                   MOVEL     WMN           U0062A
     C                   MOVEL     EC0065        U0065
     C                   MOVEL     '1'           U0052
     C                   MOVEL     EC0054        U0054
     C                   MOVEL     'UN'          U0051
     C                   MOVEL     '621'         U1001
     C*                  MOVEL     W1004         U1004
     C                   CALL      'SYGE15'
     C                   PARM                    W1004B
     C**** SENERE....      MOVELW1004B    U1004
     C                   MOVEL     '402'         W1004B           20
     C                   MOVEL     W1004B        U1004
     C     EC0054        IFEQ      '93A'
     C                   MOVEL     'S'           U0052
     C                   MOVEL     '700'         U1001
     C                   ENDIF
     C                   WRITE     UNHR
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * TVINM0                                              TVINM0/
      *////////////////////////////////////////////////////////////
     C     TVINM0        BEGSR
     C                   CLEAR                   EDIMR
     C                   MOVEL     ECIIDI        M0004
     C                   MOVEL     ECIIDC        M0010
     C                   MOVE      '1'           M0035
     C                   MOVEL     U0062A        M0062
     C                   MOVEL     U0065         M0065
     C                   MOVEL     U1004         M0068
     C                   MOVEL     U1001         M1001
     C                   MOVEL     U1004         M1004
     C                   Z-ADD     WMN           MMN
     C                   MOVE      'S'           MSR
     C                   MOVEL     WDATO         MDT
     C                   MOVEL     WTID          MTM
     C                   Z-ADD     WUAVD         MAVD
     C                   WRITE     EDIMR
     C                   ENDSR
