/* DENNE KJØRER EPOST  FAKTURA         */
/*                         */
             PGM        PARM(&AVD &FANR &STMF &BANE &FINS1 &BANES +
                          &FINS2 &INFOP)
             DCL        VAR(&INFOP) TYPE(*CHAR) LEN(1)
             DCL        VAR(&LIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&VISE) TYPE(*CHAR) LEN(1)
             DCL        VAR(&FINS1) TYPE(*CHAR) LEN(1)
             DCL        VAR(&FINS2) TYPE(*CHAR) LEN(1)
             DCL        VAR(&FANR) TYPE(*CHAR) LEN(7)
             DCL        VAR(&FILEN) TYPE(*CHAR) LEN(10)
             DCL        VAR(&FILENS) TYPE(*CHAR) LEN(10) +
                          VALUE('SYFA27PS')
             DCL        VAR(&AVD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&P1) TYPE(*CHAR) LEN(2) VALUE('00')
             DCL        VAR(&P1E) TYPE(*CHAR) LEN(2) VALUE('00')
             DCL        VAR(&P1S) TYPE(*CHAR) LEN(2) VALUE('00')
             DCL        VAR(&P2) TYPE(*CHAR) LEN(1) VALUE('N')
             DCL        VAR(&P3) TYPE(*LGL) LEN(1) VALUE('0')
             DCL        VAR(&P4) TYPE(*LGL) LEN(1) VALUE('0')
             DCL        VAR(&P5) TYPE(*LGL) LEN(1) VALUE('0')
             DCL        VAR(&P6) TYPE(*LGL) LEN(1) VALUE('0')
             DCL        VAR(&P7) TYPE(*CHAR) LEN(1) VALUE('J')
             DCL        VAR(&P8) TYPE(*CHAR) LEN(1) VALUE('J')
             DCL        VAR(&P9) TYPE(*CHAR) LEN(1) VALUE('J')
             DCL        VAR(&STMF) TYPE(*CHAR) LEN(70)
             DCL        VAR(&BANE) TYPE(*CHAR) LEN(50)
             DCL        VAR(&BANES) TYPE(*CHAR) LEN(50)
             DCL        VAR(&UNIK) TYPE(*CHAR) LEN(7) /* Unikkode +
                          til register SORT. */
             DCL        VAR(&QUSER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QJOB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QNBR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&AVD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&LTYPE) TYPE(*CHAR) LEN(1)
             RTVJOBA    JOB(&QJOB) USER(&QUSER) NBR(&QNBR)
/*                                         */
/*           SKJEKK OM PDF FINNES FRA FØR  */
/*                                         */
             CHGDTAARA  DTAARA(*LDA (47 1)) VALUE('F')
             OVRPRTF    FILE(QSYSPRT) OUTQ(OUTMAIL)
             DSPLNK     OBJ(&BANE) OUTPUT(*PRINT) OBJTYPE(*STMF) +
                          DETAIL(*NAME) DSPOPT(*USER)
             MONMSG     MSGID(CPFA0A9) EXEC(GOTO CMDLBL(VIDERE))
             DLTSPLF    FILE(QSYSPRT) JOB(&QNBR/&QUSER/&QJOB) +
                          SPLNBR(*LAST)
             IF         COND(&VISE = 'J') THEN(DO)
             CALL       PGM(PDF001) PARM(&STMF)
             ENDDO
             CHGVAR     VAR(&FINS1) VALUE('X')
             RETURN
    /*                                    */
    /* SKRIVER UT FAKTURAKOPI             */
    /*                                    */
    /* */
    /* FIXER UDS                             */
    /* */
VIDERE:      CALL       PGM(SYFABKD) PARM(&AVD &FANR &FILEN)
    /* */
             RTVDTAARA  DTAARA(*LDA (81 1)) RTNVAR(&LTYPE)
             CHGDTAARA  DTAARA(*LDA (47 1)) VALUE('F')

             /* OVERRIDE     */
             OVRPRTF    FILE(FAKTURA) DEVTYPE(*AFPDS) PAGESIZE(72 +
                          80) LPI(8) CPI(10) OVRFLW(72) +
                          PRTQLTY(*NLQ) FRONTOVL(LOGOFAKT) +
                          OUTQ(OUTMAIL) FORMTYPE(*STD) HOLD(*YES)
             OVRPRTF    FILE(SYFA20P) DEVTYPE(*AFPDS) PAGESIZE(72 +
                          80) LPI(6) CPI(10) OVRFLW(72) +
                          PRTQLTY(*NLQ) FRONTOVL(LOGOFAKT) +
                          OUTQ(OUTMAIL) FORMTYPE(*STD) HOLD(*YES)


             IF         COND(&LTYPE = 'S') THEN(OVRPRTF +
                          FILE(SYFA20PS) DEVTYPE(*AFPDS) PAGESIZE(96 +
                          80) LPI(8) CPI(12) OVRFLW(96) +
                          PRTQLTY(*NLQ) FRONTOVL(LOGOFAKT) +
                          OUTQ(OUTMAIL) FORMTYPE(*STD) HOLD(*YES))
             ELSE       CMD(OVRPRTF FILE(SYFA20PS) DEVTYPE(*AFPDS) +
                          PAGESIZE(72 90) LPI(8) CPI(12) OVRFLW(72) +
                          PRTQLTY(*NLQ) FRONTOVL(LOGOFAKT) +
                          OUTQ(OUTMAIL) FORMTYPE(*STD) HOLD(*YES))

             OVRPRTF    FILE(SYFA20PD) DEVTYPE(*AFPDS) PAGESIZE(72 +
                          80) LPI(6) CPI(12) OVRFLW(72) +
                          OUTQ(OUTMAIL) FORMTYPE(*STD) HOLD(*YES)
             OVRPRTF    FILE(SYFA20PT) PAGESIZE(72 80) CPI(10) +
                          OVRFLW(72) PRTQLTY(*NLQ) +
                          FRONTOVL(LOGOFAKT) OUTQ(OUTMAIL) +
                          FORMTYPE(*STD) HOLD(*YES) /*N01*/
/*N01 START*/
             OVRPRTF    FILE(SYFA27PF) DEVTYPE(*AFPDS) PAGESIZE(72 +
                          80) CPI(10) OVRFLW(72) PRTQLTY(*NLQ) +
                          FRONTOVL(LOGOFAKT) OUTQ(OUTMAIL) +
                          FORMTYPE(*STD) HOLD(*YES) /*N01*/
             OVRPRTF    FILE(SYFA27PS) DEVTYPE(*AFPDS) PAGESIZE(70 +
                          80) CPI(10) OVRFLW(58) PRTQLTY(*NLQ) +
                          FRONTOVL(LOGOFAKT) OUTQ(OUTMAIL) +
                          FORMTYPE(*STD) HOLD(*YES) /*N01*/
/*N01 SLUTT*/
/*N02*/      OVRPRTF    FILE(SYFA27PP) PAGESIZE(70 80) CPI(10) +
                          OVRFLW(66) OUTQ(OUTMAIL)  /* +
                          PRINTERFIL AV SAMLEFAKTURA LISTE */
    /* */
    /* */
    /* FIX SEPARATE GIRO */
    /* */
    /* */
    /* */
    /*                                    */
    /*                                    */
             CHGVAR     VAR(&UNIK) VALUE('W' *CAT &QNBR)
/* SORT OGSÅ I LØSNING 1 - INLIBL FOR Å SIKRE BIBLIOTEKSLISTE */
             CALL INLIBL
/* SORT OGSÅ I LØSNING 1 - INLIBL FOR Å SIKRE SORT I RIKTIG BIBL.*/
             RTVDTAARA  DTAARA(FIRMDT (141 10)) RTNVAR(&LIB)
             OVRDBF     FILE(SORT) TOFILE(&LIB/SORT)

             RMVM       FILE(SORT) MBR(&UNIK)
             MONMSG     MSGID(CPF7310 CPF5815 CPF7315)
             ADDPFM     FILE(SORT) MBR(&UNIK)
             OVRDBF     FILE(SORT) TOFILE(&LIB/SORT) MBR(&UNIK)
             OVRMSGF    MSGF(QUSERMSG) TOMSGF(SYMSGF)

             CALL       PGM(SYFA20) PARM(&P1 &P1E &P1S &P2 &P3 &P4 +
                          &P5 &P6 &P7 &P8 &P9)
             RMVM       FILE(SORT) MBR(&UNIK)
             MONMSG     MSGID(CPF7310 CPF5815 CPF7315)
/*                                       */
/* LAGER PDF AV SELVE FAKTURAEN          */
/*                                       */
/* FINNES FILEN  ??                      */
/*                                       */
             RLSSPLF    FILE(&FILEN) JOB(&QNBR/&QUSER/&QJOB) +
                          SPLNBR(*LAST)
             MONMSG     MSGID(CPF3309 CPF3303 CPF3322) EXEC(DO)
             CHGVAR     VAR(&FINS1) VALUE('N')
             GOTO       CMDLBL(SPES)
             ENDDO
/*                                       */
             ADDLIBLE   LIB(MMAIL)
             MONMSG     MSGID(CPF0000)
/*                                       */
/* LAGER PDF OG LEGGER I MAPPE          */
/* UTEN INFOPRINT                        */
/*                                       */
             IF         COND(&INFOP = 'N') THEN(DO)
             CVTSPLFPDF SPLF(&FILEN) JOB(&QNBR/&QUSER/&QJOB) +
                          TOPDF(&BANE)
             DLTSPLF    FILE(&FILEN) JOB(&QNBR/&QUSER/&QJOB) +
                          SPLNBR(*LAST)
             MONMSG     MSGID(CPF0000)
                          ENDDO
/*                                       */
/*                                       */
/* LAGER PDF OG LEGGER I MAPPE           */
/* MED  INFOPRINT                        */
/*                                       */
             IF         COND(&INFOP = 'J') THEN(DO)
             CALL       PGM(INF001CL) PARM(&FILEN &QNBR &QUSER &QJOB +
                          &BANE)
                          ENDDO
/*                                       */
/*                                       */
/*                                       */
             RMVLIBLE   LIB(MMAIL)
 /*                           */
 /* SAMLEFAKTURALISTE TIL PDF */
 /*                           */
 SPES:       RLSSPLF    FILE(&FILENS) JOB(&QNBR/&QUSER/&QJOB) +
                          SPLNBR(*LAST)
             MONMSG     MSGID(CPF3309 CPF3303 CPF3322) EXEC(DO)
             CHGVAR     VAR(&FINS2) VALUE('N')
             GOTO       CMDLBL(SLUTT)
             ENDDO
/*                                       */
/*                                       */
             ADDLIBLE   LIB(MMAIL)
             MONMSG     MSGID(CPF0000)
             IF         COND(&INFOP = 'N') THEN(DO)
             CVTSPLFPDF SPLF(&FILENS) TOPDF(&BANES) +
                          JOB(&QNBR/&QUSER/&QJOB)
             DLTSPLF    FILE(&FILENS) JOB(&QNBR/&QUSER/&QJOB) +
                          SPLNBR(*LAST)
             MONMSG     MSGID(CPF0000)
                          ENDDO
/*                                       */
/*                                       */
/* LAGER PDF OG LEGGER I MAPPE           */
/* MED  INFOPRINT                        */
/*                                       */
             IF         COND(&INFOP = 'J') THEN(DO)
             CALL       PGM(INF001CL) PARM(&FILENS &QNBR &QUSER &QJOB +
                          &BANES)
                          ENDDO
/*                                       */
             RMVLIBLE   LIB(MMAIL)
 SLUTT:      ENDPGM
