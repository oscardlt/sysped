      ***********************************************************
      * PROGRAM SKAL BE OM UTSKRIFT (EL. TRANSITTERING)       ***
      * INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER      ***
      * LEDIGE INDIKATORER 01 02 05-07 09 11 13-16 18-26      ***
      * LEDIGE INDIKATORER 29 30 35-96                        ***
      ***********************************************************
     FNCTSEH    UF   E           K DISK
     FNCTSEHK   UF A E           K DISK
     FNCTSEHL   UF A E           K DISK
     FTRKODL01  IF   E           K DISK
     FEDIM1     UF A E           K DISK    USROPN
     FEDIM2     IF   E           K DISK
     F                                     RENAME(EDIMR:EDIMR2)
     FEDIM4     IF   E           K DISK
     F                                     RENAME(EDIMR:EDIMR4)
     FEDIC      UF   E             DISK
     FTVIND     UF A E           K DISK
     FNCTSESTD  IF   E           K DISK
     FNCTS012DT CF   E             WORKSTN USROPN
     D                 DS
     D  THAVD                  1      4  0
     D  THTDN                  5     11  0
     D  THSG                  12     14
     D  X14S                   1     14
     D                 DS
     D  X0068R                 1      8
     D  X0068A                 9     16  0
     D  X0068B                17     22  0
     D  X0068L                 1     22
     D                 DS
     D  TLDT                   1      8  0
     D  TLDTC                  1      2  0
     D  TLDTA                  3      4  0
     D  TLDTM                  5      6  0
     D  TLDTD                  7      8  0
     D                 DS
     D  TLTM                   1      6  0
     D  TLTMH                  1      2  0
     D  TLTMM                  3      4  0
     D  TLTMS                  5      6  0
     D                 DS
     D  WSDT                   1      6  0
     D  WSDTD                  1      2  0
     D  WSDTM                  3      4  0
     D  WSDTA                  5      6  0
     D                 DS
     D  WSTM                   1      4  0
     D  WSTMH                  1      2  0
     D  WSTMM                  3      4  0
     D                 DS
     D  UAVD                   1      4  0
     D  UTDN                   5     11  0
     D  UWS                   13     22
     D  UTVIN                 23     23
      *** UIN34 = '1' -> SENDES PÅ TVINN
     D  UIN34                 25     25
     D  U1N07                 40     42
      * OBS! HUSK INITIERE ALLE FELTER PÅ TR011R
     D  UPARM2                 1    128
      *
     C                   OPEN      NCTS012DT
     C                   EXSR      INIT
      *
      *=========================================
      *
     C   34              DO
     C                   EXSR      TSTMTY
     C     START2        TAG
     C                   EXFMT     NCTS012DT1
     C                   MOVEA     '00'          *IN(97)
     C                   MOVEA     '00'          *IN(87)
      *
     C   12              GOTO      START3
     C     *IN27         IFEQ      '1'
     C     WSFT1         COMP      *BLANKS                                98
     C                   END
     C   98              GOTO      START2
      *
     C     *IN28         IFEQ      '1'
     C                   CALL      'TESTDATO'
     C                   PARM      WSDTD         UDD               2 0
     C                   PARM      WSDTM         UMM               2 0
     C                   PARM      WSDTA         UAA               2 0
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      88
     C                   IF        *IN88
     C                   EVAL      *IN30 = *ON
     C                   GOTO      START2
     C                   END
      *
     C                   IF        WSTMH >= 24 OR WSTMM >= 60
     C                   EVAL      *IN87 = *ON
     C                   EVAL      *IN30 = *ON
     C                   GOTO      START2
     C                   END
      *
     C                   END
      *
     C                   SELECT
     C                   WHEN      *IN27
     C                   EXSR      OPDFILCSL
     C                   WHEN      *IN28
     C                   EXSR      OPDFILREL
     C                   WHEN      *IN29
     C                   EXSR      OPDFILCHG
     C                   WHEN      *IN39
     C                   EXSR      OPDFILCHG
     C                   END
      *
     C                   END
      *
     C     START3        TAG
     C     NCTSEHKEY     CHAIN     NCTSEH                             33
     C  N12*IN34         IFEQ      '0'
     C                   MOVE      'A'           THST
     C                   MOVE      *BLANKS       THWS
     C                   ELSE
     C                   MOVE      'Q'           THST
     C                   MOVE      *BLANKS       THWS
     C                   END
     C   12THST          IFEQ      'E'                                           2<-B
     C                   SELECT                                                   3<-B
     C                   WHEN      U1N07 = '015'                                  3
     C                   MOVE      ' '           THST
     C                   WHEN      U1N07 = '013'                                  3
     C                   IF        THTRNR = *BLANKS                                4<-B
     C                   MOVE      'c'           THST
     C                   ELSE                                                      4
     C                   MOVE      'U'           THST
     C                   END                                                       4<-E
     C                   WHEN      U1N07 = '170'                                  3
     C                   MOVE      'c'           THST
     C                   OTHER                                                    3
     C                   MOVE      ' '           THST
     C                   ENDSL                                                    3<-E
     C                   END                                                     2<-E
      *
      *** OPPDATER KOMMUNIKASJONDATA PÅ SAD-REGISTER
     C  N12              MOVE      UTVIN         THPKL
     C   12              MOVE      'N'           THPKL
     C                   UPDATE    NCTSEHR
      *
      *
     C  N12
     CAN 34              EXSR      KOMLIN
     C                   MOVE      'J'           XWIN              1
      *
     C     SLUTT         TAG
     C                   CLOSE     NCTS012DT
     C                   EVAL      *INLR = *ON
     C                   RETURN
      *
      ***********************************************
     C     TSTMTY        BEGSR
      ***********************************************
     C     M2KDCK        SETLL     EDIM2                              33
     C     STTSTM        TAG
     C     M2KD2K        READPE    EDIM2                                  33
     C     *IN33         IFEQ      '0'
     C                   SELECT
      * BRUKER VIL KANSELLERE TRANSITTERING
     C     W1N07         WHENEQ    '014'
     C                   SELECT
     C     M1001         WHENNE    'TET'
     C                   GOTO      STTSTM
     C*    M1N07         WHENEQ    '029'
     C     M1N07         WHENEQ    '928'
     C     M1N07         OREQ      '028'
     C     M1N07         OREQ      '060'                                        KONTROLL VARSEL
     C     M1N07         OREQ      '055'                                        UGYLDIG GARANTI
      * FRIGIVELSE FOR TRANSITTERING --> OK FOR KANSELLERING
     C     NCTSEHKEY     CHAIN(N)  NCTSEHK                            33
     C     *IN33         IFEQ      '0'
     C                   MOVE      TKFT1         WSFT1
     C                   MOVE      TKFT2         WSFT2
     C                   MOVE      TKFT3         WSFT3
     C                   MOVE      TKFT4         WSFT4
     C                   MOVE      TKFT5         WSFT5
     C                   END
     C                   GOTO      SLTSTM
     C     M1N07         WHENEQ    '009'                                        BESLUTTET OM KANSELL
     C     TH0035        IFEQ      '1'                                          AKSEPTERT KANSELLERI
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END
     C     M1N07         WHENEQ    '015'                                        SENDT TRANSITTERING
     C*    M1N07         OREQ      '056'                                        TRANSITTERING ER AVV
     C     M1N07         OREQ      '051'                                        INGEN FRIGIVELSE
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   OTHER
     C                   GOTO      STTSTM
     C                   ENDSL
      *
      * BRUKER VIL SENDE TRANSITTERING
     C     W1N07         WHENEQ    '015'
     C                   SELECT
     C     M1001         WHENNE    'TET'
     C                   GOTO      STTSTM
     C     M1N07         WHENEQ    '009'                                        BESLUTTET OM KANSELL
      * TIDLIGERE TRANSITTERING ER KANSELLERT --> OK Å SENDE PÅ NYTT
     C     M1N07         OREQ      '056'                                        TRANSITTERING ER AVV
      * TIDLIGERE TRANSITTERING ER AVVIST --> OK Å SENDE PÅ NYTT
     C     M1N07         OREQ      '051'                                        INGEN FRIGIVELSE
      * TIDLIGERE TRANSITTERING FIRGIS IKKE --> OK Å SENDE PÅ NYTT
     C     M1N07         OREQ      '055'                                        UGYLDIG GARANTI FØR
      * TIDLIGERE UGYLDIG GARARANTI --> OK Å SENDE PÅ NYTT
     C*    M1N07         OREQ      '062'                                        AVVIST OM FRIGIVELSE
      * TIDLIGERE TRANSITTERING ER AVVIST FOR FRIGIVELSE --> OK Å SENDE PÅ NYTT
     C                   GOTO      SLTSTM
     C     M1N07         WHENEQ    '014'                                        ALLEREDE SENDT KANSE
     C     M1N07         OREQ      '028'                                        TRANSITTERINGNR TILD
     C     M1N07         OREQ      '029'                                        FRIGIVELSE
     C                   MOVE      '1'           *IN99
     C                   GOTO      SLTSTM
     C                   OTHER
     C                   GOTO      STTSTM
     C                   ENDSL
      *
      * BRUKER BER OM FRIGIVELSE
     C     W1N07         WHENEQ    '054'
     C                   SELECT
     C     M1001         WHENNE    'TET'
     C                   GOTO      STTSTM
     C     M1N07         WHENEQ    '029'
     C     M1N07         OREQ      '014'
     C                   MOVE      '1'           *IN99
     C                   GOTO      SLTSTM
     C                   ENDSL
     C     NCTSEHKEY     CHAIN(N)  NCTSEHL                            33
     C     *IN33         IFEQ      '0'
     C                   MOVE      TLST          WSST
     C                   MOVE      TLDTA         WSDTA
     C                   MOVE      TLDTM         WSDTM
     C                   MOVE      TLDTD         WSDTD
     C                   MOVE      TLTMH         WSTMH
     C                   MOVE      TLTMM         WSTMM
     C                   END
      *
     C                   ENDSL
      *
     C                   END
      *
     C     SLTSTM        ENDSR
      *
      ***********************************************
     C     OPDFILCSL     BEGSR
      ***********************************************
     C                   SELECT
     C     W1N07         WHENEQ    '014'
      * OPPDATER KANSELLERINGSGRUNNLAG
     C     WSFT1         COMP      *BLANKS                                98
     C   98              GOTO      START2
     C     NCTSEHKEY     CHAIN     NCTSEHK                            33
     C                   MOVE      WSFT1         TKFT1
     C                   MOVE      WSFT2         TKFT2
     C                   MOVE      WSFT3         TKFT3
     C                   MOVE      WSFT4         TKFT4
     C                   MOVE      WSFT5         TKFT5
     C     *IN33         IFEQ      '1'
     C                   MOVE      THAVD         TKAVD
     C                   MOVE      THTDN         TKTDN
     C                   WRITE     NCTSEHKR
     C                   ELSE
     C                   UPDATE    NCTSEHKR
     C                   END
      *
     C                   ENDSL
      *
     C                   ENDSR
      *
      ***********************************************
     C     OPDFILREL     BEGSR
      ***********************************************
     C                   SELECT
     C     W1N07         WHENEQ    '054'
      *
     C     NCTSEHKEY     CHAIN     NCTSEHK                            33
     C                   MOVE      WSST          TLST
     C                   MOVE      20            TLDTC
     C                   MOVE      WSDTA         TLDTA
     C                   MOVE      WSDTM         TLDTM
     C                   MOVE      WSDTD         TLDTD
     C                   MOVE      WSTMH         TLTMH
     C                   MOVE      WSTMM         TLTMM
     C     *IN33         IFEQ      '1'
     C                   MOVE      THAVD         TLAVD
     C                   MOVE      THTDN         TLTDN
     C                   WRITE     NCTSEHLR
     C                   ELSE
     C                   UPDATE    NCTSEHLR
     C                   END
      *
     C                   ENDSL
      *
     C                   ENDSR
      *
      ***********************************************
     C     OPDFILCHG     BEGSR
      ***********************************************
     C                   SELECT
     C     W1N07         WHENEQ    '013'
      *
     C     NCTSEHKEY     CHAIN     NCTSEH                             33
     C                   MOVE      WSFLAG        THFLAG
     C                   UPDATE    NCTSEHR
      *
     C     W1N07         WHENEQ    '170'
     C                   ENDSL
      *
     C                   ENDSR
      *
      ***********************************************
     C     KOMLIN        BEGSR
      ***********************************************
     C     W1N07         IFEQ      '015'
     C                   MOVE      '1'           *IN31
     C                   GOTO      STKL2
     C                   END
      *
      * HENT SISTE DATO/SEKVENSNR.
      *   1. HVIS DET FINNES OG IKKE ER 'CTL'
      *   2. HVIS DET IKKE PKT.1, HENTER NY DATO/SEKV.NR.
     C     MAKDCK        SETLL     EDIM4                              31
      * FOR Å FÅ UNIK NUMMERERING PÅ ALLE TVINNSAKER SKAL VERSJ.NR ØKER
      * ALLTID (OGSÅ VED FEIL I INP.KTR.!!! - NÅR NY SAK I TVINN (ELLER
      * BARE DFI HITTIL SKAL NY DATO/SEKV.NR. ALLTID TILDELES))
     C     STKL          TAG
     C     MAKD2K        READPE    EDIM4                                  31
     C  N31M0065         IFNE      'XMLDEC'                                     1<-B
     C     M0065         ANDNE     'XMLRES'
     C                   GOTO      STKL
     C                   END                                                    1<-E
     C  N31MST           IFEQ      'D'                                          1<-B
     C     M1001         ORNE      'TET'
     C                   GOTO      STKL
     C                   END                                                    1<-E
     C  N31M1N07         IFEQ      'CTL'                                        1<-B
     C                   GOTO      STKL
     C                   END                                                    1<-E
      *
      *** DET FINNES IKKE TAD-SVAR DATO/SEKVENS/VERSJON MÅ KONSTRUERES
      *** ORDNE DEKLARANTENS DATO
     C     STKL2         TAG
     C   31              DO
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVEL     WDT           M0068A
      *** HENT SEKVENSNR.
     C     TVINDK        CHAIN     TVIND                              32
     C   32              Z-ADD     M0068A        D0068A
     C   32              Z-ADD     0             D0068B
     C                   ADD       1             D0068B
     C   32              WRITE     TVINDF
     C  N32              UPDATE    TVINDF
     C                   MOVE      D0068B        M0068B
     C                   END
      *
      *** HENTE MELDINGSNR
     C     1             CHAIN     EDIC                               32
     C                   ADD       1             CMN
     C                   UPDATE    EDICR
      *
     C                   EXSR      MOVKD1
     C                   OPEN      EDIM1
     C     TVIM1K        SETLL     EDIM1                              32
     C     STKL3         TAG
     C     TVIM1K        READE     EDIM1                                  32
     C  N32M0065         IFEQ      'XMLDEC'
     C     M1001         ANDEQ     'TET'
     C                   DELETE    EDIMR
     C                   ELSE
     C                   UPDATE    EDIMR
     C                   GOTO      STKL3
     C                   END
     C                   EXSR      MOVKD2
     C                   WRITE     EDIMR
     C                   CLOSE     EDIM1
      *
      * Lag XML-fil
     C                   CALL      'NCTS101R'
     C                   PARM      MMN           UMN               9 0
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVKD1        BEGSR
      ***********************************************
     C                   MOVE      M0068A        X0068A
     C                   MOVE      M0068B        X0068B
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVKD2        BEGSR
      ***********************************************
     C                   MOVE      X0004         M0004
     C                   MOVE      X0010         M0010
     C                   MOVE      W0035         M0035
     C                   MOVE      *BLANKS       M0062
     C                   MOVEL     X14S          M0062
     C                   MOVE      'XMLDEC'      M0065
     C                   MOVE      X0068A        M0068A
     C                   MOVE      X0068B        M0068B
     C                   MOVE      *ZEROS        M0068C
     C                   MOVE      *BLANKS       M0068
     C                   MOVEL     X0004         X0068R
     C                   MOVEL     X0068L        M0068
      *
     C     NCTSEHKEY     CHAIN     NCTSEH                             33
     C*                  EVAL      THTRNR = X0068L
     C                   EVAL      THLRN  = X0068L
     C                   UPDATE    NCTSEHR
      *
     C                   MOVE      *ZEROS        M0068D
     C                   MOVE      *ZEROS        M0068E
     C                   MOVE      *ZEROS        M0068F
     C                   MOVE      'TET'         M1001
     C                   MOVE      *BLANKS       M1004
     C                   MOVE      W1N07         M1225
     C                   MOVE      *ZEROS        M2005B
     C                   MOVE      *ZEROS        M3039D
     C                   MOVE      *ZEROS        M3039E
     C                   MOVE      *ZEROS        M5004D
     C                   MOVE      W1N07         M1N07
     C                   MOVE      *BLANKS       M1N08
      *
     C                   MOVE      *ZEROS        MSN
     C                   Z-ADD     CMN           MMN
     C                   MOVE      'S'           MSR
     C                   MOVE      *BLANKS       MST
     C                   MOVE      *ZEROS        MDT
     C                   MOVE      *ZEROS        MTM
     C                   MOVE      THAVD         MAVD
     C                   MOVE      THTDN         MTDN
     C                   MOVE      *ZEROS        MFFBNR
     C                   MOVE      WVEN          MVEN
      *
     C                   ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     *LIKE         DEFINE    MSR           XSR1
     C     *LIKE         DEFINE    MSR           X1STA
     C     *LIKE         DEFINE    M0068A        MAX0B
     C     *LIKE         DEFINE    M0068B        MAX0C
     C     *LIKE         DEFINE    M0068C        MAX0D
     C     *LIKE         DEFINE    S0004         X0004
     C     *LIKE         DEFINE    S0010         X0010
     C     NCTSEHKEY     KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C     TRK01K        KLIST
     C                   KFLD                    YUNIK             3
     C                   KFLD                    YKODE            10
     C     MAKDCK        KLIST
     C                   KFLD                    XSR1
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    MAX0B
     C                   KFLD                    MAX0C
     C                   KFLD                    MAX0D
     C     MAKD2K        KLIST
     C                   KFLD                    XSR1
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C     M2KDCK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    MAX0B
     C                   KFLD                    MAX0C
     C                   KFLD                    MAX0D
     C     M2KD2K        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C     TVIM1K        KLIST
     C                   KFLD                    X1STA
     C                   KFLD                    THAVD
     C                   KFLD                    THTDN
     C     TVINDK        KLIST
     C                   KFLD                    M0068A
      *
     C     *ENTRY        PLIST
     C     UPARM2        PARM                    UPARM1          128
     C                   PARM                    UFLAGG            1 0
      *
     C                   MOVE      UIN34         *IN34
     C                   MOVE      U1N07         W1N07
     C     U1N07         COMP      '014'                                  27
     C     U1N07         COMP      '054'                                  28
     C     U1N07         COMP      '013'                                  29
     C     U1N07         COMP      '170'                                  39
      *
     C                   MOVE      'R'           XSR1
     C                   MOVE      *ZEROS        M0068A
     C                   MOVE      '99999999'    MAX0B
     C                   MOVE      '999999'      MAX0C
     C                   MOVE      '99'          MAX0D
     C                   MOVE      *ZEROS        WSDT
     C                   MOVE      *ZEROS        WSTM
     C                   MOVE      *ZEROS        TLDT
     C                   MOVE      *ZEROS        TLTM
      *
     C     UAVD          CHAIN     NCTSESTD                           33
     C                   MOVE      S0035         W0035
     C                   MOVE      S0004         X0004
     C                   MOVE      S0010         X0010
     C                   MOVE      *BLANKS       WVEN
     C     NCTSEHKEY     CHAIN(N)  NCTSEH                             33
      *
     C                   MOVE      '0'           *IN12
      *
     C                   ENDSR
      *
