      *__________________________
      * Utskrift av samlefaktura AMETA
      *""""""""""""""""""""""""""
     FFAK2      IF   E           K DISK
     F                                     RENAME(FAKTR:FAK2R)
     FFAKT      UF   E           K DISK
     FFAI3      IF A E           K DISK
     FHEADF     UF   E           K DISK
     FKODTLK    IF   E           K DISK
     FFAK3      IF   E           K DISK
     F                                     RENAME(FAKTR:FAKTR3)
     FKODTA     IF   E           K DISK
     FKODTÅ     IF   E           K DISK
     FKODTH     IF   E           K DISK
     FKODTW     IF   E           K DISK
     FHODE      IF   E           K DISK
     FFIRM      IF   E           K DISK
     FTELLFA    UF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FAMHE      IF   E           K DISK
     FAMSAML    UF   E           K DISK
     FAMSAML2   IF   E           K DISK
     F                                     RENAME(SAMLR:SAMLR2)
     FAMWSAML   O  A E           K DISK
     F                                     RENAME(SAMLR:WSAMLR)
     FAMWSAML2  UF A E           K DISK
     F                                     RENAME(SAMLR:WSAML2R)
     FSYAM27FM  CF   E             WORKSTN
     FSYAM27PF  O    E             PRINTER
     D HO              S             80    DIM(10)
     D HE              S             80    DIM(10)
     D HT              S             80    DIM(10)
     D                 DS
     D  ADR3                   1     24
     D  ADR31                  1     24
     D  ADR3B                  1     24
     D  ADR3C                  1     24
     D                 DS
     D  XSA1                   1     18
     D  XSA2                   5     18
     D  SAAVD                  1      4  0
     D  FIAVD                  1      4  0
     D  SAFIRM                 5      6
     D  SAKN                   7     14  0
     D  SAXXX                 15     18
     D  SAOPD                 19     25  0
     D  FIOPD                 19     25  0
NV5  D                 DS
NV5  D  AHAÅÅ                  1      4  0
NV5  D  AHAMM                  5      6  0
NV5  D  AHADD                  7      8  0
NV5  D  AHADAT                 1      8  0
NV5  D                 DS
NV5  D  XHADD                  1      2  0
NV5  D  XHAMM                  3      4  0
NV5  D  XHAÅÅ                  5      6  0
NV5  D  XHADAT                 1      6  0
NV5  D                 DS
NV5  D  AHBÅÅ                  1      4  0
NV5  D  AHBMM                  5      6  0
NV5  D  AHBDD                  7      8  0
NV5  D  AHBDAT                 1      8  0
NV5  D                 DS
NV5  D  XHBDD                  1      2  0
NV5  D  XHBMM                  3      4  0
NV5  D  XHBÅÅ                  5      6  0
NV5  D  XHBDAT                 1      6  0
     D                 DS
EV5  D  FADATO                 1      8  0
EV5  D  XDTKÅ                  1      4  0
NV5  D  XDTKM                  5      6  0
EV5  D  XDTKD                  7      8  0
NV5  D                 DS
NV5  D  XDTU2                  1      6  0
NV5  D  XDTU2D                 1      2  0
NV5  D  XDTU2M                 3      4  0
NV5  D  XDTU2Å                 5      6  0
NV5  D                 DS
NV5  D  XFFDTD                 1      2  0
NV5  D  XFFDTM                 3      4  0
NV5  D  XFFDTA                 5      6  0
NV5  D  XFFDT                  1      6  0
NV5  D                 DS
NV5  D  XFFD2A                 1      4  0
NV5  D  XFFD2M                 5      6  0
NV5  D  XFFD2D                 7      8  0
NV5  D  XFFDT2                 1      8  0
NV5  D                 DS
NV5  D  IDAGA                  1      4  0
NV5  D  IDAGM                  5      6  0
NV5  D  IDAGD                  7      8  0
NV5  D  IDAG                   1      8  0
SV5  D*           DS
SV5  D*                                       1   60HEDTS
SV5  D*                                       1   20XDTSÅ
SV5  D*                                       5   60XDTSD
SV5  D*           DS
SV5  D*                                       1   20HEDTD
SV5  D*                                       3   40HEDTM
SV5  D*                                       5   60HEDTÅ
SV5  D*                                       1   60XDT
NV5  D                 DS
NV5  D  WSDAT8                 1      8  0
NV5  D  WSDATE                 3      8  0
SV5  D*           DS
SV5  D*                                       1   20W2DTÅ
SV5  D*                                       3   40W2DTM
SV5  D*                                       5   60W2DTD
SV5  D*                                       1   60W2DATE
SV5  D*           DS
SV5  D*                                       1   40WSPER
SV5  D*                                       1   20YDTMP
SV5  D*                                       3   40YDTÅP
     D                 DS
     D  HOHT1                  1     80
     D  HOHT2                 81    160
     D  HOHT3                161    240
     D  HOHT4                241    320
     D  HOHT5                321    400
     D  HOHT6                401    480
     D  HOHT7                481    560
     D  HOBT1                561    640
     D  HOBT2                641    720
     D  HOBT3                721    800
     D  HP                     1    800
     D                                     DIM(10)
     D                UDS
     D  UFIRM                  1      2
     D  UAVD                  15     18  0
     D  USG                   19     21
     D  UPRO                  22     29  0
     D  UDT                   30     35  0
     D  UHOD                  47     47
     D  UBBS                  48     48
     D  UGN                  981    995
     C*
     C     PÅNY          TAG
     C                   EXSR      INIT
     C  N03              DO
     C  N27              EXSR      PRINT1
     C  N27URETUR        IFEQ      'Y'
     C                   GOTO      PÅNY
     C                   END
     C   27              EXSR      PRINTK
     C                   END
     C*
     C                   MOVE      XPRANT        UPRANT
     C                   SETON                                        LR
     C                   RETURN
     C*
     C******************************************
     C     PRINT1        BEGSR
     C******************************************
     C*
     C                   EXSR      PLUKK
     C     URETUR        IFEQ      'Y'
     C                   GOTO      SLPR1
     C                   END
     C* LES ALLTID UAVH. AV AVDELING FRA WFILE
     C                   MOVE      'J'           XHOD              1
     C     SAML2K        SETLL     AMWSAML2
     C                   READ      AMWSAML2                               30
     C* 30 ER INGEN FUNNET
     C   30              GOTO      SLPR1
     C*
     C                   MOVE      XSA2          XFORR2           14
     C     SAML2K        SETLL     AMWSAML2
     C*
     C* STARTER LØKKE FOR UTSKRIFT
     C*
     C     STPR1         TAG
     C                   READ      AMWSAML2                               30
     C  N30HEADFK        CHAIN     HEADF                              33
      *
     C  N30HEST          IFEQ      'S'
     C                   GOTO      STPR1
     C                   END
      *
     C     *IN30         IFEQ      '1'
      * FRAMKALLE BRUDD/UTSKR. AV SIST LESTE TUR.
     C                   MOVE      *ZEROS        HEPRO
     C                   EXSR      PRTTUR
     C                   EXSR      TOTSR
     C                   GOTO      SLPR1
     C                   END
     C*
     C*
     C*  BRUDD PÅ TUR.. MEN FLERE POSTER
     C     XSA2          COMP      XFORR2                                 32
     C  N32              DO
     C                   EXSR      PRTTUR
     C                   EXSR      TOTSR
     C                   MOVE      XSA2          XFORR2
     C                   MOVE      'J'           XHOD
     C                   MOVEL     SAKN          WSKN
     C     SAML2K        SETLL     AMWSAML2
     C                   GOTO      STPR1
     C                   END
     C* BRUDD PÅ TUR SLUTT
     C*
     C     HEADFK        CHAIN     HEADF                              30
     C                   EXSR      PRINT
     C                   UPDATE    HEADFR
     C*
     C                   DELETE    WSAML2R
     C     DELKEY        CHAIN     AMSAML                             77
     C  N77              DELETE    SAMLR
     C*
     C                   GOTO      STPR1
     C*
     C     SLPR1         ENDSR
     C*
     C*
     C******************************************
     C     PLUKK         BEGSR
     C******************************************
     C     WSAVD         COMP      0                                  31
     C   31PSAMK         SETLL     AMSAML
     C  N31PSAMK2        SETLL     AMSAML2
     C*
     C* STARTER LØKKE FOR UTSKRIFT
     C*
     C     STPLU         TAG
     C   31WSAVD         READE     AMSAML                                 30
     C  N31              READ      AMSAML2                                30
     C   30              GOTO      WOPD2
     C* TESTER KUNDENUMMER
     C   28WSKN          IFNE      SAKN
     C                   GOTO      STPLU
     C                   END
     C* TESTER PROSJEKT
     C   29WSPRO         IFNE      SAPRO
     C                   GOTO      STPLU
     C                   END
     C     HEADFK        CHAIN(N)  HEADF                              33
     C*
     C* ORDER DELETED
     C*
     C  N33HEST          IFEQ      'S'
     C                   GOTO      STPLU
     C                   END
     C   33              GOTO      STPLU
     C* TESTER DATO
NV5  C     WSDATE        IFEQ      0
NV5  C                   MOVE      *ZEROS        WSDAT8
NV5  C                   ELSE
NV5  C     WSDATE        IFGT      501231
NV5  C                   MOVEL     '19'          WSDAT8
NV5  C                   ELSE
NV5  C                   MOVEL     '20'          WSDAT8
NV5  C                   END
NV5  C                   END
     C     WSDATE        IFNE      *ZEROS
SV5  C*                    MOVE HEDTÅ     W2DTÅ
SV5  C*                    MOVE HEDTM     W2DTM
SV5  C*                    MOVE HEDTD     W2DTD
SV5  C*          W2DATE    IFGT WSDATE
NV5  C     HEDTOP        IFGT      WSDAT8
     C                   GOTO      STPLU
     C                   END
     C                   END
     C     KUND2K        CHAIN     CUNDL01                            33
     C   33              GOTO      STPLU
     C     WOPD          TAG
     C* FLYTTER INN VALUTAKODE I WORKFIL
     C     SASK          IFEQ      'X'
     C                   MOVE      FICURR        SAXXX
     C                   END
     C*
     C   31              WRITE     WSAMLR
     C  N31              WRITE     WSAML2R
     C                   GOTO      STPLU
     C     WOPD2         TAG
     C*
     C                   CALL      'SYAM27A '
     C     URETUR        PARM      URETUR        URETUR            1
     C*TØMMER WORKFILE HVIS RETUR = Y
     C     URETUR        IFEQ      'Y'
     C                   CALL      'SYAM27C'
     C                   END
     C                   ENDSR
     C*
     C******************************************
     C     PRINTK        BEGSR
     C******************************************
     C                   MOVE      'J'           XHOD
     C     STPRK         TAG
     C                   EXFMT     BILDE02
     C   03              GOTO      SLPRK
     C                   SETOFF                                       99
     C     WSFN          SETLL     FAI3
     C     WSFN          READE     FAI3                                   99
     C   99              MOVE      'SPF0003'     MSGNR
     C   99              GOTO      STPRK
     C*
     C     WSFN          SETLL     FAI3
     C     STPRK2        TAG
     C     WSFN          READE     FAI3                                   45
     C   45
     CANN48              GOTO      SLPRK
     C  N45
     CANN48              SETON                                        48
     C  N45HEADFK        CHAIN     HEADF                              30
     C*
     C* IF COPY THE DOKUMENT CAN HAVE DIFFERENT STATUSCODES
     C*
     C                   MOVE      'O'           GLSTAT            1
     C                   SETOFF                                       33
     C     FAK2KC        SETLL     FAK3
     C     FAK2KC        READE     FAK3                                   33
     C  N33              GOTO      CONTC
     C                   MOVE      'F'           GLSTAT
     C                   SETOFF                                       33
     C     FAK2KC        SETLL     FAK3
     C     FAK2KC        READE     FAK3                                   33
     C  N33              GOTO      CONTC
     C                   MOVE      'G'           GLSTAT
     C                   SETOFF                                       33
     C     FAK2KC        SETLL     FAK3
     C     FAK2KC        READE     FAK3                                   33
     C*
     C     CONTC         TAG
     C*
     C  N33              MOVE      FIFIRM        SAFIRM
     C  N33              MOVE      FICURR        SAXXX
     C  N33              MOVE      FAKUNR        SAKN
     C  N33              MOVE      FASK          SASK
     C  N45SASK          IFNE      ' '
SV5  C*                    MOVE FADATO    XDTU1   60
SV5  C*                    MOVE FADATO    XDTU2   60
SV5  C*                    MOVELXDTKD     XDTU2
SV5  C*                    MOVE XDTKÅ     XDTU2
NV5  C                   MOVE      XDTKD         XDTU2D
NV5  C                   MOVE      XDTKM         XDTU2M
NV5  C                   MOVE      XDTKÅ         XDTU2Å
     C                   MOVE      FADATO        IDAG
     C                   MOVE      FAKUNR        KUNDNR
     C                   MOVE      FAFAKT        XFN
     C                   EXSR      PRINT
     C                   GOTO      STPRK2
     C                   END
     C*
      * FRAMKALLE BRUDD/UTSKR. AV SIST LESTE TUR.
     C                   MOVE      *ZEROS        HEPRO
     C                   EXSR      PRTTUR
     C                   EXSR      TOTSR
      *
     C     SLPRK         ENDSR
     C*
     C*
     C******************************************
     C     PRINT         BEGSR
     C******************************************
     C* VARIABLE VAT
     C     FITAXD        IFNE      *ZEROS
     C     FITAX2        ANDNE     *ZEROS
     C     IDAG          ANDLT     FITAXD
     C                   MOVE      FITAX2        FITAX
     C                   MOVE      FITAX2        FITAXB            4 4
     C                   MOVE      FITAX2        MVAPRO            4 2
     C                   END
     C*
     C                   MOVE      'X'           YSK
     C                   SETOFF                                       34
     C     FAK2K         SETLL     FAK2
      *
     C     OPKO2X        TAG
      *
     C     FAK2K         READE     FAK2                                   34
     C  N27
     CANN34FAOPKO        IFNE      'A'
     C     FAOPKO        IFNE      ' '
     C                   GOTO      OPKO2X
     C                   END
     C                   END
     C   27
     CANN34FAOPKO        IFNE      'O'
     C     FAOPKO        IFNE      'F'
     C     FAOPKO        IFNE      'G'
     C                   GOTO      OPKO2X
     C                   END
     C                   END
     C                   END
      *
     C   27
     CANN34FAFAKT        IFNE      WSFN
     C                   GOTO      OPKO2X
     C                   END
      *
     C                   EXSR      FRIPA
     C*
     C     SLPR          ENDSR
     C*
     C*
     C***********************************************
     C     FRIPA         BEGSR
     C***********************************************
     C*
     C*** HENTER KUNDEOPPLYSNINGER
     C                   MOVE      FAKUNR        YKN
     C     KUND1K        CHAIN     CUNDL01                            33
     C     POSTNR        COMP      0                                      37
     C     SYPOGE        COMP      *BLANKS                                38
     C  N33SPRAAK        COMP      'E'                                    70
     C  N33SPRAAK        COMP      'T'                                    79
     C*
     C                   MOVE      FICURR        XVAL              3
     C*
     C* OPPDATERER TELLER VED FØRSTE OPPDRAG
     C*
     C     XHOD          IFEQ      'J'
     C*
     C  N27              DO
     C     UFIRM         CHAIN     TELLFA                             33
     C  N33              DO
     C                   MOVE      FIFNR         XFN               7 0
     C                   ADD       1             FIFNR
     C                   UPDATE    tellfar
     C                   END
     C                   END
     C   27              SETOFF                                       33
     C   27              MOVE      WSFN          XFN
     C                   EXSR      BETSR
     C*
     C                   END
     C*
     C  N27              DO
     C                   MOVE      XFN           FIFN
     C                   MOVE      HEAVD         FIAVD
     C                   MOVE      HEOPD         FIOPD
     C     FAI3K         CHAIN     FAI3                               33
     C   33              WRITE     FAINR
     C                   END
     C*
SV5  C*
SV5  C*                    MOVE XFFDT     XFFDTS  60
     C                   EXSR      VALI
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     VALI          BEGSR
     C***********************************************
     C                   MOVE      *BLANKS       KLKNVN
     C     LKKEY         CHAIN     KODTLK                             33
     C*
     C  N70
     CANN79              MOVE      HO            HP
     C   70              MOVE      HE            HP
     C   79              MOVE      HT            HP
     C                   SETOFF                                       88
     C*
     C* SKRIVER UT HEAD VED FØRSTE RECORD
     C*
     C     XHOD          IFEQ      'J'
     C                   Z-ADD     1             XANT              2 0
     C                   SETOFF                                       90
     C                   EXSR      KDTFM1
     C                   WRITE     FHEAD
     C                   EXSR      KDTFM1
     C                   MOVE      ' '           XHOD
     C                   END
     C** BRUDD PÅ TUR/SDKRIV DETAL???
     C                   EXSR      PRTTUR
     C** AKKUMULER SIST LESTE OPPDRAG INN I TOTALER
     C                   EXSR      OPDSUM
     C**
     C                   ENDSR
     C****************************************************************
     C     PRTTUR        BEGSR
     C****************************************************************
      * INNOM HER ETTER HVERT OPPDRAG - HVIS NY TUR
      * HVIS NY TUR / SISTE FØR BRUDD/SISTE TOTALT SKRIV
      * DETALJPOST PÅ SAMLEFAKTURAEN
     C**
      * UNNGÅ BRUDD/SETT KEY ETTER FØRSTE LESTE OPPDRAG
     C     *IN51         IFEQ      *OFF
     C                   MOVE      *ON           *IN51
     C                   MOVE      HEPRO         XXPRO             8 0
     C                   MOVE      HEKNA         XXKNA             8 0
     C                   MOVE      XSA2          XFORR2
     C                   ENDIF                                                  <*IN51
     C*
     C     XSA2          IFNE      XFORR2
     C     XXPRO         ORNE      HEPRO
     C     AMHEKY        CHAIN     AMHE                               53
     C     *IN53         IFEQ      *ON
     C                   MOVEL     XXPRO         AHEREF
     C                   MOVE      *BLANKS       AHAREF
     C                   MOVE      *ZEROS        AHADAT                         AVG.DATO
     C                   MOVE      *ZEROS        AHBDAT                         ANK.DATO
NV5  C                   MOVE      *ZEROS        XHADAT                         AVG.DATO
NV5  C                   MOVE      *ZEROS        XHBDAT                         ANK.DATO
     C                   MOVE      *BLANKS       AHBILN
NV5  C                   ELSE
NV5  C                   MOVE      AHADD         XHADD
NV5  C                   MOVE      AHAMM         XHAMM
NV5  C                   MOVE      AHAÅÅ         XHAÅÅ
NV5  C                   MOVE      AHBDD         XHBDD
NV5  C                   MOVE      AHBMM         XHBMM
NV5  C                   MOVE      AHBÅÅ         XHBÅÅ
     C                   ENDIF                                                  <*IN53
     C**
     C** HVIS 32. LINJE NY SIDE FAKTURA
     C**
     C     XANT          COMP      33                                 88
     C   88              DO
     C                   WRITE     FHEAD1
     C                   EXSR      KDTFM1
     C                   WRITE     FHEAD
     C                   EXSR      KDTFM1
     C                   SETOFF                                       88
     C                   Z-ADD     1             XANT
     C                   END
     C                   WRITE     FTUR
     C                   MOVE      *ZEROS        XBRUTA
     C                   ADD       1             XANT
     C                   MOVE      HEPRO         XXPRO
     C                   MOVE      HEKNA         XXKNA
     C                   MOVE      XSA2          XFORR2
     C                   ENDIF                                                  <XXPRO
     C                   ENDSR
     C*
     C***********************************************
     C     OPDSUM        BEGSR
     C***********************************************
     C     XVAL          COMP      'NOK'                              7171
     C     FAK2K         SETLL     FAK2
      *
     C     STKRE         TAG
     C                   SETOFF                                       33
     C     FAK2K         READE     FAK2                                   33
     C   33              GOTO      SLKRE
      *
     C     FAVK          IFNE      'AME'
     C                   GOTO      STKRE
     C                   END
      * KOPI.....
     C     *IN27         IFEQ      '1'
     C     FAOPKO        IFNE      'O'
     C     FAOPKO        ANDNE     'F'
     C     FAOPKO        ANDNE     'G'
     C                   GOTO      STKRE
     C                   END
     C     WSFN          IFNE      FAFAKT
     C                   GOTO      STKRE
     C                   END
     C* IKKE TA MED KOSTNADER
     C     FAKDA         IFEQ      'K'
     C                   GOTO      STKRE
     C                   END
     C*
     C                   ELSE
     C* ORIGINAL....
     C     FAOPKO        IFNE      'A'
     C     FAOPKO        ANDNE     ' '
     C                   GOTO      STKRE
     C                   END
     C* UPDATING FILE
     C*
     C     FAKTK         CHAIN     FAKT                               33
     C  N33              MOVE      KUNDNR        FAKUNR
     C  N33              MOVE      XFN           FAFAKT
     C  N33              MOVE      'F'           FAOPKO
     C  N33              MOVE      YDTMP         FAMND
     C  N33              MOVE      YDTÅP         FAÅR
NV5  C  N33              MOVE      YDTCP         FACC
     C  N33              MOVE      IDAG          FADATO
SV5  C* N33                MOVE XFFDT     FADAFF
NV5  C  N33              MOVE      XFFDT2        FADAFF
     C  N33              MOVE      'S'           FAKDA
     C  N33              EXCEPT    OPDFAK
     C                   END
     C*
     C* AKKUMULER PÅ DETALJNIVÅ (TUR)
     C  N71              ADD       FABELN        XBRUTA
     C   71              ADD       FABELV        XBRUTA
     C* .... OG PÅ TOTALNIVÅ
     C     FAKDM         COMP      'J'                                    34
     C   34
     CANN71              ADD       FABELN        XMVGR
     C   34
     CAN 71              ADD       FABELV        XMVGR
     C  N71              ADD       FABELN        XTOTAL
     C   71              ADD       FABELV        XTOTAL
     C*
     C                   GOTO      STKRE
     C*
     C     SLKRE         ENDSR
     C*
     C******************************************
     C     TOTSR         BEGSR
     C******************************************
      * SKRIV TOTAL FOR DENNE SAMLEFAKT
     C     XMVGR         MULT(H)   FITAXB        XMOM
     C     XTOTAL        ADD       XMOM          XBRUT
     C     XBRUT         COMP      *ZEROS                               73
     C     XMOM          COMP      *ZEROS                             7272
     C                   WRITE     FTOT
     C                   WRITE     FTOT2B
     C                   ADD       1             XPRANT
     C                   MOVE      *ZEROS        XMVGR             9 2
     C                   MOVE      *ZEROS        XMOM              8 2
     C                   MOVE      *ZEROS        XTOTAL           13 2
     C                   MOVE      *ZEROS        XBRUT            13 2
     C                   ENDSR
     C*
     C***********************************************
     C     BETSR         BEGSR
     C***********************************************
     C*
     C                   MOVE      *BLANKS       KLKNVN
     C     LKKEY         CHAIN     KODTLK                             33
     C*
     C*
     C*** FINNER BETBET OG FORFALLSDATO
SV5  C*** INN ÅÅMMDD   UT DDMMÅÅ
NV5  C*** INN DDMMÅÅ   UT DDMMÅÅ
SV5  C* N27                MOVE UDATE     XFFDT   60
SV5  C* N27                MOVELUYEAR     XFFDT
SV5  C* N27                MOVE UDAY      XFFDT
SV5  C* N27                MOVE XDTU1     XFFDT
NV5  C  N27              MOVE      XDTU2         XFFDT
NV5  C   27              MOVE      *ZEROS        XFFDT
     C                   MOVE      *BLANKS       BETTXT           30
     C                   CALL      'SYFA20A'
SV5  C*                    PARM           XFFDT
NV5  C     XFFDT         PARM      XFFDT         UFFDT             6 0
     C                   PARM                    BETTXT
     C                   PARM                    UFIRM
     C                   PARM                    BETBET
NV5  C                   MOVE      XFFDTD        XFFD2D
NV5  C                   MOVE      XFFDTM        XFFD2M
NV5  C                   MOVE      XFFDTA        XFFD2A
NV5  C     XFFDTA        IFGT      50
NV5  C                   MOVEL     '19'          XFFD2A
NV5  C                   ELSE
NV5  C                   MOVEL     '20'          XFFD2A
NV5  C                   END
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     AMHEKY        KLIST
     C                   KFLD                    XXPRO
     C                   KFLD                    XXKNA
     C*
     C     FAK2KC        KLIST
     C                   KFLD                    GLSTAT
     C                   KFLD                    FIFN
     C*
     C                   MOVEL     'LK'          YLKUNI            3
     C     LKKEY         KLIST
     C                   KFLD                    YLKUNI
     C                   KFLD                    SYLAND
     C     FAKTK         KLIST
     C                   KFLD                    FAAVD
     C                   KFLD                    FAOPD
     C                   KFLD                    FALI
     C     FAK2K         KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    YSK
     C     FAI3K         KLIST
     C                   KFLD                    FIFN
     C                   KFLD                    FIAVD
     C                   KFLD                    FIOPD
     C     HEADFK        KLIST
     C                   KFLD                    SAAVD
     C                   KFLD                    SAOPD
     C     KODTHK        KLIST
     C                   KFLD                    YHUNI
     C                   KFLD                    UAVD
     C     KODTAK        KLIST
     C                   KFLD                    YAUNI
     C                   KFLD                    WSAVD
     C     KODTA9        KLIST
     C                   KFLD                    YAUNI
     C                   KFLD                    UAVDXX
     C     KODTÅK        KLIST
     C                   KFLD                    YÅUNI
SV5  C*                    KFLD           YDTMP
NV5  C                   KFLD                    YDTCP
     C                   KFLD                    YDTÅP
NV5  C                   KFLD                    YDTMP
     C     HODEK         KLIST
     C                   KFLD                    YNET
     C                   KFLD                    UAVD
     C     KUND1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    YKN
     C     KUND2K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    SAKN
     C     PSAMK         KLIST
     C                   KFLD                    WSAVD
     C                   KFLD                    UFIRM
     C                   KFLD                    WSKN
     C                   KFLD                    WSPRO
     C                   KFLD                    YOPD
     C                   KFLD                    YSK
     C     DELKEY        KLIST
     C                   KFLD                    SAAVD
     C                   KFLD                    SAFIRM
     C                   KFLD                    SAKN
     C                   KFLD                    SAPRO
     C                   KFLD                    SAOPD
     C                   KFLD                    SASK
     C     SAML2K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSKN
     C                   KFLD                    YVALU             4
     C                   KFLD                    WSPRO
     C                   KFLD                    YOPD
     C                   KFLD                    YSK
     C     PSAMK2        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    WSKN
     C                   KFLD                    WSPRO
     C                   KFLD                    YOPD
     C                   KFLD                    YSK
     C     KODTWK        KLIST
     C                   KFLD                    KOWUNI
     C                   KFLD                    UAVD
     C*
     C                   MOVE      'W'           KOWUNI
     C     KODTWK        CHAIN     KOWR                               33
     C*
     C*
     C*
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UPRANT            2
     C                   PARM                    UIN01             1
     C     UIN01         COMP      '1'                                    27
     C*
     C                   MOVE      *ZEROS        WSPER
     C                   MOVE      UAVD          UAVDXX            4 0
     C                   MOVE      ' '           YSK               1
     C                   MOVE      *ZEROS        YOPD              7 0
     C                   MOVE      'H'           YHUNI             1
     C                   MOVE      'A'           YAUNI             1
     C                   MOVE      'Å'           YÅUNI             1
     C                   MOVE      *ZEROS        YKN               8 0
     C                   MOVE      *BLANKS       YNET              1
     C                   MOVE      *ZEROS        XPRANT            2 0
     C                   MOVE      *ZEROS        KUNDNR
     C                   MOVE      *ZEROS        XBRUTA
     C                   MOVEL     'F A K T '    XF2NV            16
     C                   MOVE      'U R A   '    XF2NV
     C                   MOVEL     'I N V O '    XF2NV2           16
     C                   MOVE      'I C E   '    XF2NV2
SV5  C*                    MOVELUMONTH    IDMMDD  40
SV5  C*                    MOVE UDAY      IDMMDD
SV5  C*                    MOVE IDMMDD    IDAG    60
SV5  C*                    MOVELUYEAR     IDAG
SV5  C*                    MOVE UYEAR     IDMMDD
SV5  C*                    MOVE IDMMDD    IDAGX
SV5  C*                    MOVELUDAY      IDAGX
NV5  C                   MOVE      *ZEROS        IDAG
NV5  C                   MOVE      UDAY          IDAGD
NV5  C                   MOVE      UMONTH        IDAGM
NV5  C                   MOVE      UYEAR         IDAGA
NV5  C     UYEAR         IFGT      50
NV5  C                   MOVEL     '19'          IDAGA
NV5  C                   ELSE
NV5  C                   MOVEL     '20'          IDAGA
NV5  C                   END
NV5  C                   MOVE      *ZEROS        AHADAT
NV5  C                   MOVE      *ZEROS        XHADAT
NV5  C                   MOVE      *ZEROS        AHBDAT
NV5  C                   MOVE      *ZEROS        XHBDAT
NV5  C                   MOVE      *ZEROS        FADATO
NV5  C                   MOVE      *ZEROS        XDTU2
NV5  C                   MOVE      *ZEROS        XFFDT
NV5  C                   MOVE      *ZEROS        XFFDT2
NV5  C                   MOVE      *ZEROS        WSDAT8
     C*
     C   27              GOTO      STINIT
     C*
     C     STINI1        TAG
     C                   EXFMT     BILDE01
     C* Hopp ut ved avbrudd
     C   03              GOTO      SLINIT
     C                   SETOFF                                       999897
     C                   SETOFF                                       969530
     C*
     C     WSAVD         IFNE      *ZEROS
     C     KODTAK        CHAIN     KODTA                              99
     C   99              MOVE      'SPA0002'     MSGNR
     C   99              GOTO      STINI1
     C                   END
     C* Dersom avdeling er gitt test gyldighet
     C* Dersom varsel alt er gitt - Ikke sjekk kundenr =0
     C   72WSKN          IFEQ      *ZEROS
     C                   SETOFF                                           72
     C                   GOTO      STINI2
     C                   END
     C  N72WSKN          IFEQ      *ZEROS
     C                   SETON                                            72
     C   98              MOVE      'SPK0002'     MSGNR
     C   98              GOTO      STINI1
     C                   END
     C* Test Periode
     C     STINI2        TAG
NV5  C                   MOVEL     WSPER         YDTMP             2 0
NV5  C                   MOVE      WSPER         YDTÅP             2 0
NV5  C     YDTÅP         IFGT      50
NV5  C                   MOVE      '19'          YDTCP             2 0
NV5  C                   ELSE
NV5  C                   MOVE      '20'          YDTCP
NV5  C                   END
     C     KODTÅK        CHAIN     KODTÅ                              96
     C   96              MOVE      'SPP0001'     MSGNR
     C   96              GOTO      STINI1
     C*
     C     STINIT        TAG
     C*
     C*
     C     WSKN          COMP      *ZEROS                             28
     C     WSPRO         COMP      *ZEROS                             29
     C     WSAVD         IFNE      0
     C                   MOVE      WSAVD         UAVD
     C     KODTHK        CHAIN     KODTH                              33
     C     KOHFAK        COMP      'J'                                    47
     C                   END
     C* koden for hode kan være J(topp/bunntekst), T(kuntopp)
     C* B(kun bunn) - videre setninger tar hensyn til dette.
     C     UHOD          IFEQ      'J'
     C                   SETON                                        4446
     C                   ELSE
     C     UHOD          IFEQ      'T'
     C                   SETOFF                                       44
     C                   SETON                                        46
     C                   ELSE
     C     UHOD          IFEQ      'B'
     C                   SETON                                        44
     C                   SETOFF                                       46
     C                   END
     C                   END
     C                   END
     C*
     C   44
     COR 46
     COR 47              DO
     C*** 44 PÅ SKRIVER UT BUNN     46 PÅ SKRIVER UT TOPP
     C     HODEK         CHAIN     HODE                               33
     C  N33              MOVE      HP            HO
     C                   MOVEL     'E'           YNET
     C     HODEK         CHAIN     HODE                               33
     C  N33              MOVE      HP            HE
     C                   MOVEL     'T'           YNET
     C     HODEK         CHAIN     HODE                               33
     C  N33              MOVE      HP            HT
     C                   END
     C*
     C*                    EXSR HMSG
     C     SLINIT        TAG
     C                   READ      FIRM                                   33
     C     FITAX         MULT      100           MVAPRO            4 2
     C                   MOVE      FITAX         FITAXB
     C*
     C                   ENDSR
     C***********************************************
     C     KDTFM1        BEGSR
     C***********************************************
SV5  C*                    MOVE XFFDT     XKDTFM
SV5  C*                    MOVELXFFDT     UDT1
SV5  C*                    MOVELXKDTFM    UDT2
SV5  C*                    MOVE XKDTFM    UDT3
NV5  C                   MOVE      XFFDTD        UDT1              2 0
NV5  C                   MOVE      XFFDTM        UDT2              2 0
NV5  C                   MOVE      XFFDTA        UDT3              2 0
     C                   EXSR      KDTFMT
SV5  C*                    MOVELUDT1      XFFDT
SV5  C*                    MOVELUDT2      XKDTFM
SV5  C*                    MOVE UDT3      XKDTFM
SV5  C*                    MOVE XKDTFM    XFFDT
NV5  C                   MOVE      UDT1          XFFDTD
NV5  C                   MOVE      UDT2          XFFDTM
NV5  C                   MOVE      UDT3          XFFDTA
SV5  C*
SV5  C*                    MOVE XDT       XKDTFM
SV5  C*                    MOVELXDT       UDT1
SV5  C*                    MOVELXKDTFM    UDT2
SV5  C*                    MOVE XKDTFM    UDT3
SV5  C*                    EXSR KDTFMT
SV5  C*                    MOVELUDT1      XDT
SV5  C*                    MOVELUDT2      XKDTFM
SV5  C*                    MOVE UDT3      XKDTFM
SV5  C*                    MOVE XKDTFM    XDT
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C*
     C                   ENDSR
     C*
     OFAKTR     E            OPDFAK
     O                       FAOPKO
     O                       FAKDA
     O                       FAKUNR
     O                       FAFAKT
NV5  O                       FACC
     O                       FAÅR
     O                       FAMND
     O                       FADATO
     O                       FADAFF
