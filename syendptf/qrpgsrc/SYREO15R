     H DFTACTGRP(*NO)
     FLLAGJL14  UF   E           K DISK
     FLLAGFLG1  UF   E           K DISK
     FLLAGJD01  UF   E           K DISK
     FLLAGJFE2  UF   E           K DISK
     FLLLISF    UF   E           K DISK
     FLLLTLL02  UF   E           K DISK
     FLLSERL03  UF   E           K DISK
     FLLMRFL01  UF   E           K DISK
     FLLBL1F    UF   E           K DISK
     FLLAGJFEU  UF   E           K DISK
      *
     FLLLINE    UF   E           K DISK
     FLLLINEE1  UF   E           K DISK
     FLLSERL02  UF   E           K DISK    RENAME(LLSERR:LLSERR2)
     FLLHEAD    UF   E           K DISK
     FLLHETXT   UF   E           K DISK
     FLLJUSF    UF   E           K DISK
     FLLJUSD    UF   E           K DISK
      *
     FFIRM      IF   E           K DISK

     d xdtf            S              8  0
     d xdtp            S              8  0
     d WhereC          s            512a
     d FirstW          s              1A
     d cQuote          C                   const('''')
     d SqlStm          s            512a
     d myrows0         s             10i 0
     d myrows          s             10i 0
     d myrows2         s             10i 0
     D XSLUTT          S              1A
     D XPOS            S              3  0
     D Error           S            150
     d X               S             10  0
     d X2              S             10  0
     D*ufil            S            256A
      *  Prototype for 'SYREO11C3'
     d*SYREO11C3       pr                  extpgm('SYREO11C3')
     d*ufil_                               like(ufil)
      *  Prototype for syreo12r5
     d syreo15r        pr
     d udtf_                               like(udtf)
     d udtp_                               like(udtp)
      *  *ENTRY Interface for Main Procedure
     d syreo15r        pi
     d udtf                           8
     d udtP                           8
      *
     d MyPoDS0         ds                  Qualified  dim(1)
     d  FIFIRM                        2A
     d MyPoDS          ds                  Qualified  dim(10000)
     d  VAMN                          7S 0
     d  VAANR                        15A
     d  VASALD                        7S 0
     d  VADATO                        8S 0
     d  VAMRNR                        5S 0
     d MyPoDS2         ds                  Qualified  dim(10000)
     d  LHMN                          7S 0
     d  LHTDT                         8S 0
     d  LHBNA                        30A
      *
      /free

         exsr init;

         dow xslutt <> 'J';
           exsr srinnlager;
         enddo;

         xslutt = 'N';
         dow xslutt <> 'J';
           exsr srutlager;
         enddo;

         *inlr = *on;
         return;

       //=====================================================================
       // Inn lager
       //=====================================================================
       begsr srinnlager;

       clear MyPoDS;
       SqlStm = 'Select VAMN, VAANR, VASALD, VADATO, VAMRNR ' +
                'from LLAGJF ' +
                'Where VADATO <> 0 and VADATO <= ' +
                %trim(udtf);
       Exec SQL PREPARE DynSel from :SqlStm;
       EXEC SQL DECLARE  A33  cursor for DynSel;
       Exec SQL OPEN A33;
       Myrows = %elem(MyPoDS);
       exec sql FETCH A33   for :MyRows rows
                  INTO :MyPoDs;
       Exec SQL CLOSE A33;

       if myrows > 0;
         for x = 1 to myrows;
           if mypods(x).vaanr = *blanks;
             xslutt = 'J';
             leave;
           endif;

           vamn   = mypods(x).vamn;
           vasald = mypods(x).vasald;
           vamrnr = mypods(x).vamrnr;

           if vasald = 0;
             exec sql
             delete from LLAGFLOG
             where vamn = :vamn
             with NC;

             exec sql
             delete from LLAGJD
             where vdmn = :vamn
             with NC;

             exec sql
             delete from LLAGJFE
             where vamn = :vamn
             with NC;

             exec sql
             delete from LLAGJFEU
             where vamn = :vamn
             with NC;

             exec sql
             delete from LLLISF
             where limn = :vamn
             with NC;

             exec sql
             delete from LLLTLF
             where ltmn = :vamn
             with NC;

             exec sql
             delete from LLSERF
             where snmn = :vamn
             with NC;

             exec sql
             delete from LLMRF
             where mrmrnr = :vamrnr
             with NC;

             exec sql
             delete from LLBL1F
             where blmrnr = :vamrnr
             with NC;

             exec sql
             delete from LLJUSF
             where ljmn = :vamn
             with NC;

             exec sql
             delete from LLJUSD
             where ljmn = :vamn
             with NC;

           // slett hovedpost
             exec sql
             delete from LLAGJF
             where vamn = :vamn
             with NC;

           endif;

         endfor;
       endif;

       endsr;

       //=====================================================================
       // Ut lager
       //=====================================================================
       begsr srutlager;

       clear MyPoDS2;
       SqlStm = 'Select LHMN, LHBNA, LHTDT ' +
                'from LLHEAD ' +
                'Where LHTDT <> 0 and LHTDT <= ' +
                %trim(udtf);
       Exec SQL PREPARE DynSel2 from :SqlStm;
       EXEC SQL DECLARE  A34  cursor for DynSel2;
       Exec SQL OPEN A34;
       Myrows2 = %elem(MyPoDS2);
       exec sql FETCH A34   for :MyRows2 rows
                  INTO :MyPoDs2;
       Exec SQL CLOSE A34;

       if myrows2 > 0;
         for x2 = 1 to myrows2;
           if mypods2(x2).lhbna = *blanks;
             xslutt = 'J';
             leave;
           endif;

           lhmn   = mypods2(x).lhmn;
           lhtdt  = mypods2(x).lhtdt;
           lhbna  = mypods2(x).lhbna;

           if vasald = 0;
             exec sql
             delete from LLAGFLOG
             where vamn = :vamn
             with NC;

             exec sql
             delete from LLAGJD
             where vdmn = :vamn
             with NC;

             exec sql
             delete from LLAGJFE
             where vamn = :vamn
             with NC;

             exec sql
             delete from LLAGJFEU
             where vamn = :vamn
             with NC;

             exec sql
             delete from LLLISF
             where limn = :vamn
             with NC;

             exec sql
             delete from LLLTLF
             where ltmn = :vamn
             with NC;

             exec sql
             delete from LLSERF
             where snmn = :vamn
             with NC;

             exec sql
             delete from LLMRF
             where mrmrnr = :vamrnr
             with NC;

             exec sql
             delete from LLBL1F
             where blmrnr = :vamrnr
             with NC;

           // slett hovedpost
             exec sql
             delete from LLAGJF
             where vamn = :vamn
             with NC;

           endif;

         endfor;
       endif;

       endsr;
      //***********************************************
       begsr init;
      //***********************************************
       xdtf = %float(udtf);
       xdtp = %float(udtp);

       SqlStm = 'Select * ' +
                'from FIRM ' +
                'FOR READ ONLY ';
       Exec SQL PREPARE DynSel0 from :SqlStm;
       EXEC SQL DECLARE  A30  cursor for DynSel0;
       Exec SQL OPEN A30;
       Myrows0 = %elem(MyPoDS0);
       exec sql FETCH A30   for :MyRows0 rows
                  INTO :MyPoDs0;
       Exec SQL CLOSE A30;
       FIFIRM = mypods0(1).fifirm;

       endsr;

      /end-free
