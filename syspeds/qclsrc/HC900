/********************************************************************/
/*                                                                  */
/* 5738SS1 V2R2M0 920925  Utdata fra RTVCLSRC    11.11.93 22.13.15  */
/*                                                                  */
/* Programnavn  . . . . . . . . . . . . . . :   HC900             PN*/
/* Biblioteknavn  . . . . . . . . . . . . . :   IBMPGM            PL*/
/* Opprinnelig kildefil . . . . . . . . . . :   QRGNSRC           SN*/
/* Biblioteknavn  . . . . . . . . . . . . . :   IBMSRCXX          SL*/
/* Opprinnelig kildekomponent . . . . . . . :   HC900             SM*/
/* Endring av kildefil                                              */
/*   dato/klokkeslett . . . . . . . . . . . :   05.11.93 12.58.18 SC*/
/* Valg for programretting  . . . . . . . . :   *NOPATCH          PO*/
/* Brukerprofil . . . . . . . . . . . . . . :   *USER             UP*/
/* Tekst  . . : Start bilagsregistrering                          TX*/
/* Eier . . . . . . . . . . . . . . . . . . :   QPGMR             OW*/
/* Endrings-ID for programretting . . . . . :                     PC*/
/* APAR-ID for programretting . . . . . . . :                     PA*/
/* Merke for brukerendring  . . . . . . . . :   *YES              UM*/
/*                                                                ED*/
/********************************************************************/
     PGM
     DCL VAR(&WIN01) TYPE(*LGL) LEN(1) VALUE('0')
     DCL VAR(&WIN03) TYPE(*LGL) LEN(1) VALUE('0')
     DCL VAR(&WIN13) TYPE(*CHAR) LEN(1) VALUE('0')
     DCL VAR(&WMEMBE) TYPE(*CHAR) LEN(8)
     DCL VAR(&WSTATU) TYPE(*CHAR) LEN(1)
     DCL VAR(&WSLUTT) TYPE(*CHAR) LEN(1)
     DCL VAR(&WNYSTR) TYPE(*CHAR) LEN(1)
     DCL VAR(&WVALG) TYPE(*CHAR) LEN(1)
     DCL VAR(&WUSER) TYPE(*CHAR) LEN(10)
     DCL VAR(&WJOBQ) TYPE(*CHAR) LEN(10)
     DCL VAR(&WHJOB) TYPE(*CHAR) LEN(1)
     DCL VAR(&HOLDJ) TYPE(*CHAR) LEN(5)
     DCL VAR(&WORK) TYPE(*CHAR) LEN(212)
     DCL VAR(&ANLEGG) TYPE(*CHAR) LEN(1) VALUE('J')
     MONMSG MSGID(CPF0000) EXEC(GOTO CMDLBL(MSG))
     CHGVAR VAR(&WORK) VALUE(%SST(*LDA 1 212))
NYFIRM: +
     CHGVAR VAR(&WUSER) VALUE(%SST(*LDA 45 10))
     CHGVAR VAR(&WIN13) VALUE('0')
     CHGVAR VAR(&WSLUTT) VALUE('0')
     CHGDTAARA DTAARA(*LDA (160 1)) VALUE('A')
     CALL PGM(HR900)
     CHGVAR VAR(&WSLUTT) VALUE(%SST(*LDA 303 1))
     IF COND(&WSLUTT = '1') THEN(GOTO CMDLBL(SLUTT))
     CHGVAR VAR(&WSLUTT) VALUE('0')
     CHGVAR VAR(&WMEMBE) VALUE(%SST(*LDA 162 8))
     CHGVAR VAR(&WSTATU) VALUE(%SST(*LDA 161 1))
     IF COND(&WSTATU = 'A') THEN(DO)
     ADDPFM FILE(AVKRF) MBR(&WMEMBE)
     ADDPFM FILE(POSAF) MBR(&WMEMBE)
     ADDPFM FILE(POSBF) MBR(&WMEMBE)
     ADDLFM FILE(AVKRL01) MBR(&WMEMBE) DTAMBRS((AVKRF (&WMEMBE)))
     ADDLFM FILE(POSAL01) MBR(&WMEMBE) DTAMBRS((POSAF (&WMEMBE)))
     ADDLFM FILE(POSBL01) MBR(&WMEMBE) DTAMBRS((POSBF (&WMEMBE)))
     ADDLFM FILE(POSBL02) MBR(&WMEMBE) DTAMBRS((POSBF (&WMEMBE)))
     ADDLFM FILE(POSBL04) MBR(&WMEMBE) DTAMBRS((POSBF (&WMEMBE)))
     ADDLFM FILE(POSBL05) MBR(&WMEMBE) DTAMBRS((POSBF (&WMEMBE)))
     CHKOBJ OBJ(TPAN070) OBJTYPE(*PGM)
     MONMSG MSGID(CPF0000) EXEC(CHGVAR VAR(&ANLEGG) VALUE('N'))
     IF COND(&ANLEGG *EQ 'J') THEN(DO)
     ADDPFM FILE(TPANI1F) MBR(&WMEMBE)
     ADDLFM FILE(TPANI101) MBR(&WMEMBE) DTAMBRS((TPANI1F (&WMEMBE)))
     ENDDO
     ENDDO
     ALCOBJ OBJ((*LIBL/AVKRF *FILE *EXCL &WMEMBE)) WAIT(0)
     MONMSG MSGID(CPF1002) EXEC(DO)
     SNDPGMMSG MSG('Bilagsbunken er i bruk av samme bruker som du har-
 logget på med.')
     GOTO CMDLBL(SLUTT)
     ENDDO
     DLCOBJ OBJ((*LIBL/AVKRF *FILE *EXCL &WMEMBE))
     MONMSG MSGID(CPF0000)
     OVRDBF FILE(AVKRF) MBR(&WMEMBE)
     OVRDBF FILE(AVKRL01) MBR(&WMEMBE)
     OVRDBF FILE(POSBF) MBR(&WMEMBE) SHARE(*YES)
     OVRDBF FILE(POSBL01) MBR(&WMEMBE) SHARE(*YES)
     OVRDBF FILE(POSBL02) MBR(&WMEMBE) SHARE(*YES)
     OVRDBF FILE(POSBL04) MBR(&WMEMBE) SHARE(*YES)
     OVRDBF FILE(POSBL05) MBR(&WMEMBE) SHARE(*YES)
     OVRDBF FILE(POSAL01) MBR(&WMEMBE) SHARE(*YES)
     OVRDBF FILE(KHEDL01) SHARE(*YES)
     OVRDBF FILE(LEVEL01) SHARE(*YES)
     OVRDBF FILE(LEVEL02) SHARE(*YES)
     OVRDBF FILE(LRESF) SHARE(*YES)
     OVRDBF FILE(LREHL05) SHARE(*YES)
     OVRDBF FILE(HPOHL02) SHARE(*YES)
     OVRDBF FILE(KONTL01) SHARE(*YES)
     OVRDBF FILE(VALUL01) SHARE(*YES)
     OVRDBF FILE(KODAL01) SHARE(*YES)
     OVRDBF FILE(KODBL01) SHARE(*YES)
     OVRDBF FILE(KODTL01) SHARE(*YES)
     OVRDBF FILE(SYSHL01) SHARE(*YES)
     OVRDBF FILE(SYSBL01) SHARE(*YES)
     OVRDBF FILE(PROSL01) SHARE(*YES)
     IF COND(&ANLEGG *EQ 'J') THEN(DO)
     OVRDBF FILE(TPANI1F) MBR(&WMEMBE) SHARE(*YES)
     ENDDO
     CALL PGM(HR910)
     CHGVAR VAR(&WIN13) VALUE(%SST(*LDA 310 1))
     CHGVAR VAR(&WVALG) VALUE(%SST(*LDA 311 1))
     CHGVAR VAR(&WSTATU) VALUE(%SST(*LDA 161 1))
     IF COND(&WVALG = '1') THEN(DO)
     IF COND(&WSTATU = 'A') THEN(DO)
     RMVM FILE(POSAL01) MBR(&WMEMBE)
     MONMSG MSGID(CPF0000)
     RMVM FILE(POSBL01) MBR(&WMEMBE)
     MONMSG MSGID(CPF0000)
     RMVM FILE(POSBL02) MBR(&WMEMBE)
     MONMSG MSGID(CPF0000)
     RMVM FILE(POSBL04) MBR(&WMEMBE)
     MONMSG MSGID(CPF0000)
     RMVM FILE(POSBL05) MBR(&WMEMBE)
     MONMSG MSGID(CPF0000)
     RMVM FILE(AVKRL01) MBR(&WMEMBE)
     MONMSG MSGID(CPF0000)
     RMVM FILE(POSAF) MBR(&WMEMBE)
     MONMSG MSGID(CPF0000)
     RMVM FILE(POSBF) MBR(&WMEMBE)
     MONMSG MSGID(CPF0000)
     RMVM FILE(AVKRF) MBR(&WMEMBE)
     MONMSG MSGID(CPF0000)
     IF COND(&ANLEGG *EQ 'J') THEN(DO)
     RMVM FILE(TPANI1F) MBR(&WMEMBE)
     MONMSG MSGID(CPF0000)
     RMVM FILE(TPANI101) MBR(&WMEMBE)
     MONMSG MSGID(CPF0000)
     ENDDO
     ENDDO
     GOTO CMDLBL(END)
     ENDDO
     CHGDTAARA DTAARA(*LDA (290 10)) VALUE('HR940U01')
     CHGDTAARA DTAARA(*LDA (213 10)) VALUE('HC900')
TAG002: +
     CALL PGM(VR001) PARM(&WIN01 &WIN03)
     IF COND(&WIN03 = '1') THEN(GOTO CMDLBL(TAG002))
     IF COND(&WIN01 = '1') THEN(GOTO CMDLBL(TAG002))
     CHGVAR VAR(&WJOBQ) VALUE(%SST(*LDA 201 10))
     CHGVAR VAR(&WHJOB) VALUE(%SST(*LDA 211 1))
     IF COND(&WHJOB *EQ 'J') THEN(CHGVAR VAR(&HOLDJ) VALUE('*YES'))
     IF COND(&WHJOB *EQ ' ') THEN(CHGVAR VAR(&HOLDJ) VALUE('*NO'))
TAG003: +
     IF COND(&WVALG = '2') THEN(DO)
     SBMJOB JOB(JOURNAL) JOBD(*LIBL/QBATCH) JOBQ(&WJOBQ) RQSDTA('CALL-
 HC920') HOLD(&HOLDJ)
     GOTO CMDLBL(SBM)
     ENDDO
TAG004: +
     IF COND(&WVALG = '3') THEN(DO)
     SBMJOB JOB(DAGBOK) JOBD(*LIBL/QBATCH) JOBQ(&WJOBQ) RQSDTA('CALL -
HC930') HOLD(&HOLDJ)
     GOTO CMDLBL(SBM)
     ENDDO
SBM: +
     SNDPGMMSG MSG('Oppdatering/utskrift er sendt til jobbkø')
END: +
     RCLRSC
     IF COND(&WIN13 = '1') THEN(DO)
     CHGDTAARA DTAARA(*LDA (315 1)) VALUE('A')
     CALL PGM(VC005)
     CHGDTAARA DTAARA(*LDA (315 1)) VALUE(' ')
     CHGVAR VAR(&WNYSTR) VALUE(%SST(*LDA 301 1))
     IF COND(&WSLUTT = '1') THEN(GOTO CMDLBL(SLUTT))
     GOTO CMDLBL(NYFIRM)
     ENDDO
     GOTO CMDLBL(SLUTT)
MSG: +
     SNDPGMMSG MSGID(RGN0100) MSGF(IBMMSG) MSGDTA('BILAGSREG HC900')
     MONMSG MSGID(CPF0000) EXEC(GOTO CMDLBL(SLUTT))
SLUTT: +
     CHGDTAARA DTAARA(*LDA (160 1)) VALUE(' ')
     CHGDTAARA DTAARA(*LDA (213 812)) VALUE(' ')
     CHGDTAARA DTAARA(*LDA (1 212)) VALUE(&WORK)
     ENDPGM
