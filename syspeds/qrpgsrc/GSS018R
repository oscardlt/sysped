********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 ny dangerous goods logikk
10029 * 02 YBC PTF10 NY MODUS FOR Å ENDRE KOLLI NÅR STATUS > '0'
********************************************************************
      *
      **************************************************************
      *** PROGRAM SKAL ARBEIDE MED LOKASJONER
      **************************************************************
      *
     FGSSORF    IF   E           K DISK
     FGSSOLF    UF A E           K DISK
     FLLLSDF    IF   E           K DISK
     FLLULLF    IF   E           K DISK
     FGSS018D   CF   E             WORKSTN
     F                                     SFILE(GSS018DA:ZRECNO)
     F                                     INFDS(FBAREA)
     D                 DS
     D  WRLLOK                 1     25
     D  WRLOK1                 1      5
     D  WSLC                   6     25
     D  LS                     6     14
     D                                     DIM(9)
     D  LS2                   15     25
     D  LS2L                   6      7
     D  LS2B                   8      9
     D  LS2H                  10     11
     D  LS3L                   6      8
     D  LS3B                   9     11
     D  LS3H                  12     14
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
      *
     C                   EXSR      INIT
      *
     C     GOLKM         SETGT     GSSOLF
     C                   MOVE      'N'           XSLT              1
     C     UONO          READPE    GSSOLF                                 33
     C     *IN33         DOWEQ     '0'
     C     OLLNO         IFGT      UCLI
     C     XSLT          OREQ      'J'
     C                   DELETE    GSSOLFR
     C     OLLC          IFNE      *BLANKS
N02  C     XDELENDRING   ANDNE     'J'
     C                   MOVE      'J'           XSLT
     C                   END
     C                   ELSE
     C                   IF        ((OLSTD <> UPOS1) AND (OLSTD = ORPOS2))
     C                   MOVE      UPOS1         OLSTD
     C                   END
     C                   IF        ((OLSTD <> UPOS1) AND (OLTNO <> 0))
     C                   MOVE      UPOS1         OLSTD
     C                   END
     C     OLSTD         IFEQ      UPOS1
     C                   UPDATE    GSSOLFR
     C                   LEAVE
     C                   ELSE
     C                   DELETE    GSSOLFR
     C                   END
     C                   END
     C     UONO          READPE    GSSOLF                                 33
     C  N33              ENDDO
     C                   MOVE      *ZEROS        OLLNO
      *
     C     START         TAG
     C                   MOVE      '1'           *IN(93)
     C                   WRITE     GSS018DB
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
     C                   MOVE      *BLANKS       WSNR
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     UONO          SETLL     GSSOLF
     C     UONO          READE(N)  GSSOLF                                 94
     C     *IN94         DOWEQ     '0'
     C                   ADD       1             ZRECNO
     C                   WRITE     GSS018DA
     C     UONO          READE(N)  GSSOLF                                 94
     C  N94              ENDDO
      *
     C     *IN27         IFEQ      '0'
     C     *IN28         ANDEQ     '0'
     C     UCLI          ANDLE     99
     C                   MOVE      UPOS1         OLSTD
     C                   MOVE      *BLANKS       OLST
     C                   MOVE      *BLANKS       OLLC
     C                   MOVE      *ZEROS        OLBOX
     C                   MOVE      ORTNO         OLTNO
     C                   MOVE      *BLANKS       OLMN
     C     ZRECNO        DOWLT     UCLI
     C                   ADD       1             ZRECNO
     C                   ADD       1             OLLNO
     C                   WRITE     GSSOLFR
     C                   WRITE     GSS018DA
     C                   ENDDO
     C                   END
     C                   MOVE      ZRECNO        YRECNO            4 0
     C     *IN29         CABEQ     '1'           SLUTT
     C     ZRECNO        IFGT      1
     C                   Z-ADD     1             ZRECNO
     C                   END
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
      *
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     ZRECNO        IFEQ      0
     C                   EXFMT     GSS018DG
     C                   ELSE
     C                   WRITE     GSS018DB
     C                   EXFMT     GSS018DC
     C                   END
      *
      *** AVSLUTT
     C                   MOVE      '0'           *IN30
     C                   MOVEA     '00'          *IN(98)
      *
     C   05              GOTO      START
     C   12              GOTO      SLUTT
      *
      *** BLA VIDERE
     C   25              DO
     C                   MOVE      '0'           *IN25
     C                   GOTO      START3
     C                   END
      *
     C     ZRECNO        IFNE      0
     C                   EXSR      HENT
     C                   END
     C                   GOTO      START3
      *
     C     SLUTT         TAG
     C  N27              EXSR      OPPDAT
     C                   SETON                                        LR
     C                   RETURN
      *
     C***********************************************
     C     OPPDAT        BEGSR
     C***********************************************
     C     UONO          SETLL     GSSOLF
     C     UONO          READE     GSSOLF                                 33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    GSSOLFR
     C     UONO          READE     GSSOLF                                 33
     C  N30              ENDDO
      *
     C                   MOVE      UPOS1         OLSTD
     C     1             DO        YRECNO        ZRECNO
     C     ZRECNO        CHAIN     GSS018DA                           33
     C                   IF        OLTNO = 0
     C                   IF        OLBOX = *ZEROS
     C                   MOVE      ' '           OLST
     C                   ELSE
     C                   MOVE      'L'           OLST
     C                   END
     C                   END
     C                   WRITE     GSSOLFR
     C                   ENDDO
      *
N01  c                   call      'GSS077R'
N01  C                   PARM                    UONO
     C                   ENDSR
      *
     C***********************************************
     C     TESTB         BEGSR
     C***********************************************
     C     UPOS1         CHAIN     LLLSDF                             90
     C     *IN90         IFEQ      '0'
     C     WSLC          IFEQ      *BLANKS
     C                   MOVE      '1'           *IN30
     C                   MOVE      'YBC1814'     MSGNR
     C                   GOTO      SLTB
     C                   ELSE
     C     GLCK          CHAIN     LLULLF                             33
     C     *IN33         IFEQ      '0'
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN90
     C                   MOVE      'YBC1721'     MSGNR
     C                   GOTO      SLTB
     C                   END
     C     LSLENG        IFNE      0
     C     LSLENG        IFGE      100
     C     LSBRED        ORGE      100
     C     LSHØYD        ORGE      100
     C                   Z-ADD     9             XN                2 0
     C                   ELSE
     C                   Z-ADD     6             XN
     C                   END
     C     1             DO        XN            XN2               5 0
     C     LS(XN2)       IFLT      '0'
     C     LS(XN2)       ORGT      '9'
     C                   MOVE      '1'           *IN30
     C                   MOVE      'YBC0867'     MSGNR
     C                   GOTO      SLTB
     C                   END
     C                   ENDDO
     C                   MOVE      *ZEROS        XSLENG            3 0
     C                   MOVE      *ZEROS        XSBRED            3 0
     C                   MOVE      *ZEROS        XSHØYD            3 0
     C     LSLENG        IFGE      100
     C     LSBRED        ORGE      100
     C     LSHØYD        ORGE      100
     C                   MOVE      LS3L          XSLENG
     C                   MOVE      LS3B          XSBRED
     C                   MOVE      LS3H          XSHØYD
     C                   ELSE
     C                   MOVE      LS2L          XSLENG
     C                   MOVE      LS2B          XSBRED
     C                   MOVE      LS2H          XSHØYD
     C                   END
     C     LSLENG        IFLT      XSLENG
     C     LSBRED        ORLT      XSBRED
     C     LSHØYD        ORLT      XSHØYD
     C                   MOVE      '1'           *IN30
     C                   MOVE      'YBC0867'     MSGNR
     C                   GOTO      SLTB
     C                   END
     C                   MOVE      *BLANKS       LS2
     C                   END
     C                   END
     C                   ELSE
     C                   MOVE      '1'           *IN30
     C                   MOVE      'JOV1227'     MSGNR
     C                   GOTO      SLTB
     C                   END
      *** OPPDATERE PÅ SUBFIL
     C                   MOVE      WSLC          OLLC
     C                   MOVE      WSBOX         OLBOX
     C                   MOVE      WSMN          OLMN
     C                   MOVE      ' '           WSNR
     C                   UPDATE    GSS018DA
     C                   WRITE     GSS018DB
     C                   MOVE      *BLANKS       WSLC
     C                   MOVE      *ZEROS        WSBOX
     C                   MOVE      *BLANKS       WSMN
      *
     C     SLTB          ENDSR
      *
     C***********************************************
     C     HENT          BEGSR
     C***********************************************
     C                   MOVE      *BLANKS       MSGNR
     C                   MOVEA     '000'         *IN(90)
     C                   MOVE      '0'           *IN99
     C     *IN98         DOWEQ     '0'
     C                   READC     GSS018DA                               98
     C   98              DO
     C   99              MOVE      '0'           *IN98
     C                   GOTO      SLHENT
     C                   END
      *
     C     ZRECNO        DIV       8             LINNBR
     C                   MVR                     XLIN              1 0
     C     XLIN          IFEQ      0
     C                   Z-ADD     12            LINNBR
     C                   ELSE
     C                   ADD       4             LINNBR
     C                   END
      *
     C  N27WSNR          IFEQ      '2'
     C                   EXSR      CHGLC
     C                   END
      *
     C     WSNR          IFEQ      '5'
     C                   EXSR      DSPLC
     C                   END
      *
     C     WSNR          IFEQ      '7'
     C                   EXSR      WRKLC
     C                   END
     C                   MOVE      '1'           *IN99
      *
     C                   END
      *
     C     SLHENT        TAG
     C                   MOVE      '0'           *IN99
     C   98MSGNR         IFEQ      *BLANKS
     C                   MOVE      'GSS0009'     MSGNR
     C                   END
     C   98              MOVE      '1'           *IN30
     C  N30              Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
      *
     C                   ENDSR
      *
     C***********************************************
     C     CHGLC         BEGSR
     C***********************************************
     C                   MOVE      OLLC          WSLC
     C                   MOVE      OLBOX         WSBOX
     C                   MOVE      OLMN          WSMN
     C                   MOVE      '1'           *IN99
     C     STCHG         TAG
     C                   EXFMT     GSS018DD
     C                   MOVE      '0'           *IN90
     C                   MOVE      '0'           *IN30
      *
     C   12              DO
     C                   UPDATE    GSS018DA
     C                   MOVE      *BLANKS       WSLC
     C                   MOVE      *ZEROS        WSBOX
     C                   MOVE      *BLANKS       WSMN
     C                   END
     C  N12              EXSR      TESTB
     C  N12
     CAN 30              GOTO      STCHG
      *
     C     XLIN          IFEQ      0
     C                   Z-ADD     12            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     DSPLC         BEGSR
     C***********************************************
     C                   MOVE      '1'           *IN99
     C                   EXFMT     GSS018DE
      *
     C                   MOVE      ' '           WSNR
     C                   UPDATE    GSS018DA
     C     XLIN          IFEQ      0
     C                   Z-ADD     12            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     WRKLC         BEGSR
     C***********************************************
     C                   CALL      'GSS027R'
     C                   PARM                    UONO
     C                   PARM      OLLNO         ULNO              2 0
     C                   PARM                    UTYPE
      *
     C                   MOVE      ' '           WSNR
     C                   UPDATE    GSS018DA
     C     XLIN          IFEQ      0
     C                   Z-ADD     12            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     GLCK          KLIST
     C                   KFLD                    UPOS1
     C                   KFLD                    WSLC
     C     GOLKM         KLIST
     C                   KFLD                    UONO
     C                   KFLD                    YLNO
     C                   Z-ADD     99            YLNO              2 0
      *
     C     *ENTRY        PLIST
     C     OLONO         PARM                    UONO              7 0
     C                   PARM                    UTYPE             3
     C                   PARM                    UPOS1             5
     C                   PARM                    UCLI              5 0
      *
     C     OLONO         CHAIN     GSSORF                             33
     C     UTYPE         COMP      'DSP'                                  27
     C     UTYPE         COMP      'BOX'                                  28
N02  C     UTYPE         IFEQ      'CH3'
N02  C                   MOVE      'J'           XDELENDRING       1
N02  C                   MOVE      'CH2'         UTYPE
N02  C                   END
     C     UTYPE         COMP      'CH2'                                  29
     C                   WRITE     WINDOWSZ
      *
     C                   ENDSR
      *
