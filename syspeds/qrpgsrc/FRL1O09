      *********************************************************************
     H debug(*yes)
      *
CRTPG+*  CRTPGM SYSPED/FRl1O09 MODULE(*LIBL/FRL1O09 *LIBL/INCGI)
CRTPGM*         ACTGRP(CGI) AUT(*USE)
      *
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
     FBRPARF    if   e           k disk    usropn
     FPRISLH    IF   E           K DISK    USROPN
      *********************************************************************
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      /copy syspeds/qrpgsrcpy,variables3
      *
      * Alle databasefelter med tilhørende skjermvariabel
      *
      * PRISLD
      *
     D PRH_FIR         S              2
     D WRH_FIR         S              2
     D PRH_PLN         S              5  0
     D WRH_PLN         S              5
     D PRH_KNK         S             35
     D WRH_KNK         S             35
     D PRH_KNR         S              8  0
     D WRH_KNR         S              8
     D PRH_SEAN        S             13  0
     D WRH_SEAN        S             13
     D PRH_SNA1        S             35
     D WRH_SNA1        S             35
     D PRH_SNA2        S             35
     D WRH_SNA2        S             35
     D PRH_SNA3        S             35
     D WRH_SNA3        S             35
     D PRH_SGAT        S             35
     D WRH_SGAT        S             35
     D PRH_SPNR        S              8
     D WRH_SPNR        S              8
     D PRH_SSTE        S             35
     D WRH_SSTE        S             35
     D PRH_LEV1        S             70
     D WRH_LEV1        S             70
     D PRH_LEV2        S             70
     D WRH_LEV2        S             70
     D PRH_LEV3        S             70
     D WRH_LEV3        S             70
     D PRH_LEV4        S             70
     D WRH_LEV4        S             70
     D PRH_LEV5        S             70
     D WRH_LEV5        S             70
     D PRH_LEV6        S             70
     D WRH_LEV6        S             70
     D PRH_LEV7        S             70
     D WRH_LEV7        S             70
     D PRH_LEV8        S             70
     D WRH_LEV8        S             70
     D PRH_LEV9        S             70
     D WRH_LEV9        S             70
     D PRH_ANN1        S             70
     D WRH_ANN1        S             70
     D PRH_ANN2        S             70
     D WRH_ANN2        S             70
     D PRH_ANN3        S             70
     D WRH_ANN3        S             70
     D PRH_ANN4        S             70
     D WRH_ANN4        S             70
     D PRH_ANN5        S             70
     D WRH_ANN5        S             70
     D PRH_ANN6        S             70
     D WRH_ANN6        S             70
     D PRH_ANN7        S             70
     D WRH_ANN7        S             70
     D PRH_ANN8        S             70
     D WRH_ANN8        S             70
     D PRH_ANN9        S             70
     D WRH_ANN9        S             70
     D PRH_HTM         S             70
     D WRH_HTM         S             70
      *
      * VAREL01
      *
OddEvD OddEven         s             10
     D USER            s             10
     D lenke           s            200
     D lenke0          s            200
     D lenket          s             20
      * Variables used to load the external html source member
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
      * Other variables
      *
      *
      *
      *
      /copy syspeds/qrpgsrcpy,prolog3
      *
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Les iput parametr
     C                   exsr      Parse
      *
     C                   dump
      * Initiering
     C                   EXSR      INIT
      * Read output skeleton html member into memory
     C                   exsr      LoadHtml
      * Set section variables
     C                   exsr      SetTop
      * Send section top
     C                   callp     wrtsection('top')
      * finn vare
     C                   exsr      lesvare
      * Send section bot
      *
     C                   callp     wrtsection('bot')
      * Quit
     C                   exsr      Exit
      *
     C                   eval      *inlr = *on
     C                   return
      *
      *
      *********************************************************************
     C     Parse         begsr
      *********************************************************************
      * Leser varens key
     C                   eval      USER      = zhbgetvar('USER')
     C                   eval      PRH_FIR   = zhbgetvar('FIRMA')
     C                   eval      WRH_KNR   = zhbgetvar('KUNDNA')
     C                   eval      PRH_KNR   = c2n2(WRH_KNR)
     C                   eval      WRH_PLN   = zhbgetvar('PRINR')
     C                   eval      PRH_PLN   = c2n2(WRH_PLN)
     C                   endsr
      *********************************************************************
     C     Exit          begsr
      *********************************************************************
      * lukk filer
     C                   callp     wrtsection('*fini')
      * Quit
     C                   CLOSE     BRIDF
     C                   close     BRPARF
     C                   CLOSE     PRISLH
     C                   return
     C                   endsr
      *********************************************************************
     C     LoadHtml      begsr
      *********************************************************************
      * Read output skeleton html member into memory
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC'
     C                   eval      Mbr = 'FRL1O09'
     C                   CAT       XSPRÅK:0      MBR
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
     C                   endsr
      *********************************************************************
     C     SetTop        begsr
      *********************************************************************
      *  Set variable data for section /$top
      *
     C* klargjøre HTMLvariable
      *
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
      *
     C                   endsr
      *
      *********************************************************************
     C     lesvare       begsr
      *********************************************************************
      * leser vare informasjon i prislib
      *
     C     KPRISLH       chain     PRISLH                             33
     c                   dump
      *
     C* klargjøre HTMLvariable - SEND ROW
      *
      * Prislistenummer
     C                   callp     updHTMLvar('WRH_PLN':
     C                             %trim(%editc(PRH_PLN:'Z')))
      * navn liste
     C                   callp     updHTMLvar('WRH_KNK':PRH_KNK)
      * L1 Firmakode
     C                   callp     updHTMLvar('WRH_FIR':PRH_FIR)
      * kundenr
     C                   callp     updHTMLvar('WRH_KNR':
     C                             %trim(%editc(PRH_KNR:'Z')))
      * EAN
     C                   callp     updHTMLvar('WRH_SEAN':
     C                             %trim(%editc(PRH_SEAN:'Z')))
      * KUNDEOPPLYSNINGER
     C                   callp     updHTMLvar('WRH_SNA1':PRH_SNA1)
     C                   callp     updHTMLvar('WRH_SNA2':PRH_SNA2)
     C                   callp     updHTMLvar('WRH_SNA3':PRH_SNA3)
     C                   callp     updHTMLvar('WRH_SGAT':PRH_SGAT)
     C                   callp     updHTMLvar('WRH_SPNR':PRH_SPNR)
     C                   callp     updHTMLvar('WRH_SSTE':PRH_SSTE)
      * lev 1
     C                   callp     updHTMLvar('WRH_LEV1':PRH_LEV1)
      * lev 2
     C                   callp     updHTMLvar('WRH_LEV2':PRH_LEV2)
      * lev 3
     C                   callp     updHTMLvar('WRH_LEV3':PRH_LEV3)
      * lev 4
     C                   callp     updHTMLvar('WRH_LEV4':PRH_LEV4)
      * lev 5
     C                   callp     updHTMLvar('WRH_LEV5':PRH_LEV5)
      * lev 6
     C                   callp     updHTMLvar('WRH_LEV6':PRH_LEV6)
      * lev 7
     C                   callp     updHTMLvar('WRH_LEV7':PRH_LEV7)
      * lev 8
     C                   callp     updHTMLvar('WRH_LEV8':PRH_LEV8)
      * lev 9
     C                   callp     updHTMLvar('WRH_LEV9':PRH_LEV9)
      * ann 1
     C                   callp     updHTMLvar('WRH_ANN1':PRH_ANN1)
      * ann 2
     C                   callp     updHTMLvar('WRH_ANN2':PRH_ANN2)
      * ann 3
     C                   callp     updHTMLvar('WRH_ANN3':PRH_ANN3)
      * ann 4
     C                   callp     updHTMLvar('WRH_ANN4':PRH_ANN4)
      * ann 5
     C                   callp     updHTMLvar('WRH_ANN5':PRH_ANN5)
      * ann 6
     C                   callp     updHTMLvar('WRH_ANN6':PRH_ANN6)
      * ann 7
     C                   callp     updHTMLvar('WRH_ANN7':PRH_ANN7)
      * ann 8
     C                   callp     updHTMLvar('WRH_ANN8':PRH_ANN8)
      * ann 9
     C                   callp     updHTMLvar('WRH_ANN9':PRH_ANN9)
      * kat.bane produkt
     c     PRH_HTM       ifne      *blanks
     c                   eval      lenke0=PRH_HTM
     c                   eval      lenket='Prisliste katalog'
     C                   exsr      genlenke
     C                   callp     updHTMLvar('WRH_HTM':LENKE)
     c                   else
     c                   eval      lenke='Prisliste katalog mangler'
     C                   callp     updHTMLvar('WRH_HTM':LENKE)
     c                   end
      *
      * skriver ut bilde
     C                   callp     wrtsection('head')
      *
     C                   endsr
      *
      *********************************************************************
     C     INIT          begsr
      *********************************************************************
      *  INITIER
     C                   OPEN      BRIDF
     C     USER          CHAIN     BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
      *
OddEv * hent Parametre som går igjen i mange prog:
OddEv *      Odd/Even/Rowhead-farger,Logobilde,Språk,Intern/Ekstern bruker,  mm
OddEvc                   call      'ESGETPAR'
OddEvc                   parm                    BIBRID
OddEvc                   parm                    BIFIRM
OddEvc                   parm                    BIKUNR
OddEvc                   parm                    BIKNG
OddEvc                   parm                    RowHead          10
OddEvc                   parm                    Odd              10
OddEvc                   parm                    Even             10
OddEvc                   parm                    LogoImg          50
OddEvc                   parm                    XSPRÅK            2
OddEvc                   parm                    XINTERN           1
OddEvc                   parm                    ParmDS1        1024
OddEvc                   parm                    ParmDS2        1024
OddEvc                   parm                    ParmDS3        1024
      *
     C                   OPEN      BRPARF
     C                   OPEN      PRISLH
      * Key for PRISLH
     C     KPRISLH       KLIST
     C                   KFLD                    PRH_FIR
     C                   KFLD                    PRH_PLN
     c     BRPARFK       klist
     c                   kfld                    PABRID
     c                   kfld                    PAKUNR
     c                   kfld                    PAID
     C                   endsr
     C***********************************************
     C     genlenke      BEGSR
     C***********************************************
     c                   move      *BLANKS       LENKE
     c                   movel     '<a href="'   LENKE
     C     LENKE         CAT       LENKE0:0      LENKE
     C     LENKE         CAT       '" target="':0LENKE
     C     LENKE         CAT       '_BLANK"':0   LENKE
     C     LENKE         CAT       '">':0        LENKE
     C     LENKE         CAT       LENKET:0      LENKE
     C     LENKE         CAT       '</a>':0      LENKE
     c                   endsr
