     FDKIV      UF   E           K DISK
     FDKIH      IF   E           K DISK
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    USYAV             4
     C                   PARM                    USYOP             7
     C                   PARM                    USYLI             2
     C                   MOVE      USYAV         UKIH_SYAV
     C                   MOVE      USYOP         UKIH_SYOP
     C                   MOVE      USYLI         UKIV_SYLI
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    DKIH_SYAV     UKIH_SYAV
     C     *LIKE         DEFINE    DKIH_SYOP     UKIH_SYOP
     C     *LIKE         DEFINE    DKIV_SYLI     UKIV_SYLI
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYA          KLIST
     C                   KFLD                    UKIH_SYAV
     C                   KFLD                    UKIH_SYOP
     C     KEYB          KLIST
     C                   KFLD                    UKIH_SYAV
     C                   KFLD                    UKIH_SYOP
     C                   KFLD                    UKIV_SYLI
      *_____________
      * Init av felt
      *"""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Læs varuposter                                       SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
      * Hent hovedopplysninger
     C     KEYA          CHAIN     DKIH
      * Les varepost
     C     KEYB          CHAIN     DKIV                               51
     C                   IF        *IN51 = *OFF
     C                   EXSR      AVG
     C                   UPDATE    DKIVR
     C
     C                   ENDIF
     C                   ENDSR
      *_________________________________________________
      * Avgiftsberækning                             AVG
      *"""""""""""""""""""""""""""""""""""""""""""""""""
     C     AVG           BEGSR
      * Regn ut faktor for T17A og T19A
     C                   IF        DKIH_222 > 0
     C     DKIV_42       DIV       DKIH_222      ZFAKTOR          18 8
     C                   ENDIF
      * Rækna ut T17A
     C     DKIH_12E      MULT      ZFAKTOR       DKIV_T17A
      * Rækna ut T19
     C     DKIH_201      IFNE      'DDU'
     C     DKIH_201      IFNE      'DDP'
     C     DKIH_12       MULT      ZFAKTOR       DKIV_T19
     C                   ENDIF
     C                   ENDIF
      * Sum alla T-værden + stat.værde
     C                   Z-ADD     0             DKIV_T18
     C                   Z-ADD     0             DKIV_T23
     C                   Z-ADD     0             DKIV_T24
     C     DKIV_42       ADD       DKIV_T11B     W11A             17 0
     C     W11A          MULT(H)   DKIH_221B     DKIV_T12
     C                   IF        DKIH_221C > 0
     C     DKIV_T12      DIV       DKIH_221C     DKIV_T12
     C                   ENDIF

     C                   ADD       DKIV_T13A     DKIV_T18
     C                   ADD       DKIV_T13B     DKIV_T18
     C                   ADD       DKIV_T13C     DKIV_T18
     C                   ADD       DKIV_T14A     DKIV_T18
     C                   ADD       DKIV_T14B     DKIV_T18
     C                   ADD       DKIV_T14C     DKIV_T18
     C                   ADD       DKIV_T14D     DKIV_T18
     C                   ADD       DKIV_T15      DKIV_T18
     C                   ADD       DKIV_T16      DKIV_T18
     C                   ADD       DKIV_T17A     DKIV_T18
     C                   ADD       DKIV_T17B     DKIV_T18
     C                   ADD       DKIV_T17C     DKIV_T18

     C                   ADD       DKIV_T19      DKIV_T23
     C                   ADD       DKIV_T20      DKIV_T23
     C                   ADD       DKIV_T21B     DKIV_T23
     C                   ADD       DKIV_T22      DKIV_T23

     C                   ADD       DKIV_T12      DKIV_T24
     C                   ADD       DKIV_T18      DKIV_T24
     C                   SUB       DKIV_T23      DKIV_T24
      * Statistiskt værde
     C                   Z-ADD     DKIV_T24      DKIV_46

     C                   ENDSR
