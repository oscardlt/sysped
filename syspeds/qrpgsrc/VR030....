SY    *   SYSTEMA ENDRINGER MERKET SY I MARGEN         ***************
      /TITLE   V E D L I K E H O L D   A V   K U N D E F I L E N
N55
N55  H COPYRIGHT('Copyright 3.PART AS')
N55  H OPTION(*NODEBUGIO)
N55
      *****************************************************************
      *   5797-AWD    IBM NORWAY 1988                                 *
      *   5797-AWD    COPYRIGHT IBM CORP 1988                         *
      *   REFER TO INSTRUCTIONS ON COPYRIGHT NOTICE NO. G120-2083     *
      *****************************************************************
      *  Det er foretatt endringer i dette program.
E55   *  Endringer er foretatt ifølge endringsmelding nr: 55
N55   *
N55   * NB! Slettede linjer er fysisk fjernet fra kildekoden.
N50   *
N55   * NB! Hvis endringer i datastruktur: KUNDDS, husk å endre lengden
N55   *     på DTAARA: DATA2 i VC030.
N55   *     *************************
N24P  *   - Hvis kunden reaktiveres skal ENDPOS kode settes til "J".
N40   *   - Filen KHEAF har en ny felt VAVGKA som settes til " " når
      *     det gjelder vanlig avgift
N40   *   - Filen KUNDF har nye felt ifbm e-handel
N40   *   - Utvidet tester mot OFKPOS til også å teste mot verdien 'J'
      ****************************************************************
      *               --- V R 0 3 0 ---
      *
      *----------------- INDIKATORER ---------------------------------
      *
      *  03 - F3 Avslutt
      *  04 - F4 Posisjonsavhengig søk
      *  06 - F6 Avbryte
      *  09 - F9 Ny standard
F10   *  10 - F10 Styringsfil dokumentforsendelse
      *  11 - F11 Fjerne
      *  12 - F12 Forrige bilde
      *  14 - F14 Reaktiver
      *  15 - F15 Statusbilde
N50P  *  16 - F16 Vareadresser
      *  17 - F17 Aksepter feil
N55   *  18 - F18 Bankadresser
      *  23 - F23 Notatblokk
E55P  *  25 - VLDCMDKEY i skjermbilde
E55P  *  26 - ROLLUP i skjermbilde
      *  31 - SFLDSP
      *  32 - SFLDSPCTL
      *  33 - SFLCLR
      *  34 - SFLEND
      *  36 - SFL
      *  37 - READC SFL
      *  38 - SFL
      *  45 - Sjekker om dokumenttekst finnes
      *  46 - Feilmelding ved inntasting
      *  50 - CHAIN
      *  52 - CHAIN
      *  53 - SETLL
      *  54 - CHAIN
      *  55 - CHAIN
      *  56 - CHAIN
      *  57 - CHAIN
      *  58 - CHAIN
      *  59 - CHAIN
      *  60 - READE
      *  61 - CHAIN
      *  62 - CHAIN
      *  64 - Styring av oppdatering av journalnr.
      *  65 - Styring av printtekst
      *  66 - Styring av printtekst
      *  67 - Styring av printtekst
      *  69 - Feilmelding ved inntasting
      *  69 - Feilmelding ved inntasting
      *  70 - Feilmelding ved inntasting
      *  71 - Feilmelding ved inntasting
      *  72 - Feilmelding ved inntasting
      *  73 - Feilmelding ved inntasting
      *  74 - Feilmelding ved inntasting
      *  75 - Feilmelding ved inntasting
      *  76 - Feilmelding ved inntasting
      *  77 - Feilmelding ved inntasting
      *  78 - Feilmelding ved inntasting
      *  79 - Feilmelding ved inntasting
      *  80 - Feilmelding ved inntasting
      *  81 - Feilmelding ved inntasting
      *  82 - Ikke automatisk tildeling, systemfilen sier knr. 0
      *  83 - Kundenummer er større en sist automatisk tildelt.
      *  84 - Sjekker om notablokk finnes
      *  85 - Feilmelding ved inntasting
      *  86 - Feilmelding ved inntasting
      *  87 - Retur fra program VR901 Søk på koder
      *  88 - Ingen poster funnet ved søk på koder
      *  89 - Feilmelding ved inntasting
      *  90 - Posten er registrert med feil
      *  91 - Lock indikator for KKUNF
      *  92 - Styringsindikator for data area
      *  93 - Feilmelding ved inntasting
      *  94 - Feilmelding ved inntasting
      *  96 - Tekst for kundenummer opprettet
      *  97 - Styring av DDMMÅÅ/ÅÅMMDD
      *  98 - PUTOVR
      *  99 - Sjekk om siste kundenummer
      *
      *----------------- SUBRUTINER ----------------------------------
      *
      *  SUBR01 - Nyregistrering på kundefilen
      *  SUBR02 - Endring på kundefilen
      *  SUBR03 - Nullstill felter eller flytt over fra standard
      *  SUBR05 - Spørring på kundefilen
      *  SUBR06 - Fjerne på kundefilen
      *  SUBR07 - Ny standard
      *  SUBR08 - Statusbilde
      *  SUBR09 - Flytt til X-felter for endringsjournal
      *  SUBR10 - Søk på koder
      *  SUBR11 - Modulus 11 sjekk
      *  SUBR12 - Kaller pgm. for bygging av data til kassene
N50   *  SUBR13 - Vedlikehold, forespørsel URL-adresse
N50   *  SUBR14 - Vedlikehold, E-postadreser
N50   *  SUBR15 - Forespørsel på kontakter
N50P  *  SUBR16 - Kontroll av postnummer
N55   *  SUBR17 - Vedlikehold av kontakter
N55P  *  VIS_KUNSF    - Henter opplysninger fra statistikkfil kunde
      *
      *----------------- SKJERMBILDER --------------------------------
      *
      *  VR030B01 - Heading
S55   *  VR030B02 - Utvalgsbilde N/E/S/F
      *  VR030B03 - Nyregistrering bilde 1
      *  VR030B04 - ---------"---------- 2
      *  VR030B05 - ---------"---------- 3
      *  VR030B06 - Endring bilde 1
      *  VR030B07 - Endring bilde 2
      *  VR030B08 - Endring bilde 3
      *  VR030B09 - Fjerne
      *  VR030B10 - Filstatus
      *  VR030B11 - Ny standard bilde 1
      *  VR030B12 - Ny standard bilde 2
      *  VR030B13 - Ny standard bilde 3
      *  VR030B14 - Spørring bilde 1
      *  VR030B15 - Spørring bilde 2
      *  VR030B16 - Nyregistrering bilde 4
      *  VR030B17 - Endring bilde 4
      *  VR030B18 - Ny standard bilde 4
      *  VR030B19 - Journalskriving
      *  VR030B22 - Funksjonstaster
      *  VR030B25 - ------"--------
      *  VR030H01 - Alfasøk
      *  VR030K01 - ---"---
      *
      *
      *----------------- PRINTERFILER --------------------------------
      *
      *  VR030S01 - Nyregistrering
      *  VR030S02 - Endringer
      *  VR030S03 - Filstatus
      *
      ****************************************************************
      *
      /EJECT
     FVR030D01  CF   E             WORKSTN
E55  F                                     SFILE(VR030H01:WRRN1)
     F                                     INFDS(FEILDS)
     F                                     INFSR(FEILSR)
     FVR030U01  O    E             PRINTER USROPN
     FFEILLOGG  O    E             PRINTER USROPN
     FKODAL01   IF   E           K DISK
     FKODDL01   IF   E           K DISK
     FKODEL01   IF   E           K DISK
     FKODKL01   IF   E           K DISK
     FKODLL01   IF   E           K DISK
     FKODML01   IF   E           K DISK
     FKODNL01   IF   E           K DISK
N24  FKODTL01   IF   E           K DISK
     FKODRL01   IF   E           K DISK
     FKODUL01   IF   E           K DISK
     FKHEDL01   IF   E           K DISK
     FVALUL01   IF   E           K DISK
E40  FKHEAL02   IF   E           K DISK
     FKODSL01   IF   E           K DISK
     FVADRL01   IF   E           K DISK
     FKODQL01   IF   E           K DISK
     FKODYL01   IF   E           K DISK
     FKUNDL01   UF A E           K DISK                                         PR. KUNDENUMMER
N55  FKUNDL02   IF   E           K DISK                                         PR. SØKENAVN
N55  F                                     RENAME(KUNDR:KUND02)
     FKUNDL03   IF   E           K DISK                                         PR. TELEFON
     F                                     RENAME(KUNDR:KUND03)
N55  FKUNDL07   IF   E           K DISK                                         PR. KUNDEGRUPPE
N55  F                                     RENAME(KUNDR:KUND07)
N55  FKUNDL08   IF   E           K DISK                                         PR. POSTNUMMER
N55  F                                     RENAME(KUNDR:KUND08)
     FLEVEL01   IF   E           K DISK
     FSYSBL01   UF   E           K DISK
     FSYSRL01   UF A E           K DISK
N40  FSYSOL01   IF   E           K DISK
N50P FSYSDL01   IF   E           K DISK    PREFIX(SD_)
N50  FKORTL06   UF A E           K DISK
N50P FKORTL01   UF   E           K DISK
N50P F                                     RENAME(KORTR:KORT01)
     FKKUNF     UF A E           K DISK
     FNOTAL01   IF   E           K DISK
     FESTYL00   IF   E           K DISK
N55  FPKASL04   IF   E           K DISK    PREFIX(PA_)                          POS MASTERKASSER
N55  FPKUNL01   UF A E           K DISK    PREFIX(BK_)                          POS KUNDER-OVERFØRIN
N55P FKUNSL01   IF   E           K DISK
      /EJECT
     D ARRC            S             60    DIM(2) CTDATA PERRCD(1)
N55P D TXT             S             50    DIM(2) CTDATA PERRCD(1)
      * TABELLER FOR MODULUS 11 KONTROLL
     D MO1             S              1    DIM(15)
     D MO2             S              3  0 DIM(15)
N55  D MO35            S              1    DIM(35)
N50   * Hjelpevariabler
N50  D W_EPOST         S              1
N55P D W_IN25          S              1    INZ('0')
N55P D W_IN26          S              1    INZ('0')
N50  D W_NAVN          S                   LIKE(KNAVN)
N55P D W_NRAAR         S                   LIKE(NRAAR)
N50  D W_KORTN         S                   LIKE(KONRKO)
N50  D W_KUNDNR        S                   LIKE(KUNDNR)
N55  D W_VR090         S              1
N55  D WRRN1           S                   LIKE(WD_CURS1)
N55  D WSISRRN         S                   LIKE(WD_CURS1)                       SISTE RRN
N55  D WANTPG          S                   LIKE(WD_CURS1)                       ANTALL RCDS. PR SIDE
N55  D                                     INZ(14)
N55  D WXKUN           S                   LIKE(WD_CURS1)                       ANT KUNDER DENNE SID
N55  D WSFLSOK         S              3                                         SORTERING PÅ SUBFILE
N55  D WVALG           S                   LIKE(WD_VALGH1)
N55  D WSISKUN         S                   LIKE(KUNDNR)                         SISTE LESTE KUNDE
N55
N55   * Datakø-data
N55  D                 DS
N55  D  WQSFELT                1     50
N55  D   WQSFIL                1     10                                         FILNAVN
N55  D   WQSDTALIB            11     20                                         BIBLIOTEK (TIL FIL)
N55  D   WQSFKODE             21     22                                         FIRMAKODE
N55  D   WQSFIRMA             23     24                                         FIRMA
N55  D   WQSEVENT             25     25                                         INSERT/UPDATE/DELETE
N55  D   WQSBASE              26     26                                         Alle/Batch/Trigger
N55P D   WQSHTTPRQ            27     27                                         UTFØR HTTP-REQUEST
N55P D   WQSOPPDAT            28     28                                         OPPDATER UANSETT
E55P D   WQSKEY               31     45                                         NØKKEL
N55
N55   * Sendende datakø
N55  D WQSNAVN         S             10                                         DATAKØ NAVN
N55  D WQSLIB          S             10    INZ('*LIBL')                         DATAKØ BIBLIOTEK
N55  D WQSLEN          S              5  0 INZ(%LEN(WQSFELT))                   DATAKØ FELTLENGDE
      *
     D                SDS
     D  ZPROG                  1     10
     D  ZPMSG                 40     46
     D  ZBIBLO                81     90
     D  ZJOBB                244    253
     D  ZBRKR                254    263
     D  ZJNR                 264    269
      *
     D FEILDS          DS
     D  ZSTAT            *STATUS
     D  ZFILE            *FILE
     D  ZLINE                 30     37
     D  ZFMT                  38     45
     D  ZFMSG                 46     52
     D  ZDSP                 273    282
     D  CURLIN               370    371B 0
     D  ZMAJ                 401    402
     D  ZMIN                 403    404
      * PARAMETER TIL VR060 (DOKUMENT-TEKST)
     D PARMD1          DS           256    INZ
     D  UPARD1                 1    256
     D  WRESNR                 1      8  0
     D  OTBKOD                 9      9
     D  WNAVN                 10     39
     D  WFEILK                40     40
     D  VARENR                41     55
     D  INDVN1                56     70
N50P D  W_HEAD                71     71
N50P D  W_KUGR                72     73
N50P D  W_PROGID              74     81
      * PARAMETER TIL VR350 (ORDRE-TEKST)
     D PARMD2          DS           256    INZ
     D  UPARD2                 1    256
     D  TXTKOD                 1      1
     D  TXTBGR                 2     16
N50P  * PARAMETER TIL VR033 (Dokumentforsendelse)
N50P D PARMD3          DS           256    INZ
N50P D  UPARD3                 1    256
N50P D  W_KUNDEN               1      6
N50   * PARAMETER TIL VR070 (URL-adresser)
N50  D VR070DS         DS           256    INZ
N50  D  P_FIRMA                1      2
N50  D  P_URLTYP               3      3
N50  D  P_RESKNR               4     11  0
N50  D  P_VARENR              12     26
N50  D  P_BEHKOD              27     27
N50P  * PARAMETER TIL VR841 (Postnummer)
N50P D VR841DS         DS           256    INZ
N50P D  P8_BEHKDE              1      1
N50P D  P8_POSTNR              2      5  0
N50P D  P8_A                   6      7  0
N50P D  P8_B                   8     10  0
N50P D  P8_WPAVSL             11     11
N50P D  P8_WPNONE             12     12
N50P D  P8_WPTSOK             13     13
N50P D  P8_POSTED             14     37
N50P D  P8_KOMMUN             38     62
N50P D  P8_RETKDE             63     63
N50P D  P8_PONRPB             64     73
      *----------------------------------------------------------------
      * LOCAL DATA AREA OG DATAOMRÅDE FOR KUNDEFILEN
      *----------------------------------------------------------------
     D DATA1         EUDS                  EXTNAME(LDADS)
N50P D  LD_PROG              500    504
N50P D  LD_KUND              505    512  0
N50P D  LD_VADR              513    515  0
N55  D  LD_BEHKD             600    600
N55  D  LD_RESKNR            601    608  0
N55  D  LD_NAVN              609    638
     D DATA2         EUDS                  EXTNAME(KUNDDS)
     D DATA3         E DS                  EXTNAME(KUNDDSW)
N24   *
N24  D DSDATO        E DS                  EXTNAME(VR014DS)
N24   *
      ****
      * PARAMETERLISTE FOR BUTIKKDATA
      ****
     D                 DS
     D  PR500                  1    256
     D  PRTYPE                 1      1
     D  PRDATA                 2     25
      *
      *   Rename av felter i SYSBR
     ISYSBR                                                                     KR0210
     I              FACKNR                      WWFACK                          KR0210
      *
      *   Rename av felter i VADRF
     IVADRR                                                                     KR0210
     I              SONAVN                      SONAVA                          KR0210
     I              DISTR                       DISTVA                          KR0210
     I              RUTENR                      RUTEVA                          KR0210
     I              SEKVNR                      SEKVVA                          KR0210
     I              SISAAR                      SISAVA                          KR0210
     I              SISMND                      SISMVA                          KR0210
     I              SISDAG                      SISDVA                          KR0210
N55
N55   * Alle defineringer er flyttet til *INZSR
N55
      /EJECT
      *----------------------------------------------------------------
      *  VIS HEADING OG SJEKK FILOPPLYSNINGER
      *----------------------------------------------------------------
     C                   WRITE     VR030B01
      *
     C     KEYG          CHAIN     SYSRL01                            50
     C     *IN50         IFEQ      *ON
     C                   MOVE      'J'           LISKOD
     C                   EXFMT     VR030B19
     C     *IN03         CABEQ     *ON           SLUTT
     C                   MOVE      'A'           AKTKOD
     C                   WRITE     SYSRR
      *
     C                   MOVE      *BLANKS       REGNAV
     C                   MOVEL     'SYS'         REGNAV
     C     KEYG          CHAIN     SYSRL01                            50
     C     *IN50         IFEQ      *OFF
     C                   ADD       1             ANTBRU
     C                   UPDATE    SYSRR
     C                   ENDIF
      *
     C                   ELSE
     C                   EXCEPT    SYUTR
     C                   ENDIF
     C     LISKOD        IFEQ      'J'
E55P C                   MOVE      *ON           W_IN25                         <LISTE SKRIVES
     C                   ENDIF
      *----------------------------------------------------------------
      *  VIS INNGANGSBILDE OG TEST HVA SOM ER VALGT
      *----------------------------------------------------------------
     C     TOP           TAG
      *
S55   **                 MOVE      *OFF          *IN06
S55   **                 MOVE      *BLANKS       VALSON
S55   **                 MOVE      *BLANKS       HLPSON
S55   **                 CLEAR                   LEDI20
S55   **   *IN71         IFEQ      *OFF
S55   **                 MOVE      *BLANKS       VALTLF
S55   **                 ENDIF
S55   **   *IN70         IFEQ      *OFF
S55   **   *IN72         ANDEQ     *OFF
S55   **   *IN83         ANDEQ     *OFF
S55   **                 MOVE      *ZEROS        VALKNR
S55   **                 ENDIF
S55   **   *IN92         IFEQ      *OFF
S55   **                 IN        DATA2
S55   **                 ENDIF
S55   **
S55   **   VISB02        TAG
S55   **
S55   **                 MOVE      *BLANKS       VALSON
S55   **                 MOVE      *OFF          *IN04
S55   **                 EXFMT     VR030B02
S55   **                 MOVE      *OFF          *IN46                          <FEILIND
S55   **                 MOVEA     '00000'       *IN(68)                        <SETOF FEILIND
S55   **                 MOVEA     '000'         *IN(81)                        <SETOF FEILIND
S55   **                 MOVE      *OFF          *IN95                          <FEILIND
S55   **                 MOVE      *OFF          *IN98                          <PUTOVR
S55   **                 MOVEA     '00000000'    *IN(73)                        <SETOF FEILIND
S55   **                 MOVEA     '000'         *IN(87)                        <SETOF FEILIND
S55   **
S55   **   *IN03         CABEQ     *ON           SLUTT                          <AVBRYT
S55   **                 MOVE      *OFF          *IN96
S55   **                 MOVE      *OFF          *IN99
S55   **
S55   **F10 - Overgang til vedl.hold av styringsfil dok.forsendelse
S55   **
S55   **                 IF        *IN10 = *ON
S55   **                 EVAL      W_KUNDEN = 'KUNDEN'
S55   **                 CALL      'VR033'
S55   **                 PARM                    PARMD3
S55   **                 GOTO      VISB02
S55   **                 ENDIF                                                  <*IN10
S55   **
S55   **F16 - Overgang til vedl.hold av vareadresser
S55   **
S55   **                 IF        *IN16 = *ON
S55   **                 EVAL      LD_PROG = 'VR030'
S55   **                 EVAL      LD_KUND = *ZEROS
S55   **                 EVAL      LD_VADR = *ZEROS
S55   **                 OUT       DATA1
S55   **                 CALL      'VR300'
S55   **                 EVAL      LD_PROG = *BLANKS
S55   **                 OUT       DATA1
S55   **                 GOTO      VISB02
S55   **                 ENDIF                                                  <*IN10
S55   **
S55   **F18 - Overgang til vedl.hold av bankadresser
S55   **
S55   **                 IF        *IN18 = *ON
S55   **                 EVAL      LD_PROG = 'VR030'
S55   **                 EVAL      LD_KUND = VALKNR
S55   **                 OUT       DATA1
S55   **                 CALL      'VR550'
S55   **                 EVAL      LD_PROG = *BLANKS
S55   **                 OUT       DATA1
S55   **                 GOTO      VISB02
S55   **                 ENDIF                                                  <*IN10
S55   **
S55   **F24 - Overgang til vedl.hold av kortnummer (kontakter)
S55   **
S55   **                 IF        *IN24 = *ON
S55   **                 EVAL      LD_BEHKD  = 'D'
S55   **                 EVAL      LD_RESKNR = *ZEROS
S55   **                 EVAL      LD_NAVN   = *BLANKS
S55   **                 OUT       DATA1
S55   **                 CALL      'VR090'
S55   **                 EVAL      W_VR090   = '1'
S55   **                 EVAL      LD_BEHKD  = *BLANKS
S55   **                 EVAL      LD_RESKNR = *ZEROS
S55   **                 OUT       DATA1
S55   **                 GOTO      VISB02
S55   **                 ENDIF                                                  <*IN10
S55   **
S55   **
S55   **       SJEKK OM F4 ER TASTET
S55   **
S55   **   *IN04         IFEQ      *ON
S55   **   SOK           TAG
S55   **                 Z-ADD     CURLIN        CURLI1            5 0
S55   **   CURLI1        DIV       256           LINJE             2 0
S55   **   LINJE         MULT      256           CURLI2            5 0
S55   **   CURLI1        SUB       CURLI2        POSISJ            3 0
S55   **
S55   **                 SELECT
S55   **
S55   **       SØK PÅ KUNDENR/SØKENAVN
S55   **
S55   **   LINJE         WHENGE    13
S55   **   LINJE         ANDLE     15
S55   **                 Z-ADD     7             A
S55   **                 Z-ADD     2             B
S55   **                 MOVE      'VR910'       WPROG
S55   **                 EXSR      SUBR10                                       <Søk på koder
S55   **   WPNONE        IFEQ      '1'
S55   **                 MOVE      *ON           *IN46
S55   **                 GOTO      VISB02
S55   **                 ENDIF
S55   **   HLPI12        IFEQ      '1'
S55   **                 GOTO      VISB02
S55   **                 ENDIF
S55   **                 ENDSL
S55   **                 GOTO      FORTS
S55   **                 ENDIF                                                  <*IN04
S55   **
S55   **   *IN09         CASEQ     *ON           SUBR07                         <STANDARD
S55   **   *IN15         CASEQ     *ON           SUBR08                         <STATUS
S55   **   VALG          CASEQ     'N'           SUBR01                         <NYE
S55   **                 ENDCS
S55   **   VALSON        IFNE      *BLANKS
S55   **   VALKNR        OREQ      *ZEROS
S55   **   VALSON        ANDEQ     *BLANKS
S55   **   VALTLF        ANDEQ     *BLANKS
S55   **                 GOTO      SOK
S55   **                 ENDIF
S55   **   FORTS         TAG
S55   **   VALKNR        CABEQ     *ZEROS        TOP
S55   **   VALG          CASEQ     'E'           SUBR02                         <ENDRING
S55   **   VALG          CASEQ     'S'           SUBR06                         <FJERNE
S55   **   VALG          CASEQ     'F'           SUBR05                         <SPØRRING
S55   **                 ENDCS
S55   **                 GOTO      TOP
N55
N55   * Legg ut subfile med kunder
N55  C                   EXSR      SFL01
N55
     C     SLUTT         TAG
      *
E55P C     W_IN26        IFEQ      *ON
     C                   WRITE     VR030S03
     C                   CLOSE     VR030U01
     C                   ENDIF
N50
N50   * Avslutt program VR070 URL-adresse
N50
N50  C                   EVAL      P_BEHKOD = 'A'
N50  C                   EXSR      SUBR13
N50P
N50P  * Avslutt program VR841 Postnummer
N50P
N50P C                   EVAL      P8_BEHKDE = '9'
N50P C                   CALL      'VR841'       VR841P
N55   * Avslutt program VR090
N55  C                   IF        W_VR090 = '1'
N55  C                   EVAL      LD_BEHKD  = '9'
N55  C                   OUT       DATA1
N55  C                   CALL      'VR090'
N55  C                   ENDIF                                                  <W_VR090
N50
     C                   MOVE      *ON           *INLR
N55
N55   /EJECT
N55   *----------------------------------------------------------------
N55   *  S F L 0 1    LEGG UT KUNDER PÅ SUBFILE
N55   *----------------------------------------------------------------
N55  C     SFL01         BEGSR
N55
N55  C                   EXSR      SFL01_CLEAR
N55
N55  C                   EXSR      SFL01_FYLL
N55
N55  C                   EXSR      SFL01_VIS
N55
N55
N55
N55  C                   ENDSR
N55
N55   /EJECT
N55   *----------------------------------------------------------------
N55   *  S F L 0 1 _ C L E A R ; Clear av subfile
N55   *----------------------------------------------------------------
N55  C     SFL01_CLEAR   BEGSR
N55
N55  C                   MOVEA     '00'          *IN(27)                        SETOF 27-28
N55  C                   WRITE     VR030K01                                     SFLCLR
     C                   CLEAR                   WRRN1
     C                   CLEAR                   WSISRRN
N55
N55   * Posisjonering
N55  C                   SELECT
N55  C                   WHEN      WSFLSOK = 'SOK'                              PR. SØKENAVN
N55  C                   EVAL      SONAVN = WD_STRSOK
N55  C     KEYB          SETLL     KUND02
N55
N55  C                   WHEN      WSFLSOK = 'KGR'                              PR. KUNDEGRUPPE
N55  C                   EVAL      KUNDGR = WD_STRKGR
N55  C     KEYN          SETLL     KUND07
N55
N55  C                   WHEN      WSFLSOK = 'TLF'                              PR. TELEFON
N55  C                   EVAL      TLF    = WD_STRTLF
N55  C     KEYC          SETLL     KUND03
N55
N55  C                   WHEN      WSFLSOK = 'PNR'                              PR. POSTNUMMER
N55  C                   EVAL      POSTNR = WD_STRPNR
N55  C     KEYY          SETLL     KUND08
N55
N55  C                   OTHER                                                  PR. KUNDENUMMER
N55  C                   EVAL      KUNDNR = WD_STRKUN
N55  C     KEYA          SETLL     KUNDR
N55  C                   ENDSL                                                  <SELECT
N55
N55  C                   ENDSR
N55
N55   /EJECT
N55   *----------------------------------------------------------------
N55   *  S F L 0 1 _ F Y L L ; Les kunder og legg de på subfilen (en side ad gangen)
N55   *----------------------------------------------------------------
N55  C     SFL01_FYLL    BEGSR
N55
N55  C                   CLEAR                   WXKUN                          ANTALL LESTE KUNDER
N55  C                   CLEAR                   WD_VALGK1                      VALG
N55  C                   CLEAR                   WD_POS                         KODE FOR OVERFØRT PO
N55  C                   EVAL      WRRN1    = WSISRRN                           ASG. RRN
N55
N55  C                   SELECT
N55  C                   WHEN      WSFLSOK = 'SOK'                              PR. SØKENAVN
N55  C     WFIRMA        READE     KUND02
N55  C                   WHEN      WSFLSOK = 'KGR'                              PR. KUNDEGRUPPE
N55  C     WFIRMA        READE     KUND07
N55  C                   WHEN      WSFLSOK = 'TLF'                              PR. TELEFON
N55  C     WFIRMA        READE     KUND03
N55  C                   WHEN      WSFLSOK = 'PNR'                              PR. POSTNUMMER
N55  C     WFIRMA        READE     KUND08
N55  C                   OTHER                                                  PR. KUNDENUMMER
N55
N55  C                   IF        WD_STRKUN = *ZEROS                           ROLL-UP
N55  C                   EVAL      KUNDNR = WSISKUN
N55  C     KEYA          SETGT     KUNDR                                        PLASSERING ETTER
N55  C                   ELSE                                                   ): NY POSISJONERING
N55  C     KEYA          SETLL     KUNDR                                        PLASSERING FØR
N55  C                   ENDIF                                                  <WD_STRKUN
N55
N55  C     WFIRMA        READE (N) KUNDR
N55  C                   ENDSL                                                  <SELECT
N55
N55  C                   DOW       NOT %EOF
N55
N55  C     AKTKOD        COMP      'A'                                4141      INAKTIV
N55  C                   EVAL      WD_IN41 = *IN41
N55  C                   EVAL      WRRN1 = WRRN1 + 1
N55  C                   WRITE     VR030H01
N55  C                   EVAL      WXKUN = WXKUN + 1
N55P C                   EVAL      *IN41 = *OFF

N55  C                   IF        WXKUN >= WANTPG                              ANTALL PR. SIDE
     C                   LEAVE                                                  AVSLUTT LOOP
     C                   ENDIF                                                  <WXKUN
N55
N55  C                   SELECT
N55  C                   WHEN      WSFLSOK = 'SOK'                              PR. SØKENAVN
N55  C     WFIRMA        READE     KUND02
N55  C                   WHEN      WSFLSOK = 'KGR'                              PR. KUNDEGRUPPE
N55  C     WFIRMA        READE     KUND07
N55  C                   WHEN      WSFLSOK = 'TLF'                              PR. TELEFON
N55  C     WFIRMA        READE     KUND03
N55  C                   WHEN      WSFLSOK = 'PNR'                              PR. POSTNUMMER
N55  C     WFIRMA        READE     KUND08
N55  C                   OTHER                                                  PR. KUNDENUMMER
N55  C     WFIRMA        READE(N)  KUNDR
N55  C                   ENDSL                                                  <SELECT
N55  C                   ENDDO                                                  <NOT %EOF (KUND0x)
N55
N55  C                   EVAL      WSISRRN  = WRRN1                             ASG. RRN
N55  C                   IF        WXKUN <> *ZEROS                              LEST KUNDER
N55  C                   EVAL      WD_CURS1 = WSISRRN - WXKUN + 1               1. RECORD PÅ SIDEN
N55  C                   EVAL      WSISKUN  = KUNDNR                            ASG. SISTE KUNDENUMM
N55  C                   ENDIF                                                  <WXKUN
N55
N55   * Assign SFLEND dersom EOF
N55  C                   IF        %EOF
N55  C                   EVAL      *IN29 = *ON                                  SFLEND
N55  C                   ELSE
N55  C                   EVAL      *IN29 = *OFF                                 SFLEND
N55  C                   ENDIF                                                  <%EOF
N55  C
N55
N55  C                   ENDSR
N55
N55   /EJECT
N55   *----------------------------------------------------------------
N55   *  S F L 0 1 _ V I S ; Vis kunder
N55   *----------------------------------------------------------------
N55  C     SFL01_VIS     BEGSR
N55
N55  C     BILDEK011     TAG
N55
N55   * Nullstill startfelter
N55  C                   CLEAR                   WD_VALGK1                      VALG
N55  C                   CLEAR                   WD_STRKUN                      KUNDENUMMER
N55  C                   CLEAR                   WD_STRSOK                      SØKENAVN
N55  C                   CLEAR                   WD_STRKGR                      KUNDEGRUPPE
N55  C                   CLEAR                   WD_STRTLF                      TELEFON
N55  C                   CLEAR                   WD_STRPNR                      POSTNUMMER
N55
N55  C                   EVAL      *IN27 = *ON                                  SFLDSPCTL
N55  C     WRRN1         COMP      *ZEROS                             28        SFLDSP
N55  C     POKOD         COMP      'J'                                    42    POS ER INSTALLERT
N55
N55  C     BILDEK012     TAG
     C                   WRITE     VR030F01
N55  C                   EXFMT     VR030K01
     C                   MOVEA     *ALL'0'       *IN(71)                        SETOF 71-99
N55P C                   CLEAR                   W_WKNR
N55P C                   CLEAR                   W_TXT
N55
N55  C                   IF        *IN25 = *ON                                  F-TAST TRYKKET
N55  C                   SELECT
N55   * F3 = Avslutt
N55  C                   WHEN      *IN03 = *ON
N55  C                   GOTO      SLUTT
N55   * F4 = Søking
N55  C                   WHEN      *IN04 = *ON
     C                   EVAL      A     = 6
     C                   EVAL      B     = 2
N55  C                   EVAL      WPROG = 'VR910'
N55  C                   EXSR      SUBR10                                       <Søk på koder
N55  C                   IF           WPNONE = '1'
N55  C                             OR HLPI12 = '1'
N55  C                   CLEAR                   WD_STRKUN
N55  C                   ELSE
N55  C                   EVAL      WD_STRKUN = PKUNDN
N55  C                   ENDIF                                                  <WPNONE
N55  C                   GOTO      BILDEK012
N55
N55   * F9 = Standarder
N55  C                   WHEN      *IN09 = *ON
N55  C                   EXSR      SUBR07
N55
N55   * F10 - Overgang til vedl.hold av styringsfil dok.forsendelse
N55  C                   WHEN      *IN10 = *ON
N55  C                   EVAL      W_KUNDEN = 'KUNDEN'
N55  C                   CALL      'VR033'
N55  C                   PARM                    PARMD3
N55
N55   * F15 = Status
N55  C                   WHEN      *IN15 = *ON
N55  C                   EXSR      SUBR08
N55
N55   * F16 - Overgang til vedl.hold av vareadresser
N55  C                   WHEN      *IN16 = *ON
N55  C                   EVAL      LD_PROG = 'VR030'
N55  C                   EVAL      LD_KUND = *ZEROS
N55  C                   EVAL      LD_VADR = *ZEROS
N55  C                   OUT       DATA1
N55  C                   CALL      'VR300'
N55  C                   EVAL      LD_PROG = *BLANKS
N55  C                   OUT       DATA1
N55  C
N55   * F18 - Overgang til vedl.hold av bankadresser
N55  C                   WHEN      *IN18 = *ON
N55  C                   EVAL      LD_PROG = 'VR030'
N55  C                   EVAL      LD_KUND = KUNDNR
N55  C                   OUT       DATA1
N55  C                   CALL      'VR550'
N55  C                   EVAL      LD_PROG = *BLANKS
N55  C                   OUT       DATA1
N55
N55   * F24 - Overgang til vedl.hold av kortnummer (kontakter)
N55  C                   WHEN      *IN24 = *ON
N55  C                   EVAL      LD_BEHKD  = 'D'
N55  C                   EVAL      LD_RESKNR = *ZEROS
N55  C                   EVAL      LD_NAVN   = *BLANKS
N55  C                   OUT       DATA1
N55  C                   CALL      'VR090'
N55  C                   EVAL      W_VR090   = '1'
N55  C                   EVAL      LD_BEHKD  = *BLANKS
N55  C                   EVAL      LD_RESKNR = *ZEROS
N55  C                   OUT       DATA1
N55
N55   * *IN26 = Rollup
N55  C                   WHEN      *IN26 = *ON
N55  C                   EXSR      SFL01_FYLL
N55
N55  C                   ENDSL                                                  <SELECT
N55
N55  C                   ELSE                                                   ): IKKE F-TAST
N55  C                   SELECT
N55
N55   * Opprett kunde
N55  C                   WHEN      WD_VALGK1 = '1'
N55  C                   EVAL      KUNDNR = WD_STRKUN
N55  C                   EXSR      SUBR01
N55  C     *IN98         CABEQ     *ON           BILDEK012
N55
N55   * Endre   kunde
N55  C                   WHEN      WD_VALGK1 = '2'
N55  C                   EVAL      KUNDNR = WD_STRKUN
N55  C                   EXSR      SUBR02
N55  C     *IN98         CABEQ     *ON           BILDEK012
N55
N55   * Slette  kunde
N55  C                   WHEN      WD_VALGK1 = '4'
N55  C                   EVAL      KUNDNR = WD_STRKUN
N55  C                   EXSR      SUBR06
N55
N55   * Forespørre kunde
N55  C                   WHEN      WD_VALGK1 = '5'
N55  C                   EVAL      KUNDNR = WD_STRKUN
N55  C                   EXSR      SUBR05
N55
N55   * Overføre kunde til POS
N55  C                   WHEN          WD_VALGK1 = 'O'
N55  C                             AND POKOD     = 'J'                          POS ER INSTALLERT
N55  C                   EVAL      KUNDNR = WD_STRKUN
N55  C                   EXSR      SUBR18
N55
N55   * Ny startverdi, kundenummer
N55  C                   WHEN      WD_STRKUN <> *ZEROS
N55  C                   EVAL      WSISKUN = WD_STRKUN
N55  C                   EVAL      WSFLSOK = 'KUN'
N55  C                   GOTO      TOP
N55
N55   * Ny startverdi, søkenavn
N55  C                   WHEN      WD_STRSOK <> *BLANK
N55  C                   EVAL      WSFLSOK = 'SOK'
N55  C                   GOTO      TOP
N55
N55   * Ny startverdi, kundegruppe
N55  C                   WHEN      WD_STRKGR <> *BLANK
N55  C                   EVAL      WSFLSOK = 'KGR'
N55  C                   GOTO      TOP
N55
N55   * Ny startverdi, telefon
N55  C                   WHEN      WD_STRTLF <> *BLANK
N55  C                   EVAL      WSFLSOK = 'TLF'
N55  C                   GOTO      TOP
N55
N55   * Ny startverdi, postnummer
N55  C                   WHEN      WD_STRPNR <> *ZEROS
N55  C                   EVAL      WSFLSOK = 'PNR'
N55  C                   GOTO      TOP
N55  C                   ENDSL                                                  <SELECT
N55
N55   * Sjekk valg på subfile
N55  C                   READC     VR030H01
N55  C                   DOW       NOT %EOF
N55
N55  C                   IF        WD_VALGH1 <> *BLANK
N55
N55  C                   EVAL      WVALG = WD_VALGH1
N55  C                   CLEAR                   WD_VALGH1
N55  C                   IF        WVALG <> 'O'                                 IKKE OVERFØR POS
N55  C                   EVAL      *IN41 = WD_IN41                              DSPATR(RI)
N55  C                   UPDATE    VR030H01
N55  C                   ENDIF                                                  <WD_VALGH
N55
N55  C                   SELECT
N55   * Opprett kunde
N55  C                   WHEN      WVALG     = '1'
N55  C                   EXSR      SUBR01
N55
N55   * Endre   kunde
N55  C                   WHEN      WVALG     = '2'
N55  C                   EXSR      SUBR02
N55
N55   * Inaktiviser kunde
N55  C                   WHEN      WVALG     = '4'
N55  C                   EXSR      SUBR06
N55
N55   * Se på kunde
N55  C                   WHEN      WVALG     = '5'
N55  C                   EXSR      SUBR05
N55
N55   * Overfør kunde til POS
N55  C                   WHEN          WVALG = 'O'
N55  C                             AND POKOD = 'J'                              POS ER INSTALLERT
N55  C                   EXSR      SUBR18
N55
N55  C                   EVAL      WD_POS = 'O'
N55  C                   EVAL      *IN41 = WD_IN41                              DSPATR(RI)
N55  C                   UPDATE    VR030H01
N55
N55  C                   ENDSL                                                  <SELECT
N55
N55  C                   EVAL      WD_CURS1 = WRRN1
N55  C                   ENDIF                                                  <WD_VALGH1
N55
N55
N55  C                   READC     VR030H01
N55  C                   ENDDO                                                  <NOT %EOF (VR030H01)
N55
N55  C                   ENDIF                                                  <*IN25
N55  C                   GOTO      BILDEK011
N55
N55
N55
N55  C                   ENDSR
N55
      /EJECT
      *----------------------------------------------------------------
      *  S U B R 0 1    NYREGISTRERING PÅ KUNDEFILEN
      *----------------------------------------------------------------
     C     SUBR01        BEGSR
     C                   MOVE      *OFF          *IN72
     C                   MOVE      *OFF          *IN64
     C     *LOCK         IN        DATA2
     C                   MOVE      WFIRMA        FIRMA
      *----------------------------------------------------------------
      *  HVIS KUNDENR. ER TASTET, SJEKK OM DETTE FINNES FRA FØR
      *----------------------------------------------------------------
S55   *                  Z-ADD     VALKNR        KUNDNR
S55   *    VALKNR        IFNE      *ZEROS
N55  C                   Z-ADD     WD_STRKUN     KUNDNR
N55  C     KUNDNR        IFNE      *ZEROS
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         IFEQ      *OFF
     C                   EXCEPT    KUNDA
     C                   MOVE      *ON           *IN72
     C                   MOVE      *ON           *IN98
     C                   GOTO      TAG03A
     C                   ENDIF
S55   *    VALKNR        IFGT      SISKNR
N55  C     KUNDNR        IFGT      SISKNR
     C                   MOVE      *ON           *IN83
N55  C                   MOVE      *ON           *IN98
     C                   GOTO      TAG03A
     C                   ENDIF
     C                   ELSE
     C     SISKNR        IFEQ      *ZEROS
     C                   MOVE      *ON           *IN82
N55  C                   MOVE      *ON           *IN98
     C                   GOTO      TAG03A
     C                   ENDIF
     C                   ENDIF
      *
     C                   EXSR      SUBR03                                       <FLYTT STANDARD
N50  C                   MOVE      'H'           W_EPOST
N50  C                   EXSR      SUBR14
      *
     C     VISB03        TAG
     C                   EXFMT     VR030B03
E55  C     *IN12         CABEQ     *ON           TAG03A
     C                   MOVEA     '00000'       *IN(68)                        <FEILIND
     C                   MOVEA     '00000000'    *IN(73)                        <FEILIND
     C                   MOVE      *OFF          *IN(81)                        <FEILINDIKAT
     C                   MOVE      *OFF          *IN98                          <PUTOVR
E50P C                   MOVEA     '000'         *IN(87)
      *
      *        SJEKK OM F4 ER TASTET
      *
     C     *IN04         IFEQ      *ON
     C                   Z-ADD     CURLIN        CURLI1            5 0
     C     CURLI1        DIV       256           LINJE             2 0
     C     LINJE         MULT      256           CURLI2            5 0
     C     CURLI1        SUB       CURLI2        POSISJ            3 0
      *
     C                   SELECT
N50P
N50P  *        SØK PÅ POSTNUMMER
N50P
N50P C                   WHEN          LINJE = 10
N50P C                             AND POSISJ >= 38
N50P C                             AND POSISJ <= 41
N50P C                             OR  LINJE = 10
N50P C                             AND POSISJ >= 58
N50P C                             AND POSISJ <= 67
N50P C                   MOVE      'VR841'       WPROG
N50P C                   EXSR      SUBR10                                       <Søk på koder
N50P C                   GOTO      VISB03
      *
      *        SØK PÅ LANDKODE
      *
E50  C     LINJE         WHENEQ    17
     C                   Z-ADD     1             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR907'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB03
      *
      *        SØK PÅ VALUTAKODE
      *
E50  C     LINJE         WHENEQ    18
     C                   Z-ADD     2             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR906'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB03
     C                   ENDSL
     C                   GOTO      VISB03
     C                   ENDIF                                                  <*IN04
      *----------------------------------------------------------------
      *  TEST OM F17 (IN17) FØR FEILKONTROLL
      *----------------------------------------------------------------
      *
     C     *IN17         IFEQ      *OFF
      *
     C     KNAVN         IFEQ      *BLANKS
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB03
     C                   ENDIF
      *
     C     POSTNU        IFNE      *BLANKS
     C     POSTNR        ANDNE     *ZEROS
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB03
     C                   ENDIF
      *
     C     LAND          IFNE      *BLANKS
     C     KEYU          CHAIN     KODEL01                            54
     C     *IN54         IFEQ      *ON
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB03
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB03
     C                   ENDIF
     C                   ENDIF
      *
     C     VALKOD        IFNE      *BLANKS
     C     KEYM          CHAIN     VALUL01                            54
     C     *IN54         IFEQ      *ON
     C                   MOVE      *ON           *IN74
     C                   GOTO      VISB03
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB03
     C                   ENDIF
     C                   ENDIF
      *
     C     BANKG         IFNE      *BLANKS
     C     LAND          ANDEQ     *BLANKS
E55  C                   MOVEA     BANKG         MO35
     C                   EXSR      SUBR11                                       <MOD11
     C     *IN78         IFEQ      *ON
     C     *IN79         OREQ      *ON
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB03
     C                   ENDIF
     C                   ENDIF
      *
     C     FORETN        IFLT      100000000
     C     FORETN        ANDNE     *ZEROS
     C                   MOVE      *ON           *IN77
     C                   GOTO      VISB03
     C                   ENDIF
N50P
N50P  * Kontroll av postnummer
N50P
N50P C                   IF           POSTNR <> *ZEROS
N50P C                             OR PNPBKU <> *BLANKS
N50P C                   EXSR      SUBR16
N50P C     *IN81         CABEQ     *ON           VISB03
N50P C                   ENDIF                                                  <POSTNR...
      *----------------------------------------------------------------
      *  HVIS SØKENAVN ER BLANK SETTES 10 FØRSTE FRA NAVNET INN
      *  MED STORE BOKSTAVER
      *----------------------------------------------------------------
     C     SONAVN        IFEQ      *BLANKS
     C                   Z-ADD     10            FLDLEN            5 0
     C                   MOVEL     KNAVN         FIELD            10
     C                   MOVEL     'IBMSTOR'     TBL              10
     C                   MOVEL     '*LIBL'       LIB              10
     C                   CALL      'QDCXLATE'                                   <STORE BOKST
     C                   PARM                    FLDLEN
     C                   PARM                    FIELD
     C                   PARM                    TBL
     C                   PARM                    LIB
     C                   MOVEL     FIELD         SONAVN
     C                   ENDIF
     C                   ELSE
     C                   MOVE      *OFF          *IN17
     C                   MOVE      *ON           *IN90
     C                   ENDIF
      *
     C     VISB04        TAG
     C                   MOVE      *OFF          *IN12
     C                   EXFMT     VR030B04
     C     *IN06         CABEQ     *ON           TAG03A
     C                   MOVEA     '00000'       *IN(68)                        <FEILIND
     C                   MOVEA     '00000000'    *IN(72)                        <FEILIND
     C                   MOVEA     '0000'        *IN(80)                        <FEILIND
     C                   MOVE      *OFF          *IN(85)                        <FEILIND
     C                   MOVEA     '00'          *IN(93)                        <FEILIND
E50P C                   MOVEA     '000'         *IN(87)
     C                   MOVE      *OFF          *IN98                          <PUTOVR
     C     *IN12         CABEQ     *ON           VISB03                         <FORRIGE BILDE
      *
      *        SJEKK OM F4 ER TASTET
      *
     C     *IN04         IFEQ      *ON
     C                   Z-ADD     CURLIN        CURLI1            5 0
     C     CURLI1        DIV       256           LINJE             2 0
     C     LINJE         MULT      256           CURLI2            5 0
     C     CURLI1        SUB       CURLI2        POSISJ            3 0
      *
     C                   SELECT
      *
      *        SØK PÅ AVTALEKUNDE (KUNDE)
      *
     C     LINJE         WHENEQ    22
     C                   Z-ADD     6             A
     C                   Z-ADD     2             B
     C                   MOVE      'VR910'       WPROG
E40P C                   MOVE      'B'           WPTSOK
     C                   Z-ADD     AKNRKU        SOKNR
     C     AKNRKU        IFNE      *ZEROS
E40P C                   MOVE      'O'           WPTSOK
     C                   ENDIF
     C                   OUT       DATA2
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN81
     C     *LOCK         IN        DATA2
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN81
     C                   ENDIF
     C                   MOVE      PKUNDN        AKNRKU
     C                   ENDIF
     C                   GOTO      VISB04
      *
      *        SØK PÅ FAKTURAMOTTAKER (KUNDE)
      *
     C     LINJE         WHENEQ    5
     C                   Z-ADD     6             A
     C                   Z-ADD     2             B
     C                   MOVE      'VR910'       WPROG
E40P C                   MOVE      'B'           WPTSOK
     C                   Z-ADD     FMOT          SOKNR
     C     FMOT          IFNE      *ZEROS
E40P C                   MOVE      'O'           WPTSOK
     C                   ENDIF
     C                   OUT       DATA2
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN74
     C                   MOVE      *OFF          *IN72
     C     *LOCK         IN        DATA2
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN74
     C                   MOVE      *ON           *IN72
     C                   ENDIF
     C                   MOVE      PKUNDN        FMOT
     C                   ENDIF
     C                   GOTO      VISB04
      *
      *        SØK PÅ FACTORINGSELSKAP (KUNDE)
      *
     C     LINJE         WHENEQ    6
     C                   Z-ADD     7             A
     C                   Z-ADD     2             B
     C                   MOVE      'VR910'       WPROG
E40P C                   MOVE      'B'           WPTSOK
     C                   Z-ADD     FACKNR        SOKNR
     C     FACKNR        IFNE      *ZEROS
E40P C                   MOVE      'O'           WPTSOK
     C                   ENDIF
     C                   OUT       DATA2
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN72
     C                   MOVE      *OFF          *IN68
     C     *LOCK         IN        DATA2
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN72
     C                   MOVE      *ON           *IN68
     C                   ENDIF
     C                   MOVE      PKUNDN        FACKNR
     C                   ENDIF
     C                   GOTO      VISB04
      *
      *        SØK PÅ BETALINGSBETINGELSE
      *
     C     LINJE         WHENEQ    8
     C                   Z-ADD     9             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR903'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB04
      *
      *        SØK PÅ AVGIFT 1 - 3
      *
     C     LINJE         WHENEQ    13
     C                   Z-ADD     9             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR909'       WPROG
     C     POSISJ        IFGE      34
     C     POSISJ        ANDLE     35
     C                   MOVE      AVG1          PAVG
     C                   ENDIF
     C     POSISJ        IFGE      38
     C     POSISJ        ANDLE     39
     C                   MOVE      AVG2          PAVG
     C                   ENDIF
     C     POSISJ        IFGE      42
     C     POSISJ        ANDLE     43
     C                   MOVE      AVG3          PAVG
     C                   ENDIF
     C     POSISJ        IFGE      46
     C     POSISJ        ANDLE     47
     C                   MOVE      AVG4KU        PAVG
     C                   ENDIF
     C     POSISJ        IFGE      50
     C     POSISJ        ANDLE     51
     C                   MOVE      AVG5KU        PAVG
     C                   ENDIF
     C     POSISJ        IFGE      54
     C     POSISJ        ANDLE     55
     C                   MOVE      AVG6KU        PAVG
     C                   ENDIF
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB04
      *
      *        SØK PÅ LEVERANDØR
      *
     C     LINJE         WHENEQ    21
     C                   Z-ADD     6             A
     C                   Z-ADD     2             B
     C                   MOVE      'VR911'       WPROG
     C                   MOVE      'A'           WPTSOK
     C                   Z-ADD     LEVNR         SOKNR
     C     LEVNR         IFNE      *ZEROS
     C                   MOVE      'N'           WPTSOK
     C                   ENDIF
     C                   OUT       DATA2
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN73
     C                   MOVE      *OFF          *IN81
     C     *LOCK         IN        DATA2
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN73
     C                   MOVE      *ON           *IN81
     C                   ENDIF
     C                   MOVE      PLEVNR        LEVNR
     C                   ENDIF
     C                   GOTO      VISB04
      *
     C                   ENDSL
     C                   GOTO      VISB04
     C                   ENDIF                                                  <*IN04
      *----------------------------------------------------------------
      *  TEST OM F17 (IN17) FØR FEILKONTROLL
      *----------------------------------------------------------------
     C     *IN17         IFEQ      *OFF
      *----------------------------------------------------------------
      *  TEST FELTER
      *----------------------------------------------------------------
      *
     C     AKNRKU        IFGE      1
     C                   OUT       DATA2
     C                   Z-ADD     AKNRKU        KUNDNR
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         IFEQ      *OFF
     C                   EXCEPT    KUNDA
     C                   ENDIF
     C     *IN53         IFEQ      *ON
     C                   MOVE      *ON           *IN81
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB04
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN81
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB04
     C                   ENDIF
     C     *LOCK         IN        DATA2
     C                   ENDIF
      *
     C     FMOT          IFGE      1
     C                   OUT       DATA2
     C                   Z-ADD     FMOT          KUNDNR
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         IFEQ      *OFF
     C                   EXCEPT    KUNDA
     C                   ENDIF
     C     *IN53         IFEQ      *ON
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB04
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB04
     C                   ENDIF
     C     *LOCK         IN        DATA2
     C                   ENDIF
      *
     C     FACKNR        IFGE      1
     C                   OUT       DATA2
     C                   Z-ADD     FACKNR        KUNDNR
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         IFEQ      *OFF
     C                   EXCEPT    KUNDA
     C                   ENDIF
     C     *IN53         IFEQ      *ON
     C                   MOVE      *ON           *IN72
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB04
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN72
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB04
     C                   ENDIF
     C     *LOCK         IN        DATA2
     C                   ENDIF
      *
     C     FACKNR        IFNE      *ZEROS
     C     FACT          ANDEQ     *BLANKS
     C                   MOVE      *ON           *IN69
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
      *
     C     FACT          IFNE      *BLANKS
     C     FACKNR        IFEQ      *ZEROS
     C     WWFACK        ANDEQ     *ZEROS
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C                   ENDIF
      *
     C     KEYH          CHAIN     KODAL01                            59
     C     *IN59         IFEQ      *ON
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
      *
     C     MOMS          IFNE      *BLANKS
     C                   MOVE      MOMS          AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C                   ENDIF
      *
     C     AVG1          IFNE      *BLANKS
     C                   MOVE      AVG1          AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C                   ENDIF
      *
     C     AVG2          IFNE      *BLANKS
     C                   MOVE      AVG2          AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C                   ENDIF
      *
     C     AVG3          IFNE      *BLANKS
     C                   MOVE      AVG3          AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN80
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN80
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C                   ENDIF
      *
     C     AVG4KU        IFNE      *BLANKS
     C                   MOVE      AVG4KU        AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN85
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN85
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C                   ENDIF
      *
     C     AVG5KU        IFNE      *BLANKS
     C                   MOVE      AVG5KU        AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN93
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN93
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C                   ENDIF
      *
     C     AVG6KU        IFNE      *BLANKS
     C                   MOVE      AVG6KU        AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN94
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN94
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB04
     C                   ENDIF
     C                   ENDIF
      *
      *
     C     LEVNR         IFGE      1
     C                   OUT       DATA2
     C     KEYD          CHAIN     LEVEL01                            58
     C     *IN58         IFEQ      *ON
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB04
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB04
     C                   ENDIF
     C     *LOCK         IN        DATA2
     C                   ENDIF
      *
     C                   ELSE
     C                   MOVE      *OFF          *IN17
     C                   MOVE      *ON           *IN90
     C                   ENDIF
      *
     C                   MOVE      'K'           ESPTYP
     C                   MOVE      'ORDRES'      ESDKID
     C                   MOVE      'M'           ESDKSM
     C                   MOVE      *OFF          *IN80
     C     KEYT          CHAIN     ESTYL00                            55
     C     *IN55         IFEQ      *OFF
     C     ESDKST        IFEQ      '0'
     C                   MOVE      *BLANKS       ESDKST
     C                   ENDIF                                                  <ESDKST
     C     ESDKST        IFNE      *BLANKS
     C                   MOVE      *ON           *IN80
     C                   ENDIF                                                  <ESDKST
     C                   ENDIF                                                  <*IN55
      *
     C     VISB05        TAG
     C                   MOVE      *OFF          *IN12
     C                   EXFMT     VR030B05
N24  C                   MOVE      KODEEV        XKOEEV
     C     *IN06         CABEQ     *ON           TAG03A
N40  C                   MOVEA     '000000'      *IN(67)                        <FEILIND
     C                   MOVEA     '00000000'    *IN(73)                        <FEILIND
     C                   MOVE      *OFF          *IN(81)                        <FEILINDIKAT
     C                   MOVE      *OFF          *IN89                          <FEILIND
     C                   MOVE      *OFF          *IN55                          <CHAIN
     C                   MOVE      *OFF          *IN98                          <PUTOVR
E50P C                   MOVEA     '000'         *IN(87)
     C     *IN12         CABEQ     *ON           VISB04                         <FORRIGE BILDE
      *
      *        SJEKK OM F4 ER TASTET
      *
     C     *IN04         IFEQ      *ON
     C                   Z-ADD     CURLIN        CURLI1            5 0
     C     CURLI1        DIV       256           LINJE             2 0
     C     LINJE         MULT      256           CURLI2            5 0
     C     CURLI1        SUB       CURLI2        POSISJ            3 0
      *
     C                   SELECT
      *
      *        SØK PÅ KUNDEGRUPPE
      *
     C     LINJE         WHENEQ    5
     C                   Z-ADD     6             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR914'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB05
      *
      *        SØK PÅ DISTRIKT ?
      *
     C     LINJE         WHENEQ    6
     C                   MOVE      'D'           FIL
     C                   Z-ADD     7             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR902'       WPROG
     C                   Z-ADD     DISTR         WNUMSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN74
     C                   MOVE      *OFF          *IN75
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN74
     C                   MOVE      *ON           *IN75
     C                   ENDIF
     C                   Z-ADD     WNUMSO        DISTR
     C                   ENDIF
     C                   GOTO      VISB05
      *
      *        SØK PÅ SELGER ?
      *
     C     LINJE         WHENEQ    7
     C                   MOVE      'S'           FIL
     C                   Z-ADD     8             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR901'       WPROG
     C                   MOVEL     SELGER        WALFSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN75
     C                   MOVE      *OFF          *IN76
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN75
     C                   MOVE      *ON           *IN76
     C                   ENDIF
     C                   MOVE      WALFSO        SELGER
     C                   ENDIF
     C                   GOTO      VISB05
      *
      *        SØK PÅ LAGERNR ?
      *
     C     LINJE         WHENEQ    8
     C                   MOVE      'L'           FIL
     C                   Z-ADD     9             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR901'       WPROG
     C                   MOVEL     LAGNR         WALFSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN76
     C                   MOVE      *OFF          *IN77
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN76
     C                   MOVE      *ON           *IN77
     C                   ENDIF
     C                   MOVEL     WALFSO        LAGNR
     C                   ENDIF
     C                   GOTO      VISB05
      *
      *        SØK PÅ LEVERINGSBETINGELSE ?
      *
     C     LINJE         WHENEQ    21
     C                   MOVE      'M'           FIL
     C                   Z-ADD     5             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR901'       WPROG
     C                   MOVEL     LEVBET        WALFSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN78
     C     HLPI12        IFNE      '1'
     C                   MOVEL     WALFSO        LEVBET
     C                   ENDIF
     C                   GOTO      VISB05
N24   *
N24   *        SØK PÅ EKSTERNT VARENUMMERKODE ?
N24   *
N24  C     LINJE         WHENEQ    22
N24  C                   MOVE      'T'           FIL
N24  C                   Z-ADD     6             A
N24  C                   Z-ADD     33            B
N24  C                   MOVE      'VR901'       WPROG
N24  C                   MOVEL     KODEEV        WALFSO
N24  C                   EXSR      SUBR10                                       <Søk på koder
N24  C                   MOVE      *ON           *IN76
N24  C     HLPI12        IFNE      '1'
N24  C     WPNONE        IFNE      '1'
N24  C                   MOVE      *OFF          *IN76
N24  C                   ENDIF                                                  <WPNONE
N24  C                   MOVEL     WALFSO        KODEEV
N24  C                   ENDIF                                                  <HLPI12
N24  C                   GOTO      VISB05
      *
      *        SØK PÅ RUTENR ?
      *
     C     LINJE         WHENEQ    9
     C                   MOVE      'R'           FIL
     C                   Z-ADD     10            A
     C                   Z-ADD     33            B
     C                   MOVE      'VR902'       WPROG
     C                   Z-ADD     RUTENR        WNUMSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN77
     C                   MOVE      *OFF          *IN72
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN77
     C                   MOVE      *ON           *IN72
     C                   ENDIF
     C                   Z-ADD     WNUMSO        RUTENR
     C                   ENDIF
     C                   GOTO      VISB05
     C                   OTHER
     C                   GOTO      VISB05
      *
     C                   ENDSL
     C                   ENDIF                                                  *IN04
      *----------------------------------------------------------------
      *  TEST OM F17 (IN17) FØR FEILKONTROLL
      *----------------------------------------------------------------
     C     *IN17         IFEQ      *OFF
      *----------------------------------------------------------------
      *   TEST FELTER
      *----------------------------------------------------------------
N40  C                   IF        EHANKU = 'N'
N40  C                   EVAL      EHANKU = *BLANKS
N40  C                   ENDIF                                                  IF EHANKU
N40  C                   IF        EHANKU = *BLANKS AND EHOTKU <> *BLANKS
N40  C                   EVAL      *IN67 = *ON
N40  C                   EVAL      *IN98 = *ON
N40  C                   GOTO      VISB05
N40  C                   ENDIF                                                  IF EHANKU
N40  C                   IF        EHOTKU = 'L' AND LALOSO <> 'J'
E40P C                   EVAL      *IN71 = *ON
N40  C                   EVAL      *IN98 = *ON
N40  C                   GOTO      VISB05
N40  C                   ENDIF                                                  IF EHOTKU
     C     KUNDGR        IFNE      *BLANKS
     C     KEYN          CHAIN     KODKL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB05
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB05
     C                   ENDIF
     C                   ENDIF
      *
     C     DISTR         IFGE      1
     C     KEYI          CHAIN     KODDL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB05
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB05
     C                   ENDIF
     C                   ENDIF
      *
     C     SELGER        IFNE      *BLANKS
     C     KEYS          CHAIN     KODUL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB05
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB05
     C                   ENDIF
     C                   ENDIF
      *
     C     LAGNR         IFNE      *BLANKS
     C     KEYO          CHAIN     KODLL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB05
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB05
     C                   ENDIF
     C                   ENDIF
      *
     C                   MOVE      'K'           ESPTYP
     C                   MOVE      'ORDRES'      ESDKID
     C                   MOVE      'M'           ESDKSM
     C     KEYT          CHAIN     ESTYL00                            55
     C     *IN55         IFEQ      *OFF
     C     ESDKST        IFEQ      '0'
     C                   MOVE      *BLANKS       ESDKST
     C                   ENDIF                                                  <ESDKST
     C     ESDKST        IFNE      *BLANKS
     C     LAGNR         ANDEQ     *BLANKS
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB05
     C                   ENDIF                                                  <ESDKST..
     C                   ENDIF                                                  <*IN55
      *
     C     RUTENR        IFGE      1
     C     KEYR          CHAIN     KODRL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB05
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB05
     C                   ENDIF
     C                   ENDIF
N50P
N50P  * Egeninkasso (PKOD = E) er bare tillatt hvis postnr.
N50P  * innland er utfylt og hvis purregebyrkode i systemfilen
N50P  * SYSDF = "J"
N50P
N50P C                   IF        PKOD   = 'E'
N50P C                   IF           POSTNR    = *ZEROS
N50P C                             OR SD_PURGEB = *BLANKS
N50P C                   EVAL      *IN81 = *ON
N50P C                   EVAL      *IN98 = *ON
N50P C                   GOTO      VISB05
N50P C                   ENDIF                                                  <POSTNR...
N50P C                   ENDIF                                                  <PKOD
N50P
N50P  * Purregebyrkode "J" er bare tillatt hvis purrekoden er
N50P  * "E" eller "J" og purregebyrkode i systemfilen
N50P  * SYSDF = "J"
N50P
N50P C                   IF        PGEBYR = 'J'
N50P C                   IF           PKOD      = *BLANKS
N50P C                             OR SD_PURGEB = *BLANKS
N50P C                   EVAL      *IN89 = *ON
N50P C                   EVAL      *IN98 = *ON
N50P C                   GOTO      VISB05
N50P C                   ENDIF                                                  <PKOD...
N50P C                   ENDIF                                                  <PGEBYR
      *
     C     LEVBET        IFNE      *BLANKS
     C     KEYP          CHAIN     KODML01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB05
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB05
     C                   ENDIF
     C                   ENDIF
      *
N24  C     KODEEV        IFNE      *BLANKS
N24  C     KEYPT         CHAIN     KODTL01                            55
N24  C     *IN55         IFEQ      *ON
N24  C                   MOVE      *ON           *IN80
N24  C                   MOVE      *ON           *IN98
N24  C                   GOTO      VISB05
N24  C                   ENDIF                                                  <*IN55
N24  C     AKTKOD        IFNE      'A'
N24  C                   MOVE      *ON           *IN80
N24  C                   MOVE      *ON           *IN98
N24  C                   GOTO      VISB05
N24  C                   ENDIF                                                  <AKTKOD
N24  C                   ENDIF                                                  <KODEEV
N24   *
     C                   ELSE
     C                   MOVE      *OFF          *IN17
     C                   MOVE      *ON           *IN90
     C                   ENDIF
      *
     C     FEKS          IFLT      1
     C                   Z-ADD     1             FEKS
     C                   ENDIF
      *
     C     VISB16        TAG
     C                   MOVE      *OFF          *IN12
     C                   EXFMT     VR030B16
     C     *IN06         CABEQ     *ON           TAG03A
     C                   MOVEA     '00000'       *IN(68)                        <FEILIND
     C                   MOVEA     '00000'       *IN(73)                        <FEILIND
     C                   MOVEA     '0000'        *IN(78)                        <FEILIND
     C                   MOVE      *OFF          *IN98                          <PUTOVR
E50P C                   MOVEA     '000'         *IN(87)                        <RETUR FRA VR901
     C     *IN12         CABEQ     *ON           VISB05                         <FORRIGE BILDE
      *
      *        SJEKK OM F4 ER TASTET
      *
     C     *IN04         IFEQ      *ON
     C                   Z-ADD     CURLIN        CURLI1            5 0
     C     CURLI1        DIV       256           LINJE             2 0
     C     LINJE         MULT      256           CURLI2            5 0
     C     CURLI1        SUB       CURLI2        POSISJ            3 0
      *
     C                   SELECT
      *
      *        SØK PÅ KONTOHENVISNINGSKODE
      *
     C     LINJE         WHENEQ    5
     C                   Z-ADD     6             A
     C                   Z-ADD     25            B
     C                   MOVE      'VR913'       WPROG                                      r
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB16
      *
      *        SØK PÅ LEVERINGSMÅTE ?
      *
     C     LINJE         WHENEQ    6
     C                   MOVE      'N'           FIL
     C                   Z-ADD     7             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR901'       WPROG                                      r
     C                   MOVEL     LEVMAT        WALFSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN74
     C                   MOVE      *OFF          *IN68
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN74
     C                   MOVE      *ON           *IN68
     C                   ENDIF
     C                   MOVEL     WALFSO        LEVMAT
     C                   ENDIF
     C                   GOTO      VISB16
      *
      *        SØK PÅ SPEDITØR / SPEDITØR UTLAND
      *
     C     LINJE         WHENEQ    8
     C                   Z-ADD     9             A
     C                   Z-ADD     3             B
     C                   MOVE      'VR904'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB16
      *
      *        SØK PÅ VAREADRESSE
      *
     C     LINJE         WHENEQ    16
     C                   Z-ADD     6             A
     C                   Z-ADD     3             B
     C                   MOVE      'VR920'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB16
      *
      *        SØK PÅ RESKONTROTYPE
      *
     C     LINJE         WHENEQ    19
     C                   Z-ADD     8             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR925'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB16
      *
      *        SØK PÅ PRIS/RABATTGRUPPE
      *
     C     LINJE         WHENEQ    21
     C                   Z-ADD     6             A
     C                   Z-ADD     2             B
E24  C                   MOVE      'VR928'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB16
      *
     C                   OTHER
     C                   GOTO      VISB16
      *
     C                   ENDSL
     C                   ENDIF                                                  *IN04
      *----------------------------------------------------------------
      *  TEST OM F17 (IN17) FØR FEILKONTROLL
      *----------------------------------------------------------------
     C     *IN17         IFEQ      *OFF
      *----------------------------------------------------------------
      *   TEST FELTER
      *----------------------------------------------------------------
     C                   MOVE      'D'           RECTYP
     C     KEYJ          CHAIN     KHEDL01                            61
     C     *IN61         IFEQ      *ON
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB16
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB16
     C                   ENDIF
     C     LEVMAT        IFNE      *BLANKS
     C     KEYQ          CHAIN     KODNL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB16
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB16
     C                   ENDIF
     C                   ENDIF
      *
     C     SPEDNR        IFNE      *BLANKS
     C     KEYL          CHAIN     KODSL01                            62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB16
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB16
     C                   ENDIF
     C                   ENDIF
      *
     C     SPEDNU        IFNE      *BLANKS
     C                   OUT       DATA2
     C     KEYLU         CHAIN     KODSL01                            62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB16
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB16
     C                   ENDIF
     C     *LOCK         IN        DATA2
     C                   ENDIF
      *
     C     VADRKU        IFNE      *ZEROS
     C     KEYV          CHAIN     VADRL01                            62
N50P C                   CLEAR                   LD_PROG
N50P C                   CLEAR                   LD_KUND
N50P C                   CLEAR                   LD_VADR
N50P
N50P  * Hvis vareadressen ikke finnes vil programm VR300
N50P  * automatisk bli hentet etter at kunden er registrert.
N50P
     C     *IN62         IFEQ      *ON
N50P C                   EVAL      LD_PROG = 'VR030'
N50P C                   EVAL      LD_KUND = KUNDNR
N50P C                   EVAL      LD_VADR = VADRKU
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB16
     C                   ENDIF
     C                   ENDIF
      *
     C     RETYKU        IFNE      *BLANKS
     C     KEYW          CHAIN     KODQ1A                             62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB16
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB16
     C                   ENDIF
     C                   ENDIF
      *
     C     PRIKKU        IFNE      *BLANKS
     C     KEYX          CHAIN     KODYL01                            62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN80
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB16
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN80
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB16
     C                   ENDIF
     C                   ENDIF
      *
     C     AUTKOD        IFNE      *BLANKS
     C     BETMAT        ANDNE     'A'
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB16
     C                   ENDIF
      *
     C                   ELSE
     C                   MOVE      *OFF          *IN17
     C                   MOVE      *ON           *IN90
     C                   ENDIF
      ****
      *  HENT KUNDENUMMER
      ****
     C     KUNDNR        IFEQ      *ZEROS
     C     KEYF          CHAIN     SYSBL01                            52
     C     SISKNR        IFNE      99999999
     C                   ADD       1             SISKNR
     C                   Z-ADD     SISKNR        KUNDNR
     C                   ELSE
     C                   Z-ADD     1             SISKNR
     C                   Z-ADD     1             KUNDNR
     C                   ENDIF
      *----------------------------------------------------------------
      *  SJEKK OM KUNDNUMMER FINNES
      *----------------------------------------------------------------
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         IFEQ      *OFF
     C                   MOVE      *ON           *IN95
     C                   MOVE      *ON           *IN98
S55   *                  Z-ADD     KUNDNR        SKUNNR
N55P C                   Z-ADD     KUNDNR        W_WKNR
N55P C                   MOVEL     TXT(1)        W_TXT
     C                   EXCEPT    KUNDA
     C                   EXCEPT    SYUTB
     C                   GOTO      TAG03A
     C                   ENDIF
      *
     C                   UPDATE    SYSBR
S55   *                  Z-ADD     KUNDNR        WKNR
N55P C                   Z-ADD     KUNDNR        W_WKNR
N55P C                   MOVEL     TXT(2)        W_TXT
     C                   MOVE      *ON           *IN96
     C                   ENDIF
      *----------------------------------------------------------------
      *  FLYTT VERDIER TIL FELT SOM IKKE REGISTRERES
      *----------------------------------------------------------------
     C                   MOVE      *ZEROS        KRTID
     C                   MOVE      *ZEROS        INNAAR
     C                   MOVE      *ZEROS        INNMND
     C                   MOVE      *ZEROS        INNDAG
     C                   MOVE      *ZEROS        SISAAR
     C                   MOVE      *ZEROS        SISMND
     C                   MOVE      *ZEROS        SISDAG
     C                   MOVE      *ZEROS        KSALDO
     C                   MOVE      *ZEROS        KUTSK
     C                   MOVE      *ZEROS        FAIAAR
     C                   MOVE      *ZEROS        FAIFJ
     C                   MOVE      *ZEROS        KJIAAR
     C                   MOVE      *ZEROS        KJIFJ
     C                   MOVE      *ZEROS        FOIAAR
     C                   MOVE      *ZEROS        FOIFJ
     C                   MOVE      *ZEROS        REIAAR
     C                   MOVE      *ZEROS        REIFJ
     C                   MOVE      *ZEROS        RAIAAR
     C                   MOVE      *ZEROS        RAIFJ
     C                   MOVE      *ZEROS        BONGRL
     C                   MOVE      *ZEROS        BONOPT
     C                   MOVE      *ZEROS        AOIAAR
     C                   MOVE      *ZEROS        AOIFJ
E24  C                   MOVE      *YEAR         DAOAAR
     C                   MOVE      UMONTH        DAOMND
     C                   MOVE      UDAY          DAODAG
     C                   MOVE      *ZEROS        RESTK
     C                   MOVE      *ZEROS        KUTSKF
     C                   MOVE      *ZEROS        ORDVRD
     C                   MOVE      *ZEROS        KGRAAR
     C                   MOVE      *ZEROS        KGRMND
     C                   MOVE      *ZEROS        KGRDAG
     C                   CLEAR                   BGRIKU
     C                   CLEAR                   BOIFKU
     C                   CLEAR                   RSATKU
      *
     C     KGRENS        IFNE      *ZEROS
E24  C                   MOVE      *YEAR         KGRAAR
     C                   MOVE      UMONTH        KGRMND
     C                   MOVE      UDAY          KGRDAG
     C                   ENDIF                                                  <KGRENS
      *----------------------------------------------------------------
      *  OPPDATER FILSTATUS
      *----------------------------------------------------------------
     C     KEYG          CHAIN     SYSRL01                            50
     C                   ADD       1             ANTBRU
     C     *IN90         IFEQ      *ON
     C                   ADD       1             ANTFEI
     C                   ENDIF
      *
E55P C     W_IN25        IFEQ      *ON
     C     HLPJNR        ANDEQ     *ZEROS
     C     SJOUR         ADD       1             HLPJNR
     C                   Z-ADD     HLPJNR        SJOUR
     C                   ENDIF
      *
     C     *IN50         IFEQ      *OFF
     C                   UPDATE    SYSRR
     C                   ENDIF
     C                   ADD       1             NYE
      ****
E55P  *  SKRIV LISTE HVIS W_IN25 = '1'
      ****
E55P C     W_IN25        IFEQ      *ON
     C                   MOVE      *ON           *IN64
E55P C     W_IN26        IFEQ      *OFF
     C                   OPEN      VR030U01
E55P C                   MOVE      *ON           W_IN26
     C                   ENDIF
     C                   Z-ADD     HLPJNR        JOURNR
     C                   WRITE     VR030S01
     C                   MOVE      *OFF          *IN64
     C                   ENDIF
      *
     C     *IN90         IFEQ      *OFF
     C                   MOVE      'A'           AKTKOD                         <INGEN FEIL
     C                   ELSE
     C                   MOVE      'E'           AKTKOD                         <REG M/FEIL
     C                   ENDIF
      *
     C     POKOD         IFEQ      'J'
     C     AKTKOD        ANDEQ     'A'
     C     OFKPOS        IFEQ      *BLANK
N40P C     OFKPOS        OREQ      'J'
     C                   MOVE      'J'           ENDPOS
     C                   ENDIF
     C                   ENDIF
      *
N24  C                   MOVE      XKOEEV        KODEEV
N24  C                   MOVE      *ZEROS        ORDRAB
N24  C                   MOVE      *ZEROS        EANNKU
N24P C                   MOVE      *ZEROS        SAIFKU
N50P
N50P C                   IF        ADR3 = *BLANKS
N50P C                   EVAL      ADR3 = P8_POSTED
N50P C                   ENDIF                                                  <ADR3
N50P
N55P C                   CLEAR                   DSSFKU
     C                   WRITE     KUNDR
     C                   WRITE     KKUNR
SY   C                   MOVE      '0'           SYSY              1
SY   C                   MOVE      KUNDNR        SYKUAL            8
SY   C                   CALL      'VKUNDCLI'
SY   C                   PARM                    SYSY
SY   C                   PARM                    FIRMA
SY   C                   PARM                    SYKUAL
N50  C                   MOVE      'O'           W_EPOST
N50  C                   EXSR      SUBR14
N50P
N50P  * Overgang til vedl.hold av vareadresser
N50P
N50P C                   IF            LD_PROG = 'VR030'
N50P C                             AND LD_KUND > *ZEROS
N50P C                             AND LD_VADR > *ZEROS
N50P C                   OUT       DATA1
N50P C                   CALL      'VR300'
N50P C                   EVAL      LD_PROG = *BLANKS
N50P C                   EVAL      LD_KUND = *ZEROS
N50P C                   EVAL      LD_VADR = *ZEROS
N50P C                   OUT       DATA1
N50P C                   ENDIF                                                  <LD_PROG...
N50P
      *
     C     ENDPOS        IFEQ      'J'
     C                   EXSR      SUBR12
     C                   ENDIF
      *
     C     TAG03A        TAG
     C                   MOVE      *OFF          *IN90
     C                   ENDSR
      /EJECT
      *----------------------------------------------------------------
      *  S U B R 0 2    ENDRING PÅ KUNDEFILEN
      *----------------------------------------------------------------
     C     SUBR02        BEGSR
     C                   MOVE      *OFF          *IN92
     C                   MOVE      *OFF          *IN66                          <PRINTTEKST
     C                   MOVE      *OFF          *IN67                          <PRINTTEKST
S55   **   *LOCK         IN        DATA2
      *----------------------------------------------------------------
      *  HVIS SØKEBEGREP ER TASTET
      *----------------------------------------------------------------
     C                   MOVE      WFIRMA        FIRMA
S55   *                  Z-ADD     VALKNR        KUNDNR
      ****
      *  HVIS INGEN SØKEBEGREP ER TASTET VIS ALFASØK
      ****
      *
     C     *IN06         CABEQ     *ON           TAG04A
      *----------------------------------------------------------------
      *  CHAIN MED KUNDENUMMER ELLER TELEFONNR.
      *----------------------------------------------------------------
S55   *    VALTLF        IFNE      *BLANKS
S55   *                  MOVE      VALTLF        TLF
S55   *    KEYC          CHAIN     KUNDL03                            53
S55   *    *IN53         IFEQ      *ON
S55   *                  CLEAR                   KUNDNR
S55   *                  ENDIF                                                  <*IN53
S55   *                  ENDIF                                                  <VALTLF
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         IFEQ      *OFF
      *
     C                   MOVE      KNAVN         XKNAVN           30
     C                   MOVE      SONAVN        XSONAV           10
     C                   MOVE      RABAT1        XRABA1            1
     C                   MOVE      RABAT2        XRABA2            1
     C                   MOVE      RABAT3        XRABA3            1
     C                   MOVE      KUNDGR        XKUNDG            2
N40P C                   MOVE      PRIKKU        XPRIKK            2
     C                   MOVE      KVERD         XKVERD            1
     C                   MOVE      TILBKD        XTILBK            1
     C                   MOVE      BKDBKU        XBKDBK
     C                   Z-ADD     PRISK         XPRISK            1 0
     C                   Z-ADD     KGRENS        XKGREN            7 0
      *
     C     AKTKOD        IFEQ      'I'
     C                   MOVEL     'INAKTIV'     WTEKST
     C                   ELSE
     C                   MOVE      *BLANKS       WTEKST
     C                   ENDIF                                                  <AKTKOD
     C                   MOVE      AKTKOD        HLPAKO
     C                   EXCEPT    KUNDA
N50  C                   MOVE      'H'           W_EPOST
N50  C                   EXSR      SUBR14
      *
     C     VISB06        TAG
     C                   MOVE      'K'           OTBKOD
     C                   Z-ADD     KUNDNR        RESNR
     C     KEYKOM        SETLL     NOTAL01                                84
     C                   MOVE      'F'           OTBKOD
     C                   Z-ADD     KUNDNR        RESNR
     C     KEYKOM        SETLL     NOTAL01                                45
     C                   EXFMT     VR030B06
E55  C     *IN12         CABEQ     *ON           TAG04A
     C                   MOVEA     '00000'       *IN(68)                        <FEILIND
     C                   MOVEA     '00000000'    *IN(73)                        <FEILINDIKAT
     C                   MOVE      *OFF          *IN(81)                        <FEILINDIKAT
     C                   MOVE      *OFF          *IN98                          <PUTOVR
E50P C                   MOVEA     '000'         *IN(87)
      *
      *        SJEKK OM F4 ER TASTET
      *
     C     *IN04         IFEQ      *ON
     C                   Z-ADD     CURLIN        CURLI1            5 0
     C     CURLI1        DIV       256           LINJE             2 0
     C     LINJE         MULT      256           CURLI2            5 0
     C     CURLI1        SUB       CURLI2        POSISJ            3 0
      *
     C                   SELECT
N50P
N50P  *        SØK PÅ POSTNUMMER
N50P
N50P C                   WHEN          LINJE = 10
N50P C                             AND POSISJ >= 38
N50P C                             AND POSISJ <= 41
N50P C                             OR  LINJE = 10
N50P C                             AND POSISJ >= 58
N50P C                             AND POSISJ <= 67
N50P C                   MOVE      'VR841'       WPROG
N50P C                   EXSR      SUBR10                                       <Søk på koder
N50P C                   GOTO      VISB06
      *
      *        SØK PÅ LANDKODE
      *
E50  C     LINJE         WHENEQ    17
     C                   Z-ADD     1             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR907'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB06
      *
      *        SØK PÅ VALUTAKODE
      *
E50  C     LINJE         WHENEQ    18
     C                   Z-ADD     2             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR906'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB06
      *
     C                   ENDSL
     C                   GOTO      VISB06
     C                   ENDIF                                                  <*IN04
N50
N50   * URL-adresse
N50
N50  C                   IF        *IN20 = *ON
N50  C                   EVAL      P_BEHKOD = *BLANKS
N50  C                   EXSR      SUBR13
N50  C                   GOTO      VISB06
N50  C                   ENDIF                                                  <*IN20
N50
N50   * Forespørsel kontakter (F24)
N50
N50  C                   IF        *IN24 = *ON
E55  C                   EXSR      SUBR17
N50P
E55  C                   IF        LD_NAVN <> *BLANKS
E55  C                   EVAL      KPERS = LD_NAVN
N50P C                   EVAL      *IN98 = *ON
N50P C                   ENDIF                                                  <LD_NAVN
N50P
N55  C                   CLEAR                   LD_NAVN
N55  C                   OUT       DATA1
N50  C                   GOTO      VISB06
N50  C                   ENDIF                                                  <*IN20
      *
     C     *IN21         IFEQ      *ON
     C                   MOVE      '1'           TXTKOD
     C                   MOVE      KUNDNR        TXTBGR
     C                   CALL      'VR350'
     C                   PARM                    PARMD2
N24P C                   MOVE      *ON           *IN98
     C                   GOTO      VISB06
     C                   ENDIF                                                  <*IN21
      *
     C     *IN22         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'F'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
S55   *                  MOVE      VALG          WFEILK
N55P C                   MOVE      'E'           WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
N24P C                   MOVE      *ON           *IN98
     C                   GOTO      VISB06
     C                   ENDIF                                                  <*IN22
      *
     C     *IN23         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'K'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
N55P C                   MOVE      'E'           WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
N24P C                   MOVE      *ON           *IN98
     C                   GOTO      VISB06
     C                   ENDIF                                                  <*IN23
      *
      *----------------------------------------------------------------
      *  TEST FELTER
      *----------------------------------------------------------------
     C     KNAVN         IFEQ      *BLANKS
     C                   MOVE      *ON           *IN73                          <BLANK KNAVN
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB06
     C                   ENDIF                                                  <KNAVN
      *
     C     POSTNU        IFNE      *BLANKS
     C     POSTNR        ANDNE     *ZEROS
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB06
     C                   ENDIF                                                  <POSTNU ..
      *
     C     LAND          IFNE      *BLANKS
     C     KEYU          CHAIN     KODEL01                            54
     C     *IN54         IFEQ      *ON
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB06
     C                   ENDIF                                                  <LAND
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB06
     C                   ENDIF                                                  <AKTKOD
     C                   ENDIF
      *
     C     VALKOD        IFNE      *BLANKS
     C     KEYM          CHAIN     VALUL01                            54
     C     *IN54         IFEQ      *ON
     C                   MOVE      *ON           *IN74                          <UKJ.VALKOD
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB06
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN74                          <UKJ.VALKOD
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB06
     C                   ENDIF
     C                   ENDIF
      *
     C     BANKG         IFNE      *BLANKS
     C     LAND          ANDEQ     *BLANKS
E55  C                   MOVEA     BANKG         MO35
     C                   EXSR      SUBR11                                       <MOD11
     C     *IN78         IFEQ      *ON
     C     *IN79         OREQ      *ON
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB06
     C                   ENDIF
     C                   ENDIF
      *
     C     FORETN        IFLT      100000000
     C     FORETN        ANDNE     *ZEROS
     C                   MOVE      *ON           *IN77
     C                   GOTO      VISB06
     C                   ENDIF
N50P
N50P  * Kontroll av postnummer
N50P
N50P C                   IF           POSTNR <> *ZEROS
N50P C                             OR PNPBKU <> *BLANKS
N50P C                   EXSR      SUBR16
N50P C     *IN81         CABEQ     *ON           VISB06
N50P C                   ENDIF                                                  <POSTNR...
      *----------------------------------------------------------------
      *  HVIS SØKENAVN ER BLANK SETTES 10 FØRSTE FRA NAVNET INN
      *  MED STORE BOKSTAVER
      *----------------------------------------------------------------
     C     SONAVN        IFEQ      *BLANKS
     C                   Z-ADD     10            FLDLEN            5 0
     C                   MOVEL     KNAVN         FIELD            10
     C                   MOVEL     'IBMSTOR'     TBL              10
     C                   MOVEL     '*LIBL'       LIB              10
     C                   CALL      'QDCXLATE'
     C                   PARM                    FLDLEN
     C                   PARM                    FIELD
     C                   PARM                    TBL
     C                   PARM                    LIB
     C                   MOVEL     FIELD         SONAVN
     C                   ENDIF
      *
     C     VISB07        TAG
     C                   MOVE      *OFF          *IN12
     C                   EXFMT     VR030B07
     C     *IN06         CABEQ     *ON           TAG04A
     C                   MOVEA     '00000'       *IN(68)                        <FEILIND
     C                   MOVEA     '00000000'    *IN(72)                        <FEILIND
     C                   MOVEA     '0000'        *IN(80)                        <FEILIND
     C                   MOVE      *OFF          *IN(85)                        <FEILIND
     C                   MOVEA     '00'          *IN(93)                        <FEILIND
     C                   MOVE      *OFF          *IN98                          <PUTOVR
E50P C                   MOVEA     '000'         *IN(87)
     C     *IN12         CABEQ     *ON           VISB06                         <FORRIGE BILDE
      *
      *        SJEKK OM F4 ER TASTET
      *
     C     *IN04         IFEQ      *ON
     C                   Z-ADD     CURLIN        CURLI1            5 0
     C     CURLI1        DIV       256           LINJE             2 0
     C     LINJE         MULT      256           CURLI2            5 0
     C     CURLI1        SUB       CURLI2        POSISJ            3 0
      *
     C                   SELECT
      *
      *        SØK PÅ AVTALEKUNDE (KUNDE)
      *
     C     LINJE         WHENEQ    22
     C                   Z-ADD     6             A
     C                   Z-ADD     2             B
     C                   MOVE      'VR910'       WPROG
E40P C                   MOVE      'B'           WPTSOK
     C                   Z-ADD     AKNRKU        SOKNR
     C     AKNRKU        IFNE      *ZEROS
E40P C                   MOVE      'O'           WPTSOK
     C                   ENDIF
     C                   OUT       DATA2
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN81
     C     *LOCK         IN        DATA2
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN81
     C                   ENDIF
     C                   MOVE      PKUNDN        AKNRKU
     C                   ENDIF
     C                   GOTO      VISB07
      *
      *        SØK PÅ FAKTURAMOTTAKER (KUNDE)
      *
     C     LINJE         WHENEQ    5
     C                   Z-ADD     6             A
     C                   Z-ADD     2             B
     C                   MOVE      'VR910'       WPROG
E40P C                   MOVE      'B'           WPTSOK
     C                   Z-ADD     FMOT          SOKNR
     C     FMOT          IFNE      *ZEROS
E40P C                   MOVE      'O'           WPTSOK
     C                   ENDIF
     C                   OUT       DATA2
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN74
     C                   MOVE      *OFF          *IN72
     C     *LOCK         IN        DATA2
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN74
     C                   MOVE      *ON           *IN72
     C                   ENDIF
     C                   MOVE      PKUNDN        FMOT
     C                   ENDIF
     C                   GOTO      VISB07
      *
      *        SØK PÅ FACTORINGSELSKAP (KUNDE)
      *
     C     LINJE         WHENEQ    6
     C                   Z-ADD     7             A
     C                   Z-ADD     2             B
     C                   MOVE      'VR910'       WPROG
E40P C                   MOVE      'B'           WPTSOK
     C                   Z-ADD     FACKNR        SOKNR
     C     FACKNR        IFNE      *ZEROS
E40P C                   MOVE      'O'           WPTSOK
     C                   ENDIF
     C                   OUT       DATA2
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN72
     C                   MOVE      *OFF          *IN68
     C     *LOCK         IN        DATA2
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN72
     C                   MOVE      *ON           *IN68
     C                   ENDIF
     C                   MOVE      PKUNDN        FACKNR
     C                   ENDIF
     C                   GOTO      VISB07
      *
      *        SØK PÅ BETALINGSBETINGELSE
      *
     C     LINJE         WHENEQ    8
     C                   Z-ADD     9             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR903'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB07
      *
      *        SØK PÅ AVGIFT 1 - 3
      *
     C     LINJE         WHENEQ    13
     C                   Z-ADD     9             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR909'       WPROG
     C     POSISJ        IFGE      34
     C     POSISJ        ANDLE     35
     C                   MOVE      AVG1          PAVG
     C                   ENDIF
     C     POSISJ        IFGE      38
     C     POSISJ        ANDLE     39
     C                   MOVE      AVG2          PAVG
     C                   ENDIF
     C     POSISJ        IFGE      42
     C     POSISJ        ANDLE     43
     C                   MOVE      AVG3          PAVG
     C                   ENDIF
     C     POSISJ        IFGE      46
     C     POSISJ        ANDLE     47
     C                   MOVE      AVG4KU        PAVG
     C                   ENDIF
     C     POSISJ        IFGE      50
     C     POSISJ        ANDLE     51
     C                   MOVE      AVG5KU        PAVG
     C                   ENDIF
     C     POSISJ        IFGE      54
     C     POSISJ        ANDLE     55
     C                   MOVE      AVG6KU        PAVG
     C                   ENDIF
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB07
      *
      *        SØK PÅ LEVERANDØR
      *
     C     LINJE         WHENEQ    21
     C                   Z-ADD     6             A
     C                   Z-ADD     2             B
     C                   MOVE      'VR911'       WPROG
     C                   MOVE      'A'           WPTSOK
     C                   Z-ADD     LEVNR         SOKNR
     C     LEVNR         IFNE      *ZEROS
     C                   MOVE      'N'           WPTSOK
     C                   ENDIF
     C                   OUT       DATA2
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN73
     C                   MOVE      *OFF          *IN81
     C     *LOCK         IN        DATA2
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN73
     C                   MOVE      *ON           *IN81
     C                   ENDIF
     C                   MOVE      PLEVNR        LEVNR
     C                   ENDIF
     C                   GOTO      VISB07
      *
     C                   ENDSL
     C                   GOTO      VISB07
     C                   ENDIF                                                  <*IN04
N50
N50   * URL-adresse
N50
N50  C                   IF        *IN20 = *ON
N50  C                   EVAL      P_BEHKOD = *BLANKS
N50  C                   EXSR      SUBR13
N50  C                   GOTO      VISB07
N50  C                   ENDIF                                                  <*IN20
N50
      *
     C     *IN21         IFEQ      *ON
     C                   MOVE      '1'           TXTKOD
     C                   MOVE      KUNDNR        TXTBGR
     C                   CALL      'VR350'
     C                   PARM                    PARMD2
N24P C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
      *
     C     *IN22         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'F'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
N55P C                   MOVE      'E'           WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
N24P C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
      *
     C     *IN23         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'K'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
N55P C                   MOVE      'E'           WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
N24P C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
      *
      *----------------------------------------------------------------
      *  TEST FELTER
      *----------------------------------------------------------------
      *
     C     AKNRKU        IFGE      1
     C                   OUT       DATA2
     C                   Z-ADD     AKNRKU        KUNDNR
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         IFEQ      *OFF
     C                   EXCEPT    KUNDA
     C                   ENDIF
     C     *IN53         IFEQ      *ON
     C                   MOVE      *ON           *IN81                          <UKJ.AKNRKU
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB07
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN81                          <UKJ.AKNRKU
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB07
     C                   ENDIF
     C     *LOCK         IN        DATA2
     C                   ENDIF
      *
     C     FMOT          IFGE      1
     C                   OUT       DATA2
     C                   Z-ADD     FMOT          KUNDNR
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         IFEQ      *OFF
     C                   EXCEPT    KUNDA
     C                   ENDIF
     C     *IN53         IFEQ      *ON
     C                   MOVE      *ON           *IN74                          <UKJ.FMOT
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB07
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN74                          <UKJ.FMOT
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB07
     C                   ENDIF
     C     *LOCK         IN        DATA2
     C                   ENDIF
      *
     C     FACKNR        IFGE      1
     C                   OUT       DATA2
     C                   Z-ADD     FACKNR        KUNDNR
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         IFEQ      *OFF
     C                   EXCEPT    KUNDA
     C                   ENDIF
     C     *IN53         IFEQ      *ON
     C                   MOVE      *ON           *IN72
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB07
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN72
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB07
     C                   ENDIF
     C     *LOCK         IN        DATA2
     C                   ENDIF
      *
     C     FACKNR        IFNE      *ZEROS
     C     FACT          ANDEQ     *BLANKS
     C                   MOVE      *ON           *IN69
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
      *
     C     FACT          IFNE      *BLANKS
     C     FACKNR        IFEQ      *ZEROS
     C     WWFACK        ANDEQ     *ZEROS
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C                   ENDIF
      *
      *
     C     KEYH          CHAIN     KODAL01                            59
     C     *IN59         IFEQ      *ON
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
      *
     C     MOMS          IFNE      *BLANKS
     C                   MOVE      MOMS          AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C                   ENDIF
     C     AVG1          IFNE      *BLANKS
     C                   MOVE      AVG1          AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C                   ENDIF
     C     AVG2          IFNE      *BLANKS
     C                   MOVE      AVG2          AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C                   ENDIF
     C     AVG3          IFNE      *BLANKS
     C                   MOVE      AVG3          AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN80
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN80
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C                   ENDIF
     C     AVG4KU        IFNE      *BLANKS
     C                   MOVE      AVG4KU        AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN85
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN85
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C                   ENDIF
     C     AVG5KU        IFNE      *BLANKS
     C                   MOVE      AVG5KU        AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN93
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN93
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C                   ENDIF
     C     AVG6KU        IFNE      *BLANKS
     C                   MOVE      AVG6KU        AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN94
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN94
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB07
     C                   ENDIF
     C                   ENDIF
      *
     C     LEVNR         IFGE      1
     C                   OUT       DATA2
     C     KEYD          CHAIN     LEVEL01                            58
     C     *IN58         IFEQ      *ON
     C                   MOVE      *ON           *IN73                          <UKJ.LEVNR
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB07
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN73                          <UKJ.LEVNR
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB07
     C                   ENDIF
     C     *LOCK         IN        DATA2
     C                   ENDIF
      *
     C                   MOVE      'K'           ESPTYP
     C                   MOVE      'ORDRES'      ESDKID
     C                   MOVE      'M'           ESDKSM
     C                   MOVE      *OFF          *IN80
     C     KEYT          CHAIN     ESTYL00                            55
     C     *IN55         IFEQ      *OFF
     C     ESDKST        IFEQ      '0'
     C                   MOVE      *BLANKS       ESDKST
     C                   ENDIF                                                  <ESDKST
     C     ESDKST        IFNE      *BLANKS
     C                   MOVE      *ON           *IN80
     C                   ENDIF                                                  <ESDKST
     C                   ENDIF                                                  <*IN55
      *
     C     VISB08        TAG
     C                   MOVE      *OFF          *IN12
     C                   EXFMT     VR030B08
N24  C                   MOVE      KODEEV        XKOEEV
     C     *IN06         CABEQ     *ON           TAG04A
N40  C                   MOVEA     '000000'      *IN(67)                        <FEILIND
     C                   MOVEA     '00000000'    *IN(73)                        <FEILIND
     C                   MOVE      *OFF          *IN(81)                        <FEILINDIKAT
     C                   MOVE      *OFF          *IN55                          <CHAIN
     C                   MOVE      *OFF          *IN98                          <PUTOVR
E50P C                   MOVEA     '000'         *IN(87)
     C     *IN12         CABEQ     *ON           VISB07                         <FORRIGE BILDE
N50
N50   * URL-adresse
N50
N50  C                   IF        *IN20 = *ON
N50  C                   EVAL      P_BEHKOD = *BLANKS
N50  C                   EXSR      SUBR13
N50  C                   GOTO      VISB08
N50  C                   ENDIF                                                  <*IN20
N50
      *
     C     *IN21         IFEQ      *ON
     C                   MOVE      '1'           TXTKOD
     C                   MOVE      KUNDNR        TXTBGR
     C                   CALL      'VR350'
     C                   PARM                    PARMD2
N24P C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
      *
     C     *IN22         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'F'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
N55P C                   MOVE      'E'           WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
N24P C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
      *
     C     *IN23         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'K'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
N55P C                   MOVE      'E'           WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
N24P C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
      *
      *        SJEKK OM F4 ER TASTET
      *
     C     *IN04         IFEQ      *ON
     C                   Z-ADD     CURLIN        CURLI1            5 0
     C     CURLI1        DIV       256           LINJE             2 0
     C     LINJE         MULT      256           CURLI2            5 0
     C     CURLI1        SUB       CURLI2        POSISJ            3 0
      *
     C                   SELECT
      *
      *        SØK PÅ KUNDEGRUPPE
      *
     C     LINJE         WHENEQ    5
     C                   Z-ADD     6             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR914'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN73
     C                   GOTO      VISB08
      *
      *        SØK PÅ DISTRIKT ?
      *
     C     LINJE         WHENEQ    6
     C                   MOVE      'D'           FIL
     C                   Z-ADD     7             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR902'       WPROG
     C                   Z-ADD     DISTR         WNUMSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN74
     C                   MOVE      *OFF          *IN75
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN74
     C                   MOVE      *ON           *IN75
     C                   ENDIF
     C                   Z-ADD     WNUMSO        DISTR
     C                   ENDIF
     C                   GOTO      VISB08
      *
      *        SØK PÅ SELGER ?
      *
     C     LINJE         WHENEQ    7
     C                   MOVE      'S'           FIL
     C                   Z-ADD     8             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR901'       WPROG
     C                   MOVEL     SELGER        WALFSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN75
     C                   MOVE      *OFF          *IN76
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN75
     C                   MOVE      *ON           *IN76
     C                   ENDIF
     C                   MOVE      WALFSO        SELGER
     C                   ENDIF
     C                   GOTO      VISB08
      *
      *        SØK PÅ LAGERNR ?
      *
     C     LINJE         WHENEQ    8
     C                   MOVE      'L'           FIL
     C                   Z-ADD     9             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR901'       WPROG
     C                   MOVEL     LAGNR         WALFSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN76
     C                   MOVE      *OFF          *IN77
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN76
     C                   MOVE      *ON           *IN77
     C                   ENDIF
     C                   MOVEL     WALFSO        LAGNR
     C                   ENDIF
     C                   GOTO      VISB08
      *
      *        SØK PÅ LEVERINGSBETINGELSE ?
      *
     C     LINJE         WHENEQ    21
     C                   MOVE      'M'           FIL
     C                   Z-ADD     5             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR901'       WPROG
     C                   MOVEL     LEVBET        WALFSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN78
     C     HLPI12        IFNE      '1'
     C                   MOVEL     WALFSO        LEVBET
     C                   ENDIF
     C                   GOTO      VISB08
N24   *
N24   *        SØK PÅ EKSTERNT VARENUMMERKODE ?
N24   *
N24  C     LINJE         WHENEQ    22
N24  C                   MOVE      'T'           FIL
N24  C                   Z-ADD     6             A
N24  C                   Z-ADD     33            B
N24  C                   MOVE      'VR901'       WPROG
N24  C                   MOVEL     KODEEV        WALFSO
N24  C                   EXSR      SUBR10                                       <Søk på koder
N24  C                   MOVE      *ON           *IN76
N24  C     HLPI12        IFNE      '1'
N24  C     WPNONE        IFNE      '1'
N24  C                   MOVE      *OFF          *IN76
N24  C                   ENDIF                                                  <WPNONE
N24  C                   MOVEL     WALFSO        KODEEV
N24  C                   ENDIF                                                  <HLPI12
N24  C                   GOTO      VISB08
      *
      *        SØK PÅ RUTENR ?
      *
     C     LINJE         WHENEQ    9
     C                   MOVE      'R'           FIL
     C                   Z-ADD     10            A
     C                   Z-ADD     33            B
     C                   MOVE      'VR902'       WPROG
     C                   Z-ADD     RUTENR        WNUMSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN77
     C                   MOVE      *OFF          *IN72
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN77
     C                   MOVE      *ON           *IN72
     C                   ENDIF
     C                   Z-ADD     WNUMSO        RUTENR
     C                   ENDIF
     C                   GOTO      VISB08
      *
     C                   OTHER
     C                   GOTO      VISB08
      *
     C                   ENDSL
     C                   ENDIF                                                  *IN04
      *
      *----------------------------------------------------------------
      *   TEST FELTER
      *----------------------------------------------------------------
N40  C                   IF        EHANKU = 'N'
N40  C                   EVAL      EHANKU = *BLANKS
N40  C                   ENDIF                                                  IF EHANKU
N40  C                   IF        EHANKU = *BLANKS AND EHOTKU <> *BLANKS
N40  C                   EVAL      *IN67 = *ON
N40  C                   EVAL      *IN98 = *ON
N40  C                   GOTO      VISB08
N40  C                   ENDIF                                                  IF EHANKU
N40  C                   IF        EHOTKU = 'L' AND LALOSO <> 'J'
E40P C                   EVAL      *IN71 = *ON
N40  C                   EVAL      *IN98 = *ON
N40  C                   GOTO      VISB08
N40  C                   ENDIF                                                  IF EHOTKU
     C     KUNDGR        IFNE      *BLANKS
     C     KEYN          CHAIN     KODKL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
     C                   ENDIF
      *
     C     DISTR         IFGE      1
     C     KEYI          CHAIN     KODDL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
     C                   ENDIF
      *
     C     SELGER        IFNE      *BLANKS
     C     KEYS          CHAIN     KODUL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
     C                   ENDIF
      *
     C     LAGNR         IFNE      *BLANKS
     C     KEYO          CHAIN     KODLL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
     C                   ENDIF
      *
     C                   MOVE      'K'           ESPTYP
     C                   MOVE      'ORDRES'      ESDKID
     C                   MOVE      'M'           ESDKSM
     C     KEYT          CHAIN     ESTYL00                            55
     C     *IN55         IFEQ      *OFF
     C     ESDKST        IFEQ      '0'
     C                   MOVE      *BLANKS       ESDKST
     C                   ENDIF                                                  <ESDKST
     C     ESDKST        IFNE      *BLANKS
     C     LAGNR         ANDEQ     *BLANKS
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF                                                  <ESDKST..
     C                   ENDIF                                                  <*IN55
      *
     C     RUTENR        IFGE      1
     C     KEYR          CHAIN     KODRL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
     C                   ENDIF
N50P
N50P  * Egeninkasso (PKOD = E) er bare tillatt hvis postnr.
N50P  * innland er utfylt og purregebyr benyttes.
N50P
N50P C                   IF        PKOD = 'E'
N50P C                   IF           POSTNR    = *ZEROS
N50P C                             OR SD_PURGEB = *BLANKS
N50P C                   EVAL      *IN81 = *ON
N50P C                   EVAL      *IN98 = *ON
N50P C                   GOTO      VISB08
N50P C                   ENDIF                                                  <POSTNR...
N50P C                   ENDIF                                                  <PKOD
N50P
N50P  * Purregebyrkode "J" er bare tillatt hvis purrekoden er
N50P  * "E" eller "J" og purregebyrkode i systemfilen
N50P  * SYSDF = "J"
N50P
N50P C                   IF        PGEBYR = 'J'
N50P C                   IF           PKOD      = *BLANKS
N50P C                             OR SD_PURGEB = *BLANKS
N50P C                   EVAL      *IN89 = *ON
N50P C                   EVAL      *IN98 = *ON
N50P C                   GOTO      VISB08
N50P C                   ENDIF                                                  <PKOD...
N50P C                   ENDIF                                                  <PGEBYR
      *
     C     LEVBET        IFNE      *BLANKS
     C     KEYP          CHAIN     KODML01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB08
     C                   ENDIF
     C                   ENDIF
N24   *
N24  C     KODEEV        IFNE      *BLANKS
N24  C     KEYPT         CHAIN     KODTL01                            55
N24  C     *IN55         IFEQ      *ON
N24  C                   MOVE      *ON           *IN80
N24  C                   MOVE      *ON           *IN98
N24  C                   GOTO      VISB08
N24  C                   ENDIF                                                  <*IN55
N24  C     AKTKOD        IFNE      'A'
N24  C                   MOVE      *ON           *IN80
N24  C                   MOVE      *ON           *IN98
N24  C                   GOTO      VISB08
N24  C                   ENDIF                                                  <AKTKOD
N24  C                   ENDIF                                                  <KODEEV
      *
     C     FEKS          IFLT      1
     C                   Z-ADD     1             FEKS
     C                   ENDIF
      *
     C     VISB17        TAG
     C                   MOVE      *OFF          *IN12
     C                   EXFMT     VR030B17
     C     *IN06         CABEQ     *ON           TAG04A
     C                   MOVEA     '00000'       *IN(68)                        <FEILIND
     C                   MOVEA     '00000'       *IN(73)                        <FEILIND
     C                   MOVEA     '0000'        *IN(78)                        <FEILIND
     C                   MOVE      *OFF          *IN85                          <FEILIND
E50P C                   MOVEA     '000'         *IN(87)
     C                   MOVE      *OFF          *IN98                          <PUTOVR
N24  C                   MOVE      *OFF          *IN49                          <PC - RNRAKU
     C     *IN12         CABEQ     *ON           VISB08                         <FORRIGE BILDE
N50
N50   * URL-adresse
N50
N50  C                   IF        *IN20 = *ON
N50  C                   EVAL      P_BEHKOD = *BLANKS
N50  C                   EXSR      SUBR13
N50  C                   GOTO      VISB17
N50  C                   ENDIF                                                  <*IN20
N50
      *
     C     *IN21         IFEQ      *ON
     C                   MOVE      '1'           TXTKOD
     C                   MOVE      KUNDNR        TXTBGR
     C                   CALL      'VR350'
     C                   PARM                    PARMD2
N24P C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
      *
     C     *IN22         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'F'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
N55P C                   MOVE      'E'           WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
N24P C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
      *
     C     *IN23         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'K'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
N55P C                   MOVE      'E'           WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
N24P C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
      *
      *        SJEKK OM F4 ER TASTET
      *
     C     *IN04         IFEQ      *ON
     C                   Z-ADD     CURLIN        CURLI1            5 0
     C     CURLI1        DIV       256           LINJE             2 0
     C     LINJE         MULT      256           CURLI2            5 0
     C     CURLI1        SUB       CURLI2        POSISJ            3 0
      *
     C                   SELECT
      *
      *        SØK PÅ KONTOHENVISNINGSKODE
      *
     C     LINJE         WHENEQ    5
     C                   Z-ADD     6             A
     C                   Z-ADD     25            B
     C                   MOVE      'VR913'       WPROG                                      r
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB17
      *
      *        SØK PÅ LEVERINGSMÅTE ?
      *
     C     LINJE         WHENEQ    6
     C                   MOVE      'N'           FIL
     C                   Z-ADD     7             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR901'       WPROG                                      r
     C                   MOVEL     LEVMAT        WALFSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN74
     C                   MOVE      *OFF          *IN68
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN74
     C                   MOVE      *ON           *IN68
     C                   ENDIF
     C                   MOVEL     WALFSO        LEVMAT
     C                   ENDIF
     C                   GOTO      VISB17
      *
      *        SØK PÅ SPEDITØR / SPEDITØR UTLAND
      *
     C     LINJE         WHENEQ    8
     C                   Z-ADD     9             A
     C                   Z-ADD     3             B
     C                   MOVE      'VR904'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB17
      *
      *        SØK PÅ VAREADRESSE
      *
     C     LINJE         WHENEQ    16
     C                   Z-ADD     6             A
     C                   Z-ADD     3             B
     C                   MOVE      'VR920'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB17
      *
      *        SØK PÅ RESKONTROTYPE
      *
     C     LINJE         WHENEQ    19
     C                   Z-ADD     8             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR925'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB17
      *
      *        SØK PÅ PRIS/RABATTGRUPPE
      *
     C     LINJE         WHENEQ    21
     C                   Z-ADD     6             A
     C                   Z-ADD     2             B
E24  C                   MOVE      'VR928'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB17
      *
     C                   OTHER
     C                   GOTO      VISB17
      *
     C                   ENDSL
     C                   ENDIF                                                  *IN04
      *
      *----------------------------------------------------------------
      *   TEST FELTER
      *----------------------------------------------------------------
     C                   MOVE      'D'           RECTYP
     C     KEYJ          CHAIN     KHEDL01                            61
     C     *IN61         IFEQ      *ON
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
     C     LEVMAT        IFNE      *BLANKS
     C     KEYQ          CHAIN     KODNL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
     C                   ENDIF
      *
     C     SPEDNR        IFNE      *BLANKS
     C     KEYL          CHAIN     KODSL01                            62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
     C                   ENDIF
      *
     C     SPEDNU        IFNE      *BLANKS
     C                   OUT       DATA2
     C     KEYLU         CHAIN     KODSL01                            62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB17
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C     *LOCK         IN        DATA2
     C                   GOTO      VISB17
     C                   ENDIF
     C     *LOCK         IN        DATA2
     C                   ENDIF
      *
     C     VADRKU        IFNE      *ZEROS
     C     KEYV          CHAIN     VADRL01                            62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
     C                   ENDIF
      *
     C     RETYKU        IFNE      *BLANKS
     C     KEYW          CHAIN     KODQ1A                             62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
     C                   ENDIF
      *
     C     PRIKKU        IFNE      *BLANKS
     C     KEYX          CHAIN     KODYL01                            62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN80
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN80
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
     C                   ENDIF
      *
     C     AUTKOD        IFNE      *BLANKS
     C     BETMAT        ANDNE     'A'
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
      ****
      *  HVIS POSTEN ER INAKTIV MÅ DET TRYKKES F6 ELLER F14
      ****
     C     HLPAKO        IFEQ      'I'
     C     *IN06         ANDEQ     *OFF
     C     *IN14         ANDEQ     *OFF
     C                   MOVE      *ON           *IN85
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB17
     C                   ENDIF
      *----------------------------------------------------------------
      *  OPPDATER FILSTATUS
      *----------------------------------------------------------------
     C     KEYG          CHAIN     SYSRL01                            50
     C                   ADD       1             ENDRET
      *
E55P C     W_IN25        IFEQ      *ON
     C     HLPJNR        ANDEQ     *ZEROS
     C     SJOUR         ADD       1             HLPJNR
     C                   Z-ADD     HLPJNR        SJOUR
     C                   ENDIF
      *
     C     *IN14         IFEQ      *ON
     C     HLPAKO        ANDEQ     'I'
     C                   SUB       1             ANTINA
     C                   MOVE      'A'           AKTKOD
N24P C                   MOVE      'J'           ENDPOS
     C                   ENDIF
      *
     C     HLPAKO        IFEQ      'E'
     C                   SUB       1             ANTFEI
     C                   MOVE      'A'           AKTKOD
     C                   ENDIF
     C     *IN50         IFEQ      *OFF
     C                   UPDATE    SYSRR
     C                   ENDIF
      *----------------------------------------------------------------
      *  CHAIN OPP FILEN OG OPPDATER
      *----------------------------------------------------------------
     C                   OUT       DATA2
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         CABEQ     *ON           TAG04A
     C                   EXSR      SUBR09
      *
     C     *LOCK         IN        DATA2
      ****
E55P  *  SKRIV LISTE HVIS W_IN25 = '1'
      ****
E55P C     W_IN25        IFEQ      *ON
     C     *IN14         IFEQ      *OFF
     C                   MOVE      *ON           *IN66
     C                   ELSE
     C                   MOVE      *ON           *IN67
     C                   ENDIF
E55P C     W_IN26        IFEQ      *OFF
     C                   OPEN      VR030U01
E55P C                   MOVE      *ON           W_IN26
     C                   ENDIF
     C                   Z-ADD     HLPJNR        JOURNR
     C                   WRITE     VR030S02
     C                   MOVEA     '00'          *IN(66)
     C                   ENDIF
      ****
      *  OPPDATER ENDRINGSDATO KREDITTGRENSE HVIS KREDITTGRENSE ENDRET
      ****
     C     KGRENS        IFNE      XKGREN
E24  C                   MOVE      *YEAR         KGRAAR
     C                   MOVE      UMONTH        KGRMND
     C                   MOVE      UDAY          KGRDAG
     C                   ENDIF                                                  <KGRENS
      *
     C     POKOD         IFEQ      'J'
     C     OFKPOS        IFEQ      *BLANK
N40P C     OFKPOS        OREQ      'J'
     C     KNAVN         IFNE      XKNAVN
     C                   MOVE      'J'           ENDPOS
     C                   ELSE
     C     SONAVN        IFNE      XSONAV
     C                   MOVE      'J'           ENDPOS
     C                   ELSE
     C     PRISK         IFNE      XPRISK
     C                   MOVE      'J'           ENDPOS
     C                   ELSE
     C     RABAT1        IFNE      XRABA1
     C                   MOVE      'J'           ENDPOS
     C                   ELSE
     C     RABAT2        IFNE      XRABA2
     C                   MOVE      'J'           ENDPOS
     C                   ELSE
     C     RABAT3        IFNE      XRABA3
     C                   MOVE      'J'           ENDPOS
     C                   ELSE
     C     KUNDGR        IFNE      XKUNDG
     C                   MOVE      'J'           ENDPOS
     C                   ELSE
N40P C     PRIKKU        IFNE      XPRIKK
N40P C                   MOVE      'J'           ENDPOS
N40P C                   ELSE
     C     KGRENS        IFNE      XKGREN
     C                   MOVE      'J'           ENDPOS
     C                   ELSE
     C     KVERD         IFNE      XKVERD
     C                   MOVE      'J'           ENDPOS
     C                   ELSE
     C     TILBKD        IFNE      XTILBK
     C                   MOVE      'J'           ENDPOS
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
N40P C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
N50P
N50P C                   IF        ADR3 = *BLANKS
N50P C                   EVAL      ADR3 = P8_POSTED
N50P C                   ENDIF                                                  <ADR3
      *
     C                   UPDATE    KUNDR
SY   C                   MOVE      '0'           SYSY              1
SY   C                   MOVE      KUNDNR        SYKUAL            8
SY   C                   CALL      'VKUNDCLI'
SY   C                   PARM                    SYSY
SY   C                   PARM                    FIRMA
SY   C                   PARM                    SYKUAL
     C     KEYA          CHAIN     KKUNF                              5391
     C     *IN91         IFEQ      *OFF                                         <REC.LOCK
     C     *IN53         IFEQ      *OFF
     C                   UPDATE    KKUNR
     C                   ELSE
     C                   WRITE     KKUNR
     C                   ENDIF
     C                   ENDIF                                                  <IN91
N50  C                   MOVE      'O'           W_EPOST
N50  C                   EXSR      SUBR14
      *
     C     ENDPOS        IFEQ      'J'
     C                   EXSR      SUBR12
     C                   ENDIF
      *
     C                   ELSE
     C                   MOVE      *ON           *IN70
     C                   MOVE      *ON           *IN98
     C                   ENDIF
     C     TAG04A        TAG
     C                   MOVE      *ON           *IN92
     C                   ENDSR
      /EJECT
      *----------------------------------------------------------------
      *  S U B R 0 3    BLANK UT FELTER ELLER FLYTT OVER FRA STANDARD
      *----------------------------------------------------------------
     C     SUBR03        BEGSR
      *
     C                   MOVE      WDKUND        DKUND
     C                   MOVE      WKNAVN        KNAVN
     C                   MOVE      WADR1         ADR1
     C                   MOVE      WADR2         ADR2
     C                   MOVE      WPOSTN        POSTNR
     C                   MOVE      WADR3         ADR3
     C                   MOVE      WKPERS        KPERS
     C                   MOVE      WTLF          TLF
     C                   MOVE      WSONAV        SONAVN
     C                   MOVE      WLAND         LAND
     C                   MOVE      WVALKO        VALKOD
     C                   MOVE      WSPRAA        SPRAAK
     C                   MOVE      WHEAD         HEAD
     C                   MOVE      WBANKG        BANKG
     C                   MOVE      WPOSTG        POSTG
     C                   MOVE      WLEVNR        LEVNR
     C                   MOVE      WFMOT         FMOT
     C                   MOVE      WFACT         FACT
     C                   MOVE      WBETBE        BETBET
     C                   MOVE      WBETMA        BETMAT
     C                   MOVE      WPRISK        PRISK
     C                   MOVE      WRAB1         RABAT1
     C                   MOVE      WRAB2         RABAT2
     C                   MOVE      WRAB3         RABAT3
     C                   MOVE      WRAB4         RABAT4
     C                   MOVE      WMOMS         MOMS
     C                   MOVE      WAVG1         AVG1
     C                   MOVE      WAVG2         AVG2
     C                   MOVE      WAVG3         AVG3
     C                   MOVE      WAVG4K        AVG4KU
     C                   MOVE      WAVG5K        AVG5KU
     C                   MOVE      WAVG6K        AVG6KU
     C                   MOVE      WREST         REST
     C                   MOVE      WKVANT        KVANT
     C                   MOVE      WBONUS        BONUS
     C                   MOVE      WSFAKT        SFAKT
N40  C                   MOVE      WVAVGK        VAVGKU
     C                   MOVE      WSORD         SORD
     C                   MOVE      WAUTKO        AUTKOD
     C                   MOVE      WKUNDG        KUNDGR
     C                   MOVE      WDISTR        DISTR
     C                   MOVE      WSELGE        SELGER
     C                   MOVE      WLAGNR        LAGNR
     C                   MOVE      WRUTEN        RUTENR
     C                   MOVE      WSEKVN        SEKVNR
     C                   MOVE      WFEKS         FEKS
     C                   MOVE      WRKOD         RKOD
     C                   MOVE      WPKOD         PKOD
     C                   MOVE      WKUTDR        KUTDR
     C                   MOVE      WAKONT        AKONT
     C                   MOVE      WKGREN        KGRENS
     C                   MOVE      WKVERD        KVERD
     C                   MOVE      WKHENV        KHENV
     C                   MOVE      WLEVBE        LEVBET
N24  C                   MOVE      WKOEEV        KODEEV
     C                   MOVE      WLEVMA        LEVMAT
     C                   MOVE      WGNOTK        GNOTKD
     C                   MOVE      WFRSON        FRSONE
     C                   MOVE      WSPEDN        SPEDNR
     C                   MOVE      WFBKOD        FBKOD
     C                   MOVE      WMRKKO        MRKKOD
     C                   MOVE      WADRKO        ADRKOD
     C                   MOVE      WGNOTA        GNOTAK
     C                   MOVE      WFAXNR        TFAXNR
     C                   MOVE      WFKPOS        OFKPOS
     C                   MOVE      WILBKD        TILBKD
     C                   MOVE      WBKDBK        BKDBKU
     C                   MOVE      WGEBYR        PGEBYR
     C                   MOVE      WPOSTU        POSTNU
N50  C                   MOVE      WPNPBK        PNPBKU
     C                   MOVE      WSPEDU        SPEDNU
     C                   MOVE      WPFKOK        PFKOKU
     C                   MOVE      WBFKOK        BFKOKU
     C                   MOVE      WFACKN        FACKNR
     C                   MOVE      WFORET        FORETN
     C                   MOVE      WVADRK        VADRKU
     C                   MOVE      WPRKPK        PRKPKU
     C                   MOVE      WPRKOK        PRKOKU
     C                   MOVE      WRETYK        RETYKU
     C                   MOVE      WVATKK        VATKKU
     C                   MOVE      WPRIKK        PRIKKU
     C                   MOVE      WRNRAK        RNRAKU
     C                   MOVE      WAKNRK        AKNRKU
N50P C                   MOVE      WEANNK        EANNKU
      *
     C                   ENDSR
      /EJECT
      *----------------------------------------------------------------
      *  S U B R 0 5    SPØRRING PÅ FILEN
      *----------------------------------------------------------------
     C     SUBR05        BEGSR
     C                   MOVE      WFIRMA        FIRMA
      *----------------------------------------------------------------
      *  HVIS SØKEBEGREP ER TASTET
      *----------------------------------------------------------------
S55   *                  Z-ADD     VALKNR        KUNDNR
      ****
      *  HVIS INGEN SØKEBEGREP ER TASTET VIS ALFASØK
      ****
      *
     C     *IN06         CABEQ     *ON           TAG06C
      *----------------------------------------------------------------
      *  SØK MED KUNDENUMMER
      *----------------------------------------------------------------
     C     KUNDNR        IFGE      1
     C     KEYA          SETLL     KUNDL01                                53
     C     *IN53         IFEQ      *ON
      *
     C     TAG06A        TAG
     C     FIRMA         READE     KUNDL01                                60
      *
     C                   MOVE      *BLANKS       WTEKST
     C     AKTKOD        IFEQ      'I'
     C                   MOVEL     'INAKTIV'     WTEKST
     C                   ENDIF
      *
     C     AKTKOD        IFEQ      'E'
     C                   MOVEL     'REG. M/F'    WTEKST
     C                   MOVE      'EIL'         WTEKST
     C                   ENDIF
N24   *
N24   * Datoeditering,
N24  C                   CLEAR                   DSDATO
N24  C     WDATOF        IFEQ      *ZEROS
N24  C                   MOVE      '1'           ÅWDATF                         <ddmmåå
N24  C                   ENDIF                                                  <WDATOF
N24  C                   MOVE      SISDAG        ÅDAG
N24  C                   MOVE      SISMND        ÅMND
N24  C                   MOVE      SISAAR        ÅAAR
N24  C                   MOVE      'E'           ÅTYPE
N24  C                   CALL      'VR014'
N24  C                   PARM                    DSDATO
N24  C                   MOVEL     ÅDATO3        SISFAK
N24   *
N24  C                   CLEAR                   ÅDATO1
N24  C                   MOVE      INNDAG        ÅDAG
N24  C                   MOVE      INNMND        ÅMND
N24  C                   MOVE      INNAAR        ÅAAR
N24  C                   MOVE      'E'           ÅTYPE
N24  C                   CALL      'VR014'
N24  C                   PARM                    DSDATO
N24  C                   MOVEL     ÅDATO3        INNBET
N24   *
N24  C                   CLEAR                   ÅDATO1
N24  C                   MOVE      DAODAG        ÅDAG
N24  C                   MOVE      DAOMND        ÅMND
N24  C                   MOVE      DAOAAR        ÅAAR
N24  C                   MOVE      'E'           ÅTYPE
N24  C                   CALL      'VR014'
N24  C                   PARM                    DSDATO
N24  C                   MOVEL     ÅDATO3        DATOO
N24   *
N24  C                   CLEAR                   ÅDATO1
N24  C                   MOVE      KGRDAG        ÅDAG
N24  C                   MOVE      KGRMND        ÅMND
N24  C                   MOVE      KGRAAR        ÅAAR
N24  C                   MOVE      'E'           ÅTYPE
N24  C                   CALL      'VR014'
N24  C                   PARM                    DSDATO
N24  C                   MOVEL     ÅDATO3        KGRDAT
      *
     C     *IN60         IFEQ      *OFF
     C                   EXCEPT    KUNDA                                        <DUMMY UPDAT
     C                   ENDIF
N50
N50  C                   MOVE      'H'           W_EPOST
N50  C                   EXSR      SUBR14
      *
     C     TAG06D        TAG
     C                   MOVE      'K'           OTBKOD
     C                   Z-ADD     KUNDNR        RESNR
     C     KEYKOM        SETLL     NOTAL01                                84
     C                   MOVE      'F'           OTBKOD
     C                   Z-ADD     KUNDNR        RESNR
     C     KEYKOM        SETLL     NOTAL01                                45
     C                   EXFMT     VR030B14
     C                   MOVE      *OFF          *IN63
     C     *IN07         CABEQ     *ON           TAG06A                         <NESTE POST
N50
N50   * URL-adresse
N50
N50  C                   IF        *IN20 = *ON
N50  C                   EVAL      P_BEHKOD = 'F'
N50  C                   EXSR      SUBR13
N50  C                   GOTO      TAG06D
N50  C                   ENDIF                                                  <*IN20
N50
N50   * Forespørsel kontakter (F24)
N50
N50  C                   IF        *IN24 = *ON
N50  C                   EXSR      SUBR15
N50  C                   GOTO      TAG06D
N50  C                   ENDIF                                                  <*IN20
      *
     C     *IN21         IFEQ      *ON
     C                   MOVE      '1'           TXTKOD
     C                   MOVE      KUNDNR        TXTBGR
     C                   CALL      'VR350'
     C                   PARM                    PARMD2
     C                   GOTO      TAG06D
     C                   ENDIF
      *
     C     *IN22         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'F'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
N55P C                   CLEAR                   WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
     C     WFEILK        IFEQ      '9'
     C                   MOVE      *ON           *IN63
     C                   ENDIF
     C                   GOTO      TAG06D
     C                   ENDIF
      *
     C     *IN23         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'K'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
N55P C                   CLEAR                   WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
     C     WFEILK        IFEQ      '9'
     C                   MOVE      *ON           *IN63
     C                   ENDIF
     C                   GOTO      TAG06D
     C                   ENDIF
      *
     C     TAG06E        TAG
N55P C                   EXSR      VIS_KUNSF
     C                   EXFMT     VR030B15
     C                   MOVE      *OFF          *IN63
     C     *IN07         CABEQ     *ON           TAG06A                         <NESTE POST
N50
N50   * URL-adresse
N50
N50  C                   IF        *IN20 = *ON
N50  C                   EVAL      P_BEHKOD = 'F'
N50  C                   EXSR      SUBR13
N50  C                   GOTO      TAG06E
N50  C                   ENDIF                                                  <*IN20
N50
      *
     C     *IN21         IFEQ      *ON
     C                   MOVE      '1'           TXTKOD
     C                   MOVE      KUNDNR        TXTBGR
     C                   CALL      'VR350'
     C                   PARM                    PARMD2
     C                   GOTO      TAG06E
     C                   ENDIF
      *
     C     *IN22         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'F'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
N55P C                   CLEAR                   WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
     C     WFEILK        IFEQ      '9'
     C                   MOVE      *ON           *IN63
     C                   ENDIF
     C                   GOTO      TAG06E
     C                   ENDIF
      *
     C     *IN23         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'K'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
N55P C                   CLEAR                   WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
     C     WFEILK        IFEQ      '9'
     C                   MOVE      *ON           *IN63
     C                   ENDIF
     C                   GOTO      TAG06E
     C                   ENDIF
      *
     C                   ELSE
     C                   MOVE      *ON           *IN70
     C                   MOVE      *ON           *IN98
     C                   ENDIF
     C                   GOTO      TAG06C
     C                   ENDIF
      *----------------------------------------------------------------
      *  SØK MED TELEFONNUMMER
      *----------------------------------------------------------------
S55   *                  MOVE      VALTLF        TLF
     C     TLF           IFNE      *BLANKS
     C     KEYC          CHAIN     KUNDL03                            56
     C     *IN56         IFEQ      *OFF
     C                   GOTO      VIS02
     C     TAG06B        TAG
     C     FIRMA         READE     KUNDL03                                60
     C     VIS02         TAG
     C     AKTKOD        IFEQ      'I'
     C                   MOVEL     'INAKTIV'     WTEKST
     C                   ELSE
     C                   MOVE      *BLANKS       WTEKST
     C                   ENDIF
     C     AKTKOD        IFEQ      'E'
     C                   MOVEL     'REG. M/F'    WTEKST
     C                   MOVE      'EIL'         WTEKST
     C                   ELSE
     C                   MOVE      *BLANKS       WTEKST
     C                   ENDIF
N24   *
N24   * Datoeditering,
N24  C                   CLEAR                   DSDATO
N24  C     WDATOF        IFEQ      *ZEROS
N24  C                   MOVE      '1'           ÅWDATF                         <ddmmåå
N24  C                   ENDIF                                                  <WDATOF
N24  C                   MOVE      SISDAG        ÅDAG
N24  C                   MOVE      SISMND        ÅMND
N24  C                   MOVE      SISAAR        ÅAAR
N24  C                   MOVE      'E'           ÅTYPE
N24  C                   CALL      'VR014'
N24  C                   PARM                    DSDATO
N24  C                   MOVEL     ÅDATO3        SISFAK
N24   *
N24  C                   CLEAR                   ÅDATO1
N24  C                   MOVE      INNDAG        ÅDAG
N24  C                   MOVE      INNMND        ÅMND
N24  C                   MOVE      INNAAR        ÅAAR
N24  C                   MOVE      'E'           ÅTYPE
N24  C                   CALL      'VR014'
N24  C                   PARM                    DSDATO
N24  C                   MOVEL     ÅDATO3        INNBET
N24   *
N24  C                   CLEAR                   ÅDATO1
N24  C                   MOVE      DAODAG        ÅDAG
N24  C                   MOVE      DAOMND        ÅMND
N24  C                   MOVE      DAOAAR        ÅAAR
N24  C                   MOVE      'E'           ÅTYPE
N24  C                   CALL      'VR014'
N24  C                   PARM                    DSDATO
N24  C                   MOVEL     ÅDATO3        DATOO
N24   *
N24  C                   CLEAR                   ÅDATO1
N24  C                   MOVE      KGRDAG        ÅDAG
N24  C                   MOVE      KGRMND        ÅMND
N24  C                   MOVE      KGRAAR        ÅAAR
N24  C                   MOVE      'E'           ÅTYPE
N24  C                   CALL      'VR014'
N24  C                   PARM                    DSDATO
N24  C                   MOVEL     ÅDATO3        KGRDAT
      *
     C                   EXFMT     VR030B14
     C     *IN07         CABEQ     *ON           TAG06B                         <NESTE POST
N55P C                   EXSR      VIS_KUNSF
     C                   EXFMT     VR030B15
     C     *IN07         CABEQ     *ON           TAG06B                         <NESTE POST
     C                   ELSE
     C                   MOVE      *ON           *IN71
     C                   MOVE      *ON           *IN98
     C                   ENDIF
     C                   ENDIF
     C     TAG06C        TAG
     C                   ENDSR
      /EJECT
      *----------------------------------------------------------------
      *  S U B R 0 6      FJERNE PÅ KUNDEFILEN
      *----------------------------------------------------------------
     C     SUBR06        BEGSR
     C                   MOVE      *OFF          *IN70                          <FEILIND
     C                   MOVE      *OFF          *IN65                          <PRINTTEKST
     C                   MOVE      WFIRMA        FIRMA
      *----------------------------------------------------------------
      *  HVIS SØKEBEGREP ER TASTET
      *----------------------------------------------------------------
S55   *                  Z-ADD     VALKNR        KUNDNR
      ****
      *  HVIS INGEN SØKEBEGREP ER TASTET VIS ALFASØK
      ****
      *
     C     *IN06         CABEQ     *ON           TAG05A
      *----------------------------------------------------------------
      *  CHAIN MED KUNDENUMMER ELLER TELEFONNR.
      *----------------------------------------------------------------
S55   *    VALTLF        IFNE      *BLANKS
S55   *                  MOVE      VALTLF        TLF
S55   *    KEYC          CHAIN     KUNDL03                            53
S55   *    *IN53         IFEQ      *ON
S55   *                  CLEAR                   KUNDNR
S55   *                  ENDIF                                                  <*IN53
S55   *                  ENDIF                                                  <VALTLF
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         IFEQ      *OFF
     C                   EXCEPT    KUNDA
      *
     C     VISB09        TAG
     C                   MOVE      'K'           OTBKOD
     C                   Z-ADD     KUNDNR        RESNR
     C     KEYKOM        SETLL     NOTAL01                                84
     C                   MOVE      'F'           OTBKOD
     C                   Z-ADD     KUNDNR        RESNR
     C     KEYKOM        SETLL     NOTAL01                                45
     C                   EXFMT     VR030B09
     C                   MOVE      *OFF          *IN63                          RR
      *
     C     *IN21         IFEQ      *ON
     C                   MOVE      '1'           TXTKOD
     C                   MOVE      KUNDNR        TXTBGR
     C                   CALL      'VR350'
     C                   PARM                    PARMD2
     C                   GOTO      VISB09
     C                   ENDIF
      *
     C     *IN22         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'F'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
N55P C                   CLEAR                   WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
     C     WFEILK        IFEQ      '9'
     C                   MOVE      *ON           *IN63
     C                   ENDIF
     C                   GOTO      VISB09
     C                   ENDIF
      *
     C     *IN23         IFEQ      *ON
     C                   MOVE      KUNDNR        WRESNR
     C                   MOVE      'K'           OTBKOD
     C                   MOVE      KNAVN         WNAVN
S55   *                  MOVE      VALG          WFEILK
N55P C                   CLEAR                   WFEILK
     C                   MOVE      VARENR        VARENR
     C                   MOVE      INDVN1        INDVN1
N50P C                   CLEAR                   W_HEAD
N50P C                   CLEAR                   W_KUGR
N50P C                   CLEAR                   W_PROGID
     C                   CALL      'VR060'
     C                   PARM                    PARMD1
     C     WFEILK        IFEQ      '9'
     C                   MOVE      *ON           *IN63
     C                   ENDIF
     C                   GOTO      VISB09
     C                   ENDIF
      *
     C                   MOVE      *OFF          *IN86
      ****
E55   *  BARE F12 OG F11 ER GYLDIG
      ****
E55  C     *IN12         IFEQ      *OFF
     C     *IN11         ANDEQ     *OFF
     C                   GOTO      VISB09
     C                   ENDIF
      *
E55  C     *IN12         CABEQ     *ON           TAG05A                         <AVBRYT
     C     *IN11         IFEQ      *ON                                          <FJERNE
      *
     C     KSALDO        IFNE      *ZEROS
     C                   MOVE      *ON           *IN86                          <KAN IKKE FJERN
     C                   GOTO      VISB09
     C                   ENDIF
      *
     C     KEYG          CHAIN     SYSRL01                            50
      *
E55P C     W_IN25        IFEQ      *ON
     C     HLPJNR        ANDEQ     *ZEROS
     C     SJOUR         ADD       1             HLPJNR
     C                   Z-ADD     HLPJNR        SJOUR
     C                   ENDIF
      *
     C                   ADD       1             ANTINA
     C     *IN50         IFEQ      *OFF
     C                   UPDATE    SYSRR
     C                   ENDIF
     C                   ADD       1             SLETTE
     C                   ENDIF
     C     KEYA          CHAIN     KUNDL01                            53
     C     KEYA          CHAIN     KKUNF                              53
     C                   MOVE      'I'           AKTKOD
      ****
      *  SJEKK OM LISTE
      ****
E55P C     W_IN25        IFEQ      *ON
E55P C     W_IN26        IFEQ      *OFF
     C                   OPEN      VR030U01
E55P C                   MOVE      *ON           W_IN26
     C                   ENDIF
     C                   MOVE      *ON           *IN65
     C                   Z-ADD     HLPJNR        JOURNR
     C                   WRITE     VR030S01
     C                   MOVE      *OFF          *IN65
     C                   ENDIF
      *
     C     POKOD         IFEQ      'J'
     C     OFKPOS        IFEQ      *BLANK
N40P C     OFKPOS        OREQ      'J'
     C                   MOVE      'J'           ENDPOS
     C                   ENDIF
     C                   ENDIF
      *
     C                   UPDATE    KUNDR
     C                   UPDATE    KKUNR
SY   C                   MOVE      '0'           SYSY              1
SY   C                   MOVE      KUNDNR        SYKUAL            8
SY   C                   CALL      'VKUNDCLI'
SY   C                   PARM                    SYSY
SY   C                   PARM                    FIRMA
SY   C                   PARM                    SYKUAL
N50
N50   * Slett event. URL-adresse
N50
N50  C                   EVAL      P_BEHKOD = 'S'
N50  C                   EXSR      SUBR13
N50
N50   * Slett event. E-post adresser
N50
N50  C                   MOVE      'S'           W_EPOST
N50  C                   EXSR      SUBR14
      *
     C     ENDPOS        IFEQ      'J'
     C                   EXSR      SUBR12
     C                   ENDIF
      *
     C                   ELSE
     C                   MOVE      *ON           *IN70
     C                   MOVE      *ON           *IN98
     C                   ENDIF
     C     TAG05A        TAG
     C                   ENDSR
      /EJECT
      *----------------------------------------------------------------
      *  S U B R 0 7    NY STANDARD
      *----------------------------------------------------------------
     C     SUBR07        BEGSR
     C                   MOVE      WFIRMA        FIRMA
      *
     C     VISB11        TAG
     C                   EXFMT     VR030B11
E55  C     *IN12         CABEQ     *ON           TAG01A
     C                   MOVEA     '00000'       *IN(68)                        <FEILIND
     C                   MOVEA     '00000000'    *IN(73)                        <FEILIND
     C                   MOVE      *OFF          *IN(81)                        <FEILINDIKAT
E50P C                   MOVEA     '000'         *IN(87)
      *
      *        SJEKK OM F4 ER TASTET
      *
     C     *IN04         IFEQ      *ON
N50P C                   MOVE      *ON           *IN87
     C                   Z-ADD     CURLIN        CURLI1            5 0
     C     CURLI1        DIV       256           LINJE             2 0
     C     LINJE         MULT      256           CURLI2            5 0
     C     CURLI1        SUB       CURLI2        POSISJ            3 0
      *
     C                   SELECT
      *
      *        SØK PÅ STANDARDKUNDE
      *
     C     LINJE         WHENEQ    5
     C                   Z-ADD     7             A
     C                   Z-ADD     2             B
     C                   MOVE      'VR910'       WPROG
E40P C                   MOVE      'B'           WPTSOK
     C                   EXSR      SUBR10                                       <Søk på koder
     C     HLPI12        IFNE      '1'
     C                   MOVE      PKUNDN        WKUNDN
     C                   ENDIF
     C                   GOTO      VISB11
      *
      *        SØK PÅ LANDKODE
      *
E50P C     LINJE         WHENEQ    17
     C                   Z-ADD     2             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR907'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C     HLPI12        IFNE      '1'
     C                   MOVE      PLAND         WLAND
     C                   ENDIF
     C                   GOTO      VISB11
      *
      *        SØK PÅ VALUTAKODE
      *
E50P C     LINJE         WHENEQ    18
     C                   Z-ADD     3             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR906'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C     HLPI12        IFNE      '1'
     C                   MOVE      PVALKO        WVALKO
     C                   ENDIF
     C                   GOTO      VISB11
N50P
N50P  * Forespørsel på postnummer
N50P
N50P C                   WHEN      LINJE = 10
N50P C                   CLEAR                   VR841DS
N50P
N50P C                   IF        POSISJ <= 41
N50P C                   EVAL      *IN81 = *ON
N50P C                   EVAL      P8_POSTNR = WPOSTN
N50P C                   ELSE                                                   <POSISJ
N50P C                   EVAL      P8_PONRPB = WPNPBK
N50P C                   EVAL      *IN89 = *ON
N50P C                   ENDIF                                                  <POSISJ
N50P
N50P C                   Z-ADD     7             P8_A
N50P C                   Z-ADD     2             P8_B
N50P C                   CALL      'VR841'       VR841P
N50P
N50P C                   IF        P8_WPNONE = '1'
N50P C                   EVAL      *IN88 = *ON
N50P C                   ELSE                                                   <P8_WPNONE
N50P
N50P C                   IF        P8_WPAVSL <> '1'
N50P
N50P C                   IF        POSISJ <= 41
N50P C                   EVAL      WPOSTN = P8_POSTNR
N50P C                   ELSE                                                   <POSISJ
N50P C                   CLEAR                   WPNPBK
N50P
N50P C                   IF        P8_PONRPB <> *BLANKS
N50P C                   MOVEL     P8_PONRPB     WPNPBK
N50P C                   ELSE                                                   <P8_PONRPB
N50P C                   MOVEL     P8_POSTNR     WPNPBK
N50P C                   ENDIF                                                  <P8_PONRPB
N50P
N50P C                   ENDIF                                                  <POSISJ
N50P
N50P C                   IF        WADR3 = *BLANKS
N50P C                   EVAL      WADR3 = P8_POSTED
N50P C                   ENDIF                                                  <ADR3
N50P
N50P C                   ENDIF                                                  <P8_WPAVSL
N50P
N50P C                   ENDIF                                                  <P8_WPNONE
N50P
     C                   ENDSL
     C                   GOTO      VISB11
     C                   ENDIF                                                  <*IN04
      *
      *----------------------------------------------------------------
      *  HENTER STANDARDKUNDE FRA KUNDF
      *----------------------------------------------------------------
      *
     C     *IN05         IFEQ      *ON
     C     WKUNDN        ANDGT     *ZEROS
     C                   MOVE      WKUNDN        KUNDNR
N50  C     KEYA          CHAIN(N)  KORTR
N50
N50   * Henter event. E-postadr.
N50
N50  C                   IF        NOT %FOUND
N50  C                   EVAL      EMNRKO = *BLANKS
N50  C                   EVAL      EPOAKO = *BLANKS
N50  C                   ENDIF                                                  <NOT %FOUND
N50
     C     KEYA          CHAIN     KUNDL01                            53
      *
     C     *IN53         IFEQ      *OFF
     C     AKTKOD        ANDEQ     'A'
     C                   MOVEL     DATA2         DATA3
N50  C                   EVAL      WS_EMNRKO = EMNRKO
N50  C                   EVAL      WS_EPOAKO = EPOAKO
     C                   EXCEPT    KUNDA
     C                   MOVE      *ZEROS        WKUNDN
     C                   ENDIF                                                  *IN53/AKTKOD
     C                   GOTO      VISB11                                       *IN53/AKTKOD
      *
     C                   ENDIF                                                  *IN05/WKUNDN
      *
      *----------------------------------------------------------------
      *  TEST FELTER
      *----------------------------------------------------------------
      *
     C     WPOSTU        IFNE      *BLANKS
     C     WPOSTN        ANDNE     *ZEROS
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB11
     C                   ENDIF
      *
     C     WLAND         IFNE      *BLANKS
     C                   MOVE      WLAND         LAND
     C     KEYU          CHAIN     KODEL01                            54
     C     *IN54         IFEQ      *ON
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB11
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB11
     C                   ENDIF
     C                   ENDIF
      *
     C     WVALKO        IFNE      *BLANKS
     C                   MOVE      WVALKO        VALKOD
     C     KEYM          CHAIN     VALUL01                            54
     C     *IN54         IFEQ      *ON
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB11
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB11
     C                   ENDIF
     C                   ENDIF
      *
     C     WFORET        IFLT      100000000
     C     WFORET        ANDNE     *ZEROS
     C                   MOVE      *ON           *IN77
     C                   GOTO      VISB11
     C                   ENDIF
      *
     C     VISB12        TAG
     C                   MOVE      *OFF          *IN12
     C                   EXFMT     VR030B12
     C     *IN06         CABEQ     *ON           TAG01A
     C                   MOVEA     '0000'        *IN(68)                        <FEILIND
     C                   MOVEA     '00000000'    *IN(72)                        <FEILIND
     C                   MOVEA     '0000'        *IN(80)                        <FEILIND
     C                   MOVE      *OFF          *IN(85)                        <FEILIND
     C                   MOVEA     '00'          *IN(93)
E50P C                   MOVEA     '000'         *IN(87)
     C                   MOVE      *OFF          *IN98                          <PUTOVR
     C     *IN12         CABEQ     *ON           VISB11                         <FORRIGE BILDE
      *
      *        SJEKK OM F4 ER TASTET
      *
     C     *IN04         IFEQ      *ON
     C                   Z-ADD     CURLIN        CURLI1            5 0
     C     CURLI1        DIV       256           LINJE             2 0
     C     LINJE         MULT      256           CURLI2            5 0
     C     CURLI1        SUB       CURLI2        POSISJ            3 0
      *
     C                   SELECT
      *
      *        SØK PÅ AVTALEKUNDE (KUNDE)
      *
     C     LINJE         WHENEQ    22
     C                   Z-ADD     6             A
     C                   Z-ADD     2             B
     C                   MOVE      'VR910'       WPROG
E40P C                   MOVE      'B'           WPTSOK
     C                   Z-ADD     WAKNRK        SOKNR
     C     WAKNRK        IFNE      *ZEROS
E40P C                   MOVE      'O'           WPTSOK
     C                   ENDIF
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN81
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN81
     C                   ENDIF
     C                   MOVE      PKUNDN        WAKNRK
     C                   ENDIF
     C                   GOTO      VISB12
      *
      *        SØK PÅ FAKTURAMOTTAKER (KUNDE)
      *
     C     LINJE         WHENEQ    5
     C                   Z-ADD     6             A
     C                   Z-ADD     2             B
     C                   MOVE      'VR910'       WPROG
E40P C                   MOVE      'B'           WPTSOK
     C                   Z-ADD     WFMOT         SOKNR
     C     WFMOT         IFNE      *ZEROS
E40P C                   MOVE      'O'           WPTSOK
     C                   ENDIF
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN74
     C                   MOVE      *OFF          *IN72
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN74
     C                   MOVE      *ON           *IN72
     C                   ENDIF
     C                   MOVE      PKUNDN        WFMOT
     C                   ENDIF
     C                   GOTO      VISB12
      *
      *        SØK PÅ FACTORINGSELSKAP (KUNDE)
      *
     C     LINJE         WHENEQ    6
     C                   Z-ADD     7             A
     C                   Z-ADD     2             B
     C                   MOVE      'VR910'       WPROG
E40P C                   MOVE      'B'           WPTSOK
     C                   Z-ADD     WFACKN        SOKNR
     C     WFACKN        IFNE      *ZEROS
E40P C                   MOVE      'O'           WPTSOK
     C                   ENDIF
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN72
     C                   MOVE      *OFF          *IN68
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN72
     C                   MOVE      *ON           *IN68
     C                   ENDIF
     C                   MOVE      PKUNDN        WFACKN
     C                   ENDIF
     C                   GOTO      VISB12
      *
      *        SØK PÅ BETALINGSBETINGELSE
      *
     C     LINJE         WHENEQ    8
     C                   Z-ADD     9             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR903'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C     HLPI12        IFNE      '1'
     C                   MOVE      BETBET        WBETBE
     C                   ENDIF
     C                   GOTO      VISB12
      *
      *        SØK PÅ AVGIFT 1 - 3
      *
     C     LINJE         WHENEQ    13
     C                   Z-ADD     9             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR909'       WPROG
     C     POSISJ        IFGE      34
     C     POSISJ        ANDLE     35
     C                   MOVE      WAVG1         PAVG
     C                   ENDIF
     C     POSISJ        IFGE      38
     C     POSISJ        ANDLE     39
     C                   MOVE      WAVG2         PAVG
     C                   ENDIF
     C     POSISJ        IFGE      42
     C     POSISJ        ANDLE     43
     C                   MOVE      WAVG3         PAVG
     C                   ENDIF
     C     POSISJ        IFGE      46
     C     POSISJ        ANDLE     47
     C                   MOVE      WAVG4K        PAVG
     C                   ENDIF
     C     POSISJ        IFGE      50
     C     POSISJ        ANDLE     51
     C                   MOVE      WAVG5K        PAVG
     C                   ENDIF
     C     POSISJ        IFGE      54
     C     POSISJ        ANDLE     55
     C                   MOVE      WAVG6K        PAVG
     C                   ENDIF
     C                   EXSR      SUBR10                                       <Søk på koder
     C     POSISJ        IFGE      34
     C     POSISJ        ANDLE     35
     C     HLPI12        ANDNE     '1'
     C                   MOVE      AVG1          WAVG1
     C                   ENDIF
     C     POSISJ        IFGE      38
     C     POSISJ        ANDLE     39
     C     HLPI12        ANDNE     '1'
     C                   MOVE      AVG2          WAVG2
     C                   ENDIF
     C     POSISJ        IFGE      42
     C     POSISJ        ANDLE     43
     C     HLPI12        ANDNE     '1'
     C                   MOVE      AVG3          WAVG3
     C                   ENDIF
     C     POSISJ        IFGE      46
     C     POSISJ        ANDLE     47
     C     HLPI12        ANDNE     '1'
     C                   MOVE      AVG4KU        WAVG4K
     C                   ENDIF
     C     POSISJ        IFGE      50
     C     POSISJ        ANDLE     51
     C     HLPI12        ANDNE     '1'
     C                   MOVE      AVG5KU        WAVG5K
     C                   ENDIF
     C     POSISJ        IFGE      54
     C     POSISJ        ANDLE     55
     C     HLPI12        ANDNE     '1'
     C                   MOVE      AVG6KU        WAVG6K
     C                   ENDIF
     C                   GOTO      VISB12
      *
      *        SØK PÅ LEVERANDØR
      *
     C     LINJE         WHENEQ    21
     C                   Z-ADD     6             A
     C                   Z-ADD     2             B
     C                   MOVE      'VR911'       WPROG
     C                   MOVE      'A'           WPTSOK
     C                   Z-ADD     WLEVNR        SOKNR
     C     WLEVNR        IFNE      *ZEROS
     C                   MOVE      'N'           WPTSOK
     C                   ENDIF
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN73
     C                   MOVE      *OFF          *IN81
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN73
     C                   MOVE      *ON           *IN81
     C                   ENDIF
     C                   MOVE      PLEVNR        WLEVNR
     C                   ENDIF
     C                   GOTO      VISB12
      *
     C                   ENDSL
     C                   GOTO      VISB12
     C                   ENDIF                                                  <*IN04
      *----------------------------------------------------------------
      *  TEST FELTER
      *----------------------------------------------------------------
      *
     C     WAKNRK        IFGE      1
     C                   Z-ADD     WAKNRK        KUNDNR
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         IFEQ      *OFF
     C                   EXCEPT    KUNDA
     C                   ENDIF
     C     *IN53         IFEQ      *ON
     C                   MOVE      *ON           *IN81
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN81
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C                   ENDIF
      *
     C     WFMOT         IFGE      1
     C                   Z-ADD     WFMOT         KUNDNR
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         IFEQ      *OFF
     C                   EXCEPT    KUNDA
     C                   ENDIF
     C     *IN53         IFEQ      *ON
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C                   ENDIF
      *
     C     WFACKN        IFGE      1
     C                   Z-ADD     WFACKN        KUNDNR
     C     KEYA          CHAIN     KUNDL01                            53
     C     *IN53         IFEQ      *OFF
     C                   EXCEPT    KUNDA
     C                   ENDIF
     C     *IN53         IFEQ      *ON
     C                   MOVE      *ON           *IN72
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN72
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C     *LOCK         IN        DATA2
     C                   ENDIF
      *
     C     WFACT         IFNE      *BLANKS
     C     FACKNR        IFEQ      *ZEROS
     C     WWFACK        ANDEQ     *ZEROS
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C                   ENDIF
      *
     C     WBETBE        IFNE      *BLANKS
     C                   MOVE      WBETBE        BETBET
     C     KEYH          CHAIN     KODAL01                            59
     C     *IN59         IFEQ      *ON
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C                   ENDIF
      *
     C     WMOMS         IFNE      *BLANKS
     C                   MOVE      WMOMS         AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C                   ENDIF
      *
     C     WAVG1         IFNE      *BLANKS
     C                   MOVE      WAVG1         AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C                   ENDIF
      *
     C     WAVG2         IFNE      *BLANKS
     C                   MOVE      WAVG2         AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C                   ENDIF
      *
     C     WAVG3         IFNE      *BLANKS
     C                   MOVE      WAVG3         AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN80
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN80
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C                   ENDIF
      *
     C     WAVG4K        IFNE      *BLANKS
     C                   MOVE      WAVG4K        AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN85
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN85
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C                   ENDIF
      *
     C     WAVG5K        IFNE      *BLANKS
     C                   MOVE      WAVG5K        AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN93
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN93
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C                   ENDIF
      *
     C     WAVG6K        IFNE      *BLANKS
     C                   MOVE      WAVG6K        AVG
E40  C     KEYK          CHAIN     KHEAL02                            57
     C     *IN57         IFEQ      *ON
     C                   MOVE      *ON           *IN94
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN94
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C                   ENDIF
      *
     C     WLEVNR        IFGE      1
     C                   Z-ADD     WLEVNR        LEVNR
     C     KEYD          CHAIN     LEVEL01                            58
     C     *IN58         IFEQ      *ON
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB12
     C                   ENDIF
     C                   ENDIF
     C     VISB13        TAG
     C                   MOVE      *OFF          *IN12
     C                   EXFMT     VR030B13
     C     *IN06         CABEQ     *ON           TAG01A
     C                   MOVEA     '00000'       *IN(68)                        <FEILIND
     C                   MOVEA     '00000000'    *IN(73)                        <FEILIND
     C                   MOVE      *OFF          *IN(81)                        <FEILINDIKAT
     C                   MOVE      *OFF          *IN98                          <PUTOVR
E50P C                   MOVEA     '000'         *IN(87)
     C     *IN12         CABEQ     *ON           VISB12                         <FORRIGE BILDE
      *
      *        SJEKK OM F4 ER TASTET
      *
     C     *IN04         IFEQ      *ON
     C                   Z-ADD     CURLIN        CURLI1            5 0
     C     CURLI1        DIV       256           LINJE             2 0
     C     LINJE         MULT      256           CURLI2            5 0
     C     CURLI1        SUB       CURLI2        POSISJ            3 0
      *
     C                   SELECT
      *
      *        SØK PÅ KUNDEGRUPPE
      *
     C     LINJE         WHENEQ    5
     C                   Z-ADD     6             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR914'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C     HLPI12        IFNE      '1'
     C                   MOVE      KUNDGR        WKUNDG
     C                   ENDIF
     C                   GOTO      VISB13
      *
      *        SØK PÅ DISTRIKT ?
      *
     C     LINJE         WHENEQ    6
     C                   MOVE      'D'           FIL
     C                   Z-ADD     7             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR902'       WPROG
     C                   Z-ADD     WDISTR        WNUMSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN74
     C                   MOVE      *OFF          *IN75
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN74
     C                   MOVE      *ON           *IN75
     C                   ENDIF
     C                   Z-ADD     WNUMSO        WDISTR
     C                   ENDIF
     C                   GOTO      VISB13
      *
      *        SØK PÅ SELGER ?
      *
     C     LINJE         WHENEQ    7
     C                   MOVE      'S'           FIL
     C                   Z-ADD     8             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR901'       WPROG
     C                   MOVEL     WSELGE        WALFSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN75
     C                   MOVE      *OFF          *IN76
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN75
     C                   MOVE      *ON           *IN76
     C                   ENDIF
     C                   MOVE      WALFSO        WSELGE
     C                   ENDIF
     C                   GOTO      VISB13
      *
      *        SØK PÅ LAGERNR ?
      *
     C     LINJE         WHENEQ    8
     C                   MOVE      'L'           FIL
     C                   Z-ADD     9             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR901'       WPROG
     C                   MOVEL     WLAGNR        WALFSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN76
     C                   MOVE      *OFF          *IN77
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN76
     C                   MOVE      *ON           *IN77
     C                   ENDIF
     C                   MOVEL     WALFSO        WLAGNR
     C                   ENDIF
     C                   GOTO      VISB13
      *
      *        SØK PÅ RUTENR ?
      *
     C     LINJE         WHENEQ    9
     C                   MOVE      'R'           FIL
     C                   Z-ADD     10            A
     C                   Z-ADD     33            B
     C                   MOVE      'VR902'       WPROG
     C                   Z-ADD     WRUTEN        WNUMSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN77
     C                   MOVE      *OFF          *IN72
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN77
     C                   MOVE      *ON           *IN72
     C                   ENDIF
     C                   Z-ADD     WNUMSO        WRUTEN
     C                   ENDIF
     C                   GOTO      VISB13
      *
      *        SØK PÅ LEVERINGSBETINGELSE ?
      *
     C     LINJE         WHENEQ    21
     C                   MOVE      'M'           FIL
     C                   Z-ADD     5             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR901'       WPROG
     C                   MOVEL     WLEVBE        WALFSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN78
     C     HLPI12        IFNE      '1'
     C                   MOVEL     WALFSO        WLEVBE
     C                   ENDIF
     C                   GOTO      VISB13
      *
     C                   OTHER
     C                   GOTO      VISB13
      *
     C                   ENDSL
     C                   ENDIF                                                  *IN04
      *----------------------------------------------------------------
      *   TEST FELTER
      *----------------------------------------------------------------
     C     WKUNDG        IFNE      *BLANKS
     C                   MOVE      WKUNDG        KUNDGR
     C     KEYN          CHAIN     KODKL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB13
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB13
     C                   ENDIF
     C                   ENDIF
      *
     C     WDISTR        IFGE      1
     C                   Z-ADD     WDISTR        DISTR
     C     KEYI          CHAIN     KODDL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB13
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB13
     C                   ENDIF
     C                   ENDIF
      *
     C     WSELGE        IFNE      *BLANKS
     C                   MOVE      WSELGE        SELGER
     C     KEYS          CHAIN     KODUL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB13
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB13
     C                   ENDIF
     C                   ENDIF
      *
     C     WLAGNR        IFNE      *BLANKS
     C                   MOVE      WLAGNR        LAGNR
     C     KEYO          CHAIN     KODLL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB13
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB13
     C                   ENDIF
     C                   ENDIF
      *
     C     WRUTEN        IFGE      1
     C                   Z-ADD     WRUTEN        RUTENR
     C     KEYR          CHAIN     KODRL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB13
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN77
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB13
     C                   ENDIF
     C                   ENDIF
      *
     C     WLEVBE        IFNE      *BLANKS
     C                   MOVE      WLEVBE        LEVBET
     C     KEYP          CHAIN     KODML01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB13
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB13
     C                   ENDIF
     C                   ENDIF
      *
N24  C     WKOEEV        IFNE      *BLANKS
N24  C                   MOVE      WKOEEV        KODEEV
N24  C     KEYPT         CHAIN     KODTL01                            55
N24  C     *IN55         IFEQ      *ON
N24  C                   MOVE      *ON           *IN80
N24  C                   MOVE      *ON           *IN98
N24  C                   GOTO      VISB13
N24  C                   ENDIF                                                  <*IN55
N24  C     AKTKOD        IFNE      'A'
N24  C                   MOVE      *ON           *IN80
N24  C                   MOVE      *ON           *IN98
N24  C                   GOTO      VISB13
N24  C                   ENDIF                                                  <AKTKOD
N24  C                   ENDIF                                                  <WKOEEV
N24   *
     C     VISB18        TAG
     C                   MOVE      *OFF          *IN12
     C                   EXFMT     VR030B18
     C     *IN06         CABEQ     *ON           TAG01A
     C                   MOVEA     '00000'       *IN(68)                        <FEILIND
     C                   MOVEA     '00000'       *IN(73)                        <FEILIND
     C                   MOVEA     '0000'        *IN(78)                        <FEILIND
     C                   MOVE      *OFF          *IN98                          <PUTOVR
E50P C                   MOVEA     '000'         *IN(87)
     C     *IN12         CABEQ     *ON           VISB13                         <FORRIGE BILDE
      *
      *        SJEKK OM F4 ER TASTET
      *
     C     *IN04         IFEQ      *ON
     C                   Z-ADD     CURLIN        CURLI1            5 0
     C     CURLI1        DIV       256           LINJE             2 0
     C     LINJE         MULT      256           CURLI2            5 0
     C     CURLI1        SUB       CURLI2        POSISJ            3 0
      *
     C                   SELECT
      *
      *        SØK PÅ KONTOHENVISNINGSKODE
      *
     C     LINJE         WHENEQ    5
     C                   Z-ADD     6             A
     C                   Z-ADD     25            B
     C                   MOVE      'VR913'       WPROG                                      r
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      KHENV         WKHENV
     C                   GOTO      VISB18
      *
      *        SØK PÅ LEVERINGSMÅTE ?
      *
     C     LINJE         WHENEQ    6
     C                   MOVE      'N'           FIL
     C                   Z-ADD     7             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR901'       WPROG                                      r
     C                   MOVEL     WLEVMA        WALFSO
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   MOVE      *ON           *IN74
     C                   MOVE      *OFF          *IN68
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN74
     C                   MOVE      *ON           *IN68
     C                   ENDIF
     C                   MOVEL     WALFSO        WLEVMA
     C                   ENDIF
     C                   GOTO      VISB18
      *
      *        SØK PÅ SPEDITØR / SPEDITØR UTLAND
      *
     C     LINJE         WHENEQ    8
     C                   Z-ADD     9             A
     C                   Z-ADD     3             B
     C                   MOVE      'VR904'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C     POSISJ        IFGE      38
     C     POSISJ        ANDLE     39
     C     HLPI12        ANDNE     '1'
     C                   MOVE      SPEDNR        WSPEDN
     C                   ENDIF
     C     POSISJ        IFGE      42
     C     POSISJ        ANDLE     43
     C     HLPI12        ANDNE     '1'
     C                   MOVE      SPEDNU        WSPEDU
     C                   ENDIF
     C                   GOTO      VISB18
      *
      *        SØK PÅ VAREADRESSE
      *
     C     LINJE         WHENEQ    16
     C                   Z-ADD     6             A
     C                   Z-ADD     3             B
     C                   MOVE      'VR920'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB18
      *
      *        SØK PÅ RESKONTROTYPE
      *
     C     LINJE         WHENEQ    19
     C                   Z-ADD     8             A
     C                   Z-ADD     33            B
     C                   MOVE      'VR925'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB18
      *
      *        SØK PÅ PRIS/RABATTGRUPPE
      *
     C     LINJE         WHENEQ    21
     C                   Z-ADD     6             A
     C                   Z-ADD     2             B
E24  C                   MOVE      'VR928'       WPROG
     C                   EXSR      SUBR10                                       <Søk på koder
     C                   GOTO      VISB18
      *
     C                   OTHER
     C                   GOTO      VISB18
      *
     C                   ENDSL
     C                   ENDIF                                                  *IN04
      *----------------------------------------------------------------
      *   TEST FELTER
      *----------------------------------------------------------------
     C     WKHENV        IFNE      *BLANKS
     C                   MOVE      'D'           RECTYP
     C                   MOVEL     WKHENV        KHENV
     C     KEYJ          CHAIN     KHEDL01                            61
     C     *IN61         IFEQ      *ON
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN73
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C                   ENDIF
      *
     C     WLEVMA        IFNE      *BLANKS
     C                   MOVEL     WLEVMA        LEVMAT
     C     KEYQ          CHAIN     KODNL01                            55
     C     *IN55         IFEQ      *ON
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN74
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C                   ENDIF
      *
     C     WSPEDN        IFNE      *BLANKS
     C                   MOVE      WSPEDN        SPEDNR
     C     KEYL          CHAIN     KODSL01                            62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN75
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C                   ENDIF
      *
     C     WSPEDU        IFNE      *BLANKS
     C                   MOVE      WSPEDU        SPEDNU
     C     KEYLU         CHAIN     KODSL01                            62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN76
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C                   ENDIF
      *
     C     WVADRK        IFNE      *ZEROS
     C                   MOVE      WVADRK        VADRKU
     C                   MOVE      WKUNDN        KUNDNR
     C     KEYV          CHAIN     VADRL01                            62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN78
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C                   ENDIF
      *
     C     WRETYK        IFNE      *BLANKS
     C                   MOVE      WRETYK        RETYKU
     C     KEYW          CHAIN     KODQ1A                             62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN79
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C                   ENDIF
      *
     C     WPRIKK        IFNE      *BLANKS
     C                   MOVE      WPRIKK        PRIKKU
     C     KEYX          CHAIN     KODYL01                            62
     C     *IN62         IFEQ      *ON
     C                   MOVE      *ON           *IN80
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C     AKTKOD        IFNE      'A'
     C                   MOVE      *ON           *IN80
     C                   MOVE      *ON           *IN98
     C                   GOTO      VISB18
     C                   ENDIF
     C                   ENDIF
      *
     C     TAG01A        TAG
     C                   ENDSR
      /EJECT
      *----------------------------------------------------------------
      *  S U B R 0 8    STATUSBILDE
      *----------------------------------------------------------------
     C     SUBR08        BEGSR
     C                   MOVE      WFIRMA        FIRMA
     C     KEYG          CHAIN     SYSRL01                            50
     C     *IN50         IFEQ      *OFF
     C                   EXCEPT    SYUTR
     C                   ENDIF
     C                   EXFMT     VR030B10
     C                   ENDSR
      /EJECT
      *----------------------------------------------------------------
      *  S U B R 0 9    FLYTT TIL X-FELTER FOR ENDRINGSJOURNAL
      *----------------------------------------------------------------
     C     SUBR09        BEGSR
      *
     C                   MOVE      DKUND         XDKUND
     C                   MOVE      KNAVN         XKNAVN
     C                   MOVE      ADR1          XADR1
     C                   MOVE      ADR2          XADR2
     C                   MOVE      POSTNR        XPOSTN
     C                   MOVE      ADR3          XADR3
     C                   MOVE      KPERS         XKPERS
     C                   MOVE      TLF           XTLF
     C                   MOVE      TFAXNR        XTFAXN
     C                   MOVE      SONAVN        XSONAV
     C                   MOVE      LAND          XLAND
     C                   MOVE      SPRAAK        XSPRAA
     C                   MOVE      HEAD          XHEAD
     C                   MOVE      BANKG         XBANKG
     C                   MOVE      POSTG         XPOSTG
     C                   MOVE      LEVNR         XLEVNR
     C                   MOVE      FMOT          XFMOT
     C                   MOVE      FACT          XFACT
     C                   MOVE      BETBET        XBETBE
     C                   MOVE      BETMAT        XBETMA
     C                   MOVE      PRISK         XPRISK
     C                   MOVE      RABAT1        XRAB1
     C                   MOVE      RABAT2        XRAB2
     C                   MOVE      RABAT3        XRAB3
     C                   MOVE      RABAT4        XRAB4
     C                   MOVE      MOMS          XMOMS
     C                   MOVE      AVG1          XAVG1
     C                   MOVE      AVG2          XAVG2
     C                   MOVE      AVG3          XAVG3
     C                   MOVE      AVG4KU        XAVG4K
     C                   MOVE      AVG5KU        XAVG5K
     C                   MOVE      AVG6KU        XAVG6K
     C                   MOVE      REST          XREST
     C                   MOVE      KVANT         XKVANT
     C                   MOVE      TILBKD        XTILBK
     C                   MOVE      BKDBKU        XBKDBK
     C                   MOVE      BONUS         XBONUS
     C                   MOVE      SFAKT         XSFAKT
     C                   MOVE      SORD          XSORD
     C                   MOVE      AUTKOD        XAUTKO
     C                   MOVE      KUNDGR        XKUNDG
     C                   MOVE      DISTR         XDISTR
     C                   MOVE      SELGER        XSELGE
     C                   MOVE      LAGNR         XLAGNR
     C                   MOVE      RUTENR        XRUTEN
     C                   MOVE      SEKVNR        XSEKVN
     C                   MOVE      FEKS          XFEKS
     C                   MOVE      RKOD          XRKOD
     C                   MOVE      PKOD          XPKOD
     C                   MOVE      PGEBYR        XPGEBY
     C                   MOVE      KUTDR         XKUTDR
     C                   MOVE      AKONT         XAKONT
     C                   MOVE      KGRENS        XKGREN
     C                   MOVE      KVERD         XKVERD
     C                   MOVE      KHENV         XKHENV
     C                   MOVE      LEVBET        XLEVBE
     C                   MOVE      LEVMAT        XLEVMA
     C                   MOVE      GNOTKD        XGNOTK
     C                   MOVE      FRSONE        XFRSON
     C                   MOVE      SPEDNR        XSPEDN
     C                   MOVE      FBKOD         XFBKOD
     C                   MOVE      MRKKOD        XMRKKO
     C                   MOVE      ADRKOD        XADRKO
     C                   MOVE      OFKPOS        XOFKPO
     C                   MOVE      POSTNU        XPOSTU
N50  C                   MOVE      PNPBKU        XPNPBK
     C                   MOVE      SPEDNU        XSPEDU
     C                   MOVE      PFKOKU        XPFKOK
     C                   MOVE      BFKOKU        XBFKOK
     C                   MOVE      FACKNR        XFACKN
     C                   MOVE      FORETN        XFORET
     C                   MOVE      VADRKU        XVADRK
     C                   MOVE      PRKPKU        XPRKPK
     C                   MOVE      PRKOKU        XPRKOK
     C                   MOVE      RETYKU        XRETYK
     C                   MOVE      VATKKU        XVATKK
     C                   MOVE      PRIKKU        XPRIKK
     C                   MOVE      RNRAKU        XRNRAK
     C                   MOVE      AKNRKU        XAKNRK
N40  C                   EVAL      XEHANK = EHANKU
N40  C                   EVAL      XEHOTK = EHOTKU
N50P C                   EVAL      XEANNK = EANNKU
      *
     C                   ENDSR
      /EJECT
      *----------------------------------------------------------------
      *  S U B R 1 0    SØK PÅ KODER
      *----------------------------------------------------------------
     C     SUBR10        BEGSR
     C                   MOVE      *ON           *IN87
     C                   MOVE      *ON           *IN98
     C                   SELECT
N50P
N50P  * Forespørsel på postnummer
N50P
N50P C                   WHEN      WPROG = 'VR841'
N50P C                   CLEAR                   VR841DS
N50P
N50P C                   IF        POSISJ <= 41
N50P C                   EVAL      *IN81 = *ON
N50P C                   EVAL      P8_POSTNR = POSTNR
N50P C                   ELSE                                                   <POSISJ
N50P C                   EVAL      P8_PONRPB = PNPBKU
N50P C                   EVAL      *IN89 = *ON
N50P C                   ENDIF                                                  <POSISJ
N50P
N50P C                   Z-ADD     7             P8_A
N50P C                   Z-ADD     2             P8_B
N50P C                   CALL      'VR841'       VR841P
N50P
N50P C                   IF        P8_WPNONE = '1'
N50P C                   EVAL      *IN88 = *ON
N50P C                   ELSE                                                   <P8_WPNONE
N50P
N50P C                   IF        P8_WPAVSL <> '1'
N50P
N50P C                   IF        POSISJ <= 41
N50P C                   EVAL      POSTNR = P8_POSTNR
N50P C                   ELSE                                                   <POSISJ
N50P C                   CLEAR                   PNPBKU
N50P
N50P C                   IF        P8_PONRPB <> *BLANKS
N50P C                   MOVEL     P8_PONRPB     PNPBKU
N50P C                   ELSE                                                   <P8_PONRPB
N50P C                   MOVEL     P8_POSTNR     PNPBKU
N50P C                   ENDIF                                                  <P8_PONRPB
N50P
N50P C                   ENDIF                                                  <POSISJ
N50P
N50P C                   IF        ADR3 = *BLANKS
N50P C                   EVAL      ADR3 = P8_POSTED
N50P C                   ENDIF                                                  <ADR3
N50P
N50P C                   ENDIF                                                  <P8_WPAVSL
N50P
N50P C                   ENDIF                                                  <P8_WPNONE
N50P
     C     WPROG         WHENEQ    'VR910'
     C     LINJE         ANDEQ     13
     C     LINJE         OREQ      14
S55   *    VALKNR        ANDNE     *ZEROS
N55  C     KUNDNR        ANDNE     *ZEROS
     C                   CALL      'VR910'
S55   *                  PARM      VALKNR        PKUNDN
N55  C                   PARM      KUNDNR        PKUNDN
     C                   PARM      *BLANKS       PSONAV
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      *BLANKS       WPNONE
E40P C                   PARM      'O'           WPTSOK                         NUM. SØK
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
     C     HLPI12        IFNE      '1'
S55   *                  MOVE      PKUNDN        VALKNR
N55  C                   MOVE      PKUNDN        KUNDNR
     C                   ENDIF
      *
     C     WPROG         WHENEQ    'VR910'
     C     LINJE         ANDGE     14
     C     LINJE         ANDLE     15
     C                   CALL      'VR910'
     C                   PARM      *ZEROS        PKUNDN
S55   *                  PARM      VALSON        PSONAV
N55  C                   PARM      SONAVN        PSONAV
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      *BLANKS       WPNONE
E40P C                   PARM      'B'           WPTSOK                         ALFA SØK
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
     C     HLPI12        IFNE      '1'
S55   *                  MOVE      PKUNDN        VALKNR
N55  C                   MOVE      PKUNDN        KUNDNR
     C                   ENDIF
      *
     C     WPROG         WHENEQ    'VR901'
     C                   CALL      'VR901'                                      <Søk på koder
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      FIL           FIL
     C                   PARM      WALFSO        WALFSO
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       WPNONE
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
      *
     C     WPROG         WHENEQ    'VR902'
     C                   CALL      'VR902'                                      <Søk på koder
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      FIL           FIL
     C                   PARM      WNUMSO        WNUMSO
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       WPNONE
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
      *
     C     WPROG         WHENEQ    'VR903'
     C                   CALL      'VR903'                                      <Søk på koder
     C                   PARM      BETBET        PBETBE
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      *BLANKS       WPNONE
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
     C                   MOVE      *ON           *IN76
     C                   MOVE      *OFF          *IN70
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN76
     C                   MOVE      *ON           *IN70
     C                   ENDIF
     C                   MOVE      PBETBE        BETBET
     C                   ENDIF
      *
     C     WPROG         WHENEQ    'VR904'
     C                   CALL      'VR904'                                      <Søk på koder
     C                   PARM      SPEDNR        PSPEDN
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      *BLANKS       WPNONE
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
     C     POSISJ        IFGE      38
     C     POSISJ        ANDLE     39
     C                   MOVE      *ON           *IN75
     C                   MOVE      *OFF          *IN76
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN75
     C                   MOVE      *ON           *IN76
     C                   ENDIF
     C                   MOVE      PSPEDN        SPEDNR
     C                   ENDIF
     C                   ENDIF
     C     POSISJ        IFGE      42
     C     POSISJ        ANDLE     43
     C                   MOVE      *ON           *IN76
     C                   MOVE      *OFF          *IN69
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN76
     C                   MOVE      *ON           *IN69
     C                   ENDIF
     C                   MOVE      PSPEDN        SPEDNU
     C                   ENDIF
     C                   ENDIF
      *
     C     WPROG         WHENEQ    'VR906'
     C                   CALL      'VR906'                                      <Søk på koder
     C                   PARM      VALKOD        PVALKO
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      *BLANKS       WPNONE
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
     C                   MOVE      *ON           *IN74
     C                   MOVE      *OFF          *IN80
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN74
     C                   MOVE      *ON           *IN80
     C                   ENDIF
     C                   MOVE      PVALKO        VALKOD
     C                   ENDIF
      *
     C     WPROG         WHENEQ    'VR907'
     C                   CALL      'VR907'                                      <Søk på koder
     C                   PARM      LAND          PLAND
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      *BLANKS       WPNONE
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
     C                   MOVE      *ON           *IN76
     C                   MOVE      *OFF          *IN74
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      *ON
     C                   MOVE      *OFF          *IN76
     C                   MOVE      *ON           *IN74
     C                   ENDIF
     C                   MOVE      PLAND         LAND
     C                   ENDIF
      *
     C     WPROG         WHENEQ    'VR909'
     C                   CALL      'VR909'                                      <Søk på koder
N40  C                   PARM      *BLANKS       PKODE
E40  C                   PARM      PAVG          PAVG
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      *BLANKS       WPNONE
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
     C     POSISJ        IFGE      34
     C     POSISJ        ANDLE     35
     C                   MOVE      *ON           *IN78
     C                   MOVE      *OFF          *IN79
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN78
     C                   MOVE      *ON           *IN79
     C                   ENDIF
     C                   MOVE      PAVG          AVG1
     C                   ENDIF
     C                   ENDIF
     C     POSISJ        IFGE      38
     C     POSISJ        ANDLE     39
     C                   MOVE      *ON           *IN79
     C                   MOVE      *OFF          *IN80
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN79
     C                   MOVE      *ON           *IN80
     C                   ENDIF
     C                   MOVE      PAVG          AVG2
     C                   ENDIF
     C                   ENDIF
     C     POSISJ        IFGE      42
     C     POSISJ        ANDLE     43
     C                   MOVE      *ON           *IN80
     C                   MOVE      *OFF          *IN85
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN80
     C                   MOVE      *ON           *IN85
     C                   ENDIF
     C                   MOVE      PAVG          AVG3
     C                   ENDIF
     C                   ENDIF
     C     POSISJ        IFGE      46
     C     POSISJ        ANDLE     47
     C                   MOVE      *ON           *IN85
     C                   MOVE      *OFF          *IN93
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN85
     C                   MOVE      *ON           *IN93
     C                   ENDIF
     C                   MOVE      PAVG          AVG4KU
     C                   ENDIF
     C                   ENDIF
     C     POSISJ        IFGE      50
     C     POSISJ        ANDLE     51
     C                   MOVE      *ON           *IN93
     C                   MOVE      *OFF          *IN94
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN93
     C                   MOVE      *ON           *IN94
     C                   ENDIF
     C                   MOVE      PAVG          AVG5KU
     C                   ENDIF
     C                   ENDIF
     C     POSISJ        IFGE      54
     C     POSISJ        ANDLE     55
     C                   MOVE      *ON           *IN94
     C                   MOVE      *OFF          *IN71
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN94
     C                   MOVE      *ON           *IN71
     C                   ENDIF
     C                   MOVE      PAVG          AVG6KU
     C                   ENDIF
     C                   ENDIF
      *
     C     WPROG         WHENEQ    'VR910'
     C                   CALL      'VR910'                                      <Søk på kundnr
     C                   PARM      SOKNR         PKUNDN
     C                   PARM      *BLANKS       PSONAV
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      *BLANKS       WPNONE
     C                   PARM      WPTSOK        WPTSOK
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
      *
     C     WPROG         WHENEQ    'VR911'
     C                   CALL      'VR911'                                      <Søk på levnr
     C                   PARM      SOKNR         PLEVNR
     C                   PARM      *BLANKS       PSONAV
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      *BLANKS       WPNONE
     C                   PARM      WPTSOK        WPTSOK
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
     C                   MOVE      *ON           *IN73
      *
     C     WPROG         WHENEQ    'VR913'
     C                   CALL      'VR913'                                      <Søk på koder
     C                   PARM      KHENV         PKHENV
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      *BLANKS       WPNONE
     C                   PARM      'D'           WPRECT
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
     C                   MOVE      *ON           *IN73
     C                   MOVE      *OFF          *IN74
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN73
     C                   MOVE      *ON           *IN74
     C                   ENDIF
     C                   MOVE      PKHENV        KHENV
     C                   ENDIF
      *
     C     WPROG         WHENEQ    'VR914'
     C                   CALL      'VR914'                                      <Søk på koder
     C                   PARM      KUNDGR        PKUNDG
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      *BLANKS       WPNONE
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
     C                   MOVE      *ON           *IN73
     C                   MOVE      *OFF          *IN74
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN73
     C                   MOVE      *ON           *IN74
     C                   ENDIF
     C                   MOVE      PKUNDG        KUNDGR
     C                   ENDIF
      *
     C     WPROG         WHENEQ    'VR920'
     C                   CALL      'VR920'
     C                   PARM      *BLANKS       PSONAV
     C                   PARM      KUNDNR        PKUNDN
     C                   PARM      VADRKU        PVADRN
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      *BLANKS       WPNONE
     C                   PARM      'V'           WPTSOK
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
     C                   MOVE      *ON           *IN78
     C                   MOVE      *OFF          *IN70
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN78
     C                   MOVE      *ON           *IN70
     C                   ENDIF
     C                   MOVEL     PVADRN        VADRKU
     C                   ENDIF
      *
     C     WPROG         WHENEQ    'VR925'
     C                   CALL      'VR925'
     C                   PARM      RETYKU        PRETYL            5
     C                   PARM      A             A
     C                   PARM      B             B
     C                   PARM      *BLANKS       HLPI12
     C                   PARM      *BLANKS       WPNONE
     C                   PARM      *BLANKS       WPNY              1
     C                   PARM      '52'          FORMAT            2
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
     C                   MOVE      *ON           *IN79
     C                   MOVE      *OFF          *IN71
     C     HLPI12        IFNE      '1'
     C     WPNONE        IFNE      '1'
     C                   MOVE      *OFF          *IN79
     C                   MOVE      *ON           *IN71
     C                   ENDIF
     C                   MOVEL     PRETYL        RETYKU
     C                   ENDIF
      *
E24  C     WPROG         WHENEQ    'VR928'
NYTT  *
CALL  *
N24  C                   CALL      'VR928'                                      <SøkPris/Rabgrupper
N24  C                   PARM      PRIKKU        PPRIKU            2
N24  C                   PARM      A             A                 2 0
N24  C                   PARM      B             B                 3 0
N24  C                   PARM      *BLANKS       HLPI12
N24  C                   PARM      *BLANKS       WPNONE
      *
     C     WPNONE        IFEQ      '1'
     C                   MOVE      *ON           *IN88
     C                   ENDIF
     C                   MOVE      *ON           *IN80
     C     HLPI12        IFNE      '1'
E24  C                   MOVEL     PPRIKU        PRIKKU
N24  C                   MOVE      *BLANKS       PPRIKU
     C                   ENDIF
      *
     C                   ENDSL
      *
     C                   ENDSR
      /EJECT
      /TITLE  V R 0 3 0    -  SUBR11 : MODULUS 11 SJEKK
      *
      *------------------------------------------------------------------------
      *  S U B R 1 1      MODULUS 11 SJEKK
      *------------------------------------------------------------------------
      *
     C     SUBR11        BEGSR
      * VERDIEN MÅ VÆRE LAGT I DEN ALFANUMERISKE TABELLEN MO1
      * REDIGERER FØRST DET ALFANUMERISKE FELTET
      * HØYRESTILLER OG BLANKER
E55  C                   Z-ADD     35            X                 3 0
     C                   Z-ADD     15            Y                 3 0
N55  C                   CLEAR                   MO1
     C     X             DOWGT     *ZEROS
N55  C     Y             ANDGT     *ZEROS
E55  C     MO35(X)       IFGE      '0'
E55  C     MO35(X)       ANDLE     '9'
E55  C                   MOVE      MO35(X)       MO1(Y)
     C                   SUB       1             Y
     C                   ENDIF                                                  <MO1,X
     C                   SUB       1             X
     C                   ENDDO                                                  <X
      * MÅ VÆRE 11 SIFFER
     C     Y             IFEQ      4
     C                   MOVE      *OFF          *IN78
     C                   ELSE                                                   <Y
     C                   MOVE      *ON           *IN78
     C                   GOTO      XSUB11
     C                   ENDIF                                                  <Y
      * LEGGER BLANKE I RESTEN AV POSISJONENE
     C     Y             DOWGT     *ZEROS
     C                   MOVE      *BLANK        MO1(Y)
     C                   SUB       1             Y
     C                   ENDDO                                                  <Y
      * TAR VARE PÅ DET OPPGITTE KONTROLLSIFFER
     C                   MOVE      MO1(15)       OPPKON            1 0
      * FJERNER DET OPPGITTE KONTROLLSIFFER I TABELLEN
     C                   MOVEA     MO1           ALFA             15
     C                   MOVE      ALFA          NUMMER           15 0
     C     NUMMER        DIV       10            NUMMER
      * LEGGER I TABELL FOR BEREGNING AV TVERRSUM
     C                   MOVE      NUMMER        ALFA
     C                   MOVEA     ALFA          MO1
      * FINNER VEKTTALL FOR HVER ENKELT POSISJON
     C                   Z-ADD     15            X
     C     X             DOWGT     *ZEROS
     C                   SELECT
     C     X             WHENEQ    15
     C     X             OREQ      9
     C     X             OREQ      3
     C                   Z-ADD     2             VEKT              1 0
     C     X             WHENEQ    14
     C     X             OREQ      8
     C     X             OREQ      2
     C                   Z-ADD     3             VEKT
     C     X             WHENEQ    13
     C     X             OREQ      7
     C     X             OREQ      1
     C                   Z-ADD     4             VEKT
     C     X             WHENEQ    12
     C     X             OREQ      6
     C                   Z-ADD     5             VEKT
     C     X             WHENEQ    11
     C     X             OREQ      5
     C                   Z-ADD     6             VEKT
     C     X             WHENEQ    10
     C     X             OREQ      4
     C                   Z-ADD     7             VEKT
     C                   ENDSL
      * BEREGNER SUM
     C                   MOVE      MO1(X)        VERDI             1 0
     C     VERDI         MULT      VEKT          MO2(X)
     C                   SUB       1             X
     C                   ENDDO                                                  <X
      * BEREGNER TVERRSUM
     C                   XFOOT     MO2           PRODUK            5 0
      * TVERRSUM PLUSS OPPGITT KONTROLLSIFFER
      * DIVIDERT PÅ 11. REST SKAL VÆRE 0.
     C     PRODUK        ADD       OPPKON        PRODUK
     C     PRODUK        DIV       11            PRODUK
     C                   MVR                     PRODUK
      * *IN43 BLIR SATT PÅ HVIS IKKE TALLET TILFREDSTILLER MODULUS 11
     C     PRODUK        IFNE      *ZEROS
     C                   MOVE      *ON           *IN79
     C                   ELSE                                                   <PRODUK
     C                   MOVE      *OFF          *IN79
     C                   ENDIF                                                  <PRODUK
     C     XSUB11        ENDSR
      /EJECT
      *----------------------------------------------------------------
      * Subrutine som kaller pgm. for bygging av data til kassene
      *----------------------------------------------------------------
     C     SUBR12        BEGSR
      *
     C     POKOD         IFEQ      'J'
     C                   MOVE      'B'           PRTYPE
     C                   MOVEL     KUNDNR        PRDATA
     C                   CALL      'PR500'       PARM2                  91
     C                   ENDIF                                                  <POKOD
      *
     C                   ENDSR
N50   *----------------------------------------------------------------
N50   * Subrutine som kaller pgm. for vedlikehold av URL-adresse
N50   *----------------------------------------------------------------
N50  C     SUBR13        BEGSR
N50
N50  C                   EVAL      P_FIRMA = WFIRMA
N50  C                   EVAL      P_URLTYP = '2'
N50  C                   EVAL      P_RESKNR = KUNDNR
N50  C                   CALL      'VR070'       VR070P
N50
N50  C                   ENDSR
N50   *----------------------------------------------------------------
N50   * Subrutine som vedlikeholder E-postadr. i filen KORTF
N50   *----------------------------------------------------------------
N50  C     SUBR14        BEGSR
E50P  * Hent gjeldende E-postadresser og EAN-nr.
N50  C                   IF        W_EPOST = 'H'
N50  C     KEYA          CHAIN(N)  KORTR
N50
N50  C                   IF        NOT %FOUND
N50  C                   EVAL      EMNRKO = *BLANKS
N50  C                   EVAL      EPOAKO = *BLANKS
N50  C                   EVAL      WD_EMNRKO = *BLANKS
N50  C                   EVAL      WD_EPOAKO = *BLANKS
N50  C                   ELSE                                                   <NOT %FOUND
N50  C                   EVAL      WD_EMNRKO = EMNRKO
N50  C                   EVAL      WD_EPOAKO = EPOAKO
N50  C                   ENDIF                                                  <NOT %FOUND
N50
N50   * Legg inn standardverdier ved nyregistrering
N50
S55   *                  IF            VALG = 'N'
S55   *                  IF        WS_EMNRKO <> *BLANKS
S55   *                  EVAL      WD_EMNRKO = WS_EMNRKO
S55   *                  ENDIF                                                  <WS_EMNRKO
S55   *                  IF        WS_EPOAKO <> *BLANKS
S55   *                  EVAL      WD_EPOAKO = WS_EPOAKO
S55   *                  ENDIF                                                  <WS_EPOAKO
S55   *                  ENDIF                                                  <VALG
N50
N50  C                   ENDIF                                                  <W_EPOST
N50   * Oppdater ved ny/endring
N50  C                   IF        W_EPOST = 'O'
N50  C     KEYA          CHAIN     KORTR
N50
N50  C                   IF        NOT %FOUND
N50
N50  C                   IF           WD_EMNRKO <> *BLANKS
N50  C                             OR WD_EPOAKO <> *BLANKS
N50  C                   CLEAR                   KORTR
N50  C                   EVAL      FIRMKO = FIRMA
N50  C                   EVAL      KUNRKO = KUNDNR
N50  C                   EVAL      EMNRKO = WD_EMNRKO
N50  C                   EVAL      EPOAKO = WD_EPOAKO
N50  C                   WRITE     KORTR
N50  C                   ENDIF                                                  <WD_EMNRKO...
N50
N50  C                   ELSE                                                   <NOT %FOUND
N50
N50  C                   EVAL      EMNRKO = WD_EMNRKO
N50  C                   EVAL      EPOAKO = WD_EPOAKO
N50  C                   EXCEPT    KORTUPD
N50  C                   ENDIF                                                  <NOT %FOUND
N50
N50  C                   ENDIF                                                  <W_EPOST
N50   * Sletting
N50  C                   IF        W_EPOST = 'S'
N50  C     KEYA          CHAIN     KORTR
E50P  * Sletter kundeposten
N50  C                   IF        %FOUND
N50  C                   DELETE    KORTR
N50  C                   ENDIF                                                  <NOT %FOUND
N50P  * Sletter alle kortnummer på dette kundenr.
N50P C                   EVAL      *IN50 = *OFF
N50P C     KEYA          SETLL     KORT01
N50P
N50P C                   DOW       *IN50 = *OFF
N50P C     KEYA          READE     KORT01                                 50
N50P
N50P C                   IF        *IN50 = *OFF
N50P C                   DELETE    KORT01
N50P C                   ENDIF                                                  <*IN50
N50P
N50P C                   ENDDO                                                  <*IN50
N50
N50  C                   ENDIF                                                  <W_EPOST
N50
N50  C                   ENDSR
N50   *----------------------------------------------------------------
N50   * Subrutine for å forespørrse på kortfilen (F24)
N50   *----------------------------------------------------------------
N50  C     SUBR15        BEGSR
N50
N50  C                   EVAL      W_KUNDNR = KUNDNR
N50  C                   CALL      'VR970'
E50P C                   PARM      'V'           WPTSOK
N50  C     W_KUNDNR      PARM      W_KUNDNR      W_KUNDNR
N50  C                   PARM      1             A                              LINJE
N50  C                   PARM      3             B                              POS
N50  C     HLPI12        PARM      *OFF          HLPI12
N50  C     WPNONE        PARM      *OFF          WPNONE
N50  C                   PARM      *ZEROS        W_KORTN
N50  C                   PARM      *BLANKS       W_NAVN
N50
N50  C                   ENDSR
N50P  *----------------------------------------------------------------
N50P  * Kontroll av postnummer
N50P  *----------------------------------------------------------------
N50P C     SUBR16        BEGSR
N50P
N50P C                   EVAL      P8_POSTNR = *ZEROS
N50P C                   EVAL      P8_PONRPB = *BLANKS
N50P
N50P C                   IF        POSTNR <> *ZEROS
N50P C                   EVAL      P8_BEHKDE = '1'
N50P C                   EVAL      P8_POSTNR = POSTNR
N50P C                   CALL      'VR841'       VR841P
N50P
N50P C                   IF        P8_RETKDE = 'A'
N50P C                   EVAL      *IN81 = *ON
N50P C                   ENDIF                                                  <P8_RETKDE
N50P
N50P C                   ENDIF                                                  <POSTNR
N50P
N50P C                   IF        PNPBKU <> *BLANKS
N50P C                   EVAL      P8_BEHKDE = '1'
N50P C                   EVAL      P8_PONRPB = PNPBKU
N50P C                   CALL      'VR841'       VR841P
N50P
N50P C                   IF        P8_RETKDE = 'A'
N50P C                   EVAL      *IN89 = *ON
N50P C                   ELSE                                                   <P8_RETKDE
N50P C                   EVAL      *IN89 = *OFF
N50P C                   ENDIF                                                  <P8_RETKDE
N50P
N50P C                   ENDIF                                                  <PNPBKU
N50P
N50P C                   ENDSR
N55   /EJECT
N55   *----------------------------------------------------------------
N55   * Subrutine for å vedlikeholde kortfilen (F24)
N55   *----------------------------------------------------------------
N55  C     SUBR17        BEGSR
N55
N55  C                   EVAL      LD_BEHKD  = 'D'
N55  C                   EVAL      LD_RESKNR = KUNDNR
N55  C                   EVAL      LD_NAVN   = *BLANKS
N55  C                   OUT       DATA1
N55  C                   CALL      'VR090'
N55  C                   EVAL      W_VR090   = '1'
N55  C                   EVAL      LD_BEHKD  = *BLANKS
N55  C                   EVAL      LD_RESKNR = *ZEROS
N55
N55  C                   ENDSR
N55   /EJECT
N55   *----------------------------------------------------------------
N55   * Subrutine for å overføre kunde til POS
N55   *----------------------------------------------------------------
N55  C     SUBR18        BEGSR
N55
N55   * Les masterkasser/MBOer (omit på LF)
N55  C     WFIRMA        SETLL     PKASR
N55  C     WFIRMA        READE     PKASR
N55  C                   DOW       NOT %EOF
N55
N55  C                   IF        PA_AKTKPA = 'A'
N55
N55  C                   IF        PA_KASYPA = 'I'                              INFO-POS
N55
N55   * Assign datakø-variabler
N55  C                   EVAL      WQSNAVN   = 'KUNDF_' + WFKODE + WFIRMA       DATAKØ-NAVN
N55  C                   EVAL      WQSFIL    = 'KUNDF'                          FILNAVN
N55  C                   EVAL      WQSDTALIB = '*LIBL'                          BIBLIOTEK (TIL FIL)
N55  C                   EVAL      WQSFKODE  = WFKODE                           FIRMAKODE
N55  C                   EVAL      WQSFIRMA  = WFIRMA                           FIRMA
N55  C                   EVAL      WQSEVENT  = '3'                              = UPDATE
N55  C                   EVAL      WQSBASE   = 'A'                              = ALLE POSTER
N55P C                   EVAL      WQSOPPDAT = 'J'                              = NY TIMESTAMP
N55
N55   * Assign data-felter til datakø
N55  C                   EVAL      WQSKEY    = %EDITC(KUNDNR:'X')               KUNDER
N55
N55  C                   CALL      'QSNDDTAQ'                           99
N55  C                   PARM                    WQSNAVN
N55  C                   PARM                    WQSLIB
N55  C                   PARM                    WQSLEN
N55  C                   PARM                    WQSFELT

      * InfoPos trenger bare 1 entry pr. kunde
     C                   LEAVESR
N55
N55  C                   ELSE
N55
N55   * Sjekk om ikke varen allerede er klar for overføring
N55  C     K_PKUN        SETLL     PKUNR
N55  C                   IF        NOT %EQUAL                                   ER IKKE FRA FØR
N55  C                   EVAL      BK_AKTKOD = 'A'
N55  C                   EVAL      BK_FIRMA  = WFIRMA
N55  C                   EVAL      BK_BUTNR  = PA_BUTNPA
N55  C                   EVAL      BK_KASNR  = PA_KASNPA
N55  C                   EVAL      BK_KUNDNR = KUNDNR
N55  C                   WRITE     PKUNR
N55  C                   ENDIF                                                  <NOT %EQUAL
N55
N55  C                   ENDIF                                                  <PA_KASYPA
N55
N55  C                   ENDIF                                                  <PA_AKTKPA
N55
N55  C     WFIRMA        READE     PKASR
N55  C                   ENDDO                                                  <NOT %EOF
N55
N55  C                   ENDSR
N55P  ********************************************************************
N55P  * Subrutine som henter opplysninger fra statistikkfilen kunde
N55P  ********************************************************************
N55P C     VIS_KUNSF     BEGSR
N55P  * Forrige år
N55P C                   EVAL      W_NRAAR = NRAAR - 1
N55P C     KSTKEY        CHAIN     KUNSR
N55P
N55P C                   IF        %FOUND
N55P C                   Z-ADD     KUTSK         KUTSKF
N55P C                   Z-ADD     FAIAAR        FAIFJ
N55P C                   Z-ADD     KJIAAR        KJIFJ
N55P C                   Z-ADD     FOIAAR        FOIFJ
N55P C                   Z-ADD     REIAAR        REIFJ
N55P C                   Z-ADD     RAIAAR        RAIFJ
N55P C                   Z-ADD     BONGRL        BGRIKU
N55P C                   Z-ADD     BONOPT        BOIFKU
N55P C                   Z-ADD     AOIAAR        AOIFJ
N55P C                   ELSE                                                   <%FOUND
N55P C                   CLEAR                   KUTSKF
N55P C                   CLEAR                   FAIFJ
N55P C                   CLEAR                   KJIFJ
N55P C                   CLEAR                   FOIFJ
N55P C                   CLEAR                   REIFJ
N55P C                   CLEAR                   RAIFJ
N55P C                   CLEAR                   BGRIKU
N55P C                   CLEAR                   BOIFKU
N55P C                   CLEAR                   AOIFJ
N55P C                   ENDIF                                                  <%FOUND
N55P  * Nåværende år
N55P C                   EVAL      W_NRAAR = NRAAR
N55P C     KSTKEY        CHAIN     KUNSR
N55P
N55P C                   IF        NOT %FOUND
N55P C                   CLEAR                   KUTSK
N55P C                   CLEAR                   FAIAAR
N55P C                   CLEAR                   KJIAAR
N55P C                   CLEAR                   FOIAAR
N55P C                   CLEAR                   REIAAR
N55P C                   CLEAR                   RAIAAR
N55P C                   CLEAR                   BONGRL
N55P C                   CLEAR                   BONOPT
N55P C                   CLEAR                   AOIAAR
N55P C                   ENDIF                                                  <%FOUND
N55P
N55P C                   ENDSR
      /EJECT
      *----------------------------------------------------------------***
      * F E I L S R
      * Subrutine som rydder opp etter en feil i forb. med et skjermbilde
      *----------------------------------------------------------------***
     C     FEILSR        BEGSR
      ****
      * Skriver feillogg
      ****
     C                   OPEN      FEILLOGG
     C                   WRITE     FEIL
     C                   CLOSE     FEILLOGG
      ****
      * Lukker ordinær printerfile hvis den har vært åpnet
      ****
E55P C     W_IN26        IFEQ      *ON
     C     HLPJNR        ANDNE     *ZEROS
     C                   CLOSE     VR030U01
     C                   ENDIF
      ****
      * Lukker programkontrollerte filer og tar SIGNOFF
      ****
     C                   MOVE      *ON           *INLR
     C                   Z-ADD     15            LEN              15 5
     C                   MOVEL     ARRC(1)       KOMM             60
     C                   CALL      'QCMDEXC'
     C                   PARM                    KOMM
     C                   PARM                    LEN
      *
     C                   ENDSR
N55   /EJECT
N55   *----------------------------------------------------------------***
N55   * *INZSR
N55   * Initiell sibrutine, defineringer og startverdier
N55   * NB! All defineringer som før lå først i pgm er flyttet hit.
N55   *----------------------------------------------------------------***
N55  C     *INZSR        BEGSR
N55   /EJECT
N55   *----------------------------------------------------------------
N55   *  KEY LISTS
N55   *----------------------------------------------------------------
N55  C     KEYA          KLIST                                                  <KUNDL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    KUNDNR
N55  C     KEYB          KLIST                                                  <KUNDL02
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    SONAVN
N55  C     KEYC          KLIST                                                  <KUNDL03
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    TLF
N55  C     KEYD          KLIST                                                  <LEVEL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    LEVNR
N55  C     KEYF          KLIST                                                  <SYSBL01
N55  C                   KFLD                    FIRMA
N55  C     KEYG          KLIST                                                  <SYSRL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    REGNAV
N55  C     KEYH          KLIST                                                  <KODAL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    BETBET
N55  C     KEYI          KLIST                                                  <KODDL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    DISTR
N55  C     KEYJ          KLIST                                                  <KHEDL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    RECTYP
N55  C                   KFLD                    KHENV
N55  C     KEYK          KLIST                                                  <KHEAL02
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    AVG
N55  C     KEYL          KLIST                                                  <KODSL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    SPEDNR
N55  C     KEYLU         KLIST                                                  <KODSL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    SPEDNU
N55  C     KEYM          KLIST                                                  <VALUL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    VALKOD
N55  C     KEYN          KLIST                                                  <KODKL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    KUNDGR
N55  C     KEYO          KLIST                                                  <KODLL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    LAGNR
N55  C     KEYP          KLIST                                                  <KODML01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    LEVBET
N55  C     KEYPT         KLIST                                                  <KODTL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    KODEEV
N55  C     KEYQ          KLIST                                                  <KODNL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    LEVMAT
N55  C     KEYR          KLIST                                                  <KODRL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    RUTENR
N55  C     KEYS          KLIST                                                  <KODUL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    SELGER
N55  C     KEYT          KLIST                                                  <ESTYL00
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    ESPTYP
N55  C                   KFLD                    KUNDNR
N55  C                   KFLD                    ESDKID
N55  C                   KFLD                    ESDKSM
N55  C     KEYKOM        KLIST                                                  <NOTAL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    OTBKOD
N55  C                   KFLD                    RESNR
N55  C     KEYU          KLIST                                                  <KODEL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    LAND
N55  C     KEYV          KLIST                                                  <VADRL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    KUNDNR
N55  C                   KFLD                    VADRKU
N55  C     KEYW          KLIST                                                  <KODQL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    RETYKU
N55  C     KEYX          KLIST                                                  <KODYL01
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    PRIKKU
N55  C     KEYY          KLIST                                                  <KUNDL08
N55  C                   KFLD                    FIRMA
N55  C                   KFLD                    POSTNR
N55  C     K_PKUN        KLIST                                                  <PKUNL01
N55  C                   KFLD                    WFIRMA
N55  C                   KFLD                    PA_BUTNPA
N55  C                   KFLD                    PA_KASNPA
N55  C                   KFLD                    KUNDNR
N55P  * Statistikkfil kunde
N55P C     KSTKEY        KLIST
N55P C                   KFLD                    WFIRMA
N55P C                   KFLD                    W_NRAAR
N55P C                   KFLD                    KUNDNR
N55   /EJECT
N55   *----------------------------------------------------------------
N55   *   DEFINERING AV PARAMETERLISTER
N55   *----------------------------------------------------------------
N55  C     PARM2         PLIST
N55  C                   PARM                    PR500
N55  C     VR070P        PLIST
N55  C                   PARM                    VR070DS
N55  C     VR841P        PLIST
N55  C                   PARM                    VR841DS
N55   /EJECT
N55   *----------------------------------------------------------------
N55   *   DEFINERING OG FLYTTING TIL HJELPEFELTER
N55   *----------------------------------------------------------------
N55  C     *LIKE         DEFINE    AKTKOD        HLPAKO
N55  C     *LIKE         DEFINE    LAND          PLAND
N55  C     *LIKE         DEFINE    VALKOD        PVALKO
N55  C     *LIKE         DEFINE    KUNDNR        PKUNDN
N55  C     *LIKE         DEFINE    KUNDNR        SOKNR
N55  C     *LIKE         DEFINE    BETBET        PBETBE
N55  C     *LIKE         DEFINE    AVG1          PAVG
N55  C     *LIKE         DEFINE    LEVNR         PLEVNR
N55  C     *LIKE         DEFINE    KHENV         PKHENV
N55  C     *LIKE         DEFINE    KUNDGR        PKUNDG
N55  C     *LIKE         DEFINE    VAVGKA        PKODE
N55  C     *LIKE         DEFINE    SPEDNR        PSPEDN
N55  C     *LIKE         DEFINE    SONAVN        PSONAV
N55  C     *LIKE         DEFINE    VADRNR        PVADRN
N55  C     *LIKE         DEFINE    KODEEV        XKOEEV
N55  C     *LIKE         DEFINE    EHANKU        XEHANK
N55  C     *LIKE         DEFINE    EHOTKU        XEHOTK
N55  C                   CLEAR                   DSSFKU
N55  C     *DTAARA       DEFINE    *LDA          DATA1
N55  C     *DTAARA       DEFINE                  DATA2
N55  C                   CLEAR                   DATA3
N55  C                   CLEAR                   WS_EMNRKO
N55  C                   CLEAR                   WS_EPOAKO
N55  C                   MOVE      WFIRMA        FIRMA
N55  C                   MOVEL     'KUNDF'       REGNAV
N55  C                   CLEAR                   SISFAK
N55  C                   CLEAR                   DATOO
N55  C                   CLEAR                   KGRDAT
N55  C                   MOVE      *ON           *IN92
S55   *                  MOVE      'E'           VALG
N55  C     WDATOF        IFEQ      1
N55  C                   MOVE      *ON           *IN97                          <ÅÅMMDD
N55  C                   ENDIF
N55  C                   MOVE      *BLANKS       WPTSOK            1
N55  C                   MOVE      *BLANKS       WPRECT            1
N55  C                   MOVE      '0'           HLPI12            1
N55  C                   MOVE      *BLANKS       FIL               1
N55  C                   MOVE      *BLANKS       WALFSO            3
N55  C                   MOVE      *BLANKS       WPNONE            1
N55  C                   MOVE      *BLANKS       WPROG             5
N55  C                   MOVE      *ZEROS        A                 2 0
N55  C                   MOVE      *ZEROS        B                 3 0
N55  C                   MOVE      *ZEROS        WNUMSO            4 0
N55  C                   CLEAR                   KUNDNR
N55   *----------------------------------------------------------------
N55   *  HENTE INN FIRMAOPPLYSNINGER
N55   *----------------------------------------------------------------
N55  C     KEYF          CHAIN     SYSOR
N55  C                   IF        NOT %FOUND
N55  C                   EVAL      LALOSO = *BLANKS
N55  C                   ENDIF
N55  C     KEYF          CHAIN     SYSBL01                            52
N55  C     *IN52         IFEQ      *OFF
N55  C     SISKNR        IFEQ      99999999
N55  C                   MOVE      *ON           *IN99
N55  C                   ENDIF
N55  C                   EXCEPT    SYUTB
N55  C                   ENDIF
N55
N55  C     KEYF          CHAIN     SYSDR
N55  C                   IF        NOT %FOUND
N55  C                   EVAL      SD_PURGEB = *BLANKS
N55  C                   ENDIF
N55
N55  C                   ENDSR
      *                                                                ***
      /EJECT
     OKUNDR     E            KUNDA
     OSYSBR     E            SYUTB
     OSYSRR     E            SYUTR
N50
N50  OKORTR     E            KORTUPD
N50  O                       EMNRKO
N50  O                       EPOAKO
      /EJECT
      *
**  COPYRIGHT LOAD
CALL PGM(VC006)
5797-AWH IBM NORWAY 1988  5797-AWD COPYRIGHT IBM CORP. 1988
**  Tekster
Forrige kunde ble forsøkt registrert med nummer
Forrige kunde ble registrert med kundenummer
