/* *********************************************************************   */
/*       * RETTINGER I DETTE PROGRAM:                                      */
/* PTFnr:*Sek Sig Vers  Beskrivelse..........................              */
/* """"""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""    */
/* 12XXX * 01 YBC PTF12 LAG EHF PÅ FAKTURA SOM VAR LAGET FØR EHF-SETTING   */
/* ********************************************************************    */
             PGM
             DCL        VAR(&IN01) TYPE(*LGL) LEN(1) VALUE('0') /* +
                          Hvis &in01 på, AVBRYT PROGRAM               -
        */
             DCL        VAR(&P1) TYPE(*CHAR) LEN(2) VALUE('00')
             DCL        VAR(&P1E) TYPE(*CHAR) LEN(2) VALUE('00')
             DCL        VAR(&P1S) TYPE(*CHAR) LEN(2) VALUE('00')
             DCL        VAR(&P2) TYPE(*CHAR) LEN(1) VALUE('N')
             DCL        VAR(&P3) TYPE(*LGL) LEN(1) VALUE('0')
             DCL        VAR(&P4) TYPE(*LGL) LEN(1) VALUE('0')
             DCL        VAR(&P5) TYPE(*LGL) LEN(1) VALUE('0')
             DCL        VAR(&P6) TYPE(*LGL) LEN(1) VALUE('0')
             DCL        VAR(&P7) TYPE(*CHAR) LEN(1) VALUE('J')
             DCL        VAR(&P8) TYPE(*CHAR) LEN(1) VALUE('N')
             DCL        VAR(&P9) TYPE(*CHAR) LEN(1)
             DCL        VAR(&PRT) TYPE(*CHAR) LEN(10) /* Printernavn +
                          til fakturaer. */
             DCL        VAR(&PT) TYPE(*CHAR) LEN(10) /* Papirtype til +
                          fakturaer. */
             DCL        VAR(&UNIK) TYPE(*CHAR) LEN(7) /* Unikkode +
                          til register SORT. */
             DCL        VAR(&TIME) TYPE(*CHAR) LEN(6)
             DCL        VAR(&LIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&LPI) TYPE(*DEC) LEN(2 0) VALUE(06)
             DCL        VAR(&LPP) TYPE(*DEC) LEN(3 0) VALUE(70)
    /* */
    /* */
    /* HENTE AVDELING, SIGNATUR OG FIRMAKODE */
    /* */
             CALL       PGM(SYFA00) PARM(&IN01)
             IF         COND(&IN01 = '1') THEN(GOTO CMDLBL(SLUTT)) /* +
                          Hvis &IN01 på, avslutter program. */
    /* */
    /* HENTE OPPLYSNINGER OM HVA SLAGS UTSKRIFT MAN ØNSKER */
    /*    FOR Å HENTE TURNR               */
             CALL       PGM(SYFABK) PARM(&IN01 &P3)
             IF         COND(&IN01 = '1') THEN(GOTO CMDLBL(SLUTT)) /* +
                          Hvis &IN01 på, avslutter program. */

    /* */
    /* SKRIVER UT FAKTURAKOPI             */
    /*                                    */
             RTVDTAARA  DTAARA(*LDA (681 10)) RTNVAR(&PRT)
             RTVDTAARA  DTAARA(*LDA (691 10)) RTNVAR(&PT)
    /* */
             OVRPRTF    FILE(SYFA20P) DEVTYPE(*SCS) PAGESIZE(&LPP +
                          80) LPI(&LPI) CPI(10) OVRFLW(&LPP) +
                          OUTQ(&PRT) FORMTYPE(&PT) HOLD(*YES)
    /* */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&TIME)
    /*                                    */
             CHGVAR     VAR(&UNIK) VALUE('W' *CAT &TIME)
    /*                                    */
/* SORT OGSÅ I LØSNING 1 - INLIBL FOR Å SIKRE SORT I RIKTIG BIBL.*/
             RTVDTAARA  DTAARA(FIRMDT (141 10)) RTNVAR(&LIB)
             OVRDBF     FILE(SORT) TOFILE(&LIB/SORT)

             RMVM       FILE(SORT) MBR(&UNIK)
             MONMSG     MSGID(CPF7310)
             ADDPFM     FILE(SORT) MBR(&UNIK)
             OVRDBF     FILE(SORT) TOFILE(SORT) MBR(&UNIK)
    /* */
    /*                                    */
    /* */
/*S01        CALL       PGM(SYBO22) PARM(&P3) */
/*N01*/      CALL       PGM(SYBO22) PARM(&P3 &P1)
             OVRMSGF    MSGF(QUSERMSG) TOMSGF(SYMSGF)
             CALL       PGM(SYFA20) PARM(&P1 &P1E &P1S &P2 &P3 &P4 +
                          &P5 &P6 &P7)
             SNDPGMMSG  MSG(' ' *BCAT &P1 *BCAT 'fakturakopierer er +
                          klare til utskrift på printer ' *BCAT &PRT +
                          *BCAT '.') MSGTYPE(*INFO)
             RMVM       FILE(SORT) MBR(&UNIK)


             CLRPFM     FILE(PRTDOCA) MBR(&UNIK)
             MONMSG     MSGID(CPF3141) EXEC(ADDPFM FILE(PRTDOCA) +
                          MBR(&UNIK))
             OVRDBF     FILE(PRTDOCA) TOFILE(PRTDOCA) MBR(&UNIK)
             CLRPFM     FILE(PRTDOCB) MBR(&UNIK)
             MONMSG     MSGID(CPF3141) EXEC(ADDPFM FILE(PRTDOCB) +
                          MBR(&UNIK))
             OVRDBF     FILE(PRTDOCB) TOFILE(PRTDOCB) MBR(&UNIK)
    /* */
    /* KOPIER SPOOLFILE OVER I DATABASEFIL (4 FØRSTE=SKIP/SPACEINFO) */
             CPYSPLF    FILE(SYFA20P) TOFILE(PRTDOCA) +
                          SPLNBR(*LAST) TOMBR(&UNIK) CTLCHAR(*PRTCTL)
/*           DLTSPLF    FILE(SYFA20P) SPLNBR(*LAST)  */
/*           MONMSG     MSGID(CPF0000)   */
    /* SETTE INN BLANKLINJER ETTER INFO I SKIPP/SPACEB-FELT*/
             CALL       PGM(SYYA02B)
/***** VIDERE BEHANDLING AV PRTDOCB */

/*           CLRPFM     FILE(PRTDOCA) MBR(&UNIK)                */
/*           MONMSG     MSGID(CPF0000)                          */
/*           CLRPFM     FILE(PRTDOCB) MBR(&UNIK)                */
/*           MONMSG     MSGID(CPF0000)                          */
    /* */
             CHGDTAARA  DTAARA(*LDA (101 924)) VALUE(' ')
    /* */
 SLUTT:      ENDPGM
