     H DFTACTGRP(*NO)
     FECMSG     UF   E           K DISK
     FEDII      UF   E           K DISK
     FFIRM      IF   E           K DISK

     d WhereC          s            512a
     d SqlStm          s            512a
     d myrows0         s             10i 0
     d myrows          s             10i 0
     d XAPS            C                   const(X'7D')
     d X               S             10  0
      *  Prototype for V12RE111
     d v12re111        pr
      *
     d MyPoDS0         ds                  Qualified  dim(1)
     d  FIFIRM                        2A
     d MyPoDS          ds                  Qualified  dim(1000)
     d  ECFIR                         2A
     d  ECCNO                         8S 0
     d  ECIIDI                       35A
     d  ECIIDC                       35A
      /free

       exsr init;

       SqlStm = 'Select ECFIR, ECCNO, ECIIDI, ECIIDC ' +
                'from ECMSG ' +
                'Where ECFIR = ' + xaps + %trim(FIFIRM) + xaps +
                ' and ECSR = ' + xaps + 'S' + xaps +
                ' and EC0065 = ' + xaps + 'INVXML' + xaps +
                ' and EC0054 = ' + xaps + '2.0' + xaps;
       Exec SQL PREPARE DynSel from :SqlStm;
       EXEC SQL DECLARE  A33  cursor for DynSel;
       Exec SQL OPEN A33;
       Myrows = %elem(MyPoDS);
       exec sql FETCH A33   for :MyRows rows
                  INTO :MyPoDs;
       Exec SQL CLOSE A33;

       if myrows > 0;
         for x = 1 to myrows;
           if mypods(x).ecfir = *blanks;
             leave;
           endif;

           ecfir  = mypods(x).ecfir;
           eccno  = mypods(x).eccno;
           eciidi = mypods(x).eciidi;
           eciidc = mypods(x).eciidc;

           if eciidc <> *blanks;
             exec sql
             delete from ecmsg
             where ecfir = :ecfir and eccno = :eccno and ecsr = 'S'
               and eciidi = :eciidi and eciidc = :eciidc and ec0065 = 'INVXML'
             with NC;

             exec sql
             delete from edii
             where inid = :eciidc and innetw = 'A' and inex = 'E'
             with NC;
           endif;

         endfor;
       endif;

       *inlr = *on;
       return;

      //***********************************************
       begsr init;
      //***********************************************

       SqlStm = 'Select * ' +
                'from FIRM ' +
                'FOR READ ONLY ';
       Exec SQL PREPARE DynSel0 from :SqlStm;
       EXEC SQL DECLARE  A30  cursor for DynSel0;
       Exec SQL OPEN A30;
       Myrows0 = %elem(MyPoDS0);
       exec sql FETCH A30   for :MyRows0 rows
                  INTO :MyPoDs0;
       Exec SQL CLOSE A30;
       FIFIRM = mypods0(1).fifirm;

       endsr;

      /end-free
