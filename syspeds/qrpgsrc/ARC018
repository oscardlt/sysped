      ***********************************************************
      *** PROGRAM for SENDE TRANSPORTØRAVREGNING PÅ MAIL
      ***********************************************************
     FARUSERL1  IF   E           K DISK
     FTRAVH3    IF   E           K DISK
     FTRAVV6    IF   E           K DISK
     Fcundl01   IF   E           K DISK
     FFIRM      IF   E           K DISK
     FARKEPO    UF A E           K DISK
     FARKTXT    IF   E           K DISK
     FCUNDC03   IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FARKIVL06  IF   E           K DISK
     D                SDS
     D  UUSR                 254    263
     D                 DS
     D  FADATO                 1      8  0
     D  FAAA                   3      4
     D  FAMM                   5      6
     D  FADG                   7      8
     D trykka          C                   CONST('Trykk på link for å -
     D                                     se på avregning')
      *
     c                   exsr      init
      *
     C     *ENTRY        PLIST
     c                   parm                    ufirma            2
     c                   parm                    utype             2
     c                   parm                    urunde           10
      *
     c     key           klist
     c                   kfld                    firma             2
     c                   kfld                    type              2
     c                   kfld                    runde            10
      *
     c                   move      ufirma        firma
     c                   move      utype         type
     c                   move      urunde        runde
     C*
     C     KEY           CHAIN     ARKIVL06                           33
      *
      *transportøravregning
     c  N33              DO
     c                   exsr      pdftran
     c                   end
     c                   seton                                        lr
     c                   return
      *
     C***********************************************
     C     PDFTRAN       BEGSR
     C***********************************************
     C*
     C     TRH3KE        KLIST
     C                   KFLD                    XXST              1
     C                   KFLD                    NFAK
     C*
     C     TRV6KE        KLIST
     C                   KFLD                    NFAK
     C*
     C                   MOVE      'F'           XXST
     C                   z-add     0             ntrans            8 0
     c                   move      *zeros        traavd            4
      *
      *
     c     artype        chain     ARKTXT                             33
      *
     C  N33ARKJN         IFEQ      'J'
     C                   MOVEL     ARUNDE        AFAK              7
     C                   MOVEL     ARUNDE        NFAK              7 0
     c                   move      ardate        fadato
     c                   move      'N'           finsspe           1
     C     TRH3KE        CHAIN     TRAVH3                             72
     C  N72              z-add     thtnr         ntrans            8 0
     c  N72              move      thtavd        traavd            4
     C   72              MOVE      'O'           XXST
     C   72TRH3KE        CHAIN     TRAVH3                             72
     C  N72              z-add     thtnr         ntrans
     c  N72              move      thtavd        traavd
     C     *IN(72)       IFEQ      '1'
     C     TRV6KE        CHAIN     TRAVV6                             72
     C  N72              Z-ADD     TVTUNR        NTRANS
     C  N72              move      TVoavd        traavd
     C                   END
      *
     C                   EXSR      GENBANE
      *
      * skal kunde ha mail
      *
     c                   z-add     arkund        tuknt             8 0
     C     ARKSND        IFEQ      'J'
     C                   MOVE      ARTXT         MAIL16           16
     C                   MOVEL     '*'           MAIL16
     c                   movel     MAIL16        mail30           30
     c                   moveL     artxt         wstex1           30
     c     mailk         setll     cundc03
     c     *in(33)       doweq     '0'
     c     mailk         reade     cundc03                                33
     c     *in(33)       ifeq      '0'
      *
     c* slett eventuellt gamle poster
     c                   exsr      delark
     c                   move      *blanks       wstex2           60
     C                   movel     'Fakt:'       wstex2
     C     wstex2        CAT       afak:1        wstex2
     C     wstex2        CAT       'dato:':1     wstex2
     C     wstex2        CAT       fadg:1        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       famm:0        wstex2
     C     wstex2        CAT       '.':0         wstex2
     C     wstex2        CAT       faaa:0        wstex2
     c     faktkk        CHAIN     CUNDL01                            33
     C  N33wstex2        cat       'Til:':1      wstex2
     C  N33wstex2        cat       knavn:1       wstex2
     c                   move      *blanks       epuser
     c                   movel     uusr          epuser
     c                   movel     uhttpi        eplink
     c                   movel     uhttpe        epline
      * skjekk om mailbruker  er intern
     C                   MOVE      'E'           inteks
     C     CEMAIL        CHAIN     ARUSERL1                           33
     C  N33arinek        ifeq      'I'
     C                   MOVE      'I'           inteks
     c                   end
     C                   move      *blanks       wscvp1
     C                   movel     'Transportøra'wscv24           24
     C                   move      'vregning fra'wscv24           24
     c                   movel     wscv24        wscvp1
     C     wscvp1        cat       fift:1        wscvp1
     c                   movel     trykka        wscvp2
     c                   moveL     wstex1        eptex1
     c                   move      wstex2        eptex2
     c                   write     arkepor
     c                   call      'ARC009CL'
     c                   parm                    CEMAIL
     c                   parm                    wscvp1           40
     c                   parm                    wscvp2           40
     c                   parm                    wscvp3           40
     c                   parm                    wscvp4           40
     C                   parm                    wscvp5           40
     C                   parm                    wscvp6           40
     C                   parm                    wscvp7           40
     C                   parm                    wscvp8           40
     C                   parm                    inteks            1
     c                   end
     c                   end
     c                   end
     c                   end
     C                   ENDSR
      *
     C***********************************************
     C     Init          BEGSR
     C***********************************************
      * skal Transportør ha mail
      *
     c     mailk         klist
     c                   kfld                    fifirm
     c                   kfld                    mail30
     c                   kfld                    tuknt
      *
     C*
     C     faktkk        KLIST
     C                   KFLD                    fifirm
     C                   KFLD                    TUKNT
     C*
     c                   read      firm                                   33
     c                   read      firmarc                                33
     c     *in33         ifeq      '1'
     c                   seton                                        lr
     c                   return
     c                   end
      *
      * med vennlig hilsen
      *
     c                   movel     '.'           wscvp3
     c                   movel     'Med vennlig 'wscvp4
     C     wscvp4        CAT       'hilsen':1    wscvp4
     C                   movel     fift          wscvp5
     c*
     c*
     c*
     C* lager starten på http og IFS-bane  intern ekstern
     c*
     c*
      * lager http for interne brukere
      *
      * intern
      *
     C                   move      *blanks       uhttpista        76
     c                   movel     'http://'     uhttpista
     C     uhttpista     CAT       arcpad:0      uhttpista
     C     uhttpista     CAT       '/':0         uhttpista
     C     uhttpista     CAT       arcane:0      uhttpista
     C     uhttpista     CAT       '/':0         uhttpista
      *
      * ekstern
      *
     C                   move      *blanks       uhttpesta        76
     c                   movel     'http://'     uhttpesta
     C     uhttpesta     CAT       arcpae:0      uhttpesta
     C     uhttpesta     CAT       '/':0         uhttpesta
     C     uhttpesta     CAT       arcane:0      uhttpesta
     C     uhttpesta     CAT       '/':0         uhttpesta
      *
      * lager bane til IFS
      *
     C                   movel     '/'           ubanesta         70
     C     ubanesta      CAT       arcane:0      ubanesta
     C     ubanesta      CAT       '/':0         ubanesta
     c                   endsr
     C*
     C***********************************************
     C     genbane       BEGSR
     C***********************************************
      * genererer bane for lagring
      *
      * henter  randomverdi
      *
      *
      * lager http for interne brukere
      *
     C                   move      *blanks       uhttpi
     c                   movel     uhttpista     uhttpi           76
     C     uhttpi        CAT       arlink:0      uhttpi
     C     uhttpi        CAT       '.pdf':0      uhttpi
      * lager http for interne brukere
     C                   move      *blanks       uhttpe           76
     c                   movel     uhttpesta     uhttpe
     C     uhttpe        CAT       arlink:0      uhttpe
     C     uhttpe        CAT       '.pdf':0      uhttpe
      *
      * lager bane til IFS
      *
     C                   move      *blanks       ubane            50
     C                   movel     ubanesta      ubane
     C     ubane         CAT       arlink:0      ubane
     C     ubane         CAT       '.pdf':0      ubane
     c                   endsr
     C***********************************************
     C     delark        BEGSR
     C***********************************************
     c                   move      '0'           *in(39)
     c     uusr          setll     arkepo
     c     *in(39)       doweq     '0'
     c     uusr          reade     arkepo                                 39
     c     *in(39)       ifeq      '0'
     c                   delete    arkepor
     c                   end
     c                   end
     c                   endsr
      *stykkgods fraktbrev
     C*
