********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10019 * 01 YBC PTF10 OPPDATER ETA ELLER ATA PÅ TRACKT
10XXX * 02 YBC PTF10 FEIL LENGDE PÅ WTM
10172 * 03 SH  PTF10 norsk text til Track and trace
********************************************************************
      *
      *****************************************************************
      *** PROGRAM SKAL OVERFØRE DATA FRA B/L TIL OPPDRAG            ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER          ***
      *** LEDIGE INDIKATORER 01-26                                  ***
      *** LEDIGE INDIKATORER 27-29 32-99                            ***
      *****************************************************************
      *
N01  FTRACKF    O  A E           K DISK
N01  FTRACKT    UF A E           K DISK
     FBILLOF    IF   E           K DISK
     FHEADF     UF A E           K DISK
     FVADR      IF   E           K DISK
     FBLV1      IF   E           K DISK
     FBOOKING   IF   E           K DISK
     FKODTA     IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FSYSJ50KD  CF   E             WORKSTN
     D                 DS
     D  XTIME                  1     14  0
     D  XTID                   1      6  0
     D  XDAG                   7      8  0
     D  XMND                   9     10  0
     D  XÅR                   11     14  0
     D                 DS
     D  IDAG                   1      8  0
     D  IDAGÅ                  1      4  0
     D  IDAGM                  5      6  0
     D  IDAGD                  7      8  0
N01  D                 DS
N01  D  HEGN                   1     15
N01  D  HEGN11S                5     15
     D                UDS
     D  UFIRM                  1      2
N01  D  UUSR                 301    310
     C*
     C     KEY           KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C     KEY2          KLIST
     C                   KFLD                    UAVD2
     C                   KFLD                    UOPD2
     C     BLV1K         KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    YLI
     C     KUND1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    KUNDNR
     C     VADRK         KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    KUNDNR
     C                   KFLD                    VADRNR
     C                   Z-ADD     1             VADRNR
     C     KODTAK        KLIST
     C                   KFLD                    YAUNI
     C                   KFLD                    UAVD
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD              7 0
     C                   PARM                    USG               3
     C                   PARM                    UAVD2             4 0
     C                   PARM                    UOPD2             7 0
     C*
     C                   TIME                    XTIME
     C                   MOVE      XDAG          IDAGD
     C                   MOVE      XMND          IDAGM
     C                   MOVE      XÅR           IDAGÅ
     C                   MOVE      *ZEROS        YLI               3 0
     C                   MOVE      'A'           YAUNI             1
N01  C                   MOVE      *BLANKS       HEGN
     C*
     C     KEY           CHAIN     HEADF                              31
     C  N31HEST          IFNE      ' '
     C     HEST          ANDNE     'U'
     C                   GOTO      SLUTT
     C                   END
     C  N31HEOT          IFNE      *BLANKS
     C                   MOVE      'J'           WSJN
     C                   EXFMT     WINDOW1
     C     WSJN          IFNE      'J'
     C                   GOTO      SLUTT
     C                   END
     C                   END
      *
     C     KEY           CHAIN     BILLOF                             32
     C     KEY           CHAIN     BOOKING                            32
N01   *
N01  C                   IF        HEDTOP <> BLDTA
N01  C                   EXSR      TTSR
N01  C                   END
     C*
     C   31              DO
      * UAVD2 <> 0  -->  MAN HAR TATT F16 FOR Å LAGE NESTE B/L
     C     UAVD2         IFNE      0
     C     KEY2          CHAIN(N)  HEADF                              32
     C  N32BLUR          IFEQ      'F'
     C     HEPOS2        IFEQ      *ZEROS
     C                   CALL      'SYFA10C'
     C                   PARM                    HEPOS1
     C                   ELSE
     C                   ADD       1             HEPOS2
     C                   END
     C                   END
     C                   END
     C                   MOVE      'U'           HEST
     C                   MOVE      UAVD          HEAVD
     C                   MOVE      UOPD          HEOPD
     C                   MOVE      IDAG          HEDTR
     C                   END
     C                   MOVE      USG           HESG
     C                   MOVE      BLUR          HEUR
     C     BLUR          IFEQ      'F'
     C                   MOVE      *ZEROS        HEKNT
     C                   MOVE      BLKNK         TRKNFA
     C                   ELSE
     C                   MOVE      BOKNT         HEKNT
     C                   MOVE      BLKNA         TRKNFA
     C                   END
     C     KODTAK        CHAIN     KODTA                              32
     C                   MOVE      KOABÆR        HESTD
     C                   MOVE      BLLSS         HESDFF
     C                   MOVE      BLPRO         HEPRO
     C                   MOVE      BLLOS         HESDVT
     C                   MOVE      BLDTA         HEDTOP
     C                   MOVE      BLLSH         HESDF
     C                   MOVE      BLLOH         HESDT
     C                   MOVE      BLMN          HETRCN
     C                   MOVE      BLKNR         HEKNA
     C                   MOVE      BLKNR         KUNDNR
     C     KUND1K        CHAIN     CUNDL01                            32
     C  N32              MOVE      KNAVN         HENAA
     C                   MOVE      BLKNA         HEKNS
     C                   MOVE      BLNAA         HENAS
     C                   MOVE      BLAD1A        HEADS1
     C                   MOVE      BLAD2A        HEADS2
     C                   MOVE      BLAD3A        HEADS3
     C*
     C                   MOVE      BLKNSA        KUNDNR
     C     KUND1K        CHAIN     CUNDL01                            32
     C   32              DO                                                     1<-B
     C                   MOVE      'X'           HEKDFS
     C                   MOVE      *BLANKS       HEVALS
     C                   MOVE      *ZEROS        HEKNSF
     C                   MOVE      *BLANKS       HENASF
     C                   END                                                    1<-E
     C  N32              DO                                                     1<-B
     C                   MOVE      BLKNSA        HEKNSF
     C                   MOVE      ' '           HEKDFS
     C                   MOVE      VALKOD        HEVALS
     C                   MOVE      BLKNSA        HEKNSF
     C                   MOVE      KNAVN         HENASF
     C                   END                                                    1<-E
     C*
     C                   MOVE      BLKNK         KUNDNR
     C     KUND1K        CHAIN     CUNDL01                            32
     C  N32              MOVE      BLKNK         HEKNK
     C   32              MOVE      BLKNM         HEKNK
     C   32              MOVE      BLKNM         KUNDNR
     C   32KUND1K        CHAIN     CUNDL01                            32
      * 1. KUNDE IKKE FINNES --> FLYTTER MOTT.ADR TIL KJØPER.
      * 2. BLKNK ER ULIK MED BLKNM -->
      *    A. FLYTTER VAREADR.1 AV BLKNK TIL KJØPER HVIS V.ADR.1 FINNES
      *    B. FLYTTER ADR. AV BLKNK TIL KJØPER HVIS V.ADR.1 IKKE FINNES
      * 3. MOTT.ADR = KUNDERS ADR -->
      *    A. FLYTTER VAREADR.1 TIL KJØPER HVIS VAREADR.1 FINNES.
      *    B. FLYTTER MOTT.ADR TIL KJØPER HVIS VAREADR.1 IKKE FINNES.
      * 4. MOTT.ADR <> KUNDERS ADR --> FLYTTER MOTT.ADR TIL KJØPER.
     C     *IN32         IFEQ      '0'                                          1<-B
     C     KUNDNR        IFNE      BLKNM                                         2<-B
     C     KUNDNR        ANDNE     0
      * TILFELLE 2.
     C     VADRK         CHAIN     VADR                               32
     C     *IN32         IFEQ      '1'                                            3<-B
      * TILFELLE 2B.
     C                   MOVE      KNAVN         HENAK
     C                   MOVE      ADR1          HEADK1
     C                   MOVE      ADR2          HEADK2
     C                   MOVE      *BLANKS       HEADK3
     C     POSTNR        IFEQ      0                                               4<-B
     C                   MOVEL     ADR3          HEADK3
     C                   ELSE                                                      4
     C                   MOVEL     POSTNR        HEADK3
     C                   MOVE      ADR3          HEADK3
     C                   END                                                       4<-E
     C                   GOTO      SLKJØP
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C     KNAVN         IFEQ      BLNAM                                          3<-B
     C     ADR1          ANDEQ     BLAD1M
     C     ADR2          ANDEQ     BLAD2M
      * TILFELLE 3.
     C     VADRK         CHAIN     VADR                               32
     C                   ELSE                                                     3
      * TILFELLE 4.
     C                   MOVE      '1'           *IN32
     C                   END                                                      3<-E
     C                   END                                                     2<-E
      * TILFELLE 2A ELLER 3A.
     C     *IN32         IFEQ      '0'                                           2<-B
     C                   MOVE      VADRNA        HENAK
     C                   MOVE      VADRN1        HEADK1
     C                   MOVE      VADRN2        HEADK2
     C                   MOVE      VADRN3        HEADK3
     C                   GOTO      SLKJØP
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      * TILFELLE 1 ELLER 4.
     C     BLAD0M        IFEQ      *BLANKS
     C                   MOVE      BLNAM         HENAK
     C                   MOVE      BLAD1M        HEADK1
     C                   MOVE      BLAD2M        HEADK2
     C                   MOVE      BLAD3M        HEADK3
     C                   ELSE
     C                   MOVE      BLAD0M        HENAK
     C                   MOVE      BLNAM         HEADK1
     C                   MOVE      BLAD1M        HEADK2
     C                   MOVE      BLAD2M        HEADK3
     C                   END
     C     SLKJØP        TAG
     C*
     C                   MOVE      BLKNKA        KUNDNR
     C     KUND1K        CHAIN     CUNDL01                            32
     C   32              DO                                                     1<-B
     C                   MOVE      'X'           HEKDFK
     C                   MOVE      *BLANKS       HEVALK
     C                   MOVE      *ZEROS        HEKNKF
     C                   MOVE      *BLANKS       HENAKF
     C                   END                                                    1<-E
     C  N32              DO                                                     1<-B
     C                   MOVE      BLKNKA        HEKNKF
     C                   MOVE      ' '           HEKDFK
     C                   MOVE      VALKOD        HEVALK
     C                   MOVE      BLKNKA        HEKNKF
     C                   MOVE      KNAVN         HENAKF
     C                   END                                                    1<-E
     C*
     C                   Z-ADD     0             HEVKT
     C                   Z-ADD     0             HEM3
     C                   Z-ADD     0             HENT
     C     BLV1K         SETLL     BLV1
     C                   SETOFF                                       32
     C                   MOVE      *BLANKS       HEVS1
     C                   MOVE      *BLANKS       HEGM1
     C                   MOVE      *BLANKS       HEVS2
     C                   MOVE      *BLANKS       HEGM2
     C     STMHE         TAG
     C     BLAVD         READE     BLV1                                   32
     C  N32BLOPD         COMP      BVOPD                              3232
     C  N32BVKDC         IFNE      'TA'                                         1<-B
     C     BVVS          IFNE      *BLANKS                                       2<-B
     C     HEVS1         IFEQ      *BLANKS                                        3<-B
     C                   MOVEL     BVVS          HEVS1
     C                   ELSE                                                     3
     C     HEVS2         IFEQ      *BLANKS                                         4<-B
     C                   MOVEL     BVVS          HEVS2
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C     BVMN          IFNE      *BLANKS                                       2<-B
     C     HEGM1         IFEQ      *BLANKS                                        3<-B
     C                   MOVEL     BVMN          HEGM1
     C                   ELSE                                                     3
     C     HEGM2         IFEQ      *BLANKS                                         4<-B
     C                   MOVEL     BVMN          HEGM2
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   ADD       BVVKT         HEVKT
     C                   ADD       BVM3          HEM3
     C                   ADD       BVNT          HENT
     C                   END                                                    1<-E
     C  N32              GOTO      STMHE
     C*
     C                   MOVE      BLLB          HELB
     C  N31              EXCEPT    GMHEAD
     C   31              EXCEPT    NYHEAD
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
N01   ***********************************************
N01  C     TTSR          BEGSR
N01   ***********************************************
N01  C                   MOVE      HEDTOP        XDTOPF            8
N01  C                   MOVE      BLDTA         XDTOPE            8
N01   * OPPDRAG OPPRETTET (POST I FIL TRACKF)
N01  C                   MOVE      HEAVD         TTAVD
N01  C                   MOVE      HEOPD         TTOPD
N01  C                   IF        HEDTOP = 0
N01  C                   MOVE      'STR'         TTACTI
N01  C                   EVAL      TTTEXT = 'Order entered'
N03  C                   EVAL      TTTEXL = 'Ordre opprettet'
N01  C                   ELSE
N01  C                   MOVE      'CHD'         TTACTI
N01  C                   IF        HEGN11S = *BLANKS
N01  C                   EVAL      TTTEXT = 'ETA changed from '
N01  C                             + %TRIM(XDTOPF) + ' to '
N01  C                             + %TRIM(XDTOPE) + ' by '
N01  C                             + %TRIM(TTUSER)
N03  C                   EVAL      TTTEXL = 'ETA endret fra '
N03  C                             + %TRIM(XDTOPF) + ' til '
N03  C                             + %TRIM(XDTOPE) + ' av '
N03  C                             + %TRIM(TTUSER)
N01  C                   ELSE
N01  C                   EVAL      TTTEXT = 'ATA changed from '
N01  C                             + %TRIM(XDTOPF) + ' to '
N01  C                             + %TRIM(XDTOPE) + ' by '
N01  C                             + %TRIM(TTUSER)
N03  C                   EVAL      TTTEXL = 'ATA endret fra '
N01  C                             + %TRIM(XDTOPF) + ' til '
N01  C                             + %TRIM(XDTOPE) + ' av '
N01  C                             + %TRIM(TTUSER)
N01  C                   END
N01  C                   END
N01  C                   CALL      'SYGE15C'
N01  C                   PARM                    WDT               8
N02  C                   PARM                    WTM               6
S02  C*                  PARM                    WTM               8
N01  C                   MOVE      WDT           TTDATE
N01  C                   MOVE      WTM           TTTIME
N01  C                   MOVE      TTDATE        TTDATL
N01  C                   MOVE      TTTIME        TTTIML
N01  C                   EVAL      TTDEPO = 'SYSJ50K'
N01  C                   MOVE      UUSR          TTUSER
N01  C                   WRITE     TRACKFR
N01   *
N01   * ETD/ATD - ETA/ATA - TIDSOPPFØLGING. (EGEN FIL TRACKT)
N01  C     KEY           CHAIN     TRACKT                             33
N01  C                   IF        HEGN11S = *BLANKS
N01  C                   EVAL      TXETAD  = BLDTA
N01  C                   ELSE
N01  C                   EVAL      TXATAD  = BLDTA
N01  C                   END
N01  C                   IF        *IN33
N01  C                   EVAL      TXAVD = BLAVD
N01  C                   EVAL      TXOPD = BLOPD
N01  C                   WRITE     TRACKTR
N01  C                   ELSE
N01  C                   UPDATE    TRACKTR
N01  C                   END
N01   *
N01  C                   ENDSR
N01   *
     OHEADFR    E            GMHEAD
     O                       HEST
     O                       HESDFF
     O                       HESG
     O                       HESTD
     O                       HEPRO
     O                       HESDVT
     O                       HEDTOP
     O                       HEGN
     O                       HESDF
     O                       HESDT
     O                       HEKNA
     O                       HENAA
     O                       HEKNS
     O                       HEKDFS
     O                       HEVALS
     O                       HENAS
     O                       HEADS1
     O                       HEADS2
     O                       HEADS3
     O                       HEKNSF
     O                       HENASF
     O                       HEKNK
     O                       HEKDFK
     O                       HEVALK
     O                       HENAK
     O                       HEADK1
     O                       HEADK2
     O                       HEADK3
     O                       HEKNKF
     O                       HENAKF
     O                       HEPOS1
     O                       HENT
     O                       HEVS1
     O                       HEVKT
     O                       HEM3
     O                       HEKNT
     O                       HETRM
     O                       HETRI
     O                       HETRC
     O                       HETRCN
     O                       HEDTR
     O                       HEPOS2
     O                       HESDL
     O                       HEGM1
     O                       HEGM2
     O                       HEVS2
     O                       HELB
     O                       TRKNFA
     OHEADFR    EADD         NYHEAD
     O                       HEST
     O                       HEAVD
     O                       HEOPD
     O                       HESDFF
     O                       HEUR
     O                       HESG
     O                       HESTD
     O                       HEPRO
     O                       HESDVT
     O                       HEDTOP
     O                       HEGN
     O                       HESDF
     O                       HESDT
     O                       HEKNA
     O                       HENAA
     O                       HEKNS
     O                       HEKDFS
     O                       HEVALS
     O                       HENAS
     O                       HEADS1
     O                       HEADS2
     O                       HEADS3
     O                       HEKNSF
     O                       HENASF
     O                       HEKNK
     O                       HEKDFK
     O                       HEVALK
     O                       HENAK
     O                       HEADK1
     O                       HEADK2
     O                       HEADK3
     O                       HEKNKF
     O                       HENAKF
     O                       HEPOS1
     O                       HENT
     O                       HEVS1
     O                       HEVKT
     O                       HEM3
     O                       HEKNT
     O                       HETRM
     O                       HETRI
     O                       HETRC
     O                       HETRCN
     O                       HEDTR
     O                       HEPOS2
     O                       HESDL
     O                       HEGM1
     O                       HEGM2
     O                       HEVS2
     O                       HELB
     O                       TRKNFA
