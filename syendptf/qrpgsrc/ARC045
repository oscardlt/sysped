********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
********************************************************************
10XXX * 01 SWH PTF10 får med flere date til logging
11XXX * 02 SH  PTF11 kundenummer i parameter
11XXX * 03 SH  PTF11 får med type kode til loggen P=prisforespørsel R=reklamasjon
11XXX * 04 SH  PTF11 Reklamasjon
11XXX * 05 SH  PTF11 emne som parameter
11XXX * 06 SH  PTF11 rettelser etter at reklamasjon L1 er medkommet UKODE=L
11XXX * 07 SH  PTF12 egen kode purring prisforespørsel TTSR omskrevet uten merking
      *
      ***********************************************************
      *** PROGRAM SKAL plukke epostadresse                    ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01 02 04-26                      ***
      *** LEDIGE INDIKATORER 28 29 31 32 35 38 51-56 58-69    ***
      ***                    74-78 80-87 89-99                ***
      ***********************************************************
     FTRACKF    O  A E           K DISK
     Fheadf     IF   E           K DISK
     Fturer14   IF   E           K DISK
     FArkepoW   UF   E           K DISK
     FCUNDC     IF   E             DISK
     FCUNDC03   IF   E           K DISK
     F                                     RENAME(CUNDCR:CUNDCR3)
     FDISTLH    IF   E           K DISK
     FFIRM      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FKUNDL01   IF   E           K DISK
     F                                     RENAME(KUNDR:KUNDR2)
     FARC045FM  CF   E             WORKSTN
     F                                     INFDS(FBAREA)
     D                SDS
     D  ZUSER                254    263
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D F5              S             75    DIM(12)
     D                 DS
     D  USØKKN                 1     30
     D  USØKKO                 1      2
     D  URRN                   3     12
     D  epofax                13     13
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0

     D  F3                     1      6
     D                                     DIM(6)
     D UP              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZ')
     D LO              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyz')
     IKUNDR
     I              BANKG                       SYBAGI
     I              POSTG                       SYPOGI
     C*
     C                   EXSR      INIT
     C*
     C     START         TAG
     C                   EXFMT     BILDE
     c                   setoff                                       3031
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   SETOFF                                       30
     C   03              GOTO      SLUTT
     C   12              GOTO      SLUTT
     C   04              DO
     C     LINNBR        IFeq      4
     C     LO:UP         XLATE     EPOST         usok
     C                   eval      usok='*tilbud'
     C                   CALL      'VCUNDCR'
     C                   PARM                    FIFIRM
     C                   PARM                    KUNDNR
     C                   PARM                    URRN2            10 0
     c                   parm                    epofax            1
     C                   PARM                    USOK             30
     C     URRN2         IFNE      *ZEROS
     C                   MOVE      URRN2         URRN
     C                   MOVE      'KP'          USØKKO
     c                   else
     c                   movel     usok          epost
     C                   END
     C                   ELSE
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    KUNDNR
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN           30
     c                   end
     C* RETUR MED KONTAKTPERS
     C     USØKKO        IFEQ      'KP'
     C                   MOVE      URRN          RRN              10 0
     C     RRN           CHAIN     CUNDC                              31
     C  N31              MOVEL     CEMAIL        EPOST
     C  N31              MOVE      CCOMPN        KUNDNR
     C                   END
     C                   END
     C                   EXSR      TEST
     C   30              GOTO      START
     C*
     C                   z-add     8             LINNBR
     C                   z-add     10            POSNBR
     C*
     C  N10              GOTO      START
     C*
n01  c                   move      heavd         aavd              4
n01  c                   move      heopd         aopd              7
n01  c                   move      hepro         atur              8
n01  c                   move      kundnr        akun              8
     c                   call      'ARC045CLJ'
n04  c                   parm                    zuser
n04  c                   parm                    navnf            30
n04  c                   parm                    epostf           70
     c                   parm                    epost
     c                   parm                    wsemne
     c                   parm                    wscvp1
     c                   parm                    wscvp2
     c                   parm                    wscvp3
     c                   parm                    wscvp4
     C                   parm                    wscvp5
     C                   parm                    wscvp6
     C                   parm                    wscvp7
     C                   parm                    wscvp8
     C                   parm                    wscvp9
     C                   parm                    wscvp10
     C                   parm                    wscvp11
     C                   parm                    wscvp12
     C                   parm                    wscvp13
     C                   parm                    wscvp14
     C                   parm                    wscvp15
     C                   parm                    wscvp16
     C                   parm                    wscvp17
     C                   parm                    wscvp18
n01  c                   parm                    aavd
n01  c                   parm                    aopd
n01  c                   parm                    atur
n01  c                   parm                    akun
n03  c                   parm                    ukode
     c                   exsr      ttsr
n02  c                   move      'S'           ukode
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     TEST          BEGSR
     C***********************************************
     C
      *
      *
     c                   setoff                                       30
     c                   setoff                                       707172
n02  c                   setoff                                       73
     C
      *
     C     KUNDNR        IFNE      *ZEROS
     C     KUKEY         CHAIN     CUNDL01                            71
     C  N71EPOST         IFEQ      *BLANKS
     C*                  MOVEl     syepos        epost
     c                   exsr      finnep
     C                   END
      *
     c     *in(71)       ifeq      '1'
     C                   SETON                                        30
     C                   MOVE      'SPK0001'     MSGNR
     C                   z-add     9             LINNBR
     C                   z-add     8             POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
      *
      * IKKE EPOST-ADRESSE LAGT INN
      *
     C     EPOST         ifeq      *BLANKS
     C                   SETON                                        3072
     C                   MOVE      'SHU0835'     MSGNR
     C                   z-add     4             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
      *
      * adresse må inneholde @
      *
     c                   else
     c                   movel     epost         star              1
     c     star          ifeq      '*'
     c                   movel     epost         dis7              7
     c                   move      dis7          dis6              6
     c     dis6          chain     distlh                             72
     c     *in(72)       ifeq      '1'
     C                   SETON                                        3072
     C                   MOVE      'SHU0915'     MSGNR
     C                   z-add     4             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     c                   end
     c                   else
     C     '@'           SCAN      EPOST                                  62
     c     *in(62)       ifeq      '0'
     C                   SETON                                        3072
     C                   MOVE      'SHU0848'     MSGNR
     C                   z-add     4             LINNBR
     C                   z-add     10            POSNBR
     C                   GOTO      SLTB
     C                   END
     C                   END
     C                   END
      *
N02  c     WSEMNE        ifeq      *blanks
n02  C                   SETON                                        3073
n02  C                   MOVE      'SHU1299'     MSGNR
n02  C                   z-add     7             LINNBR
n02  C                   z-add     10            POSNBR
n02  C                   GOTO      SLTB
n02  C                   END
      *
     C*
     C     SLTB          ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD              7 0
N02  C                   PARM                    UKUNDE            8 0
     c                   PARM                    UKODE             1
     c                   PARM                    EMNE             80
     c                   MOVE      EMNE          WSEMNE
     C     KUKEY         KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C     CUKEY         KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    TYPE             30
     C                   KFLD                    KUNDNR
s06  c*    type          ifeq      'R'
N06  c     UKODE         ifeq      'R'
N06  c     UKODE         oreq      'L'
N04  c                   eval      type='*Reklamasjon'
N04  c                   else
     C                   EVAL      type='*tilbud'
N04  C                   end
     C     HEKEY         KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     c                   move      uavd          heavd
     c                   move      uopd          heopd
      *
     C                   READ      FIRM                                   44
n06  c                   move      ukunde        kundnr
     C*
N06  c     ukode         ifne      'L'
     c     hekey         chain     headf                              33
      *
s06  c*    ukunde        ifne      *zeros
s06  c*                  move      ukunde        kundnr
s06  c*                  else
n06  c     ukunde        ifeq      *zeros
     c     trkdff        ifeq      'K'
     c                   move      heknkf        kundnr
     c                   else
     c                   move      heknsf        kundnr
     c                   end
     c     kundnr        ifeq      0
     c                   move      trknfa        kundnr
     c                   end
n02  c                   end
n06  c                   end
     c                   exsr      finnep
N06  c     ukode         ifne      'L'
     c     hepro         chain     turer14                            34
n06  c                   end
      *
n06  c     kundnr        ifne      0
n06  C     KUKEY         CHAIN     CUNDL01                            34
n06  c                   end
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     TTSR          BEGSR
     C***********************************************
     C                   CLEAR                   trackfr
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      ULDT          TTDATE
     C                   MOVE      XULTM         TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
     C                   MOVE      ZUSER         TTUSER
     C                   MOVE      *blanks       TTTEXT
     c                   move      *blanks       FIFNA             7
      * purring pristilbud
     c     ukode         ifeq      'P'
     C                   MOVE      'PRP'         TTACTI
     C                   eval      TTTEXT = 'Purring pristilbud:'
     C                   eval      TTTEXL = 'Purring pristilbud:'
     C                   end
      * reklamasjon  kostnadsføring
     c     ukode         ifeq      'R'
     C                   MOVE      'REK'         TTACTI
     C                   eval      TTTEXT = 'Complaint:'
     C                   eval      TTTEXL = 'Reklamasjon:'
     C                   end
      * sendt pristilbud ved mottak POD fra  ESTSTT (Toten)
     c     ukode         ifeq      'S'
     c                   move      'PRI'         TTACTI
     C                   eval      TTTEXT = 'Price inquiry:'
     C                   eval      TTTEXL = 'Pris forespørsel:'
     c                   end
      * ren epostsending
     c     ukode         ifeq      'E'
     c                   move      'EMA'         TTACTI
     C                   eval      TTTEXT = 'Email sent:'
     C                   eval      TTTEXL = 'Epost sendt:'
     c                   end
     C     TTTEXT        CAT       KNAVN:1       TTTEXT
     C     TTTEXL        CAT       KNAVN:1       TTTEXL
     C                   WRITE     TRACKFR
      * skriver egen record med epostadressen
      * ikke ved purring
     C     TTACTI        ifne      'PRP'
     C                   eval      TTTEXT = 'Email:'
     C     TTTEXT        CAT       EPOST:1       TTTEXT
     C                   eval      TTTEXL = 'Epost:'
     C     TTTEXL        CAT       EPOST:1       TTTEXL
     C                   WRITE     TRACKFR
     C                   END
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     FINNEP        BEGSR
     C***********************************************
     c                   z-add     0             antkp             5 0
     c                   setoff                                       34
     c     cukey         setll     cundc03
     c     *in34         doweq     '0'
     c     cukey         reade     cundc03                                34
     c     *in34         ifeq      '0'
     c                   add       1             antkp             5 0
     c                   eval      epost=cemail
     c                   end
     c                   end
      *
      * kun 1 adresse
      *
     c     antkp         ifeq      1
     c                   goto      utfinn
     c                   end
      *
      * flere enn 1 adresse
      *
     c     antkp         ifgt      1
     C                   eval      usok='*tilbud'
     C                   CALL      'VCUNDCR'
     C                   PARM                    FIFIRM
     C                   PARM                    KUNDNR
     C                   PARM                    URRN2            10 0
     c                   parm                    epofax            1
     C                   PARM                    USOK             30
     C     URRN2         IFNE      *ZEROS
     C                   MOVE      URRN2         URRN
     C                   MOVE      'KP'          USØKKO
     C                   MOVE      URRN          RRN              10 0
     C     RRN           CHAIN     CUNDC                              31
     C  N31              MOVEL     CEMAIL        EPOST
     C  N31              MOVE      CCOMPN        KUNDNR
     c                   else
     c                   movel     usok          epost
     C                   END
     c                   end
     c     utfinn        TAG
     C     EPOST         IFEQ      *BLANKS
     C     KUNDNR        ANDNE     *ZEROS
     C     KUKEY         CHAIN     CUNDL01                            71
     C  N71              MOVEl     syepos        epost
     C                   END
     c                   endsr
