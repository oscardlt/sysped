xxx   * start fra customsOfficeOfFirstEntry
     H*debug(*yes)
     H Option( *SrcStmt ) DftActGrp( *No ) BndDir( 'QC2LE' )
      *
     FSADEXML2  UF   E           K DISK
     FSADEXHL1  IF   E           K DISK
     FECMSG1    IF   E           K DISK
     FEDIC      UF   E             DISK
     FEDIS      O  A E           K DISK
     ‚*  Prototype for 'JSONFIX'
     d jsonfix         pr                  extpgm('JSONFIX')
     d jsonstring_                         like(jsonstring)
      *
     D FILE_o          s               *
     D String          s            512a
     D rc              s             10i 0
     D Data            s             80a   Varying
     D codepage        s              5a   Varying
     D CmdLine         S            512
     D CmdLen          S             15  5
     D LF              c                   x'25'
     D X_1LIN          S              1a
     D XAPS            S              1a
     D XN51            S              3  0
     D XN52            S              3  0
     D XN53            S              3  0
     D XN54            S              3  0
     D XN55            S              3  0
     D XN56            S              3  0
     D XAN80_1         S             80
     D XAN80_2         S             80
      *
      * Status = Pre-alert  / On-Arrival / Cancelled
     D Status          s             20
     D JSONstring      s          32000
     D WFILNAM         S            200
     D WFILNAM1        S            200
     D WFILNAM2        S            200
     D WFILNAM3        S            200
     D WFILNAM4        S            200
     D WMAPPE          S            100
     D WMAPPE2         S            100
     D XLIB            S             11
     D WFilback        S            512
     D WFIL            S            512
     D timeData        S               Z                                        Z=Timestamfield
     D Fldr            S             60
     d wdt             s              8a
     d wtm             s              6a
     d udtno           s              8  0
     d utdno           s              6  0
     d udtgm           s              8  0
     d utdgm           s              6  0
     d umod            s              1
     d i               s              3  0
     d xn              s              3  0
      *
     Dopen             Pr              *   ExtProc( '_C_IFS_fopen' )
     D                                 *   Value Options( *String )
     D                                 *   Value Options( *String )
     Dfputs            Pr            10i 0 ExtProc( '_C_IFS_fputs' )
     D                                 *   Value Options( *String )
     D                                 *   Value
     Dclose            Pr            10i 0 ExtProc( '_C_IFS_fclose' )
     D                                 *   Value
     D RunCmd          PR                  EXTPGM('QCMDEXC')
     D  Cmd                         200A   CONST
     D  Len                          15P 5 CONST
      *   EDIDTA data area
     D EDIDTA          DS           256    DTAARA('EDIDTA')
     D  UELIBF               171    180
     D                 DS
     D  TS                     1     26
     D  TS_N                   1     26  0
     D                 DS
     D  X_IDAG                 1      8  0
     D  X_IDAGC                1      2
     D  X_IDAGA                3      4
     D  X_IDAGM                5      6
     D  X_IDAGD                7      8
     D                 DS
     D  X_TID                  1      6  0
     D  X_TIDH                 1      2
     D  X_TIDM                 3      4
     D  X_TIDS                 5      6
     D                 DS
     D  X_ETA                  1      8  0
     D  X_ETAA                 1      4
     D  X_ETAM                 5      6
     D  X_ETAD                 7      8
     D                 DS
     D  X_ETM                  1      6  0
     D  X_ETMH                 1      2
     D  X_ETMM                 3      4
     D  X_ETMS                 5      6
     D                 DS
     D  EMPRO                  1      8  0
     D  EMPRO_A                1      8
     D                 DS
     D  EMCN                   1      1  0
     D  EMCN_A                 1      1
     D                 DS
     D  EMETDDC                1      2
     D  EMETDDA                3      4
     D  EMETDDM                5      6
     D  EMETDDD                7      8
     D  EMETDD                 1      8  0
     D                 DS
     D  EMETDTH                1      2
     D  EMETDTM                3      4
     D  EMETDTS                5      6
     D  EMETDT                 1      6  0
     D                 DS
     D  EMETADC                1      2
     D  EMETADA                3      4
     D  EMETADM                5      6
     D  EMETADD                7      8
     D  EMETAD                 1      8  0
     D                 DS
     D  EMETATH                1      2
     D  EMETATM                3      4
     D  EMETATS                5      6
     D  EMETAT                 1      6  0
     D                 DS
     D  EMATDDC                1      2
     D  EMATDDA                3      4
     D  EMATDDM                5      6
     D  EMATDDD                7      8
     D  EMATDD                 1      8  0
     D                 DS
     D  EMATDTH                1      2
     D  EMATDTM                3      4
     D  EMATDTS                5      6
     D  EMATDT                 1      6  0
     D                 DS
     D  EMATADC                1      2
     D  EMATADA                3      4
     D  EMATADM                5      6
     D  EMATADD                7      8
     D  EMATAD                 1      8  0
     D                 DS
     D  EMATATH                1      2
     D  EMATATM                3      4
     D  EMATATS                5      6
     D  EMATAT                 1      6  0
     D                 DS
     D  EMSJADT                1      8  0
     D  EMSJADTC               1      2
     D  EMSJADTA               3      4
     D  EMSJADTM               5      6
     D  EMSJADTD               7      8
     D                 DS
     D  EMSJ2DT                1      8  0
     D  EMSJ2DTC               1      2
     D  EMSJ2DTA               3      4
     D  EMSJ2DTM               5      6
     D  EMSJ2DTD               7      8
     D                 DS
     D  EMLKR1                 1      2
     D  EMLKR2                 3      4
     D  EMLKR3                 5      6
     D  EMLKR4                 7      8
     D  EMLKR5                 9     10
     D  EMLKR6                11     12
     D  EMLKR7                13     14
     D  EMLKR8                15     16
     D  CR                     1     16    DIM(8)
     D                 DS
     D  XTXT801                1     80
     D  XT801                  1     80    DIM(80)
     D                 DS
     D  XTXT802                1     80
     D  XT802                  1     80    DIM(80)
      *  Prototype for 'SYGE15C'
     d SYGE15C         pr                  extpgm('SYGE15C')
     d wdt_                                like(wdt)
     d wtm_                                like(wtm)
      *  Prototype for 'ARC040C1'
     d ARC040C1        pr                  extpgm('ARC040C1')
     d Fldr_                               like(Fldr)
      *  Prototype for 'SYGE128'
     d SYGE128         pr                  extpgm('SYGE128')
     d udtno_                              like(udtno)
     d utdno_                              like(utdno)
     d udtgm_                              like(udtgm)
     d utdgm_                              like(utdgm)
     d umod_                               like(umod)
      *  Prototype for 'SADEXJSONC'
     d SADEXJSONC      pr                  extpgm('SADEXJSONC')
     d wfilnam_                            like(wfilnam)
     d wfilnam1_                           like(wfilnam1)
     d wfilnam2_                           like(wfilnam2)
     d wfilnam3_                           like(wfilnam3)
     d wfilnam4_                           like(wfilnam4)
     d wmappe_                             like(wmappe)
     d wmappe2_                            like(wmappe2)
      *  Prototype for SADEXJSON
     d SADEXJSON       pr
     d upro_                               like(upro)
      *  *ENTRY Interface for Main Procedure
     d SADEXJSON       pi
     d upro                           8
      *
      /free

         exsr init;
         // tEMPORÆRE HARDKODEDE VERDIER

         exsr LagFil;

         exsr OpdEDIS;

         *inlr = *on;
         return;

        //*********************
        Begsr LagFil;
        //*********************
        //time (Timedata);
        //ts = Timedata;
      /end-free
     C                   time                    Timedata
     C                   movel     timedata      TS
      /free

        //Lag fil og set codepage (pc)

        chain empro sadexml2;

        select;
        when emst2 = 'D';
          WFil = 'D_' + EMMID;                 // DELETE
          emst = 'B';
        when emst2 = 'S';
          WFil = UPRO;                         // 1. GANG SENDING
          emst = 'B';
        when emst2 = 'R';
          WFil = 'U_' + EMMID;                 // Endring og send sletting først
          emst = 'U';
        other;
          WFil = 'XXX' + EMMID;                // Skal ikke komme hit
        endsl;

        emerr = *blanks;
        update sadexmfr;

        XLIB = '/' + UELIBF;
        // ByggFlr kan gjerne flyttes til annet prog. men det er gjort på millisekunder..
        exsr ByggFlr;
        // Fil i backup med stempel
        WFilNam  = %TRIM(XLIB) + '/EXPRESSMANIFEST/json_Ut/Backup/'
                  + %TRIM(TS) + %TRIM(Wfil) + '.json';
        // Fil i temp med stempel
        WFilNam1 = %TRIM(XLIB) + '/EXPRESSMANIFEST/' + 'json_Ut/Temp/'
                  + %TRIM(TS) + %TRIM(Wfil) + '.json';
        // Fil i temp uten stempel
        WFilNam2 = %TRIM(XLIB) + '/EXPRESSMANIFEST/' + 'json_Ut/Temp/'
                  + %TRIM(Wfil) + '.json';
        // Filnavn uten stempel
        WFilNam3 = %TRIM(Wfil) + '.json';
        // Sjekk tidligere versjon
        WFilNam4 = %TRIM(XLIB) + '/EXPRESSMANIFEST/' + 'json_Ut/'
                  + %TRIM(Wfil) + '.json';

        WMAPPE   = %TRIM(XLIB) + '/EXPRESSMANIFEST/' + 'json_Ut/Temp';
        WMAPPE2  = %TRIM(XLIB) + '/EXPRESSMANIFEST/' + 'json_Ut';

        FILE_o = open( %TrimR( WFilNam ) : 'w, codepage=865' );
        rc = close( FILE_o );
        FILE_o = open( %TrimR( WFilNam ) : 'w' );

        exsr LagJson;

        rc = close( FILE_o );

        sadexjsonc (wfilnam: wfilnam1: wfilnam2: wfilnam3: wfilnam4:
                    wmappe: wmappe2);
        // Kopiert til endelig mappe ..

        endsr;

        //*********************
        Begsr LagJson;
        //*********************

        // Start JSON
        jsonstring ='{';
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        // documentIssueDate
          jsonstring ='¬documentIssueDate¬:¬' + %trim(X_IDAGC) + %trim(X_IDAGA)
            + '-' + %trim(X_IDAGM) + '-' + %trim(X_IDAGD) + 'T'
            +  %trim(X_TIDH) + ':' + %trim(X_TIDM) + ':' + %trim(X_TIDS) +'Z'
            + '¬,';
          jsonfix ( jsonstring );
          rc = fputs(%trimr(jsonstring) + LF: File_o);
        //endif;

        // MasterConsignment
        exsr MasterC;

        jsonstring = '}';                                    // slutt Hele meldingen
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        endsr;

        //*********************
        Begsr MasterC;
        //*********************

      //-----------------------------------------------------------------------------------
        // Representativ
        jsonstring = '¬representative¬:{';                   // start representative
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNAR;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬name¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬identificationNumber¬:¬'+%trim(EMRGR)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬status¬:¬'+%trim(EMSTR)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬address¬:{';                          // start address
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPSR;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬city¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬country¬:¬'+%trim(EMLKR)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNA2R;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬subDivision¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMAD1R;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬streetLine¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPNR;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬postcode¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        //xtxt801 = EMAD2R;
        //xn53 = 30;
        //exsr knvst;
        //jsonstring = '¬streetAdditionalLine¬:¬'+%trim(EMAD2R)+'¬,';
        //jsonfix ( jsonstring );
        //rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNRR;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬number¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPBR;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬poBox¬:¬'+%trim(XTXT802)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                   // slutt address
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬communication¬:[';                    // start communication
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '{';                                    // {
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬identifier¬:¬'+%trim(EMEMR)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬type¬:¬'+%trim(EMEMRT)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '}';                                    // }
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = ']';                                    // slutt communication
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                   // slutt representativ
        rc = fputs(%trimr(jsonstring) + LF: File_o);
      //-----------------------------------------------------------------------------------

      //-----------------------------------------------------------------------------------
        // activeBorderTransportMeans
        jsonstring = '¬activeBorderTransportMeans¬:{';       // start activeBorderTransportMeans
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬identificationNumber¬:¬'+%trim(EMKMRK)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬typeOfIdentification¬:¬'+%trim(EMKTYP)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬typeOfMeansOfTransport¬:¬'+%trim(EMKTM)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬nationalityCode¬:¬'+%trim(EMKLK)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬modeOfTransportCode¬:¬'+%trim(EMKTKD)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        if EMATDD > 0;
        jsonstring ='¬actualDateAndTimeOfDeparture¬:¬' + %trim(EMATDDC)
          + %trim(EMATDDA) + '-' + %trim(EMATDDM) + '-' + %trim(EMATDDD) + 'T'
          + %trim(EMATDTH) + ':' + %trim(EMATDTM) + ':' + %trim(EMATDTS) + 'Z'
          + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);
        endif;

        if EMETDD > 0;
        jsonstring ='¬estimatedDateAndTimeOfDeparture¬:¬' + %trim(EMETDDC)
          + %trim(EMETDDA) + '-' + %trim(EMETDDM) + '-' + %trim(EMETDDD) + 'T'
          + %trim(EMETDTH) + ':' + %trim(EMETDTM) + ':' + %trim(EMETDTS) + 'Z'
          + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);
        endif;

        if EMETAD > 0;
        jsonstring ='¬estimatedDateAndTimeOfArrival¬:¬' + %trim(EMETADC)
          + %trim(EMETADA) + '-' + %trim(EMETADM) + '-' + %trim(EMETADD) + 'T'
          + %trim(EMETATH) + ':' + %trim(EMETATM) + ':' + %trim(EMETATS) + 'Z'
          + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);
        endif;

        jsonstring = '¬countriesOfRoutingOfMeansOfTransport¬:[';   // start Routing
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xn = 0;
        for i = 1 to 8;
          if cr(i) <> *blanks;
            xn = xn + 1;

            if xn > 1;
        jsonstring = '},';                                   // }
        rc = fputs(%trimr(jsonstring) + LF: File_o);
            endif;

        jsonstring = '{';                                    // {
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬sequenceNumber¬:¬'+%trim(%editc(XN:'Z'))+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬country¬:¬'+%trim(CR(I))+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

          endif;
        endfor;

        if cr(1) <> *blanks;
        jsonstring = '}';                                    // }
        rc = fputs(%trimr(jsonstring) + LF: File_o);
        endif;

        jsonstring = '],';                                   // slutt Routing
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬operator¬:{';                         // start operator
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMSJAF;
        xn53 = 50;
        exsr knvst;
        jsonstring = '¬name¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬citizenship¬:¬' + %trim(EMSJALK) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬dateOfBirth¬:¬' + %trim(EMSJADTC) + %trim(EMSJADTA)
          + '-' + %trim(EMSJADTM) + '-' + %trim(EMSJADTD)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                   // slutt operator
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬crew¬:[';                             // start crew
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '{';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMSJ2F;
        xn53 = 50;
        exsr knvst;
        jsonstring = '¬name¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬citizenship¬:¬' + %trim(EMSJ2LK) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬dateOfBirth¬:¬' + %trim(EMSJ2DTC) + %trim(EMSJ2DTA)
          + '-' + %trim(EMSJ2DTM) + '-' + %trim(EMSJ2DTD)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '}';
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = ']';                                    // slutt crew
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                   // slutt activeBorderTransportMeans
        rc = fputs(%trimr(jsonstring) + LF: File_o);
      //-----------------------------------------------------------------------------------

      //-----------------------------------------------------------------------------------
        // customsOfficeOfFirstEntry
        jsonstring = '¬customsOfficeOfFirstEntry¬:{';        // start customsOfficeOfFirstEntry
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬referenceNumber¬:¬' + %trim(EMTSD) + '¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                   // slutt customsOfficeOfFirstEntry
        rc = fputs(%trimr(jsonstring) + LF: File_o);
      //-----------------------------------------------------------------------------------

      //-----------------------------------------------------------------------------------
        // consignmentMasterLevel
        jsonstring = '¬consignmentMasterLevel¬:{';           // start consignmentMasterLevel
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        setll empro sadexhl1;
        reade empro sadexhl1;
        dow not %eof;

          jsonstring = '¬consignmentHouseLevel¬:[';          // start consignmentHouseLevel
          jsonfix ( jsonstring );
          rc = fputs(%trimr(jsonstring) + LF: File_o);

          jsonstring = '{';                                  // {
          rc = fputs(%trimr(jsonstring) + LF: File_o);

          jsonstring = '¬transportDocumentHouseLevel¬:{';    // start transportDocumentHouseLevel
          jsonfix ( jsonstring );
          rc = fputs(%trimr(jsonstring) + LF: File_o);

          xtxt801 = EHDKH;
          xn53 = 50;
          exsr knvst;
          jsonstring = '¬documentNumber¬:¬' + %trim(XTXT802) + '¬,';
          jsonfix ( jsonstring );
          rc = fputs(%trimr(jsonstring) + LF: File_o);

          jsonstring = '¬type¬:¬' + %trim(EHDKHT) + '¬';
          jsonfix ( jsonstring );
          rc = fputs(%trimr(jsonstring) + LF: File_o);

          jsonstring = '}';                                  // slutt transportDocumentHouseLevel
          rc = fputs(%trimr(jsonstring) + LF: File_o);

          jsonstring = '}';                                  // }
          rc = fputs(%trimr(jsonstring) + LF: File_o);

          jsonstring = '],';                                  // slutt consignmentHouseLevel
          rc = fputs(%trimr(jsonstring) + LF: File_o);

          reade empro sadexhl1;
        enddo;

        jsonstring = '¬containerIndicator¬:¬' + %trim(EMCN_A) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬grossMassr¬:¬' + %trim(%editc(EMVKB:'Z')) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        //==================
        jsonstring = '¬carrier¬:{';                           // start carrier
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNAT;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬name¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬identificationNumber¬:¬' + %trim(EMRGT) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬address¬:{';                           // start address
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPST;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬city¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬country¬:¬' + %trim(EMLKT) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNA2T;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬subDivision¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMAD1T;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬streetLine¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPNT;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬postcode¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        //xtxt801 = EMAD2T;
        //xn53 = 30;
        //exsr knvst;
        //jsonstring = '¬streetAdditionalLine¬:¬' + %trim(EMAD2T) + '¬,';
        //jsonfix ( jsonstring );
        //rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNRT;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬number¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPBT;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬poBox¬:¬' + %trim(XTXT802) + '¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                    // slutt address
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬communicatio¬:[';                      // start communication
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '{';                                    // {
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬identifier¬:¬'+%trim(EMEMT)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬type¬:¬'+%trim(EMEMTT)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '}';                                    // }
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = ']';                                    // slutt communication
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                   // slutt carrier
        rc = fputs(%trimr(jsonstring) + LF: File_o);
        //==================

        jsonstring = '¬transportDocumentMasterLevel¬:{';     // start transportDocumentMasterLevel
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMDKMT;
        xn53 = 50;
        exsr knvst;
        jsonstring = '¬documentNumber¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬type¬:¬' + %trim(EMDKM) + '¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '}';                                    // slutt transportDocumentMasterLevel
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMUCR;
        xn53 = 50;
        exsr knvst;
        jsonstring = '¬referenceNumberUCR¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        //==================
        if EMNAM <> *blanks;

        jsonstring = '¬consignee¬:{';                         // start consignee
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNAM;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬name¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬identificationNumber¬:¬' + %trim(EMRGM) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬address¬:{';                           // start address
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPSM;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬city¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬country¬:¬' + %trim(EMLKM) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNA2M;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬subDivision¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMAD1M;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬streetLine¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPNM;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬postcode¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        //xtxt801 = EMAD2M;
        //xn53 = 30;
        //exsr knvst;
        //jsonstring = '¬streetAdditionalLine¬:¬' + %trim(EMAD2M) + '¬,';
        //jsonfix ( jsonstring );
        //rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNRM;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬number¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPBM;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬poBox¬:¬' + %trim(XTXT802) + '¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                    // slutt address
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬communicatio¬:[';                      // start communication
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '{';                                    // {
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬identifier¬:¬'+%trim(EMEMM)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬type¬:¬'+%trim(EMEMMT)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '}';                                    // }
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = ']';                                    // slutt communication
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                    // slutt consignee
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        endif;     // if EMNAS <> *blanks;
        //==================

        //==================
        if EMNAS <> *blanks;

        jsonstring = '¬consignee¬:{';                         // start consignor
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNAS;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬name¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬identificationNumber¬:¬' + %trim(EMRGS) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬address¬:{';                           // start address
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPSS;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬city¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬country¬:¬' + %trim(EMLKS) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNA2S;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬subDivision¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMAD1S;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬streetLine¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMAD1S;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬postcode¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        //xtxt801 = EMAD2S;
        //xn53 = 30;
        //exsr knvst;
        //jsonstring = '¬streetAdditionalLine¬:¬' + %trim(EMAD2S) + '¬,';
        //jsonfix ( jsonstring );
        //rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNRS;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬number¬:¬' + %trim(XTXT802) + '¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPBS;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬poBox¬:¬' + %trim(XTXT802) + '¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                    // slutt address
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬communicatio¬:[';                      // start communication
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '{';                                    // {
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬identifier¬:¬'+%trim(EMEMS)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬type¬:¬'+%trim(EMEMST)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '}';                                    // }
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = ']';                                    // slutt communication
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                    // slutt consignor
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        endif;     // if EMNAS <> *blanks;
        //==================

        jsonstring = '¬placeOfLoading¬:{';                    // start placeOfLoading
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMSDLT;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬location¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬unloCode¬:¬'+%trim(EMLKL)+' '+%trim(EMSDL)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬address¬:{';                           // start address
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬country¬:¬'+%trim(EMLKL)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '}';                                     // slutt address
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                    // slutt placeOfLoading
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬placeOfUnloading¬:{';                  // start placeOfUnloading
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMSDUT;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬location¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬unloCode¬:¬'+%trim(EMLKU)+' '+%trim(EMSDU)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬address¬:{';                           // start address
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬country¬:¬'+%trim(EMLKU)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '}';                                     // slutt address
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                    // slutt placeOfUnloading
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        //==================
        if EMPMRK <> *blanks;

        //jsonstring = '¬PassiveBorderTransportMeans¬:[';      // start PassiveBorderTransportMeans
        jsonstring = '¬passiveBorderTransportMeans¬:[';      // start passiveBorderTransportMeans
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '{';                                    // {
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬identificationNimberr¬:¬'+%trim(EMPMRK)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬typeOfIdentification¬:¬'+%trim(EMPTYP)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬typeOfMeansOfTransport¬:¬'+%trim(EMPTM)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬country¬:¬'+%trim(EMPLK)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '}';                                    // }
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '],';                                   // slutt PassiveBorderTransportMeans
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        endif;     // if EMPMRK <> *blanks;
        //==================

        //==================
        if EMCNR <> *blanks;

        //jsonstring = '¬TransportEquipment¬:[';               // start TransportEquipment
        jsonstring = '¬transportEquipment¬:[';               // start TransportEquipment
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '{';                                    // {
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬containerIdentificationNumber¬:¬'+%trim(EMCNR)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '}';                                    // }
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '],';                                   // slutt PassiveBorderTransportMeans
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        endif;     // if EMPMRK <> *blanks;
        //==================

        //==================
        if EMSCA <> *blanks;

        jsonstring = '¬additionalSupplyChainActor¬:[';       // start additionalSupplyChainActor
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '{';                                    // {
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMSCA;
        xn53 = 50;
        exsr knvst;
        jsonstring = '¬identificationNumber¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬role¬:¬'+%trim(EMSCAR)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '}';                                    // }
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '],';                                   // slutt additionalSupplyChainActor
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        endif;     // if EMPMRK <> *blanks;
        //==================

        jsonstring = '},';                                    // slutt consignmentMasterLevel
        rc = fputs(%trimr(jsonstring) + LF: File_o);
      //-----------------------------------------------------------------------------------

      //-----------------------------------------------------------------------------------
        // declarant
        jsonstring = '¬declarant¬:{';                        // start declarant
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNAD;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬name¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬address¬:{';                          // start address
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPSD;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬city¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬country¬:¬'+%trim(EMLKD)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNA2D;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬subDivision¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMAD1D;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬streetLine¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPND;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬postcode¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        //xtxt801 = EMAD2D;
        //xn53 = 30;
        //exsr knvst;
        //jsonstring = '¬streetAdditionalLine¬:¬'+%trim(EMAD2D)+'¬,';
        //jsonfix ( jsonstring );
        //rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMNRD;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬number¬:¬'+%trim(XTXT802)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMPBD;
        xn53 = 30;
        exsr knvst;
        jsonstring = '¬poBox¬:¬'+%trim(XTXT802)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                   // slutt address
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬communication¬:[';                    // start communication
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '{';                                    // {
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬identifier¬:¬'+%trim(EMEMD)+'¬,';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '¬type¬:¬'+%trim(EMEMDT)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '}';                                    // }
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = ']';                                    // slutt communication
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '},';                                   // slutt representativ
        rc = fputs(%trimr(jsonstring) + LF: File_o);
      //-----------------------------------------------------------------------------------

      //-----------------------------------------------------------------------------------
        // releasedConfirmation
        jsonstring = '¬releasedConfirmation¬:[';             // start releasedConfirmation
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '{';                                    // {
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        xtxt801 = EMRCEM;
        xn53 = 50;
        exsr knvst;
        jsonstring = '¬emailAddress¬:¬'+%trim(XTXT802)+'¬';
        jsonfix ( jsonstring );
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = '}';                                    // }
        rc = fputs(%trimr(jsonstring) + LF: File_o);

        jsonstring = ']';                                    // slutt releasedConfirmation
        rc = fputs(%trimr(jsonstring) + LF: File_o);
      //-----------------------------------------------------------------------------------

        endsr;

        //*********************
        Begsr OpdEDIS;
        //*********************
        chain ('S': 'EXPREM') ecmsg1;
        chain 1 edic;
        csn = csn + 1;
        update edicr;
        s0004 = ECIIDI;
        s0010 = ECIIDC;
        s0020 = 'EF' + %TRIM(UPRO);
        s0026 = 'SADEXJSON';
        ssn   = CSN;
        ssr   = 'S';
        sst   = 'B';
        select;
        when emst2 = 'S';
          s0036 = 1;
        when emst2 = 'D';
          s0036 = 2;
        when emst2 = 'R';
          s0036 = 3;
        endsl;
        sdt   = %dec(wdt:8:0);
        stm   = %dec(wtm:6:0);
        slib  = '*LIB';
        sfile = '*IFS';
        smbr  = *BLANKS;
        sifs  = WFilNam;
        write edisr;

        endsr;

        //*********************
        Begsr knvst;
        //*********************

        xn51 = 0;
        xn52 = 0;
        xn54 = xn53 - 4;
        xn55 = xn53 - 5;
        xn56 = xn53 - 6;
        XTXT802 = *blanks;

        dow xn51 < 80;                                                        // 1<b
          xn51 = xn51 + 1;
          if XT801(XN51) = '&' OR XT801(XN51) = '"' OR                        // 2<b
             XT801(XN51) = 'Æ' OR XT801(XN51) = 'Ø' OR XT801(XN51) = 'Å' OR
             XT801(XN51) = 'æ' OR XT801(XN51) = 'ø' OR XT801(XN51) = 'å' OR
             XT801(XN51) = X'5A' OR XT801(XN51) = X'8E' OR                    // , ¤->' '
             XT801(XN51) = X'B0' OR XT801(XN51) = X'B2' OR
             XT801(XN51) = X'71' OR XT801(XN51) = X'54' OR
             XT801(XN51) = X'74' OR XT801(XN51) = X'58' OR
             XT801(XN51) = X'7D' OR XT801(XN51) = X'EC' OR
             XT801(XN51) = X'90' OR XT801(XN51) = X'63' OR                    //      , Ä->AA
             XT801(XN51) = X'FC' OR XT801(XN51) = X'CC' OR                    //      , ö->oe
             XT801(XN51) = X'43' OR XT801(XN51) = X'55' OR                    // ä->aa, í->i
             XT801(XN51) = X'62' OR XT801(XN51) = X'51' OR                    // Â->A,  é->e
             XT801(XN51) = X'42' OR XT801(XN51) = X'CE' OR                    // â->aa, ó->o
             XT801(XN51) = X'63' OR XT801(XN51) = X'64' OR                    // À->A,  À->A
             XT801(XN51) = X'65' OR XT801(XN51) = X'5B' OR                    // Á->A,  Å->A
             XT801(XN51) = X'41' OR XT801(XN51) = XAPS OR                     // '41'->' ',
             XT801(XN51) = '<' OR XT801(XN51) = '>';

            if XN52 < XN53;                                                   // 3<b
              xn52 = xn52 + 1;

              select;                                                         // 4<-b
              when XT801(XN51) = 'Æ' OR XT801(XN51) = X'63';                  // 4
                if XN51 < XN55;                                               // 5<-b
                  %SUBST(XTXT802:XN52:2) = 'AA';
                  xn52 = xn52 + 1;
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = 'Ø' OR XT801(XN51) = X'8E'                   // 4
                  OR XT801(XN51) = X'B2';
                if XN51 < XN55;                                               // 5<-b
                  %SUBST(XTXT802:XN52:2) = 'OE';
                  xn52 = xn52 + 1;
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = 'Å';                                         // 4
                if XN51 < XN55;                                               // 5<-b
                  %SUBST(XTXT802:XN52:2) = 'AE';
                  xn52 = xn52 + 1;
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = 'æ' OR XT801(XN51) = X'43'                   // 4
                  OR XT801(XN51) = X'42';
                if XN51 < XN55;                                               // 5<-b
                  %SUBST(XTXT802:XN52:2) = 'aa';
                  xn52 = xn52 + 1;
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = 'ø' OR XT801(XN51) = X'B0'                   // 4
                  OR XT801(XN51) = X'7D' OR XT801(XN51) = X'CC';
                if XN51 < XN55;                                               // 5<-b
                  %SUBST(XTXT802:XN52:2) = 'oe';
                  xn52 = xn52 + 1;
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = 'å';                                         // 4
                if XN51 < XN55;                                               // 5<-b
                  %SUBST(XTXT802:XN52:2) = 'ae';
                  xn52 = xn52 + 1;
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = X'5A';                                       // 4
                if XN51 < XN55;                                               // 5<-b
                  XT802(XN52) = '.';
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = X'71' OR XT801(XN51) = X'54'                 // 4
                  OR XT801(XN51) = X'74';
                if XN51 < XN55;                                               // 5<-b
                  XT802(XN52) = 'E';
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = X'58' OR XT801(XN51) = X'55';                // 4
                if XN51 < XN55;                                               // 5<-b
                  XT802(XN52) = 'i';
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = X'7D';                                       // 4
                if XN51 < XN55;                                               // 5<-b
                  %SUBST(XTXT802:XN52:5) = '&apos;';
                  xn52 = xn52 + 5;
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = X'EC';                                       // 4
                if XN51 < XN55;                                               // 5<-b
                  XT802(XN52) = 'O';
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = X'90';                                       // 4
                if XN51 < XN55;                                               // 5<-b
                  XT802(XN52) = X'5F';
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = X'FC';                                       // 4
                if XN51 < XN55;                                               // 5<-b
                  XT802(XN52) = 'U';
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-b
              when XT801(XN51) = X'62' OR XT801(XN51) = X'63'                 // 4
                  OR XT801(XN51) = X'64' OR XT801(XN51) = X'65'
                  OR XT801(XN51) = X'5B';
                if XN51 < XN55;                                               // 5<-b
                  XT802(XN52) = 'A';
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = X'51';                                       // 4
                if XN51 < XN55;                                               // 5<-b
                  XT802(XN52) = 'e';
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = X'CE';                                       // 4
                if XN51 < XN55;                                               // 5<-b
                  XT802(XN52) = 'o';
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = X'41';                                       // 4
                if XN51 < XN55;                                               // 5<-b
                  XT802(XN52) = ' ';
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = '&';                                         // 4
                if XN51 < XN55;                                               // 5<-b
                  %SUBST(XTXT802:XN52:5) = '&amp;';
                  xn52 = xn52 + 4;
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = '"';                                         // 4
                if XN51 < XN55;                                               // 5<-b
                  %SUBST(XTXT802:XN52:5) = '&quot;';
                  xn52 = xn52 + 5;
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = XAPS;                                        // 4
                if XN51 < XN55;                                               // 5<-b
                  %SUBST(XTXT802:XN52:5) = '&apos;';
                  xn52 = xn52 + 5;
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = '>';                                         // 4
                if XN51 < XN55;                                               // 5<-b
                  %SUBST(XTXT802:XN52:5) = '&gt;';
                  xn52 = xn52 + 3;
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              when XT801(XN51) = '<';                                         // 4
                if XN51 < XN55;                                               // 5<-b
                  %SUBST(XTXT802:XN52:5) = '&lt;';
                  xn52 = xn52 + 3;
                else;                                                         // 5
                  xn52 = xn52 - 1;
                endif;                                                        // 5<-e
              other;                                                          // 4
                if xn52 < xn53;                                               // 5<-b
                  xn52 = xn52 + 1;
                  XT802(XN51) = XT801(XN52);
                else;                                                         // 5
                  leave;
                endif;                                                        // 5<-e
              endsl;                                                          // 4<-e
            endif;                                                            // 3<-e
          else;                                                               // 2
            if XN52 < XN53;                                                   // 3<-b
              xn52 = xn52 + 1;
              XT802(XN52) = XT801(XN51);
            else;                                                             // 3
              leave;
            endif;                                                            // 3<-e
          endif;                                                              // 2<-e
        enddo;                                                                // 1<-e

        if XTXT802 = *BLANKS;
        //  XTXT802 = '.';
        endif;

        endsr;

        //*********************
        Begsr init;
        //*********************

        // hent turheader
        empro_a = upro;

        syge15c (wdt: wtm);
        x_idag = %dec(wdt:8:0);
        x_tid = %dec(wtm:6:0);
        xaps = x'7D';               // Apstroff

        // Åpne dataarea
        IN EDIDTA;

        endsr;

        //*********************
        Begsr ByggFlr;
        //*********************

        Fldr = %TRIM(XLIB) + '/EXPRESSMANIFEST/';
        ARC040C1 (Fldr);

        Fldr = %TRIM(XLIB) + '/EXPRESSMANIFEST/json_Ut';
        ARC040C1 (Fldr);

        Fldr = %TRIM(XLIB) + '/EXPRESSMANIFEST/json_Ut/Temp';
        ARC040C1 (Fldr);

        Fldr = %TRIM(XLIB) + '/EXPRESSMANIFEST/json_Ut/Backup';
        ARC040C1 (Fldr);

        // for Oscar/Java-bruk
        Fldr = %TRIM(XLIB) + '/EXPRESSMANIFEST/json_Ut/error';
        ARC040C1 (Fldr);

        Fldr = %TRIM(XLIB) + '/EXPRESSMANIFEST/json_Ut/sent';
        ARC040C1 (Fldr);

        Fldr = %TRIM(XLIB) + '/EXPRESSMANIFEST/json_Inn';
        ARC040C1 (Fldr);

        Fldr = %TRIM(XLIB) + '/EXPRESSMANIFEST/json_Inn/Backup';
        ARC040C1 (Fldr);

        // BAT = Batch / for Java sende motoren
        Fldr = %TRIM(XLIB) + '/EXPRESSMANIFEST/BAT';
        ARC040C1 (Fldr);

        // automatistere også denne (lage egen CL ?)
        // også kopiere  /apache/express-client/upload-engine-expressmanif-client.jar
        //          til  .../BAT/upload-engine-expressmanif-client.jar

        endsr;

      /end-free
