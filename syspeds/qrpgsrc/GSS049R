********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
P090xx* 01 SH  PTF9 INNFØRT TURNIVÅ   ......
P090xx* 02 SH  PTF9 videreføring tur  ......
********************************************************************
      *
      ***********************************************************
      *** PROGRAM SKAL AUTOBEREGNE FAKTURABASIS               ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      ***********************************************************
      *
     FDOKOTH    UF A E           K DISK
     FDOKOTHP   IF   E           K DISK
     F                                     RENAME(DOKOTR:DOKOTRPRO)
     FDOKEF     UF A E           K DISK
     FDOKEFP    IF   E           K DISK
     F                                     RENAME(DOKEFR:DOKEFRPRO)
     FKODTGE    IF   E           K DISK
     FGSSOVF    UF A E           K DISK
N02  FGSSTUR    UF A E           K DISK
     FGSSORF    IF   E           K DISK
N01  FGSSORL21  IF   E           K DISK
N01  F                                     RENAME(GSSORFR:GSSOR21)
     FHEADFP    IF   E           K DISK
     F                                     RENAME(HEADFR:HEADFRPRO)
     FHEADF     UF A E           K DISK
     FFAK2      UF   E           K DISK
     FFIRM      IF   E           K DISK
     FTELL      UF A E           K DISK
     FKODTV     IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     D                UDS
     D  UFIRM                  1      2
     D                 DS
EV5  D  HEDTRÅ                 1      4  0
EV5  D  HEDTRM                 5      6  0
EV5  D  HEDTRD                 7      8  0
EV5  D  HEDTR                  1      8  0
NV5  D  HEDTÅ                  1      4  0
NV5  D  HEDTM                  5      6  0
NV5  D  HEDTD                  7      8  0
NV5  D  HEDTOP                 1      8  0
     D                 DS
EV5  D  ORTNO                  1     11  0
EV5  D  ORAVD                  1      4  0
EV5  D  OROPD                  5     11  0
      *
     C                   EXSR      INIT
      *
N02  C     utno          ifeq      *zeros
     C                   EXSR      BEREGN
N02  c                   end
      *
     c                   seton                                        lr
     c                   return
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
      *
N02  C     KEYWRK        KLIST
N02  C                   KFLD                    ORTNO
N02  C                   KFLD                    KUNDE
N02  C                   KFLD                    ORBCD
N02  C     KEYWRKS       KLIST
N02  C                   KFLD                    ORTNO
     C     KEYHEA        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     KODGEK        KLIST
     C                   KFLD                    KGEUNI
     C                   KFLD                    FAVK
     C                   MOVE      'GE'          KGEUNI
      *
     C     KEYB          KLIST                                                  CUNDL01
     C                   KFLD                    FIFIRM                         CUNDL01
     C                   KFLD                    ORCNO                          CUNDL01
      *
      *
     C     KEYD          KLIST                                                  HEADF
     C                   KFLD                    HEAVD                          HEADF
     C                   KFLD                    HEOPD                          HEADF
      *
      * flyfraktbrev
      *
     C     KEYDF         KLIST                                                  HEADF
     C                   KFLD                    STAFFF            1
     C                   KFLD                    HEAVD                          HEADF
     C                   KFLD                    HEOPD                          HEADF
     C                   KFLD                    LOP001            3 0
     C                   move      'F'           STAFFF
     C                   z-add     1             LOP001
      *
      *
     C     KEYU          KLIST                                                  HEADF
     C                   KFLD                    UAVD                           HEADF
     C                   KFLD                    UOPD                           HEADF
      *
      *
      * flyfraktbrev
      *
     C     KEYUF         KLIST                                                  HEADF
     C                   KFLD                    STAFFF            1
     C                   KFLD                    UAVD                           HEADF
     C                   KFLD                    UOPD                           HEADF
     C                   KFLD                    LOP001            3 0
      *
     C     KEYV          KLIST                                                  CUNDL01
     C                   KFLD                    UONO                           CUNDL01
     C                   KFLD                    MAX               3 0          CUNDL01
     c                   z-add     999           max
      *
      *
     C     KEYSLE        KLIST                                                  CUNDL01
     C                   KFLD                    UONO                           CUNDL01
     C                   KFLD                    MIN               3 0          CUNDL01
     c                   z-add     0             MIN
      *
     C     KEYE          KLIST                                                  KODTV
     C                   KFLD                    WVUNI                          KODTV
     C                   KFLD                    HEAVD                          KODTV
      *
     C                   MOVE      'V'           WVUNI             1
      *
     C     *ENTRY        PLIST
     C                   PARM                    UONO              7 0
N01  C                   PARM                    UTNO             11 0
      *
     c                   movel     utno          uavd              4 0
     c                   move      utno          uopd              7 0
      * les firma info
      *
     C                   read      firm                                   33
      *
NV5  C     UYEAR         IFGT      50
NV5  C                   MOVE      '19'          UCENT             2 0
NV5  C                   ELSE
NV5  C                   MOVE      '20'          UCENT
NV5  C                   END
      * tur relatert
N01  C     UTNO          IFNE      0
N01  C                   EXSR      SRTUR
     C                   GOTO      UTINI
N01  C                   END
     C     UONO          CHAIN     GSSORF                             27
      *
     C     ORTNO         IFNE      *zeros
     C                   move      oravd         heavd
     C                   move      oropd         HEOPD
     c     keyhea        chain     headfp                             33
     c     *in33         ifeq      '0'
     c                   exsr      srdest
     c                   end
     c                   end
      *
     c                   exsr      srneste
     C     UTINI         ENDSR
      *
     C***********************************************
     C     SRNESTE       BEGSR
     C***********************************************
      *
     c                   setoff                                       33
     c     keyv          setgt     GSSOVF
     C     UONO          readpe(n) GSSOVF                                 33
     C   33              z-add     0             neste             3 0
     C  n33              z-add     ovlno         neste
      *
     c                   endsr
     C***********************************************
     C     SRDEST        BEGSR
     C***********************************************
      *
     c                   move      heavd         xxavd             4
     c                   move      heur          xxur              1
     c                   move      helka         xxlka             2
     c                   move      hesdf         xxsdf             5
     c                   move      hesdff        xxsdff            5
     c                   move      hesdt         xxsdt             5
     c                   move      hesdvt        xxsdvt            5
     c                   clear                   headfr
     C                   move      xxavd         heavd
     c                   move      xxur          heur              1
     c                   move      xxlka         helka             2
     c                   move      xxsdf         hesdf             5
     c                   move      xxsdff        hesdff            5
     c                   move      xxsdt         hesdt             5
     c                   move      xxsdvt        hesdvt            5
     c                   endsr
     C***********************************************
     C     BEREGN        BEGSR
     C***********************************************
      * Hente avdeling
     C     KEYE          CHAIN     KODTV                              30
      * Hente kunde
     C     KEYB          CHAIN     CUNDL01                            30
      *
      * Add av record til HEADF.
      *
     c     heavd         ifeq      *zeros
     C                   read(n)   tell                                   52
     c  N52              z-add     teavd         heavd
     c                   end
     C     HEAVD         CHAIN     TELL                               52
     C     *IN52         IFEQ      '0'
     C                   MOVE      TEOPDN        HEOPD
     C                   ADD       1             TEOPDN
     C                   UPDATE    TELLR
     C                   ELSE
     C                   Z-ADD     HEAVD         TEAVD
     C                   Z-ADD     1             HEOPD
     C                   Z-ADD     1             TEOPDN
     C                   WRITE     TELLR
     C                   END
      *
     C     KEYD          CHAIN     HEADF                              52
     C* N71              MOVE      WELKAF        HELKA
     C*  71              MOVE      WELKAT        HELKA
     C                   MOVE      'S'           ZSK               1
     C     ZSK           IFNE      ' '
     C     ZSK           IFEQ      'S'
     C                   MOVE      '1'           *IN71
     C                   ELSE
     C                   MOVE      '0'           *IN71
     C                   END
     C                   END
     C*                  MOVE      ZESDFF        HESDFF
     C*                  MOVE      ZELKS         HELKS
     C*                  MOVE      ZELKK         HELKK
     c     heur          ifeq      *blank
     C                   MOVE      'D'           HEUR
     c                   end
     C*                  MOVE      ZEKDPL        HEKDPL
     C*                  MOVE      WUSR          HESG
     C                   movel     ORLC          hesdl
     C                   MOVE      *ZEROS        HESTD
     C                   MOVE      *ZEROS        HENTVS
     C                   MOVE      *ZEROS        HEPRO
     C*                  MOVE      ZESDVT        HESDVT
     C                   MOVE      UDAY          HEDTD
     C                   MOVE      UMONTH        HEDTM
     C     UCENT         MULT      100           HEDTÅ
     C                   MOVE      UYEAR         HEDTÅ
     C*                  MOVE      ZESDF         HESDF
     C*                  MOVE      ZESDT         HESDT
     C                   MOVE      *ZEROS        HEKNA
      *_________Selger________*                   N71=Kjøper  71=Selger
     C  N71              MOVE      *ZEROS        HEKNS
     C   71              MOVE      ORCNO         HEKNS
     C  N71              MOVE      'X'           HEKDFS
     C   71              MOVE      ' '           HEKDFS
     C  N71              MOVE      '   '         HEVALS
     C   71              MOVE      FICURR        HEVALS
     C  N71              MOVE      *ZEROS        HEKNSF
     C   71              MOVE      ORCNO         HEKNSF
     C  N71              MOVE      *ZEROS        HEANS
     C*  71              MOVE      ZEANK         HEANS
     C  N71              MOVE      *BLANKS       HENASF
     C*  71              MOVEL     KNAVN         HENASF
      *_________Selger________*
      *_________Kjøper________*
     C  N71              MOVE      ORCNO         HEKNK
     C   71              MOVE      *ZEROS        HEKNK
     C  N71              MOVE      ' '           HEKDFK
     C   71              MOVE      'X'           HEKDFK
     C  N71              MOVE      FICURR        HEVALK
     C   71              MOVE      '   '         HEVALK
     C  N71              MOVE      ORCNO         HEKNKF
     C   71              MOVE      *ZEROS        HEKNKF
     C* N71              MOVE      ZEANK         HEANK
     C   71              MOVE      *ZEROS        HEANK
     C* N71              MOVEL     KNAVN         HENAKF
     C   71              MOVE      *BLANKS       HENAKF
      *_________Kjøper________*
     C                   MOVE      OROT          HEOT
     C                   MOVE      *BLANKS       HEPOS1
     C                   MOVE      ORFR          HEFR
     c     HEOT          ifeq      *blanks
     c                   move      'SS'          HEOT
     C                   END
      * turnivå
N01  C     utno          ifne      *zeros
N01  C                   Move      'S*'          heot
N01  C                   end
     c     HEFR          ifeq      *blanks
     c                   move      'FCA'         HEFR
     C                   END
     C                   Z-ADD     ORCLI         HENT
     C                   Z-ADD     ORWT          HEVKT
     C                   Z-ADD     ORWT          HEFBV
     C                   Z-add     ORVOL         HEM3
      * turnivå
N01  C     utno          ifne      *zeros
N01  C                   z-add(H)  sumvkt        hevkt
N01  C                   Z-ADD(H)  sumant        HENT
N01  C                   z-add(H)  SUMVOL        HEM3
N01  C                   z-add(H)  SUMFBV        HEFBV
N01  c                   end
     C*                  MOVE      ZELM          HELM
     C                   MOVE      *ZEROS        HEDTMP
     C                   MOVE      *ZEROS        HEDTÅP
NV5  C                   MOVE      *ZEROS        HEDTCP
     C                   MOVE      *ZEROS        HEKNT
     C                   MOVE      *ZEROS        HEBELT
     C                   MOVE      *ZEROS        HEBELM
     C                   MOVE      *ZEROS        HEVN
     C                   MOVE      *ZEROS        HETRM
     C                   MOVE      *ZEROS        HETRC
     C* ordrenivå
N01  C     utno          ifeq      *zeros
     C     HELM          MULT(H)   KOVLKG        XFBV1             5 0
     C     HEM3          MULT(H)   KOVKKG        XFBV2             5 0
     C     HEVKT         IFGE      XFBV1
     C                   Z-ADD(H)  HEVKT         HEFBV
     C                   ELSE
     C                   Z-ADD(H)  XFBV1         HEFBV
     C                   END
     C     HEFBV         IFLT      XFBV2
     C                   Z-ADD     XFBV2         HEFBV
     C                   END
     C                   END
     C*
NV5  C     UCENT         MULT      100           HEDTRÅ
     C                   MOVE      UYEAR         HEDTRÅ
     C                   MOVE      UMONTH        HEDTRM
     C                   MOVE      UDAY          HEDTRD
     C                   MOVE      *ZEROS        HEFBK
     C                   MOVE      *ZEROS        HEFNGK
     C                   MOVE      *ZEROS        HEFNGS
     C                   MOVE      *BLANKS       HEPOS1
s03  C*                  MOVE      *ZEROS        HEVALP
N04  C     HEVALT        IFEQ      *BLANKS
N04  C     HEUR          IFEQ      'A'
N04  C     HEUR          OREQ      'C'
N04  C     HEUR          OREQ      'F'
N04  C     HEKNKF        IFNE      *ZEROS
N04  C     HEKDFK        ANDNE     'X'                                          VED IMPORT..
N04  C                   MOVE      HEKNKF        UKNOP                          PRIM. KJØPER
N04  C                   ELSE
N04  C                   MOVE      HEKNSF        UKNOP                          SEK. SELGER
N04  C                   END
N04  C                   ELSE
N04  C     HEKNSF        IFNE      *ZEROS
N04  C     HEKDFS        ANDNE     'X'                                          VED EKSPORT
N04  C                   MOVE      HEKNSF        UKNOP                          PRIM. SELGER
N04  C                   ELSE
N04  C                   MOVE      HEKNKF        UKNOP                          SEK. KJØPER
N04  C                   END
N04  C                   END
N04  C                   MOVE      *ZEROS        UVALP
N04  C                   CALL      'SYFA24B'
N04  C                   PARM      HEUR          UVUR              1
N04  C                   PARM      HEAVD         UAVDOP            4 0
N04  C                   PARM                    UKNOP             8 0
N04  C                   PARM                    HEVALT
N04  C                   PARM                    UVALP             3 1
N04  C                   MOVE      UVALP         HEVALP
N04  C                   END
     C                   MOVE      *ZEROS        HENTF
     C                   movel     orono         HEGN
     C                   WRITE     HEADFR
     C                   MOVE      FIFIRM        UFIRM
     C  N71              MOVE      'K'           UKODE
     C   71              MOVE      'S'           UKODE
      * Kall på eksternt program.
     C                   Z-ADD     0             UFLAGG
     C                   MOVE      'SSKALK'      USECUR
     C                   MOVE      'NY'          WNYGML            2
     C                   CALL      'SYFI10X'
     C                   PARM                    UFIRM                          FIRMAKODE
     C                   PARM                    HEAVD                          AVDELING
     C                   PARM                    HEOPD                          OPDNR
     C                   PARM                    WNYGML            2            NY=N GML=G
     C                   PARM                    KO2UTL            1            UTL PROV
     C                   PARM                    XKUTL             4 2          UTLP SATS
     C                   PARM                    XSUTL             4 2          UTLP SATS
     C                   PARM                    XKUMIN            2 0          UTLP MIN
     C                   PARM                    XSUMIN            2 0          UTLP MIN
     C                   PARM                    KO2MVK            1            MVA KJØPER
     C                   PARM                    KO2MVS            1            MVA SELGER
     C                   PARM                    UKFRA             7 0          =0
     C                   PARM                    KOVAVR            1            OVERST.AVRUN
     C                   PARM                    WSMSG            62            DS
     C                   PARM                    WSMELD            1            =*BLANK
     C                   PARM                    UFLAGG            1 0          =0
     C                   PARM                    UKODE             1
     C     USECUR        PARM      USECUR        USECUR            6            =*SECUR
      *
N01  C     UTNO          ifeq      *zeros
     c                   exsr      tilfil
     C                   end
     c                   ENDSR
      *
     C***********************************************
     C     TILFIL        BEGSR
     C***********************************************
     C     keyd          setll     fak2
     C                   setoff                                       37
     C     *in37         doweq     '0'
     c     keyd          reade     fak2                                   37
     c     *in37         ifeq      '0'
     c                   exsr      movwov
     C                   WRITE     GSSOVFR
     c                   end
     c                   end
     c                   endsr
     C***********************************************
     C     SLETTGMT      BEGSR
     C***********************************************
      * SLETTER GAMLE
     c                   setoff                                       35
     c     keysle        setll     GSSOVF
     c                   setoff                                       35
     c     *in35         doweq     '0'
     C     UONO          reade     GSSOVF                                 35
     c  N35favk          ifeq      OVFEEC
     c                   delete    GSSOVFR
     c                   endif
     c                   enddo
      *
     c                   exsr      srneste
     c                   endsr
     C***********************************************
     C     MOVWOV        BEGSR
     C***********************************************
     c                   add       1             OVLNO
     C                   MOVE      UONO          OVONO
     C                   MOVE      FAVK          OVFEEC
     C                   MOVE      FAVAL         OVCURC
     C                   MOVE      FABELV        OVAMT
N01  C     utno          ifne      *zeros
N01  c     ORWT          DIV(H)    SUMVKT        FAKTOR           19 9
N01  c                   mult(h)   faktor        OVAMT
N01  c                   end
      *
     C                   MOVE      *blanks       OVFT
     C                   MOVE      FAKDM         OVVAT
N01  C                   IF        ORLC = 'ONWAY'
N01  C                   MOVE      ORLC2         OVLC
N01  C                   ELSE
     C                   MOVE      ORLC          OVLC
N01  C                   END
     C                   MOVE      *BLANKS       OVST
      *
     C     KODGEK        CHAIN     KODTGE                             33
     C  N33              MOVEL     KGEENT        ovFT
     C                   ENDSR
N01   *************************************************************
N01  c     SRTUR         BEGSR
N01   *************************************************************
N01  c     keyturb       klist
N01  c                   kfld                    ortno
N01  c                   kfld                    orbcd
N01  c     keytur        klist
N01  c                   kfld                    ortno
N01  c                   z-add     utno          ortno
N02   * slett gamle fra workfile
N02  C                   EXSR      SRTURS
      *
N02   * hent alle ordre og skriv til workfile
      *
N01  c     Keytur        SETLL     gssorl21
N01  c     LESHED        TAG
N01  c     keytur        READE     gssorl21                               66
N01  c     *IN66         IFEQ      *OFF
n02  c     keyb          chain     cundl01                            67
n02  c                   move      orcno         kunde
n02  c     *in67         ifeq      '0'
n02  c     aknrku        andne     0
n02  c                   move      aknrku        kunde
n02  c                   end
N01  c     uono          ifeq      *zeros
N01  c                   z-add     orono         uono
N01  c                   end
     C*  finn fraktvekt
     C     orvol         MULT      KOVKKG        XFBV2             5 0
     C                   Z-ADD     orwt          xxxfbv            9 0
     C     xxxfbv        iflt      XFBV2
     C                   Z-ADD     XFBV2         xxxfbv
     C                   END
n02  c     keywrk        chain     gsstur                             68
n02  c     *in68         ifeq      '0'
      * summer ved lik kunde båt
N01  c                   ADD       orwt          sumvkt            9 1
N01  C                   ADD       ORCLI         sumant            9 0
N01  C                   ADD       ORVOL         sumVOL            7 2
     C                   ADD       XXXfbv        sumfbv            9 1
     C*
N02  C                   UPDATE    GSSTURR
n02  c                   else
N02  c                   Z-ADD     orwt          sumvkt            9 1
N02  C                   Z-ADD     ORCLI         sumant            9 0
N02  C                   Z-ADD     ORVOL         sumVOL            7 2
     C                   z-add     XXXfbv        sumfbv            9 1
N02  C                   WRITE     GSSTURR
n02  c                   end
N01  c                   GOTO      LESHED
N01  c                   ENDIF
n02   *
n02   * beregn verdier
n02   *
n02  c                   exsr      srturb
n02   *
N01  c                   ENDSR
N02   *************************************************************
N02  c     SRTURS        BEGSR
N02   *************************************************************
N02   * slette evt gamle records
N02  c                   setoff                                       66
N02  c     Keywrks       SETLL     gsstur
N02  c     *in66         doweq     '0'
N02  c     keywrks       READE     gsstur                                 66
N02  c     *in66         ifeq      '0'
N02  c                   delete    gssturr
N02  c                   end
N02  c                   end
n02  c                   setoff                                       66
N02  c                   endsr
N02   *************************************************************
N02  c     SRTURB        BEGSR
N02   *************************************************************
N02   * beregner beløp pr linje
N02  c                   setoff                                       66
N02  c     Keywrks       SETLL     gsstur
N02  c     *in66         doweq     '0'
N02  c     keywrks       READE(N)  gsstur                                 66
N02  c     *in66         ifeq      '0'
n02  c                   move      kunde         orcno
     c*
     c                   clear                   headfr
     c     KEYU          CHAIN     HEADFP                             33
     C**                 EXSR      SRDEST
N02  c                   exsr      beregn
s02  C                   exsr      tilfilt
     C     heur          ifeq      'D'
     c                   exsr      kopifly
     c                   end
N02  c*                  move      faval         val
N02  c*                  z-add     fabelv        belop
n02  c*                  update    gssturr
N02  c                   end
N02  c                   end
n02  c                   setoff                                       66
N02  c                   endsr
N01  C***********************************************
N01  C     TILFILT       BEGSR
N01  C***********************************************
      * skriver beregnede verdier til ordrefil
      *
N01  C     keyd          setll     fak2
N01  C                   setoff                                       37
N01  C     *in37         doweq     '0'
N01  c     keyd          reade     fak2                                   37
N01  c     *in37         ifeq      '0'
N01  c     Keyturb       SETLL     gssorl21
N01  C                   SETOFF                                       34
N01  C     *in34         doweq     '0'
N01  c     keyturb       READE     gssorl21                               34
N01  c     *in34         ifeq      '0'
N01  c                   z-add     orono         uono
     c                   exsr      slettgmt
N01  c                   exsr      movwov
N01  C                   WRITE     GSSOVFR
N01  c                   end
N01  c                   end
N01  c                   end
N01  c                   end
N01  c                   endsr
      *
N01  C***********************************************
N01  C     KOPIFLY       BEGSR
N01  C***********************************************
      * flyfraktbrev etc kopieres
      *
     C     keydf         chain     dokef                              36
     c  N36              delete    dokefr
     c     keyuf         chain     dokefp                             36
     c     *in36         ifeq      '0'
     c                   z-add     heavd         dfavd
     c                   z-add     heopd         dfopd
     c                   write     dokefr
     c                   end
      * tilleggsgebyrer  kopieres
      *
     C     keyd          setll     dokoth
     c                   setoff                                       36
     c     *in36         doweq     '0'
     c     keyd          reade     dokoth                                 36
     c     *in36         ifeq      '0'
     c                   delete    dokotr
     c                   end
     c                   end
      *
      *
     C     keyu          setll     dokothp
     c                   setoff                                       36
     c     *in36         doweq     '0'
     c     keyu          reade     dokothp                                36
     c     *in36         ifeq      '0'
     c                   z-add     heavd         doavd
     c                   z-add     heopd         doopd
     c                   z-add     1             dolop
     c                   write     dokotr
     c                   end
     c                   end
     c                   endsr
      *
