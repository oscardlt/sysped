     FSVNH      IF   E           K DISK
     FSVNL      IF   E           K DISK
     FSVL006P   O    E             PRINTER USROPN
     FARKTXT    IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FarkivP    O  A E           K DISK
     FKODTP     IF   E           K DISK
     FKODTFM    IF   E           K DISK
     FFIRM      IF   E             DISK
     FKODTA     IF   E           K DISK
     FSVTHA     IF   E           K DISK
     FSVL006D   CF   E             WORKSTN
     F                                     INFDS(FBAREA)
      *___________________________
      * Finner username
      *"""""""""""""""""""""""""""
     D                SDS
     D  ZUSER                254    263
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     D                 DS
     D  ØN154                  1     15  4
     D  ØA154H                 1     11
     D  ØA154X                 7     11
     D  ØA154D                12     15
     D                 DS
     D  ØA10                   1     10
     D  Ø10                    1     10
     D                                     DIM(10)                              Num edit
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    UTIAVD            4
     C                   PARM                    UTITDN            7
     C                   PARM                    CALLTYP           1
     C                   MOVE      UTIAVD        U_TIAVD
     C                   MOVE      UTITDN        U_TITDN
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    TIAVD         U_TIAVD
     C     *LIKE         DEFINE    TITDN         U_TITDN
     C     *LIKE         DEFINE    KOPUNI        UOPUNI
     C     *LIKE         DEFINE    KOPAVD        UOPAVD
     C     *LIKE         DEFINE    KOPLNR        UOPLNR
     C     *LIKE         DEFINE    KFMSD         UFMSD1
     C     *LIKE         DEFINE    KFMSD         UFMSD3
     C     *LIKE         DEFINE    KOAUNI        WKOAUNI
     C     *LIKE         DEFINE    WR31A         XR31
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYA          KLIST
     C                   KFLD                    U_TIAVD
     C                   KFLD                    U_TITDN
     C     KEYP          KLIST
     C                   KFLD                    UOPUNI
     C                   KFLD                    UOPAVD
     C                   KFLD                    UOPLNR
     C     KEYF1         KLIST
     C                   KFLD                    KOPFM
     C                   KFLD                    UFMSD1
     C     KEYF3         KLIST
     C                   KFLD                    KOPFM
     C                   KFLD                    UFMSD3
     C     KEYKODTA      KLIST
     C                   KFLD                    WKOAUNI
     C                   KFLD                    TIAVD
      *_____________
      * Init av felt
      *"""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           WDT80             8 0
     C                   EVAL      UOPUNI='P'
     C                   EVAL      UOPAVD=U_TIAVD
     C                   EVAL      UOPLNR=251
     C                   EVAL      UFMSD1=1
     C                   EVAL      UFMSD3=3
     C                   Z-ADD     1024          UCMDL            15 5
     C                   MOVE      *BLANKS       UCMD           1024
     C                   Z-ADD     0             ØX                2 0
     C                   MOVE      *BLANKS       ØAN              12
     C                   EVAL      WKOAUNI='A'
      *______________________________________
      * Hente firmaopplysninger fra spedisjon
      *""""""""""""""""""""""""""""""""""""""
     C                   READ      FIRM
      *_____________________
      * Hente printerstyring
      *"""""""""""""""""""""
     C     KEYP          CHAIN     KODTP                              33
      *_______________
      * Printerstyring ikke ved arkiv
      *"""""""""""""""
     C     calltyp       ifne      'A'
     C     koplas        andne     'P'
N01  C     koplas        andne     'F'
     C                   OPEN      SVL006P
     C                   EVAL      UCMD='OVRPRTF FILE(SVL006P) OUTQ('
      *
     C     UCMD          CAT       KOPNVN:0      UCMD
     C     UCMD          CAT       ')':0         UCMD
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     c                   end
      *
      * PDF vdirekte print
     C     KOPLAS        IFEQ      'P'
N01  C     KOPLAS        oreq      'F'
s01  C*    calltyp       andne     'A'
N01  C     calltyp       ifne      'A'
     C                   CALL      'SVL006C'
     C                   PARM                    KOPNVN
     C                   OPEN      SVL006P
N01  c                   end
     C                   END
      * arkivering
     C     calltyp       ifeq      'A'
     C                   CALL      'SVL006CA'
     C                   OPEN      SVL006P
     C                   END
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Start av file                                        SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
     C     KEYA          CHAIN     SVNH
      * Init av arbetsfælt
     C     KEYKODTA      CHAIN     KODTA
     C     TISG          CHAIN     SVTHA
     C                   MOVEL     TIDTF         WR54A
     C                   EVAL      WR54B=TINA
     C                   EVAL      WR54C=TITARF
     C     KEYF1         CHAIN     KODTFM

     C                   EVAL      WR06=TINTK
     C                   IF        NINTK > *ZEROS
     C                   EVAL      WR06=NINTK
     C                   ENDIF
     C                   EVAL      WR02A=TINAA
     C                   EVAL      WR02B=TIADA1
     C                   EVAL      WR02D=TIPNA
     C                   EVAL      WR02E=TIPSA
     C                   EVAL      WR02F=TILKA
     C                   EVAL      WR08A=TINA
     C                   EVAL      WR08B=TIAD1
     C                   EVAL      WR08D=TIPN
     C                   EVAL      WR08E=TIPS
     C                   EVAL      WR08F=TILK
     C                   EVAL      WR14A='Collicare Logistics AB'
     C                   EVAL      WR14B='Exportgatan 24'
     C                   EVAL      WR14D='422 46'
     C                   EVAL      WR14E='Hisings Backa'
     C                   EVAL      WR14F='SE'
     C                   MOVEL     TIDK          WR30
     C                   EVAL      WR31A='UPPLÆGGNINGSANMÆLAN'
N06  C                   EVAL      WR35=TIVKB
     C                   IF        NIVKB > *ZEROS
     C                   EVAL      WR35=NIVKB
     C                   ENDIF
N06  C                   EVAL      WR40=TITRNR
     C                   MOVEL     TIGN          WR49
     C

      *_______
      * Linjer
      *"""""""
     C                   EXSR      SRBA
      * Skriv

     C                   EXFMT     SVL006DA
     C                   IF        *IN12 = *OFF
     C                   WRITE     SVL006PA
     C     calltyp       ifeq      'C'
     C                   EXSR      ARKSR
     C                   end
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Varuposter                                          SRBA /
      *////////////////////////////////////////////////////////////
     C     SRBA          BEGSR

     C     KEYA          SETLL     SVNL
     C     KEYA          READE     SVNL                                   52
     C     *IN52         DOWEQ     *OFF

     C                   EVAL      XR31=*BLANKS
N06  C                   EVAL      ØN154=TVNT
     C                   IF        TVNT=*ZEROS
N06  C                   EVAL      ØN154=TVNTEH
     C                   ENDIF
N06  C                   EXSR      SRNE
N06  C                   MOVEL     ØAN           XR31
N06  C     XR31          CAT       TVEH:1        XR31
N06  C     XR31          CAT       TVVT:1        XR31

     C                   SELECT
     C     WR31B         WHENEQ    *BLANKS
     C                   EVAL      WR31B=XR31
     C     WR31C         WHENEQ    *BLANKS
     C                   EVAL      WR31C=XR31
     C     WR31D         WHENEQ    *BLANKS
     C                   EVAL      WR31D=XR31
     C     WR31E         WHENEQ    *BLANKS
     C                   EVAL      WR31E=XR31
     C     WR31F         WHENEQ    *BLANKS
     C                   EVAL      WR31F=XR31
     C     WR31G         WHENEQ    *BLANKS
     C                   EVAL      WR31G=XR31
     C     WR31H         WHENEQ    *BLANKS
     C                   EVAL      WR31H=XR31
     C     WR31I         WHENEQ    *BLANKS
     C                   EVAL      WR31I=XR31
     C     WR31J         WHENEQ    *BLANKS
     C                   EVAL      WR31J=XR31
     C     WR31K         WHENEQ    *BLANKS
     C                   EVAL      WR31K=XR31
     C     WR31L         WHENEQ    *BLANKS
     C                   EVAL      WR31L=XR31
     C     WR31M         WHENEQ    *BLANKS
     C                   EVAL      WR31M=XR31
     C                   ENDSL

     C     KEYA          READE     SVNL                                   52
     C                   ENDDO

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Venstrestill numeriske verdier                      SRNE /
      *////////////////////////////////////////////////////////////
     C     SRNE          BEGSR
      * Flytte in rett verdi i Alfa 12-felt
     C                   MOVE      *ZEROS        ØA10
     C     ØA154D        IFEQ      '0000'                                       <-------------I
     C                   MOVE      ØA154H        ØA10                                         I
     C                   ELSE                                                   <-------------I
     C                   MOVEL     ØA154X        ØA10                                         I
     C                   MOVE      ',    '       ØA10                                         I
     C                   MOVE      ØA154D        ØA10                                         I
     C     Ø10(10)       IFEQ      '0'
     C                   MOVE      ' '           Ø10(10)
     C     Ø10(9)        IFEQ      '0'
     C                   MOVE      ' '           Ø10(9)
N06  C     Ø10(8)        IFEQ      '0'
N06  C                   MOVE      ' '           Ø10(8)
N06  C                   END
     C                   END
     C                   END
     C                   END                                                    <-------------I
      * lete fra venstre og finn foerste siffer over 0
     C     1             DO        9             ØX                             <-------------I
     C     Ø10(ØX)       IFNE      '0'                                           <-----------II
N06  C     Ø10(ØX)       IFEQ      ','                                           <-----------II
N06  C                   SUB       1             ØX
N06  C                   ENDIF                                                   <-----------II
     C                   GOTO      SRNE1                                                     II
     C                   END                                                     <-----------II
     C                   END                                                    <-------------I
     C     SRNE1         TAG
      * Venstrestill til et nytt felt
     C                   MOVE      *BLANKS       ØAN
     C                   MOVEA     Ø10(ØX)       ØAN
      *
     C                   ENDSR
      *
      ***********************************************
     C     ARKSR         BEGSR
      ***********************************************
      *
      * SKRIV TIL ARKIV
      *
      * SKAL DOKUMENT ARKIVERES
      *
     C                   MOVE      'SL'          ARTYPE
     C     FIFIRM        CHAIN     FIRMARC                            34
     C  N34ARTYPE        CHAIN     ARKTXT                             34
     C     *IN(34)       IFEQ      '0'
     C     arkjn         andeq     'J'

     C                   MOVE      FIFIRM        ARFIRM
     C                   MOVE      U_TIAVD       ARAVD
N03  C                   MOVE      U_TITDN       AROPD
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     C                   MOVE      ZUSER         ARUSER
     C                   MOVE      U_TITDN       ARUNDE
     C                   movel     'SL:'         ARUNDE
     C                   WRITE     ARKIVR
      *_________________________
      * Aktivera arkivfunktionen  FJERNES SENERE
      *"""""""""""""""""""""""""
     C                   CALL      'ARC002CLB'
     C                   PARM      'SL'          WATYPE            2
     C                   PARM                    ARUSER
     C                   END
     C                   ENDSR
