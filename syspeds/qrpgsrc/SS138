      *********************************************************************
      *  After compiling this RPG MODULE,
      *  create the related program with the following command:
      *
CRTPG+*  CRTPGM SYSPED/SS138   MODULE(*LIBL/SS138 *LIBL/INCGI)
CRTPGM*         ACTGRP(CGI) AUT(*USE)
      *
      *
      *********************************************************************
      *
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
      *--------------------------------------------------------------------
      * Data base files
      *--------------------------------------------------------------------
     FBRIDF     if   e           k disk    usropn
     Fgssoll01  if   e           K DISK    usropn
     Fgsspof    if   e           K DISK    usropn
      *--------------------------------------------------------------------
      * Prototype defintions and standard system API error structure
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      *--------------------------------------------------------------------
      * Variables common to CGI programs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
      * Variables received from the input string
     D Curturn         s             11  0
     D Curtur          s             11
     D UserId          s             10
     D User            s             10
     D VisAlle         s              1
      * andre variabler
     D Fn              s             10
     D Lib             s             10
     D Mbr             s             10
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================******
      * MAIN PROCESS LINE
      *=====================================================================******
      * Parse input string
     C                   eval      CurTur = zhbgetvar('Curtur')
     C                   eval      Curturn = c2n2(curtur)
     C                   eval      VisAlle = zhbgetvar('Alle')
     C                   eval      userid = zhbgetvar('user')
      * Set libl/open files
     C                   exsr      Init
      * Set output skeleton html member name
     C                   exsr      SetSkl
      * Read skeleton output html, etc.
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
      *------------------
      * Write sections of HTML.
      *
      * Hent/vis Kolli
     C                   exsr      VIS
      *
      *
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      *
     C                   close     BRIDF
     C                   close     gssoll01
     C                   close     GSSPOF
     C                   eval      *inlr = *on
     C                   RETURN
      *
     C***********************************************
     C     VIS           BEGSR
     C***********************************************
      * Repeat UserId for the next invocation
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updhtmlvar('USER':userid)
     C                   callp     updhtmlvar('Curtur':Curtur)
      *
     C                   callp     wrtsection('top')
     C     Curturn       SETLL     gssoll01
     C     Curturn       READE     gssoll01                               94
     C     *IN94         DOWEQ     '0'
      * Ved dft visning skal ikke de med box utfylt vises
      * (box-nr er ledd 2 i nøkkel - kam da hoppe helt ut av leseloop)
     C     VisAlle       Ifne      'J'
     C     OLBOX         Andne     *zeros
     C                   goto      UTLES
     C                   end
      * kollipost som skal vises i lista...
     C     OLONO         CHAIN     GSSPOF                             33
     C   33              MOVE      *BLANKS       POCONO
     C                   callp     updhtmlvar('OLONO':
     C                             %trim(%editc(OLONO:'Z')))
     C                   callp     updhtmlvar('OLLNO':
     C                             %trim(%editc(OLLNO:'Z')))
     C                   callp     updhtmlvar('POCONO':POCONO)
     C                   callp     updhtmlvar('OLMN':OLMN)
     C                   callp     updhtmlvar('OLBOX':
     C                             %trim(%editc(OLBOX:'Z')))
     C                   callp     wrtsection('tablerow')
     C     Curturn       READE     gssoll01                               94
     C                   end
      *
     c     UtLes         Tag
     C                   callp     wrtsection('tablebot')
      *
     C                   ENDSR
      *
      *
      *=====================================================================******
      * Set html output skeleton member before its read into memory
      *=====================================================================******
     C     SetSkl        begsr
      *------------------
      * Set html output skeleton member
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC'
     C                   eval      Mbr = 'SS138'
      *------------------
     C                   endsr
      *=====================================================================******
      * Set Keys mm
      *=====================================================================******
     C     init          begsr
      *=====================================================================******
      *
     C                   open      BRIDF
     C     UserID        CHAIN     BRIDF                              30
      * --------------------------------------
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C* (bedre ressursmessig). MODUL må da være med comp. av dette pgm!!
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
     C                   open      GSSOLL01
     C                   open      GSSPOF
     C                   endsr
