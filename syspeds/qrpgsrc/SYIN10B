      *
      ***************************************************************
      *** PROGRAM SKAL BEREGNE KUBIKK         (KALLES FRA SYIN10) ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER        ***
      *** LEDIGE INDIKATORER 01 03-11 14-26                       ***
      *** LEDIGE INDIKATORER 27-99                                ***
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 KODE NOTISBLOKK->DOKKODE (J->BLANK)
10XXX * 02 JOV PTF10 fjernet 'grisete' parameteroverføring
10XXX * 03 SH  PTF11 div endriner gikk for tidlig til start
********************************************************************
      *
     FFREETXT   UF A E           K DISK
     FSYPARL1   IF   E           K DISK
     FSYIN10FB  CF   E             WORKSTN
     D UHØ             S              3  2 DIM(12)
     D ULE             S              3  2 DIM(12)
     D UBR             S              3  2 DIM(12)
     D UAN             S              3  0 DIM(12)
     D                 DS
     D  HØ                     1     36  2
     D                                     DIM(12)
     D  WSH1                   1      3  0
     D  WSH2                   4      6  0
     D  WSH3                   7      9  0
     D  WSH4                  10     12  0
     D  WSH5                  13     15  0
     D  WSH6                  16     18  0
     D  WSH7                  19     21  0
     D  WSH8                  22     24  0
     D  WSH9                  25     27  0
     D  WSH10                 28     30  0
     D  WSH11                 31     33  0
     D  WSH12                 34     36  0
s02  D*   UHØAVOP              1     14
     D                 DS
     D  LE                     1     36  2
     D                                     DIM(12)
     D  WSL1                   1      3  0
     D  WSL2                   4      6  0
     D  WSL3                   7      9  0
     D  WSL4                  10     12  0
     D  WSL5                  13     15  0
     D  WSL6                  16     18  0
     D  WSL7                  19     21  0
     D  WSL8                  22     24  0
     D  WSL9                  25     27  0
     D  WSL10                 28     30  0
     D  WSL11                 31     33  0
     D  WSL12                 34     36  0
     D                 DS
     D  BR                     1     36  2
     D                                     DIM(12)
     D  WSB1                   1      3  0
     D  WSB2                   4      6  0
     D  WSB3                   7      9  0
     D  WSB4                  10     12  0
     D  WSB5                  13     15  0
     D  WSB6                  16     18  0
     D  WSB7                  19     21  0
     D  WSB8                  22     24  0
     D  WSB9                  25     27  0
     D  WSB10                 28     30  0
     D  WSB11                 31     33  0
     D  WSB12                 34     36  0
     D                 DS
     D  AN                     1     36  0
     D                                     DIM(12)
     D  WSA1                   1      3  0
     D  WSA2                   4      6  0
     D  WSA3                   7      9  0
     D  WSA4                  10     12  0
     D  WSA5                  13     15  0
     D  WSA6                  16     18  0
     D  WSA7                  19     21  0
     D  WSA8                  22     24  0
     D  WSA9                  25     27  0
     D  WSA10                 28     30  0
     D  WSA11                 31     33  0
     D  WSA12                 34     36  0

     C* bevar inntil 100 stk for å skrive til notisblokk
     D                 DS
     D  HØ2                    1    300  0 inz(*Zeros)
     D                                     DIM(100)
     D                 DS
     D  LE2                    1    300  0 inz(*Zeros)
     D                                     DIM(100)
     D                 DS
     D  BR2                    1    300  0 inz(*Zeros)
     D                                     DIM(100)
     D                 DS
     D  AN2                    1    300  0 inz(*Zeros)
     D                                     DIM(100)
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
s02  D*                DS
s02  D* AVDOPDDS               1     14
s02  D* XXAVD                  1      4
s02  D* XXOPD                  5     11                                         7 lang !!
s02  D* XXFBR                 12     14
     D                 DS
     D  FRTTXT                 1     70
     D  FRTTXT1_8              1      8
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UAVD              4 0
     C                   PARM                    UOPD              7 0
     C                   PARM                    UFBN              3 0
     C                   PARM                    UFLYTM            1
     C                   PARM                    UM3               7 3
     C                   PARM                    UHØ
     C                   PARM                    ULE
     C                   PARM                    UBR
     C                   PARM                    UAN
      *
     C                   WRITE     WINDOWSZ
     C* LÅNER DELER UHØ FOR AVD / OPPDR. HVIS FLYTT-PARAM = O  (FLYTT ER UANSETT "PÅ TRYNET")
     C     UFLYTM        IFEQ      'O'
     c                   move      *on           *in56
     C                   MOVEA     UHØ           HØ
s02  C*                  MOVE      UHØAVOP       AVDOPDDS
     C     KLMKey        KLIST
     C                   KFLD                    XXPAKN            8 0
     C                   KFLD                    XXPAID            5
     C                   movel     'KLMFT'       XXPAID
     c     KLMKey        chain     SYPARL1                            33
     C                   Movel     SYVRDA        WSNOT                          J=til notisblokk
S01  C*    WSNOT         ifne      'J'
S01  C*                  Move      'N'           WSNOT                          J=til notisblokk
S01  c*                  end
      * dagens dato
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   Move      'N'           TXTDEL            1            J=fjern gamle
     c                   exsr      tstfree                                      sjekk freetxt
     C                   end
     C*
     C                   MOVE      *ZEROS        WSTOTT            7 5
     C     UFLYTM        IFEQ      'J'
     C                   MOVEA     UHØ           HØ
     C                   MOVEA     ULE           LE
     C                   MOVEA     UBR           BR
     C                   MOVEA     UAN           AN
     C                   ELSE
     C                   MOVE      *ZEROS        HØ
     C                   MOVE      *ZEROS        LE
     C                   MOVE      *ZEROS        BR
     C                   MOVE      *ZEROS        AN
     C                   END
     C                   MOVE      'J'           UFLYTM
     C*
     C     START         TAG
     c     WSTOTF        comp      *zeros                             5555
     C                   EXFMT     BILDE
N01
N01   * søk dokumentkoder
N01  C     *in04         ifeq      *on
N01  C                   MOVEL     'FRTKOD'      XKFTYP           10
N01  C                   MOVE      'N'           UUPDAT            1
N01  C                   MOVE      *BLANKS       XKFKOD            5
N01  C                   CALL      'SYFAKDA'
N01  C                   PARM                    XKFTYP
N01  C                   PARM                    UUPDAT
N01  C                   PARM                    XKFKOD
N01  C     XKFKOD        ifne      *blanks
N01  C                   MOVEL     XKFKOD        WSNOT
N01  C                   endif
N01  C                   goto      Start
N01  C                   endif
N01
     C                   MOVE      *ZEROS        WSTOT
     C                   Z-ADD     1             XN                2 0
     C                   DO        12
     C     HØ(XN)        IFEQ      0
     c     *in03         ifeq      *on
     c     *in12         oreq      *on
     C                   GOTO      SLUTT
     C                   end
s03  C*                  GOTO      START
     C                   END
     C     HØ(XN)        MULT      LE(XN)        XKUB             14 5
     C                   MULT      BR(XN)        XKUB
n03  c     XKUB          ifgt      0
     C     AN(XN)        IFGT      0
     C                   MULT      AN(XN)        XKUB
     C                   ELSE
     C                   Z-ADD     1             AN(XN)
N03  C                   MULT      AN(XN)        XKUB
     C                   END
N03  C                   END
     C                   ADD       XKUB          WSTOT
     C                   ADD       1             XN
     C                   END
     C   12              GOTO      SLUTT
     C   02              DO
     c                   exsr      add2
     C                   ADD       WSTOT         WSTOTF
     C                   MOVE      'N'           UFLYTM
     C                   Move      *zeros        WSTOT
     C                   MOVE      *ZEROS        HØ
     C                   MOVE      *ZEROS        LE
     C                   MOVE      *ZEROS        BR
     C                   MOVE      *ZEROS        AN
     C                   END
      * vis også grand total (før kun denne/fra før)
     C     WSTOTF        ADD       WSTOT         WSTOTTOT
     C                   GOTO      START
     C     SLUTT         TAG
      *
     C     *in12         ifeq      *off
     C                   ADD       WSTOTF        WSTOT
     C                   Z-ADD(H)  WSTOT         UM3
     C                   MOVEA     HØ            UHØ
     C                   MOVEA     LE            ULE
     C                   MOVEA     BR            UBR
     C                   MOVEA     AN            UAN
s01  c*    WSNOT         ifeq      'J'
N01  c     WSNOT         ifne      'N'
N01  c     WSNOT         andne     ' '
     c     *in56         andeq     *on
     c                   exsr      add2
     c                   exsr      NotisSr
     c                   end
     C                   else
     c                   move      *zeros        UM3
     C                   end
     C*
     C                   SETON                                        LR
     C                   RETURN
     C*

      ******************************************************************
     C     Add2          BEGSR
      ******************************************************************
      * legg inn i arrays med inntil 100 stk for å overføre fil notisblokk
      * finn første ledige arrayelement
     c     1             do        100           N2                3 0
     c     LE2(N2)       ifeq      *zeros
     c                   leave
     c                   end
     c                   end
      * add inntil 12 nye
     c     1             do        12            N1                3 0
     c     LE(N1)        ifeq      *zeros
     c                   leave
     c                   end
     c                   move      LE(N1)        LE2(N2)
     c                   move      BR(N1)        BR2(N2)
     c                   move      HØ(N1)        HØ2(N2)
     c                   move      AN(N1)        AN2(N2)
     c                   add       1             n2
     c                   end
      *
     C                   ENDSR

      ******************************************************************
     C     NotisSr       BEGSR
      ******************************************************************
      * 1 -  fjern gamle / finn max linjenr på dagen dato..
     C                   Move      'J'           TXTDEL            1            J=fjern gamle
     c                   exsr      tstfree                                      sjekk freetxt
      * 2 -  skriv nye
     c     1             do        100           N2                3 0
     c     LE2(N2)       ifeq      *zeros
     c                   leave
     c                   end
      * skriv en linje pr kll på dagens dato
     c                   eval      FRTDT  = ULDT
     c                   eval      MaxLi  = Maxli + 1
     c                   eval      FRTLI  = MaxLi
     c                   eval      FRTKOD = ' '
N01  c     WSNOT         ifne      'J'
N01  c                   eval      FRTKOD = WSNOT
N01  c                   endif
     c                   eval      FRTFAK = *zeros
     c                   eval      FRTTXT = 'Kll-mål:'
     c                             + %trimR(%editc(AN2(N2):'Z')) + ' kll a   '
     c                             + %trimR(%editc(LE2(N2):'Z')) + ' X '
     c                             + %trimR(%editc(BR2(N2):'Z')) + ' X '
     c                             + %trimR(%editc(HØ2(N2):'Z')) + ' cm.'
     c                   write     FREETXTR
     c                   end
     C                   ENDSR

      ******************************************************************
     C     TstFree       BEGSR
      ******************************************************************
s02  c*                  move      xxavd         frtavd
s02  c*                  move      xxopd         frtopd
n02  c                   move      Uavd          frtavd
n02  c                   move      Uopd          frtopd
     c     Key           klist
     c                   kfld                    frtavd
     c                   kfld                    frtopd
      *
     c                   move      '0'           *in57
     c                   move      *zeros        MaxLi             2 0
     c     Key           setll     FreeTxt
     c     Key           reade     FreeTxt                                33
     c     *in33         doweq     '0'
     c     FRTTXT1_8     ifeq      'Kll-mål:'
     c                   move      '1'           *in57                          MÅL finnes i FREETXT
     c     TXTDEL        ifeq      'N'
     c                   update    FREETXTR
     c                   else
     c                   delete    FREETXTR
     C                   goto      NextLin
     c                   end
     c                   end
     c     FRTDT         ifeq      ULDT
     c     FRTLI         andgt     MaxLi
     c                   move      FRTLI         MaxLi                          Max Linje i dag
     c                   end
     c     NextLin       tag
     c     Key           reade     FreeTxt                                33
     c                   end
      *
     C                   ENDSR
