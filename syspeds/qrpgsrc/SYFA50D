      **************************************************************
      * PROGRAM SKAL OPPDATERE GEBYR AV DOK.KONTR. PÅ FAKT.REG.***
      *       PROGRAM BLIR KALLT AV TVI21R MED GEBYKODE        ***
      *       LIKE FØR 'MOVE  Y0035  SE0035'
      *                'M1001  IFEQ  '929'
      *       SE EKSAMPEL HOS TOLLPOST                         ***
      * OBS!  TOLLPOST BRUKER TABELL 1 FOR Å HENTE PRIS        ***
      *       SØK PÅ PRTNR FOR Å BYTTE TABELL NUMMER           ***
      * INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER       ***
      * LEDIGE INDIKATORER 01-26                               ***
      * LEDIGE INDIKATORER 27-32 34-83 87-98
      **************************************************************
     FFAK4      UF A E           K DISK    USROPN
     FFAK2      IF   E           K DISK    USROPN
     F                                     RENAME(FAKTR:FAKTR2)
     FFIRM      IF   E           K DISK
     FKODTV     IF   E           K DISK
     FCUNDL01   UF   E           K DISK
     FHEADF     IF   E           K DISK
     FVALUL01   IF   E           K DISK
     FKODTGE    IF   E           K DISK
     FPRIS      IF   E           K DISK
     D*  Include/omit arrays for gebyravtaler
      *
     C                   OPEN      FAK4
     C                   OPEN      FAK2
     C                   EXSR      INIT
      *
     C     HEADFK        CHAIN     HEADF                              33
     C  N33              EXSR      HOVED
      *
     C                   CLOSE     FAK4
     C                   CLOSE     FAK2
     C                   RETURN
      *
      ******************************************
     C     HOVED         BEGSR
      ******************************************
      *
     C                   EXSR      TESTFA
     C   33              GOTO      UTUT
     C     KODTVK        CHAIN     KODTV                              33
      * BYGGER OPP FAKTURABILDET
      *
     C                   IF        HEKDFS = ' '
     C                   MOVE      HEKNKF        KUNDNR
     C                   MOVE      'K'           XSK               1
     C                   ELSE
     C                   MOVE      HEKNSF        KUNDNR
     C                   MOVE      'S'           XSK
     C                   END
      *
     C                   MOVE      *ZEROS        XUTLGR            9 0
     C                   MOVE      *ZEROS        XLN               2 0
     C                   MOVE      'N'           UTLMAN            1
      *
     C     FAK4K         SETLL     FAK4
      *
     C     STLES         TAG
     C     FAK4K         READE     FAK4                                   33
     C   33              GOTO      UTLES
     C                   MOVE      FABELN        XBELØN           13 2
      *
     C     FAVK          IFEQ      PRGEBY
     C                   DELETE    FAKTR
     C                   EXSR      MSALDO
     C                   END
      *** ---------------------------------------------
     C     FAOPKO        IFEQ      ' '
     C     FAOPKO        OREQ      'C'
     C     FASK          IFEQ      XSK
      *** FJERNER UTLEGGSPOST
     C     FAVK          IFEQ      'UTL'
     C     FAOPKO        IFEQ      'M'
     C     FAOPKO        OREQ      'E'
     C                   MOVE      'J'           UTLMAN            1
     C                   ELSE
     C                   MOVE      FAKDM         XAKDM             1
     C                   DELETE    FAKTR
     C                   EXSR      MSALDO
     C                   END
     C                   ELSE
      *** ØKER UTLEGGSGRUNNLAG
     C     FAKDUL        IFEQ      'J'
     C                   ADD       FABELN        XUTLGR
     C                   END
     C                   END
     C                   END
     C                   END
      *** ---------------------------------------------
      *
     C                   GOTO      STLES
      *
     C     UTLES         TAG
      *
      *** OPPDATERER FIL
      ***----------------------------------------------
      *** OPPDATERER GEBYR FOR DOKUMENT KONTROLL
     C                   MOVE      PRGEBY        FAVK
     C                   Z-ADD     PRBELØ        FABELV
     C                   Z-ADD     PRBELØ        FABELN
     C     KEYGE         CHAIN     KODTGE                             33
     C  N33              MOVE      KGEUTL        FAKDUL
     C   33              MOVE      ' '           FAKDUL
     C     FAKDUL        IFEQ      'J'
     C                   ADD       PRBELØ        XUTLGR
     C                   END
     C                   MOVE      'M'           FAKDA
     C                   MOVE      'N'           FAKDM
     C                   EXSR      OPDFAK
      ***----------------------------------------------
      *
      * OPPDATERER UTLEGGS PROVISJON
      *
     C     KUND1K        CHAIN(N)  CUNDL01                            33
     C  N33              Z-ADD     SYMINU        XUTLMI
     C  N33SYUTLP        IFEQ      *ZEROS
     C                   MOVE      'B'           FAKDA
     C                   MOVE      FIUPS         SYUTLP            4 2
     C                   Z-ADD     FIUPM         XUTLMI            4 0
     C     AVUTPR        IFNE      *ZEROS
     C                   Z-ADD     AVUTPR        SYUTLP
     C                   END
     C     AVUTMI        IFNE      *ZEROS
     C                   Z-ADD     AVUTMI        XUTLMI
     C                   END
     C                   END
     C     SYUTLP        IFEQ      99.99
     C                   MOVE      'A'           FAKDA
     C                   MOVE      *ZEROS        SYUTLP
     C                   END
      *
     C  N33XUTLGR        IFNE      *ZEROS
     C     HEKDTM        ANDNE     ' '
     C     SYUTLP        ANDNE     0
     C     UTLMAN        ANDNE     'J'
     C                   MOVE      'UTL'         FAVK
     C     XUTLGR        MULT      SYUTLP        FABELV
     C     FABELV        DIV(H)    100           FABELN
     C                   Z-ADD     FABELN        FABELV
     C     FABELN        IFLT      XUTLMI
     C                   Z-ADD     XUTLMI        FABELV
     C                   Z-ADD     XUTLMI        FABELN                          H
     C                   END
      *
     C     XAKDM         IFNE      *BLANK
     C                   MOVE      XAKDM         FAKDM
     C                   ELSE
     C     HEKDTM        IFEQ      'S'
     C                   MOVE      'N'           FAKDM
     C                   ELSE
     C                   MOVE      'J'           FAKDM
     C                   END
     C                   END
      *
     C                   EXSR      OPDFAK
     C                   END
      *
     C     UTUT          ENDSR
      *
      ******************************************
     C     OPDFAK        BEGSR
      ******************************************
     C                   MOVE      *BLANKS       FA01
     C                   MOVE      XSK           FASK
     C                   MOVE      *BLANKS       FAVT
     C                   MOVE      *BLANKS       FA01B
     C                   MOVE      FICURR        FAVAL
     C                   MOVE      ' '           FAKDUK
     C                   MOVE      *ZEROS        FABELU
     C                   EXSR      DECI
     C                   CALL      'SYGE06'
     C                   PARM                    FAAVD
     C                   PARM                    FAOPD
     C                   PARM                    FALI
     C                   EXSR      SRKUNR
     C                   EXSR      VALUT2
     C                   EXCEPT    NYFAKT
     C                   EXSR      PSALDO
      *
     C                   ENDSR
      ***********************************************
     C     DECI          BEGSR
      ***********************************************
     C     FIDECI        IFEQ      0
     C                   Z-ADD(H)  FABELN        FABEL0           11 0
     C                   Z-ADD     FABEL0        FABELN
     C                   Z-ADD(H)  FABELU        FABEL0           11 0
     C                   Z-ADD     FABEL0        FABELU
     C                   ELSE
     C     FIDECI        IFEQ      1
     C                   Z-ADD(H)  FABELN        FABEL1           12 1
     C                   Z-ADD     FABEL1        FABELN
     C                   Z-ADD(H)  FABELU        FABEL1           12 1
     C                   Z-ADD     FABEL1        FABELU
     C                   END
     C                   END
      *
     C                   ENDSR
      *
      ******************************************
     C     VALUT2        BEGSR
      ******************************************
      *
      * OMREGNER VALUTABELØP
      *
     C                   SETOFF                                       8586
     C     FASK          IFNE      'I'
     C     FASK          COMP      'S'                                868685
      *
     C   85HEVALS        COMP      '   '                                  84
     C   85
     CANN84HEVALS        COMP      FICURR                                 84
     C   86HEVALK        COMP      '   '                                  84
     C   86
     CANN84HEVALK        COMP      FICURR                                 84
     C   84              GOTO      UTVAL2
      *
     C   85VALKOD        COMP      HEVALS                                 84
     C   86VALKOD        COMP      HEVALK                                 84
     C   84              GOTO      UTVAL2
     C   85              MOVE      HEVALS        VALKOD
     C   86              MOVE      HEVALK        VALKOD
     C                   END
      *
     C     VALU1K        CHAIN     VALUL01                            84
     C  N84VALKU2        IFNE      0
     C                   Z-ADD     VALKU2        VALKU1
     C                   END
     C  N84FABELN        MULT      OMRFAK        XWORK            15 4
     C  N84XWORK         DIV(H)    VALKU1        FABELV
     C   85              MOVE      HEVALS        VALKOD
     C   86              MOVE      HEVALK        VALKOD
     C     UTVAL2        TAG
     C                   SETOFF                                       848586
     C                   ENDSR
      *
      ******************************************
     C     INIT          BEGSR
      ******************************************
     C     *ENTRY        PLIST
     C                   PARM                    UAVD              4
     C                   PARM                    UOPD              7
     C                   PARM                    UGEB              3
      *
     C     FAK4K         KLIST
     C                   KFLD                    FAAVD
     C                   KFLD                    FAOPD
     C     KUND1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C     CUND1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    FAKUNR
     C     KEYGE         KLIST
     C                   KFLD                    KGEUNI
     C                   KFLD                    FAVK
     C                   MOVE      'GE'          KGEUNI
      *
     C     KODTVK        KLIST
     C                   KFLD                    XVUNI
     C                   KFLD                    FAAVD
     C                   MOVE      'V'           XVUNI             1
     C     HEADFK        KLIST
     C                   KFLD                    FAAVD
     C                   KFLD                    FAOPD
     C     VALU1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    VALKOD
     C     PRISK         KLIST
     C                   KFLD                    PRTNR
     C                   KFLD                    UGEB
      *
     C                   MOVE      UAVD          FAAVD
     C                   MOVE      UOPD          FAOPD
     C                   MOVE      '1'           PRTNR
      *
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
     C     PRISK         CHAIN     PRIS                               33
      *
     C                   ENDSR
      ***********************************************
     C     SRKUNR        BEGSR
      ****************************************************
      *
     C     FASK          IFEQ      'S'
     C                   MOVE      HEKNSF        FAKUNR
     C                   END
     C     FASK          IFEQ      'K'
     C                   MOVE      HEKNKF        FAKUNR
     C                   END
     C     FASK          IFEQ      'A'
     C                   MOVE      HEKNA         FAKUNR
     C                   END
     C                   ENDSR
      ***********************************************
     C     MSALDO        BEGSR
      ***********************************************
     C     CUND1K        CHAIN     CUNDL01                            33
     C  N33              SUB       XBELØN        SYSALU
     C  N33              EXCEPT    NYSALD
      *
     C                   ENDSR
      *
      ***********************************************
     C     PSALDO        BEGSR
      ***********************************************
     C     CUND1K        CHAIN     CUNDL01                            33
     C  N33              ADD       FABELN        SYSALU
     C  N33              EXCEPT    NYSALD
      *
     C                   ENDSR
      ***********************************************
     C     TESTFA        BEGSR
      ***********************************************
      * AVSLUTTER PROGRAM HVIS DET ER FAKTURERT TOL ELLER MVA
      * *IN33 SETTES DA PÅ
      *
     C     FAK4K         SETLL     FAK2
      *
     C     STLEST        TAG
     C     FAK4K         READE     FAK2                                   33
     C   33              GOTO      UTTEST
      *
      * HOPPER UT HVIS GEBYR FOR DOKUMENT KONTROLL FINNES
      *
     C                   IF        FASK = PRGEBY AND
     C                             FAOPKO <> ' ' AND FAOPKO <> 'C'
     C                   SETON                                        33
     C                   GOTO      UTTEST
     C                   END
      *
     C                   GOTO      STLEST
     C     UTTEST        ENDSR
      *
     OFAKTR     EADD         NYFAKT
     O                       FA01
     O                       FALI
     O                       FAAVD
     O                       FAOPD
     O                       FASK
     O                       FAVK
     O                       FAVT
     O                       FAVAL
     O                       FABELV
     O                       FAKDM
     O                       FABELN
     O                       FAKDA
     O                       FA01B
     O                       FAKDUL
     O                       FAKDUK
     O                       FABELU
     O                       FAKUNR
     OKUNDR     E            NYSALD
     O                       SYSALU
