     FEDI55D    CF   E             WORKSTN
     F                                     SFILE(EDI55DA:ZRECNO)
     FESTYL00   UF A E           K DISK
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
     C     *LIKE         DEFINE    ZRECNO        WRECNO
     C     *LIKE         DEFINE    ESFIKD        WSFIKD
     C     *LIKE         DEFINE    ESPTYP        WSPTYP
     C     *LIKE         DEFINE    ESPNUM        WSPNUM
     C     *LIKE         DEFINE    ESDKID        WSDKID
     C     *LIKE         DEFINE    ESDKSM        WSDKSM
     C     *LIKE         DEFINE    *IN03         WIN03
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYA          KLIST
     C                   KFLD                    WSFIKD
     C                   KFLD                    WSPTYP
     C                   KFLD                    WSPNUM
     C                   KFLD                    WSDKID
     C                   KFLD                    WSDKSM
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
     C     SRB1          TAG
      *______________
      * Tømme Subfile
      *""""""""""""""
     C                   MOVE      '1'           *IN93
     C                   WRITE     EDI55DB
     C                   MOVEA     '000'         *IN(93)
     C                   Z-ADD     *ZERO         ZRECNO
     C                   Z-ADD     *ZERO         WRECNO
     C                   MOVE      *ZEROS        WSPNUM
     C                   MOVE      *OFF          *IN61
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     *LOVAL        SETLL     ESTYL00
     C                   READ      ESTYL00                                94
      *
     C     *IN94         DOWEQ     '0'
     C                   ADD       1             ZRECNO
     C                   Z-ADD     ZRECNO        WRECNO
     C                   WRITE     EDI55DA
     C                   READ      ESTYL00                                94
     C  N94              END
      *
     C     ZRECNO        IFEQ      0
     C                   MOVE      *ZEROS        ESPNUM
     C                   ADD       1             ZRECNO
     C                   WRITE     EDI55DA
     C                   ENDIF
     C                   Z-ADD     1             ZRECNO
      *_______________
      * Behandle bilde
      *"""""""""""""""
     C     SRB3          TAG
      *
     C                   MOVEA     '11'          *IN(91)
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     EDI55DØ
     C                   WRITE     EDI55DC
     C                   EXFMT     EDI55DB
      *
     C     *IN03         IFEQ      '0'
     C     *IN12         ANDEQ     '0'
      *
     C                   MOVEA     '00'          *IN(91)
      *_____________
      * F5=Frisk opp
      *"""""""""""""
     C     *IN05         CABEQ     '1'           SRB1
      *___________
      * F6=Lage ny
      *"""""""""""
     C     *IN06         IFEQ      '1'
     C                   EXSR      SRBA
     C     *IN03         CABEQ     '1'           SRB9
     C                   GOTO      SRB3
     C                   END
      *_______
      * Valg ?
      *"""""""
     C                   MOVE      '0'           *IN52
     C                   MOVE      '0'           *IN95
     C     *IN52         DOWEQ     '0'
      *
     C                   READC     EDI55DA                                52
     C     *IN52         IFEQ      '0'
     C     ZOP           CASEQ     '2'           SRBB                           Endre
N02  C     ZOP           CASEQ     '3'           SRBC                           Kopiere
     C     ZOP           CASEQ     '4'           SRBD                           Slette
N02  C     ZOP           CASEQ     '5'           SRBE                           Vise
     C                   END
     C                   END
      *
     C  N52              END
      *
     C     *IN03         CABEQ     '1'           SRB9
     C     *IN95         CABEQ     '1'           SRB1
     C     *IN95         CABEQ     '0'           SRB3
      *
     C                   END
      *
     C     SRB9          ENDSR
      *////////////////////////////////////////////////////////////
      *  Lage ny                                             SRBA /
      *////////////////////////////////////////////////////////////
     C     SRBA          BEGSR
      *____________
      * Blanke felt
      *""""""""""""
     C                   MOVE      '0'           *IN41
N02  C                   MOVE      '0'           *IN42
     C                   MOVEA     '0000'        *IN(30)
     C                   MOVE      *BLANKS       ESFIKD
     C                   MOVE      *BLANKS       ESPTYP
     C                   MOVE      *ZEROS        ESPNUM
     C                   MOVE      *BLANKS       ESDKID
     C                   MOVE      *BLANKS       ESDKSM
     C                   MOVE      *BLANKS       ESPNVN
     C                   MOVE      *BLANKS       ESDKST
     C                   MOVE      *BLANKS       ESDKBH
     C                   MOVE      *ZEROS        ESSTDT
     C                   MOVE      *BLANKS       ESMPID
     C                   MOVE      *BLANKS       ESNTID
     C                   MOVE      *BLANKS       ESNTPK
     C                   MOVE      *BLANKS       ESTRPA
     C                   MOVE      *BLANKS       ESRNUM
      *
     C     SRBA1         TAG
      *
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     EDI55DØ
     C                   EXFMT     EDI55DD
     C                   MOVEA     '0000'        *IN(30)
     C     *IN03         IFEQ      '0'
     C     *IN12         ANDEQ     '0'
      *____________
      * Teste input-1
      *""""""""""""
      * Post må ikke finnes fra før.
     C                   Z-ADD     ÅSPNUM        WSPNUM
     C     KEYA          CHAIN     ESTYL00                            53
     C     *IN53         IFEQ      '0'
     C                   MOVE      'SY00100'     ZMSGNO
     C                   MOVEA     '1110'        *IN(30)
     C                   GOTO      SRBA1
     C                   ENDIF
      *___________________
      * Adda post til  FIL
      *"""""""""""""""""""
     C                   MOVE      ÅSFIKD        ESFIKD
     C                   MOVE      ÅSPTYP        ESPTYP
     C                   Z-ADD     ÅSPNUM        ESPNUM
     C                   MOVE      ÅSDKID        ESDKID
     C                   MOVE      ÅSDKSM        ESDKSM
     C                   MOVE      ÅSPNVN        ESPNVN
     C                   MOVE      ÅSDKST        ESDKST
     C                   MOVE      ÅSDKBH        ESDKBH
     C                   Z-ADD     ÅSSTDT        ESSTDT
     C                   MOVE      ÅSMPID        ESMPID
     C                   MOVE      ÅSNTID        ESNTID
     C                   MOVE      ÅSNTPK        ESNTPK
     C                   MOVE      ÅSTRPA        ESTRPA
     C                   MOVE      ÅSRNUM        ESRNUM
     C                   WRITE     ESTYR
      *______________________
      * Adda post til  SUBFIL
      *""""""""""""""""""""""
     C                   ADD       1             WRECNO
     C                   Z-ADD     WRECNO        ZRECNO
     C                   WRITE     EDI55DA
      *
     C                   ENDIF
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Endre                                               SRBB /
      *////////////////////////////////////////////////////////////
     C     SRBB          BEGSR
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    EDI55DA
      *____________
      * Flytte felt
      *""""""""""""
     C                   MOVE      ESFIKD        WSFIKD
     C                   MOVE      ESPTYP        WSPTYP
     C                   Z-ADD     ESPNUM        WSPNUM
     C                   MOVE      ESDKID        WSDKID
     C                   MOVE      ESDKSM        WSDKSM
     C     KEYA          CHAIN(N)  ESTYL00                            53
     C                   MOVE      '1'           *IN41
N02  C                   MOVE      '0'           *IN42
     C                   MOVEA     '0000'        *IN(30)
     C                   MOVE      ESFIKD        ÅSFIKD
     C                   MOVE      ESPTYP        ÅSPTYP
     C                   Z-ADD     ESPNUM        ÅSPNUM
     C                   MOVE      ESDKID        ÅSDKID
     C                   MOVE      ESDKSM        ÅSDKSM
     C                   MOVE      ESPNVN        ÅSPNVN
     C                   MOVE      ESDKST        ÅSDKST
     C                   MOVE      ESDKBH        ÅSDKBH
     C                   Z-ADD     ESSTDT        ÅSSTDT
     C                   MOVE      ESMPID        ÅSMPID
     C                   MOVE      ESNTID        ÅSNTID
     C                   MOVE      ESNTPK        ÅSNTPK
     C                   MOVE      ESTRPA        ÅSTRPA
     C                   MOVE      ESRNUM        ÅSRNUM
      *
     C     SRBB1         TAG
      *
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     EDI55DØ
     C                   EXFMT     EDI55DD
     C                   MOVEA     '000'         *IN(30)
     C     *IN12         IFEQ      '0'
      *____________
      * Teste input
      *""""""""""""
     C   30              GOTO      SRBB1
     C     *IN12         CABEQ     '1'           SRBB1
     C     *IN03         IFEQ      '0'
      *______________
      * Oppdatere FIL
      *""""""""""""""
     C                   MOVE      ÅSFIKD        WSFIKD
     C                   MOVE      ÅSPTYP        WSPTYP
     C                   Z-ADD     ÅSPNUM        WSPNUM
     C                   MOVE      ÅSDKID        WSDKID
     C                   MOVE      ÅSDKSM        WSDKSM
     C     KEYA          CHAIN     ESTYL00                            53
     C                   MOVE      ÅSFIKD        ESFIKD
     C                   MOVE      ÅSPTYP        ESPTYP
     C                   Z-ADD     ÅSPNUM        ESPNUM
     C                   MOVE      ÅSDKID        ESDKID
     C                   MOVE      ÅSDKSM        ESDKSM
     C                   MOVE      ÅSPNVN        ESPNVN
     C                   MOVE      ÅSDKST        ESDKST
     C                   MOVE      ÅSDKBH        ESDKBH
     C                   Z-ADD     ÅSSTDT        ESSTDT
     C                   MOVE      ÅSMPID        ESMPID
     C                   MOVE      ÅSNTID        ESNTID
     C                   MOVE      ÅSNTPK        ESNTPK
     C                   MOVE      ÅSTRPA        ESTRPA
     C                   MOVE      ÅSRNUM        ESRNUM
     C                   UPDATE    ESTYR
      *
     C                   END
     C                   END
      *
     C                   ENDSR
N02   *////////////////////////////////////////////////////////////
N02   *  Kopiere                                             SRBC /
N02   *////////////////////////////////////////////////////////////
N02  C     SRBC          BEGSR
N02   *____________
N02   * Flytte felt
N02   *""""""""""""
     C                   MOVE      ESFIKD        WSFIKD
     C                   MOVE      ESPTYP        WSPTYP
     C                   Z-ADD     ESPNUM        WSPNUM
     C                   MOVE      ESDKID        WSDKID
     C                   MOVE      ESDKSM        WSDKSM
     C     KEYA          CHAIN(N)  ESTYL00                            53
     C                   MOVE      ESFIKD        ÅSFIKD
     C                   MOVE      ESPTYP        ÅSPTYP
     C                   Z-ADD     ESPNUM        ÅSPNUM
     C                   MOVE      ESDKID        ÅSDKID
     C                   MOVE      ESDKSM        ÅSDKSM
     C                   MOVE      ESPNVN        ÅSPNVN
     C                   MOVE      ESDKST        ÅSDKST
     C                   MOVE      ESDKBH        ÅSDKBH
     C                   Z-ADD     ESSTDT        ÅSSTDT
     C                   MOVE      ESMPID        ÅSMPID
     C                   MOVE      ESNTID        ÅSNTID
     C                   MOVE      ESNTPK        ÅSNTPK
     C                   MOVE      ESTRPA        ÅSTRPA
     C                   MOVE      ESRNUM        ÅSRNUM
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    EDI55DA
      *____________________________
      * Kalle på rutine for Lage Ny
      *""""""""""""""""""""""""""""
N02  C                   EXSR      SRBA
N02  C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Slette                                              SRBD /
      *////////////////////////////////////////////////////////////
     C     SRBD          BEGSR
      *______________
      * Oppdatere FIL
      *""""""""""""""
     C                   MOVE      ESFIKD        WSFIKD
     C                   MOVE      ESPTYP        WSPTYP
     C                   Z-ADD     ESPNUM        WSPNUM
     C                   MOVE      ESDKID        WSDKID
     C                   MOVE      ESDKSM        WSDKSM
     C     KEYA          CHAIN     ESTYL00                            53
     C                   DELETE    ESTYR
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   MOVE      *BLANKS       ESFIKD
     C                   MOVE      *BLANKS       ESPTYP
     C                   MOVE      *ZEROS        ESPNUM
     C                   MOVE      *BLANKS       ESDKID
     C                   MOVE      *BLANKS       ESDKSM
     C                   UPDATE    EDI55DA
     C                   MOVE      '1'           *IN95
      *
     C                   ENDSR
N02   *////////////////////////////////////////////////////////////
N02   *  Vise                                                SRBE /
N02   *////////////////////////////////////////////////////////////
N02  C     SRBE          BEGSR
N02   *____________
N02   * Flytte felt
N02   *""""""""""""
N02  C                   MOVE      '1'           *IN41
N02  C                   MOVE      '1'           *IN42
N02  C                   MOVEA     '0000'        *IN(30)
     C                   MOVE      ESFIKD        WSFIKD
     C                   MOVE      ESPTYP        WSPTYP
     C                   Z-ADD     ESPNUM        WSPNUM
     C                   MOVE      ESDKID        WSDKID
     C                   MOVE      ESDKSM        WSDKSM
     C     KEYA          CHAIN(N)  ESTYL00                            53
     C                   MOVE      ESFIKD        ÅSFIKD
     C                   MOVE      ESPTYP        ÅSPTYP
     C                   Z-ADD     ESPNUM        ÅSPNUM
     C                   MOVE      ESDKID        ÅSDKID
     C                   MOVE      ESDKSM        ÅSDKSM
     C                   MOVE      ESPNVN        ÅSPNVN
     C                   MOVE      ESDKST        ÅSDKST
     C                   MOVE      ESDKBH        ÅSDKBH
     C                   Z-ADD     ESSTDT        ÅSSTDT
     C                   MOVE      ESMPID        ÅSMPID
     C                   MOVE      ESNTID        ÅSNTID
     C                   MOVE      ESNTPK        ÅSNTPK
     C                   MOVE      ESTRPA        ÅSTRPA
     C                   MOVE      ESRNUM        ÅSRNUM
N02   *_________________
N02   * Oppdatere SUBFIL
N02   *"""""""""""""""""
N02  C                   MOVE      *BLANKS       ZOP
N02  C                   UPDATE    EDI55DA
N02  C                   WRITE     EDI55DØ
N02  C                   EXFMT     EDI55DD
N02  C                   ENDSR
