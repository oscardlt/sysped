      *********************************************************************
CRTPG+*  CRTPGM SYSPED/TDKE002R MODULE(*LIBL/TDKE002R *LIBL/INCGI)
CRTPGM*        ACTGRP(CGI) AUT(*USE)
      *********************************************************************
      /copy SYSPEDS/qrpgsrcpy,hspecs
      /copy SYSPEDS/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
     FDKEH      UF A E           K DISK    USROPN
     F                                     PREFIX(X)
     FDKEV1     IF A E           K DISK    USROPN
     FDKEA      UF   E           K DISK    USROPN
     FDKTHA2    IF   E           K DISK    USROPN
     FSADH      IF   E           K DISK    USROPN
     FHEADF     UF   E           K DISK    USROPN
     FCUNDL01   IF   E           K DISK    USROPN
KING FKUNDL01   IF   E           K DISK    PREFIX(X_)
KING F                                     RENAME(KUNDR:KUNDRX)
     F                                     USROPN
     FFIRM      IF   E             DISK    USROPN
     FSYPARL1   IF   E           K DISK    USROPN
     FEDIC      UF   E             DISK    USROPN
     FDKTFI     IF   E             DISK    USROPN
     FEDIM      O  A E             DISK    USROPN
     FFRISOK    UF A E           K DISK    USROPN
     FFRISOL01  IF   E           K DISK    USROPN
     F                                     RENAME(FRISOKR:FRISOKRL)
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy SYSPEDS/qrpgsrcpy,prototypeb
      /copy SYSPEDS/qrpgsrcpy,usec
      /copy SYSPEDS/qrpgsrcpy,variables3
      *
      * Varible for
     D P               S              5U 0
     D WSUSER          S             10
     D DKEH_SYAVA      S              4
     D DKEH_SYAV       S              4  0
     D NEWSYAVA        S              4
     D NEWAVD          S              4  0
     D DKEH_SYOPA      S              7
     D DKEH_SYOP       S              7  0
     D NEWOPD          S              7  0
     D WMODE           S              2
     D WSIGN           S              3
     D NEWSIGN         S              3
     D DKEH_SYSG       S              3
     D DKEH_SYST       S              2
     D DKEH_0035       S              1
     D DKEH_1004       S             20
     D DKEH_XREF       S             35
     D DKEH_A1         S              8
     D DKEH_A2         S             13
     D DKEH_DTM1       S             12S 0
     D DKEH_DTM2       S             12S 0
     D DKEH_AJOU       S              1
     D DKEH_R011       S              2
     D DKEH_R012       S              1
     D DKEH_AART       S              2
     D DKEH_GIS1       S              1
     D DKEH_GIS2       S              1
     D DKEH_GIS3       S              1
     D DKEH_GIS4       S              1
     D DKEH_AVKN       S              8S 0
     D DKEH_02A        S             18
     D DKEH_02B        S             35
     D DKEH_02C        S             35
     D DKEH_02D        S             35
     D DKEH_02E        S             35
     D DKEH_02F        S             35
     D DKEH_06         S              6S 0
     D DKEH_07         S             13
     D DKEH_MOKN       S              8S 0
     D DKEH_08A        S             18
     D DKEH_08B        S             35
     D DKEH_08C        S             35
     D DKEH_08D        S             35
     D DKEH_08E        S             35
     D DKEH_08F        S             35
     D DKEH_REKN       S              8S 0
     D DKEH_REEO       S             18
     D DKEH_RENA       S             35
     D DKEH_REGA       S             35
     D DKEH_REPO       S              9
     D DKEH_REBY       S             35
     D DKEH_RELK       S              2
     D DKEH_TRKN       S              8S 0
     D DKEH_TREO       S             18
     D DKEH_ZKP        S             35
     D DKEH_14A        S             18
     D DKEH_14B        S              1
     D DKEH_17A        S              2
     D DKEH_UVP        S             35
     D DKEH_181        S             20
     D DKEH_201        S              3
     D DKEH_S29        S              1
     D DKEH_202        S             35
     D DKEH_21         S              2
     D DKEH_221        S              3
     D DKEH_221B       S              7S 4
     D DKEH_221C       S              7S 0
     D DKEH_222        S             15S 0
     D DKEH_25         S              1
     D DKEH_26         S              1
     D DKEH_28A        S              4
     D DKEH_28B        S             17
     D DKEH_28C        S              8S 0
     D DKEH_TAF        S             20
     D DKEH_IND        S              8
     D DKEH_29         S              8
     D DKEH_301        S              2
     D DKEH_302        S             16
     D DKEH_303        S              3
     D DKEH_304        S              3
     D DKEH_49         S             17
     D DKEH_BRUT       S             11S 0
     D DKEH_S131       S              2
     D DKEH_S132       S              2
     D DKEH_S133       S              2
     D DKEH_S134       S              2
     D DKEH_S135       S              2
     D DKEH_D011       S             35
     D DKEH_D012       S             35
     D DKEH_D013       S             35
     D DKEH_D014       S             35
     D DKEH_D015       S             35
     D DKEH_FTX1       S             70
     D DKEH_FTX2       S              4S 0
     D DKEH_FTX3       S              4S 0
     D DKEH_FTX4       S             17
     D DKEH_FTX5       S             35
     D DKEH_FTX6       S             70
     D DKEH_FTX7       S             70
     D DKEH_FTX8       S             70
     D DKEH_FTX9       S             70
     D DKEH_FTXA       S              9S 0
     D DKEH_FTXB       S              9S 0
     D DKEH_FTXC       S              9S 0
     D DKEH_FTXD       S              9S 0
     D DKEH_FTXE       S              9S 0
     D DKEH_FTXF       S              9S 0
     D DKEH_FTXG       S              9S 0
     D DKEH_FTXH       S              9S 0
     D DKEH_FTXI       S              9S 0
     D DKEH_FTXJ       S             70
     D DKEH_FTXK       S             70
     D DKEH_FTXL       S             70
     D DKEH_FTXM       S             70
     D DKEH_YM21       S              3
     D DKEH_YM23       S              1
     D DKEH_YMVP       S             35
     D DKEH_YMD1       S             12S 0
     D DKEH_YMD2       S             12S 0
     D DKEH_YMD3       S              8S 0
     D DKEH_YMB1       S             70
     D DKEH_YMB2       S             70
     D DKEH_YMB3       S             70
     D DKEH_YMB4       S             70
     D DKEH_YME1       S              3
     D DKEH_YME2       S              3
     D DKEH_YME3       S              3
     D WA              S             15
     D JSONstring      S          32000
     D Error           S            150

      *get input-string
      /copy syspeds/qrpgsrcpy,prolog3

      * Parse input
     C                   EXSR      Parse
      * Open files etc
     C                   EXSR      INIT
      *
     c                   callp     gethtmlifs(
     C                             '/syspeddev/html/JSON.html':
     C                             '/CGITAG/')
     C                   callp     wrtsection('top')
      * Teste input og utfør
     C  N50              EXSR      TEST

      * ............................................................................................
      * skriv JSON-Object start..(alltid '{' + x ant param. m/komma mellom (IKKE komma etter siste))
      * ............................................................................................
      *
      /free
        JSONstring='{'
        +'¬user¬ : ¬'+%trim(WSUSER)+'¬, '
        +'¬dkeh_syav¬ : ¬'+%trim(%editc(DKEH_SYAV:'Z'))+'¬, '
        +'¬newavd¬ : ¬'+%trim(%editc(NEWAVD:'Z'))+'¬, '
        +'¬dkeh_syop¬ : ¬'+%trim(%editc(DKEH_SYOP:'Z'))+'¬, '
        +'¬newopd¬ : ¬'+%trim(%editc(NEWOPD:'Z'))+'¬, '
        +'¬sign¬ : ¬'+%trim(WSIGN)+'¬, '
        +'¬newsign¬ : ¬'+%trim(NEWSIGN)+'¬, '
        +'¬mode¬ : ¬'+%trim(WMODE)+'¬, '
        +'¬errMsg¬ : ¬'+%trim(Error)+'¬, '
        +'¬dkeh_14a¬ : ¬'+%trim(DKEA_14A)+'¬, '
        +'¬dkeh_14b¬ : ¬'+%trim(DKEA_14B)+'¬, '
        +'¬dkea_0035¬ : ¬'+%trim(DKEA_0035)+'¬, ';
      /end-free
      * JSONfix escaper " i tekst,  for deretter å bytte ¬->"
     c                   call      'JSONFIX'
     c                   parm                    JSONstring
     C                   callp     updHTMLvar('JSONstring':JSONstring)
     C                   callp     wrtsection('JSONlin')
      *
      * ............................................................................................
      * Skriv JSON-LISTE Start (en liste er EN parameter(fra [ til   )
      * ............................................................................................
     c                   eval      JSONstring ='"orderupdate" : ['
     C                   callp     updHTMLvar('JSONstring':JSONstring)
     C                   callp     wrtsection('JSONlin')
      * ............................................................................................
      * Skriv JSON-Liste/Array  Avslutning
      * ............................................................................................
     c                   eval      JSONstring =']'
     C                   callp     updHTMLvar('JSONstring':JSONstring)
     C                   callp     wrtsection('JSONlin')
      * ............................................................................................
      * Skriv JSON-string Avsluttning
      * ............................................................................................
     c                   eval      JSONstring ='}'
     C                   callp     updHTMLvar('JSONstring':JSONstring)
     C                   callp     wrtsection('JSONlin')
      *
      * Quit
     C                   exsr      Exit


      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Lukk fil
     C                   CLOSE     BRIDF
     C  N50              CLOSE     DKEH
     C  N50              CLOSE     DKEV1
     C  N50              CLOSE     DKEA
     C  N50              CLOSE     DKTHA2
     C  N50              CLOSE     SADH
     C  N50              CLOSE     HEADF
     C  N50              CLOSE     CUNDL01
     C  N50              CLOSE     KUNDL01
     C  N50              CLOSE     FIRM
     C  N50              CLOSE     SYPARL1
     C  N50              CLOSE     EDIC
     C  N50              CLOSE     DKTFI
     C  N50              CLOSE     EDIM
     C  N50              CLOSE     FRISOK
     C  N50              CLOSE     FRISOL01

      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      * Quit
     C                   MOVE      *ON           *INLR
     C                   return
     C                   endsr
      *
      *********************************************************
     C     Parse         Begsr
      *********************************************************
      * Get input
     C                   EVAL      WSUSER  = zhbgetvar('USER')
     C                   EVAL      DKEH_SYAVA = zhbgetvar('AVD')
     C                   EVAL      DKEH_SYAV  = c2n2(DKEH_SYAVA)
     C                   EVAL      NEWSYAVA = zhbgetvar('NEWAVD')
     C                   EVAL      NEWAVD  = c2n2(NEWSYAVA)
     C                   EVAL      DKEH_SYOPA = zhbgetvar('OPD')
     C                   EVAL      DKEH_SYOP  = c2n2(DKEH_SYOPA)
     C                   EVAL      WMODE  = zhbgetvar('MODE')
     C                   EVAL      DKEH_SYSG  = zhbgetvar('DKEH_SYSG')
     C                   EVAL      WSIGN      = zhbgetvar('SIGN')
     C                   EVAL      NEWSIGN      = zhbgetvar('NEWSIGN')
     C                   EVAL      DKEH_SYST  = zhbgetvar('DKEH_SYST')
     C                   EVAL      DKEH_0035  = zhbgetvar('DKEH_0035')
     C                   EVAL      DKEH_1004  = zhbgetvar('DKEH_1004')
     C                   EVAL      DKEH_XREF  = zhbgetvar('DKEH_XREF')
     C                   EVAL      DKEH_A1    = zhbgetvar('DKEH_A1')
     C                   EVAL      DKEH_A2    = zhbgetvar('DKEH_A2')
     C                   EVAL      WA         = zhbgetvar('DKEH_DTM1')
     C                   EVAL      DKEH_DTM1  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_DTM2')
     C                   EVAL      DKEH_DTM2  = c2n2(WA)
     C                   EVAL      DKEH_AJOU  = zhbgetvar('DKEH_AJOU')
     C                   EVAL      DKEH_R011  = zhbgetvar('DKEH_R011')
     C                   EVAL      DKEH_R012  = zhbgetvar('DKEH_R012')
     C                   EVAL      DKEH_AART  = zhbgetvar('DKEH_AART')
     C                   EVAL      DKEH_GIS1  = zhbgetvar('DKEH_GIS1')
     C                   EVAL      DKEH_GIS2  = zhbgetvar('DKEH_GIS2')
     C                   EVAL      DKEH_GIS3  = zhbgetvar('DKEH_GIS3')
     C                   EVAL      DKEH_GIS4  = zhbgetvar('DKEH_GIS4')
     C                   EVAL      WA         = zhbgetvar('DKEH_AVKN')
     C                   EVAL      DKEH_AVKN  = c2n2(WA)
     C                   EVAL      DKEH_02A   = zhbgetvar('DKEH_02A')
     C                   EVAL      DKEH_02B   = zhbgetvar('DKEH_02B')
     C                   EVAL      DKEH_02C   = zhbgetvar('DKEH_02C')
     C                   EVAL      DKEH_02D   = zhbgetvar('DKEH_02D')
     C                   EVAL      DKEH_02E   = zhbgetvar('DKEH_02E')
     C                   EVAL      DKEH_02F   = zhbgetvar('DKEH_02F')
     C                   EVAL      WA         = zhbgetvar('DKEH_06')
     C                   EVAL      DKEH_06    = c2n2(WA)
     C                   EVAL      DKEH_07    = zhbgetvar('DKEH_07')
     C                   EVAL      WA         = zhbgetvar('DKEH_MOKN')
     C                   EVAL      DKEH_MOKN  = c2n2(WA)
     C                   EVAL      DKEH_08A   = zhbgetvar('DKEH_08A')
     C                   EVAL      DKEH_08B   = zhbgetvar('DKEH_08B')
     C                   EVAL      DKEH_08C   = zhbgetvar('DKEH_08C')
     C                   EVAL      DKEH_08D   = zhbgetvar('DKEH_08D')
     C                   EVAL      DKEH_08E   = zhbgetvar('DKEH_08E')
     C                   EVAL      DKEH_08F   = zhbgetvar('DKEH_08F')
     C                   EVAL      WA         = zhbgetvar('DKEH_REKN')
     C                   EVAL      DKEH_REKN  = c2n2(WA)
     C                   EVAL      DKEH_REEO  = zhbgetvar('DKEH_REEO')
     C                   EVAL      DKEH_RENA  = zhbgetvar('DKEH_RENA')
     C                   EVAL      DKEH_REGA  = zhbgetvar('DKEH_REGA')
     C                   EVAL      DKEH_REPO  = zhbgetvar('DKEH_REPO')
     C                   EVAL      DKEH_REBY  = zhbgetvar('DKEH_REBY')
     C                   EVAL      DKEH_RELK  = zhbgetvar('DKEH_RELK')
     C                   EVAL      WA         = zhbgetvar('DKEH_TRKN')
     C                   EVAL      DKEH_TRKN  = c2n2(WA)
     C                   EVAL      DKEH_TREO  = zhbgetvar('DKEH_TREO')
     C                   EVAL      DKEH_ZKP   = zhbgetvar('DKEH_ZKP')
     C                   EVAL      DKEH_14A   = zhbgetvar('DKEH_14A')
     C                   EVAL      DKEH_14B   = zhbgetvar('DKEH_14B')
     C                   EVAL      DKEH_17A   = zhbgetvar('DKEH_17A')
     C                   EVAL      DKEH_UVP   = zhbgetvar('DKEH_UVP')
     C                   EVAL      DKEH_181  = zhbgetvar('DKEH_181')
     C                   EVAL      DKEH_201   = zhbgetvar('DKEH_201')
     C                   EVAL      DKEH_S29   = zhbgetvar('DKEH_S29')
     C                   EVAL      DKEH_202   = zhbgetvar('DKEH_202')
     C                   EVAL      DKEH_21    = zhbgetvar('DKEH_21')
     C                   EVAL      DKEH_221   = zhbgetvar('DKEH_221')
     C                   EVAL      WA         = zhbgetvar('DKEH_221B')
     C                   EVAL      DKEH_221B  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_221C')
     C                   EVAL      DKEH_221C  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_222')
     C                   EVAL      DKEH_222   = c2n2(WA)
     C                   EVAL      DKEH_25    = zhbgetvar('DKEH_25')
     C                   EVAL      DKEH_26    = zhbgetvar('DKEH_26')
     C                   EVAL      DKEH_28A   = zhbgetvar('DKEH_28A')
     C                   EVAL      DKEH_28B   = zhbgetvar('DKEH_28B')
     C                   EVAL      WA         = zhbgetvar('DKEH_28C')
     C                   EVAL      DKEH_28C   = c2n2(WA)
     C                   EVAL      DKEH_TAF   = zhbgetvar('DKEH_TAF')
     C                   EVAL      DKEH_IND   = zhbgetvar('DKEH_IND')
     C                   EVAL      DKEH_29    = zhbgetvar('DKEH_29')
     C                   EVAL      DKEH_301   = zhbgetvar('DKEH_301')
     C                   EVAL      DKEH_302   = zhbgetvar('DKEH_302')
     C                   EVAL      DKEH_303   = zhbgetvar('DKEH_303')
     C                   EVAL      DKEH_304   = zhbgetvar('DKEH_304')
     C                   EVAL      DKEH_49    = zhbgetvar('DKEH_49')
     C                   EVAL      WA         = zhbgetvar('DKEH_BRUT')
     C                   EVAL      DKEH_BRUT  = c2n2(WA)
     C                   EVAL      DKEH_S131  = zhbgetvar('DKEH_S131')
     C                   EVAL      DKEH_S132  = zhbgetvar('DKEH_S132')
     C                   EVAL      DKEH_S133  = zhbgetvar('DKEH_S133')
     C                   EVAL      DKEH_S134  = zhbgetvar('DKEH_S134')
     C                   EVAL      DKEH_S135  = zhbgetvar('DKEH_S135')
     C                   EVAL      DKEH_D011  = zhbgetvar('DKEH_D011')
     C                   EVAL      DKEH_D012  = zhbgetvar('DKEH_D012')
     C                   EVAL      DKEH_D013  = zhbgetvar('DKEH_D013')
     C                   EVAL      DKEH_D014  = zhbgetvar('DKEH_D014')
     C                   EVAL      DKEH_D015  = zhbgetvar('DKEH_D015')
     C                   EVAL      DKEH_FTX1  = zhbgetvar('DKEH_FTX1')
     C                   EVAL      WA         = zhbgetvar('DKEH_FTX2')
     C                   EVAL      DKEH_FTX2  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_FTX3')
     C                   EVAL      DKEH_FTX3  = c2n2(WA)
     C                   EVAL      DKEH_FTX4  = zhbgetvar('DKEH_FTX4')
     C                   EVAL      DKEH_FTX5  = zhbgetvar('DKEH_FTX5')
     C                   EVAL      DKEH_FTX6  = zhbgetvar('DKEH_FTX6')
     C                   EVAL      DKEH_FTX7  = zhbgetvar('DKEH_FTX7')
     C                   EVAL      DKEH_FTX8  = zhbgetvar('DKEH_FTX8')
     C                   EVAL      DKEH_FTX9  = zhbgetvar('DKEH_FTX9')
     C                   EVAL      WA         = zhbgetvar('DKEH_FTXA')
     C                   EVAL      DKEH_FTXA  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_FTXB')
     C                   EVAL      DKEH_FTXB  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_FTXC')
     C                   EVAL      DKEH_FTXC  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_FTXD')
     C                   EVAL      DKEH_FTXD  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_FTXE')
     C                   EVAL      DKEH_FTXE  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_FTXF')
     C                   EVAL      DKEH_FTXF  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_FTXG')
     C                   EVAL      DKEH_FTXG  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_FTXH')
     C                   EVAL      DKEH_FTXH  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_FTXI')
     C                   EVAL      DKEH_FTXI  = c2n2(WA)
     C                   EVAL      DKEH_FTXJ  = zhbgetvar('DKEH_FTXJ')
     C                   EVAL      DKEH_FTXK  = zhbgetvar('DKEH_FTXK')
     C                   EVAL      DKEH_FTXL  = zhbgetvar('DKEH_FTXL')
     C                   EVAL      DKEH_FTXM  = zhbgetvar('DKEH_FTXM')
     C                   EVAL      DKEH_YM21  = zhbgetvar('DKEH_YM21')
     C                   EVAL      DKEH_YM23  = zhbgetvar('DKEH_YM23')
     C                   EVAL      DKEH_YMVP  = zhbgetvar('DKEH_YMVP')
     C                   EVAL      WA         = zhbgetvar('DKEH_YMD1')
     C                   EVAL      DKEH_YMD1  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_YMD2')
     C                   EVAL      DKEH_YMD2  = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('DKEH_YMD3')
     C                   EVAL      DKEH_YMD3  = c2n2(WA)
     C                   EVAL      DKEH_YMB1  = zhbgetvar('DKEH_YMB1')
     C                   EVAL      DKEH_YMB2  = zhbgetvar('DKEH_YMB2')
     C                   EVAL      DKEH_YMB3  = zhbgetvar('DKEH_YMB3')
     C                   EVAL      DKEH_YMB4  = zhbgetvar('DKEH_YMB4')
     C                   EVAL      DKEH_YME1  = zhbgetvar('DKEH_YME1')
     C                   EVAL      DKEH_YME2  = zhbgetvar('DKEH_YME2')
     C                   EVAL      DKEH_YME3  = zhbgetvar('DKEH_YME3')
     C                   ENDSR
      *********************************************************
     C     INIT          Begsr
      *********************************************************
     C                   OPEN      BRIDF
      * Test innlogging
     C     WSUSER        CHAIN     BRIDF                              50
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C                   call      BILIBL
     C                   end
      *
     C     DKEHKey       klist
     C                   kfld                    DKEH_SYAV
     C                   kfld                    DKEH_SYOP
     C     CUNDL01K      KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C     SYPARKEY      KLIST
     C                   KFLD                    WSYKUNR
     C                   KFLD                    WSYPAID
     C     FRIKEY        klist
     C                   kfld                    DKEH_SYAV
     C                   kfld                    DKEH_SYOP
     C                   KFLD                    WFSKODE           3
     C     FRIKEY01      KLIST
     C                   KFLD                    WFSKODE
     C                   KFLD                    DKEH_XREF
     C     *LIKE         DEFINE    DKEH_08E      W_PADR
     C     *LIKE         DEFINE    SYKUNR        WSYKUNR
     C     *LIKE         DEFINE    SYPAID        WSYPAID
     C                   EVAL      WSYPAID='DKMVA'
     C                   EVAL      WFSKODE='*CE'
      *
     C   50              eval      Error = 'Invalid userID'
     C  N50              OPEN      DKEH
     C  N50              OPEN      DKEV1
     C  N50              OPEN      DKEA
     C  N50              OPEN      DKTHA2
     C  N50              OPEN      SADH
     C  N50              OPEN      HEADF
     C  N50              OPEN      CUNDL01
     C  N50              OPEN      KUNDL01
     C  N50              OPEN      FIRM
     C  N50              OPEN      SYPARL1
     C  N50              OPEN      EDIC
     C  N50              OPEN      DKTFI
     C  N50              OPEN      EDIM
     C  N50              OPEN      FRISOK
     C  N50              OPEN      FRISOL01
      *_________________________________
      * Hæmta dagens datum och klockslag
      *"""""""""""""""""""""""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
      * Hæmta firmaopplysninger
     C                   READ      FIRM
      * MODE=GS
     C     WMODE         IFEQ      'GS'
     C     DKEH_XREF     ANDNE     *BLANKS
     C     *IN50         ANDEQ     *OFF
     C     FRIKEY01      CHAIN     FRISOL01                           56
     C                   IF        *IN56=*OFF
     C                   EVAL      DKEH_SYAV=FSAVD
     C                   EVAL      DKEH_SYOP=FSOPD
     C                   ENDIF
     C                   ENDIF

     c                   endsr
      *
      *______________________________________________________
      * TEST                                             TEST
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     TEST          BEGSR
      * Hæmta userid
     C     WSUSER        CHAIN     DKTHA2
      * Hæmta ærende
     C     WMODE         IFNE      'A'
     C     DKEHKey       CHAIN     DKEH                               55
     C                   ENDIF
      * MODE A=Add  D=Delete  U=Update  S=Skicka  C=Copy  GS=Hæmta från SYSPED
     C                   SELECT
     C     WMODE         WHENEQ    'A'
     C                   eval      Error = *blanks
     C                   EXSR      SRA
     C     WMODE         WHENEQ    'GS'
     C                   eval      Error = *blanks
     C  N55              eval      Error = 'Fel, finns redan'
     C   55              EXSR      SRGS
     C     WMODE         WHENEQ    'C'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   UPDATE    DKEHR
     C                   eval      Error = *blanks
     C                   EXSR      SRC
     C                   ENDIF
     C     WMODE         WHENEQ    'D'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   eval      Error = *blanks
     C                   EXSR      SRD
     C                   ENDIF
     C     WMODE         WHENEQ    'S'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   eval      Error = *blanks
     C                   EXSR      SRS
     C                   ENDIF
     C     WMODE         WHENEQ    'U'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   eval      Error = *blanks
     C                   EXSR      SRU
     C                   ENDIF
     C                   OTHER
     C                   eval      Error = 'Wrong mode'
     C                   ENDSL
     C                   ENDSR
      *______________________________________________________
      * Add                                               SRA
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRA           BEGSR
     C                   CLEAR                   DKEHR
      * Hæmta uppdragsnummer
     C     DKEH_SYAV     CHAIN     DKEA                               52
     C                   ADD       1             DKEA_SYOP
     C                   UPDATE    DKEAR
     C                   EVAL      XDKEH_SYAV=DKEH_SYAV
     C                   EVAL      DKEH_SYOP=DKEA_SYOP
     C                   EVAL      XDKEH_SYOP=DKEH_SYOP
     C                   EVAL      XDKEH_SYSG=WSIGN
     C                   MOVEL     WDT           XDKEH_SYDT
      * Write
     C                   WRITE     DKEHR
     C                   ENDSR
      *______________________________________________________
      * Delete                                            SRD
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRD           BEGSR
     C                   EVAL      XDKEH_SYST='D '
     C                   UPDATE    DKEHR
     C                   ENDSR
      *______________________________________________________
      * Skicka                                            SRS
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRS           BEGSR
     C                   eval      Error = *blanks
      * Tvungen testindikator ?
     C     XDKEH_0035    IFEQ      *BLANKS
     C     XDKEH_SYAV    CHAIN(N)  DKEA
     C     DKEA_0035     IFNE      *BLANKS
     C                   EVAL      XDKEH_0035=DKEA_0035
     C                   ENDIF
     C                   ENDIF
      * Ændra status
     C                   EVAL      XDKEH_SYST='A '
     C                   UPDATE    DKEHR
      * Hæmta firmaupplysningar
     C     1             CHAIN     DKTFI                              51
      * Hæmta næsta meddelandenummer
     C     1             CHAIN     EDIC                               51
     C                   ADD       1             CMN
     C                   UPDATE    EDICR
      * Hæmta dagens datum och klockslag
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
      * Skriv til EDIM
     C                   CLEAR                   EDIMR
     C                   EVAL      M0004=DKTF_0004T
     C                   EVAL      M0010=DKTF_0010T
     C                   EVAL      M0035=XDKEH_0035
     C                   MOVEL     DKEH_SYAV     W0062            11
     C                   MOVE      DKEH_SYOP     W0062
     C                   EVAL      M0062=W0062
     C                   EVAL      M0065='CUSDEC'
     C                   EVAL      M1001=XDKEH_AART
     C                   EVAL      M1004=XDKEH_1004
     C                   EVAL      M1225=XDKEH_AART
     C                   EVAL      M1N07='DKE'
     C                   EVAL      MMN=CMN
     C                   EVAL      MSR='S'
     C                   MOVEL     WDT           MDT
     C                   MOVEL     WTM           MTM
     C                   EVAL      MAVD=DKEH_SYAV
     C                   EVAL      MTDN=DKEH_SYOP

     C                   WRITE     EDIMR
     C                   ENDSR
      *______________________________________________________
      * Update                                            SRU
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRU           BEGSR
     C                   EVAL      XDKEH_SYST = DKEH_SYST
     C                   EVAL      XDKEH_0035 = DKEH_0035
     C                   EVAL      XDKEH_1004 = DKEH_1004
     C                   EVAL      XDKEH_A1   = DKEH_A1
     C                   EVAL      XDKEH_A2   = DKEH_A2
     C                   EVAL      XDKEH_DTM1 = DKEH_DTM1
     C                   EVAL      XDKEH_DTM2 = DKEH_DTM2
     C                   EVAL      XDKEH_AJOU = DKEH_AJOU
     C                   EVAL      XDKEH_R011 = DKEH_R011
     C                   EVAL      XDKEH_R012 = DKEH_R012
     C                   EVAL      XDKEH_AART = DKEH_AART
     C                   EVAL      XDKEH_GIS1 = DKEH_GIS1
     C                   EVAL      XDKEH_GIS2 = DKEH_GIS2
     C                   EVAL      XDKEH_GIS3 = DKEH_GIS3
     C                   EVAL      XDKEH_GIS4 = DKEH_GIS4
     C                   EVAL      XDKEH_AVKN = DKEH_AVKN
     C                   EVAL      XDKEH_02A  = DKEH_02A
     C                   EVAL      XDKEH_02B  = DKEH_02B
     C                   EVAL      XDKEH_02C  = DKEH_02C
     C                   EVAL      XDKEH_02D  = DKEH_02D
     C                   EVAL      XDKEH_02E  = DKEH_02E
     C                   EVAL      XDKEH_02F  = DKEH_02F
     C                   EVAL      XDKEH_06   = DKEH_06
     C                   EVAL      XDKEH_07   = DKEH_07
     C                   EVAL      XDKEH_MOKN = DKEH_MOKN
     C                   EVAL      XDKEH_08A  = DKEH_08A
     C                   EVAL      XDKEH_08B  = DKEH_08B
     C                   EVAL      XDKEH_08C  = DKEH_08C
     C                   EVAL      XDKEH_08D  = DKEH_08D
     C                   EVAL      XDKEH_08E  = DKEH_08E
     C                   EVAL      XDKEH_08F  = DKEH_08F
     C                   EVAL      XDKEH_REKN = DKEH_REKN
     C                   EVAL      XDKEH_REEO = DKEH_REEO
     C                   EVAL      XDKEH_RENA = DKEH_RENA
     C                   EVAL      XDKEH_REGA = DKEH_REGA
     C                   EVAL      XDKEH_REPO = DKEH_REPO
     C                   EVAL      XDKEH_REBY = DKEH_REBY
     C                   EVAL      XDKEH_RELK = DKEH_RELK
     C                   EVAL      XDKEH_TRKN = DKEH_TRKN
     C                   EVAL      XDKEH_TREO = DKEH_TREO
     C                   EVAL      XDKEH_ZKP  = DKEH_ZKP
     C                   EVAL      XDKEH_14A  = DKEH_14A
     C                   EVAL      XDKEH_14B  = DKEH_14B
     C                   EVAL      XDKEH_17A  = DKEH_17A
     C                   EVAL      XDKEH_UVP  = DKEH_UVP
     C                   EVAL      XDKEH_181  = DKEH_181
     C                   EVAL      XDKEH_201  = DKEH_201
     C                   EVAL      XDKEH_S29  = DKEH_S29
     C                   EVAL      XDKEH_202  = DKEH_202
     C                   EVAL      XDKEH_21   = DKEH_21
     C                   EVAL      XDKEH_221  = DKEH_221
     C                   EVAL      XDKEH_221B = DKEH_221B
     C                   EVAL      XDKEH_221C = DKEH_221C
     C                   EVAL      XDKEH_222  = DKEH_222
     C                   EVAL      XDKEH_25   = DKEH_25
     C                   EVAL      XDKEH_26   = DKEH_26
     C                   EVAL      XDKEH_28A  = DKEH_28A
     C                   EVAL      XDKEH_28B  = DKEH_28B
     C                   EVAL      XDKEH_28C  = DKEH_28C
     C                   EVAL      XDKEH_TAF  = DKEH_TAF
     C                   EVAL      XDKEH_IND  = DKEH_IND
     C                   EVAL      XDKEH_29   = DKEH_29
     C                   EVAL      XDKEH_301  = DKEH_301
     C                   EVAL      XDKEH_302  = DKEH_302
     C                   EVAL      XDKEH_303  = DKEH_303
     C                   EVAL      XDKEH_304  = DKEH_304
     C                   EVAL      XDKEH_49   = DKEH_49
     C                   EVAL      XDKEH_BRUT = DKEH_BRUT
     C                   EVAL      XDKEH_S131 = DKEH_S131
     C                   EVAL      XDKEH_S132 = DKEH_S132
     C                   EVAL      XDKEH_S133 = DKEH_S133
     C                   EVAL      XDKEH_S134 = DKEH_S134
     C                   EVAL      XDKEH_S135 = DKEH_S135
     C                   EVAL      XDKEH_D011 = DKEH_D011
     C                   EVAL      XDKEH_D012 = DKEH_D012
     C                   EVAL      XDKEH_D013 = DKEH_D013
     C                   EVAL      XDKEH_D014 = DKEH_D014
     C                   EVAL      XDKEH_D015 = DKEH_D015
     C                   EVAL      XDKEH_FTX1 = DKEH_FTX1
     C                   EVAL      XDKEH_FTX2 = DKEH_FTX2
     C                   EVAL      XDKEH_FTX3 = DKEH_FTX3
     C                   EVAL      XDKEH_FTX4 = DKEH_FTX4
     C                   EVAL      XDKEH_FTX5 = DKEH_FTX5
     C                   EVAL      XDKEH_FTX6 = DKEH_FTX6
     C                   EVAL      XDKEH_FTX7 = DKEH_FTX7
     C                   EVAL      XDKEH_FTX8 = DKEH_FTX8
     C                   EVAL      XDKEH_FTX9 = DKEH_FTX9
     C                   EVAL      XDKEH_FTXA = DKEH_FTXA
     C                   EVAL      XDKEH_FTXB = DKEH_FTXB
     C                   EVAL      XDKEH_FTXC = DKEH_FTXC
     C                   EVAL      XDKEH_FTXD = DKEH_FTXD
     C                   EVAL      XDKEH_FTXE = DKEH_FTXE
     C                   EVAL      XDKEH_FTXF = DKEH_FTXF
     C                   EVAL      XDKEH_FTXG = DKEH_FTXG
     C                   EVAL      XDKEH_FTXH = DKEH_FTXH
     C                   EVAL      XDKEH_FTXI = DKEH_FTXI
     C                   EVAL      XDKEH_FTXJ = DKEH_FTXJ
     C                   EVAL      XDKEH_FTXK = DKEH_FTXK
     C                   EVAL      XDKEH_FTXL = DKEH_FTXL
     C                   EVAL      XDKEH_FTXM = DKEH_FTXM
     C                   EVAL      XDKEH_YM21 = DKEH_YM21
     C                   EVAL      XDKEH_YM23 = DKEH_YM23
     C                   EVAL      XDKEH_YMVP = DKEH_YMVP
     C                   EVAL      XDKEH_YMD1 = DKEH_YMD1
     C                   EVAL      XDKEH_YMD2 = DKEH_YMD2
     C                   EVAL      XDKEH_YMD3 = DKEH_YMD3
     C                   EVAL      XDKEH_YMB1 = DKEH_YMB1
     C                   EVAL      XDKEH_YMB2 = DKEH_YMB2
     C                   EVAL      XDKEH_YMB3 = DKEH_YMB3
     C                   EVAL      XDKEH_YMB4 = DKEH_YMB4
     C                   EVAL      XDKEH_YME1 = DKEH_YME1
     C                   EVAL      XDKEH_YME2 = DKEH_YME2
     C                   EVAL      XDKEH_YME3 = DKEH_YME3
     C                   UPDATE    DKEHR
      * Legg ut frie søkeveier
     C     FRIKEY        DELETE    FRISOK                             56
     C     DKEH_XREF     IFNE      *BLANKS
     C                   CLEAR                   FRISOKR
     C                   EVAL      FSAVD=DKEH_SYAV
     C                   EVAL      FSOPD=DKEH_SYOP
     C                   EVAL      FSKODE='*CE'
     C                   EVAL      FSSOK=DKEH_XREF
     C                   MOVE      WDT           FSDTOP
     C                   WRITE     FRISOKR
     C                   ENDIF
     C                   ENDSR
      *______________________________________________________
      * Copy                                              SRC
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRC           BEGSR
     C                   EVAL      WSIGN=DKEH_SYSG
      * Hæmta uppdragsnummer
     C     NEWAVD        CHAIN     DKEA                               52
     C                   ADD       1             DKEA_SYOP
     C                   UPDATE    DKEAR
     C                   EVAL      XDKEH_SYAV=NEWAVD
     C                   EVAL      XDKEH_SYOP=DKEA_SYOP
     C                   EVAL      NEWOPD=DKEA_SYOP
     C                   EVAL      XDKEH_SYSG=NEWSIGN
     C                   MOVEL     WDT           XDKEH_SYDT
     C                   EVAL      XDKEH_14A=DKEA_14A
     C                   EVAL      XDKEH_14B=DKEA_14B
     C                   EVAL      XDKEH_SYST=*BLANKS
     C                   EVAL      XDKEH_DTM1=*ZEROS
     C                   EVAL      XDKEH_DTM2=*ZEROS
     C                   EVAL      XDKEH_AJOU=*BLANKS
     C                   EVAL      XDKEH_07=*BLANKS
     C                   EVAL      XDKEH_MRN=*BLANKS
     C                   EVAL      XDKEH_221=*BLANKS
     C                   EVAL      XDKEH_221B=*ZEROS
     C                   EVAL      XDKEH_222=*ZEROS
      * Write
     C                   WRITE     DKEHR
      * Kopiera också varuposter
     C                   EVAL      *IN52=*OFF
     C     DKEHKey       SETLL     DKEV1
     C     DKEHKey       READE     DKEV1                                  52
     C     *IN52         DOWEQ     *OFF

     C                   EVAL      DKEV_SYAV=NEWAVD
     C                   EVAL      DKEV_SYOP=NEWOPD
     C                   WRITE     DKEVR

     C     DKEHKey       READE     DKEV1                                  52
     C                   ENDDO
     C                   ENDSR
      *______________________________________________________
      * Hæmta från SAD Import, SYSPED op, eller DKE      SRGS
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRGS          BEGSR
      * Finnes SAD Import ?
     C     DKEhKey       CHAIN     SADH                               53
      * Finnes SYSPED Oppdrag ?
     C     DKEhKey       CHAIN(N)  HEADF                              54
      * Fel, finns inte varken sad eksport eller sysped uppdrag
     C                   IF        *IN53
     C                   IF        *IN54
     C                   eval      Error = 'Order not found'
     C                   GOTO      SRGS9
     C                   ENDIF
     C                   ENDIF
      * Skapa gemensam information
     C     DKEH_SYAV     CHAIN(N)  DKEA                               52
     C                   EVAL      XDKEH_SYAV=DKEH_SYAV
     C                   EVAL      XDKEH_SYOP=DKEH_SYOP
     C                   EVAL      XDKEH_SYSG=WSIGN
     C                   MOVEL     WDT           XDKEH_SYDT
     C                   EVAL      XDKEH_14A=DKEA_14A
     C                   EVAL      XDKEH_14B=DKEA_14B

     C                   EVAL      XDKEH_AART='24'
     C                   EVAL      XDKEH_R011='EU'
     C                   EVAL      XDKEH_R012='A'
     C                   EVAL      XDKEH_A1='5600'
     C                   EVAL      XDKEH_S29='Y'
     C                   EVAL      XDKEH_28A='N380'
      * Hæmta från SAD Import
     C  N53              EXSR      SRGSS
      * Hæmta från SYSPED oppdrag
     C   53              EXSR      SRGSO
      * Write
     C                   WRITE     DKEHR
     C     SRGS9         ENDSR
      *______________________________________________________
      * Hæmta från SAD Import                           SRGSS
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRGSS         BEGSR
     C                   EVAL      XDKEH_AVKN=SIKNS
     C                   EVAL      XDKEH_02B=SINAS
     C                   EVAL      XDKEH_02C=SIADS1
     C                   EVAL      P = %SCAN (' ' : SIADS3)
     C                   EVAL      XDKEH_02D=%SUBST(SIADS3:1:P)
     C                   EVAL      W_PADR=%SUBST(SIADS3:P+1)
     C                   EVAL      XDKEH_02E=%triml(W_PADR)
     C                   EVAL      XDKEH_02F='NO'
      * Spesial kingsrød, hent avs. oppl fra kundereg uansett
     C     XDKEH_AVKN    IFNE      0
     C                   MOVE      XDKEH_AVKN    KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            35
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN35=*OFF
     C                   EVAL      XDKEH_02B = KNAVN
     C                   EVAL      XDKEH_02C = ADR1
     C                   IF        POSTNR = 0

     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XDKEH_02D=%SUBST(SYPOGE:P:Q)

     C                   ELSE
     C                   EVAL      XDKEH_02D = *BLANKS
     C                   MOVEL     POSTNR        XDKEH_02D
     C                   ENDIF
     C                   MOVEL     ADR3          XDKEH_02E
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XDKEH_02F = SYLAND
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C                   EVAL      XDKEH_MOKN=SIKNK
     C                   EVAL      XDKEH_08B=SINAK
     C                   EVAL      XDKEH_08C=SIADK1
     C                   EVAL      P = %SCAN (' ' : SIADK3)
     C                   EVAL      XDKEH_08D=%SUBST(SIADK3:1:P)
     C                   EVAL      W_PADR=%SUBST(SIADK3:P+1)
     C                   EVAL      XDKEH_08E=%triml(W_PADR)
     C*                  EVAL      XDKEH_08F=SILKA
     C                   MOVEL     SILKA         XDKEH_08F
     C                   EVAL      XDKEH_14A=DKEA_14A
     C                   EVAL      XDKEH_14B=DKEA_14B
     C                   EVAL      XDKEH_17A=SILKA
     C                   EVAL      XDKEH_221=SIVAL1
     C                   EVAL      XDKEH_222=SIBEL1
     C                   MOVEL     '3'           XDKEH_25
     C                   MOVEL     '3'           XDKEH_26
     C                   MOVEL     SIFIF         XDKEH_28B
     C                   MOVE      SIFID         XDKEH_28C
     C                   EVAL      XDKEH_181=SITRID
     C                   EVAL      XDKEH_21=SILKT
     C                   EVAL      XDKEH_06=SINTK
     C                   EVAL      XDKEH_BRUT=SIVKB
      * hæmta kundinfo
     C     XDKEH_MOKN    IFNE      0
     C                   MOVE      XDKEH_MOKN    KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            40
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN40=*OFF
     C     XDKEH_08A     IFEQ      *BLANKS
     C     EORI          IFNE      *BLANKS
     C                   EVAL      XDKEH_08A=EORI
     C                   ELSE
     C                   MOVEL(P)  SYLAND        XDKEH_08A
     C                   CAT       SYRG:0        XDKEH_08A
     C                   CAT       '00':0        XDKEH_08A
     C                   IF        SYRG=*BLANKS
     C                   MOVEL(P)  SYLAND        XDKEH_08A
     C                   CAT       VATKKU:0      XDKEH_08A
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C     XDKEH_08F     IFEQ      *BLANKS
     C                   EVAL      XDKEH_08F = SYLAND
     C                   ENDIF
      * Spesial for Kingrød, hent mott.oppl fra kundereg uansett
     C                   EVAL      XDKEH_08B = KNAVN
     C                   EVAL      XDKEH_08C = ADR1
     C                   IF        POSTNR = 0

     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XDKEH_08D=%SUBST(SYPOGE:P:Q)

     C                   ELSE
     C                   EVAL      XDKEH_08D = *BLANKS
     C                   MOVEL     POSTNR        XDKEH_08D
     C                   ENDIF
     C                   EVAL      XDKEH_08E = ADR3
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XDKEH_08F = SYLAND
     C                   ENDIF
      * Hent godslokalkode fra CUNDF
     C     XDKEH_49      IFEQ      *BLANKS
     C                   EVAL      XDKEH_49=GOLK
     C                   ENDIF

     C                   ENDIF
     C                   ENDIF
      *Og bitte lite til fra HEADF
     C     DKEHKEY       CHAIN(N)  HEADF                              52
     C     *IN52         IFEQ      *OFF
     C                   EVAL      XDKEH_181=HEHAWB
     C                   ENDIF
      * Kopier varelinjer
     C                   CALL      'DKE009R'
     C                   PARM                    XDKEH_SYAV
     C                   PARM                    XDKEH_SYOP
     C*                  PARM                    XDKEH_EUP1
     C                   ENDSR
      *______________________________________________________
      * Hæmta från SYSPED Oppdrag                       SRGSO
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRGSO         BEGSR
     C                   EVAL      XDKEH_AVKN=HEKNS
     C                   EVAL      XDKEH_02B=HENAS
     C                   EVAL      XDKEH_02C=HEADS1
     C                   EVAL      P = %SCAN (' ' : HEADS3)
     C                   EVAL      XDKEH_02D=%SUBST(HEADS3:1:P)
     C                   EVAL      W_PADR=%SUBST(HEADS3:P+1)
     C                   EVAL      XDKEH_02E=%triml(W_PADR)
     C                   EVAL      XDKEH_02F=HELKS
      * Spesial kingsrød, hent avs. oppl fra kundereg uansett
     C     XDKEH_AVKN    IFNE      0
     C                   MOVE      XDKEH_AVKN    KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            35
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN35=*OFF
     C                   EVAL      XDKEH_02B = KNAVN
     C                   EVAL      XDKEH_02C = ADR1
     C                   IF        POSTNR = 0

     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XDKEH_02D=%SUBST(SYPOGE:P:Q)

     C                   ELSE
     C                   EVAL      XDKEH_02D = *BLANKS
     C                   MOVEL     POSTNR        XDKEH_02D
     C                   ENDIF
     C                   MOVEL     ADR3          XDKEH_02E
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XDKEH_02F = SYLAND
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF

     C                   EVAL      XDKEH_MOKN=HEKNK
     C                   EVAL      XDKEH_08B=HENAK
     C                   EVAL      XDKEH_08C=HEADK1
     C                   EVAL      P = %SCAN (' ' : HEADK3)
     C                   EVAL      XDKEH_08D=%SUBST(HEADK3:1:P)
     C                   EVAL      W_PADR=%SUBST(HEADK3:P+1)
     C                   EVAL      XDKEH_08E=%triml(W_PADR)
     C                   EVAL      XDKEH_08F=HELKK
     C                   EVAL      XDKEH_14A=DKEA_14A
     C                   EVAL      XDKEH_14B=DKEA_14B
     C                   EVAL      XDKEH_17A=HELKA
     C                   EVAL      XDKEH_06=HENT
     C                   MOVEL     '3'           XDKEH_25
     C                   MOVEL     '3'           XDKEH_26
     C                   EVAL      XDKEH_181=HETRI
     C                   EVAL      XDKEH_BRUT=HEVKT
      * hæmta kundinfo
     C     XDKEH_MOKN    IFNE      0
     C                   MOVE      XDKEH_MOKN    KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            40
KING C     CUNDL01K      CHAIN     KUNDL01
     C                   IF        *IN40=*OFF
     C     XDKEH_08A     IFEQ      *BLANKS
     C     EORI          IFNE      *BLANKS
     C                   EVAL      XDKEH_08A=EORI
     C                   ELSE
     C                   MOVEL(P)  SYLAND        XDKEH_08A
     C                   CAT       SYRG:0        XDKEH_08A
     C                   CAT       '00':0        XDKEH_08A
     C                   IF        SYRG=*BLANKS
     C                   MOVEL(P)  SYLAND        XDKEH_08A
     C                   CAT       VATKKU:0      XDKEH_08A
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C     XDKEH_08F     IFEQ      *BLANKS
     C                   EVAL      XDKEH_08F = SYLAND
     C                   ENDIF
      * Spesial for Kingrød, hent mott.oppl fra kundereg uansett
     C                   EVAL      XDKEH_08B = KNAVN
     C                   EVAL      XDKEH_08C = ADR1
     C                   IF        POSTNR = 0

     C                   EVAL      P = %SCAN ('-' : SYPOGE)
     C     9             SUB       P             Q                 1 0
     C                   ADD       1             P
     C                   EVAL      XDKEH_08D=%SUBST(SYPOGE:P:Q)

     C                   ELSE
     C                   EVAL      XDKEH_08D = *BLANKS
     C                   MOVEL     POSTNR        XDKEH_08D
     C                   ENDIF
     C                   EVAL      XDKEH_08E = ADR3
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XDKEH_08F = SYLAND
     C                   ENDIF
      * Hent godslokalkode fra CUNDF
     C     XDKEH_49      IFEQ      *BLANKS
     C                   EVAL      XDKEH_49=GOLK
     C                   ENDIF

     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
