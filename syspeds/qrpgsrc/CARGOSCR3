********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10153 * 01 JOV PTF10 LM innført+STERKT ommskrevetr-Forenkling/direkte oppdatering
      * %%%%%%%%%%%%%%%%%%%%%%
      * 02 JOV PTF11 ignorer  GENRELL GODSMERKE MM - KUN KOLLI-ID  (= LINJE 00 I/E )
********************************************************************
     H DATEDIT(*YMD)
     FCARGOF    UF   E           K DISK
     FCARGOF2   UF   E           K DISK
     F                                     RENAME(CARGOFR:CARGOFR2)
     FDOKUFM    IF   E           K DISK
     FDOKUFM1   UF   E           K DISK
     F                                     RENAME(DOKUFMR:DOKUFM1R)
     FCARGOO    IF   E           K DISK
     FHENOK     IF   E           K DISK
     FHENOK01   UF   E           K DISK
     F                                     RENAME(HENOKR:HENOK1R)
     D                 DS
     D  FMMRK1                 1     35
     D  FMCLID                 1     18
     D                 DS
     D  KOID                   1     20
     D  KOID18                 3     20
      *___________
      * Initiering
      *"""""""""""
     C                   EXSR      INIT
      *
     C                   EXSR      MAIN
      *
     C                   MOVE      '1'           *INLR
     C                   RETURN
      *
      *////////////////////////////////////////////////////////////
      *                                                     STATUS/
      *////////////////////////////////////////////////////////////
     C     MAIN          BEGSR
      *
     C     *LOVAL        SETLL     CARGOF2
     C                   READ      CARGOF2                                33
     C     *IN33         DOWEQ     '0'
      * Mer en en måned gammel - merk med oppdrag 99999 som et dummy flagg/status
     C     KOINDT        IFLT      MinDato
     C     KOID          OREQ      *BLANKS
     c                   move      9999999       KOOPD
     C                   update    CARGOFR2
     c                   else
     C                   update    CARGOFR2
      * sjekk om kolli finnes i dokufm-oppdater dersom komplett
     c                   Move      'N'           DokufmYN          1
     C                   EXSR      OppDatO
      * Henteoppdragssystemet sjekkes kun dersom det ikke er kolli i DOKUFM
     C     DokufmYN      ifeq      'N'
     C                   EXSR      OppDatH
     c                   end
     c                   end
      *
     C                   READ      CARGOF2                                33
     C                   END
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
     C     OppDatO       BEGSR
      *////////////////////////////////////////////////////////////
      *
      *
      * SETT STATUS I DOKUFM(hvis den finnes der..)
     C                   EVAL      FMMRK1 = KOID18
     C     FMMRK1        setll     DOKUFM1
     c     TerMtag       tag                                                    Hos BHR fler like
     C                   Read      DOKUFM1                                33
     C  N33FMCLID        Comp      KOID18                             3333
     C     *in33         cabeq     '1'           UtOppd
      *
BHR   * KOLLI-ID kan være skutt både i Oslo og senere i Drammen(OMEX)- merk det rette
BHR  C*    KOTERM        IFEQ      'OSL'
BHR  C*    FMAVD         CABLT     8000          TerMtag
BHR  C*                  ELSE
BHR  C*    FMAVD         CABGT     8000          TerMtag
BHR  C*                  END
BHR   *
     C                   MOVE      'X'           FMITER
     C                   MOVE      KOINDT        FMItDt
     C                   MOVE      KOINTI        FMItTm
     C                   MOVE      KOUSER        FMItUs
     C                   update    DOKUFM1R
      * Flagg om at DOKUFM finnes - ikke behov for å sjekke HENOK
     c                   Move      'Y'           DokufmYN          1
      *
     C     CARGOFKey     Chain     CARGOF                             34
     C     *in34         ifeq      *OFF
     C                   move      FMAVD         KOAVD
     C                   move      FMOPD         KOOPD
     C                   update    CARGOFR
     c                   end
      *
      * Sjekk om ALLE på aktuell sending dermed er ankommet
      * (Sjekk om ALLE på aktuell sending dermed er ankommet
     C     DokKey        SETLL     DOKUFM
     C     DokKey        READE     DOKUFM                                 33
     C     *IN33         DOWEQ     '0'
N02  C                   if        FMST='I' OR FMST='E'
     C     FMITER        ifeq      ' '
     C                   leave
     C                   endif
N02  C                   endif
     C     DokKey        READE     DOKUFM                                 33
     C                   enddo
      **
      * Kom gjennom alle kolli uten blank.. - alle kommet - oppdater
     C     FMITER        IFNE      ' '
     c                   call      'CARGOSCR4'
     c                   parm                    FMAVD
     c                   parm                    FMOPD
     c                   parm                    KOTERM
     C                   else
      * Ikke alle skutt- MEN Corgoo finnes likevel (ER sumert når den ble satt på tur??)-resummer
     C     CARGOOKey     Chain     CARGOO                             35
     C     *in35         ifeq      '0'
     c                   call      'CARGOSCR4'
     c                   parm                    FMAVD
     c                   parm                    FMOPD
     c                   parm                    KOTERM
     C                   endif
     C                   endif
      *
     C     UtOppd        ENDSR
      *
      *////////////////////////////////////////////////////////////
     C     OppDatH       BEGSR
      *////////////////////////////////////////////////////////////
      *
      *
      * SETT STATUS I HENOK (hvis den finnes der..)
     C     KOID          Chain     HENOK01                            33
     C     *in33         cabeq     '1'           UtHenop
      *
     C                   MOVE      'X'           HKSTIN
     C                   update    HENOK1R
     C     CARGOFKey     Chain     CARGOF                             34
     C     *in34         ifeq      *OFF
     C                   move      HKLNR         KOLNR
     C                   move      HKLNR2        KOLNR2
     C                   update    CARGOFR
     c                   end
      *
      * Sjekk om ALLE på aktuell sending dermed er ankommet
     C     SndKey        SETLL     HENOK
     C     SndKey        READE     HENOK                                  33
     C     *IN33         DOWEQ     '0'
     C     HKSTIN        ifeq      ' '
     C                   leave
     C                   endif
     C     SndKey        READE     HENOK                                  33
     C                   enddo
      *
      * Kom gjennom alle kolli uten blank..
     C     HKSTIN        IFNE      ' '
     c                   call      'CARGOSCR5'
     c                   parm                    HKLNR
     c                   parm                    HKLNR2
     c                   parm                    KOTERM
     C                   end
      *
      *
     C     UtHenop       ENDSR
      *////////////////////////////////////////////////////////////
     C     INIT          BEGSR
      *////////////////////////////////////////////////////////////
      *
     C     CARGOFKey     KLIST
     C                   KFLD                    KOID
     C                   KFLD                    KOTERM
     C     CARGOOKey     KLIST
     C                   KFLD                    FMAVD
     C                   KFLD                    FMOPD
      *
     C     SndKey        KLIST
     C                   KFLD                    HKLNR
     C                   KFLD                    HKLNR2
      *
     C     DOKKEY        KLIST
     C                   KFLD                    FMRI
     C                   KFLD                    FMAVD
     C                   KFLD                    FMOPD
     C                   KFLD                    FMFBNR
     C                   KFLD                    FMLINR
     C                   MOVE      'F'           FMRI
     C                   Z-ADD     1             FMFBNR
     C                   MOVE      *ZEROS        FMLINR
      *
     c                   Move      'SUB'         Ufunksjon
     c                   z-add     30            UDager
     C                   call      'SYGE20'
     C                   PARM                    Ufunksjon         3
     c                   parm                    UDato1            8 0
     c                   parm                    UDato2            8 0
     c                   parm                    UDager            5 0
     c                   move      Udato2        MinDato           8 0
      *
     C                   ENDSR
      *
