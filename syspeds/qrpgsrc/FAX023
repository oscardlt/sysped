      *
      *
      * SENDE FRAKTBREV PÅ FAX
      *
      *
     FDOK29     IF   E           K DISK
     FDOK36     IF   E           K DISK
     FHEADF     IF   E           K DISK
     FVALUL01   IF   E           K DISK
     FFIRM      IF   E           K DISK
     FFAK2      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FKODTTST   IF   E           K DISK
     FKODTTSX   IF   E           K DISK
     FKODTGE    IF   E           K DISK
     FKODTSF    IF   E           K DISK
     FDOKUF     IF   E           K DISK
     FFAX023P   O    E             PRINTER
     D MSG             S             78    DIM(3)
     D                 DS
     D  TX                     1    980
     D                                     DIM(14)
     D  Z2901                  1     70
     D  Z2902                 71    140
     D  Z2903                141    210
     D  Z2904                211    280
     D  Z2905                281    350
     D  Z2906                351    420
     D  Z2907                421    490
     D  Z2908                491    560
     D  Z2909                561    630
     D  Z2910                631    700
     D  Z2911                701    770
     D  Z2912                771    840
     D  Z2913                841    910
     D  Z2914                911    980
     D                 DS
     D  TZ                     1    700
     D                                     DIM(10)
     D  Z3601                  1     70
     D  Z3602                 71    140
     D  Z3603                141    210
     D  Z3604                211    280
     D  Z3605                281    350
     D  Z3606                351    420
     D  Z3607                421    490
     D  Z3608                491    560
     D  Z3609                561    630
     D  Z3610                631    700
     D                 DS
     D  T1                     1     20
     D  T2                    21     40
     D  T3                    41     60
     D  T4                    61     80
     D  T5                    81    100
     D  T6                   101    120
     D  T7                   121    140
     D  T8                   141    160
     D  T9                   161    180
     D  T10                  181    200
     D  T                      1    200
     D                                     DIM(10)
     D                 DS
     D  B1                     1      9  2
     D  B2                    10     18  2
     D  B3                    19     27  2
     D  B4                    28     36  2
     D  B5                    37     45  2
     D  B6                    46     54  2
     D  B7                    55     63  2
     D  B8                    64     72  2
     D  B9                    73     81  2
     D  B10                   82     90  2
     D  B                      1     90  2
     D                                     DIM(10)
     D                 DS
     D  M1                     1      1
     D  M2                     2      2
     D  M3                     3      3
     D  M4                     4      4
     D  M5                     5      5
     D  M6                     6      6
     D  M7                     7      7
     D  M8                     8      8
     D  M9                     9      9
     D  M10                   10     10
     D  M                      1     10
     D                                     DIM(10)
     D                 DS
     D  MN1                    1     17
     D  MN2                   18     34
     D  MN3                   35     51
     D  MN4                   52     68
     D  MN5                   69     85
     D  MN6                   86    102
     D  MN7                  103    119
     D  MN8                  120    136
     D  MN9                  137    153
     D  MN10                 154    170
     D  MN11                 171    187
     D  MN12                 188    204
     D  MN13                 205    221
     D  MN14                 222    238
     D  MN15                 239    255
     D  MN16                 256    272
     D  MN17                 273    289
     D  MN18                 290    306
     D  MN19                 307    323
     D  MN20                 324    340
     D  MN                     1    340
     D                                     DIM(20)
     D                 DS
     D  VS1                    1     25
     D  VS2                   26     50
     D  VS3                   51     75
     D  VS4                   76    100
     D  VS5                  101    125
     D  VS6                  126    150
     D  VS7                  151    175
     D  VS8                  176    200
     D  VS9                  201    225
     D  VS10                 226    250
     D  VS11                 251    275
     D  VS12                 276    300
     D  VS13                 301    325
     D  VS14                 326    350
     D  VS15                 351    375
     D  VS16                 376    400
     D  VS17                 401    425
     D  VS18                 426    450
     D  VS19                 451    475
     D  VS20                 476    500
     D  VS                     1    500
     D                                     DIM(20)
     D                 DS
     D  DF1004                 1     35
     D  PF1004                 1     22
     D  TF1004                 1     22
     D                 DS
     D  prdtop                 1      6  0
     D  prdtdd                 1      2  0
     D  prdtMM                 3      4  0
     D  prDTÅÅ                 5      6  0
     D                 DS
     D  DFDTCC                 1      4  0
     D  DFDTÅÅ                 3      4  0
     D  DFDTMM                 5      6  0
     D  DFDTDD                 7      8  0
     D  DFDTU                  1      8  0
     D                 DS
     D  DFNAVX                 1     30
     D  DFXAVX                 1     25
     D                 DS
     D  DFAD1X                 1     30
     D  DFXD1X                 1     25
     D                 DS
     D  DFAD3X                 1     30
     D  DFXD3X                 1     25
      *
     C                   EXSR      INIT
      *
      *
     C     UKEY          CHAIN     DOKUF                              33
     C                   Z-ADD     DFOPD         YOPD
     C  N33KODSFK        CHAIN     KODTSF                             34
     C  N33HEADFK        CHAIN     HEADF                              33
     C   33              GOTO      SLUTT
      *
      *
      * FRA TRANSP. MODUL. - EVT UTFYLT ETTERKRAV ????  TAR IKKE HENSYN TIL DET
      * OM VANLIG ETTERKRAV (MED TILDELING AV FAKT.NR. PÅ FRAKTBREV ER VALGT)
      *
     C                   SETOFF                                       31
     C     HEUR          IFEQ      'H'
     C     DFKDE         ANDNE     'X'
     C                   Z-ADD     DFOPD         YOPD
     C                   SETON                                        31
     C                   END
      *
     C                   SETOFF                                       50
     C                   EXSR      FINRUB
     c                   move      *zeros        prdtop
     c                   move      dfdtdd        prdtdd
     c                   move      dfdtmm        prdtmm
     c                   move      dfdtÅÅ        prdtÅÅ
     C     DFTOLL        IFNE      0
     C                   SETON                                        50
     C                   EXSR      TOLL
     C                   ELSE
     C                   EXSR      HOVED
     C                   END
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
      *////////////////////////////////////////////////////////////
      *  Henter rubrikk 29 og 36 informasjon til utskrift og EDI  /
      *////////////////////////////////////////////////////////////
     C     FINRUB        BEGSR
      * Hent faste tekster til R-38
     C                   CALL      'SYFA12F'
     C                   PARM                    fifirm
     C                   PARM                    DFAVD
     C                   PARM                    DFOPD
     C                   PARM                    DFFBNR
     C                   PARM                    U38TXT          700
     C                   MOVEA     U38TXT        TX
      * Finn antall brukte array-element
     C                   Z-ADD     10            X                 3 0
     C     TX(X)         DOWEQ     *BLANKS
     C                   SUB       1             X
     C     X             CABEQ     0             UTFAS
     C                   END
     C     UTFAS         TAG
      *
     C     R29KEY        KLIST
     C                   KFLD                    DFAVD
     C                   KFLD                    DFOPD
     C                   KFLD                    DFFBNR
     C                   MOVEA     *BLANKS       TZ
      * Sjekker først om det finnes noen verdier å vise
     C     R29KEY        SETLL     DOK29
     C     R29KEY        READE     DOK29                                  90
     C     *IN90         DOWEQ     *OFF
     C                   MOVEA     D29TXT        TX(X)
     C                   ADD       1             X
     C     X             IFGT      14
     C                   LEAVE
     C                   ENDIF
     C     R29KEY        READE     DOK29                                  90
     C                   ENDDO
      *
     C                   Z-ADD     1             X                 3 0
     C     R29KEY        SETLL     DOK36
     C     R29KEY        READE     DOK36                                  90
     C     *IN90         DOWEQ     *OFF
     C                   MOVEA     D36TXT        TZ(X)
     C                   ADD       1             X
     C     X             IFGT      10
     C                   LEAVE
     C                   ENDIF
     C     R29KEY        READE     DOK36                                  90
     C                   ENDDO
      *
     C                   ENDSR
      *
      *
      ******************************************
     C     HOVED         BEGSR
      ******************************************
     C                   MOVE      *BLANKS       MN
     C                   MOVE      *BLANKS       VS
     C     HEUR          IFEQ      'F'
     C     HEUR          OREQ      'G'
     C     DFGM          IFEQ      *BLANKS
     C     DFGM2         ANDEQ     *BLANKS
     C     DFVS          ANDEQ     *BLANKS
     C     DFVS2         ANDEQ     *BLANKS
     C                   CALL      'SAD61PBL'
     C                   PARM      HEAVD         UAVD2             4 0
     C                   PARM      HEOPD         UOPD2             7 0
     C                   PARM                    UNR               2 0
     C                   PARM                    MN
     C                   PARM                    UNR2              2 0
     C                   PARM                    VS
     C                   END
     C                   END
     C     MN(1)         IFEQ      *BLANKS
     C                   MOVE      DFGM          MN(1)
     C                   MOVE      DFGM2         MN(2)
     C                   END
     C     VS(1)         IFEQ      *BLANKS
     C                   MOVE      DFVS          VS(1)
     C                   MOVE      DFVS2         VS(2)
     C                   END
      *
      * INDIKATORER FOR PRINTERSTYRING
      *
     C     HETRCN        COMP      *BLANKS                            7777
     C   77              MOVE      HETRCN        QTRCN            17
     C     HERFA         COMP      *BLANKS                            7878
     C     DFNTEU        COMP      *ZEROS                             75
     C  N75DFNTAU        COMP      *ZEROS                             75
     C     DFKNS         COMP      *BLANKS                            7474
     C     DFKNM         COMP      *BLANKS                            7373
     C     TF1004        COMP      *BLANKS                            7272
     C   72TF1004        COMP      *ZEROS                             7272
      *
      * SENDER BETALER
      *
     C     DFBELA        COMP      'S'                                    81
     C     DFBELA        COMP      'M'                                    82
     C     DFBELA        COMP      'A'                                    83
     C     DFKNX         COMP      *BLANKS                            8484
      *
      * ETTERKRAVSFORSENDELSE  *IN61
      *
     C     DFKDE         COMP      'X'                                    61
     C   61              MOVE      HEKNKF        YKN
     C   61KUND1K        CHAIN     CUNDL01                            41
     C   61
     CANN41              DO
     C     DKUND         IFNE      'D'
     C                   MOVE      KNAVN         WNAVN            30
     C                   MOVE      ADR1          WADR1            30
     C                   MOVE      ADR2          WADR2            30
     C                   MOVE      *BLANKS       WADR3            30
     C     POSTNR        IFEQ      0
     C                   MOVEL     ADR3          WADR3
     C                   ELSE
     C                   MOVEL     POSTNR        WADR3
     C                   MOVE      ADR3          WADR3
     C                   END
     C                   ELSE
     C                   MOVE      HENAK         WNAVN
     C                   MOVE      HEADK1        WADR1
     C                   MOVE      HEADK2        WADR2
     C                   MOVE      HEADK3        WADR3
     C                   END
     C                   END
      *
     C   61
     CAN 41              DO
     C                   MOVE      *BLANKS       WNAVN
     C                   MOVE      *BLANKS       WADR1
     C                   MOVE      *BLANKS       WADR2
     C                   MOVE      *BLANKS       WADR3
     C                   END
      *
      *
     C     DFNAVS        IFEQ      *BLANKS
     C                   MOVE      DFKNSS        YKN
     C     KUND1K        CHAIN     CUNDL01                            41
     C  N41              DO
     C                   MOVE      KNAVN         DFNAVS
     C                   MOVE      ADR1          DFAD1S
     C                   MOVE      ADR2          DFAD2S
     C                   MOVE      *BLANKS       DFAD3S
     C     POSTNR        IFEQ      0
     C                   MOVEL     ADR3          DFAD3S
     C                   ELSE
     C                   MOVEL     POSTNR        DFAD3S
     C                   MOVE      ADR3          DFAD3S
     C                   END
     C                   END
     C                   ELSE
     C                   MOVE      '0'           *IN41
     C                   END
      *
     C  N41              DO
      *
      * TRANPORTØRMODUL - ETTREKR
     C   31
     CANN61TRETTB        IFNE      *ZEROS
     C                   SETON                                            61
     C                   END
      *
     C   61              EXSR      VALI
      *
      *
      *     ORDINÆR UTSKRIFT
      *
      *
      *
     C                   MOVE      PDATE1        QDATE1
     C                   EXSR      UTFBR
      *
      *
     C                   END
      *
     C                   ENDSR
      *
      ******************************************
     C     TOLL          BEGSR
      ******************************************
     C                   MOVE      *BLANKS       MN
     C                   MOVE      *BLANKS       VS
     C     DFGM          IFEQ      *BLANKS
     C     DFGM2         ANDEQ     *BLANKS
     C     DFVS          ANDEQ     *BLANKS
     C     DFVS2         ANDEQ     *BLANKS
     C     HEUR          IFEQ      'F'
     C     HEUR          OREQ      'G'
     C                   CALL      'SAD61PBL'
     C                   PARM      HEAVD         UAVD2             4 0
     C                   PARM      HEOPD         UOPD2             7 0
     C                   PARM                    UNR               2 0
     C                   PARM                    MN
     C                   PARM                    UNR2              2 0
     C                   PARM                    VS
     C                   END
     C                   END
     C     MN(1)         IFEQ      *BLANKS
     C                   MOVE      DFGM          MN(1)
     C                   MOVE      DFGM2         MN(2)
     C                   END
      *
     C     VS(1)         IFEQ      *BLANKS
     C                   MOVE      DFVS          VS(1)
     C                   MOVE      DFVS2         VS(2)
     C                   END
      *
     C     DFKDE         COMP      'X'                                    61
     C   61              MOVE      HEKNKF        YKN
     C   61KUND1K        CHAIN     CUNDL01                            41
      *
      * GETS CUSTOMPLACE
      *
     C                   MOVE      *BLANKS       KTSNAV
     C     KODTSK        CHAIN     KODTTST                            41
     C   41              MOVEL     'UKJENT'      KTSNAV
     C     DFTOLL        CHAIN     KODTTSX                            41
     C  N41              MOVE      KTXPNR        KTSPNR
     C   41              MOVE      *ZEROS        KTSPNR
      *
     C     DFNAVS        IFEQ      *BLANKS
     C                   MOVE      DFKNSS        YKN
     C     KUND1K        CHAIN     CUNDL01                            41
     C  N41              DO
     C                   MOVE      KNAVN         DFNAVS
     C                   MOVE      ADR1          DFAD1S
     C                   MOVE      ADR2          DFAD2S
     C                   MOVE      *BLANKS       DFAD3S
     C     POSTNR        IFEQ      0
     C                   MOVEL     ADR3          DFAD3S
     C                   ELSE
     C                   MOVEL     POSTNR        DFAD3S
     C                   MOVE      ADR3          DFAD3S
     C                   END
     C                   END
     C                   ELSE
     C                   MOVE      '0'           *IN41
     C                   END
      *
     C  N41              DO
      * TRANPORTØRMODUL - ETTREKR (OBS- FOR TOLLPASS RETTET 13/9.93)
     C   31
     CANN61TRETTB        IFNE      *ZEROS
     C                   SETON                                            61
     C                   END
      *
     C   61              EXSR      VALI
     C                   MOVE      PDATE1        QDATE1
     C                   EXSR      UTFBR
      *
      *
     C                   END
      *
     C                   ENDSR
      ******************************************
     C     VALI          BEGSR
      ******************************************
     C                   SETOFF                                       63
     C                   MOVE      *ZEROS        B
     C                   MOVE      *BLANKS       M
     C                   MOVE      *BLANKS       T
     C                   MOVE      *ZEROS        XMVAGR
     C                   MOVE      *ZEROS        XTOTAL
     C                   MOVE      'K'           YSK
     C                   Z-ADD     1             XN2               2 0
      * ETTERKRAV FRA TRANSPORTØRMODUL - LEGGES I FØRSTE LINJE
     C   31              DO
     C                   MOVEL     XTETT         T(XN2)
     C                   MOVE      TRMVA         M(XN2)
     C     HEVALK        IFNE      TRETTV
     C                   EXSR      TESTVA
     C                   END
     C                   ADD       TRETTB        B(XN2)
     C                   ADD       TRETTB        XTOTAL
     C     TRMVA         IFEQ      'J'
     C                   ADD       TRETTB        XMVAGR
     C                   END
     C                   ADD       1             XN2
     C                   END
      *
     C     FAK2K         SETLL     FAK2
      *
     C     STV           TAG
     C     FAK2K         READE     FAK2                                   63
     C  N63              DO
     C     FAKDA         IFEQ      'K'                                          *KOSTNADSLIN
     C     FAKDA         OREQ      'C'                                          *KREDITNOTA
     C     FAKDA         OREQ      'D'                                          *SLETTEDE
     C                   GOTO      STV
     C                   END
      *
     C                   MOVE      FAFAKT        XFN
      *
      * CHANGES DATE TO INHOUSE LAYOUT HVEN COPYPRINT
      *
     C                   MOVE      FADAFF        PXFFDT            6 0
     C                   CALL      'DATFM2'
     C                   PARM                    FIDTFM
     C                   PARM                    PXFFDT
     C                   MOVE      FADATO        PDATE1            6 0
     C                   CALL      'DATFM3'
     C                   PARM                    FIDTFM
     C                   PARM                    PDATE1
      *
      *
     C     XN2           COMP      8                                  36
     C  N36FAVT          COMP      *BLANKS                                35
     C  N36
     CAN 35KODGEK        CHAIN     KODTGE                             35
     C   36              MOVEL     'OTHER   '    T(XN2)
     C     HEVALK        IFEQ      FICURR
     C                   ADD       FABELN        B(XN2)
     C                   ADD       FABELN        XTOTAL
     C                   ELSE
     C                   ADD       FABELV        B(XN2)
     C                   ADD       FABELV        XTOTAL
     C                   END
      *
     C                   MOVE      FAKDM         M(XN2)
     C  N36FAVT          IFNE      *BLANKS
     C                   MOVEL     FAVT          T(XN2)
     C                   ELSE
     C                   MOVEL     KGENOT        T(XN2)
     C                   END
      *
      * TAX ?
      *
     C     FAKDM         IFEQ      'J'
     C     FICURR        IFEQ      HEVALK
     C                   ADD       FABELN        XMVAGR            8 2
     C                   ELSE
     C                   ADD       FABELV        XMVAGR
     C                   END
     C                   END
     C  N36              ADD       1             XN2
     C                   GOTO      STV
     C                   END
      *
     C     XN2           IFGT      1
      * VARIABLE VAT
     C                   MOVE      FITAX         FITAXB            4 4
     C     FITAXD        IFNE      *ZEROS
     C     FITAX2        ANDNE     *ZEROS
     C     FADATO        ANDLT     FITAXD
     C                   MOVE      FITAX2        FITAXB            4 4
     C                   END
     C     XMVAGR        MULT(H)   FITAXB        XMOMSX            8 2
     C                   Z-ADD     XMOMSX        XPMOMS            8 2
     C                   ADD       XMOMSX        XTOTAL            9 2
     C                   END
     C                   Z-ADD     XTOTAL        DFBELE
      * TESTER VED TR.DISP OM BELØP I ETTERKRAV
     C   31B(1)          COMP      0                                  61
     C                   ENDSR
      ***********************************************
     C     TESTVA        BEGSR
      ***********************************************
     C     VALKFA        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    XXVAL             3
      * AAAAA
      * DERSOM ETTERKRAVSVALUTA FORSKJ. FRA FICURR - REGN OM
     C     TRETTV        IFNE      FICURR
     C                   MOVE      TRETTV        XXVAL
     C     VALKFA        CHAIN     VALUL01                            95
     C   95              GOTO      ENDVAL
     C     VALKU2        IFNE      0
     C                   MOVE      VALKU2        VALKU1
     C                   END
     C     TRETTB        MULT      VALKU1        XWORK            15 4
     C     XWORK         DIV(H)    OMRFAK        TRETTB
     C                   END
      * BBBBB
      * DERSOM KUNDENS VALUTA  FORSKJ. FRA FICURR - REGN OM
     C     HEVALK        IFNE      FICURR
     C                   MOVE      HEVALK        XXVAL
     C     VALKFA        CHAIN     VALUL01                            95
     C   95              GOTO      ENDVAL
     C     VALKU2        IFNE      0
     C                   MOVE      VALKU2        VALKU1
     C                   END
     C     TRETTB        DIV       VALKU1        XWORK            15 4
     C     XWORK         MULT(H)   OMRFAK        TRETTB
     C                   END
      *
     C     ENDVAL        TAG
     C                   SETOFF                                       95
     C                   ENDSR                                                  1<-E
      *
      *
      ******************************************
     C     UTFBR         BEGSR
      ******************************************
     C     DFM3          IFNE      0
     C                   SETON                                        59
     C                   END
     C                   WRITE     FBREV
     C                   WRITE     CVRPA2
     C                   SETOFF                                       5960
      *
     C                   ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
      *
     C     *ENTRY        PLIST
     C                   PARM                    UAVDA             4
     C                   PARM                    UOPDA             7
     C                   PARM                    UFBNRA            3
     C                   PARM                    UKODE             1
     C                   PARM                    FAXFIR           30
     C                   PARM                    FAXNVN           30
     C*
     C                   MOVE      UAVDA         UAVD              4 0
     C                   MOVE      UOPDA         UOPD              7 0
     C                   MOVE      UFBNRA        UFBNR             3 0
     C                   MOVEL     FAXNVN        FAXNV2           25
      *
      *
     C     KODTAK        KLIST
     C                   KFLD                    YUNIKA
     C                   KFLD                    UAVD
     C     HEADFK        KLIST
     C                   KFLD                    DFAVD
     C                   KFLD                    DFOPD
     C     FAK2K         KLIST
     C                   KFLD                    DFAVD
     C                   KFLD                    DFOPD
     C                   KFLD                    YSK
     C     KUND1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    YKN
     C     KODTSK        KLIST
     C                   KFLD                    YTSUNI
     C                   KFLD                    DFTOLL
     C     KODGEK        KLIST
     C                   KFLD                    YGEUNI
     C                   KFLD                    FAVK
     C     KODSFK        KLIST
     C                   KFLD                    YGESF
     C                   KFLD                    DFSG
     C     UKEY          KLIST
     C                   KFLD                    DFRI
     C                   KFLD                    UAVD
     C                   KFLD                    UOPD
     C                   KFLD                    UFBNR
     C                   MOVE      'F'           DFRI
      *
     C                   MOVE      *ZEROS        YOPD              7 0
     C                   MOVE      ' '           YSK               1
     C                   MOVE      'A'           YUNIKA            1
     C                   MOVE      *ZEROS        YKN               8 0
     C                   MOVE      'TST'         YTSUNI            3
     C                   MOVE      'GE'          YGEUNI            2
     C                   MOVE      'SF'          YGESF             2
     C                   MOVE      'F'           YRI               1
     C                   Z-ADD     1             YFBNR             3 0
     C                   MOVEA     *BLANKS       T
     C                   MOVEA     *ZEROS        B
     C                   MOVEA     *BLANKS       M
     C                   MOVEA     *BLANKS       MN
     C                   MOVEA     *BLANKS       VS
     C                   MOVE      *ZEROS        HEAVD
     C                   MOVE      *ZEROS        HEOPD
     C                   MOVE      *BLANKS       HESG
     C                   MOVE      *ZEROS        HEPRO
     C                   MOVE      *ZEROS        XFN
     C                   MOVE      *ZEROS        KTSPNR
     C                   MOVE      *BLANKS       KTSNAV
     C                   MOVE      *BLANKS       DFAD3M
     C                   MOVE      *ZEROS        QDATE1
     C                   MOVE      *BLANKS       DFFASE
     C                   MOVE      *BLANKS       HEGN
     C                   MOVE      *BLANKS       HEPOS1
     C                   MOVE      *ZEROS        HEPOS2
     C                   MOVE      *ZEROS        PXFFDT
     C                   MOVE      *BLANKS       HEFR
     C                   MOVE      *ZEROS        XTOTAL
      *
     C                   MOVEL     'SPEDITØR'    XTETT            16
     C                   MOVE      '.ETTERK.'    XTETT
      *
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
      *
     C                   CALL      'DATFM1'
     C                   PARM                    FIDTFM
     C                   PARM                    PDATE1            6 0          FIRM UDATE
     C                   PARM                    PDATE2            6 0          YMD
     C                   PARM                    PDATE3            6 0          DMY
      *
     C                   ENDSR
