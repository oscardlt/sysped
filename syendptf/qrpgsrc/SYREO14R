     H DFTACTGRP(*NO)
     FARKIVL19  UF   E           K DISK
     FFRISKK    UF   E           K DISK
     FKOSTA     UF   E           K DISK
     FKOSTB     UF   E           K DISK
     FARKTXT    IF   E           K DISK
     FARKEXT    IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FFIRM      IF   E           K DISK

     d                 ds
     d  x_arunde               1     10A
     d  x_arunde3              1      3A
     d  x_arunde7              4     10A
     d                 ds
     d  kabnr                  1      7  0
     d  kabnr_a                1      7

     d xdtf            S              8  0
     d xdtp            S              8  0
     d WhereC          s            512a
     d FirstW          s              1A
     d cQuote          C                   const('''')
     d SqlStm          s            512a
     d myrows0         s             10i 0
     d myrows          s             10i 0
     D XSLUTT          S              1
     D XPOS            S              3  0
     d X               S             10  0
     D ufil            S            256A
      *  Prototype for 'SYREO01C3'
     d SYREO01C3       pr                  extpgm('SYREO01C3')
     d ufil_                               like(ufil)
      *  Prototype for syreo14r
     d syreo14r        pr
     d udtf_                               like(udtf)
     d udtp_                               like(udtp)
      *  *ENTRY Interface for Main Procedure
     d syreo14r        pi
     d udtf                           8
     d udtp                           8
      *
     d MyPoDS0         ds                  Qualified  dim(1)
     d  FIFIRM                        2A
     d MyPoDS          ds                  Qualified  dim(10000)
     d  KABNR                         7S 0
     d  KABDT                         8S 0
     d  KAUSER                       10A
      *
      /free

         exsr init;

         dow xslutt <> 'J';
           exsr srhoved;
         enddo;


         *inlr = *on;
         return;

       //=====================================================================
       // Hoved logikk
       //=====================================================================
       begsr srhoved;

       clear MyPoDS;
       SqlStm = 'Select KABNR, KABDT, KAUSER ' +
                'from KOSTA ' +
                'Where KABDT <= ' + %trim(udtf) +
                ' AND KAFFDT <= ' + %trim(udtf) +
                ' AND KADTR <= ' + %trim(udtf);
       Exec SQL PREPARE DynSel from :SqlStm;
       EXEC SQL DECLARE  A33  cursor for DynSel;
       Exec SQL OPEN A33;
       Myrows = %elem(MyPoDS);
       exec sql FETCH A33   for :MyRows rows
                  INTO :MyPoDs;
       Exec SQL CLOSE A33;

       if myrows > 0;
         for x = 1 to myrows;
           if mypods(x).kauser = *blanks;
             xslutt = 'J';
             leave;
           endif;

             kabnr  = mypods(x).kabnr;
             kauser = mypods(x).kauser;
             kabdt  = mypods(x).kabdt;

             exec sql
             delete from kostb
             where kbbnr = :kabnr
             with NC;

             exec sql
             delete from friskk
             where fsbnr = :kabnr
             with NC;

             x_arunde7 = kabnr_a;
             setll (x_arunde) arkivl19;
             reade (x_arunde) arkivl19;
             dow not %eof;
               chain (fifirm) firmarc;
               chain (artype) arktxt;
               if %found and arklag <> *blanks;
                 chain (fifirm:arklag) arkext;
               endif;
               if arbhis <> *blanks;
               // Bane for historikk
                 arcane = arbhis;
               endif;
               xpos = %scan ('.' : arlink : 1);
               if xpos = 0;
                 ufil = '/' + %TRIM(ARCANE) + '/' + %TRIM(ARLINK) + '.pdf';
               else;
                 ufil = '/' + %TRIM(ARCANE) + '/' + %TRIM(ARLINK);
               endif;
               syreo01c3 (ufil);

               delete arkivr;
               reade (x_arunde) arkivl19;
             enddo;

           // slett hovedpost
             exec sql
             delete from kosta
             where kabnr = :kabnr
             with NC;

         endfor;
       endif;

       endsr;
      //***********************************************
       begsr init;
      //***********************************************
       xdtf = %float(udtf);
       xdtp = %float(udtp);
       x_arunde3 = 'KL:';

       SqlStm = 'Select * ' +
                'from FIRM ' +
                'FOR READ ONLY ';
       Exec SQL PREPARE DynSel0 from :SqlStm;
       EXEC SQL DECLARE  A30  cursor for DynSel0;
       Exec SQL OPEN A30;
       Myrows0 = %elem(MyPoDS0);
       exec sql FETCH A30   for :MyRows0 rows
                  INTO :MyPoDs0;
       Exec SQL CLOSE A30;
       FIFIRM = mypods0(1).fifirm;

       endsr;

      /end-free
