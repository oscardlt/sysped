********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 sh  PTF10 ny parameter syge13
********************************************************************
      *
     FHEADF     UF   E           K DISK
     FHETRIU    IF A E           K DISK
     FKOSBU     UF A E           K DISK
     FKOSTT     UF A E           K DISK
     FDISP      UF   E           K DISK
     FHESTED    UF   E           K DISK
     FTURER14   IF   E           K DISK
     FKODTAG    IF   E           K DISK
     FSTED2D    IF   E           K DISK
     FUSRDFT    IF   E           K DISK
     FNOPNR     IF   E           K DISK
     D* Datastruktur for Å HENTE USER
     D                SDS
     D  ZJOB                 244    253
     D  ZUSER                254    263
     D                 DS
     D  HEDTOP                 1      8  0
     D  HEDTÅ                  1      4  0
     D  HEDTM                  5      6  0
     D  HEDTD                  7      8  0
     D                 DS
     D  DSVFTX                 1     35
     D  DSVT1                  1     10
     D  HESDVT                12     16
     D  DSVT2                 23     24
     D  HESDT                 26     30
     D                 DS
     D  HXHEAD                 1    256
     D  XXUR                   1      1
     D  XXFR                   2      4
     D  XXKDPL                 5      5
     D  XXLKA                  6      7
     D  XXSDF                  8     12
     D  XXTRI                 13     14
     D  XXSDT                 15     19
     D  XXLKS                 20     21
     D  XXSDFF                22     26
     D  XXLKK                 27     28
     D  XXSDVT                29     33
     D  XXVKT                 34     42  0
     D  XXFBV                 43     51  0
     D  XXM3                  52     58  3
     D  XXLM                  59     62  2
     D  XXNT                  63     69  0
     D  XXVERV                70     72
     D  XXVERB                73     75  2
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UUAVD             4 0
     C                   PARM                    UUOPD             7 0
     C                   PARM                    UUFFVF            2
     C                   PARM                    UFLAGG            1
     C*
     C                   MOVEL     'UTKJØRING'   DSVT1
     C                   MOVE      '->'          DSVT2
     C     HEADKEY       KLIST
     C                   KFLD                    UUAVD
     C                   KFLD                    UUOPD
      *
     C     VFKEY         KLIST
     C                   KFLD                    UUAVD
     C                   KFLD                    UUOPD
     C                   KFLD                    TISLAG
     C                   MOVE      'VF'          TISLAG
     C*
     C     STEDKEY       KLIST
     C                   KFLD                    ST2LK
     C                   KFLD                    DISTET
     C                   MOVE      'NO'          ST2LK
     C     zuser         CHAIN     usrdft                             33
     C     InnlKey       KLIST
     C                   KFLD                    ZZTERM
     C                   KFLD                    NOPONR
     C*
     C* REFRESH AV PRIS??
     C     UFLAGG        IFEQ      'R'
     C                   MOVE      'J'           REFRESH           1
     C                   ELSE
     C                   MOVE      'N'           REFRESH
     C                   END
     C*
     C                   MOVE      '1'           UFLAGG
      * Avdelingen SKAL finnes i fil med "Agent-avdelinger"
     C     UUAVD         CHAIN     KODTAG                             33
     C     *IN33         CABEQ     '1'           UT
     C     AGTRNR        CABEQ     *zeros        UT
      * X-REF post for ferdig "utkjørings-rekv." skal IKKE finnes
     c     REFRESH       IFEQ      'N'
     C     VFKEY         CHAIN     HETRIU                             33
     C     *IN33         CABEQ     '0'           UT
     C                   else
      * VED REFRESH: REF post for ferdig "utkjørings-rekv." MÅ FINNES
     C     VFKEY         CHAIN     HETRIU                             33
     C     *IN33         CABEQ     '1'           UT
     C                   END
     C*
     C     HEADKEY       CHAIN     HEADF                              33
     C     *in33         IFEQ      *OFF
      * alle vilkår for SETTING  tilfredsstilt...
     C     REFRESH       IFEQ      'N'
     C                   MOVE      '0'           UFLAGG
     C                   MOVE      'NO'          HELKK
     C                   MOVE      TRSDTD        TRSVTD
     C                   MOVE      AGTRKU        HEKNA
     C                   MOVE      AGPNRT        HESDVT
     C                   MOVE      'F'           TRSTAE
     C                   END
     C                   MOVE      'J'           TRTSTA
     C                   UPDATE    HEADFR
      * BEREGN agent-pris.
     C* POSTNUMMERBASERT KALKULASJON
     C                   Z-ADD     HEKNA         UUKN              8 0
     C                   MOVE      UUAVD         UAVD
     C                   MOVE      HEFR          XXFR
     C                   MOVE      HEKDPL        XXKDPL
     C                   MOVEL     HESDVT        XXSDF
     C                   MOVEL     HESDT         XXSDT
     C                   Z-ADD     HEM3          XXM3
     C                   Z-ADD     HELM          XXLM
     C                   Z-ADD     HENT          XXNT
     c                   Z-ADD     HEVKT         XXVKT
     c                   Z-ADD     HEFBV         XXFBV
     C                   MOVE      'H'           XXUR
     C                   MOVE      'NO'          XXLKA
     C                   MOVE      'NO'          XXTRI
     C                   MOVE      *BLANKS       XXLKS
     C                   MOVE      *BLANKS       XXSDFF
     C                   MOVE      *BLANKS       XXLKK
     C                   MOVE      *BLANKS       XXSDVT
     C                   MOVE      *BLANKS       XXVERV
     C                   MOVE      *ZEROS        XXVERB
     C                   MOVE      *ZEROS        N5                5 0
     C                   MOVE      *ZEROS        NOPD              7 0
      * Finn frakt i kundersfraktavtale
     C                   MOVE      *BLANKS       UUVAL             3 0
     C                   MOVE      'FRA'         UGEB              3
     C                   MOVE      'FRA'         UGEBKO            3
     C                   MOVE      *ZEROS        UUBELØ           13 2
     C                   MOVE      HXHEAD        UHEAD           256
      * primært sjekk om Agenttabell finnes direkte på postnummeret
     C                   movel     HESDT         TSTPNR            4
     C     TSTPNR        IFge      '0000'
     C     TSTPNR        andle     '9999'
     C                   move      TSTPNR        NOPONR
     C                   END
     C     InnlKey       CHAIN     NOPNR                              33
     C                   move      NOPNAT        Nopnata           4
     C     *IN33         IFEQ      *OFF
     C     NOATAB        andne     *blanks
     C                   move      *blanks       UUVAL
     C                   move      *zeros        URABAT
     C                   CALL      'SYGE13'
     C                   PARM                    UGEBKO
     C                   PARM                    UAVD
     C                   PARM                    NOPD
     C                   PARM                    UUVAL
     C                   PARM                    UUBELØ
     C                   PARM                    NOATAB
     C                   PARM                    URABAT            5 2
     C                   PARM                    xxOMRL            5 0
     C                   PARM                    XXOMRM            5 0
     C                   PARM                    XXOMR1            5 0
     C                   PARM                    XXOMR2            5 0
     C                   PARM                    UUKN
     C                   PARM                    UHEAD           256
n01  C                   PARM                    atdum             1
     C     UUBELØ        cabne     *ZEROS        skip14
     C                   end
     C                   CALL      'SYGE14'
     C                   PARM                    UGEBKO
     C                   PARM                    UGEB
     C                   PARM                    UAVD              4 0
     C                   PARM                    NOPD
     C                   PARM                    UUKN
     C                   PARM                    UUVAL
     C                   PARM                    UUBELØ
     C                   PARM                    UAVNR             9 0
     C                   PARM                    UAVMSG           50
     C                   PARM                    USKA              1
     C                   PARM                    UHEAD
     C     Skip14        tag
     C*
     C     REFRESH       IFEQ      'N'
     C* HENT TELLER / SKRIV REKV.POST
     C     'Å'           CHAIN     KOSTT                              34
     C   34              MOVE      'Å'           KTTYP
     C   34              Z-ADD     1000000       KTNR
     C   34              WRITE     KOSTTR
     C  N34              ADD       1             KTNR
     C  N34              UPDATE    KOSTTR
      *
     C                   MOVE      KTNR          BUBNR
     C                   MOVEL     HEDTÅ         BUPCC
     C                   MOVE      HEDTÅ         BUPÅR
     C                   MOVE      HEDTM         BUPMN
     C     HEHAWB        IFEQ      *BLANKS
     C                   MOVEL     'XX'          BUBILN
     C                   ELSE
     C                   MOVEL     HEHAWB        BUBILN
     C                   END
     C                   MOVE      AGTRNR        BUTNR
     C                   MOVE      AGTRLE        BULNR
     C                   MOVE      'A'           BUTYPE
     C                   MOVE      DSVFTX        BUTXT
     C                   MOVE      'NOK'         BUVAL
     C                   MOVE      'FRA'         BUVK
     C                   MOVE      HESG          BUSG
     C                   MOVE      HEAVD         BUOAVD
     C                   MOVE      HEOPD         BUOPD
     C                   MOVE      HEPRO         BUTUNR
     C     BUTUNR        IFNE      *ZEROS
     C     BUTUNR        CHAIN     TURER14                            33
     C  N33              MOVE      TUAVD         BUTAVD
     C                   END
     C                   MOVE      'T'           BUBLST
     C                   MOVE      HEDTOP        BUFEDT
     C                   MOVE      'O'           BUFER
     C                   Z-ADD     UUBELØ        BUBL
     C                   WRITE     KOSBUR
     C                   ELSE
      * REFRESH
     C     TIBURF        CHAIN     KOSBU                              33
     C     *IN33         IFEQ      '0'
     C     BUST          IFEQ      ' '
     C     BUBLST        ANDEQ     'T'
     C                   Z-ADD     UUBELØ        BUBL
     C                   END
     C                   UPDATE    KOSBUR
     C                   END
     C                   GOTO      UT
     C                   END
      *
      * X-REF - REKV - UTKJ
     C                   CLEAR                   HETRIUR
     C                   MOVE      HEAVD         TIAVD
     C                   MOVE      HEOPD         TIOPD
     C                   MOVE      'VF'          TISLAG
     C                   MOVE      KTNR          TIBURF
     C                   WRITE     HETRIUR
      *
      * OPPDATER SONE MM I DISP.
     C     HEADKEY       CHAIN     DISP                               33
     C     *in33         IFEQ      *OFF
     C                   MOVE      HESDVT        DISTET
     C     STEDKEY       CHAIN     STED2D                             33
     C  N33              MOVE      ST2SOL        DISONT
     C                   UPDATE    DISPR
     C                   END
      *
      * OPPDATER VIA-TIL STEDSNAVN I HESTED
     C     HEADKEY       CHAIN     HESTED                             33
     C     *in33         IFEQ      *OFF
     C                   MOVEL     ST2NVN        HSVIA2
     C                   UPDATE    HESTEDR
     C                   END
      *
     C                   END
      *
     C     UT            TAG
     C                   SETON                                        LR
     C                   RETURN
      *
