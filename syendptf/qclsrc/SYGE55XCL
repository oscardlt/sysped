/* *********************************************************************   */
/*       * RETTINGER I DETTE PROGRAM:                                      */
/* PTFnr:*Sek Sig Vers  Beskrivelse..........................              */
/* """"""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""    */
/* 12324 * 01 ORG PTF12 Fil til excel endret fra .xls til .xlsx            */
/* ********************************************************************    */
/* VED KOMPILERING ADDLIBLE HSSFCGI */
/* +               ADDLIBLE MMAIL   */
/* SENDE FIL TIL SEG SELV      */
/* I EXCEL FORMAT              */
/* CPYCMD ENDRET               */
/* IKKE BRUK QDLS              */
             PGM        PARM(&FILE &MBR &EPOSTT &CVP1)
             DCL        VAR(&FILE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&CVP1) TYPE(*CHAR) LEN(70)
             DCL        VAR(&MBR) TYPE(*CHAR) LEN(10)
             DCL        VAR(&TMPF10) TYPE(*CHAR) LEN(10)
             DCL        VAR(&STMF) TYPE(*CHAR) LEN(30)
             DCL        VAR(&EMNE) TYPE(*CHAR) LEN(70)
             DCL        VAR(&QNBR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&QUSER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&EPOSTF) TYPE(*CHAR) LEN(70)
             DCL        VAR(&EPOSTT) TYPE(*CHAR) LEN(70)
             DCL        VAR(&RPLNA) TYPE(*CHAR) LEN(8) +
                          VALUE('*CURRENT')
             DCL        VAR(&RPLAD) TYPE(*CHAR) LEN(8)
             CHGVAR     VAR(&EMNE) VALUE(&CVP1)
             CALL       PGM(SYGE55R) PARM(&EPOSTT &EMNE)
             CHGJOB     CCSID(277)
             ADDLIBLE   LIB(MMAIL)
             MONMSG     MSGID(CPF0000)
/*                                                */
/* BESTEMMER STREAMFILE OG EMNE                  */
/*                                                */
             IF         COND(&MBR = '          ') THEN(CHGVAR +
                          VAR(&MBR) VALUE(&FILE))
/*           CHGVAR     VAR(&STMF) VALUE('/tmp/' *CAT &FILE *TCAT +
                          '.xls') */ /* S01 */
             CHGVAR     VAR(&STMF) VALUE('/tmp/' *CAT &FILE *TCAT +
                          '.xlsx') /* N01 */
/*           CHGVAR     VAR(&EMNE) VALUE('sender: ' *CAT &FILE *TCAT +
                          '.xls som epost')   */
             DEL        OBJLNK(&STMF)
             MONMSG     MSGID(CPF0000)
/*                                                */
/* LEGGER TIL XLS VERKTØY                        */
/*                                                */
             ADDLIBLE   LIB(HSSFCGI)
             MONMSG     MSGID(CPF0000)
             TABLEXLS   FROMFILE(&FILE) FROMMBR(&MBR) TOXLS(&STMF)
             MONMSG     MSGID(CPF0000)
/*                                                */
/* HENTER EGEN MAIL ADRESSE                      */
/*                                                */
             RTVJOBA    USER(&QUSER) NBR(&QNBR)
             CHGVAR     VAR(&RPLNA) VALUE(&QUSER)
             RTVNETA    SYSNAME(&RPLAD)
             CALL       PGM(EPOS04) PARM(&QUSER &RPLNA &RPLAD &EPOSTF)
             CHGAUT     OBJ(&STMF) USER(*PUBLIC) DTAAUT(*RWX) +
                          OBJAUT(*ALL)
             MONMSG     MSGID(CPF0000)
/*           CHGVAR     VAR(&EPOSTT) VALUE(&EPOSTF)     */
             MONMSG     MSGID(CPF0000)
             EMLSTMF    SUBJECT(&EMNE) FROMNAME(&QUSER) +
                          FROMADDR(&EPOSTF) TO(&EPOSTT/&QUSER/*TO) +
                          STMF(&STMF)
             RMVLIBLE   LIB(MMAIL)
             MONMSG     MSGID(CPF0000)
             RMVLIBLE   LIB(HSSFCGI)
             MONMSG     MSGID(CPF0000)
 SLUTT:      ENDPGM
