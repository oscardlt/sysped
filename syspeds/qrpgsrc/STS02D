      *********************************************************************
      * Avslutt arbeid med kolli-id
      *********************************************************************
      *  RPG ILE MODULE *LIBL/STS02D
      *
CRTPG+*  CRTPGM SYSPED/STS02D MODULE(*LIBL/STS02D *LIBL/INCGI)
CRTPGM*        ACTGRP(*NEW) AUT(*USE)
      *
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
     FBRIDF     IF   E           K DISK    USROPN
     FHENOKW1   UF   E           K DISK    USROPN
      *--------------------------------------------------------------------
      * Prototype defintions and standard system API error structure
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      *--------------------------------------------------------------------
      * Variables common to CGI programs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
      * Variables received from the input string
     D lng             s              2
     D BckGnd          s             10
     D quit            s              4
     D WSUSER          s             10
     D lstbrd          s              1
     D FEILMELDING     S             70
      *
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
      *
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================******
      * MAIN PROCESS LINE
      *=====================================================================******
      *
      * Parse input
     C                   exsr      Parse
     C                   EXSR      INIT
      *
     C                   exsr      UPDFIL
      *
     C                   callp     gethtml('HTMLSRC':
     C                             '*LIBL':
     C                             'STS02':'/CGITAG/')
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updhtmlvar('USER':WSUSER)
     C                   callp     updHTMLvar('besk':BIBESK)
     C                   callp     updHTMLvar('kunr':
     C                             %trim(%editc(BIKUNR:'Z')))
     C                   callp     updHTMLvar('sdato':
     C                             %trim(%editw(BIDTV:'    .  .  ')))
     C                   callp     updHTMLvar('stid':
     C                             %trim(%editw(BITIDV:'  .  .  ')))
     C                   callp     updHTMLvar('FEILTXT':FEILMELDING)
     C                   callp     wrtsection('all')
     C                   callp     wrtsection('*fini')
     C                   EXSR      EXIT
     C                   return
      *=====================================================================******
      * Parse input
      *=====================================================================******
     C     Parse         begsr
     C                   eval      WSUSER  = zhbgetvar('USER')
      *
     C                   endsr
      *=====================================================================******
      *  Oppdater fil
      *=====================================================================******
     C     UPDFIL        BEGSR
     C     WSUSER        SETLL     HENOKW1
     C     WSUSER        READE     HENOKW1                                33
     C                   DOW       *IN33 = *OFF
     C                   DELETE    HENOKW1
     C     WSUSER        READE     HENOKW1                                33
     C  N33              ENDDO
      *
     C     WSUSER        CHAIN     BRIDF                              33
      *
     C                   endsr
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   open      BRIDF                                50
     C     WSUSER        CHAIN     BRIDF                              33
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C* (bedre ressursmessig). MODUL må da være med comp. av dette pgm!!
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
     C                   open      HENOKW1                              50
      *
     C                   endsr
      *=====================================================================******
      *  AVSLUTT
      *=====================================================================******
     C     EXIT          begsr
     C                   close     BRIDF
     C                   close     HENOKW1
     C                   eval      *inlr = *on
      *
     C                   endsr
