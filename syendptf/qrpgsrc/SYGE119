********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 sh  PTF12 ØKT TIL 240 FELT
     Fifsinnf   ip   e             DISK
     F                                     RENAME(ifsinnf:ifsinnfr)
     Fdb2def    IF   e             DISK
     Fdb2pack   UF A F   64        DISK
     Fdb2ny     IF A e             DISK
     F                                     RENAME(db2ny:db2nyr)
     D                 DS
     D* in                     1   2048
     D*                                    DIM(2048)
     D*                DS
     D* ut                     1   2048
     D*                                    DIM(2048)
     D                 DS
     D  ina                    1   2560
     D                                     DIM(256)
     D                 DS
     D  ity                    1    256
     D                                     DIM(256)
     D                 DS
     D  ile                    1    512S 0
     D                                     DIM(256)
     D                 DS
     D  ilp                    1    512S 0
     D                                     DIM(256)
     D                 DS
     D  ide                    1    512S 0
     D                                     DIM(256)
     D                 DS
     D  ist                    1   1024S 0
     D                                     DIM(256)
     D                 DS
     D  dtafld                 1  72000
     D                                     DIM(240)
     D* dtafld                 1  18000
     D*                                    DIM(60)
     D                 DS
     D* RDATA                  1   1024
     D  RDATA                  1   4096
     D  RTYP                   1      6
     D  RTYP4                  1      4
     D                 DS
     D  ZDEC                   1      7  6
     D  ZDEC6                  2      7
     D  ZHEL                  11     22  0
     D                 DS
     D  A                      1     79
     D                                     DIM(79)
     D                 DS
     D  B                      1     18
     D                                     DIM(18)
     Iifsinnfr
     I              ifsinnf                     DATAINN
     Idb2nyr
     I              db2ny                       dataut
      *
     Idb2pack   AA  01
     I                                  1   64  dp
     c                   exsr      init
     c                   exsr      DETSR
      *
      **************************************************************
     C     DETSR         BEGSR
      **************************************************************
      *
      * Kaller eksternt program og legger felt i array
      *
S01  C*                  MOVEL     DATAINN       UDATA          1024
S01  C*                  MOVEL     *BLANKS       UARRA         18000
N01  C                   MOVEL     DATAINN       UDATA          4096
N01  C                   EVAL      UARRA=*BLANKS
     C                   CALL      'SYGE111'
     C                   PARM                    SKILLE
     C                   PARM                    UDATA
     C                   PARM                    UARRA         54000
     c                   movea     uarra         dtafld
      *
     c                   move      *blanks       in             2048
     c                   move      *blanks       ut             2048
     c                   move      *blanks       det             512
      *
     c     1             do        WHFLDN        N                 3 0
      *
      * numerisk
      *
     c     ITY(N)        ifeq      'S'
     C                   MOVEA     dtafld(N)     A
     C                   EXSR      GETNUM
     C                   Z-ADD     ZNUM          NUM              20 5
     c                   movel     num           na               20
     C
     c     16            sub       ILE(N)        st                2 0
     C     IDE(N)        IFNE      0
     C                   add       IDE(N)        st
     C                   end
     c                   eval      %subst(ut:ist(N):ile(N))=%subst(na:st:ile(N))
     C                   end
      *
      * packed
      *
     c     ITY(N)        ifeq      'P'
     C                   MOVEA     dtafld(N)     A
     C                   EXSR      GETNUM
     C                   Z-ADD     ZNUM          NUM              20 5
     c                   movel     num           na               20
     c     16            sub       ILE(N)        st                2 0
     C
     C     IDE(N)        IFNE      0
     C                   add       IDE(N)        st
     C                   end
      * packed
     c                   exsr      packsr
     c*    ILE(N)        chain     db2pack                            33
     c                   exsr      packsr2
     c*    ILE(N)        chain     db2pack                            33
     c     1             chain     db2pack                            33
     c                   eval      %subst(ut:ist(N):ilp(N))=%subst(dp:1:ilp(N))
     C                   end
      *
      * alfafelt
      *
     c     ITY(N)        ifeq      'A'
     C                   EVAL      det=dtafld(N)
     c                   eval      %subst(ut:ist(N):ile(N))=%subst(det:1:ile(N))
     C                   end
     c                   enddo
      *
     c                   movel     ut            dataut
     c                   write     db2nyr
     C                   ENDSR
      *
     c*****************************************
     c     getnum        begsr
     c*****************************************
     C                   MOVE      *ZEROS        ZHEL
     C                   MOVE      *ZEROS        ZDEC
     C                   MOVE      *ZEROS        B
     C                   Z-ADD     1             AX                2 0
     C                   Z-ADD     1             BX                2 0
      * Get Integer
     C     A(AX)         DOWGE     '0'
     C     ZHEL          MULT      10            ZHEL
     C                   MOVE      A(AX)         ZHEL
     C                   ADD       1             AX
     C                   ENDDO
      * Decimal point ?
     C     A(AX)         IFEQ      '.'
     C     A(AX)         OREQ      ','
     C                   ADD       1             AX
     C     A(AX)         DOWGE     '0'
     C                   MOVE      A(AX)         B(BX)
     C                   ADD       1             AX
     C                   ADD       1             BX
     C                   ENDDO
     C                   MOVEA     B             ZDEC6
     C                   ENDIF
      * Concatenate
     C                   Z-ADD     ZHEL          ZNUM             18 6
     C                   ADD       ZDEC          ZNUM
     C                   ENDSR
     c
      *
     c*****************************************
     c     init          begsr
     c*****************************************
     c                   except    nydb2p
     c
     c     *entry        plist
     c                   parm                    ifsfil           50
     c                   parm                    skille            1
     c                   parm                    fil              10
     c                   parm                    lib              10
     c                   exsr      lesdef
     c                   endsr
     c*****************************************
     c     lesdef        begsr
     c*****************************************
      * WHFLDE   felt navn
      * WHFLDT   felttype
      * WHFLDB   felt lengde
      * WHFLDP   desimal pos
      * WHFLDN   antall felt
      * WHRLEN   lengde på postformat
      * WHFOBO   buffer startpos
      *
     c                   setoff                                       33
     c     *in33         doweq     '0'
     c                   read      db2def                                 33
     c     *in33         ifeq      '0'
     c                   add       1             nr                3 0
      * WHFLDE FELTNAVN
     c                   move      WHFLDE        ina(NR)
      * WHFLDT FELTTYLE A S P
     c                   move      WHFLDT        ity(NR)
      * WHFLDD FELTLENGDE
     c                   move      WHFLDD        ile(NR)
     C     ITY(NR)       IFEQ      'A'
     c                   move      WHFLDB        ile(NR)
     c                   end
      * WHFLDB ANTALL BYTE
     c                   move      WHFLDB        ilp(NR)
     C* WHFLDP ANTALL DESIMALER
     c                   move      WHFLDP        ide(NR)
     C* WHFOBO STRATPOSISJON
     c                   move      WHFOBO        ist(NR)
     c                   endif
     c                   enddo
     c                   endsr
     c*****************************************
     c     packsr        begsr
     c*****************************************
     C*1
     c     ILE(N)        ifeq      1
     c                   move      *zeros        a1                1
     c                   eval      %subst(A1:1:1)=%subst(na:st:ile(N))
     c                   movel     a1            p1                1 0
     c                   end
     C*2
     c     ILE(N)        ifeq      2
     c                   move      *zeros        a2                2
     c                   eval      %subst(A2:1:2)=%subst(na:st:ile(N))
     c                   movel     a2            p2                2 0
     c                   end
     C*3
     c     ILE(N)        ifeq      3
     c                   move      *zeros        a3                3
     c                   eval      %subst(A3:1:3)=%subst(na:st:ile(N))
     c                   movel     a3            p3                3 0
     c                   end
     C*4
     c     ILE(N)        ifeq      4
     c                   move      *zeros        A4                4
     c                   eval      %subst(A4:1:4)=%subst(na:st:ile(N))
     c                   movel     a4            p4                4 0
     c                   end
     C*5
     c     ILE(N)        ifeq      5
     c                   move      *zeros        a5                5
     c                   eval      %subst(A5:1:5)=%subst(na:st:ile(N))
     c                   movel     a5            p5                5 0
     c                   end
     C*6
     c     ILE(N)        ifeq      6
     c                   move      *zeros        a6                6
     c                   eval      %subst(A6:1:6)=%subst(na:st:ile(N))
     c                   movel     a6            p6                6 0
     c                   end
     C*7
     c     ILE(N)        ifeq      7
     c                   move      *zeros        a7                7
     c                   eval      %subst(A7:1:7)=%subst(na:st:ile(N))
     c                   movel     a7            p7                7 0
     c                   end
     C*8
     c     ILE(N)        ifeq      8
     c                   move      *zeros        a8                8
     c                   eval      %subst(A8:1:8)=%subst(na:st:ile(N))
     c                   movel     a8            p8                8 0
     c                   end
     C*9
     c     ILE(N)        ifeq      9
     c                   move      *zeros        a9                9
     c                   eval      %subst(A9:1:9)=%subst(na:st:ile(N))
     c                   movel     a9            p9                9 0
     c                   end
     C*10
     c     ILE(N)        ifeq      10
     c                   move      *zeros        a10              10
     c                   eval      %subst(A10:1:10)=%subst(na:st:ile(N))
     c                   movel     a10           p10              10 0
     c                   end
     C*11
     c     ILE(N)        ifeq      11
     c                   move      *zeros        a11              11
     c                   eval      %subst(A11:1:11)=%subst(na:st:ile(N))
     c                   movel     a11           p11              11 0
     c                   end
     C*12
     c     ILE(N)        ifeq      12
     c                   move      *zeros        a12              12
     c                   eval      %subst(A12:1:12)=%subst(na:st:ile(N))
     c                   movel     a12           p12              12 0
     c                   end
     C*13
     c     ILE(N)        ifeq      13
     c                   move      *zeros        a13              13
     c                   eval      %subst(A13:1:13)=%subst(na:st:ile(N))
     c                   movel     a13           p13              13 0
     c                   end
     C*14
     c     ILE(N)        ifeq      14
     c                   move      *zeros        a14              14
     c                   eval      %subst(A14:1:14)=%subst(na:st:ile(N))
     c                   movel     a14           p14              14 0
     c                   end
     C*15
     c     ILE(N)        ifeq      15
     c                   move      *zeros        a15              15
     c                   eval      %subst(A15:1:15)=%subst(na:st:ile(N))
     c                   movel     a15           p15              15 0
     c                   end
     C*16
     c     ILE(N)        ifeq      16
     c                   move      *zeros        a16              16
     c                   eval      %subst(A16:1:16)=%subst(na:st:ile(N))
     c                   movel     a16           p16              16 0
     c                   end
     C*17
     c     ILE(N)        ifeq      17
     c                   move      *zeros        a17              17
     c                   eval      %subst(A17:1:17)=%subst(na:st:ile(N))
     c                   movel     a17           p17              17 0
     c                   end
     C*18
     c     ILE(N)        ifeq      18
     c                   move      *zeros        a18              18
     c                   eval      %subst(A18:1:18)=%subst(na:st:ile(N))
     c                   movel     a18           p18              18 0
     c                   end
     C*19
     c     ILE(N)        ifeq      19
     c                   move      *zeros        a19              19
     c                   eval      %subst(A19:1:19)=%subst(na:st:ile(N))
     c                   movel     a19           p19              19 0
     c                   end
     C*20
     c     ILE(N)        ifeq      20
     c                   move      *zeros        a20              20
     c                   eval      %subst(A20:1:20)=%subst(na:st:ile(N))
     c                   movel     a20           p20              20 0
     c                   end
     c                   endsr
     c*****************************************
     c     packsr2       begsr
     c*****************************************
     c     1             chain     db2pack                            77
     c     ILE(N)        ifeq      1
     c                   except    pack1
     c                   end
     c     ILE(N)        ifeq      2
     c                   except    pack2
     c                   end
     c     ILE(N)        ifeq      3
     c                   except    pack3
     c                   end
     c     ILE(N)        ifeq      4
     c                   except    pack4
     c                   end
     c     ILE(N)        ifeq      5
     c                   except    pack5
     c                   end
     c     ILE(N)        ifeq      6
     c                   except    pack6
     c                   end
     c     ILE(N)        ifeq      7
     c                   except    pack7
     c                   end
     c     ILE(N)        ifeq      8
     c                   except    pack8
     c                   end
     c     ILE(N)        ifeq      9
     c                   except    pack9
     c                   end
     c     ILE(N)        ifeq      10
     c                   except    pack10
     c                   end
     c     ILE(N)        ifeq      11
     c                   except    pack11
     c                   end
     c     ILE(N)        ifeq      12
     c                   except    pack12
     c                   end
     c     ILE(N)        ifeq      13
     c                   except    pack13
     c                   end
     c     ILE(N)        ifeq      14
     c                   except    pack14
     c                   end
     c     ILE(N)        ifeq      15
     c                   except    pack15
     c                   end
     c     ILE(N)        ifeq      16
     c                   except    pack16
     c                   end
     c     ILE(N)        ifeq      17
     c                   except    pack17
     c                   end
     c     ILE(N)        ifeq      18
     c                   except    pack18
     c                   end
     c     ILE(N)        ifeq      19
     c                   except    pack19
     c                   end
     c     ILE(N)        ifeq      20
     c                   except    pack20
     c                   end
     c                   endsr
     Odb2pack   eadd         nydb2p
     O                       p1                    P
     Odb2pack   e            pack1
     O                       p1                    P
     Odb2pack   e            pack2
     O                       p2                    P
     Odb2pack   e            pack3
     O                       p3                    P
     Odb2pack   e            pack4
     O                       p4                    P
     Odb2pack   e            pack5
     O                       p5                    P
     Odb2pack   e            pack6
     O                       p6                    P
     Odb2pack   e            pack7
     O                       p7                    P
     Odb2pack   e            pack8
     O                       p8                    P
     Odb2pack   e            pack9
     O                       p9                    P
     Odb2pack   e            pack10
     O                       p10                   P
     Odb2pack   e            pack11
     O                       p11                   P
     Odb2pack   e            pack12
     O                       p12                   P
     Odb2pack   e            pack13
     O                       p13                   P
     Odb2pack   e            pack14
     O                       p14                   P
     Odb2pack   e            pack15
     O                       p15                   P
     Odb2pack   e            pack16
     O                       p16                   P
     Odb2pack   e            pack17
     O                       p17                   P
     Odb2pack   e            pack18
     O                       p18                   P
     Odb2pack   e            pack19
     O                       p19                   P
     Odb2pack   e            pack20
     O                       p20                   P
