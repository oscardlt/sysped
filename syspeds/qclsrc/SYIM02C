/*           PGM        PARM(&ZAVF &ZAVT &ZGNF &ZGNT &ZDF &ZDT +
                          &ZOT01 &ZOT02 &ZOT03 &ZOT04 &ZOT05 &ZOT06 +
                          &ZOT07 &ZOT08 &ZOT09 &ZOT10 &ZST &ZUNG +
                          &ZDEV &ZA4 &ZBRUDD &ZLNRF &ZLNRT &EPOST) */
             PGM        PARM(&PARM)
     /*___________________*/
     /* Beskriv variabler */
     /*"""""""""""""""""""*/
             DCL        VAR(&EMNE) TYPE(*CHAR) LEN(70) +
                          VALUE('Tollagerregnskap sendt som epost +
                          (CSV-fil til EXCEL)')
             DCL        VAR(&EMFAX) TYPE(*CHAR) LEN(70) +
                          VALUE('Tollagerregnskap sendt som epost +
                          I PDF-FORMAT')
             DCL        VAR(&PARM) TYPE(*CHAR) LEN(162)
             DCL        VAR(&PS) TYPE(*CHAR) LEN(1)
             DCL        VAR(&CVP1) TYPE(*CHAR) LEN(40) +
                          VALUE('Tollagerregnskap')
             DCL        VAR(&CVP1) TYPE(*CHAR) LEN(40) +
                          VALUE('Tollagerregnskap')
             DCL        VAR(&CVP2) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP3) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP4) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP5) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP6) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP7) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP8) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP9) TYPE(*CHAR) LEN(40)
             DCL        VAR(&PDF) TYPE(*CHAR) LEN(4) VALUE('*YES')
             DCL        VAR(&FILEN) TYPE(*CHAR) LEN(10) +
                          VALUE('SYIM03P')
             DCL        VAR(&QUSER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QJOB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QNBR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&FILE) TYPE(*CHAR) LEN(10) VALUE('SYIM03F')
             DCL        VAR(&UNIK) TYPE(*CHAR) LEN(10)
             DCL        VAR(&UNIK2) TYPE(*CHAR) LEN(6)
             DCL        VAR(&EPOST) TYPE(*CHAR) LEN(70)
             DCL        VAR(&ZAVDF) TYPE(*DEC) LEN(4 0)
             DCL        VAR(&ZAVDT) TYPE(*DEC) LEN(4 0)
             DCL        VAR(&ZGNF) TYPE(*CHAR) LEN(15)
             DCL        VAR(&ZGNT) TYPE(*CHAR) LEN(15)
             DCL        VAR(&ZDTF) TYPE(*DEC) LEN(6 0)
             DCL        VAR(&ZDTT) TYPE(*DEC) LEN(6 0)
             DCL        VAR(&ZOT01) TYPE(*CHAR) LEN(2)
             DCL        VAR(&ZOT02) TYPE(*CHAR) LEN(2)
             DCL        VAR(&ZOT03) TYPE(*CHAR) LEN(2)
             DCL        VAR(&ZOT04) TYPE(*CHAR) LEN(2)
             DCL        VAR(&ZOT05) TYPE(*CHAR) LEN(2)
             DCL        VAR(&ZOT06) TYPE(*CHAR) LEN(2)
             DCL        VAR(&ZOT07) TYPE(*CHAR) LEN(2)
             DCL        VAR(&ZOT08) TYPE(*CHAR) LEN(2)
             DCL        VAR(&ZOT09) TYPE(*CHAR) LEN(2)
             DCL        VAR(&ZOT10) TYPE(*CHAR) LEN(2)
             DCL        VAR(&ZST) TYPE(*CHAR) LEN(5)
             DCL        VAR(&ZUNG) TYPE(*CHAR) LEN(1)
             DCL        VAR(&ZDEV) TYPE(*CHAR) LEN(10)
             DCL        VAR(&ZA4) TYPE(*CHAR) LEN(1)
             DCL        VAR(&ZBRUDD) TYPE(*CHAR) LEN(1)
             DCL        VAR(&ZAVF) TYPE(*CHAR) LEN(4)
             DCL        VAR(&ZAVT) TYPE(*CHAR) LEN(4)
             DCL        VAR(&ZDF) TYPE(*CHAR) LEN(6)
             DCL        VAR(&ZDF8) TYPE(*CHAR) LEN(8)
             DCL        VAR(&ZDT) TYPE(*CHAR) LEN(6)
             DCL        VAR(&ZDT8) TYPE(*CHAR) LEN(8)
             DCL        VAR(&BLANK) TYPE(*CHAR) LEN(5) VALUE('     ')
             DCL        VAR(&ZLNRF) TYPE(*CHAR) LEN(1)
             DCL        VAR(&ZLNRT) TYPE(*CHAR) LEN(1)
             RTVJOBA    JOB(&QJOB) USER(&QUSER) NBR(&QNBR)
     /*____________________*/
     /* PAKK OPP PARAMETRE */
     /*""""""""""""""""""""*/
             CHGVAR     VAR(&ZAVF) VALUE(%SST(&PARM 1 4))
             CHGVAR     VAR(&ZAVT) VALUE(%SST(&PARM 5 4))
             CHGVAR     VAR(&ZGNF) VALUE(%SST(&PARM 9 15))
             CHGVAR     VAR(&ZGNT) VALUE(%SST(&PARM 24 15))
             CHGVAR     VAR(&ZDF) VALUE(%SST(&PARM 39 6))
             CHGVAR     VAR(&ZDT) VALUE(%SST(&PARM 45 6))
             CHGVAR     VAR(&ZOT01) VALUE(%SST(&PARM 51 2))
             CHGVAR     VAR(&ZOT02) VALUE(%SST(&PARM 53 2))
             CHGVAR     VAR(&ZOT03) VALUE(%SST(&PARM 55 2))
             CHGVAR     VAR(&ZOT04) VALUE(%SST(&PARM 57 2))
             CHGVAR     VAR(&ZOT05) VALUE(%SST(&PARM 59 2))
             CHGVAR     VAR(&ZOT06) VALUE(%SST(&PARM 61 2))
             CHGVAR     VAR(&ZOT07) VALUE(%SST(&PARM 63 2))
             CHGVAR     VAR(&ZOT08) VALUE(%SST(&PARM 65 2))
             CHGVAR     VAR(&ZOT09) VALUE(%SST(&PARM 67 2))
             CHGVAR     VAR(&ZOT10) VALUE(%SST(&PARM 69 2))
             CHGVAR     VAR(&ZST) VALUE(%SST(&PARM 71 5))
             CHGVAR     VAR(&ZUNG) VALUE(%SST(&PARM 76 1))
             CHGVAR     VAR(&ZDEV) VALUE(%SST(&PARM 77 10))
             CHGVAR     VAR(&ZA4) VALUE(%SST(&PARM 87 1))
             CHGVAR     VAR(&ZBRUDD) VALUE(%SST(&PARM 88 1))
             CHGVAR     VAR(&ZLNRF) VALUE(%SST(&PARM 89 1))
             CHGVAR     VAR(&ZLNRT) VALUE(%SST(&PARM 90 1))
             CHGVAR     VAR(&EPOST) VALUE(%SST(&PARM 91 70))
             CHGVAR     VAR(&PS) VALUE(%SST(&PARM 161 1))
     /*____________________*/
     /* Forandre variabler */
     /*""""""""""""""""""""*/
             CHGVAR     VAR(&ZAVDF) VALUE(&ZAVF)
             CHGVAR     VAR(&ZAVDT) VALUE(&ZAVT)
             CHGVAR     VAR(&ZDTF) VALUE(&ZDF)
             CHGVAR     VAR(&ZDTT) VALUE(&ZDT)
             IF         COND(&ZDF > '501231') THEN(CHGVAR VAR(&ZDF8) +
                          VALUE('19' *CAT &ZDF))
             ELSE       CMD(CHGVAR VAR(&ZDF8) VALUE('20' *CAT &ZDF))
             IF         COND(&ZDT > '501231') THEN(CHGVAR VAR(&ZDT8) +
                          VALUE('19' *CAT &ZDT))
             ELSE       CMD(CHGVAR VAR(&ZDT8) VALUE('20' *CAT &ZDT))
    /* */
     /*____________________*/
     /* FINNER UNIK VERDIr */
     /*""""""""""""""""""""*/
             RTVJOBA    NBR(&UNIK2)
             CHGVAR     VAR(&UNIK) VALUE('W' *CAT &UNIK2)
 NYFORS:     DLYJOB     DLY(5)
             RMVM       FILE(SYIM03F) MBR(&UNIK)
             MONMSG     MSGID(CPF0000)
             ADDPFM     FILE(SYIM03F) MBR(&UNIK)
             MONMSG     MSGID(CPF7306) EXEC(GOTO CMDLBL(NYFORS))
             OVRDBF     FILE(SYIM03F) TOFILE(SYIM03F) MBR(&UNIK)
             MONMSG     MSGID(CPF0000)
     /*_______________________________*/
     /* Selektere via Open Query-file */
     /*"""""""""""""""""""""""""""""""*/
             OVRDBF     FILE(HEADF) SHARE(*YES)
             IF         COND(&ZUNG = 'J') THEN(OPNQRYF FILE((HEADF)) +
                          QRYSLT('HEST *NE ''S'' *AND HEAVD *EQ +
                          %RANGE(' *CAT &ZAVF *CAT ' ' *CAT &ZAVT +
                          *CAT ') *AND HEGN *EQ %RANGE(''' *CAT +
                          &ZGNF *CAT ''' ''' *CAT &ZGNT *CAT ''') +
                          *AND HEDTOP *GE (' *CAT &ZDF8 *CAT ') *AND +
                          HEDTOP *LE (' *CAT &ZDT8 *CAT ') *AND HEOT +
                          *NE (''' *CAT &ZOT01 *CAT ''') *AND HEOT +
                          *NE (''' *CAT &ZOT02 *CAT ''') *AND HEOT +
                          *NE (''' *CAT &ZOT03 *CAT ''') *AND HEOT +
                          *NE (''' *CAT &ZOT04 *CAT ''') *AND HEOT +
                          *NE (''' *CAT &ZOT05 *CAT ''') *AND HEOT +
                          *NE (''' *CAT &ZOT06 *CAT ''') *AND HEOT +
                          *NE (''' *CAT &ZOT07 *CAT ''') *AND HEOT +
                          *NE (''' *CAT &ZOT08 *CAT ''') *AND HEOT +
                          *NE (''' *CAT &ZOT09 *CAT ''') *AND HEOT +
                          *NE (''' *CAT &ZOT10 *CAT ''') *AND HETLL +
                          *EQ (''' *CAT &BLANK *CAT ''')') +
                          KEYFLD((HEGN) (HEPOS1) (HEPOS2)))
             ELSE       CMD(OPNQRYF FILE((HEADF)) QRYSLT('HEST *NE +
                          ''S'' *AND HEAVD *EQ %RANGE(' *CAT &ZAVF +
                          *CAT ' ' *CAT &ZAVT *CAT ') *AND HEGN *EQ +
                          %RANGE(''' *CAT &ZGNF *CAT ''' ''' *CAT +
                          &ZGNT *CAT ''') *AND HEDTOP *GE (' *CAT +
                          &ZDF8 *CAT ') *AND HEDTOP *LE (' *CAT +
                          &ZDT8 *CAT ') *AND HEOT *NE (''' *CAT +
                          &ZOT01 *CAT ''') *AND HEOT *NE (''' *CAT +
                          &ZOT02 *CAT ''') *AND HEOT *NE (''' *CAT +
                          &ZOT03 *CAT ''') *AND HEOT *NE (''' *CAT +
                          &ZOT04 *CAT ''') *AND HEOT *NE (''' *CAT +
                          &ZOT05 *CAT ''') *AND HEOT *NE (''' *CAT +
                          &ZOT06 *CAT ''') *AND HEOT *NE (''' *CAT +
                          &ZOT07 *CAT ''') *AND HEOT *NE (''' *CAT +
                          &ZOT08 *CAT ''') *AND HEOT *NE (''' *CAT +
                          &ZOT09 *CAT ''') *AND HEOT *NE (''' *CAT +
                          &ZOT10 *CAT ''')') KEYFLD((HEGN) (HEPOS1) +
                          (HEPOS2)))
     /*________________*/
     /* Skriv ut liste */
     /*""""""""""""""""*/
             IF         COND(&EPOST *EQ '                        ') +
                          THEN(DO)
             IF         COND(&ZA4 *EQ 'N') THEN(OVRPRTF +
                          FILE(SYIM03P) PAGESIZE(48 120) CPI(10) +
                          OVRFLW(40) OUTQ(&ZDEV))
             IF         COND(&ZA4 *EQ 'J') THEN(OVRPRTF +
                          FILE(SYIM03P) PAGESIZE(70 120) CPI(15) +
                          OVRFLW(62) OUTQ(&ZDEV))
             ENDDO
             IF         COND(&EPOST *NE '                        ') +
                          THEN(DO)
             IF         COND(&ZA4 *EQ 'N') THEN(OVRPRTF +
                          FILE(SYIM03P) DEVTYPE(*AFPDS) PAGESIZE(48 +
                          120) CPI(10) OVRFLW(40) OUTQ(OUTMAIL))
             IF         COND(&ZA4 *EQ 'J') THEN(OVRPRTF +
                          FILE(SYIM03P) DEVTYPE(*AFPDS) PAGESIZE(70 +
                          120) CPI(15) OVRFLW(62) OUTQ(OUTMAIL))
             ENDDO
             CALL       PGM(SYIM03R) PARM(&ZAVDF &ZAVDT &ZGNF &ZGNT +
                          &ZDTF &ZDTT &ZOT01 &ZOT02 &ZOT03 &ZOT04 +
                          &ZOT05 &ZOT06 &ZOT07 &ZOT08 &ZOT09 &ZOT10 +
                          &ZST &ZUNG &ZBRUDD &ZLNRF &ZLNRT &EPOST &PS)
             CLOF       OPNID(HEADF)
             IF         COND(&EPOST *NE '                        ') +
                          THEN(DO)
             IF         COND(&PS *EQ 'S') THEN(DO)
/*           CALL       PGM(SYGE55CLE) PARM(&FILE &UNIK &EPOST)  */
             CALL       PGM(SYGE55CLE) PARM(&FILE &UNIK &EPOST &EMNE &CVP1)
             ENDDO
             IF         COND(&PS *EQ 'P') THEN(DO)
             CALL       PGM(FAXEPMMCL) PARM(&QUSER &QNBR &QJOB &FILEN +
                          &EPOST +
                          &EMFAX &CVP2 &CVP3 &CVP4 &CVP5 +
                          &CVP6 &CVP7 &CVP8 &CVP9 &PDF)
             ENDDO
             ENDDO
             ENDPGM
