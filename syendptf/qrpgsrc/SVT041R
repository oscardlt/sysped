     FSVT041D   CF   E             WORKSTN
     F                                     SFILE(SVT041DA:ZRECNO)
     FSVTX15L1  UF A E           K DISK
     FSVTX08F2  IF   E           K DISK
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
     C     *LIKE         DEFINE    ZRECNO        WRECNO
     C     *LIKE         DEFINE    SVTX15_01     WSVTX15_01
     C     *LIKE         DEFINE    SVTX15_02     WSVTX15_02
     C     *LIKE         DEFINE    SVTX15_04     WSVTX15_04
     C     *LIKE         DEFINE    SVTX15_22A    WVTX15_22A
     C     *LIKE         DEFINE    SVTX15_31     WSVTX15_31
     C     *LIKE         DEFINE    *IN03         WIN03
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     WKEY          KLIST
     C                   KFLD                    WSVTX15_01
     C                   KFLD                    WSVTX15_02
     C                   KFLD                    WSVTX15_04
     C                   KFLD                    WVTX15_22A
     C                   KFLD                    WSVTX15_31
     C     SVTLKKEY      KLIST
     C                   KFLD                    ZLK4              4
     C                   KFLD                    SVTX15_02
      *_________________
      * Input parametere
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    WSVTX04_01        1
     C                   PARM                    WSVTX04_02       10
     C                   PARM                    WSVTX10_31       90
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR

     C     SRB1          TAG
      *______________
      * Tømme Subfile
      *""""""""""""""
     C                   MOVE      '1'           *IN93
     C                   WRITE     SVT041DB
     C                   MOVEA     '000'         *IN(93)
     C                   Z-ADD     *ZERO         ZRECNO
     C                   Z-ADD     *ZERO         WRECNO
     C                   MOVEA     '000'         *IN(61)
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C                   MOVEL     WSVTX04_02    WVK              10
     C                   MOVE      '00000000'    WVK
     C                   EXSR      READ

     C                   MOVEL     WSVTX04_02    WVK
     C                   MOVE      '000000'      WVK
     C                   EXSR      READ

     C                   MOVEL     WSVTX04_02    WVK
     C                   MOVE      '0000'        WVK
     C                   EXSR      READ

     C                   MOVEL     WSVTX04_02    WVK
     C                   MOVE      '00'          WVK
     C                   EXSR      READ

     C                   MOVE      WSVTX04_02    W89               2
     C     W89           IFNE      '00'
     C                   MOVEL     WSVTX04_02    WVK
     C                   EXSR      READ
     C                   ENDIF

     C     ZRECNO        IFEQ      0
     C                   MOVE      ' '           SVTX15_02
     C                   MOVE      ' '           SVTX15_04
     C                   ADD       1             ZRECNO
     C                   WRITE     SVT041DA
     C                   ENDIF
     C                   Z-ADD     1             ZRECNO
      *_______________
      * Behandle bilde
      *"""""""""""""""
     C     SRB3          TAG

     C                   MOVEA     '11'          *IN(91)
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     SVT041DØ
     C                   WRITE     SVT041DC
     C                   EXFMT     SVT041DB

     C     *IN03         IFEQ      '0'
     C     *IN12         ANDEQ     '0'

     C                   MOVEA     '00'          *IN(91)
      *_____________
      * F5=Frisk opp
      *"""""""""""""
     C     *IN05         CABEQ     '1'           SRB1
      *___________
      * F6=Lage ny
      *"""""""""""
     C     *IN06         IFEQ      '1'
     C                   EXSR      SRBA
     C     *IN03         CABEQ     '1'           UT
     C                   GOTO      SRB3
     C                   END
      *_______
      * Valg ?
      *"""""""
     C                   MOVE      '0'           *IN52
     C                   MOVE      '0'           *IN95
     C     *IN52         DOWEQ     '0'

     C                   READC     SVT041DA                               52
     C     *IN52         IFEQ      '0'
     C     ZOP           CASEQ     '2'           SRBB                           Endre
     C     ZOP           CASEQ     '3'           SRBC                           Kopiere
     C     ZOP           CASEQ     '4'           SRBD                           Slette
     C     ZOP           CASEQ     '5'           SRBE                           Vise
     C                   END
     C                   END
      *
     C  N52              END

     C     ZLK           CABNE     *BLANKS       SRB1

     C     *IN03         CABEQ     '1'           UT
     C     *IN95         CABEQ     '1'           SRB1
     C     *IN95         CABEQ     '0'           SRB3

     C                   END

     C     UT            ENDSR
      *////////////////////////////////////////////////////////////
      *  Lage ny                                             SRBA /
      *////////////////////////////////////////////////////////////
     C     SRBA          BEGSR
      *____________
      * Blanke felt
      *""""""""""""
     C                   MOVE      '0'           *IN41
     C                   MOVE      '0'           *IN42
     C                   MOVEA     '0000'        *IN(30)
     C                   CLEAR                   SVTX15R

     C     SRBA1         TAG

     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     SVT041DØ
     C                   EXFMT     SVT041DD
     C                   MOVEA     '0000'        *IN(30)
     C     *IN03         IFEQ      '0'
     C     *IN12         ANDEQ     '0'
      *____________
      * Teste input-1
      *""""""""""""
      * Post må ikke finnes fra før.
     C                   MOVE      ÅVTX15_01     WSVTX15_01
     C                   MOVE      ÅVTX15_02     WSVTX15_02
     C                   MOVE      ÅVTX15_04     WSVTX15_04
     C                   MOVE      ÅVTX15_22A    WVTX15_22A
     C                   MOVE      ÅVTX15_31     WSVTX15_31
     C     WKEY          CHAIN(N)  SVTX15L1                           53
     C     *IN53         IFEQ      '0'
     C                   MOVE      'SY00100'     ZMSGNO
     C                   MOVEA     '1110'        *IN(30)
     C*                  GOTO      SRBA1
     C                   ENDIF
      *___________________
      * Adda post til  FIL
      *"""""""""""""""""""
     C                   MOVE      ÅVTX15_01     SVTX15_01
     C                   MOVE      ÅVTX15_02     SVTX15_02
     C                   MOVE      ÅVTX15_04     SVTX15_04
     C                   MOVE      ÅVTX15_08     SVTX15_08
     C                   MOVE      ÅVTX15_09     SVTX15_09
     C                   MOVE      ÅVTX15_10     SVTX15_10
     C                   MOVE      ÅVTX15_11     SVTX15_11
     C                   MOVE      ÅVTX15_22A    SVTX15_22A
     C                   MOVE      ÅVTX15_22B    SVTX15_22B
     C                   MOVE      ÅVTX15_22C    SVTX15_22C
     C                   MOVE      ÅVTX15_22D    SVTX15_22D
     C                   MOVE      ÅVTX15_22E    SVTX15_22E
     C                   MOVE      ÅVTX15_22F    SVTX15_22F
     C                   MOVE      ÅVTX15_23A    SVTX15_23A
     C                   MOVE      ÅVTX15_23B    SVTX15_23B
     C                   MOVE      ÅVTX15_23C    SVTX15_23C
     C                   MOVE      ÅVTX15_23D    SVTX15_23D
     C                   MOVE      ÅVTX15_23E    SVTX15_23E
     C                   MOVE      ÅVTX15_23F    SVTX15_23F
     C                   MOVE      ÅVTX15_31     SVTX15_31
     C                   MOVE      ÅVTX15_32     SVTX15_32
     C                   MOVE      ÅVTX15_33     SVTX15_33
     C                   WRITE     SVTX15R

      *______________________
      * Adda post til  SUBFIL
      *""""""""""""""""""""""
     C                   ADD       1             WRECNO
     C                   Z-ADD     WRECNO        ZRECNO
     C                   EVAL      *IN60=*OFF
     C                   WRITE     SVT041DA

     C                   ENDIF

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Endre                                               SRBB /
      *////////////////////////////////////////////////////////////
     C     SRBB          BEGSR
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    SVT041DA
      *____________
      * Flytte felt
      *""""""""""""
     C                   MOVE      SVTX15_01     WSVTX15_01
     C                   MOVE      SVTX15_02     WSVTX15_02
     C                   MOVE      SVTX15_04     WSVTX15_04
     C                   MOVE      SVTX15_22A    WVTX15_22A
     C                   MOVE      SVTX15_31     WSVTX15_31
     C     WKEY          CHAIN(N)  SVTX15L1                           53
     C                   MOVE      '1'           *IN41
     C                   MOVE      '0'           *IN42
     C                   MOVEA     '0000'        *IN(30)
     C                   MOVE      SVTX15_01     ÅVTX15_01
     C                   MOVE      SVTX15_02     ÅVTX15_02
     C                   MOVE      SVTX15_04     ÅVTX15_04
     C                   MOVE      SVTX15_08     ÅVTX15_08
     C                   MOVE      SVTX15_09     ÅVTX15_09
     C                   MOVE      SVTX15_10     ÅVTX15_10
     C                   MOVE      SVTX15_11     ÅVTX15_11
     C                   MOVE      SVTX15_22A    ÅVTX15_22A
     C                   MOVE      SVTX15_22B    ÅVTX15_22B
     C                   MOVE      SVTX15_22C    ÅVTX15_22C
     C                   MOVE      SVTX15_22D    ÅVTX15_22D
     C                   MOVE      SVTX15_22E    ÅVTX15_22E
     C                   MOVE      SVTX15_22F    ÅVTX15_22F
     C                   MOVE      SVTX15_23A    ÅVTX15_23A
     C                   MOVE      SVTX15_23B    ÅVTX15_23B
     C                   MOVE      SVTX15_23C    ÅVTX15_23C
     C                   MOVE      SVTX15_23D    ÅVTX15_23D
     C                   MOVE      SVTX15_23E    ÅVTX15_23E
     C                   MOVE      SVTX15_23F    ÅVTX15_23F
     C                   MOVE      SVTX15_31     ÅVTX15_31
     C                   MOVE      SVTX15_32     ÅVTX15_32
     C                   MOVE      SVTX15_33     ÅVTX15_33

     C     SRBB1         TAG

     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     SVT041DØ
     C                   EXFMT     SVT041DD
     C                   MOVEA     '000'         *IN(30)
     C     *IN03         IFEQ      '0'
     C     *IN12         IFEQ      '0'
      *____________
      * Teste input
      *""""""""""""
     C   30              GOTO      SRBB1
      *______________
      * Oppdatere FIL
      *""""""""""""""
     C                   MOVE      ÅVTX15_01     WSVTX15_01
     C                   MOVE      ÅVTX15_02     WSVTX15_02
     C                   MOVE      ÅVTX15_04     WSVTX15_04
     C                   MOVE      ÅVTX15_22A    WVTX15_22A
     C                   MOVE      ÅVTX15_31     WSVTX15_31
     C     WKEY          CHAIN     SVTX15L1                           53
     C                   MOVE      ÅVTX15_08     SVTX15_08
     C                   MOVE      ÅVTX15_09     SVTX15_09
     C                   MOVE      ÅVTX15_10     SVTX15_10
     C                   MOVE      ÅVTX15_11     SVTX15_11
     C                   MOVE      ÅVTX15_22A    SVTX15_22A
     C                   MOVE      ÅVTX15_22B    SVTX15_22B
     C                   MOVE      ÅVTX15_22C    SVTX15_22C
     C                   MOVE      ÅVTX15_22D    SVTX15_22D
     C                   MOVE      ÅVTX15_22E    SVTX15_22E
     C                   MOVE      ÅVTX15_22F    SVTX15_22F
     C                   MOVE      ÅVTX15_23A    SVTX15_23A
     C                   MOVE      ÅVTX15_23B    SVTX15_23B
     C                   MOVE      ÅVTX15_23C    SVTX15_23C
     C                   MOVE      ÅVTX15_23D    SVTX15_23D
     C                   MOVE      ÅVTX15_23E    SVTX15_23E
     C                   MOVE      ÅVTX15_23F    SVTX15_23F
     C                   MOVE      ÅVTX15_31     SVTX15_31
     C                   MOVE      ÅVTX15_32     SVTX15_32
     C                   MOVE      ÅVTX15_33     SVTX15_33
     C                   UPDATE    SVTX15R

     C                   ENDIF
     C                   ENDIF
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Kopiere                                             SRBC /
      *////////////////////////////////////////////////////////////
     C     SRBC          BEGSR
      *____________
      * Flytte felt
      *""""""""""""
     C                   MOVE      SVTX15_01     WSVTX15_01
     C                   MOVE      SVTX15_02     WSVTX15_02
     C                   MOVE      SVTX15_04     WSVTX15_04
     C                   MOVE      SVTX15_22A    WVTX15_22A
     C                   MOVE      SVTX15_31     WSVTX15_31
     C     WKEY          CHAIN(N)  SVTX15L1                           53
     C                   MOVE      SVTX15_01     ÅVTX15_01
     C                   MOVE      SVTX15_02     ÅVTX15_02
     C                   MOVE      SVTX15_04     ÅVTX15_04
     C                   MOVE      SVTX15_08     ÅVTX15_08
     C                   MOVE      SVTX15_09     ÅVTX15_09
     C                   MOVE      SVTX15_10     ÅVTX15_10
     C                   MOVE      SVTX15_11     ÅVTX15_11
     C                   MOVE      SVTX15_22A    ÅVTX15_22A
     C                   MOVE      SVTX15_22B    ÅVTX15_22B
     C                   MOVE      SVTX15_22C    ÅVTX15_22C
     C                   MOVE      SVTX15_22D    ÅVTX15_22D
     C                   MOVE      SVTX15_22E    ÅVTX15_22E
     C                   MOVE      SVTX15_22F    ÅVTX15_22F
     C                   MOVE      SVTX15_23A    ÅVTX15_23A
     C                   MOVE      SVTX15_23B    ÅVTX15_23B
     C                   MOVE      SVTX15_23C    ÅVTX15_23C
     C                   MOVE      SVTX15_23D    ÅVTX15_23D
     C                   MOVE      SVTX15_23E    ÅVTX15_23E
     C                   MOVE      SVTX15_23F    ÅVTX15_23F
     C                   MOVE      SVTX15_31     ÅVTX15_31
     C                   MOVE      SVTX15_32     ÅVTX15_32
     C                   MOVE      SVTX15_33     ÅVTX15_33
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    SVT041DA
      *____________________________
      * Kalle på rutine for Lage Ny
      *""""""""""""""""""""""""""""
     C                   EXSR      SRBA
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Slette                                              SRBD /
      *////////////////////////////////////////////////////////////
     C     SRBD          BEGSR
      *______________
      * Oppdatere FIL
      *""""""""""""""
     C                   MOVE      SVTX15_01     WSVTX15_01
     C                   MOVE      SVTX15_02     WSVTX15_02
     C                   MOVE      SVTX15_04     WSVTX15_04
     C                   MOVE      SVTX15_22A    WVTX15_22A
     C                   MOVE      SVTX15_31     WSVTX15_31
     C     WKEY          CHAIN     SVTX15L1                           53
     C                   DELETE    SVTX15R
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    SVT041DA
     C                   MOVE      '1'           *IN95
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Vise                                                SRBE /
      *////////////////////////////////////////////////////////////
     C     SRBE          BEGSR
      *____________
      * Flytte felt
      *""""""""""""
     C                   MOVE      '1'           *IN41
     C                   MOVE      '1'           *IN42
     C                   MOVEA     '0000'        *IN(30)
     C                   MOVE      SVTX15_01     WSVTX15_01
     C                   MOVE      SVTX15_02     WSVTX15_02
     C                   MOVE      SVTX15_04     WSVTX15_04
     C                   MOVE      SVTX15_22A    WVTX15_22A
     C                   MOVE      SVTX15_31     WSVTX15_31
     C     WKEY          CHAIN(N)  SVTX15L1                           53
     C                   MOVE      SVTX15_01     ÅVTX15_01
     C                   MOVE      SVTX15_02     ÅVTX15_02
     C                   MOVE      SVTX15_04     ÅVTX15_04
     C                   MOVE      SVTX15_08     ÅVTX15_08
     C                   MOVE      SVTX15_09     ÅVTX15_09
     C                   MOVE      SVTX15_10     ÅVTX15_10
     C                   MOVE      SVTX15_11     ÅVTX15_11
     C                   MOVE      SVTX15_22A    ÅVTX15_22A
     C                   MOVE      SVTX15_22B    ÅVTX15_22B
     C                   MOVE      SVTX15_22C    ÅVTX15_22C
     C                   MOVE      SVTX15_22D    ÅVTX15_22D
     C                   MOVE      SVTX15_22E    ÅVTX15_22E
     C                   MOVE      SVTX15_22F    ÅVTX15_22F
     C                   MOVE      SVTX15_23A    ÅVTX15_23A
     C                   MOVE      SVTX15_23B    ÅVTX15_23B
     C                   MOVE      SVTX15_23C    ÅVTX15_23C
     C                   MOVE      SVTX15_23D    ÅVTX15_23D
     C                   MOVE      SVTX15_23E    ÅVTX15_23E
     C                   MOVE      SVTX15_23F    ÅVTX15_23F
     C                   MOVE      SVTX15_31     ÅVTX15_31
     C                   MOVE      SVTX15_32     ÅVTX15_32
     C                   MOVE      SVTX15_33     ÅVTX15_33

     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     SVT041DØ
     C                   EXFMT     SVT041DD
     C                   MOVEA     '000'         *IN(30)
      *_________________
      * Oppdatere SUBFIL
      *"""""""""""""""""
     C                   MOVE      *BLANKS       ZOP
     C                   UPDATE    SVT041DA
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Läs records från DB-fil                             READ /
      *////////////////////////////////////////////////////////////
     C     READ          BEGSR
     C     WVK           SETLL     SVTX15L1
     C     WVK           READE(N)  SVTX15L1                               94

     C     *IN94         DOWEQ     '0'
     C                   IF        ZRECNO > 999
     C                   LEAVE
     C                   ENDIF

     C                   IF        ZLK <> *BLANKS
     C                   MOVEL     ZLK           ZLK4
      * Er landkoden riktig ?
     C     SVTX15_02     CABEQ     ZLK4          READ1
      * Eller stæmmer regionen ?
     C     SVTLKKEY      CHAIN     SVTX08F2                           56
     C     *IN56         CABEQ     *OFF          READ1
     C                   GOTO      READ2
     C                   ENDIF

     C     READ1         TAG
     C                   ADD       1             ZRECNO
     C                   Z-ADD     ZRECNO        WRECNO
     C                   WRITE     SVT041DA

     C     READ2         TAG
     C     WVK           READE(N)  SVTX15L1                               94
     C  N94              END
     C                   ENDSR
