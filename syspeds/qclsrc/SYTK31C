/* *********************************************************************   */
/*   TA IMOT  SKANN VIA SMTP - FLYTTE TIL TKpdfHandlers INNmappe           */
/*   OBS! User / Adresse er hardkodet (og også TKpdfHandler INNmappe)      */
/*   FOR Å KUNNE KOMPILERE MÅ FIL SKAPES I QTEMP....                       */
/*   QRYDST USRID(SCAN S44DC044) OUTFILE(QTEMP/SCANMAIL) STATUS(*OLD)      */
/*   OBS! MAPPEN "SCAN" (E.L.) MÅ LAGES MANUELT FØR KJØRING                */
/*   USERID SOM SKAL KJØRE JOBBEN MÅ VÆRE AUTORISERT TIL Å JOBBE FOR "SCAN"*/
/*              F.EKS: GRTUSRPMN TOUSER(SY400USR) FORUSER(SCAN)            */
/* *********************************************************************   */
             PGM
             DCL        VAR(&USER) TYPE(*CHAR) LEN(8) VALUE('SCAN')
             DCL        VAR(&ADR) TYPE(*CHAR) LEN(8) VALUE('S44DC044')
             DCL        VAR(&STMF) TYPE(*CHAR) LEN(80)
             DCL        VAR(&LINSNOA) TYPE(*CHAR) LEN(2)
             DCLF       FILE(SCANMAIL)
/*_______________________*/
/* HENTE ID TIL DOCUMENT */
/*"""""""""""""""""""""""*/
             QRYDST     USRID(&USER &ADR) OUTFILE(QTEMP/SCANMAIL) +
                          STATUS(*NEW)
/*____________________*/
/* HENTE DOC TIL FILE */
/*""""""""""""""""""""*/
 START:      RCVF
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))
             DLTDLO     DLO(VEDLEGG) FLR(&USER)
             MONMSG CPF0000
/*KEEP YES*/ RCVDST     DSTID(&LINDID) USRID(&USER &ADR) +
                          DOC(VEDLEGG) FLR(&USER) DSTIDEXN(&LINDEX) +
                          KEEP(*YES)
/*KEEP NO    RCVDST     DSTID(&LINDID) USRID(&USER &ADR) +
                          DOC(VEDLEGG) FLR(&USER) DSTIDEXN(&LINDEX) +
                          KEEP(*NO)   */
 /* DOKUMENTTYPE 14 - = PC-DOK = VEDLEGG... */
             IF         COND(&LINDTP = 14) THEN(DO)
             CHGVAR     VAR(&LINSNOA) VALUE(&LINSNO)
             CHGVAR     VAR(&STMF) VALUE('/sysca/innTKpdf/' *CAT +
                          &LINDID *CAT '_' *CAT &LINSNOA *CAT '.PDF')
             MOV        OBJ('/QDLS/SCAN/VEDLEGG') +
                          TOOBJ(&STMF)
                        ENDDO


             GOTO       CMDLBL(START)

END:         ENDPGM
