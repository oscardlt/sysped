      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/TDIG000R2 MODULE(*LIBL/TDIG000R2 *LIBL/INCGI)
CRTPGM*        ACTGRP(*NEW) AUT(*USE)
      *
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 XXX PTF12 XXXXXXXXXXXXXXXXXXXXXXXX
12XXX * 02 XXX PTF12 XXXXXXXXXXXXXXXXXXXXXXXX
12XXX * 03 XXX PTF12 XXXXXXXXXXXXXXXXXXXXXXXX
12356 * 04 CB  PTF12 Send med ekspedisjonsenhet i svaret
      *********************************************************************
     H*DEBUG(*YES)
      /copy SYSPEDS/qrpgsrcpy,hspecs
      /copy SYSPEDS/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
     FFRISOK    IF   E           K DISK    USROPN
     FBRPARF    IF   E           K DISK    USROPN
     FHEADF     IF   E             DISK    USROPN
     FSADH      IF   E           K DISK    USROPN
     FEDIM2     IF   E           K DISK    USROPN
     FCUNDL01   IF   E           K DISK    USROPN
     FSADMOHF   IF   E             DISK    USROPN
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy SYSPEDS/qrpgsrcpy,prototypeb
      /copy SYSPEDS/qrpgsrcpy,usec
      /copy SYSPEDS/qrpgsrcpy,variables3
     ‚*  Prototype for 'JSONFIX'
     d jsonfix         pr                  extpgm('JSONFIX')
     d jsonstring_                         like(jsonstring)
     ‚*  Prototype for 'INCGI'
     d incgi           pr                  extproc('INCGI')
     d bistdl_                             like(bistdl)
     ‚*  Prototype for variabel program
     D Varpgm          Pr                  ExtPgm(BILIBL)
     d WhereC          s            512a
     d FirstW          s              1A
     d cQuote          C                   const('''')
     d SqlStm          s            512a
     d myrows          s             10i 0
     D WSUSER          S             10
     D TUR             S              8
     D TURN            S              8  0
     D WEHRG           S             11
     D WEH0068A        S              8  0
     D WEH0068B        S              6  0
     D WEH3039E        S              6  0
     D WSITLE          S              6
     D JSONstring      s          32000
     D Error           S            150
     D AntLest         S              9  0
     d X               S             10  0
     d wpabrid         s                   like(pabrid)
     d wpakunr         s                   like(pakunr)
     d wpasort         s                   like(pasort)
N02  d wfssok_CR       s                   like(fssok)
N02  d wfssokMRN       s                   like(fssok)
N03  d wfssokMRN2      s                   like(fssok)
N03  d wfssokMRN3      s                   like(fssok)
N03  d wfssokMRN4      s                   like(fssok)
N03  d wfssokMRN5      s                   like(fssok)
N03  d wfssokMRN6      s                   like(fssok)
N03  d wfssokMRN7      s                   like(fssok)
N03  d wfssokMRN8      s                   like(fssok)
N03  d wfssokMRN9      s                   like(fssok)
N02  d wfssokEXP       s                   like(fssok)
N03  d wfssokEXP2      s                   like(fssok)
N03  d wfssokEXP3      s                   like(fssok)
N03  d wfssokEXP4      s                   like(fssok)
N03  d wfssokEXP5      s                   like(fssok)
N03  d wfssokEXP6      s                   like(fssok)
N03  d wfssokEXP7      s                   like(fssok)
N03  d wfssokEXP8      s                   like(fssok)
N03  d wfssokEXP9      s                   like(fssok)
     d avda            S              4
     d avdn            S              4  0
     d opda            S              7
     d opdn            S              7  0
     d MyPoDS          ds                  Qualified  dim(500)
     d  HEST                          1
     d  HEUR                          1
     d  HEAVD                         4S 0
     d  HEOPD                         7S 0
     d  HESG                          3
     d  HEDTOP                        8S 0
     d  HEKNS                         8S 0
     d  HENAS                        30
     d  HEADS1                       30
     d  HEADS2                       30
     d  HEPNS                         9
     d  HEADS3                       30
     d  HEKNK                         8S 0
     d  HENAK                        30
     d  HEADK1                       30
     d  HEADK2                       30
     d  HEPNK                         9
     d  HEADK3                       30
     d  HELKA                         2
     d  HEGN                         15
     d  HENT                          7S 0
     d  HEVKT                         9S 0
     d  HEFR                          3
      *get input-string
      /copy syspeds/qrpgsrcpy,prolog3

      /free
         exsr ParseSr;
         exsr init;

       gethtmlifs(
       '/syspeddev/html/JSON.html':
       '/CGITAG/');
       wrtsection('top');

       //...........................................................................................
       //skriv JSON-Object start (alltid '{' + x ant param. m/komma mellom (IKKE komma etter siste))
       //...........................................................................................

        JSONstring='{'
        +'¬user¬ : ¬'+%trim(WSUSER)+'¬, '
        +'¬tur¬ : ¬'+%trim(%editc(TURN:'Z'))+'¬, '
        +'¬avd¬ : ¬'+%trim(%editc(AVDN:'Z'))+'¬, '
        +'¬opd¬ : ¬'+%trim(%editc(OPDN:'Z'))+'¬, '
        +'¬errMsg¬ : ¬'+%trim(Error)+'¬, ';

       //JSONfix escaper " i tekst,  for deretter å bytte ¬->"

       jsonfix ( jsonstring );

       updhtmlvar2('JSONstring'
                  :%addr(jsonstring)
                  :%len(jsonstring));
       wrtsection('JSONlin');

       //...........................................................................................
       // Skriv JSON-LISTE Start (en liste er EN parameter(fra [ til   )
       //..........................................................................................
       jsonstring ='"orderList" : [';

       updhtmlvar2('JSONstring'
                  :%addr(jsonstring)
                  :%len(jsonstring));
       wrtsection('JSONlin');

       if error = *blanks;
         exsr SelSr;
         if myrows > 0;
           exsr LesSr;
         endif;
       endif;
       // ..........................................................................................
       // Skriv JSON-Liste/Array  Avslutning
       // ..........................................................................................
       jsonstring =']';
       updhtmlvar2('JSONstring'
                  :%addr(jsonstring)
                  :%len(jsonstring));
       wrtsection('JSONlin');
       // ..........................................................................................
       // Skriv JSON-string Avsluttning
       // ..........................................................................................
       jsonstring ='}';
       updhtmlvar2('JSONstring'
                  :%addr(jsonstring)
                  :%len(jsonstring));
       wrtsection('JSONlin');
         exsr Exit;

       //-----------------------------------------------------------------
       // Select fra fil via SQL
       //-----------------------------------------------------------------
       begsr     SelSr;

       If    TURN > 0;
         TUR = %editc(TURN:'X');
         Exsr  AddAnd;
         Eval  WhereC = ' HEPRO  = ' + TUR;
       EndIf;

       If    AVDN > 0;
       If    OPDN > 0;
         AVDA = %editc(AVDN:'X');
         Eval  WhereC = ' HEAVD  = ' + AVDA + ' and' +
                        ' HEOPD  = ' + OPDA;
       EndIf;
       EndIf;

         Eval      WhereC =  ' Where ' + %trim(WhereC);
         Eval       SqlStm = 'Select HEST, HEUR, HEAVD, HEOPD, HESG, +
                                     HEDTOP, HEKNS, HENAS, HEADS1, HEADS2, +
                                     HEPNS, HEADS3, HEKNK, HENAK, HEADK1, +
                                     HEADK2, HEPNK, HEADK3, HELKA, +
                                     HEGN, HENT, HEVKT, HEFR ' +
                             'from HEADF ' +
                              %trim(WhereC)  +
                             ' Order by '       +
                             'HEDTOP desc ' +
                             'FOR READ ONLY ';
         Exec SQL PREPARE DynSel from :SqlStm;
         EXEC SQL DECLARE  A33  cursor for DynSel;
         Exec SQL OPEN A33;
         Myrows = %elem(MyPoDS);
         exec sql FETCH A33   for :MyRows rows
                  INTO :MyPoDs;
         Exec SQL CLOSE A33;
       endsr;
       //-----------------------------------------------------------------
       // Set inn "AND" mellom where settninger
       //-----------------------------------------------------------------
       begsr     AddAnd;
       If        FirstW =   'N';
         Eval      WhereC =  %trim(WhereC) + ' and ';
       EndIf;
         Eval      FirstW =   'N';
       endsr;
       //-----------------------------------------------------------------
       // hent input
       //-----------------------------------------------------------------
       begsr     ParseSr;
         wsuser  = zhbgetvar('USER');
         tur     = zhbgetvar('TUR');
         turn    = c2n2(tur);
         wsitle  = zhbgetvar('SITLE');
         avda    = zhbgetvar('AVD');
         avdn    = c2n2(avda);
         opda = zhbgetvar('OPD');
         opdn = c2n2(opda);
        endsr;
        // __________________________________________________
        // Læs array                                    LESSR
        // """"""""""""""""""""""""""""""""""""""""""""""""""
           begsr LesSr;
       for x = 1 to myrows;

       if mypods(x).hesg <> *blanks;

            sist=*blanks;
             fssok=*blanks;
             wfssok_CR=*blanks;
             wfssokMRN=*blanks;
N03          wfssokMRN2=*blanks;
N03          wfssokMRN3=*blanks;
N03          wfssokMRN4=*blanks;
N03          wfssokMRN5=*blanks;
N03          wfssokMRN6=*blanks;
N03          wfssokMRN7=*blanks;
N03          wfssokMRN8=*blanks;
N03          wfssokMRN9=*blanks;
             wfssokEXP=*blanks;
N03          wfssokEXP2=*blanks;
N03          wfssokEXP3=*blanks;
N03          wfssokEXP4=*blanks;
N03          wfssokEXP5=*blanks;
N03          wfssokEXP6=*blanks;
N03          wfssokEXP7=*blanks;
N03          wfssokEXP8=*blanks;
N03          wfssokEXP9=*blanks;
            fssok=*blanks;
           chain (mypods(x).HEAVD: mypods(x).HEOPD) SADH;
           if %found;
             Exsr  Lesedim;
             Exsr  Lesedim2;
           else;
             Exsr  clearsadh;
           endif;
N03          WHEAVD=mypods(x).HEAVD;
N03          WHEOPD=mypods(x).HEOPD;
N03          Exsr  LesMRN;
N03          Exsr  Lesexp;
             chain (mypods(x).HEAVD: mypods(x).HEOPD: '*CR') FRISOK;
               if %found;
                 wfssok_CR = fssok;
               endif;

         // Hent kundeopplysninger
            exsr getcundf;

           if error = *blanks;

        // Lægg ut Json stræng
           AntLest = AntLest + 1;

        // Skriv en JSON-Array-linje pr menypunkt - komma før hvert nytt element

       if AntLest=1;
          JSONstring=*blanks;
          else;
          JSONstring=', ';
          endif;
       JSONstring=%trim(JSONstring)+'{'
          +'¬hest¬ : ¬'+%trim(mypods(x).HEST)+'¬, '
          +'¬heur¬ : ¬'+%trim(mypods(x).HEUR)+'¬, '
          +'¬siavd¬ : ¬'+%trim(%editc(mypods(x).HEAVD:'Z'))+'¬, '
          +'¬sitdn¬ : ¬'+%trim(%editc(mypods(x).HEOPD:'Z'))+'¬, '
          +'¬sisg¬ : ¬'+%trim(mypods(x).HESG)+'¬, '
          +'¬sidt¬ : ¬'+%trim(%editc(mypods(x).HEDTOP:'Z'))+'¬, '
          +'¬sikns¬ : ¬'+%trim(%editc(mypods(x).HEKNS:'Z'))+'¬, '
          +'¬sinas¬ : ¬'+%trim(mypods(x).HENAS)+'¬, '
          +'¬siads1¬ : ¬'+%trim(mypods(x).HEADS1)+'¬, '
          +'¬siads2¬ : ¬'+%trim(mypods(x).HEADS2)+'¬, '
          +'¬hepns¬ : ¬'+%trim(mypods(x).HEPNS)+'¬, '
          +'¬siads3¬ : ¬'+%trim(mypods(x).HEADS3)+'¬, '
          +'¬sintk¬ : ¬'+%trim(%editc(mypods(x).HENT:'Z'))+'¬, '
          +'¬sivkb¬ : ¬'+%trim(%editc(mypods(x).HEVKT:'Z'))+'¬, '
          +'¬sikdc¬ : ¬'+%trim(SIKDC)+'¬, '
          +'¬siknk¬ : ¬'+%trim(%editc(mypods(x).HEKNK:'Z'))+'¬, '
          +'¬sirg¬ : ¬'+%trim(SIRG)+'¬, '
          +'¬sinak¬ : ¬'+%trim(mypods(x).HENAK)+'¬, '
          +'¬siadk1¬ : ¬'+%trim(mypods(x).HEADK1)+'¬, '
          +'¬siadk2¬ : ¬'+%trim(mypods(x).HEADK2)+'¬, '
          +'¬hepnk¬ : ¬'+%trim(mypods(x).HEPNK)+'¬, '
          +'¬siadk3¬ : ¬'+%trim(mypods(x).HEADK3)+'¬, '
          +'¬silka¬ : ¬'+%trim(mypods(x).HELKA)+'¬, '
          +'¬sitlf¬ : ¬'+%trim(SITLF)+'¬, '
          +'¬sinad¬ : ¬'+%trim(SINAD)+'¬, '
          +'¬silv¬ : ¬'+%trim(mypods(x).HEFR)+'¬, '
          +'¬silvt¬ : ¬'+%trim(SILVT)+'¬, '
          +'¬sign¬ : ¬'+%trim(mypods(x).HEGN)+'¬, '
          +'¬sitle¬ : ¬'+%trim(%editc(WEH3039E:'Z'))+'¬, '
          +'¬wehrg¬ : ¬'+%trim(WEHRG)+'¬, '
          +'¬weh0068a¬ : ¬'+%trim(%editc(WEH0068A:'Z'))+'¬, '
          +'¬weh0068b¬ : ¬'+%trim(%editc(WEH0068B:'Z'))+'¬, '
          +'¬ehrgs¬ : ¬'+%trim(EHRGS)+'¬, '
          +'¬ehnas¬ : ¬'+%trim(EHNAS)+'¬, '
          +'¬ehad1s¬ : ¬'+%trim(EHAD1S)+'¬, '
          +'¬ehpns¬ : ¬'+%trim(EHPNS)+'¬, '
          +'¬ehpss¬ : ¬'+%trim(EHPSS)+'¬, '
          +'¬ehlks¬ : ¬'+%trim(EHLKS)+'¬, '
          +'¬ehems¬ : ¬'+%trim(EHEMS)+'¬, '
          +'¬ehemst¬ : ¬'+%trim(EHEMST)+'¬, '
          +'¬ehrgm¬ : ¬'+%trim(EHRGM)+'¬, '
          +'¬ehnam¬ : ¬'+%trim(EHNAM)+'¬, '
          +'¬ehad1m¬ : ¬'+%trim(EHAD1M)+'¬, '
          +'¬ehpnm¬ : ¬'+%trim(EHPNM)+'¬, '
          +'¬ehpsm¬ : ¬'+%trim(EHPSM)+'¬, '
          +'¬ehlkm¬ : ¬'+%trim(EHLKM)+'¬, '
          +'¬ehemm¬ : ¬'+%trim(EHEMM)+'¬, '
          +'¬ehemmt¬ : ¬'+%trim(EHEMMT)+'¬, '
          +'¬sist¬ : ¬'+%trim(SIST)+'¬, '
          +'¬fssok¬ : ¬'+%trim(FSSOK)+'¬, '
          +'¬wfssok_cr¬ : ¬'+%trim(WFSSOK_CR)+'¬, '
          +'¬wfssokmrn¬ : ¬'+%trim(WFSSOKMRN)+'¬, '
N03       +'¬wfssokmrn2¬ : ¬'+%trim(WFSSOKMRN2)+'¬, '
N03       +'¬wfssokmrn3¬ : ¬'+%trim(WFSSOKMRN3)+'¬, '
N03       +'¬wfssokmrn4¬ : ¬'+%trim(WFSSOKMRN4)+'¬, '
N03       +'¬wfssokmrn5¬ : ¬'+%trim(WFSSOKMRN5)+'¬, '
N03       +'¬wfssokmrn6¬ : ¬'+%trim(WFSSOKMRN6)+'¬, '
N03       +'¬wfssokmrn7¬ : ¬'+%trim(WFSSOKMRN7)+'¬, '
N03       +'¬wfssokmrn8¬ : ¬'+%trim(WFSSOKMRN8)+'¬, '
N03       +'¬wfssokmrn9¬ : ¬'+%trim(WFSSOKMRN9)+'¬, '
          +'¬wfssokexp¬ : ¬'+%trim(WFSSOKEXP)+'¬, '
N03       +'¬wfssokexp2¬ : ¬'+%trim(WFSSOKEXP2)+'¬, '
N03       +'¬wfssokexp3¬ : ¬'+%trim(WFSSOKEXP3)+'¬, '
N03       +'¬wfssokexp4¬ : ¬'+%trim(WFSSOKEXP4)+'¬, '
N03       +'¬wfssokexp5¬ : ¬'+%trim(WFSSOKEXP5)+'¬, '
N03       +'¬wfssokexp6¬ : ¬'+%trim(WFSSOKEXP6)+'¬, '
N03       +'¬wfssokexp7¬ : ¬'+%trim(WFSSOKEXP7)+'¬, '
N03       +'¬wfssokexp8¬ : ¬'+%trim(WFSSOKEXP8)+'¬, '
N03       +'¬wfssokexp9¬ : ¬'+%trim(WFSSOKEXP9)+'¬, '
          +'¬sitarf¬ : ¬'+%trim(SITARF)+'¬}';
         jsonfix (JSONstring);
       updhtmlvar2('JSONstring'
                  :%addr(jsonstring)
                  :%len(jsonstring));
         wrtsection ('JSONlin');

           endif;
           endif;
        endfor;

       endsr;
       //********************************************************
       begsr init;
       //********************************************************
         open bridf;
         // Test innlogging
         chain wsuser bridf;

         if %found;
           if bilibl = *blanks;
             incgi ( bistdl );
           else;

             Monitor;
                   Varpgm();
                 On-Error;
                   //
                 EndMon;

           endif;
         else;

           error = 'Invalid userID';
         endif;
         open frisok;
         open brparf;
         open sadh;
         open edim2;
         open cundl01;
         open sadmohf;
         open headf;
         // Dummy read av HEADF
           if bilibl = *blanks;
           if bilibl <> *blanks;
           read headf;
           endif;
           endif;

       endsr;
       //=====================================================================
       // Close output html and quit
       //=====================================================================
       begsr exit;
         // Lukk fil
         close bridf;
         close frisok;
         close brparf;
         close sadh;
         close edim2;
         close cundl01;
         close sadmohf;
         close headf;

         wrtsection('*fini');
         *inlr = *on;
         return;
       endsr;
      /end-free
      *________________________________________
      * Hent dato og sekvensnr fra meldingslogg
      *"""""""""""""""""""""""""""""""""""""""""
     C     LESEDIM       BEGSR
     C     EDIM2KEY      KLIST
     C                   KFLD                    SIAVD
     C                   KFLD                    SITDN
     C                   EVAL      *IN33 = *OFF
     C                   EVAL      WEHRG = *BLANKS
     C                   EVAL      WEH0068A = *ZEROS
     C                   EVAL      WEH0068B = *ZEROS
     C     EDIM2KEY      SETGT     EDIM2
     C     EDIM2KEY      READPE    EDIM2                                  33
     C                   DOW       *IN33 = *OFF
     C                   IF        M1001 = '929'
     C                   EVAL      WEHRG = %SUBST(M0068:1:9)
     C                   EVAL      WEH0068A = M0068A
     C                   EVAL      WEH0068B = M0068B
     C                   LEAVE
     C                   END
     C     EDIM2KEY      READPE    EDIM2                                  33
     C                   ENDDO
     C                   ENDSR
      *________________________________________
      * Hent ekspedisjonsenhet fra meldingslogg
      *"""""""""""""""""""""""""""""""""""""""""
     C     LESEDIM2      BEGSR
     C                   EVAL      ERROR=' '
     C                   EVAL      *IN33 = *OFF
     C                   EVAL      WEH3039E = *ZEROS
     C     EDIM2KEY      SETLL     EDIM2
     C     EDIM2KEY      READE     EDIM2                                  33
     C                   DOW       *IN33 = *OFF
     C                   IF        MSR = 'S'
     C                   IF        M1001 = '929'
     C                   EVAL      WEH3039E = M3039E
     C                   LEAVE
     C                   ENDIF
     C                   ENDIF
     C     EDIM2KEY      READE     EDIM2                                  33
     C                   ENDDO
      * Om Oscar har skickat med ett värde i ekspedisjonsenhet så testa det.
     C     WSITLE        IFNE      *BLANKS
     C                   MOVE      M3039E        WM3039E           6
     C     WSITLE        IFNE      WM3039E
     C                   EVAL      ERROR='X'
     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
N03   *____________________________
N03   * Hent EXP fra frie søkeveier
N03   *""""""""""""""""""""""""""""
N03  C     LESEXP        BEGSR
N03  C     FRIKEY        KLIST
N03  C                   KFLD                    WHEAVD
N03  C                   KFLD                    WHEOPD
N03  C                   KFLD                    WFSKODE
N03  C     *LIKE         DEFINE    HEAVD         WHEAVD
N03  C     *LIKE         DEFINE    HEOPD         WHEOPD
N03  C     *LIKE         DEFINE    FSKODE        WFSKODE
N03  C                   EVAL      WFSKODE='EXP'
N03
N03  C                   EVAL      *IN33 = *OFF
N03  C     FRIKEY        SETLL     FRISOK
N03  C     FRIKEY        READE     FRISOK                                 33
N03  C                   DOW       *IN33 = *OFF
N03  C                   SELECT
N03  C                   WHEN      WFSSOKEXP=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKEXP
N03  C                   WHEN      WFSSOKEXP2=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKEXP2
N03  C                   WHEN      WFSSOKEXP3=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKEXP3
N03  C                   WHEN      WFSSOKEXP4=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKEXP4
N03  C                   WHEN      WFSSOKEXP5=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKEXP5
N03  C                   WHEN      WFSSOKEXP6=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKEXP6
N03  C                   WHEN      WFSSOKEXP7=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKEXP7
N03  C                   WHEN      WFSSOKEXP8=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKEXP8
N03  C                   WHEN      WFSSOKEXP9=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKEXP9
N03  C                   ENDSL
N03  C     FRIKEY        READE     FRISOK                                 33
N03  C                   ENDDO
N03  C                   ENDSR
N03   *____________________________
N03   * Hent MRN fra frie søkeveier
N03   *""""""""""""""""""""""""""""
N03  C     LESMRN        BEGSR
N03  C                   EVAL      WFSKODE='MRN'
N03
N03  C                   EVAL      *IN33 = *OFF
N03  C     FRIKEY        SETLL     FRISOK
N03  C     FRIKEY        READE     FRISOK                                 33
N03  C                   DOW       *IN33 = *OFF
N03  C                   SELECT
N03  C                   WHEN      WFSSOKMRN=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKMRN
N03  C                   WHEN      WFSSOKMRN2=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKMRN2
N03  C                   WHEN      WFSSOKMRN3=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKMRN3
N03  C                   WHEN      WFSSOKMRN4=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKMRN4
N03  C                   WHEN      WFSSOKMRN5=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKMRN5
N03  C                   WHEN      WFSSOKMRN6=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKMRN6
N03  C                   WHEN      WFSSOKMRN7=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKMRN7
N03  C                   WHEN      WFSSOKMRN8=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKMRN8
N03  C                   WHEN      WFSSOKMRN9=*BLANKS
N03  C                   MOVEL     FSSOK         WFSSOKMRN9
N03  C                   ENDSL
N03  C     FRIKEY        READE     FRISOK                                 33
N03  C                   ENDDO
N03  C                   ENDSR
      *_________________________________________________
      * Hent avs/mot kundeopplysninger fra kundregistret
      *"""""""""""""""""""""""""""""""""""""""""""""""""
     C     GETCUNDF      BEGSR
     C     *LIKE         DEFINE    HEKNS         WHEKNS
     C     *LIKE         DEFINE    HEKNK         WHEKNK
     C     KEYCUNDS      KLIST
     C                   KFLD                    BIFIRM
     C                   KFLD                    WHEKNS
     C     KEYCUNDM      KLIST
     C                   KFLD                    BIFIRM
     C                   KFLD                    WHEKNK
      /free
         whekns=mypods(x).hekns;
         wheknk=mypods(x).heknk;
      /end-free
     C                   EVAL      EHRGS = *BLANKS
     C                   EVAL      EHNAS = *BLANKS
     C                   EVAL      EHAD1S = *BLANKS
     C                   EVAL      EHPNS = *BLANKS
     C                   EVAL      EHPSS = *BLANKS
     C                   EVAL      EHLKS = *BLANKS
     C                   EVAL      EHEMS = *BLANKS
     C                   EVAL      EHEMST = *BLANKS
     C                   EVAL      EHRGM = *BLANKS
     C                   EVAL      EHNAM = *BLANKS
     C                   EVAL      EHAD1M = *BLANKS
     C                   EVAL      EHPNM = *BLANKS
     C                   EVAL      EHPSM = *BLANKS
     C                   EVAL      EHLKM = *BLANKS
     C                   EVAL      EHEMM = *BLANKS
     C                   EVAL      EHEMMT = *BLANKS
     C     KEYCUNDS      CHAIN     CUNDL01                            33
     C                   IF        *IN33 = *OFF
     C                   EVAL      EHRGS = EORI
     C                   EVAL      EHNAS = KNAVN
     C                   EVAL      EHAD1S = ADR1
     C                   EVAL      EHPNS = SYPOGE
     C                   EVAL      EHPSS = ADR3
     C                   EVAL      EHLKS = SYLAND
     C                   EVAL      EHEMS = SYEPOS
     C                   IF        SYEPOS <> *BLANKS
     C                   EVAL      EHEMST = 'EM'
     C                   ENDIF
     C                   ENDIF
     C     KEYCUNDM      CHAIN     CUNDL01                            33
     C                   IF        *IN33 = *OFF
     C                   EVAL      EHRGM = SYRG
     C                   EVAL      EHNAM = KNAVN
     C                   EVAL      EHAD1M = ADR1
     C                   MOVEL     POSTNR        EHPNM
     C                   EVAL      EHPSM = ADR3
     C                   EVAL      EHLKM = SYLAND
     C                   EVAL      EHEMM = SYEPOS
     C                   IF        SYEPOS <> *BLANKS
     C                   EVAL      EHEMMT = 'EM'
     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
      *_____________________________
      * Nullstill variabler fra SADH
      *"""""""""""""""""""""""""""""
     C     CLEARSADH     BEGSR
     C                   EVAL      sinad=*BLANKS
     C                   EVAL      silvt=*BLANKS
     C                   EVAL      sitle=*BLANKS
     C                   EVAL      sist=*BLANKS
     C                   EVAL      sitarf=*BLANKS
     C                   EVAL      WEHRG = *BLANKS
     C                   EVAL      WEH0068A = *ZEROS
     C                   EVAL      WEH0068B = *ZEROS
     C                   EVAL      WEH3039E = *ZEROS
     C     WSITLE        IFNE      *BLANKS
     C                   EVAL      ERROR='X'
     C                   ENDIF
     C                   ENDSR
