********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 YBC PTF12 TVFGKD er definert 5A, men WSFGKD er 4A.
********************************************************************
      *
      ***********************************************************
      *** PROGRAM SKAL ARBEIDE MED EL.TRANSIT LINJE-OPPLYSNING***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01 02 05 06 08 09 11 13 16 18-26
      *** LEDIGE INDIKATORER 40-47
      ***        INDIKATOR   27 PÅ = SPØRRING                 ***
      ***        INDIKATOR   34 BRUKES FOR TVINN              ***
      *** ALLE VARIABLER SOM STARTER MED 'X' ER ARBERDSVAR.   ***
      ***   OG DEFINERES I PROGRAM                            ***
      ***********************************************************
      *
     FTRUVFV    UF A E           K DISK
     FTRKODL01  IF   E           K DISK
     FFIRM      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FKODTS2    IF   E           K DISK
     FTR012DA   CF   E             WORKSTN INFDS(FBAREA)
     D FBAREA          DS
     D  WSCLOC               382    383B 0
     D  WSSUBN               378    379B 0
      *
     D                 DS
     D  SYRG                   1     14
     D  SYFOR9                 1      9
     D  SYFORE                 1     11
      *
     C                   EXSR      INIT
      *
      *...............................................
      * BILDE-1 INNLESING AV HOVED OPPL. FORH.VARSLING
      *'''''''''''''''''''''''''''''''''''''''''''''''
     C     START         TAG
     C  N30              Z-ADD     2             LINNBR
     C  N30              Z-ADD     15            POSNBR
      *
     C     START1        TAG
     C                   EXFMT     TR012DA1
     C                   MOVEA     '0000000'     *IN(93)
     C                   MOVE      '0'           *IN(30)
      *
      *  04 = SØK AVSENDER/MOTTAKER/HOVEDANSVARLIG
     C   04              DO
     C                   EXSR      SØKDTA
     C                   GOTO      START1
     C                   END
      *
      *  12 = AVBRYT, FRIGJØR E-MERKING OG GÅ TIL TR011D02
     C   12              GOTO      SLUTT
      *
     C   27              GOTO      SLUTT
      *
      * ----------- T E S T   B I L D E --------------
     C                   EXSR      TESTB
     C   30              GOTO      START
      *
      * ----- INGEN FEIL HITTIL  OPPDATER TRUVFV -----
     C                   EXSR      OPDTRV
      *
     C     SLUTT         TAG
     C     *IN12         IFEQ      '1'
     C                   Z-ADD     1             UFLAGG
     C                   ELSE
     C                   Z-ADD     0             UFLAGG
     C                   END
     C                   EVAL      *INLR = *ON
     C                   RETURN
      *
     C***********************************************
     C     SØKDTA        BEGSR
     C***********************************************
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
      * TRANSPORTKOSTNADS BETALINGSMÅTE
     C     LINNBR        IFEQ      2
     C     POSNBR        ANDGE     15
     C     POSNBR        ANDLE     15
     C                   MOVE      '116'         UUNIK             3
     C                   MOVE      *BLANKS       UKODE            10
     C                   MOVEL     WSTKBM        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE             3
     C                   MOVEL     UKODE         WSTKBM
     C                   Z-ADD     3             LINNBR
     C                   Z-ADD     10            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * AVSENDERSNR SIKKERHET
     C     LINNBR        IFEQ      4
     C     POSNBR        ANDGE     22
     C     POSNBR        ANDLE     29
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    WSKNSS
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN
     C                   IF        WSKNSS <> 0
     C                   EXSR      TESTSS
     C                   END
     C                   Z-ADD     31            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * LANDKODE TIL AVSENDER SIKKERHET
     C     LINNBR        IFEQ      8
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     13
     C                   CALL      'SYFI10L'
     C                   PARM                    WSLKSS
     C                   PARM                    USPED
     C                   Z-ADD     32            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * SPRÅKKODE TIL AVSENDER SIKKERHET
     C     LINNBR        IFEQ      8
     C     POSNBR        ANDGE     32
     C     POSNBR        ANDLE     33
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSSKSS        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE
     C                   MOVEL     UKODE         WSSKSS
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     22            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * MOTTAKERSNR SIKKERHET
     C     LINNBR        IFEQ      9
     C     POSNBR        ANDGE     22
     C     POSNBR        ANDLE     29
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    WSKNKS
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN
     C                   IF        WSKNKS <> 0
     C                   EXSR      TESTKK
     C                   END
     C                   Z-ADD     31            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * LANDKODE TIL MOTTAKER SIKKERHET
     C     LINNBR        IFEQ      13
     C     POSNBR        ANDGE     12
     C     POSNBR        ANDLE     13
     C                   CALL      'SYFI10L'
     C                   PARM                    WSLKKS
     C                   PARM                    USPED
     C                   Z-ADD     32            POSNBR
     C                   GOTO      SLSØK
     C                   END
      * SPRÅKKODE TIL MOTTAKER SIKKERHET
     C     LINNBR        IFEQ      13
     C     POSNBR        ANDGE     32
     C     POSNBR        ANDLE     33
     C                   MOVE      '012'         UUNIK
     C                   MOVE      *BLANKS       UKODE
     C                   MOVEL     WSSKKS        UKODE
     C                   CALL      'TR002R'
     C                   PARM                    UUNIK
     C                   PARM                    UKODE
     C                   PARM                    UTYPE
     C                   MOVEL     UKODE         WSSKKS
     C                   Z-ADD     32            POSNBR
     C                   GOTO      SLSØK
     C                   END
      *
     C                   MOVE      'DIV1037'     MSGNR
     C                   SETON                                        30
      *
     C     SLSØK         ENDSR
      *
      ***********************************************
     C     TESTB         BEGSR
      ***********************************************
      *
     C                   IF        WSTKBM <> *BLANKS
     C                   MOVE      '116'         YUNIK
     C                   EVAL      YKODE = WSTKBM
     C     TRK01K        CHAIN     TRKODL01                           99
     C   99              MOVE      'YBC1945'     MSGNR
     C   99              SETON                                        30
     C                   END
      *
     C                   IF        WSKNSS <> 0
     C                   MOVE      WSKNSS        KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            98
     C                   IF        *IN98
     C  N30              MOVE      'SPK0001'     MSGNR
     C                   SETON                                        30
     C                   ELSE
     C                   MOVE      KNAVN         WSNASS
     C                   MOVE      ADR1          WSADSS1
     C     SYPOGE        IFEQ      *BLANKS
     C                   MOVE      *BLANKS       WSPNSS
     C                   MOVEL     POSTNR        WSPNSS
     C                   ELSE
     C                   MOVEL     SYPOGE        WSPNSS
     C                   END
     C                   MOVE      ADR3          WSPSSS
     C                   IF        SYLAND = *BLANKS
     C                   MOVE      'NO'          WSLKSS
     C                   ELSE
     C                   MOVE      SYLAND        WSLKSS
     C                   END
     C                   IF        WSTINSS = *BLANKS
     C                   IF        EORI = *BLANKS
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))
     C                   EVAL      WSTINSS = WSLKSS + SYFOR9
     C                   ELSE
     C                   EVAL      WSTINSS = *BLANKS
     C                   END
     C                   ELSE
     C                   EVAL      WSTINSS = EORI
     C                   END
     C                   END
     C                   END
     C                   END
      *
     C                   IF        ((WSNASS <> *BLANKS) AND (WSADSS1 = *BLANKS))
     C                   EVAL      WSADSS1 = '.'
     C                   END
      *
     C                   IF        WSLKSS <> *BLANKS
     C                   MOVE      WSLKSS        KS2LK
     C     KODS2K        CHAIN     KODTS2                             97
     C   97
     CANN30              MOVE      'SPL0001'     MSGNR
     C   97              SETON                                        30
     C                   END
      *
     C                   IF        WSSKSS <> *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   MOVEL     WSSKSS        YKODE
     C     TRK01K        CHAIN     TRKODL01                           96
     C   96
     CANN30              MOVE      'YBC0810'     MSGNR
     C   96              SETON                                        30
     C                   END
      *
     C                   IF        WSKNKS <> 0
     C                   MOVE      WSKNKS        KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            95
     C                   IF        *IN95
     C  N30              MOVE      'SPK0001'     MSGNR
     C                   SETON                                        30
     C                   ELSE
     C                   MOVE      KNAVN         WSNAKS
     C                   MOVE      ADR1          WSADKS1
     C     SYPOGE        IFEQ      *BLANKS
     C                   MOVE      *BLANKS       WSPNKS
     C                   MOVEL     POSTNR        WSPNKS
     C                   ELSE
     C                   MOVEL     SYPOGE        WSPNKS
     C                   END
     C                   MOVE      ADR3          WSPSKS
     C                   IF        SYLAND = *BLANKS
     C                   MOVE      'NO'          WSLKKS
     C                   ELSE
     C                   MOVE      SYLAND        WSLKKS
     C                   END
     C                   IF        WSTINKS = *BLANKS
     C                   IF        EORI = *BLANKS
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))
     C                   EVAL      WSTINKS = WSLKKS + SYFOR9
     C                   ELSE
     C                   EVAL      WSTINKS = *BLANKS
     C                   END
     C                   ELSE
     C                   EVAL      WSTINKS = EORI
     C                   END
     C                   END
     C                   END
     C                   END
      *
     C                   IF        ((WSNAKS <> *BLANKS) AND (WSADKS1 = *BLANKS))
     C                   EVAL      WSADKS1 = '.'
     C                   END
      *
     C                   IF        WSLKKS <> *BLANKS
     C                   MOVE      WSLKKS        KS2LK
     C     KODS2K        CHAIN     KODTS2                             94
     C   94
     CANN30              MOVE      'SPL0001'     MSGNR
     C   94              SETON                                        30
     C                   END
      *
     C                   IF        WSSKKS <> *BLANKS
     C                   MOVE      '012'         YUNIK
     C                   EVAL      YKODE = WSSKKS
     C     TRK01K        CHAIN     TRKODL01                           93
     C   93
     CANN30              MOVE      'YBC0810'     MSGNR
     C   93              SETON                                        30
     C                   END
      *
     C   30              EXSR      SETCUR
      *
     C                   ENDSR
      *
      ***********************************************
     C     SETCUR        BEGSR
      ***********************************************
     C   93              Z-ADD     13            LINNBR
     C   93              Z-ADD     32            POSNBR
     C   94              Z-ADD     13            LINNBR
     C   94              Z-ADD     12            POSNBR
     C   95              Z-ADD     9             LINNBR
     C   95              Z-ADD     22            POSNBR
     C   96              Z-ADD     8             LINNBR
     C   96              Z-ADD     32            POSNBR
     C   97              Z-ADD     8             LINNBR
     C   97              Z-ADD     12            POSNBR
     C   98              Z-ADD     4             LINNBR
     C   98              Z-ADD     22            POSNBR
     C   99              Z-ADD     2             LINNBR
     C   99              Z-ADD     15            POSNBR
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVW          BEGSR
      ***********************************************
     C                   MOVE      TVTKBM        WSTKBM
     C                   MOVEL     TVKREF        WSKREF
S01  C*                  MOVE      TVFGKD        WSFGKD
N01  C                   IF        %SUBST(TVFGKD:1:1) = ' '
N01  C                   EVAL      WSFGKD = %SUBST(TVFGKD:2:4)
N01  C                   ELSE
N01  C                   EVAL      WSFGKD = TVFGKD
N01  C                   END
     C                   MOVE      TVKNSS        WSKNSS
     C                   MOVE      TVTINSS       WSTINSS
     C                   MOVE      TVNASS        WSNASS
     C                   MOVE      TVADSS1       WSADSS1
     C                   MOVE      TVPNSS        WSPNSS
     C                   MOVE      TVPSSS        WSPSSS
     C                   MOVE      TVLKSS        WSLKSS
     C                   MOVE      TVSKSS        WSSKSS
     C                   MOVE      TVKNKS        WSKNKS
     C                   MOVE      TVTINKS       WSTINKS
     C                   MOVE      TVNAKS        WSNAKS
     C                   MOVE      TVADKS1       WSADKS1
     C                   MOVE      TVPNKS        WSPNKS
     C                   MOVE      TVPSKS        WSPSKS
     C                   MOVE      TVLKKS        WSLKKS
     C                   MOVE      TVSKKS        WSSKKS
      *
     C                   ENDSR
      *
      ***********************************************
     C     MOVTRV        BEGSR
      ***********************************************
     C                   MOVE      UAVD          TVAVD
     C                   MOVE      UTDN          TVTDN
     C                   MOVE      ULI           TVLI
     C                   MOVE      WSTKBM        TVTKBM
     C                   MOVEL     WSKREF        TVKREF
S01  C*                  MOVE      WSFGKD        TVFGKD
N01  C                   EVAL      TVFGKD = WSFGKD
     C                   MOVE      WSKNSS        TVKNSS
     C                   MOVE      WSTINSS       TVTINSS
     C                   MOVE      WSNASS        TVNASS
     C                   MOVE      WSADSS1       TVADSS1
     C                   MOVE      WSPNSS        TVPNSS
     C                   MOVE      WSPSSS        TVPSSS
     C                   MOVE      WSLKSS        TVLKSS
     C                   MOVE      WSSKSS        TVSKSS
     C                   MOVE      WSKNKS        TVKNKS
     C                   MOVE      WSTINKS       TVTINKS
     C                   MOVE      WSNAKS        TVNAKS
     C                   MOVE      WSADKS1       TVADKS1
     C                   MOVE      WSPNKS        TVPNKS
     C                   MOVE      WSPSKS        TVPSKS
     C                   MOVE      WSLKKS        TVLKKS
     C                   MOVE      WSSKKS        TVSKKS
      *
     C                   ENDSR
      *
     C***********************************************
     C     OPDTRV        BEGSR
     C***********************************************
     C     TRUVFVK       CHAIN     TRUVFV                             33
     C                   EXSR      MOVTRV
      *
     C   33              WRITE     TRUVFVR
     C  N33              UPDATE    TRUVFVR
      *
     C                   ENDSR
      *
      ***********************************************
     C     TESTSS        BEGSR
      ***********************************************
     C                   MOVE      WSKNSS        KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            98
     C                   IF        *IN98
     C  N30              MOVE      'SPK0001'     MSGNR
     C  N30              Z-ADD     4             LINNBR
     C  N30              Z-ADD     22            POSNBR
     C                   SETON                                        30
     C                   ELSE
     C                   MOVE      KNAVN         WSNASS
     C                   MOVE      ADR1          WSADSS1
     C     SYPOGE        IFEQ      *BLANKS
     C                   MOVE      *BLANKS       WSPNSS
     C                   MOVEL     POSTNR        WSPNSS
     C                   ELSE
     C                   MOVEL     SYPOGE        WSPNSS
     C                   END
     C                   MOVE      ADR3          WSPSSS
     C                   IF        SYLAND = *BLANKS
     C                   MOVE      'NO'          WSLKSS
     C                   ELSE
     C                   MOVE      SYLAND        WSLKSS
     C                   END
     C                   IF        WSTINSS = *BLANKS
     C                   IF        EORI = *BLANKS
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))
     C                   EVAL      WSTINSS = WSLKSS + SYFOR9
     C                   ELSE
     C                   EVAL      WSTINSS = *BLANKS
     C                   END
     C                   ELSE
     C                   EVAL      WSTINSS = EORI
     C                   END
     C                   END
     C                   END
      *
     C                   ENDSR
      *
      ***********************************************
     C     TESTKK        BEGSR
      ***********************************************
     C                   MOVE      WSKNKS        KUNDNR
     C     CUND1K        CHAIN     CUNDL01                            95
     C                   IF        *IN95
     C  N30              MOVE      'SPK0001'     MSGNR
     C  N30              Z-ADD     9             LINNBR
     C  N30              Z-ADD     22            POSNBR
     C                   SETON                                        30
     C                   ELSE
     C                   MOVE      KNAVN         WSNAKS
     C                   MOVE      ADR1          WSADKS1
     C     SYPOGE        IFEQ      *BLANKS
     C                   MOVE      *BLANKS       WSPNKS
     C                   MOVEL     POSTNR        WSPNKS
     C                   ELSE
     C                   MOVEL     SYPOGE        WSPNKS
     C                   END
     C                   MOVE      ADR3          WSPSKS
     C                   IF        SYLAND = *BLANKS
     C                   MOVE      'NO'          WSLKKS
     C                   ELSE
     C                   MOVE      SYLAND        WSLKKS
     C                   END
     C                   IF        WSTINKS = *BLANKS
     C                   IF        EORI = *BLANKS
     C                   IF        ((SYFOR9 <> *BLANKS) AND (SYFOR9 <> *ZEROS))
     C                   EVAL      WSTINKS = WSLKKS + SYFOR9
     C                   ELSE
     C                   EVAL      WSTINKS = *BLANKS
     C                   END
     C                   ELSE
     C                   EVAL      WSTINKS = EORI
     C                   END
     C                   END
     C                   END
      *
     C                   ENDSR
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     TRUVFVK       KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    ULI
     C     CUND1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C     KODS2K        KLIST
     C                   KFLD                    XS2UNI
     C                   KFLD                    KS2LK
     C     TRK01K        KLIST
     C                   KFLD                    YUNIK             3
     C                   KFLD                    YKODE            10
      *
     C     *ENTRY        PLIST
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    ULI
     C                   PARM                    UIN27             1
     C                   PARM                    UFLAGG            1 0
      *
     C                   MOVE      UIN27         *IN(27)
     C                   MOVE      'S2 '         XS2UNI            3
     C                   MOVE      'N'           USPED             1
      *
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
     C     TRUVFVK       CHAIN(N)  TRUVFV                             33
     C                   EXSR      MOVW
     C                   WRITE     WINDOWSZ
      *
     C                   ENDSR
      *
