********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 LES SADHEDI FØR VISNING PÅ SKJERMEN
10XXX * 02 YBC PTF10 TEST OM DCR FINNES PÅ LINJER
10319 * 03 YBC PTF10 FLERE ENDRET/NYE FELTER
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11055 * 04 YBC PTF11 GRUNNLAG MED 2 DESIMALER
11108 * 05 YBC PTF11 TAKLE OMBEREGNING
12XXX * 06 CB  PTF12 Endre hexverdi for logisk kolon
12281 * 07 YBC PTF12 4 SIFFER PROSEDYRE OG 2 SIFFER TRANSAKSJONSTYPE
********************************************************************
      *
      **************************************************************
      *** PROGRAM SKAL KOVENRTER UTGÅENDE TVINN-IMPORT           ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER       ***
      *** LEDIGE INDIKATORER 01 02 04-11 13 14 16-26             ***
      *** LEDIGE INDIKATORER 28-32 34-97                         ***
      **************************************************************
      *
     FEDIS      IF   E           K DISK
     FEDISE     IF   E           K DISK
     FSTANDI    IF   E           K DISK    PREFIX(STD_)
     FKODTSI    IF   E           K DISK
     FKODTSF    IF   E           K DISK
     FKODTSD    IF   E           K DISK
     FCUNDLFO   IF   E           K DISK
     FFIRM      IF   E           K DISK
     FSADHEDI   IF A E           K DISK
     FSADVEDI   IF A E           K DISK
     FSADFEDI   IF A E           K DISK
     FSAD016FM  CF   E             WORKSTN
     D                 DS
     D  FE                     1    256
     D                                     DIM(256)
     D  FELT                   1    256
     D                 DS
     D  AA                     1     80    DIM(80)
     D  AADS                   1     80
     D                 DS
     D  AB                     1     80    DIM(80)
     D  ABDS                   1     80
     D                 DS
     D  XAN14                  1     14
     D  XAN1411                1      4
     D  XAN1412                5      9
     D  XAN1413               10     12
     D  XAN1421               13     14
     D  XAN1422                5     11
     D  XAN1423               12     14
     D                 DS
     D  XAN08                  1      8
     D  XAN081                 8      8
     D  XAN0811                1      1
     D  XAN0812                2      6
     D  XAN0813                7      8
     D  XAN0822                1      5
     D  XAN0823                6      7
     D                 DS
     D  XAN11                  1     11
     D  XAN111                 9     11
     D                 DS
     D  XAN06                  1      6
     D  XT06                   1      6    DIM(6)
     D                 DS
     D  SIBEL3                 1     13  2
     D  SIBEL3H                1     11  0
     D  SIBEL3D1              12     12  0
     D  SIBEL3D2              13     13  0
     D                 DS
     D  SIBEL1                 1     11  2
     D  SIBEL1H                1      9  0
     D  SIBEL1D1              10     10  0
     D  SIBEL1D2              11     11  0
     D                 DS
     D  SIVKU                  1      7  3
     D  SIVKUH                 1      4  0
     D  SIVKUD1                5      5  0
     D  SIVKUD2                6      6  0
     D  SIVKUD3                7      7  0
     D                 DS
     D  SVBELT                 1     11  2
     D  SVBELTH                1      9  0
     D  SVBELTD1              10     10  0
     D  SVBELTD2              11     11  0
     D                 DS
     D  SVBELS                 1     11  2
     D  SVBELSH                1      9  0
     D  SVBELSD1              10     10  0
     D  SVBELSD2              11     11  0
     D                 DS
     D  SVBELR                 1     11  2
     D  SVBELRH                1      9  0
     D  SVBELRD1              10     10  0
     D  SVBELRD2              11     11  0
N04  D                 DS
N04  D  XGRLAG                 1     11  2
N04  D  XGRLAGH                1      9  0
N04  D  XGRLAGD1              10     10  0
N04  D  XGRLAGD2              11     11  0
     D                 DS
     D  XSATS                  1      7  2
     D  XSATSH                 1      5  0
     D  XSATSD1                6      6  0
     D  XSATSD2                7      7  0
     D                 DS
S03  D* MN                     1     85    DIM(5)
N03  D  MN                     1    119    DIM(7)
     D  SVMN1                  1     17
     D  SVMN2                 18     34
     D  SVMN3                 35     51
     D  SVMN4                 52     68
     D  SVMN5                 69     85
N03  D  SVMN6                 86    102
N03  D  SVMN7                103    119
     D                 DS
     D  AV1                    1     16    DIM(8)
     D  SVAV11                 1      2
     D  SVAV12                 3      4
     D  SVAV13                 5      6
     D  SVAV14                 7      8
     D  SVAV15                 9     10
     D  SVAV16                11     12
     D  SVAV17                13     14
     D  SVAV18                15     16
     D                 DS
     D  AV2                    1     24    DIM(8)
     D  SVAV21                 1      3
     D  SVAV22                 4      6
     D  SVAV23                 7      9
     D  SVAV24                10     12
     D  SVAV25                13     15
     D  SVAV26                16     18
     D  SVAV27                19     21
     D  SVAV28                22     24
     D                 DS
E04  D  AV3                    1     88  2 DIM(8)
E04  D  SVAV31                 1     11  2
E04  D  SVAV32                12     22  2
E04  D  SVAV33                23     33  2
E04  D  SVAV34                34     44  2
E04  D  SVAV35                45     55  2
E04  D  SVAV36                56     66  2
E04  D  SVAV37                67     77  2
E04  D  SVAV38                78     88  2
     D                 DS
     D  AV4                    1     56  2 DIM(8)
     D  SVAV41                 1      7  2
     D  SVAV42                 8     14  2
     D  SVAV43                15     21  2
     D  SVAV44                22     28  2
     D  SVAV45                29     35  2
     D  SVAV46                36     42  2
     D  SVAV47                43     49  2
     D  SVAV48                50     56  2
     D                 DS
     D  AV5                    1     88  0 DIM(8)
     D  SVAV51                 1     11  0
     D  SVAV52                12     22  0
     D  SVAV53                23     33  0
     D  SVAV54                34     44  0
     D  SVAV55                45     55  0
     D  SVAV56                56     66  0
     D  SVAV57                67     77  0
     D  SVAV58                78     88  0
     D                 DS
S03  D* DC1                    1     21    DIM(7)
N03  D  DC1                    1     45    DIM(15)
     D  SVDC11                 1      3
     D  SVDC12                 4      6
     D  SVDC13                 7      9
     D  SVDC14                10     12
     D  SVDC15                13     15
     D  SVDC16                16     18
     D  SVDC17                19     21
N03  D  SVDC18                22     24
N03  D  SVDC19                25     27
N03  D  SVDC110               28     30
N03  D  SVDC111               31     33
N03  D  SVDC112               34     36
N03  D  SVDC113               37     39
N03  D  SVDC114               40     42
N03  D  SVDC115               43     45
     D                 DS
S03  D* DC2                    1    119    DIM(7)
N03  D  DC2                    1    255    DIM(15)
     D  SVDC21                 1     17
     D  SVDC22                18     34
     D  SVDC23                35     51
     D  SVDC24                52     68
     D  SVDC25                69     85
     D  SVDC26                86    102
     D  SVDC27               103    119
N03  D  SVDC28               120    136
N03  D  SVDC29               137    153
N03  D  SVDC210              154    170
N03  D  SVDC211              171    187
N03  D  SVDC212              188    204
N03  D  SVDC213              205    221
N03  D  SVDC214              222    238
N03  D  SVDC215              239    255
     D                 DS
S03  D* VB                     1     75    DIM(5)
S03  D* SVVB1                  1     15
S03  D* SVVB2                 16     30
S03  D* SVVB3                 31     45
S03  D* SVVB4                 46     60
S03  D* SVVB5                 61     75
N03  D  VB                     1    150    DIM(5)
N03  D  SVVB1                  1     30
N03  D  SVVB2                 31     60
N03  D  SVVB3                 61     90
N03  D  SVVB4                 91    120
N03  D  SVVB5                121    150
     D                 DS
S03  D* TT1                    1     16    DIM(8)
N03  D  TT1                    1     32    DIM(16)
     D  SITKD1                 1      2
     D  SITKD2                 3      4
     D  SITKD3                 5      6
     D  SITKD4                 7      8
     D  SITKD5                 9     10
     D  SITKD6                11     12
     D  SITKD7                13     14
     D  SITKD8                15     16
N03  D  SITKD9                17     18
N03  D  SITKD10               19     20
N03  D  SITKD11               21     22
N03  D  SITKD12               23     24
N03  D  SITKD13               25     26
N03  D  SITKD14               27     28
N03  D  SITKD15               29     30
N03  D  SITKD16               31     32
     D                 DS
S03  D* TT2                    1     88  0 DIM(8)
N03  D  TT2                    1    176  0 DIM(16)
     D  SITAV1                 1     11  0
     D  SITAV2                12     22  0
     D  SITAV3                23     33  0
     D  SITAV4                34     44  0
     D  SITAV5                45     55  0
     D  SITAV6                56     66  0
     D  SITAV7                67     77  0
     D  SITAV8                78     88  0
N03  D  SITAV9                89     99  0
N03  D  SITAV10              100    110  0
N03  D  SITAV11              111    121  0
N03  D  SITAV12              122    132  0
N03  D  SITAV13              133    143  0
N03  D  SITAV14              144    154  0
N03  D  SITAV15              155    165  0
N03  D  SITAV16              166    176  0
N05  D                 DS
N05  D  FT                     1    350    DIM(5)
N05  D  SIFT01                 1     70
N05  D  SIFT02                71    140
N05  D  SIFT03               141    210
N05  D  SIFT04               211    280
N05  D  SIFT05               281    350
      *
     C                   EXSR      INIT
     C   LR              GOTO      SLUTT
      *
     C                   EXSR      SRKVT
N01  C     SADHEDIK      CHAIN     SADHEDI                            33
     C     SIFID         COMP      99999999                               27
      *
     C     START         TAG
     C                   EXFMT     BILDE
      *
     C   03
     COR 12              GOTO      SLUTT
      *
     C                   IF        *IN15
     C                   CALL      'SAD016B'
     C                   PARM                    SIAVD
     C                   PARM                    SITDN
     C                   GOTO      START
     C                   END
      *
     C                   CALL      'SAD016A'
     C                   PARM                    SIAVD
     C                   PARM                    SITDN
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        CABEQ     1             START
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
      ***********************************************
     C     SRKVT         BEGSR
      ***********************************************
     C     SEGSTA        TAG
     C  NLR              EXSR      GETSEG
     C   LR              GOTO      SLSRKVT
     C     SEGNAM        CASEQ     'UNB'         SRUNB
     C     SEGNAM        CASEQ     'UNH'         SRUNH
     C     SEGNAM        CASEQ     'UNZ'         SRUNZ
     C                   END
     C                   GOTO      SEGSTA
      *
     C     SLSRKVT       ENDSR
      *
      *__________________________________________________________
     C* SR for å hente UNBdata - (NodiID.)                 SRUNB
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRUNB         BEGSR
      *
      *
     C                   ENDSR
      *
      *__________________________________________________________
     C* SR for å hente UNZdata                             SRUNZ
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRUNZ         BEGSR
      *
      *
     C                   ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle UNH-segmentet                    SRUNH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRUNH         BEGSR
     C                   CLEAR                   SADHEDIR
      * LES AVDELING OG OPPDRAGSNR
     C                   MOVE      *BLANKS       FE
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDUNH
     C                   IF        TEGN = LOGPLU
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C     UNH010        TAG
     C                   MOVEL     FELT          XAN14
      *
     C                   MOVE      XAN1411       SIAVD
     C                   IF        XAN1421 = *BLANKS
     C                   MOVE      XAN1412       SITDN
     C                   MOVE      XAN1413       SISG
     C                   ELSE
     C                   MOVE      XAN1422       SITDN
     C                   MOVE      XAN1423       SISG
     C                   END
      *
     C                   IF        ((XAVD <> SIAVD) OR (XTDN <> SITDN))
     C                   GOTO      ENDUNH
     C                   END
      *
     C                   EXSR      GETSEG
     C     SIAVD         CHAIN     STANDI                             33
      *
      *
     C                   EXSR      SRBGMH
     C                   EXSR      SRCSTH
     C                   EXSR      SRRFFH
     C                   EXSR      SRDTMH
     C                   EXSR      SRLOCH
      *
     C                   IF        SEGNAM = 'TDT'
     C                   EXSR      SRTDTH
     C                   EXSR      SRGISH
     C                   END
      *
     C                   EXSR      SRNADH
     C                   EXSR      SRCTAH
      *
     C                   IF        SEGNAM = 'TOD'
     C                   EXSR      SRTODH
N05  C                   IF        *IN39
N05  C                   EXSR      SRFTXH
N05  C                   END
     C                   EXSR      SRMOAH
     C                   EXSR      SRCUXH
     C                   END
      *
     C                   EXSR      SRUNSH
     C                   IF        SEGNAM = 'DMS'
     C                   EXSR      SRDMSH
     C                   END
      *
     C                   DOW       SEGNAM = 'CST'
     C                   CLEAR                   SADVEDIR
     C                   EVAL      SVAVD = SIAVD
     C                   EVAL      SVTDN = SITDN
     C                   EXSR      SRCSTV
     C                   IF        SEGNAM = 'PAC'
     C                   EXSR      SRPACV
     C                   EXSR      SRPCIV
     C                   END
     C                   EXSR      SRLOCV
     C                   IF        SEGNAM = 'MOA'
     C                   EXSR      SRMOAV
     C                   END
     C                   EXSR      SRMEAV
     C                   IF        SEGNAM = 'TAX'
     C                   EXSR      SRTAXV
     C                   END
N02  C                   IF        SEGNAM = 'DCR'
     C                   EXSR      SRDCRV
N02  C                   END
     C                   EXSR      SRGDSV
     C                   EXSR      SRFTXV
     C                   WRITE     SADVEDIR
     C                   ENDDO
      *
N03  C                   EXSR      SRUNSV
     C                   IF        SEGNAM = 'TAX'
     C                   EXSR      SRTAXT
     C                   END
      *
S03  C*                  EXSR      SRUNSV
      *
     C                   EXSR      SRCNTT
      *
     C                   IF        SIRG <> *BLANKS
     C                   EVAL      SYRG   = SIRG
     C     CUNDLFOK      CHAIN     CUNDLFO                            33
     C                   IF        *IN33 = *OFF
     C                   EVAL      SIKNK  = KUNDNR
     C                   EVAL      SINAK  = KNAVN
     C                   EVAL      SIADK1 = ADR1
     C                   EVAL      SIADK2 = ADR2
     C                   IF        POSTNR = 0
     C                   MOVEL     ADR3          SIADK3
     C                   ELSE
     C                   MOVEL     POSTNR        SIADK3
     C                   MOVE      ADR3          SIADK3
     C                   END
     C                   END
     C                   END
     C                   WRITE     SADHEDIR
      *
     C     ENDUNH        ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle BGM-segmentet                   SRBGMH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRBGMH        BEGSR
      * LES 3 '+'
     C                   DO        3
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDBGMH
     C                   ENDDO
     C                   ENDDO
      * LES MELDINGSTYPE
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDBGMH
     C                   IF        ((TEGN = LOGPLU) OR (TEGN = LOGAPP))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          XAN03             3
      *
     C                   SELECT
     C                   WHEN      XAN03 = '9'
     C                   MOVE      'DFU'         SI1225
     C                   MOVEL     'FULLSTENDIG 'SI1225T
     C                   WHEN      XAN03 = 'ZZ'
     C                   MOVE      'DMA'         SI1225
     C                   MOVEL     'MANUELL     'SI1225T
     C                   WHEN      XAN03 = '14'
     C                   MOVE      'DFO'         SI1225
     C                   MOVEL     'FORELØPIG   'SI1225T
     C                   WHEN      XAN03 = '2'
     C                   MOVE      'DEN'         SI1225
     C                   MOVEL     'ENDELIG     'SI1225T
     C                   WHEN      XAN03 = '4'
     C                   MOVE      'DKO'         SI1225
     C                   MOVEL     'KORRIGERING 'SI1225T
S05  C*                  WHEN      XAN03 = '18'
S05  C*                  MOVE      'DOM'         SI1225
S05  C*                  MOVEL     'OMREGNING   'SI1225T
N05  C                   WHEN      XAN03 = '43'
N05  C                   MOVE      'DSO'         SI1225
N05  C                   MOVEL     'STA. OPPRET.'SI1225T
N05  C                   WHEN      XAN03 = '18'
N05  C                   MOVE      'DEB'         SI1225
N05  C                   MOVEL     'ETTERBEREGN.'SI1225T
N05  C                   WHEN      XAN03 = '19'
N05  C                   MOVE      'DRE'         SI1225
N05  C                   MOVEL     'REFUSJON    'SI1225T
     C                   ENDSL
N05   *
N05   * OMBEREGNING
N05  C                   IF        XAN03 = '43' OR XAN03 = '18' OR XAN03 = '19'
N05   * LES FORBI TO +
N05  C     1             DO        2
N05  C                   DOW       TEGN <> LOGPLU
N05  C                   EXSR      GETCH
N05  C   LR              GOTO      ENDBGMH
N05  C                   ENDDO
N05  C                   ENDDO
N05   * LES FORBI :
N05  C                   DOW       TEGN <> LOGKOL
N05  C                   EXSR      GETCH
N05  C   LR              GOTO      ENDBGMH
N05  C                   ENDDO
N05   *
N05  C                   MOVE      *BLANKS       FE
N05  C     1             DO        20            NR
N05  C                   EXSR      GETCH
N05  C   LR              GOTO      ENDBGMH
N05  C                   IF        TEGN = LOGAPP
N05  C                   LEAVE
N05  C                   END
N05  C                   MOVE      TEGN          FE(NR)
N05  C                   ENDDO
N05  C                   MOVEL     FELT          SITLL
N05  C                   EVAL      *IN39 = *ON
N05  C                   END
      *
     C                   EXSR      GETSEG
      *
     C     ENDBGMH       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle CST-segmentet                   SRCSTH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRCSTH        BEGSR
      * LES FORBI '+'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTH
     C                   ENDDO
      * LES DEKLARASJONSTYPE EU/EX
     C                   MOVE      *BLANKS       FE
     C     1             DO        2             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTH
     C                   IF        TEGN = LOGKOL
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          SIDTY
      * LES FORBI '+'
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTH
     C                   ENDDO
      * LES TRANSAKSJONSTYPE
     C                   MOVE      *BLANKS       FE
     C     1             DO        2             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTH
     C                   IF        TEGN = LOGKOL
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
S07  C*                  MOVEL     FELT          SITST
N07  C                   IF        %SUBST(FELT:2:1) = ' '
N07  C                   MOVEL     FELT          XAN01             1
N07  C                   MOVE      XAN01         SITST
N07  C                   ELSE
N07  C                   MOVEL     FELT          XAN02             2
N07  C                   MOVE      XAN02         SITST
N07  C                   END
N05   *
N05   * OMBEREGNING
N05  C                   IF        *IN39
N05   * LES FORBI +
N05  C                   DOW       TEGN <> LOGPLU
N05  C                   EXSR      GETCH
N05  C   LR              GOTO      ENDCSTH
N05  C                   ENDDO
N05   * TYPE
N05  C                   MOVE      *BLANKS       FE
N05  C     1             DO        4             NR
N05  C                   EXSR      GETCH
N05  C   LR              GOTO      ENDCSTH
N05  C                   IF        TEGN = LOGAPP
N05  C                   LEAVE
N05  C                   END
N05  C                   MOVE      TEGN          FE(NR)
N05  C                   ENDDO
N05  C                   MOVEL     FELT          SITYPE
N05  C                   END
      *
     C                   EXSR      GETSEG
      *
     C     ENDCSTH       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle RFF-segmentet                   SRRFFH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRRFFH        BEGSR
     C     STSRRFFH      TAG
      * LES KODE
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDRFFH
     C                   IF        TEGN = LOGKOL
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          XAN03             3
      * LES REF
     C                   MOVE      *BLANKS       FE
     C     1             DO        35            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDRFFH
     C                   IF        (((TEGN = LOGAPP) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGKOL))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          XAN35            35
      *
     C                   SELECT
     C                   WHEN      XAN03 = 'VA'
     C                   MOVEL     XAN35         SIRG
     C                   WHEN      XAN03 = 'CO'
     C                   MOVEL     XAN35         SIKT
     C                   WHEN      XAN03 = 'XC'
     C                   MOVEL     XAN35         SIGN
     C                   WHEN      XAN03 = 'LAR'
     C                   MOVEL     XAN35         SIPOS
     C                   ENDSL
      *
     C                   EXSR      GETSEG
     C     SEGNAM        CABEQ     'RFF'         STSRRFFH
      *
     C     ENDRFFH       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle LOC-segmentet                   SRLOCH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRLOCH        BEGSR
     C     STSRLOCH      TAG
      * LES KODE
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDLOCH
     C                   IF        TEGN = LOGKOL
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          XAN02             2
      * LES LOKASJON
     C                   MOVE      *BLANKS       FE
     C     1             DO        35            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDLOCH
     C                   IF        (((TEGN = LOGAPP) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGKOL))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          XAN35            35
      *
     C                   SELECT
     C                   WHEN      XAN02 = '35'
     C                   MOVEL     XAN35         SILKA
     C                   WHEN      XAN02 = '14'
     C                   MOVEL     XAN35         SIKDLS
     C     SIKDLS        CHAIN     KODTSD                             33
     C  N33              EVAL      SILS = KSDTXT
     C                   ENDSL
      *
     C                   EXSR      GETSEG
     C     SEGNAM        CABEQ     'LOC'         STSRLOCH
      *
     C     ENDLOCH       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle DTM-segmentet                   SRDTMH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRDTMH        BEGSR
      *
     C                   ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle TDT-segmentet                   SRTDTH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRTDTH        BEGSR
      * LES FORBI 2 '+'
     C                   DO        2
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTDTH
     C                   ENDDO
     C                   ENDDO
      * LES TRANSPORTMÅTE
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTDTH
     C                   IF        ((TEGN = LOGPLU) OR (TEGN = LOGAPP))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          SITRM
      *
      * LES TRANSPORTMIDDELS LANDKODE
     C                   IF        TEGN = LOGPLU
      * LES FORBI 5 ':'
     C                   DO        5
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTDTH
     C                   ENDDO
     C                   ENDDO
      *
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTDTH
     C                   IF        (((TEGN = LOGAPP) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGKOL))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          SILKT
     C                   END
      *
     C                   EXSR      GETSEG
      *
     C     ENDTDTH       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle GIS-segmentet                   SRGISH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRGISH        BEGSR
      * LES CONTAINERKODE
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDGISH
     C                   IF        (((TEGN = LOGKOL) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGAPP))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          SIKDC
      *
     C                   EXSR      GETSEG
      *
     C     ENDGISH       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle NAD-segmentet                   SRNADH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRNADH        BEGSR
     C     STSRNADH      TAG
      *
      *
     C                   MOVE      *BLANKS       XKN              35
     C                   MOVE      *BLANKS       XNA              35
     C                   MOVE      *BLANKS       XAD1             35
     C                   MOVE      *BLANKS       XAD2             35
     C                   MOVE      *BLANKS       XAD3             35
      * LES KODE
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDNADH
     C                   IF        TEGN = LOGPLU
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          XAN02             2
      * LES FIRMAS ORGANISASJONSNR
     C                   MOVE      *BLANKS       FE
     C     1             DO        35            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDNADH
     C                   IF        (((TEGN = LOGAPP) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGKOL))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          XKN
     C     TEGN          CABEQ     LOGAPP        SLSRNADH
      *
     C                   DOW       ((TEGN <> LOGPLU) AND (TEGN <> LOGAPP))
     C                   EXSR      GETCH
     C   LR              GOTO      ENDNADH
     C                   ENDDO
     C     TEGN          CABEQ     LOGAPP        SLSRNADH
      * LES NAVN
     C                   MOVE      *BLANKS       FE
     C     1             DO        40            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDNADH
     C                   IF        (((TEGN = LOGAPP) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGKOL))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          XNA
     C     TEGN          CABEQ     LOGAPP        SLSRNADH
     C     TEGN          CABEQ     LOGPLU        SLSRNADH
      * LES ADR1
     C                   MOVE      *BLANKS       FE
     C     1             DO        36            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDNADH
     C                   IF        (((TEGN = LOGAPP) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGKOL))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          XAD1
     C     TEGN          CABEQ     LOGPLU        SLSRNADH
     C     TEGN          CABEQ     LOGAPP        SLSRNADH
      * LES ADR2
     C                   MOVE      *BLANKS       FE
     C     1             DO        36            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDNADH
     C                   IF        (((TEGN = LOGAPP) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGKOL))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          XAD2
     C     TEGN          CABEQ     LOGPLU        SLSRNADH
     C     TEGN          CABEQ     LOGAPP        SLSRNADH
      * LES ADR3
     C                   MOVE      *BLANKS       FE
     C     1             DO        36            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDNADH
     C                   IF        (((TEGN = LOGAPP) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGKOL))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          XAD3
      *
     C     SLSRNADH      TAG
     C                   SELECT
      *
     C                   WHEN      XAN02 = 'IM'
     C                   IF        XKN <> *BLANKS
     C                   MOVEL     XKN           XAN11
     C                   IF        XAN111 = *BLANKS
     C                   MOVEL     XAN11         SIKT
     C                   ELSE
     C                   MOVEL     XAN11         SIRG
     C                   END
     C                   END
     C                   MOVEL     XNA           SINAK
     C                   MOVEL     XAD1          SIADK1
     C                   MOVEL     XAD2          SIADK2
     C                   MOVEL     XAD3          SIADK3
      *
     C                   WHEN      XAN02 = 'SE'
     C                   MOVEL     XNA           SINAS
     C                   MOVEL     XAD1          SIADS1
     C                   MOVEL     XAD2          SIADS2
     C                   MOVEL     XAD3          SIADS3
      *
     C                   WHEN      XAN02 = 'DT'
     C                   MOVE      STD_SITLF     SITLF
     C                   MOVE      STD_SINAD     SINAD
      *
     C                   WHEN      XAN02 = 'AA'
     C                   MOVEL     XKN           SIKDDK
      *
     C                   WHEN      XAN02 = 'EE'
     C                   MOVEL     XKN           XAN06
     C                   MOVE      *ZEROS        S3039E
     C     1             DO        6             XN                3 0
     C                   IF        ((XT06(XN) >= '0') AND (XT06(XN) <= '9'))
     C                   MULT      10            S3039E
     C                   MOVE      XT06(XN)      S3039E
     C                   END
     C                   ENDDO
      *
     C                   ENDSL
      *
     C                   EXSR      GETSEG
     C     SEGNAM        CABEQ     'NAD'         STSRNADH
      *
     C     ENDNADH       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle CTA-segmentet                   SRCTAH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRCTAH        BEGSR
      * LES FORBI '+'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCTAH
     C                   ENDDO
      * LES SINATUR
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCTAH
     C                   IF        ((TEGN = LOGPLU) OR (TEGN = LOGAPP))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          SISG
      *
     C     KODTSIK       CHAIN     KODTSI                             33
     C                   IF        *IN33
     C     KODTSFK       CHAIN     KODTSF                             33
     C                   IF        *IN33
     C                   MOVE      *BLANKS       SITARF
     C                   ELSE
     C                   MOVE      KOSFNV        SITARF
     C                   END
     C                   ELSE
     C                   MOVE      KSINAV        SITARF
     C                   END
      *
     C                   EXSR      GETSEG
      *
     C     ENDCTAH       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle TOD-segmentet                   SRTODH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRTODH        BEGSR
      * LES FORBI 2 '+'
     C                   DO        2
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTODH
     C                   ENDDO
     C                   ENDDO
      * LES LEVERINGSBETINGELSE
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTODH
     C                   IF        ((TEGN = LOGPLU) OR (TEGN = LOGAPP))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          SILV
      * LES FORBI 4 ':'
     C                   DO        4
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTODH
     C                   ENDDO
     C                   ENDDO
      * LES TEKST
     C                   MOVE      *BLANKS       FE
     C     1             DO        35            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTODH
     C                   IF        ((TEGN = LOGPLU) OR (TEGN = LOGAPP))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          SILVT
      *
     C                   EXSR      GETSEG
      *
     C     ENDTODH       ENDSR
      *
N05   *__________________________________________________________
N05  C* SR for å behandle FTX-segmentet                   SRFTXH
N05   *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
N05  C     SRFTXH        BEGSR
N05   * LES FORBI 3 '+'
N05  C                   DO        3
N05  C                   MOVE      *BLANKS       TEGN
N05  C                   DOW       TEGN <> LOGPLU
N05  C                   EXSR      GETCH
N05  C   LR              GOTO      ENDFTXH
N05  C                   ENDDO
N05  C                   ENDDO
N05   * LES BEGRUNNELSE
N05  C                   MOVE      *BLANKS       FE
N05  C                   MOVE      *BLANKS       FT
N05  C     1             DO        5             NR2               3 0
N05   * LES TEKST
N05  C                   MOVE      *BLANKS       FE
N05  C     1             DO        71            NR
N05  C                   EXSR      GETCH
N05  C   LR              GOTO      ENDFTXH
N05  C                   IF        TEGN = LOGKOL OR TEGN = LOGAPP
N05  C                   LEAVE
N05  C                   END
N05  C                   MOVE      TEGN          FE(NR)
N05  C                   END
N05  C                   MOVEL     FELT          FT(NR2)
N05  C                   IF        TEGN = LOGAPP
N05  C                   LEAVE
N05  C                   END
N05  C                   ENDDO
N05   *
N05  C                   EXSR      GETSEG
N05   *
N05  C     ENDFTXH       ENDSR
N05   *
      *__________________________________________________________
     C* SR for å behandle MOA-segmentet                   SRMOAH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRMOAH        BEGSR
      * LES FORBI ':'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMOAH
     C                   ENDDO
      * LES FAKTURASUM
     C                   MOVE      *ZEROS        SIBEL3
     C     1             DO        20            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMOAH
     C                   IF        ((((TEGN = LOGKOL) OR
     C                                (TEGN = LOGPLU)) OR
     C                                (TEGN = LOGAPP)) OR
     C                                (TEGN = ','))
     C                   LEAVE
     C                   END
     C                   MULT      10            SIBEL3H
     C                   MOVE      TEGN          SIBEL3H
     C                   ENDDO
      *
     C                   IF        TEGN = ','
     C                   EXSR      GETCH
     C                   MOVE      TEGN          SIBEL3D1
     C                   EXSR      GETCH
     C                   IF        TEGN <> LOGKOL
     C                   MOVE      TEGN          SIBEL3D2
     C                   EXSR      GETCH
     C                   END
     C                   END
      * LES VALUTAKODE
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMOAH
     C                   IF        ((TEGN = LOGPLU) OR (TEGN = LOGAPP))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          SIVAL3
      *
     C                   EXSR      GETSEG
     C     SEGNAM        CABNE     'MOA'         ENDMOAH
      *
      * FRAKT
      * LES FORBI ':'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMOAH
     C                   ENDDO
      * LES FRAKT
     C                   MOVE      *ZEROS        SIBEL1
     C     1             DO        20            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMOAH
     C                   IF        ((((TEGN = LOGKOL) OR
     C                                (TEGN = LOGPLU)) OR
     C                                (TEGN = LOGAPP)) OR
     C                                (TEGN = ','))
     C                   LEAVE
     C                   END
     C                   MULT      10            SIBEL1H
     C                   MOVE      TEGN          SIBEL1H
     C                   ENDDO
      *
     C                   IF        TEGN = ','
     C                   EXSR      GETCH
     C                   MOVE      TEGN          SIBEL1D1
     C                   EXSR      GETCH
     C                   IF        TEGN <> LOGKOL
     C                   MOVE      TEGN          SIBEL1D2
     C                   EXSR      GETCH
     C                   END
     C                   END
      *
     C                   EXSR      GETSEG
      *
     C     ENDMOAH       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle CUX-segmentet                   SRCUXH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRCUXH        BEGSR
      * LES FORBI 2 '+'
     C                   DO        2
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCUXH
     C                   ENDDO
     C                   ENDDO
      * LES KURS
     C                   MOVE      *ZEROS        SIVKU
     C     1             DO        20            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCUXH
     C                   IF        ((((TEGN = LOGKOL) OR
     C                                (TEGN = LOGPLU)) OR
     C                                (TEGN = LOGAPP)) OR
     C                                (TEGN = ','))
     C                   LEAVE
     C                   END
     C                   MULT      10            SIVKUH
     C                   MOVE      TEGN          SIVKUH
     C                   ENDDO
      *
     C                   IF        TEGN = ','
     C                   EXSR      GETCH
     C                   MOVE      TEGN          SIVKUD1
     C                   EXSR      GETCH
     C                   IF        TEGN <> LOGAPP
     C                   MOVE      TEGN          SIVKUD2
     C                   EXSR      GETCH
     C                   IF        TEGN <> LOGAPP
     C                   MOVE      TEGN          SIVKUD3
     C                   EXSR      GETCH
     C                   END
     C                   END
     C                   END
      *
     C                   EXSR      GETSEG
      *
     C     ENDCUXH       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle UNS-segmentet                   SRUNSH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRUNSH        BEGSR
      *
     C                   EXSR      GETSEG
      *
     C                   ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle DMS-segmentet                   SRDMSH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRDMSH        BEGSR
      *
     C                   EVAL      SFAVD  = SIAVD
     C                   EVAL      SFOPDN = SITDN
     C                   MOVE      *BLANKS       SIFIF
     C                   MOVE      *ZEROS        SIFID
     C     STSRDMSH      TAG
      * LES FAKTURANR
     C                   MOVE      *BLANKS       FE
     C     1             DO        35            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDDMSH
     C                   IF        TEGN = LOGPLU
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
      *
     C                   SELECT
     C                   WHEN      SIFID = 0
     C                   MOVEL     FELT          SIFIF
     C                   WHEN      SIFID = 99999999
     C                   MOVEL     FELT          SFTXT
     C                   OTHER
     C                   MOVEL     SIFIF         SFTXT
     C                   MOVEL     SIFID         SFDT
     C                   WRITE     SADFEDIR
     C                   MOVEL     FELT          SFTXT
     C                   EVAL      SIFID = 99999999
     C                   EVAL      SIFIF = 'F15  ER  BENYTTET'
     C                   ENDSL
      * LES FORBI ':'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDDMSH
     C                   ENDDO
      * LES DATO
     C                   MOVE      *BLANKS       XN08              8 0
     C     1             DO        10            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDDMSH
     C                   IF        (((TEGN = LOGAPP) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGKOL))
     C                   LEAVE
     C                   END
     C                   MULT      10            XN08
     C                   MOVE      TEGN          XN08
     C                   ENDDO
      *
     C                   IF        SIFID = 0
     C                   MOVE      XN08          SIFID
     C                   ELSE
     C                   MOVEL     XN08          SFDT
     C                   WRITE     SADFEDIR
     C                   END
      *
     C                   EXSR      GETSEG
     C     SEGNAM        CABEQ     'DMS'         STSRDMSH
      *
     C     ENDDMSH       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle CST-segmentet                   SRCSTV
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRCSTV        BEGSR
      *
     C                   MOVE      *ZEROS        SVLI
      * LES LINJENR
     C     1             DO        10            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTV
     C                   IF        (((TEGN = LOGAPP) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGKOL))
     C                   LEAVE
     C                   END
     C                   MULT      10            SVLI
     C                   MOVE      TEGN          SVLI
     C                   ENDDO
      * LES TARIFFNR
     C                   MOVE      *BLANKS       FE
     C     1             DO        35            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTV
     C                   IF        TEGN = LOGKOL
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          SVVNT
      * LES FORBI '+'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTV
     C                   ENDDO
      * LES PROSEDYRE
S07  C*                  MOVE      *BLANKS       XN02              2 0
S07  C*    1             DO        3             NR
N07  C                   MOVE      *ZEROS        XN04              4 0
N07  C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTV
     C                   IF        (((TEGN = LOGAPP) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGKOL))
     C                   LEAVE
     C                   END
S07  C*                  MULT      10            XN02
S07  C*                  MOVE      TEGN          XN02
N07  C                   MULT      10            XN04
N07  C                   MOVE      TEGN          XN04
     C                   ENDDO
S07  C*                  MOVE      XN02          SIDP
N07  C                   IF        XN04 < 100
N07  C                   MOVE      XN04          SIDP
N07  C                   MOVE      *ZEROS        SIDP2
N07  C                   ELSE
N07  C                   MOVEL     XN04          SIDP
N07  C                   MOVE      XN04          SIDP2
N07  C                   END
      * LES FORBI '+'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTV
     C                   ENDDO
      * LES PREFERANSE
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTV
     C                   IF        TEGN = LOGKOL
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          SVPRE
      * LES FORBI '+'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTV
     C                   ENDDO
      * LES VERDI FASTSETTELSE
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTV
     C                   IF        TEGN = LOGKOL
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          SVVF
      * LES FORBI '+'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       ((TEGN <> LOGPLU) AND (TEGN <> LOGAPP))
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTV
     C                   ENDDO
     C     TEGN          CABEQ     LOGAPP        SLSRCSTV
      * LES TOLLNEDSETTELSE
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCSTV
     C                   IF        TEGN = LOGKOL
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          SVTN
      *
     C     SLSRCSTV      TAG
     C                   EXSR      GETSEG
      *
     C     ENDCSTV       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle PAC-segmentet                   SRPACV
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRPACV        BEGSR
      *
     C                   MOVE      *ZEROS        SVNT
      * LES ANTALL
     C     1             DO        10            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDPACV
     C                   IF        (((TEGN = LOGAPP) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGKOL))
     C                   LEAVE
     C                   END
     C                   MULT      10            SVNT
     C                   MOVE      TEGN          SVNT
     C                   ENDDO
      * LES FORBI '+'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDPACV
     C                   ENDDO
      * LES ENHETSKODE
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDPACV
     C                   IF        TEGN = LOGAPP
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          SVEH
      *
     C                   EXSR      GETSEG
      *
     C     ENDPACV       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle PCI-segmentet                   SRPCIV
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRPCIV        BEGSR
      *
      * LES FORBI '+'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDPCIV
     C                   ENDDO
      * LES MERKE & NR
     C                   MOVE      *BLANKS       MN
     C                   MOVE      *ZEROS        XN                3 0
     C     STSRPCIV      TAG
     C                   MOVE      *BLANKS       FE
     C     1             DO        18            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDPCIV
     C                   IF        (((TEGN = LOGKOL) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGAPP))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   IF        FELT <> *BLANKS
     C                   IF        XN = 0
     C                   IF        ((SVEH = 'U.NR') OR (SVEH = 'U-NR'))
     C                   ADD       1             XN
     C                   END
     C                   END
     C                   ADD       1             XN
     C                   MOVEL     FELT          MN(XN)
     C     TEGN          CABEQ     LOGKOL        STSRPCIV
     C                   END
      *
     C                   IF        TEGN = LOGPLU
      * LES FORBI ':'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDPCIV
     C                   ENDDO
      * LES BIL UNDERST.NR
     C                   MOVE      *BLANKS       FE
     C     1             DO        18            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDPCIV
     C                   IF        TEGN = LOGAPP
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          MN(1)
      *
     C                   END
      *
     C                   EXSR      GETSEG
      *
     C     ENDPCIV       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle LOC-segmentet                   SRLOCV
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRLOCV        BEGSR
      *
      * LES FORBI ':'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDLOCV
     C                   ENDDO
      * LES OPPRINGELSESLAND
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDLOCV
     C                   IF        TEGN = LOGAPP
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          SVLK
      *
     C                   EXSR      GETSEG
      *
     C     ENDLOCV       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle MOA-segmentet                   SRMOAV
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRMOAV        BEGSR
      *
      * LES FORBI ':'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMOAV
     C                   ENDDO
      * LES STATISTISK VERDI
     C                   MOVE      *ZEROS        SVBELS
     C                   MOVE      *BLANKS       FE
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMOAV
     C                   IF        (((TEGN = LOGPLU) OR
     C                               (TEGN = LOGAPP)) OR
     C                               (TEGN = ','))
     C                   LEAVE
     C                   END
     C                   MULT      10            SVBELSH
     C                   MOVE      TEGN          SVBELSH
     C                   ENDDO
     C     TEGN          CABEQ     LOGPLU        STSRMOAV1
     C     TEGN          CABEQ     LOGAPP        SLSRMOAV
      *
     C                   IF        TEGN = ','
     C                   EXSR      GETCH
     C                   MOVE      TEGN          SVBELSD1
     C                   EXSR      GETCH
     C                   IF        ((TEGN >= '0') AND (TEGN <= '9'))
     C                   MOVE      TEGN          SVBELSD2
     C                   EXSR      GETCH
     C                   END
     C                   END
     C     TEGN          CABEQ     LOGAPP        SLSRMOAV
      *
     C     STSRMOAV1     TAG
      * LES KODE FOR JUSTERING
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMOAV
     C                   IF        TEGN = LOGKOL
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          XAN03             3
     C     TEGN          CABEQ     LOGPLU        STSRMOAV2
     C     TEGN          CABEQ     LOGAPP        SLSRMOAV
      *
      * LES JUSTERINGS VERDI
     C                   MOVE      *ZEROS        SVBELT
     C                   MOVE      *BLANKS       FE
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMOAV
     C                   IF        (((TEGN = LOGPLU) OR
     C                               (TEGN = LOGAPP)) OR
     C                               (TEGN = ','))
     C                   LEAVE
     C                   END
     C                   MULT      10            SVBELTH
     C                   MOVE      TEGN          SVBELTH
     C                   ENDDO
     C     TEGN          CABEQ     LOGPLU        STSRMOAV2
     C     TEGN          CABEQ     LOGAPP        SLSRMOAV
      *
     C                   IF        TEGN = ','
     C                   EXSR      GETCH
     C                   MOVE      TEGN          SVBELTD1
     C                   EXSR      GETCH
     C                   IF        ((TEGN >= '0') AND (TEGN <= '9'))
     C                   MOVE      TEGN          SVBELTD2
     C                   EXSR      GETCH
     C                   END
     C                   END
      *
     C                   IF        XAN03 = '21'
     C                   Z-SUB     SVBELT        SVBELT
     C     TEGN          CABEQ     LOGAPP        SLSRMOAV
      *
     C     STSRMOAV2     TAG
      * LES FORBI ':'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMOAV
     C                   ENDDO
      *
      * LES BEARBEDINGSKOSTNAD
     C                   MOVE      *ZEROS        SVBELR
     C                   MOVE      *BLANKS       FE
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMOAV
     C                   IF        (((TEGN = LOGPLU) OR
     C                               (TEGN = LOGAPP)) OR
     C                               (TEGN = ','))
     C                   LEAVE
     C                   END
     C                   MULT      10            SVBELRH
     C                   MOVE      TEGN          SVBELRH
     C                   ENDDO
     C     TEGN          CABEQ     LOGAPP        SLSRMOAV
      *
     C                   IF        TEGN = ','
     C                   EXSR      GETCH
     C                   MOVE      TEGN          SVBELRD1
     C                   EXSR      GETCH
     C                   IF        ((TEGN >= '0') AND (TEGN <= '9'))
     C                   MOVE      TEGN          SVBELRD2
     C                   EXSR      GETCH
     C                   END
     C                   END
      *
     C                   END
      *
     C     SLSRMOAV      TAG
     C                   EXSR      GETSEG
      *
     C     ENDMOAV       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle MEA-segmentet                   SRMEAV
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRMEAV        BEGSR
     C                   MOVE      *ZEROS        SVVKTB
     C                   MOVE      *ZEROS        SVVKTN
     C                   MOVE      *ZEROS        SVNTM
      *
     C     STSRMEAV      TAG
      * LES FORBI '+'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMEAV
     C                   ENDDO
      * LES KODE
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMEAV
     C                   IF        TEGN = LOGPLU
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          XAN02             2
      * LES FORBI ':'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMEAV
     C                   ENDDO
      * LES TALL
     C                   MOVE      *ZEROS        XN09              9 0
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDMEAV
     C                   IF        ((TEGN = LOGPLU) OR (TEGN = LOGAPP))
     C                   LEAVE
     C                   END
     C                   MULT      10            XN09
     C                   MOVE      TEGN          XN09
     C                   ENDDO
      *
     C                   SELECT
     C                   WHEN      XAN02 = 'G'
     C                   EVAL      SVVKTB = XN09
     C                   WHEN      XAN02 = 'N'
     C                   EVAL      SVVKTN = XN09
     C                   WHEN      XAN02 = 'ZZ'
     C                   EVAL      SVNTM  = XN09
     C                   ENDSL
      *
     C     SLSRMEAV      TAG
     C                   EXSR      GETSEG
     C     SEGNAM        CABEQ     'MEA'         STSRMEAV
      *
     C     ENDMEAV       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle TAX-segmentet                   SRTAXV
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRTAXV        BEGSR
     C                   MOVE      *BLANKS       AV1
     C                   MOVE      *BLANKS       AV2
     C                   MOVE      *ZEROS        AV3
     C                   MOVE      *ZEROS        AV4
     C                   MOVE      *ZEROS        AV5
     C                   MOVE      *ZEROS        XN
      *
     C     STSRTAXV      TAG
     C                   ADD       1             XN
      * LES FORBI ':'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTAXV
     C                   ENDDO
      * LES BELØP
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTAXV
     C                   IF        TEGN = LOGPLU
     C                   LEAVE
     C                   END
     C                   MULT      10            AV5(XN)
     C                   MOVE      TEGN          AV5(XN)
     C                   ENDDO
     C     TEGN          CABEQ     LOGAPP        SLSRTAXV
      * LES AVGIFTKODE
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTAXV
     C                   IF        TEGN = LOGKOL
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          AV1(XN)
     C     TEGN          CABEQ     LOGAPP        SLSRTAXV
      * LES FORBI '+'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTAXV
     C                   ENDDO
      * LES SEKVENSNR
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTAXV
     C                   IF        TEGN = LOGKOL
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          AV2(XN)
     C     TEGN          CABEQ     LOGAPP        SLSRTAXV
      * LES FORBI '+'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTAXV
     C                   ENDDO
      * LES GRUNNLAG
N04  C                   MOVE      *ZEROS        XGRLAG
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTAXV
S04  C*                  IF        TEGN = LOGPLU
N04  C                   IF        TEGN = LOGPLU OR TEGN = ','
     C                   LEAVE
     C                   END
S04  C*                  MULT      10            AV3(XN)
S04  C*                  MOVE      TEGN          AV3(XN)
N04  C                   MULT      10            XGRLAGH
N04  C                   MOVE      TEGN          XGRLAGH
     C                   ENDDO
N04   *
N04  C                   IF        TEGN = ','
N04  C                   EXSR      GETCH
N04  C                   MOVE      TEGN          XGRLAGD1
N04  C                   EXSR      GETCH
N04  C                   IF        TEGN >= '0' AND TEGN <= '9'
N04  C                   MOVE      TEGN          XGRLAGD2
N04  C                   EXSR      GETCH
N04  C                   END
N04  C                   END
N04  C                   Z-ADD     XGRLAG        AV3(XN)
     C     TEGN          CABEQ     LOGAPP        SLSRTAXV
      *
      * LES SATS
     C                   MOVE      *ZEROS        XSATS
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTAXV
     C                   IF        ((TEGN = LOGAPP) OR (TEGN = ','))
     C                   LEAVE
     C                   END
     C                   MULT      10            XSATSH
     C                   MOVE      TEGN          XSATSH
     C                   ENDDO
      *
     C                   IF        TEGN = ','
     C                   EXSR      GETCH
     C                   MOVE      TEGN          XSATSD1
     C                   EXSR      GETCH
     C                   IF        ((TEGN >= '0') AND (TEGN <= '9'))
     C                   MOVE      TEGN          XSATSD2
     C                   EXSR      GETCH
     C                   END
     C                   END
     C                   Z-ADD     XSATS         AV4(XN)
      *
     C     SLSRTAXV      TAG
     C                   EXSR      GETSEG
     C     SEGNAM        CABEQ     'TAX'         STSRTAXV
      *
     C     ENDTAXV       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle DCR-segmentet                   SRDCRV
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRDCRV        BEGSR
     C                   MOVE      *BLANKS       DC1
     C                   MOVE      *BLANKS       DC2
     C                   MOVE      *ZEROS        XN
      *
     C     STSRDCRV      TAG
     C                   ADD       1             XN
      * LES FORBI '+'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDDCRV
     C                   ENDDO
      * LES DOKUMENTKODE
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDDCRV
     C                   IF        TEGN = LOGKOL
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          DC1(XN)
      * LES DOKUMENTREF.
     C                   MOVE      *BLANKS       FE
     C     1             DO        18            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDDCRV
     C                   IF        TEGN = LOGAPP
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          DC2(XN)
      *
     C                   EXSR      GETSEG
     C     SEGNAM        CABEQ     'DCR'         STSRDCRV
      *
     C     ENDDCRV       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle GDS-segmentet                   SRGDSV
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRGDSV        BEGSR
      *
     C                   EXSR      GETSEG
      *
     C                   ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle FTX-segmentet                   SRFTXV
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRFTXV        BEGSR
     C                   MOVE      *BLANKS       VB
     C                   MOVE      *ZEROS        XN
      *
     C     STSRFTXV      TAG
      * LES FORBI 3 '+'
     C                   DO        3
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGPLU
     C                   EXSR      GETCH
     C   LR              GOTO      ENDFTXV
     C                   ENDDO
     C                   ENDDO
      * LES VAREBESKRIVELSE
     C     STSRFTXV2     TAG
     C                   MOVE      *BLANKS       FE
     C     1             DO        35            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDFTXV
     C                   IF        (((TEGN = LOGKOL) OR
     C                               (TEGN = LOGPLU)) OR
     C                               (TEGN = LOGAPP))
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   ADD       1             XN
     C                   MOVEL     FELT          VB(XN)
     C     TEGN          CABEQ     LOGKOL        STSRFTXV2
      *
     C                   EXSR      GETSEG
     C     SEGNAM        CABEQ     'FTX'         STSRFTXV
      *
     C     ENDFTXV       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle UNS-segmentet                   SRUNSV
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRUNSV        BEGSR
      *
     C                   EXSR      GETSEG
      *
     C                   ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle TAX-segmentet                   SRTAXT
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRTAXT        BEGSR
      * LES FORBI ':'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTAXT
     C                   ENDDO
      * LES TOTAL AVGIFT
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTAXT
S03  C*                  IF        TEGN = LOGPLU
N03  C                   IF        TEGN = LOGPLU OR TEGN = LOGAPP
     C                   LEAVE
     C                   END
     C                   MULT      10            SITOTA
     C                   MOVE      TEGN          SITOTA
     C                   ENDDO
     C                   EXSR      GETSEG
     C     SEGNAM        CABNE     'TAX'         ENDTAXT
      *
     C                   MOVE      *BLANKS       TT1
     C                   MOVE      *ZEROS        TT2
     C                   MOVE      *ZEROS        XN
     C     STSRTAXT      TAG
     C                   ADD       1             XN
      * LES FORBI ':'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTAXT
     C                   ENDDO
      * LES BELØP
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTAXT
     C                   IF        TEGN = LOGPLU
     C                   LEAVE
     C                   END
     C                   MULT      10            TT2(XN)
     C                   MOVE      TEGN          TT2(XN)
     C                   ENDDO
     C     TEGN          CABEQ     LOGAPP        SLSRTAXT
      * LES AVGIFTKODE
     C                   MOVE      *BLANKS       FE
     C     1             DO        5             NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDTAXT
     C                   IF        TEGN = LOGKOL
     C                   LEAVE
     C                   END
     C                   MOVE      TEGN          FE(NR)
     C                   ENDDO
     C                   MOVEL     FELT          TT1(XN)
      *
     C     SLSRTAXT      TAG
     C                   EXSR      GETSEG
     C     SEGNAM        CABEQ     'TAX'         STSRTAXT
      *
     C     ENDTAXT       ENDSR
      *
      *__________________________________________________________
     C* SR for å behandle CNT-segmentet                   SRCNTT
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRCNTT        BEGSR
      * LES FORBI ':'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCNTT
     C                   ENDDO
      * LES TOTAL LINJER
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCNTT
     C                   IF        TEGN = LOGPLU
     C                   LEAVE
     C                   END
     C                   MULT      10            SITOTL
     C                   MOVE      TEGN          SITOTL
     C                   ENDDO
      *
      * LES FORBI ':'
     C                   MOVE      *BLANKS       TEGN
     C                   DOW       TEGN <> LOGKOL
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCNTT
     C                   ENDDO
      * LES TOTAL KOLLI
     C     1             DO        15            NR
     C                   EXSR      GETCH
     C   LR              GOTO      ENDCNTT
     C                   IF        ((TEGN = LOGPLU) OR (TEGN = LOGAPP))
     C                   LEAVE
     C                   END
     C                   MULT      10            SINTK
     C                   MOVE      TEGN          SINTK
     C                   ENDDO
      *
     C                   EXSR      GETSEG
      *
     C     ENDCNTT       ENDSR
      *
      *__________________________________________________________
     C* SR for å hente neste tegn i datastroem             GETCH
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     GETCH         BEGSR
      * Rutinen henter "TEGN" fra array AA. Ved slutten av AA "toemmes" AB inn
      * i AA. (AB benyttes kun for alltid å kunne ha "lookahead-tegn" - LOKAHE)
      * LR settes når en ved "Toemming" finner at AB-arrayet er tomt.
      *
      * "?" spises av SR når "?" kun varsler grafisk betydning av spesialtegn.
      *Når tegn ved utgang av SR er ',+ eller :  er betydningen av ind. 98 :
      *    98 ON -> kun grafisk betydning (uforandret)
      *    98 OFF-> spesialtegn (Bytt tegn mot ikke lesbar logisk verdi LOG???)
     C                   SETOFF                                           98
     C     STACH         TAG
      * Må ny record hentes inn i array AA (fra AB)?????
     C     TN            IFEQ      81
     C     EOF           IFEQ      'YES'
     C                   SETON                                            LR
     C                   GOTO      ENDCH
     C                   END
     C                   MOVE      ABDS          AADS
     C  N99SMBR          READE     EDISE                                  99     *hent ny til AB
     C  N99              MOVE      SDATA         ABDS
     C   99              MOVE      *BLANKS       ABDS
     C   99              MOVE      'YES'         EOF                             * FLAGG FOR EOF
     C                   Z-ADD     1             TN                              * Tegn-index-nr
     C                   END
     C* Hent det tegn som TN peker på - Tegnet etter er "Lookahead"
     C                   MOVE      AA(TN)        TEGN
     C                   ADD       1             TN
     C     TN            IFLE      80
     C                   MOVE      AA(TN)        LOKAHE            1
     C                   ELSE
     C                   MOVE      AB(1)         LOKAHE
     C                   END
     C                   SELECT
     C     TEGN          WHENEQ    X'47'                                        å
     C                   MOVE      X'D0'         TEGN
     C     TEGN          WHENEQ    X'9F'                                        Å
     C                   MOVE      X'5B'         TEGN
     C     TEGN          WHENEQ    X'BB'                                        ø
     C                   MOVE      X'6A'         TEGN
     C     TEGN          WHENEQ    X'E0'                                        Ø
     C                   MOVE      X'7C'         TEGN
     C     TEGN          WHENEQ    X'9C'                                        æ
     C                   MOVE      X'C0'         TEGN
     C     TEGN          WHENEQ    X'9E'                                        Æ
     C                   MOVE      X'7B'         TEGN
     C                   ENDSL
      * Dersom TEGN er "?" og LOKAHE er spes.tegn - "spis" spoersmålstegnet
      * Når 98 er on her betyr det at "?" foran spesialtegn alt er "spist"
      *        evt. nytt "?" er da grafisk tegn - LOKAHE skal da IKKE testes.
     C  N98TEGN          IFEQ      GRASPØ
     C     LOKAHE        COMP      GRAAPP                                 98
     C  N98LOKAHE        COMP      GRAPLU                                 98
     C  N98LOKAHE        COMP      GRAKOL                                 98
     C  N98LOKAHE        COMP      GRASPØ                                 98
     C   98              GOTO      STACH
     C                   END
      * Ved N98 og ',+ eller : i TEGN betyr det at det IKKE var opphevelsestegn
      * foran. Vi har med andre ord et LOGISK SPESIALTEN INNE
     C  N98TEGN          IFEQ      GRAAPP
     C                   MOVE      LOGAPP        TEGN
     C                   ELSE
     C     TEGN          IFEQ      GRAPLU
     C                   MOVE      LOGPLU        TEGN
     C                   ELSE
     C     TEGN          IFEQ      GRAKOL
     C                   MOVE      LOGKOL        TEGN
     C                   ELSE
     C     TEGN          IFEQ      LOGBLA
     C                   MOVE      ' '           TEGN
     C                   END
     C                   END
     C                   END
     C                   END
      *
     C     ENDCH         ENDSR
      *
      *__________________________________________________________
     C* SR for å hente neste Segment                       GETSEG
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     GETSEG        BEGSR
      * "Spis tegn" til appostrof er lest
     C     TEGN          DOWNE     LOGAPP
     C                   EXSR      GETCH
     C   LR              GOTO      ENDSEG
     C                   END
      * Har nå lest appostrof - de 3 neste vil være SEGMENTNAVN
     C                   MOVE      *BLANKS       FE
     C     1             DO        3             NR                3 0
     C                   EXSR      GETCH
     C   LR              GOTO      ENDSEG
     C                   MOVE      TEGN          FE(NR)
     C                   END
     C                   MOVEL     FELT          SEGNAM
      * La TEGN være '+' etter segmentnavnet ved utgang av SR
     C                   EXSR      GETCH
      * Segmentnavn returneres nå i variabel 'SEGNAM'
     C     ENDSEG        ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
N01  C     SADHEDIK      KLIST
N01  C                   KFLD                    XAVD
N01  C                   KFLD                    XTDN
     C     KODTSIK       KLIST
     C                   KFLD                    KSIUNI
     C                   KFLD                    SISG
     C                   MOVE      'SI'          KSIUNI
     C     KODTSFK       KLIST
     C                   KFLD                    KOSFUN
     C                   KFLD                    SISG
     C                   MOVE      'SF'          KOSFUN
     C     CUNDLFOK      KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    SYRG
      *
     C     *ENTRY        PLIST
     C                   PARM                    UAVD              4
     C                   PARM                    UTDN              7
     C                   PARM                    USN               9
      *
     C                   MOVE      UAVD          XAVD              4 0
     C                   MOVE      UTDN          XTDN              7 0
     C                   MOVE      USN           SSN
     C     SSN           CHAIN     EDIS                               33
      *
     C     SMBR          SETLL     EDISE
     C     SMBR          READE     EDISE                                  LR
     C   LR              GOTO      ENDINI
     C                   MOVE      SDATA         ABDS
      *
     C                   Z-ADD     81            TN                2 0
     C                   MOVE      'NO '         EOF               3             * FLAGG FOR EOF
     C                   MOVE      ' '           TEGN              1
     C                   MOVE      ' '           LOKAHE            1
     C                   MOVE      *BLANKS       SEGNAM            3            Segment navn
      *
      * Spesielt reserverte tegn defineres her med både grafisk verdi og
      * med en logisk verdi. Den grafiske verdien testes det mot i rutinen
      * som henter tegn. Finner denne rutinen at at tegnet er ment som en
      * spesialverdi (ikke ? foran), byttes tegnet med tilsvarende LOGISK VERDI
      * (De logiske verdiene er ikke lesbre tegn,og vil aldri forekomme i den
      * innkommende datastroemmen). '?' når brukt som opphevelse foran annet
      * spesialtegn vil bli "spist" av henterutinen (GETCH) og en vil derfor
      * kunne betrakte spoersmålstegn som grafisk tegn i resten av programmet.
      *
      * Ved andre standarder for spesialtegn er det bare å bytte verdiene til
      * de GRAFISKE tegnene her. (Programmet arbeider da med riktige verdier).
     C                   MOVE      '?'           GRASPØ            1
     C                   MOVE      '+'           GRAPLU            1
     C                   MOVE      ':'           GRAKOL            1
     C                   BITON     '123457'      GRAAPP            1
     C                   BITOFF    '06'          GRAAPP
      * Logiske verdier for spesialtegn
      * LOGAPP = slutt på segmentet. I NODI er tegnet "'".
     C                   BITON     '17'          LOGAPP            1
     C                   BITOFF    '023456'      LOGAPP
      * HVIS KOMMUNEDATA, INITIERE MED LOGAPP (GÅ RETT PÅ UNB)
     C                   MOVE      LOGAPP        TEGN
      * LOGPLU = sparasjonstegn for Tag/dataelement. I NODI er tegnet "+".
     C                   BITON     '16'          LOGPLU            1
     C                   BITOFF    '023457'      LOGPLU
      * LOGKOL = sparasjonstegn for delelement. I NODI er tegnet ":".
     C                   BITON     '167'         LOGKOL            1
     C                   BITOFF    '02345'       LOGKOL
N06  C                   EVAL      LOGKOL=X'33'
      * LOGBLA = utenlandske måten å vise blank.
     C                   BITON     '01234567'    LOGBLA            1
      *
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
      *
     C     ENDINI        ENDSR
      *
