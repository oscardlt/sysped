***** **************************************************************
      * Program henter arkivlenke til fraktbrev
      * Program "arvet" fra BHR - ren standard
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 JOV PTF12 FEILMELDING DERSOM......
12XXX * 02 sh  PTF12 historisk arkiv
********************************************************************
     Farkivl02  IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FARKTXT    IF   E           K DISK
     FARKEXT    IF   E           K DISK
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
     c     *entry        Plist
     c                   parm                    aravd
     c                   parm                    aropd
     c                   parm                    UPDF            500
     c                   parm                    ardate
     c                   parm                    artime
      * UPDF BENYTTES OGSÅ SOM IN-PARAM - ZS ELLER ZP... / URL
      *
     C     ARKEXTK       KLIST
     C                   KFLD                    ARFIRM
     C                   KFLD                    ARCEXT
     C     arkivkeyS     KLIST
     C                   KFLD                    ARSTAT
     C                   KFLD                    ARAVD
     C                   KFLD                    AROPD
     C                   KFLD                    ARTYPE
     c                   move      'A'           ARSTAT
     c                   move      'ZP'          ARTYPE
      *
S01  C*    UPDF          Ifne      *blanks
N01  C                   If        %subst(UPDF:1:2) <> *blanks
     c                   movel     UPDF          ARTYPE
     C                   end
N01  C                   If        %subst(UPDF:3:6) = 'KUNURL'
N01  c                   movel     'J'           KUNURL            1
N01  C                   end
     c                   move      *blanks       UPDF
     c     arkivkeyS     setll     arkivl02
     c     arkivkeyS     reade     arkivl02                               40
     c  N40              exsr      fraktbrev
     C                   SETON                                        LR
     C                   RETURN
      *
     C***********************************************
     C     FRAKTBREV     BEGSR
     C***********************************************
     c     artype        chain     arktxt                             33
     C                   MOVE      ARKLAG        ARCEXT
     C     ARKEXTK       CHAIN     ARKEXT                             33
     C   33ARFIRM        CHAIN     FIRMARC                            33
N02  c     arbhis        ifne      *blanks
N02  c                   eval      arcane=arbhis
N02  c                   end
     C* genererer bane for lagring
N01  c                   if        KunURL='J'
N01  C                   eval      UPDF='http://'+%trim(arcpae)+'/'
N01  c                             +%trim(arcane)+'/'
N01  c                             +%trim(ArLink)
N01  c                   goto      UtFrBr
N01  c                   endif
      *
     C                   MOVE      ARAVD         AAVD              4
     C                   MOVE      AROPD         AOPD              5
     C                   move      *blanks       UPDF
     c                   movel     '<a href="'   UPDF
     C     UPDF          CAT       '/':0         UPDF
     C     UPDF          CAT       arcane:0      UPDF
     C     UPDF          CAT       '/':0         UPDF
     C     ARLINK        IFNE      *Blanks
     C     UPDF          CAT       ArLink:0      UPDF
     c                   else
     C     UPDF          CAT       aavd:0        UPDF
     C     UPDF          CAT       aopd:0        UPDF
     C     UPDF          CAT       artype:0      UPDF
     C     UPDF          CAT       arunde:0      UPDF
     c                   end
      * scannede dokument inneholder extention som del av filnavn..
     C     ArType        ifeq      'sb'
     C     UPDF          CAT       '.pdf">':0    UPDF
     c                   else
     C     UPDF          CAT       '">':0        UPDF
     c                   end
     c                   select
     c     ARTYPE        wheneq    'ZP'
     C     UPDF          CAT       'Se kvitter':0UPDF
     C     UPDF          CAT       't fr.brev.':0UPDF
     c     ARTYPE        wheneq    'ZS'
     C     UPDF          CAT       'Se origina':0UPDF
     C     UPDF          CAT       'lt fr.brev':0UPDF
     c     ARTYPE        wheneq    'sb'
     C     UPDF          CAT       'Se utstedt':0UPDF
     C     UPDF          CAT       ' fr.brev  ':0UPDF
     c                   other
     C*...
     c                   endsl
     C     UPDF          CAT       '<img src="':0UPDF
     C     UPDF          CAT       '/syspeddev':0UPDF
     C     UPDF          CAT       '/PDF.gif">':0UPDF
     C*...
      * det kan være mer enn ett POD-brev (dellevering / nødbrev... )
     c     ARTYPE        IFEQ      'ZP'
      *
     c                   movel     ARLINK        GMLINK           40
     c                   z-add     1             ZPnr              1 0
     c     arkivkeyS     reade     arkivl02                               40
     c     *IN40         doweq     '0'
     c     ARLINK        cabeq     GMLINK        Duplikat
     c                   add       1             ZPnr
     c                   move      ZPnr          ZPnrA             1
     c     UPDF          CAT       Spaces:0      UPDF
     c     UPDF          CAT       ZPNRA:0       UPDF
     c     UPDF          CAT       '&nbsp;':0    UPDF
     c     UPDF          CAT       '<a href="':0 UPDF
     C     UPDF          CAT       '/':0         UPDF
     C     UPDF          CAT       arcane:0      UPDF
     C     UPDF          CAT       '/':0         UPDF
     C     UPDF          CAT       ArLink:0      UPDF
     C     UPDF          CAT       '">':0        UPDF
      *
     C     UPDF          CAT       '<img src="':0UPDF
     C     UPDF          CAT       '/syspeddev':0UPDF
     C     UPDF          CAT       '/PDF.gif">':0UPDF
     c                   movel     ARLINK        GMLINK           40
     c     duplikat      tag
     c     arkivkeyS     reade     arkivl02                               40
     c                   end
      *
     c                   end
N01  c     UtFrBr        tag
     c                   endsr
      *
