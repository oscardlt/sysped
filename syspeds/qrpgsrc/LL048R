      *
      ***********************************************************
      *** PROGRAM SKAL OPPDATERE LAGER ETTER OPPTELLING       ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      ***********************************************************
      *
     FLLLTLL01  UF   E           K DISK
     FLLVARE01  UF   E           K DISK
     FLLAGJD01  IF A E           K DISK
     FLLAGJL01  UF   E           K DISK
     D                SDS
     D  ZJOB                 244    253
     D  ZUSER                254    263
     D  ZJOBNR               264    269  0
     D                 DS
     D XTXT01          C                   CONST('LAGEROPPTELLING')
     D                 DS
     D  WTIME                  1     14  0
     D  WTM                    1      6  0
     D  WDD                    7      8  0
     D  WMM                    9     10  0
     D  W≈≈                   11     14  0
     D                 DS
     D  DATO                   1      8  0
     D  DT≈                    1      4  0
     D  DTM                    5      6  0
     D  DTD                    7      8  0
      *
     C                   EXSR      INIT
      *
     C     LTLKEY        SETLL     LLLTLL01
     C     LTLKEY        READE     LLLTLL01                               33
     C     *IN33         DOWEQ     '0'                                          1<-B
     C     LTSTAT        IFNE      'J'                                           2<-B
     C     LTDIFF        ANDNE     0
     C     AGJKEY        CHAIN(N)  LLAGJL01                           34
     C                   IF        VASALD < LTDIFF
     C                   Z-ADD     1             UFLAGG
     C                   LEAVE
     C                   END
      *
      * OPPDATER LAGERJOURNAL-DETALJ
     C                   EXSR      OPDAGD
      * OPPDATER NY SALDO P≈ ARTIKKEL-FIL
     C     LLVARK        CHAIN     LLVARE01                           34
     C                   SUB       LTDIFF        LVSALD
     C                   UPDATE    LLVARER
      * OPPDATER LAGERJOURNAL-FIL
     C                   EXSR      OPDAGF
      *
     C                   END                                                     2<-E
      *
     C                   MOVE      'J'           LTSTAT
     C                   EXCEPT    NYSTAT
     C     LTLKEY        READE     LLLTLL01                               33
     C  N33              END                                                    1<-E
      *
     C                   SETON                                        LR
     C                   RETURN
      *
     C***********************************************
     C     OPDAGF        BEGSR
     C***********************************************
     C     AGJKEY        CHAIN     LLAGJL01                           34
     C                   SUB       LTDIFF        VASALD
     C     LTDIFF        IFLT      0                                            1<-B
     C                   SUB       LTDIFF        VASAE0
     C                   ELSE                                                   1
      * STK
     C     STAGF1        TAG
     C     VASAE0        IFNE      0                                             2<-B
     C     VASAE0        IFGE      LTDIFF                                         3<-B
     C                   SUB       LTDIFF        VASAE0
     C                   MOVE      *ZEROS        LTDIFF
     C                   ELSE                                                     3
     C                   SUB       VASAE0        LTDIFF
     C                   MOVE      *ZEROS        VASAE0
     C                   END                                                      3<-E
     C                   END                                                     2<-E
      * EKSE
     C     STAGF2        TAG
     C     VASAE1        IFNE      0                                             2<-B
     C     LTDIFF        ANDNE     0
     C     VAAN01        IFEQ      0
     C                   Z-ADD     1             UFLAGG
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END
     C                   Z-ADD     VAAN01        VASAE0
     C                   SUB       1             VASAE1
     C                   GOTO      STAGF1
     C                   END                                                     2<-E
      * KARTONG
     C     STAGF3        TAG
     C     VASAE2        IFNE      0                                             2<-B
     C     LTDIFF        ANDNE     0
     C     VAAN01        IFEQ      0                                              3<-B
     C     VAAN02        IFEQ      0
     C                   Z-ADD     2             UFLAGG
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END
     C                   Z-ADD     VAAN02        VASAE0
     C                   SUB       1             VASAE2
     C                   GOTO      STAGF1
     C                   ELSE                                                     3
     C     VAAN12        IFEQ      0
     C                   Z-ADD     2             UFLAGG
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END
     C                   Z-ADD     VAAN12        VASAE1
     C                   SUB       1             VASAE2
     C                   GOTO      STAGF2
     C                   END                                                      3<-E
     C                   END                                                     2<-E
      * PALL
     C     LTDIFF        IFNE      0                                             2<-B
     C                   SELECT                                                   3<-B
     C     VAAN01        WHENEQ    0
     C     VAAN02        ANDEQ     0
     C     VAAN03        IFEQ      0
     C                   Z-ADD     3             UFLAGG
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END
     C                   Z-ADD     VAAN03        VASAE0
     C                   SUB       1             VASAE3
     C                   GOTO      STAGF1
     C     VAAN02        WHENEQ    0
     C     VAAN23        IFEQ      0
     C                   Z-ADD     3             UFLAGG
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END
     C                   Z-ADD     VAAN23        VASAE1
     C                   SUB       1             VASAE3
     C                   GOTO      STAGF2
     C                   OTHER
     C     VAAN23        IFEQ      0
     C                   Z-ADD     3             UFLAGG
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C                   END
     C                   Z-ADD     VAAN23        VASAE2
     C                   SUB       1             VASAE3
     C                   GOTO      STAGF3
     C                   ENDSL                                                    3<-E
     C                   END                                                     2<-E
      *
     C                   END                                                    1<-E
      *
     C                   UPDATE    LLAGJR
      *
     C                   ENDSR
      *
     C***********************************************
     C     OPDAGD        BEGSR
     C***********************************************
     C                   MOVE      999           VDVN
     C     AGDKEY        SETLL     LLAGJD01
     C     AGJKEY        READPE    LLAGJD01                               33
     C     *IN33         IFEQ      '1'
     C                   MOVE      UGRUP         VDGRUP
     C                   MOVE      UKJED         VDKJED
     C                   MOVE      LTMN          VDMN
     C                   MOVE      *ZEROS        VDVN
     C                   END
     C                   ADD       1             VDVN
      *
     C                   MOVE      *ZEROS        VDMNL
     C                   MOVE      *ZEROS        VDVNL
     C                   MOVE      LTLTDT        VDLDAT
     C                   MOVE      LTDIFF        VDLANT
     C                   MOVE      LTDIFF        VDSAE0
     C                   MOVE      *ZEROS        VDSAE1
     C                   MOVE      *ZEROS        VDSAE2
     C                   MOVE      *ZEROS        VDSAE3
     C                   MOVE      *BLANKS       VDTEXT
     C                   MOVEL     XTXT01        VDTEXT
     C                   MOVE      'LAGOT'       VDLTYP
     C                   MOVE      ' '           VDST
     C                   MOVE      *ZEROS        VDDAGE
     C                   MOVE      *ZEROS        VDAVD
     C                   MOVE      *ZEROS        VDOPD
     C                   MOVE      *ZEROS        VDFBNR
     C                   MOVE      ZUSER         VDBUSE
     C                   Z-ADD     DATO          VDBDAT
     C                   Z-ADD     WTM           VDBKL
     C                   WRITE     LLAGJDR
      *
     C                   ENDSR
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    UGRUP             8 0
     C                   PARM                    UKJED             8 0
     C                   PARM                    ULNR              7 0
     C                   PARM                    UFLAGG            1 0
     C                   MOVE      *ZEROS        UFLAGG
      *
     C     LTLKEY        KLIST
     C                   KFLD                    UGRUP
     C                   KFLD                    UKJED
     C                   KFLD                    ULNR
     C     AGJKEY        KLIST
     C                   KFLD                    UGRUP
     C                   KFLD                    UKJED
     C                   KFLD                    LTMN
     C     AGDKEY        KLIST
     C                   KFLD                    UGRUP
     C                   KFLD                    UKJED
     C                   KFLD                    LTMN
     C                   KFLD                    VDVN
     C     LLVARK        KLIST
     C                   KFLD                    UGRUP
     C                   KFLD                    UKJED
     C                   KFLD                    LTANR
      *
      *
     C                   TIME                    WTIME
     C                   MOVE      WDD           DTD
     C                   MOVE      WMM           DTM
     C                   MOVE      W≈≈           DT≈
      *
     C                   ENDSR
      *
     OLLLTLR    E            NYSTAT
     O                       LTSTAT
