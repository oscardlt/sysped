********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 SØK KUN EN KUNDE AV GANGEN
********************************************************************
      *
      ************************************************************
      *** FLYTTE RATER TIL JUSTERINGSSSYSTEM                   ***
      ************************************************************
      *
     FCUNDL01   IF   E           K DISK
     FSTED2     IF   E           K DISK
     FFRATN     IF   E           K DISK
     FFRATNWRK  UF A E           K DISK    RENAME(FRATR:FRATRWRK)
     FFIRM      IF   E           K DISK
E01  FSYSA50FM  CF   E             WORKSTN INFDS(FBAREA)
N01  D FBAREA          DS
N01  D  WSCLOC               370    371B 0
N01  D  WSSUBN               378    379B 0
     D                 DS
     D  WAGEDA                 1      6  0
     D  WAGED                  1      2  0
     D  WAGEM                  3      4  0
     D  WAGEÅ                  5      6  0
     D                 DS
     D  WAGED2                 1      8  0
     D  WAGE2Å                 1      4  0
     D  WAGE2M                 5      6  0
     D  WAGE2D                 7      8  0
      *
     C                   EXSR      INIT
     C*
     C     START         TAG
     C                   EXSR      KDTFMT
     C                   EXFMT     BILDE
     C                   EXSR      KDTFMT
     C                   SETOFF                                       30
     C*
     C   03              GOTO      SLUTT
     C   04              DO
     C                   EXSR      SØKKUN
     C                   GOTO      START
     C                   END
      *
     C                   EXSR      TESTB
     C   30              GOTO      START
     C*
     C   05
     CANN87              EXSR      FLYTT
     C   05
     CAN 87              EXSR      DEL
     C*
     C                   GOTO      START
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C******************************************
     C     TESTB         BEGSR
     C******************************************
     C*
     C*
     C*
     C*
     C*  Only customer no...
     C*  Only customer no...
     C     WAFRKU        IFNE      99999999
     C     WAFRKU        ANDNE     0
     C     KUND1K        CHAIN     CUNDL01                            92
     C   92              MOVE      'SPK0001'     MSGNR
     C   92              SETON                                        30
     C   92              GOTO      SLTB
     C                   END
     C* From destination
     C     WAFRFR        IFNE      '*ALL '
     C     WAFRFR        CHAIN     STED2                              94
     C   94              MOVE      'SPS0012'     MSGNR
     C   94              SETON                                        30
     C   94              GOTO      SLTB
     C                   END
     C*
     C* To - destination
     C     WAFRTI        IFNE      '*ALL '
     C     WAFRTI        CHAIN     STED2                              93
     C   93              MOVE      'SPS0013'     MSGNR
     C   93              SETON                                        30
     C   93              GOTO      SLTB
     C                   END
     C*
     C*
     C* Expire date
     C     WAGEDA        IFNE      0
     C                   MOVE      WAGEÅ         UÅÅ               2 0
     C                   MOVE      WAGEM         UMM               2 0
     C                   MOVE      WAGED         UDD               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      89
     C   89              MOVE      'SPD0001'     MSGNR
     C   89              SETON                                        30
     C   89              GOTO      SLTB
     C                   END
     C*
     C*
     C     SLTB          ENDSR
     C*
      *
     C***********************************************
     C     SØKKUN        BEGSR
     C***********************************************
S01  C*                  CALL      'SOEKUN'
S01  C*                  PARM                    FIFIRM
S01  C*                  PARM                    SOANTK
S01  C*                  PARM                    SOTXT1
S01  C*                  PARM                    WAFRKU
S01  C*                  PARM                    SOTXT2
S01  C*                  PARM                    WAFRKU
S01  C*                  PARM                    SOTXT3
S01  C*                  PARM                    SOKNR3
S01  C*                  PARM                    SOTXT4
S01  C*                  PARM                    SOKNR4
S01  C*                  PARM                    SOTXT5
S01  C*                  PARM                    SOKNR5
S01  C*                  PARM                    SOTXT6
S01  C*                  PARM                    SOKNR6
S01  C*                  PARM                    SOTXT7
S01  C*                  PARM                    SOKNR7
S01  C*                  PARM                    SOTXT8
S01  C*                  PARM                    SOKNR8
N01   *
N01  C     WSCLOC        DIV       256           LINNBR
N01  C                   MVR                     POSNBR
N01   *
N01  C     LINNBR        IFEQ      8
N01  C     POSNBR        ANDGE     35
N01  C     POSNBR        ANDLE     42
N01  C                   MOVE      *BLANKS       UKNAVN           30
N01  C                   CALL      'SOEKKUN'
N01  C                   PARM                    WAFRKU
N01  C                   PARM                    FIFIRM
N01  C                   PARM                    UKNAVN
N01  C                   Z-ADD     9             LINNBR
N01  C                   Z-ADD     35            POSNBR
N01  C                   END
     C*
     C                   ENDSR
     C*
     C******************************************
     C     INIT          BEGSR
     C******************************************
     C*
     C* D= TIL DRIFTSBASE
     C*
     C     *ENTRY        PLIST
     C                   PARM                    VEI               1
     C     VEI           COMP      'D'                                    88
     C     VEI           COMP      'S'                                    87
     C* Key for customer file
     C     KUND1K        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WAFRKU
     C*
     C                   READ      FIRM                                   33
     C*
     C*
     C                   MOVE      'DIV0000'     MSGNR
     C*
S01  C*                  Z-ADD     2             SOANTK            1 0
S01  C*                  MOVE      *BLANKS       SOTXT3            8
S01  C*                  MOVE      *BLANKS       SOTXT4            8
S01  C*                  MOVE      *BLANKS       SOTXT5            8
S01  C*                  MOVE      *BLANKS       SOTXT6            8
S01  C*                  MOVE      *BLANKS       SOTXT7            8
S01  C*                  MOVE      *BLANKS       SOTXT8            8
S01  C*                  MOVE      *ZEROS        SOKNR3            8 0
S01  C*                  MOVE      *ZEROS        SOKNR4            8 0
S01  C*                  MOVE      *ZEROS        SOKNR5            8 0
S01  C*                  MOVE      *ZEROS        SOKNR6            8 0
S01  C*                  MOVE      *ZEROS        SOKNR7            8 0
S01  C*                  MOVE      *ZEROS        SOKNR8            8 0
     C                   MOVE      *ZEROS        WAGEDA
     C                   MOVE      *ZEROS        WAGED2
S01  C*
S01  C*                  EXSR      HMSG
     C*
     C                   ENDSR
S01  C***********************************************
S01  C*    HMSG          BEGSR
S01  C***********************************************
S01  C*                  MOVE      'DIV2094'     XMSGNR            7            MELDING-ID
S01  C*                  EXSR      HMSG2
S01  C*                  MOVEL     XMSG          SOTXT1            8
S01  C*                  MOVE      'DIV2095'     XMSGNR
S01  C*                  EXSR      HMSG2
S01  C*                  MOVEL     XMSG          SOTXT2            8
S01  C*
S01  C*                  ENDSR
S01  C*
S01  C***********************************************
S01  C*    HMSG2         BEGSR
S01  C***********************************************
S01  C*                  Z-ADD     3             XLEVEL            1 0          NIVÅ
S01  C*                  Z-ADD     0             XRETUR            1 0          RETURKODE
S01  C*                  Z-ADD     132           XMSGL             4 0          LENGDE PÅ MELDING
S01  C*                  CALL      'SUBR23R3'
S01  C*                  PARM                    XMSGNR
S01  C*                  PARM                    XMSG            132
S01  C*                  PARM                    XLEVEL
S01  C*                  PARM                    XRETUR
S01  C*                  PARM                    XMSGL
S01  C*
S01  C*                  ENDSR
S01  C*
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
     C*
     C* Format expiredate for agreed prices
     C     WAGEDA        IFNE      *ZEROS
     C                   MOVE      WAGED         UDT1              2 0
     C                   MOVE      WAGEM         UDT2              2 0
     C                   MOVE      WAGEÅ         UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          WAGED
     C                   MOVE      UDT2          WAGEM
     C                   MOVE      UDT3          WAGEÅ
     C                   END
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     FLYTT         BEGSR
     C***********************************************
     C     FRATKE        KLIST
     C                   KFLD                    FTKNR
     C                   KFLD                    FTFRAN
     C                   KFLD                    FTOPDT
     C                   KFLD                    FTSK
     C                   KFLD                    FTFRA
     C                   KFLD                    FTTIL
     C                   KFLD                    FTAVTN
     C*
     C     WAGEDA        IFEQ      0
     C                   MOVE      *ZEROS        WAGED2
     C                   ELSE
     C                   MOVE      WAGED         WAGE2D
     C                   MOVE      WAGEM         WAGE2M
     C     WAGEÅ         IFGT      50
     C     WAGEÅ         ADD       1900          WAGE2Å
     C                   ELSE
     C     WAGEÅ         ADD       2000          WAGE2Å
     C                   END
     C                   END
     C                   Z-ADD     1             KUNDE1            8 0
     C*
     C     WAFRKU        IFNE      99999999
     C     WAFRKU        SETLL     FRATN
     C                   ELSE
     C     KUNDE1        SETLL     FRATN
     C                   END
     C                   SETOFF                                       33
     C     *IN33         DOWEQ     '0'
     C     WAFRKU        IFNE      99999999
     C     WAFRKU        READE     FRATN                                  33
     C                   ELSE
     C                   READ      FRATN                                  33
     C                   END
     C     *IN33         IFEQ      '0'
     C                   EXSR      TESTAV
     C  N34              DO
     C     FRATKE        CHAIN     FRATNWRK                           35
     C   35              WRITE     FRATRWRK
     C   35              ADD       1             ANTFLY            6 0
     C  N35WSBYTT        IFEQ      'J'
     C     FRATKE        CHAIN     FRATN                              38
     C                   UPDATE    FRATRWRK
     C     FRATKE        SETGT     FRATN
     C                   ADD       1             ANTFLY            6 0
     C                   ELSE
     C                   UPDATE    FRATRWRK
     C  N35              ADD       1             ANTFOR            6 0
     C                   END
     C                   END
     C                   END
     C                   END
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     DEL           BEGSR
     C***********************************************
     C*
     C     WAGEDA        IFEQ      0
     C                   MOVE      *ZEROS        WAGED2
     C                   ELSE
     C                   MOVE      WAGED         WAGE2D
     C                   MOVE      WAGEM         WAGE2M
     C     WAGEÅ         IFGT      50
     C     WAGEÅ         ADD       1900          WAGE2Å
     C                   ELSE
     C     WAGEÅ         ADD       2000          WAGE2Å
     C                   END
     C                   END
     C                   Z-ADD     1             KUNDE1            8 0
     C*
     C     WAFRKU        IFNE      99999999
     C     WAFRKU        SETLL     FRATNWRK
     C                   ELSE
     C     KUNDE1        SETLL     FRATNWRK
     C                   END
     C                   SETOFF                                       33
     C     *IN33         DOWEQ     '0'
     C     WAFRKU        IFNE      99999999
     C     WAFRKU        READE     FRATNWRK                               33
     C                   ELSE
     C                   READ      FRATNWRK                               33
     C                   END
     C     *IN33         IFEQ      '0'
     C                   EXSR      TESTAV
     C  N34              DO
     C                   DELETE    FRATRWRK
     C                   ADD       1             ANTFLY            6 0
     C                   END
     C                   END
     C                   END
     C                   ENDSR
     C*
     C***********************************************
     C     TESTAV        BEGSR
     C***********************************************
     C                   SETOFF                                       34
     C*
     C     WAFRFR        IFNE      '*ALL '
     C     WAFRFR        ANDNE     FTFRA
     C                   SETON                                        34
     C                   GOTO      UTT
     C                   END
     C*
     C*
     C     WAFRFL        IFNE      '*A'
     C     FTFRA         CHAIN     STED2                              37
     C     WAFRFL        IFNE      ST2LK
     C                   SETON                                        34
     C                   GOTO      UTT
     C                   END
     C                   END
     C*
     C     WAFRTI        IFNE      '*ALL '
     C     WAFRTI        ANDNE     FTTIL
     C                   SETON                                        34
     C                   GOTO      UTT
     C                   END
     C*
     C*
     C     WAFRTL        IFNE      '*A'
     C     FTTIL         CHAIN     STED2                              37
     C     WAFRTL        IFNE      ST2LK
     C                   SETON                                        34
     C                   GOTO      UTT
     C                   END
     C                   END
     C*
     C*
     C     WAFROT        IFNE      '*A'
     C     WAFROT        ANDNE     FTOPDT
     C                   SETON                                        34
     C                   GOTO      UTT
     C                   END
     C*
     C*
     C     WAFRLE        IFNE      '*AL'
     C     WAFRLE        ANDNE     FTFRAN
     C                   SETON                                        34
     C                   GOTO      UTT
     C                   END
     C*
     C     WAGEDA        IFNE      *ZEROS
     C     FTDT          ANDGT     WAGED2
     C                   SETON                                        34
     C                   GOTO      UTT
     C                   END
     C     UTT           ENDSR
     C*
