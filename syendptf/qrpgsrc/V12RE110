     H DFTACTGRP(*NO)
     FCUNDL01   UF   E           K DISK
     FCUNDC05   UF   E           K DISK
     FECMSG     UF   E           K DISK
     FEDII      UF   E           K DISK
     FFIRM      IF   E           K DISK

     d WhereC          s            512a
     d*FirstW          s              1A
     d*cQuote          C                   const('''')
     d SqlStm          s            512a
     d myrows0         s             10i 0
     d myrows          s             10i 0
     d XAPS            C                   const(X'7D')
     d X               S             10  0
      *  Prototype for V12RE110
     d v12re110        pr
      *
     d MyPoDS0         ds                  Qualified  dim(1)
     d  FIFIRM                        2A
     d MyPoDS          ds                  Qualified  dim(10000)
     d  CFIRMA                        2A
     d  CCOMPN                        8S 0
     d  CPHONE                       15A
     d  CMOBIL                       15A
     d  CFAX                         15A
     d  CEMAIL                       70A
      /free

       exsr init;

       SqlStm = 'Select CFIRMA, CCOMPN, CPHONE, CMOBIL, CFAX, CEMAIL ' +
                'from CUNDC ' +
                'Where CFIRMA = ' + xaps + %trim(FIFIRM) + xaps +
                ' and CTYPE = ' + xaps + '*XML FAKTURA SIN' + xaps +
                ' and CCONTA = ' + xaps + 'SINGELFAKTURA' + xaps;
       Exec SQL PREPARE DynSel from :SqlStm;
       EXEC SQL DECLARE  A33  cursor for DynSel;
       Exec SQL OPEN A33;
       Myrows = %elem(MyPoDS);
       exec sql FETCH A33   for :MyRows rows
                  INTO :MyPoDs;
       Exec SQL CLOSE A33;

       if myrows > 0;
         for x = 1 to myrows;
           if mypods(x).cfirma = *blanks;
             leave;
           endif;

           cphone = mypods(x).cphone;

           if cphone = 'EHF';
             cfirma = mypods(x).cfirma;
             ccompn = mypods(x).ccompn;
             cmobil = mypods(x).cmobil;
             cfax   = mypods(x).cfax;
             cemail = mypods(x).cemail;

             exec sql
             update cundf
             set syfr06 = 'J'
             where firma = :cfirma and kundnr = :ccompn
             with NC;

             if cfax <> *blanks;
               exec sql
               delete from ecmsg
               where ecfir = :cfirma and eccno = :ccompn and ecsr = 'S'
                 and eciidi = :cmobil and eciidc = :cfax and ec0065 = 'INVXML'
               with NC;

               exec sql
               delete from edii
               where inid = :cfax and innetw = 'A' and inex = 'E'
               with NC;
             endif;

             exec sql
             delete from cundc
             where cfirma = :cfirma and ccompn = :ccompn and cphone = 'EHF'
               and ctype = '*XML FAKTURA SIN' and CCONTA = 'SINGELFAKTURA'
               and cemail = ' '
             with NC;

           endif;

         endfor;
       endif;

       *inlr = *on;
       return;

      //***********************************************
       begsr init;
      //***********************************************

       SqlStm = 'Select * ' +
                'from FIRM ' +
                'FOR READ ONLY ';
       Exec SQL PREPARE DynSel0 from :SqlStm;
       EXEC SQL DECLARE  A30  cursor for DynSel0;
       Exec SQL OPEN A30;
       Myrows0 = %elem(MyPoDS0);
       exec sql FETCH A30   for :MyRows0 rows
                  INTO :MyPoDs0;
       Exec SQL CLOSE A30;
       FIFIRM = mypods0(1).fifirm;

       endsr;

      /end-free
