      **************************************************************
      *         GENERERE PERIODISK INTERNBELASTNING                *
      **************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 V10-7 lang-feil rettet (kjør V10V10RE114 ) OGSÅ SYFI10X/SYTR35 !!!!
10XXX * 02 JOV PTF10 27X132 - nye kolonner
********************************************************************
     H DECEDIT('0,')
     FWINTF     UF   E           K DISK
     FHEADF     IF   E           K DISK
     FSADH      IF   E           K DISK
     FFAKT      O  A E             DISK
     FSYKSIN01FMCF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
N97  D                 DS
N97  D  FADOCN                 1     11
s01  D* FADOCN6_10             6     10
N01  D  FADOCN5_11             5     11
     D                UDS
     D* UDgavd                91     94
     D* UDgopd                95     99
     D  UDgavd                90     93
     D  UDgopd                94    100
     D  UUSER                401    410
     C*
     C                   EXSR      INIT
     C*
     C     START         TAG
     C                   move      *ZEROS        TOTBEL           13 2
     C                   Z-ADD     0             XIAVD             4 0
     C*                  Z-ADD     0             XIOPD             5 0
     C                   Z-ADD     0             XIOPD             7 0
     C                   Z-ADD     0             XILI              5 0
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     XINTKY        SETLL     WINTF
     C     START1        TAG
     C   94              MOVE      *BLANKS       WSNR
      *
     C     START2        TAG
      *
     C     *IN94         DOWEQ     *OFF
     C                   READ      WINTF                                  94
     C     *IN94         IFEQ      *OFF
     c     Vis0Lin       ifeq      'N'
     c     WIBELN        cabeq     *zeros        Next
     c     WIST          cabeq     'S'           Next
     c                   end
     c     WIST          ifeq      'S'
     c                   move      '*D*'         WIVK
     c                   end
     C                   ADD       1             ZRECNO
     C     ZRECNO        IFGE      9999
     C                   MOVE      'JOV1471'     MSGNR
     c                   seton                                        30
     C                   GOTO      MaxTag
     C                   ENDIF
     c                   move      WIOPD         SFOPD
     C                   Z-ADD     WIBELN        SFBEL
     c     WIST          ifne      'S'
     C                   ADD       WIBELN        TOTBEL
     c                   end
      *  Oppdrag finnes  ikke - RØD farge 50 *ON ,(SAD "90000-serie"?)
      *  HVIS SAD sad finnes basert på oppdrag/fraktbrev - GUL farge  51 *ON
     c                   movea     '00'          *IN(50)
N02  c                   move      *blanks       HEOT
N02  c                   move      *blanks       HEFR
N02  c                   move      *blanks       HESDL
     c     HeaKey        chain     HEADF                              50
     c     *in50         ifeq      '1'
     c                   move      *blanks       HESDL
     c     HeaKey        chain     SADH                               33
     c  N33SIOPD         Ifne      *zeros
     c                   movea     '01'          *IN(50)
     c     VisLS         ifeq      'J'
     c                   move      SIOPD         SFOPD
     c                   end
     c                   end
     c                   end
      * mode
     c     VisLS         ifeq      'J'
     c                   movel     HESDL         SFTEXT
     c                   else
     c                   eval      SFTEXT = %trimr(%editc(WIJUST:'2'))
     c                   movel     WITEGN        SFTEXT
     c                   end
     C                   WRITE     SUBFIL
     c     Next          tag
     C                   ENDIF
     C  N94              ENDDO
     c     Maxtag        tag
     C                   Z-ADD     ZRECNO        YRECNO            5 0
JOV   * HAR NÅ HENTET HELE - Vis fra første post.
JOV  C                   Z-ADD     1             ZRECNO
     C*
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
JOV  C     YRECNO        IFEQ      0
     C                   EXFMT     NYWRK
     C                   GOTO      ST41
     C                   ELSE
     C                   WRITE     BUNN
     C                   END
     C                   SETOFF                                       3098
     C                   EXFMT     SUBCTL
     C*
     C*** AVSLUTT
     C     ST41          TAG
     C   03              move      '3'           UFLAGG
     C   03              GOTO      SLUTT
     C   12              move      '2'           UFLAGG
     C   12              GOTO      SLUTT
     C     *IN10         IFEQ      *ON
     c                   exsr      INTLIN
     C                   MOVE      '0'           UFLAGG
     C                   GOTO      SLUTT
     C                   ENDIF
     C*
      *** FRISK OPP
     C     *IN05         IFEQ      *ON
     C                   GOTO      START
     C                   ENDIF
      *** Mode / vis laste-lossested
     C     *IN07         IFEQ      *ON
     C     VisLS         IFEQ      'J'
     C                   move      'N'           VisLS             1
     C                   eval      F7txt='F7=Vis Las/Los.st'
     c                   else
     C                   move      'J'           VisLS
     C                   eval      F7txt='F7=Vis Min/Just. '
     c                   end
     C                   GOTO      START
     C                   ENDIF
      *** Mode / vis kun de med beløp
     C     *IN09         IFEQ      *ON
     C     Vis0Lin       IFEQ      'J'
     C                   move      'N'           Vis0Lin           1
     C                   eval      F9txt='F9=Vis også 0-lin'
     c                   else
     C                   move      'J'           Vis0Lin
     C                   eval      F9txt='F9=Ikke vis 0-lin'
     c                   end
     C                   GOTO      START
     C                   ENDIF
     C*
     C                   EXSR      HENTOP
     c     Refresh       cabeq     'J'           Start
     C  N98              GOTO      START3
     C*
     C                   GOTO      START
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C*
     C*
     C***********************************************
     C     HENTOP        BEGSR
     C******************************** **************
     c                   move      'N'           Refresh           1
     C                   MOVEA     '00'          *IN(91)
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C  N98WSNR          IFEQ      '4'
     C                   EXSR      SUBR4
     C                   END
     C                   ENDDO
     C*
     C     SLHENT        TAG
     C                   ENDSR
     C*
     C***********************************************
     C     SUBR4         BEGSR
     C***********************************************
     C     WINTKY        CHAIN     WINTF                              66
     C     *IN66         IFEQ      *OFF
     c                   move      'J'           Refresh
     C     WIST          IFEQ      'S'
     C                   MOVE      ' '           WIST
     C                   ELSE
     C                   MOVE      'S'           WIST
     C                   ENDIF
     C                   UPDATE    WINTFR
     C                   ENDIF
     C                   ENDSR
     C***********************************************
     C     INTLIN        BEGSR
     C***********************************************
     C     *LOVAL        SETLL     WINTF
     C                   READ      WINTF                                  94
     C     *IN94         DOWEQ     *OFF
     c                   move      *blanks       FAVT
     C     WIST          IFNE      'S'
     C     WIbeln        andne     *zeros
     c     HeaKey        chain     HEADF                              33
      * hvis oppdr ikke finnes er det sad -
      *  - hvis denne peker på oppdrag OK / ellers belast kostnad mot trafikkavd / 0 i oppdrag.
     c     *in33         ifeq      '1'
     c                   move      *zeros        SIOPD
     c     HeaKey        chain     SADH                               33
     c                   move      SIOPD         WIOPD
     c                   Eval      FAVT = 'SAD '
     c                             +%trimr(%editc(SIAVD:'Z'))+'/'
     c                             +%trimr(%editc(SITDN:'Z'))
     c     SIFRBN        ifne      *zeros
     c                   Eval      FAVT = %trim(FAVT)+' Fb'
     c                             +%trimr(%editc(SIFRBN:'Z'))
     c                   end
     c                   end
     C                   MOVE      UDgavd        FAAVD
     C                   MOVE      UDgopd        FAOPD
     C                   MOVE      *ZEROS        FALI
     C                   CALL      'SYGE06'
     C                   PARM                    FAAVD
     C                   PARM                    FAOPD
     C                   PARM                    FALI
     C                   MOVE      'I'           FASK
     C                   MOVE      WIVK          FAVK
     C                   MOVE      'NOK'         FAVAL
     C                   MOVE      WIBELN        FABELV
     C                   MOVE      WIBELN        FABELN
     C                   MOVE      'N'           FAKDM
     C                   MOVE      'M'           FAKDA
     C                   MOVE      WIAVD         FAAVDR
S01  C*                  MOVE      WIOPD         FADOCN6_10
N01  C                   MOVE      WIOPD         FADOCN5_11
     c     WIOPD         ifeq      *zeros
S01  C*                  MOVE      *blanks       FADOCN6_10
N01  C                   MOVE      *blanks       FADOCN5_11
     c                   end
     C                   WRITE     FAKTR
     C                   END
     C                   READ      WINTF                                  94
     C                   ENDdo
     C                   ENDSR
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    UFLAGG            1
      * DFT = gopp ut (om ikke aktiv F10 velges..)
     c                   move      '3'           UFLAGG
     C* DEKLARER KEYS
     C     XINTKY        KLIST
     C                   KFLD                    XIAVD
     C                   KFLD                    XIOPD
     C                   KFLD                    XILI
      *
     C     WINTKY        KLIST
     C                   KFLD                    WIAVD
     C                   KFLD                    WIOPD
     C                   KFLD                    WILI
     C     HEAKEY        KLIST
     C                   KFLD                    WIAVD
     C                   KFLD                    WIOPD
      *
     c                   move      *blanks       F7txt            17
     c                   move      *blanks       F9txt            17
     c                   MOVE      'N'           VisLS
     C                   eval      F7txt='F7=Vis Las/Los.st'
     C                   move      'J'           Vis0Lin
     C                   eval      F9txt='F9=Ikke vis 0-lin'
      *
     C                   ENDSR
