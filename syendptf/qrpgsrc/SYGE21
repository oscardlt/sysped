********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF9 FEIL VED OPPDATERING AV HEADF OG TURER
10XXX * 02 JOV PTF9 FEIL i PTF 01
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * 03 JOV PTF11 oppdatere også HEKNT = oppdragets transp(feil siden 2012 - i alle andre fra da)
      *              Test også mot status S=Slettet
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * 04 JOV PTF12 Sett turens oppdragstype kun om den er blank fra før
      * 05 JOV PTF12 Sjekk for farlig gods/ulovlig mix (hovedregel= ikke mix eksplosjonsfarl/annet)
12XXX * 06 JOV PTF12 IKKE sjekk ADR dersom godset alt ER levert
***** **************************************************************
      *
      **********************************************************************
      *** PROGRAM for å sette et oppdrag på en tur                       ***
      ***                                                                ***
      ***  Param 4, IN30 = "1" i retur - Misslykket                      ***
      ***                                                                ***
      *** Det forutsettes at kallende prog utfører alle lovlighetstester ***
      *** Det forutsettes SELVSAGT at kallende prog (F.eks SYTR10...)    ***
      ***     "refresher" aktuelle variabler (ved chain el.annen måte)   ***
      **********************************************************************
     FHEADF     UF   E           K DISK
     FDISP      UF   E           K DISK
     FTURER14   UF   E           K DISK
     FKOSBU9    UF   E           K DISK
      *
     c     *entry        plist
     c                   parm                    Heavd             4 0
     c                   parm                    Heopd             7 0
     c                   parm                    UPRO              8 0
     c                   parm                    IN30              1
      * IN30 "1" i retur - Misslykket
     C     HEAKEY        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     KOSB9K        KLIST
     C                   KFLD                    YYST              1
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
      *
     c     HeaKey        chain     headf                              30
N02  c     *IN30         cabeq     '1'           UtPaTur
S01  C* N30HEPRO         COMP      *zeros                             3030
S01  C* N30HEST          COMP      'X'                                    30
S01  c*    *in30         IFEQ      '1'
S01  c*                  update    headfr
s02  C*    *IN30         IFEQ      *OFF
s02  C*    HEPRO         ANDNE     0
s02  C*    *IN30         OREQ      *OFF
s02  C*    HEST          ANDEQ     'X'
s02  C*    *IN30         OREQ      *ON
s02  C* N33              UPDATE    HEADFR
N02  C     HEPRO         ifne      0
N02  C     HEST          oreq      'X'
N03  C     HEST          oreq      'S'
N02  c                   seton                                        30
N02  C                   UPDATE    HEADFR
     c                   goto      UtPaTur
     c                   end
      *
      * sjekk mot farlig gods (hovedrege: ikke mix ax eksplosjonfarlig / annet )
N05  C     HESTN8        IFNE      'X'
N06  c     HESGM         andeq     *blanks
N05  C                   CALL      'SYGE84'
N05  C                   PARM      HEAVD         UFARAVD           4 0
N05  C                   PARM      HEOPD         UFAROPD           7 0
N05  C                   PARM      UPRO          UFARPRO           8 0
N05  C                   PARM                    UFARSAM           1
N05  C     UFARSAM       IFEQ      '1'                                          MSGNR 'JOV1673'
N05  C     UFARSAM       OREQ      '2'                                          MSGNR 'JOV1676'
N05  C     UFARSAM       OREQ      '3'                                          MSGNR 'JOV1677'
N05  C                   SETON                                        30
N05  C                   GOTO      UtPaTur
N05  C                   ENDIF
N05  C                   ENDIF
      *
     c     UPRO          chain     TURER14                            30
     c     *in30         IFEQ      '1'
     c                   update    headfr
S01  c*                  update    Turerr
     c                   goto      UtPaTur
     c                   end
      * OK
     C                   MOVE      UPRO          TUPRO
      * OPPDATER PÅ HEADF
     C                   MOVE      TUPRO         HEPRO
     C                   MOVEL     TUBILN        HEHAWB
     C                   MOVE      TURUND        TRRUND
N03  C                   MOVE      TUKNT2        HEKNT
     C                   MOVE      TUTRMA        HETRM
     C     TUCON1        IFNE      *BLANKS
     C                   MOVE      1             HETRC
     C                   MOVEL     TUCON1        HETRCN
     C                   END
     C                   UPDATE    HEADFR
      * OPPDATER PÅ TURER
N04  C                   IF        TUOPDT = *BLANKS
     C                   MOVE      HEOT          TUOPDT
N04  C                   ENDIF
     C                   ADD       HENT          TUTS
     C                   ADD       HEVKT         TUTVKT
     C                   ADD       HEM3          TUTM3
     C                   ADD       HELM          TUTLM
     C                   ADD       1             TUAO
     C                   UPDATE    TURERR
      * OPPDATER PÅ DISP
     C     HEAKEY        CHAIN     DISP                               33
     C     *in33         IFEQ      '0'
     C                   MOVE      HEPRO         DITUR
     C                   MOVE      TURUND        DIRUND
     C                   MOVE      TUAVD         DITUAV
     C                   MOVE      ' '           DISTA1
     C                   UPDATE    DISPR
     C                   end
      * GÅR IGJENNOM EVT. REKVISISJONER PÅ DETTE OPPDRAG OG LEGGER INN
      * TURNUMMER (FOR EVT Å KUNNE INNGÅ I TRANSPORTØRAVREGNING )
     C                   MOVE      ' '           YYST
     C     KOSB9K        CHAIN     KOSBU9                             33
     C     *IN33         DOWNE     '1'
     C                   MOVE      TUAVD         BUTAVD
     C                   MOVE      TUPRO         BUTUNR
     C                   MOVE      TURMND        BUPMN                          *PERIODE FØLGER
     C                   MOVE      TURAAR        BUPÅR                           ALLTID TUREN...
     C                   MOVE      TURACC        BUPCC
     C     BUBILN        IFEQ      *BLANKS
     C                   MOVE      TUBILN        BUBILN
     C                   MOVE      TUBILK        BUBILK
     C                   MOVE      TUDT          BUFEDT
     C                   END
     C                   UPDATE    KOSBUR
     C     KOSB9K        READE     KOSBU9                                 33
     C  N33              END
      *
      * OPPDATER TUR OGSÅ PÅ EVT. DUMMY/DUPREKV. PÅ OPPDRAGET
      * EVT. DUMMYREKVISISJONER (DUP)PÅ DETTE OPPDRAG-LEGGER INN TURNR
      * (FOR Å FÅ "TOTALBILDE" VED SPØRRING PÅ REKV - STATUS "*")
     C                   MOVE      'D'           YYST
     C     KOSB9K        CHAIN     KOSBU9                             33
     C     *IN33         DOWNE     '1'
     C                   MOVE      TUAVD         BUTAVD
     C                   MOVE      TUPRO         BUTUNR
     C                   MOVE      TURMND        BUPMN                          *PERIODE FØLGER
     C                   MOVE      TURAAR        BUPÅR                           ALLTID TUREN...
     C                   MOVE      TURACC        BUPCC
     C                   UPDATE    KOSBUR
     C     KOSB9K        READE     KOSBU9                                 33
     C  N33              END
      *
      *
      *
     c     UtPaTur       tag
     C                   Move      *IN30         IN30
     c                   seton                                        LR
     c                   return
      *
