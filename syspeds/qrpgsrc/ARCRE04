      ***********************************************************
      *** PROGRAM for arkivering
      ***********************************************************
     FTRUH      IF   E           K DISK
     FFIRMARC   IF   E           K DISK
     FFIRM      IF   E           K DISK
     FARKIVL06  UF   E           K DISK
     FARKIVL12  UF   E           K DISK
     F                                     RENAME(ARKIVR:ARKIVR12)
     D                SDS
     D  UUSR                 254    263
      *
      *
     C                   READ      FIRM                                   33
     C                   MOVE      FIFIRM        ARFIRM
     C                   READ      FIRMARC                                33
      *
     c     KEYARK        KLIST
     c                   kfld                    fifirm
     c                   kfld                    artype
      *
     c     KEYSAM        KLIST
     c                   kfld                    fifirm
     c                   kfld                    artype
     c                   kfld                    arunde
      *
      *
     c     KEYTRU        KLIST
     c                   kfld                    aravd
     c                   kfld                    aropd
      *
     c                   exsr      samle
      *
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      ************************************************************************
     c     samle         begsr
      ************************************************************************
     c                   move      'te'          artype
      *
     C     KEYARK        SETLL     ARKIVL06
     C                   SETOFF                                       33
      *
      *
     C     *IN(33)       DOWEQ     '0'
     C     KEYARK        READE     ARKIVL06                               33
     c     *in(33)       ifeq      '0'
      *
     C                   move      *BLANKS       ubane           256
     C                   movel     '/'           ubane
     C     ubane         CAT       arcane:0      ubane
     C     ubane         CAT       '/':0         ubane
     C     ubane         CAT       ARLINK:0      ubane
     C     ubane         CAT       '.pdf':0      ubane
     c                   call      'SYGE35CL'
     c                   parm                    UBANE
     c                   parm                    fins              1
     c                   move      *blanks       ARFRI
     c     FINS          ifeq      '1'
      *
     C     keytru        chain     truh                               35
     C     *in35         ifeq      '1'
     C                   delete    arkivr
     C                   else
      *
      * skjekk om faktura i det hele tatt finnes
      *
     C                   MOVEL     'NEI'         ARFRI
     C                   MOVE      *BLANKS       ARUSER
     c                   movel     uusr          aruser
     c                   move      ' '           arstat
     C                   UPDATE    ARKIVR
     c* slett tf-record
     c                   exsr      sletf
     c                   end
     C                   ELSE
     C                   MOVEL     'JA'          ARFRI
     C                   UPDATE    ARKIVR
     C                   END
     C                   ENDIF
     C                   ENDDO
     c                   endsr
      ************************************************************************
     c     sletf         begsr
      ************************************************************************
     c     KEYTF         KLIST
     c                   kfld                    arlinkk
     c                   move      arlink        arlinkk          40
     c                   movel     'tf'          arlinkk          40
     C     KEYTF         SETLL     ARKIVL12
     c* ikke setll da ikke første post skal slettes
     c                   setoff                                       34
     c     *in(34)       doweq     '0'
     c     KEYTF         reade     arkivl12                               34
     c     *in34         ifeq      '0'
     c     artype        andeq     'tf'
     c                   delete    arkivr12
     c                   endif
     c                   enddo
     c                   move      'te'          artype
     c                   movel     'te'          arlink
     c                   endsr
