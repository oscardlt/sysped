*****F**************************************************************
      * PROGRAM FOR generering av tabell til htmlfil
*****F**************************************************************
      *
     Fhtmlfil   IF   E           K DISK
     Fhtmlmail  o  a E             DISK
      *
     D                 DS
     D  varinn                 1   1600
     D  DA                     1   1600
     D                                     DIM(20)                              Output string
     D                 DS
     D  varcol                 1     20
     D  DC                     1     20
     D                                     DIM(20)                              Output string
     D                 DS
     D  varbac                 1     20
     D  DB                     1     20
     D                                     DIM(20)                              Output string
     D                 DS
     D  varrl                  1     20
     D  DRL                    1     20
     D                                     DIM(20)                              Output string
     D                 DS
     D  varbol                 1     20
     D  DBO                    1     20
     D                                     DIM(20)                              Output string
     D                 DS
     D  varsiz                 1     20
     D  DSI                    1     20
     D                                     DIM(20)                              Output string
     D                SDS
     D  UUSR                 254    263
     D*
     D*
      *
     C                   EXSR      INIT
      *
      *
      * skriver logo ved L
      *
     c     HTMLKO        ifeq      'LOGO  '
     C     'LOGO     '   chain     htmlfil                            33
     C                   MOVEL     htdata        pdata
     c                   write     htmlmailr
     c                   goto      slutt
     c                   end
      *
      * skriver brukerdata linje
      *
     c     HTMLKO        ifeq      'USER  '
     c                   MOVEL     UUSR          USERK             9
     C     USERK         chain     htmlfil                            33
     C                   MOVEL     htdata        pdata
     c                   write     htmlmailr
     c                   goto      slutt
     c                   end
      *
      * skriver heading
      *
     c     HTMLKO        ifeq      'TEXT  '
     C                   EXSR      STRTXT
     c                   goto      slutt
     c                   end
      *
      *
      *
      *
      *
      * start tabell hvis ønskelig
      *
     c
     c     HTMLKO        ifeq      'TABSTR'
     C                   EXSR      TABSTR
     c                   end
     c*
     c                   EXSR      TABLINSTR
     c     1             do        uantk         nr                2 0
     c                   EXSR      TABVARSTR
      *
      * font color
      *
     c     DC(NR)        ifne      *blanks
     c                   exsr      fontstr
     c                   end
      *
      * bold or not
      *
     c     DBO(NR)       ifeq      'J'
     c                   exsr      bolstr
     c                   end
      *
     c     pdata         cat       da(nr):1      pdata
      *
      * bold or not  end
      *
     c     DBO(NR)       ifeq      'J'
     C                   EXSR      BOLEND
     c                   end
     c                   write     htmlmailr
     c                   move      *blanks       pdata
      *
      * font color end
      *
     c     DC(NR)        ifne      *blanks
     c                   exsr      endfnt
     c                   end
     c                   EXSR      TABVARend
     c                   end
      *
      * slutt løkke
     c*
     c                   EXSR      TABLINEND
      *
      *
     c     HTMLKO        ifeq      'TABEND'
     c                   EXSR      TABEND
     c                   end
      *
      *
      * skriver eventuellt brukers bunntekst
      *
     c     slutt         tag
     C                   MOVE      '1'           *INLR
     C                   RETURN
      *
      *
      *
     C***********************************************
     C     BOLEND        begsr
     C***********************************************
     C     'BOLEND   '   chain     htmlfil                            33
     C     pdata         CAT       htdata:0      pdata
     c                   endsr
     C***********************************************
     C     BOLSTR        begsr
     C***********************************************
     C     'BOLSTR   '   chain     htmlfil                            33
     C     pdata         CAT       htdata:0      pdata
     c                   endsr
     C***********************************************
     C     BUNNSR        begsr
     C***********************************************
     c                   movel     uusr          uusr9             9
     C     uusr9         chain     htmlfil                            33
     c     *in(33)       ifeq      '0'
     c                   movel     htdata        pdata
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   end
     c                   endsr
     C***********************************************
     C     ENDFNT        begsr
     C***********************************************
     C     'ENDFNT   '   chain     htmlfil                            33
     C     pdata         CAT       htdata:0      pdata
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   endsr
     C***********************************************
     C     FONTSTR       begsr
     C***********************************************
     C     pdata         CAT       '<font ':0    pdata
      *
      * size
      *
     c     DSI(NR)       ifne      ' '
     C     pdata         CAT       'size="':1    pdata
     C     pdata         CAT       DSI(NR):0     pdata
     C     pdata         CAT       '"':0         pdata
     C                   end
      * blå font
      *
     c     DC(NR)        ifeq      'B'
     C     'STRFNTBLU'   chain     htmlfil                            33
     C     pdata         CAT       htdata:1      pdata
     c                   end
      *
      * grønn font
      *
     c     DC(NR)        ifeq      'G'
     C     'STRFNTGRE'   chain     htmlfil                            33
     C     pdata         CAT       htdata:1      pdata
     c                   end
      *
      * rød font
      *
     c     DC(NR)        ifeq      'R'
     C     'STRFNTRED'   chain     htmlfil                            33
     C     pdata         CAT       htdata:1      pdata
     c                   end
     C     pdata         CAT       '>':0         pdata
      *
      * avslutter td
      *
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   endsr
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     c*
     c* HTMLKO
      * LOGO    = skriver firmalogo
      * TEXT    = tekstlinje
      * TABSTR  = Første linje i tabell
      * TABDET  = Detaljlinjer i tabell
      * TABEND  = Avslutningslinjen i tabell
     c     *entry        plist
     c                   parm                    uantk             2 0
     c                   parm                    htmlko            6
     c                   parm                    uvar           1600
     c                   parm                    uvarc            20
     c                   parm                    uvarb            20
     c                   parm                    uvarrl           20
     c                   parm                    ubold            20
     c                   parm                    usize            20
     c                   move      uvar          varinn
     c                   move      uvarc         varcol
     c                   move      uvarb         varbac
     c                   move      uvarrl        varrl
     c                   move      ubold         varbol
     c                   move      usize         varsiz
      *
     C                   ENDSR
      *
     C***********************************************
     C     TABSTR        BEGSR
     C***********************************************
     C     'TABSTR   '   chain     htmlfil                            33
     c                   movel     htdata        pdata
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   endsr
     C***********************************************
     C     TABEND        BEGSR
     C***********************************************
     C     'TABEND   '   chain     htmlfil                            33
     c                   movel     htdata        pdata
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   endsr
     C***********************************************
     C     TABLINSTR     begsr
     C***********************************************
     C     'TABLINSTR'   chain     htmlfil                            33
     c                   movel     htdata        pdata
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   endsr
     C***********************************************
     C     TABLINEND     begsr
     C***********************************************
     C     'TABLINEND'   chain     htmlfil                            33
     c                   movel     htdata        pdata
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   endsr
     C***********************************************
     C     TABVARSTR     begsr
     C***********************************************
     C     pdata         CAT       '<td':0       pdata
      *
      * høyrestill
      *
     c     DRL(NR)       ifeq      'R'
     C     'TABVARRIG'   chain     htmlfil                            33
     C     pdata         CAT       htdata:1      pdata
     c                   end
      *
      * blå bakgrunn
      *
     c     DB(NR)        ifeq      'B'
     C     'TABVARBAB'   chain     htmlfil                            33
     C     pdata         CAT       htdata:1      pdata
     c                   end
      *
      * rosa bakgrunn
      *
     c     DB(NR)        ifeq      'P'
     C     'TABVARBAP'   chain     htmlfil                            33
     C     pdata         CAT       htdata:1      pdata
     c                   end
      *
      * gul bakgrunn
      *
     c     DB(NR)        ifeq      'Y'
     C     'TABVARBAY'   chain     htmlfil                            33
     C     pdata         CAT       htdata:1      pdata
     c                   end
      *
      * avslutter td
      *
     C     pdata         CAT       '>':0         pdata
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   endsr
     C***********************************************
     C     TABVAREND     begsr
     C***********************************************
     C     'TABVAREND'   chain     htmlfil                            33
     c                   move      htdata        pdata
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   endsr
     C***********************************************
     C     STRFOBBOL     begsr
     C***********************************************
     C     'STRFOBBOL'   chain     htmlfil                            33
     c                   movel     htdata        pdata
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   endsr
     C***********************************************
     C     STRTXT        begsr
     C***********************************************
     C     pdata         CAT       '<p>':0       pdata
      *
     c     1             do        uantk         nr                2 0
      *
      * font color
      *
     c     DC(NR)        ifne      *blanks
     c                   exsr      fontstr
     c                   end
      *
      * bold or not
      *
     c     DBO(NR)       ifeq      'J'
     c                   exsr      bolstr
     c                   end
      *
      * selve teksteb
      *
     C     pdata         CAT       da(nr):0      pdata
      *
      * bold or not end
      *
     c     DBO(NR)       ifeq      'J'
     C                   EXSR      BOLEND
     c                   end
      *
      * font color end
      *
     c     DC(NR)        ifne      *blanks
     c                   exsr      endfnt
     c                   end
     C     pdata         CAT       '<br>':0      pdata
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   end
     C     pdata         CAT       '</p>':0      pdata
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   endsr
     C***********************************************
     C     ENDFONBOL     begsr
     C***********************************************
     C     'ENDFONBOL'   chain     htmlfil                            33
     c                   movel     htdata        pdata
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   endsr
     C***********************************************
     C     LOGOSR        begsr
     C***********************************************
     C     'LOGO     '   chain     htmlfil                            33
     c     *in(33)       ifeq      '0'
     c                   movel     htdata        pdata
     c                   write     htmlmailr
     c                   move      *blanks       pdata
     c                   end
     c                   endsr
