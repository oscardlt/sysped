********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10107 * 01 CB  PTF10 Bytt frisokkode fra *CR til *CE
10108 * 02 CB  PTF10 Ikke lås record ved mode='D' (VIS)
10XXX * 03 CB  PTF10 Ombudstyp feil
11XXX * 04 CB  PTF10 Utøkad test på R2 och R14
11XXX * 05 CB  PTF10 Hent deklarantens namn om blankt
11071 * 06 CB  PTF11 Tlf till handlæggare
11073 * 07 CB  PTF11 Syntakssjekk på alle EORI-nr
11080 * 08 CB  PTF11 Lagerid/Godsnr repeteres fra hoved til varuposter
11103 * 09 CB  PTF11 Validering av Containernummer
11XXX * 10 CB  PTF11 Fel position utfartstullkontor
********************************************************************
     FSVE001D   CF   E             WORKSTN
     F                                     INFDS(FBAREA)
     FFRISOK    UF A E           K DISK
     FFRISOL01  IF   E           K DISK
     F                                     RENAME(FRISOKR:FRISOK1)
     FSVEH      UF A E           K DISK
     FSVEA      UF   E           K DISK
     FSVEF      IF   E             DISK
     FSADH      IF   E           K DISK
     FSADV      IF   E           K DISK
     FHEADF     IF   E           K DISK
     FSVTHA     IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     FSVTFI     IF   E             DISK
     FSVTVK     IF   E           K DISK
     FSVTLV     IF   E           K DISK
     FSVTX03F   IF   E           K DISK
     FSVEV      UF   E           K DISK
     D P               S              5U 0
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  SYRG                   1     14
     D  SYO1                   1     10
     D  SYO2                  11     12
     D                UDS
     D  UFIRM                  1      2
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    UMODE             1
     C                   PARM                    UVEH_SYAV
     C                   PARM                    UVEH_SYOP
     C                   PARM                    UVEH_SYSG
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    SVEH_SYAV     UVEH_SYAV
     C     *LIKE         DEFINE    SVEH_SYOP     UVEH_SYOP
     C     *LIKE         DEFINE    SVEH_SYSG     UVEH_SYSG
     C     *LIKE         DEFINE    SVEH_TUID     UVEH_TUID
     C     *LIKE         DEFINE    SIAVD         Z_SIAVD
     C     *LIKE         DEFINE    SITDN         Z_SITDN
     C     *LIKE         DEFINE    SVEF_VAKD     ÅVEF_VAKD
     C     *LIKE         DEFINE    SVEF_VAKU     ÅVEF_VAKU
     C     *LIKE         DEFINE    SVEF_FABL     ÅVEF_FABL
     C     *LIKE         DEFINE    SVEH_FABL     ZVEH_FABL
     C     *LIKE         DEFINE    *IN03         WIN03
     C     *LIKE         DEFINE    *IN12         WIN12
     C     *LIKE         DEFINE    SVVK_KD       ZVVK_KD
     C     *LIKE         DEFINE    SVVK_DTS      ZVVK_DTS
     C     *LIKE         DEFINE    SVEH_AVPA     W_PADR
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     EXTREFK       KLIST
     C                   KFLD                    WSKODE            3
     C                   KFLD                    EXTREF
S01  C*                  MOVEL     '*CR'         WSKODE
N01  C                   MOVEL     '*CE'         WSKODE
     C     FRIKEY2       KLIST
     C                   KFLD                    ZVEH_SYAV
     C                   KFLD                    ZVEH_SYOP
     C                   KFLD                    WFSKODE2          3
S01  C*                  MOVE      '*CR'         WFSKODE2
N01  C                   MOVE      '*CE'         WFSKODE2
     C     ZKEY          KLIST
     C                   KFLD                    ZVEH_SYAV
     C                   KFLD                    ZVEH_SYOP
     C     XKEY          KLIST
     C                   KFLD                    XVEH_SYAV
     C                   KFLD                    XVEH_SYOP
     C     SADKEY        KLIST
     C                   KFLD                    Z_SIAVD
     C                   KFLD                    Z_SITDN
     C     CUNDL01K      KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    KUNDNR
     C     SVTVKKEY      KLIST
     C                   KFLD                    ZVVK_KD
     C                   KFLD                    ZVVK_DTS
     C     SVTX03K       KLIST
     C                   KFLD                    UIE
     C                   KFLD                    UTYP
     C                   KFLD                    UKD
      *___________________
      * Dummy read av SVEF
      *"""""""""""""""""""
     C     *IN30         IFEQ      *OFF
     C     *IN30         ANDEQ     *ON
     C                   READ      SVEF
     C                   ENDIF
      *_________________________________
      * Hæmta dagens datum och klockslag
      *"""""""""""""""""""""""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVEL     WDT           ZVVK_DTS
      *________________________
      * Hæmta firmaupplysningar
      *""""""""""""""""""""""""
     C     1             CHAIN     SVTFI
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
     C                   EVAL      ZVEH_SYAV=UVEH_SYAV
     C                   EVAL      ZVEH_SYOP=UVEH_SYOP
     C                   EVAL      ZVEH_SYSG=UVEH_SYSG
     C                   EVAL      *IN30=*OFF
     C                   IF        UMODE='N'
     C                   EVAL      ZVEH_SYOP=0
     C                   ELSE
     C                   GOTO      SRB2
     C                   ENDIF

      *_______________
      * Behandle bilde
      *"""""""""""""""
     C     SRB1          TAG

     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     SVE001DØ
     C                   EXFMT     SVE001DA
      *_______________
      * F3,F12=Avlsutt
      *"""""""""""""""
     C                   IF         *IN03
     C                   GOTO      SRB9
     C                   ENDIF
     C                   IF         *IN12
     C                   GOTO      SRB9
     C                   ENDIF
      *_______
      * F4=Søk
      *"""""""
      *___________
      * Test input
      *"""""""""""
     C     SRB2          TAG
      * Avdeling får ikke vare 0 og må finnes
     C     ZVEH_SYAV     CHAIN(N)  SVEA                               30
     C                   IF        *IN30
     C                   EVAL      *IN31=*ON
     C                   MOVE      'SVE0001'     ZMSGNO
     C                   EVAL      LINNBR=6
     C                   EVAL      POSNBR=27
     C                   GOTO      SRB1
     C                   ENDIF
      * Signatur får ikke vare blank
     C     ZVEH_SYSG     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN32=*ON
     C                   MOVE      'SVE0002'     ZMSGNO
     C                   EVAL      LINNBR=8
     C                   EVAL      POSNBR=27
     C                   GOTO      SRB1
     C                   ENDIF
      * Signatur må finnes
     C     ZVEH_SYSG     CHAIN     SVTHA                              30
     C                   IF        *IN30
     C                   EVAL      *IN32=*ON
     C                   MOVE      'SVE0002'     ZMSGNO
     C                   EVAL      LINNBR=8
     C                   EVAL      POSNBR=27
     C                   GOTO      SRB1
     C                   ENDIF
      *
      * F4 søk
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN04         IFEQ      '1'
     C     LINNBR        ANDEQ     9
     C                   CALL      'SYGE47R'
     C                   PARM      'B'           UHEUR             1
     C                   PARM                    EXTREF
     C                   EVAL      *IN04=*OFF
     C     EXTREF        IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   GOTO      SRB1
     C                   ENDIF
     C                   ENDIF
      * HENT EKSTERNREF
      *
     C     EXTREF        IFNE      *BLANKS
     C     ZVEH_SYOP     ANDEQ     0
     C     EXTREFK       CHAIN     FRISOL01                           99
      * gjør forsøk på ny oppdatering
     C   99              DO
     c                   move      *zeros        nyopd             7 0
     c                   move      UVEH_SYAV     UAVD              4 0
     c                   move      ZVEH_SYSG     WSSG              3
     C                   CALL      'SADEXT'
     C                   PARM                    UAVD
     C                   PARM                    EXTREF
     C                   PARM                    nyopd
     C                   PARM                    WSSG
     C     EXTREFK       CHAIN     FRISOL01                           99
     C                   END
     C     *IN99         IFEQ      '0'
     C                   MOVE      FSAVD         ZVEH_SYAV
     C                   Z-ADD     FSOPD         ZVEH_SYOP
     C                   ELSE
     C                   MOVE      'SVI0048'     ZMSGNO
     C                   EVAL      LINNBR=9
     C                   EVAL      POSNBR=27
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN32=*ON
     C                   GOTO      SRB1
     C                   END
     C                   END
      * Hent tolldeklarasjon
     C     ZKEY          CHAIN(N)  SVEH                               51
      *
      * HENT EKSTERNREF uansett
     C     FRIKEY2       CHAIN     FRISOK                             99
     C  N99              MOVEL     FSSOK         EXTREF
      *
      * Hvis avdeling er utfyllt men ikke oppdrag, lag ny
      * Hvis dekl. finnes, gå videre for vedlikehold.
      * Hvis ikke, prøv i 2 steg.
      * 1. Hent fra Norsk SAD Eksport      *** kommer senere ***
      * 2. Hent fra Oppdrag                *** kommer senere ***
      *_______
      * Lag ny
      *"""""""
     C     *IN51         IFEQ      *ON
     C     ZVEH_SYOP     ANDEQ     0
     C                   CLEAR                   SVE001DB
     C                   CLEAR                   SVE001DC
     C     UMODE         COMP      'D'                                    27
      * Hent neste tolldeklarasjonsnummer
     C     ZVEH_SYAV     CHAIN     SVEA                               52
     C                   ADD       1             SVEA_SYOP
     C     UMODE         IFNE      'D'
     C                   UPDATE    SVEAR
     C                   ENDIF
     C                   MOVEL     EXTREF        EXTREF2
     C                   EVAL      ZVEH_SYOP=SVEA_SYOP
      * legg in ombudsupplysningar från avdelningsreg.
     C                   EVAL      XVEH_OMEO=SVEA_OMEO
     C                   EVAL      XVEH_OMHA=SVTH_NAMN
S06  C*                  EVAL      XVEH_OMTL=SVEA_OMTL
N06  C                   EVAL      XVEH_OMTL=SVTH_TLF
     C                   EVAL      XVEH_OMTY=SVEA_OMTY
     C                   EVAL      XVEH_0035=SVEA_0035
      * Andra defaultupplysningar
     C                   EVAL      XVEH_MTYP='UGE'
     C                   EVAL      XVEH_TART='1'
     C                   EVAL      XVEH_DEK1='EU'
     C                   EVAL      XVEH_DEK2='Z'
     C                   EVAL      XVEH_UPPS='T'
     C                   IF        SVTF_0035='1'
     C                   EVAL      XVEH_GOLK='AZZ'
     C                   ENDIF
     C                   EVAL      XVEH_KVSA=SVTF_KVAL
      * Lag tullid
     C                   CALL      'SVG001R'
     C                   PARM                    XVEH_TUID
     C                   EVAL      UVEH_TUID=XVEH_TUID

     C                   EVAL      XVEH_SYAV=ZVEH_SYAV
     C                   EVAL      XVEH_SYOP=ZVEH_SYOP
     C                   EVAL      XVEH_SYSG=ZVEH_SYSG
     C                   GOTO      SRB3
     C                   ENDIF
      *_________________________
      * Deklarasjon fantes, vedl.
      *""""""""""""""""""""""""""
     C                   IF        *IN51=*off
     C                   CLEAR                   SVE001DB
     C                   CLEAR                   SVE001DC
     C     UMODE         COMP      'D'                                    27
     C                   MOVEL     EXTREF        EXTREF2
     C                   EVAL      XVEH_SYAV=SVEH_SYAV
     C                   EVAL      XVEH_SYOP=SVEH_SYOP
     C                   EVAL      XVEH_SYSG=SVEH_SYSG
     C                   EVAL      XVEH_TUID=SVEH_TUID
     C                   EVAL      XVEH_MTYP=SVEH_MTYP
     C                   EVAL      XVEH_TART=SVEH_TART
     C                   EVAL      XVEH_DEK1=SVEH_DEK1
     C                   EVAL      XVEH_DEK2=SVEH_DEK2
     C                   EVAL      XVEH_AVKN=SVEH_AVKN
     C                   EVAL      XVEH_AVEO=SVEH_AVEO
     C                   EVAL      XVEH_AVNA=SVEH_AVNA
     C                   EVAL      XVEH_AVA1=SVEH_AVA1
     C                   EVAL      XVEH_AVA2=SVEH_AVA2
     C                   EVAL      XVEH_AVPN=SVEH_AVPN
     C                   EVAL      XVEH_AVPA=SVEH_AVPA
     C                   EVAL      XVEH_AVLK=SVEH_AVLK
     C                   EVAL      XVEH_AVHA=SVEH_AVHA
     C                   EVAL      XVEH_AVTL=SVEH_AVTL
     C                   EVAL      XVEH_MOKN=SVEH_MOKN
     C                   EVAL      XVEH_MOEO=SVEH_MOEO
     C                   EVAL      XVEH_MONA=SVEH_MONA
     C                   EVAL      XVEH_MOA1=SVEH_MOA1
     C                   EVAL      XVEH_MOA2=SVEH_MOA2
     C                   EVAL      XVEH_MOPN=SVEH_MOPN
     C                   EVAL      XVEH_MOPA=SVEH_MOPA
     C                   EVAL      XVEH_MOLK=SVEH_MOLK
     C                   EVAL      XVEH_DKKN=SVEH_DKKN
     C                   EVAL      XVEH_DKEO=SVEH_DKEO
     C                   EVAL      XVEH_DKNA=SVEH_DKNA
     C                   EVAL      XVEH_DKA1=SVEH_DKA1
     C                   EVAL      XVEH_DKA2=SVEH_DKA2
     C                   EVAL      XVEH_DKPN=SVEH_DKPN
     C                   EVAL      XVEH_DKPA=SVEH_DKPA
     C                   EVAL      XVEH_DKLK=SVEH_DKLK
     C                   EVAL      XVEH_OMEO=SVEH_OMEO
     C                   EVAL      XVEH_OMHA=SVEH_OMHA
     C                   EVAL      XVEH_OMTL=SVEH_OMTL
     C                   EVAL      XVEH_OMTY=SVEH_OMTY
     C                   EVAL      XVEH_0035=SVEH_0035
     C                   EVAL      XVEH_VAKD=SVEH_VAKD
     C                   EVAL      XVEH_FABL=SVEH_FABL
     C                   EVAL      XVEH_VAKU=SVEH_VAKU
     C                   EVAL      XVEH_FATY=SVEH_FATY
     C                   EVAL      XVEH_FATX=SVEH_FATX
     C                   EVAL      XVEH_UPPS=SVEH_UPPS
     C                   EVAL      XVEH_AVUT=SVEH_AVUT
     C                   EVAL      XVEH_AUBE=SVEH_AUBE
     C                   EVAL      XVEH_TRID=SVEH_TRID
     C                   EVAL      XVEH_TRAI=SVEH_TRAI
     C                   EVAL      XVEH_TRAL=SVEH_TRAL
     C                   EVAL      XVEH_TRGR=SVEH_TRGR
     C                   EVAL      XVEH_TRIN=SVEH_TRIN
     C                   EVAL      XVEH_CONT=SVEH_CONT
     C                   EVAL      XVEH_GOLK=SVEH_GOLK
     C                   EVAL      XVEH_KOTA=SVEH_KOTA
     C                   EVAL      XVEH_BRUT=SVEH_BRUT
     C                   EVAL      XVEH_KENH=SVEH_KENH
     C                   EVAL      XVEH_KLEO=SVEH_KLEO
     C                   EVAL      XVEH_TRNR=SVEH_TRNR
     C                   EVAL      XVEH_AUKD=SVEH_AUKD
     C                   EVAL      XVEH_RFAC=SVEH_RFAC
     C                   EVAL      XVEH_RFAC2=SVEH_RFAC2
     C                   EVAL      XVEH_RFAC3=SVEH_RFAC3
     C                   EVAL      XVEH_LAST=SVEH_LAST
     C                   EVAL      XVEH_UTFA=SVEH_UTFA
     C                   EVAL      XVEH_TAXD=SVEH_TAXD
     C                   EVAL      XVEH_BEAT=SVEH_BEAT
     C                   EVAL      XVEH_BETK=SVEH_BETK
     C                   EVAL      XVEH_SAOM=SVEH_SAOM
     C                   EVAL      XVEH_KOMR=SVEH_KOMR
     C                   EVAL      XVEH_SEL1=SVEH_SEL1
     C                   EVAL      XVEH_SEL2=SVEH_SEL2
     C                   EVAL      XVEH_RES1=SVEH_RES1
     C                   EVAL      XVEH_RES2=SVEH_RES2
     C                   EVAL      XVEH_RES3=SVEH_RES3
     C                   EVAL      XVEH_RES4=SVEH_RES4
     C                   EVAL      XVEH_RES5=SVEH_RES5
     C                   EVAL      XVEH_RES6=SVEH_RES6
     C                   EVAL      XVEH_RES7=SVEH_RES7
     C                   EVAL      XVEH_RES8=SVEH_RES8
     C                   EVAL      XVEH_KVSA=SVEH_KVSA
     C                   EVAL      XVEH_GODN=SVEH_GODN
      * Uppdatera status
N02  C     UMODE         IFNE      'D'
     C     ZKEY          CHAIN     SVEH                               51
     C     *IN51         IFEQ      *OFF
     C                   EVAL      SVEH_SYST='E'
S02  C*    UMODE         IFNE      'D'
     C                   UPDATE    SVEHR
     C                   ENDIF
     C                   ENDIF
     C                   GOTO      SRB3
     C                   ENDIF
      *_________________________________________________
      * Kopier fra SAD Import (og bitte lite fra HEADF)
      *"""""""""""""""""""""""""""""""""""""""""""""""""
     C     *IN51         IFEQ      *ON
     C     ZVEH_SYOP     ANDNE     0
     C                   EVAL      Z_SIAVD=ZVEH_SYAV
     C                   EVAL      Z_SITDN=ZVEH_SYOP
     C     SADKEY        CHAIN     SADH                               52
     C     *IN52         IFEQ      *OFF

     C                   CLEAR                   SVE001DB
     C                   CLEAR                   SVE001DC
     C     UMODE         COMP      'D'                                    27
     C                   EVAL      XVEH_TUID=UVEH_TUID
     C                   EVAL      XVEH_SYAV=ZVEH_SYAV
     C                   EVAL      XVEH_SYOP=ZVEH_SYOP
     C                   EVAL      XVEH_SYSG=ZVEH_SYSG
      * Lag tullid
     C                   CALL      'SVG001R'
     C                   PARM                    XVEH_TUID
     C                   EVAL      UVEH_TUID=XVEH_TUID

     C                   EVAL      XVEH_MTYP='UGE'
     C                   EVAL      XVEH_TART='1'
     C                   EVAL      XVEH_DEK1='EU'
     C                   EVAL      XVEH_DEK2='Z'
     C                   EVAL      XVEH_UPPS='T'
     C                   IF        SVTF_0035='1'
     C                   EVAL      XVEH_GOLK='AZZ'
     C                   ENDIF
     C                   EVAL      XVEH_AVKN=SIKNS
     C                   EVAL      XVEH_AVNA=SINAS
     C                   EVAL      XVEH_AVA1=SIADS1
     C                   EVAL      XVEH_AVA2=SIADS2
     C                   EVAL      P = %SCAN (' ' : SIADS3)
     C                   EVAL      XVEH_AVPN=%SUBST(SIADS3:1:P)
     C                   EVAL      W_PADR=%SUBST(SIADS3:P+1)
     C                   EVAL      XVEH_AVPA=%triml(W_PADR)
     C                   EVAL      XVEH_AVLK='SE'
     C                   EVAL      XVEH_AVHA=SITARF
     C                   EVAL      XVEH_AVTL=' '
     C                   EVAL      XVEH_MOKN=SIKNK
     C                   EVAL      XVEH_MONA=SINAK
     C                   EVAL      XVEH_MOA1=SIADK1
     C                   EVAL      XVEH_MOA2=SIADK2
     C                   EVAL      P = %SCAN (' ' : SIADK3)
     C                   EVAL      XVEH_MOPN=%SUBST(SIADK3:1:P)
     C                   EVAL      W_PADR=%SUBST(SIADK3:P+1)
     C                   EVAL      XVEH_MOPA=%triml(W_PADR)
     C                   EVAL      XVEH_MOLK='NO'
      * Kingsrød spesial, hent mott oppl fra kundereg uansett
     C     XVEH_MOKN     IFNE      0
     C                   MOVE      XVEH_MOKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            40
     C                   IF        *IN40=*OFF
     C                   EVAL      XVEH_MONA = KNAVN
     C                   EVAL      XVEH_MOA1 = ADR1
     C                   EVAL      XVEH_MOA2 = ADR2
     C                   IF        POSTNR = 0
     C                   EVAL      XVEH_MOPN = SYPOGE
     C                   ELSE
     C                   EVAL      XVEH_MOPN = *BLANKS
     C                   MOVEL     POSTNR        XVEH_MOPN
     C                   ENDIF
     C                   EVAL      XVEH_MOPA = ADR3
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XVEH_MOLK = SYLAND
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *
     C                   EVAL      XVEH_OMEO=SVEA_OMEO
     C                   EVAL      XVEH_OMHA=SVTH_NAMN
S06  C*                  EVAL      XVEH_OMTL=SVEA_OMTL
N06  C                   EVAL      XVEH_OMTL=SVTH_TLF
S03  C*                  EVAL      XVEH_OMTY='A'
     C                   EVAL      XVEH_AVUT='SE'
     C                   EVAL      XVEH_AUBE='NO'
     C                   EVAL      XVEH_VAKD=SIVAL3
     C                   EVAL      XVEH_FABL=SIBEL3
     C                   MOVEL     SITRM         XVEH_TRGR
     C                   MOVEL     '3'           XVEH_TRIN
     C                   EVAL      XVEH_FATY='N380'
     C                   EVAL      XVEH_FATX=SIFIF
     C                   EVAL      XVEH_TRID=SITRID
     C                   EVAL      XVEH_TRAI=SITRID
     C                   EVAL      XVEH_TRAL=SILKT
     C                   EVAL      XVEH_CONT=SIKDC
     C                   EVAL      XVEH_KOTA=SINTK
     C                   EVAL      XVEH_BRUT=SIVKB
     C     SADKEY        SETLL     SADV
     C     SADKEY        READE     SADV                                   40
      * hæmta kundinfo
     C     XVEH_AVKN     IFNE      0
     C                   MOVE      XVEH_AVKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            40
     C                   IF        *IN40=*OFF
     C     XVEH_AVEO     IFEQ      *BLANKS
     C     EORI          IFNE      *BLANKS
     C                   EVAL      XVEH_AVEO=EORI
KING C                   ELSE
KING C*    SYLAND        IFNE      'NO'
KING C*                  MOVEL     RNRAKU        XVEH_AVEO
KING C*                  ELSE
     C                   MOVEL(P)  SYLAND        XVEH_AVEO
     C                   CAT       SYRG:0        XVEH_AVEO
     C                   CAT       '00':0        XVEH_AVEO
KING C*                  ENDIF
     C                   ENDIF
     C                   ENDIF
     C     XVEH_AVHA     IFEQ      *BLANKS
     C                   EVAL      XVEH_AVHA = KPERS
     C                   ENDIF
     C     XVEH_AVTL     IFEQ      *BLANKS
     C                   EVAL      XVEH_AVTL = TLF
     C                   ENDIF
      * Hent avs.oppl fra kundereg uansett   KINGSRØD
     C                   EVAL      XVEH_AVHA = KPERS
     C                   EVAL      XVEH_AVTL = TLF
     C                   EVAL      XVEH_AVNA = KNAVN
     C                   EVAL      XVEH_AVA1 = ADR1
     C                   EVAL      XVEH_AVA2 = ADR2
     C                   IF        POSTNR = 0
     C                   EVAL      XVEH_AVPA = SYPOGE
     C                   ELSE
     C                   EVAL      XVEH_AVPA = *BLANKS
     C                   MOVEL     POSTNR        XVEH_AVPN
     C                   ENDIF
     C                   MOVEL     ADR3          XVEH_AVPA
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XVEH_AVLK = SYLAND
     C                   ENDIF
     C                   EVAL      XVEH_AVTL = TLF
      *
     C                   ENDIF
     C                   ENDIF
     C     XVEH_AVHA     IFEQ      *BLANKS
     C                   EVAL      XVEH_AVHA=SVTH_NAMN
S06  C*                  EVAL      XVEH_AVTL=SVEA_OMTL
N06  C                   EVAL      XVEH_OMTL=SVTH_TLF
     C                   ENDIF
      *Og bitte lite til fra HEADF
     C     SADKEY        CHAIN     HEADF                              52
     C     *IN52         IFEQ      *OFF
     C                   EVAL      XVEH_TRID=HEHAWB
     C                   EVAL      XVEH_TRAI=HEHAWB
     C                   ENDIF
      * Kopier varelinjer
     C                   CALL      'SVE009R'
     C                   PARM                    ZVEH_SYAV
     C                   PARM                    ZVEH_SYOP
      * Kopier varelinjer
     C                   CALL      'SVE009RX'
     C                   PARM                    ZVEH_SYAV
     C                   PARM                    ZVEH_SYOP

     C                   GOTO      SRB3
     C                   ENDIF
     C                   ENDIF
      *___________________
      * Kopier fra oppdrag
      *"""""""""""""""""""
     C     *IN51         IFEQ      *ON
     C     ZVEH_SYOP     ANDNE     0
     C                   EVAL      Z_SIAVD=ZVEH_SYAV
     C                   EVAL      Z_SITDN=ZVEH_SYOP
     C     SADKEY        CHAIN     HEADF                              52
     C     *IN52         IFEQ      *OFF

     C                   CLEAR                   SVE001DB
     C                   CLEAR                   SVE001DC
     C     UMODE         COMP      'D'                                    27
     C                   EVAL      XVEH_TUID=UVEH_TUID
     C                   EVAL      XVEH_SYAV=ZVEH_SYAV
     C                   EVAL      XVEH_SYOP=ZVEH_SYOP
     C                   EVAL      XVEH_SYSG=ZVEH_SYSG
      * Lag tullid
     C                   CALL      'SVG001R'
     C                   PARM                    XVEH_TUID
     C                   EVAL      UVEH_TUID=XVEH_TUID

     C                   EVAL      XVEH_MTYP='UGE'
     C                   EVAL      XVEH_TART='1'
     C                   EVAL      XVEH_DEK1='EU'
     C                   EVAL      XVEH_DEK2='Z'
     C                   EVAL      XVEH_UPPS='T'
     C                   IF        SVTF_0035='1'
     C                   EVAL      XVEH_GOLK='AZZ'
     C                   ENDIF
     C                   EVAL      XVEH_AVKN=HEKNS
     C                   EVAL      XVEH_AVNA=HENAS
     C                   EVAL      XVEH_AVA1=HEADS1
     C                   EVAL      XVEH_AVA2=HEADS2
     C                   EVAL      P = %SCAN (' ' : HEADS3)
     C                   EVAL      XVEH_AVPN=%SUBST(HEADS3:1:P)
     C                   EVAL      W_PADR=%SUBST(HEADS3:P+1)
     C                   EVAL      XVEH_AVPA=%triml(W_PADR)
     C                   EVAL      XVEH_AVLK=HELKS
     C                   EVAL      XVEH_MOKN=HEKNK
     C                   EVAL      XVEH_MONA=HENAK
     C                   EVAL      XVEH_MOA1=HEADK1
     C                   EVAL      XVEH_MOA2=HEADK2
     C                   EVAL      P = %SCAN (' ' : HEADK3)
     C                   EVAL      XVEH_MOPN=%SUBST(HEADK3:1:P)
     C                   EVAL      W_PADR=%SUBST(HEADK3:P+1)
     C                   EVAL      XVEH_MOPA=%triml(W_PADR)
     C                   EVAL      XVEH_MOLK='SE'
      * Kingsrød spesial, hent mott oppl fra kundereg uansett
     C     XVEH_MOKN     IFNE      0
     C                   MOVE      XVEH_MOKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            40
     C                   IF        *IN40=*OFF
     C                   EVAL      XVEH_MONA = KNAVN
     C                   EVAL      XVEH_MOA1 = ADR1
     C                   EVAL      XVEH_MOA2 = ADR2
     C                   IF        POSTNR = 0
     C                   EVAL      XVEH_MOPN = SYPOGE
     C                   ELSE
     C                   EVAL      XVEH_MOPN = *BLANKS
     C                   MOVEL     POSTNR        XVEH_MOPN
     C                   ENDIF
     C                   EVAL      XVEH_MOPA = ADR3
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XVEH_MOLK = SYLAND
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *
     C                   EVAL      XVEH_OMEO=SVEA_OMEO
     C                   EVAL      XVEH_OMHA=SVTH_NAMN
S06  C*                  EVAL      XVEH_OMTL=SVEA_OMTL
N06  C                   EVAL      XVEH_OMTL=SVTH_TLF
S03  C*                  EVAL      XVEH_OMTY='A'
     C                   EVAL      XVEH_AVUT='SE'
     C                   EVAL      XVEH_AUBE='NO'
     C                   EVAL      XVEH_KOTA=HENT
     C                   EVAL      XVEH_BRUT=HEVKT
     C                   MOVEL     HETRC         XVEH_CONT
     C                   MOVEL     HETRM         XVEH_TRGR
     C                   MOVEL     '3'           XVEH_TRIN
     C                   EVAL      XVEH_TRAL=HETRI
     C                   EVAL      XVEH_TRID=HEHAWB
     C                   EVAL      XVEH_TRAI=HEHAWB
     C     XVEH_TRAI     IFEQ      *BLANKS
     C                   EVAL      XVEH_TRAI=HETRCN
     C                   ENDIF
     C     XVEH_TRID     IFEQ      *BLANKS
     C                   EVAL      XVEH_TRID=HETRCN
     C                   ENDIF
      * hæmta kundinfo
     C     XVEH_AVKN     IFNE      0
     C                   MOVE      XVEH_AVKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            40
     C                   IF        *IN40=*OFF
     C     XVEH_AVEO     IFEQ      *BLANKS
     C     EORI          IFNE      *BLANKS
     C                   EVAL      XVEH_AVEO=EORI
     C                   ELSE
KING C*    SYLAND        IFNE      'NO'
KING C*                  MOVEL     RNRAKU        XVEH_AVEO
KING C*                  ELSE
     C                   MOVEL     SYLAND        XVEH_AVEO
     C                   CAT       SYRG:00       XVEH_AVEO
     C                   CAT       '00':0        SVEH_AVEO
KING C*                  ENDIF
     C                   ENDIF
     C                   ENDIF
     C     XVEH_AVHA     IFEQ      *BLANKS
     C                   EVAL      XVEH_AVHA = KPERS
     C                   ENDIF
     C     XVEH_AVTL     IFEQ      *BLANKS
     C                   EVAL      XVEH_AVTL = TLF
     C                   ENDIF
      * Hent avs.oppl fra kundereg uansett   KINGSRØD
     C                   EVAL      XVEH_AVHA = KPERS
     C                   EVAL      XVEH_AVTL = TLF
     C                   EVAL      XVEH_AVNA = KNAVN
     C                   EVAL      XVEH_AVA1 = ADR1
     C                   EVAL      XVEH_AVA2 = ADR2
     C                   IF        POSTNR = 0
     C                   EVAL      XVEH_AVPA = SYPOGE
     C                   ELSE
     C                   EVAL      XVEH_AVPA = *BLANKS
     C                   MOVEL     POSTNR        XVEH_AVPN
     C                   ENDIF
     C                   MOVEL     ADR3          XVEH_AVPA
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XVEH_AVLK = SYLAND
     C                   ENDIF
     C                   EVAL      XVEH_AVTL = TLF
      *
     C                   ENDIF
     C                   ENDIF
     C     XVEH_AVHA     IFEQ      *BLANKS
     C                   EVAL      XVEH_AVHA=SVTH_NAMN
S06  C*                  EVAL      XVEH_AVTL=SVEA_OMTL
N06  C                   EVAL      XVEH_AVTL=SVTH_TLF
     C                   ENDIF

     C                   GOTO      SRB3
     C                   ENDIF
     C                   ENDIF
      *____________
      * Vis bilde-B
      *""""""""""""
     C     SRB3          TAG
     C                   EXSR      SRBB
     C                   IF        *IN03
     C                   GOTO      SRB9
     C                   ENDIF
     C                   IF        *IN12
     C                   GOTO      SRB9
     C                   ENDIF
      *____________
      * Vis bilde-C
      *""""""""""""
     C                   EXSR      SRBC
     C                   IF        *IN03
     C                   GOTO      SRB9
     C                   ENDIF
     C                   IF        *IN12
     C                   GOTO      SRB3
     C                   ENDIF

      *_____________________
      * Oppdare og gå videre
      *"""""""""""""""""""""
N02  C     UMODE         IFNE      'D'
     C     ZKEY          CHAIN     SVEH                               51
N02  C                   ELSE
N02  C     ZKEY          CHAIN(N)  SVEH                               51
N02  C                   ENDIF

     C                   EVAL      SVEH_SYAV=XVEH_SYAV
     C                   EVAL      SVEH_SYOP=XVEH_SYOP
     C                   EVAL      SVEH_SYSG=XVEH_SYSG
     C                   EVAL      SVEH_TUID=XVEH_TUID
     C                   EVAL      SVEH_MTYP=XVEH_MTYP
     C                   EVAL      SVEH_TART=XVEH_TART
     C                   EVAL      SVEH_DEK1=XVEH_DEK1
     C                   EVAL      SVEH_DEK2=XVEH_DEK2
     C                   EVAL      SVEH_AVKN=XVEH_AVKN
     C                   EVAL      SVEH_AVEO=XVEH_AVEO
     C                   EVAL      SVEH_AVNA=XVEH_AVNA
     C                   EVAL      SVEH_AVA1=XVEH_AVA1
     C                   EVAL      SVEH_AVA2=XVEH_AVA2
     C                   EVAL      SVEH_AVPN=XVEH_AVPN
     C                   EVAL      SVEH_AVPA=XVEH_AVPA
     C                   EVAL      SVEH_AVLK=XVEH_AVLK
     C                   EVAL      SVEH_AVHA=XVEH_AVHA
     C                   EVAL      SVEH_AVTL=XVEH_AVTL
     C                   EVAL      SVEH_MOKN=XVEH_MOKN
     C                   EVAL      SVEH_MOEO=XVEH_MOEO
     C                   EVAL      SVEH_MONA=XVEH_MONA
     C                   EVAL      SVEH_MOA1=XVEH_MOA1
     C                   EVAL      SVEH_MOA2=XVEH_MOA2
     C                   EVAL      SVEH_MOPN=XVEH_MOPN
     C                   EVAL      SVEH_MOPA=XVEH_MOPA
     C                   EVAL      SVEH_MOLK=XVEH_MOLK
     C                   EVAL      SVEH_DKKN=XVEH_DKKN
     C                   EVAL      SVEH_DKEO=XVEH_DKEO
     C                   EVAL      SVEH_DKNA=XVEH_DKNA
     C                   EVAL      SVEH_DKA1=XVEH_DKA1
     C                   EVAL      SVEH_DKA2=XVEH_DKA2
     C                   EVAL      SVEH_DKPN=XVEH_DKPN
     C                   EVAL      SVEH_DKLK=XVEH_DKLK
     C                   EVAL      SVEH_DKPA=XVEH_DKPA
     C                   EVAL      SVEH_OMEO=XVEH_OMEO
     C                   EVAL      SVEH_OMHA=XVEH_OMHA
     C                   EVAL      SVEH_OMTL=XVEH_OMTL
     C                   EVAL      SVEH_OMTY=XVEH_OMTY
     C                   EVAL      SVEH_0035=XVEH_0035
     C                   EVAL      SVEH_VAKD=XVEH_VAKD
     C                   EVAL      SVEH_FABL=XVEH_FABL
     C                   EVAL      SVEH_VAKU=XVEH_VAKU
     C                   EVAL      SVEH_FATY=XVEH_FATY
     C                   EVAL      SVEH_FATX=XVEH_FATX
     C                   EVAL      SVEH_UPPS=XVEH_UPPS
     C                   EVAL      SVEH_AVUT=XVEH_AVUT
     C                   EVAL      SVEH_AUBE=XVEH_AUBE
     C                   EVAL      SVEH_TRID=XVEH_TRID
     C                   EVAL      SVEH_TRAI=XVEH_TRAI
     C                   EVAL      SVEH_TRAL=XVEH_TRAL
     C                   EVAL      SVEH_TRGR=XVEH_TRGR
     C                   EVAL      SVEH_TRIN=XVEH_TRIN
     C                   EVAL      SVEH_CONT=XVEH_CONT
     C                   EVAL      SVEH_GOLK=XVEH_GOLK
     C                   EVAL      SVEH_KOTA=XVEH_KOTA
     C                   EVAL      SVEH_BRUT=XVEH_BRUT
     C                   EVAL      SVEH_KENH=XVEH_KENH
     C                   EVAL      SVEH_KLEO=XVEH_KLEO
     C                   EVAL      SVEH_TRNR=XVEH_TRNR
     C                   EVAL      SVEH_AUKD=XVEH_AUKD
     C                   EVAL      SVEH_RFAC=XVEH_RFAC
     C                   EVAL      SVEH_RFAC2=XVEH_RFAC2
     C                   EVAL      SVEH_RFAC3=XVEH_RFAC3
     C                   EVAL      SVEH_LAST=XVEH_LAST
     C                   EVAL      SVEH_UTFA=XVEH_UTFA
     C                   EVAL      SVEH_TAXD=XVEH_TAXD
     C                   EVAL      SVEH_BEAT=XVEH_BEAT
     C                   EVAL      SVEH_BETK=XVEH_BETK
     C                   EVAL      SVEH_SAOM=XVEH_SAOM
     C                   EVAL      SVEH_KOMR=XVEH_KOMR
     C                   EVAL      SVEH_SEL1=XVEH_SEL1
     C                   EVAL      SVEH_SEL2=XVEH_SEL2
     C                   EVAL      SVEH_RES1=XVEH_RES1
     C                   EVAL      SVEH_RES2=XVEH_RES2
     C                   EVAL      SVEH_RES3=XVEH_RES3
     C                   EVAL      SVEH_RES4=XVEH_RES4
     C                   EVAL      SVEH_RES5=XVEH_RES5
     C                   EVAL      SVEH_RES6=XVEH_RES6
     C                   EVAL      SVEH_RES7=XVEH_RES7
     C                   EVAL      SVEH_RES8=XVEH_RES8
     C                   EVAL      SVEH_KVSA=XVEH_KVSA
     C                   EVAL      SVEH_GODN=XVEH_GODN

     C     UMODE         IFNE      'D'
     C                   IF        *IN51
     C                   MOVE      WDT           SVEH_SYDT
     C                   EVAL      SVEH_SGME='SD'
     C                   MOVEL     SVTH_ANN      SVEH_SGID
     C                   MOVEL     SVEH_SYAV     XVEH_RFAB        11
     C                   MOVE      SVEH_SYOP     XVEH_RFAB
     C                   MOVEL     XVEH_RFAB     SVEH_RFAB
     C                   WRITE     SVEHR
     C                   ELSE
     C                   UPDATE    SVEHR
     C                   ENDIF
     C                   ENDIF

     C   30              GOTO      SRB3

      *  Øver till varuposter
N08  C                   EXSR      CHGLAGI
     C     XVEH_MTYP     IFEQ      'UNU'
     C     XVEH_MTYP     OREQ      'URT'
     C     XVEH_MTYP     OREQ      'UGE'
     C     XVEH_MTYP     OREQ      'UFF'
     C     XVEH_MTYP     OREQ      'UKO'
     C     XVEH_MTYP     OREQ      'UBK'
     C                   CALL      'SVE003R'
     C                   PARM                    XVEH_SYAV
     C                   PARM                    XVEH_SYOP
     C                   PARM                    XVEH_SYSG
     C     *IN03         PARM                    WIN03
     C     *IN12         PARM                    WIN12
     C                   PARM                    UMODE
     C     *IN03         CABEQ     *ON           SRB9
     C     *IN12         CABEQ     *ON           SRB3
     C                   GOTO      SRB1
     C                   ENDIF

     C     SRB9          TAG
      * Oppdater ev. status på ærendet
N02  C     UMODE         IFNE      'D'
     C     ZKEY          CHAIN     SVEH                               51
     C     *IN51         IFEQ      *OFF
     C     SVEH_SYST     ANDEQ     'E'
     C                   EVAL      SVEH_SYST=' '
S02  C*    UMODE         IFNE      'D'
     C                   UPDATE    SVEHR
     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater SVE001DB                         SRBB /
      *////////////////////////////////////////////////////////////
     C     SRBB          BEGSR
      *____________
      * Vis bilde-B
      *""""""""""""
     C                   EVAL      LINNBR=4
     C                   EVAL      POSNBR=67
     C     SRBB3         TAG
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     SVE001DØ
     C                   EXFMT     SVE001DB
     C                   EVAL      *IN30 = *OFF
     C                   EVAL      *IN31 = *OFF
     C                   EVAL      *IN32 = *OFF
     C                   EVAL      *IN33 = *OFF
     C                   EVAL      *IN35 = *OFF
     C                   EVAL      *IN36 = *OFF
     C                   EVAL      *IN39 = *OFF
     C                   EVAL      *IN40 = *OFF
     C                   EVAL      *IN41 = *OFF
     C                   EVAL      *IN49 = *OFF
     C                   EVAL      *IN50 = *OFF
     C                   EVAL      *IN64 = *OFF
     C                   EVAL      *IN66 = *OFF
     C                   EVAL      *IN69 = *OFF
     C                   EVAL      *IN74 = *OFF
     C                   EVAL      *IN75 = *OFF
     C                   EVAL      *IN76 = *OFF
     C                   EVAL      *IN77 = *OFF
     C                   EVAL      *IN78 = *OFF
     C                   EVAL      *IN79 = *OFF
     C                   EVAL      *IN80 = *OFF
     C                   EVAL      *IN83 = *OFF
     C                   EVAL      *IN84 = *OFF
     C                   EVAL      *IN85 = *OFF
     C                   EVAL      *IN86 = *OFF
     C                   EVAL      *IN87 = *OFF
     C                   EVAL      *IN88 = *OFF
     C                   EVAL      *IN89 = *OFF
      *_______________
      * F3,F12=Avlsutt
      *"""""""""""""""
     C                   IF        *IN03
     C                   GOTO      SRBB9
     C                   ENDIF
     C                   IF        *IN12
     C                   GOTO      SRBB9
     C                   ENDIF
      *_______
      * F4=Søk
      *"""""""
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN04         IFEQ      '1'
      * Rubrik 2, avsændare
     C     LINNBR        IFEQ      6
     C     POSNBR        ANDGE     9
     C     POSNBR        ANDLE     16
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    XVEH_AVKN
     C                   PARM                    UFIRM
     C                   PARM                    USØKKN
     C                   ENDIF
      * Avsændare, landkod
     C     LINNBR        IFEQ      7
     C     POSNBR        ANDGE     91
     C     POSNBR        ANDLE     92
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'E'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVEH_AVLK=UKD
     C                   ENDIF
     C                   ENDIF
      * Rubrik 8, mottagare
     C     LINNBR        IFEQ      10
     C     POSNBR        ANDGE     9
     C     POSNBR        ANDLE     16
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    XVEH_MOKN
     C                   PARM                    UFIRM
     C                   PARM                    USØKKN
     C                   ENDIF
      * Mottagare, landkod
     C     LINNBR        IFEQ      11
     C     POSNBR        ANDGE     91
     C     POSNBR        ANDLE     92
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'E'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVEH_MOLK=UKD
     C                   ENDIF
     C                   ENDIF
      * Rubrik 44, fakturor
     C     LINNBR        IFEQ      14
     C     POSNBR        ANDGE     49
     C     POSNBR        ANDLE     62
     C                   CALL      'SVE002R'
     C                   PARM                    XVEH_SYAV
     C                   PARM                    XVEH_SYOP
     C                   PARM                    ÅVEF_VAKD
     C                   PARM                    ÅVEF_VAKU
     C                   PARM                    ÅVEF_FABL
     C     XVEH_VAKD     IFEQ      *BLANKS
     C     XVEH_VAKU     ANDEQ     0
     C     XVEH_FABL     ANDEQ     0
     C                   EVAL      XVEH_VAKD=ÅVEF_VAKD
     C                   EVAL      XVEH_VAKU=ÅVEF_VAKU
     C                   EVAL      XVEH_FABL=ÅVEF_FABL
     C                   ENDIF
     C                   ENDIF
      * Rubrik 22, valuta
     C     LINNBR        IFEQ      13
     C     POSNBR        ANDGE     17
     C     POSNBR        ANDLE     19
     C                   CALL      'SVT007R'
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVEH_VAKD=UKD
     C                   ENDIF
     C                   ENDIF
      * Rubrik 15, landkod
     C     LINNBR        IFEQ      14
     C     POSNBR        ANDGE     17
     C     POSNBR        ANDLE     19
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'E'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVEH_AVUT=UKD
     C                   ENDIF
     C                   ENDIF
      * Rubrik 17, landkod
     C     LINNBR        IFEQ      14
     C     POSNBR        ANDGE     20
     C     POSNBR        ANDLE     21
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'E'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVEH_AUBE=UKD
     C                   ENDIF
     C                   ENDIF
      * Rubrik 18, landkod
     C     LINNBR        IFEQ      17
     C     POSNBR        ANDGE     70
     C     POSNBR        ANDLE     71
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'E'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVEH_TRAL=UKD
     C                   ENDIF
     C                   ENDIF
      * Rubrik 29 Utf.kontor
     C     LINNBR        IFEQ      19
E10  C     POSNBR        ANDGE     75
     C     POSNBR        ANDLE     82
     C                   CALL      'SVX002R'
     C                   PARM      '106'         UUNIK             3
     C                   PARM      '          '  UKODE            10
     C                   PARM      'AVG'         UTYPE             3
     C     UKODE         IFNE      *BLANKS
     C                   EVAL      XVEH_UTFA=UKODE
     C                   ENDIF
     C                   ENDIF
      * Bilagda handlingar, kod
     C     LINNBR        IFEQ      14
     C     POSNBR        ANDGE     67
     C     POSNBR        ANDLE     70
     C                   CALL      'SVT003R'
     C                   PARM      'MCF'         UTYP
     C                   PARM      'A'           UIE
     C                   PARM      WDT           UDATO
     C                   PARM                    UKD
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVEH_FATY=UKD
     C                   ENDIF
     C                   GOTO      SRBB3
     C                   ENDIF
      * Transitnummer, landkod
     C     LINNBR        IFEQ      24
     C     POSNBR        ANDEQ     39
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'E'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM                    UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVEH_AUKD=UKD
     C                   ENDIF
     C                   ENDIF
     C                   GOTO      SRBB3
     C                   ENDIF
      *_________________________
      * F9=Extra text på rubr.44
      *"""""""""""""""""""""""""
     C     *IN09         IFEQ      *ON
     C                   CALL      'SVE033R'
     C                   PARM                    XVEH_SYAV
     C                   PARM                    XVEH_SYOP
     C                   GOTO      SRBB3
     C                   ENDIF
      *___________
      * Test input
      *"""""""""""
      * Meddelandetyp
     C     XVEH_MTYP     COMP      'UNU'                                  20
     C  N20XVEH_MTYP     COMP      'URT'                                  20
     C  N20XVEH_MTYP     COMP      'UKO'                                  20
     C  N20XVEH_MTYP     COMP      'UBK'                                  20
     C  N20XVEH_MTYP     COMP      'UGE'                                  20
     C  N20XVEH_MTYP     COMP      'UFF'                                  20
     C     *IN20         IFEQ      *OFF
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN31=*ON
     C                   MOVE      'SVE0003'     ZMSGNO
     C                   EVAL      LINNBR=4
     C                   EVAL      POSNBR=67
     C                   GOTO      SRBB3
     C                   ENDIF
      * 1. Deklaration del-1
     C     XVEH_MTYP     IFNE      'UKO'
     C     XVEH_MTYP     ANDNE     'UBK'
     C     XVEH_DEK1     COMP      'CO'                                   20
     C  N20XVEH_DEK1     COMP      'EU'                                   20
     C  N20XVEH_DEK1     COMP      'EX'                                   20
     C     *IN20         IFEQ      *OFF
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN32=*ON
     C                   MOVE      'SVE0005'     ZMSGNO
     C                   EVAL      LINNBR=4
     C                   EVAL      POSNBR=88
     C                   GOTO      SRBB3
     C                   ENDIF
      * 1. Deklaration del-2
     C     XVEH_DEK2     COMP      'A'                                    20
     C  N20XVEH_DEK2     COMP      'C'                                    20
     C  N20XVEH_DEK2     COMP      'Y'                                    20
     C  N20XVEH_DEK2     COMP      'Z'                                    20
     C     *IN20         IFEQ      *OFF
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN32=*ON
     C                   MOVE      'SVE0042'     ZMSGNO
     C                   EVAL      LINNBR=4
     C                   EVAL      POSNBR=91
     C                   GOTO      SRBB3
     C                   ENDIF
      * 1. Riktig dekl.typ i førhållande till medd.typ ?
     C     XVEH_DEK2     IFEQ      'Z '
     C     XVEH_MTYP     ANDEQ     'UNU'
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN32=*ON
     C                   MOVE      'SVE0045'     ZMSGNO
     C                   EVAL      LINNBR=4
     C                   EVAL      POSNBR=91
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
      * 2. Avsændar kundenr
     C     XVEH_AVKN     IFNE      0
     C                   MOVE      XVEH_AVKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            35
     C                   IF        *IN35=*ON
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SPK0001'     ZMSGNO
     C                   EVAL      LINNBR=6
     C                   EVAL      POSNBR=9
     C                   GOTO      SRBB3
     C                   ELSE
     C     XVEH_AVEO     IFEQ      *BLANKS
     C     EORI          IFNE      *BLANKS
     C                   EVAL      XVEH_AVEO=EORI
     C                   ELSE
KING C*    SYLAND        IFNE      'NO'
KING C*                  MOVEL     RNRAKU        XVEH_AVEO
KING C*                  ELSE
     C                   MOVEL     SYLAND        XVEH_AVEO
     C                   CAT       SYRG:0        XVEH_AVEO
     C                   CAT       '00':0        XVEH_AVEO
KING C*                  ENDIF
     C                   ENDIF
     C                   ENDIF
     C     XVEH_AVHA     IFEQ      *BLANKS
     C                   EVAL      XVEH_AVHA = KPERS
     C                   ENDIF
     C     XVEH_AVTL     IFEQ      *BLANKS
     C                   EVAL      XVEH_AVTL = TLF
     C                   ENDIF
     C     XVEH_AVNA     IFEQ      *BLANKS
     C                   EVAL      XVEH_AVNA = KNAVN
     C                   EVAL      XVEH_AVA1 = ADR1
     C                   EVAL      XVEH_AVA2 = ADR2
     C                   IF        POSTNR = 0
     C                   EVAL      XVEH_AVPN = SYPOGE
     C                   ELSE
     C                   MOVEL     POSTNR        XVEH_AVPN
     C                   ENDIF
     C                   MOVEL     ADR3          XVEH_AVPA
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XVEH_AVLK = SYLAND
     C                   ENDIF
     C                   EVAL      XVEH_AVTL = TLF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      * 2. Avsændar EORI
     C     XVEH_MTYP     IFNE      'UKO'
S04  C*    XVEH_AVEO     IFEQ      *BLANKS
N04  C                   IF        %SUBST(XVEH_AVEO:3:1)= *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN41=*ON
     C                   MOVE      'SVI0013'     ZMSGNO
     C                   EVAL      LINNBR=6
     C                   EVAL      POSNBR=18
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
      * 2. Avsændar namn
     C     XVEH_AVEO     IFEQ      *BLANKS
     C     XVEH_AVNA     ANDEQ     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN36=*ON
     C                   MOVE      'SVE0010'     ZMSGNO
     C                   EVAL      LINNBR=6
     C                   EVAL      POSNBR=45
     C                   GOTO      SRBB3
     C                   ENDIF
      * 2. Adressrad 1
     C     XVEH_AVEO     IFEQ      *BLANKS
     C     XVEH_AVA1     ANDEQ     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN36=*ON
     C                   MOVE      'SVE0053'     ZMSGNO
     C                   EVAL      LINNBR=6
     C                   EVAL      POSNBR=81
     C                   GOTO      SRBB3
     C                   ENDIF
      * 2. Adressrad 2
     C     XVEH_AVEO     IFEQ      *BLANKS
     C     XVEH_AVA1     ANDEQ     *BLANKS
     C     XVEH_AVA2     ANDNE     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN36=*ON
     C                   MOVE      'SVE0054'     ZMSGNO
     C                   EVAL      LINNBR=7
     C                   EVAL      POSNBR=9
     C                   GOTO      SRBB3
     C                   ENDIF
      * 2. Avsændar postadress
     C     XVEH_AVEO     IFEQ      *BLANKS
     C     XVEH_AVPA     ANDEQ     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN39=*ON
     C                   MOVE      'SVE0011'     ZMSGNO
     C                   EVAL      LINNBR=7
     C                   EVAL      POSNBR=55
     C                   GOTO      SRBB3
     C                   ENDIF
      * 2. Avsændare, landkod
     C     XVEH_AVEO     IFEQ      *BLANKS
     C     XVEH_AVLK     ANDEQ     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVE0009'     ZMSGNO
     C                   EVAL      LINNBR=7
     C                   EVAL      POSNBR=91
     C                   GOTO      SRBB3
     C                   ENDIF
     C     XVEH_AVEO     IFEQ      *BLANKS
     C                   EVAL      UIE='A'
     C                   EVAL      UTYP='GCY'
     C                   EVAL      UKD=*BLANKS
     C                   EVAL      UKD=XVEH_AVLK
     C     SVTX03K       CHAIN     SVTX03F                            30
     C                   IF        *IN30
     C                   MOVE      'SVE0009'     ZMSGNO
     C                   EVAL      LINNBR=7
     C                   EVAL      POSNBR=91
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
      * 2. Avsændare, handlæggare
     C     XVEH_AVHA     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN50=*ON
     C                   MOVE      'SVE0014'     ZMSGNO
     C                   EVAL      LINNBR=8
     C                   EVAL      POSNBR=9
     C                   GOTO      SRBB3
     C                   ENDIF
      * 2. Avsændare, telefonnummer
     C     XVEH_AVTL     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN50=*ON
     C                   MOVE      'SVE0015'     ZMSGNO
     C                   EVAL      LINNBR=8
     C                   EVAL      POSNBR=45
     C                   GOTO      SRBB3
     C                   ENDIF
      * 8. Mottagare kundenr
     C     XVEH_MOKN     IFNE      0
     C                   MOVE      XVEH_MOKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            40
     C                   IF        *IN40=*ON
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SPK0001'     ZMSGNO
     C                   EVAL      LINNBR=10
     C                   EVAL      POSNBR=9
     C                   GOTO      SRBB3
     C                   ELSE
     C     XVEH_MONA     IFEQ      *BLANKS
     C                   EVAL      XVEH_MONA = KNAVN
     C                   EVAL      XVEH_MOA1 = ADR1
     C                   EVAL      XVEH_MOA2 = ADR2
     C                   IF        POSTNR = 0
     C                   EVAL      XVEH_MOPN = SYPOGE
     C                   ELSE
     C                   EVAL      XVEH_MOPN = *BLANKS
     C                   MOVEL     POSTNR        XVEH_MOPN
     C                   ENDIF
     C                   EVAL      XVEH_MOPA = ADR3
     C                   IF        SYLAND <> *BLANKS
     C                   EVAL      XVEH_MOLK = SYLAND
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
N07   * 8. Mottagare EORI
N07  C     XVEH_MOEO     IFNE      *BLANKS
N07  C                   IF        %SUBST(XVEH_MOEO:3:1)= *BLANKS
N07  C                   EVAL      *IN30=*ON
N07  C                   EVAL      *IN41=*ON
N07  C                   MOVE      'SVI0013'     ZMSGNO
N07  C                   EVAL      LINNBR=10
N07  C                   EVAL      POSNBR=18
N07  C                   GOTO      SRBB3
N07  C                   ENDIF
N07  C                   ENDIF
      * 8. Mottagare namn
     C     XVEH_MONA     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVE0010'     ZMSGNO
     C                   EVAL      LINNBR=10
     C                   EVAL      POSNBR=45
     C                   GOTO      SRBB3
     C                   ENDIF
      * 8. Adressrad 1
     C     XVEH_MOA1     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN36=*ON
     C                   MOVE      'SVE0053'     ZMSGNO
     C                   EVAL      LINNBR=10
     C                   EVAL      POSNBR=81
     C                   GOTO      SRBB3
     C                   ENDIF
      * 8. Adressrad 2
     C     XVEH_MOA1     IFEQ      *BLANKS
     C     XVEH_MOA2     ANDNE     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN36=*ON
     C                   MOVE      'SVE0054'     ZMSGNO
     C                   EVAL      LINNBR=11
     C                   EVAL      POSNBR=9
     C                   GOTO      SRBB3
     C                   ENDIF
      * 8. Mottagare postadress
     C     XVEH_MOPA     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVE0011'     ZMSGNO
     C                   EVAL      LINNBR=11
     C                   EVAL      POSNBR=55
     C                   GOTO      SRBB3
     C                   ENDIF
      * 8. Mottagare, landkod
     C     XVEH_MOLK     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVE0009'     ZMSGNO
     C                   EVAL      LINNBR=11
     C                   EVAL      POSNBR=91
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   EVAL      UIE='A'
     C                   EVAL      UTYP='GCY'
     C                   EVAL      UKD=*BLANKS
     C                   EVAL      UKD=XVEH_MOLK
     C     SVTX03K       CHAIN     SVTX03F                            30
     C                   IF        *IN30
     C                   MOVE      'SVE0009'     ZMSGNO
     C                   EVAL      LINNBR=11
     C                   EVAL      POSNBR=91
     C                   GOTO      SRBB3
     C                   ENDIF
      * 22. Valutakod
     C     XVEH_VAKD     IFNE      *BLANKS
     C     XVEH_VAKD     CHAIN     SVTVK                              66
     C     *IN66         IFEQ      *ON
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVE0008'     ZMSGNO
     C                   EVAL      LINNBR=13
     C                   EVAL      POSNBR=17
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
     C     XVEH_VAKD     IFNE      *BLANKS
     C     XVEH_VAKU     ANDEQ     *ZEROS
     C                   EVAL      ZVVK_KD=XVEH_VAKD
     C     SVTVKKEY      SETGT     SVTVK
     C                   READP     SVTVK                                  64
     C     *IN64         IFEQ      *OFF
     C                   EVAL      XVEH_VAKU=SVVK_KRS
     C                   ENDIF
     C                   ENDIF
      * 15. Landkod
     C     XVEH_MTYP     IFNE      'UKO'
     C     XVEH_MTYP     ANDNE     'UKB'
     C     XVEH_AVUT     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN74=*ON
     C                   MOVE      'SVE0009'     ZMSGNO
     C                   EVAL      LINNBR=14
     C                   EVAL      POSNBR=17
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   EVAL      UIE='A'
     C                   EVAL      UTYP='GCY'
     C                   EVAL      UKD=*BLANKS
     C                   EVAL      UKD=XVEH_AVUT
     C     SVTX03K       CHAIN     SVTX03F                            30
     C                   IF        *IN30
     C                   EVAL      *IN74=*ON
     C                   MOVE      'SVE0009'     ZMSGNO
     C                   EVAL      LINNBR=14
     C                   EVAL      POSNBR=17
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
      * 17. Landkod
     C     XVEH_MTYP     IFNE      'UKO'
     C     XVEH_MTYP     ANDNE     'UKB'
     C     XVEH_AUBE     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN75=*ON
     C                   MOVE      'SVE0009'     ZMSGNO
     C                   EVAL      LINNBR=14
     C                   EVAL      POSNBR=20
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   EVAL      UIE='A'
     C                   EVAL      UTYP='GCY'
     C                   EVAL      UKD=*BLANKS
     C                   EVAL      UKD=XVEH_AUBE
     C     SVTX03K       CHAIN     SVTX03F                            30
     C                   IF        *IN30
     C                   EVAL      *IN75=*ON
     C                   MOVE      'SVE0009'     ZMSGNO
     C                   EVAL      LINNBR=14
     C                   EVAL      POSNBR=20
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
      * 18. Landkod
     C     XVEH_TRAL     IFNE      *BLANKS
     C                   EVAL      UIE='A'
     C                   EVAL      UTYP='GCY'
     C                   EVAL      UKD=*BLANKS
     C                   EVAL      UKD=XVEH_TRAL
     C     SVTX03K       CHAIN     SVTX03F                            30
     C                   IF        *IN30
     C                   EVAL      *IN76=*ON
     C                   MOVE      'SVE0009'     ZMSGNO
     C                   EVAL      LINNBR=17
     C                   EVAL      POSNBR=70
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
      * 25. Transportsætt vid græns
     C     XVEH_MTYP     IFEQ      'UGE'
     C     XVEH_MTYP     OREQ      'UFF'
     C     XVEH_TRGR     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN77=*ON
     C                   MOVE      'SVE0016'     ZMSGNO
     C                   EVAL      LINNBR=17
     C                   EVAL      POSNBR=17
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
      * 26. Transportsætt inrikes
     C     XVEH_MTYP     IFEQ      'UGE'
     C     XVEH_MTYP     OREQ      'UFF'
     C     XVEH_TRIN     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN78=*ON
     C                   MOVE      'SVE0017'     ZMSGNO
     C                   EVAL      LINNBR=16
     C                   EVAL      POSNBR=17
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
      * 29. Utfartstullkontor
     C     XVEH_MTYP     IFEQ      'UBK'
     C     XVEH_MTYP     OREQ      'UGE'
     C     XVEH_UTFA     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVE0044'     ZMSGNO
     C                   EVAL      LINNBR=19
E10  C                   EVAL      POSNBR=75
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF
      * 6. Kollital
     C     XVEH_MTYP     IFNE      'UKO'
     C     XVEH_MTYP     ANDNE     'UKB'
     C     XVEH_KOTA     ANDEQ     *ZEROS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN83=*ON
     C                   MOVE      'SVE0012'     ZMSGNO
     C                   EVAL      LINNBR=19
     C                   EVAL      POSNBR=17
     C                   GOTO      SRBB3
     C                   ENDIF
      * 19. Containerkod
S09  C*    XVEH_MTYP     IFNE      'UKO'
S09  C*    XVEH_MTYP     ANDNE     'UBK'
     C     XVEH_CONT     IFLT      '0 '
     C     XVEH_CONT     ORGT      '1 '
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVE0046'     ZMSGNO
     C                   EVAL      LINNBR=19
S09  C*                  EVAL      POSNBR=98
N09  C                   EVAL      POSNBR=100
     C                   GOTO      SRBB3
     C                   ENDIF
S09  C*                  ENDIF
      * Taxebestæmmande dag
     C     XVEH_MTYP     IFEQ      'UFF'
     C     XVEH_TAXD     ANDLT     1
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVE0059'     ZMSGNO
     C                   EVAL      LINNBR=24
     C                   EVAL      POSNBR=104
     C                   GOTO      SRBB3
     C                   ENDIF
      * Beræknad avgångstid
     C     XVEH_MTYP     IFEQ      'UGE'
     C     XVEH_BEAT     ANDEQ     *ZEROS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN51=*ON
     C                   MOVE      'SVE0048'     ZMSGNO
     C                   EVAL      LINNBR=24
     C                   EVAL      POSNBR=78
     C                   GOTO      SRBB3
     C                   ENDIF
      * Transitnummer, landkod
     C     XVEH_AUKD     IFEQ      *BLANKS
     C     XVEH_TRNR     ANDNE     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN92=*ON
     C                   MOVE      'SVE0009'     ZMSGNO
     C                   EVAL      LINNBR=24
     C                   EVAL      POSNBR=39
     C                   GOTO      SRBB3
     C                   ENDIF
      * Transit, landkod
     C     XVEH_AUKD     IFNE      *BLANKS
     C                   EVAL      UIE='A'
     C                   EVAL      UTYP='GCY'
     C                   EVAL      UKD=*BLANKS
     C                   EVAL      UKD=XVEH_AUKD
     C     SVTX03K       CHAIN     SVTX03F                            30
     C                   IF        *IN30
     C                   MOVE      'SVE0009'     ZMSGNO
     C                   EVAL      LINNBR=24
     C                   EVAL      POSNBR=39
     C                   GOTO      SRBB3
     C                   ENDIF
     C                   ENDIF

     C     SRBB9         TAG

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater SVE001DC                         SRBC /
      *////////////////////////////////////////////////////////////
     C     SRBC          BEGSR
      *_____________________________________________________________________
      * Ny eller gammal, kopiera mottagaruppgifter till deklarant, om blankt
      *"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     XVEH_DKNA     IFEQ      *BLANKS
     C                   EVAL      XVEH_DKKN=XVEH_AVKN
     C                   EVAL      XVEH_DKEO=XVEH_AVEO
     C                   EVAL      XVEH_DKNA=XVEH_AVNA
     C                   EVAL      XVEH_DKA1=XVEH_AVA1
     C                   EVAL      XVEH_DKA2=XVEH_AVA2
     C                   EVAL      XVEH_DKPN=XVEH_AVPN
     C                   EVAL      XVEH_DKPA=XVEH_AVPA
     C                   EVAL      XVEH_DKLK=XVEH_AVLK
     C                   ENDIF
      *____________
      * Vis bilde-C
      *""""""""""""
     C                   EVAL      LINNBR=10
     C                   EVAL      POSNBR=16
     C     SRBC3         TAG
     C  N30              MOVE      'SY00000'     ZMSGNO
     C                   WRITE     SVE001DØ
     C                   EXFMT     SVE001DC
     C                   EVAL      *IN30 = *OFF
     C                   EVAL      *IN51 = *OFF
     C                   EVAL      *IN92 = *OFF
      *_______________
      * F3,F12=Avlsutt
      *"""""""""""""""
     C                   IF        *IN03
     C                   GOTO      SRBC9
     C                   ENDIF
     C                   IF        *IN12
     C                   GOTO      SRBC9
     C                   ENDIF
      *_______
      * F4=Søk
      *"""""""
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C     *IN04         IFEQ      '1'
      * Rubrik 14, deklarant
     C     LINNBR        IFEQ      5
     C     POSNBR        ANDGE     5
     C     POSNBR        ANDLE     16
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    XVEH_DKKN
     C                   PARM                    UFIRM
     C                   PARM                    USØKKN
     C                   ENDIF
      * Deklarant, landkod
     C     LINNBR        IFEQ      6
     C     POSNBR        ANDGE     98
     C     POSNBR        ANDLE     99
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'E'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM      *BLANKS       UKD              10
     C     UKD           IFNE      *BLANKS
     C                   EVAL      XVEH_DKLK=UKD
     C                   ENDIF
     C                   ENDIF
      * Resplan, landkod
     C     XVEH_MTYP     IFNE      'UNU'
     C     LINNBR        IFEQ      10
     C     POSNBR        IFGE      16
     C     POSNBR        ANDLE     38
     C                   CALL      'SVT003R'
     C                   PARM      'GCY'         UTYP              3
     C                   PARM      'E'           UIE               1
     C                   PARM      WDT           UDATO             8
     C                   PARM      *BLANKS       UKD              10
     C     UKD           IFNE      *BLANKS
     C                   SELECT
     C     POSNBR        WHENEQ    16
     C                   EVAL      XVEH_RES1=UKD
     C     POSNBR        WHENEQ    19
     C                   EVAL      XVEH_RES2=UKD
     C     POSNBR        WHENEQ    22
     C                   EVAL      XVEH_RES3=UKD
     C     POSNBR        WHENEQ    25
     C                   EVAL      XVEH_RES4=UKD
     C     POSNBR        WHENEQ    28
     C                   EVAL      XVEH_RES5=UKD
     C     POSNBR        WHENEQ    31
     C                   EVAL      XVEH_RES6=UKD
     C     POSNBR        WHENEQ    34
     C                   EVAL      XVEH_RES7=UKD
     C     POSNBR        WHENEQ    37
     C                   EVAL      XVEH_RES8=UKD
     C                   ENDSL
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *___________
      * Test input
      *"""""""""""
      * 14. Deklarant kundenr
     C     XVEH_DKKN     IFNE      0
     C                   MOVE      XVEH_DKKN     KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            51
     C                   IF        *IN51=*ON
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SPK0001'     ZMSGNO
     C                   EVAL      LINNBR=5
     C                   EVAL      POSNBR=16
     C                   GOTO      SRBC3
     C                   ELSE
     C     XVEH_DKEO     IFEQ      *BLANKS
     C     EORI          IFNE      *BLANKS
     C                   EVAL      XVEH_DKEO=EORI
     C                   ELSE
     C                   MOVEL     SYLAND        XVEH_DKEO
     C                   CAT       RNRAKU:0      XVEH_DKEO
     C                   CAT       '00':0        XVEH_DKEO
     C                   ENDIF
     C                   ENDIF
     C     XVEH_DKA1     IFEQ      *BLANKS
N05  C                   EVAL      XVEH_DKNA = KNAVN
     C                   EVAL      XVEH_DKA1 = ADR1
     C                   EVAL      XVEH_DKA2 = ADR2
     C                   IF        POSTNR = 0
     C                   EVAL      XVEH_DKPN = SYPOGE
     C                   ELSE
     C                   EVAL      XVEH_DKPN = *BLANKS
     C                   MOVEL     POSTNR        XVEH_DKPN
     C                   ENDIF
     C                   EVAL      XVEH_DKPA = ADR3
N05  C                   EVAL      XVEH_DKLK = SYLAND
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      * 2. Deklarant EORI
S04  C*    XVEH_DKEO     IFEQ      *BLANKS
N04  C                   IF        %SUBST(XVEH_DKEO:3:1)= *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0013'     ZMSGNO
     C                   EVAL      LINNBR=5
     C                   EVAL      POSNBR=25
     C                   GOTO      SRBC3
     C                   ENDIF
      * 14. Deklarant Namn
     C     XVEH_DKNA     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVE0010'     ZMSGNO
     C                   EVAL      LINNBR=5
     C                   EVAL      POSNBR=52
     C                   GOTO      SRBC3
     C                   ENDIF
      * 14. Deklarant Adressrad 1
     C     XVEH_DKA1     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVE0054'     ZMSGNO
     C                   EVAL      LINNBR=5
     C                   EVAL      POSNBR=88
     C                   GOTO      SRBC3
     C                   ENDIF
      * 14. Adress
     C     XVEH_DKA1     IFEQ      *BLANKS
     C     XVEH_DKA2     ANDNE     *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVE0045'     ZMSGNO
     C                   EVAL      LINNBR=5
     C                   EVAL      POSNBR=88
     C                   GOTO      SRBC3
     C                   ENDIF
      * Deklarant , landkod
     C                   EVAL      UIE='A'
     C                   EVAL      UTYP='GCY'
     C                   EVAL      UKD=*BLANKS
     C                   EVAL      UKD=XVEH_DKLK
     C     SVTX03K       CHAIN     SVTX03F                            30
     C                   IF        *IN30
     C                   MOVE      'SVE0009'     ZMSGNO
     C                   EVAL      LINNBR=6
     C                   EVAL      POSNBR=98
     C                   GOTO      SRBC3
     C                   ENDIF
      * 14. Ombud EORI
S07  C*    XVEH_OMEO     IFEQ      *BLANKS
N07  C                   IF        %SUBST(XVEH_OMEO:3:1)= *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVI0013'     ZMSGNO
     C                   EVAL      LINNBR=8
     C                   EVAL      POSNBR=21
     C                   GOTO      SRBC3
     C                   ENDIF
      * 14. Ombud typ
     C     XVEH_OMTY     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVE0052'     ZMSGNO
     C                   EVAL      LINNBR=8
     C                   EVAL      POSNBR=39
     C                   GOTO      SRBC3
     C                   ENDIF
      * 14. Ombud, handlæggare
     C     XVEH_OMHA     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   MOVE      'SVE0014'     ZMSGNO
     C                   EVAL      LINNBR=8
     C                   EVAL      POSNBR=52
     C                   GOTO      SRBC3
     C                   ENDIF
      * 14. Ombud, telefonnummer
     C     XVEH_OMTL     IFEQ      *BLANKS
     C                   EVAL      *IN30=*ON
     C                   EVAL      *IN50=*ON
     C                   MOVE      'SVE0015'     ZMSGNO
     C                   EVAL      LINNBR=8
     C                   EVAL      POSNBR=88
     C                   GOTO      SRBC3
     C                   ENDIF
      * Betalningsstætt før transportkostnader, kod
     C     XVEH_BETK     IFNE      *BLANKS
     C     XVEH_BETK     COMP      'A'                                3030
     C   30XVEH_BETK     COMP      'B'                                3030
     C   30XVEH_BETK     COMP      'C'                                3030
     C   30XVEH_BETK     COMP      'D'                                3030
     C   30XVEH_BETK     COMP      'H'                                3030
     C   30XVEH_BETK     COMP      'Y'                                3030
     C   30XVEH_BETK     COMP      'Z'                                3030
     C                   IF        *IN30
     C                   MOVE      'SVE0049'     ZMSGNO
     C                   EVAL      LINNBR=10
     C                   EVAL      POSNBR=55
     C                   GOTO      SRBC3
     C                   ENDIF
     C                   ENDIF
      * Særskilda omstændigheter, kod
     C     XVEH_SAOM     IFNE      *BLANKS
     C     XVEH_SAOM     COMP      'A'                                3030
     C   30XVEH_SAOM     COMP      'B'                                3030
     C   30XVEH_SAOM     COMP      'E'                                3030
     C                   IF        *IN30
     C                   MOVE      'SVE0050'     ZMSGNO
     C                   EVAL      LINNBR=10
     C                   EVAL      POSNBR=74
     C                   GOTO      SRBC3
     C                   ENDIF
     C                   ENDIF

     C     SRBC9         TAG

     C                   ENDSR
N08   *////////////////////////////////////////////////////////////
N08   *  Ændra førfarande på alla varulinjer              CHGLAGI /
N08   *////////////////////////////////////////////////////////////
N08  C     CHGLAGI       BEGSR
N08  C     UMODE         IFNE      'D'
N08  C                   EVAL      *IN54=*OFF
N08  C     ZKEY          SETLL     SVEV
N08  C     ZKEY          READE     SVEV                                   54
N08  C     *IN54         DOWEQ     *OFF
N08  C     XVEH_GODN     IFNE      *BLANKS
N08  C                   IF        SVEV_LAGI=*BLANKS
N08  C                   EVAL      SVEV_LAGI=XVEH_GODN
N08  C                   EVAL      SVEV_LAGT='A'
N08  C                   EVAL      SVEV_LAGL='SE'
N08  C                   ENDIF
N08  C                   ENDIF
N08  C                   UPDATE    SVEVR
N08  C     ZKEY          READE     SVEV                                   54
N08  C                   ENDDO
N08  C                   ENDIF
N08  C                   ENDSR
