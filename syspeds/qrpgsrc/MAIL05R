********************************************************************
""""" *   VEDLIKEHOLD AV KUNDES KONTAKTPERSON/FUNKSJON             *
""""" *   OBS! Programmet er litt primitivt - TRYNER hvis 0 records*
""""" *        Derfor: Kallende prog ansvarlig for at minst en     *
""""" *                record finnes (evt av firltert type)        *
********************************************************************
     FFIRM      IF   E           K DISK
     FCUNDC     UF A E             DISK
     F                                     INFDS(CUNDS)
     FCUNDC01   IF   E           K DISK
     F                                     INFDS(CUNDS1)
     F                                     RENAME(CUNDCR:CUNDCR1)
     FCUNDL01   IF   E           K DISK
     Fmail05d   CF   E             WORKSTN
     F                                     SFILE(VCUNDCD4:ZRECNO)
     F                                     INFDS(FBAREA)
     D TXT             S             15    DIM(1) CTDATA PERRCD(1)
     D CUNDS           DS
     D  RRNP                 397    400B 0
     D CUNDS1          DS
     D  RRNP1                397    400B 0
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
      *
     C     START0        TAG
     C                   EXSR      INIT
      *______________
      * Clear Subfile
      *""""""""""""""
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     VCUNDCD5
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
      *_____________
      * Fill Subfile
      *"""""""""""""
     C     CUNKY1        SETLL     CUNDC01
     C     CUNKY1        READE     CUNDC01                                94
     c   94              goto      start5
     C     CUNKY1        SETLL     CUNDC01
      *
     C     START1        TAG
     C                   DO        13
     C     NEXT          TAG
     C     CUNKY1        READE     CUNDC01                                94
     C     *IN94         IFEQ      '0'
     C   55KUNFUN        CABNE     CTYPE         NEXT
     C                   MOVE      RRNP1         SFRRN
     C                   MOVE      CCONTA        SFONTA
     c     SFONTA        ifeq      *blank
     C                   eval      SFONTA = 'Kpers mm. mangler! 2=Endre..'
     C                   end
     C                   MOVEL     CTYPE         SFYPE
     C                   MOVEL     CPHONE        SFHONE
     C                   ADD       1             ZRECNO
     C                   Z-ADD     ZRECNO        CURS1
     C                   WRITE     VCUNDCD4
     C                   END                                                    <*IN94
     C  N94              ENDDO
      *
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C     YRECNO        IFGT      0
     C     YRECNO        SUB       1             ZRECNO
     C     ZRECNO        DIV       13            ZRECNO
     C     ZRECNO        MULT      13            ZRECNO
     C                   ADD       1             ZRECNO
     C                   ENDIF
      *________________
      * Display Subfile
      *""""""""""""""""
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C                   MOVE      '0'           *IN31
     C                   WRITE     VCUNDCD5
     C                   Z-ADD     WSSUBN        XRECNO
     C                   EXFMT     VCUNDCD3
     C                   READ      VCUNDCD5                               66
      *
     C     FKEYS         TAG
      *
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   END
      *
     C                   SETOFF                                       999830
      *** F3=Exit
     C     *IN03         IFEQ      '1'
     C                   GOTO      ENDPGM
     C                   END                                                    <*IN03
      *** F5=Refresh
     C     *IN05         IFEQ      '1'
     C                   CLEAR                   SFONTA
     C                   CLEAR                   SFYPE
     C                   CLEAR                   SFHONE
     C                   GOTO      START
     C                   END                                                    <*IN05
      *** F6=New record
     C     *IN06         IFEQ      '1'
     C                   MOVEL     'Lage ny '    WMODE
     C                   EXSR      CLRSCR
     c                   movel     KUNFUN        CTYPE
     C                   MOVE      '0'           *IN40
     C                   GOTO      START5
     C                   END                                                    <*IN06
      *** F12=Cancel
     C     *IN12         IFEQ      '1'
     C                   CLEAR                   SFONTA
     C                   CLEAR                   SFYPE
     C                   CLEAR                   SFHONE
     C                   GOTO      START0
     C                   END                                                    <*IN12
      *** Roll
     C     *IN25         IFEQ      '1'
     C                   Z-ADD     YRECNO        ZRECNO
     C                   MOVE      '0'           *IN25
     C     START4        TAG
     C     *IN94         IFEQ      '0'
     C                   GOTO      START1
     C                   END                                                    <*IN94
     C                   END                                                    <*IN25
      *** Get options from screen
     C     ZRECNO        IFNE      0
     C                   EXSR      GETOPT
      *** No option selected
     C     *IN97         IFEQ      '1'
     C                   EXFMT     VCUNDCD3
     C                   READ      VCUNDCD5                               66
     C                   MOVE      '0'           *IN97
     C                   GOTO      FKEYS
     C                   END                                                    <*IN12
      *** F3=Exit
     C     *IN03         IFEQ      '1'
     C                   GOTO      ENDPGM
     C                   END                                                    <*IN03
     C                   END                                                    <ZRECNO
     C     *IN98         IFEQ      '1'
     C     XRECNO        ANDNE     0
     C                   Z-ADD     XRECNO        ZRECNO
     C                   END                                                    <*IN98
     C                   GOTO      START3
      *** New record
     C     START5        TAG
     C                   EXFMT     VCUNDCD1
     C***
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C***
     C                   MOVEA     '00000'       *IN(61)
     C                   MOVE      '0'           *IN(67)
     C                   MOVE      '0'           *IN30
      *** F12=Cancel
     C   12              GOTO      START0
      *** F3=Exit
     C     *IN03         IFEQ      '1'
     C                   EXSR      CLRSCR
     C                   MOVEA     '00000'       *IN(61)
     C                   MOVE      '0'           *IN(67)
     C                   ELSE
     C                   EXSR      TESTB1
     C     *IN30         IFEQ      '1'
     C                   GOTO      START5
     C                   END                                                    <*IN30
     C                   END                                                    <*IN12
     C                   GOTO      START3
      *
     C     ENDPGM        TAG
     C                   MOVE      '1'           *INLR
     C                   RETURN
     C*
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
     C*          N40 = NEW
     C*           40 = CHANGE
     C***********************************************
     C                   EXSR      TSTSCR
     C     *IN30         IFEQ      '1'
     C                   GOTO      ENDTST
     C                   END                                                    <*IN30
     C     *IN40         IFEQ      '1'
     C                   UPDATE    CUNDCR                               38
     C                   ELSE
     C                   MOVEL     ÆFIRMA        CFIRMA
     C                   Z-ADD     ÆCOMPN        CCOMPN
     C                   WRITE     CUNDCR
     C                   END                                                    <*IN40
     C*
     C                   MOVE      CCONTA        SFONTA
     C                   MOVEL     CTYPE         SFYPE
     C                   MOVEL     CPHONE        SFHONE
     C     *IN40         IFEQ      '1'
     C                   UPDATE    VCUNDCD4
     C                   ELSE
     C                   ADD       1             YRECNO
     C                   Z-ADD     YRECNO        ZRECNO
     C                   MOVE      RRNP          SFRRN
     C                   WRITE     VCUNDCD4
     C                   END                                                    <*IN40
     C                   EXSR      CLRSCR
      *
     C     ENDTST        ENDSR
      ***********************************************************
     C     TSTSCR        BEGSR
      ***********************************************************
     C                   MOVE      '0'           *IN30
     C                   MOVEA     '00000'       *IN(61)
     C                   MOVE      '0'           *IN(67)
     C*
     C     CCONTA        IFEQ      *BLANKS
     C                   MOVE      'CBA0130'     MSGNR
     C                   MOVE      '1'           *IN61
     C                   MOVE      '1'           *IN30
     C                   Z-ADD     7             LINNBR
     C                   Z-ADD     27            POSNBR
     C                   GOTO      TSTEND
     C                   END                                                    <CCONTA
     C*
     C     CTYPE         IFEQ      *BLANKS
     C                   CALL      'MAIL04CLP'
     C                   PARM                    CTYPE
     C                   PARM                    PLUKK
     C                   END                                                    <CCONTA
      *
     C*
     C     CTYPE         IFEQ      *BLANKS
     C                   MOVE      'SHU1112'     MSGNR
     C                   MOVE      '1'           *IN62
     C                   MOVE      '1'           *IN30
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     27            POSNBR
     C                   GOTO      TSTEND
     C                   END                                                    <CCONTA
     C     CEMAIL        IFEQ      *BLANKS
     C                   MOVE      'SHU1113'     MSGNR
     C                   MOVE      '1'           *IN63
     C                   MOVE      '1'           *IN30
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     6             POSNBR
     C                   GOTO      TSTEND
     C                   END                                                    <CCONTA
     C*
     C     TSTEND        ENDSR
     C*
      ***********************************************
     C     GETOPT        BEGSR
      ***********************************************
     C                   Z-ADD     0             OPTNBR            2 0
     C                   SETOFF                                       919299
     C                   MOVE      '1'           *IN97
     C     *IN98         DOWEQ     '0'
     C                   READC     VCUNDCD4                               98
     C     *IN98         IFEQ      '1'
     C     *IN99         IFEQ      '1'
     C                   MOVE      '0'           *IN98
     C                   END                                                    <*IN99
     C                   GOTO      ENDGET
     C                   END                                                    <*IN98
     C                   MOVE      '0'           *IN97
     C                   Z-ADD     CURS1         ZRECNO
      *** 1=PICK
     C     WSNR          IFEQ      '1 '
     C     WSNR          OREQ      ' 1'
     C     WSNR          OREQ      '01'
     C     WSNR          OREQ      'E '
     C     WSNR          OREQ      'F '
     C     WSNR          OREQ      ' E'
     C     WSNR          OREQ      ' F'
     C                   MOVE      SFRRN         URRN
     C                   MOVE      SFONTA        UCONTA
     C     WSNR          IFEQ      'E '
     C     WSNR          OREQ      ' E'
     C                   MOVE      'E'           UEMFA
     C                   END
     C     WSNR          IFEQ      'F '
     C     WSNR          OREQ      ' F'
     C                   MOVE      'F'           UEMFA
     C                   END
     C                   SETON                                        LR
     C                   RETURN
     C                   END                                                    <SFYPE
      *** 2=Change
     C     WSNR          IFEQ      '2 '
     C     WSNR          OREQ      ' 2'
     C     WSNR          OREQ      '02'
     C                   ADD       1             OPTNBR
     C                   MOVE      ' '           WSNR
     C                   MOVEL     'Endre   '    WMODE
     C     SFYPE         IFEQ      TXT(1)
     C                   MOVE      'CBA0120'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      ENDGET
     C                   END                                                    <SFYPE
     C                   MOVE      '1'           *IN40
     C                   EXSR      CHGST
      *** F12=Cancel
     C     *IN12         IFEQ      '1'
     C                   GOTO      ENDGET
     C                   END                                                    <*IN12
     C                   MOVE      '0'           *IN40
     C                   END                                                    <WSNR=2
      *** 3=Copy
     C     WSNR          IFEQ      '3 '
     C     WSNR          OREQ      ' 3'
     C     WSNR          OREQ      '03'
     C                   ADD       1             OPTNBR
     C                   MOVE      ' '           WSNR
     C                   MOVEL     'Kopier  '    WMODE
     C     SFYPE         IFEQ      TXT(1)
     C                   MOVE      'CBA0120'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      ENDGET
     C                   END                                                    <SFYPE
     C                   EXSR      CPYST
      *** F12=Cancel
     C     *IN12         IFEQ      '1'
     C                   GOTO      ENDGET
     C                   END                                                    <*IN12
     C                   END                                                    <WSNR=3
      *** 4=Delete
     C     WSNR          IFEQ      '4 '
     C     WSNR          OREQ      ' 4'
     C     WSNR          OREQ      '04'
     C                   ADD       1             OPTNBR
     C                   MOVE      ' '           WSNR
     C                   MOVEL     'Slett   '    WMODE
     C     SFYPE         IFEQ      TXT(1)
     C                   MOVE      'CBA0120'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      ENDGET
     C                   END                                                    <SFYPE
     C                   EXSR      DLTST
      *** F12=Cancel
     C     *IN12         IFEQ      '1'
     C                   GOTO      ENDGET
     C                   END                                                    <*IN12
     C                   END                                                    <WSNR=4
      *** 5=Display
     C     WSNR          IFEQ      '5 '
     C     WSNR          OREQ      ' 5'
     C     WSNR          OREQ      '05'
     C                   ADD       1             OPTNBR
     C                   MOVE      ' '           WSNR
     C                   MOVEL     'Vise    '    WMODE
     C     SFYPE         IFEQ      TXT(1)
     C                   MOVE      'CBA0120'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   GOTO      ENDGET
     C                   END                                                    <SFYPE
     C     SFRRN         CHAIN(N)  CUNDC                              77
     C                   MOVE      '1'           *IN88
     C                   EXFMT     VCUNDCD1
      *** F12=Cancel
     C     *IN12         IFEQ      '1'
     C                   UPDATE    VCUNDCD4
     C                   GOTO      ENDGET
     C                   END                                                    <*IN12
     C                   MOVEA     '00000'       *IN(61)
     C                   MOVE      '0'           *IN(67)
     C                   MOVE      '0'           *IN88
     C                   UPDATE    VCUNDCD4
     C                   END                                                    <WSNR=5
     C                   ENDDO
      *
     C     ENDGET        TAG
      *
     C                   ENDSR
      ***********************************************
     C     CHGST         BEGSR
      ***********************************************
     C     SFRRN         CHAIN     CUNDC                              77
     C                   MOVE      '1'           *IN99
     C     STCHG         TAG
     C                   EXFMT     VCUNDCD1
     C                   MOVE      '0'           *IN30
     C                   MOVEA     '00000'       *IN(61)
     C                   MOVE      '0'           *IN(67)
     C     *IN12         IFEQ      '1'
     C     *IN03         OREQ      '1'
     C                   UPDATE    VCUNDCD4
     C                   GOTO      CHGEND
     C                   END                                                    <*IN12
     C                   EXSR      TESTB1
     C     *IN30         IFEQ      '1'
     C                   GOTO      STCHG
     C                   END                                                    <*IN30
      *
     C     CHGEND        TAG
     C                   ENDSR
     C*
      ***********************************************
     C     CPYST         BEGSR
      ***********************************************
     C     SFRRN         CHAIN(N)  CUNDC                              77
     C                   MOVE      '1'           *IN99
     C                   UPDATE    VCUNDCD4
     C     STCPY         TAG
     C                   EXFMT     VCUNDCD1
     C                   MOVE      '0'           *IN30
     C                   MOVEA     '00000'       *IN(61)
     C                   MOVE      '0'           *IN(67)
     C     *IN12         IFEQ      '1'
     C     *IN03         OREQ      '1'
     C                   EXSR      CLRSCR
     C                   MOVEA     '00000'       *IN(61)
     C                   MOVE      '0'           *IN(67)
     C                   GOTO      CPYEND
     C                   END                                                    <*IN12
     C                   MOVE      '0'           *IN40
     C                   EXSR      TESTB1
     C     *IN30         IFEQ      '1'
     C                   GOTO      STCPY
     C                   END                                                    <*IN30
      *
     C     CPYEND        TAG
     C                   ENDSR
     C*
      ***********************************************
     C     DLTST         BEGSR
      ***********************************************
     C                   MOVE      '1'           *IN99
     C                   MOVEA     '11'          *IN(88)
     C     SFRRN         CHAIN     CUNDC                              77
     C                   EXFMT     VCUNDCD1
     C                   MOVEA     '00'          *IN(88)
     C     *IN11         IFEQ      '1'
     C     *IN77         IFEQ      '0'
     C                   DELETE    CUNDCR
     C                   END                                                    <*IN77
     C                   MOVE      CCONTA        SFONTA
     C                   MOVEL     TXT(1)        SFYPE
     C                   END                                                    <*IN11
     C                   UPDATE    VCUNDCD4
      *
     C                   ENDSR
      ***********************************************
     C     CLRSCR        BEGSR
      ***********************************************
     C                   MOVE      '0'           *IN40
     C                   CLEAR                   CCONTA
     C                   CLEAR                   CTYPE
     C                   CLEAR                   CMOBIL
     C                   CLEAR                   CEMAIL
      *
     C                   ENDSR
      ***********************************************
     C     init          BEGSR
      ***********************************************
     C                   MOVE      'J'           PLUKK             1
     C                   move      *zeros        URRN             10 0
     C                   move      *blanks       UEMFA             1
     C                   move      *blanks       UCONTA           30
     C     *LIKE         DEFINE    CFIRMA        ÆFIRMA
     C     *LIKE         DEFINE    CCOMPN        ÆCOMPN
     C                   MOVE      *BLANKS       USØKKN           30
     c                   read      firm                                   33
     c                   move      fifirm        ÆFIRMA
     C                   CALL      'MAIL06R'
     C                   PARM                    UKNR              8 0
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKN           30
     c     UKNR          ifeq      *zeros
     c                   seton                                        lr
     c                   return
     c                   end
     C*
     C                   Z-ADD     UKNR          ÆCOMPN
     C                   movel     UCONTA        TST1              1
     C     TST1          ifeq      '*'
     C                   MOVE      *ON           *IN55
     C                   move      UCONTA        KUNFUN
     C                   move      *blanks       UCONTA
     C                   end
      *--------------------------------------------------------------
      * DEFINE KEY FOR CUNDC01
      *--------------------------------------------------------------
     C     CUNKY1        KLIST
     C                   KFLD                    ÆFIRMA
     C                   KFLD                    ÆCOMPN
      *
     C     CUNKY1        CHAIN     CUNDL01                            51
      *
     C                   CLEAR                   SFONTA
     C                   MOVE      '1'           *IN50
      *
     C                   ENDSR
      *
**
*** SLETTET ***
