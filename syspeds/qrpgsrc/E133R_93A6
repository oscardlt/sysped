BHR   * VISSE HARDKODEDE VERDIER
      *****************************************************************
      * MOTTAK AV IFTMIN FRA EURISCO/"SENDPAKKE"                      *
      * DETTE ER EN FORH≈NDSADVISERING OM AT SENDING ER REGISTRERT    *
      * I WEBLÿSNINGEN (NOE ER P≈ GANG...)                            *
      * LAGRES I HENOP/HENOS MED STATUS "Z"                           *
      * SENDERS KUNDENR MED NEGATIVT FORTEGN BRUKES SOM FAST LÿPENR   *
      * LÿPENR2 (LINJER I HENOS) SETTES FAST TIL 0                    *
      * VERDI I HENOP (HEADER) AKKUMULERES FORTLÿPENDE                *
      * SENINGSNUMMER SLETTES FRA FILEN N≈R IFCSUM MOTTARS (ELLER N≈R *
      * MELDING OM SLETTING MOTTAS...)                                *
      * VERDI I HENOP (HEADER) REDISSERES  FORTLÿPENDE                *
      * (SYNKRONISERING HENOP/HENOS BÿR SIKRES I NATTRUTINE)          *
      *****************************************************************
      *
     H DATEDIT(*YMD)
     FCUNDL01   IF   E           K DISK
     FEDIS      IF   E           K DISK
     FEDIM      IF   E           K DISK
     FEUNB      IF   E           K DISK
     FEUNH      IF   E           K DISK
     FFIRM      IF   E           K DISK
     FECNT93A   IF   E           K DISK
     FEFTX93A   IF   E           K DISK
     FEGID93A   IF   E           K DISK
     FENAD93A   IF   E           K DISK
     FERFF93A   IF   E           K DISK
     FETSR93A   IF   E           K DISK
     FEEQD93A   IF   E           K DISK
     FEEQN93A   IF   E           K DISK
     FEMEA93A   IF   E           K DISK
     FKODTRI    IF   E           K DISK
     FKODTAG    IF   E           K DISK
     FHEAD39    IF   E           K DISK
     FHENOP     UF A E           K DISK
     FHENOS     O  A E             DISK
     F*ENOS01 IF  E           K        DISK
     FHENOS01   UF   E           K DISK
     F                                     RENAME(HENOSR:HENOS01R)
     FHENOF01   UF A E           K DISK
     D A               S              1    DIM(79)
     D B               S              1    DIM(18)
      *________________________
      * DS for decimal handling
      *""""""""""""""""""""""""
     D                 DS
     D  ZDEC                   1      7  6
     D  ZDEC6                  2      7
     D  ZHEL                  11     22  0
     D                 DS
     D  WMN2                   1      9  0
     D                 DS
     D  M1004                  1     35
     D  W1004A                 1     17
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XUL≈≈                 11     14  0
     D                 DS
     D  UL≈≈                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     D                 DS
     D  XXDS                   1     30
     D  XXDATE                 1      8
     D  XXTIME                 9     14
      */////////////
      * MAIN LOGIC /
      */////////////
      *___________
      * Initiering
      *"""""""""""
     C                   EXSR      INIT
      *________
      * CONVERT
      *""""""""
     C                   EXSR      RTVD
      *
     C                   MOVE      '1'           *INLR
      *
      *
      *////////////////////////////////////////////////////////////
      * RETREIVE INFO FROM EDIFACT DATABASE TO SYSPED        RTVD /
      *////////////////////////////////////////////////////////////
     C     RTVD          BEGSR
      *__________________
      * INIT. DATAFELTER
      *""""""""""""""""""
     C                   MOVEL     '401'         SNDN20           20
     C                   MOVE      W1004A        SNDN20
      * SLETTEMELDING ??
     C     U1225         IFEQ      '3'
     C     U2005A        OREQ      '3'                                          FEIL EURISCO!!
     C                   EXSR      DELPRE
     C                   GOTO      NXTFBR
     C                   END
      * FINNES SENDINGEN ALLEREDE...
     C     SNDN20        SETLL     HENOS01
     C     SNDN20        READE(N)  HENOS01                                33
     C     *IN33         CABEQ     '0'           NXTFBR
      *
     C     Sndn20        chain     Head39                             33
     C     *IN33         CABEQ     '0'           NXTFBR
      *
      * LEGG INN SNDNR / TID FRA UNH/UNB - HENT RESTEN FRA EDISEGMENTER
     C                   CLEAR                   HENOSR
     C                   MOVEL     SNDN20        HSSNDN
     C                   MOVEL     XXDS          HSDS
      *
     C                   MOVE      '0'           *IN51
      *__________________
      * READ ALL SEGMENTS
      *""""""""""""""""""
     C                   Z-ADD     CREP0         ZREPB0
     C                   EXSR      NAD10
     C     HOKNS         CABEQ     *ZEROS        NXTFBR
     C                   EXSR      RFF03
     C                   EXSR      FTX00
     C                   EXSR      TSR00
     C                   EXSR      CNT00
     C                   EXSR      GID16
     C                   EXSR      EQD34
      *________________
      * WRITE TO SYSPED
      *""""""""""""""""
     C                   MOVE      HOLNR         HSLNR
     C                   MOVE      HOST          HSST
     C                   WRITE     HENOSR
      * ADDER VEKTER I HEADER
     C     HOLNR         CHAIN     HENOP                              55
     C     *IN55         IFEQ      *OFF
      * L≈NER FELTENE HOMINT / HOMINK FOR ANT SEND/ANT KLL.
     C                   ADD       1             HOMINT                          *ANT SND
     C                   ADD       HSANT         HOMINK                          *ANT KLL
     C                   ADD       HSVKT         HOVKT
     C                   ADD       HSM3          HOM3
     C                   ADD       HSLM          HOLM
     C                   UPDATE    HENOPR
     C                   END
      *
     C     NXTFBR        TAG
     C                   ENDSR
      *////////////////////////////////////////////////////////////
     C     DELPRE        BEGSR
      *////////////////////////////////////////////////////////////
      *__________________
      * DELETE PREADVICES
      *""""""""""""""""""
      * Fjern Sending / tell ned(/fjern)i header -  fra Preadv.
     C     SNDN20        SETLL     HENOS01
     C     SNDN20        READE     HENOS01                                33                   33
     C     *IN33         DOWEQ     '0'
     C     HSLNR         IFLT      0
     C                   DELETE    HENOS01R
     C     HSLNR         CHAIN     HENOP                              33
     C     *IN33         IFEQ      '0'
     C                   SUB       1             HOMINT
     C                   SUB       HSANT         HOMINK
     C                   SUB       HSVKT         HOVKT
     C                   SUB       HSM3          HOM3
     C                   SUB       HSLM          HOLM
     C     HOMINT        IFGT      0
     C                   UPDATE    HENOPR
     C                   ELSE
     C                   DELETE    HENOPR
     C                   END
     C                   END
      *
      * Fjern Fritekster fra Preadv.
     C     HENOFK        KLIST
     C                   KFLD                    HSLNR
     C                   KFLD                    SNDN20
     C     HENOFK        SETLL     HENOF01
     C     HENOFK        READE     HENOF01                                33                   33
     C     *IN33         DOWEQ     '0'
     C                   DELETE    HENOFR
     C     HENOFK        READE     HENOF01                                33                   33
     C                   END
      *
     C                   END
     C     SNDN20        READE     HENOS01                                33                   33
     C                   END
      *
      *
     C     UTDEL         ENDSR
      *
      *////////////////////////////////////////////////////////////
      * TSR00                                               TSR00 /
      *////////////////////////////////////////////////////////////
     C     TSR00         BEGSR
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     0             ZGN0
     C     KEYMS0        SETLL     ETSR93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ETSR93A                                51
     C     *IN51         DOWEQ     '0'
      * RMD=FARLIG (-> ADR-MERKING)  ZHO=VARME (-> IMD-MERKING)
     C                   SELECT
     C     T7085         WHENEQ    'RMD'
     C     T4065         OREQ      'RMD'
     C                   MOVEL     'X'           HSFARL                         *FARLIG
     C     T7085         WHENEQ    'ZHO'
     C     T4065         OREQ      'ZHO'
     C                   MOVEL     'X'           HSVARM                         *VARME
     C     T7085         WHENEQ    'ZPL'
     C     T4065         OREQ      'ZPL'
     C                   MOVEL     'P'           HSPROD                         *PALL PRISET
     C     T7085         WHENEQ    'ZHP'
     C     T4065         OREQ      'ZHP'
     C                   MOVEL     'H'           HSPROD                         *Halv-PALL PRISET
     C     T7085         WHENEQ    'ZKL'
     C     T4065         OREQ      'ZKL'
     C                   MOVEL     'K'           HSPROD                         *KOLLIPRISET
     C     T7085         WHENEQ    'ZPG'
     C     T4065         OREQ      'ZPG'
     C                   MOVEL     'D'           HSPROD                         *Partigods/direkte
     C                   ENDSL
     C  N51KEYMS0        READE     ETSR93A                                51
     C  N51              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * CNT00                                               CNT00 /
      *////////////////////////////////////////////////////////////
     C     CNT00         BEGSR
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     0             ZGN0
     C     KEYMS0        SETLL     ECNT93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ECNT93A                                51
     C     *IN51         DOWEQ     '0'
      *
     C                   MOVEA     C6066         A
     C                   EXSR      GETNUM
     C                   SELECT
     C     C6069         WHENEQ    '7  '
     C                   Z-ADD     ZNUM          HSVKT
     C     C6069         WHENEQ    '11 '
     C                   Z-ADD     ZNUM          HSANT
     C     C6069         WHENEQ    '15 '                                         DMQ
     C     ZNUM          DIV       1000          HSM3
     C     C6069         WHENEQ    'ZLM'
     C                   Z-ADD     ZNUM          HSLM
     C                   ENDSL
      *
     C  N51KEYMS0        READE     ECNT93A                                51
     C  N51              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * FTX00                                               FTX00 /
      *////////////////////////////////////////////////////////////
     C     FTX00         BEGSR
     C                   CLEAR                   HENOFR
     C                   MOVE      HOLNR         HFLNR
     C                   MOVE      HSSNDN        HFSNDN
     C                   MOVE      'T'           HFKODE
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     0             ZGN0
     C     KEYMS0        SETLL     EFTX93A                                20
     C     KEYMS0        READE     EFTX93A                                51
     C     *IN51         DOWEQ     '0'
      * KUN MELDING TIL TRANSP. ER INTTERESSANT I FORH≈NDSADVISERINGEN
     C     F4451         IFEQ      'SIC'
     C                   MOVEL     F4440A        HFTXT
     C                   WRITE     HENOFR
     C     F4440B        IFNE      *BLANKS
     C                   MOVEL     F4440B        HFTXT
     C                   WRITE     HENOFR
     C                   ENDIF
     C     F4440C        IFNE      *BLANKS
     C                   MOVEL     F4440C        HFTXT
     C                   WRITE     HENOFR
     C                   ENDIF
     C     F4440D        IFNE      *BLANKS
     C                   MOVEL     F4440D        HFTXT
     C                   WRITE     HENOFR
     C                   ENDIF
     C     F4440E        IFNE      *BLANKS
     C                   MOVEL     F4440E        HFTXT
     C                   WRITE     HENOFR
     C                   ENDIF
     C                   ENDIF
      *
      *
     C     KEYMS0        READE     EFTX93A                                51
     C  N51              ENDDO
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * FTX16                                               FTX16 /
      *////////////////////////////////////////////////////////////
     C     FTX16         BEGSR
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     16            ZGN1
     C     KEYMS1        SETLL     EFTX93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     EFTX93A                                52
     C     *IN52         DOWEQ     '0'
      *
     C     F4451         IFEQ      'AAA'
     C     HSVB          CAT       F4440A:1      HSVB
     C                   ENDIF
      *
     C  N52KEYMS1        READE     EFTX93A                                52
     C  N52              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * MEA19                                               MEA19 /
      *////////////////////////////////////////////////////////////
     C     MEA19         BEGSR
     C                   MOVE      '0'           *IN52
     C                   Z-ADD     19            ZGN1
     C     KEYMS1        SETLL     EMEA93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS1        READE     EMEA93A                                52
     C     *IN52         DOWEQ     '0'
      *
     C                   MOVEA     M6314         A
     C                   EXSR      GETNUM
     C                   SELECT
     C     M6311         WHENEQ    'WT '
     C                   ADD       ZNUM          XXVKT
     C     M6311         WHENEQ    'LMT'
     C                   ADD       ZNUM          XXLM
     C     M6311         WHENEQ    'VOL'
     C     M6411         IFEQ      'DMQ'
     C     ZNUM          DIV(H)    1000          ZNUM
     C                   END
     C                   ADD       ZNUM          XXM3
     C                   ENDSL
      *
     C  N52KEYMS1        READE     EMEA93A                                52
     C  N52              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Get numerical value                               GETNUM /
      *////////////////////////////////////////////////////////////
     C     GETNUM        BEGSR
     C                   MOVE      *ZEROS        ZHEL
     C                   MOVE      *ZEROS        ZDEC
     C                   MOVE      *ZEROS        B
     C                   Z-ADD     1             AX                2 0
     C                   Z-ADD     1             BX                2 0
      * Get Integer
     C     A(AX)         DOWGE     '0'
     C     ZHEL          MULT      10            ZHEL
     C                   MOVE      A(AX)         ZHEL
     C                   ADD       1             AX
     C                   ENDDO
      * Decimal point ?
     C     A(AX)         IFEQ      '.'
     C     A(AX)         OREQ      ','
     C                   ADD       1             AX
     C     A(AX)         DOWGE     '0'
     C                   MOVE      A(AX)         B(BX)
     C                   ADD       1             AX
     C                   ADD       1             BX
     C                   ENDDO
     C                   MOVEA     B             ZDEC6
     C                   ENDIF
      * Concatenate
     C                   Z-ADD     ZHEL          ZNUM             18 6
     C                   ADD       ZDEC          ZNUM
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * GID16                                               GID16 /
      *////////////////////////////////////////////////////////////
     C     GID16         BEGSR
     C                   MOVE      *ZEROS        XXANT             7 0
     C                   MOVE      *ZEROS        XXVKT             7 0
     C                   MOVE      *ZEROS        XXM3              7 3
     C                   MOVE      *ZEROS        XXLM              7 2
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     16            ZGN0
     C     KEYMS0        SETLL     EGID93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     EGID93A                                51
     C     *IN51         DOWEQ     '0'
     C                   MOVEA     G7224A        A
     C                   EXSR      GETNUM
     C                   ADD       ZNUM          XXANT
     C                   MOVEL     G7064A        HEVS1
      *
     C                   Z-ADD     GREP0         ZREPB0
     C                   EXSR      FTX16
     C                   EXSR      MEA19
      *
     C     KEYMS0        READE     EGID93A                                51
     C  N51              ENDDO
     C                   ENDIF
     C     HSANT         IFEQ      *ZEROS
     C                   Z-ADD     XXANT         HSANT
     C                   END
     C     HSVKT         IFEQ      *ZEROS
     C                   Z-ADD     XXVKT         HSVKT
     C                   END
     C     HSM3          IFEQ      *ZEROS
     C                   Z-ADD     XXM3          HSM3
     C                   END
     C     HSLM          IFEQ      *ZEROS
     C                   Z-ADD     XXLM          HSLM
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *                                                      INIT /
      *////////////////////////////////////////////////////////////
     C     INIT          BEGSR
     C     KEYMS0        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN0
     C     KEYMS1        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN1
     C                   KFLD                    ZREPB0
     C     KODRIK        KLIST
     C                   KFLD                    XXTERM            4 0
     C                   KFLD                    NUMPNR            4 0
     C     KUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
     C     STEDKE        KLIST
     C                   KFLD                    YYLAND            2
     C                   KFLD                    YYSTED            5
     C                   MOVE      'NO'          YYLAND
      *
     C     *LIKE         DEFINE    NMN           ZMN
     C     *LIKE         DEFINE    NGN           ZGN0
     C     *LIKE         DEFINE    NGN           ZGN1
     C     *LIKE         DEFINE    NREP0         ZREPB0
      *
     C     *ENTRY        PLIST
     C                   PARM                    WMN1              9
     C                   MOVEL     WMN1          WMN2
     C                   Z-ADD     WMN2          ZMN
      * Get msg and interchange values
     C     ZMN           CHAIN     EUNH                               51
     C     ZMN           CHAIN     EDIM                               51
     C     MSN           CHAIN     EDIS                               51
     C     MSN           CHAIN     EUNB                               33
     C                   MOVEL     '20'          XXDATE
     C                   MOVE      U0017         XXDATE
     C                   MOVE      '00'          XXTIME
     C                   MOVEL     U0019         XXTIME
     C     U0017         IFEQ      *ZEROS
     C     U0017         OREQ      *BLANKS
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XUL≈≈         UL≈≈
     C                   MOVE      ULDT          XXDATE
     C                   MOVE      XULTM         XXTIME
     C                   END
      *
     C     *LOVAL        SETLL     FIRM
     C                   READ      FIRM                                   33
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * NAD10                                               NAD10 /
      *////////////////////////////////////////////////////////////
     C     NAD10         BEGSR
     C                   Z-ADD     10            ZGN0
     C     KEYMS0        SETLL     ENAD93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ENAD93A                                51
     C     *IN51         DOWEQ     '0'
      *
     C                   SELECT
      *
     C     N3035         WHENEQ    'CZ'                                         AVSENDER
     C                   MOVE      *ZEROS        HOKNS
     C                   MOVEA     N3039         A
     C                   EXSR      GETNUM
     C     ZNUM          IFNE      *ZEROS
     C                   CLEAR                   HENOPR
     C                   Z-SUB     ZNUM          HOLNR             7 0
     C     HOLNR         CHAIN     HENOP                              55
     C                   Z-ADD     ZNUM          KUNDNR
     C     KUNKEY        CHAIN     CUNDL01                            33
     C     *IN33         IFEQ      '0'
     C                   MOVE      KUNDNR        HOKNS
     C                   MOVEL     KNAVN         HONAS
     C                   MOVEL     ADR1          HOADS1
     C                   MOVEL     POSTNR        HOPNRS
     C                   MOVEL     ADR3          HOSTDS
     C                   ELSE
     C                   MOVE      *ZEROS        HOKNS
     C                   MOVE      *BLANKS       HONAS
     C                   MOVE      *BLANKS       HOADS1
     C                   MOVE      *ZEROS        HOPNRS
     C                   MOVE      *BLANKS       HOSTDS
     C                   END
BHR   * VIA MOTTAGER EDI FINN OM DET ER OSLO ELLER DRAMMEN..
BHR  C                   MOVEL     M0010         MOTEDI            8
BHR  C     MOTEDI        IFEQ      'RIKSGODS'
BHR  C                   MOVE      'Y'           HOST                             OSLO
BHR  C                   MOVE      1000          XXTERM
BHR  C                   ELSE
     C                   MOVE      'Z'           HOST                             DRAMMEN
     C                   MOVE      3000          XXTERM
BHR  C                   END
     C                   MOVE      XXTERM        HOPNRT
     C   55              WRITE     HENOPR
     C  N55              UPDATE    HENOPR
     C                   END
      *
      *
     C     N3035         WHENEQ    'CN'                                         MOTTAKER
     C                   MOVEL     N3036A        HSNAK
     C                   MOVEL     N3042A        HSADK1
     C                   MOVEL     N3251         HSPNRK
     C                   MOVEL     N3164         HSSTDK
      *
     C     N3035         WHENEQ    'DP'                                         LEV.ADR
     C                   MOVEL     N3036A        HSNAK
     C                   MOVEL     N3042A        HSADK1
     C                   MOVEL     N3251         HSPNRK
     C                   MOVEL     N3164         HSSTDK
      *
     C                   ENDSL
      *
     C     KEYMS0        READE     ENAD93A                                51
     C  N51              ENDDO
     C                   ENDIF
      *
      *
     C                   MOVE      HSPNRK        NUMPNR
      * FINN AVD
     C     KODRIK        SETGT     KODTRI
     C     XXTERM        READPE    KODTRI                                 33
     C  N33NUMPNR        IFGE      RIPNRF
     C     NUMPNR        ANDLE     RIPNRT
     C                   MOVE      RIAVDU        HSAVDH
     C                   END
      * VIA...
     C     HSAVDH        IFNE      *ZEROS
     C     HSAVDH        CHAIN     KODTAG                             33
     C  N33AGTRNR        comp      *zeros                                 33
     C  N33              MOVE      'J'           TRTSTA
     C                   END
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * RFF03                                               RFF03 /
      *////////////////////////////////////////////////////////////
     C     RFF03         BEGSR
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     3             ZGN0
     C     KEYMS0        SETLL     ERFF93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     ERFF93A                                51
     C     *IN51         DOWEQ     '0'
      *
     C     R1153         IFEQ      'CU '                                           TG
     C     R1153         OREQ      'CO '                                           LG
     C                   MOVEL     R1154         HSRFA
     C                   ENDIF
      *
     C  N51KEYMS0        READE     ERFF93A                                51
     C  N51              ENDDO
     C                   ENDIF
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      * EQD34                                               EQD13 /
      *////////////////////////////////////////////////////////////
     C     EQD34         BEGSR
     C                   MOVE      *ZEROS        ANTPLL            3 0
     C                   Z-ADD     34            ZGN0
     C                   Z-ADD     34            ZGN1
      *
     C     KEYMS0        SETLL     EEQD93A                                20
     C     *IN20         IFEQ      '1'
     C     KEYMS0        READE     EEQD93A                                51
     C     *IN51         DOWEQ     '0'
      *
      * ETT ELLER 2 SEGMENT...
     C     E8053         IFEQ      'EFP'
     C                   Z-ADD     EREP0         ZREPB0
     C     KEYMS1        CHAIN     EEQN93A                            33
     C     *IN33         IFEQ      '0'
     C     E6350         ANDNE     *BLANKS
     C                   CLEAR                   A
     C                   MOVEA     E6350         A
     C                   EXSR      GETNUM
     C                   Z-ADD     ZNUM          ANTPLL
     C                   END
     C                   END
      *
     C  N51KEYMS0        READE     EEQD93A                                51
     C  N51              END
     C                   END
     C                   MOVE      ANTPLL        HSANTP
      *
     C                   ENDSR
