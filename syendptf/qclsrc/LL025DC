/*N01   PARAMETER &WSFILE */
/*N02   BYGG WORKFIL UANSETT OM CSV VELGES ELLER EI */
/*N03   PDF TIL EPOST                               */
/*N04   UTVIDET FILEN XXTOLLAG                      */
             PGM
/*N03*/      DCL        VAR(&CVP2) TYPE(*CHAR) LEN(40)
/*N03*/      DCL        VAR(&CVP3) TYPE(*CHAR) LEN(40)
/*N03*/      DCL        VAR(&CVP4) TYPE(*CHAR) LEN(40)
/*N03*/      DCL        VAR(&CVP5) TYPE(*CHAR) LEN(40)
/*N03*/      DCL        VAR(&CVP6) TYPE(*CHAR) LEN(40)
/*N03*/      DCL        VAR(&CVP7) TYPE(*CHAR) LEN(40)
/*N03*/      DCL        VAR(&CVP8) TYPE(*CHAR) LEN(40)
/*N03*/      DCL        VAR(&CVP9) TYPE(*CHAR) LEN(40)
/*N03*/      DCL        VAR(&PDF) TYPE(*CHAR) LEN(4) VALUE('*YES')
/*N03*/      DCL        VAR(&EMFAX) TYPE(*CHAR) LEN(70) +
                          VALUE('Tollagerregnskap sendt som epost +
                          I PDF-FORMAT')
/*N03*/      DCL        VAR(&FILEN) TYPE(*CHAR) LEN(10) +
                          VALUE('LL025DPF')
/*N03*/      DCL        VAR(&QJOB) TYPE(*CHAR) LEN(10)
/*N03*/      DCL        VAR(&QNBR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&HOLD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&SAVE) TYPE(*CHAR) LEN(4)
             DCL        VAR(&PTY) TYPE(*CHAR) LEN(10)
             DCL        VAR(&STR) TYPE(*CHAR) LEN(5)
             DCL        VAR(&LAS) TYPE(*CHAR) LEN(10)
             DCL        VAR(&UDOKN) TYPE(*DEC) LEN(3 0) VALUE(203)
             DCL        VAR(&KOPI) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&UKOPI) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&GNF) TYPE(*CHAR) LEN(15) /*LLOK FRA*/
             DCL        VAR(&GNT) TYPE(*CHAR) LEN(15) /*LLOK TIL*/
             DCL        VAR(&ARF) TYPE(*CHAR) LEN(15) /*ART. FRA*/
             DCL        VAR(&ART) TYPE(*CHAR) LEN(15) /*ART  TIL*/
             DCL        VAR(&PNR) TYPE(*CHAR) LEN(8) /*LAGERKUNDENR*/
             DCL        VAR(&LAGF) TYPE(*CHAR) LEN(25) /*LLOK FRA*/
             DCL        VAR(&LAGT) TYPE(*CHAR) LEN(25) /*LLOK TIL*/
             DCL        VAR(&DET) TYPE(*CHAR) LEN(1) VALUE('J')
             DCL        VAR(&SALD) TYPE(*CHAR) LEN(1) VALUE(' ')
             DCL        VAR(&TYPE) TYPE(*CHAR) LEN(3) /*VARETYPE*/
             DCL        VAR(&BRUD) TYPE(*CHAR) LEN(1) VALUE('J')
             DCL        VAR(&PRT) TYPE(*CHAR) LEN(10) /*PRINTER*/
             DCL        VAR(&IN01) TYPE(*LGL) LEN(1) VALUE('0') /* +
                          AVSLUTT*/
/*N01  */    DCL        VAR(&FILE) TYPE(*CHAR) LEN(1)
/*N01  */    DCL        VAR(&EPOST) TYPE(*CHAR) LEN(70)
/*N01  */    DCL        VAR(&QUSER) TYPE(*CHAR) LEN(10)
/*N01  */    DCL        VAR(&SNDNA) TYPE(*CHAR) LEN(8)
/*N01  */    DCL        VAR(&SNDAD) TYPE(*CHAR) LEN(8)
/*N01  */    DCL        VAR(&EMNE) TYPE(*CHAR) LEN(44)
/*N01  */    DCL        VAR(&STMFIL) TYPE(*CHAR) LEN(50) +
                            VALUE('/QDLS/QPGMR/TOLLAG.CSV')
/*N01  */    DCL        VAR(&STMF) TYPE(*CHAR) LEN(15) VALUE(TOLLAG.CSV)
/*N01  */    DCL        VAR(&FLR) TYPE(*CHAR) LEN(10) VALUE(QPGMR)
/*S01        RTVJOBA    USER(&QUSER)     */
             RTVJOBA    JOB(&QJOB) USER(&QUSER) NBR(&QNBR)
/*N01  */    CALL       PGM(EPOS04E) PARM(&QUSER &SNDNA &SNDAD &EPOST)
             OVRMSGF    MSGF(QUSERMSG) TOMSGF(SYMSGF)
             CALL       PGM(SYFA00) PARM(&IN01)
             IF         COND(&IN01 = '1') THEN(GOTO CMDLBL(SLUTT))

             CALL       PGM(SYGE18) PARM(&UDOKN &PRT &LAS &STR &PTY +
                          &HOLD &SAVE &KOPI &IN01)
             IF         COND(&IN01 = '1') THEN(GOTO CMDLBL(SLUTT))
/*                                                  */
/* VED AVANSERT SKRIVER ENDRES KOPIER I RPG-PROGRAM */
/*                                                  */
             CHGVAR     VAR(&UKOPI) VALUE(&KOPI)
             IF         COND(&LAS = 'A') THEN(DO)
             CHGVAR     VAR(&UKOPI) VALUE(1)
             ENDDO
/*                                                  */
    /* */
    /* UTSKRIFT AV TOLLAGERJOURNAL */
    /* */
/*N01        CALL       PGM(LL025ER) PARM(&GNF &GNT &ARF &ART &PNR +
                          &LAGF &LAGT &DET &SALD &TYPE +
                          &BRUD &IN01) */
/*N01  */    CALL       PGM(LL025ER) PARM(&GNF &GNT &ARF &ART &PNR +
                          &LAGF &LAGT &DET &SALD &TYPE +
                          &BRUD &IN01 &FILE &EPOST)
             IF         COND(&IN01 = '1') THEN(GOTO CMDLBL(SLUTT)) /* +
                          Hvis &IN01 på, avslutter program. */

/*N01  */
/*S02        IF         COND(&FILE='J' *OR &FILE='F') THEN(DO)   */
/*S04        CRTPF      FILE(QTEMP/XXTOLLAG) RCDLEN(9999)  */
/*N04*/      CRTPF      FILE(QTEMP/XXTOLLAG) RCDLEN(9999) SIZE(1000000)
             MONMSG     MSGID(CPF0000)
             CLRPFM     FILE(XXTOLLAG)
/*S02        ENDDO     */
/*N01  */
/*                         */
/*    LASER                */
/*                         */
             IF         COND(&LAS = 'A') THEN(DO)
             OVRPRTF    FILE(LL025DPF) PAGESIZE(48 132) CPI(15) +
                          OVRFLW(43) PAGRTT(0) +
                          OUTQ(&PRT) FORMTYPE(&PTY) +
                          COPIES(&UKOPI) HOLD(&HOLD) SAVE(&SAVE)
             ENDDO
             IF         COND(&LAS = 'J') THEN(DO)
             OVRPRTF    FILE(LL025DPF) PAGESIZE(48 132) CPI(15) +
                          OVRFLW(43) PAGRTT(90) +
                          OUTQ(&PRT) FORMTYPE(&PTY) +
                          COPIES(&UKOPI) HOLD(&HOLD) SAVE(&SAVE)
             ENDDO
/*                         */
/*    IKKE LASER           */
/*                         */
             IF         COND(&LAS = ' ') THEN(DO)
             OVRPRTF    FILE(LL025DPF) PAGESIZE(48 132) CPI(10) +
                          OVRFLW(43) PRTQLTY(*DRAFT) OUTQ(&PRT) +
                          FORMTYPE(*STD)
             ENDDO

/*S01        CALL       PGM(LL025DR) PARM(&GNF &GNT &ARF &ART +
                          &PNR &LAGF &LAGF &DET &SALD &TYPE +
                          &BRUD &LAS &STR &KOPI)  **/
/*N01  */    CALL       PGM(LL025DR) PARM(&GNF &GNT &ARF &ART +
                          &PNR &LAGF &LAGT &DET &SALD &TYPE +
                          &BRUD &LAS &STR &KOPI &FILE)

/************************************************************************/
/*    P ER PDF TIL EPOST                                                */
/************************************************************************/
             IF         COND(&FILE *EQ 'P') THEN(DO)
             CALL       PGM(FAXEPMMCL) PARM(&QUSER &QNBR &QJOB &FILEN +
                          &EPOST +
                          &EMFAX &CVP2 &CVP3 &CVP4 &CVP5 +
                          &CVP6 &CVP7 &CVP8 &CVP9 &PDF)
             RETURN
             ENDDO
  /* EVT F = KUN FIL ER ENDRET TIL J I LL025DR */
             IF         COND(&FILE = 'J') THEN(DO)
             CTOPCF     FIL(XXTOLLAG) LIB(QTEMP) STMF(&STMFIL) +
                          RCDLEN(9999)
             CHGVAR     VAR(&EMNE) VALUE('TOLLAGER fra ' *CAT +
                          &GNF *CAT ' til ' *CAT &GNT *CAT '.')
             CHGDOCD    DOC(&STMF) FLR(&FLR) DOCD(&EMNE) +
                          USRAUT((*PUBLIC *ALL))
             SNDDST     TYPE(*DOC) TOINTNET((&EPOST)) DSTD('FIL') +
                          MSG('Vedlagt .csv-fil inneholder +
                          tollagerregnskap for de +
                          godsnummer/ekspeditionsnummer som er +
                          angitt i subject') DOC(&STMF) FLR(&FLR)
             SNDPGMMSG  MSG('Fil Tollag.csv er skapt og sendt som +
                          vedlegg til mail. ')
                        GOTO SLUTT
                        ENDDO
/*N01   SLUTT */
             SNDPGMMSG  MSG('Tollagerliste er sendt til printeren')
 SLUTT:      ENDPGM
