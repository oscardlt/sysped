/* *********************************************************************   */
/*       * RETTINGER I DETTE PROGRAM:                                      */
/* PTFnr:*Sek Sig Vers  Beskrivelse..........................              */
/* """"""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""    */
/* 11105 * 01 YBC PTF11 SEND EPOST PÅ NCTS-MELDING                         */
/* ********************************************************************    */
             PGM        PARM(&FILE &LIBRARY &MEMBER)
             DCL        VAR(&FILE) TYPE(*CHAR) LEN(10) /* File    */
             DCL        VAR(&LIBRARY) TYPE(*CHAR) LEN(10) /* Library */
             DCL        VAR(&MEMBER) TYPE(*CHAR) LEN(10) /* Member  */
             DCL        VAR(&AVD) TYPE(*DEC) LEN(4 0) /* Avdeling */
             DCL        VAR(&MRKP) TYPE(*CHAR) LEN(10) /* Printer +
                          Device for Merknader */
             DCL        VAR(&OK) TYPE(*CHAR) LEN(1) /* Status fra +
                          program, N=Nei(Ikke OK), J=Ja(OK) */
             DCL        VAR(&OKPRT) TYPE(*CHAR) LEN(1) /* Printerdata+
                          finnes for avdelingen J/N         */
             DCL        VAR(&WS) TYPE(*CHAR) LEN(10) VALUE(TVINR) /* +
                          "Skjerm ID"= Membernavn arbeidsfil*/
             DCL        VAR(&USER) TYPE(*CHAR) LEN(10)
/* N01 START */
             DCL        VAR(&PRTFIL) TYPE(*CHAR) LEN(10) +
                          VALUE('TVINME')
             DCL        VAR(&EPOST) TYPE(*CHAR) LEN(70)
             DCL        VAR(&SLUTT) TYPE(*CHAR) LEN(1)
             DCL        VAR(&EMNE) TYPE(*CHAR) LEN(70)
/* N01 SLUTT */

           /*______________________________________________*/
           /* Konvertere meldinger.                        */
           /* - Oppdatere Transitt register med en unik    */
           /*   status for: Mottatt men ikke utskrevet.    */
           /* - Hvis det er noe feil med datane skrives    */
           /*   det ut en feillogg.                        */
           /*""""""""""""""""""""""""""""""""""""""""""""""*/
             CALL       PGM(TR154R) PARM(&LIBRARY &FILE &MEMBER &WS +
                          &OK)
             IF         COND(&OK *EQ N) THEN(GOTO CMDLBL(END))
           /*_________________________*/
           /* Skriv ut lossetillatelse*/
           /*"""""""""""""""""""""""""*/
             RTVJOBA    USER(&USER)
             CALL       PGM(TR157R) PARM(&USER &WS)
           /*______________________________________________*/
           /* Hente avdelingsopplysninger for å overstyre  */
           /* printerfiler. Ingen med A/B/Å i staus-OK=N   */
           /*""""""""""""""""""""""""""""""""""""""""""""""*/
 GETAVD:     CALL       PGM(TR155R) PARM(&AVD &MRKP &WS &OK &OKPRT)
             IF         COND(&OK *EQ N) THEN(GOTO CMDLBL(END))

             IF         COND(&OKPRT *EQ N) THEN(CHGVAR VAR(&MRKP) +
                          VALUE(*SYSVAL))

             OVRPRTF    FILE(TVINME) PAGESIZE(72 80) OVRFLW(66) +
                          OUTQ(&MRKP) SECURE(*YES)
           /*_________________________*/
           /* Skriv ut Merknader (ME) */
           /*"""""""""""""""""""""""""*/
/* N01 START */
/*           CALL       PGM(TR156R) PARM(&AVD &WS) */
 STME:       CALL       PGM(TR156R) PARM(&AVD &WS &SLUTT &EPOST &EMNE)
             IF         COND(&SLUTT *NE 'J') THEN(DO)
             IF         COND(&EPOST *NE ' ') THEN(DO)
             CALL       PGM(PDF037CL) PARM(&PRTFIL &EPOST &EMNE)
             ENDDO
             GOTO       CMDLBL(STME)
             ENDDO
/* N01 SLUTT */
             GOTO       CMDLBL(GETAVD)
 END:        ENDPGM
