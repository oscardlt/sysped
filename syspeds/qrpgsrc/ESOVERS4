      *********************************************************************
      * Sp¯rring pÂ oppdrag (vis oppdrag)
      * PROGRAM BEHANDLER INPUT FRA ESOVERS2
********************************************************************
CRTPG+* CRTPGM SYSPED/ESOVERS4 MODULE(*LIBL/ESOVERS4
CRTPGM*        *LIBL/CHECKUSR *LIBL/INCGI) ACTGRP(CGI) AUT(*USE)
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 OPPDATER ETA P≈ HEADF
10XXX * 02 YBC PTF10 Felles T&T-kode ved datoendring CHD (f¯r ETD,ATD....)
10XXX * 03 YBC PTF10 ≈RSAK TIL DATO ENDRING
10019 * 04 YBC PTF10 NYE DATOFELTER
10XXX * 05 YBC PTF10 OPPDATER ATD OG ATA P≈ BILLOF/HEADF
10XXX * 06 YBC PTF10 OPPDATER ETA OG ATA P≈ BILLOF/HEADF
10172 * 07 SH  PTF10 norsk text til Track and trace
10XXX * 08 YBC PTF10 SEND ASNSTS TIL EUROPRIS
10XXX * 09 YBC PTF10 SEND ASNSTS TIL VOICE
10XXX * 10 YBC PTF10 RETTELSE P≈ ENDRING 8
********************************************************************
      *
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
     FBRIDF     UF   E           K DISK    USROPN
N03  FBRPARF    IF   E           K DISK    USROPN
N04  FFRISOK    IF   E           K DISK    USROPN
S05  F*BILLOF    IF   E           K DISK    USROPN
N05  FBILLOF    UF   E           K DISK    USROPN
     FBILLOFLG  IF   E           K DISK    USROPN
     F                                     RENAME(BILLOFR:BILLOFRLG)
     FBILLOFL2  IF   E           K DISK    USROPN
     F                                     RENAME(BILLOFR:BILLOFRL2)
     FTRACKT    UF   E           K DISK    USROPN
     FTRACKF    O  A E             DISK    USROPN
N01  FHEADF     UF   E           K DISK    USROPN
N09  FEPOPOS    IF   E           K DISK    USROPN
      *--------------------------------------------------------------------
      * Prototype defintions and standard system API error structure
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      *--------------------------------------------------------------------
      * Variables common to CGI programs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
     D OddEven         s             10
      * Variables received from the input string
     D lng             s              2
     D UsrSpcName      s             10
     D WSUSER          S             10
     D WSAVD           S              4
     D BSAVD           S              4  0
     D WSOPD           S              7
     D BSOPD           S              7  0
     D WSETA           S             10
     D WSETD           S             10
     D WSATA           S             10
     D WSATD           S             10
N04  D WSOS01          S             10
N04  D WSOS02          S             10
N04  D WSOS03          S             10
N04  D WSOS04          S             10
N04  D WSOS05          S             10
N04  D WSOS06          S             10
N04  D WSOS07          S             10
N03  D WSEDRE          S              3
     D WSIN            S              1
     D AVSLUTT         S              1
     D PGM             C                   CONST('*LIBL/CHECKUSR')
     D FMELDNR         S              2
     D FEILMELDING     S             80
     D OKBUTTON        S             80
      *
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
      *
     D                 DS
     D BSETA                   1      8  0
     D BSETA≈                  1      4  0
     D BSETAM                  5      6  0
     D BSETAD                  7      8  0
N04  D BSETA8                  1      8
     D                 DS
     D BSETD                   1      8  0
     D BSETD≈                  1      4  0
     D BSETDM                  5      6  0
     D BSETDD                  7      8  0
N04  D BSETD8                  1      8
     D                 DS
     D BSATA                   1      8  0
     D BSATA≈                  1      4  0
     D BSATAM                  5      6  0
     D BSATAD                  7      8  0
N04  D BSATA8                  1      8
     D                 DS
     D BSATD                   1      8  0
     D BSATD≈                  1      4  0
     D BSATDM                  5      6  0
     D BSATDD                  7      8  0
N04  D BSATD8                  1      8
N04  D                 DS
N04  D BSOS01                  1      8  0
N04  D BSOS01≈                 1      4  0
N04  D BSOS01M                 5      6  0
N04  D BSOS01D                 7      8  0
N04  D BSOS018                 1      8
N04  D                 DS
N04  D BSOS02                  1      8  0
N04  D BSOS02≈                 1      4  0
N04  D BSOS02M                 5      6  0
N04  D BSOS02D                 7      8  0
N04  D BSOS028                 1      8
N04  D                 DS
N04  D BSOS03                  1      8  0
N04  D BSOS03≈                 1      4  0
N04  D BSOS03M                 5      6  0
N04  D BSOS03D                 7      8  0
N04  D BSOS038                 1      8
N04  D                 DS
N04  D BSOS04                  1      8  0
N04  D BSOS04≈                 1      4  0
N04  D BSOS04M                 5      6  0
N04  D BSOS04D                 7      8  0
N04  D BSOS048                 1      8
N04  D                 DS
N04  D BSOS05                  1      8  0
N04  D BSOS05≈                 1      4  0
N04  D BSOS05M                 5      6  0
N04  D BSOS05D                 7      8  0
N04  D BSOS058                 1      8
N04  D                 DS
N04  D BSOS06                  1      8  0
N04  D BSOS06≈                 1      4  0
N04  D BSOS06M                 5      6  0
N04  D BSOS06D                 7      8  0
N04  D BSOS068                 1      8
N04  D                 DS
N04  D BSOS07                  1      8  0
N04  D BSOS07≈                 1      4  0
N04  D BSOS07M                 5      6  0
N04  D BSOS07D                 7      8  0
N04  D BSOS078                 1      8
N04  D                 DS
N04  D FSSOK                   1     35
N04  D FSSOKAVD                1      4
N04  D FSSOKOPD                6     12
      *
     D FEIL01          C                   CONST('ETD is not valid.')
     D FEIL02          C                   CONST('ATD is not valid.')
     D FEIL03          C                   CONST('ETA is not valid.')
     D FEIL04          C                   CONST('ATA is not valid.')
N03  D FEIL05          C                   CONST('You have to select a reason -
N03  D                                     since at least one of dates is -
N03  D                                     changed.')
N04  D FEIL06          C                   CONST('Dato for ready from supplier -
N04  D                                     is not valid.')
N04  D FEIL07          C                   CONST('Deadline for shipping is not -
N04  D                                     valid.')
N04  D FEIL08          C                   CONST('Deadline for arrival is not -
N04  D                                     valid.')
N04  D FEIL09          C                   CONST('Shipping window is not -
N04  D                                     valid.')
N04  D FEIL10          C                   CONST('Arrival window is not -
N04  D                                     valid.')
     D                 DS
     D  ParmOS1                1   1024
     D  OSCHG                  1      1
      *
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================******
      * MAIN PROCESS LINE
      *=====================================================================******
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input
     C                   exsr      Parse
      *
     C                   EXSR      INIT
      *
     C                   CALLB     PGM
     C                   PARM                    BIBRID
     C                   PARM                    UsrSpcName
     C                   PARM                    UINN              1
     C                   IF        UINN = 'N'
     C                   GOTO      SLUTT
     C                   END
     C     WSUSER        CHAIN     BRIDF                              50
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           BIDTF
     C                   MOVE      WTM           BITIDF
     C                   UPDATE    BRIDFR
      * Set output skeleton html member name
     C                   exsr      SetSkl
      * Read skeleton output html, etc.
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
      * Retrieve environment variables
     C                   exsr      RtvEnvVar
      *
     C                   IF        WSIN = 'J'
     C     TRACKTK       CHAIN(N)  TRACKT                             33
     C                   MOVE      TXETDD        BSETD
     C                   MOVE      TXETAD        BSETA
     C                   MOVE      TXATDD        BSATD
     C                   MOVE      TXATAD        BSATA
N04  C                   MOVE      TXOS01        BSOS01
N04  C                   MOVE      TXOS02        BSOS02
N04  C                   MOVE      TXOS03        BSOS03
N04  C                   MOVE      TXOS04        BSOS04
N04  C                   MOVE      TXOS05        BSOS05
N04  C                   MOVE      TXOS06        BSOS06
N04  C                   MOVE      TXOS07        BSOS07
     C                   ELSE
     C                   exsr      TESTIN
     C                   END
      * 1-Section /$top
     C                   exsr      SetTop
     C                   callp     wrtsection('top')
N03   *
N03  C                   exsr      VISREASON
      *
     C     SLUTT         TAG
     C                   EXSR      EXIT
     C                   return
      *
      *=====================================================================******
      * Parse input
      *=====================================================================******
     C     Parse         begsr
     C                   eval      lng     = zhbgetvar('lng')
     C                   eval      WSUSER  = zhbgetvar('USER')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   eval      WSAVD   = zhbgetvar('WSAVD')
     C                   EVAL      BSAVD = c2n2(WSAVD)
     C                   eval      WSOPD   = zhbgetvar('WSOPD')
     C                   EVAL      BSOPD = c2n2(WSOPD)
     C                   eval      WSETA   = zhbgetvar('WSETA')
     C                   EVAL      BSETA = c2n2(WSETA)
     C                   eval      WSETD   = zhbgetvar('WSETD')
     C                   EVAL      BSETD = c2n2(WSETD)
     C                   eval      WSATA   = zhbgetvar('WSATA')
     C                   EVAL      BSATA = c2n2(WSATA)
     C                   eval      WSATD   = zhbgetvar('WSATD')
     C                   EVAL      BSATD = c2n2(WSATD)
N04  C                   eval      WSOS01  = zhbgetvar('WSOS01')
N04  C                   EVAL      BSOS01  = c2n2(WSOS01)
N04  C                   eval      WSOS02  = zhbgetvar('WSOS02')
N04  C                   EVAL      BSOS02  = c2n2(WSOS02)
N04  C                   eval      WSOS03  = zhbgetvar('WSOS03')
N04  C                   EVAL      BSOS03  = c2n2(WSOS03)
N04  C                   eval      WSOS04  = zhbgetvar('WSOS04')
N04  C                   EVAL      BSOS04  = c2n2(WSOS04)
N04  C                   eval      WSOS05  = zhbgetvar('WSOS05')
N04  C                   EVAL      BSOS05  = c2n2(WSOS05)
N04  C                   eval      WSOS06  = zhbgetvar('WSOS06')
N04  C                   EVAL      BSOS06  = c2n2(WSOS06)
N04  C                   eval      WSOS07  = zhbgetvar('WSOS07')
N04  C                   EVAL      BSOS07  = c2n2(WSOS07)
N03  C                   eval      WSEDRE  = zhbgetvar('WSEDRE')
     C                   eval      WSIN    = zhbgetvar('WSIN')
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$top
      *  (search criteria)
      *=====================================================================******
     C     SetTop        begsr
      * Repeat national language for the next invocation
     C                   callp     updhtmlvar('LNG':lng:
     C                             InitHTMLVars)
     C                   callp     updHTMLvar('ROWHEAD':RowHead)
     C                   callp     updHTMLvar('LogoImg':LogoImg)
      * Color for text, background, links, visited links, active links
     C                   callp     updhtmlvar('TXTCOLOR':'black')
     C                   callp     updhtmlvar('BOLD':' ')
     C                   callp     updhtmlvar('BGCOLOR':BIFARG)
     C                   callp     updhtmlvar('LINK':'0000FF')
     C                   callp     updhtmlvar('VLINK':'FF0000')
     C                   callp     updhtmlvar('ALINK':'00FF00')
      * KUNDE
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updHtmlVar('USER':WSUSER)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHTMLvar('WSNA':BIBESK)
     C                   callp     updHtmlVar('KUNDE':
     C                             %trim(%editc(BIKUNR:'Z')))
     C                   callp     updHTMLvar('sdato':
     C                             %trim(%editw(BIDTV:'    .  .  ')))
     C                   callp     updHTMLvar('stid':
     C                             %trim(%editw(BITIDV:'  .  .  ')))
      *
     C                   callp     updHtmlVar('WSAVD':
     C                             %trim(%editc(BSAVD:'Z')))
     C                   callp     updHtmlVar('WSOPD':
     C                             %trim(%editc(BSOPD:'Z')))
     C                   callp     updHtmlVar('WSETD':
     C                             %trim(%editw(BSETD:'    .  .  ')))
     C                   callp     updHtmlVar('WSETA':
     C                             %trim(%editw(BSETA:'    .  .  ')))
     C                   callp     updHtmlVar('WSATD':
     C                             %trim(%editw(BSATD:'    .  .  ')))
     C                   callp     updHtmlVar('WSATA':
     C                             %trim(%editw(BSATA:'    .  .  ')))
N04  C                   callp     updHtmlVar('WSOS01':
N04  C                             %trim(%editw(BSOS01:'    .  .  ')))
N04  C                   callp     updHtmlVar('WSOS02':
N04  C                             %trim(%editw(BSOS02:'    .  .  ')))
N04  C                   callp     updHtmlVar('WSOS03':
N04  C                             %trim(%editw(BSOS03:'    .  .  ')))
N04  C                   callp     updHtmlVar('WSOS04':
N04  C                             %trim(%editw(BSOS04:'    .  .  ')))
N04  C                   callp     updHtmlVar('WSOS05':
N04  C                             %trim(%editw(BSOS05:'    .  .  ')))
N04  C                   callp     updHtmlVar('WSOS06':
N04  C                             %trim(%editw(BSOS06:'    .  .  ')))
N04  C                   callp     updHtmlVar('WSOS07':
N04  C                             %trim(%editw(BSOS07:'    .  .  ')))
      *
S05  C*    BILLOFK       CHAIN     BILLOF                             33
N05  C     BILLOFK       CHAIN(N)  BILLOF                             33
     C                   callp     updHTMLvar('BLREIS':BLREIS)
      *
     C                   callp     updHTMLvar('WSIN':'N')
     C                   callp     updHTMLvar('AVSLUTT':AVSLUTT)
     C                   callp     updhtmlvar('FEILMELDING':
     C                             FEILMELDING)
     C                   callp     updhtmlvar('FMELDNR':FMELDNR)
     C                   callp     updhtmlvar('OKBUTTON':OKBUTTON)
      *
     C                   endsr
      *=====================================================================******
      * Set html output skeleton member before its read into memory
      *=====================================================================******
     C     SetSkl        begsr
      *------------------
      * Set html output skeleton member
     C                   eval      lng = uppify(lng)
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC' + lng
     C                   eval      Mbr = 'ESOVERS4'
     C*                  CAT       XSPR≈K:0      MBR
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$endhtml
      *=====================================================================******
     C     SetEnd        begsr
      * Server protocol
     C                   callp     updhtmlvar('PROTOCOL':S_Protocol)
      * Compute run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   endsr
      *=====================================================================******
      *  Retrieve environment variables
      *=====================================================================******
     C     RtvEnvVar     begsr
      * Use getenvp to get this server's protocol and name
     C                   eval      S_Protocol =getenv('SERVER_PROTOCOL':
     C                             qusec)
     C                   eval      S_Name     =getenv('SERVER_NAME':
     C                             qusec)
      *
     C                   endsr
      *
      *////////////////////////////////////////////////////////////
     C     TESTIN        BEGSR
      *////////////////////////////////////////////////////////////
      *
      * TEST ETD
     C                   IF        BSETD <> 0
     C                   MOVE      BSETDD        UDD               2 0
     C                   MOVE      BSETDM        UMM               2 0
     C                   MOVE      BSETD≈        U≈≈               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    U≈≈
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL01        FEILMELDING
     C                   MOVE      '01'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   END
      *
      * TEST ATD
     C                   IF        BSATD <> 0
     C                   MOVE      BSATDD        UDD               2 0
     C                   MOVE      BSATDM        UMM               2 0
     C                   MOVE      BSATD≈        U≈≈               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    U≈≈
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL02        FEILMELDING
     C                   MOVE      '02'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   END
      *
      * TEST ETA
     C                   IF        BSETA <> 0
     C                   MOVE      BSETAD        UDD               2 0
     C                   MOVE      BSETAM        UMM               2 0
     C                   MOVE      BSETA≈        U≈≈               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    U≈≈
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL03        FEILMELDING
     C                   MOVE      '03'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   END
      *
      * TEST ATA
     C                   IF        BSATA <> 0
     C                   MOVE      BSATAD        UDD               2 0
     C                   MOVE      BSATAM        UMM               2 0
     C                   MOVE      BSATA≈        U≈≈               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    U≈≈
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL04        FEILMELDING
     C                   MOVE      '04'          FMELDNR
     C                   GOTO      SLTBDT
     C                   ENDIF
     C                   END
N03   * TEST OM ≈RSAK ER GITT
N03  C     TRACKTK       CHAIN(N)  TRACKT                             33
N03  C  N33              IF        (((((TXETAD <> 0) AND (TXETAD <> BSETA)) OR
N03  C                                ((TXETDD <> 0) AND (TXETDD <> BSETD))) OR
N03  C                                ((TXATAD <> 0) AND (TXATAD <> BSATA))) OR
N03  C                                ((TXATDD <> 0) AND (TXATDD <> BSATD)))
N03  C                   IF        WSEDRE = *BLANKS
N03  C                   MOVEL     FEIL05        FEILMELDING
N03  C                   MOVE      '05'          FMELDNR
N03  C                   GOTO      SLTBDT
N03  C                   END
N03  C                   END
N04   *
N04   * TEST KLAR FRA LEVERANDÿR
N04  C                   IF        BSOS01 <> 0
N04  C                   MOVE      BSOS01D       UDD               2 0
N04  C                   MOVE      BSOS01M       UMM               2 0
N04  C                   MOVE      BSOS01≈       U≈≈               2 0
N04  C                   CALL      'TESTDATO'
N04  C                   PARM                    UDD
N04  C                   PARM                    UMM
N04  C                   PARM                    U≈≈
N04  C                   PARM                    UFLAGG            1 0
N04  C     UFLAGG        IFEQ      1
N04  C                   MOVEL     FEIL06        FEILMELDING
N04  C                   MOVE      '06'          FMELDNR
N04  C                   GOTO      SLTBDT
N04  C                   ENDIF
N04  C                   END
N04   *
N04   * TEST FRIST FOR SHIPPING
N04  C                   IF        BSOS02 <> 0
N04  C                   MOVE      BSOS02D       UDD               2 0
N04  C                   MOVE      BSOS02M       UMM               2 0
N04  C                   MOVE      BSOS02≈       U≈≈               2 0
N04  C                   CALL      'TESTDATO'
N04  C                   PARM                    UDD
N04  C                   PARM                    UMM
N04  C                   PARM                    U≈≈
N04  C                   PARM                    UFLAGG            1 0
N04  C     UFLAGG        IFEQ      1
N04  C                   MOVEL     FEIL07        FEILMELDING
N04  C                   MOVE      '07'          FMELDNR
N04  C                   GOTO      SLTBDT
N04  C                   ENDIF
N04  C                   END
N04   *
N04   * TEST FRIST FOR ANKOMST
N04  C                   IF        BSOS03 <> 0
N04  C                   MOVE      BSOS03D       UDD               2 0
N04  C                   MOVE      BSOS03M       UMM               2 0
N04  C                   MOVE      BSOS03≈       U≈≈               2 0
N04  C                   CALL      'TESTDATO'
N04  C                   PARM                    UDD
N04  C                   PARM                    UMM
N04  C                   PARM                    U≈≈
N04  C                   PARM                    UFLAGG            1 0
N04  C     UFLAGG        IFEQ      1
N04  C                   MOVEL     FEIL08        FEILMELDING
N04  C                   MOVE      '08'          FMELDNR
N04  C                   GOTO      SLTBDT
N04  C                   ENDIF
N04  C                   END
N04   *
N04   * TEST SHIPPING VINDU FRA
N04  C                   IF        BSOS04 <> 0
N04  C                   MOVE      BSOS04D       UDD               2 0
N04  C                   MOVE      BSOS04M       UMM               2 0
N04  C                   MOVE      BSOS04≈       U≈≈               2 0
N04  C                   CALL      'TESTDATO'
N04  C                   PARM                    UDD
N04  C                   PARM                    UMM
N04  C                   PARM                    U≈≈
N04  C                   PARM                    UFLAGG            1 0
N04  C     UFLAGG        IFEQ      1
N04  C                   MOVEL     FEIL09        FEILMELDING
N04  C                   MOVE      '09'          FMELDNR
N04  C                   GOTO      SLTBDT
N04  C                   ENDIF
N04  C                   END
N04   *
N04   * TEST SHIPPING VINDU TIL
N04  C                   IF        BSOS05 <> 0
N04  C                   MOVE      BSOS05D       UDD               2 0
N04  C                   MOVE      BSOS05M       UMM               2 0
N04  C                   MOVE      BSOS05≈       U≈≈               2 0
N04  C                   CALL      'TESTDATO'
N04  C                   PARM                    UDD
N04  C                   PARM                    UMM
N04  C                   PARM                    U≈≈
N04  C                   PARM                    UFLAGG            1 0
N04  C     UFLAGG        IFEQ      1
N04  C                   MOVEL     FEIL09        FEILMELDING
N04  C                   MOVE      '09'          FMELDNR
N04  C                   GOTO      SLTBDT
N04  C                   ENDIF
N04  C                   END
N04   *
N04   * TEST SHIPPING VINDU
N04  C                   IF        BSOS04 > BSOS05
N04  C                   MOVEL     FEIL09        FEILMELDING
N04  C                   MOVE      '09'          FMELDNR
N04  C                   GOTO      SLTBDT
N04  C                   END
N04   *
N04   * TEST ANKOMST VINDU FRA
N04  C                   IF        BSOS06 <> 0
N04  C                   MOVE      BSOS06D       UDD               2 0
N04  C                   MOVE      BSOS06M       UMM               2 0
N04  C                   MOVE      BSOS06≈       U≈≈               2 0
N04  C                   CALL      'TESTDATO'
N04  C                   PARM                    UDD
N04  C                   PARM                    UMM
N04  C                   PARM                    U≈≈
N04  C                   PARM                    UFLAGG            1 0
N04  C     UFLAGG        IFEQ      1
N04  C                   MOVEL     FEIL10        FEILMELDING
N04  C                   MOVE      '10'          FMELDNR
N04  C                   GOTO      SLTBDT
N04  C                   ENDIF
N04  C                   END
N04   *
N04   * TEST ANKOMST VINDU TIL
N04  C                   IF        BSOS07 <> 0
N04  C                   MOVE      BSOS07D       UDD               2 0
N04  C                   MOVE      BSOS07M       UMM               2 0
N04  C                   MOVE      BSOS07≈       U≈≈               2 0
N04  C                   CALL      'TESTDATO'
N04  C                   PARM                    UDD
N04  C                   PARM                    UMM
N04  C                   PARM                    U≈≈
N04  C                   PARM                    UFLAGG            1 0
N04  C     UFLAGG        IFEQ      1
N04  C                   MOVEL     FEIL10        FEILMELDING
N04  C                   MOVE      '10'          FMELDNR
N04  C                   GOTO      SLTBDT
N04  C                   ENDIF
N04  C                   END
N04   *
N04   * TEST ANKOMST VINDU
N04  C                   IF        BSOS06 > BSOS07
N04  C                   MOVEL     FEIL10        FEILMELDING
N04  C                   MOVE      '10'          FMELDNR
N04  C                   GOTO      SLTBDT
N04  C                   END
      *
      * OPPDATER DATO
     C                   MOVE      'Y'           AVSLUTT
S05  C*    BILLOFK       CHAIN     BILLOF                             33
N05  C     BILLOFK       CHAIN(N)  BILLOF                             33
     C                   SELECT
     C                   WHEN      ((BLREIS = *BLANKS) AND (BLBLNR = *BLANKS))
     C     TRACKTK       CHAIN     TRACKT                             33
     C                   IF        *IN33 = *OFF
N08   *
N08   * SEND ASNSTS TIL EUROPRIS
N08  C     HEADFK        CHAIN(N)  HEADF                              34
S09  C* N34              IF        HEKNA = 12497 OR (BIFIRM='SY' AND HEKNA=7032)
N09  C  N34              IF        TRKNFA = 12497 OR TRKNFA = 21647 OR
N09  C                             (BIFIRM='SY' AND HEKNA=7032)
N08  C                   EXSR      ASNSTS1
N08  C                   END
N08   *
     C                   EXSR      OPDLOG
N04  C                   EXSR      TSTVINDU
cc    * POMS er CC-spesial, men lagt inn i std/hos Systema for Â kunne teste
cc   c                   IF        BSETA <> TXETAD
cc   c                             or BSETD <> TXETDD
cc   c                             or BSATA <> TXATAD
cc   c                             or BSATD <> TXATDD
cc   c                   call      'EPOMS41'
cc   c                   parm                    BSAVD
cc   c                   parm                    BSOPD
cc   c                   parm      BSETD         UUETD             8 0
cc   c                   parm      BSETA         UUETA             8 0
cc   c                   parm      BSATD         UUATD             8 0
cc   c                   parm      BSATA         UUATA             8 0
cc   c                   parm                    POMSDS          256
cc   c                   endif
     C                   MOVE      BSETA         TXETAD
     C                   MOVE      BSETD         TXETDD
     C                   MOVE      BSATA         TXATAD
     C                   MOVE      BSATD         TXATDD
N04  C                   MOVE      BSOS01        TXOS01
N04  C                   MOVE      BSOS02        TXOS02
N04  C                   MOVE      BSOS03        TXOS03
N04  C                   MOVE      BSOS04        TXOS04
N04  C                   MOVE      BSOS05        TXOS05
N04  C                   MOVE      BSOS06        TXOS06
N04  C                   MOVE      BSOS07        TXOS07
     C                   UPDATE    TRACKTR
N04   * OPPDATER SYSPED-OPPDRAG
N04  C                   EXSR      OPDSYSOPD
N04   *
N08   * SEND ASNSTS TIL EUROPRIS
S09  C* N34              IF        HEKNA = 12497 OR (BIFIRM='SY' AND HEKNA=7032)
N09  C  N34              IF        TRKNFA = 12497 OR TRKNFA = 21647 OR
N09  C                             (BIFIRM='SY' AND HEKNA=7032)
N08  C                   EXSR      ASNSTS2
N08  C                   END
     C                   END
     C                   WHEN      BLBLNR <> *BLANKS
     C     BILLOFLGK     SETLL     BILLOFLG
     C     BILLOFLGK     READE     BILLOFLG                               33
     C                   DOW       *IN33 = *OFF
     C     TRACKTK2      CHAIN     TRACKT                             33
     C  N33              IF        TXATAD = 0
N08   *
N08   * SEND ASNSTS TIL EUROPRIS
N08  C     HEADFK        CHAIN(N)  HEADF                              34
S09  C* N34              IF        HEKNA = 12497 OR (BIFIRM='SY' AND HEKNA=7032)
N09  C  N34              IF        TRKNFA = 12497 OR TRKNFA = 21647 OR
N09  C                             (BIFIRM='SY' AND HEKNA=7032)
N08  C                   EXSR      ASNSTS1
N08  C                   END
N08   *
     C                   EXSR      OPDLOG
N04  C                   EXSR      TSTVINDU
cc    * POMS er CC-spesial, men lagt inn i std/hos Systema for Â kunne teste
cc   c                   IF        BSETA <> TXETAD
cc   c                             or BSETD <> TXETDD
cc   c                             or BSATA <> TXATAD
cc   c                             or BSATD <> TXATDD
cc   c                   call      'EPOMS41'
cc   c                   parm                    BSAVD
cc   c                   parm                    BSOPD
cc   c                   parm      BSETD         UUETD             8 0
cc   c                   parm      BSETA         UUETA             8 0
cc   c                   parm      BSATD         UUATD             8 0
cc   c                   parm      BSATA         UUATA             8 0
cc   c                   parm                    POMSDS          256
cc   c                   endif
     C                   MOVE      BSETA         TXETAD
     C                   MOVE      BSETD         TXETDD
     C                   MOVE      BSATA         TXATAD
     C                   MOVE      BSATD         TXATDD
N04  C                   MOVE      BSOS01        TXOS01
N04  C                   MOVE      BSOS02        TXOS02
N04  C                   MOVE      BSOS03        TXOS03
N04  C                   MOVE      BSOS04        TXOS04
N04  C                   MOVE      BSOS05        TXOS05
N04  C                   MOVE      BSOS06        TXOS06
N04  C                   MOVE      BSOS07        TXOS07
     C                   END
     C  N33              UPDATE    TRACKTR
N04   * OPPDATER SYSPED-OPPDRAG
N04  C  N33              EXSR      OPDSYSOPD
N04   *
N08   * SEND ASNSTS TIL EUROPRIS
S09  C* N34              IF        HEKNA = 12497 OR (BIFIRM='SY' AND HEKNA=7032)
N09  C  N34              IF        TRKNFA = 12497 OR TRKNFA = 21647 OR
N09  C                             (BIFIRM='SY' AND HEKNA=7032)
N08  C                   EXSR      ASNSTS2
N08  C                   END
     C     BILLOFLGK     READE     BILLOFLG                               33
     C                   ENDDO
     C                   WHEN      BLREIS <> *BLANKS
     C     BILLOFL2K     SETLL     BILLOFL2
     C     BILLOFL2K     READE     BILLOFL2                               33
     C                   DOW       *IN33 = *OFF
     C     TRACKTK2      CHAIN     TRACKT                             33
     C  N33              IF        TXATAD = 0
N08   *
N08   * SEND ASNSTS TIL EUROPRIS
N08  C     HEADFK        CHAIN(N)  HEADF                              34
S09  C* N34              IF        HEKNA = 12497 OR (BIFIRM='SY' AND HEKNA=7032)
N09  C  N34              IF        TRKNFA = 12497 OR TRKNFA = 21647 OR
N09  C                             (BIFIRM='SY' AND HEKNA=7032)
N08  C                   EXSR      ASNSTS1
N08  C                   END
N08   *
     C                   EXSR      OPDLOG
N04  C                   EXSR      TSTVINDU
     C                   MOVE      BSETA         TXETAD
     C                   MOVE      BSETD         TXETDD
     C                   MOVE      BSATA         TXATAD
     C                   MOVE      BSATD         TXATDD
N04  C                   MOVE      BSOS01        TXOS01
N04  C                   MOVE      BSOS02        TXOS02
N04  C                   MOVE      BSOS03        TXOS03
N04  C                   MOVE      BSOS04        TXOS04
N04  C                   MOVE      BSOS05        TXOS05
N04  C                   MOVE      BSOS06        TXOS06
N04  C                   MOVE      BSOS07        TXOS07
     C                   END
     C  N33              UPDATE    TRACKTR
N04   * OPPDATER SYSPED-OPPDRAG
N04  C  N33              EXSR      OPDSYSOPD
N04   *
S09  C* N34              IF        HEKNA = 12497 OR (BIFIRM='SY' AND HEKNA=7032)
N09  C  N34              IF        TRKNFA = 12497 OR TRKNFA = 21647 OR
N09  C                             (BIFIRM='SY' AND HEKNA=7032)
N08  C                   EXSR      ASNSTS2
N08  C                   END
     C     BILLOFL2K     READE     BILLOFL2                               33
     C                   ENDDO
     C                   ENDSL
      * Dersom ATA nÂ er satt - switch oppdragstype
     c     TXATAD        IFNE      *zeros
      * systema manlglet load for ESOVERS4B - navnet tatt i bruk til annet - enkler Â endre her
s02  c*                  call      'ESOVERS4B'
n02  c                   call      'ESOVERS4C'
     c                   parm                    TXAVD
     c                   parm                    TXOPD
     c                   parm                    BIFIRM
     c                   parm                    BIBRID
     c                   end
      *
     C     SLTBDT        ENDSR
      *
N08   *////////////////////////////////////////////////////////////
N08  C     ASNSTS1       BEGSR
N08   *////////////////////////////////////////////////////////////
N08  C                   MOVE      'N'           XFUNKS40          1
N08  C                   MOVE      'N'           XFUNKS50          1
S10  C*                  IF        BSETA <> 0 AND BSETA <> TXETAD
N10  C                   IF        BSATD <> 0 AND
N10  C                             BSETA <> 0 AND BSETA <> TXETAD
N08  C                   EVAL      XFUNKS40 = 'J'
N08  C                   END
N08  C                   IF        BSATA <> 0 AND BSATA <> TXATAD
N08  C                   EVAL      XFUNKS50 = 'J'
N08  C                   END
N08   *
N08  C                   ENDSR
N08   *
N08   *////////////////////////////////////////////////////////////
N08  C     ASNSTS2       BEGSR
N08   *////////////////////////////////////////////////////////////
N09  C                   OPEN      EPOPOS
N09  C     EPOPOSK       CHAIN     EPOPOS                             33
N09  C                   CLOSE     EPOPOS
N09  C                   IF        *IN33 = *OFF
N08  C                   IF        XFUNKS40 = 'J'
N09  C                   SELECT
N09  C                   WHEN      TRKNFA = 12497 OR
N09  C                             (BIFIRM='SY' AND HEKNA=7032)
N08  C                   MOVE      HEAVD         UAVDASN           4
N08  C                   MOVE      HEOPD         UOPDASN           7
N08  C                   MOVE      '40'          USTSASN           2
N08  C                   CALL      'EUR04CL'
N08  C                   PARM                    UAVDASN
N08  C                   PARM                    UOPDASN
N08  C                   PARM                    USTSASN
N09  C                   WHEN      TRKNFA = 21647
N09  C                   CALL      'EPOMS53R'
N09  C                   PARM                    HEAVD
N09  C                   PARM                    HEOPD
N09  C                   ENDSL
N08  C                   END
N08  C                   IF        XFUNKS50 = 'J'
N09  C                   SELECT
N09  C                   WHEN      TRKNFA = 12497 OR
N09  C                             (BIFIRM='SY' AND HEKNA=7032)
N08  C                   MOVE      HEAVD         UAVDASN           4
N08  C                   MOVE      HEOPD         UOPDASN           7
N08  C                   MOVE      '50'          USTSASN           2
N08  C                   CALL      'EUR04CL'
N08  C                   PARM                    UAVDASN
N08  C                   PARM                    UOPDASN
N08  C                   PARM                    USTSASN
N09  C                   WHEN      TRKNFA = 21647
N09  C                   CALL      'EPOMS53R'
N09  C                   PARM                    HEAVD
N09  C                   PARM                    HEOPD
N09  C                   ENDSL
N08  C                   END
N09  C                   END
N08   *
N08  C                   ENDSR
N08   *
      *////////////////////////////////////////////////////////////
     C     OPDLOG        BEGSR
      *////////////////////////////////////////////////////////////
      * ETA
     C                   IF        BSETA <> TXETAD
S04  C*                  MOVE      BSAVD         TTAVD
S04  C*                  MOVE      BSOPD         TTOPD
N04  C                   MOVE      TXAVD         TTAVD
N04  C                   MOVE      TXOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
s02  C*                  MOVE      'ETA'         TTACTI
N02  C                   MOVE      'CHD'         TTACTI
     C                   MOVE      WSUSER        TTUSER
s02  C*                  EVAL      TTUSER = 'ESOVERS4'
n02  C                   EVAL      TTDEPO = 'ESOVERS4'
N03  C                   MOVE      WSEDRE        TTEDRE
     C                   MOVE      TXETAD        XAN08             8
     C                   EVAL      TTTEXT = 'ETA changed from '
     C                             + %TRIM(XAN08) + ' to '
     C                             + %TRIM(WSETA) + ' by '
     C                             + %TRIM(WSUSER)
N07  C                   EVAL      TTTEXL = 'ETA endret av '
N07  C                             + %TRIM(XAN08) + ' til '
N07  C                             + %TRIM(WSETA) + ' av '
N07  C                             + %TRIM(WSUSER)
     C                   WRITE     TRACKFR
N06  C                   IF        TXATAD = 0
N06  C     HEADFK        CHAIN     HEADF                              33
N06  C  N33              MOVE      BSETA         TRSDTD
N06  C  N33              MOVE      BSATA         HEDTOP
N06  C  N33              UPDATE    HEADFR
N06  C     HEADFK        CHAIN     BILLOF                             33
N06  C  N33              MOVE      BSETA         BLDTA
N06  C  N33              UPDATE    BILLOFR
N06  C                   END
     C                   END
      * ETD
     C                   IF        BSETD <> TXETDD
S04  C*                  MOVE      BSAVD         TTAVD
S04  C*                  MOVE      BSOPD         TTOPD
N04  C                   MOVE      TXAVD         TTAVD
N04  C                   MOVE      TXOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
s02  C*                  MOVE      'ETD'         TTACTI
N02  C                   MOVE      'CHD'         TTACTI
     C                   MOVE      WSUSER        TTUSER
s02  C*                  EVAL      TTUSER = 'ESOVERS4'
n02  C                   EVAL      TTDEPO = 'ESOVERS4'
N03  C                   MOVE      WSEDRE        TTEDRE
     C                   MOVE      TXETDD        XAN08
     C                   EVAL      TTTEXT = 'ETD changed from '
     C                             + %TRIM(XAN08) + ' to '
     C                             + %TRIM(WSETD) + ' by '
     C                             + %TRIM(WSUSER)
N07  C                   EVAL      TTTEXL = 'ETD endret av '
N07  C                             + %TRIM(XAN08) + ' til '
N07  C                             + %TRIM(WSETD) + ' av '
N07  C                             + %TRIM(WSUSER)
     C                   WRITE     TRACKFR
     C                   END
      * ATA
     C                   IF        BSATA <> TXATAD
S04  C*                  MOVE      BSAVD         TTAVD
S04  C*                  MOVE      BSOPD         TTOPD
N04  C                   MOVE      TXAVD         TTAVD
N04  C                   MOVE      TXOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
s02  C*                  MOVE      'ATA'         TTACTI
N02  C                   MOVE      'CHD'         TTACTI
     C                   MOVE      WSUSER        TTUSER
s02  C*                  EVAL      TTUSER = 'ESOVERS4'
n02  C                   EVAL      TTDEPO = 'ESOVERS4'
N03  C                   MOVE      WSEDRE        TTEDRE
     C                   MOVE      TXATAD        XAN08             8
     C                   EVAL      TTTEXT = 'ATA changed from '
     C                             + %TRIM(XAN08) + ' to '
     C                             + %TRIM(WSATA) + ' by '
     C                             + %TRIM(WSUSER)
N07  C                   EVAL      TTTEXL = 'ATA endret av '
N07  C                             + %TRIM(XAN08) + ' til '
N07  C                             + %TRIM(WSATA) + ' av '
N07  C                             + %TRIM(WSUSER)
     C                   WRITE     TRACKFR
N01  C     HEADFK        CHAIN     HEADF                              33
N01  C  N33              MOVE      BSATA         TRSDTD
N06  C  N33              MOVE      BSATA         HEDTOP
N01  C  N33              UPDATE    HEADFR
N05  C     HEADFK        CHAIN     BILLOF                             33
N05  C  N33              MOVE      BSATA         BLDTA
N05  C  N33              UPDATE    BILLOFR
N01  C                   MOVE      *OFF          *IN33
     C                   END
      * ETD
     C                   IF        BSATD <> TXATDD
S04  C*                  MOVE      BSAVD         TTAVD
S04  C*                  MOVE      BSOPD         TTOPD
N04  C                   MOVE      TXAVD         TTAVD
N04  C                   MOVE      TXOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
s02  C*                  MOVE      'ATD'         TTACTI
N02  C                   MOVE      'CHD'         TTACTI
     C                   MOVE      WSUSER        TTUSER
s02  C*                  EVAL      TTUSER = 'ESOVERS4'
n02  C                   EVAL      TTDEPO = 'ESOVERS4'
N03  C                   MOVE      WSEDRE        TTEDRE
     C                   MOVE      TXATDD        XAN08
     C                   EVAL      TTTEXT = 'ATD changed from '
     C                             + %TRIM(XAN08) + ' to '
     C                             + %TRIM(WSATD) + ' by '
     C                             + %TRIM(WSUSER)
N07  C                   EVAL      TTTEXL = 'ATD endret av '
N07  C                             + %TRIM(XAN08) + ' til '
N07  C                             + %TRIM(WSATD) + ' av '
N07  C                             + %TRIM(WSUSER)
     C                   WRITE     TRACKFR
N05  C     HEADFK        CHAIN     HEADF                              33
N05  C  N33              MOVE      BSATD         TRSDFD
N05  C  N33              UPDATE    HEADFR
N05  C     HEADFK        CHAIN     BILLOF                             33
N05  C  N33              MOVE      BSATD         BLDLOS
N05  C  N33              UPDATE    BILLOFR
     C                   END
N03   * INGEN DATO ENDRING
N03  C                   IF        ((((BSETA = TXETAD) AND
N03  C                                (BSETD = TXETDD)) AND
N03  C                                (BSATA = TXATAD)) AND
N03  C                                (BSATD = TXATDD))
N03  C                   IF        WSEDRE <> *BLANKS
S04  C*                  MOVE      BSAVD         TTAVD
S04  C*                  MOVE      BSOPD         TTOPD
N04  C                   MOVE      TXAVD         TTAVD
N04  C                   MOVE      TXOPD         TTOPD
N03  C                   MOVE      WDT           TTDATE
N03  C                   MOVE      WTM           TTTIME
N03  C                   MOVE      WDT           TTDATL
N03  C                   MOVE      WTM           TTTIML
N03  C                   MOVE      'CHD'         TTACTI
N03  C                   MOVE      WSUSER        TTUSER
N03  C                   EVAL      TTDEPO = 'ESOVERS4'
N03  C                   MOVE      WSEDRE        TTEDRE
N03  C                   EVAL      TTTEXT = 'New information from '
N03  C                             + %TRIM(WSUSER)
N07  C                   EVAL      TTTEXL = 'Ny informasjon fra '
N07  C                             + %TRIM(WSUSER)
N03  C                   WRITE     TRACKFR
N03  C                   END
N03  C                   END
N04   * DATO FOR KLAR FRA LEVERANDÿR
N04  C                   IF        BSOS01 <> TXOS01
N04  C                   MOVE      TXAVD         TTAVD
N04  C                   MOVE      TXOPD         TTOPD
N04  C                   MOVE      WDT           TTDATE
N04  C                   MOVE      WTM           TTTIME
N04  C                   MOVE      WDT           TTDATL
N04  C                   MOVE      WTM           TTTIML
N04  C                   MOVE      'CHD'         TTACTI
N04  C                   MOVE      WSUSER        TTUSER
N04  C                   EVAL      TTDEPO = 'ESOVERS4'
N04  C                   MOVE      WSEDRE        TTEDRE
N04  C                   MOVE      TXOS01        XAN08
N04  C                   EVAL      TTTEXT = 'Ready date from supplier changed '
N04  C                             + 'from ' + %TRIM(XAN08) + ' to '
N04  C                             + %TRIM(BSOS018) + ' by '
N04  C                             + %TRIM(WSUSER)
N07  C                   EVAL      TTTEXL = 'Klar dato fra leverand¯r endret '
N07  C                             + 'fra ' + %TRIM(XAN08) + ' til '
N07  C                             + %TRIM(BSOS018) + ' av '
N07  C                             + %TRIM(WSUSER)
N04  C                   WRITE     TRACKFR
N04  C                   END
N04   * FRIST FOR SHIPPING
N04  C                   IF        BSOS02 <> TXOS02
N04  C                   MOVE      TXAVD         TTAVD
N04  C                   MOVE      TXOPD         TTOPD
N04  C                   MOVE      WDT           TTDATE
N04  C                   MOVE      WTM           TTTIME
N04  C                   MOVE      WDT           TTDATL
N04  C                   MOVE      WTM           TTTIML
N04  C                   MOVE      'CHD'         TTACTI
N04  C                   MOVE      WSUSER        TTUSER
N04  C                   EVAL      TTDEPO = 'ESOVERS4'
N04  C                   MOVE      WSEDRE        TTEDRE
N04  C                   MOVE      TXOS02        XAN08
N04  C                   EVAL      TTTEXT = 'Deadline for shipping changed '
N04  C                             + 'from ' + %TRIM(XAN08) + ' to '
N04  C                             + %TRIM(BSOS028) + ' by '
N04  C                             + %TRIM(WSUSER)
N07  C                   EVAL      TTTEXL = 'Frist for forsendelse endret '
N07  C                             + 'fra ' + %TRIM(XAN08) + ' til '
N07  C                             + %TRIM(BSOS028) + ' av '
N07  C                             + %TRIM(WSUSER)
N04  C                   WRITE     TRACKFR
N04  C                   END
N04   * FRIST FOR ANKOMST
N04  C                   IF        BSOS03 <> TXOS03
N04  C                   MOVE      TXAVD         TTAVD
N04  C                   MOVE      TXOPD         TTOPD
N04  C                   MOVE      WDT           TTDATE
N04  C                   MOVE      WTM           TTTIME
N04  C                   MOVE      WDT           TTDATL
N04  C                   MOVE      WTM           TTTIML
N04  C                   MOVE      'CHD'         TTACTI
N04  C                   MOVE      WSUSER        TTUSER
N04  C                   EVAL      TTDEPO = 'ESOVERS4'
N04  C                   MOVE      WSEDRE        TTEDRE
N04  C                   MOVE      TXOS03        XAN08
N04  C                   EVAL      TTTEXT = 'Deadline for arrival changed '
N04  C                             + 'from ' + %TRIM(XAN08) + ' to '
N04  C                             + %TRIM(BSOS038) + ' by '
N04  C                             + %TRIM(WSUSER)
N07  C                   EVAL      TTTEXL = 'Frist for ankommst endret '
N07  C                             + 'fra ' + %TRIM(XAN08) + ' til '
N07  C                             + %TRIM(BSOS038) + ' av '
N07  C                             + %TRIM(WSUSER)
N04  C                   WRITE     TRACKFR
N04  C                   END
N04   * SHIPPING VINDU
N04  C                   IF        ((BSOS04 <> TXOS04) OR (BSOS05 <> TXOS05))
N04  C                   MOVE      TXAVD         TTAVD
N04  C                   MOVE      TXOPD         TTOPD
N04  C                   MOVE      WDT           TTDATE
N04  C                   MOVE      WTM           TTTIME
N04  C                   MOVE      WDT           TTDATL
N04  C                   MOVE      WTM           TTTIML
N04  C                   MOVE      'CHD'         TTACTI
N04  C                   MOVE      WSUSER        TTUSER
N04  C                   EVAL      TTDEPO = 'ESOVERS4'
N04  C                   MOVE      WSEDRE        TTEDRE
N04  C                   MOVE      TXOS04        XAN08
N04  C                   MOVE      TXOS05        XAN082            8
N04  C                   EVAL      TTTEXT = 'Ship-window changed from '
N04  C                             + %TRIM(XAN08) + '-' + %TRIM(XAN082) + ' to '
N04  C                             + %TRIM(BSOS048) + '-' + %TRIM(BSOS058)
N04  C                             + ' by ' + %TRIM(WSUSER)
N07  C                   EVAL      TTTEXL = 'Ship-window endret fra '
N07  C                             + %TRIM(XAN08) + '-' + %TRIM(XAN082) + ' ti'+
N07  C                             'l' + %TRIM(BSOS048) + '-' + %TRIM(BSOS058)
N07  C                             + ' av ' + %TRIM(WSUSER)
N04  C                   WRITE     TRACKFR
N04  C                   END
N04   * ANKOMST VINDU
N04  C                   IF        ((BSOS06 <> TXOS06) OR (BSOS07 <> TXOS07))
N04  C                   MOVE      TXAVD         TTAVD
N04  C                   MOVE      TXOPD         TTOPD
N04  C                   MOVE      WDT           TTDATE
N04  C                   MOVE      WTM           TTTIME
N04  C                   MOVE      WDT           TTDATL
N04  C                   MOVE      WTM           TTTIML
N04  C                   MOVE      'CHD'         TTACTI
N04  C                   MOVE      WSUSER        TTUSER
N04  C                   EVAL      TTDEPO = 'ESOVERS4'
N04  C                   MOVE      WSEDRE        TTEDRE
N04  C                   MOVE      TXOS06        XAN08
N04  C                   MOVE      TXOS07        XAN082            8
N04  C                   EVAL      TTTEXT = 'Arr-window changed from '
N04  C                             + %TRIM(XAN08) + '-' + %TRIM(XAN082) + ' to '
N04  C                             + %TRIM(BSOS068) + '-' + %TRIM(BSOS078)
N04  C                             + ' by ' + %TRIM(WSUSER)
N07  C                   EVAL      TTTEXL = 'Ank-window endret fra '
N07  C                             + %TRIM(XAN08) + '-' + %TRIM(XAN082) + ' ti'+
N07  C                             'l' + %TRIM(BSOS068) + '-' + %TRIM(BSOS078)
N07  C                             + ' av ' + %TRIM(WSUSER)
N07  C                   WRITE     TRACKFR
N07  C                   END
      *
     C                   ENDSR
      *
N04   *////////////////////////////////////////////////////////////
N04  C     TSTVINDU      BEGSR
N04   *////////////////////////////////////////////////////////////
N04  C                   IF        (((BSOS02 <> TXOS02) OR
N04  C                               (BSOS04 <> TXOS04)) OR
N04  C                               (BSOS05 <> TXOS05))
N04  C                   IF        ((BSOS04 <> 0) AND (BSOS04 > BSOS02))
N04  C                   MOVE      TXAVD         XAVD4             4
N04  C                   MOVE      TXOPD         XOPD7             7
N04  C                   MOVE      BSOS02        XOS02             8
N04  C                   MOVE      BSOS04        XOS04             8
N04  C                   MOVE      BSOS05        XOS05             8
N04  C                   EVAL      XTYPE = 'SHIPPING'
N04  C                   CALL      'ESOVERS4EC'
N04  C                   PARM                    WSUSER
N04  C                   PARM                    XAVD4
N04  C                   PARM                    XOPD7
N04  C                   PARM                    XOS02
N04  C                   PARM                    XOS04
N04  C                   PARM                    XOS05
N04  C                   PARM                    XTYPE            10
N04  C                   END
N04  C                   END
N04   *
N04  C                   IF        (((BSOS03 <> TXOS03) OR
N04  C                               (BSOS06 <> TXOS06)) OR
N04  C                               (BSOS07 <> TXOS07))
N04  C                   IF        ((BSOS06 <> 0) AND (BSOS06 > BSOS03))
N04  C                   MOVE      TXAVD         XAVD4             4
N04  C                   MOVE      TXOPD         XOPD7             7
N04  C                   MOVE      BSOS03        XOS03             8
N04  C                   MOVE      BSOS06        XOS06             8
N04  C                   MOVE      BSOS07        XOS07             8
N04  C                   EVAL      XTYPE = 'ARRIVAL'
N04  C                   CALL      'ESOVERS4EC'
N04  C                   PARM                    WSUSER
N04  C                   PARM                    XAVD4
N04  C                   PARM                    XOPD7
N04  C                   PARM                    XOS03
N04  C                   PARM                    XOS06
N04  C                   PARM                    XOS07
N04  C                   PARM                    XTYPE            10
N04  C                   END
N04  C                   END
N04   *
N04  C                   ENDSR
N04   *
N04   *////////////////////////////////////////////////////////////
N04  C     OPDSYSOPD     BEGSR
N04   *////////////////////////////////////////////////////////////
N04   * OPPDATER SYSPED-OPPDRAG
N04  C     FRISOKK       SETLL     FRISOK
N04  C     FRISOKK       READE     FRISOK                                 33
N04  C                   DOW       *IN33 = *OFF
N04  C     HEADFK        CHAIN(N)  HEADF                              33
N04  C                   IF        TRSDTD = 0
N04  C                   CALL      'ESOVERS4D'
N04  C                   PARM                    FSSOKAVD
N04  C                   PARM                    FSSOKOPD
N04  C                   PARM                    WSEDRE
N04  C                   PARM                    WSUSER
N04  C                   PARM                    BSETD8
N04  C                   PARM                    BSATD8
N04  C                   PARM                    BSETA8
N04  C                   PARM                    BSATA8
N04  C                   PARM                    BSOS018
N04  C                   PARM                    BSOS028
N04  C                   PARM                    BSOS038
N04  C                   PARM                    BSOS048
N04  C                   PARM                    BSOS058
N04  C                   PARM                    BSOS068
N04  C                   PARM                    BSOS078
N04  C                   END
N04  C     FRISOKK       READE     FRISOK                                 33
N04  C                   ENDDO
N04   *
N04  C                   ENDSR
N04   *
N03   *////////////////////////////////////////////////////////////
N03  C     VISREASON     BEGSR
N03   *////////////////////////////////////////////////////////////
N03   * REASON
N03  C                   callp     wrtsection('Reasontop')
N03   *
N03  C                   IF        WSEDRE = *BLANKS
N03  C                   callp     updhtmlvar('RKD':'')
N03  C                   callp     updhtmlvar('RFT':' -- blank -- ')
N03  C                   callp     wrtsection('Reasonrow')
N03  C                   END
N03   *
N03  C                   MOVE      *ZEROS        XN                3 0
N03  C                   MOVEL     'OSREA'       PAID
N03  C                   MOVE      BIBRID        PABRID
N03  C     BRPARFK       CHAIN     BRPARF                             33
N03  c   33              Eval      PABRID = '*KUNDFT*'+BIFIRM
N03  C   33BRPARFK       CHAIN     BRPARF                             33
N03  C                   DOW       *IN33 = *OFF
N03  C                   ADD       1             XN
N03  C                   MOVEL     PAVRDA        XAN03             3
N03  C                   callp     updhtmlvar('RKD':XAN03)
N03  C                   callp     updhtmlvar('RFT':PAVRDA)
N03  C                   IF        XAN03 = WSEDRE
N03  C                   callp     updhtmlvar('SLREASON':'SELECTED')
N03  C                   else
N03  C                   callp     updhtmlvar('SLREASON':'')
N03  C                   END
N03  C                   callp     wrtsection('Reasonrow')
N03  C     BRPARFK       READE     BRPARF                                 33
N03  C                   ENDDO
N03   *
N03   * legg pÂ mulighet til Â velge (tilbake til) kun blank nÂr kode er valgt..
N03  C                   callp     wrtsection('ReasonBot')
N03   *
N03  C                   ENDSR
N03   *
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C     TRACKTK       KLIST
     C                   KFLD                    BSAVD
     C                   KFLD                    BSOPD
     C                   KFLD                    TXFBNR
     C     TRACKTK2      KLIST
     C                   KFLD                    BLAVD
     C                   KFLD                    BLOPD
     C                   KFLD                    TXFBNR
     C     BILLOFK       KLIST
     C                   KFLD                    BSAVD
     C                   KFLD                    BSOPD
     C     BILLOFLGK     KLIST
     C                   KFLD                    BLBLNR
     C     BILLOFL2K     KLIST
     C                   KFLD                    BLAVD
     C                   KFLD                    BLREIS
N01  C     HEADFK        KLIST
N01  C                   KFLD                    TXAVD
N01  C                   KFLD                    TXOPD
N03  C     BRPARFK       KLIST
N03  C                   kfld                    PABRID
N03  C                   kfld                    PAKUNR
N03  C                   kfld                    PAID
N04  C     FRISOKK       KLIST
N04  C                   kfld                    BSAVD
N04  C                   kfld                    BSOPD
N04  C                   kfld                    FSKODE
N04  C                   MOVE      '*O1'         FSKODE
N09  C     EPOPOSK       KLIST
N09  C                   KFLD                    HEAVD
N09  C                   KFLD                    HEOPD
      *
     C                   OPEN      BRIDF
     C     WSUSER        CHAIN(N)  BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt pÂ user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
      * hent Parametre som gÂr igjen i mange prog:
      *      Odd/Even/Rowhead-farger,Logobilde,SprÂk,Intern/Ekstern bruker,  mm
     c                   call      'ESGETPAR'
     c                   parm                    BIBRID
     c                   parm                    BIFIRM
     c                   parm                    BIKUNR
     c                   parm                    BIKNG
     c                   parm                    RowHead          10
     c                   parm                    Odd              10
     c                   parm                    Even             10
     c                   parm                    LogoImg          50
     c                   parm                    XSPR≈K            2
     c                   parm                    XINTERN           1
     c                   parm                    ParmDS1        1024
     c                   parm                    ParmDS2        1024
     c                   parm                    ParmDS3        1024
      * HENTER PARAMETER
     C                   CALL      'ESGETOS'
     C                   parm                    BIBRID
     C                   parm                    BIFIRM
     C                   parm                    BIKUNR
     C                   parm                    BIKNG
     C                   parm                    ParmOS1        1024
      *
     c     OSCHG         ifeq      'J'
     c                   eval      OKButton = '<INPUT TYPE="SUBMIT" '
     c                             + 'VALUE="   OK   ">'
     c                   end
N03  C                   OPEN      BRPARF
     C                   OPEN      BILLOF
     C                   OPEN      BILLOFLG
     C                   OPEN      BILLOFL2
     C                   OPEN      TRACKT
     C                   OPEN      TRACKF
N01  C                   OPEN      HEADF
N04  C                   OPEN      FRISOK
      *
     C                   endsr
      *
      *=====================================================================******
      *  AVSLUTT
      *=====================================================================******
     C     EXIT          begsr
     C                   callp     wrtsection('end')
     C                   callp     wrtsection('*fini')
     C                   close     BRIDF
N03  C                   close     BRPARF
     C                   close     BILLOF
     C                   close     BILLOFLG
     C                   close     BILLOFL2
     C                   close     trackt
N01  C                   close     TRACKF
N01  C                   close     HEADF
N04  C                   close     FRISOK
     C                   eval      *inlr = *on
      *
     C                   endsr
      *
