      * START Customs office
XXX01 * Ikke sende <Consignee> under <ConsignmentItem>
      * For å kompilere: ADDLIBLE LIB(LIBHTTP) POSITION(*LAST)
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12308 * 01 CB  PTF12 Send med avsender på IE15 uansett på masternivå uansett om den er lik holder
12314 * 02 CB  PTF12 Test og landkode for å avgjøre om det er ulike mottakere
12327 * 03 CB  PTF12 Skriv: ADR. isteden for: punktum i merking
12329 * 04 CB  PTF12 Ikke send blanke verdier fra NCTSIEAM
12340 * 05 CB  PTF12 Endring logikk Dispatch country
      *              og noen PT endringer
12344 * 06 CB  PTF12 Ikke send noen verdier på housenivå hvis kun 1 house
12347 * 07 CB  PTF12 Ikke summer vekter ved ant.kolli = 0
      *----------------------------------------------------------------
      * Program sender IE15, IE13 (endring) og IE170 (presentasjon), IE141
      *----------------------------------------------------------------
     H DftActGrp(*No)
     FEDIC      UF   E             DISK
     FEDIS      O  A E             DISK
     FEDIM      UF   E           K DISK
     FTRACKF    O  A E             DISK
     FHEADF     IF   E           K DISK
     FNCTSEH    UF   E           K DISK
     FNCTSEHK   UF   E           K DISK
     FNCTSEHL   UF   E           K DISK
     FNCTSEHN   IF   E           K DISK
     FNCTSEC    UF   E           K DISK
     FNCTSECAM  IF   E           K DISK
     FNCTSEI    UF   E           K DISK
     FNCTSEI02  IF   E           K DISK    RENAME(NCTSEIR:NCTSEIR2)
     FNCTSEIAM  IF   E           K DISK
      /copy ifsio_h
     D EDIDTA          DS           256
     D  UELIBF               171    180
     D                 DS
     D  CSN                    1      9  0
     D  X_CSN                  1      9
     D                 DS
     D  WMBR                   1     14
     D  WMBRA                  1      1
     D  WMBRB                  2     10  0
     D                 DS
     D  XDT                    1      8
     D  XDTA                   1      4
     D  XDTM                   5      6
     D  XDTD                   7      8
     D                 DS
     D  XTM                    1      6
     D  XTMH                   1      2
     D  XTMM                   3      4
     D  XTMS                   5      6
     D                 DS
     D  THAVD                  1      4  0
     D  THTDN                  5     11  0
     D  THOPDNR                1     11
     D                 DS
     D  TNDTT                  1      8  0
     D  TNDTTA                 1      4
     D  TNDTTM                 5      6
     D  TNDTTD                 7      8
     D                 DS
     D  THDDT                  1      8  0
     D  THDDTA                 1      4
     D  THDDTM                 5      6
     D  THDDTD                 7      8
     D                 DS
     D  THTSD1                 1      8
     D  THTSD2                 9     16
     D  THTSD3                17     24
     D  THTSD4                25     32
     D  THTSD5                33     40
     D  THTSD6                41     48
     D  THTSD7                49     56
     D  THTSD8                57     64
     D  TSD                    1     64    DIM(8)
     D                 DS
     D  THETA1                 1      8  0
     D  THETA2                 9     16  0
     D  THETA3                17     24  0
     D  THETA4                25     32  0
     D  THETA5                33     40  0
     D  THETA6                41     48  0
     D  THETA7                49     56  0
     D  THETA8                57     64  0
     D  ETA                    1     64  0 DIM(8)
     D                 DS
     D  THETAT1                1      4  0
     D  THETAT2                5      8  0
     D  THETAT3                9     12  0
     D  THETAT4               13     16  0
     D  THETAT5               17     20  0
     D  THETAT6               21     24  0
     D  THETAT7               25     28  0
     D  THETAT8               29     32  0
     D  ETAT                   1     32  0 DIM(8)
     D                 DS
     D  XDT2                   1      8
     D  XDT2A                  1      4
     D  XDT2M                  5      6
     D  XDT2D                  7      8
     D                 DS
     D  XTM2                   1      6
     D  XTM2H                  1      2
     D  XTM2M                  3      4
     D  XTM2S                  5      6
     D                 DS
     D  THLKR1                 1      2
     D  THLKR2                 3      4
     D  THLKR3                 5      6
     D  THLKR4                 7      8
     D  THLKR5                 9     10
     D  THLKR6                11     12
     D  THLKR7                13     14
     D  THLKR8                15     16
     D  LKR                    1     16    DIM(8)
     D                 DS
     D  TICCH                  1      6  0
     D  TICCH_A                1      6
     D                 DS
     D  TLDT                   1      8  0
     D  TLDTA                  1      4
     D  TLDTM                  5      6
     D  TLDTD                  7      8
     D                 DS
     D  TLTM                   1      6  0
     D  TLTMH                  1      2
     D  TLTMM                  3      4
     D  TLTMS                  5      6
      *
     D FILE_o          s             10I 0
     D String          s            512a
     D rc              s             10i 0
     D*Data            s             80a   Varying
     D*Codepage        s              5a   Varying
     D CmdLine         S            512
     D CmdLen          S             15  5
     D LF              c                   x'25'
     D XCHGAUT         s            200A
     D CNR             s             17A   DIM(10)
     D ANT             s              3S 0 DIM(10)
     D SEAL            s             20A   DIM(10)
     D XTXT500         S            500A
     d X_PDRF          s                   like(TIPDRF)
     d U_UUID          s             36A
     D RunCmd          PR                  EXTPGM('QCMDEXC')
     D  Cmd                         200A   CONST
     D  Len                          15P 5 CONST
      *
     D                 DS
     D  XTXT801                1     80
     D  XT801                  1     80    DIM(80)
     D                 DS
     D  XTXT802                1     80
     D  XT802                  1     80    DIM(80)
     D                SDS
     D  ZUSER                254    263
      *//////////////
      *  Hodelogikk /
      *//////////////
      * Initiering av variabler og nøkler
     C                   EXSR      SRA
      * Plukk NCTS og send til Tollvesenet
     C                   EXSR      SRC
      * Avsluttning av sending
     C                   EXSR      SRD
     C                   MOVE      '1'           *INLR
      *
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYD          KLIST
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     C     KEYE          KLIST
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     C                   KFLD                    TCLI
     C     KEYF          KLIST
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     C                   KFLD                    TICNR
     C     NCTSECK       KLIST
     C                   KFLD                    THAVD
     C                   KFLD                    THTDN
     C                   KFLD                    TCLI
     C     NCTSEIAMK     KLIST
     C                   KFLD                    THAVD
     C                   KFLD                    THTDN
     C                   KFLD                    TCLI
     C                   KFLD                    TILI2
     C     HEADFK        KLIST
     C                   KFLD                    TCAVD2
     C                   KFLD                    TCTDN2
      *_____________
      * Init av felt
      *"""""""""""""
      * Hente dagens dato og klokkeslett.
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           XIDAG             8 0
     C                   MOVE      WDT           XDT
     C                   MOVE      WTM           XTM
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    UMN               9 0
      *
     C     *DTAARA       DEFINE                  EDIDTA
     C                   IN        EDIDTA
     C                   MOVE      *BLANKS       XDATA          1024
     C                   BITON     '123457'      XAPS              1
     C                   BITOFF    '06'          XAPS
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Les meldinger                                        SRC /
      *////////////////////////////////////////////////////////////
     C     SRC           BEGSR
      *
     C     UMN           CHAIN     EDIM                               33
     C                   IF        *IN33 = *OFF                                 1<-B
     C     1             CHAIN     EDIC                               36
     C                   ADD       1             CSN
     C                   UPDATE    EDICR
      *
     C     KEYD          CHAIN     NCTSEH                             33
     C                   IF        *IN33 = *OFF                                  2<-B
     C                   IF        M1N07 = '141'                                  3<-B
     C                   MOVE      'P'           THST
     C                   ELSE                                                     3
     C                   MOVE      'A'           THST
     C                   END                                                      3<-E
     C                   UPDATE    NCTSEHR
     C                   Z-ADD     CSN           MSN
     C                   MOVE      'A'           MST
     C                   MOVEL     WDT           MDT
     C                   MOVEL     WTM           MTM
     C*                  UPDATE    EDIMR
     C                   SELECT                                                   3<-B
     C     M1N07         WHENEQ    '014'
     C                   EXSR      KANSEL
     C     M1N07         WHENEQ    '015'
     C     M1N07         OREQ      '013'
     C     M1N07         OREQ      '170'
     C                   EXSR      TRANSI
     C     M1N07         WHENEQ    '054'
     C                   EXSR      RELEAS
     C     M1N07         WHENEQ    '141'
     C                   EXSR      NONARR
     C                   ENDSL                                                    3<-E
     C                   EVAL      M1004 = %SUBST(U_UUID:1:35)
     C                   UPDATE    EDIMR
     C                   ELSE                                                    2
     C                   UPDATE    EDIMR
     C                   END                                                     2<-E
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Slutt på file                                        SRD /
      *////////////////////////////////////////////////////////////
     C     SRD           BEGSR
      *________________________
      * Oppdatere sendningslogg
      *""""""""""""""""""""""""
     C                   EVAL      WMBRA = 'S'
     C                   EVAL      WMBRB = CSN
     C                   EVAL      S0004  = M0004
     C                   EVAL      S0010  = M0010
     C*                  EVAL      S0020  = WMBR
     C                   EVAL      S0020  = 'SE' + THOPDNR
     C                   EVAL      SSN    = CSN
     C                   EVAL      SSR    = 'S'
     C                   EVAL      SST    = 'A'
     C                   EVAL      S0036  = 1
     C                   MOVEL     WDT           SDT
     C                   MOVEL     WTM           STM
     C                   EVAL      SFILE  = '*IFS'
     C                   EVAL      SMBR   = WMBR
     C                   EVAL      SLIB   = '*LIBL'
     C                   EVAL      SIFS   = WFILNAM2
     C                   WRITE     EDISR
      *
      * Oppdater track & trace
     C                   EVAL      TTAVD  = MAVD
     C                   EVAL      TTOPD  = MTDN
     C                   EVAL      TTACTI = 'NCT'
     C                   MOVEL     WDT           TTDATE
     C                   MOVEL     WTM           TTTIME
     C                   EVAL      TTTEXT='NCTS exit (' + %TRIM(M1N07)
     C                             + ') is sent to TVINN.'
     C                   EVAL      TTUSER = ZUSER
     C                   EVAL      TTDATL = TTDATE
     C                   EVAL      TTTIML = TTTIME
     C                   EVAL      TTTEXT='NCTS exit (' + %TRIM(M1N07)
     C                             + ') er sendt til TVINN.'
     C                   WRITE     TRACKFR
      *
     C                   ENDSR
      *
      */////////////////////////////////////////////////////////////
      * Send kansellering til Tollvesnet                           /
      * Her skrive UNH, BGM og UNT segment                         /
      */////////////////////////////////////////////////////////////
     C     KANSEL        BEGSR
      *
     C     KEYD          CHAIN     NCTSEHK                            82
     C                   MOVE      WDT           TKDT
     C                   UPDATE    NCTSEHKR
      * Lag fil og set codepage (pc)
     C                   MOVE      *BLANKS       WFilNam         256
     C                   EVAL      WFilNam= '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/NCTS_'
     C                             + %TRIM(THOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_014.xml'
     C                   MOVE      *BLANKS       WFilNam2        256
     C                   EVAL      WFilNam2 = '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/BACKUP/NCTS_'
     C                             + %TRIM(THOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_014.xml'
      * 1208 = UTF-8
     C                   eval      FILE_o = open( %TrimR( WFilNam2 )
     C                               : O_CREAT+O_TRUNC+O_WRONLY
     C                                + O_TEXT_CREAT+O_CCSID+O_TEXTDATA
     C                               : S_IRUSR + S_IWUSR
     C                               : 1208
     C                               : 0)
      *
     C                   EVAL      XDATA = '<?xml version="1.0" '
     C                             + 'encoding="UTF-8" standalone="yes"?>'
     C*                            + 'encoding="UTF-8" standalone="true"?>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<ns2:CC014C '
     C                             + 'xmlns:ns2="http://ncts.dgtaxud.ec">'
     C                   EXSR      OPDFIL
      *
     C                   EXSR      SRMESSAGEKAN
      *
     C                   EVAL      XDATA = '</ns2:CC014C>'
     C                   EXSR      OPDFIL
      *
     C                   callp     close( FILE_o )
     C                   EVAL      XCHGAUT = 'CHGAUT OBJ(' + XAPS
     C                             + %TRIM(WFilNam2) + XAPS
     C                             + ') USER(*PUBLIC) DTAAUT(*RWX) OBJAUT(*ALL)'
     C                   CALLP     RUNCMD(XCHGAUT:200)
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Message                                     SRMESSAGEKAN /
      *////////////////////////////////////////////////////////////
     C     SRMESSAGEKAN  BEGSR
      *
     C                   EVAL      XDATA = '<messageSender>'
     C                             + %TRIM(M0004) + '</messageSender>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<messageRecipient>'
     C*                            + %TRIM(%SUBST(M0010:1:8))
     C                             + %TRIM(M0010)
     C                             + '</messageRecipient>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<preparationDateAndTime>'
     C                             + %TRIM(XDTA) + '-' + %TRIM(XDTM) + '-'
     C                             + %TRIM(XDTD) + 'T' + %TRIM(XTMH) + ':'
     C                             + %TRIM(XTMM) + ':' + %TRIM(XTMS)
     C                             + '</preparationDateAndTime>'
     C                   EXSR      OPDFIL
     C*                  CALL      'UUIDC'
     C*                  PARM                    U_UUID           36
     C                   EVAL      U_UUID = %TRIM(M0004) + '-'
     C                             + %TRIM(WDT) + '-' + %TRIM(X_CSN)
     C                   EVAL      XDATA = '<messageIdentification>'
     C*                            + %SUBST(U_UUID:1:35)
     C                             + %TRIM(U_UUID)
     C                             + '</messageIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<messageType>'
     C                             + 'CC014C' + '</messageType>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<correlationIdentifier>'
     C                             + 'O' + '</correlationIdentifier>'
     C                   EXSR      OPDFIL
      * Transit operation
     C                   EVAL      XDATA = '<TransitOperation>'
     C                   EXSR      OPDFIL
     C                   IF        THST028 <> 'J'
     C                   EVAL      XDATA = '<LRN>' + %TRIM(THLRN) + '</LRN>'
     C                   EXSR      OPDFIL
     C*                  IF        THTRNR <> *BLANKS
     C                   ELSE
     C                   EVAL      XDATA = '<MRN>' + %TRIM(THTRNR) + '</MRN>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</TransitOperation>'
     C                   EXSR      OPDFIL
      * Invalidation
     C                   EVAL      XDATA = '<Invalidation>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<requestDateAndTime>'
     C                             + %TRIM(XDTA) + '-' + %TRIM(XDTM) + '-'
     C                             + %TRIM(XDTD) + 'T' + %TRIM(XTMH) + ':'
     C                             + %TRIM(XTMM) + ':' + %TRIM(XTMS)
     C                             + '</requestDateAndTime>'
     C                   EXSR      OPDFIL
     C                   IF        %SUBST(M0010:1:3) <> 'NTA'
     C                             AND %SUBST(M0010:1:4) <> 'NCTS'
     C                   EVAL      XDATA = '<decision>'
     C                             + %TRIM(%EDITC(TKKD1A:'3')) + '</decision>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '<initiatedByCustoms>'
     C                             + %TRIM(%EDITC(TKKD2A:'3'))
     C                             + '</initiatedByCustoms>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TKFT1
     C                   EXSR      KNVST
     C                   EVAL      XTXT500 = XTXT802
     C                   IF        TKFT2 <> *BLANKS
     C                   EVAL      XTXT801 = TKFT2
     C                   EXSR      KNVST
     C                   EVAL      XTXT500 = %TRIM(XTXT500) +' '+ %TRIM(XTXT802)
     C                   END
     C                   IF        TKFT3 <> *BLANKS
     C                   EVAL      XTXT801 = TKFT3
     C                   EXSR      KNVST
     C                   EVAL      XTXT500 = %TRIM(XTXT500) +' '+ %TRIM(XTXT802)
     C                   END
     C                   IF        TKFT4 <> *BLANKS
     C                   EVAL      XTXT801 = TKFT4
     C                   EXSR      KNVST
     C                   EVAL      XTXT500 = %TRIM(XTXT500) +' '+ %TRIM(XTXT802)
     C                   END
     C                   IF        TKFT5 <> *BLANKS
     C                   EVAL      XTXT801 = TKFT5
     C                   EXSR      KNVST
     C                   EVAL      XTXT500 = %TRIM(XTXT500) +' '+ %TRIM(XTXT802)
     C                   END
     C                   EVAL      XDATA = '<justification>'
     C                             + %TRIM(XTXT500)
     C                   EVAL      XDATA = %TRIM(XDATA) + '</justification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Invalidation>'
     C                   EXSR      OPDFIL
      * Customs office of departure
     C                   EVAL      XDATA = '<CustomsOfficeOfDeparture>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(THCATS) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</CustomsOfficeOfDeparture>'
     C                   EXSR      OPDFIL
      *
      * Holder of the transit procesure
     C                   EVAL      XDATA = '<HolderOfTheTransitProcedure>'
     C                   EXSR      OPDFIL
     C                   IF        THTINH <> *BLANKS
     C                   EVAL      XTXT801 = THTINH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        THTIRH <> *BLANKS
     C                   EVAL      XTXT801 = THTIRH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<TIRHolderIdentificatioNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</TIRHolderIdentificatioNumber>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C                   IF        THTINH = *BLANKS
      *
     C                   EVAL      XTXT801 = THNAH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THAD1H
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THPNH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THPSH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(THLKH) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
      *
     C                   END
      *
     C                   IF        THCPH <> *BLANKS
     C                   EVAL      XDATA = '<ContactPerson>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THCPH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   IF        THTLH <> *BLANKS
     C                   EVAL      XTXT801 = THTLH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<phoneNumber>'
     C                             + %TRIM(XTXT802) + '</phoneNumber>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        THEMH <> *BLANKS
     C*                  EVAL      XDATA = '<E-mailAddress>'
     C*                            + %TRIM(THEMH) + '</E-mailAddress>'
     C                   EVAL      XDATA = '<eMailAddress>'
     C                             + %TRIM(THEMH) + '</eMailAddress>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</ContactPerson>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</HolderOfTheTransitProcedure>'
     C                   EXSR      OPDFIL
      *
     C                   ENDSR
      *
      */////////////////////////////////////////////////////////////
      * Send non-arrival info til Tollvesnet                       /
      * Her skrive UNH, BGM og UNT segment                         /
      */////////////////////////////////////////////////////////////
     C     NONARR        BEGSR
      *
     C     KEYD          CHAIN     NCTSEHN                            82
      * Lag fil og set codepage (pc)
     C                   MOVE      *BLANKS       WFilNam         256
     C                   EVAL      WFilNam= '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/NCTS_'
     C                             + %TRIM(THOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_141.xml'
     C                   MOVE      *BLANKS       WFilNam2        256
     C                   EVAL      WFilNam2 = '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/BACKUP/NCTS_'
     C                             + %TRIM(THOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_141.xml'
      * 1208 = UTF-8
     C                   eval      FILE_o = open( %TrimR( WFilNam2 )
     C                               : O_CREAT+O_TRUNC+O_WRONLY
     C                                + O_TEXT_CREAT+O_CCSID+O_TEXTDATA
     C                               : S_IRUSR + S_IWUSR
     C                               : 1208
     C                               : 0)
      *
     C                   EVAL      XDATA = '<?xml version="1.0" '
     C                             + 'encoding="UTF-8" standalone="yes"?>'
     C*                            + 'encoding="UTF-8" standalone="true"?>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<ns2:CC141C '
     C                             + 'xmlns:ns2="http://ncts.dgtaxud.ec">'
     C                   EXSR      OPDFIL
      *
     C                   EXSR      SRMESSAGENON
      *
     C                   EVAL      XDATA = '</ns2:CC141C>'
     C                   EXSR      OPDFIL
      *
     C                   callp     close( FILE_o )
     C                   EVAL      XCHGAUT = 'CHGAUT OBJ(' + XAPS
     C                             + %TRIM(WFilNam2) + XAPS
     C                             + ') USER(*PUBLIC) DTAAUT(*RWX) OBJAUT(*ALL)'
     C                   CALLP     RUNCMD(XCHGAUT:200)
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Message                                     SRMESSAGENON /
      *////////////////////////////////////////////////////////////
     C     SRMESSAGENON  BEGSR
      *
     C                   EVAL      XDATA = '<messageSender>'
     C                             + %TRIM(M0004) + '</messageSender>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<messageRecipient>'
     C*                            + %TRIM(%SUBST(M0010:1:8))
     C                             + %TRIM(M0010)
     C                             + '</messageRecipient>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<preparationDateAndTime>'
     C                             + %TRIM(XDTA) + '-' + %TRIM(XDTM) + '-'
     C                             + %TRIM(XDTD) + 'T' + %TRIM(XTMH) + ':'
     C                             + %TRIM(XTMM) + ':' + %TRIM(XTMS)
     C                             + '</preparationDateAndTime>'
     C                   EXSR      OPDFIL
     C*                  CALL      'UUIDC'
     C*                  PARM                    U_UUID           36
     C                   EVAL      U_UUID = %TRIM(M0004) + '-'
     C                             + %TRIM(WDT) + '-' + %TRIM(X_CSN)
     C                   EVAL      XDATA = '<messageIdentification>'
     C*                            + %SUBST(U_UUID:1:35)
     C                             + %TRIM(U_UUID)
     C                             + '</messageIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<messageType>'
     C                             + 'CC141C' + '</messageType>'
     C                   EXSR      OPDFIL
     C*                  EVAL      XDATA = '<correlationIdentifier>'
     C*                            + 'O' + '</correlationIdentifier>'
     C*                  EXSR      OPDFIL
      * Transit operation
     C                   EVAL      XDATA = '<TransitOperation>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<MRN>' + %TRIM(THTRNR) + '</MRN>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</TransitOperation>'
     C                   EXSR      OPDFIL
      * Customs office of departure
     C*                  EVAL      XDATA = '<CustomsOfficeOfDeparture>'
     C*                  EXSR      OPDFIL
     C*                  EVAL      XDATA = '<referenceNumber>'
     C*                            + %TRIM(THCATS) + '</referenceNumber>'
     C*                  EXSR      OPDFIL
     C*                  EVAL      XDATA = '</CustomsOfficeOfDeparture>'
     C*                  EXSR      OPDFIL
      * Customs office of destination (actual)
     C                   EVAL      XDATA = '<CustomsOfficeOfDestination'
     C                             + 'Actual>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(TNTSAN) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</CustomsOfficeOfDestination'
     C                             + 'Actual>'
     C                   EXSR      OPDFIL
      * Customs office of enquiry at departure
     C                   EVAL      XDATA = '<CustomsOfficeOfEnquiryAtDeparture>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(TNTSAV) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA='</CustomsOfficeOfEnquiryAtDeparture>'
     C                   EXSR      OPDFIL
      *
      * Holder of the transit procesure
     C                   EVAL      XDATA = '<HolderOfTheTransitProcedure>'
     C                   EXSR      OPDFIL
     C                   IF        THTINH <> *BLANKS
     C                   EVAL      XTXT801 = THTINH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        THTIRH <> *BLANKS
     C                   EVAL      XTXT801 = THTIRH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<TIRHolderIdentificatioNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</TIRHolderIdentificatioNumber>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C                   IF        THTINH = *BLANKS
      *
     C                   EVAL      XTXT801 = THNAH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THAD1H
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THPNH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THPSH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(THLKH) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
      *
     C                   END
     C                   EVAL      XDATA = '</HolderOfTheTransitProcedure>'
     C                   EXSR      OPDFIL
      * Enquiry
     C                   EVAL      XDATA = '<Enquiry>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<TC11DeliveryDate>'
     C                             + %TRIM(TNDTTA) + '-'
     C                             + %TRIM(TNDTTM) + '-'
     C                             + %TRIM(TNDTTD) + '</TC11DeliveryDate>'
     C                   EXSR      OPDFIL
      *
     C                   IF        TNTXT <> *BLANKS
     C                   EVAL      XTXT801 = %SUBST(TNTXT:1:60)
     C                   EXSR      KNVST
     C                   EVAL      XTXT500 = XTXT802
     C                   IF        %SUBST(TNTXT:61:60) <> *BLANKS
     C                   EVAL      XTXT801 = %SUBST(TNTXT:61:60)
     C                   EXSR      KNVST
     C                   EVAL      XTXT500 = %TRIM(XTXT500) +' '+ %TRIM(XTXT802)
     C                   END
     C                   IF        %SUBST(TNTXT:121:60) <> *BLANKS
     C                   EVAL      XTXT801 = %SUBST(TNTXT:121:60)
     C                   EXSR      KNVST
     C                   EVAL      XTXT500 = %TRIM(XTXT500) +' '+ %TRIM(XTXT802)
     C                   END
     C                   IF        %SUBST(TNTXT:181:60) <> *BLANKS
     C                   EVAL      XTXT801 = %SUBST(TNTXT:181:60)
     C                   EXSR      KNVST
     C                   EVAL      XTXT500 = %TRIM(XTXT500) +' '+ %TRIM(XTXT802)
     C                   END
     C                   IF        %SUBST(TNTXT:241:60) <> *BLANKS
     C                   EVAL      XTXT801 = %SUBST(TNTXT:241:60)
     C                   EXSR      KNVST
     C                   EVAL      XTXT500 = %TRIM(XTXT500) +' '+ %TRIM(XTXT802)
     C                   END
     C                   EVAL      XDATA = '<text>'
     C                             + %TRIM(XTXT500) + '</text>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C                   EVAL      XDATA = '</Enquiry>'
     C                   EXSR      OPDFIL
      * Consignment
     C                   EVAL      XDATA = '<Consignment>'
     C                   EXSR      OPDFIL
      * Consignee actual
     C                   EVAL      XDATA = '<ConsigneeActual>'
     C                   EXSR      OPDFIL
      *
     C                   IF        TNTIN <> *BLANKS
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(TNTIN) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C                   EVAL      XTXT801 = TNNA
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TNAD1
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TNPN
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TNPS
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(TNLK) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '</ConsigneeActual>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '</Consignment>'
     C                   EXSR      OPDFIL
      *
     C                   ENDSR
      *
      */////////////////////////////////////////////////////////////
      * Send transittering til Tollvesnet                          /
      */////////////////////////////////////////////////////////////
     C     TRANSI        BEGSR
      *
     C                   EXSR      TSTPARTS
      * Lag fil og set codepage (pc)
     C                   MOVE      *BLANKS       WFilNam         256
     C                   SELECT
     C                   WHEN      M1N07 = '015'
     C                   EVAL      WFilNam= '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/NCTS_'
     C                             + %TRIM(THOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_015.xml'
     C                   MOVE      *BLANKS       WFilNam2        256
     C                   EVAL      WFilNam2 = '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/BACKUP/NCTS_'
     C                             + %TRIM(THOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_015.xml'
     C                   WHEN      M1N07 = '013'
      * Endring
     C                   EVAL      WFilNam= '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/NCTS_'
     C                             + %TRIM(THOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_013.xml'
     C                   MOVE      *BLANKS       WFilNam2        256
     C                   EVAL      WFilNam2 = '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/BACKUP/NCTS_'
     C                             + %TRIM(THOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_013.xml'
     C                   WHEN      M1N07 = '170'
      * Presentasjon
     C                   EVAL      WFilNam= '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/NCTS_'
     C                             + %TRIM(THOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_170.xml'
     C                   MOVE      *BLANKS       WFilNam2        256
     C                   EVAL      WFilNam2 = '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/BACKUP/NCTS_'
     C                             + %TRIM(THOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_170.xml'
     C                   ENDSL
      *
      * 1208 = UTF-8
     C                   eval      FILE_o = open( %TrimR( WFilNam2 )
     C                               : O_CREAT+O_TRUNC+O_WRONLY
     C                                + O_TEXT_CREAT+O_CCSID+O_TEXTDATA
     C                               : S_IRUSR + S_IWUSR
     C                               : 1208
     C                               : 0)
      *
     C                   EVAL      XDATA = '<?xml version="1.0" '
     C                             + 'encoding="UTF-8" standalone="yes"?>'
     C*                            + 'encoding="UTF-8" standalone="true"?>'
     C                   EXSR      OPDFIL
     C                   SELECT
     C                   WHEN      M1N07 = '015'
     C                   EVAL      XDATA = '<ns2:CC015C '
     C                             + 'xmlns:ns2="http://ncts.dgtaxud.ec">'
     C                   WHEN      M1N07 = '013'
      * Endring
     C                   EVAL      XDATA = '<ns2:CC013C '
     C                             + 'xmlns:ns2="http://ncts.dgtaxud.ec">'
     C                   WHEN      M1N07 = '170'
      * Presentasjon
     C                   EVAL      XDATA = '<ns2:CC170C '
     C                             + 'xmlns:ns2="http://ncts.dgtaxud.ec">'
     C                   ENDSL
     C                   EXSR      OPDFIL
      *
     C                   EXSR      SRMESSAGE
      *
     C                   SELECT
     C                   WHEN      M1N07 = '015'
     C                   EVAL      XDATA = '</ns2:CC015C>'
     C                   WHEN      M1N07 = '013'
      * Endring
     C                   EVAL      XDATA = '</ns2:CC013C>'
     C                   WHEN      M1N07 = '170'
      * Presentasjon
     C                   EVAL      XDATA = '</ns2:CC170C>'
     C                   END
     C                   EXSR      OPDFIL
      *
     C                   callp     close( FILE_o )
     C                   EVAL      XCHGAUT = 'CHGAUT OBJ(' + XAPS
     C                             + %TRIM(WFilNam2) + XAPS
     C                             + ') USER(*PUBLIC) DTAAUT(*RWX) OBJAUT(*ALL)'
     C                   CALLP     RUNCMD(XCHGAUT:200)
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  Message                                        SRMESSAGE /
      *////////////////////////////////////////////////////////////
     C     SRMESSAGE     BEGSR
      *
     C                   EVAL      XDATA = '<messageSender>'
     C                             + %TRIM(M0004) + '</messageSender>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<messageRecipient>'
     C*                            + %TRIM(%SUBST(M0010:1:8))
     C                             + %TRIM(M0010)
     C                             + '</messageRecipient>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<preparationDateAndTime>'
     C                             + %TRIM(XDTA) + '-' + %TRIM(XDTM) + '-'
     C                             + %TRIM(XDTD) + 'T' + %TRIM(XTMH) + ':'
     C                             + %TRIM(XTMM) + ':' + %TRIM(XTMS)
     C                             + '</preparationDateAndTime>'
     C                   EXSR      OPDFIL
     C*                  CALL      'UUIDC'
     C*                  PARM                    U_UUID           36
     C                   EVAL      U_UUID = %TRIM(M0004) + '-'
     C                             + %TRIM(WDT) + '-' + %TRIM(X_CSN)
     C                   EVAL      XDATA = '<messageIdentification>'
     C*                            + %SUBST(U_UUID:1:35)
     C                             + %TRIM(U_UUID)
     C                             + '</messageIdentification>'
     C                   EXSR      OPDFIL
     C                   SELECT
     C                   WHEN      M1N07 = '015'
     C                   EVAL      XDATA = '<messageType>'
     C                             + 'CC015C' + '</messageType>'
     C                   WHEN      M1N07 = '013'
      * Endring
     C                   EVAL      XDATA = '<messageType>'
     C                             + 'CC013C' + '</messageType>'
     C                   WHEN      M1N07 = '170'
      * Presentasjon
     C                   EVAL      XDATA = '<messageType>'
     C                             + 'CC170C' + '</messageType>'
     C                   ENDSL
     C                   EXSR      OPDFIL
     C*                  EVAL      XDATA = '<correlationIdentifier>'
     C*                            + 'O' + '</correlationIdentifier>'
     C*                  EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<TransitOperation>'
     C                   EXSR      OPDFIL
     C                   SELECT
     C                   WHEN      M1N07 = '015'
     C                   EVAL      XDATA = '<LRN>' + %TRIM(M0068) + '</LRN>'
     C                   WHEN      M1N07 = '013'
      * Endring
     C                   IF        THTRNR = *BLANKS
     C                   EVAL      XDATA = '<LRN>' + %TRIM(THLRN) + '</LRN>'
     C                   ELSE
     C                   EVAL      XDATA = '<MRN>' + %TRIM(THTRNR) + '</MRN>'
     C                   END
     C                   WHEN      M1N07 = '170'
     C                   EVAL      XDATA = '<LRN>' + %TRIM(M0068) + '</LRN>'
     C                   ENDSL
     C                   EXSR      OPDFIL
      *
     C                   IF        M1N07 = '170'
     C                   GOTO      SRMSG1701
     C                   END
      *
     C                   EVAL      XDATA = '<declarationType>'
     C                             + %TRIM(THDK) + '</declarationType>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<additionalDeclarationType>'
     C                             + %TRIM(THDKT)
     C                             + '</additionalDeclarationType>'
     C                   EXSR      OPDFIL
     C                   IF        THTIRN <> *BLANKS
     C                   EVAL      XDATA = '<TIRCarnetNumber>'
     C                             + %TRIM(THTIRN) + '</TIRCarnetNumber>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '<security>'
     C                             + %TRIM(%EDITC(THSECU:'3'))
     C                             + '</security>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<reducedDatasetIndicator>'
     C                             + %TRIM(%EDITC(THRDIN:'3'))
     C                             + '</reducedDatasetIndicator>'
     C                   EXSR      OPDFIL
     C                   IF        THSCIN <> *BLANKS
     C                   EVAL      XDATA = '<specificCircumstanceIndicator>'
     C                             + %TRIM(THSCIN)
     C                             + '</specificCircumstanceIndicator>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        THCLKD <> *BLANKS
     C                   EVAL      XDATA = '<communicationLanguageAtDeparture>'
     C                             + %TRIM(THCLKD)
     C                             + '</communicationLanguageAtDeparture>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '<bindingItinerary>'
     C                             + %TRIM(%EDITC(THBINI:'3'))
     C                             + '</bindingItinerary>'
     C                   EXSR      OPDFIL
     C                   IF        M1N07 = '013'
      * Endring på andre felter enn garanti
     C                   EVAL      XDATA = '<amendmentTypeFlag>'
     C                             + %TRIM(%EDITC(THFLAG:'3'))
     C                             + '</amendmentTypeFlag>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C     SRMSG1701     TAG
     C*                  IF        THLIDT <> *BLANKS
     C*                  EVAL      XDATA = '<limitDate>'
     C*                            + %TRIM(THLIDT) + '</limitDate>'
     C*                  EXSR      OPDFIL
     C*                  END
     C                   IF        THENKL = 'J' AND THDDT <> 0
     C                   EVAL      XDATA = '<limitDate>'
     C                             + %TRIM(THDDTA) + '-' + %TRIM(THDDTM) + '-'
     C                             + %TRIM(THDDTD) + '</limitDate>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</TransitOperation>'
     C                   EXSR      OPDFIL
     C                   IF        M1N07 = '170'
     C                   GOTO      SRMSG1702
     C                   END
      *
     C                   IF        THATYP <> *BLANKS
     C                   EVAL      XDATA = '<Authorisation>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(THATYP) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THAREF
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Authorisation>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C     SRMSG1702     TAG
      * Customs office of departure
     C                   EVAL      XDATA = '<CustomsOfficeOfDeparture>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(THCATS) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</CustomsOfficeOfDeparture>'
     C                   EXSR      OPDFIL
     C                   IF        M1N07 = '170'
     C                   GOTO      SRMSG1703
     C                   END
      * Customs office of destination
     C                   EVAL      XDATA = '<CustomsOfficeOfDestination'
     C                             + 'Declared>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(THTSB) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</CustomsOfficeOfDestination'
     C                             + 'Declared>'
     C                   EXSR      OPDFIL
      * Custeoms office of transit
     C                   IF        TSD(1) <> *BLANKS
     C                   Z-ADD     0             XN1               3 0
     C     1             DO        8             XN2               3 0
     C                   IF        TSD(XN2) <> *BLANKS
     C                   EVAL      XDATA = '<CustomsOfficeOfTransitDeclared>'
     C                   EXSR      OPDFIL
     C                   ADD       1             XN1
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + %TRIM(%EDITC(XN1:'Z'))
     C                             + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(TSD(XN2)) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        ETA(XN2) <> 0
     C                   MOVE      ETA(XN2)      XDT2
     C                   MOVE      *ZEROS        XTM2
     C                   MOVEL     ETAT(XN2)     XTM2
     C                   EVAL      XDATA = '<arrivalDateAndTimeEstimated>'
     C                             + %TRIM(XDT2A) + '-' + %TRIM(XDT2M) + '-'
     C                             + %TRIM(XDT2D) + 'T' + %TRIM(XTM2H) + ':'
     C                             + %TRIM(XTM2M) + ':' + %TRIM(XTM2S)
     C                             + '</arrivalDateAndTimeEstimated>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</CustomsOfficeOfTransitDeclared>'
     C                   EXSR      OPDFIL
     C                   END
     C                   ENDDO
     C                   END
      * Customs office of exit for transit
     C                   IF        THTSDE <> *BLANKS
     C                   EVAL      XDATA = '<CustomsOfficeOfExitForTransit'
     C                             + 'Declared>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(THTSDE) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</CustomsOfficeOfExitForTransit'
     C                             + 'Declared>'
     C                   EXSR      OPDFIL
     C                   END
      * Customs office of exit for transit 2
     C                   IF        THTSDE2 <> *BLANKS
     C                   EVAL      XDATA = '<CustomsOfficeOfExitForTransit'
     C                             + 'Declared>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '2' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(THTSDE2) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</CustomsOfficeOfExitForTransit'
     C                             + 'Declared>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C     SRMSG1703     TAG
      * Holder of the transit procesure
     C                   EVAL      XDATA = '<HolderOfTheTransitProcedure>'
     C                   EXSR      OPDFIL
     C                   IF        THTINH <> *BLANKS
     C                   EVAL      XTXT801 = THTINH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        THTIRH <> *BLANKS
     C                   EVAL      XTXT801 = THTIRH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<TIRHolderIdentificatioNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</TIRHolderIdentificatioNumber>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C*                  IF        THTINH = *BLANKS
      *
     C                   EVAL      XTXT801 = THNAH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THAD1H
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THPNH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THPSH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(THLKH) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
      *
     C*                  END
      *
     C                   IF        M1N07 = '170'
     C                   GOTO      SRMSG1704
     C                   END
      *
     C                   IF        THCPH <> *BLANKS
     C                   EVAL      XDATA = '<ContactPerson>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THCPH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   IF        THTLH <> *BLANKS
     C                   EVAL      XDATA = '<phoneNumber>'
     C                             + %TRIM(THTLH) + '</phoneNumber>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        THEMH <> *BLANKS
     C*                  EVAL      XDATA = '<E-mailAddress>'
     C*                            + %TRIM(THEMH) + '</E-mailAddress>'
     C                   EVAL      XDATA = '<eMailAddress>'
     C                             + %TRIM(THEMH) + '</eMailAddress>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</ContactPerson>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C     SRMSG1704     TAG
     C                   EVAL      XDATA = '</HolderOfTheTransitProcedure>'
     C                   EXSR      OPDFIL
      * Representative
     C                   IF        THTINA <> *BLANKS
     C                   EVAL      XDATA = '<Representative>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(THTINA) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<status>'
     C                             + %TRIM(%EDITC(THSTA:'4')) + '</status>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<ContactPerson>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THCPA
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<phoneNumber>'
     C                             + %TRIM(THTLA) + '</phoneNumber>'
     C                   EXSR      OPDFIL
     C                   IF        THEMA <> *BLANKS
     C*                  EVAL      XDATA = '<E-mailAddress>'
     C*                            + %TRIM(THEMA) + '</E-mailAddress>'
     C                   EVAL      XDATA = '<eMailAddress>'
     C                             + %TRIM(THEMA) + '</eMailAddress>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</ContactPerson>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Representative>'
     C                   EXSR      OPDFIL
      *
     C                   ELSE
      *
      * Forhåndsvarsel
     C*                  IF        THDK = 'ENTRY' OR THDK = 'EXIT'
     C*                  EVAL      XDATA = '<Representative>'
     C*                  EXSR      OPDFIL
     C*                  EVAL      XDATA = '<identificationNumber>'
     C*                            + %TRIM(THTINH) + '</identificationNumber>'
     C*                  EXSR      OPDFIL
     C*                  EVAL      XDATA = '<status>'
     C*                            + '2' + '</status>'
     C*                  EXSR      OPDFIL
     C*                  EVAL      XDATA = '<ContactPerson>'
     C*                  EXSR      OPDFIL
     C*                  EVAL      XTXT801 = THCPH
     C*                  EXSR      KNVST
     C*                  EVAL      XDATA = '<name>'
     C*                            + %TRIM(XTXT802) + '</name>'
     C*                  EXSR      OPDFIL
     C*                  EVAL      XDATA = '<phoneNumber>'
     C*                            + %TRIM(THTLH) + '</phoneNumber>'
     C*                  EXSR      OPDFIL
     C*                  IF        THEMH <> *BLANKS
     C***                EVAL      XDATA = '<E-mailAddress>'
     C***                          + %TRIM(THEMH) + '</E-mailAddress>'
     C*                  EVAL      XDATA = '<eMailAddress>'
     C*                            + %TRIM(THEMH) + '</eMailAddress>'
     C*                  EXSR      OPDFIL
     C*                  END
     C*                  EVAL      XDATA = '</ContactPerson>'
     C*                  EXSR      OPDFIL
     C*                  EVAL      XDATA = '</Representative>'
     C*                  EXSR      OPDFIL
     C*                  END
      *
     C                   END
      *
     C                   IF        M1N07 = '170'
     C                   GOTO      SRMSG1705
     C                   END
      *
      * Guarantee
     C*                  IF        THDK <> 'ENTRY' AND THDK <> 'EXIT'
     C                   EVAL      XDATA = '<Guarantee>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<guaranteeType>'
     C                             + %TRIM(THGKD)
     C                             + '</guaranteeType>'
     C                   IF        THDK <> 'ENTRY' AND THDK <> 'EXIT'
     C                   IF        THGFT2 = *BLANKS
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<GuaranteeReference>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<GRN>'
     C                             + %TRIM(THGFT1) + '</GRN>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<accessCode>'
     C                             + %TRIM(THGADK) + '</accessCode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<amountToBeCovered>'
     C                             + %TRIM(%EDITC(THGBL:'Z'))
     C                             + '</amountToBeCovered>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<currency>'
     C                             + %TRIM(THGVK) + '</currency>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</GuaranteeReference>'
     C                   ELSE
     C                   EVAL      XDATA = '<otherGuaranteeReference>'
     C                             + %TRIM(THGFT2)
     C                             + '</otherGuaranteeReference>'
     C                   END
     C                   END
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Guarantee>'
     C                   EXSR      OPDFIL
     C*                  END
      *
     C     SRMSG1705     TAG
     C                   EXSR      SRCONSIGN
      *
     C                   ENDSR
      *
      *
      *////////////////////////////////////////////////////////////
      *  Consignment                                    SRCONSIGN /
      *////////////////////////////////////////////////////////////
     C     SRCONSIGN     BEGSR
      *
      * Consigment
     C                   EVAL      XDATA = '<Consignment>'
     C                   EXSR      OPDFIL
     C                   IF        M1N07 = '170'
     C                   GOTO      SRCON1701
     C                   END
      *
S05  C*                  IF        THDK = 'TIR'
N06  C     KEYD          CHAIN     NCTSEH
N06  C                   IF        X_ANTHC = 1
N06  C                   IF        THALK = *BLANKS
N06  C                   IF        TCALK <> *BLANKS
N06  C                   EVAL      THALK = TCALK
N06  C                   ENDIF
N06  C                   ENDIF
N06  C                   ENDIF
N05  C                   IF        THALK <> *BLANKS
     C                   EVAL      XDATA = '<countryOfDispatch>'
     C                             + %TRIM(THALK) + '</countryOfDispatch>'
     C                   EXSR      OPDFIL
     C                   END
N06  C                   IF        X_ANTHC = 1
N06  C                   IF        THBLK = *BLANKS
N06  C                   IF        TCBLK <> *BLANKS
N06  C                   EVAL      THBLK = TCBLK
N06  C                   ENDIF
N06  C                   ENDIF
N06  C                   ENDIF
     C                   IF        THBLK <> *BLANKS
     C                   EVAL      XDATA = '<countryOfDestination>'
     C                             + %TRIM(THBLK) + '</countryOfDestination>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C     SRCON1701     TAG
     C                   EVAL      XDATA = '<containerIndicator>'
     C                             + %TRIM(THKDC) + '</containerIndicator>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<inlandModeOfTransport>'
     C                             + %TRIM(%EDITC(THTMIN:'Z'))
     C                             + '</inlandModeOfTransport>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<modeOfTransportAtTheBorder>'
     C                             + %TRIM(%EDITC(THTMGR:'Z'))
     C                             + '</modeOfTransportAtTheBorder>'
     C                   EXSR      OPDFIL
     C                   IF        M1N07 = '170'
     C                   GOTO      SRCON1702
     C                   END
     C                   EVAL      XDATA = '<grossMass>'
     C*                            + %TRIM(%EDITC(THVKB:'L'))
     C                             + %TRIM(%EDITW(THVKB:'        0 .   '))
     C                             + '</grossMass>'
     C                   EXSR      OPDFIL
N06  C                   IF        X_ANTHC = 1
N06  C                   IF        THUCR = *BLANKS
N06  C                   IF        TCUCR <> *BLANKS
N06  C                   EVAL      THUCR = TCUCR
N06  C                   ENDIF
N06  C                   ENDIF
N06  C                   ENDIF
N06  C                   IF        %FOUND(NCTSEH)
N06  C                   UPDATE    NCTSEHR
N06  C                   ENDIF
     C                   IF        THUCR <> *BLANKS
     C                   EVAL      XTXT801 = THUCR
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumberUCR>'
     C                             + %TRIM(XTXT802) + '</referenceNumberUCR>'
     C                   EXSR      OPDFIL
     C                   END
      * Carrier
     C                   IF        THTINC <> *BLANKS AND THTINC <> THTINH       G0090
      * G0090: Når carrier ikke er holder, send <Carrier>
     C                   EVAL      XDATA = '<Carrier>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(THTINC) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<ContactPerson>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THNAC
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THTLC
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<phoneNumber>'
     C                             + %TRIM(XTXT802) + '</phoneNumber>'
     C                   EXSR      OPDFIL
     C                   IF        THEMC <> *BLANKS
     C*                  EVAL      XDATA = '<E-mailAddress>'
     C*                            + %TRIM(THEMC) + '</E-mailAddress>'
     C                   EVAL      XDATA = '<eMailAddress>'
     C                             + %TRIM(THEMC) + '</eMailAddress>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</ContactPerson>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Carrier>'
     C                   EXSR      OPDFIL
     C                   END
      * Consignor
     C*                  IF        X_ULIKAVS <> 'J'
S01  C*                  IF        X_ULIKAVS <> 'J' AND THTINS <> THTINH        G0123
S01  C*                            AND (THSECU <> 0 OR THRDIN <> 1)             C0542
N01  C                   IF        X_ULIKAVS <> 'J'                             G0123
N01  C                             AND (THSECU <> 0 OR THRDIN <> 1)             C0542
      * G0123: Når Consignor <> Holder -> Sender <Consignor>
      * C0542: Secure = 0 og Redsert datasett = 1 -> Ikke sende <Consignor>
     C                   EVAL      XDATA = '<Consignor>'
     C                   EXSR      OPDFIL
     C                   IF        THTINS <> *BLANKS
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(THTINS) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XTXT801 = THNAS
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THAD1S
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THPNS
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THPSS
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(THLKS) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<ContactPerson>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THCPS
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THTLS
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<phoneNumber>'
     C                             + %TRIM(XTXT802) + '</phoneNumber>'
     C                   EXSR      OPDFIL
     C                   IF        THEMS <> *BLANKS
     C*                  EVAL      XDATA = '<E-mailAddress>'
     C*                            + %TRIM(THEMS) + '</E-mailAddress>'
     C                   EVAL      XDATA = '<eMailAddress>'
     C                             + %TRIM(THEMS) + '</eMailAddress>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</ContactPerson>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Consignor>'
     C                   EXSR      OPDFIL
     C                   END
      * Consignee
     C                   IF        X_ULIKMOT <> 'J'
     C                             AND X_HCI_AM <> 'J'                          AVS/MOTT IKKE I ITEM
     C                   EVAL      XDATA = '<Consignee>'
     C                   EXSR      OPDFIL
     C                   IF        THTINK <> *BLANKS
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(THTINK) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XTXT801 = THNAK
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THAD1K
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THPNK
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THPSK
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(THLKK) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Consignee>'
     C                   EXSR      OPDFIL
     C                   END
      * Additional supply chain actor
     C                   IF        THIDR <> *BLANKS
     C                   EVAL      XDATA = '<AdditionalSupplyChainActor>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<role>'
     C                             + %TRIM(THROLE) + '</role>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(THIDR) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</AdditionalSupplyChainActor>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C     SRCON1702     TAG
      *
      * Transport equipment
     C                   IF        THKDC = '1'                                  1<-B
      * Sett "Declaration Goods Item Number"
     C                   MOVE      *ZEROS        X_ITEMT           5 0
     C                   MOVE      *ZEROS        X_CNR             3 0
     C                   MOVE      *BLANKS       CNR
     C                   MOVE      *ZEROS        ANT
     C                   MOVE      *BLANKS       SEAL
     C*                  MOVE      *BLANKS       X_SEAL           17
     C     KEYD          SETLL     NCTSEI
     C     KEYD          READE     NCTSEI                                 33
     C                   DOW       *IN33 = *OFF                                  2<-B
     C     1             DO        10            XN                3 0
     C                   SELECT                                                   3<-B
     C                   WHEN      TICNR <> *BLANKS AND CNR(XN) = *BLANKS         3
      * Ny container
     C                   ADD       1             X_ITEMT
     C                   EVAL      TILIT = X_ITEMT
     C                   UPDATE    NCTSEIR
     C                   EVAL      X_CNR = X_CNR + 1
     C                   EVAL      CNR(XN) = TICNR
     C                   IF        TIDFKD = *BLANKS                                4<-B
     C                   EVAL      ANT(XN) = 0
     C                   ELSE                                                      4
     C     1             DO        10            XN2               3 0              5<-B
     C                   IF        SEAL(XN2) = *BLANKS                               6<-B
     C                   EVAL      SEAL(XN2) = TIDFKD
     C                   LEAVE
     C                   END                                                         6<-E
     C                   ENDDO                                                      5<-E
     C                   EVAL      ANT(XN) = 1
     C                   END                                                       4<-E
     C                   LEAVE
     C                   WHEN      TICNR <> *BLANKS AND TICNR = CNR(XN)           3
      * Samme container
     C                   ADD       1             X_ITEMT
     C                   EVAL      TILIT = X_ITEMT
     C                   UPDATE    NCTSEIR
     C*                  IF        TIDFKD <> *BLANKS AND TIDFKD <> X_SEAL          4<-B
      * Ulike seal
     C*                  EVAL      ANT(XN) = ANT(XN) + 1
     C*                  END                                                       4<-E
     C                   IF        TIDFKD <> *BLANKS                               4<-B
     C     1             DO        10            XN2               3 0              5<-B
     C                   SELECT                                                      6<-B
     C                   WHEN      SEAL(XN2) = *BLANKS                               6
     C                   EVAL      SEAL(XN2) = TIDFKD
     C                   EVAL      ANT(XN) = ANT(XN) + 1
     C                   LEAVE
     C                   WHEN      SEAL(XN2) = TIDFKD                                6
     C                   LEAVE
     C                   ENDSL                                                       6<-E
     C                   ENDDO                                                      5<-E
     C                   END                                                       4<-E
     C                   LEAVE
     C                   ENDSL                                                    3<-E
     C                   ENDDO
     C     KEYD          READE     NCTSEI                                 33
     C                   ENDDO                                                   2<-E
      *
      * Container hentes fra NCTSIE02
     C     1             DO        X_CNR         XN                3 0           2<-B
     C                   EVAL      TICNR = CNR(XN)
     C                   EVAL      XDATA = '<TransportEquipment>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + %TRIM(%EDITC(XN:'3'))
     C                             + '</sequenceNumber>'
     C                   EXSR      OPDFIL
      * Container
     C                   EVAL      XDATA = '<containerIdentificationNumber>'
     C                             + %TRIM(TICNR)
     C                             + '</containerIdentificationNumber>'
     C                   EXSR      OPDFIL
      * Antall seals
     C                   EVAL      XDATA = '<numberOfSeals>'
     C                             + %TRIM(%EDITC(ANT(XN):'3'))
     C                             + '</numberOfSeals>'
     C                   EXSR      OPDFIL
      * Seal
     C     KEYF          SETLL     NCTSEI02
     C     KEYF          READE     NCTSEI02                               33
     C                   MOVE      *ZEROS        XN2               3 0
     C                   MOVE      *BLANKS       X_SEAL           17
     C                   DOW       *IN33 = *OFF                                   3<-B
     C                   IF        TIDFKD <> *BLANKS AND TIDFKD <> X_SEAL          4<-B
     C                   EVAL      XN2    = XN2 + 1
     C                   EVAL      X_SEAL = TIDFKD
     C                   EVAL      XDATA = '<Seal>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + %TRIM(%EDITC(XN2:'3'))
     C                             + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<identifier>'
     C                             + %TRIM(X_SEAL) + '</identifier>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Seal>'
     C                   EXSR      OPDFIL
     C                   END                                                       4<-E
     C     KEYF          READE     NCTSEI02                               33
     C                   ENDDO                                                    3<-E
      *
     C*                  IF        X_CNR > 1                                      3<-B
     C                   IF        X_CNR > 0                                      3<-B
      * Goods Reference
     C     KEYF          SETLL     NCTSEI02
     C     KEYF          READE     NCTSEI02                               33
     C                   MOVE      *ZEROS        XN2               3 0
     C                   DOW       *IN33 = *OFF                                    4<-B
     C                   EVAL      XN2    = XN2 + 1
     C                   EVAL      XDATA = '<GoodsReference>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + %TRIM(%EDITC(XN2:'3'))
     C                             + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<declarationGoodsItemNumber>'
     C                             + %TRIM(%EDITC(TILIT:'Z'))
     C                             + '</declarationGoodsItemNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</GoodsReference>'
     C                   EXSR      OPDFIL
     C     KEYF          READE     NCTSEI02                               33
     C                   ENDDO                                                     4<-E
     C                   END                                                      3<-E
      *
     C                   EVAL      XDATA = '</TransportEquipment>'
     C                   EXSR      OPDFIL
     C                   END                                                     2<-E
      *
     C                   END                                                    1<-E
      *
      * START Location of goods
     C                   IF        THLGTY <> *BLANKS
     C                   EVAL      XDATA = '<LocationOfGoods>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<typeOfLocation>'
     C                             + %TRIM(THLGTY)
     C                             + '</typeOfLocation>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<qualifierOfIdentification>'
     C                             + %TRIM(THLGID)
     C                             + '</qualifierOfIdentification>'
     C                   EXSR      OPDFIL
      *
      * Start C0394
     C                   SELECT
     C                   WHEN      THLGID = 'Y'
      * Autorisation number
     C                   EVAL      XDATA = '<authorisationNumber>'
     C                             + %TRIM(THLGAU)
     C                             + '</authorisationNumber>'
     C                   EXSR      OPDFIL
     C                   IF        THLGAI <> *BLANKS
     C                   EVAL      XDATA = '<additionalIdentifier>'
     C                             + %TRIM(THLGAI)
     C                             + '</additionalIdentifier>'
     C                   EXSR      OPDFIL
     C                   END
     C                   WHEN      THLGID = 'U'
      * UN Locode
     C                   EVAL      XDATA = '<UNLocode>'
     C                             + %TRIM(THLGUN) + '</UNLocode>'
     C                   EXSR      OPDFIL
     C                   WHEN      THLGID = 'V'
      * Customs office
     C                   EVAL      XDATA = '<CustomsOffice>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(THLGTS)
     C                             + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</CustomsOffice>'
     C                   EXSR      OPDFIL
     C                   WHEN      THLGID = 'W'
      * GNSS
     C                   EVAL      XDATA = '<GNSS>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<latitude>'
     C                             + %TRIM(THLGLA) + '</latitude>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<longitude>'
     C                             + %TRIM(THLGLO)
     C                             + '</longitude>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</GNSS>'
     C                   EXSR      OPDFIL
     C                   WHEN      THLGID = 'X'
      * Economic operator
     C                   EVAL      XDATA = '<EconomicOperator>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(THTINE) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</EconomicOperator>'
     C                   EXSR      OPDFIL
     C                   WHEN      THLGID = 'Z'
      * Address
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THADE1
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   IF        THPNE <> *BLANKS
     C                   EVAL      XTXT801 = THPNE
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XTXT801 = THPSE
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(THLKE) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
     C                   WHEN      THLGID = 'T'
      * Postcode Address
     C                   EVAL      XDATA = '<PostcodeAddress>'
     C                   EXSR      OPDFIL
     C                   IF        THADE2 <> *BLANKS
     C                   EVAL      XTXT801 = THADE2
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<houseNumber>'
     C                             + %TRIM(XTXT802) + '</houseNumber>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XTXT801 = THPNE2
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(THLKE2) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</PostcodeAddress>'
     C                   EXSR      OPDFIL
      *
     C                   ENDSL
      * Slutt C0394
      *
     C                   IF        THCPE <> *BLANKS AND THLGID <> 'V'
     C                   EVAL      XDATA = '<ContactPerson>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THCPE
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THTLE
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<phoneNumber>'
     C                             + %TRIM(XTXT802) + '</phoneNumber>'
     C                   EXSR      OPDFIL
     C                   IF        THEME <> *BLANKS
     C*                  EVAL      XDATA = '<E-mailAddress>'
     C*                            + %TRIM(THEME) + '</E-mailAddress>'
     C                   EVAL      XDATA = '<eMailAddress>'
     C                             + %TRIM(THEME) + '</eMailAddress>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</ContactPerson>'
     C                   EXSR      OPDFIL
     C                   END
      * SLUTT Location of goods
     C                   EVAL      XDATA = '</LocationOfGoods>'
     C                   EXSR      OPDFIL
     C                   END
      *
      * START Departure transport means
     C                   EVAL      XDATA = '<DepartureTransportMeans>'
     C                   EXSR      OPDFIL
      * TRUCK
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<typeOfIdentification>'
     C                             + %TRIM(%EDITC(THTRM:'Z'))
     C                             + '</typeOfIdentification>'
     C                   EXSR      OPDFIL
     C     '#'           SCAN      THTAID        XPOS              3 0    33
     C                   IF        *IN33 = *OFF
     C                   EVAL      XTXT801 = THTAID
     C                   ELSE
     C                   EVAL      XTXT801 = %SUBST(THTAID:1:XPOS-1)
     C                   END
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   IF        THTALK <> *BLANKS
     C                   EVAL      XDATA = '<nationality>'
     C                             + %TRIM(THTALK) + '</nationality>'
     C                   EXSR      OPDFIL
     C                   END
      * SLUTT Departure transport means
     C                   EVAL      XDATA = '</DepartureTransportMeans>'
     C                   EXSR      OPDFIL
      * HENGER 1
     C                   IF        XPOS > 0 AND %SUBST(THTAID:XPOS+1:1) <> ' '
     C                   EVAL      XDATA = '<DepartureTransportMeans>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '2' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<typeOfIdentification>'
     C                             + '31'
     C                             + '</typeOfIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XPOS = XPOS + 1
     C     '#'           SCAN      THTAID:XPOS   XPOS2             3 0    33
     C                   IF        *IN33 = *OFF
     C                   EVAL      XTXT801 = %SUBST(THTAID:XPOS:36-XPOS)
     C                   ELSE
     C                   EVAL      XTXT801 = %SUBST(THTAID:XPOS:XPOS2-XPOS)
     C                   END
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<nationality>'
     C                             + %TRIM(THTALK) + '</nationality>'
     C                   EXSR      OPDFIL
      * SLUTT Departure transport means
     C                   EVAL      XDATA = '</DepartureTransportMeans>'
     C                   EXSR      OPDFIL
      * HENGER 2
     C                   IF        XPOS2 > 0 AND %SUBST(THTAID:XPOS2+1:1) <> ' '
     C                   EVAL      XDATA = '<DepartureTransportMeans>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '3' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<typeOfIdentification>'
     C                             + '31'
     C                             + '</typeOfIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = %SUBST(THTAID:XPOS2+1:35-XPOS2)
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<nationality>'
     C                             + %TRIM(THTALK) + '</nationality>'
     C                   EXSR      OPDFIL
      * SLUTT Departure transport means
     C                   EVAL      XDATA = '</DepartureTransportMeans>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C                   END
      *
     C                   IF        M1N07 = '170'
     C                   GOTO      SRCON1703
     C                   END
      * Country of routing of consignment
     C                   IF        LKR(1) <> *BLANKS
     C                   MOVE      *ZEROS        XN1
     C     1             DO        6             XN2
     C                   IF        LKR(XN2) <> *BLANKS
     C                   EVAL      XDATA = '<CountryOfRoutingOfConsignment>'
     C                   EXSR      OPDFIL
     C                   ADD       1             XN1
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + %TRIM(%EDITC(XN1:'Z'))
     C                             + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(LKR(XN2)) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</CountryOfRoutingOfConsignment>'
     C                   EXSR      OPDFIL
     C                   END
     C                   ENDDO
     C                   END
      *
     C     SRCON1703     TAG
      * Active border transport means
     C                   EVAL      XDATA = '<ActiveBorderTransportMeans>'
     C                   EXSR      OPDFIL
      * Truck
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<customsOfficeAtBorderReference'
     C                             + 'Number>'
     C                             + %TRIM(THTGTS)
     C                             + '</customsOfficeAtBorderReferenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<typeOfIdentification>'
     C                             + %TRIM(%EDITC(THTRMG:'3'))
     C                             + '</typeOfIdentification>'
     C                   EXSR      OPDFIL
     C     '#'           SCAN      THTGID        XPOS              3 0    33
     C                   IF        *IN33 = *OFF
     C                   EVAL      XTXT801 = THTGID
     C                   ELSE
     C                   EVAL      XTXT801 = %SUBST(THTGID:1:XPOS-1)
     C                   END
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<nationality>'
     C                             + %TRIM(THTGLK) + '</nationality>'
     C                   EXSR      OPDFIL
     C                   IF        THTGCN <> *BLANKS
     C                   EVAL      XTXT801 = THTGCN
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<conveyanceReferenceNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</conveyanceReferenceNumber>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</ActiveBorderTransportMeans>'
     C                   EXSR      OPDFIL
      * HENGER 1
     C                   IF        XPOS > 0 AND %SUBST(THTGID:XPOS+1:1) <> ' '
     C                   EVAL      XDATA = '<ActiveBorderTransportMeans>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '2' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<typeOfIdentification>'
     C                             + '31'
     C                             + '</typeOfIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XPOS = XPOS + 1
     C     '#'           SCAN      THTGID:XPOS   XPOS2             3 0    33
     C                   IF        *IN33 = *OFF
     C                   EVAL      XTXT801 = %SUBST(THTGID:XPOS:36-XPOS)
     C                   ELSE
     C                   EVAL      XTXT801 = %SUBST(THTGID:XPOS:XPOS2-XPOS)
     C                   END
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<nationality>'
     C                             + %TRIM(THTGLK) + '</nationality>'
     C                   EXSR      OPDFIL
      * SLUTT Departure transport means
     C                   EVAL      XDATA = '</ActiveBorderTransportMeans>'
     C                   EXSR      OPDFIL
      * HENGER 2
     C                   IF        XPOS2 > 0 AND %SUBST(THTGID:XPOS2+1:1) <> ' '
     C                   EVAL      XDATA = '<ActiveBorderTransportMeans>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '3' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<typeOfIdentification>'
     C                             + '31'
     C                             + '</typeOfIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = %SUBST(THTGID:XPOS2+1:35-XPOS2)
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<nationality>'
     C                             + %TRIM(THTGLK) + '</nationality>'
     C                   EXSR      OPDFIL
      * SLUTT Departure transport means
     C                   EVAL      XDATA = '</ActiveBorderTransportMeans>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C                   END
      * Place of loading
     C                   IF        THSECU <> 0 OR THLSUN <> *BLANKS
N05  C                             OR THLSLK <> *BLANKS
     C                   EVAL      XDATA = '<PlaceOfLoading>'
     C                   EXSR      OPDFIL
N05  C                   IF        THLSUN <> *BLANKS
     C                   EVAL      XDATA = '<UNLocode>'
     C                             + %TRIM(THLSUN) + '</UNLocode>'
     C                   EXSR      OPDFIL
N05  C                   ENDIF
N05  C                   IF        THLSLK <> *BLANKS
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(THLSLK) + '</country>'
     C                   EXSR      OPDFIL
N05  C                   ENDIF
N05  C                   IF        THLSNA <> *BLANKS
     C                   EVAL      XDATA = '<location>'
     C                             + %TRIM(THLSNA) + '</location>'
     C                   EXSR      OPDFIL
N05  C                   ENDIF
     C                   EVAL      XDATA = '</PlaceOfLoading>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C                   IF        M1N07 = '170'
     C                   GOTO      SRCON1704
     C                   END
      * Place of unloading
     C                   IF        THSECU <> 0 OR THLOUN <> *BLANKS
     C                   EVAL      XDATA = '<PlaceOfUnloading>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<UNLocode>'
     C                             + %TRIM(THLOUN) + '</UNLocode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(THLOLK) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<location>'
     C                             + %TRIM(THLONA) + '</location>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</PlaceOfUnloading>'
     C                   EXSR      OPDFIL
     C                   END
      * Previous document
     C                   IF        THPDRF <> *BLANKS OR THPDIN <> *BLANKS
     C                   EVAL      XDATA = '<PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(THPDTY) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THPDRF
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        THPDIN <> *BLANKS
     C                   EVAL      XTXT801 = THPDIN
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<complementOfInformation>'
     C                             + %TRIM(XTXT802)
     C                             + '</complementOfInformation>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Supporting document
     C                   IF        THSDRF <> *BLANKS OR THSDIN <> *BLANKS
     C                   EVAL      XDATA = '<SupportingDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(THSDTY) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THSDRF
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        THSDIN <> *BLANKS
     C                   EVAL      THSDLN = 1
     C                   EVAL      XDATA = '<documentLineItemNumber>'
     C                             + %TRIM(%EDITC(THSDLN:'Z'))
     C                             + '</documentLineItemNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THSDIN
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<complementOfInformation>'
     C                             + %TRIM(XTXT802)
     C                             + '</complementOfInformation>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</SupportingDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Transport document
     C                   IF        THTDRF <> *BLANKS
     C                   EVAL      XDATA = '<TransportDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(THTDTY) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THTDRF
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</TransportDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Additional document
     C                   IF        THADRF <> *BLANKS
     C                   EVAL      XDATA = '<AdditionalDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(THADTY) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THADRF
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</AdditionalDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Additional information
     C                   IF        THAITX <> *BLANKS
     C                   EVAL      XDATA = '<AdditionalInformation>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<code>'
     C                             + %TRIM(THAICD) + '</code>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THAITX
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<text>'
     C                             + %TRIM(XTXT802) + '</text>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</AdditionalInformation>'
     C                   EXSR      OPDFIL
     C                   END
      * Transport charges
     C                   IF        THTRCH <> *BLANKS
     C                   EVAL      XDATA = '<TransportCharges>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<methodOfPayment>'
     C                             + %TRIM(THTRCH) + '</methodOfPayment>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</TransportCharges>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C     SRCON1704     TAG
     C                   MOVE      *ZEROS        X_HOUSE           3 0
     C                   MOVE      *ZEROS        X_ITEMT           5 0
     C     KEYD          SETLL     NCTSEC
     C     KEYD          READE     NCTSEC                                 33
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             X_HOUSE
     C                   EVAL      TCLN = X_HOUSE
     C                   UPDATE    NCTSECR
     C                   EXSR      SRHOUSE
     C     KEYD          READE     NCTSEC                                 33
     C                   ENDDO
      *
     C                   EVAL      XDATA = '</Consignment>'
     C                   EXSR      OPDFIL
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  SRHOUSE                                          SRHOUSE /
      *////////////////////////////////////////////////////////////
     C     SRHOUSE       BEGSR
      *
      * House consigment
     C                   EVAL      XDATA = '<HouseConsignment>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + %TRIM(%EDITC(X_HOUSE:'Z'))
     C                             + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        M1N07 = '170'
     C                   GOTO      SRHAU1701
     C                   END
      * Country of dispatch
     C                   IF        TCALK <> *BLANKS
N06  C                   IF        X_ANTHC > 1
     C                   EVAL      XDATA = '<countryOfDispatch>'
     C                             + %TRIM(TCALK) + '</countryOfDispatch>'
     C                   EXSR      OPDFIL
N06  C                   ENDIF
     C                   END
      *
     C                   EVAL      XDATA = '<grossMass>'
     C*                            + %TRIM(%EDITC(TCVKTB:'3'))
     C                             + %TRIM(%EDITW(TCVKTB:'        0 .   '))
     C                             + '</grossMass>'
     C                   EXSR      OPDFIL
      *
     C                   IF        TCUCR <> *BLANKS
N06  C                   IF        X_ANTHC > 1
     C                   EVAL      XTXT801 = TCUCR
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumberUCR>'
     C                             + %TRIM(XTXT802) + '</referenceNumberUCR>'
     C                   EXSR      OPDFIL
N06  C                   ENDIF
     C                   END
      * Consignor
     C     NCTSECK       CHAIN     NCTSECAM                           33
     C                   IF        *IN33
     C                   IF        X_ULIKAVS = 'J'
     C                   EVAL      TCTINS = THTINS
     C                   EVAL      TCNAS  = THNAS
     C                   EVAL      TCAD1S = THNAS
     C                   EVAL      TCPNS  = THPNS
     C                   EVAL      TCPSS  = THPSS
     C                   EVAL      TCLKS  = THLKS
     C                   EVAL      TCCPS  = THCPS
     C                   EVAL      TCTLS  = THTLS
     C                   EVAL      TCEMS  = THEMS
     C                   END
     C                   IF        X_ULIKMOT = 'J'
     C                   EVAL      TCTINK = THTINS
     C                   EVAL      TCNAK  = THNAK
     C                   EVAL      TCAD1K = THNAK
     C                   EVAL      TCPNK  = THPNK
     C                   EVAL      TCPSK  = THPSK
     C                   EVAL      TCLKK  = THLKK
     C                   END
     C                   IF        X_ULIKACT = 'J'
     C                   EVAL      TCROLE = THROLE
     C                   EVAL      TCIDR  = THIDR
     C                   END
     C                   END
      * Consignor
     C                   IF        X_ULIKAVS = 'J'
     C                             AND (THSECU <> 0 OR THRDIN <> 1)             C0542
      * C0542: Secure = 0 og Redsert datasett = 1 -> Ikke sende <Consignor>
     C                   EVAL      XDATA = '<Consignor>'
     C                   EXSR      OPDFIL
     C                   IF        TCTINS <> *BLANKS
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(TCTINS) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XTXT801 = TCNAS
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCAD1S
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCPNS
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCPSS
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(TCLKS) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<ContactPerson>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCCPS
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCTLS
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<phoneNumber>'
     C                             + %TRIM(XTXT802) + '</phoneNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TCEMS <> *BLANKS
     C*                  EVAL      XDATA = '<E-mailAddress>'
     C*                            + %TRIM(TCEMS) + '</E-mailAddress>'
     C                   EVAL      XDATA = '<eMailAddress>'
     C                             + %TRIM(TCEMS) + '</eMailAddress>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</ContactPerson>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Consignor>'
     C                   EXSR      OPDFIL
     C                   END
      * Consignee
     C                   IF        X_ULIKMOT = 'J'
     C                             AND X_HCI_AM <> 'J'                          AVS/MOTT IKKE I ITEM
     C                   EVAL      XDATA = '<Consignee>'
     C                   EXSR      OPDFIL
     C                   IF        TCTINK <> *BLANKS
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(TCTINK) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XTXT801 = TCNAK
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCAD1K
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCPNK
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCPSK
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(TCLKK) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Consignee>'
     C                   EXSR      OPDFIL
     C                   END
      * Slutt på Consignor, Consignee
      *
      * Additional supply chain actor
     C                   IF        X_ULIKACT = 'J' AND TCROLE <> *BLANKS
     C                   EVAL      XDATA = '<AdditionalSupplyChainActor>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<role>'
     C                             + %TRIM(TCROLE) + '</role>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(TCIDR) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</AdditionalSupplyChainActor>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C     SRHAU1701     TAG
      * START Departure transport means
     C                   IF        TCTATY <> 0 OR TCTAID <> *BLANKS
     C                   EVAL      XDATA = '<DepartureTransportMeans>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<typeOfIdentification>'
     C                             + %TRIM(%EDITC(TCTATY:'Z'))
     C                             + '</typeOfIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCTAID
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<nationality>'
     C                             + %TRIM(TCTALK) + '</nationality>'
     C                   EXSR      OPDFIL
      * SLUTT Departure transport means
     C                   EVAL      XDATA = '</DepartureTransportMeans>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        M1N07 = '170'
     C                   GOTO      SRHAU1702
     C                   END
      * Previous document
     C                   IF        TCPDRF <> *BLANKS OR TCPDIN <> *BLANKS
     C                   IF        *IN33 AND *IN33 = *OFF
      * Send KUN på item-nivå
     C                   EVAL      XDATA = '<PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TCPDTY) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCPDRF
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TCPDIN <> *BLANKS
     C                   EVAL      XDATA = '<complementOfInformation>'
     C                             + %TRIM(TCPDIN)
     C                             + '</complementOfInformation>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</PreviousDocument>'
     C                   EXSR      OPDFIL
      *
     C                   END
     C                   END
      * Supporting document
     C                   IF        TCSDRF <> *BLANKS OR TCSDIN <> *BLANKS
     C                   EVAL      XDATA = '<SupportingDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TCSDTY) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCSDRF
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TCSDIN <> *BLANKS
     C                   EVAL      TCSDLN = 1
     C                   EVAL      XDATA = '<documentLineItemNumber>'
     C                             + %TRIM(%EDITC(TCSDLN:'Z'))
     C                             + '</documentLineItemNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<complementOfInformation>'
     C                             + %TRIM(TCSDIN)
     C                             + '</complementOfInformation>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</SupportingDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Transport document
     C                   IF        TCTDRF <> *BLANKS
     C                   EVAL      XDATA = '<TransportDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TCTDTY) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCTDRF
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</TransportDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Additional document
     C                   IF        TCADRF <> *BLANKS
     C                   EVAL      XDATA = '<AdditionalDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TCADTY) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCADRF
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</AdditionalDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Additional information
     C                   IF        TCAITX <> *BLANKS
     C                   EVAL      XDATA = '<AdditionalInformation>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<code>'
     C                             + %TRIM(TCAICD) + '</code>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TCAITX
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<text>'
     C                             + %TRIM(XTXT802) + '</text>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</AdditionalInformation>'
     C                   EXSR      OPDFIL
     C                   END
      * Transport charge
     C                   IF        TCTRCH <> *BLANKS
     C                   EVAL      XDATA = '<TransportCharges>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<methodOfPayment>'
     C                             + %TRIM(TCTRCH) + '</methodOfPayment>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</TransportCharges>'
     C                   EXSR      OPDFIL
     C                   END
      *
      * Consignment items
     C                   MOVE      *ZEROS        X_ITEM            3 0
     C     KEYE          SETLL     NCTSEI
     C     KEYE          READE     NCTSEI                                 33
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             X_ITEM
     C                   ADD       1             X_ITEMT
     C                   EVAL      TILIT = X_ITEMT
     C                   UPDATE    NCTSEIR
     C                   EXSR      SRITEM
     C     KEYE          READE     NCTSEI                                 33
     C                   ENDDO
      *
     C     SRHAU1702     TAG
     C                   EVAL      XDATA = '</HouseConsignment>'
     C                   EXSR      OPDFIL
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  SRITEM                                            SRITEM /
      *////////////////////////////////////////////////////////////
     C     SRITEM        BEGSR
      *
     C                   EVAL      XDATA = '<ConsignmentItem>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<goodsItemNumber>'
     C                             + %TRIM(%EDITC(X_ITEM:'Z'))
     C                             + '</goodsItemNumber>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '<declarationGoodsItemNumber>'
     C                             + %TRIM(%EDITC(X_ITEMT:'Z'))
     C                             + '</declarationGoodsItemNumber>'
     C                   EXSR      OPDFIL
      *
      * Declaration type       (Ligg i NCTSEC)
     C                   SELECT
     C                   WHEN      TIDK <> *BLANKS
     C                   EVAL      XDATA = '<declarationType>'
     C                             + %TRIM(TIDK) + '</declarationType>'
     C                   EXSR      OPDFIL
     C                   WHEN      TCDK <> *BLANKS
     C                   EVAL      XDATA = '<declarationType>'
     C                             + %TRIM(TCDK) + '</declarationType>'
     C                   EXSR      OPDFIL
     C                   ENDSL
      * Country of dispatch    (Ligg i NCTSEC)
     C*                  SELECT
     C*                  WHEN      TIALK <> *BLANKS
     C*                  EVAL      XDATA = '<countryOfDispatch>'
     C*                            + %TRIM(TIALK) + '</countryOfDispatch>'
     C*                  EXSR      OPDFIL
     C*                  WHEN      TCALK <> *BLANKS
     C*                  EVAL      XDATA = '<countryOfDispatch>'
     C*                            + %TRIM(TCALK) + '</countryOfDispatch>'
     C*                  EXSR      OPDFIL
     C*                  ENDSL
N05  C                   IF        TIALK <> *BLANKS
N05  C                   EVAL      XDATA = '<countryOfDispatch>'
N05  C                             + %TRIM(TIALK) + '</countryOfDispatch>'
N05  C                   EXSR      OPDFIL
N05  C                   ENDIF
      * Country of destination (Ligg i NCTSEC)
     C                   SELECT
     C                   WHEN      TIBLK <> *BLANKS
     C                   EVAL      XDATA = '<countryOfDestination>'
     C                             + %TRIM(TIBLK) + '</countryOfDestination>'
     C                   EXSR      OPDFIL
     C                   WHEN      TCBLK <> *BLANKS
     C                   EVAL      XDATA = '<countryOfDestination>'
     C                             + %TRIM(TCBLK) + '</countryOfDestination>'
     C                   EXSR      OPDFIL
     C                   ENDSL
      *
     C                   IF        TIUCR <> *BLANKS
     C                   EVAL      XTXT801 = TIUCR
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumberUCR>'
     C                             + %TRIM(XTXT802) + '</referenceNumberUCR>'
     C                   EXSR      OPDFIL
     C                   END
      *
      * Consignee                     (Ligg i NCTSEI)
     C                   IF        X_HCI_AM = 'J'
     C     NCTSEIAMK     CHAIN     NCTSEIAM                           33
N04  C                   IF        *IN33=*OFF
N04  C                   IF        TINAK=*BLANKS
N04  C                   EVAL      *IN33=*ON
N04  C                   ENDIF
N04  C                   ENDIF
     C                   IF        *IN33
     C                   EVAL      TIKNK  = THKNK
     C                   EVAL      TINAK  = THNAK
     C                   EVAL      TIAD1K = THAD1K
     C                   EVAL      TIPNK  = THPNK
     C                   EVAL      TIPSK  = THPSK
     C                   EVAL      TILKK  = THLKK
     C                   EVAL      TITINK = THTINK
     C                   END
     C                   EVAL      XDATA = '<Consignee>'
     C                   EXSR      OPDFIL
     C                   IF        TITINK <> *BLANKS
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(TITINK) + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C*                  ENDIF
     C                   ELSE
     C                   EVAL      XTXT801 = TINAK
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIAD1K
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPNK
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPSK
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(TILKK) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
     C                   ENDIF
     C                   EVAL      XDATA = '</Consignee>'
     C                   EXSR      OPDFIL
     C                   END
      * Additional supply chain actor (Ligg i NCTSEC)
      *
      * Commodity
     C                   EVAL      XDATA = '<Commodity>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XTXT801 = TICTX
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<descriptionOfGoods>'
     C                             + %TRIM(XTXT802)
     C                             + '</descriptionOfGoods>'
     C                   EXSR      OPDFIL
     C                   IF        TICCUS <> *BLANKS
     C                   EVAL      XDATA = '<cusCode>'
     C                             + %TRIM(TICCUS) + '</cusCode>'
     C                   EXSR      OPDFIL
     C                   END
      * Commodity code
     C                   EVAL      XDATA = '<CommodityCode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<harmonizedSystemSubHeadingCode>'
     C                             + %TRIM(TICCH_A)
     C                             + '</harmonizedSystemSubHeadingCode>'
     C                   EXSR      OPDFIL
     C                   IF        TICCCD <> *BLANKS
     C                   EVAL      XDATA = '<combinedNomenclatureCode>'
     C                             + %TRIM(TICCCD)
     C                             + '</combinedNomenclatureCode>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</CommodityCode>'
     C                   EXSR      OPDFIL
      * Dangerous goods
     C                   IF        TIUNNR <> *BLANKS
     C                   EVAL      XDATA = '<DangerousGoods>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<UNNumber>'
     C                             + %TRIM(TIUNNR) + '</UNNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</DangerousGoods>'
     C                   EXSR      OPDFIL
     C                   END
      * Goods measure
     C                   EVAL      XDATA = '<GoodsMeasure>'
     C                   EXSR      OPDFIL
     C                   IF        TIPNT = 0
      * R0221 -> Bruttovekt = 0
     C                   EVAL      XDATA = '<grossMass>0</grossMass>'
     C                   ELSE
     C                   EVAL      XDATA = '<grossMass>'
     C*                            + %TRIM(%EDITC(TIVKB:'L'))
     C                             + %TRIM(%EDITW(TIVKB:'        0 .   '))
     C                             + '</grossMass>'
     C                   END
     C                   EXSR      OPDFIL
N07  C                   IF        TIPNT = 0
N07  C                   EVAL      XDATA = '<netMass>0</netMass>'
N07  C                   ELSE
     C                   EVAL      XDATA = '<netMass>'
     C                             + %TRIM(%EDITW(TIVKN:'        0 .   '))
     C                             + '</netMass>'
     C                   EXSR      OPDFIL
N07  C                   ENDIF
     C                   IF        TINTS <> 0
     C                   EVAL      XDATA = '<supplementaryUnits>'
     C                             + %TRIM(%EDITC(TINTS:'L'))
     C                             + '</supplementaryUnits>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</GoodsMeasure>'
     C                   EXSR      OPDFIL
      *
     C                   EVAL      XDATA = '</Commodity>'
     C                   EXSR      OPDFIL
      * Packaging
     C                   EVAL      XDATA = '<Packaging>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TIPTY = *BLANKS
     C                   EVAL      TIPTY = 'PK'
     C                   END
     C                   EVAL      XDATA = '<typeOfPackages>'
     C                             + %TRIM(TIPTY)
     C                             + '</typeOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<numberOfPackages>'
     C                             + %TRIM(%EDITC(TIPNT:'3'))
     C                             + '</numberOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPMRK
     C                   EXSR      KNVST
N03  C                   IF        XTXT802='.'
N03  C                   EVAL      XTXT802='ADR.'
N03  C                   ENDIF
     C                   EVAL      XDATA = '<shippingMarks>'
     C                             + %TRIM(XTXT802)
     C                             + '</shippingMarks>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Packaging>'
     C                   EXSR      OPDFIL
      * Packaging 2
     C                   IF        TIPNT2 > 0
     C                   EVAL      XDATA = '<Packaging>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '2' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<typeOfPackages>'
     C                             + %TRIM(TIPTY2)
     C                             + '</typeOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<numberOfPackages>'
     C                             + %TRIM(%EDITC(TIPNT2:'3'))
     C                             + '</numberOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPMRK2
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<shippingMarks>'
     C                             + %TRIM(XTXT802)
     C                             + '</shippingMarks>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Packaging>'
     C                   EXSR      OPDFIL
     C                   END
      * Packaging 3
     C                   IF        TIPNT3 > 0
     C                   EVAL      XDATA = '<Packaging>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '3' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<typeOfPackages>'
     C                             + %TRIM(TIPTY3)
     C                             + '</typeOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<numberOfPackages>'
     C                             + %TRIM(%EDITC(TIPNT3:'3'))
     C                             + '</numberOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPMRK3
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<shippingMarks>'
     C                             + %TRIM(XTXT802)
     C                             + '</shippingMarks>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Packaging>'
     C                   EXSR      OPDFIL
     C                   END
      * Packaging 4
     C                   IF        TIPNT4 > 0
     C                   EVAL      XDATA = '<Packaging>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '4' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<typeOfPackages>'
     C                             + %TRIM(TIPTY4)
     C                             + '</typeOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<numberOfPackages>'
     C                             + %TRIM(%EDITC(TIPNT4:'3'))
     C                             + '</numberOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPMRK4
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<shippingMarks>'
     C                             + %TRIM(XTXT802)
     C                             + '</shippingMarks>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Packaging>'
     C                   EXSR      OPDFIL
     C                   END
      * Packaging 5
     C                   IF        TIPNT5 > 0
     C                   EVAL      XDATA = '<Packaging>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '5' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<typeOfPackages>'
     C                             + %TRIM(TIPTY5)
     C                             + '</typeOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<numberOfPackages>'
     C                             + %TRIM(%EDITC(TIPNT4:'3'))
     C                             + '</numberOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPMRK5
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<shippingMarks>'
     C                             + %TRIM(XTXT802)
     C                             + '</shippingMarks>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Packaging>'
     C                   EXSR      OPDFIL
     C                   END
      * Previous document
     C*                  IF        TIPDRF <> *BLANKS OR TIPDIN <> *BLANKS
     C                   IF        TCPDRF <> *BLANKS OR TCPDIN <> *BLANKS OR
     C                             TIPDRF <> *BLANKS OR TIPDIN <> *BLANKS
     C                   EVAL      XDATA = '<PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        %TRIM(TIPDTY) = *BLANKS
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TCPDTY) + '</type>'
     C                   ELSE
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TIPDTY) + '</type>'
     C                   END
     C                   EXSR      OPDFIL
     C                   IF        TIPDRF = *BLANKS
     C                   EVAL      X_PDRF = TCPDRF
     C                   ELSE
     C                   EVAL      X_PDRF = TIPDRF
     C                   END
     C     '#'           SCAN      X_PDRF        XPOS              3 0    33
     C                   IF        *IN33 = *OFF
     C                   EVAL      XTXT801 = X_PDRF
     C                   ELSE
     C                   EVAL      XTXT801 = %SUBST(X_PDRF:1:XPOS-1)
     C                   END
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TIPDGN <> 0
     C                   EVAL      XDATA = '<goodsItemNumber>'
     C                             + %TRIM(%EDITC(TIPDGN:'3'))
     C                             + '</goodsItemNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TIPDTP <> *BLANKS
     C                   EVAL      XDATA = '<typeOfPackages>'
     C                             + %TRIM(TIPDTP) + '</typeOfPackages>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '<numberOfPackages>'
     C                             + %TRIM(%EDITC(TIPDAN:'3'))
     C                             + '</numberOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<measurementUnitAndQualifier>'
     C                             + %TRIM(TIPDUN)
     C                             + '</measurementUnitAndQualifier>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<quantity>'
     C                             + %TRIM(%EDITC(TIPDPC:'3')) + '</quantity>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        TIPDIN <> *BLANKS OR TCPDIN <> *BLANKS
     C                   IF        TIPDIN = *BLANKS
     C                   EVAL      XDATA = '<complementOfInformation>'
     C                             + %TRIM(TCPDIN)
     C                             + '</complementOfInformation>'
     C                   ELSE
     C                   EVAL      XDATA = '<complementOfInformation>'
     C                             + %TRIM(TIPDIN)
     C                             + '</complementOfInformation>'
     C                   END
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * PreviousDocument 2
     C                   IF        XPOS > 0 AND %SUBST(X_PDRF:XPOS+1:1) <> ' '
     C                   EVAL      XDATA = '<PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '2' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        %TRIM(TIPDTY) = *BLANKS
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TCPDTY) + '</type>'
     C                   ELSE
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TIPDTY) + '</type>'
     C                   END
     C                   EXSR      OPDFIL
     C                   EVAL      XPOS = XPOS + 1
     C     '#'           SCAN      X_PDRF:XPOS   XPOS2             3 0    33
     C                   IF        *IN33 = *OFF
     C                   EVAL      XTXT801 = %SUBST(X_PDRF:XPOS:36-XPOS)
     C                   ELSE
     C                   EVAL      XTXT801 = %SUBST(X_PDRF:XPOS:XPOS2-XPOS)
     C                   END
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
      * SLUTT PreviousDocumentort 2
     C                   EVAL      XDATA = '</PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Previous document 2, NY DATABASE
     C                   IF        TIPDRF2 <> *BLANKS OR TIPDIN2 <> *BLANKS
     C                   EVAL      XDATA = '<PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '2' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TIPDTY2) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPDRF2
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TIPDGN2 <> 0
     C                   EVAL      XDATA = '<goodsItemNumber>'
     C                             + %TRIM(%EDITC(TIPDGN2:'3'))
     C                             + '</goodsItemNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TIPDTP2 <> *BLANKS
     C                   EVAL      XDATA = '<typeOfPackages>'
     C                             + %TRIM(TIPDTP2) + '</typeOfPackages>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '<numberOfPackages>'
     C                             + %TRIM(%EDITC(TIPDAN2:'3'))
     C                             + '</numberOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<measurementUnitAndQualifier>'
     C                             + %TRIM(TIPDUN2)
     C                             + '</measurementUnitAndQualifier>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<quantity>'
     C                             + %TRIM(%EDITC(TIPDPC2:'3')) + '</quantity>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        TIPDIN <> *BLANKS
     C                   EVAL      XDATA = '<complementOfInformation>'
     C                             + %TRIM(TIPDIN2)
     C                             + '</complementOfInformation>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Previous document 3, NY DATABASE
     C                   IF        TIPDRF3 <> *BLANKS OR TIPDIN3 <> *BLANKS
     C                   EVAL      XDATA = '<PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '3' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TIPDTY3) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPDRF3
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TIPDGN3 <> 0
     C                   EVAL      XDATA = '<goodsItemNumber>'
     C                             + %TRIM(%EDITC(TIPDGN3:'3'))
     C                             + '</goodsItemNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TIPDTP3 <> *BLANKS
     C                   EVAL      XDATA = '<typeOfPackages>'
     C                             + %TRIM(TIPDTP3) + '</typeOfPackages>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '<numberOfPackages>'
     C                             + %TRIM(%EDITC(TIPDAN3:'3'))
     C                             + '</numberOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<measurementUnitAndQualifier>'
     C                             + %TRIM(TIPDUN3)
     C                             + '</measurementUnitAndQualifier>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<quantity>'
     C                             + %TRIM(%EDITC(TIPDPC3:'3')) + '</quantity>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        TIPDIN <> *BLANKS
     C                   EVAL      XDATA = '<complementOfInformation>'
     C                             + %TRIM(TIPDIN3)
     C                             + '</complementOfInformation>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Previous document 4, NY DATABASE
     C                   IF        TIPDRF4 <> *BLANKS OR TIPDIN4 <> *BLANKS
     C                   EVAL      XDATA = '<PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '4' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TIPDTY4) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPDRF4
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TIPDGN4 <> 0
     C                   EVAL      XDATA = '<goodsItemNumber>'
     C                             + %TRIM(%EDITC(TIPDGN4:'3'))
     C                             + '</goodsItemNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TIPDTP4 <> *BLANKS
     C                   EVAL      XDATA = '<typeOfPackages>'
     C                             + %TRIM(TIPDTP4) + '</typeOfPackages>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '<numberOfPackages>'
     C                             + %TRIM(%EDITC(TIPDAN4:'3'))
     C                             + '</numberOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<measurementUnitAndQualifier>'
     C                             + %TRIM(TIPDUN4)
     C                             + '</measurementUnitAndQualifier>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<quantity>'
     C                             + %TRIM(%EDITC(TIPDPC4:'3')) + '</quantity>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        TIPDIN <> *BLANKS
     C                   EVAL      XDATA = '<complementOfInformation>'
     C                             + %TRIM(TIPDIN4)
     C                             + '</complementOfInformation>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Previous document 5, NY DATABASE
     C                   IF        TIPDRF5 <> *BLANKS OR TIPDIN5 <> *BLANKS
     C                   EVAL      XDATA = '<PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '5' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TIPDTY5) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIPDRF5
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TIPDGN5 <> 0
     C                   EVAL      XDATA = '<goodsItemNumber>'
     C                             + %TRIM(%EDITC(TIPDGN5:'3'))
     C                             + '</goodsItemNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TIPDTP4 <> *BLANKS
     C                   EVAL      XDATA = '<typeOfPackages>'
     C                             + %TRIM(TIPDTP5) + '</typeOfPackages>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '<numberOfPackages>'
     C                             + %TRIM(%EDITC(TIPDAN5:'3'))
     C                             + '</numberOfPackages>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<measurementUnitAndQualifier>'
     C                             + %TRIM(TIPDUN5)
     C                             + '</measurementUnitAndQualifier>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<quantity>'
     C                             + %TRIM(%EDITC(TIPDPC5:'3')) + '</quantity>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        TIPDIN <> *BLANKS
     C                   EVAL      XDATA = '<complementOfInformation>'
     C                             + %TRIM(TIPDIN5)
     C                             + '</complementOfInformation>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</PreviousDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Supporting document
     C                   IF        TISDRF <> *BLANKS OR TISDIN <> *BLANKS
     C                   EVAL      XDATA = '<SupportingDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TISDTY) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TISDRF
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   IF        TISDIN <> *BLANKS
     C                   EVAL      TISDLN = 1
     C                   EVAL      XDATA = '<documentLineItemNumber>'
     C                             + %TRIM(%EDITC(TISDLN:'Z'))
     C                             + '</documentLineItemNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TISDIN
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<complementOfInformation>'
     C                             + %TRIM(XTXT802)
     C                             + '</complementOfInformation>'
     C                   EXSR      OPDFIL
     C                   END
     C                   EVAL      XDATA = '</SupportingDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Transport document
     C                   IF        TITDRF <> *BLANKS
     C                   EVAL      XDATA = '<TransportDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TITDTY) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TITDRF
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</TransportDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Additional document
     C                   IF        TIADRF <> *BLANKS
     C                   EVAL      XDATA = '<AdditionalDocument>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<type>'
     C                             + %TRIM(TIADTY) + '</type>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIADRF
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(XTXT802) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</AdditionalDocument>'
     C                   EXSR      OPDFIL
     C                   END
      * Additional information
     C                   IF        TIAITX <> *BLANKS
     C                   EVAL      XDATA = '<AdditionalInformation>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<sequenceNumber>'
     C                             + '1' + '</sequenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<code>'
     C                             + %TRIM(TIAICD) + '</code>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = TIAITX
     C                   Z-ADD     70            XN53              3 0
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<text>'
     C                             + %TRIM(XTXT802) + '</text>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</AdditionalInformation>'
     C                   EXSR      OPDFIL
     C                   END
      * Transport charge
     C                   IF        TITRCH <> *BLANKS
     C                   EVAL      XDATA = '<TransportCharges>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<methodOfPayment>'
     C                             + %TRIM(TITRCH) + '</methodOfPayment>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</TransportCharges>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C                   EVAL      XDATA = '</ConsignmentItem>'
     C                   EXSR      OPDFIL
      *
     C                   ENDSR
      *
      */////////////////////////////////////////////////////////////
      * Send request release til Tollvesnet                        /
      */////////////////////////////////////////////////////////////
     C     RELEAS        BEGSR
      *
     C     KEYD          CHAIN     NCTSEHL                            82
      * Lag fil og set codepage (pc)
     C                   MOVE      *BLANKS       WFilNam         256
     C                   EVAL      WFilNam= '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/NCTS_'
     C                             + %TRIM(THOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_054.xml'
     C                   MOVE      *BLANKS       WFilNam2        256
     C                   EVAL      WFilNam2 = '/' + %TRIM(UELIBF) + 'X/'
     C                             + %TRIM(M0010)
     C                             + '/EDISE1K/BACKUP/NCTS_'
     C                             + %TRIM(THOPDNR) + '_'
     C                             + %TRIM(WDT) + %TRIM(WTM)
     C                             + '_054.xml'
      * 1208 = UTF-8
     C                   eval      FILE_o = open( %TrimR( WFilNam2 )
     C                               : O_CREAT+O_TRUNC+O_WRONLY
     C                                + O_TEXT_CREAT+O_CCSID+O_TEXTDATA
     C                               : S_IRUSR + S_IWUSR
     C                               : 1208
     C                               : 0)
      *
     C                   EVAL      XDATA = '<?xml version="1.0" '
     C                             + 'encoding="UTF-8" standalone="yes"?>'
     C*                            + 'encoding="UTF-8" standalone="true"?>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<ns2:CC054C '
     C                             + 'xmlns:ns2="http://ncts.dgtaxud.ec">'
     C                   EXSR      OPDFIL
      *
     C                   EXSR      SRMESSAGEREL
      *
     C                   EVAL      XDATA = '</ns2:CC054C>'
     C                   EXSR      OPDFIL
      *
     C                   callp     close( FILE_o )
     C                   EVAL      XCHGAUT = 'CHGAUT OBJ(' + XAPS
     C                             + %TRIM(WFilNam2) + XAPS
     C                             + ') USER(*PUBLIC) DTAAUT(*RWX) OBJAUT(*ALL)'
     C                   CALLP     RUNCMD(XCHGAUT:200)
      *
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Message                                     SRMESSAGEREL /
      *////////////////////////////////////////////////////////////
     C     SRMESSAGEREL  BEGSR
      *
     C                   EVAL      XDATA = '<messageSender>'
     C                             + %TRIM(M0004) + '</messageSender>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<messageRecipient>'
     C*                            + %TRIM(%SUBST(M0010:1:8))
     C                             + %TRIM(M0010)
     C                             + '</messageRecipient>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<preparationDateAndTime>'
     C                             + %TRIM(XDTA) + '-' + %TRIM(XDTM) + '-'
     C                             + %TRIM(XDTD) + 'T' + %TRIM(XTMH) + ':'
     C                             + %TRIM(XTMM) + ':' + %TRIM(XTMS)
     C                             + '</preparationDateAndTime>'
     C                   EXSR      OPDFIL
     C*                  CALL      'UUIDC'
     C*                  PARM                    U_UUID           36
     C                   EVAL      U_UUID = %TRIM(M0004) + '-'
     C                             + %TRIM(WDT) + '-' + %TRIM(X_CSN)
     C                   EVAL      XDATA = '<messageIdentification>'
     C*                            + %SUBST(U_UUID:1:35)
     C                             + %TRIM(U_UUID)
     C                             + '</messageIdentification>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<messageType>'
     C                             + 'CC054C' + '</messageType>'
     C                   EXSR      OPDFIL
     C*                  EVAL      XDATA = '<correlationIdentifier>'
     C*                            + 'O' + '</correlationIdentifier>'
     C*                  EXSR      OPDFIL
      * Transit operation
     C                   EVAL      XDATA = '<TransitOperation>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<MRN>' + %TRIM(THTRNR) + '</MRN>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<releaseRequested>'
     C                             + %trim(%editc(TLST:'3'))
     C                             + '</releaseRequested>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<releaseRequestDateAndTime>'
     C                             + %TRIM(TLDTA) + '-' + %TRIM(TLDTM) + '-'
     C                             + %TRIM(TLDTD) + 'T' + %TRIM(TLTMH) + ':'
     C                             + %TRIM(TLTMM) + ':' + %TRIM(TLTMS)
     C                             + '</releaseRequestDateAndTime>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</TransitOperation>'
     C                   EXSR      OPDFIL
      * Customs office of departure
     C                   EVAL      XDATA = '<CustomsOfficeOfDeparture>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<referenceNumber>'
     C                             + %TRIM(THCATS) + '</referenceNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</CustomsOfficeOfDeparture>'
     C                   EXSR      OPDFIL
      *
      * Holder of the transit procesure
     C                   EVAL      XDATA = '<HolderOfTheTransitProcedure>'
     C                   EXSR      OPDFIL
     C                   IF        THTINH <> *BLANKS
     C                   EVAL      XTXT801 = THTINH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<identificationNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</identificationNumber>'
     C                   EXSR      OPDFIL
     C                   END
     C                   IF        THTIRH <> *BLANKS
     C                   EVAL      XTXT801 = THTIRH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<TIRHolderIdentificatioNumber>'
     C                             + %TRIM(XTXT802)
     C                             + '</TIRHolderIdentificatioNumber>'
     C                   EXSR      OPDFIL
     C                   END
      *
     C                   IF        THTINH = *BLANKS
      *
     C                   EVAL      XTXT801 = THNAH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<name>'
     C                             + %TRIM(XTXT802) + '</name>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<Address>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THAD1H
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<streetAndNumber>'
     C                             + %TRIM(XTXT802) + '</streetAndNumber>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THPNH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<postcode>'
     C                             + %TRIM(XTXT802) + '</postcode>'
     C                   EXSR      OPDFIL
     C                   EVAL      XTXT801 = THPSH
     C                   EXSR      KNVST
     C                   EVAL      XDATA = '<city>'
     C                             + %TRIM(XTXT802) + '</city>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '<country>'
     C                             + %TRIM(THLKH) + '</country>'
     C                   EXSR      OPDFIL
     C                   EVAL      XDATA = '</Address>'
     C                   EXSR      OPDFIL
      *
     C                   END
      *
     C                   EVAL      XDATA = '</HolderOfTheTransitProcedure>'
     C                   EXSR      OPDFIL
      *
     C                   ENDSR
      *
      ***********************************************
     C     OPDFIL        BEGSR
      ***********************************************
     C                   EVAL      XDATA=(%trimr(XDATA))+ LF
     c                   callp     write(File_o : %addr(Xdata)
     c                                : %len(%trimr(Xdata)) )
      *
     C                   ENDSR
      *
      ***********************************************
     C     KNVST         BEGSR
      ***********************************************
     C*                  Z-ADD     50            XN53              3 0
     C                   Z-ADD     70            XN53              3 0
     C     XN53          SUB       4             XN54              3 0
     C     XN53          SUB       5             XN55              3 0
     C     XN53          SUB       6             XN56              3 0
     C                   Z-ADD     0             XN52              3 0
     C                   MOVE      *BLANKS       XTXT802
     C     1             DO        80            XN51              3 0
     C                   IF        XT801(XN51) = '&' OR
     C                             XT801(XN51) = '"' OR
     C                             XT801(XN51) = 'Æ' OR
     C                             XT801(XN51) = 'Ø' OR
     C                             XT801(XN51) = 'Å' OR
     C                             XT801(XN51) = 'æ' OR
     C                             XT801(XN51) = 'ø' OR
     C                             XT801(XN51) = 'å' OR
     C                             XT801(XN51) = X'5A' OR                       ¤
     C                             XT801(XN51) = X'8E' OR
     C                             XT801(XN51) = X'B0' OR
     C                             XT801(XN51) = X'B2' OR
     C                             XT801(XN51) = X'71' OR
     C                             XT801(XN51) = X'54' OR
     C                             XT801(XN51) = X'74' OR
     C                             XT801(XN51) = X'58' OR
     C                             XT801(XN51) = X'7D' OR
     C                             XT801(XN51) = X'EC' OR
     C                             XT801(XN51) = X'90' OR
     C                             XT801(XN51) = X'63' OR                       Ä -> AA
     C                             XT801(XN51) = X'FC' OR
     C                             XT801(XN51) = X'CC' OR                       ö -> oe
     C                             XT801(XN51) = X'43' OR                       ä -> aa
     C                             XT801(XN51) = X'55' OR                       í -> i
     C                             XT801(XN51) = X'62' OR                       Â -> A
     C                             XT801(XN51) = X'51' OR                       é -> e
     C                             XT801(XN51) = X'42' OR                       â -> aa
     C                             XT801(XN51) = X'CE' OR                       ó -> o
     C                             XT801(XN51) = X'64' OR                       À -> A
     C                             XT801(XN51) = X'65' OR                       Á -> A
     C                             XT801(XN51) = X'67' OR                       $ -> A
     C                             XT801(XN51) = X'5B' OR                       Å -> A
     C                             XT801(XN51) = X'41' OR                       '41' -> '40'
     C                             XT801(XN51) = X'4D' OR                       '4D' -> u
     C                             XT801(XN51) = X'A1' OR                       ü -> u
     C                             XT801(XN51) = X'66' OR                       Ã -> A
     C                             XT801(XN51) = X'75' OR                       Í -> I
     C                             XT801(XN51) = X'8F' OR                       ± -> +/-
     C                             XT801(XN51) = X'FD' OR                       Ù -> U
     C                             XT801(XN51) = X'E1' OR                       ÷ -> O
     C                             XT801(XN51) = X'7C' OR                       Ø -> O
     C                             XT801(XN51) = X'EF' OR                       Õ -> O
     C                             XT801(XN51) = X'AD' OR                       Ý -> OE
     C                             XT801(XN51) = X'73' OR                       Ë -> E
     C                             XT801(XN51) = X'72' OR                       Ê -> E
     C                             XT801(XN51) = X'FE' OR                       Ú -> U
     C                             XT801(XN51) = X'3F' OR                       '3F' -> Blank
     C                             XT801(XN51) = X'BE' OR                       ´ -> blank
     C                             XT801(XN51) = X'45' OR                       á -> a
     C                             XT801(XN51) = X'59' OR                       ß -> S
     C                             XT801(XN51) = X'AF' OR                       ® -> Blank
     C                             XT801(XN51) = X'68' OR                       Ç -> Blank
     C                             XT801(XN51) = XAPS OR
     C                             XT801(XN51) = '<' OR
     C                             XT801(XN51) = '>'
     C                   IF        XN52 < XN53
     C                   ADD       1             XN52
     C                   SELECT
     C                   WHEN      XT801(XN51) = 'Å'                               4
     C                             OR XT801(XN51) = X'63'
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'AA'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'Ø'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'OE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'Æ'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'AE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'æ'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'ae'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'ø'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'oe'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = 'å'                               4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'aa'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'5A'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     '.'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'8E'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'OE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'B0'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'oe'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'B2'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'OE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'71'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'E'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'54'                             4
     C                             OR XT801(XN51) = X'74'
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'E'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'58'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'i'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'7D'                             4
     C                   IF        XN51 < XN56                                      5<-B
     C                   MOVEA     '&apos;'      XT802(XN52)
     C                   ADD       5             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'EC'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'O'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'90'                             4
     C                   IF        XN51 < XN56                                      5<-B
     C                   EVAL      XT802(XN52) = X'5F'
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'FC'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'U'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'CC'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'oe'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'43'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'aa'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'55'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'i'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'62'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'A'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'51'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'e'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'42'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'aa'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'CE'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'o'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'64' OR                          4
     C                             XT801(XN51) = X'65' OR
     C                             XT801(XN51) = X'66' OR
     C                             XT801(XN51) = X'67' OR
     C                             XT801(XN51) = X'5B'
     C                   IF        XT801(XN51) = X'66' AND XT801(XN51+1) = X'9D'    Ã¸ -> oe
     C                   MOVEA     'oe'          XT802(XN52)
     C                   ADD       1             XN51
     C                   ADD       1             XN52
     C                   ELSE
     C                   IF        XT801(XN51) = X'66' AND XT801(XN51+1) = X'70'    Ã¦-> ae
     C                   MOVEA     'ae'          XT802(XN52)
     C                   ADD       1             XN51
     C                   ADD       1             XN52
     C                   ELSE
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'A'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   END
     C                   END
     C                   WHEN      XT801(XN51) = X'41'                             4
     C                             OR XT801(XN51) = X'AF'
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     ' '           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'4D'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'u'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'A1'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'u'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'75'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'I'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'8F'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     '+/-'         XT802(XN52)
     C                   ADD       2             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'FD'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'U'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'E1'                             4
     C                             OR XT801(XN51) = X'7C'
     C                             OR XT801(XN51) = X'EF'
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'O'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'AD'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'OE'          XT802(XN52)
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'73'                             4
     C                             OR XT801(XN51) = X'72'
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'E'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'FE'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'U'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51)=X'66' AND XT801(XN51+1)=X'80'       4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'ae'          XT802(XN52)
     C                   ADD       1             XN51
     C                   ADD       1             XN52
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'3F'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     ' '           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'BE'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     ' '           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'45'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'a'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'59'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'S'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = X'68'                             4
     C                   IF        XN51 < XN55                                      5<-B
     C                   MOVEA     'C'           XT802(XN52)
     C                   ELSE                                                       5
     C                   SUB       1             XN52
     C                   END                                                        5<-E
     C                   WHEN      XT801(XN51) = '&'
     C                   IF        XN51 < XN55
     C                   MOVEA     '&amp;'       XT802(XN52)
     C                   ADD       4             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = '"'
     C                   IF        XN51 < 75
     C                   MOVEA     '&quot;'      XT802(XN52)
     C                   ADD       5             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = XAPS
     C                   IF        XN51 < XN56
     C                   MOVEA     '&apos;'      XT802(XN52)
     C                   ADD       5             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = '>'
     C                   IF        XN51 < XN54
     C                   MOVEA     '&gt;'        XT802(XN52)
     C                   ADD       3             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   WHEN      XT801(XN51) = '<'
     C                   IF        XN51 < XN54
     C                   MOVEA     '&lt;'        XT802(XN52)
     C                   ADD       3             XN52
     C                   ELSE
     C                   SUB       1             XN52
     C                   END
     C                   ENDSL
     C                   END
     C                   ELSE
     C                   IF        XN52 < XN53
     C                   ADD       1             XN52
     C                   MOVE      XT801(XN51)   XT802(XN52)
     C                   ELSE
     C                   LEAVE
     C                   END
     C                   END
     C                   ENDDO
      *
     C                   IF        XTXT802 = *BLANKS                            1<-B
     C                   EVAL      XTXT802 = '.'
     C                   END                                                    1<-E
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
      *  TEST OM VARELINJER HAR FORSKJELLIGE AVSENDER/MOTTAKER    /
      *////////////////////////////////////////////////////////////
     C     TSTPARTS      BEGSR
     C                   MOVE      'N'           X_ULIKAVS         1
     C                   MOVE      'N'           X_ULIKMOT         1
     C                   MOVE      'N'           X_ULIKACT         1
     C                   MOVE      'N'           X_HCI_AM          1
N06  C                   MOVE      *ZEROS        X_ANTHC           5 0
      *
     C     KEYD          SETLL     NCTSEC
     C     KEYD          READE(N)  NCTSEC                                 33
     C     *IN33         DOWEQ     '0'
N06  C                   ADD       1             X_ANTHC
     C     NCTSECK       CHAIN     NCTSECAM                           33
     C                   IF        *IN33
     C                   EVAL      TCNAS  = *BLANKS
     C                   EVAL      TCAD1S = *BLANKS
     C                   EVAL      TCNAK  = *BLANKS
     C                   EVAL      TCAD1K = *BLANKS
     C                   END
      *
     C                   IF        TCNAS <> *BLANKS AND
     C                             (THNAS <> TCNAS OR THAD1S <> TCAD1S)
     C                   MOVE      'J'           X_ULIKAVS
     C                   END
      *
     C                   IF        TCNAK <> *BLANKS AND
     C                             (THNAK <> TCNAK OR THAD1K <> TCAD1K)
     C                   MOVE      'J'           X_ULIKMOT
     C                   END
      *
     C                   IF        TCROLE <> *BLANKS AND
     C                             (THROLE <> TCROLE OR THIDR <> TCIDR)
     C                   MOVE      'J'           X_ULIKACT
     C                   END
      *
     C     KEYD          READE(N)  NCTSEC                                 33
     C  N33              ENDDO
N06  C                   IF        X_ANTHC =1
N06  C                   MOVE      'N'           X_ULIKAVS
N06  C                   MOVE      'N'           X_ULIKMOT
N06  C                   ENDIF
      *
     C     KEYD          SETLL     NCTSEIAM
     C     KEYD          READE     NCTSEIAM                               33
     C                   IF        *IN33 = *OFF
     C     *LIKE         DEFINE    TITINK        TITINK_G
     C     *LIKE         DEFINE    TINAK         TINAK_G
N02  C     *LIKE         DEFINE    TILKK         TILKK_G
     C                   EVAL      TITINK_G = TITINK
     C                   EVAL      TINAK_G  = TINAK
N02  C                   EVAL      TILKK_G  = TILKK
     C                   DOW       *IN33 = *OFF
S02  C*                  IF        TITINK_G <> TITINK OR TINAK_G <> TINAK
N02  C                   IF        TITINK_G <> TITINK OR TINAK_G <> TINAK
N02  C                             OR TILKK_G <> TILKK
      * Flere mottakere på Item-nivå.
     C                   MOVE      'J'           X_HCI_AM
     C                   LEAVE
     C                   END
     C     KEYD          READE     NCTSEIAM                               33
     C                   ENDDO
     C                   END
XXX01C*                  MOVE      'N'           X_HCI_AM
      *
     C                   ENDSR
      *
