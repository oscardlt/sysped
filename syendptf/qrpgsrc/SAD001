********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10244 * 01 YBC PTF10 VARENR ER UTVIDERT FRA 15A TIL 28A
      *              MYE ENDRING. INGEN MERKING
10286 * 02 YBC PTF10 VEKT ER ENDRET FRA 9.0 TIL 12.3
      *              VAREBESKRIVELSE ER ØKT FRA 15A TIL 30A
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
12103 * 03 YBC PTF12 Hent avgift fra avgiftsregister
********************************************************************
      *
      ***********************************************************
      *** PROGRAM FOR VEDLIKEHOLD I LEVERANDØRERS VARER       ***
      ***********************************************************
      *
     FSADVARE   UF A E           K DISK
N03  FSADSD     IF   E           K DISK
N03  FCUNDMAF   IF   E           K DISK
N03  FKODTS8    IF   E           K DISK
N03  FFIRM      IF   E           K DISK
     FSAD001FM  CF   E             WORKSTN
N03  D                 DS
N03  D  KS8FTX                 1     52
N03  D  KS8MIL                52     52
N03  D  KS8ØRE                51     51
N03  D                 DS
N03  D  W2AKD1                 1      2
N03  D  W2AKD2                 3      4
N03  D  W2AKD3                 5      6
N03  D  W2AKD4                 7      8
N03  D  W2AKD5                 9     10
N03  D  W2AKD6                11     12
N03  D  W2AKD7                13     14
N03  D  W2AKD8                15     16
N03  D  AKD                    1     16    DIM(8)
N03  D                 DS
N03  D  W2ASV1                 1      3
N03  D  W2ASV2                 4      6
N03  D  W2ASV3                 7      9
N03  D  W2ASV4                10     12
N03  D  W2ASV5                13     15
N03  D  W2ASV6                16     18
N03  D  W2ASV7                19     21
N03  D  W2ASV8                22     24
N03  D  ASV                    1     24    DIM(8)
      *
     C                   EXSR      INIT
      *
     C     ST            TAG
     C                   EXFMT     BILDE
     C   03              GOTO      SLUTT
N03   *
N03  C                   IF        UNYVARE = 'J'
N03  C                   MOVE      *IN33         XIN33             1
N03  C                   MOVE      W2VNTI        W2VNT
N03  C                   EXSR      SÆRAVG
N03  C                   MOVE      XIN33         *IN33
N03  C                   GOTO      ST
N03  C                   END
N03   *
     C   33              WRITE     SADVARER
     C  N33              UPDATE    SADVARER
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
      *
      *
N03   ******************************************
N03  C     SÆRAVG        BEGSR
N03   ******************************************
N03  C                   MOVE      *BLANKS       XXKDAÆ            2
N03  C                   MOVE      *BLANKS       XXKDSÆ            3
N03  C                   MOVE      *ZEROS        XXBLSÆ            7 2
N03  C                   MOVE      *BLANKS       XXAKTK            1
N03   *
N03  C     W2VNT         SETLL     SADSD
N03  C     STSA1         TAG
N03   * LES SÆRAVGIFTSFIL FOR Å SJEKKE OM MAN TRENGER LAGE SÆRAVGIFTER.
N03  C     W2VNT         READE     SADSD                                  33
N03  C                   DOW       *IN33 = *OFF
N03  C     SDDTF         IFLE      USIDT
N03  C     SDDTT         ANDGE     USIDT
N03  C                   LEAVE
N03  C                   END
N03  C     W2VNT         READE     SADSD                                  33
N03  C  N33              ENDDO
N03  C                   IF        *IN33 = *OFF
N03  C     SDAKTK        CABEQ     'I'           STSA1
N03  C     W2CRE1        CABEQ     'UTB'         STSA1
N03  C     W2CRE2        CABEQ     'UTB'         STSA1
N03  C     W2CRE3        CABEQ     'UTB'         STSA1
N03  C     W2CRE4        CABEQ     'UTB'         STSA1
N03  C     W2CRE5        CABEQ     'UTB'         STSA1
N03  C     STSA2         TAG
N03  C     KODTS8K       CHAIN     KODTS8                             33
N03  C  N33              IF        KS8MIL = 'J'
N03  C     CMAFK         CHAIN     CUNDMAF                            33
N03  C     *IN33         CABEQ     '1'           STSA1
N03  C                   END
N03   * FINN RIKTIG HAVNEKODE OG VF
N03   * FINN RIKTIG VERDIFASTSETTELSE
N03  C                   IF        SDVF <> *BLANKS AND SDVF <> W2VF
N03  C                   GOTO      STSA1
N03  C                   ENDIF                                                  <SDVF
N03   *
N03  C     XXKDAÆ        IFNE      *BLANKS
N03  C     XXKDAÆ        IFEQ      SDKDAÆ
N03  C     XXAKTK        OREQ      'V'
N03   * HVIS DET FINNES FLERE LINJER MED SAMME SÆRAVGIFT, BES BRUKER
N03   * TIL Å VELGE EN AV DEM.
N03  C                   MOVE      *BLANKS       XXKDSÆ
N03  C                   CALL      'SAD061D'
N03  C     W2VNT         PARM      W2VNT         UVNTS             8 0
N03  C                   PARM                    XXKDAÆ
N03  C                   PARM                    XXKDSÆ
N03  C                   PARM                    XXBLSÆ            7 2
N03  C                   PARM      USIDT         USIDT2            8 0
N03  C                   PARM                    FIFIRM
N03  C                   PARM      LEVENR        UKN               8 0
N03  C     XXKDSÆ        IFEQ      *BLANKS
N03  C                   MOVE      *BLANKS       XXKDAÆ
N03  C                   GOTO      SLSA
N03  C                   ELSE
N03  C                   IF        SDKDAÆ <> XXKDAÆ
N03  C                   EVAL      SDKDAÆ = XXKDAÆ
N03  C     SADS4K        SETLL     SADSD
N03  C                   END
N03  C                   ENDIF
N03  C     XXKDAÆ        IFNE      SDKDAÆ
N03  C     XXKDAÆ        ANDNE     *BLANKS
N03  C     XXAKTK        ANDNE     'V'
N03  C     SADS4K        SETLL     SADSD
N03  C                   MOVE      *BLANKS       XXKDAÆ
N03  C                   GOTO      STSA1
N03  C                   END
N03  C                   ENDIF
N03   * KOM HIT, HAR BRUKER FÅTT EN SPESIFSERT SÆRAVGIFT MED KODE,
N03   * SEKVENS OG SATS. KALLE "SÆRAV2" FOR Å BEREGNE GR.LAG OG BELØP
N03   * OG OPPDATERE SAD-FIL
N03  C                   EXSR      SÆRAV2
N03   * LES FORBI ALLE LINJER MED SAMME SÆRAVGIFTSKODE INNTIL NESTE
N03   * SÆRAVGIFT
N03  C                   IF        XXKDAÆ > SDKDAÆ
N03  C                   MOVE      XXKDAÆ        SDKDAÆ
N03  C     SADS4K        SETLL     SADSD
N03  C                   END
N03  C  N33XXKDAÆ        DOWEQ     SDKDAÆ
N03  C     STSA3         TAG
N03  C     W2VNT         READE     SADSD                                  33
N03  C     *IN33         DOWEQ     '0'
N03  C     SDDTF         IFLE      USIDT
N03  C     SDDTT         ANDGE     USIDT
N03  C                   LEAVE
N03  C                   END
N03  C     W2VNT         READE     SADSD                                  33
N03  C  N33              ENDDO
N03  C  N33SDAKTK        CABEQ     'I'           STSA3
N03  C  N33W2CRE1        CABEQ     'UTB'         STSA3
N03  C  N33W2CRE2        CABEQ     'UTB'         STSA3
N03  C  N33W2CRE3        CABEQ     'UTB'         STSA3
N03  C  N33W2CRE4        CABEQ     'UTB'         STSA3
N03  C  N33W2CRE5        CABEQ     'UTB'         STSA3
N03  C  N33              ENDDO
N03  C                   MOVE      *BLANKS       XXKDAÆ
N03  C   33              GOTO      SLSA
N03  C                   MOVE      *BLANKS       XXKDSÆ
N03  C                   MOVE      *BLANKS       XXAKTK
N03  C                   GOTO      STSA2
N03  C                   ENDIF
N03   *
N03   * BEVARE INNLESTE SÆRAVGIFTSKODE/SEKVENS/SATS
N03  C                   MOVE      SDKDAÆ        XXKDAÆ
N03  C                   MOVE      SDKDSÆ        XXKDSÆ
N03  C                   MOVE      SDBLSÆ        XXBLSÆ
N03  C                   MOVE      SDAKTK        XXAKTK
N03  C                   GOTO      STSA1
N03  C                   ENDIF
N03   *
N03  C     SLSA          TAG
N03   * HVIS XXKDAÆ<>BLANK --> SISTE LINJE MED SÆRAVGIFT ER LEST.
N03  C     XXKDAÆ        IFNE      *BLANKS
N03  C     XXAKTK        IFEQ      'V'
N03  C                   CALL      'SAD061D'
N03  C     W2VNT         PARM      W2VNT         UVNTS             8 0
N03  C                   PARM                    XXKDAÆ
N03  C                   PARM                    XXKDSÆ
N03  C                   PARM                    XXBLSÆ            7 2
N03  C                   PARM      USIDT         USIDT2            8 0
N03  C                   PARM                    FIFIRM
N03  C                   PARM      LEVENR        UKN               8 0
N03  C                   ENDIF
N03  C     XXKDSÆ        IFNE      *BLANKS
N03  C                   EXSR      SÆRAV2
N03  C                   ENDIF
N03  C                   ENDIF
N03   *
N03  C                   MOVE      'N'           UNYVARE
N03   *
N03  C                   ENDSR
N03   *
N03   ******************************************
N03  C     SÆRAV2        BEGSR
N03   ******************************************
N03  C     1             DO        8             XN                3 0
N03  C     AKD(XN)       IFEQ      *BLANKS
N03  C                   LEAVE
N03  C                   END
N03  C                   END
N03  C     XN            CABGT     8             SLSÆR2
N03   *
N03  C                   MOVE      XXKDAÆ        AKD(XN)
N03  C                   MOVE      XXKDSÆ        ASV(XN)
N03   *
N03  C     SLSÆR2        TAG
N03  C                   MOVE      '0'           *IN33
N03  C                   ENDSR
N03   *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     KEYVAR        KLIST
     C                   KFLD                    LEVENR
     C                   KFLD                    VARENR
N03  C     SADS4K        KLIST
N03  C                   KFLD                    W2VNT
N03  C                   KFLD                    XXKDAÆ
N03  C     CMAFK         KLIST
N03  C                   KFLD                    FIFIRM
N03  C                   KFLD                    LEVENR
N03  C                   KFLD                    SDKDAÆ
N03  C     KODTS8K       KLIST
N03  C                   KFLD                    KS8AVG
N03  C                   KFLD                    KS8SKV
      *
     C     *ENTRY        PLIST
     C                   PARM                    ULEVE             8 0
     C                   PARM                    UVAREN           28
     C                   PARM                    UVAREB           50
N03  C                   PARM                    UNYVARE           1
      *
     C                   MOVE      ULEVE         LEVENR
     C                   MOVE      UVAREN        VARENR
N03  C                   MOVEA     *BLANKS       AKD
N03  C                   MOVEA     *BLANKS       ASV
N03  C                   CALL      'SYGE15C'
N03  C                   PARM                    WDT               8
N03  C                   PARM                    WTM               6
N03  C                   MOVE      WDT           USIDT             8 0
      *
N03  C     *LOVAL        SETLL     FIRM
N03  C                   READ      FIRM                                   33
     C     KEYVAR        CHAIN     SADVARE                            33
      *
     C                   MOVE      UVAREB        VAREBE
     C                   ENDSR
