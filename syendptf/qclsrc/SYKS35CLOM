/*  TESTER OM BILAG I LØSNING 1  */
             PGM
             DCL        VAR(&FAKO) TYPE(*CHAR) LEN(1) VALUE('K')
             DCL        VAR(&NRBE) TYPE(*DEC) LEN(3 0) VALUE(110)
             DCL        VAR(&PRT110) TYPE(*CHAR) LEN(10) /* Printernavn+
                          til JOURNALEN  */
             DCL        VAR(&PT110) TYPE(*CHAR) LEN(10) /* Papirtype +
                          til JOURNALEN */
             DCL        VAR(&BILL1) TYPE(*CHAR) LEN(1)
             DCL        VAR(&FIRMA) TYPE(*CHAR) LEN(2)
             DCL        VAR(&AAR) TYPE(*CHAR) LEN(4)
             DCL        VAR(&PER) TYPE(*CHAR) LEN(2)
             DCL        VAR(&PRTF) TYPE(*CHAR) LEN(10) +
                          VALUE('SYKS35P   ')
             DCL        VAR(&JANEI) TYPE(*CHAR) LEN(1) VALUE('N')
             DCL        VAR(&IN01) TYPE(*CHAR) LEN(1) VALUE('0')
             DCL        VAR(&WS) TYPE(*CHAR) LEN(10) /* ARB.STASJ*/
             DCL        VAR(&FLAGG) TYPE(*CHAR) LEN(1) VALUE('O')
                        /*"O"=OMKJ:IKKE OPPDATER FAKT.LINJER/STATIST?*/
/*______________*/
/* LES FIRMAFIL */
/*""""""""""""""*/
             DCLF       FILE(FIRML1) RCDFMT(*ALL)
             RCVF       DEV(*FILE) RCDFMT(*FILE)
/*                      */
             RTVJOBA    JOB(&WS) /* Hente arbeidstsjonskode WS */
/*           CALL       PGM(INLIBL)   */


/*********************************************************************/
/* SKJEKKER FILLAG I LØSNING 1                                       */
/*********************************************************************/
             RTVDTAARA  DTAARA(EDIDTA (193 1)) RTNVAR(&BILL1)
             IF         COND(&BILL1 = 'Y') THEN(DO)
             CALL       PGM(HR900SY) PARM(&BILL1)
             IF         COND(&BILL1 = 'J') THEN(DO)
             RETURN
             ENDDO
             ENDDO
/**********************************************************************/
             ALCOBJ     OBJ((SYFA35CL *PGM *EXCL) (SYKS35CL *PGM +
                          *EXCL) (SYFA39 *PGM *EXCL))
             MONMSG     MSGID(CPF0000) EXEC(DO)
             SNDBRKMSG  MSG('En annen kjører overføring til regnskap +
                          eller oppdatering på statistikk  - prøv +
                          igjen senere') TOMSGQ(&WS)
             GOTO       CMDLBL(SLUTT)
             ENDDO
             CALL       PGM(SYFAFICL) PARM(&IN01)
             IF         COND(&IN01 *EQ '1') THEN(DO)
             SNDBRKMSG  MSG('Du er ikke registrert som bruker i +
                          økonomisystemet - overføringen er +
                          avbrutt.') TOMSGQ(&WS)
             GOTO       CMDLBL(SLUTT)
             ENDDO
/* FJERN MEMBER FRA ARBEIDSFIL */
             RMVM       FILE(KOSAL01) MBR(&WS)
             MONMSG     MSGID(CPF0000)
             RMVM       FILE(KOSAL02) MBR(&WS)
             MONMSG     MSGID(CPF0000)
             RMVM       FILE(KOSAF) MBR(&WS)
             MONMSG     MSGID(CPF0000)
             RMVM       FILE(KOSBL01) MBR(&WS)
             MONMSG     MSGID(CPF0000)
             RMVM       FILE(KOSBL02) MBR(&WS)
             MONMSG     MSGID(CPF0000)
             RMVM       FILE(KOSBF) MBR(&WS)
             MONMSG     MSGID(CPF0000)
/* LEGG TIL NYTT MEMBER TIL ARBEIDSFIL(FÅR DATO) */
             ADDPFM     FILE(KOSAF) MBR(&WS)
             ADDPFM     FILE(KOSBF) MBR(&WS)
             ADDLFM     FILE(KOSAL01) MBR(&WS) DTAMBRS((KOSAF (&WS)))
             ADDLFM     FILE(KOSAL02) MBR(&WS) DTAMBRS((KOSAF (&WS)))
             ADDLFM     FILE(KOSBL01) MBR(&WS) DTAMBRS((KOSBF (&WS)))
             ADDLFM     FILE(KOSBL02) MBR(&WS) DTAMBRS((KOSBF (&WS)))
/* OVERRIDE FILE TIL MEMBER (=DSPSTN NAVN.) */
             OVRDBF     FILE(KOSAF) TOFILE(KOSAF) MBR(&WS)
             OVRDBF     FILE(KOSAL01) TOFILE(KOSAL01) MBR(&WS)
             OVRDBF     FILE(KOSAL02) TOFILE(KOSAL02) MBR(&WS) +
                          FRCRATIO(1) /* N01 */
             OVRDBF     FILE(KOSBF) TOFILE(KOSBF) MBR(&WS)
             OVRDBF     FILE(KOSBL01) TOFILE(KOSBL01) MBR(&WS)
             OVRDBF     FILE(KOSBL02) TOFILE(KOSBL02) MBR(&WS) +
                          FRCRATIO(1) /* N01 */
/* */
/* OVERSTYRER SKRIVERFIL                          */
/* */
             CALL       PGM(GETPRTB) PARM(&NRBE &PRT110 &PT110)
             OVRPRTF    FILE(&PRTF) OUTQ(&PRT110) PAGESIZE(48 132) +
                          CPI(10) OVRFLW(48) +
                          FORMTYPE(&PT110)
/* */
/* */
/* KALLER SYFA35 FOR Å OPPDATERE POSTERINGER      */
/* */
/*                                                */
/* HAR KUNDEN ARKIVSYSTEM ???                     */
/*                                                */
             CALL       PGM(ARC016) PARM(&JANEI)
             IF         COND(&JANEI = 'J') THEN(DO)
             OVRPRTF    FILE(&PRTF) OUTQ(SYARKIV) HOLD(*YES)
             ENDDO

    /* */
             CALL       PGM(SYKS35) PARM(&FLAGG &L1KJOR)
             CALL       PGM(SYKS35F) PARM(&L1KJOR)
/* INGENTING Å OVERFØRE - HOPP UT */
             IF         COND(&FLAGG *EQ '1') THEN(DO)
             SNDBRKMSG  MSG('Det finnes ingen poster i +
                          posteringsfilen til økonomi - overføring +
                          avbrytes') TOMSGQ(&WS)
             GOTO       CMDLBL(SLUTT)
             ENDDO
/*                                                */
/* OPPDATERER ARKIV                               */
/*                                                */
             IF         COND(&JANEI = 'J') THEN(DO)
             RTVDTAARA  DTAARA(*LDA (1 2)) RTNVAR(&FIRMA)
             ADDLIBLE   LIB(IBMENDA)
             MONMSG     MSGID(CPF0000)
             CALL PGM(ARK001CL) PARM(&FIRMA &PRTF +
                          &AAR &PER)
             RMVLIBLE   LIB(IBMENDA)
             ENDDO
/* */
/* KALLER V005NY FOR Å OPPDATERE NATIVE ØKONOMI   */
/* */
             DLTOVR     FILE(*ALL)
             CHGDTAARA  DTAARA(*LDA (1 1024)) VALUE('                 -
             ')
             IF         COND(&L1KJOR = 'J') THEN(DO)
             CALL       PGM(VC005KS) PARM(&WS)
             CALL       PGM(INLIBL)
             ENDDO
/* FJERN EVT. GAMMELT MEMBER FRA KOPI/BACKUPFILER */
             RMVM       FILE(BACKKSA) MBR(&WS)
             MONMSG     MSGID(CPF0000)
             RMVM       FILE(BACKKSB) MBR(&WS)
             MONMSG     MSGID(CPF0000)
/* KOPIER INN OVERFØRT MEMBER TIL  BACKUPFILER */
             CPYF       FROMFILE(KOSAF) TOFILE(BACKKSA) FROMMBR(&WS) +
                          TOMBR(&WS) MBROPT(*ADD) FMTOPT(*MAP *DROP)
             CPYF       FROMFILE(KOSBF) TOFILE(BACKKSB) FROMMBR(&WS) +
                          TOMBR(&WS) MBROPT(*ADD) FMTOPT(*MAP *DROP)
/*                                             */
/* VISMA.NET TILPASSING                        */
/*                                             */
             IF         COND(&L1KJOR = 'V') THEN(DO)
             RMVM       FILE(VISTRAKOS) MBR(&WS)
             MONMSG     MSGID(CPF0000)
             RMVM       FILE(VISTRAHOV) MBR(&WS)
             MONMSG     MSGID(CPF0000)
             CPYF       FROMFILE(BACKKSB) TOFILE(VISTRAKOS) +
                          FROMMBR(&WS) TOMBR(&WS) MBROPT(*REPLACE) +
                          INCREL((*IF OPKDPO *NE 'J')) FMTOPT(*MAP +
                          *DROP)
             MONMSG     MSGID(CPF2817)
             CPYF       FROMFILE(BACKKSB) TOFILE(VISTRAHOV) +
                          FROMMBR(&WS) TOMBR(&WS) MBROPT(*REPLACE) +
                          INCREL((*IF OPKDPO *EQ 'J')) FMTOPT(*MAP +
                          *DROP)
             MONMSG     MSGID(CPF2817)
             CALL       PGM(VISM35CL) PARM(&FAKO &WS)
             ENDDO
/* FJERN MEMBER FRA ARBEIDSFIL */
             RMVM       FILE(KOSAL01) MBR(&WS)
             MONMSG     MSGID(CPF0000)
             RMVM       FILE(KOSAL02) MBR(&WS)
             MONMSG     MSGID(CPF0000)
             RMVM       FILE(KOSAF) MBR(&WS)
             MONMSG     MSGID(CPF0000)
             RMVM       FILE(KOSBL01) MBR(&WS)
             MONMSG     MSGID(CPF0000)
             RMVM       FILE(KOSBL02) MBR(&WS)
             MONMSG     MSGID(CPF0000)
             RMVM       FILE(KOSBF) MBR(&WS)
             MONMSG     MSGID(CPF0000)
/* GJENOPPRETT LDA FRA FØR KJØRINGEN */
             CHGDTAARA  DTAARA(*LDA (1 1024)) VALUE('                 -
             ')
/* */
             SNDPGMMSG  MSG('Utskrift av dagbok er sendt i jobkø +
                          QBATCH i bibliotek QGPL')

             IF         COND(&JANEI = 'J') THEN(DO)
             SIGNOFF    LOG(*LIST)
             ENDDO
SLUTT:       DLCOBJ     OBJ((SYFA35CL *PGM *EXCL) (SYKS35CL *PGM +
                          *EXCL) (SYFA39 *PGM *EXCL))

             ENDPGM
