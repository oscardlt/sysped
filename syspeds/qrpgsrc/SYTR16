********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10154 * 01 SH  KODE WSFU IJKKE FAKTURERING ..
********************************************************************
      *
      **************************************************************
      *** PROGRAM FOR SPØRRING/PLUKKING AV FERJE OVERFARTER      ***
      *****************************************************************
     FKOSBU     UF A E           K DISK
     FTUFE      IF A E           K DISK
     FTUFE2     IF A E           K DISK
     F                                     RENAME(TUFER:TUFE2R)
     FTURER     UF   E           K DISK
     FFERJL01   IF   E           K DISK
     FLEVEL01   IF   E           K DISK
     FKOSTT     UF A E           K DISK
     FFIRM      IF   E           K DISK
     FSYTR16FM  CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  WSDATE                 1      6  0
     D  WSDAY                  1      2  0
     D  WSMONT                 3      4  0
     D  WSYEAR                 5      6  0
     D                 DS
     D  FENY                   1     18
     D  FEFIRM                 1      8  0
     D  FEFROM                 9     13
     D  FETO                  14     18
     D                 DS
     D  YEDATE                 1      8  0
     D  YEYEAR                 1      4  0
     D  YEMONT                 5      6  0
     D  YEDAY                  7      8  0
     D                 DS
     D  FEDATE                 1      8  0
     D  FEYEAR                 1      4  0
     D  FEMONT                 5      6  0
     D  FEDAY                  7      8  0
     D                 DS
     D  DSTXT                  1     35
     D  DSFROM                 9     13
     D  DSTO                  15     19
     D  DSDATE                21     26
     D  DSTIME                28     31
     D*
     D                UDS
     D  UUSIGN                19     21
     C*
     C     STINI         TAG
     C                   EXSR      INIT
     C                   MOVEA     '0100'        *IN(91)
     C                   WRITE     SUBCTL
     C                   MOVEA     '0000'        *IN(91)
     C                   GOTO      START6
     C*
     C*** AVSLUTT
     C   03              GOTO      SLUTT
     C*
     C*
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
     C                   MOVE      W2FROM        YSFROM
     C                   MOVE      W2TO          YSTO
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C     KODSI1        SETLL     FERJL01
     C     START1        TAG
     C                   READ      FERJL01                                94
     C  N94              MOVE      FEFROM        YSFROM
     C  N94              MOVE      FETO          YSTO
     C  N94              MOVE      FELENG        YSLENG
     C  N94              MOVE      FEFIRM        YSFIRM
     C  N94              MOVE      FEDATE        YSDATE
     C  N94              MOVE      FEFIRM        YSFIRM
     C  N94              MOVE      FEFIRM        WSFIRM
     C  N94KONEST        SETLL     FERJL01
      *
     C     START2        TAG
      *
     C  N94              DO
     C                   MOVE      FETIME        WSTIME
     C                   MOVE      FEFIRM        WSFIRM
     C                   DO        28
     C                   ADD       1             ZRECNO
     C     LEVEK         CHAIN     LEVEL01                            33
     C  N33              MOVEL     LNAVN         FENAME
     C                   MOVE      *ZEROS        WSDATE
     C                   WRITE     SUBFIL
     C*
     C* VED 55 LES NESTE FERJESTREKNING MED PRIS
     C*
     C                   READ      FERJL01                                94
     C  N94              MOVE      FEFROM        YSFROM
     C  N94              MOVE      FETO          YSTO
     C  N94              MOVE      FELENG        YSLENG
     C  N94              MOVE      FEDATE        YSDATE
     C  N94              MOVE      FEFIRM        YSFIRM
     C  N94              MOVE      FEFIRM        WSFIRM
     C  N94              MOVE      FETIME        WSTIME
     C  N94KONEST        SETLL     FERJL01
     C*
     C*
     C*
     C  N94              END
     C                   END
     C*
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   Z-ADD     1             ZRECNX
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C                   WRITE     SUBCTL
     C                   EXFMT     BUNN
     C*
     C***
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   END
     C***
     C*
     C                   SETOFF                                       989975
     C*
     C*** AVSLUTT
     C   03              GOTO      SLUTT
     C*
     C*** FRISK OPP
     C   05              GOTO      START
     C* LAGE NY
     C   06              DO
     C                   CALL      'SYTR01'
     C                   GOTO      START
     C                   END
     C*
     C*** SØK FRA
     C   08              GOTO      START6
     C*
     C*** BLA VIDERE
     C   25              DO
     C                   SETOFF                                       25
     C                   Z-ADD     YRECNO        ZRECNO            5 0
     C*          KODSI3    SETLLFERJL01
     C                   READ      FERJL01                                94
     C                   MOVE      FEFIRM        WSFIRM
     C                   GOTO      START2
     C                   END
     C*
     C     ZRECNO        IFNE      0
     C                   EXSR      HENT
     C                   END
     C   98XRECNO        IFNE      0
     C                   Z-ADD     XRECNO        ZRECNO
     C                   END
     C                   GOTO      START3
     C*
     C*
     C*** SØK FRA
     C     START6        TAG
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     04            POSNBR
     C                   EXFMT     VAREL2
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     2             POSNBR
     C   12              GOTO      SLUTT
     C*******              MOVE *BLANKS   YSLENG
     C                   MOVE      *BLANKS       YSFIRM
     C                   GOTO      START
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C***********************************************
     C     HENT          BEGSR
     C***********************************************
     C                   Z-ADD     0             LINNBR
     C                   SETOFF                                       919299
     C                   SETOFF                                       9830
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C*
     C   98              DO
     C   99              SETOFF                                       98
     C                   Z-ADD     1             LINNBR
     C                   GOTO      SLHENT
     C                   END
     C*
     C     ZRECNO        DIV       14            LINNBR
     C                   MVR                     XLIN              2 0
     C     XLIN          IFEQ      0
     C                   Z-ADD     14            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C                   Z-ADD     ZRECNO        ZRECNX
     C*
     C* STARTER TESTING
     C*
     C     WSNR          IFEQ      '1'                                          PLUKK
     C                   MOVE      ' '           WSNR
     C     WSTIME        COMP      *ZEROS                                 75
     C  N75WSDATE        COMP      *ZEROS                                 75
     C   75              MOVE      'DIV4017'     MSGNR
     C   75              SETON                                        30
     C   75              GOTO      SLHENT
     C* HVIS IKKE FEIL OPPDATER
     C                   EXSR      CHGSI
     C* INGEN OPTION VED 98
     C   98              MOVE      'DIV0012'     MSGNR
     C   98              SETON                                        30
     C   98              GOTO      SLHENT
     C                   END
     C                   END
     C*
     C     SLHENT        TAG
     C                   ADD       5             LINNBR
     C                   Z-ADD     2             POSNBR
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     CHGSI         BEGSR
     C***********************************************
     C                   MOVE      WSDAY         YEDAY
     C                   MOVE      WSMONT        YEMONT
     C     WSYEAR        IFGE      50
     C     WSYEAR        ADD       1900          YEYEAR
     C                   ELSE
     C     WSYEAR        ADD       2000          YEYEAR
     C                   END
     C     KODATO        SETGT     FERJL01
     C                   READP     FERJL01                                70
     C                   SETON                                        99
     C                   SETOFF                                       30
     C* VED "DIVERSEFERGER" UTENOM TUR BRUK  KEY VED CHAIN
     C* SOM INNEHOLDER AVGANGSDATO/BILNR
     C     FEAVD         IFNE      *ZEROS
     C     TUFEK         CHAIN     TUFE                               70
     C                   ELSE
     C     TUFE2K        CHAIN     TUFE2                              70
     C                   END
     C  N70              MOVE      'DIV4027'     MSGNR
     C  N70              SETON                                        30
     C  N70              UPDATE    SUBFIL
     C   70              Z-ADD     0             FETREF
     C   70              MOVE      *BLANKS       FENAME
     C   70              MOVEL     '*PLUKK*'     FENAME
     C   70              MOVE      ' '           WSNR
     C   70              UPDATE    SUBFIL
     C   70              MOVE      YEDATE        FEDAT2
     C   70              MOVE      WSFIRM        FEFIRM
     C   70              EXSR      KOST
     C   70              MOVE      TURUND        FERUND
     C   70              MOVE      WSTIME        FETIME
     C   70              MOVE      TUBILN        FEBILN
     C   70FEAVD         IFNE      *ZEROS
     C                   WRITE     TUFER
     C     TUTST5        IFNE      ' '
     C     TURKEY        CHAIN     TURER                              33
     C  N33              MOVE      ' '           TUTST5
     C  N33              UPDATE    TURERR
     C                   END
     C                   ELSE
     C                   WRITE     TUFE2R
     C                   END
     C     XLIN          IFEQ      0
     C                   Z-ADD     14            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
     C*
     C                   ENDSR
     C*
     C*
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    FEAVD
     C                   PARM                    FETUR
     C                   PARM                    UURUND            8 0
     C     *LIKE         DEFINE    FEFROM        YSFROM
     C     *LIKE         DEFINE    FETO          YSTO
     C     *LIKE         DEFINE    FELENG        YSLENG
     C     *LIKE         DEFINE    FEDATE        YSDATE
     C     *LIKE         DEFINE    FEFIRM        YSFIRM
     C     KODSI1        KLIST
     C                   KFLD                    W2FROM
     C                   KFLD                    W2TO
     C                   KFLD                    W2LEN
     C     KODATO        KLIST
     C                   KFLD                    FEFROM
     C                   KFLD                    FETO
     C                   KFLD                    FELENG
     C                   KFLD                    WSFIRM
     C                   KFLD                    WSTIME
     C                   KFLD                    YEDATE
     C     KONEST        KLIST
     C                   KFLD                    FEFROM
     C                   KFLD                    FETO
     C                   KFLD                    FELENG
     C                   KFLD                    FEFIRM
     C                   KFLD                    FETIME
     C                   KFLD                    MADATE
     C     TUFEK         KLIST
     C                   KFLD                    FEAVD
     C                   KFLD                    FETUR
     C                   KFLD                    FEFROM
     C                   KFLD                    FETO
     C* VED "DIVERSEFERGER" UTENOM TUR BRUK KEY SOM INNEHOLDER AVG.DATO
     C* OG BILNR
     C     TUFE2K        KLIST
     C                   KFLD                    FEOPKO
     C                   KFLD                    FEAVD
     C                   KFLD                    FETUR
     C                   KFLD                    YEDATE
     C                   KFLD                    FEFROM
     C                   KFLD                    FETO
     C                   KFLD                    TUBILN
     C     TURKEY        KLIST
     C                   KFLD                    FEAVD
     C                   KFLD                    FETUR
     C     KODSI3        KLIST
     C                   KFLD                    YSFROM
     C                   KFLD                    YSTO
     C                   KFLD                    YSLENG
     C                   KFLD                    YSFIRM
     C                   KFLD                    YSDATE
     C*
     C     LEVEK         KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    FEFIRM
     C                   READ      FIRM                                   33
     C                   MOVE      *ZEROS        WSDATE
     C                   MOVEL     '*FERJE*'     DSTXT
     C                   Z-ADD     99999999      MADATE            8 0
     C*
     C     TURKEY        CHAIN(N)  TURER                              33
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KOST          BEGSR
     C***********************************************
     C*
     C                   Z-ADD     FETREF        KTNR
     C*
     C* TILDELER REFNUMMER
     C*
     C     KTNR          CHAIN     KOSBU                              34
     C  N34              UPDATE    KOSBUR
     C   34              MOVE      *ZEROS        FETREF
     C     FETREF        IFEQ      *ZEROS
     C     'Å'           CHAIN     KOSTT                              34
     C   34              Z-ADD     1000000       KTNR
     C   34              WRITE     KOSTTR
     C  N34              ADD       1             KTNR
     C  N34              UPDATE    KOSTTR
     C                   END
     C*
     C     KTNR          CHAIN     KOSBU                              34
     C   34              MOVE      ' '           BUST
     C     BUST          IFEQ      ' '
     C                   MOVE      KTNR          BUBNR
     C                   MOVE      TURACC        BUPCC
     C                   MOVE      TURAAR        BUPÅR
     C                   MOVE      TURMND        BUPMN
     C                   MOVE      *ZEROS        BUTNR
     C                   MOVE      FEFIRM        BULNR
     C                   MOVE      FECURR        BUVAL
     C                   Z-ADD     FEPRI1        BUBL
     C* DETTE ER NOE MIDLERTIDIG - BØR ERSTATTES AV "FERJEGEBYRKODE"
     C* KNYTTET TIL BILKODE (NYTT FELT I BILKODEREGISTER)
     C                   MOVE      'FER'         BUVK
     C     TUBILK        IFNE      *BLANKS
     C                   MOVE      TUBILK        XBILK             1
     C                   MOVE      XBILK         BUVK
     C                   END
     C                   MOVE      UUSIGN        BUSG
     C                   MOVE      FEAVD         BUTAVD
     C                   MOVE      FETUR         BUTUNR
     C                   MOVE      *ZEROS        BUOAVD
     C                   MOVE      *ZEROS        BUOPD
     C                   MOVE      'E'           BUBLST
     C                   MOVE      'E'           BUTYPE
     C                   MOVE      *BLANKS       BUTXT
     C                   MOVE      FEFROM        DSFROM
     C                   MOVE      FETO          DSTO
     C                   MOVE      WSDATE        DSDATE
     C                   MOVE      FETIME        DSTIME
     C                   MOVEL     DSTXT         BUTXT
     C                   MOVE      TUBILK        BUBILK
     C                   MOVE      TUBILN        BUBILN
     C                   MOVE      FEDAT2        BUFEDT
     C                   MOVE      'F'           BUFER
     C                   MOVE      *ZEROS        BUBNR2                         *FØRT BNR
     C                   MOVE      *ZEROS        BUBNR3                         *"SLAVE" AV.
     C                   MOVE      *ZEROS        BULNR3                         SLAVE-LØPENR
     C                   MOVE      *ZEROS        BUBLFD                         *FORDELT BEL
     C                   END
N01  C     WSFAJN        IFEQ      'N'
N01  C                   MOVE      'FEI'         BUVK
N01  C                   END
     C   34              WRITE     KOSBUR
     C  N34              UPDATE    KOSBUR
     C                   MOVE      KTNR          FETREF
     C                   ENDSR
