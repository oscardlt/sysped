/* *********************************************************************   */
/*       * RETTINGER I DETTE PROGRAM:                                      */
/* PTFnr:*Sek Sig Vers  Beskrivelse..........................              */
/* """"""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""    */
/* 12XXX * 01 YBC PTF12 STMFCODPAG                                         */
/* ********************************************************************    */
/* FLYTTER TIL IFSFIL          */
             PGM        PARM(&FILE &MBR &IFS)
             DCL        VAR(&FILE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&NBR) TYPE(*DEC) LEN(6) VALUE(0)
             DCL        VAR(&NBR2) TYPE(*DEC) LEN(6) VALUE(0)
             DCL        VAR(&MBR) TYPE(*CHAR) LEN(10)
             DCL        VAR(&IFS) TYPE(*CHAR) LEN(70)
             DCL        VAR(&TMPF10) TYPE(*CHAR) LEN(10)
             DCL        VAR(&TMPFIL) TYPE(*CHAR) LEN(7)
             DCL        VAR(&QNBR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&QUSER) TYPE(*CHAR) LEN(10)
             RTVJOBA    USER(&QUSER) NBR(&QNBR)
/*                         */
/* UNIKE FILNAVN           */
/*                         */
             CHGVAR     VAR(&TMPFIL) VALUE('W' *CAT &QNBR)
/*                                                */
/* START SEMIKOLON-SEPARERT                       */
/*                                                */
/*                        */
/* KJØR QUERYIER UANSETT  */
/*                        */
             RUNQRY     QRY(*NONE) QRYFILE((&FILE &MBR)) +
                          OUTTYPE(*OUTFILE) RCDSLT(*NO) +
                          OUTFILE(QTEMP/&TMPFIL *FIRST *RPLFILE) +
                          AUT(*ALL)
             CPYTOIMPF  FROMFILE(QTEMP/&TMPFIL) TOSTMF(&IFS) +
                          MBROPT(*REPLACE) STMFCODPAG(*PCASCII) +
                          RCDDLM(*CRLF) FLDDLM(';') DECPNT(*COMMA)
             CHGVAR     VAR(&TMPF10) VALUE(&TMPFIL)
             CALL       PGM(SYGE28CL) PARM(&TMPF10)
/*                                                */
/*                                                */
/* START SEMIKOLON-SEPARERT                       */
/*                                                */
/* DLY 5 GRUNNET MIMIX */
             DLYJOB     DLY(5)
NY:          CPYTOIMPF  FROMFILE(TMP4096) TOSTMF(&IFS) +
                          MBROPT(*REPLACE) STMFCODPAG(*PCASCII) +
                          RCDDLM(*CRLF) STRDLM(*NONE) FLDDLM(';') +
                          DECPNT(*COMMA)
/* PROBLEM MED FILSYSTEMET  */
/* PRØV 10 GANGER           */
             MONMSG     MSGID(CPF2817) EXEC(DO)
             IF         COND(&NBR *LE 10) THEN(DO)
             DLYJOB     DLY(10)
             CHGVAR     VAR(&NBR) VALUE(&NBR + 1)
             GOTO       CMDLBL(NY)
             ENDDO
             ENDDO


/*E01   STMFCODPAG(*STMF) ENDRES TIL STMFCODPAG(*PCASCII) */
NY2:         CPYTOIMPF  FROMFILE(&TMPFIL) TOSTMF(&IFS) +
                          MBROPT(*ADD) STMFCODPAG(*PCASCII) +
                          RCDDLM(*CRLF) FLDDLM(';') DECPNT(*COMMA)
/* PROBLEM MED FILSYSTEMET  */
/* PRØV 10 GANGER           */
             MONMSG     MSGID(CPF2817) EXEC(DO)
             IF         COND(&NBR2 *LE 10) THEN(DO)
             DLYJOB     DLY(10)
             CHGVAR     VAR(&NBR2) VALUE(&NBR2 + 1)
             GOTO       CMDLBL(NY2)
             ENDDO
             ENDDO
             CHGAUT     OBJ(&IFS) USER(*PUBLIC) DTAAUT(*RWX) +
                          OBJAUT(*ALL)
             MONMSG     MSGID(CPF0000)
 SLUTT:      ENDPGM
