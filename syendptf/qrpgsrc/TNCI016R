********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 CB  PTF12  NCTS5
********************************************************************
      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/TNCI016R MODULE(*LIBL/TNCI016R *LIBL/INCGI)
CRTPGM*        ACTGRP(*NEW) AUT(*USE)
      *
      *********************************************************************
      /copy SYSPEDS/qrpgsrcpy,hspecs
      /copy SYSPEDS/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
     FSVNL      IF   E           K DISK    USROPN
     FSVNLCN    IF   E           K DISK    USROPN
     FSVNLDK    IF   E           K DISK    USROPN
     FSVNLKL    IF   E           K DISK    USROPN
     FSVNLMN    IF   E           K DISK    USROPN
     FSVNLPK    IF   E           K DISK    USROPN
     FSVNLVT    IF   E           K DISK    USROPN
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy SYSPEDS/qrpgsrcpy,prototypeb
      /copy SYSPEDS/qrpgsrcpy,usec
      /copy SYSPEDS/qrpgsrcpy,variables3
      *
      * Varible for
     D WSUSER          S             10
     D TVAVD_A         S              4
     D TVAVD           S              4  0
     D TVTDN_A         S              7
     D TVTDN           S              7  0
     D TVLI_A          S              5
     D TVLI            S              5  0
     D WMODE           S              2
     D JSONstring      S          32000
     D Error           S            150
     D                 DS
     D  TVVT1                  1     70
     D  TVVT2                 71    140
     D  TVVT3                141    210
     D  TVVT4                211    280
     D  TVT                    1    280    DIM(4)
     D                 DS
     D  NVVT1                  1     70
     D  NVVT2                 71    140
     D  NVVT3                141    210
     D  NVVT4                211    280
     D  VT                     1    280    DIM(4)
     D                 DS
     D  TVDTY                  1      4
     D  TVDREF                 5     39
     D  TVDSK                 40     41
     D  TVDO                  42     67
     D  TVDOSK                68     69
     D  TORIDK                 1     69
     D                 DS
     D  NVDTY                  1      4
     D  NVDREF                 5     39
     D  NVDSK                 40     41
     D  NVDO                  42     67
     D  NVDOSK                68     69
     D  ORIDK                  1     69
     D                 DS
     D  TVDTY1                 1      4
     D  TVDREF1                5     39
     D  TVDSK1                40     41
     D  TVDO1                 42     67
     D  TVDOSK1               68     69
     D  TVDTY2                70     73
     D  TVDREF2               74    108
     D  TVDSK2               109    110
     D  TVDO2                111    136
     D  TVDOSK2              137    138
     D  TVDTY3               139    142
     D  TVDREF3              143    177
     D  TVDSK3               178    179
     D  TVDO3                180    205
     D  TVDOSK3              206    207
     D  TVDTY4               208    211
     D  TVDREF4              212    246
     D  TVDSK4               247    248
     D  TVDO4                249    274
     D  TVDOSK4              275    276
     D  TVDTY5               277    280
     D  TVDREF5              281    315
     D  TVDSK5               316    317
     D  TVDO5                318    343
     D  TVDOSK5              344    345
     D  TDK                    1    345    DIM(5)
     D                 DS
     D  NVDTY1                 1      4
     D  NVDREF1                5     39
     D  NVDSK1                40     41
     D  NVDO1                 42     67
     D  NVDOSK1               68     69
     D  NVDTY2                70     73
     D  NVDREF2               74    108
     D  NVDSK2               109    110
     D  NVDO2                111    136
     D  NVDOSK2              137    138
     D  NVDTY3               139    142
     D  NVDREF3              143    177
     D  NVDSK3               178    179
     D  NVDO3                180    205
     D  NVDOSK3              206    207
     D  NVDTY4               208    211
     D  NVDREF4              212    246
     D  NVDSK4               247    248
     D  NVDO4                249    274
     D  NVDOSK4              275    276
     D  NVDTY5               277    280
     D  NVDREF5              281    315
     D  NVDSK5               316    317
     D  NVDO5                318    343
     D  NVDOSK5              344    345
     D  DK                     1    345    DIM(5)
     D                 DS
     D  TVCNR1                 1     17
     D  TVCNR2                18     34
     D  TVCNR3                35     51
     D  TVCNR4                52     68
     D  TVCNR5                69     85
     D  TVCNR6                86    102
     D  TCN                    1    102    DIM(6)
     D                 DS
     D  NVCNR1                 1     17
     D  NVCNR2                18     34
     D  NVCNR3                35     51
     D  NVCNR4                52     68
     D  NVCNR5                69     85
     D  NVCNR6                86    102
     D  CN                     1    102    DIM(6)
     D                 DS
     D  TVMN                   1     42
     D  TVMNSK                43     44
     D  TORIMN                 1     44
     D                 DS
     D  NVMN                   1     42
     D  NVMNSK                43     44
     D  ORIMN                  1     44
     D                 DS
     D  TVMN1                  1     42
     D  TVMNSK1               43     44
     D  TVMN2                 45     86
     D  TVMNSK2               87     88
     D  TVMN3                 89    130
     D  TVMNSK3              131    132
     D  TVMN4                133    174
     D  TVMNSK4              175    176
     D  TVMN5                177    218
     D  TVMNSK5              219    220
     D  TVMN6                221    262
     D  TVMNSK6              263    264
     D  TMN                    1    264    DIM(6)
     D                 DS
     D  NVMN1                  1     42
     D  NVMNSK1               43     44
     D  NVMN2                 45     86
     D  NVMNSK2               87     88
     D  NVMN3                 89    130
     D  NVMNSK3              131    132
     D  NVMN4                133    174
     D  NVMNSK4              175    176
     D  NVMN5                177    218
     D  NVMNSK5              219    220
     D  NVMN6                221    262
     D  NVMNSK6              263    264
     D  MN                     1    264    DIM(6)
     D                 DS
     D  TVEH                   1      2
     D  TVNT                   3      7  0
     D  TVNTEH                 8     12  0
     D  TORIKL                 1     12
     D                 DS
     D  NVEH                   1      2
     D  NVNT                   3      7  0
     D  NVNTEH                 8     12  0
     D  ORIKL                  1     12
     D                 DS
     D  TVEH1                  1      2
     D  TVNT1                  3      7  0
     D  TVNTEH1                8     12  0
     D  TVEH2                 13     14
     D  TVNT2                 15     19  0
     D  TVNTEH2               20     24  0
     D  TVEH3                 25     26
     D  TVNT3                 27     31  0
     D  TVNTEH3               32     36  0
     D  TVEH4                 37     38
     D  TVNT4                 39     43  0
     D  TVNTEH4               44     48  0
     D  TVEH5                 49     50
     D  TVNT5                 51     55  0
     D  TVNTEH5               56     60  0
     D  TVEH6                 61     62
     D  TVNT6                 63     67  0
     D  TVNTEH6               68     72  0
     D  TKL                    1     72    DIM(6)
     D                 DS
     D  NVEH1                  1      2
     D  NVNT1                  3      7  0
     D  NVNTEH1                8     12  0
     D  NVEH2                 13     14
     D  NVNT2                 15     19  0
     D  NVNTEH2               20     24  0
     D  NVEH3                 25     26
     D  NVNT3                 27     31  0
     D  NVNTEH3               32     36  0
     D  NVEH4                 37     38
     D  NVNT4                 39     43  0
     D  NVNTEH4               44     48  0
     D  NVEH5                 49     50
     D  NVNT5                 51     55  0
     D  NVNTEH5               56     60  0
     D  NVEH6                 61     62
     D  NVNT6                 63     67  0
     D  NVNTEH6               68     72  0
     D  KL                     1     72    DIM(6)
     D                 DS
     D  NVCTP1                 1     35
     D  NVCTP2                36     70
     D  NVCTP3                71    105
     D  NVCTP4               106    140
     D  NVCTP5               141    175
     D  PK                     1    175    DIM(5)

      *get input-string
      /copy syspeds/qrpgsrcpy,prolog3

      * Parse input
     C                   EXSR      Parse
      * Open files etc
     C                   EXSR      INIT
      *
     c                   callp     gethtmlifs(
     C                             '/syspeddev/html/JSON.html':
     C                             '/CGITAG/')
     C                   callp     wrtsection('top')

      * ............................................................................................
      * skriv JSON-Object start..(alltid '{' + x ant param. m/komma mellom (IKKE komma etter siste))
      * ............................................................................................
      *
      /free
        JSONstring='{'
        +'¬user¬ : ¬'+%trim(WSUSER)+'¬, '
        +'¬tvavd¬ : ¬'+%trim(%editc(tvavd:'Z'))+'¬, '
        +'¬tvtdn¬ : ¬'+%trim(%editc(tvtdn:'Z'))+'¬, '
        +'¬tvli¬ : ¬'+%trim(%editc(tvli:'Z'))+'¬, '
        +'¬errMsg¬ : ¬'+%trim(Error)+'¬, ¬oneline¬ : [';
      /end-free
      * JSONfix escaper " i tekst,  for deretter å bytte ¬->"
     c                   call      'JSONFIX'
     c                   parm                    JSONstring
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')

      * Hæmta detta ena ærendet.
     C     Error         IFEQ      *blanks
     C                   MOVE      *BLANKS       TVT
     C                   MOVE      *BLANKS       VT
     C                   MOVE      *BLANKS       TDK
     C                   MOVE      *BLANKS       DK
     C                   MOVE      *BLANKS       TCN
     C                   MOVE      *BLANKS       CN
     C                   MOVE      *BLANKS       TMN
     C                   MOVE      *BLANKS       MN
     C                   MOVE      *ZEROS        TKL
     C     1             DO        6             XN
     C                   EVAL      %SUBST(TKL(XN):1:2) = *BLANKS
     C                   EVAL      %SUBST(KL(XN):1:2) = *BLANKS
     C                   ENDDO
     C                   MOVE      *ZEROS        KL
     C                   MOVE      *BLANKS       PK
     C     SVNLkey       CHAIN     SVNL                               33
     C                   IF        *IN33 = *OFF
      *
     C                   MOVE      TVCNR         TCN(1)
     C                   MOVE      NVCNR         CN(1)
     C                   Z-ADD     1             XN                3 0
     C     SVNLkey       SETLL     SVNLCN
     C     SVNLkey       READE     SVNLCN                                 33
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   MOVE      TVCNR         TCN(XN)
     C                   MOVE      NVCNR         CN(XN)
     C     SVNLkey       READE     SVNLCN                                 33
     C  N33              ENDDO
      *
     C                   MOVE      TORIDK        TDK(1)
     C                   MOVE      ORIDK         DK(1)
     C                   Z-ADD     1             XN                3 0
     C     SVNLkey       SETLL     SVNLDK
     C     SVNLkey       READE     SVNLDK                                 33
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   MOVE      TORIDK        TDK(XN)
     C                   MOVE      ORIDK         DK(XN)
     C     SVNLkey       READE     SVNLDK                                 33
     C  N33              ENDDO
      *
     C                   MOVE      TORIKL        TKL(1)
     C                   MOVE      ORIKL         KL(1)
     C                   Z-ADD     1             XN                3 0
     C     SVNLkey       SETLL     SVNLKL
     C     SVNLkey       READE     SVNLKL                                 33
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   MOVE      TORIKL        TKL(XN)
     C                   MOVE      ORIKL         KL(XN)
     C     SVNLkey       READE     SVNLKL                                 33
     C  N33              ENDDO
      *
     C                   MOVE      TORIMN        TMN(1)
     C                   MOVE      ORIMN         MN(1)
     C                   Z-ADD     1             XN                3 0
     C     SVNLkey       SETLL     SVNLMN
     C     SVNLkey       READE     SVNLMN                                 33
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   MOVE      TORIMN        TMN(XN)
     C                   MOVE      ORIMN         MN(XN)
     C     SVNLkey       READE     SVNLKL                                 33
     C  N33              ENDDO
      *
     C                   MOVE      TVVT          TVT(1)
     C                   MOVE      NVVT          VT(1)
     C                   Z-ADD     1             XN                3 0
     C     SVNLkey       SETLL     SVNLVT
     C     SVNLkey       READE     SVNLVT                                 33
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   MOVE      TVVT          TVT(XN)
     C                   MOVE      NVVT          VT(XN)
     C     SVNLkey       READE     SVNLVT                                 33
     C  N33              ENDDO
      *
     C                   MOVE      NVCTP         PK(1)
     C                   Z-ADD     1             XN                3 0
     C     SVNLkey       SETLL     SVNLPK
     C     SVNLkey       READE     SVNLPK                                 33
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   MOVE      NVCTP         PK(XN)
     C     SVNLkey       READE     SVNLPK                                 33
     C  N33              ENDDO
      *
      *
      * ............................................................................................
      * Skriv en JSON-Array-linje pr menypunkt - komma før hvert nytt element
      * ............................................................................................
      /free
          JSONstring=*blanks;
       JSONstring=%trim(JSONstring)+'{'
          +'¬tvavd¬ : ¬'+%trim(%editc(TVAVD:'Z'))+'¬, '
          +'¬tvtdn¬ : ¬'+%trim(%editc(TVTDN:'Z'))+'¬, '
          +'¬tvli¬ : ¬'+%trim(%editc(TVLI:'Z'))+'¬, '
          +'¬tvvnt¬ : ¬'+%trim(%editc(TVVNT:'4'))+'¬, '
          +'¬tvvntl¬ : ¬'+%trim(%editc(TVVNTL:'4'))+'¬, '
          +'¬tvdk¬ : ¬'+%trim(TVDK)+'¬, '
          +'¬tvvt¬ : ¬'+%trim(TVVT1)+'¬, '
          +'¬tvvt2¬ : ¬'+%trim(TVVT2)+'¬, '
          +'¬tvvt3¬ : ¬'+%trim(TVVT3)+'¬, '
          +'¬tvvt4¬ : ¬'+%trim(TVVT4)+'¬, '
          +'¬tvvtsk¬ : ¬'+%trim(TVVTSK)+'¬, '
          +'¬tvvktb¬ : ¬'+%trim(%editc(TVVKTB:'4'))+'¬, '
          +'¬tvvktn¬ : ¬'+%trim(%editc(TVVKTN:'4'))+'¬, '
          +'¬tvalk¬ : ¬'+%trim(TVALK)+'¬, '
          +'¬tvblk¬ : ¬'+%trim(TVBLK)+'¬, '
          +'¬tvnas¬ : ¬'+%trim(TVNAS)+'¬, '
          +'¬tvads1¬ : ¬'+%trim(TVADS1)+'¬, '
          +'¬tvpns¬ : ¬'+%trim(TVPNS)+'¬, '
          +'¬tvpss¬ : ¬'+%trim(TVPSS)+'¬, '
          +'¬tvlks¬ : ¬'+%trim(TVLKS)+'¬, '
          +'¬tvsks¬ : ¬'+%trim(TVSKS)+'¬, '
          +'¬tvtins¬ : ¬'+%trim(TVTINS)+'¬, '
          +'¬tvnak¬ : ¬'+%trim(TVNAK)+'¬, '
          +'¬tvadk1¬ : ¬'+%trim(TVADK1)+'¬, '
          +'¬tvpnk¬ : ¬'+%trim(TVPNK)+'¬, '
          +'¬tvpsk¬ : ¬'+%trim(TVPSK)+'¬, '
          +'¬tvlkk¬ : ¬'+%trim(TVLKK)+'¬, '
          +'¬tvskk¬ : ¬'+%trim(TVSKK)+'¬, '
          +'¬tvtink¬ : ¬'+%trim(TVTINK)+'¬, '
          +'¬tvdty¬ : ¬'+%trim(TVDTY1)+'¬, '
          +'¬tvdref¬ : ¬'+%trim(TVDREF1)+'¬, '
          +'¬tvdsk¬ : ¬'+%trim(TVDSK1)+'¬, '
          +'¬tvdo¬ : ¬'+%trim(TVDO1)+'¬, '
          +'¬tvdosk¬ : ¬'+%trim(TVDOSK1)+'¬, '
          +'¬tvdty2¬ : ¬'+%trim(TVDTY2)+'¬, '
          +'¬tvdref2¬ : ¬'+%trim(TVDREF2)+'¬, '
          +'¬tvdsk2¬ : ¬'+%trim(TVDSK2)+'¬, '
          +'¬tvdo2¬ : ¬'+%trim(TVDO2)+'¬, '
          +'¬tvdosk2¬ : ¬'+%trim(TVDOSK2)+'¬, '
          +'¬tvdty3¬ : ¬'+%trim(TVDTY3)+'¬, '
          +'¬tvdref3¬ : ¬'+%trim(TVDREF3)+'¬, '
          +'¬tvdsk3¬ : ¬'+%trim(TVDSK3)+'¬, '
          +'¬tvdo3¬ : ¬'+%trim(TVDO3)+'¬, '
          +'¬tvdosk3¬ : ¬'+%trim(TVDOSK3)+'¬, '
          +'¬tvdty4¬ : ¬'+%trim(TVDTY4)+'¬, '
          +'¬tvdref4¬ : ¬'+%trim(TVDREF4)+'¬, '
          +'¬tvdsk4¬ : ¬'+%trim(TVDSK4)+'¬, '
          +'¬tvdo4¬ : ¬'+%trim(TVDO4)+'¬, '
          +'¬tvdosk4¬ : ¬'+%trim(TVDOSK4)+'¬, '
          +'¬tvdty5¬ : ¬'+%trim(TVDTY5)+'¬, '
          +'¬tvdref5¬ : ¬'+%trim(TVDREF5)+'¬, '
          +'¬tvdsk5¬ : ¬'+%trim(TVDSK5)+'¬, '
          +'¬tvdo5¬ : ¬'+%trim(TVDO5)+'¬, '
          +'¬tvdosk5¬ : ¬'+%trim(TVDOSK5)+'¬, '
          +'¬tvtlo¬ : ¬'+%trim(TVTLO)+'¬, '
          +'¬tvexkd¬ : ¬'+%trim(%editc(TVEXKD:'4'))+'¬, '
          +'¬tvexlk¬ : ¬'+%trim(TVEXLK)+'¬, '
          +'¬tvcnr¬ : ¬'+%trim(TVCNR1)+'¬, '
          +'¬tvcnr2¬ : ¬'+%trim(TVCNR2)+'¬, '
          +'¬tvcnr3¬ : ¬'+%trim(TVCNR3)+'¬, '
          +'¬tvcnr4¬ : ¬'+%trim(TVCNR4)+'¬, '
          +'¬tvcnr5¬ : ¬'+%trim(TVCNR5)+'¬, '
          +'¬tvmn¬ : ¬'+%trim(TVMN1)+'¬, '
          +'¬tvmnl¬ : ¬'+%trim(%editc(TVMNL:'4'))+'¬, '
          +'¬tvmnsk¬ : ¬'+%trim(TVMNSK1)+'¬, '
          +'¬tvmn2¬ : ¬'+%trim(TVMN2)+'¬, '
          +'¬tvmnsk2¬ : ¬'+%trim(TVMNSK2)+'¬, '
          +'¬tvmn3¬ : ¬'+%trim(TVMN3)+'¬, '
          +'¬tvmnsk3¬ : ¬'+%trim(TVMNSK3)+'¬, '
          +'¬tvmn4¬ : ¬'+%trim(TVMN4)+'¬, '
          +'¬tvmnsk4¬ : ¬'+%trim(TVMNSK4)+'¬, '
          +'¬tvmn5¬ : ¬'+%trim(TVMN5)+'¬, '
          +'¬tvmnsk5¬ : ¬'+%trim(TVMNSK5)+'¬, '
          +'¬tvmn6¬ : ¬'+%trim(TVMN6)+'¬, '
          +'¬tvmnsk6¬ : ¬'+%trim(TVMNSK6)+'¬, '
          +'¬tveh¬ : ¬'+%trim(TVEH1)+'¬, '
          +'¬tvnt¬ : ¬'+%trim(%editc(TVNT1:'4'))+'¬, '
          +'¬tvnteh¬ : ¬'+%trim(%editc(TVNTEH1:'4'))+'¬, '
          +'¬tveh2¬ : ¬'+%trim(TVEH2)+'¬, '
          +'¬tvnt2¬ : ¬'+%trim(%editc(TVNT2:'4'))+'¬, '
          +'¬tvnteh2¬ : ¬'+%trim(%editc(TVNTEH2:'4'))+'¬, '
          +'¬tveh3¬ : ¬'+%trim(TVEH3)+'¬, '
          +'¬tvnt3¬ : ¬'+%trim(%editc(TVNT3:'4'))+'¬, '
          +'¬tvnteh3¬ : ¬'+%trim(%editc(TVNTEH3:'4'))+'¬, '
          +'¬tveh4¬ : ¬'+%trim(TVEH4)+'¬, '
          +'¬tvnt4¬ : ¬'+%trim(%editc(TVNT4:'4'))+'¬, '
          +'¬tvnteh4¬ : ¬'+%trim(%editc(TVNTEH4:'4'))+'¬, '
          +'¬tveh5¬ : ¬'+%trim(TVEH5)+'¬, '
          +'¬tvnt5¬ : ¬'+%trim(%editc(TVNT5:'4'))+'¬, '
          +'¬tvnteh5¬ : ¬'+%trim(%editc(TVNTEH5:'4'))+'¬, '
          +'¬tveh6¬ : ¬'+%trim(TVEH6)+'¬, '
          +'¬tvnt6¬ : ¬'+%trim(%editc(TVNT6:'4'))+'¬, '
          +'¬tvnteh6¬ : ¬'+%trim(%editc(TVNTEH6:'4'))+'¬, '
          +'¬tvfv¬ : ¬'+%trim(TVFV)+'¬, '
          +'¬tvftnt¬ : ¬'+%trim(%editc(TVFVNT:'4'))+'¬, '
          +'¬nvvnt¬ : ¬'+%trim(%editc(NVVNT:'4'))+'¬, '
          +'¬nvvt¬ : ¬'+%trim(NVVT1)+'¬, '
          +'¬nvvt2¬ : ¬'+%trim(NVVT2)+'¬, '
          +'¬nvvt3¬ : ¬'+%trim(NVVT3)+'¬, '
          +'¬nvvt4¬ : ¬'+%trim(NVVT4)+'¬, '
          +'¬nvvtsk¬ : ¬'+%trim(NVVTSK)+'¬, '
          +'¬nvvktb¬ : ¬'+%trim(%editc(NVVKTB:'4'))+'¬, '
          +'¬nvvktn¬ : ¬'+%trim(%editc(NVVKTN:'4'))+'¬, '
          +'¬nvdty¬ : ¬'+%trim(NVDTY1)+'¬, '
          +'¬nvdref¬ : ¬'+%trim(NVDREF1)+'¬, '
          +'¬nvdsk¬ : ¬'+%trim(NVDSK1)+'¬, '
          +'¬nvdo¬ : ¬'+%trim(NVDO1)+'¬, '
          +'¬nvdosk¬ : ¬'+%trim(NVDOSK1)+'¬, '
          +'¬nvdty2¬ : ¬'+%trim(NVDTY2)+'¬, '
          +'¬nvdref2¬ : ¬'+%trim(NVDREF2)+'¬, '
          +'¬nvdsk2¬ : ¬'+%trim(NVDSK2)+'¬, '
          +'¬nvdo2¬ : ¬'+%trim(NVDO2)+'¬, '
          +'¬nvdosk2¬ : ¬'+%trim(NVDOSK2)+'¬, '
          +'¬nvdty3¬ : ¬'+%trim(NVDTY3)+'¬, '
          +'¬nvdref3¬ : ¬'+%trim(NVDREF3)+'¬, '
          +'¬nvdsk3¬ : ¬'+%trim(NVDSK3)+'¬, '
          +'¬nvdo3¬ : ¬'+%trim(NVDO3)+'¬, '
          +'¬nvdosk3¬ : ¬'+%trim(NVDOSK3)+'¬, '
          +'¬nvdty4¬ : ¬'+%trim(NVDTY4)+'¬, '
          +'¬nvdref4¬ : ¬'+%trim(NVDREF4)+'¬, '
          +'¬nvdsk4¬ : ¬'+%trim(NVDSK4)+'¬, '
          +'¬nvdo4¬ : ¬'+%trim(NVDO4)+'¬, '
          +'¬nvdosk4¬ : ¬'+%trim(NVDOSK4)+'¬, '
          +'¬nvdty5¬ : ¬'+%trim(NVDTY5)+'¬, '
          +'¬nvdref5¬ : ¬'+%trim(NVDREF5)+'¬, '
          +'¬nvdsk5¬ : ¬'+%trim(NVDSK5)+'¬, '
          +'¬nvdo5¬ : ¬'+%trim(NVDO5)+'¬, '
          +'¬nvdosk5¬ : ¬'+%trim(NVDOSK5)+'¬, '
          +'¬nvcnr¬ : ¬'+%trim(NVCNR1)+'¬, '
          +'¬nvcnr2¬ : ¬'+%trim(NVCNR2)+'¬, '
          +'¬nvcnr3¬ : ¬'+%trim(NVCNR3)+'¬, '
          +'¬nvcnr4¬ : ¬'+%trim(NVCNR4)+'¬, '
          +'¬nvcnr5¬ : ¬'+%trim(NVCNR5)+'¬, '
          +'¬nvcnr6¬ : ¬'+%trim(NVCNR6)+'¬, '
          +'¬nvmn¬ : ¬'+%trim(NVMN1)+'¬, '
          +'¬nvmnsk¬ : ¬'+%trim(NVMNSK1)+'¬, '
          +'¬nvmn2¬ : ¬'+%trim(NVMN2)+'¬, '
          +'¬nvmnsk2¬ : ¬'+%trim(NVMNSK2)+'¬, '
          +'¬nvmn3¬ : ¬'+%trim(NVMN3)+'¬, '
          +'¬nvmnsk3¬ : ¬'+%trim(NVMNSK3)+'¬, '
          +'¬nvmn4¬ : ¬'+%trim(NVMN4)+'¬, '
          +'¬nvmnsk4¬ : ¬'+%trim(NVMNSK4)+'¬, '
          +'¬nvmn5¬ : ¬'+%trim(NVMN5)+'¬, '
          +'¬nvmnsk5¬ : ¬'+%trim(NVMNSK5)+'¬, '
          +'¬nvmn6¬ : ¬'+%trim(NVMN6)+'¬, '
          +'¬nvmnsk6¬ : ¬'+%trim(NVMNSK6)+'¬, '
          +'¬nveh¬ : ¬'+%trim(NVEH1)+'¬, '
          +'¬nvnt¬ : ¬'+%trim(%editc(NVNT1:'4'))+'¬, '
          +'¬nvnteh¬ : ¬'+%trim(%editc(NVNTEH1:'4'))+'¬, '
          +'¬nveh2¬ : ¬'+%trim(NVEH2)+'¬, '
          +'¬nvnt2¬ : ¬'+%trim(%editc(NVNT2:'4'))+'¬, '
          +'¬nvnteh2¬ : ¬'+%trim(%editc(NVNTEH2:'4'))+'¬, '
          +'¬nveh3¬ : ¬'+%trim(NVEH2)+'¬, '
          +'¬nvnt3¬ : ¬'+%trim(%editc(NVNT3:'4'))+'¬, '
          +'¬nvnteh3¬ : ¬'+%trim(%editc(NVNTEH3:'4'))+'¬, '
          +'¬nveh4¬ : ¬'+%trim(NVEH4)+'¬, '
          +'¬nvnt4¬ : ¬'+%trim(%editc(NVNT4:'4'))+'¬, '
          +'¬nvnteh4¬ : ¬'+%trim(%editc(NVNTEH4:'4'))+'¬, '
          +'¬nveh5¬ : ¬'+%trim(NVEH5)+'¬, '
          +'¬nvnt5¬ : ¬'+%trim(%editc(NVNT5:'4'))+'¬, '
          +'¬nvnteh5¬ : ¬'+%trim(%editc(NVNTEH5:'4'))+'¬, '
          +'¬nveh6¬ : ¬'+%trim(NVEH6)+'¬, '
          +'¬nvnt6¬ : ¬'+%trim(%editc(NVNT6:'4'))+'¬, '
          +'¬nvnteh6¬ : ¬'+%trim(%editc(NVNTEH6:'4'))+'¬, '
          +'¬nvfv¬ : ¬'+%trim(NVFV)+'¬, '
          +'¬nvfvnt¬ : ¬'+%trim(%editc(NVFVNT:'4'))+'¬, '
          +'¬nvct¬ : ¬'+%trim(NVCT)+'¬, '
          +'¬nvctb¬ : ¬'+%trim(NVCTB)+'¬, '
          +'¬nvctsk¬ : ¬'+%trim(NVCTSK)+'¬, '
          +'¬nvctp¬ : ¬'+%trim(NVCTP1)+'¬,'
          +'¬nvctp2¬ : ¬'+%trim(NVCTP2)+'¬,'
          +'¬nvctp3¬ : ¬'+%trim(NVCTP3)+'¬,'
          +'¬nvctp4¬ : ¬'+%trim(NVCTP4)+'¬,'
          +'¬nvctp5¬ : ¬'+%trim(NVCTP5)+'¬, '
          +'¬tvorgh¬ : ¬'+%trim(%editc(TVORGH:'4'))+'¬, '
          +'¬tvorgi¬ : ¬'+%trim(%editc(TVORGI:'4'))+'¬}';
      /end-free
     C                   CALL      'JSONFIX'
     C                   PARM                    JSONstring
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   CALLP     wrtsection('JSONlin')

     C                   ENDIF
     C                   ENDIF
      * ............................................................................................
      * Skriv JSON-string Avsluttning
      * ............................................................................................
     C                   EVAL      JSONstring =']}'
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   CALLP     wrtsection('JSONlin')
      *
      * Quit
     C                   exsr      Exit


      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Lukk fil
     C                   CLOSE     BRIDF
     C  N50              CLOSE     SVNL
     C  N50              CLOSE     SVNLCN
     C  N50              CLOSE     SVNLDK
     C  N50              CLOSE     SVNLKL
     C  N50              CLOSE     SVNLMN
     C  N50              CLOSE     SVNLPK
     C  N50              CLOSE     SVNLVT

      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      * Quit
     C                   MOVE      *ON           *INLR
     C                   return
     C                   endsr
      *
      *********************************************************
     C     Parse         Begsr
      *********************************************************
      * Get input
     C                   EVAL      WSUSER  = zhbgetvar('USER')
     C                   EVAL      TVAVD_A   = zhbgetvar('AVD')
     C                   EVAL      TVAVD     = c2n2(TVAVD_A)
     C                   EVAL      TVTDN_A   = zhbgetvar('OPD')
     C                   EVAL      TVTDN     = c2n2(TVTDN_A)
     C                   EVAL      TVLI_A    = zhbgetvar('LIN')
     C                   EVAL      TVLI      = c2n2(TVLI_A)
     C                   EVAL      WMODE     = zhbgetvar('MODE')
      *
     c                   ENDSR
      *********************************************************
     C     INIT          Begsr
      *********************************************************
     C                   OPEN      BRIDF
      * Test innlogging
     C     WSUSER        CHAIN     BRIDF                              50
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C                   call      BILIBL
     C                   end
      *
     C     SVNLKey       klist
     C                   kfld                    TVAVD
     C                   kfld                    TVTDN
     C                   kfld                    TVLI
      *
     C   50              eval      Error = 'Invalid userID'
     C  N50              OPEN      SVNL
     C  N50              OPEN      SVNLCN
     C  N50              OPEN      SVNLDK
     C  N50              OPEN      SVNLKL
     C  N50              OPEN      SVNLMN
     C  N50              OPEN      SVNLPK
     C  N50              OPEN      SVNLVT

     c                   endsr
      *
