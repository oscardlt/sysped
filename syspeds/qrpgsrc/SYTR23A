********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 TETS PERIODE ER ÅPEN.
********************************************************************
      *
      ************************************************************
      *** UTSKRIFT AV TRANSPORTØRAVREGNING (KREDITNOTA)        ***
      ************************************************************
      *
     FFIRM      IF   E           K DISK
     FKODTV     IF   E           K DISK
     FKODTW     IF   E           K DISK
     FKODTSF    IF   E           K DISK
     FTRAVH3    IF   E           K DISK
     FTRAVV2    IF   E           K DISK
     FTRAN      IF   E           K DISK
     FKODTÅ     IF   E           K DISK
     FSYTR23FA  CF   E             WORKSTN
     D                 DS
     D  WSPER                  1      6  0
     D  XXPERC                 1      2  0
     D  XXPERÅ                 3      4  0
     D  XXPERM                 5      6  0
     D                 DS
     D  MINPER                 1      6  0
     D  KOÅCC                  1      2  0
     D  KOÅÅR                  3      4  0
     D  KOÅMND                 5      6  0
      *
     C                   EXSR      INIT
      *
     C     WSVAVD        IFGT      0
     C                   GOTO      START2
     C                   ELSE
     C                   SETON                                        50        IKKE VIS NEDRE DEL.
     C                   END
     C*
     C*
     C     START         TAG
     C                   EXFMT     BILDE01
     C     START2        TAG
     C                   SETOFF                                       309899
     C                   SETOFF                                       97
     C*
     C   03              MOVE      '1'           UIN01
     C   03              GOTO      SLUTT
     C   12              MOVE      '1'           UIN01
     C   12              GOTO      SLUTT
     C*
     C     KODTVK        CHAIN     KODTV                              99
     C  N99KODTWK        CHAIN     KODTW                              99
     C   99              MOVE      'SPA0001'     MSGNR
     C   99              SETON                                        3050
     C   99              GOTO      START
     C*
     C     KODSFK        CHAIN     KODTSF                             98
     C   98              MOVE      'SPS0001'     MSGNR
     C   98              SETON                                        3050
     C   98              GOTO      START
     C*
     C* HENTER STANDARD PRINTERSTYRING - FAKTURA
     C*
     C                   Z-ADD     102           PRTNR             3 0
     C                   CALL      'SYGE01'
     C                   PARM                    WSVAVD
     C                   PARM                    PRTNR
     C                   PARM                    WSPRT
     C                   PARM                    WSFORM
     C                   PARM                    WSHEAD            1
     C                   PARM                    WKOPFM            5
     C*
     C                   SETOFF                                       50         VIS NEDRE DEL
     C* MELDING OM FORIGE UTSKRIFT?
     C     UMSGNR        IFNE      'DIV0000'
     C                   MOVE      UMSGNR        MSGNR
     C                   MOVE      'DIV0000'     UMSGNR
     C                   SETON                                        30
     C                   END
     C*
     C     STA11         TAG
     C                   EXFMT     BILDE01
     C* NY AVD??
     C   12              DO
     C                   SETON                                        50
     C                   MOVE      *BLANKS       WSPRT
     C                   MOVE      *BLANKS       WSFORM
     C                   MOVE      *BLANKS       WSHEAD
     C                   GOTO      START
     C                   END
     C*
     C   03              MOVE      '1'           UIN01
     C   03              GOTO      SLUTT
     C*
     C   04              DO
     C                   CALL      'SYTR04A'
     C                   PARM                    WSTNR
     C                   END
     C*
     C                   EXSR      TESTB1
     C   30              GOTO      STA11
     C*
     C     SLUTT         TAG
     C                   MOVE      WSTNR         UTNR              8 0
     C                   MOVE      WSVAVD        UUVAVD                          *ALPHA
     C     WSJOBQ        IFEQ      'Y'
     C     WSJOBQ        OREQ      'J'
     C                   MOVE      'SPU0010'     UMSGNR            7
     C                   ELSE
     C                   MOVE      'SPU0011'     UMSGNR
     C                   END
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
     C*
     C                   MOVEA     '0'           *IN(30)
     C                   MOVEA     '00000000'    *IN(70)
     C     *IN51         IFEQ      *ON
     C     WSFAKT        COMP      *ZEROS                                 72
     C  N72WSTNR         COMP      *ZEROS                                 72
     C     *IN72         IFEQ      *OFF
      * VED KOPI - KAN VÆRE YMSE STATUSER, STATUS G GODTAS IKKE!!
     C                   MOVE      'F'           XXST
     C     TRH3KE        CHAIN     TRAVH3                             72
     C  N72THTNR         COMP      WSTNR                              7272
     C   72              MOVE      'O'           XXST
     C   72TRH3KE        CHAIN     TRAVH3                             72
     C  N72THTNR         COMP      WSTNR                              7272
      * FANT INGEN HOVED-POSTER.. - SJEKKE I GODSKR. UTENOM TUR..
     C     *IN72         IFEQ      *ON
     C                   MOVE      'F'           XXST
     C     TRV2KE        CHAIN     TRAVV2                             72
     C   72              MOVE      'O'           XXST
     C   72TRV2KE        CHAIN     TRAVV2                             72
     C                   END
     C                   END
      *
     C   72              DO
     C                   MOVE      'JOV1223'     MSGNR
     C                   SETON                                        30
     C                   GOTO      SLTB
     C                   END
     C                   GOTO      SLTB
     C                   END
     C* TRANSPORTØR
     C     WSTNR         IFNE      *ZEROS
     C     TRANKE        CHAIN     TRAN                               70
     C   70              DO
     C                   MOVE      'SPT0133'     MSGNR
     C                   SETON                                        30
     C                   GOTO      SLTB
     C                   END
     C* KAN IKKE AVREGNE TRANSP- SOM IKKE HAR KUNDENR
     C     VMTRKU        IFEQ      *ZEROS
     C                   MOVE      'DIV2366'     MSGNR
     C                   SETON                                        3070
     C                   GOTO      SLTB
     C                   END
     C                   END
     C* PERIODISERING  (MÅ VÆRE STØRRE EN MINSTE ÅPNE)
     C     WSPERÅ        IFGT      50
     C                   MOVE      19            XXPERC
     C                   ELSE
     C                   MOVE      20            XXPERC
     C                   END
     C                   MOVE      WSPERÅ        XXPERÅ
     C                   MOVE      WSPERM        XXPERM
S01  C*    WSPER         COMP      MINPE2                               71
N01  C     KODTÅK        CHAIN     KODTÅ                              71
     C   71              DO
     C                   MOVE      'DIV2295'     MSGNR
     C                   SETON                                        3071
     C                   GOTO      SLTB
     C                   END
     C     SLTB          ENDSR
     C*
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UIN01             1            *AVBRUDD (=1)
     C                   PARM                    UUVAVD            4            *ALPHA
     C                   PARM                    WSSFSI                         *SIGN
     C                   PARM                    WSPRT                          *PRINTER/UTKØ
     C                   PARM                    WSFORM                         *BLANKETT
     C                   PARM                    KOWHOD                         *HODE-FAKTURA
     C                   PARM                    WSVEDL                         *OGSÅ VEDLEGG
     C                   PARM                    WSJOBQ                         *JOBKØ
     C                   PARM                    UMSGNR                         *MELDING FRA FOREG.
     C                   PARM                    UTNR                           *TRANSP
     C                   PARM                    WSPERÅ                         *PERIODEÅR
     C                   PARM                    WSPERM                         *PERIODEMND
     C* SEPARAT GIRO
     C                   PARM                    WSALFA                         *ALFASORT
     C                   PARM                    WSFAKT                         *BIL.NR KOPI
     C*
      * 51 ON = KOPIKJØRING
     C     WSFAKT        COMP      *ZEROS                             5151
     C   51              MOVE      'J'           WSALFA                         SKRIV *KOPI*
     C   51              MOVE      *ZEROS        WSFAKT
     C     TRH3KE        KLIST
     C                   KFLD                    XXST              1
     C                   KFLD                    WSFAKT
     C     TRV2KE        KLIST
     C                   KFLD                    TVTAVD
     C                   KFLD                    WSTNR
     C                   KFLD                    XXST              1
     C                   KFLD                    WSFAKT
     C     KODSFK        KLIST
     C                   KFLD                    WSSFUN
     C                   KFLD                    WSSFSI
     C     KODTVK        KLIST
     C                   KFLD                    WSVUNI
     C                   KFLD                    WSVAVD
     C     KODTWK        KLIST
     C                   KFLD                    WSWUNI
     C                   KFLD                    WSVAVD
     C     TRANKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSTNR
S01  C*    KODÅKE        KLIST
S01  C*                  KFLD                    KOÅUNI
S01  C*                  KFLD                    KOÅCC
S01  C*                  KFLD                    KOÅÅR
S01  C*                  KFLD                    KOÅMND
N01  C     KODTÅK        KLIST
N01  C                   KFLD                    KOÅUNI
N01  C                   KFLD                    XXPERC
N01  C                   KFLD                    XXPERÅ
N01  C                   KFLD                    XXPERM
     C*
     C     UUVAVD        IFGT      '0000'
     C     UUVAVD        ANDLE     '9999'
     C                   MOVE      UUVAVD        WSVAVD                         *NUMERIC
     C                   ELSE
     C                   MOVE      *ZEROS        WSVAVD
     C                   END
     C                   MOVE      '0'           UIN01
     C                   MOVE      'SF'          WSSFUN            2
     C                   MOVE      'V'           WSVUNI            1
     C                   MOVE      'W'           WSWUNI            1
     C*
     C                   MOVE      *ZEROS        WSPER
S01  C*                  MOVE      *ZEROS        MINPER
     C*
     C*
S01  C* HENTER MINSTE ÅPNE PERIODE
     C                   MOVE      'Å'           KOÅUNI
S01  C*    KODÅKE        SETLL     KODTÅ
S01  C*    KOÅUNI        READE     KODTÅ                                  33
S01  C*    *IN33         IFEQ      '1'
S01  C*    UYEAR         IFGT      50
S01  C*    UYEAR         ADD       1900          MINPE2            6 0
S01  C*                  ELSE
S01  C*    UYEAR         ADD       2000          MINPE2
S01  C*                  END
S01  C*                  MULT      100           MINPE2
S01  C*                  MOVE      UMONTH        MINPE2
S01  C*                  ELSE
S01  C*                  MOVE      MINPER        MINPE2
S01  C*                  END
     C*
     C*
     C                   READ      FIRM                                   33
     C*
     C     UTI           ENDSR
     C*
     C*
