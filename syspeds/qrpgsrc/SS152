********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 BIAKT=L ER ENDRET TIL Å TESTE AUTORISASJON
********************************************************************
      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/SS152 MODULE(*LIBL/SS152
CRTPGM*         *LIBL/CHECKUSR *LIBL/INCGI) ACTGRP(CGI) AUT(*USE)
      *
      *
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
     FBRIDF     UF   E           K DISK    USROPN
     FBRPARF    IF   E           K DISK    USROPN
     FWRKCGISS  UF A E           K DISK    USROPN
     FCDBOAT    IF   E           K DISK    USROPN
     FGSSORL17  IF   E           K DISK    USROPN
     FGSSORL18  IF   E           K DISK    USROPN
     F                                     RENAME(GSSORFR:GSSORFR18)
     FGSSORL19  IF   E           K DISK    USROPN
     F                                     RENAME(GSSORFR:GSSORFR19)
     FGSSORL20  IF   E           K DISK    USROPN
     F                                     RENAME(GSSORFR:GSSORFR20)
     FGSSPOF    IF   E           K DISK    USROPN
     FGSSRFF    IF   E           K DISK    USROPN
     FGSSTRF    IF   E           K DISK    USROPN
     FVADR      IF   E           K DISK    USROPN
     FKUFAST    IF   E           K DISK    USROPN
      *--------------------------------------------------------------------
      * Prototype defintions and standard system API error structure
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      *--------------------------------------------------------------------
      * Variables common to CGI programs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
      * Variables received from the input string
     D lng             s              2
     D BckGnd          s             10
     D UsrSpcName      s             10
     D WSUSER          S             10
     D WSNA            S             30
     D WINT            s              6
     D WINTEG          s              6  0
     D MaxSN           s              5
     D MaxRC           s              5
     D MaxSN2          s              5  0
     D MaxRC2          s              5  0
     D AntSn           s              5  0
     D AntRC           s              5  0
     D XSN             s              5  0
     D WSCNO           s              8
     D WSCNO8          s              8  0
     D WSPRO           s              4
     D WSSAL           s             10
     D WSSALMAX        s             10
     D WSBCD           s              5
     D WSLC            s              5
     D WSSUP           s             30
     D WSST2           s              5
     D WSDTL           s              8
     D WSDTL8          s              8  0
     D WSAP            s             12
     D WSPO            s             20
     D WSPOMAX         s             20
     D WSACC           s             20
     D WSACCMAX        s             20
     D WSTYM           s              6
     D WSINKL          s              1
     D WSMS01          s              1
     D WSMS02          s              1
     D WSMS03          s              1
     D WSMS04          s              1
     D WSMS05          s              1
     D WSMS06          s              1
     D WSMS07          s              1
     D WSMS08          s              1
     D WSMS09          s              1
     D WSMS10          s              1
     D WSMS11          s              1
     D WSMS12          s              1
     D W2AP            s             12
     D W2SAL           s             35
     D W2ACC           s             35
     D W2AMT           s              2
     D W2CNA           s             36
     D W2TYM           s              7
     D lstbrd          s              1
     D NIER            s             30a   inz('999999999999999999999999999999')
     D XKN             s              8  0 DIM(100)
      *
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
     D PGM             C                   CONST('SYSPED/CHECKUSR')
     D                 DS
     D ORBCD                   1      5
     D ORBCD2                  2      5
     D                 DS
     D ORFT4                   1     30
     D ORAREA                  1      2
     D ORAAR                   4      7
     D ORMND                   8      9
     D ORAARMND                4      9
     D ORLMA                  11     14
     D                 DS
     D VADRN3                  1     30
     D VADRN32                 1     10
     D                 DS
     D WKEY1                   1    256
     D KEY1                    1    256    DIM(256)
     D                 DS
     D WKEY2                   1    256
     D KEY                     1    256    DIM(256)
     D                 DS
     D WKEY3                   1    256
     D KEY3                    1    256    DIM(256)
     D                 DS
     D WDATA                   1   1024
     D DATA                    1   1024    DIM(1024)
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================******
      * MAIN PROCESS LINE
      *=====================================================================******
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input
     C                   exsr      Parse
      *
     C                   EXSR      INIT
     C                   CALLB     PGM
     C                   PARM                    BIBRID
     C                   PARM                    UsrSpcName
     C                   PARM                    UINN              1
     C                   IF        UINN = 'N'
     C                   GOTO      SLUTT
     C                   END
     C     WSUSER        CHAIN     BRIDF                              50
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           BIDTF
     C                   MOVE      WTM           BITIDF
     C                   UPDATE    BRIDFR
      *
      * Set output skeleton html member name
     C                   exsr      SetSkl
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
      * Retrieve environment variables
     C                   exsr      RtvEnvVar
     C                   exsr      SetTop
     C                   callp     wrtsection('top')
     C                   exsr      GetData
     C                   IF        XFOUND = 'N'
     C                   callp     wrtsection('0found')
     C                   ELSE
     C                   exsr      SetData
     C                   callp     wrtsection('foundsome')
S01  C*                  IF        BIAKT = 'L'
N01  C                   IF        XAUT = 'L'
     C                   callp     wrtsection('foundsome2')
     C                   END
     C                   callp     wrtsection('foundsome3')
     C                   END
      *
     C                   exsr      SetEnd
     C                   callp     wrtsection('endhtml')
     C                   callp     wrtsection('*fini')
      *
     C     SLUTT         TAG
     C                   EXSR      EXIT
     C                   return
      *=====================================================================******
      * Parse input
      *=====================================================================******
     C     Parse         begsr
     C                   eval      lng     = zhbgetvar('lng')
     C                   eval      BckGnd  = zhbgetvar('bckgnd')
     C                   eval      lstbrd  = zhbgetvar('lstbrd')
     C                   EVAL      WSUSER  = zhbgetvar('USER')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   EVAL      WSNA    = zhbgetvar('WSNA')
     C                   EVAL      WKEY1   = zhbgetvar('WKEY')
     C                   IF        WKEY1   = *BLANKS
     C                   EVAL      WINT    = zhbgetvar('WINT')
     C                   eval      WINTEG  = c2n2(WINT)
     C                   eval      MaxSn   = zhbgetvar('MaxSn')
     C                   eval      MaxSn2  = c2n2(MaxSn)
     C                   eval      MaxRc   = zhbgetvar('MaxRc')
     C                   eval      MaxRc2  = c2n2(MaxRc)
     C                   EVAL      WSCNO   = zhbgetvar('WSCNO')
     C                   eval      WSCNO8  = c2n2(WSCNO)
     C                   EVAL      WSPRO   = zhbgetvar('WSPRO')
     C                   eval      WSPRO   = uppify(WSPRO)
     C                   EVAL      WSSAL   = zhbgetvar('WSSAL')
     C                   eval      WSSAL   = uppify(WSSAL)
     C                   eval      WSSALMAX= WSSAL
     C                   CAT       NIER:0        WSSALMAX
     C                   EVAL      WSBCD   = zhbgetvar('WSBCD')
     C                   eval      WSBCD   = uppify(WSBCD)
     C                   EVAL      WSLC    = zhbgetvar('WSLC')
     C                   eval      WSLC    = uppify(WSLC)
     C                   EVAL      WSSUP   = zhbgetvar('WSSUP')
     C                   EVAL      WSST2   = zhbgetvar('WSST2')
     C                   EVAL      WSDTL   = zhbgetvar('WSDTL')
     C                   eval      WSDTL8  = c2n2(WSDTL)
     C                   EVAL      WSAP    = zhbgetvar('WSAP')
     C                   eval      WSAP    = uppify(WSAP)
     C                   EVAL      WSPO    = zhbgetvar('WSPO')
     C                   eval      WSPO    = uppify(WSPO)
     C                   eval      WSPOMAX = WSPO
     C                   CAT       NIER:0        WSPOMAX
     C                   EVAL      WSACC   = zhbgetvar('WSACC')
     C                   eval      WSACC   = uppify(WSACC)
     C                   eval      WSACCMAX= WSACC
     C                   CAT       NIER:0        WSACCMAX
     C                   EVAL      WSTYM   = zhbgetvar('WSTYM')
     C                   EVAL      WSINKL  = zhbgetvar('WSINKL')
     C                   EVAL      WSMS01  = zhbgetvar('WSMS01')
     C                   EVAL      WSMS02  = zhbgetvar('WSMS02')
     C                   EVAL      WSMS03  = zhbgetvar('WSMS03')
     C                   EVAL      WSMS04  = zhbgetvar('WSMS04')
     C                   EVAL      WSMS05  = zhbgetvar('WSMS05')
     C                   EVAL      WSMS06  = zhbgetvar('WSMS06')
     C                   EVAL      WSMS07  = zhbgetvar('WSMS07')
     C                   EVAL      WSMS08  = zhbgetvar('WSMS08')
     C                   EVAL      WSMS09  = zhbgetvar('WSMS09')
     C                   EVAL      WSMS10  = zhbgetvar('WSMS10')
     C                   EVAL      WSMS11  = zhbgetvar('WSMS11')
     C                   EVAL      WSMS12  = zhbgetvar('WSMS12')
     C                   MOVE      'X'           KEY1(1)
     C                   MOVEA     WSCNO         KEY1(2)
     C                   MOVEA     WSPRO         KEY1(10)
     C                   MOVEA     WSSAL         KEY1(14)
     C                   MOVEA     WSBCD         KEY1(24)
     C                   MOVEA     WSLC          KEY1(29)
     C                   MOVEA     WSSUP         KEY1(34)
     C                   MOVEA     WSST2         KEY1(64)
     C                   MOVEA     WSDTL         KEY1(69)
     C                   MOVEA     WSAP          KEY1(77)
     C                   MOVEA     WSPO          KEY1(89)
     C                   MOVEA     WSACC         KEY1(109)
     C                   MOVEL     WSTYM         XAN04             4
     C                   MOVEA     XAN04         KEY1(129)
     C                   MOVE      WSTYM         XAN02             2
     C                   MOVEA     XAN02         KEY1(133)
     C                   MOVE      WSMS01        KEY1(135)
     C                   MOVE      WSMS02        KEY1(136)
     C                   MOVE      WSMS03        KEY1(137)
     C                   MOVE      WSMS04        KEY1(138)
     C                   MOVE      WSMS05        KEY1(139)
     C                   MOVE      WSMS06        KEY1(140)
     C                   MOVE      WSMS07        KEY1(141)
     C                   MOVE      WSMS08        KEY1(142)
     C                   MOVE      WSMS09        KEY1(143)
     C                   MOVE      WSMS10        KEY1(144)
     C                   MOVE      WSMS11        KEY1(145)
     C                   MOVE      WSMS12        KEY1(146)
     C                   MOVEA     WINT          KEY1(147)
     C                   MOVEA     MaxSn         KEY1(153)
     C                   MOVEA     MaxRc         KEY1(158)
     C                   MOVE      WSINKL        KEY1(163)
     C                   MOVE      'N'           KEY1(256)
     C                   ELSE
     C                   MOVEA     KEY1(2)       WSCNO
     C                   eval      WSCNO8  = c2n2(WSCNO)
     C                   MOVEA     KEY1(10)      WSPRO
     C                   MOVEA     KEY1(14)      WSSAL
     C                   eval      WSSALMAX= WSSAL
     C                   CAT       NIER:0        WSSALMAX
     C                   MOVEA     KEY1(24)      WSBCD
     C                   MOVEA     KEY1(29)      WSLC
     C                   MOVEA     KEY1(34)      WSSUP
     C                   MOVEA     KEY1(64)      WSST2
     C                   MOVEA     KEY1(69)      WSDTL
     C                   eval      WSDTL8  = c2n2(WSDTL)
     C                   MOVEA     KEY1(77)      WSAP
     C                   MOVEA     KEY1(89)      WSPO
     C                   eval      WSPOMAX = WSPO
     C                   CAT       NIER:0        WSPOMAX
     C                   MOVEA     KEY1(109)     WSACC
     C                   eval      WSACCMAX= WSACC
     C                   CAT       NIER:0        WSACCMAX
     C                   MOVEA     KEY1(129)     XAN04             4
     C                   MOVEA     KEY1(133)     XAN02             2
     C                   MOVEL     XAN04         WSTYM
     C                   MOVE      XAN02         WSTYM
     C                   MOVEA     KEY1(135)     WSMS01
     C                   MOVEA     KEY1(136)     WSMS02
     C                   MOVEA     KEY1(137)     WSMS03
     C                   MOVEA     KEY1(138)     WSMS04
     C                   MOVEA     KEY1(139)     WSMS05
     C                   MOVEA     KEY1(140)     WSMS06
     C                   MOVEA     KEY1(141)     WSMS07
     C                   MOVEA     KEY1(142)     WSMS08
     C                   MOVEA     KEY1(143)     WSMS09
     C                   MOVEA     KEY1(144)     WSMS10
     C                   MOVEA     KEY1(145)     WSMS11
     C                   MOVEA     KEY1(146)     WSMS12
     C                   MOVEA     KEY1(147)     WINT
     C                   eval      WINTEG  = c2n2(WINT)
     C                   MOVEA     KEY1(153)     MaxSn
     C                   eval      MaxSn2  = c2n2(MaxSn)
     C                   MOVEA     KEY1(158)     MaxRc
     C                   eval      MaxRc2  = c2n2(MaxRc)
     C                   MOVE      KEY1(163)     WSINKL
     C                   END
     C                   eval      W2AP    = WSAP
     C                   cat       '9999999999':0W2AP
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$top
      *  (search criteria)
      *=====================================================================******
     C     SetTop        begsr
      * Repeat national language for the next invocation
     C                   callp     updhtmlvar('LNG':lng:
     C                             InitHTMLVars)
      * Color for text, background, links, visited links, active links
     C                   callp     updhtmlvar('TXTCOLOR':'black')
     C                   callp     updhtmlvar('BOLD':' ')
     C                   callp     updhtmlvar('BGCOLOR':BIFARG)
     C                   callp     updhtmlvar('LINK':'0000FF')
     C                   callp     updhtmlvar('VLINK':'FF0000')
     C                   callp     updhtmlvar('ALINK':'00FF00')
      * KUNDE
     C                   callp     updhtmlvar('WSNA':WSNA)
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updhtmlvar('USER':WSUSER)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHtmlVar('MaxSn':MaxSn)
     C                   callp     updHtmlVar('MaxRc':MaxRc)
     C                   callp     updhtmlvar('WKEY':WKEY1)
     C                   eval      WKEY3 = WKEY1
     C                   MOVEA     '            'KEY3(135)
     C                   MOVE      'o'           KEY3(144)
     C                   callp     updhtmlvar('WKEY01':WKEY3)
     C                   MOVE      ' '           KEY3(144)
     C                   MOVE      'o'           KEY3(140)
     C                   callp     updhtmlvar('WKEY02':WKEY3)
     C                   MOVE      ' '           KEY3(140)
     C                   MOVE      'o'           KEY3(145)
     C                   callp     updhtmlvar('WKEY03':WKEY3)
     C                   MOVE      ' '           KEY3(145)
     C                   MOVE      'o'           KEY3(142)
     C                   callp     updhtmlvar('WKEY04':WKEY3)
     C                   MOVE      ' '           KEY3(142)
     C                   MOVE      'o'           KEY3(139)
     C                   callp     updhtmlvar('WKEY05':WKEY3)
     C                   MOVE      ' '           KEY3(139)
     C                   MOVE      'o'           KEY3(141)
     C                   callp     updhtmlvar('WKEY06':WKEY3)
     C                   MOVE      ' '           KEY3(141)
     C                   MOVE      'o'           KEY3(136)
     C                   callp     updhtmlvar('WKEY07':WKEY3)
     C                   MOVE      ' '           KEY3(136)
     C                   MOVE      'o'           KEY3(138)
     C                   callp     updhtmlvar('WKEY08':WKEY3)
     C                   MOVE      ' '           KEY3(138)
     C                   MOVE      'o'           KEY3(137)
     C                   callp     updhtmlvar('WKEY09':WKEY3)
     C                   MOVE      ' '           KEY3(137)
     C                   MOVE      'o'           KEY3(143)
     C                   callp     updhtmlvar('WKEY10':WKEY3)
     C                   MOVE      ' '           KEY3(143)
     C                   MOVE      'o'           KEY3(146)
     C                   callp     updhtmlvar('WKEY11':WKEY3)
     C                   MOVE      ' '           KEY3(146)
     C                   callp     updHTMLvar('sdato':
     C                             %trim(%editw(BIDTV:'    .  .  ')))
     C                   callp     updHTMLvar('stid':
     C                             %trim(%editw(BITIDV:'  .  .  ')))
      *
     C                   endsr
      *=====================================================================******
      * Set html output skeleton member before its read into memory
      *=====================================================================******
     C     SetSkl        begsr
      *------------------
      * Set html output skeleton member
     C                   eval      lng = uppify(lng)
      * "HTMLSRC  " er dft = NORSK, ved å trykke på FLAGGET i inng.
      * kan dette endre stil "HTMLSRCXX" avh. av støttede språk
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC' + lng
     C                   eval      Mbr = 'SS152'
      *------------------
     C                   endsr
      *=====================================================================******
      *  Retrieve environment variables
      *=====================================================================******
     C     RtvEnvVar     begsr
      * Use getenvp to get this server's protocol and name
     C                   eval      S_Protocol =getenv('SERVER_PROTOCOL':
     C                             qusec)
     C                   eval      S_Name     =getenv('SERVER_NAME':
     C                             qusec)
      *
     C                   endsr
      *=====================================================================******
      *  Hent data til arbeidsfil
      *=====================================================================******
     C     GetData       begsr
      *
      * Slett gamle data
     C     WINTEG        SETLL     WRKCGISS
     C     WINTEG        READE     WRKCGISS                               33
     C                   DOW       *IN33 = *OFF
     C                   DELETE    WRKCGISR
     C     WINTEG        READE     WRKCGISS                               33
     C  N33              ENDDO
     C                   MOVE      *BLANKS       WKEY2
     C                   MOVE      *BLANKS       WDATA
      *
      * Oppdater ny data
     C                   MOVE      'N'           XFOUND            1
      *
     C                   IF        WSCNO8 < 99999999
     C                   MOVE      WSCNO8        XKN(1)
     C                   ELSE
     C     WSUSER        SETLL     BRPARF
     C     WSUSER        READE     BRPARF                                 33
     C                   DOW       *IN33 = *OFF
     C                   IF        PAID = 'SSCUS'
     C                   ADD       1             XN                3 0
     C                   Z-ADD     PAVRDN        XKN(XN)
     C                   END
     C     WSUSER        READE     BRPARF                                 33
     C  N33              ENDDO
     C                   END
      *
     C     WSUSER        SETLL     BRPARF
     C     STGETDTA      TAG
     C     WSUSER        READE     BRPARF                                 33
     C                   DOW       *IN33 = *OFF
     C                   IF        PAID = 'SSLOC'
     C                   Z-ADD     PAVRDN        XXKN              8 0
     C                   MOVEL     PAVRDA        XXLC              5
     C                   MOVE      PAVRDA        XXLOCT            5
     C                   LEAVE
     C                   END
     C     WSUSER        READE     BRPARF                                 33
     C  N33              ENDDO
     C     *IN33         CABEQ     *ON           SLGETDTA
      *
     C                   MOVE      'N'           XPOD              1
     C     STGETDTA1     TAG
     C                   EXSR      SETSTRPOS
     C                   EXSR      READREC
     C                   DOW       *IN33 = *OFF
     C                   EVAL      AntRc = AntRc + 1
      *
     C     1             DO        100           XN
     C                   IF        ORCNO = XKN(XN)
     C                   LEAVE
     C                   END
     C     XKN(XN)       CABEQ     0             LESNESTE
     C                   ENDDO
      *
     C                   IF        WSBCD <> *BLANKS
     C     WSBCD         CABNE     ORBCD         LESNESTE
     C                   END
      *
     C                   IF        WSLC <> *BLANKS
     C     WSLC          CABNE     ORLC          LESNESTE
     C                   END
      *
     C                   IF        WSSUP <> *BLANKS
     C     WSSUP         CABNE     ORSNM         LESNESTE
     C                   END
      *
     C                   IF        WSST2 <> *BLANKS
     C     WSST2         CABNE     ORST2         LESNESTE
     C                   END
      *
     C                   IF        WSDTL8 <> 0
     C     WSDTL8        CABNE     ORDTL         LESNESTE
     C                   END
      *
     C                   SELECT
     C                   WHEN      WSTYM = '999999'
     C     ORAARMND      CABNE     *BLANKS       LESNESTE
     C                   WHEN      WSTYM <> *BLANKS
     C     WSTYM         CABNE     ORAARMND      LESNESTE
     C                   ENDSL
      *
     C                   MOVEL     ORAREA        XXAP             12
     C                   MOVE      ORBCD2        VADRNR
     C     VADRK         CHAIN     VADR                               34
     C                   IF        *IN34
     C                   MOVE      *BLANKS       VADRN3
     C                   END
     C                   MOVE      VADRN32       XXAP
     C                   IF        WSAP <> *BLANKS
     C                   IF        ((XXAP < WSAP) OR (XXAP > W2AP))
     C                   GOTO      LESNESTE
     C                   END
     C                   END
      *
     C     ORONO         SETLL     GSSPOF
     C     ORONO         READE     GSSPOF                                 34
     C                   IF        *IN34
     C     WSPRO         CABNE     *BLANKS       LESNESTE
     C     WSPO          CABNE     *BLANKS       LESNESTE
     C                   MOVE      *BLANKS       POCONO
     C                   END
     C                   IF        WSPRO <> *BLANKS
     C                   MOVEL     POCONO        XAN04             4
     C     XAN04         CABNE     WSPRO         LESNESTE
     C                   END
     C                   IF        WSPO <> *BLANKS
     C     POCONO        CABLT     WSPO          LESNESTE
     C     POCONO        CABGT     WSPOMAX       LESNESTE
     C                   END
      *
     C     ORONO         SETLL     GSSRFF
     C     ORONO         READE     GSSRFF                                 34
     C                   IF        *IN34
     C     WSSAL         CABNE     *BLANKS       LESNESTE
     C                   MOVE      *BLANKS       RFREF
     C                   ELSE
     C                   DOW       *IN34 = *OFF
     C                   IF        RFKD = 'SAL'
     C                   IF        WSSAL <> *BLANKS
     C                   MOVEL     RFREF         XAN10            10
     C                   IF        ((WSSAL <= XAN10) AND (WSSALMAX > XAN10))
     C                   LEAVE
     C                   END
     C                   ELSE
     C                   LEAVE
     C                   END
     C                   END
     C     ORONO         READE     GSSRFF                                 34
     C  N34              ENDDO
     C                   IF        *IN34
     C     WSSAL         CABNE     *BLANKS       LESNESTE
     C                   END
     C                   END
     C                   MOVE      RFREF         W2SAL
      *
     C     ORONO         SETLL     GSSRFF
     C     ORONO         READE     GSSRFF                                 34
     C                   IF        *IN34
     C     WSACC         CABNE     *BLANKS       LESNESTE
     C                   MOVE      *BLANKS       RFREF
     C                   ELSE
     C                   DOW       *IN34 = *OFF
     C                   IF        RFKD = 'CPO'
     C                   IF        WSACC <> *BLANKS
     C                   MOVEL     RFREF         XAN20            20
     C                   IF        ((WSACC <= XAN20) AND (WSACCMAX > XAN20))
     C                   LEAVE
     C                   END
     C                   ELSE
     C                   LEAVE
     C                   END
     C                   END
     C     ORONO         READE     GSSRFF                                 34
     C  N34              ENDDO
     C     *IN34         CABEQ     *ON           LESNESTE
     C                   END
      *
     C                   IF        ((ORLC = 'ONWAY') AND (XXLOCT <> *BLANKS))
     C     ORTNO         CHAIN     GSSTRF                             34
     C                   IF        TRLOCT <> XXLOCT
     C                   GOTO      LESNESTE
     C                   END
     C                   END
      *
     C                   MOVE      RFREF         W2ACC
      *
      * ORDNE NØKKEL
     C                   SELECT
     C                   WHEN      WSMS01 = 'o'
     C                   MOVEL     ORCNO         XAN08             8
     C                   MOVEA     XAN08         KEY(1)
     C                   WHEN      WSMS02 = 'o'
     C                   MOVEL     POCONO        XAN04             4
     C                   MOVEA     XAN04         KEY(1)
     C                   WHEN      WSMS03 = 'o'
     C                   MOVEL     W2SAL         XAN10            10
     C                   MOVEA     XAN10         KEY(1)
     C                   WHEN      WSMS04 = 'o'
     C                   MOVEA     ORBCD         KEY(1)
     C                   WHEN      WSMS05 = 'o'
     C                   MOVEA     ORLC          KEY(1)
     C                   WHEN      WSMS06 = 'o'
     C                   MOVEA     ORSNM         KEY(1)
     C                   WHEN      WSMS07 = 'o'
     C                   MOVEA     ORST2         KEY(1)
     C                   WHEN      WSMS08 = 'o'
     C                   MOVEL     ORDTL         XAN08             8
     C                   MOVEA     XAN08         KEY(1)
     C                   WHEN      WSMS09 = 'o'
     C                   MOVEA     XXAP          KEY(1)
     C                   WHEN      WSMS10 = 'o'
     C                   MOVEA     POCONO        KEY(1)
     C                   WHEN      WSMS11 = 'o'
     C                   MOVEA     W2ACC         KEY(1)
     C                   WHEN      WSMS12 = 'o'
     C                   MOVEA     ORAAR         KEY(1)
     C                   MOVE      '-'           KEY(5)
     C                   MOVEA     ORMND         KEY(6)
     C                   OTHER
     C                   MOVEL     ORCNO         XAN08             8
     C                   MOVEA     XAN08         KEY(1)
     C                   MOVE      '1'           KEY(256)
     C                   ENDSL
      *
     C                   MOVEL     ORCNO         XAN08             8
     C                   MOVEA     XAN08         KEY(31)
     C                   MOVEL     POCONO        XAN04             4
     C                   MOVEA     XAN04         KEY(39)
     C                   MOVEL     W2SAL         XAN10            10
     C                   MOVEA     XAN10         KEY(43)
     C                   MOVEA     ORBCD         KEY(53)
     C                   MOVEA     ORLC          KEY(58)
     C                   MOVEA     ORSNM         KEY(63)
     C                   MOVEA     ORST2         KEY(93)
     C                   MOVEL     ORDTL         XAN08             8
     C                   MOVEA     XAN08         KEY(98)
     C                   MOVEA     XXAP          KEY(106)
     C                   MOVEA     POCONO        KEY(118)
     C                   MOVEL     W2ACC         XAN20            20
     C                   MOVEA     XAN20         KEY(138)
     C                   MOVEA     ORAAR         KEY(158)
     C                   MOVE      '-'           KEY(162)
     C                   MOVEA     ORMND         KEY(163)
      *
      * BEVARE DATA
     C                   MOVEA     POCONO        DATA(1)
     C                   MOVEA     ORSNM         DATA(21)
     C                   MOVEA     W2ACC         DATA(51)
     C                   SELECT
S01  C*                  WHEN      BIAKT = 'L'
N01  C                   WHEN      XAUT = 'L'
     C                   MOVE      ORAMT         XAN11            11
     C                   MOVEA     XAN11         DATA(86)
     C                   WHEN      ORAMT = 0,01
     C                   MOVEA     '$$'          DATA(86)
     C                   OTHER
     C                   MOVEA     '  '          DATA(86)
     C                   ENDSL
     C                   MOVE      ORDTL         XAN08             8
     C                   MOVEA     XAN08         DATA(97)
     C                   MOVEA     ORLC          DATA(105)
     C                   MOVE      ORDTR         XAN08             8
     C                   MOVEA     XAN08         DATA(110)
     C     KUFASTK       CHAIN     KUFAST                             34
     C                   IF        *IN33
     C                   EVAL      KFTXTE = '*UNKNOW'
     C                   END
     C                   MOVEA     KFTXTE        DATA(118)
     C                   MOVE      ORCLI         XAN05             5
     C                   MOVEA     XAN05         DATA(168)
     C                   MOVE      ORWT          XAN07             7
     C                   MOVEA     XAN07         DATA(173)
     C                   MOVE      ORVOL         XAN05             5
     C                   MOVEA     XAN05         DATA(180)
     C                   MOVEA     POCONO        DATA(185)
     C                   EVAL      W2CNA = ORBCD
     C                   CAT       '/':0         W2CNA
     C                   CAT       VADRN3:0      W2CNA
     C                   MOVEA     W2CNA         DATA(189)
     C                   EVAL      RFREF = *BLANKS
     C     ORONO         SETLL     GSSRFF
     C     ORONO         READE     GSSRFF                                 34
     C                   DOW       *IN34 = *OFF
     C                   IF        RFKD = 'SAL'
     C                   LEAVE
     C                   END
     C     ORONO         READE     GSSRFF                                 34
     C  N34              ENDDO
     C                   MOVEA     RFREF         DATA(225)
     C                   MOVEA     ORFT4         DATA(260)
     C                   MOVEA     ORAAR         DATA(262)
     C                   MOVE      '-'           DATA(266)
     C                   MOVEA     ORMND         DATA(267)
     C                   MOVEL     ORDTWL        XAN08             8
     C                   MOVEA     XAN08         DATA(269)
      * POS. 277 - 287 ER LEDIGE
     C                   MOVEL     ORCNO         XAN08             8
     C                   MOVEA     XAN08         DATA(288)
      * POS. 295 - 312 ER LEDIGE
     C                   IF        ORLMA = *BLANKS
     C                   MOVE      *ZEROS        ORLMA
     C                   END
     C                   MOVEA     ORLMA         DATA(313)
     C                   MOVE      ORONO         XAN07             7
     C                   MOVEA     XAN07         DATA(1015)
      *
     C                   WRITE     WRKCGISR
     C                   EVAL      AntSn = AntSn + 1
     C                   MOVE      'J'           XFOUND            1
      *
     C     LESNESTE      TAG
     C                   IF        ((AntRc >= MaxRc2) OR (AntSn >= MaxSn2))
     C                   GOTO      SLGETDTA
     C                   END
     C                   EXSR      READREC
     C  N33              ENDDO
      *
     C                   IF        WSINKL <> ' '
     C                   IF        XPOD = 'N'
     C                   MOVE      'J'           XPOD
     C                   GOTO      STGETDTA1
     C                   END
     C                   MOVE      'N'           XPOD
     C                   END
      *
     C                   GOTO      STGETDTA
      *
     C     SLGETDTA      TAG
     C                   callp     updhtmlvar('MaxRc':
     C                             %trim(%editc(Maxrc2:'Z')))
     C                   callp     updhtmlvar('MaxSn':
     C                             %trim(%editc(MaxSn2:'Z')))
     C                   callp     updhtmlvar('AntRc':
     C                             %trim(%editc(Antrc:'3')))
     C                   callp     updhtmlvar('AntSn':
     C                             %trim(%editc(AntSn:'3')))
      *
     C                   endsr
      *=====================================================================******
      *  SETT STARTPOS
      *=====================================================================******
     C     SETSTRPOS     begsr
     C                   IF        XPOD = 'N'
     C                   SELECT
     C                   WHEN      XXKN = 0
     C     XXLC          CHAIN     CDBOAT                             33
     C     GSSOR18K      SETLL     GSSORL18
     C                   WHEN      ((XXKN >= 99999999) AND (XXLC<>'99999'))
     C     XXLC          SETLL     GSSORL17
     C                   WHEN      ((XXKN >= 99999999) AND (XXLC='99999'))
     C     *LOVAL        SETLL     GSSORL17
     C                   WHEN      XXLC = '99999'
     C     XXKN          SETLL     GSSORL18
     C                   OTHER
     C     GSSOR17K      SETLL     GSSORL17
     C                   ENDSL
     C                   ELSE
     C                   SELECT
     C                   WHEN      XXKN = 0
     C     XXLC          CHAIN     CDBOAT                             33
     C     GSSOR18K      SETLL     GSSORL20
     C                   WHEN      ((XXKN >= 99999999) AND (XXLC<>'99999'))
     C     XXLC          SETLL     GSSORL19
     C                   WHEN      ((XXKN >= 99999999) AND (XXLC='99999'))
     C     *LOVAL        SETLL     GSSORL19
     C                   WHEN      XXLC = '99999'
     C     XXKN          SETLL     GSSORL20
     C                   OTHER
     C     GSSOR17K      SETLL     GSSORL19
     C                   ENDSL
     C                   END
      *
     C                   endsr
      *=====================================================================******
      *  LES NESTE POST
      *=====================================================================******
     C     READREC       begsr
     C                   IF        XPOD = 'N'
     C                   SELECT
     C                   WHEN      XXKN = 0
     C     GSSOR18K      READE     GSSORL18                               33
     C                   WHEN      ((XXKN >= 99999999) AND (XXLC<>'99999'))
     C     XXLC          READE     GSSORL17                               33
     C                   WHEN      ((XXKN >= 99999999) AND (XXLC='99999'))
     C                   READ      GSSORL17                               33
     C                   WHEN      XXLC = '99999'
     C     XXKN          READE     GSSORL18                               33
     C                   OTHER
     C     GSSOR17K      READE     GSSORL17                               33
     C                   ENDSL
     C                   ELSE
     C                   SELECT
     C                   WHEN      XXKN = 0
     C     GSSOR18K      READE     GSSORL20                               33
     C                   WHEN      ((XXKN >= 99999999) AND (XXLC<>'99999'))
     C     XXLC          READE     GSSORL19                               33
     C                   WHEN      ((XXKN >= 99999999) AND (XXLC='99999'))
     C                   READ      GSSORL19                               33
     C                   WHEN      XXLC = '99999'
     C     XXKN          READE     GSSORL20                               33
     C                   OTHER
     C     GSSOR17K      READE     GSSORL19                               33
     C                   ENDSL
     C                   END
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section
      *  (search criteria)
      *=====================================================================******
     C     SetData       begsr
      *
     C                   callp     wrtsection('tablestr')
     C                   callp     updhtmlvar('WSNA':WSNA)
     C                   MOVE      *ZEROS        TOTCLI            9 0
     C                   MOVE      *ZEROS        TOTWT             9 1
     C                   MOVE      *ZEROS        TOTVOL            9 2
     C                   MOVE      *ZEROS        TOTLM             9 2
      *
     C     WINTEG        SETLL     WRKCGISS
     C     WINTEG        READE(N)  WRKCGISS                               33
     C                   DOW       *IN33 = *OFF
     C                   MOVEA     DATA(1015)    XAN07
     C                   MOVE      XAN07         ORONO
     C                   callp     updhtmlvar('ORONO':
     C                             %trim(%editc(ORONO:'Z')))
     C                   MOVEA     DATA(1)       POCONO
     C                   callp     updhtmlvar('POCONO':POCONO)
     C                   MOVEA     DATA(21)      ORSNM
     C                   callp     updhtmlvar('ORSNM':ORSNM)
     C                   MOVEA     DATA(51)      W2ACC
     C                   callp     updhtmlvar('WSACC':W2ACC)
S01  C*                  IF        BIAKT = 'L'
N01  C                   IF        XAUT = 'L'
     C                   MOVEA     DATA(86)      XAN11
     C                   MOVE      XAN11         ORAMT
     C                   callp     updhtmlvar('WSAMT':
     C                             %trim(%editc(ORAMT:'3')))
     C                   ELSE
     C                   MOVEA     DATA(86)      W2AMT
     C                   callp     updhtmlvar('WSAMT':W2AMT)
     C                   END
     C                   MOVEA     DATA(97)      XAN08
     C                   MOVE      XAN08         ORDTL
     C                   callp     updhtmlvar('ORDTL':
     C                             %trim(%editw(ORDTL:'    .  .  ')))
     C                   MOVEA     DATA(105)     ORLC
     C                   callp     updhtmlvar('ORLC':ORLC)
     C                   MOVEA     DATA(110)     XAN08
     C                   MOVE      XAN08         ORDTR
     C                   callp     updhtmlvar('ORDTR':
     C                             %trim(%editw(ORDTR:'    .  .  ')))
     C                   MOVEA     DATA(118)     KFTXTE
     C                   callp     updhtmlvar('WSST2':KFTXTE)
     C                   MOVEA     DATA(168)     XAN05
     C                   MOVE      XAN05         ORCLI
     C                   callp     updhtmlvar('ORCLI':
     C                             %trim(%editc(ORCLI:'Z')))
     C                   ADD       ORCLI         TOTCLI
     C                   MOVEA     DATA(173)     XAN07
     C                   MOVE      XAN07         ORWT
     C                   callp     updhtmlvar('ORWT':
     C                             %trim(%editc(ORWT:'3')))
     C                   ADD       ORWT          TOTWT
     C                   MOVEA     DATA(180)     XAN05
     C                   MOVE      XAN05         ORVOL
     C                   callp     updhtmlvar('ORVOL':
     C                             %trim(%editc(ORVOL:'3')))
     C                   ADD       ORVOL         TOTVOL
     C                   MOVEA     DATA(185)     XAN04             4
     C                   callp     updhtmlvar('WSPRO':XAN04)
     C                   MOVEA     KEY(53)       ORBCD
     C                   callp     updhtmlvar('ORBCD':ORBCD)
     C                   MOVEA     DATA(189)     W2CNA
     C                   callp     updhtmlvar('WSCNA':W2CNA)
     C                   MOVEA     DATA(225)     RFREF
     C                   callp     updhtmlvar('WSSAL':RFREF)
     C                   MOVEA     DATA(260)     XAN02             2
     C                   callp     updhtmlvar('WSAREA':XAN02)
     C                   MOVEA     DATA(262)     W2TYM
     C                   callp     updhtmlvar('WSTYM':W2TYM)
     C                   MOVEA     DATA(269)     XAN08
     C                   MOVE      XAN08         ORDTWL
     C                   callp     updhtmlvar('ORDTWL':
     C                             %trim(%editw(ORDTWL:'    .  .  ')))
      * POS. 277 - 287 ER LEDIGE
     C                   MOVEA     DATA(288)     XAN08
     C                   MOVE      XAN08         ORCNO
     C                   callp     updhtmlvar('ORCNO':
     C                             %trim(%editc(ORCNO:'Z')))
      * POS. 295 - 312 ER LEDIGE
     C                   MOVEA     DATA(313)     XAN04             4
     C                   MOVE      XAN04         XNR42             4 2
     C                   callp     updhtmlvar('ORLM':
     C                             %trim(%editc(XNR42:'3')))
     C                   ADD       XNR42         TOTLM
     C                   callp     updhtmlvar('WSTT':'T&T')
     C                   callp     updhtmlvar('WKEY':WKEY1)
      *
     C                   callp     wrtsection('tablerow')
S01  C*                  IF        BIAKT = 'L'
N01  C                   IF        XAUT = 'L'
     C                   callp     wrtsection('tableamt1')
     C                   ELSE
     C                   callp     wrtsection('tableamt2')
     C                   END
     C                   callp     wrtsection('tableamt3')
S01  C*                  IF        BIAKT = 'L'
N01  C                   IF        XAUT = 'L'
     C                   callp     wrtsection('tablecna1')
     C                   ELSE
     C                   callp     wrtsection('tablecna2')
     C                   END
     C                   callp     wrtsection('tablecna3')
S01  C*                  IF        BIAKT = 'L'
N01  C                   IF        XAUT = 'L'
     C                   callp     wrtsection('tabletyw1')
     C                   ELSE
     C                   callp     wrtsection('tabletyw2')
     C                   END
     C                   callp     wrtsection('tabletyw3')
      *
     C     WINTEG        READE(N)  WRKCGISS                               33
     C  N33              ENDDO
      *
      * SKRIV TOTAL
     C                   IF        TOTCLI > 0
     C                   MOVE      *BLANKS       XAN01             1
     C                   callp     updhtmlvar('ORONO':XAN01)
     C                   callp     updhtmlvar('POCONO':XAN01)
     C                   EVAL      ORSNM = 'TOTAL'
     C                   callp     updhtmlvar('ORSNM':ORSNM)
     C                   MOVE      *BLANKS       W2ACC
     C                   callp     updhtmlvar('WSACC':XAN01)
     C                   callp     updhtmlvar('WSAMT':XAN01)
     C                   callp     updhtmlvar('ORDTL':XAN01)
     C                   callp     updhtmlvar('ORLC':XAN01)
     C                   callp     updhtmlvar('ORDTR':XAN01)
     C                   callp     updhtmlvar('WSST2':XAN01)
     C                   callp     updhtmlvar('ORCLI':
     C                             %trim(%editc(TOTCLI:'Z')))
     C                   callp     updhtmlvar('ORWT':
     C                             %trim(%editc(TOTWT:'3')))
     C                   callp     updhtmlvar('ORVOL':
     C                             %trim(%editc(TOTVOL:'3')))
     C                   callp     updhtmlvar('WSPRO':XAN01)
     C                   callp     updhtmlvar('ORBCD':XAN01)
     C                   callp     updhtmlvar('WSCNA':XAN01)
     C                   callp     updhtmlvar('WSSAL':XAN01)
     C                   callp     updhtmlvar('WSAREA':XAN01)
     C                   callp     updhtmlvar('WSTYM':XAN01)
     C                   callp     updhtmlvar('ORDTWL':XAN01)
     C                   callp     updhtmlvar('ORCNO':XAN01)
     C                   callp     updhtmlvar('ORLM':
     C                             %trim(%editc(TOTLM:'3')))
     C                   callp     updhtmlvar('WSTT':XAN01)
     C                   callp     updhtmlvar('WKEY':XAN01)
      *
     C                   callp     wrtsection('tablerow')
S01  C*                  IF        BIAKT = 'L'
N01  C                   IF        XAUT = 'L'
     C                   callp     wrtsection('tableamt1')
     C                   ELSE
     C                   callp     wrtsection('tableamt2')
     C                   END
     C                   callp     wrtsection('tableamt3')
S01  C*                  IF        BIAKT = 'L'
N01  C                   IF        XAUT = 'L'
     C                   callp     wrtsection('tablecna1')
     C                   ELSE
     C                   callp     wrtsection('tablecna2')
     C                   END
     C                   callp     wrtsection('tablecna3')
S01  C*                  IF        BIAKT = 'L'
N01  C                   IF        XAUT = 'L'
     C                   callp     wrtsection('tabletyw1')
     C                   ELSE
     C                   callp     wrtsection('tabletyw2')
     C                   END
     C                   callp     wrtsection('tabletyw3')
     C                   END
      *
     C                   callp     wrtsection('tableend')
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$endhtml
      *=====================================================================******
     C     SetEnd        begsr
      * Server protocol
     C                   callp     updhtmlvar('PROTOCOL':S_Protocol)
      * Compute run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   endsr
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   OPEN      BRIDF
     C     WSUSER        CHAIN(N)  BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   CALLB     'INCGI'
     C                   PARM                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
      *
     C                   OPEN      BRPARF
     C                   OPEN      WRKCGISS
     C                   OPEN      CDBOAT
     C                   OPEN      GSSORL17
     C                   OPEN      GSSORL18
     C                   OPEN      GSSORL19
     C                   OPEN      GSSORL20
     C                   OPEN      GSSPOF
     C                   OPEN      GSSRFF
     C                   OPEN      GSSTRF
     C                   OPEN      VADR
     C                   OPEN      KUFAST
      *
     C     KUFASTK       KLIST
     C                   KFLD                    KFTYP
     C                   KFLD                    ORST2
     C     VADRK         KLIST
     C                   KFLD                    BIFIRM
     C                   KFLD                    ORCNO
     C                   KFLD                    VADRNR
     C     GSSOR17K      KLIST
     C                   KFLD                    XXLC
     C                   KFLD                    XXKN
     C     GSSOR18K      KLIST
     C                   KFLD                    CBKN
     C                   KFLD                    XXLC
N01  C     BrParKey      klist
N01  C                   kfld                    PABRID
N01  C                   kfld                    PAKUNR
N01  C                   kfld                    PAID
N01  C                   EVAL      PABRID = WSUSER
N01   *
N01  C                   MOVE      'AUTOR'       PAID
N01  C     BrParKey      chain     BRPARF                             33
N01  C                   IF        *IN33
N01  C                   MOVE      'N'           XAUT              1
N01  C                   ELSE
N01  C                   MOVEL     PAVRDA        XAUT
N01  C                   END
      *
     c                   MOVEL     'SSSTATUS'    KFTYP
      *
     C                   endsr
      *=====================================================================******
      *  AVSLUTT
      *=====================================================================******
     C     EXIT          begsr
     C                   close     BRIDF
     C                   close     BRPARF
     C                   close     WRKCGISS
     C                   close     CDBOAT
     C                   close     GSSORL17
     C                   close     GSSORL18
     C                   close     GSSORL19
     C                   close     GSSORL20
     C                   close     GSSPOF
     C                   close     GSSRFF
     C                   close     GSSTRF
     C                   close     VADR
     C                   close     KUFAST
     C                   eval      *inlr = *on
      *
     C                   endsr
