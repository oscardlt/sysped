     H Option( *SrcStmt ) DftActGrp( *No ) BndDir( 'QC2LE' )
     FDKXH      UF   E           K DISK
     FDKXHK     UF A E           K DISK
     FDKXKODL01 IF   E           K DISK
     FDKXSTD    IF   E           K DISK
     FEDIC      UF   E             DISK
     FDKTFI     IF   E             DISK
     FEDIM      O  A E             DISK
      *__________
      * Variabler
      *""""""""""
     D FILE_o          s               *
     D String          s            512a
     D rc              s             10i 0
N03  D Data            s          30000a   Varying
     D Codepage        s              5a   Varying
      *___________________________
      * IFS Stream file funksjoner
      *"""""""""""""""""""""""""""
     Dopen             Pr              *   ExtProc( '_C_IFS_fopen' )
     D                                 *   Value Options( *String )
     D                                 *   Value Options( *String )

     Dfputs            Pr            10i 0 ExtProc( '_C_IFS_fputs' )
     D                                 *   Value Options( *String )
     D                                 *   Value

     Dclose            Pr            10i 0 ExtProc( '_C_IFS_fclose' )
     D                                 *   Value
     D RunCmd          PR                  EXTPGM('QCMDEXC')
     D  Cmd                         200A   CONST
     D  Len                          15P 5 CONST
      *   SYEDI data area
     D EDIDTA          DS           256
     D  UELIBF               171    180

     C                   EXSR      INIT

     C     DKHKEY        CHAIN     DKXH                               33
     C                   MOVE      'Q'           THST
     C                   MOVE      *BLANKS       THWS
     C                   MOVE      'J'           THPKL
     C                   MOVE      U1N07         THMF
     C                   MOVE      *BLANKS       THSGUT

     C                   UPDATE    DKXHR

     C                   EXSR      KOMLIN

N02  C     SLUTT         TAG
     C                   EVAL      *INLR = *ON
      ***********************************************
     C     KOMLIN        BEGSR
      ***********************************************
     C                   CALL      'DKX101R'
     C                   PARM                    UAVD
     C                   PARM                    UTDN
     C                   PARM                    U1N07
S03  C*                  PARM                    UDATA         10000
N03  C                   PARM                    UDATA         30000
      * Lag ASCIIfil
     C                   MOVE      UAVD          WAVD              4
     C                   MOVE      UTDN          WOPD              7
     C                   MOVE      *BLANKS       WFILNAM         256
     C                   EVAL      WFILNAM = '/' + %trimr(UELIBF)
     C                             + '/EDISE/TEMP/DKXU' + WAVD + '-' + WOPD

     C                   EVAL      Codepage = '819'
     C                   EVAL      FILE_o = open( %TrimR( WfilNam )
     C                             : 'w, codepage=' + Codepage )

     C                   EVAL      rc = close( FILE_o )

     C                   EVAL      FILE_o = open( %TrimR( WfilNam )
     C                             : 'w' )

     C                   IF        FILE_o <> *Null
     C                   EVAL      Data = %trimr(UDATA)
     C                   EVAL      rc = fputs(Data : File_o)
     C                   EVAL      rc = close( FILE_o )
     C                   ENDIF
      * Skriv till loggfil
      *_______________
      * Skriv til EDIM
      *"""""""""""""""
     C                   CLEAR                   EDIMR
     C                   EVAL      M0004=DKTF_0004T
     C                   EVAL      M0010='NTA.DK'
     C                   EVAL      M0035=DKXH_0035
     C                   MOVEL     THAVD         W0062            11
     C                   MOVE      THTDN         W0062
     C                   EVAL      M0062=W0062
     C                   EVAL      M0065='CUSDEC'
     C                   EVAL      M1001='DTE'
     C                   EVAL      M1004=THTUID
     C                   EVAL      M0068=THTUID
     C                   EVAL      M1225=THMF
     C                   EVAL      M1N07=THMF
     C                   EVAL      MMN=CMN
     C                   EVAL      MSR='S'
     C                   MOVEL     WDT           MDT
     C                   MOVEL     WTM           MTM
     C                   EVAL      MAVD=THAVD
     C                   EVAL      MTDN=THTDN

     C                   WRITE     EDIMR
     C                   ENDSR
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
     C     *LIKE         DEFINE    M0068A        MAX0B
     C     *LIKE         DEFINE    M0068B        MAX0C
     C     *LIKE         DEFINE    M0068C        MAX0D
     C     *LIKE         DEFINE    S0004         X0004
     C     *LIKE         DEFINE    S0010         X0010
     C     DKHKEY        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C     DkK01K        KLIST
     C                   KFLD                    YUNIK             3
     C                   KFLD                    YKODE            10
     C     M2KDCK        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
     C                   KFLD                    MAX0B
     C                   KFLD                    MAX0C
     C                   KFLD                    MAX0D
     C     M2KD2K        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    UTDN
      *
     C     *ENTRY        PLIST
     C                   PARM                    UAVD              4 0
     C                   PARM                    UTDN              7 0
     C                   PARM                    U1N07             3
     C                   PARM                    UFLAGG            1 0
      *
     C                   MOVE      '99999999'    MAX0B
     C                   MOVE      '999999'      MAX0C
     C                   MOVE      '99'          MAX0D
      *
     C     UAVD          CHAIN     DKXSTD                             33
     C                   MOVE      S0004         X0004
     C                   MOVE      S0010         X0010
     C     DKHKEY        CHAIN(N)  DKXH                               33
      *
     C                   MOVE      '0'           *IN12
      * Åpne dataarea
     C     *DTAARA       DEFINE                  EDIDTA
     C                   IN        EDIDTA
      * Hæmta firmaupplysningar
     C     1             CHAIN     DKTFI                              51
      * Hæmta næsta meddelandenummer
     C     1             CHAIN     EDIC                               51
     C                   ADD       1             CMN
     C                   UPDATE    EDICR
      * Hæmta dagens datum och klockslag
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   ENDSR
