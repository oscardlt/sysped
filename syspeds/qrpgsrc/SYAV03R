     FDOKUI     IF   E           K DISK
     FHEADF     IF   E           K DISK
     FSYAV03F   O  A E             DISK
      *__________________
      * DS for AWB-number
      *""""""""""""""""""
     D                 DS
     D  DIAWB                  1     11  0
     D  WEFLY                  1      3  0
      *_____________
      * DS for DOKEM
      *"""""""""""""
     D                 DS
NRFA D* HERFA                  1     15
NRFA D  HERFA                  1     35
NRFA D  HERFA15                1     15
     D  WFSD                   1      3
     D  WFLNR                  4      6  0
      *//////////////
      *  Main logic /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initialize                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *___________________
      * Define workfields
      *"""""""""""""""""""
     C     *LIKE         DEFINE    *IN03         WIN03
     C     *LIKE         DEFINE    DIAVD         WIAVD
     C     *LIKE         DEFINE    DIOPD         WIOPD
     C     *LIKE         DEFINE    HEAVD         ZAVDF
     C     *LIKE         DEFINE    HEAVD         ZAVDT
     C     *LIKE         DEFINE    HEFLY         ZFLYF
     C     *LIKE         DEFINE    HEFLY         ZFLYT
     C     *LIKE         DEFINE    HEDTOP        ZDTF            - 2
     C     *LIKE         DEFINE    HEDTOP        ZDTT            - 2
     C     *LIKE         DEFINE    DIRI          WIRI
     C     *LIKE         DEFINE    DIFBNR        WIFBNR
      *__________________
      * Define keys
      *""""""""""""""""""
     C     KEYA          KLIST
     C                   KFLD                    WIRI
     C                   KFLD                    WIAVD
     C                   KFLD                    WIOPD
     C                   KFLD                    WIFBNR
     C     KEYB          KLIST
     C                   KFLD                    DIAVD
     C                   KFLD                    DIOPD
      *_________________
      * Input parameters
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C     ZAVDF         PARM                    ZAVDF
     C     ZAVDT         PARM                    ZAVDT
     C     ZFLYF         PARM                    ZFLYF
     C     ZFLYT         PARM                    ZFLYT
     C     ZDTF          PARM                    ZDTF
     C     ZDTT          PARM                    ZDTT
     C     *IN03         PARM                    WIN03
      *_____________
      * Initialize fields
      *"""""""""""""
     C                   MOVE      ZDTF          ZDTF8             8 0
     C     ZDTF          IFGT      501231
     C                   MOVEL     '19'          ZDTF8
     C                   ELSE
     C                   MOVEL     '20'          ZDTF8
     C                   END
     C                   MOVE      ZDTT          ZDTT8             8 0
     C     ZDTT          IFGT      501231
     C                   MOVEL     '19'          ZDTT8
     C                   ELSE
     C                   MOVEL     '20'          ZDTT8
     C                   END
     C                   MOVE      'I'           WIRI
     C                   Z-ADD     ZAVDF         WIAVD
     C                   MOVE      *ZEROS        WIOPD
     C                   MOVE      *ZEROS        WIFBNR
     C                   MOVE      '1'           *IN03
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Read file - write valid AWBs to workfile             SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
      * Setll
     C     KEYA          SETLL     DOKUI
     C     WIRI          READE     DOKUI                                  51
     C  N51DIAVD         COMP      ZAVDT                              51
     C     *IN51         DOWEQ     '0'
      * Airline
     C     WEFLY         IFGE      ZFLYF
     C     WEFLY         ANDLE     ZFLYT
      * collect info from the orderrecord
     C     KEYB          CHAIN     HEADF                              52
     C     *IN52         IFEQ      '0'
      * Date
     C     HEDTOP        ANDGE     ZDTF8
     C     HEDTOP        ANDLE     ZDTT8
      * Status on order
     C     HEST          IFNE      ' '
     C     HEST          ANDNE     'F'
     C     HEST          ANDNE     'O'
     C     HEST          ANDNE     'H'
     C                   GOTO      SRB1
     C                   END
      * status on AWB (in DOKUI) must be "P"= printed
     C     DIST          IFNE      'P'
     C                   GOTO      SRB1
     C                   END
      * write to workfile
     C                   MOVE      '0'           *IN03
     C                   Z-ADD     WEFLY         HEFLY
     C                   WRITE     SYAV03FF
      *
     C                   END
     C                   END
     C     SRB1          TAG
      * read next record
     C     WIRI          READE     DOKUI                                  51
     C  N51DIAVD         COMP      ZAVDT                              51
     C  N51              END
      *
     C                   ENDSR
