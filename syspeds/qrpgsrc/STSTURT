      *********************************************************************
      *  After compiling this RPG MODULE,
      *  create the related program with the following command:
      *
CRTPG+*  CRTPGM SYSPED/STSTURT MODULE(*LIBL/STSTURT *LIBL/INCGI)
CRTPGM*         ACTGRP(*NEW) AUT(*USE)
      *
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
********************************************************************
P10036* 01 JOV PTF10 HOPP UT HVIS UGYLDIG USER
********************************************************************
      *
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
      *--------------------------------------------------------------------
      * Data base files
      *--------------------------------------------------------------------
     FBRIDF     IF   E           K DISK    USROPN
     FBRPARF    IF   E           K DISK    USROPN
     F*urer14   IF   E           K DISK    USROPN
      *--------------------------------------------------------------------
      * Prototype defintions and standard system API error structure
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      *
      *--------------------------------------------------------------------
      * Variables common to CGI programs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
      * Variables received from the input string
     D WSUSER          S             10
      * andre variabler
     D Fn              s             10
     D Lib             s             10
     D Mbr             s             10
N05  D TermText        s             50
     D                 DS
     D WDsDT                   1      8
     D  WDsDTÅÅ                1      4
     D  WDsDTMM                5      6
     D  WDsDTDD                7      8
     D WDsDTT12                1     12  0
     D  WDsDTTID               9     14  0
     D WDsDTT14                1     14
     D                 DS
     D  XTIME                  1     14  0
     D  XTID                   1      6  0
     D  XDD                    7      8  0
     D  XMM                    9     10  0
     D  XÅÅ                   11     14  0
     D                 DS
     D  PAVRDA                 1     50
     D  PAVRDA1_5              1      5
     D  PAVRDA7_46             7     46
N05  D  PAVRDA48_48           48     48
N05  D  PAVRDA49_50           49     50
      *
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================******
      * MAIN PROCESS LINE
      *=====================================================================******
      * Parse input string
     C                   EXSR      PARSE
      *
      ***
     C                   exsr      Init
      * Set output skeleton html member name
     C                   exsr      SetSkl
      * Read skeleton output html, etc.
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
      *------------------
      * Write sections of HTML.
      *
      * Her er HOVED logikk-rutine
     C                   exsr      SetTop
      *
     C                   callp     wrtsection('top')
      *
     C                   EXSR      DSPFK
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      *
      *
     C                   close     BRIDF
     C                   close     BRPARF
     C*                  close     TURER14
     C                   eval      *inlr = *on
     C                   RETURN
      *
      *=====================================================================******
      * Parse input
      *=====================================================================******
     C     Parse         begsr
     C                   eval      WSUSER   = zhbgetvar('USER')
     C                   eval      WSUSER   = uppify(WSUSER)
      *
     C                   endsr
      *
      *=====================================================================
      * EXECUTE LOGIC / Set html output variables for section /$top
      *=====================================================================
     C     SetTop        begsr
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updhtmlvar('User':WSUSER)
     c
      *
     C                   endsr
      *
      *=====================================================================*
      *  Display end Customer Adress to select from
      *=====================================================================*
     C     DSPFK         begsr
     C                   callp     wrtsection('FKtop')
      *
     c     TermDefin     ifeq      'N'
     C                   callp     updhtmlvar('KFKOD':'IN')
     C                   callp     updhtmlvar('KFTXT':'INN terminal')
s03  C*                  callp     wrtsection('FKrow')
     C                   callp     updhtmlvar('KFKOD':'OUT')
     C                   callp     updhtmlvar('KFTXT':'UT  terminal')
s03  C*                  callp     wrtsection('FKrow')
     c                   else
     C     BrParKey      SETLL     BRPARF
     C     BrParKey      READE     BRPARF                                 40
     c     *in40         doweq     '0'
     C                   callp     updhtmlvar('KFKOD':PAVRDA1_5)
     C                   callp     updhtmlvar('KFTXT':PAVRDA7_46)
     C                   callp     wrtsection('FKrow')
     C     BrParKey      READE     BRPARF                                 40
     C                   ENDDO
     c                   end
      * foreslå alltid dagens dato
     C                   callp     updhtmlvar('TURNR':'')
     C                   callp     updhtmlvar('DAT':WDsDT)
     C                   callp     updhtmlvar('KL':'')
      *
N03   * info
N03  c     TermDefin     ifeq      'N'
N03  C                   callp     wrtsection('FKBotINF')
N03  c                   else
     C                   callp     wrtsection('FKBot')
N03  c                   end
      *
     C                   endsr
N04
N04   *=====================================================================*
N04   *  Kolliavvik    (kun på firmanivå)
      *
      *=====================================================================******
      *  Different User than last invocation
      *=====================================================================******
     C     Init          begsr
     C                   OPEN      BRIDF
E01  C     WSUSER        CHAIN     BRIDF                              50
N01  c     *in50         ifeq      '1'
N01  C                   callp     gethtml('HTMLSRC':'*LIBL':'ERRUSR':
N01  c                             '/CGITAG/')
N01  C                   callp     updhtmlvar('User':WSUSER)
N01  C                   callp     wrtsection('all')
N01  C                   callp     wrtsection('*fini')
N01  C                   close     BRIDF
N01  C                   eval      *inlr = *on
N01  C                   return
N01  c                   endif
N01   *
      * En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
      * (bedre ressursmessig). MODUL må da være med comp. av dette pgm!!
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
      * Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
      *
     C                   open      BRPARF
     C*                  open      TURER14
      *
     C     BrParKey      KLIST
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
     C                   MOVE      BIBRID        PABRID
     C                   MOVE      *zeros        PAKUNR
     C                   MOVEL     'TERMK'       PAID
     C     BrParKey      Chain     BRPARF                             33
     C   33              MOVE      'N'           TermDefin         1
      *
     C                   TIME                    XTIME
     C                   MOVE      XDD           WDsDTDD
     C                   MOVE      XMM           WDsDTMM
     C                   MOVE      XÅÅ           WDsDTÅÅ
     C                   MOVE      XTID          WDsDTTID
     C                   endsr
      *
      *=====================================================================******
      * Set html output skeleton member before its read into memory
      *=====================================================================******
     C     SetSkl        begsr
      *------------------
      * Set html output skeleton member
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC'
     C                   eval      Mbr = 'STSTURT'
      *------------------
     C                   endsr
      *
