********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 CB  PTF12 Ny variabel
12XXX * 02 YBC PTF12 Oppdater brukt garantibeløp
12XXX * 03 YBC PTF12 Ta hänsyn till version 5
      *********************************************************************
      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/TDCE002R MODULE(*LIBL/TDCE002R *LIBL/INCGI)
CRTPGM*        ACTGRP(*NEW) AUT(*USE)
      *
      *********************************************************************
      /copy SYSPEDS/qrpgsrcpy,hspecs
      /copy SYSPEDS/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
N02  FDKXGH     UF   E           K DISK    USROPN
     FDKXH      UF A E           K DISK    USROPN
     F                                     PREFIX(X_)
     FDKXHFV    UF A E           K DISK    USROPN
     F                                     PREFIX(X_)
     FDKXSTD    UF   E           K DISK    USROPN
     F                                     PREFIX(X_)
     FDKTHA2    IF   E           K DISK    USROPN
     F                                     RENAME(DKTHAR:DKTHAR2)
     FDKTHA     IF   E           K DISK    USROPN
     FDKXV      IF A E           K DISK    USROPN
     FDKXVAM    IF A E           K DISK    USROPN
     FDKXVVT    IF A E           K DISK    USROPN
     FDKXVDK    IF A E           K DISK    USROPN
     FDKXVCN    IF A E           K DISK    USROPN
     FDKXVMN    IF A E           K DISK    USROPN
     FFRISOK    UF A E           K DISK    USROPN
     FFRISOL01  IF   E           K DISK    USROPN
     F                                     RENAME(FRISOKR:FRISOKRL)
     FHEADF     IF   E           K DISK    USROPN
     FDKEH      IF   E           K DISK    USROPN
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy SYSPEDS/qrpgsrcpy,prototypeb
      /copy SYSPEDS/qrpgsrcpy,usec
      /copy SYSPEDS/qrpgsrcpy,variables3
      *
      * Varible for
     D WSUSER          S             10
     D THAVD_A         S              4
     D THAVD           S              4  0
     D THTDN_A         S              7
     D THTDN           S              7  0
     D NEWSYAVA        S              4
     D NEWAVD          S              4  0
     D NEWOPD          S              7  0
     D NEWSIGN         S              3
     D WMODE           S              2
     D WSIGN           S              3
     D THXREF          S             35
     D THSG            S              3
     D THST            S              1
     D THDT_A          S              8
     D THDT            S              8  0
     D THPRO_A         S              8
     D THPRO           S              8  0
     D THENKL          S              1
     D THDK            S              5
     D THKNA_A         S              8
     D THKNA           S              8  0
     D THNAA           S             30
     D THADA1          S             30
     D THPNA           S              9
     D THPSA           S             24
     D THLKA           S              2
     D THSKA           S              2
     D THTINA          S             17
     D THKNS_A         S              8
     D THKNS           S              8  0
     D THNAS           S             30
     D THADS1          S             30
     D THPNS           S              9
     D THPSS           S             24
     D THLKS           S              2
     D THSKS           S              2
     D THTINS          S             17
     D THKNK_A         S              8
     D THKNK           S              8  0
     D THNAK           S             30
     D THADK1          S             30
     D THPNK           S              9
     D THPSK           S             24
     D THLKK           S              2
     D THSKK           S              2
     D THTINK          S             17
     D THBLK           S              2
     D THLSD           S             17
     D THLASD          S             17
     D THLAS2          S             17
     D THALK           S              2
     D THTRM_A         S              2
     D THTRM           S              2  0
     D THTRMI_A        S              2
     D THTRMI          S              2  0
     D THTAID          S             27
     D THTASK          S              2
     D THTALK          S              2
     D THTGID          S             27
     D THTGSK          S              2
     D THTGLK          S              2
     D THSKFD          S              2
     D THCATS          S              8
     D THTSD1          S              8
     D THTSD2          S              8
     D THTSD3          S              8
     D THTSD4          S              8
     D THTSD5          S              8
     D THTSD6          S              8
     D THTSD7          S              8
     D THTSD8          S              8
     D THTSB           S              8
     D THDDT_A         S              8
     D THDDT           S              8  0
     D THDFKD          S             20
     D THDFSK          S              2
     D THDKR           S              2
     D THDANT_A        S              4
     D THDANT          S              4  0
     D THDDTK_A        S              8
     D THDDTK          S              8  0
     D THDATS          S              8
     D THDKAV          S             35
     D THDKSK          S              2
     D THGKD_A         S              8
     D THGKD           S              8  0
     D THGFT1          S             24
     D THGFT2          S             35
     D THGADK          S              4
     D THGBL_A         S             13
     D THGBL           S             13  2
     D THGVK           S              3
     D THGBGI_A        S              1
     D THGBGI          S              1  0
     D THGBGU          S              2
     D THKDC           S              1
     D THTSSD          S              8
     D THTSN1          S             35
     D THTSN2          S             35
     D THTSPN          S              9
     D THTSLK          S              2
     D THTSSK          S              2
     D THLSTL_A        S              4
     D THLSTL          S              4  0
     D THVPOS_A        S              5
     D THVPOS          S              5  0
     D THNTK_A         S              7
     D THNTK           S              7  0
     D THVKB_A         S             11
     D THVKB           S             11  3
     D THDST           S             15
N01  D THDSTN          S             35
     D THDSK           S              2
     D THTARF          S             16
     D THWS            S             10
     D THTRNR          S             18
     D THTRDT_A        S              8
     D THTRDT          S              8  0
     D THOMD_A         S              1
     D THOMD           S              1  0
     D THBIND          S            140
     D THTET_A         S              1
     D THTET           S              1  0
     D THMF            S              3
     D THMP_A          S              1
     D THMP            S              1  0
     D THPKL           S              1
     D THKDV           S              1
     D TH0035          S              1
     D DKXH_0035       S              1
     D THTUID          S             14
     D THSGDK          S              6
     D THSGME          S              3
     D THSGUT          S              6
     D THSGID          S             10
     D THSGDT          S             12
     D THBYTE_A        S              7
     D THBYTE          S              7  0
     D THSIK           S              1  0
     D THDTA           S              8  0
     D THTMA           S              4  0
     D THSPOM          S              1
     D THTKBM          S              1
     D THKREF          S             70
     D THTREF          S             35
     D THLOSD          S             35
     D THLOSDSK        S              2
     D THLKR1          S              2
     D THLKR2          S              2
     D THLKR3          S              2
     D THLKR4          S              2
     D THLKR5          S              2
     D THLKR6          S              2
     D THLKR7          S              2
     D THLKR8          S              2
     D THKNSS          S              8  0
     D THNASS          S             30
     D THADSS1         S             30
     D THPNSS          S              9
     D THPSSS          S             24
     D THLKSS          S              2
     D THSKSS          S              2
     D THTINSS         S             17
     D THKNKS          S              8  0
     D THNAKS          S             30
     D THADKS1         S             30
     D THPNKS          S              9
     D THPSKS          S             24
     D THLKKS          S              2
     D THSKKS          S              2
     D THTINKS         S             17
     D THKNT           S              8  0
     D THNAT           S             30
     D THADT1          S             30
     D THPNT           S              9
     D THPST           S             24
     D THLKT           S              2
     D THSKT           S              2
     D THTINT          S             17
N03  D THVERS          S              1
     D WA              S             15
     D JSONstring      S          32000
     D Error           S            150
      *get input-string
      /Copy syspeds/qrpgsrcpy,prolog3

      * Parse input
     C                   EXSR      Parse
      * Open files etc
     C                   EXSR      INIT
      *
     c                   callp     gethtmlifs(
     C                             '/syspeddev/html/JSON.html':
     C                             '/CGITAG/')
     C                   callp     wrtsection('top')
      * Teste input og utfør
     C  N50              EXSR      TEST

      * ............................................................................................
      * skriv JSON-Object start..(alltid '{' + x ant param. m/komma mellom (IKKE komma etter siste))
      * ............................................................................................
      *
      /free
        JSONstring='{'
        +'¬user¬ : ¬'+%trim(WSUSER)+'¬, '
        +'¬thavd¬ : ¬'+%trim(%editc(THAVD:'Z'))+'¬, '
        +'¬thtdn¬ : ¬'+%trim(%editc(THTDN:'Z'))+'¬, '
        +'¬newavd¬ : ¬'+%trim(%editc(NEWAVD:'Z'))+'¬, '
        +'¬newopd¬ : ¬'+%trim(%editc(NEWOPD:'Z'))+'¬, '
        +'¬newsign¬ : ¬'+%trim(NEWSIGN)+'¬, '
        +'¬mode¬ : ¬'+%trim(WMODE)+'¬, '
        +'¬thtuid¬ : ¬'+%trim(THTUID)+'¬, '
        +'¬thsg¬ : ¬'+%trim(THSG)+'¬, '
        +'¬thst¬ : ¬'+%trim(THST)+'¬, '
        +'¬thdt¬ : ¬'+%trim(%editc(THDT:'Z'))+'¬, '
        +'¬thpro¬ : ¬'+%trim(%editc(THPRO:'Z'))+'¬, '
        +'¬thenkl¬ : ¬'+%trim(THENKL)+'¬, '
        +'¬thdk¬ : ¬'+%trim(THDK)+'¬, '
        +'¬thkna¬ : ¬'+%trim(%editc(THKNA:'Z'))+'¬, '
        +'¬thnaa¬ : ¬'+%trim(THNAA)+'¬, '
        +'¬thada1¬ : ¬'+%trim(THADA1)+'¬, '
        +'¬thpna¬ : ¬'+%trim(THPNA)+'¬, '
        +'¬thpsa¬ : ¬'+%trim(THPSA)+'¬, '
        +'¬thlka¬ : ¬'+%trim(THLKA)+'¬, '
        +'¬thska¬ : ¬'+%trim(THSKA)+'¬, '
        +'¬thtina¬ : ¬'+%trim(THTINA)+'¬, '
        +'¬thkns¬ : ¬'+%trim(%editc(THKNS:'Z'))+'¬, '
        +'¬thnas¬ : ¬'+%trim(THNAS)+'¬, '
        +'¬thads1¬ : ¬'+%trim(THADS1)+'¬, '
        +'¬thpns¬ : ¬'+%trim(THPNS)+'¬, '
        +'¬thpss¬ : ¬'+%trim(THPSS)+'¬, '
        +'¬thlks¬ : ¬'+%trim(THLKS)+'¬, '
        +'¬thsks¬ : ¬'+%trim(THSKS)+'¬, '
        +'¬thtins¬ : ¬'+%trim(THTINS)+'¬, '
        +'¬thknk¬ : ¬'+%trim(%editc(THKNK:'Z'))+'¬, '
        +'¬thnak¬ : ¬'+%trim(THNAK)+'¬, '
        +'¬thadk1¬ : ¬'+%trim(THADK1)+'¬, '
        +'¬thpnk¬ : ¬'+%trim(THPNK)+'¬, '
        +'¬thpsk¬ : ¬'+%trim(THPSK)+'¬, '
        +'¬thlkk¬ : ¬'+%trim(THLKK)+'¬, '
        +'¬thskk¬ : ¬'+%trim(THSKK)+'¬, '
        +'¬thtink¬ : ¬'+%trim(THTINK)+'¬, '
        +'¬thblk¬ : ¬'+%trim(THBLK)+'¬, '
        +'¬thlsd¬ : ¬'+%trim(THLSD)+'¬, '
        +'¬thlasd¬ : ¬'+%trim(THLASD)+'¬, '
        +'¬thlas2¬ : ¬'+%trim(THLAS2)+'¬, '
        +'¬thalk¬ : ¬'+%trim(THALK)+'¬, '
        +'¬thtrm¬ : ¬'+%trim(%editc(THTRM:'Z'))+'¬, '
        +'¬thtrmi¬ : ¬'+%trim(%editc(THTRMI:'Z'))+'¬, '
        +'¬thtaid¬ : ¬'+%trim(THTAID)+'¬, '
        +'¬thtask¬ : ¬'+%trim(THTASK)+'¬, '
        +'¬thtalk¬ : ¬'+%trim(THTALK)+'¬, '
        +'¬thtgid¬ : ¬'+%trim(THTGID)+'¬, '
        +'¬thtgsk¬ : ¬'+%trim(THTGSK)+'¬, '
        +'¬thtglk¬ : ¬'+%trim(THTGLK)+'¬, '
        +'¬thskfd¬ : ¬'+%trim(THSKFD)+'¬, '
        +'¬thcats¬ : ¬'+%trim(THCATS)+'¬, '
        +'¬thtsd1¬ : ¬'+%trim(THTSD1)+'¬, '
        +'¬thtsd2¬ : ¬'+%trim(THTSD2)+'¬, '
        +'¬thtsd3¬ : ¬'+%trim(THTSD3)+'¬, '
        +'¬thtsd4¬ : ¬'+%trim(THTSD4)+'¬, '
        +'¬thtsd5¬ : ¬'+%trim(THTSD5)+'¬, '
        +'¬thtsd6¬ : ¬'+%trim(THTSD6)+'¬, '
        +'¬thtsd7¬ : ¬'+%trim(THTSD7)+'¬, '
        +'¬thtsd8¬ : ¬'+%trim(THTSD8)+'¬, '
        +'¬thtsb¬ : ¬'+%trim(THTSB)+'¬, '
        +'¬thddt¬ : ¬'+%trim(%editc(THDDT:'Z'))+'¬, '
        +'¬thdfkd¬ : ¬'+%trim(THDFKD)+'¬, '
        +'¬thdfsk¬ : ¬'+%trim(THDFSK)+'¬, '
        +'¬thdkr¬ : ¬'+%trim(THDKR)+'¬, '
        +'¬thdant¬ : ¬'+%trim(%editc(THDANT:'Z'))+'¬, '
        +'¬thddtk¬ : ¬'+%trim(%editc(THDDTK:'Z'))+'¬, '
        +'¬thdats¬ : ¬'+%trim(THDATS)+'¬, '
        +'¬thdkav¬ : ¬'+%trim(THDKAV)+'¬, '
        +'¬thdksk¬ : ¬'+%trim(THDKSK)+'¬, '
        +'¬thgkd¬ : ¬'+%trim(%editc(THGKD:'3'))+'¬, '
        +'¬thgft1¬ : ¬'+%trim(THGFT1)+'¬, '
        +'¬thgft2¬ : ¬'+%trim(THGFT2)+'¬, '
        +'¬thgadk¬ : ¬'+%trim(THGADK)+'¬, '
        +'¬thgbl¬ : ¬'+%trim(%editc(THGBL:'K'))+'¬, '
        +'¬thgvk¬ : ¬'+%trim(THGVK)+'¬, '
        +'¬thgbgi¬ : ¬'+%trim(%editc(THGBGI:'3'))+'¬, '
        +'¬thgbgu¬ : ¬'+%trim(THGBGU)+'¬, '
        +'¬thkdc¬ : ¬'+%trim(THKDC)+'¬, '
        +'¬thtssd¬ : ¬'+%trim(THTSSD)+'¬, '
        +'¬thtsn1¬ : ¬'+%trim(THTSN1)+'¬, '
        +'¬thtsn2¬ : ¬'+%trim(THTSN2)+'¬, '
        +'¬thtspn¬ : ¬'+%trim(THTSPN)+'¬, '
        +'¬thtslk¬ : ¬'+%trim(THTSLK)+'¬, '
        +'¬thtssk¬ : ¬'+%trim(THTSSK)+'¬, '
        +'¬thlstl¬ : ¬'+%trim(%editc(THLSTL:'Z'))+'¬, '
        +'¬thvpos¬ : ¬'+%trim(%editc(THVPOS:'Z'))+'¬, '
        +'¬thntk¬ : ¬'+%trim(%editc(THNTK:'Z'))+'¬, '
        +'¬thvkb¬ : ¬'+%trim(%editc(THVKB:'4'))+'¬, '
        +'¬thdst¬ : ¬'+%trim(THDST)+'¬, '
        +'¬thdstn¬ : ¬'+%trim(THDSTN)+'¬, '
        +'¬thdsk¬ : ¬'+%trim(THDSK)+'¬, '
        +'¬thtarf¬ : ¬'+%trim(THTARF)+'¬, '
        +'¬thws¬ : ¬'+%trim(THWS)+'¬, '
        +'¬thtrnr¬ : ¬'+%trim(THTRNR)+'¬, '
        +'¬thtrdt¬ : ¬'+%trim(%editc(THTRDT:'Z'))+'¬, '
        +'¬thomd¬ : ¬'+%trim(%editc(THOMD:'Z'))+'¬, '
        +'¬thbind¬ : ¬'+%trim(THBIND)+'¬, '
        +'¬thtet¬ : ¬'+%trim(%editc(THTET:'Z'))+'¬, '
        +'¬thmf¬ : ¬'+%trim(THMF)+'¬, '
        +'¬thmp¬ : ¬'+%trim(%editc(THMP:'Z'))+'¬, '
        +'¬thpkl¬ : ¬'+%trim(THPKL)+'¬, '
        +'¬thkdv¬ : ¬'+%trim(THKDV)+'¬, '
        +'¬th0035¬ : ¬'+%trim(TH0035)+'¬, '
        +'¬dkxh_0035¬ : ¬'+%trim(DKXH_0035)+'¬, '
        +'¬thsgdk¬ : ¬'+%trim(THSGDK)+'¬, '
        +'¬thsgme¬ : ¬'+%trim(THSGME)+'¬, '
        +'¬thsgut¬ : ¬'+%trim(THSGUT)+'¬, '
        +'¬thsgid¬ : ¬'+%trim(THSGID)+'¬, '
        +'¬thsgdt¬ : ¬'+%trim(THSGDT)+'¬, '
        +'¬thbyte¬ : ¬'+%trim(%editc(THBYTE:'Z'))+'¬, '
          +'¬thsik¬ : ¬'+%trim(%editc(THSIK:'Z'))+'¬, '
          +'¬thdta¬ : ¬'+%trim(%editc(THDTA:'Z'))+'¬, '
          +'¬thtma¬ : ¬'+%trim(%editc(THTMA:'Z'))+'¬, '
          +'¬thspom¬ : ¬'+%trim(THSPOM)+'¬,'
          +'¬thtkbm¬ : ¬'+%trim(THTKBM)+'¬,'
          +'¬thkref¬ : ¬'+%trim(THKREF)+'¬,'
          +'¬thtref¬ : ¬'+%trim(THTREF)+'¬,'
          +'¬thlosd¬ : ¬'+%trim(THLOSD)+'¬,'
          +'¬thlosdsk¬ : ¬'+%trim(THLOSDSK)+'¬,'
          +'¬thlkr1¬ : ¬'+%trim(THLKR1)+'¬,'
          +'¬thlkr2¬ : ¬'+%trim(THLKR2)+'¬,'
          +'¬thlkr3¬ : ¬'+%trim(THLKR3)+'¬,'
          +'¬thlkr4¬ : ¬'+%trim(THLKR4)+'¬,'
          +'¬thlkr5¬ : ¬'+%trim(THLKR5)+'¬,'
          +'¬thlkr6¬ : ¬'+%trim(THLKR6)+'¬,'
          +'¬thlkr7¬ : ¬'+%trim(THLKR7)+'¬,'
          +'¬thlkr8¬ : ¬'+%trim(THLKR8)+'¬,'
          +'¬thknss¬ : ¬'+%trim(%editc(THKNSS:'Z'))+'¬, '
          +'¬thnass¬ : ¬'+%trim(THNASS)+'¬,'
          +'¬thadss1¬ : ¬'+%trim(THADSS1)+'¬,'
          +'¬thpnss¬ : ¬'+%trim(THPNSS)+'¬,'
          +'¬thpsss¬ : ¬'+%trim(THPSSS)+'¬,'
          +'¬thlkss¬ : ¬'+%trim(THLKSS)+'¬,'
          +'¬thskss¬ : ¬'+%trim(THSKSS)+'¬,'
          +'¬thtinss¬ : ¬'+%trim(THTINSS)+'¬,'
          +'¬thknks¬ : ¬'+%trim(%editc(THKNKS:'Z'))+'¬, '
          +'¬thnaks¬ : ¬'+%trim(THNAKS)+'¬,'
          +'¬thadks1¬ : ¬'+%trim(THADKS1)+'¬,'
          +'¬thpnks¬ : ¬'+%trim(THPNKS)+'¬,'
          +'¬thpsks¬ : ¬'+%trim(THPSKS)+'¬,'
          +'¬thlkks¬ : ¬'+%trim(THLKKS)+'¬,'
          +'¬thskks¬ : ¬'+%trim(THSKKS)+'¬,'
          +'¬thtinks¬ : ¬'+%trim(THTINKS)+'¬,'
          +'¬thknt¬ : ¬'+%trim(%editc(THKNT:'Z'))+'¬, '
          +'¬thnat¬ : ¬'+%trim(THNAT)+'¬,'
          +'¬thadt1¬ : ¬'+%trim(THADT1)+'¬,'
          +'¬thpnt¬ : ¬'+%trim(THPNT)+'¬,'
          +'¬thpst¬ : ¬'+%trim(THPST)+'¬,'
          +'¬thlkt¬ : ¬'+%trim(THLKT)+'¬,'
          +'¬thskt¬ : ¬'+%trim(THSKT)+'¬,'
          +'¬thtint¬ : ¬'+%trim(THTINT)+'¬, '
          +'¬thvers¬ : ¬'+%trim(THVERS)+'¬, '
        +'¬errMsg¬ : ¬'+%trim(Error)+'¬, ';
      /end-free
      * JSONfix escaper " i tekst,  for deretter å bytte ¬->"
     c                   call      'JSONFIX'
     c                   parm                    JSONstring
CB   C*                  callp     updHTMLvar('JSONstring':JSONstring)
CB   C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      *
      * ............................................................................................
      * Skriv JSON-LISTE Start (en liste er EN parameter(fra [ til   )
      * ............................................................................................
     c                   eval      JSONstring ='"orderupdate" : ['
CB   C*                  callp     updHTMLvar('JSONstring':JSONstring)
CB   C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      * ............................................................................................
      * Skriv JSON-Liste/Array  Avslutning
      * ............................................................................................
     c                   eval      JSONstring =']'
CB   C*                  callp     updHTMLvar('JSONstring':JSONstring)
CB   C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      * ............................................................................................
      * Skriv JSON-string Avsluttning
      * ............................................................................................
     c                   eval      JSONstring ='}'
CB   C*                  callp     updHTMLvar('JSONstring':JSONstring)
CB   C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      *
      * Quit
     C                   exsr      Exit


      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Lukk fil
     C                   CLOSE     BRIDF
N02  C  N50              CLOSE     DKXGH
     C  N50              CLOSE     DKXH
     C  N50              CLOSE     DKXHFV
     C  N50              CLOSE     DKXSTD
     C  N50              CLOSE     DKTHA
     C  N50              CLOSE     DKTHA2
     C  N50              CLOSE     FRISOK
     C  N50              CLOSE     FRISOL01
     C  N50              CLOSE     HEADF
     C  N50              CLOSE     DKEH

      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      * Quit
     C                   MOVE      *ON           *INLR
     C                   return
     C                   endsr
      *
      *********************************************************
     C     Parse         Begsr
      *********************************************************
      * Get input
     C                   EVAL      WSUSER   = zhbgetvar('USER')
     C                   EVAL      THAVD_A  = zhbgetvar('THAVD')
     C                   EVAL      THAVD    = c2n2(THAVD_A)
     C                   EVAL      THTDN_A  = zhbgetvar('THTDN')
     C                   EVAL      THTDN    = c2n2(THTDN_A)
     C                   EVAL      NEWSYAVA = zhbgetvar('NEWAVD')
     C                   EVAL      NEWAVD   = c2n2(NEWSYAVA)
     C                   EVAL      NEWSIGN  = zhbgetvar('NEWSIGN')
     C                   EVAL      WMODE    = zhbgetvar('MODE')
     C                   EVAL      THSG     = zhbgetvar('THSG')
     C                   EVAL      WSIGN    = zhbgetvar('SIGN')
     C                   EVAL      THXREF   = zhbgetvar('THXREF')
     C                   EVAL      THST     = zhbgetvar('THST')
     C                   EVAL      THDT_A   = zhbgetvar('THDT')
     C                   EVAL      THDT     = c2n2(THDT_A)
     C                   EVAL      THPRO_A  = zhbgetvar('THPRO')
     C                   EVAL      THPRO    = c2n2(THPRO_A)
     C                   EVAL      THENKL   = zhbgetvar('THENKL')
     C                   EVAL      THDK     = zhbgetvar('THDK')
     C                   EVAL      THKNA_A  = zhbgetvar('THKNA')
     C                   EVAL      THKNA    = c2n2(THKNA_A)
     C                   EVAL      THNAA    = zhbgetvar('THNAA')
     C                   EVAL      THADA1   = zhbgetvar('THADA1')
     C                   EVAL      THPNA    = zhbgetvar('THPNA')
     C                   EVAL      THPSA    = zhbgetvar('THPSA')
     C                   EVAL      THLKA    = zhbgetvar('THLKA')
     C                   EVAL      THSKA    = zhbgetvar('THSKA')
     C                   EVAL      THTINA   = zhbgetvar('THTINA')
     C                   EVAL      THKNS_A  = zhbgetvar('THKNS')
     C                   EVAL      THKNS    = c2n2(THKNS_A)
     C                   EVAL      THNAS    = zhbgetvar('THNAS')
     C                   EVAL      THADS1   = zhbgetvar('THADS1')
     C                   EVAL      THPNS    = zhbgetvar('THPNS')
     C                   EVAL      THPSS    = zhbgetvar('THPSS')
     C                   EVAL      THLKS    = zhbgetvar('THLKS')
     C                   EVAL      THSKS    = zhbgetvar('THSKS')
     C                   EVAL      THTINS   = zhbgetvar('THTINS')
     C                   EVAL      THKNK_A  = zhbgetvar('THKNK')
     C                   EVAL      THKNK    = c2n2(THKNK_A)
     C                   EVAL      THNAK    = zhbgetvar('THNAK')
     C                   EVAL      THADK1   = zhbgetvar('THADK1')
     C                   EVAL      THPNK    = zhbgetvar('THPNK')
     C                   EVAL      THPSK    = zhbgetvar('THPSK')
     C                   EVAL      THLKK    = zhbgetvar('THLKK')
     C                   EVAL      THSKK    = zhbgetvar('THSKK')
     C                   EVAL      THTINK   = zhbgetvar('THTINK')
     C                   EVAL      THBLK    = zhbgetvar('THBLK')
     C                   EVAL      THLSD    = zhbgetvar('THLSD')
     C                   EVAL      THLASD   = zhbgetvar('THLASD')
     C                   EVAL      THLAS2   = zhbgetvar('THLAS2')
     C                   EVAL      THALK    = zhbgetvar('THALK')
     C                   EVAL      THTRM_A  = zhbgetvar('THTRM')
     C                   EVAL      THTRM    = c2n2(THTRM_A)
     C                   EVAL      THTRMI_A = zhbgetvar('THTRMI')
     C                   EVAL      THTRMI   = c2n2(THTRMI_A)
     C                   EVAL      THTAID   = zhbgetvar('THTAID')
     C                   EVAL      THTASK   = zhbgetvar('THTASK')
     C                   EVAL      THTALK   = zhbgetvar('THTALK')
     C                   EVAL      THTGID   = zhbgetvar('THTGID')
     C                   EVAL      THTGSK   = zhbgetvar('THTGSK')
     C                   EVAL      THTGLK   = zhbgetvar('THTGLK')
     C                   EVAL      THSKFD   = zhbgetvar('THSKFD')
     C                   EVAL      THCATS   = zhbgetvar('THCATS')
     C                   EVAL      THTSD1   = zhbgetvar('THTSD1')
     C                   EVAL      THTSD2   = zhbgetvar('THTSD2')
     C                   EVAL      THTSD3   = zhbgetvar('THTSD3')
     C                   EVAL      THTSD4   = zhbgetvar('THTSD4')
     C                   EVAL      THTSD5   = zhbgetvar('THTSD5')
     C                   EVAL      THTSD6   = zhbgetvar('THTSD6')
     C                   EVAL      THTSD7   = zhbgetvar('THTSD7')
     C                   EVAL      THTSD8   = zhbgetvar('THTSD8')
     C                   EVAL      THTSB    = zhbgetvar('THTSB')
     C                   EVAL      THDDT_A  = zhbgetvar('THDDT')
     C                   EVAL      THDDT    = c2n2(THDDT_A)
     C                   EVAL      THDFKD   = zhbgetvar('THDFKD')
     C                   EVAL      THDFSK   = zhbgetvar('THDFSK')
     C                   EVAL      THDKR    = zhbgetvar('THDKR')
     C                   EVAL      THDANT_A = zhbgetvar('THDANT')
     C                   EVAL      THDANT   = c2n2(THDANT_A)
     C                   EVAL      THDDTK_A = zhbgetvar('THDDTK')
     C                   EVAL      THDDTK   = c2n2(THDDTK_A)
     C                   EVAL      THDATS   = zhbgetvar('THDATS')
     C                   EVAL      THDKAV   = zhbgetvar('THDKAV')
     C                   EVAL      THDKSK   = zhbgetvar('THDKSK')
     C                   EVAL      THGKD_A  = zhbgetvar('THGKD')
     C                   EVAL      THGKD    = c2n2(THGKD_A)
     C                   EVAL      THGFT1   = zhbgetvar('THGFT1')
     C                   EVAL      THGFT2   = zhbgetvar('THGFT2')
     C                   EVAL      THGADK   = zhbgetvar('THGADK')
     C                   EVAL      THGBL_A  = zhbgetvar('THGBL')
     C                   EVAL      THGBL    = c2n2(THGBL_A)
     C                   EVAL      THGVK    = zhbgetvar('THGVK')
     C                   EVAL      THGBGI_A = zhbgetvar('THGBGI')
     C                   EVAL      THGBGI   = c2n2(THGBGI_A)
     C                   EVAL      THGBGU   = zhbgetvar('THGBGU')
     C                   EVAL      THKDC    = zhbgetvar('THKDC')
     C                   EVAL      THTSSD   = zhbgetvar('THTSSD')
     C                   EVAL      THTSN1   = zhbgetvar('THTSN1')
     C                   EVAL      THTSN2   = zhbgetvar('THTSN2')
     C                   EVAL      THTSPN   = zhbgetvar('THTSPN')
     C                   EVAL      THTSLK   = zhbgetvar('THTSLK')
     C                   EVAL      THTSSK   = zhbgetvar('THTSSK')
     C                   EVAL      THLSTL_A = zhbgetvar('THLSTL')
     C                   EVAL      THLSTL   = c2n2(THLSTL_A)
     C                   EVAL      THVPOS_A = zhbgetvar('THVPOS')
     C                   EVAL      THVPOS   = c2n2(THVPOS_A)
     C                   EVAL      THNTK_A  = zhbgetvar('THNTK')
     C                   EVAL      THNTK    = c2n2(THNTK_A)
     C                   EVAL      THVKB_A  = zhbgetvar('THVKB')
     C                   EVAL      THVKB    = c2n2(THVKB_A)
     C                   EVAL      THDST    = zhbgetvar('THDST')
N01  C                   EVAL      THDSTN   = zhbgetvar('THDSTN')
     C                   EVAL      THDSK    = zhbgetvar('THDSK')
     C                   EVAL      THWS     = zhbgetvar('THWS')
     C                   EVAL      THTRNR   = zhbgetvar('THTRNR')
     C                   EVAL      THTRDT_A = zhbgetvar('THTRDT')
     C                   EVAL      THTRDT   = c2n2(THTRDT_A)
     C                   EVAL      THOMD_A  = zhbgetvar('THOMD')
     C                   EVAL      THOMD    = c2n2(THOMD_A)
     C                   EVAL      THBIND   = zhbgetvar('THBIND')
     C                   EVAL      THTET_A  = zhbgetvar('THTET')
     C                   EVAL      THTET    = c2n2(THTET_A)
     C                   EVAL      THMF     = zhbgetvar('THMF')
     C                   EVAL      THMP_A   = zhbgetvar('THMP')
     C                   EVAL      THMP     = c2n2(THMP_A)
     C                   EVAL      THPKL    = zhbgetvar('THPKL')
     C                   EVAL      THKDV    = zhbgetvar('THKDV')
     C                   EVAL      DKXH_0035= zhbgetvar('DKXH_0035')
     C                   EVAL      WA       = zhbgetvar('THSIK')
     C                   EVAL      THSIK    = c2n2(WA)
     C                   EVAL      WA       = zhbgetvar('THDTA')
     C                   EVAL      THDTA    = c2n2(WA)
     C                   EVAL      WA       = zhbgetvar('THTMA')
     C                   EVAL      THTMA    = c2n2(WA)
     C                   EVAL      THSPOM   = zhbgetvar('THSPOM')
     C                   EVAL      THTKBM   = zhbgetvar('THTKBM')
     C                   EVAL      THKREF   = zhbgetvar('THKREF')
     C                   EVAL      THTREF   = zhbgetvar('THTREF')
     C                   EVAL      THLOSD   = zhbgetvar('THLOSD')
     C                   EVAL      THLOSDSK = zhbgetvar('THLOSDSK')
     C                   EVAL      THLKR1   = zhbgetvar('THLKR1')
     C                   EVAL      THLKR2   = zhbgetvar('THLKR2')
     C                   EVAL      THLKR3   = zhbgetvar('THLKR3')
     C                   EVAL      THLKR4   = zhbgetvar('THLKR4')
     C                   EVAL      THLKR5   = zhbgetvar('THLKR5')
     C                   EVAL      THLKR6   = zhbgetvar('THLKR6')
     C                   EVAL      THLKR7   = zhbgetvar('THLKR7')
     C                   EVAL      THLKR8   = zhbgetvar('THLKR8')
     C                   EVAL      WA       = zhbgetvar('THKNSS')
     C                   EVAL      THKNSS   = c2n2(WA)
     C                   EVAL      THNASS   = zhbgetvar('THNASS')
     C                   EVAL      THADSS1  = zhbgetvar('THADSS1')
     C                   EVAL      THPNSS   = zhbgetvar('THPNSS')
     C                   EVAL      THPSSS   = zhbgetvar('THPSSS')
     C                   EVAL      THLKSS   = zhbgetvar('THLKSS')
     C                   EVAL      THSKSS   = zhbgetvar('THSKSS')
     C                   EVAL      THTINSS  = zhbgetvar('THTINSS')
     C                   EVAL      WA       = zhbgetvar('THKNKS')
     C                   EVAL      THKNKS   = c2n2(WA)
     C                   EVAL      THNAKS   = zhbgetvar('THNAKS')
     C                   EVAL      THADKS1  = zhbgetvar('THADKS1')
     C                   EVAL      THPNKS   = zhbgetvar('THPNKS')
     C                   EVAL      THPSKS   = zhbgetvar('THPSKS')
     C                   EVAL      THLKKS   = zhbgetvar('THLKKS')
     C                   EVAL      THSKKS   = zhbgetvar('THSKKS')
     C                   EVAL      THTINKS  = zhbgetvar('THTINKS')
     C                   EVAL      WA       = zhbgetvar('THKNT')
     C                   EVAL      THKNT    = c2n2(WA)
     C                   EVAL      THNAT    = zhbgetvar('THNAT')
     C                   EVAL      THADT1   = zhbgetvar('THADT1')
     C                   EVAL      THPNT    = zhbgetvar('THPNT')
     C                   EVAL      THPST    = zhbgetvar('THPST')
     C                   EVAL      THLKT    = zhbgetvar('THLKT')
     C                   EVAL      THSKT    = zhbgetvar('THSKT')
     C                   EVAL      THTINT   = zhbgetvar('THTINT')
N03  C                   EVAL      THVERS   = zhbgetvar('THVERS')
     c                   ENDSR
      *********************************************************
     C     INIT          Begsr
      *********************************************************
     C                   OPEN      BRIDF
      * Test innlogging
     C     WSUSER        CHAIN     BRIDF                              50
     C  N50BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C                   call      BILIBL
     C                   end

     C     DKXHKey       klist
     C                   kfld                    THAVD
     C                   kfld                    THTDN
     C     DKXHKeyG      klist
     C                   kfld                    GM_THAVD
     C                   kfld                    GM_THTDN
     C     FRIKEY        klist
     C                   kfld                    THAVD
     C                   kfld                    THTDN
     C                   KFLD                    WFSKODE           3
     C     FRIKEY01      KLIST
     C                   KFLD                    WFSKODE
     C                   KFLD                    THXREF

     C     *LIKE         DEFINE    X_THAVD       GM_THAVD
     C     *LIKE         DEFINE    X_THTDN       GM_THTDN
     C                   EVAL      WFSKODE='*CE'
      *
     C   50              eval      Error = 'Invalid userID'
N02  C  N50              OPEN      DKXGH
     C  N50              OPEN      DKXH
     C  N50              OPEN      DKXHFV
     C  N50              OPEN      DKXSTD
     C  N50              OPEN      DKTHA
     C  N50              OPEN      DKTHA2
     C  N50              OPEN      FRISOK
     C  N50              OPEN      FRISOL01
     C  N50              OPEN      HEADF
     C  N50              OPEN      DKEH
      *_________________________________
      * Hæmta dagens datum och klockslag
      *"""""""""""""""""""""""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C  N50THSG          CHAIN     DKTHA                              33
     C                   MOVEL     DKTH_NAMN     THTARF
      * MODE=GS
     C     WMODE         IFEQ      'GS'
     C     THXREF        ANDNE     *BLANKS
     C     *IN50         ANDEQ     *OFF
     C     FRIKEY01      CHAIN     FRISOL01                           56
     C                   IF        *IN56=*OFF
     C                   EVAL      THAVD=FSAVD
     C                   EVAL      THTDN=FSOPD
     C                   ENDIF
     C                   ENDIF

     c                   endsr
      *
      *______________________________________________________
      * TEST                                             TEST
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     TEST          BEGSR
      * Hæmta userid
     C     WSUSER        CHAIN     DKTHA2
      * Hæmta ærende
     C     WMODE         IFNE      'A'
     C     DKXHKey       CHAIN     DKXH                               55
     C     DKXHKey       CHAIN     DKXHFV                             34
     C                   ENDIF
      * MODE A=Add  D=Delete  U=Update  GS=Hæmta från SYSPED
     C                   SELECT
     C     WMODE         WHENEQ    'A'
     C                   eval      Error = *blanks
     C                   EXSR      SRA
     C     WMODE         WHENEQ    'GS'
     C                   eval      Error = *blanks
     C  N55              eval      Error = 'Fel, finns redan'
     C   55              EXSR      SRGS
     C     WMODE         WHENEQ    'C'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   UPDATE    DKXHR
     C  N34              UPDATE    DKXHFVR
     C                   eval      Error = *blanks
     C                   EXSR      SRC
     C                   ENDIF
     C     WMODE         WHENEQ    'D'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   eval      Error = *blanks
     C                   EXSR      SRD
     C                   ENDIF
     C     WMODE         WHENEQ    'S'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   eval      Error = *blanks
     C                   EXSR      SRS
     C                   ENDIF
     C     WMODE         WHENEQ    'U'
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   eval      Error = *blanks
     C                   EXSR      SRU
     C                   ENDIF
     C                   OTHER
     C                   eval      Error = 'Wrong mode'
     C                   ENDSL
     C                   ENDSR
      *______________________________________________________
      * Add                                               SRA
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRA           BEGSR
     C                   CLEAR                   DKXHR
     C                   CLEAR                   DKXHFVR
      * Hæmta uppdragsnummer
     C     THAVD         CHAIN     DKXSTD                             52
     C                   ADD       1             X_THTDN
     C                   UPDATE    DKXSTDR
     C                   EVAL      THTDN    = X_THTDN
     C                   EVAL      THST     = ' '
     C                   EVAL      X_THST   = ' '
     C                   EVAL      X_THSG   = WSIGN
     C                   MOVEL     WDT           X_THDT
     C                   MOVEL     WDT           THDT
      * Hæmta tullid
     C                   CALL      'SVG001R'
     C                   PARM                    WTUID            10
     C                   MOVE      UYEAR         XÅR               2
     C                   EVAL      X_THTUID = 'DK' + XÅR + WTUID
      * Write
     C                   WRITE     DKXHR
     C                   IF        X_THSIK>0
     C                   WRITE     DKXHFVR
     C                   ENDIF
N02   * Legg inn nytt garantibeløp
N02  C                   IF        X_THGFT1 <> *BLANKS AND
N02  C                             (X_THGKD <= 1 OR X_THGKD >= 6)
N02  C     X_THGFT1      CHAIN     DKXGH                              30
N02  C  N30              EVAL      TGGBLB = TGGBLB + X_THGBL
N02  C  N30              UPDATE    DKXGHR
N02  C                   END
N02   *
      * Oppdater WEB-variabler
     C                   EVAL      THTUID   = X_THTUID
     C                   EVAL      THSG     = X_THSG
     C                   EVAL      THST     = X_THST
     C                   EVAL      THDT     = X_THDT
     C                   EVAL      THTUID   = X_THTUID
     C                   EVAL      THPRO    = X_THPRO
     C                   EVAL      THENKL   = X_THENKL
     C                   EVAL      THDK     = X_THDK
     C                   EVAL      THKNA    = X_THKNA
     C                   EVAL      THNAA    = X_THNAA
     C                   EVAL      THADA1   = X_THADA1
     C                   EVAL      THPNA    = X_THPNA
     C                   EVAL      THPSA    = X_THPSA
     C                   EVAL      THLKA    = X_THLKA
     C                   EVAL      THSKA    = X_THSKA
     C                   EVAL      THTINA   = X_THTINA
     C                   EVAL      THKNS    = X_THKNS
     C                   EVAL      THNAS    = X_THNAS
     C                   EVAL      THADS1   = X_THADS1
     C                   EVAL      THPNS    = X_THPNS
     C                   EVAL      THPSS    = X_THPSS
     C                   EVAL      THLKS    = X_THLKS
     C                   EVAL      THSKS    = X_THSKS
     C                   EVAL      THTINS   = X_THTINS
     C                   EVAL      THKNK    = X_THKNK
     C                   EVAL      THNAK    = X_THNAK
     C                   EVAL      THADK1   = X_THADK1
     C                   EVAL      THPNK    = X_THPNK
     C                   EVAL      THPSK    = X_THPSK
     C                   EVAL      THLKK    = X_THLKK
     C                   EVAL      THSKK    = X_THSKK
     C                   EVAL      THTINK   = X_THTINK
     C                   EVAL      THBLK    = X_THBLK
     C                   EVAL      THLSD    = X_THLSD
     C                   EVAL      THLASD   = X_THLASD
     C                   EVAL      THLAS2   = X_THLAS2
     C                   EVAL      THALK    = X_THALK
     C                   EVAL      THTRM    = X_THTRM
     C                   EVAL      THTRMI   = X_THTRMI
     C                   EVAL      THTAID   = X_THTAID
     C                   EVAL      THTASK   = X_THTASK
     C                   EVAL      THTALK   = X_THTALK
     C                   EVAL      THTGID   = X_THTGID
     C                   EVAL      THTGSK   = X_THTGSK
     C                   EVAL      THTGLK   = X_THTGLK
     C                   EVAL      THSKFD   = X_THSKFD
     C                   EVAL      THCATS   = X_THCATS
     C                   EVAL      THTSD1   = X_THTSD1
     C                   EVAL      THTSD2   = X_THTSD2
     C                   EVAL      THTSD3   = X_THTSD3
     C                   EVAL      THTSD4   = X_THTSD4
     C                   EVAL      THTSD5   = X_THTSD5
     C                   EVAL      THTSD6   = X_THTSD6
     C                   EVAL      THTSD7   = X_THTSD7
     C                   EVAL      THTSD8   = X_THTSD8
     C                   EVAL      THTSB    = X_THTSB
     C                   EVAL      THDDT    = X_THDDT
     C                   EVAL      THDFKD   = X_THDFKD
     C                   EVAL      THDFSK   = X_THDFSK
     C                   EVAL      THDKR    = X_THDKR
     C                   EVAL      THDANT   = X_THDANT
     C                   EVAL      THDKAV   = X_THDKAV
     C                   EVAL      THDKSK   = X_THDKSK
     C                   EVAL      THGKD    = X_THGKD
     C                   EVAL      THGFT1   = X_THGFT1
     C                   EVAL      THGFT2   = X_THGFT2
     C                   EVAL      THGADK   = X_THGADK
     C                   EVAL      THGBL    = X_THGBL
     C                   EVAL      THGVK    = X_THGVK
     C                   EVAL      THGBGI   = X_THGBGI
     C                   EVAL      THGBGU   = X_THGBGU
     C                   EVAL      THKDC    = X_THKDC
     C                   EVAL      THTSSD   = X_THTSSD
     C                   EVAL      THTSN1   = X_THTSN1
     C                   EVAL      THTSN2   = X_THTSN2
     C                   EVAL      THTSPN   = X_THTSPN
     C                   EVAL      THTSLK   = X_THTSLK
     C                   EVAL      THTSSK   = X_THTSSK
     C                   EVAL      THLSTL   = X_THLSTL
     C                   EVAL      THVPOS   = X_THVPOS
     C                   EVAL      THNTK    = X_THNTK
     C                   EVAL      THVKB    = X_THVKB
     C                   EVAL      THDST    = X_THDST
N01  C                   EVAL      THDSTN   = X_THDSTN
     C                   EVAL      THDSK    = X_THDSK
     C                   EVAL      THTARF   = X_THTARF
     C                   EVAL      THWS     = X_THWS
     C                   EVAL      THTRNR   = X_THTRNR
     C                   EVAL      THTRDT   = X_THTRDT
     C                   EVAL      THOMD    = X_THOMD
     C                   EVAL      THBIND   = X_THBIND
     C                   EVAL      THTET    = X_THTET
     C                   EVAL      THMF     = X_THMF
     C                   EVAL      THMP     = X_THMP
     C                   EVAL      THPKL    = X_THPKL
     C                   EVAL      THKDV    = X_THKDV
     C                   EVAL      TH0035   = X_TH0035
     C                   EVAL      DKXH_0035= X_DKXH_0035
     C                   EVAL      THSGDK   = X_THSGDK
     C                   EVAL      THSGUT   = X_THSGUT
     C                   EVAL      THSGID   = X_THSGID
     C                   EVAL      THSGDT   = X_THSGDT
     C                   EVAL      THBYTE   = X_THBYTE
     C                   EVAL      THSIK    = X_THSIK
     C                   EVAL      THDTA    = X_THDTA
     C                   EVAL      THTMA    = X_THTMA
     C                   EVAL      THSPOM   = X_THSPOM
     C                   EVAL      THTKBM   = X_THTKBM
     C                   EVAL      THKREF   = X_THKREF
     C                   EVAL      THTREF   = X_THTREF
     C                   EVAL      THLOSD   = X_THLOSD
     C                   EVAL      THLOSDSK = X_THLOSDSK
     C                   EVAL      THLKR1   = X_THLKR1
     C                   EVAL      THLKR2   = X_THLKR2
     C                   EVAL      THLKR3   = X_THLKR3
     C                   EVAL      THLKR4   = X_THLKR4
     C                   EVAL      THLKR5   = X_THLKR5
     C                   EVAL      THLKR6   = X_THLKR6
     C                   EVAL      THLKR7   = X_THLKR7
     C                   EVAL      THLKR8   = X_THLKR8
     C                   EVAL      THKNSS   = X_THKNSS
     C                   EVAL      THNASS   = X_THNASS
     C                   EVAL      THADSS1  = X_THADSS1
     C                   EVAL      THPNSS   = X_THPNSS
     C                   EVAL      THPSSS   = X_THPSSS
     C                   EVAL      THLKSS   = X_THLKSS
     C                   EVAL      THSKSS   = X_THSKSS
     C                   EVAL      THTINSS  = X_THTINSS
     C                   EVAL      THKNKS   = X_THKNKS
     C                   EVAL      THNAKS   = X_THNAKS
     C                   EVAL      THADKS1  = X_THADKS1
     C                   EVAL      THPNKS   = X_THPNKS
     C                   EVAL      THPSKS   = X_THPSKS
     C                   EVAL      THLKKS   = X_THLKKS
     C                   EVAL      THSKKS   = X_THSKKS
     C                   EVAL      THTINKS  = X_THTINKS
     C                   EVAL      THKNT    = X_THKNT
     C                   EVAL      THNAT    = X_THNAT
     C                   EVAL      THADT1   = X_THADT1
     C                   EVAL      THPNT    = X_THPNT
     C                   EVAL      THPST    = X_THPST
     C                   EVAL      THLKT    = X_THLKT
     C                   EVAL      THSKT    = X_THSKT
     C                   EVAL      THTINT   = X_THTINT
N03  C                   EVAL      THVERS   = X_THVERS
      *
     C                   ENDSR
      *______________________________________________________
      * Copy                                              SRC
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRC           BEGSR
     C                   EVAL      WSIGN = X_THSG
      * Hæmta uppdragsnummer
     C     NEWAVD        CHAIN     DKXSTD                             52
     C                   ADD       1             X_THTDN
     C                   UPDATE    DKXSTDR
     C                   EVAL      NEWOPD   = X_THTDN
      *
     C                   EVAL      GM_THAVD = THAVD
     C                   EVAL      GM_THTDN = THTDN
     C     DKXHKeyG      CHAIN(N)  DKXH                               55
     C     DKXHKeyG      CHAIN(N)  DKXHFV                             34
     C                   EVAL      X_THAVD  = NEWAVD
     C                   EVAL      X_THTDN  = NEWOPD
     C                   EVAL      THAVD    = NEWAVD
     C                   EVAL      THTDN    = NEWOPD
     C                   EVAL      X_THST   = ' '
     C                   EVAL      X_THSG   = NEWSIGN
     C                   MOVEL     WDT           X_THDT
     C                   MOVEL     WDT           THDT
     C                   EVAL      X_THTRNR = *BLANKS
     C                   EVAL      X_THTRDT = 0
     C                   EVAL      X_THOMD  = 0
     C                   EVAL      X_THBIND = *BLANKS
     C                   EVAL      X_THMF   = *BLANKS
     C                   EVAL      X_THMP   = 0
     C                   EVAL      X_THSGDK = *BLANKS
     C                   EVAL      X_THSGME = *BLANKS
     C                   EVAL      X_THSGUT = *BLANKS
     C                   EVAL      X_THSGID = *BLANKS
     C                   EVAL      X_THSGDT = *BLANKS
     C                   EVAL      X_THBYTE = 0
     C                   EVAL      X_THTUID = *BLANKS
      * Hæmta tullid
     C                   CALL      'SVG001R'
     C                   PARM                    WTUID            10
     C                   MOVE      UYEAR         XÅR               2
     C                   EVAL      X_THTUID = 'DK' + XÅR + WTUID
      * Write
     C                   WRITE     DKXHR
     C                   IF        X_THSIK>0
     C                   WRITE     DKXHFVR
     C                   ENDIF
      * Oppdater WEB-variabler
     C                   EVAL      THSG     = X_THSG
     C                   EVAL      THST     = X_THST
     C                   EVAL      THDT     = X_THDT
     C                   EVAL      THTUID   = X_THTUID
     C                   EVAL      THPRO    = X_THPRO
     C                   EVAL      THENKL   = X_THENKL
     C                   EVAL      THDK     = X_THDK
     C                   EVAL      THKNA    = X_THKNA
     C                   EVAL      THNAA    = X_THNAA
     C                   EVAL      THADA1   = X_THADA1
     C                   EVAL      THPNA    = X_THPNA
     C                   EVAL      THPSA    = X_THPSA
     C                   EVAL      THLKA    = X_THLKA
     C                   EVAL      THSKA    = X_THSKA
     C                   EVAL      THTINA   = X_THTINA
     C                   EVAL      THKNS    = X_THKNS
     C                   EVAL      THNAS    = X_THNAS
     C                   EVAL      THADS1   = X_THADS1
     C                   EVAL      THPNS    = X_THPNS
     C                   EVAL      THPSS    = X_THPSS
     C                   EVAL      THLKS    = X_THLKS
     C                   EVAL      THSKS    = X_THSKS
     C                   EVAL      THTINS   = X_THTINS
     C                   EVAL      THKNK    = X_THKNK
     C                   EVAL      THNAK    = X_THNAK
     C                   EVAL      THADK1   = X_THADK1
     C                   EVAL      THPNK    = X_THPNK
     C                   EVAL      THPSK    = X_THPSK
     C                   EVAL      THLKK    = X_THLKK
     C                   EVAL      THSKK    = X_THSKK
     C                   EVAL      THTINK   = X_THTINK
     C                   EVAL      THBLK    = X_THBLK
     C                   EVAL      THLSD    = X_THLSD
     C                   EVAL      THLASD   = X_THLASD
     C                   EVAL      THLAS2   = X_THLAS2
     C                   EVAL      THALK    = X_THALK
     C                   EVAL      THTRM    = X_THTRM
     C                   EVAL      THTRMI   = X_THTRMI
     C                   EVAL      THTAID   = X_THTAID
     C                   EVAL      THTASK   = X_THTASK
     C                   EVAL      THTALK   = X_THTALK
     C                   EVAL      THTGID   = X_THTGID
     C                   EVAL      THTGSK   = X_THTGSK
     C                   EVAL      THTGLK   = X_THTGLK
     C                   EVAL      THSKFD   = X_THSKFD
     C                   EVAL      THCATS   = X_THCATS
     C                   EVAL      THTSD1   = X_THTSD1
     C                   EVAL      THTSD2   = X_THTSD2
     C                   EVAL      THTSD3   = X_THTSD3
     C                   EVAL      THTSD4   = X_THTSD4
     C                   EVAL      THTSD5   = X_THTSD5
     C                   EVAL      THTSD6   = X_THTSD6
     C                   EVAL      THTSD7   = X_THTSD7
     C                   EVAL      THTSD8   = X_THTSD8
     C                   EVAL      THTSB    = X_THTSB
     C                   EVAL      THDDT    = X_THDDT
     C                   EVAL      THDFKD   = X_THDFKD
     C                   EVAL      THDFSK   = X_THDFSK
     C                   EVAL      THDKR    = X_THDKR
     C                   EVAL      THDANT   = X_THDANT
     C                   EVAL      THDKAV   = X_THDKAV
     C                   EVAL      THDKSK   = X_THDKSK
     C                   EVAL      THGKD    = X_THGKD
     C                   EVAL      THGFT1   = X_THGFT1
     C                   EVAL      THGFT2   = X_THGFT2
     C                   EVAL      THGADK   = X_THGADK
     C                   EVAL      THGBL    = X_THGBL
     C                   EVAL      THGVK    = X_THGVK
     C                   EVAL      THGBGI   = X_THGBGI
     C                   EVAL      THGBGU   = X_THGBGU
     C                   EVAL      THKDC    = X_THKDC
     C                   EVAL      THTSSD   = X_THTSSD
     C                   EVAL      THTSN1   = X_THTSN1
     C                   EVAL      THTSN2   = X_THTSN2
     C                   EVAL      THTSPN   = X_THTSPN
     C                   EVAL      THTSLK   = X_THTSLK
     C                   EVAL      THTSSK   = X_THTSSK
     C                   EVAL      THLSTL   = X_THLSTL
     C                   EVAL      THVPOS   = X_THVPOS
     C                   EVAL      THNTK    = X_THNTK
     C                   EVAL      THVKB    = X_THVKB
     C                   EVAL      THDST    = X_THDST
N01  C                   EVAL      THDSTN   = X_THDSTN
     C                   EVAL      THDSK    = X_THDSK
     C                   EVAL      THTARF   = X_THTARF
     C                   EVAL      THWS     = X_THWS
     C                   EVAL      THTRNR   = X_THTRNR
     C                   EVAL      THTRDT   = X_THTRDT
     C                   EVAL      THOMD    = X_THOMD
     C                   EVAL      THBIND   = X_THBIND
     C                   EVAL      THTET    = X_THTET
     C                   EVAL      THMF     = X_THMF
     C                   EVAL      THMP     = X_THMP
     C                   EVAL      THPKL    = X_THPKL
     C                   EVAL      THKDV    = X_THKDV
     C                   EVAL      TH0035   = X_TH0035
     C                   EVAL      DKXH_0035= X_DKXH_0035
     C                   EVAL      THSGDK   = X_THSGDK
     C                   EVAL      THSGUT   = X_THSGUT
     C                   EVAL      THSGID   = X_THSGID
     C                   EVAL      THSGDT   = X_THSGDT
     C                   EVAL      THBYTE   = X_THBYTE
     C                   EVAL      THSIK    = X_THSIK
     C                   EVAL      THDTA    = X_THDTA
     C                   EVAL      THTMA    = X_THTMA
     C                   EVAL      THSPOM   = X_THSPOM
     C                   EVAL      THTKBM   = X_THTKBM
     C                   EVAL      THKREF   = X_THKREF
     C                   EVAL      THTREF   = X_THTREF
     C                   EVAL      THLOSD   = X_THLOSD
     C                   EVAL      THLOSDSK = X_THLOSDSK
     C                   EVAL      THLKR1   = X_THLKR1
     C                   EVAL      THLKR2   = X_THLKR2
     C                   EVAL      THLKR3   = X_THLKR3
     C                   EVAL      THLKR4   = X_THLKR4
     C                   EVAL      THLKR5   = X_THLKR5
     C                   EVAL      THLKR6   = X_THLKR6
     C                   EVAL      THLKR7   = X_THLKR7
     C                   EVAL      THLKR8   = X_THLKR8
     C                   EVAL      THKNSS   = X_THKNSS
     C                   EVAL      THNASS   = X_THNASS
     C                   EVAL      THADSS1  = X_THADSS1
     C                   EVAL      THPNSS   = X_THPNSS
     C                   EVAL      THPSSS   = X_THPSSS
     C                   EVAL      THLKSS   = X_THLKSS
     C                   EVAL      THSKSS   = X_THSKSS
     C                   EVAL      THTINSS  = X_THTINSS
     C                   EVAL      THKNKS   = X_THKNKS
     C                   EVAL      THNAKS   = X_THNAKS
     C                   EVAL      THADKS1  = X_THADKS1
     C                   EVAL      THPNKS   = X_THPNKS
     C                   EVAL      THPSKS   = X_THPSKS
     C                   EVAL      THLKKS   = X_THLKKS
     C                   EVAL      THSKKS   = X_THSKKS
     C                   EVAL      THTINKS  = X_THTINKS
     C                   EVAL      THKNT    = X_THKNT
     C                   EVAL      THNAT    = X_THNAT
     C                   EVAL      THADT1   = X_THADT1
     C                   EVAL      THPNT    = X_THPNT
     C                   EVAL      THPST    = X_THPST
     C                   EVAL      THLKT    = X_THLKT
     C                   EVAL      THSKT    = X_THSKT
     C                   EVAL      THTINT   = X_THTINT
N03  C                   EVAL      THVERS   = X_THVERS
      * Kopiera också varuposter
     C                   OPEN      DKXV
     C                   OPEN      DKXVAM
     C                   OPEN      DKXVVT
     C                   OPEN      DKXVDK
     C                   OPEN      DKXVCN
     C                   OPEN      DKXVMN

     C     DKXHKeyG      SETLL     DKXV
     C     DKXHKeyG      READE     DKXV                                   52
     C     *IN52         DOWEQ     *OFF
     C                   EVAL      TVAVD = NEWAVD
     C                   EVAL      TVTDN = NEWOPD
     C                   WRITE     DKXVR
     C     DKXHKeyG      READE     DKXV                                   52
     C                   ENDDO

     C     DKXHKeyG      SETLL     DKXVAM
     C     DKXHKeyG      READE     DKXVAM                                 52
     C     *IN52         DOWEQ     *OFF
     C                   EVAL      TVAVD = NEWAVD
     C                   EVAL      TVTDN = NEWOPD
     C                   WRITE     DKXVAMR
     C     DKXHKeyG      READE     DKXVAM                                 52
     C                   ENDDO

     C     DKXHKeyG      SETLL     DKXVVT
     C     DKXHKeyG      READE     DKXVVT                                 52
     C     *IN52         DOWEQ     *OFF
     C                   EVAL      TVAVD = NEWAVD
     C                   EVAL      TVTDN = NEWOPD
     C                   WRITE     DKXVVTR
     C     DKXHKeyG      READE     DKXVVT                                 52
     C                   ENDDO

     C     DKXHKeyG      SETLL     DKXVDK
     C     DKXHKeyG      READE     DKXVDK                                 52
     C     *IN52         DOWEQ     *OFF
     C                   EVAL      TVAVD = NEWAVD
     C                   EVAL      TVTDN = NEWOPD
     C                   WRITE     DKXVDKR
     C     DKXHKeyG      READE     DKXVDK                                 52
     C                   ENDDO

     C     DKXHKeyG      SETLL     DKXVCN
     C     DKXHKeyG      READE     DKXVCN                                 52
     C     *IN52         DOWEQ     *OFF
     C                   EVAL      TVAVD = NEWAVD
     C                   EVAL      TVTDN = NEWOPD
     C                   WRITE     DKXVCNR
     C     DKXHKeyG      READE     DKXVCN                                 52
     C                   ENDDO

     C     DKXHKeyG      SETLL     DKXVMN
     C     DKXHKeyG      READE     DKXVMN                                 52
     C     *IN52         DOWEQ     *OFF
     C                   EVAL      TVAVD = NEWAVD
     C                   EVAL      TVTDN = NEWOPD
     C                   WRITE     DKXVMNR
     C     DKXHKeyG      READE     DKXVMN                                 52
     C                   ENDDO

     C                   CLOSE     DKXV
     C                   CLOSE     DKXVAM
     C                   CLOSE     DKXVVT
     C                   CLOSE     DKXVDK
     C                   CLOSE     DKXVCN
     C                   CLOSE     DKXVMN

     C                   ENDSR
      *______________________________________________________
      * Delete                                            SRD
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRD           BEGSR
     C                   EVAL      X_THST    = 'D'
     C                   EVAL      THST      = 'D'
     C                   UPDATE    DKXHR
     C  N34              UPDATE    DKXHFVR
     C                   ENDSR
      *______________________________________________________
      * Skicka                                            SRS
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRS           BEGSR
     C                   eval      Error = *blanks
N03  C                   IF        X_THVERS='5'
N03  C                   EVAL      X_THST='q'
N03  C                   UPDATE    DKXHR
N03  C  N34              UPDATE    DKXHFVR
N03  C                   GOTO      SRSEND
N03  C                   ENDIF
      * Tvungen testindikator ?
     C     X_DKXH_0035   IFEQ      *BLANKS
     C                   UPDATE    DKXHR
     C     X_THAVD       CHAIN(N)  DKXSTD
     C     DKXHKey       CHAIN     DKXH                               55
     C     X_DKXS_0035   IFNE      *BLANKS
     C                   EVAL      X_DKXH_0035=X_DKXS_0035
     C                   EVAL      X_TH0035=X_DKXS_0035
     C                   ENDIF
     C                   ENDIF
      * Ændra status
     C                   UPDATE    DKXHR
     C  N34              UPDATE    DKXHFVR
      *____________________
      * Skapa edifact + fil
      *""""""""""""""""""""
     C                   CALL      'DKX013R'
     C                   PARM                    THAVD
     C                   PARM                    THTDN
     C                   PARM      '015'         X1N07             3
     C                   PARM                    UFLAGG            1 0
N03  C     SRSEND        TAG
     C                   ENDSR
      *______________________________________________________
      * Update                                            SRU
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRU           BEGSR
N02   * Trekk gammelt garantibeløp
N02  C                   IF        X_THGFT1 <> *BLANKS AND
N02  C                             (X_THGKD <= 1 OR X_THGKD >= 6)
N02  C     X_THGFT1      CHAIN     DKXGH                              30
N02  C  N30              EVAL      TGGBLB = TGGBLB - X_THGBL
N02  C  N30              UPDATE    DKXGHR
N02  C                   END
N02   *
     C                   EVAL      X_THST   = THST
     C                   EVAL      X_THPRO  = THPRO
     C                   EVAL      X_THENKL = THENKL
     C                   EVAL      X_THDK   = THDK
     C                   EVAL      X_THKNA  = THKNA
     C                   EVAL      X_THNAA  = THNAA
     C                   EVAL      X_THADA1 = THADA1
     C                   EVAL      X_THPNA  = THPNA
     C                   EVAL      X_THPSA  = THPSA
     C                   EVAL      X_THLKA  = THLKA
     C                   EVAL      X_THSKA  = THSKA
     C                   EVAL      X_THTINA = THTINA
     C                   EVAL      X_THKNS  = THKNS
     C                   EVAL      X_THNAS  = THNAS
     C                   EVAL      X_THADS1 = THADS1
     C                   EVAL      X_THPNS  = THPNS
     C                   EVAL      X_THPSS  = THPSS
     C                   EVAL      X_THLKS  = THLKS
     C                   EVAL      X_THSKS  = THSKS
     C                   EVAL      X_THTINS = THTINS
     C                   EVAL      X_THKNK  = THKNK
     C                   EVAL      X_THNAK  = THNAK
     C                   EVAL      X_THADK1 = THADK1
     C                   EVAL      X_THPNK  = THPNK
     C                   EVAL      X_THPSK  = THPSK
     C                   EVAL      X_THLKK  = THLKK
     C                   EVAL      X_THSKK  = THSKK
     C                   EVAL      X_THTINK = THTINK
     C                   EVAL      X_THBLK  = THBLK
     C                   EVAL      X_THLSD  = THLSD
     C                   EVAL      X_THLASD = THLASD
     C                   EVAL      X_THLAS2 = THLAS2
     C                   EVAL      X_THALK  = THALK
     C                   EVAL      X_THTRM  = THTRM
     C                   EVAL      X_THTRMI = THTRMI
     C                   EVAL      X_THTAID = THTAID
     C                   EVAL      X_THTASK = THTASK
     C                   EVAL      X_THTALK = THTALK
     C                   EVAL      X_THTGID = THTGID
     C                   EVAL      X_THTGSK = THTGSK
     C                   EVAL      X_THTGLK = THTGLK
     C                   EVAL      X_THSKFD = THSKFD
     C                   EVAL      X_THCATS = THCATS
     C                   EVAL      X_THTSD1 = THTSD1
     C                   EVAL      X_THTSD2 = THTSD2
     C                   EVAL      X_THTSD3 = THTSD3
     C                   EVAL      X_THTSD4 = THTSD4
     C                   EVAL      X_THTSD5 = THTSD5
     C                   EVAL      X_THTSD6 = THTSD6
     C                   EVAL      X_THTSD7 = THTSD7
     C                   EVAL      X_THTSD8 = THTSD8
     C                   EVAL      X_THTSB  = THTSB
     C                   EVAL      X_THDDT  = THDDT
     C                   EVAL      X_THDFKD = THDFKD
     C                   EVAL      X_THDFSK = THDFSK
     C                   EVAL      X_THDKR  = THDKR
     C                   EVAL      X_THDANT = THDANT
     C                   EVAL      X_THDKAV = THDKAV
     C                   EVAL      X_THDKSK = THDKSK
     C                   EVAL      X_THGKD  = THGKD
     C                   EVAL      X_THGFT1 = THGFT1
     C                   EVAL      X_THGFT2 = THGFT2
     C                   EVAL      X_THGADK = THGADK
     C                   EVAL      X_THGBL  = THGBL
     C                   EVAL      X_THGVK  = THGVK
     C                   EVAL      X_THGBGI = THGBGI
     C                   EVAL      X_THGBGU = THGBGU
     C                   EVAL      X_THKDC  = THKDC
     C                   EVAL      X_THTSSD = THTSSD
     C                   EVAL      X_THTSN1 = THTSN1
     C                   EVAL      X_THTSN2 = THTSN2
     C                   EVAL      X_THTSPN = THTSPN
     C                   EVAL      X_THTSLK = THTSLK
     C                   EVAL      X_THTSSK = THTSSK
     C                   EVAL      X_THLSTL = THLSTL
     C                   EVAL      X_THVPOS = THVPOS
     C                   EVAL      X_THNTK  = THNTK
     C                   EVAL      X_THVKB  = THVKB
     C                   EVAL      X_THDST  = THDST
N01  C                   EVAL      X_THDSTN = THDSTN
     C                   EVAL      X_THDSK  = THDSK
     C                   EVAL      X_THTARF = THTARF
     C                   EVAL      X_THWS   = THWS
     C                   EVAL      X_THTRNR = THTRNR
     C                   EVAL      X_THTRDT = THTRDT
     C                   EVAL      X_THOMD  = THOMD
     C                   EVAL      X_THBIND = THBIND
     C                   EVAL      X_THTET  = THTET
     C                   EVAL      X_THMF   = THMF
     C                   EVAL      X_THMP   = THMP
     C                   EVAL      X_THPKL  = THPKL
     C                   EVAL      X_THKDV  = THKDV
     C                   EVAL      X_DKXH_0035 = DKXH_0035
     C                   EVAL      X_THSIK    =  THSIK
     C                   EVAL      X_THDTA    =  THDTA
     C                   EVAL      X_THTMA    =  THTMA
     C                   EVAL      X_THSPOM   =  THSPOM
     C                   EVAL      X_THTKBM   =  THTKBM
     C                   EVAL      X_THKREF   =  THKREF
     C                   EVAL      X_THTREF   =  THTREF
     C                   EVAL      X_THLOSD   =  THLOSD
     C                   EVAL      X_THLOSDSK =  THLOSDSK
     C                   EVAL      X_THLKR1   =  THLKR1
     C                   EVAL      X_THLKR2   =  THLKR2
     C                   EVAL      X_THLKR3   =  THLKR3
     C                   EVAL      X_THLKR4   =  THLKR4
     C                   EVAL      X_THLKR5   =  THLKR5
     C                   EVAL      X_THLKR6   =  THLKR6
     C                   EVAL      X_THLKR7   =  THLKR7
     C                   EVAL      X_THLKR8   =  THLKR8
     C                   EVAL      X_THKNSS   =  THKNSS
     C                   EVAL      X_THNASS   =  THNASS
     C                   EVAL      X_THADSS1  =  THADSS1
     C                   EVAL      X_THPNSS   =  THPNSS
     C                   EVAL      X_THPSSS   =  THPSSS
     C                   EVAL      X_THLKSS   = THLKSS
     C                   EVAL      X_THSKSS   = THSKSS
     C                   EVAL      X_THTINSS  = THTINSS
     C                   EVAL      X_THKNKS   = THKNKS
     C                   EVAL      X_THNAKS   = THNAKS
     C                   EVAL      X_THADKS1  = THADKS1
     C                   EVAL      X_THPNKS   = THPNKS
     C                   EVAL      X_THPSKS   = THPSKS
     C                   EVAL      X_THLKKS   = THLKKS
     C                   EVAL      X_THSKKS   = THSKKS
     C                   EVAL      X_THTINKS  = THTINKS
     C                   EVAL      X_THKNT    = THKNT
     C                   EVAL      X_THNAT    = THNAT
     C                   EVAL      X_THADT1   = THADT1
     C                   EVAL      X_THPNT    = THPNT
     C                   EVAL      X_THPST    = THPST
     C                   EVAL      X_THLKT    = THLKT
     C                   EVAL      X_THSKT    = THSKT
     C                   EVAL      X_THTINT   = THTINT
N03  C                   EVAL      X_THVERS   = THVERS
     C                   UPDATE    DKXHR
     C  N34              UPDATE    DKXHFVR
N02   * Legg inn nytt garantibeløp
N02  C                   IF        X_THGFT1 <> *BLANKS AND
N02  C                             (X_THGKD <= 1 OR X_THGKD >= 6)
N02  C     X_THGFT1      CHAIN     DKXGH                              30
N02  C  N30              EVAL      TGGBLB = TGGBLB + X_THGBL
N02  C  N30              UPDATE    DKXGHR
N02  C                   END
N02   *
      * Legg ut frie søkeveier
     C*    FRIKEY        DELETE    FRISOK                             56
     C*    THXREF        IFNE      *BLANKS
     C*                  CLEAR                   FRISOKR
     C*                  EVAL      FSAVD=THAVD
     C*                  EVAL      FSOPD=THTDN
     C*                  EVAL      FSKODE='*CE'
     C*                  EVAL      FSSOK=THXREF
     C*                  MOVE      WDT           FSDTOP
     C*                  WRITE     FRISOKR
     C*                  ENDIF
     C                   ENDSR
      *______________________________________________________
      * Hæmta från SKAT Eksport eller SYSPED op          SRGS
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRGS          BEGSR
      * Finnes SKAT Eksport ?
     C     DKXHKEY       CHAIN     DKEH                               53
      * Finnes SYSPED Oppdrag ?
     C     DKXHKEY       CHAIN     HEADF                              54
      * Fel, finns inte varken SKAT Export eller sysped uppdrag
     C                   IF        *IN53
     C                   IF        *IN54
     C                   eval      Error = 'Order not found'
     C                   GOTO      SRGS9
     C                   ENDIF
     C                   ENDIF
      * Skapa gemensam information
     C                   CLEAR                   DKXHR
     C                   CLEAR                   DKXHFVR
     C     THAVD         CHAIN(N)  DKXSTD                             52
     C                   EVAL      X_THTDN  = THTDN
     C                   EVAL      THST     = ' '
     C                   EVAL      X_THST   = ' '
     C                   EVAL      X_THSG   = WSIGN
     C                   MOVEL     WDT           X_THDT
     C                   MOVEL     WDT           THDT
     C                   MOVE      *ZEROS        X_THDDTK
     C                   MOVE      *BLANKS       X_THDATS
     C                   MOVE      *BLANKS       X_THDKAV
     C                   MOVE      *BLANKS       X_THDKSK

      * Hæmta tullid
     C                   CALL      'SVG001R'
     C                   PARM                    WTUID            10
     C                   MOVE      UYEAR         XÅR               2
     C                   EVAL      X_THTUID = 'DK' + XÅR + WTUID
      * Hæmta från SKAT Export
     C  N53              EXSR      SRGSS
      * Hæmta från SYSPED oppdrag
     C   53              EXSR      SRGSO
      * Write
     C                   WRITE     DKXHR
     C                   IF        X_THSIK>0
     C                   WRITE     DKXHFVR
     C                   ENDIF
      * Oppdater WEB-variabler
     C                   EVAL      THTUID   = X_THTUID
     C                   EVAL      THSG     = X_THSG
     C                   EVAL      THST     = X_THST
     C                   EVAL      THDT     = X_THDT
     C                   EVAL      THTUID   = X_THTUID
     C                   EVAL      THPRO    = X_THPRO
     C                   EVAL      THENKL   = X_THENKL
     C                   EVAL      THDK     = X_THDK
     C                   EVAL      THKNA    = X_THKNA
     C                   EVAL      THNAA    = X_THNAA
     C                   EVAL      THADA1   = X_THADA1
     C                   EVAL      THPNA    = X_THPNA
     C                   EVAL      THPSA    = X_THPSA
     C                   EVAL      THLKA    = X_THLKA
     C                   EVAL      THSKA    = X_THSKA
     C                   EVAL      THTINA   = X_THTINA
     C                   EVAL      THKNS    = X_THKNS
     C                   EVAL      THNAS    = X_THNAS
     C                   EVAL      THADS1   = X_THADS1
     C                   EVAL      THPNS    = X_THPNS
     C                   EVAL      THPSS    = X_THPSS
     C                   EVAL      THLKS    = X_THLKS
     C                   EVAL      THSKS    = X_THSKS
     C                   EVAL      THTINS   = X_THTINS
     C                   EVAL      THKNK    = X_THKNK
     C                   EVAL      THNAK    = X_THNAK
     C                   EVAL      THADK1   = X_THADK1
     C                   EVAL      THPNK    = X_THPNK
     C                   EVAL      THPSK    = X_THPSK
     C                   EVAL      THLKK    = X_THLKK
     C                   EVAL      THSKK    = X_THSKK
     C                   EVAL      THTINK   = X_THTINK
     C                   EVAL      THBLK    = X_THBLK
     C                   EVAL      THLSD    = X_THLSD
     C                   EVAL      THLASD   = X_THLASD
     C                   EVAL      THLAS2   = X_THLAS2
     C                   EVAL      THALK    = X_THALK
     C                   EVAL      THTRM    = X_THTRM
     C                   EVAL      THTRMI   = X_THTRMI
     C                   EVAL      THTAID   = X_THTAID
     C                   EVAL      THTASK   = X_THTASK
     C                   EVAL      THTALK   = X_THTALK
     C                   EVAL      THTGID   = X_THTGID
     C                   EVAL      THTGSK   = X_THTGSK
     C                   EVAL      THTGLK   = X_THTGLK
     C                   EVAL      THSKFD   = X_THSKFD
     C                   EVAL      THCATS   = X_THCATS
     C                   EVAL      THTSD1   = X_THTSD1
     C                   EVAL      THTSD2   = X_THTSD2
     C                   EVAL      THTSD3   = X_THTSD3
     C                   EVAL      THTSD4   = X_THTSD4
     C                   EVAL      THTSD5   = X_THTSD5
     C                   EVAL      THTSD6   = X_THTSD6
     C                   EVAL      THTSD7   = X_THTSD7
     C                   EVAL      THTSD8   = X_THTSD8
     C                   EVAL      THTSB    = X_THTSB
     C                   EVAL      THDDT    = X_THDDT
     C                   EVAL      THDFKD   = X_THDFKD
     C                   EVAL      THDFSK   = X_THDFSK
     C                   EVAL      THDKR    = X_THDKR
     C                   EVAL      THDANT   = X_THDANT
     C                   EVAL      THDKAV   = X_THDKAV
     C                   EVAL      THDKSK   = X_THDKSK
     C                   EVAL      THGKD    = X_THGKD
     C                   EVAL      THGFT1   = X_THGFT1
     C                   EVAL      THGFT2   = X_THGFT2
     C                   EVAL      THGADK   = X_THGADK
     C                   EVAL      THGBL    = X_THGBL
     C                   EVAL      THGVK    = X_THGVK
     C                   EVAL      THGBGI   = X_THGBGI
     C                   EVAL      THGBGU   = X_THGBGU
     C                   EVAL      THKDC    = X_THKDC
     C                   EVAL      THTSSD   = X_THTSSD
     C                   EVAL      THTSN1   = X_THTSN1
     C                   EVAL      THTSN2   = X_THTSN2
     C                   EVAL      THTSPN   = X_THTSPN
     C                   EVAL      THTSLK   = X_THTSLK
     C                   EVAL      THTSSK   = X_THTSSK
     C                   EVAL      THLSTL   = X_THLSTL
     C                   EVAL      THVPOS   = X_THVPOS
     C                   EVAL      THNTK    = X_THNTK
     C                   EVAL      THVKB    = X_THVKB
     C                   EVAL      THDST    = X_THDST
N01  C                   EVAL      THDSTN   = X_THDSTN
     C                   EVAL      THDSK    = X_THDSK
     C                   EVAL      THTARF   = X_THTARF
     C                   EVAL      THWS     = X_THWS
     C                   EVAL      THTRNR   = X_THTRNR
     C                   EVAL      THTRDT   = X_THTRDT
     C                   EVAL      THOMD    = X_THOMD
     C                   EVAL      THBIND   = X_THBIND
     C                   EVAL      THTET    = X_THTET
     C                   EVAL      THMF     = X_THMF
     C                   EVAL      THMP     = X_THMP
     C                   EVAL      THPKL    = X_THPKL
     C                   EVAL      THKDV    = X_THKDV
     C                   EVAL      TH0035   = X_TH0035
     C                   EVAL      DKXH_0035= X_DKXH_0035
     C                   EVAL      THSGDK   = X_THSGDK
     C                   EVAL      THSGUT   = X_THSGUT
     C                   EVAL      THSGID   = X_THSGID
     C                   EVAL      THSGDT   = X_THSGDT
     C                   EVAL      THBYTE   = X_THBYTE
     C                   EVAL      THSIK    = X_THSIK
     C                   EVAL      THDTA    = X_THDTA
     C                   EVAL      THTMA    = X_THTMA
     C                   EVAL      THSPOM   = X_THSPOM
     C                   EVAL      THTKBM   = X_THTKBM
     C                   EVAL      THKREF   = X_THKREF
     C                   EVAL      THTREF   = X_THTREF
     C                   EVAL      THLOSD   = X_THLOSD
     C                   EVAL      THLOSDSK = X_THLOSDSK
     C                   EVAL      THLKR1   = X_THLKR1
     C                   EVAL      THLKR2   = X_THLKR2
     C                   EVAL      THLKR3   = X_THLKR3
     C                   EVAL      THLKR4   = X_THLKR4
     C                   EVAL      THLKR5   = X_THLKR5
     C                   EVAL      THLKR6   = X_THLKR6
     C                   EVAL      THLKR7   = X_THLKR7
     C                   EVAL      THLKR8   = X_THLKR8
     C                   EVAL      THKNSS   = X_THKNSS
     C                   EVAL      THNASS   = X_THNASS
     C                   EVAL      THADSS1  = X_THADSS1
     C                   EVAL      THPNSS   = X_THPNSS
     C                   EVAL      THPSSS   = X_THPSSS
     C                   EVAL      THLKSS   = X_THLKSS
     C                   EVAL      THSKSS   = X_THSKSS
     C                   EVAL      THTINSS  = X_THTINSS
     C                   EVAL      THKNKS   = X_THKNKS
     C                   EVAL      THNAKS   = X_THNAKS
     C                   EVAL      THADKS1  = X_THADKS1
     C                   EVAL      THPNKS   = X_THPNKS
     C                   EVAL      THPSKS   = X_THPSKS
     C                   EVAL      THLKKS   = X_THLKKS
     C                   EVAL      THSKKS   = X_THSKKS
     C                   EVAL      THTINKS  = X_THTINKS
     C                   EVAL      THKNT    = X_THKNT
     C                   EVAL      THNAT    = X_THNAT
     C                   EVAL      THADT1   = X_THADT1
     C                   EVAL      THPNT    = X_THPNT
     C                   EVAL      THPST    = X_THPST
     C                   EVAL      THLKT    = X_THLKT
     C                   EVAL      THSKT    = X_THSKT
     C                   EVAL      THTINT   = X_THTINT
N03  C                   EVAL      THVERS   = X_THVERS
     C     SRGS9         ENDSR
      *______________________________________________________
      * Hæmta från SKAT Export                          SRGSS
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRGSS         BEGSR
     C                   EVAL      X_THKNS = DKEH_AVKN
     C                   EVAL      X_THNAS = DKEH_02B
     C                   EVAL      X_THADS1 = DKEH_02C
     C                   EVAL      X_THPNS  = DKEH_02D
     C                   EVAL      X_THPSS  = DKEH_02E
     C                   EVAL      X_THLKS  = DKEH_02F
     C                   EVAL      X_THTINS = DKEH_02A
     C                   EVAL      X_THKNK=DKEH_MOKN
     C                   EVAL      X_THNAK=DKEH_08B
     C                   EVAL      X_THADK1=DKEH_08C
     C                   MOVEL     DKEH_08D      X_THPNK
     C                   MOVEL     DKEH_08E      X_THPSK
     C                   EVAL      X_THTINK=DKEH_08A
     C                   EVAL      X_THLKK=DKEH_08F

     C                   Z-ADD     DKEH_06       X_THNTK
     C                   Z-ADD     DKEH_BRUT     X_THVKB

     C     DKEH_17A      IFNE      *BLANKS
     C                   MOVE      DKEH_17A      X_THBLK
     C                   ENDIF                                                   2<-E
     C     DKEH_181      IFNE      *BLANKS
     C     DKEH_21       ORNE      *BLANKS
     C                   MOVEL     DKEH_181      X_THTGID
     C                   MOVE      DKEH_21       X_THTGLK
     C                   MOVE      *BLANKS       X_THTGSK
     C                   MOVEL     DKEH_181      X_THTAID
     C                   MOVE      DKEH_21       X_THTALK
     C                   MOVE      *BLANKS       X_THTASK
     C                   ENDIF
     C     DKEH_25       IFNE      *BLANKS                                       2<-B
     C                   MOVE      DKEH_25       X_THTRM
     C                   ENDIF                                                   2<-E
     C                   ENDSR
      *______________________________________________________
      * Hæmta från SYSPED Oppdrag                       SRGSO
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     SRGSO         BEGSR
     C                   EVAL      X_THKNS = HEKNS
     C                   EVAL      X_THNAS = HENAS
     C                   EVAL      X_THADS1 = HEADS1
     C                   EVAL      X_THPNS  = HEPNS
     C                   EVAL      X_THPSS  = HEADS3
     C                   EVAL      X_THLKS  = HELKS
     C                   EVAL      X_THKNK=HEKNK
     C                   EVAL      X_THNAK=HENAK
     C                   EVAL      X_THADK1=HEADK1
     C                   EVAL      X_THPNK=HEPNK
     C                   MOVEL     HEADK3        X_THPSK
     C                   EVAL      X_THLKK=HELKK

     C                   Z-ADD     HENT          X_THNTK
     C                   Z-ADD     HEVKT         X_THVKB
     C     DKEH_17A      IFNE      *BLANKS
     C                   MOVE      DKEH_17A      X_THBLK
     C                   ENDIF                                                   2<-E
     C     DKEH_181      IFNE      *BLANKS
     C     DKEH_21       ORNE      *BLANKS
     C                   MOVEL     DKEH_181      X_THTGID
     C                   MOVE      DKEH_21       X_THTGLK
     C                   MOVE      *BLANKS       X_THTGSK
     C                   MOVEL     DKEH_181      X_THTAID
     C                   MOVE      DKEH_21       X_THTALK
     C                   MOVE      *BLANKS       X_THTASK
     C                   ENDIF
     C     DKEH_25       IFNE      *BLANKS                                       2<-B
     C                   MOVE      DKEH_25       X_THTRM
     C                   ENDIF                                                   2<-E

     C                   ENDSR
