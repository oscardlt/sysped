********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 sh  PTF10 arkivering
      * 03 sh  PTF11 skriv barkode for arkiv?? foreløpig hardkodet type ZO
     H DECEDIT(',') debug(*yes)
********************************************************************
      *
      *
      ***********************************************************
      *** PROGRAM SKAL SKRIVE UT ARBEIDSORDRE                 ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01-25                            ***
      *** LEDIGE INDIKATORER 34-45 47-76 79-99                ***
      ***********************************************************
      *
n01  FFIRM      IF   E           K DISK
n01  FARKTXT    IF   E           K DISK
n01  FFIRMARC   IF   E           K DISK
n01  FARKIVP    O  A E             DISK
     FSYEX40FM  CF   E             WORKSTN USROPN
     FHEADF     UF   E           K DISK
     FHEAD2     IF   E           K DISK
     F                                     RENAME(HEADFR:HEAD2R)
     FCUNDL01   IF   E           K DISK
     FKODTP     IF   E           K DISK
     FKODTFM    IF   E           K DISK
     FFREETXT2  IF   E           K DISK
     FHODE      IF   E           K DISK
     FKODTH     IF   E           K DISK
     FFRISOK    IF   E           K DISK
     FKODFRI    IF   E           K DISK
     FSYEX40PF  O    E             PRINTER OFLIND(*IN26)
     FMERKL2    O    F   50        PRINTER
     F                                     FORMLEN(24)
     F                                     FORMOFL(24)
N01  D                SDS
N01  D  ZUSER                254    263
     D                 DS
     D  DFS                    1     10    DIM(10)
     D  FSDOKK                 1     10
     D                 DS
     D  HOHT1                  1     80
     D  HOHT2                 81    160
     D  HOHT3                161    240
     D  HOHT4                241    320
     D  HOHT5                321    400
     D  HOHT6                401    480
     D  HOHT7                481    560
     D  HOBT1                561    640
     D  HOBT2                641    720
     D  HOBT3                721    800
     D  HP                     1    800    DIM(10)
     D                 DS
     D  WSOP1                  1      7  0
     D  WSOP2                  8     14  0
     D  WSOP3                 15     21  0
     D  WSOP4                 22     28  0
     D  WSOP5                 29     35  0
     D  WSOP6                 36     42  0
     D  WSOP7                 43     49  0
     D  WSOP8                 50     56  0
     D  WSOP9                 57     63  0
     D  WSOP10                64     70  0
     D  WSOP11                71     77  0
     D  WSOP12                78     84  0
     D  WSOP13                85     91  0
     D  WSOP14                92     98  0
     D  WSOP15                99    105  0
     D  WSOP16               106    112  0
     D  WSOP17               113    119  0
     D  WSOP18               120    126  0
     D  WSOP19               127    133  0
     D  WSOP20               134    140  0
     D  WSOP21               141    147  0
     D  WSOP22               148    154  0
     D  WSOP23               155    161  0
     D  WSOP24               162    168  0
     D  WSOP25               169    175  0
     D  WSOP26               176    182  0
     D  WSOP27               183    189  0
     D  WSOP28               190    196  0
     D  WSOP29               197    203  0
     D  WSOP30               204    210  0
     D  WSOP31               211    217  0
     D  WSOP32               218    224  0
     D  WSOP33               225    231  0
     D  WSOP34               232    238  0
     D  WSOP35               239    245  0
     D  WF                     1    245  0 DIM(35)
     D                 DS
     D  HEFT1                  1     51
     D  HEFT1A                 1     30
     D  HEFT1B                31     45
n01  D                 DS
n01  D  XULTID                 1     14  0
n01  D  XULTM                  1      6  0
n01  D  XULDD                  7      8  0
n01  D  XULMM                  9     10  0
n01  D  XULÅÅ                 11     14  0
n01  D                 DS
n01  D  ULÅÅ                   1      4  0
n01  D  ULMM                   5      6  0
n01  D  ULDD                   7      8  0
n01  D  ULDT                   1      8  0
     D                UDS
     D  UFIRM                  1      2
     D  UAVD                  15     18  0
     D  USG                   19     21
     D  UPRO                  22     29  0
     D  UDTOP                 30     35  0
     D  UHOD                  47     47
     D  UBBS                  48     48
V10  D  UOPD                  82     88  0
     C*
     C                   EXSR      INIT
     C*
     C     KOPI          IFEQ      ' '                                          1<-B
     C     KOPI          OREQ      'N'
     C                   SETOFF                                       32
     C     HEAD2K        SETLL     HEAD2
     C     START         TAG
     C     UAVD          READE     HEAD2                                  32
     C  N32
     CANN33USG           COMP      HESG                               3232
     C   32              GOTO      SLUTT
V10   *
V10   * ENTEN UPRO<>0, UOPD=0 --> TEST OM UPRO=HEPRO
V10   * ELLER UPRO=0, UOPD<>0 --> TEST OM UOPD=HEOPD
     C     UPRO          IFNE      *ZEROS                                        2<-B
     C     UPRO          ANDNE     HEPRO
V10  C*    UPRO          ANDNE     HEOPD
V10  C     UOPD          ANDEQ     *ZEROS
V10  C     UOPD          ORNE      *ZEROS
V10  C     UOPD          ANDNE     HEOPD
     C     UPRO          ANDEQ     *ZEROS                                        2<-B
     C                   GOTO      START
     C                   END                                                     2<-E
     C*
     C     HEPK3         IFEQ      'J'                                           2<-B
     C     HEUR          IFEQ      'D'                                            3<-B
     C     HEUR          OREQ      'B'
     C     HEUR          OREQ      'H'
     C     HEUR          OREQ      'G'
     C     HEUR          OREQ      'E'
     C     HEVS2         COMP      *BLANKS                            2727
     C  N27HEGM2         COMP      *BLANKS                            2727
     C                   MOVE      *BLANKS       KFMT1
     C                   MOVE      *BLANKS       KFMT2
     C     KOPFM         SETLL     KODTFM
     C     KOPFM         READE     KODTFM                                 98
      *
     C     START2        TAG
     C     HEADFK        CHAIN     HEADF                              32
     C   32              GOTO      SLUTT
     C     HEKNS         COMP      0                                      77
     C  N77KUND1K        CHAIN     CUNDL01                            77
     C  N77DKUND         COMP      'D'                                    77
     C                   EXSR      KDTFMT
     C                   EXSR      PRLIST
     C  N98KOPFM         READE     KODTFM                                 98
     C  N98              GOTO      START2
     C     HEUR          IFNE      'E'                                             4<-B
     C     HEPK9         ANDEQ     'J'
     C                   Z-ADD     1             XN2               5 0
     C     XN2           DOWLE     HENT                                             5<-B
     C                   EXCEPT    MLAP2
     C                   ADD       1             XN2
     C                   END                                                        5<-E
     C                   MOVE      'P'           HEPK9
     C                   END                                                       4<-E
     C                   MOVE      'P'           HEPK3
     C                   ADD       1             XPRANT
     C                   UPDATE    HEADFR
     C                   END                                                      3<-E
     C                   END                                                     2<-E
     C                   GOTO      START
      *
      * kopiutskrift
      *
     C                   ELSE                                                   1
     C*
     C                   EXSR      KOPIS
     C                   END                                                    1<-E
     C*
     C     SLUTT         TAG
     C                   MOVE      XPRANT        UPRANT
     C                   SETON                                        LR
     C                   RETURN
     C*
     C******************************************
     C     PRLIST        BEGSR
     C******************************************
     C                   MOVE      '0'           *IN26
     C                   MOVE      *ZEROS        XSIDE
     C                   WRITE     KJØP
      * FRIE SØKEVEIER (KUN DE SOM HAR DOK.KODE LIK K/S)
     C     HEADFK        SETLL     FRISOK
     C     HEADFK        READE     FRISOK                                 91
     C     *IN91         DOWEQ     '0'
     C                   SORTA     DFS
     C                   MOVE      '0'           *IN34
     C     DFS(10)       IFNE      ' '
     C     'S'           LOOKUP    DFS                                    34
     C  N34'K'           LOOKUP    DFS                                    34
     C     *IN34         IFEQ      '1'
     C     FSKODE        CHAIN     KODFRI                             34
     C     *IN34         IFEQ      '0'
     C     *IN26         IFEQ      '1'
     C                   WRITE     KJØPNYS
     C                   ADD       1             XSIDE
     C                   WRITE     KJØP
     C                   MOVE      '0'           *IN26
     C                   END
     C                   WRITE     KJØPFS
     C                   END
     C                   END
     C                   END
     C*
     C  N91HEADFK        READE     FRISOK                                 91
     C                   END
      *
      * SKRIVE UTLEVERINGSFORBEHOLD
     C     HEKFT1        IFEQ      *BLANKS
     C     HEFT1A        ANDNE     *BLANKS
     C     *IN26         IFEQ      '1'
     C                   WRITE     KJØPNYS
     C                   ADD       1             XSIDE
     C                   WRITE     KJØP
     C                   MOVE      '0'           *IN26
     C                   END
     C                   WRITE     KJØP3
     C                   END
     C                   MOVE      'N'           XMNTXT            1
      *
     C     FREETK        SETLL     FREETXT2                           91
     C     STPRT         TAG
     C     FREETK        READE     FREETXT2                               91
     C  N91XMNTXT        IFEQ      'N'
     C     *IN26         IFEQ      '1'
     C                   WRITE     KJØPNYS
     C                   ADD       1             XSIDE
     C                   WRITE     KJØP
     C                   MOVE      '0'           *IN26
     C                   END
     C                   WRITE     KJØP40
     C                   MOVE      'J'           XMNTXT
     C                   END
     C  N91*IN26         IFEQ      '1'
     C                   WRITE     KJØPNYS
     C                   ADD       1             XSIDE
     C                   WRITE     KJØP
     C                   MOVE      '0'           *IN26
     C                   END
     C  N91              WRITE     KJØP4
     C  N91              GOTO      STPRT
     C                   WRITE     KJØP5
     C*
N02   * skriv barkode for arkiv?? foreløpig hardkodet type
N02  c                   movel     HEAVD         AVDOPD           11
N02  c                   move      HEOPD         AVDOPD
N02  c                   movel     'ZP'          SKANBAR
N02  c                   move      AVDOPD        SKANBAR
N02  c     KOPLAS        COMP      'F'                                    55
N02  c  N55KOPLAS        COMP      'P'                                    55
N02  C                   WRITE     KJØPB
      *
N01  C     KOPI          IFEQ      ' '                                          1<-B
N01  C     KOPI          OREQ      'N'
N01  c                   exsr      arkivsr
N01  c                   end
      *
     C                   ENDSR
      *
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     FREETK        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   MOVE      *ZEROS        WF
     C     HEADFK        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C     HEAD2K        KLIST
     C                   KFLD                    UAVD
     C                   KFLD                    USG
     C                   KFLD                    YDTOP
     C     KUND1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    HEKNS
     C     HODEK         KLIST
     C                   KFLD                    YNET
     C                   KFLD                    UAVD
     C     KODTHK        KLIST
     C                   KFLD                    YHUNI
     C                   KFLD                    UAVD
     C     KODTPK        KLIST
     C                   KFLD                    WSPUNI
     C                   KFLD                    UAVD
     C                   KFLD                    WSPLNR
     C                   MOVE      'P'           WSPUNI            1
     C                   Z-ADD     13            WSPLNR            3 0
     C     KODTPK        CHAIN     KODTP                              99
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UPRANT            2
     C                   PARM                    KOPI              1
     C                   PARM                    UUAVD             4
     C                   PARM                    UUOPD             7
     C                   PARM                    UFAX              1
     C                   MOVE      *ZEROS        XPRANT            2 0
     C                   Z-ADD     UDTOP         YDTOP             8 0
     C     UDTOP         IFGT      501231
     C                   MOVEL     '19'          YDTOP
     C                   ELSE
     C                   MOVEL     '20'          YDTOP
     C                   END
     C                   MOVE      ' '           YNET              1
     C                   MOVE      'H'           YHUNI             1
     C*
     C     KODTHK        CHAIN     KODTH                              33
     C     KOHKK         COMP      'J'                                    46
     c     UFAX          IFNE      'E'
     C   46HODEK         CHAIN     HODE                               33
     C                   end
     C*
     C     UFAX          COMP      'J'                                    78
     c  N78UFAX          comp      'E'                                    78
     C   78              move      *blanks       kopfm
     C     USG           COMP      'ALL'                                  33
     C   33              MOVE      *BLANKS       USG
     C*
N01  C                   read      firm                                   33
     C                   ENDSR
     C*
     C***********************************************
     C     KOPIS         BEGSR
     C***********************************************
     C     KOPI          IFNE      'B'
     C                   OPEN      SYEX40FM
     C                   MOVE      UAVD          HEAVD
     C                   END
     C*
     C     STKOP         TAG
     C     KOPI          IFNE      'B'
     C                   EXFMT     BILDE
     C                   ELSE
     C                   MOVE      UUAVD         HEAVD
     C                   MOVE      UUOPD         HEOPD
     C                   EXSR      PRINTB
     C                   GOTO      UTKO2
     C                   END
     C                   SETOFF                                       30
     C   03              GOTO      UTKO
     C                   EXSR      TESTB
     C   30              GOTO      STKOP
     C*
     C                   MOVE      *BLANKS       KFMT1
     C                   MOVE      *BLANKS       KFMT2
     C     KOPFM         SETLL     KODTFM
     C     KOPFM         READE     KODTFM                                 98
     C     STPR1         TAG
     C                   EXSR      PRINT1
     C  N98KOPFM         READE     KODTFM                                 98
     C  N98              GOTO      STPR1
     C*
     C     UTKO          TAG
     C                   CLOSE     SYEX40FM
     C     UTKO2         ENDSR
     C*
     C******************************************
     C     TESTB         BEGSR
     C******************************************
     C                   Z-ADD     1             XN                2 0
     C     XN            DOWLE     35
     C     WF(XN)        IFNE      0
     C                   MOVE      WF(XN)        HEOPD
     C     HEADFK        CHAIN     HEADF                              30
     C   30              MOVEL     XN            MSGTXT
     C   30              MOVE      HEOPD         MSGTXT
     C   30              GOTO      SLTB
     C                   END
     C                   ADD       1             XN
     C                   END
     C*
     C     SLTB          ENDSR
     C*
     C******************************************
     C     PRINT1        BEGSR
     C******************************************
     C                   Z-ADD     1             XN
     C     XN            DOWLE     35
     C     WF(XN)        IFNE      0
     C                   MOVE      WF(XN)        HEOPD
     C     HEADFK        CHAIN     HEADF                              33
     C  N33              DO
     C     HEVS2         COMP      *BLANKS                            2727
     C  N27HEGM2         COMP      *BLANKS                            2727
     C     HEKNS         COMP      0                                      77
     C  N77KUND1K        CHAIN     CUNDL01                            77
     C  N77DKUND         COMP      'D'                                    77
     C                   EXSR      KDTFMT
     C                   EXSR      PRLIST
     C                   ADD       1             XPRANT
     C                   END
     C                   END
     C                   ADD       1             XN
     C                   END
     C*
     C                   ENDSR
     C*
     C******************************************
     C     PRINTB        BEGSR
     C******************************************
     C     HEADFK        CHAIN     HEADF                              33
     C  N33              DO
     C     HEVS2         COMP      *BLANKS                            2727
     C  N27HEGM2         COMP      *BLANKS                            2727
     C     HEKNS         COMP      0                                      77
     C  N77KUND1K        CHAIN     CUNDL01                            77
     C  N77DKUND         COMP      'D'                                    77
     C                   EXSR      KDTFMT
     C                   EXSR      PRLIST
     C                   ADD       1             XPRANT
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
     C                   MOVE      UDAY          UDT1              2 0
     C                   MOVE      UMONTH        UDT2              2 0
     C                   MOVE      UYEAR         UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C*
     C                   ENDSR
     C*
n01  C***********************************************
n01  C     ARKIVSR       BEGSR
n01  C***********************************************
n01  C***********************************************
n01  C                   TIME                    XULTID
n01  C                   MOVE      XULDD         ULDD
n01  C                   MOVE      XULMM         ULMM
n01  C                   MOVE      XULÅÅ         ULÅÅ
n01  C     FIFIRM        CHAIN     FIRMARC                            33
n01  C     *IN33         IFEQ      '0'
n01  C     'kk'          chain     arktxt                             33
n01  C     *IN33         IFEQ      '0'
n01  C     arkjn         andeq     'J'
n01   *
n01  C                   MOVE      FIFIRM        ARFIRM
n01  C                   MOVE      HEAVD         ARAVD
n01  C                   MOVE      HEOPD         AROPD
n01  C                   MOVE      *BLANKS       ARUNDE
n01  C                   MOVE      'ae'          ARTYPE
n01  C                   MOVE      ZUSER         ARUSER
n01  C                   MOVE      ULDT          ARDATE
n01  C                   MOVE      XULTM         ARTIME
n01  C                   MOVE      KUNDNR        ARKUND
n01  C                   WRITE     ARKIVR
n01  C                   END
n01  C                   END
n01  C                   ENDSR
     OMERKL2    E            MLAP2            04
     O                       HENAK               35
     O          E            MLAP2            06
     O                       HEADK1              35
     O          E            MLAP2            08
     O                       HEADK2              35
     O          E            MLAP2            10
     O                       HEADK3              35
