*****F**************************************************************
      * sender shipsordre på mail
*****F**************************************************************
      *
      *
N01  FCUNDC     IF   E             DISK
     Fgss043fa  CF   E             WORKSTN
     F                                     INFDS(FBAREA)
     FFIRM      IF   E           K DISK
     FCUNDL01   IF   E           K DISK
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
N01  D                 DS
N01  D  USØKKN                 1     30
N01  D  URRN                   3     12
n05  D  epofax                13     13
N01  D                 DS
N01  D  USØKKU                 1     30
N01  D  USØKKO                 1      2
N01  D                 DS
N01  D  wscvp1                 1     40
N01  D  wscvpt                 1      1
N01  D                 DS
N01  D  epost                  1     70
N01  D  epost1                 1      1
n04  D UP              C                   CONST('ABCDEFGHIJKLMNOPQRST-
N04  D                                     UVWXYZ')
N04  D LO              C                   CONST('abcdefghijklmnopqrst-
N04  D                                     uvwxyz')
      *
     C                   EXSR      INIT
      *
     C     FEIL          TAG
     C*
N02  C     STARTB        TAG
     C*
     C                   EXFMT     BILDE01
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     c   03              goto      slutt
     c
     c                   move      *blanks       urrn
     C*
     C* SØKING
     C*
     C*
      *
     C   04              DO
N04  c                   move      *blanks       EPOFAX
N04  c                   move      *zeros        URRN
      *
      * linje 5 er søk kunde
      *
N04  C     LINNBR        IFEQ      5
     C                   MOVE      NAVN          USØKKU           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    KUNDNR
     C                   PARM                    FIFIRM
     C                   PARM                    USØKKU           30
N01  C     USØKKO        ifeq      'KP'
     c                   move      USØKKU        USØKKN
N04  C     URRN2         IFNE      *ZEROS
N04  C                   MOVE      URRN2         URRN
N04  C                   END
N04  C                   END
N04  C                   END
      *
      * linje 7 = søk epostadresse
      *
N04  C     LINNBR        IFEQ      7
     c     epost1        ifeq      '*'
     c                   move      '1'           umode
     c                   call      'EPOS02'
     c                   parm                    umode             1
     c                   parm                    udist             7
     c                   move      *blanks       epost
     c                   movel     udist         epost
     c                   else
N04  C                   move      *blanks       usok
N04  c     epost         ifne      *blanks
N04  C     LO:UP         XLATE     EPOST         usok
N04  c                   end
N04  C                   CALL      'VCUNDC2R'
N04  C                   PARM                    FIFIRM
N04  C                   PARM                    USOK             30
N04  C                   PARM                    URRN2            10 0
     c                   parm                    epofax            1
N03  C     URRN2         IFNE      *ZEROS
N03  C                   MOVE      URRN2         URRN
N03  C                   END
     c                   end
     c                   end
     c                   end
      *
      * retur fra søking
      *
     C*
N01  C* RETUR MED KONTAKTPERS
     C*
     c     urrn          ifne      *zeros
     c     urrn          andne     *blanks
N01  C                   MOVE      URRN          RRN              10 0
N01  C     RRN           CHAIN     CUNDC                              31
N01  C  N31              MOVEL     CEMAIL        EPOST
N04  C  N31              MOVE      CCOMPN        KUNDNR
n05  c  n31navn          ifeq      *blanks
n05  c                   movel     cconta        navn
     c                   end
     c                   end
N01  C*
     C*
     C* TESTER BILDET
     C*
     C                   EXSR      TESTB1
     C   30              GOTO      FEIL
     C  N10              GOTO      FEIL
     C*
     C*
     C* sender mail
     c*
     c                   exsr      sende
     c*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C                   RETURN
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
     C                   SETOFF                                       307071
     C                   SETOFF                                       72
      *
     C* TESTER VED UTFYLLT KUNDNUMMER
      *
     C     KUNDNR        IFNE      *ZEROS
     C     KUNKEY        CHAIN     CUNDL01                            70
     C   70              MOVE      'SPK0001'     MSGNR
     C   70              SETON                                        30
n09  C   70              z-add     5             LINNBR
n09  C   70              z-add     11            POSNBR
     c   70              goto      sltb
     c                   move      knavn         navn
N01  C     EPOST         IFEQ      *BLANKS
     C                   MOVE      SYEPOS        EPOST
     c                   end
     C                   END
     C*
     C*
     C* epost kan ukke være blank
     C*
N01  C     EPOST         IFEQ      *BLANKS
     C                   SETON                                        71
E01  C   71              MOVE      'SHU0811'     MSGNR
     C   71              SETON                                        30
n09  C   71              z-add     7             LINNBR
n09  C   71              z-add     11            POSNBR
     c                   goto      sltb
     C                   END
     C*
     C* epost må inneholde @ eller * i start
     C*
     c     epost1        ifne      '*'
     C     '@'           SCAN      epost                                  33
     c     *in33         ifeq      '0'
     c                   seton                                        71
E01  C   71              MOVE      'SHU0810'     MSGNR
     C   71              SETON                                        30
n09  C   71              z-add     7             LINNBR
n09  C   71              z-add     11            POSNBR
     c                   goto      sltb
     C                   END
     C                   END
     C*
     C* coverpage må starte med tegn
     C*
N01  C     wscvpt        IFEQ      ' '
     C                   SETON                                        72
E01  C   72              MOVE      'SHU0809'     MSGNR
     C   72              SETON                                        30
n09  C   72              z-add     10            LINNBR
n09  C   72              z-add     11            POSNBR
     C                   END
     C*
     C     SLTB          ENDSR
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
      *
     C     KUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
      *
     C     *ENTRY        PLIST
     C                   PARM                    UORNR             7
     C                   PARM                    Ukunde            8
     c                   move      ukunde        kundnr
     C*
     c                   read      firm                                   33
     C*
     C     KUNKEY        CHAIN     CUNDL01                            70
     C     *in(70)       ifeq      '0'
     c                   move      knavn         navn
     C                   MOVE      SYEPOS        EPOST
     C                   END
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     sende         BEGSR
     C***********************************************
     c     wscvp1        ifeq      *blanks
     c                   movel     '.'           wscvp1
     c                   end
     c     wscvp2        ifeq      *blanks
     c                   movel     '.'           wscvp2
     c                   end
     c     wscvp3        ifeq      *blanks
     c                   movel     '.'           wscvp3
     c                   end
     c     wscvp4        ifeq      *blanks
     c                   movel     '.'           wscvp4
     c                   end
     c     wscvp5        ifeq      *blanks
     c                   movel     '.'           wscvp5
     c                   end
     c     wscvp6        ifeq      *blanks
     c                   movel     '.'           wscvp6
     c                   end
     c     wscvp7        ifeq      *blanks
     c                   movel     '.'           wscvp7
     c                   end
     c     wscvp8        ifeq      *blanks
     c                   movel     '.'           wscvp8
     c                   end
     c                   CALL      'GSS043CL'
     C                   PARM                    UORNR
     C                   PARM                    EPOST
     C                   PARM                    WSCVP1
     C                   PARM                    WSCVP2
     C                   PARM                    WSCVP3
     C                   PARM                    WSCVP4
     C                   PARM                    WSCVP5
     C                   PARM                    WSCVP6
     C                   PARM                    WSCVP7
     C                   PARM                    WSCVP8
     C                   ENDSR
     C*
