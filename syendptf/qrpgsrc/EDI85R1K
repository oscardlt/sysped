********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 Ikke brgrense til kun versjon1
LEM   * xml fra SKY begynner litt ukurant,Tatt inn fo å kunne teste en feilsituasj hos oss
10030 * 03 CB  PTF10 Hent IFS bane slik at navn kan valideres
      *%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * 04 JOV PTF11 Finn også XML utf-16
      * 05 JOV PTF11 Reelt kundeeksempel tatt inn i standard - (god mal)
      * 06 SH  PTF11 MOTTAK NAVITRO faktura
      * 07 SH  PTF11 MOTTAK NAVITRO fortolling
      * 08 SH  PTF11 RETTELSE  NAVITRO
12051 * 09 CB  PTF12 FAKTURA og Vareposter til Z-filer
      * 10 SH  PTF12 08 satt tilbake
      * 11 SH  PTF12 flyttet navitrobehandling til egen subrutine
      *              ikke 100 % merket
      * 12 SH  PTF12 mottak PDF fra TOLLVESEN
      * 13 SH  PTF12 feil ptf 12
      * 14 SH  PTF12 sender også kontrolliste på epost
      * 15 SH  PTF12 chaine arkext tidligere
      * 16 SH  PTF12 (xml).pdf er ikke pdf
      * 17 SH  PTF12 ytterligere Navitro test
12146 * 18 SH  PTF12 takler begge navitro mottak av PDF
12146 * 19 SH  PTF12 tar inn til foretaksnummer fra katxt
12146 * 20 SH  PTF12 ved upload 3 første tegn er rare
12245 * 21 CB  PTF12 SKAT DK FAKTURA og Vareposter til Z-filer, ny Dachser-variant
12245 * 22 SH  PTF12 tester .PDF også med store bokstaver
12245 * 23 SH  PTF12 endringer import/eksport toll autofortolling
12245 * 24 SH  PTF12 FLYTTER ALTINN PDF OPP I GOOGLE CLOAD
12XXX * 25 YBC PTF12 DK CERTIFICATE TYPE
********************************************************************
N24  FFIRMGOOG  IF   E           K DISK    USROPN
N12  FFIRMDAG   IF   E           K DISK    USROPN
N12  FARKIVP    O  A E           K DISK    USROPN
N12  FEDIS9     IF   E           K DISK    USROPN
N12  FKOSTA2    IF   E           K DISK    USROPN
N06  FFIRM      IF   E           K DISK    USROPN
N06  FFIRMARC   IF   E           K DISK    USROPN
N06  FFIRMNA    IF   E           K DISK    USROPN
N06  FARKTXT    IF   E           K DISK    USROPN
N06  FARKEXT    IF   E           K DISK    USROPN
     FEDI79F1K  UF   E             DISK
     FEDI85F1K  O  A E             DISK
N03  FEDISX2    IF   E           K DISK
     D XICTYPE         C                   CONST('PostenInterchange')
S01  D*XINHOUSE        C                   CONST('<?xml version="1.0"')
N01  D XINHOUSE        C                   CONST('<?xml version=')
LEM  D XSKY            C                   CONST('<SkynetExchange>')
N04  D XUTF16          C                   CONST('<?xml version=')
SCH  D HPII            C                   CONST('<n0:ImportDeclarationRequest')
SCH  D HPIE            C                   CONST('<n0:ExportDeclarationRequest')
     D                 DS
     D  RDATA                  1   1024
N06  D  NAVITRO                1      7
     D  RTYBBS                 1      8
     D  RTYDNB                41     48
     D  RTYPE                  1      4
     D  AH100                  1      5
     D  TDS1                  10     11
     D  TDS2                  12     12
s23  D* FORT                   1     11
s23  D* FORT2                  4     14
N09  D  RTYP2                  1      2
N21  D  FORT3                  1     13
N25  D  XDKSER                 1     12
      *
     C     *ENTRY        PLIST
     C                   PARM      WTYPE         WTYPE             4
N03  C                   PARM                    WSXWORKM
     C                   MOVE      *BLANKS       WTYPE
N03  C     *LIKE         DEFINE    SXWORKM       WSXWORKM
      *
N03   * Hent IFS katalog og filnavn
N03   * Har nå variabel: SXIFSOBJ som inneholder katalogbane + filnavn
N03   * hvis en vill teste på filnavn isteden for innehold.
      *
N03  C     WSXWORKM      CHAIN     EDISX2
N03   * Exempellinje, bytt ut YYY.XXX med aktuell verdi
N03  C     'YYY.XXX'     SCAN      SXIFSOBJ                               54
      *
      * PDF motatt
      *
N16  c     '(xml).pdf'   SCAN      SXIFSOBJ                               54
N16  c     *in54         IFNE      '1'
N06  C     '.pdf'        SCAN      SXIFSOBJ                               54
N22  C  N54'.PDF'        SCAN      SXIFSOBJ                               54
N06  c     *in54         ifeq      '1'
S08  C*    'Navitro_'    SCAN      SXIFSOBJ      x                 3 0    54
s10  C*    '_'           SCAN      SXIFSOBJ      x                 3 0    54
N10  C     'Navitro_'    SCAN      SXIFSOBJ      x                 3 0    54
n18  C     *IN54         IFEQ      '0'
S18  C* N54'NAVITRO'     SCAN      SXIFSOBJ      x                 3 0    54
n18  C     'NAVITRO'     SCAN      SXIFSOBJ      x                 3 0    54
N18  C   54              ADD       50            X
n18  C   54              MOVE      'J'           NAVFOR            1
n18  C                   END
N06  C     *in54         ifeq      '1'
N11   * flyttet herfra til NAVSR
N11  c                   exsr      navsr
N12  c                   else
N12  c                   exsr      tollsr
N11  c                   end
N11  c                   end
N16  c                   end
      *
     C                   READ      EDI79F1K                               51
      *
      * DETALJPOSTER KAN HA AH100 I SEG
      *
      * DETALJPOSTER KAN HA AAANO I SEG   (CASS AVREGNING)
     C     AH100         IFEQ      'AAANO'
     C                   MOVE      'J'           AH100J            1
     C                   MOVE      AH100         AH100B            5
     C                   END
N06   * NAVITRO kostnadsfil
N06  C     NAVITRO       IFEQ      'Navitro'
N06  C                   MOVE      'J'           NAVJN             1            *BBS INNBET.
N06  C                   END
      *
     C     *IN51         DOWEQ     '0'
      *
     C     'UNB+U'       SCAN      RDATA         WPOS              4 0    52
     C     XICTYPE       SCAN      RDATA         WPOS              4 0    53
     C  N53XINHOUSE      SCAN      RDATA         WPOS              4 0    53
N04  C  N53XUTF16        SCAN      RDATA         WPOS              4 0    53
LEM  C  N53XSKY          SCAN      RDATA         WPOS              4 0    53
SCH  C  N53HPIE          SCAN      RDATA         WPOS              4 0    53
SCH  C  N53HPII          SCAN      RDATA         WPOS              4 0    53
N09  C                   IF        RTYP2='S;'
N09  C     ';E '         SCAN      RDATA                                  55
N09  C  N55';I '         SCAN      RDATA                                  55
N09  C                   ENDIF
N21  C                   IF        FORT3='Eksport_Toll;'
N21  C     'Eksport_'    SCAN      RDATA                                  56
N21  C  N56'Import_'     SCAN      RDATA                                  56
N21  C                   ENDIF
N23   * norsk eksport autofortolling
N23  C     'Export toll' SCAN      RDATA                                  88
N23  C  N88'Eksport_tol' SCAN      RDATA                                  88
N23   * norsk import  autofortolling
N23  C     'Import_toll' SCAN      RDATA                                  89
N25  C     'Diverse cert'SCAN      RDATA                                  90
N25  C  N90'Oprindelsesb'SCAN      RDATA                                  90
N25  C  N90'Andre certif'SCAN      RDATA                                  90
N25  C  N90'Antidumping-'SCAN      RDATA                                  90
N25  C  N90'Særlige beti'SCAN      RDATA                                  90
     C     RTYPE         IFEQ      '*SYS'                                       IE MSG
     C     RTYPE         OREQ      'UNB+'                                       EDIFACT
     C     RTYPE         OREQ      'UNA:'                                       EDIFACT
     C     RTYPE         OREQ      '*IN#'                                       EDIFACT
s23  C*    FORT          OREQ      'Export toll'
s23  C*    FORT          OREQ      'Eksport_tol'
s23  C*    FORT          OREQ      'Import_toll'
s23  C*    FORT2         OREQ      'Export toll'
s23  C*    FORT2         OREQ      'Eksport_tol'
s23  C*    FORT2         OREQ      'Import_toll'
     C     TDS1          OREQ      '_K'                                         TDS TARIC
     C     TDS2          ANDGE     'A'                                          TDS TARIC
     C     TDS2          ANDLE     'T'                                          TDS TARIC
     C     TDS1          OREQ      '_D'                                         TDS TARIC
     C     TDS2          ANDGE     'A'                                          TDS TARIC
     C     TDS2          ANDLE     'T'                                          TDS TARIC
     C     RTYBBS        OREQ      'NY000010'                                   OCR-INB
     C     RTYDNB        OREQ      'BETFOR00'                                   BANK
N06  C     NAVITRO       OREQ      'Navitro'
     C     AH100         OREQ      'AAANO'                                      CASS
N05  C     RTYBBS        OREQ      'Manifest'                                   CTS manifest
     C     *IN52         OREQ      *ON                                          EDIFACT
     C     *IN53         OREQ      *ON                                          XML POSTEN
N09  C     *IN55         OREQ      *ON                                          DK EDI
N21  C     *IN56         OREQ      *ON                                          DK EDI
N23  C     *IN88         OREQ      *ON                                          NO EDI exp
N23  C     *IN89         OREQ      *ON                                          NO EDI imp
N25  C     *IN90         OREQ      *ON                                          DK CERT.TYPE
S05   * line under innført i ptf 03 kan ikke brukes - vil splitte i en og en linje
N03  C**   *IN54         OREQ      *ON                                          FIL/FILTYPE
     C     *IN81         CABEQ     '1'           END
     C                   MOVE      '1'           *IN81
     C                   SELECT
     C                   WHEN      *IN52
     C                   MOVEL     'UNB+'        WTYPE
     C                   WHEN      *IN53
     C                   MOVEL     'XMLP'        WTYPE
s23  C*                  WHEN      FORT   = 'Export toll'
s23  C*                  MOVEL     'EXTO'        WTYPE
s23  C*                  WHEN      FORT   = 'Import_toll'
s23  C*                  MOVEL     'IMTO'        WTYPE
s23  C*                  WHEN      FORT   = 'Eksport_tol'
s23  C*                  MOVEL     'EXTO'        WTYPE
s23  C*                  WHEN      FORT2  = 'Export toll'
s23  C*                  MOVEL     'EXTO'        WTYPE
s23  C*                  WHEN      FORT2  = 'Import_toll'
s23  C*                  MOVEL     'IMTO'        WTYPE
s23  C*                  WHEN      FORT2  = 'Eksport_tol'
s23  C*                  MOVEL     'EXTO'        WTYPE
N09  C                   WHEN      *IN55
N09  C                   MOVEL     'DKZ '        WTYPE
N21  C                   WHEN      *IN56
N21  C                   MOVEL     'DKZ2'        WTYPE
N23  C                   WHEN      *IN88
N23  C                   MOVEL     'EXTO'        WTYPE
N23  C                   WHEN      *IN89
N23  C                   MOVEL     'IMTO'        WTYPE
N25  C                   WHEN      *IN90
N25  C                   MOVEL     'DKCT'        WTYPE
     C                   OTHER
     C                   MOVE      RTYPE         WTYPE
     C                   ENDSL
     C                   END
      *
     C     STNESTE       TAG
     C   81              WRITE     EDIRER
     C                   DELETE    EDI79FR
     C                   READ      EDI79F1K                               51
     C  N51WTYPE         CABEQ     'XMLP'        STNESTE
N07  C  N51WTYPE         CABEQ     'EXTO'        STNESTE
N07  C  N51WTYPE         CABEQ     'IMTO'        STNESTE
N25  C  N51WTYPE         CABEQ     'DKCT'        STNESTE
N06  C  N51NAVJN         CABEQ     'J'           STNESTE
N09  C  N51*IN55         CABEQ     *ON           STNESTE
N21  C  N51*IN56         CABEQ     *ON           STNESTE
N23  C  N51*IN88         CABEQ     *ON           STNESTE
N23  C  N51*IN89         CABEQ     *ON           STNESTE
      *
      * FOR Å SKRIVE ALLE RECORDS VED AH100 BANKAVSTEMNING
      * MÅ LEGGES ANNEN TYPE I AH100B
      *
     C  N51              END
      *
     C     END           TAG
     C                   MOVE      '1'           *INLR
N11   ************************************************************
N11  C     NAVSR         BEGSR
N11   ************************************************************
N11  C     arklagk       KLIST
N11  C                   KFLD                    fifirm
N11  C                   KFLD                    arklag
N11  C                   OPEN      FIRM
N11  C                   OPEN      FIRMARC
N11  C                   OPEN      ARKTXT
N11  C                   OPEN      ARKEXT
N11  C                   OPEN      FIRMNA
N11  C                   READ      FIRM                                   33
N11  C     FIFIRM        CHAIN     FIRMARC                            33
N11  C     FIFIRM        CHAIN     FIRMNA                             33
N11  C     *IN33         IFEQ      '0'
N11  C                   MOVE      *blanks       IFSFIL           70
N11  C                   MOVE      *blanks       FRAOBJ          256
N11  C                   MOVE      *blanks       TILBAN           70
N11  C                   EVAL      IFSFIL = %SUBST(SXIFSOBJ:X:70)
N11  C     'BACKUP'      SCAN      SXIFSOBJ      x                 3 0    54
N11  C     *in54         ifeq      '1'
N11   * henter eventuell avvinde bane fra arkext
N11  c     NADTDO        chain     ARKTXT                             54
N18  C* NAVITRO FORTOLLING
n18  C     NAVFOR        IFEQ      'J'
N18  c     NADTDH        chain     ARKTXT                             54
n18  C                   END
N11  C     *in54         ifeq      '0'
N11  C     ARKLAG        IFNE      *blanks
N11  c     arklagk       chain     arkext                             54
N11  c                   end
N11  c                   end
N11  C                   EVAL      FRAOBJ = %SUBST(SXIFSOBJ:1:x+6)
N11  C                             + %trim(IFSFIL)
N11  C                   EVAL      TILBAN = '/' + ARCANE
N11  C                   CALL      'SYNA02CL'
N11  C                   PARM                    SXIFSOBJ
N11  C                   PARM                    IFSFIL
N11  C                   PARM                    FRAOBJ
N11  C                   PARM                    TILBAN
N11  C                   end
N11  C                   end
N11  C                   CLOSE     FIRM
N11  C                   CLOSE     FIRMARC
N11  C                   CLOSE     ARKTXT
N11  C                   CLOSE     ARKEXT
N11  C                   CLOSE     FIRMNA
N11  C                   endsr
N12   ************************************************************
N12  C     TOLLSR        BEGSR
N12   ************************************************************
n24  C                   OPEN      FIRMgoog
n15  C                   OPEN      FIRMDAG
N12  C                   OPEN      FIRM
N12  C                   OPEN      FIRMARC
N12  C                   OPEN      ARKTXT
N12  C                   OPEN      ARKEXT
s13  C*                  OPEN      FIRMNA
N12  C                   READ      FIRM                                   33
N12  C     FIFIRM        CHAIN     FIRMARC                            33
n15  C     FIFIRM        CHAIN     FIRMDAG                            54
N15   * henter eventuell avvinde bane fra arkext
N15  c     DGDTDO        chain     ARKTXT                             54
N15  C     *in54         ifeq      '0'
N15  C     ARKLAG        IFNE      *blanks
N15  c     arklagk       chain     arkext                             54
N15  c                   end
N15  c                   end
s13  C*    FIFIRM        CHAIN     FIRMNA                             33
N12  C     *IN33         IFEQ      '0'
N12  C                   MOVE      *blanks       IFSFIL           70
N12  C                   MOVE      *blanks       IFSX            256
N12  C                   MOVE      *blanks       FRAOBJ          256
N12  C                   MOVE      *blanks       TILBAN           70
N12  C     'BACKUP'      SCAN      SXIFSOBJ      x                 3 0    54
N12  C     *in54         ifeq      '1'
N11  C                   EVAL      IFSX =  %SUBST(SXIFSOBJ:X+7:128)
N12   * lage nytt filnavn(IFSFIL)
N12  C                   exsr      arksr
N12  C                   EVAL      IFSFIL = ARLINK
N12   * lage nytt fraobjekt etter rename
N12  C                   EVAL      FRAOBJ = %SUBST(SXIFSOBJ:1:x+6)
N12  C                             + %trim(IFSFIL)
s15   * henter eventuell avvinde bane fra arkext
s15  c*    DGDTDO        chain     ARKTXT                             54
s15  C*    *in54         ifeq      '0'
s15  C*    ARKLAG        IFNE      *blanks
s15  c*    arklagk       chain     arkext                             54
s15  c*                  end
s15  c*                  end
N12  C                   EVAL      TILBAN = '/' + ARCANE
N12  C                   CALL      'SYAL02CL'
N12  C                   PARM                    SXIFSOBJ
N12  C                   PARM                    IFSFIL
N12  C                   PARM                    FRAOBJ
N12  C                   PARM                    TILBAN
N12  C                   end
N12  C                   end
     C     dgep1         ifne      *blanks
     c                   eval      doc=%trim(ARCANE) + '/' + %trim(ARLINK)
     c                   eval      tilnvn='Dagsoppgjørmottager'
     c                   eval      emne='Faktura:' + %trim(kAFNR)
     c                             + ' Dato:'
     c                             + %trim(%editw(KAFDT:'    .  .  '))
s19  c*                            + ' Dagsoppgjør'
n19  c                             + ' Dagsoppgjør Til:'
n19  c                             + %trim(kAtxt)
     c                   call      'SYGE55CLI2'
     c                   parm                    doc             256
     c                   parm                    tilnvn           30
     c                   parm                    dgep1
     c                   parm                    emne             70
     c                   parm                    cvp1             80
     c                   end
     C     dgep2         ifne      *blanks
     c                   call      'SYGE55CLI2'
     c                   parm                    doc
     c                   parm                    tilnvn           30
     c                   parm                    dgep2
     c                   parm                    emne             70
     c                   parm                    cvp1             80
     c                   end
     C     dgep3         ifne      *blanks
     c                   call      'SYGE55CLI2'
     c                   parm                    doc
     c                   parm                    tilnvn           30
     c                   parm                    dgep3
     c                   parm                    emne             70
     c                   parm                    cvp1             80
     c                   end
N24  C                   EXSR      FLYTTGC
      * sender kontrolliste
n14  C     dgep1         ifne      *blanks
n14  c                   eval      doc=%trim(KLBAN)
n14  c                   eval      tilnvn='Dagsoppgjørmottager'
n14  c                   eval      emne='Kontrolliste:' + %trim(kAFNR)
n14  c                             + ' Dato:'
n14  c                             + %trim(%editw(KAFDT:'    .  .  '))
s19  c*                            + ' Dagsoppgjør'
n19  c                             + ' Dagsoppgjør Til:'
n19  c                             + %trim(kAtxt)
n14  c                   call      'SYGE55CLI2'
n14  c                   parm                    doc             256
n14  c                   parm                    tilnvn           30
n14  c                   parm                    dgep1
n14  c                   parm                    emne             70
n14  c                   parm                    cvp1             80
n14  c                   end
n14  C     dgep2         ifne      *blanks
n14  c                   call      'SYGE55CLI2'
n14  c                   parm                    doc
n14  c                   parm                    tilnvn           30
n14  c                   parm                    dgep2
n14  c                   parm                    emne             70
n14  c                   parm                    cvp1             80
n14  c                   end
n14  C     dgep3         ifne      *blanks
n14  c                   call      'SYGE55CLI2'
n14  c                   parm                    doc
n14  c                   parm                    tilnvn           30
n14  c                   parm                    dgep3
n14  c                   parm                    emne             70
n14  c                   parm                    cvp1             80
n14  c                   end
N24  C                   EXSR      FLYTTGC
N12  C                   CLOSE     FIRM
N12  C                   CLOSE     FIRMARC
N12  C                   CLOSE     ARKTXT
N12  C                   CLOSE     ARKEXT
s13  C*                  CLOSE     FIRMNA
n15  C                   CLOSE     FIRMDAG
n24  C                   CLOSE     FIRMgoog
N12  C                   endsr
N12   ************************************************************
N12  C     arksr         BEGSR
N12   ************************************************************
s15  C*                  OPEN      FIRMDAG
N12  C                   OPEN      EDIS9
N12  C                   OPEN      ARKIVP
s15  C*    FIFIRM        CHAIN     FIRMDAG                            33
N12  C                   open      KOSTA2
N12  C     edis9k        klist
N12  c                   kfld                    sifs
N12   *
     c     *like         define    kalnr         wkalnr
N12  C     kosta2k       klist
N12  c                   kfld                    wkalnr
N12  c                   kfld                    kafnr
N12   *
N12  c                   eval      sifs=%xlate('.pdf':'.xml':SXIFSOBJ)
      *
N13  C     edis9k        chain     edis9                              44
N13  C     *in44         ifeq      '1'
N12  C     edis9k        setll     edis9
N12  C                   readp     edis9                                  44
N13  c                   end
     c     *in44         ifeq      '0'
     c                   z-add     dglevn        wkalnr
N12  c                   eval      kafnr=s0026
N12  c     kosta2k       chain     kosta2                             45
     c     *in45         ifeq      '0'
N12  C                   EVAL      ARSTAT = 'A'
N12  C                   EVAL      ARFIRM = FIFIRM
N12  C                   EVAL      ARUNDE = 'KL:'
N12  C                   EVAL      ARUSER = 'ALTINN'
N12  C                   CALL      'SYGE15C'
N12  C                   PARM                    WDT               8
N12  C                   PARM                    WTM               6
N12  C                   MOVE      WDT           ARDATE
N12  C                   MOVE      WTM           ARTIME
N12
N12  C                   EVAL      ARTYPE = DGDTDO
N12  C                   EVAL      ARLINK = DGDTDO
N12  C                   MOVEL     ARDATE        AAR               4
N12  C                   CAT       AAR:0         ARLINK
N12  C                   MOVE      KABNR2        XAN07b            7
N12  C                   MOVE      KABNR         XAN07i            7
N12  C                   CAT       XAN07b:0      ARLINK
N12  C                   CAT       XAN07i:0      ARUNDE
N12  C                   CALL      'ARCRAN'
N12  C                   PARM                    XAN10            10
N12  C                   CAT       XAN10:0       ARLINK
N12  C                   CAT       '.pdf':0      ARLINK
N12  C                   WRITE     ARKIVR
      * kontrolliste
     c                   eval      artype=DGDTKL
     c                   movel     DGDTKL        arlink
     c                   write     arkivr
N11  c                   EVAL      KLBAN = '/' + %trim(ARCANE)
     c                             + '/'
     c                             + %trim(ARLINK)
     c                   call      'SYXMLDOCL'
     c                   parm                    xan07B
     c                   parm                    klban           128
     c                   END
     c                   END
     c                   movel     DGDTDO        arlink
s15  C*                  CLOSE     FIRMDAG
N12  C                   CLOSE     EDIS9
N12  C                   CLOSE     ARKIVP
N12  C                   CLOSE     KOSTA2
N12  C                   endsr
N24   ************************************************************
N24  C     flyttgc       BEGSR
N24   ************************************************************
N24  c     fifirm        chain     firmgoog                           33
N24  c     *in33         ifeq      '0'
n24  c                   eval      fraban=DOC
n24  c                   eval      TILban=DOC
n24  c                   call      'SYGE137'
n24  c                   parm                    fraban           90
n24  c                   parm                    tilban           70
n24  c                   parm                    dokok             1
n24  c                   parm                    uokmov            1
n24  c                   end
N24  C                   ENDSR
