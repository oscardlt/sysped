      *
      **************************************************************
      *** PROGRAM SKAL ARBEIDE MED AMETAAVREGNING                ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER       ***
      *** LEDIGE INDIKATORER                                     ***
      *** 61 BASIS AMETA                                         ***
      *** 62 UTVIDET AMETA                                       ***
      **************************************************************
      *
     FCUNDL01   IF   E           K DISK
     FHEADF     IF   E           K DISK
     FAMWTUAG   IF   E           K DISK
     FTURER     IF   E           K DISK
     FAMGEBYR   IF   E           K DISK
     FFIRM      IF   E           K DISK
     FFAK2      IF   E           K DISK
     FAMHE      IF   E           K DISK
     FAMDE      IF   E           K DISK
     FAMGE      IF   E           K DISK
     FSYAM91FM  CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
     D                UDS
     D  UFIRM                  1      2
     D  UAVD                  15     18  0
     D  USG                   19     21
     D  UPRO                  22     29  0
     D  UDT                   30     35  0
     D  UHOD                  47     47
     D  UBBS                  48     48
     D  UGN                  981    995
     D                 DS
     D  DSTXT                  1     26
     D  DSTXT1                 1      7
     D  DSTXT2                 8     14
     D  DSTXT3                15     26
     D                 DS
     D  DSNVN                  1     30
     D  DSNVN1                 1     10
     D  DSNVN2                11     11
     D  DSNVN3                12     30
     D                 DS
     D  W2PER                  1      4  0
     D  W2PER≈                 1      2  0
     D  W2PERM                 3      4  0
     D                 DS
     D  KPER                   1      4  0
     D  K≈R                    1      2  0
     D  KMND                   3      4  0
     D                 DS
     D  DSBDAT                 1      6  0
     D  DSBDD                  1      2  0
     D  DSBMM                  3      4  0
     D  DSB≈≈                  5      6  0
     D                 DS
     D  KSBEL                  1     17  4
     D  KSHEL                  1     13  0
     D  KSDEC4                14     17  0
     D                 DS
     D  XDATO                  1      6  0
     D  XMND                   1      2  0
     D  XDAG                   3      4  0
     D  XAAR                   5      6  0
     D                 DS
     D  WDATO                  1      6  0
     D  WAAR                   1      2  0
     D  WMND                   3      4  0
     D  WDAG                   5      6  0
     D                 DS
     D  AHA≈≈                  1      4  0
     D  AHAMM                  5      6  0
     D  AHADD                  7      8  0
     D  AHADAT                 1      8  0
     D                 DS
     D  W2ADD                  1      2  0
     D  W2AMM                  3      4  0
     D  W2A≈≈                  5      6  0
     D  W2ADAT                 1      6  0
     D                 DS
     D  AHB≈≈                  1      4  0
     D  AHBMM                  5      6  0
     D  AHBDD                  7      8  0
     D  AHBDAT                 1      8  0
     D                 DS
     D  W2BDD                  1      2  0
     D  W2BMM                  3      4  0
     D  W2B≈≈                  5      6  0
     D  W2BDAT                 1      6  0
     C*
     C     *ENTRY        PLIST
     C                   PARM                    UTURNR            8 0
     C                   PARM                    UAGENT            8 0
     C*
     C                   EXSR      INIT
     C*
     C     CHOISE        TAG
     C                   CLEAR                   WNETDF
     C                   CLEAR                   TONETN
     C                   CLEAR                   WKLUM2
     C                   CLEAR                   RSDIFF
     C                   CLEAR                   TOVEKT
     C*
     C                   CLEAR                   TONETN
     C                   CLEAR                   WKLUMP
     C                   CLEAR                   WKLUM2
     C                   CLEAR                   TKLUMP
     C                   CLEAR                   XKLUM2
     C                   CLEAR                   WFORN
     C                   CLEAR                   WFORDF
     C                   CLEAR                   WNETDF
     C                   CLEAR                   WNETN
     C                   CLEAR                   WANETN
     C                   CLEAR                   WLNETN
     C*
     C                   CLEAR                   ZRECNO
     C                   CLEAR                   MRECNO
     C                   CLEAR                   ANTF1
     C                   CLEAR                   ANTF2
     C                   Z-ADD     04            LINNBR
     C                   Z-ADD     29            POSNBR
     C                   MOVE      UTURNR        W1TNR
     C                   MOVE      UAGENT        W1KNA
     C                   MOVEL     W1TNR         W1AVD
     C*
     C**  AVSLUTT
     C*
     C                   CLEAR                   BILDE2
     C*
     C                   Z-ADD     W1TNR         W2TNR
     C                   Z-ADD     W1TNR         UTURNR
     C     CHOIS2        TAG
     C                   Z-ADD     07            LINNBR
     C                   Z-ADD     14            POSNBR
     C     CHOIS3        TAG
     C     W2KNA         IFEQ      *ZERO
     C                   CLEAR                   W2NAVN
     C                   MOVE      'DIV2547'     MSGNR
     C                   SETON                                        307177
     C                   Z-ADD     04            LINNBR
     C                   Z-ADD     14            POSNBR
     C*                    GOTO SLTB2
     C                   END
     C                   CLEAR                   *IN12
     C     XAHST         IFEQ      '6'
     C                   SETON                                        77
     C                   Z-ADD     06            LINNBR
     C                   Z-ADD     14            POSNBR
     C                   END
     C                   EXFMT     BILDE2
     C     *IN03         IFEQ      '1'
     C                   SETOFF                                       3077
     C                   GOTO      SLUTT
     C                   END                                                    <*IN03
     C     *IN12         IFEQ      '1'
     C                   SETOFF                                       3077
     C                   GOTO      SLUTT
     C                   END                                                    <*IN12
     C                   EXSR      TESTB2
     C   30              GOTO      CHOIS3
     C*  SUBFILE CLEAR
     C     START         TAG
     C                   EXSR      BLANKW
     C                   CLEAR                   TOVEKT
     C                   CLEAR                   TEI999
     C                   CLEAR                   TEU999
     C                   CLEAR                   TAI999
     C                   CLEAR                   TAU999
     C                   CLEAR                   TOEINT
     C                   CLEAR                   TOEUTG
     C                   CLEAR                   TOAINT
     C                   CLEAR                   TOAUTG
     C                   MOVEA     '00'          *IN(91)
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
      *_____________
      * Fyll Subfile
      *"""""""""""""
     C                   CLEAR                   XUNR
     C                   CLEAR                   XPOS1
     C                   CLEAR                   WUNR
     C                   CLEAR                   ZRECNO
     C                   CLEAR                   MRECNO
     C* FINN ALLE OPPDRAG P≈ TUREN
     C     AMWKEY        SETLL     AMWTUAG
     C     HELES         TAG
     C     AMWKEY        READE     AMWTUAG                                34
     C     *IN34         IFEQ      *OFF
     C     HEADWK        CHAIN     HEADF                              51
     C                   ENDIF
     C     *IN34         IFEQ      '1'
     C* TREKKING/FERJE ETC. INN HER
     C                   GOTO      START2
     C                   END
     C     *IN47         IFEQ      '1'
     C     XPOS1         ANDNE     HEPOS1
     C                   CLEAR                   WUNR
     C                   CLEAR                   XUNR
     C                   END                                                    <*IN47
     C                   MOVEL     HEPOS1        XPOS1
     C                   MOVE      '1'           *IN47
     C     START1        TAG
     C                   SETOFF                                           38
     C* HENTER INNTEKTER/KOSTNADER PR. TUR/POSISJON
     C     FALES         TAG
     C     *IN39         IFEQ      '0'
     C                   EXSR      LESAME
     C                   GOTO      START2
     C                   END                                                    <*IN39
     C*
     C*  SKRIV SUBFILE
     C                   ADD       1             WUNR
     C                   ADD       1             ZRECNO
     C                   ADD       1             MRECNO
     C                   EXSR      MOVS0
     C     THPOSN        IFEQ      '9999'
     C                   MOVE      '1'           *IN44
     C                   ELSE
     C                   MOVE      '0'           *IN44
     C                   END                                                    <THPOSN
     C                   WRITE     SUBFIL
     C                   MOVEA     '100'         *IN(80)
     C                   CLEAR                   THEINT
     C                   CLEAR                   THEUTG
     C                   CLEAR                   THAINT
     C                   CLEAR                   THAUTG
     C                   GOTO      HELES
     C*
     C     START2        TAG
     C                   EXSR      MOV999
     C                   Z-ADD     9             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   Z-ADD     1             ZRECNO
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
     C     MRECNO        IFEQ      0
     C                   Z-ADD     8             POSNBR
     C                   EXFMT     NYWRK
     C                   ELSE
     C                   MOVE      '1'           *IN(94)
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   EXFMT     BUNN
     C                   END
     C***
     C                   SETOFF                                       9899
     C*
     C*** AVSLUTT
     C*
     C*
     C*** FOREG≈ENDE BILDE / NYTT SÿK
     C   12              GOTO      CHOIS2
     C*
     C                   SETOFF                                       94
     C*
     C*** SE RESULTATAVREGNING
     C     *IN13         IFEQ      '1'
     C                   EXSR      RESULT
     C                   EXFMT     AVREGN
     C                   GOTO      START3
     C                   END                                                    <*IN13
     C*
     C*** ROLLUP
     C     *IN25         IFEQ      '1'
     C                   MOVE      '0'           *IN25
     C                   MOVE      '1'           *IN94
     C                   GOTO      START3
     C                   END                                                    <*IN25
     C*
     C*** ROLLDOWN
     C     *IN26         IFEQ      '1'
     C                   MOVE      '0'           *IN25
     C                   MOVE      '1'           *IN94
     C                   GOTO      START3
     C                   END                                                    <*IN26
     C*
     C     ZRECNO        IFNE      0
     C                   EXSR      HENTSR
     C                   END
     C*
     C                   GOTO      START3
     C*
     C     SLUTT         TAG
     C                   SETON                                        LR
     C*
     C***********************************************
     C     TESTB1        BEGSR
     C***********************************************
     C*
     C                   MOVEA     '0000'        *IN(29)
     C                   MOVEA     '00000000'    *IN(70)
     C* SJEKK OM AMETA FINNES FRA FÿR
     C                   MOVE      W1TNR         ZTUNR
     C                   MOVE      W1KNA         ZKNA
     C     AMHEKY        CHAIN     AMHE                               39
     C     *IN39         IFEQ      *OFF
     C                   MOVE      AHVALS        W2VALK
     C                   MOVE      AHKURS        W2KURS
     C                   MOVE      100           OMRFAK
     C                   MOVEL     TUBILN        W2BILN
     C                   MOVEL     AHEREF        W2EREF
     C                   MOVEL     AHEREF        W2AREF
     C                   MOVE      AHDEL         W2AGNT
     C                   MOVE      AATYPE        W2TYPE
     C                   EXSR      ATEXT
     C* HENT AGENTNAVN
     C                   MOVE      FIFIRM        ZFIRMA
     C                   MOVE      W1KNA         ZKUNDN
     C*
     C                   END                                                    <*IN39
     C     KUNKEY        CHAIN     CUNDL01                            35
     C     *IN35         IFEQ      '0'
     C                   MOVE      W1KNA         W2KNA
     C                   CLEAR                   DSNVN
     C                   MOVEL     KNAVN         DSNVN1
     C                   MOVEL     '/'           DSNVN2
     C                   MOVEL     ADR3          DSNVN3
     C                   MOVE      DSNVN         W2NAVN
     C                   ELSE
     C                   CLEAR                   W2KNA
     C                   CLEAR                   W2NAVN
     C                   CLEAR                   W2VALK
     C                   CLEAR                   W2KURS
     C                   CLEAR                   VALKOD
     C                   END                                                    <*IN35
     C* HENT TRANSPORTÿRNAVN
     C                   MOVE      FIFIRM        ZFIRMA
     C     *IN39         IFEQ      '0'
     C                   MOVE      AHKNT         ZKUNDN
     C                   ELSE
     C     TUKNT2        IFNE      *ZEROS
     C                   MOVE      TUKNT2        ZKUNDN
     C                   ELSE
     C                   MOVE      TUKNT         ZKUNDN
     C                   END
     C                   END                                                    <*IN39
     C     KUNKEY        CHAIN     CUNDL01                            35
     C     *IN35         IFEQ      '0'
     C                   MOVE      KUNDNR        W2KNT
     C                   MOVE      KNAVN         W2TRAN
     C                   ELSE
     C                   CLEAR                   W2KNT
     C                   CLEAR                   W2TRAN
     C                   END                                                    <*IN35
     C* HENT OMREGNINGSFAKTOR
     C                   MOVE      AHKURS        W2KURS
     C                   MOVE      AHDTMP        W2PERM
     C                   MOVE      AHDT≈P        W2PER≈
     C                   MOVE      AHDEL         W2AGNT
     C                   MOVE      AHBILN        W2BILN
     C                   MOVE      AHADD         W2ADD
     C                   MOVE      AHADM         W2AMM
     C                   MOVE      AHAD≈         W2A≈≈
     C                   MOVE      AHAREF        W2AREF
     C                   MOVE      AHEREF        W2EREF
     C                   MOVE      AHENH         W2ENH
     C                   MOVE      AHENH         W2ENH
     C                   MOVE      AHBDD         W2BDD
     C                   MOVE      AHBDM         W2BMM
     C                   MOVE      AHBD≈         W2B≈≈
     C                   MOVE      AHKNT         W2KNT
     C                   MOVE      AHTRAN        W2TRAN
     C                   MOVE      AHTRKO        W2TRKO
     C                   MOVE      AHTRKP        W2TRKP
     C                   MOVE      AHFERJ        W2FERJ
     C                   MOVE      AHFERP        W2FERP
     C                   MOVE      AHTREK        W2TREK
     C                   MOVE      AHTREP        W2TREP
     C                   MOVE      AHDIV         W2DIV
     C                   MOVE      AHDIVP        W2DIVP
     C                   MOVE      AHDIVT        W2DIVT
ERT  C                   MOVE      AHDIV2        W2DIV2
ERT  C                   MOVE      AHDIVQ        W2DIVQ
ERT  C                   MOVE      AHDIVU        W2DIVU
     C                   EXSR      ATEXT
     C                   MOVE      AHST          XAHST
     C                   MOVE      '2'           AHST
     C                   UPDATE    AMHER
     C                   END                                                    <*IN39
     C*  INPUTDATA OK
     C     SLTB1         ENDSR
     C*
     C***********************************************
     C     TESTB2        BEGSR
     C***********************************************
     C*
     C                   MOVEA     '0'           *IN(30)
     C                   MOVEA     '00000000'    *IN(70)
     C* PERIODE
     C     W2PERM        IFEQ      *ZERO
     C     W2PER≈        OREQ      *ZEROS
     C                   MOVE      'DIV2264'     MSGNR
     C                   SETON                                        3071
     C                   Z-ADD     18            LINNBR
     C                   Z-ADD     14            POSNBR
     C                   GOTO      SLTB2
     C                   END
     C                   SETOFF                                       77
     C     W2KNA         IFEQ      *ZERO
     C                   CLEAR                   W2NAVN
     C                   MOVE      'DIV2547'     MSGNR
     C                   SETON                                        307177
     C                   Z-ADD     04            LINNBR
     C                   Z-ADD     14            POSNBR
     C                   GOTO      SLTB2
     C                   END
     C     W2KNA         IFNE      *ZERO
     C                   MOVE      W2KNA         ZKUNDN
     C     KUNKEY        CHAIN     CUNDL01                            35
     C     *IN35         IFEQ      '0'
     C                   MOVE      SFAKT         WSFAKT            1
     C                   CLEAR                   DSNVN
     C                   MOVEL     KNAVN         DSNVN1
     C                   MOVEL     '/'           DSNVN2
     C                   MOVEL     ADR3          DSNVN3
     C                   MOVEL     DSNVN         W2NAVN
     C                   ELSE
     C                   MOVE      ' '           WSFAKT
     C                   CLEAR                   W2NAVN
     C                   MOVE      'DIV2548'     MSGNR
     C                   SETON                                        307177
     C                   Z-ADD     06            LINNBR
     C                   Z-ADD     14            POSNBR
     C                   GOTO      SLTB2
     C                   END                                                    <WKNA
     C                   END                                                    <*IN35
     C*  INPUTDATA OK
     C     SLTB2         ENDSR
     C***********************************************
     C     LESAME        BEGSR
     C***********************************************
     C* ---------------------------------------------
     C* LES ALLE AMETALINJER
     C* """""""""""""""""""""""""""""""""""""""""""""
     C*
     C                   CLEAR                   ANTF1
     C                   CLEAR                   ANTF2
     C                   MOVE      AHTUNR        ZTUNR
     C                   MOVE      AHKNA         ZKNA
     C     AMHEKY        SETLL     AMDE                                   38
     C     AMTAG1        TAG
     C                   MOVE      AHTUNR        ZTUNR
     C     AMHEKY        READE     AMDE                                   38
     C*   DISPLAY SUBFILE
     C   38              GOTO      ENDAME
     C*   IKKE TA MED KOSTNADER FRA BILDE - BYGG OPP P≈ NYTT
     C     ADPOS         IFEQ      '9999'
ERT  C     ADUNR         IFGE      95
     C     ADUNR         ANDLE     99
     C                   GOTO      AMTAG1
     C                   END                                                    <ADUNR
     C                   END                                                    <ADPOS
     C*
     C                   ADD       1             ZRECNO
     C                   ADD       1             MRECNO
     C                   ADD       1             ANTF2
     C                   EXSR      MOVS1
     C     THPOSN        IFEQ      '9999'
     C                   MOVE      '1'           *IN44
     C                   ELSE
     C                   MOVE      '0'           *IN44
     C                   ADD       1             ANTF1
     C                   END                                                    <THPOSN
     C                   WRITE     SUBFIL
     C                   MOVEA     '100'         *IN(80)
     C* FLERE AMETALINJER P≈ DENNE TUR
     C                   GOTO      AMTAG1
     C*
     C     ENDAME        TAG
     C                   ENDIF                                                  <*IN40
     C                   ENDDO                                                  <*IN40
     C                   ENDSR
     C*
     C***********************************************
     C     HENTSR        BEGSR
     C***********************************************
     C                   Z-ADD     0             LINNBR
     C                   SETOFF                                       919299
     C     *IN98         DOWEQ     '0'
     C                   READC     SUBFIL                                 98
     C   98              DO
     C   99              SETOFF                                       98
     C                   Z-ADD     1             LINNBR
     C                   GOTO      SLHENT
     C                   ENDDO                                                  <98 DO
     C     ZRECNO        DIV       5             LINNBR
     C                   MVR                     XLIN              2 0
     C     XLIN          IFEQ      0
     C                   Z-ADD     9             LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END                                                    <XLIN
     C*    OPTION 2=ENDRE
     C     WSNRO         IFEQ      '2'                                          ENDRE
     C                   MOVE      ' '           WSNRO
     C                   MOVE      '1'           *IN99
     C                   Z-ADD     21            LINNBR
     C                   Z-ADD     29            POSNBR
     C     TENDRE        TAG
     C     THPOSN        IFEQ      '9999'
     C                   MOVE      '1'           *IN44
     C                   ELSE
     C                   MOVE      '0'           *IN44
     C                   END                                                    <THPOSN
     C                   EXFMT     CHGLIN
     C*
     C*  TEST FOR GYLDIG FRANKATUR
     C*
     C   12              GOTO      SLHENT
     C*
     C                   EXSR      TESTLI
     C     *IN30         IFEQ      '1'
     C                   GOTO      TENDRE
     C                   END                                                    <*IN30
     C*
     C                   UPDATE    SUBFIL
     C                   MOVEA     '010'         *IN(80)
     C                   EXSR      UPDWRK
     C                   END                                                    <WSNRO
     C*    OPTION 4=SLETTE
     C     WSNRO         IFEQ      '4'                                          SLETTE
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     02            POSNBR
     C                   MOVE      '1'           *IN99
     C     THPOSN        IFEQ      '9999'
     C                   MOVE      '1'           *IN44
     C                   ELSE
     C                   MOVE      '0'           *IN44
     C                   END                                                    <THPOSN
     C                   EXFMT     DLTLIN
     C   12              GOTO      SLHENT
     C                   UPDATE    SUBFIL
     C                   MOVEA     '001'         *IN(80)
     C                   EXSR      UPDWRK
     C                   END                                                    <WSNRO
     C*    OPTION 5=VISE KOMPONENTER
     C     WSNRO         IFEQ      '5'
     C     *IN61         ANDEQ     *ON
     C                   MOVE      ' '           WSNRO
     C                   ENDIF                                                  <WSNRO
     C     WSNRO         IFEQ      '5'                                          ENDRE
     C                   MOVE      ' '           WSNRO
     C                   MOVE      '1'           *IN99
     C                   Z-ADD     21            LINNBR
     C                   Z-ADD     29            POSNBR
     C*
     C                   MOVE      W2TNR         PTNR              8
     C                   MOVE      THAVD         PAVD              4
     C                   MOVE      THOPD         POPD              7
     C                   MOVE      W2KNA         PKNA              8
     C                   MOVEL     W2NAVN        PNAVN            30
     C                   MOVE      W2IMEX        PIMEX             1
     C                   MOVEL     THPOSN        PPOSN             7
     C                   MOVE      THUNR         PUNR              8
     C                   MOVE      THVEKT        PVEKT             5
     C                   MOVE      THVOL         PVOL              7
     C                   MOVE      THVTXT        PTXT              2
     C                   MOVE      THFRAN        PFRAN             3
     C                   CALL      'SYAM01A'
     C                   PARM                    PTNR
     C                   PARM                    PAVD
     C                   PARM                    POPD
     C                   PARM                    PKNA
     C                   PARM                    PNAVN
     C                   PARM                    PIMEX
     C                   PARM                    PPOSN
     C                   PARM                    PUNR
     C                   PARM                    PEINT
     C                   PARM                    PEUTG
     C                   PARM                    PAINT
     C                   PARM                    PAUTG
     C                   PARM                    PVEKT
     C                   PARM                    PTXT
     C                   PARM                    PFRAN
     C                   PARM                    PVOL
     C*
     C                   MOVE      PEINT         THEINT
     C                   MOVE      PEUTG         THEUTG
     C                   MOVE      PAINT         THAINT
     C                   MOVE      PAUTG         THAUTG
     C                   UPDATE    SUBFIL
     C                   MOVEA     '010'         *IN(80)
     C                   EXSR      UPDWRK
     C                   END                                                    <WSNRO
ERT  C*    OPTION 6=SE OPPDRAG
ERT  C     WSNRO         IFEQ      '6'
ERT  C                   EXSR      SEOPD
ERT  C                   MOVE      *ON           *IN78
ERT  C                   END                                                    <WSNRO
ERT  C*
ERT  C     WSNRO         IFEQ      '7'
ERT  C                   MOVE      '1'           *IN99
ERT  C                   Z-ADD     21            LINNBR
ERT  C                   Z-ADD     29            POSNBR
ERT  C                   EXSR      SEFAK
ERT  C                   MOVE      *ON           *IN78
ERT  C                   MOVEA     '010'         *IN(80)
ERT  C                   END                                                    <WSNRO
     C*
     C                   END                                                    <*IN98
     C*
     C     SLHENT        TAG
     C                   ADD       8             LINNBR
     C                   Z-ADD     2             POSNBR
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     ADDS1         BEGSR
     C***********************************************
     C     FASK          IFNE      'A'
     C     KGESTA        IFEQ      'A'
     C                   ADD       FABELN        THEINT
     C                   ADD       FABELN        TOEINT
     C                   END                                                    <KGESTA
     C                   END                                                    <FASK
     C     FASK          IFEQ      'A'
     C                   ADD       FABELN        THEUTG
     C                   ADD       FABELN        TOEUTG
     C                   END                                                    <FASK
     C                   ENDSR
     C***********************************************
     C     MOV999        BEGSR
     C***********************************************
     C                   MOVEL     '9999'        THPOSN
     C                   MOVE      WUNR          THUNR
     C                   MOVE      *ZEROS        THVEKT
     C                   MOVE      *BLANKS       THVOL
     C                   MOVE      *BLANKS       THVTXT
     C                   MOVE      *BLANKS       THFRAN
     C                   MOVE      *ZEROS        THAVD
     C                   MOVE      *ZEROS        THOPD
     C                   MOVE      *BLANKS       THST
     C                   MOVE      *BLANKS       THTXT
     C                   MOVE      *ZEROS        SM9999           13 2
     C                   CLEAR                   THEINT
     C                   CLEAR                   THEUTG
     C                   CLEAR                   THAINT
     C                   CLEAR                   THAUTG
ERT  C* DIVERSE 2
ERT  C     WUNR          IFEQ      95
ERT  C                   MOVE      *BLANKS       THTXT
ERT  C                   MOVEL     W2DIVU        THTXT
ERT  C     W2DIVQ        IFEQ      'A'
ERT  C                   Z-ADD     W2DIV2        THAUTG
ERT  C                   ADD       W2DIV2        TOAUTG
ERT  C                   ADD       W2DIV2        TAU999
ERT  C                   SUB       W2DIV2        SM9999
ERT  C                   ELSE
ERT  C                   Z-ADD     W2DIV2        THEUTG
ERT  C                   ADD       W2DIV2        TOEUTG
ERT  C                   ADD       W2DIV2        TEU999
ERT  C                   ADD       W2DIV2        SM9999
ERT  C                   ENDIF                                                  <W2DIVQ
ERT  C                   ENDIF                                                  <WUNR
     C* TR.KOSTN
     C     WUNR          IFEQ      96
     C                   MOVE      *BLANKS       THTXT
     C                   MOVEL     'TR.KOST'     THTXT
     C     SPRAAK        IFEQ      'E'
     C                   CLEAR                   DSTXT
     C                   MOVEL     'TRUCK C'     DSTXT1
     C                   MOVEL     'OST    '     DSTXT2
     C                   MOVE      *BLANKS       THTXT
     C                   MOVEL     DSTXT         THTXT
     C                   ENDIF                                                  <SPRAAK
     C     W2TRKP        IFEQ      'A'
     C                   Z-ADD     W2TRKO        THAUTG
     C                   ADD       W2TRKO        TOAUTG
     C                   ADD       W2TRKO        TAU999
     C                   SUB       W2TRKO        SM9999
     C                   ELSE
     C                   Z-ADD     W2TRKO        THEUTG
     C                   ADD       W2TRKO        TOEUTG
     C                   ADD       W2TRKO        TEU999
     C                   ADD       W2TRKO        SM9999
     C                   ENDIF                                                  <W2TRKP
     C                   ENDIF                                                  <WUNR
     C* FERJE
     C     WUNR          IFEQ      97
     C                   MOVE      *BLANKS       THTXT
     C                   MOVEL     'FERJE'       THTXT
     C     SPRAAK        IFEQ      'E'
     C                   MOVE      *BLANKS       THTXT
     C                   MOVEL     'FERRY  '     THTXT
     C                   ENDIF                                                  <SPRAAK
     C     W2FERP        IFEQ      'A'
     C                   Z-ADD     W2FERJ        THAUTG
     C                   ADD       W2FERJ        TOAUTG
     C                   ADD       W2FERJ        TAU999
     C                   SUB       W2FERJ        SM9999
     C                   ELSE
     C                   Z-ADD     W2FERJ        THEUTG
     C                   ADD       W2FERJ        TOEUTG
     C                   ADD       W2FERJ        TEU999
     C                   ADD       W2FERJ        SM9999
     C                   ENDIF                                                  <W2FERP
     C                   ENDIF                                                  <WUNR
     C* TREKKING
     C     WUNR          IFEQ      98
     C                   MOVE      *BLANKS       THTXT
     C                   MOVEL     'TREKKING'    THTXT
     C     SPRAAK        IFEQ      'E'
     C                   MOVE      *BLANKS       THTXT
     C                   MOVEL     'HAULAGE'     THTXT
     C                   ENDIF                                                  <SPRAAK
     C     W2TREP        IFEQ      'A'
     C                   Z-ADD     W2TREK        THAUTG
     C                   ADD       W2TREK        TOAUTG
     C                   ADD       W2TREK        TAU999
     C                   SUB       W2TREK        SM9999
     C                   ELSE
     C                   Z-ADD     W2TREK        THEUTG
     C                   ADD       W2TREK        TOEUTG
     C                   ADD       W2TREK        TEU999
     C                   ADD       W2TREK        SM9999
     C                   ENDIF                                                  <W2TREP
     C                   ENDIF                                                  <WUNR
     C* DIVERSE
     C     WUNR          IFEQ      99
     C                   MOVE      *BLANKS       THTXT
     C                   MOVEL     W2DIVT        THTXT
     C     W2DIVP        IFEQ      'A'
     C                   Z-ADD     W2DIV         THAUTG
     C                   ADD       W2DIV         TOAUTG
     C                   ADD       W2DIV         TAU999
     C                   SUB       W2DIV         SM9999
     C                   ELSE
     C                   Z-ADD     W2DIV         THEUTG
     C                   ADD       W2DIV         TOEUTG
     C                   ADD       W2DIV         TEU999
     C                   ADD       W2DIV         SM9999
     C                   ENDIF                                                  <W2DIVP
     C                   ENDIF                                                  <WUNR
     C                   ENDSR
     C***********************************************
     C     MOVS0         BEGSR
     C***********************************************
     C                   MOVEL     HEPOS1        THPOSN
     C                   MOVE      WUNR          THUNR
     C                   MOVE      HEAVD         THAVD
     C                   MOVE      HEOPD         THOPD
     C                   MOVE      HEST          THST
     C                   MOVE      HEVKT         THVEKT
     C                   ADD       HEVKT         TOVEKT
     C     HEM3          IFGT      HELM
     C                   Z-ADD     HEM3          THVOL
     C                   MOVE      'M3'          THVTXT
     C                   ELSE
     C                   Z-ADD     HELM          THVOL
     C                   MOVE      'LM'          THVTXT
     C                   END                                                    <HEM3
     C     THVOL         IFEQ      *ZERO
     C                   MOVE      '  '          THVTXT
     C                   END                                                    <THVOL
     C                   MOVE      HEFR          THFRAN
     C                   MOVE      *BLANKS       THTXT
     C                   MOVE      HEAVD         UAVD
     C                   ENDSR
     C***********************************************
     C     MOVS1         BEGSR
     C***********************************************
     C                   MOVEL     ADPOS         THPOSN
     C                   MOVE      ADUNR         THUNR
     C                   MOVE      ADAVD         THAVD
     C                   MOVE      ADOPD         THOPD
     C     HEADFK        CHAIN     HEADF                              72
ERT  C     *IN72         IFEQ      *OFF
     C                   MOVE      HEST          THST
ERT  C                   ELSE
ERT  C                   MOVE      ' '           THST
ERT  C                   END                                                    <*IN72
     C                   MOVE      ADVKT         THVEKT
     C                   Z-ADD     ADM3          THVOL
     C                   MOVE      ADVTXT        THVTXT
     C                   MOVE      ADFR          THFRAN
     C                   MOVE      ADTXT         THTXT
     C                   MOVE      ADEINT        THEINT
     C                   MOVE      ADEUTG        THEUTG
     C                   MOVE      ADAINT        THAINT
     C                   MOVE      ADAUTG        THAUTG
     C     THPOSN        IFNE      '9999'
     C                   MOVE      ADAVD         UAVD
     C                   END                                                    <THPOSN
     C     THPOSN        IFEQ      '9999'
     C                   ADD       THEINT        TEI999
     C                   ADD       THEUTG        TEU999
     C                   ADD       THAINT        TAI999
     C                   ADD       THAUTG        TAU999
     C                   END                                                    <THPOSN
     C                   ADD       THVEKT        TOVEKT
     C                   ADD       THEINT        TOEINT
     C                   ADD       THEUTG        TOEUTG
     C                   ADD       THAINT        TOAINT
     C                   ADD       THAUTG        TOAUTG
     C                   ENDSR
     C***********************************************
     C     HENTMS        BEGSR
     C***********************************************
     C                   CALL      'SUBR23R3'
     C                   PARM                    XMSGNR
     C                   PARM                    XMSG             62
     C                   PARM                    XLEVEL
     C                   PARM                    XRETUR
     C                   PARM                    XMSGL
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     RESULT        BEGSR
     C***********************************************
ERT  C                   MOVE      W2VALK        W2VALA
     C                   MOVE      TOEINT        SMEINT
     C                   MOVE      TOEUTG        SMEUTG
     C                   MOVE      TOAINT        SMAINT
     C                   MOVE      TOAUTG        SMAUTG
     C                   EXSR      BSALDO
     C                   EXSR      BGEV
     C                   EXSR      BDEL
     C                   EXSR      BRES
     C                   ENDSR
     C*
     C***********************************************
     C     BSALDO        BEGSR
     C***********************************************
     C*
     C*  BEREGNER SALDO OG OMREGNET TIL KURS
     C*
     C* HENT VALUTAKURS
     C                   MOVE      W2VALK        ZVALKO
     C     VALKEY        CHAIN     VALUAL01                           34
     C     *IN34         IFEQ      *ON
     C                   MOVE      100           OMRFAK
     C                   END                                                    <*IN34
ERT  C                   MOVE      100           OMRFAK
     C     SMAINT        SUB       SMAUTG        SLADIF           13 2
ERT  C     SLADIF        MULT      1             KSBEL
     C     SLADIF        IFGE      *ZERO
     C                   Z-ADD     SLADIF        SLAINT
     C                   Z-ADD     0             SLAUTG
     C                   Z-ADD     KSBEL         KSAINT
     C                   Z-ADD     0             KSAUTG
     C                   MOVEA     '10'          *IN(51)
     C                   ELSE
     C                   Z-ADD     0             SLAINT
     C                   Z-ADD     SLADIF        SLAUTG
     C                   Z-ADD     0             KSAINT
     C                   Z-ADD     KSBEL         KSAUTG
     C                   MOVEA     '01'          *IN(51)
     C                   END                                                    <SLADIF
     C*
     C     SMEINT        SUB       SMEUTG        SLEDIF           13 2
     C     SLEDIF        IFGT      *ZERO
     C                   Z-ADD     SLEDIF        SLEINT
     C                   Z-ADD     0             SLEUTG
     C                   MOVEA     '10'          *IN(53)
     C                   ELSE
     C                   Z-ADD     0             SLEINT
     C                   Z-ADD     SLEDIF        SLEUTG
     C                   MOVEA     '01'          *IN(53)
     C                   END                                                    <SLEDIF
     C                   ENDSR
     C*
     C***********************************************
     C     BGEV          BEGSR
     C***********************************************
     C     AHTYPE        IFNE      'P'
     C     SLEDIF        ADD       KSBEL         GTDIFF           13 2
     C                   ELSE
     C     SMEINT        SUB       SM9999        GTDIFF
     C                   ENDIF                                                  <AHTYPE
     C     GTDIFF        IFGT      *ZERO
     C                   MOVE      '0'           *IN50
     C                   ELSE
     C                   MOVE      '1'           *IN50
     C                   END                                                    <GTDIFF
     C                   Z-ADD     GTDIFF        GTBEL1
     C                   ENDSR
     C*
     C***********************************************
     C     BDEL          BEGSR
     C***********************************************
     C                   Z-ADD     W2AGNT        PAPRO1
ERT  C     GTDIFF        MULT      W2AGNT        PADEL            15 2
     C     PADEL         DIV       100           PADEL
     C                   MVR                     WREST             2 0868785
     C                   Z-ADD     PADEL         PABEL1
     C                   ENDSR
     C*
     C***********************************************
     C     BRES          BEGSR
     C***********************************************
     C     AHTYPE        IFNE      'P'
ERT  C     PADEL         SUB       KSBEL         RSDIFF           13 2
     C                   ELSE
     C     PADEL         SUB       SMEUTG        RSDIFF
     C                   ENDIF                                                  <AHTYPE
ERT  C     RSDIFF        IFGT      0
     C                   Z-ADD     RSDIFF        RSBEL1
     C                   MOVEA     '10'          *IN(55)
     C                   ELSE
ERT  C     RSDIFF        MULT      -1            RSBEL2
     C                   MOVEA     '01'          *IN(55)
     C                   END                                                    <RSDIFF
     C                   ENDSR
     C*
     C***********************************************
     C     KLUMP         BEGSR
     C***********************************************
     C*
     C*  BEREGNER TOTAL KLUMPSUM I NOK
     C*
     C     TAI999        SUB       TAU999        WKLUMP           17 6
     C     WKLUMP        MULT      W2KURS        WKLUMP
     C     WKLUMP        DIV       OMRFAK        WKLUMP
     C                   ADD       TEI999        WKLUMP
     C     WKLUMP        SUB       TEU999        WKLUMP
     C*
     C*  BEREGNER AGENTS ANDEL AV KLUMPSUM I NOK
     C*
     C     WKLUMP        MULT      W2AGNT        XKLUM2           17 6
     C     XKLUM2        DIV       100           XKLUM2
     C     XKLUM2        MULT(H)   1             WKLUM2           13 2
     C                   ENDSR
     C***********************************************
     C     ATEXT         BEGSR
     C***********************************************
     C                   MOVE      *BLANKS       W2TYPT
     C     W2TYPE        IFEQ      'P'
     C                   MOVEL     'POOL    '    W2TYPT
     C                   ENDIF                                                  <W2TYPE
     C     W2TYPE        IFEQ      'F'
     C                   MOVEL     'FRANKATU'    W2TYPT
     C                   MOVE      'RAVHENG.'    W2TYPT
     C                   ENDIF                                                  <W2TYPE
     C     W2TYPE        IFEQ      'H'
     C                   MOVEL     'HUS-HUS '    W2TYPT
     C                   ENDIF                                                  <W2TYPE
     C     W2TYPE        IFEQ      ' '
     C                   MOVEL     'HUS-HUS '    W2TYPT
     C                   ENDIF                                                  <W2TYPE
     C                   ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
ERT  C     *LIKE         DEFINE    FABELN        VABELN
     C     *LIKE         DEFINE    THEINT        PEINT
     C     *LIKE         DEFINE    THEUTG        PEUTG
     C     *LIKE         DEFINE    THAINT        PAINT
     C     *LIKE         DEFINE    THAUTG        PAUTG
     C     *LIKE         DEFINE    THEINT        DFEINT
     C     *LIKE         DEFINE    THEUTG        DFEUTG
     C     *LIKE         DEFINE    THAINT        DFAINT
     C     *LIKE         DEFINE    THAUTG        DFAUTG
     C     *LIKE         DEFINE    THEINT        TEI999
     C     *LIKE         DEFINE    THEUTG        TEU999
     C     *LIKE         DEFINE    THAINT        TAI999
     C     *LIKE         DEFINE    THAUTG        TAU999
     C     *LIKE         DEFINE    LINNBR        OLDLIN
     C     *LIKE         DEFINE    POSNBR        OLDPOS
     C     *LIKE         DEFINE    ZRECNO        MRECNO
     C     *LIKE         DEFINE    ZRECNO        XRECNO
     C     *LIKE         DEFINE    THUNR         WUNR
     C     *LIKE         DEFINE    THUNR         XUNR
     C     *LIKE         DEFINE    HEPOS1        XPOS1
     C     *LIKE         DEFINE    THVEKT        TOVEKT          + 2
     C     *LIKE         DEFINE    AHST          XAHST
     C     *LIKE         DEFINE    FAAVD         XXAVD
     C     *LIKE         DEFINE    FAOPD         XXOPD
     C     *LIKE         DEFINE    FALI          XXLI
     C     *LIKE         DEFINE    HEKNA         W1KNA
     C     *LIKE         DEFINE    HEAVD         W1AVD
     C*--------------------------------------------------------------
     C* DEFINERER NÿKKEL TIL CUNDL01
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    FIRMA         ZFIRMA
     C     *LIKE         DEFINE    KUNDNR        ZKUNDN
     C     KUNKEY        KLIST
     C                   KFLD                    ZFIRMA
     C                   KFLD                    ZKUNDN
     C*--------------------------------------------------------------
     C* DEFINERER NÿKKEL TIL HEADF
     C*--------------------------------------------------------------
     C     HEADFK        KLIST
     C                   KFLD                    THAVD
     C                   KFLD                    THOPD
     C*--------------------------------------------------------------
     C* DEFINERER NÿKKEL TIL HEADF
     C*--------------------------------------------------------------
     C     HEADWK        KLIST
     C                   KFLD                    WAAVD
     C                   KFLD                    WAOPD
     C*--------------------------------------------------------------
     C* DEFINERER NÿKKEL TIL AMWTUAG (workfile oppdrag pr tur/agent)
     C*--------------------------------------------------------------
     C     AMWKEY        KLIST
     C                   KFLD                    W1TNR
     C                   KFLD                    W1KNA
     C*--------------------------------------------------------------
     C* DEFINERER NÿKKEL TIL TURER
     C*--------------------------------------------------------------
     C     TURERK        KLIST
     C                   KFLD                    W1AVD
     C                   KFLD                    W1TNR
     C*--------------------------------------------------------------
     C* DEFINERER NÿKKEL TIL VALUAL01
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    VALKOD        ZVALKO
     C     VALKEY        KLIST
     C                   KFLD                    ZFIRMA
     C                   KFLD                    ZVALKO
     C*--------------------------------------------------------------
     C* DEFINERER NÿKKEL TIL FAK2
     C*--------------------------------------------------------------
     C     FAK2K         KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C*
     C     *LIKE         DEFINE    HEAVD         ZEAVD
     C     *LIKE         DEFINE    HEOPD         ZEOPD
     C     *LIKE         DEFINE    FASK          ZESK
     C     FAK2KA        KLIST
     C                   KFLD                    ZEAVD
     C                   KFLD                    ZEOPD
     C                   KFLD                    ZESK
     C*
     C     FAKKEY        KLIST
     C                   KFLD                    ZEAVD
     C                   KFLD                    ZEOPD
     C*
     C*-------------------- -----------------------------------------
     C* DEFINERER NÿKKEL TIL KODTGE
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    FAVK          ZAVK
     C     KODGEK        KLIST
     C                   KFLD                    YGEUNI
     C                   KFLD                    ZAVK
     C*--------------------------------------------------------------
     C* DEFINERER NÿKKEL TIL KODTFR
     C*--------------------------------------------------------------
     C     KODFRK        KLIST
     C                   KFLD                    YFRUNI
     C                   KFLD                    THFRAN
     C*--------------------------------------------------------------
     C* DEFINERER NÿKKEL TIL AMHE
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    AHTUNR        ZTUNR
     C     *LIKE         DEFINE    AHKNA         ZKNA
     C     AMHEKY        KLIST
     C                   KFLD                    ZTUNR
     C                   KFLD                    ZKNA
     C*--------------------------------------------------------------
     C* DEFINERER NÿKKEL TIL AMDE (AMDEWRK)
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    AHTUNR        ZNULL
     C     *LIKE         DEFINE    ADPOS         ZPOS
     C     *LIKE         DEFINE    ADUNR         ZUNR
     C     AMDEKY        KLIST
     C                   KFLD                    ZTUNR
     C                   KFLD                    ZKNA
     C                   KFLD                    ZPOS
     C                   KFLD                    ZUNR
     C*--------------------------------------------------------------
     C* DEFINERER NÿKKEL TIL AMDE (TURNUMMER)
     C*--------------------------------------------------------------
     C     AMDEKT        KLIST
     C                   KFLD                    ZTUNR
     C                   KFLD                    ZKNA
     C*--------------------------------------------------------------
     C* DEFINERER NÿKKEL TIL AMGE (TURNUMMER)
     C*--------------------------------------------------------------
     C     AMGEKY        KLIST
     C                   KFLD                    ZTUNR
     C                   KFLD                    ZKNA
     C*--------------------------------------------------------------
     C* DEFINERER NÿKKEL TIL AMANDEL
     C*--------------------------------------------------------------
     C     AMANKY        KLIST
     C                   KFLD                    ZKUNDN
     C*
     C                   CLEAR                   ZNULL
     C*
     C                   MOVE      ' '           YTHST             1
     C                   MOVE      *ZEROS        YYPER≈            2 0
     C                   MOVE      *ZEROS        YYPERM            2 0
     C                   MOVE      *ZEROS        YYRUND            8 0
     C                   MOVE      *ZEROS        YYPRO             8 0
     C                   MOVE      ' '           YYKDM             1
     C                   MOVE      'DIV2525'     XMSGNR            7
     C                   Z-ADD     3             XLEVEL            1 0
     C                   Z-ADD     0             XRETUR            1 0
     C                   Z-ADD     20            XMSGL             4 0
     C                   EXSR      HENTMS
     C                   MOVEL     XMSG          TXTKST           20
     C*
     C     IX            IFEQ      0
     C                   CLEAR                   WF
     C                   CLEAR                   WT
     C                   CLEAR                   WA
     C                   ENDIF                                                  <IX
     C*
     C                   MOVE      'GE'          YGEUNI            2
     C                   MOVE      'FR'          YFRUNI            2
     C*
     C*
     C                   READ(N)   FIRM                                   33
     C*
     C*
     C*
     C     UTI           ENDSR
     C*
ERT   *//////////////////////////////////////////////////////////////////////
ERT   * VIEW ORDER                                                   CHGKB //
ERT   *//////////////////////////////////////////////////////////////////////
ERT  C     SEOPD         BEGSR
ERT   *
ERT  C                   MOVE      *ZEROS        DUMFLA            1 0
ERT  C                   CALL      'SYFM21A'
ERT  C                   PARM                    FIFIRM
ERT  C                   PARM                    THAVD
ERT  C                   PARM                    THOPD
ERT  C                   PARM                    DUMFLA
ERT   *
ERT  C                   MOVE      ' '           WSNRO
ERT  C                   UPDATE    SUBFIL
ERT   *
ERT  C                   ENDSR
ERT   *//////////////////////////////////////////////////////////////////////
ERT   * VIEW Invoice picture                                         CHGKB //
ERT   *//////////////////////////////////////////////////////////////////////
ERT  C     SEFAK         BEGSR
ERT   *
ERT  C                   MOVE      *ZEROS        DUMFLA            1 0
ERT  C                   CALL      'SYFM21B'
ERT  C                   PARM                    FIFIRM
ERT  C                   PARM                    THAVD
ERT  C                   PARM                    THOPD
ERT  C                   PARM                    DUMFLA
ERT   *
ERT  C                   MOVE      ' '           WSNRO
ERT  C                   UPDATE    SUBFIL
ERT   *
ERT  C                   ENDSR
