********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11023 * 01 CB  PTF11 Feilet med å alltid finne LF
     H Option( *SrcStmt ) DftActGrp( *No ) BndDir( 'QC2LE' ) debug(*yes)
      *__________
      * Variabler
      *""""""""""
     D FILE_o          s               *
     D FILE_i          s               *
     D ErrTxt          s            128a
S01  D*String          s             81a
N01  D String          s           2048a
     D rc              s             10i 0
     D CmdLine         S            512
     D CmdLen          S             15  5
     D SRCDTA          S           2048
     D BDS             S          30000
     D Data            s          30000a   Varying
     D Codepage        s              5a   Varying
      *_________________
      * Feildefinisjoner
      *"""""""""""""""""
     D errno           Pr            10i 0

     D strerror        Pr           128a   Varying
      *___________________________
      * IFS Stream file funksjoner
      *"""""""""""""""""""""""""""
     Dopen             Pr              *   ExtProc( '_C_IFS_fopen' )
     D                                 *   Value Options( *String )
     D                                 *   Value Options( *String )

     Dfgets            Pr              *   ExtProc( '_C_IFS_fgets' )
     D                                 *   Value
     D                               10i 0 Value
     D                                 *   Value

     Dfputs            Pr            10i 0 ExtProc( '_C_IFS_fputs' )
     D                                 *   Value Options( *String )
     D                                 *   Value

     Dclose            Pr            10i 0 ExtProc( '_C_IFS_fclose' )
     D                                 *   Value
      *   SYEDI data area
     D EDIDTA          DS           256
     D  UELIBF               171    180
      * Åpne dataarea
     C     *DTAARA       DEFINE                  EDIDTA
     C                   IN        EDIDTA
      *______
      * Input
      *""""""
     C     *ENTRY        PLIST
     C                   parm                    FilNam          256
     C                   parm                    EntryName       120
     C     Qcmdexc       PLIST
     C                   PARM                    CmdLine
     C                   PARM                    Cmdlen
      *________________________________________
      * Åpne fil, med tegnkonvertering for jobb
      *""""""""""""""""""""""""""""""""""""""""
     C                   EVAL      FILE_i = open( %TrimR( FilNam ) : 'r' )

     C                   IF        FILE_i = *Null
     C                   EVAL      ErrTxt = %Char( Errno ) + ': ' + Strerror
     C                   ELSE

     C                   DOW       fgets( %Addr( String ) : %Size( String )
     C                             : FILE_i ) <> *Null
     C                   EVAL      SRCDTA=*BLANKS
S01  C*    X'25'         SCAN      string        pos               2 0
N01  C     X'25'         SCAN      string        pos               4 0
     C                   if        pos = 0
S01  C*    X'00'         SCAN      string        pos               2 0
N01  C     X'00'         SCAN      string        pos               4 0
     C                   endif
     C                   SUB       1             pos
     C                   if        pos < 1
     C                   eval      pos=1
     C                   endif
     C                   EVAL      SRCDTA = %SUBST(string:1:pos)
     C                   CAT       SRCDTA:0      BDS
     C                   ENDDO

     C                   EVAL      rc = close( FILE_i )
     C                   ENDIF
      * Lag ASCIIfil
     C                   MOVE      *BLANKS       WFILNAM         256
     C                   EVAL      WFILNAM = '/' + %trimr(UELIBF)
     C                             + '/EDIRE/' + %trimr(EntryName)

     C                   EVAL      Codepage = '819'
     C                   EVAL      FILE_o = open( %TrimR( WfilNam )
     C                             : 'w, codepage=' + Codepage )

     C                   EVAL      rc = close( FILE_o )

     C                   EVAL      FILE_o = open( %TrimR( WfilNam )
     C                             : 'w' )

     C                   IF        FILE_o <> *Null
     C                   EVAL      Data = %trimr(BDS)
     C                   EVAL      rc = fputs(Data : File_o)
     C                   EVAL      rc = close( FILE_o )
     C                   ENDIF

     C                   EVAL      *INLR = *On
     C                   RETURN

      *_________________
      * Hente feilnummer
      *"""""""""""""""""
     P Errno           B
     D                 PI            10i 0
     D sys_errno       PR              *    ExtProc( '__errno' )

     D Error           S             10i 0  Based( pError ) NoOpt

     C                   EVAL      pError = sys_errno
     C                   RETURN    Error

     P Errno           E
      *________________
      * Hente feiltekst
      *""""""""""""""""
     P Strerror        B
     D                 PI           128a   Varying
     D sys_strerror    PR              *   ExtProc( 'strerror' )
     D                               10i 0 Value

     C                   RETURN    %Str( sys_strerror( Errno ))

     P Strerror        E
