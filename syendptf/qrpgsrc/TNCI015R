********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12XXX * 01 CB  PTF12  NCTS5
********************************************************************
      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/TNCI015R MODULE(*LIBL/TNCI015R *LIBL/INCGI)
CRTPGM*        ACTGRP(*NEW) AUT(*USE)
      *
      *********************************************************************
      /copy SYSPEDS/qrpgsrcpy,hspecs
      /copy SYSPEDS/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
     FSVNL      IF   E           K DISK    USROPN
     FSVNLCN    IF   E           K DISK    USROPN
     F                                     PREFIX(XV_)
     FSVNLDK    IF   E           K DISK    USROPN
     F                                     PREFIX(XV_)
     FSVNLKL    IF   E           K DISK    USROPN
     F                                     PREFIX(XV_)
     FSVNLMN    IF   E           K DISK    USROPN
     F                                     PREFIX(XV_)
     FSVNLPK    IF   E           K DISK    USROPN
     F                                     PREFIX(XV_)
     FSVNLVT    IF   E           K DISK    USROPN
     F                                     PREFIX(XV_)
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy SYSPEDS/qrpgsrcpy,prototypeb
      /copy SYSPEDS/qrpgsrcpy,usec
      /copy SYSPEDS/qrpgsrcpy,variables3
      *
      * Varible for
     D WSUSER          S             10
     D TVAVD_A         S              4
     D TVAVD           S              4  0
     D TVTDN_A         S              7
     D TVTDN           S              7  0
     D JSONstring      S          32000
     D Error           S            150
     D AntLest         S              9  0
     D                 DS
     D  TVCNR1                 1     17
     D  TVCNR2                18     34
     D  TVCNR3                35     51
     D  TVCNR4                52     68
     D  TVCNR5                69     85
     D  TCN1                   1     85    DIM(5)
     D                 DS
     D  NVCNR1                 1     17
     D  NVCNR2                18     34
     D  NVCNR3                35     51
     D  NVCNR4                52     68
     D  NVCNR5                69     85
     D  NCN1                   1     85    DIM(5)
     D                 DS
     D  TVDTY1                 1      4
     D  TVDTY2                 5      8
     D  TVDTY3                 9     12
     D  TVDTY4                13     16
     D  TVDTY5                17     20
     D  TDK1                   1     20    DIM(5)
     D                 DS
     D  TVDREF1                1     35
     D  TVDREF2               36     70
     D  TVDREF3               71    105
     D  TVDREF4              106    140
     D  TVDREF5              141    175
     D  TDK2                   1    175    DIM(5)
     D                 DS
     D  TVDSK1                 1      2
     D  TVDSK2                 3      4
     D  TVDSK3                 5      6
     D  TVDSK4                 7      8
     D  TVDSK5                 9     10
     D  TDK3                   1     10    DIM(5)
     D                 DS
     D  TVDO1                  1     26
     D  TVDO2                 27     52
     D  TVDO3                 53     78
     D  TVDO4                 79    104
     D  TVDO5                105    130
     D  TDK4                   1    130    DIM(5)
     D                 DS
     D  TVDOSK1                1      2
     D  TVDOSK2                3      4
     D  TVDOSK3                5      6
     D  TVDOSK4                7      8
     D  TVDOSK5                9     10
     D  TDK5                   1     10    DIM(5)
     D                 DS
     D  NVDTY1                 1      4
     D  NVDTY2                 5      8
     D  NVDTY3                 9     12
     D  NVDTY4                13     16
     D  NVDTY5                17     20
     D  NDK1                   1     20    DIM(5)
     D                 DS
     D  NVDREF1                1     35
     D  NVDREF2               36     70
     D  NVDREF3               71    105
     D  NVDREF4              106    140
     D  NVDREF5              141    175
     D  NDK2                   1    175    DIM(5)
     D                 DS
     D  NVDSK1                 1      2
     D  NVDSK2                 3      4
     D  NVDSK3                 5      6
     D  NVDSK4                 7      8
     D  NVDSK5                 9     10
     D  NDK3                   1     10    DIM(5)
     D                 DS
     D  NVDO1                  1     26
     D  NVDO2                 27     52
     D  NVDO3                 53     78
     D  NVDO4                 79    104
     D  NVDO5                105    130
     D  NDK4                   1    130    DIM(5)
     D                 DS
     D  NVDOSK1                1      2
     D  NVDOSK2                3      4
     D  NVDOSK3                5      6
     D  NVDOSK4                7      8
     D  NVDOSK5                9     10
     D  NDK5                   1     10    DIM(5)
     D                 DS
     D  TVNTEH1                1      5  0
     D  TVNTEH2                6     10  0
     D  TVNTEH3               11     15  0
     D  TVNTEH4               16     20  0
     D  TVNTEH5               21     25  0
     D  TKL1                   1     25  0 DIM(5)
     D                 DS
     D  TVEH1                  1      2
     D  TVEH2                  3      4
     D  TVEH3                  5      6
     D  TVEH4                  7      8
     D  TVEH5                  9     10
     D  TKL2                   1     10    DIM(5)
     D                 DS
     D  TVNT1                  1      5  0
     D  TVNT2                  6     10  0
     D  TVNT3                 11     15  0
     D  TVNT4                 16     20  0
     D  TVNT5                 21     25  0
     D  TKL3                   1     25  0 DIM(5)
     D                 DS
     D  NVNTEH1                1      5  0
     D  NVNTEH2                6     10  0
     D  NVNTEH3               11     15  0
     D  NVNTEH4               16     20  0
     D  NVNTEH5               21     25  0
     D  NKL1                   1     25  0 DIM(5)
     D                 DS
     D  NVEH1                  1      2
     D  NVEH2                  3      4
     D  NVEH3                  5      6
     D  NVEH4                  7      8
     D  NVEH5                  9     10
     D  NKL2                   1     10    DIM(5)
     D                 DS
     D  NVNT1                  1      5  0
     D  NVNT2                  6     10  0
     D  NVNT3                 11     15  0
     D  NVNT4                 16     20  0
     D  NVNT5                 21     25  0
     D  NKL3                   1     25  0 DIM(5)

      *get input-string
      /copy syspeds/qrpgsrcpy,prolog3

      * Parse input
     C                   exsr      Parse
      * Open files etc
     C                   EXSR      INIT
      *
     c                   callp     gethtmlifs(
     C                             '/syspeddev/html/JSON.html':
     C                             '/CGITAG/')
     C                   callp     wrtsection('top')
      *
      * ............................................................................................
      * skriv JSON-Object start..(alltid '{' + x ant param. m/komma mellom (IKKE komma etter siste))
      * ............................................................................................
      *
      /free
        JSONstring='{'
        +'¬user¬ : ¬'+%trim(WSUSER)+'¬, '
        +'¬tvavd¬ : ¬'+%trim(%editc(TVAVD:'Z'))+'¬, '
        +'¬tvtdn¬ : ¬'+%trim(%editc(TVTDN:'Z'))+'¬, '
        +'¬errMsg¬ : ¬'+%trim(Error)+'¬, ';
      /end-free
      * JSONfix escaper " i tekst,  for deretter å bytte ¬->"
     c                   call      'JSONFIX'
     c                   parm                    JSONstring
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      *
      * ............................................................................................
      * Skriv JSON-LISTE Start (en liste er EN parameter(fra [ til   )
      * ............................................................................................
     c                   eval      JSONstring ='"orderList" : ['
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      *
      * Liste Ærende
      *
     c     Error         ifeq      *blanks
     C     SVNLkey       setll     SVNL
     C     SVNLkey       READE     SVNL                                   55
     C     *IN55         DOWEQ     '0'
     C                   MOVE      *BLANKS       TCN1
     C                   MOVE      *BLANKS       NCN1
     C                   MOVE      *BLANKS       TDK1
     C                   MOVE      *BLANKS       TDK2
     C                   MOVE      *BLANKS       TDK3
     C                   MOVE      *BLANKS       TDK4
     C                   MOVE      *BLANKS       TDK5
     C                   MOVE      *BLANKS       NDK1
     C                   MOVE      *BLANKS       NDK2
     C                   MOVE      *BLANKS       NDK3
     C                   MOVE      *BLANKS       NDK4
     C                   MOVE      *BLANKS       NDK5
     C                   MOVE      *ZEROS        TKL1
     C                   MOVE      *BLANKS       TKL2
     C                   MOVE      *ZEROS        TKL3
     C                   MOVE      *ZEROS        NKL1
     C                   MOVE      *BLANKS       NKL2
     C                   MOVE      *ZEROS        NKL3
      *
     C                   MOVE      TVCNR         TCN1(1)
     C                   MOVE      NVCNR         NCN1(1)
     C                   Z-ADD     1             XN                3 0
     C     SVNLkeyL      SETLL     SVNLCN
     C     SVNLkeyL      READE     SVNLCN                                 33
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   MOVE      XV_TVCNR      TCN1(XN)
     C                   MOVE      XV_NVCNR      NCN1(XN)
     C     SVNLkeyL      READE     SVNLCN                                 33
     C  N33              ENDDO
      *
     C                   MOVE      TVDTY         TDK1(1)
     C                   MOVE      TVDREF        TDK2(1)
     C                   MOVE      TVDSK         TDK3(1)
     C                   MOVE      TVDO          TDK4(1)
     C                   MOVE      TVDOSK        TDK5(1)
     C                   MOVE      NVDTY         NDK1(1)
     C                   MOVE      NVDREF        NDK2(1)
     C                   MOVE      NVDSK         NDK3(1)
     C                   MOVE      NVDO          NDK4(1)
     C                   MOVE      NVDOSK        NDK5(1)
     C                   Z-ADD     1             XN                3 0
     C     SVNLkeyL      SETLL     SVNLDK
     C     SVNLkeyL      READE     SVNLDK                                 33
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   MOVE      XV_TVDTY      TDK1(XN)
     C                   MOVE      XV_TVDREF     TDK2(XN)
     C                   MOVE      XV_TVDSK      TDK3(XN)
     C                   MOVE      XV_TVDO       TDK4(XN)
     C                   MOVE      XV_TVDOSK     TDK5(XN)
     C                   MOVE      XV_NVDTY      NDK1(XN)
     C                   MOVE      XV_NVDREF     NDK2(XN)
     C                   MOVE      XV_NVDSK      NDK3(XN)
     C                   MOVE      XV_NVDO       NDK4(XN)
     C                   MOVE      XV_NVDOSK     NDK5(XN)
     C     SVNLkeyL      READE     SVNLDK                                 33
     C  N33              ENDDO
      *
     C                   MOVE      TVNTEH        TKL1(1)
     C                   MOVE      TVEH          TKL2(1)
     C                   MOVE      TVNT          TKL3(1)
     C                   MOVE      NVNTEH        NKL1(1)
     C                   MOVE      NVEH          NKL2(1)
     C                   MOVE      NVNT          NKL3(1)
     C                   Z-ADD     1             XN                3 0
     C     SVNLkeyL      SETLL     SVNLKL
     C     SVNLkeyL      READE     SVNLKL                                 33
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   MOVE      XV_TVNTEH     TKL1(XN)
     C                   MOVE      XV_TVEH       TKL2(XN)
     C                   MOVE      XV_TVNT       TKL3(XN)
     C                   MOVE      XV_NVNTEH     NKL1(XN)
     C                   MOVE      XV_NVEH       NKL2(XN)
     C                   MOVE      XV_NVNT       NKL3(XN)
     C     SVNLkeyL      READE     SVNLKL                                 33
     C  N33              ENDDO
      *
     C                   Add       1             AntLest
      * ............................................................................................
      * Skriv en JSON-Array-linje pr menypunkt - komma før hvert nytt element
      * ............................................................................................
      /free
       if AntLest=1;
          JSONstring=*blanks;
          else;
          JSONstring=', ';
          endif;
       JSONstring=%trim(JSONstring)+'{'
          +'¬tvavd¬ : ¬'+%trim(%editc(TVAVD:'Z'))+'¬, '
          +'¬tvtdn¬ : ¬'+%trim(%editc(TVTDN:'Z'))+'¬, '
          +'¬tvli¬ : ¬'+%trim(%editc(TVLI:'Z'))+'¬, '
          +'¬tvvnt¬ : ¬'+%trim(%editc(TVVNT:'4'))+'¬, '
          +'¬tvvntl¬ : ¬'+%trim(%editc(TVVNTL:'4'))+'¬, '
          +'¬tvdk¬ : ¬'+%trim(TVDK)+'¬, '
          +'¬tvvt¬ : ¬'+%trim(TVVT)+'¬, '
          +'¬tvvtsk¬ : ¬'+%trim(TVVTSK)+'¬, '
          +'¬tvvktb¬ : ¬'+%trim(%editc(TVVKTB:'4'))+'¬, '
          +'¬tvvktn¬ : ¬'+%trim(%editc(TVVKTN:'4'))+'¬, '
          +'¬tvalk¬ : ¬'+%trim(TVALK)+'¬, '
          +'¬tvblk¬ : ¬'+%trim(TVBLK)+'¬, '
          +'¬tvnas¬ : ¬'+%trim(TVNAS)+'¬, '
          +'¬tvads1¬ : ¬'+%trim(TVADS1)+'¬, '
          +'¬tvpns¬ : ¬'+%trim(TVPNS)+'¬, '
          +'¬tvpss¬ : ¬'+%trim(TVPSS)+'¬, '
          +'¬tvlks¬ : ¬'+%trim(TVLKS)+'¬, '
          +'¬tvsks¬ : ¬'+%trim(TVSKS)+'¬, '
          +'¬tvtins¬ : ¬'+%trim(TVTINS)+'¬, '
          +'¬tvnak¬ : ¬'+%trim(TVNAK)+'¬, '
          +'¬tvadk1¬ : ¬'+%trim(TVADK1)+'¬, '
          +'¬tvpnk¬ : ¬'+%trim(TVPNK)+'¬, '
          +'¬tvpsk¬ : ¬'+%trim(TVPSK)+'¬, '
          +'¬tvlkk¬ : ¬'+%trim(TVLKK)+'¬, '
          +'¬tvskk¬ : ¬'+%trim(TVSKK)+'¬, '
          +'¬tvtink¬ : ¬'+%trim(TVTINK)+'¬, '
          +'¬tvdty¬ : ¬'+%trim(TVDTY1)+'¬, '
          +'¬tvdref¬ : ¬'+%trim(TVDREF1)+'¬, '
          +'¬tvdsk¬ : ¬'+%trim(TVDSK1)+'¬, '
          +'¬tvdo¬ : ¬'+%trim(TVDO1)+'¬, '
          +'¬tvdosk¬ : ¬'+%trim(TVDOSK1)+'¬, '
          +'¬tvdty2¬ : ¬'+%trim(TVDTY2)+'¬, '
          +'¬tvdref2¬ : ¬'+%trim(TVDREF2)+'¬, '
          +'¬tvdsk2¬ : ¬'+%trim(TVDSK2)+'¬, '
          +'¬tvdo2¬ : ¬'+%trim(TVDO2)+'¬, '
          +'¬tvdosk2¬ : ¬'+%trim(TVDOSK2)+'¬, '
          +'¬tvdty3¬ : ¬'+%trim(TVDTY3)+'¬, '
          +'¬tvdref3¬ : ¬'+%trim(TVDREF3)+'¬, '
          +'¬tvdsk3¬ : ¬'+%trim(TVDSK3)+'¬, '
          +'¬tvdo3¬ : ¬'+%trim(TVDO3)+'¬, '
          +'¬tvdosk3¬ : ¬'+%trim(TVDOSK3)+'¬, '
          +'¬tvdty4¬ : ¬'+%trim(TVDTY4)+'¬, '
          +'¬tvdref4¬ : ¬'+%trim(TVDREF4)+'¬, '
          +'¬tvdsk4¬ : ¬'+%trim(TVDSK4)+'¬, '
          +'¬tvdo4¬ : ¬'+%trim(TVDO4)+'¬, '
          +'¬tvdosk4¬ : ¬'+%trim(TVDOSK4)+'¬, '
          +'¬tvdty5¬ : ¬'+%trim(TVDTY5)+'¬, '
          +'¬tvdref5¬ : ¬'+%trim(TVDREF5)+'¬, '
          +'¬tvdsk5¬ : ¬'+%trim(TVDSK5)+'¬, '
          +'¬tvdo5¬ : ¬'+%trim(TVDO5)+'¬, '
          +'¬tvdosk5¬ : ¬'+%trim(TVDOSK5)+'¬, '
          +'¬tvtlo¬ : ¬'+%trim(TVTLO)+'¬, '
          +'¬tvexkd¬ : ¬'+%trim(%editc(TVEXKD:'4'))+'¬, '
          +'¬tvexlk¬ : ¬'+%trim(TVEXLK)+'¬, '
          +'¬tvcnr¬ : ¬'+%trim(TVCNR1)+'¬, '
          +'¬tvcnr2¬ : ¬'+%trim(TVCNR2)+'¬, '
          +'¬tvcnr3¬ : ¬'+%trim(TVCNR3)+'¬, '
          +'¬tvcnr4¬ : ¬'+%trim(TVCNR4)+'¬, '
          +'¬tvcnr5¬ : ¬'+%trim(TVCNR5)+'¬, '
          +'¬tvmn¬ : ¬'+%trim(TVMN)+'¬, '
          +'¬tvmnl¬ : ¬'+%trim(%editc(TVMNL:'4'))+'¬, '
          +'¬tvmnsk¬ : ¬'+%trim(TVMNSK)+'¬, '
          +'¬tveh¬ : ¬'+%trim(TVEH1)+'¬, '
          +'¬tvnt¬ : ¬'+%trim(%editc(TVNT1:'4'))+'¬, '
          +'¬tvnteh¬ : ¬'+%trim(%editc(TVNTEH1:'4'))+'¬, '
          +'¬tveh2¬ : ¬'+%trim(TVEH2)+'¬, '
          +'¬tvnt2¬ : ¬'+%trim(%editc(TVNT2:'4'))+'¬, '
          +'¬tvnteh2¬ : ¬'+%trim(%editc(TVNTEH2:'4'))+'¬, '
          +'¬tveh3¬ : ¬'+%trim(TVEH3)+'¬, '
          +'¬tvnt3¬ : ¬'+%trim(%editc(TVNT3:'4'))+'¬, '
          +'¬tvnteh3¬ : ¬'+%trim(%editc(TVNTEH3:'4'))+'¬, '
          +'¬tveh4¬ : ¬'+%trim(TVEH4)+'¬, '
          +'¬tvnt4¬ : ¬'+%trim(%editc(TVNT4:'4'))+'¬, '
          +'¬tvnteh4¬ : ¬'+%trim(%editc(TVNTEH4:'4'))+'¬, '
          +'¬tveh5¬ : ¬'+%trim(TVEH5)+'¬, '
          +'¬tvnt5¬ : ¬'+%trim(%editc(TVNT5:'4'))+'¬, '
          +'¬tvnteh5¬ : ¬'+%trim(%editc(TVNTEH5:'4'))+'¬, '
          +'¬tveh¬ : ¬'+%trim(TVEH1)+'¬, '
          +'¬tvnt¬ : ¬'+%trim(%editc(TVNT1:'4'))+'¬, '
          +'¬tvnteh¬ : ¬'+%trim(%editc(TVNTEH1:'4'))+'¬, '
          +'¬tvfv¬ : ¬'+%trim(TVFV)+'¬, '
          +'¬tvftnt¬ : ¬'+%trim(%editc(TVFVNT:'4'))+'¬, '
          +'¬nvvnt¬ : ¬'+%trim(%editc(NVVNT:'4'))+'¬, '
          +'¬nvvt¬ : ¬'+%trim(NVVT)+'¬, '
          +'¬nvvktb¬ : ¬'+%trim(%editc(NVVKTB:'4'))+'¬, '
          +'¬nvvktn¬ : ¬'+%trim(%editc(NVVKTN:'4'))+'¬, '
          +'¬nvdty¬ : ¬'+%trim(NVDTY1)+'¬, '
          +'¬nvdref¬ : ¬'+%trim(NVDREF1)+'¬, '
          +'¬nvdsk¬ : ¬'+%trim(NVDSK1)+'¬, '
          +'¬nvdo¬ : ¬'+%trim(NVDO1)+'¬, '
          +'¬nvdosk¬ : ¬'+%trim(NVDOSK1)+'¬, '
          +'¬nvdty2¬ : ¬'+%trim(NVDTY2)+'¬, '
          +'¬nvdref2¬ : ¬'+%trim(NVDREF2)+'¬, '
          +'¬nvdsk2¬ : ¬'+%trim(NVDSK2)+'¬, '
          +'¬nvdo2¬ : ¬'+%trim(NVDO2)+'¬, '
          +'¬nvdosk2¬ : ¬'+%trim(NVDOSK2)+'¬, '
          +'¬nvdty3¬ : ¬'+%trim(NVDTY3)+'¬, '
          +'¬nvdref3¬ : ¬'+%trim(NVDREF3)+'¬, '
          +'¬nvdsk3¬ : ¬'+%trim(NVDSK3)+'¬, '
          +'¬nvdo3¬ : ¬'+%trim(NVDO3)+'¬, '
          +'¬nvdosk3¬ : ¬'+%trim(NVDOSK3)+'¬, '
          +'¬nvdty4¬ : ¬'+%trim(NVDTY4)+'¬, '
          +'¬nvdref4¬ : ¬'+%trim(NVDREF4)+'¬, '
          +'¬nvdsk4¬ : ¬'+%trim(NVDSK4)+'¬, '
          +'¬nvdo4¬ : ¬'+%trim(NVDO4)+'¬, '
          +'¬nvdosk4¬ : ¬'+%trim(NVDOSK4)+'¬, '
          +'¬nvdty5¬ : ¬'+%trim(NVDTY5)+'¬, '
          +'¬nvdref5¬ : ¬'+%trim(NVDREF5)+'¬, '
          +'¬nvdsk5¬ : ¬'+%trim(NVDSK5)+'¬, '
          +'¬nvdo5¬ : ¬'+%trim(NVDO5)+'¬, '
          +'¬nvdosk5¬ : ¬'+%trim(NVDOSK5)+'¬, '
          +'¬nvcnr¬ : ¬'+%trim(NVCNR1)+'¬, '
          +'¬nvcnr2¬ : ¬'+%trim(NVCNR2)+'¬, '
          +'¬nvcnr3¬ : ¬'+%trim(NVCNR3)+'¬, '
          +'¬nvcnr4¬ : ¬'+%trim(NVCNR4)+'¬, '
          +'¬nvcnr5¬ : ¬'+%trim(NVCNR5)+'¬, '
          +'¬nvmn¬ : ¬'+%trim(NVMN)+'¬, '
          +'¬nvmnsk¬ : ¬'+%trim(NVMNSK)+'¬, '
          +'¬nveh¬ : ¬'+%trim(NVEH1)+'¬, '
          +'¬nvnt¬ : ¬'+%trim(%editc(NVNT1:'4'))+'¬, '
          +'¬nvnteh¬ : ¬'+%trim(%editc(NVNTEH1:'4'))+'¬, '
          +'¬nveh2¬ : ¬'+%trim(NVEH2)+'¬, '
          +'¬nvnt2¬ : ¬'+%trim(%editc(NVNT2:'4'))+'¬, '
          +'¬nvnteh2¬ : ¬'+%trim(%editc(NVNTEH2:'4'))+'¬, '
          +'¬nveh3¬ : ¬'+%trim(NVEH2)+'¬, '
          +'¬nvnt3¬ : ¬'+%trim(%editc(NVNT3:'4'))+'¬, '
          +'¬nvnteh3¬ : ¬'+%trim(%editc(NVNTEH3:'4'))+'¬, '
          +'¬nveh4¬ : ¬'+%trim(NVEH4)+'¬, '
          +'¬nvnt4¬ : ¬'+%trim(%editc(NVNT4:'4'))+'¬, '
          +'¬nvnteh4¬ : ¬'+%trim(%editc(NVNTEH4:'4'))+'¬, '
          +'¬nveh5¬ : ¬'+%trim(NVEH5)+'¬, '
          +'¬nvnt5¬ : ¬'+%trim(%editc(NVNT5:'4'))+'¬, '
          +'¬nvnteh5¬ : ¬'+%trim(%editc(NVNTEH5:'4'))+'¬, '
          +'¬nvfv¬ : ¬'+%trim(NVFV)+'¬, '
          +'¬nvftnt¬ : ¬'+%trim(%editc(NVFVNT:'4'))+'¬, '
          +'¬nvct¬ : ¬'+%trim(NVCT)+'¬, '
          +'¬nvctb¬ : ¬'+%trim(NVCTB)+'¬, '
          +'¬nvctsk¬ : ¬'+%trim(NVCTSK)+'¬, '
          +'¬nvctp¬ : ¬'+%trim(NVCTP)+'¬, '
          +'¬nvctp¬ : ¬'+%trim(NVCTP)+'¬, '
          +'¬tvorgh¬ : ¬'+%trim(%editc(TVORGH:'4'))+'¬, '
          +'¬tvorgi¬ : ¬'+%trim(%editc(TVORGI:'4'))+'¬}';
      /end-free
     C                   call      'JSONFIX'
     C                   parm                    JSONstring
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      *
     C     SVNLkey       READE     SVNL                                   55
     C                   ENDDO
     c                   endif
      * ............................................................................................
      * Skriv JSON-Liste/Array  Avslutning
      * ............................................................................................
     c                   eval      JSONstring =']'
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      * ............................................................................................
      * Skriv JSON-string Avsluttning
      * ............................................................................................
     c                   eval      JSONstring ='}'
     C                   CALLP     updHTMLvar2('JSONstring'
     C                                         :%addr(JSONstring)
     C                                         :%len(JSONstring))
     C                   callp     wrtsection('JSONlin')
      *
      * Quit
     C                   exsr      Exit


      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Lukk fil
     C                   CLOSE     BRIDF
     C  N50              CLOSE     SVNL
     C  N50              CLOSE     SVNLCN
     C  N50              CLOSE     SVNLDK
     C  N50              CLOSE     SVNLKL
     C  N50              CLOSE     SVNLMN
     C  N50              CLOSE     SVNLPK
     C  N50              CLOSE     SVNLVT

      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      * Quit
     C                   MOVE      *ON           *INLR
     C                   return
     C                   endsr
      *
      *********************************************************
     C     Parse         Begsr
      *********************************************************
      * Get input
     C                   EVAL      WSUSER  = zhbgetvar('USER')
     C                   EVAL      TVAVD_A = zhbgetvar('AVD')
     C                   EVAL      TVAVD   = c2n2(TVAVD_A)
     C                   EVAL      TVTDN_A = zhbgetvar('OPD')
     C                   EVAL      TVTDN   = c2n2(TVTDN_A)
     c                   endsr
      *
      *********************************************************
     C     INIT          Begsr
      *********************************************************
     C                   OPEN      BRIDF
      * Test innlogging
     C     WSUSER        CHAIN     BRIDF                              50
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C                   call      BILIBL
     C                   end
      *
     C     SVNLkey       klist
     C                   kfld                    TVAVD
     C                   kfld                    TVTDN
     C     SVNLkeyL      klist
     C                   kfld                    TVAVD
     C                   kfld                    TVTDN
     C                   kfld                    TVLI
      *
     C   50              eval      Error = 'Invalid userID'
     C  N50              OPEN      SVNL
     C  N50              OPEN      SVNLCN
     C  N50              OPEN      SVNLDK
     C  N50              OPEN      SVNLKL
     C  N50              OPEN      SVNLMN
     C  N50              OPEN      SVNLPK
     C  N50              OPEN      SVNLVT

     c                   endsr
      *
