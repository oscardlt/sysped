     FEPOHLCSV  IP   F 1024        DISK
     FEPOH      O    E             DISK
     FEPOL      O    E             DISK
     D A               S              1    DIM(79)
     D B               S              1    DIM(18)
      *________________________
      * DS for decimal handling
      *""""""""""""""""""""""""
     D                 DS
     D  ZDEC                   1      7  6
     D  ZDEC6                  2      7
     D  ZHEL                  11     22  0
     D                 DS
     D  data                   1   1024
     D  da                     1   1024
     D                                     DIM(1024)
     D                 DS
     D  felta                  1     60
     D  fa                     1     60
     D                                     DIM(60)
      * ARRAY MED INTIL 600 KOLONNER A 100 TEGN etter dekoding.
     D                 DS
     D  dta                    1  60000
     D                                     DIM(600)
     D LO              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzæøå')
     D UP              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZÆØÅ')
     D                 DS
     D  Lestkey                1     18
     D   xxKUND                1      8
     D   xxBES                 9     18
     D                 DS
     D  WTIME                  1     14  0
     D  WTID                   1      6  0
     D  WDD                    7      8  0
     D  WMM                    9     10  0
     D  WÅÅ                   11     14  0
     D                 DS
     D WSDTÅÅ                  1      4  0
     D WSDTMM                  5      6  0
     D WSDTDD                  7      8  0
     D WSDT                    1      8  0
     IEPOHLCSV  NC  01
     I                                  1    4  Data1_4
     I                                  1 1024  Data
      * Init kun i første syklus
     C     INI           IFEQ      ' '
     C                   EXSR      INIT
     C                   MOVE      'X'           INI               1
     C                   END
      *
      * INITIERER VARIABLE
      *
     c                   z-add     1             fra               3 0
     c                   z-add     1             til               3 0
     c                   z-add     0             DN                3 0
     c                   clear                   dta
     C     DATA1_4       Ifeq      'KUND'
     C     DATA1_4       OReq      ';;;;'
     C                   GOTO      NextRcd
     C                   END
      *
      * leser til neste skilletegn ';'
      *
     c     til           dowlt     900
     C     da(til)       ifne      ';'
     c                   add       1             til
     c                   else
      *
      * fra og til er funnet
      *
     c                   exsr      dekod
     c                   add       1             til
     c                   z-add     til           fra
     c                   endif
     c                   enddo
      *
      * siste post
      *
     c     fra           add       58            til
     c                   exsr      dekod
      * DETALJBEHANDLING
      *
     c**   AntPoster     cabgt     10            NextRcd
     c                   exsr      DETSR
     c                   add       1             AntPoster         5 0
      *
     c     NextRcd       tag

     cLR   GmKey         ifne      *blanks
     cLR                 write     EPOHR
     cLR                 movel     LestKey       GMKey            18
     cLR                 endif
      *
     c***************************************************************
     c     dekod         begsr
     c***************************************************************
      *
      * dekoder innlest post
      *
     c     til           sub       fra           antp              3 0
     c     antp          ifgt      0
     c                   exsr      dokoda
     c                   add       1             dn
     c                   movel     felta         dta(dn)
     C                   ELSE
     c                   add       1             dn
     c                   end
     c                   endsr
     c***************************************************************
     c     DOKODA        begsr
     c***************************************************************
     c*    dekoder  TIL FELTA
     c*
     c                   move      *blanks       felta
     c                   z-add     fra           nr                3 0
     c                   z-add     1             n2                3 0
     c                   do        antp
     c                   move      da(nr)        fa(n2)
     c                   add       1             n2
     c                   add       1             nr
     c                   enddo
     c                   endsr
     c***************************************************************
     c     DETSR         begsr
     c***************************************************************
      * Nøkkeldata som Brudd.... a
      * (mer avanseret Kunde-x-ref oppslag etterhvert)
     c                   movel     dta(1)        xxKUND
     c     XXKUND        ifeq      'XX'
     C                   move      '00000176'    xxKUND
     c                   else
     C                   move      '00000175'    xxKUND
     c                   endif
     c                   eval      xxBES = %trim(dta(2))
      *
     c     GmKey         ifeq      *blanks
      * Initier Lestkey første gang.
     c                   movel     LestKey       GMKey            18
     c                   else
     c     GmKey         ifne      LestKey
      * Er foregående lik med sist leste - hvis ikke, legg ut foregående HEAD-info/klargjør ny
     c                   write     EPOHR
     c                   movel     LestKey       GMKey
     c                   clear                   EPOHR
     c                   endif
     c                   endif
      *
     c                   clear                   EPOLR
      *
     C                   move      XXKUND        EHKUND
     C                   move      XXKUND        ELKUND
     c                   move      XXBES         EHBES
     c                   movel     XXBES         ELBES
      *
     c                   clear                   A
     c                   movea     dta(3)        A
     c                   exsr      getnum
     C                   z-add     ZNUM          EHDATO
      * lev nr/navn
     c                   movel     dta(4)        EHLEVN
     c                   movel     dta(5)        EHLNAV
     c                   movel     dta(6)        EHLAD1
     c                   movel     dta(7)        EHLAD2
     c                   movel     dta(8)        EHLAD3
     c                   movel     dta(9)        EHLAD4
      * LREF
     c                   movel     dta(10)       EHLREF
      *  Tidligste
     c                   clear                   A
     c                   movea     dta(11)       A
     c                   exsr      getnum
     C                   z-add     ZNUM          EHTTD
      *
      *  Forventet
     c                   clear                   A
     c                   movea     dta(12)       A
     c                   exsr      getnum
     C                   z-add     ZNUM          EHETD
      *
      *  seneste
     c                   clear                   A
     c                   movea     dta(13)       A
     c                   exsr      getnum
     C                   z-add     ZNUM          EHSTD
      *  FORVENTET ANK
     c                   clear                   A
     c                   movea     dta(14)       A
     c                   exsr      getnum
     C                   z-add     ZNUM          EHETA
      *
      * TRANSP.KOD
     c                   movel     dta(15)       EHTRKO
     c                   movel     dta(16)       EHLBET
      * FRA LAND/STED - TIL LAND/STED
     c                   movel     dta(18)       EHFLK
     c                   movel     dta(19)       EHFSTE
     c                   movel     dta(20)       EHTLK
     c                   movel     dta(21)       EHTSTE
      *
      *
      * LINJEDATA....
     c                   clear                   A
     c                   movea     dta(34)       A
     c                   exsr      getnum
     C                   z-add     ZNUM          ELLIN
      *
     c                   clear                   A
     c                   movea     dta(35)       A
     c                   exsr      getnum
     C                   z-add     ZNUM          ELULIN
      *
     c                   movel     dta(36)       ELART
      *
     c                   movel     dta(37)       ELARTL
      * BESK ikke ennå
     c***                movel     dta(xx)       ELABES
      * ant stk
     c                   clear                   A
     c                   movea     dta(38)       A
     c                   exsr      getnum
     C                   z-add     ZNUM          ELANTS
      *
      *Kolli
     c                   clear                   A
     c                   movea     dta(39)       A
     c                   exsr      getnum
     C                   z-add     ZNUM          ELANTK
      *
     C                   add       ELANTK        EHANTK
      *
      *
     c                   clear                   A
     c                   movea     dta(40)       A
     c                   exsr      getnum
     C                   z-add     ZNUM          ELVKT
      *
     C                   add       ELVKT         EHVKT
      *
      *
     c                   clear                   A
     c                   movea     dta(41)       A
     c                   exsr      getnum
     C                   z-add     ZNUM          ELM3
      *
     C                   add       ELM3          EHM3
      *
      *  Tidligste
     c                   clear                   A
     c                   movea     dta(42)       A
     c                   exsr      getnum
     C                   z-add     ZNUM          ELTTD
      *
      *  Forventet
     c                   clear                   A
     c                   movea     dta(43)       A
     c                   exsr      getnum
     C                   z-add     ZNUM          ELETD
      *
      *  seneste
     c                   clear                   A
     c                   movea     dta(44)       A
     c                   exsr      getnum
     C                   z-add     ZNUM          ELSTD
      *
      *
     C                   WRITE     EPOLR
     c     Utdet         endsr
     c*****************************************
     c     kompress      begsr
     c*****************************************
     C                   MOVE      *blanks       B
     C                   Z-ADD     1             AX                2 0
     C                   Z-ADD     1             BX                2 0
      * Get Integer
     C     1             do        15            AX
     C     A(AX)         IFGE      '0'
     C     A(AX)         andle     '9'
     C                   MOVE      A(AX)         B(BX)
     C                   ADD       1             BX
     C                   END
     C                   ENDDO
     c                   endsr
     c*****************************************
     c     getnum        begsr
     c*****************************************
      * stripp blanke
     C                   MOVE      *blanks       B
     C                   Z-ADD     1             BX                2 0
     c     1             do        18            ax
     c     A(AX)         ifne      ' '
     C                   MOVE      A(AX)         B(BX)
     c                   add       1             BX
     c                   endif
     C                   ENDDO
     c                   movea     B             A
      *
     C                   MOVE      *ZEROS        ZHEL
     C                   MOVE      *ZEROS        ZDEC
     C                   MOVE      *ZEROS        B
     C                   Z-ADD     1             AX                2 0
     C                   Z-ADD     1             BX                2 0
      * Get Integer
     C     A(AX)         DOWGE     '0'
     C     ZHEL          MULT      10            ZHEL
     C                   MOVE      A(AX)         ZHEL
     C                   ADD       1             AX
     C                   ENDDO
      * Decimal point ?
     C     A(AX)         IFEQ      '.'
     C     A(AX)         OREQ      ','
     C                   ADD       1             AX
     C     A(AX)         DOWGE     '0'
     C                   MOVE      A(AX)         B(BX)
     C                   ADD       1             AX
     C                   ADD       1             BX
     C                   ENDDO
     C                   MOVEA     B             ZDEC6
     C                   ENDIF
      * Concatenate
     C                   Z-ADD     ZHEL          ZNUM             18 6
     C                   ADD       ZDEC          ZNUM
     C                   ENDSR
     c
     c*****************************************
     c     INIT          begsr
     c*****************************************
      * HENT dagens dato
     C                   TIME                    WTIME
     C                   MOVE      WÅÅ           WSDTÅÅ
     C                   MOVE      WMM           WSDTMM
     C                   MOVE      WDD           WSDTDD
     C                   ENDSR
