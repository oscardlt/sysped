********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01  kalle copirutine istedfor arcamovc
10XXX * 02  muliggjort batchkall
      *
      ***********************************************************
      *** PROGRAM som kopiere dokument til historikk arkiv
      *** sletter hvis ok kopiert i cl
      ***********************************************************
      *
     Farkivl16  UF   E           K DISK
     Ffirm      IF   E           K DISK
     Farktxt    IF   E           K DISK
     Ffirmarc   IF   E           K DISK
     FARKEXT    IF   E           K DISK
s02  F*RCHST01FMCF   E             WORKSTN
n02  FARCHST01FMCF   E             WORKSTN USROPN
     D                 DS
     D  ardate                 1      8  0
     D  araar                  1      4  0
     C*
N02  C     batch         ifeq      'N'
N02  c                   OPEN      ARCHST01FM
N02  c                   end
     C                   EXSR      INIT
     C*
     C     START         TAG
     C     batch         ifeq      'N'
     c                   exfmt     BILDE01
     c   03              goto      slutt
     c  n10              goto      start
N02  c                   end
      *
      * starter med å bygge grunnmappen
      *
     c                   exsr      lestxt
      *
      * ARKIVERER PDF DOKUMENTER
      *
     C*
     C     SLUTT         TAG
N02  C     batch         ifeq      'N'
N02  c                   CLOSE     ARCHST01FM
N02  c                   end
     C                   SETON                                        LR
     C                   RETURN
     C*
     C***********************************************
     C     LESTXT        BEGSR
     C***********************************************
     C*
     c                   setoff                                       33
     c     *in(33)       doweq     '0'
     c                   read      arktxt                                 33
     c     *in(33)       ifeq      '0'
      * lage start av bane fra til
     c                   exsr      genbane
      * les detaljer
     c                   exsr      les
     c                   end
     c                   end
     c                   endsr
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
n02  c     *entry        plist
n02  c                   parm                    batch             1
n02  c                   parm                    aar               4
N02  c     batch         ifeq      'J'
n02  c                   move      aar           wstila            4 0
n02  c                   end
     c     keyext        klist
     c                   kfld                    fifirm
     c                   kfld                    arcext
     c     keytyp        klist
     c                   kfld                    ARTYPE
     C*
     C     arklagk       KLIST
     C                   KFLD                    fifirm
     C                   KFLD                    arklag
     C*
     c                   read      firm                                   33
      *
     C                   ENDSR
     C***********************************************
     C     LES           BEGSR
     C***********************************************
     C*
     c                   setoff                                       34
     c     keytyp        setll     arkivl16
     c     *in(34)       doweq     '0'
     c     keytyp        reade     arkivl16                               34
     c  N34ARAAR         comp      wstila                             34
     c     *in(34)       ifeq      '0'
     c     arlink        andne     *blanks
      * lik forrige oppdater samme verdi
     c     arlink        ifeq      arlinkf
     c                   eval      arbhis=arbhisf
     c                   update    arkivr
     c                   else
     c                   exsr      genbaned
     c                   exsr      kopipdf
     c     ok            ifeq      'J'
     c                   eval      arbhis=arbhisf
     c                   else
     c                   eval      arbhis='MISSING'
     c                   end
     c                   update    arkivr
     c                   move      arlink        arlinkf          40
     c                   endif
     c                   endif
     c                   enddo
     c                   endsr
     C*
     C***********************************************
     C     KOPIPDF       BEGSR
     C***********************************************
s01  c*                  call      'ARCAMOVC'
n01  c                   call      'ARCHSTCPYC'
     c                   parm                    wbanef
     c                   parm                    wbanet
     c                   parm                    ok                1
     c                   endsr
     C***********************************************
     C     genbane       BEGSR
     C***********************************************
      *
      *    ARBHISF BANE TIL HISTORIKK HENTES HER
     C     ARKLAG        IFNE      *blanks
     c     arklagk       chain     arkext                             37
     c                   else
     c     fifirm        chain     firmarc                            37
     c                   end
      *
      * GENERER FRABANE/DOKUMENT
      *
     c                   MOVE      *BLANKS       WBANEF0         120
     C     wbanef0       CAT       arcane:0      wbanef0
     C     wbanef0       CAT       '/':0         wbanef0
      *
      * GENERER TILBANE/DOKUMENT
      *
     c                   MOVE      *BLANKS       WBANET0         120
     C     wbanet0       CAT       arbhisf:0     wbanet0
     C     wbanet0       CAT       '/':0         wbanet0
     c                   endsr
     C***********************************************
     C     genbaned      BEGSR
     C***********************************************
     c                   MOVE      *BLANKS       WBANEF          120
     c                   MOVE      *BLANKS       WBANET          120
     c                   EVAL      wbanef=wbanef0
     c                   EVAL      wbanet=wbanet0
      * legger på dokumentnavn
     C     wbanef        CAT       arlink:0      wbanef
     C     '.'           SCAN      wbanef                                 35
     C  N35wbanef        CAT       '.pdf':0      wbanef
      *
      * GENERER TIABANE/DOKUMENT
      *
     C     wbanet        CAT       arlink:0      wbanet
     C     '.'           SCAN      wbanet                                 35
     C  N35wbanet        CAT       '.pdf':0      wbanet
     c                   endsr
