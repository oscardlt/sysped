********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 TEST AWB-NUMMER
********************************************************************
      *********************************************************************
      * PROGRAM BEHANDLER INPUT FRA SS002 OG VISER TRACKING
      *
CRTPG+*  CRTPGM SYSPED/SS008 MODULE(*LIBL/SS008
CRTPGM*        *LIBL/CHECKUSR *LIBL/INCGI) ACTGRP(CGI) AUT(*USE)
      *
      *
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
     F*CPFL01    IF   E           K DISK    USROPN                              Rådata
     FFSA01L    IF   E           K DISK    USROPN                               FSA Joinfilel
     FFNA01L    IF   E           K DISK    USROPN                               FSA Joinfilel
     FBRIDF     UF   E           K DISK    USROPN
     FKODTFS    IF   E           K DISK    USROPN                               FSA Joinfilel
     FSTED2     IF   E           K DISK    USROPN                               FSA Joinfilel
      *
      *--------------------------------------------------------------------
      * Prototype defintions and standard system API error structure
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      *--------------------------------------------------------------------
      * Variables common to CGI programs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
      * Variables received from the input string
     D lng             s              2
     D UsrSpcName      s             10
     D WSUSER          S             10
     D WINT            S              6
     D WSNA            S             30
     D WSAWB           S             11
     D CLRWF           S              1
     D lstbrd          s              1
     D GrpNr           s              8
     D UTDATA1         S             35
     D UTDATA2         S             65
     D PGM             C                   CONST('SYSPED/CHECKUSR')
      * Number of records matching search criteria
     DRecordCnt        s              5S 0
      *
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
      *
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
     D FEIL01          C                   CONST('System is busy now. -
     D                                     Try later.')
     D T000T           C                   CONST('=========================-
     D                                     ==============================-
     D                                     ==========')
     D T00TT           C                   CONST('MAIN INFORMATIONS')
     D T03TT           C                   CONST('RECIEVED FROM SHIPPER')
     D T04TT           C                   CONST('RECIEVED FROM ANOTHER -
     D                                     CARRIER')
     D T05TT           C                   CONST('ARRIVED ON A FLIGHT')
     D T06TT           C                   CONST('BOOKED')
     D T07TT           C                   CONST('MANIFESTED')
     D T08TT           C                   CONST('DEPARTED')
     D T09TT           C                   CONST('PREPARED FOR LANDING')
     D T10TT           C                   CONST('TRANSFERRED TO ANOTHER -
     D                                     CARRIER')
     D T11TT           C                   CONST('TRANSFERRED TO ANOTHER -
     D                                     CARRIER')
     D T12TT           C                   CONST('CONSIGNEE/AGENT INFORMED -
     D                                     OF ARRIVAL')
     D T13TT           C                   CONST('ARR.DOC. DELIVERIED TO -
     D                                     CONSIGNEE')
     D T14TT           C                   CONST('CLEARED BY CUSTOMS')
     D T15TT           C                   CONST('DELIVERIED TO CONSIGNEE/-
     D                                     HIS AGENT')
     D T16TT           C                   CONST('DISCREPANCY')
     D T17TT           C                   CONST('INFORMATIONS BE REPORTED -
     D                                     TO CUSTOMS')
     D T18TT           C                   CONST('DELIVERIED TO CUSTOMS -
     D                                     DOOR')
      *
     D T0001           C                   CONST('Airline')
     D T0002           C                   CONST('AWB serial no.')
     D T0003           C                   CONST('Origin airport')
     D T0004           C                   CONST('Destination airport')
     D T0005           C                   CONST('No. of pieces')
     D T0006           C                   CONST('Weight')
     D T0007           C                   CONST('Tot. no of pieces')
     D T0008           C                   CONST('Other service informations.')
     D T0301           C                   CONST('Receipt date, time')
     D T0302           C                   CONST('Receipt airport')
     D T0303           C                   CONST('No. of pieces')
     D T0304           C                   CONST('Weight')
     D T0305           C                   CONST('Name')
     D T0401           C                   CONST('Transfer date, time')
     D T0402           C                   CONST('Transfer airport')
     D T0403           C                   CONST('No. of pieces')
     D T0404           C                   CONST('Weight')
     D T0501           C                   CONST('Flight no.')
     D T0502           C                   CONST('Arrival date, time')
     D T0503           C                   CONST('Arrival airport')
     D T0504           C                   CONST('No. of Pieces')
     D T0505           C                   CONST('Weight')
     D T0601           C                   CONST('Flight no.')
     D T0602           C                   CONST('Scheduled departure date')
     D T0603           C                   CONST('Departure airport / time')
     D T0604           C                   CONST('Arrival airport / time')
     D T0605           C                   CONST('No. of Pieces')
     D T0606           C                   CONST('Weight')
     D T1201           C                   CONST('Notify date, time')
     D T1202           C                   CONST('Notify airport')
     D T1301           C                   CONST('Delivery date, time')
     D T1302           C                   CONST('Delivery airport')
     D T1401           C                   CONST('Clear. date, time')
     D T1402           C                   CONST('Clear. airport')
     D T1602           C                   CONST('Discrepancy date, time')
     D T1603           C                   CONST('Discrepancy airport')
     D T1701           C                   CONST('Delivery date, time')
     D T1702           C                   CONST('Delivery airport')
     D T9001           C                   CONST('Reason for error')
     D T9301           C                   CONST('Reason for error')
     D                 DS
     D  XAN34                  1     34
     D  XAN341                 1      3
     D  XAN342                 5     34
     D                 DS
     D  XAN09                  1      9
     D  XAN091                 1      7
     D  XAN092                 8      8
     D  XAN093                 9      9
     D                 DS
     D  XAN14                  1     14
     D  XAN141                 1      2
     D  XAN142                 3      3
     D  XAN143                 4      6
     D  XAN144                10     11
     D  XAN145                12     12
     D  XAN146                13     14
     D                 DS
     D  XAN08                  1      8
     D  XAN081                 1      2
     D  XAN082                 4      8
     D                 DS
     D  A0531                  1      2
     D  A0631                  1      2
     D  A0731                  1      2
     D  A0831                  1      2
     D  A0931                  1      2
     D  A1031                  1      2
     D  A1631                  1      2
     D                 DS
     D  A0532                  1      5
     D  A0632                  1      5
     D  A0732                  1      5
     D  A0832                  1      5
     D  A0932                  1      5
     D  A1032                  1      5
     D  A1632                  1      5
     D                 DS
     D  A0331                  1      2  0
     D  A0433                  1      2  0
     D  A0534                  1      2  0
     D  A0634                  1      2  0
     D  A0734                  1      2  0
     D  A0834                  1      2  0
     D  A0934                  1      2  0
     D  A1034                  1      2  0
     D  A1133                  1      2  0
     D  A1231                  1      2  0
     D  A1331                  1      2  0
     D  A1431                  1      2  0
     D  A1531                  1      2  0
     D  A1634                  1      2  0
     D  A1731                  1      2  0
     D  A1831                  1      2  0
     D                 DS
     D  A0332                  1      3
     D  A0434                  1      3
     D  A0535                  1      3
     D  A0635                  1      3
     D  A0735                  1      3
     D  A0835                  1      3
     D  A0935                  1      3
     D  A1035                  1      3
     D  A1134                  1      3
     D  A1232                  1      3
     D  A1332                  1      3
     D  A1432                  1      3
     D  A1532                  1      3
     D  A1635                  1      3
     D  A1732                  1      3
     D  A1832                  1      3
     D                 DS
     D  A0333                  1      4  0
     D  A0435                  1      4  0
     D  A0536                  1      4  0
     D  A1135                  1      4  0
     D  A1233                  1      4  0
     D  A1333                  1      4  0
     D  A1433                  1      4  0
     D  A1533                  1      4  0
     D  A1636                  1      4  0
     D  A1733                  1      4  0
     D  A1833                  1      4  0
     D                 DS
     D  A0335                  1      3
     D  A0437                  1      3
     D  A05310                 1      3
     D  A0637                  1      3
     D  A0737                  1      3
     D  A0837                  1      3
     D  A0937                  1      3
     D  A1037                  1      3
     D  A1137                  1      3
     D  A1235                  1      3
     D  A1335                  1      3
     D  A1435                  1      3
     D  A1535                  1      3
     D  A1638                  1      3
     D  A1735                  1      3
     D  A1835                  1      3
     D                 DS
     D  A0638                  1      3
     D  A0738                  1      3
     D  A0838                  1      3
     D  A0938                  1      3
     D  A1038                  1      3
     D                 DS
     D  A0343                  1      4  0
     D  A0443                  1      4  0
     D  A0543                  1      4  0
     D  A0643                  1      4  0
     D  A0743                  1      4  0
     D  A0843                  1      4  0
     D  A0943                  1      4  0
     D  A1043                  1      4  0
     D  A1143                  1      4  0
     D  A1243                  1      4  0
     D  A1343                  1      4  0
     D  A1443                  1      4  0
     D  A1543                  1      4  0
     D  A1653                  1      4  0
     D  A1743                  1      4  0
     D  A1843                  1      4  0
     D                 DS
     D  A0345                  1      8  1
     D  A0445                  1      8  1
     D  A0545                  1      8  1
     D  A0645                  1      8  1
     D  A0745                  1      8  1
     D  A0845                  1      8  1
     D  A0945                  1      8  1
     D  A1045                  1      8  1
     D  A1145                  1      8  1
     D  A1245                  1      8  1
     D  A1345                  1      8  1
     D  A1445                  1      8  1
     D  A1545                  1      8  1
     D  A1655                  1      8  1
     D  A1745                  1      8  1
     D  A1845                  1      8  1
     D                 DS
     D  A0662A                 1      2
     D  A0662B                 3      4
     D  A0662                  1      4  0
     D  A0762                  1      4  0
     D  A0862                  1      4  0
     D  A0962                  1      4  0
     D                 DS
     D  A0682A                 1      2
     D  A0682B                 3      4
     D  A0682                  1      4  0
     D  A0782                  1      4  0
     D  A0882                  1      4  0
     D  A0982                  1      4  0
     IFSA00R        01
     IFSA03R        03
     IFSA04R        04
     IFSA05R        05
     IFSA06R        06
     IFSA07R        07
     IFSA08R        08
     IFSA09R        09
     IFSA10R        10
     IFSA11R        11
     IFSA12R        12
     IFSA13R        13
     IFSA14R        14
     IFSA15R        15
     IFSA16R        16
     IFSA17R        17
     IFSA18R        18
     IFNA00R        01
     IFNA03R        03
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================******
      * MAIN PROCESS LINE
      *=====================================================================******
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input
     C                   exsr      Parse
      *
     C                   EXSR      INIT
     C                   CALLB     PGM
     C                   PARM                    BIBRID
     C                   PARM                    UsrSpcName
     C                   PARM                    UINN              1
     C                   IF        UINN = 'N'
     C                   GOTO      SLUTT
     C                   END
     C     WSUSER        CHAIN     BRIDF                              50
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           BIDTF
     C                   MOVE      WTM           BITIDF
     C                   UPDATE    BRIDFR
      * SEND FORESPØRSEL TIL TRADE VISSION
     C                   MOVEL     WSUSER        WSUSER17         17
     C                   MOVE      *ZEROS        URECN             9
N01  C     1             DO        11            XN                3 0
N01  C                   EVAL      XAN01 = %SUBST(WSAWB:XN:1)
N01  C                   IF        XAN01 < '0' OR XAN01 > '9'
N01  C                   EVAL      XFEILAWB = 'J'
N01  C                   GOTO      IKKEHENT
N01  C                   END
N01  C                   ENDDO
     C                   CALL      'TDV61C'
     C                   PARM                    WSAWB
     C                   PARM                    WSUSER17
     C                   PARM                    URECN
N01  C     IKKEHENT      TAG
     C                   MOVE      URECN         WSRECN            9 0
      * Set output skeleton html member name
     C                   exsr      SetSkl
      * Read skeleton output html, etc.
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
      * Retrieve environment variables
     C                   exsr      RtvEnvVar
      *------------------                                                   ******
      * Write HTML sections
      *
      * 1-Section /$top
     C                   exsr      SetTop
     C                   callp     wrtsection('top')
      * 3-Section /$tablestr
     C                   exsr      SetTabStr
     C                   callp     wrtsection('tablestr')
      * 4-Sections /$tablerow
      *
N01  C                   IF        XFEILAWB = 'J'
N01  C                   exsr      SetTabRow
N01  C                   ELSE
     C                   z-add     0             bseq              3 0
     C     WSRECN        SETLL     FSA01L
     C     WSRECN        READE     FSA01L                                 50
     C                   IF        *IN50
     C     WSRECN        SETLL     FNA01L
     C     WSRECN        READE     FNA01L                                 50
     C                   IF        *IN50
     C                   EVAL      UTDATA1 = FEIL01
     C                   EVAL      UTDATA2 = *BLANKS
     C                   exsr      SetTabRow
     C                   ELSE
     C     *IN50         DOWEQ     '0'
     C                   exsr      SetTabRow2
     C                   MOVEA     '000'         *IN(01)
     C     WSRECN        READE     FNA01L                                 50
     C  N50              ENDDO                                                  *hival
     C                   END
     C                   ELSE
     C     *IN50         DOWEQ     '0'
     C                   exsr      SetTabRow
     C                   MOVEA     '000000000000'*IN(01)
     C                   MOVEA     '000000'      *IN(12)
     C     WSRECN        READE     FSA01L                                 50
     C  N50              ENDDO                                                  *hival
     C                   END
N01  C                   END
      *
      * 5-Section /$tableend
     C                   callp     wrtsection('tableend')
      *
      * 5a-Section /$foundsome
     C                   exsr      SetFndSome
     C                   callp     wrtsection('foundsome')
      * 6-Section /$endhtml
     C     endhtml       tag
     C                   exsr      SetEnd
     C     SLUTT         tag
     C                   callp     wrtsection('endhtml')
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
     C                   EXSR      EXIT
     C                   return
      *=====================================================================******
      * Parse input
      *=====================================================================******
     C     Parse         begsr
     C                   MOVE      'N'           XFEIL             1
     C                   eval      lng     = zhbgetvar('lng')
     C                   eval      lstbrd  = zhbgetvar('lstbrd')
     C                   EVAL      WSUSER  = zhbgetvar('USER')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   EVAL      WSNA    = zhbgetvar('WSNA')
     C                   EVAL      WSAWB   = zhbgetvar('WSAWB')
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$top
      *  (search criteria)
      *=====================================================================******
     C     SetTop        begsr
      * Repeat national language for the next invocation
     C                   callp     updhtmlvar('LNG':lng:
     C                             InitHTMLVars)
      * Repeat background color for the next invocation
     C                   callp     updhtmlvar('TXTCOLOR':'black')
     C                   callp     updhtmlvar('BOLD':' ')
     C                   callp     updhtmlvar('BGCOLOR':BIFARG)
     C                   callp     updhtmlvar('LINK':'0000FF')
     C                   callp     updhtmlvar('VLINK':'FF0000')
     C                   callp     updhtmlvar('ALINK':'00FF00')
      * KUNDE
     C                   callp     updhtmlvar('WSNA':WSNA)
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updhtmlvar('USER':WSUSER)
     C                   callp     updhtmlvar('WINT':WINT)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHTMLvar('sdato':
     C                             %trim(%editw(BIDTV:'    .  .  ')))
     C                   callp     updHTMLvar('stid':
     C                             %trim(%editw(BITIDV:'  .  .  ')))
     C                   callp     updhtmlvar('WSAWB':WSAWB)
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$tablestr (table start)
      *=====================================================================******
     C     SetTabStr     begsr
     C     lstbrd        ifeq      'Y'
     C                   callp     updhtmlvar('LB':'0')
     C                   else
     C                   callp     updhtmlvar('LB':'1')
     C                   endif
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$tablerow (table row)
      *=====================================================================******
     C     SetTabRow     begsr
     c* Sequence of this Recd (numeric, converted to char)
     C                   move      bseq          bseqchar          3
     C                   callp     updhtmlvar('SEQ':bseqchar)
      *
     C                   IF        *IN50
     C                   EVAL      UTDATA1 = *BLANKS
N01  C                   IF        XFEILAWB = 'J'
N01  C                   EVAL      UTDATA2 = 'AWB-numner ('
N01  C                             + %TRIM(WSAWB) + ') is not correct.'
N01  C                   ELSE
     C                   EVAL      UTDATA2 = FEIL01
N01  C                   END
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
     C                   ELSE
     C                   EVAL      UTDATA2 = T000T
     C                   SELECT
     C                   WHEN      *IN01
     C                   EVAL      UTDATA1 = T00TT
     C                   WHEN      *IN03
     C                   EVAL      UTDATA1 = T03TT
     C                   WHEN      *IN04
     C                   EVAL      UTDATA1 = T04TT
     C                   WHEN      *IN05
     C                   EVAL      UTDATA1 = T05TT
     C                   WHEN      *IN06
     C                   EVAL      UTDATA1 = T06TT
     C                   WHEN      *IN07
     C                   EVAL      UTDATA1 = T07TT
     C                   WHEN      *IN08
     C                   EVAL      UTDATA1 = T08TT
     C                   WHEN      *IN09
     C                   EVAL      UTDATA1 = T09TT
     C                   WHEN      *IN10
     C                   EVAL      UTDATA1 = T10TT
     C                   WHEN      *IN11
     C                   EVAL      UTDATA1 = T11TT
     C                   WHEN      *IN12
     C                   EVAL      UTDATA1 = T12TT
     C                   WHEN      *IN13
     C                   EVAL      UTDATA1 = T13TT
     C                   WHEN      *IN14
     C                   EVAL      UTDATA1 = T14TT
     C                   WHEN      *IN15
     C                   EVAL      UTDATA1 = T15TT
     C                   WHEN      *IN16
     C                   EVAL      UTDATA1 = T16TT
     C                   WHEN      *IN17
     C                   EVAL      UTDATA1 = T17TT
     C                   WHEN      *IN18
     C                   EVAL      UTDATA1 = T18TT
     C                   ENDSL
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      *
     C                   SELECT
     C                   WHEN      *IN01
      * FLYSELSKAP
     C                   EVAL      UTDATA1 = T0001
     C                   MOVEL     A0211         KFSFNR
     C     KODTFSK       CHAIN     KODTFS                             33
     C                   MOVE      *BLANKS       XAN34
     C                   MOVE      A0211         XAN341
     C                   MOVE      KFSNAV        XAN342
     C                   EVAL      UTDATA2 = XAN34
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * AWB-NR
     C                   EVAL      UTDATA1 = T0002
     C                   MOVEL     A0211         XAN11            11
     C                   MOVE      A0213         XAN11
     C                   EVAL      UTDATA2 = XAN11
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * FRA FLYPLASS
     C                   EVAL      UTDATA1 = T0003
     C                   MOVEL     A0221         ST2KOD
     C     ST2KOD        CHAIN     STED2                              33
     C                   MOVE      *BLANKS       XAN34
     C                   MOVE      A0221         XAN341
     C                   MOVE      ST2NVN        XAN342
     C                   EVAL      UTDATA2 = XAN34
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * TIL FLYPLASS
     C                   EVAL      UTDATA1 = T0004
     C                   MOVEL     A0222         ST2KOD
     C     ST2KOD        CHAIN     STED2                              33
     C                   MOVE      *BLANKS       XAN34
     C                   MOVE      A0222         XAN341
     C                   MOVE      ST2NVN        XAN342
     C                   EVAL      UTDATA2 = XAN34
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * ANTALL KOLLI
     C                   EVAL      UTDATA1 = T0005
     C                   MOVE      A0233         XAN04             4
     C                   EVAL      UTDATA2 = XAN04
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * VEKT
     C                   EVAL      UTDATA1 = T0006
     C                   MOVEL     A0235         XAN091
     C                   MOVE      ','           XAN092
     C                   MOVE      A0235         XAN093
     C                   EVAL      UTDATA2 = XAN09
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * TOTAL KOLLI
     C                   EVAL      UTDATA1 = T0007
     C                   MOVE      A0242         XAN04             4
     C                   EVAL      UTDATA2 = XAN04
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * ANDRE INFO.
     C                   IF        A1922 <> *BLANKS
     C                   EVAL      UTDATA1 = T0008
     C                   EVAL      UTDATA2 = A1922
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
     C                   END
     C                   IF        A1932 <> *BLANKS
     C                   EVAL      UTDATA1 = T0008
     C                   EVAL      UTDATA2 = A1932
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
     C                   END
     C                   WHEN      *IN03 OR *IN17 OR *IN18
      * MOTTATT DATO OG TID
     C                   SELECT
     C                   WHEN      *IN03
     C                   EVAL      UTDATA1 = T0301
     C                   WHEN      *IN17 OR *IN18
     C                   EVAL      UTDATA1 = T1701
     C                   ENDSL
     C                   MOVE      *BLANKS       XAN14
     C                   MOVE      A0331         XAN141
     C                   MOVE      '.'           XAN142
     C                   MOVE      A0332         XAN143
     C                   MOVEL     A0333         XAN144
     C                   MOVE      ':'           XAN145
     C                   MOVE      A0333         XAN146
     C                   EVAL      UTDATA2 = XAN14
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * MOTTATT FLYPLASS
     C                   SELECT
     C                   WHEN      *IN03
     C                   EVAL      UTDATA1 = T0302
     C                   WHEN      *IN17 OR *IN18
     C                   EVAL      UTDATA1 = T1702
     C                   ENDSL
     C                   MOVEL     A0335         ST2KOD
     C     ST2KOD        CHAIN     STED2                              33
     C                   MOVE      *BLANKS       XAN34
     C                   MOVE      A0335         XAN341
     C                   MOVE      ST2NVN        XAN342
     C                   EVAL      UTDATA2 = XAN34
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * ANTALL KOLLI
     C                   EVAL      UTDATA1 = T0303
     C                   MOVE      A0343         XAN04             4
     C                   EVAL      UTDATA2 = XAN04
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * VEKT
     C                   EVAL      UTDATA1 = T0304
     C                   MOVEL     A0345         XAN091
     C                   MOVE      ','           XAN092
     C                   MOVE      A0345         XAN093
     C                   EVAL      UTDATA2 = XAN09
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * NAVN
     C                   IF        A0352 <> *BLANKS
     C                   EVAL      UTDATA1 = T0305
     C                   EVAL      UTDATA2 = A0352
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
     C                   END
     C                   WHEN      *IN04 OR *IN11 OR *IN12 OR *IN13
     C                             OR *IN14 OR *IN15
      * TRANSFER DATO (DD/MM) OG TID
     C                   SELECT
     C                   WHEN      *IN04 OR *IN11
     C                   EVAL      UTDATA1 = T0401
     C                   WHEN      *IN12
     C                   EVAL      UTDATA1 = T1201
     C                   WHEN      *IN13 OR *IN15
     C                   EVAL      UTDATA1 = T1301
     C                   WHEN      *IN14
     C                   EVAL      UTDATA1 = T1401
     C                   ENDSL
     C                   MOVE      *BLANKS       XAN14
     C                   MOVE      A0433         XAN141
     C                   MOVE      '.'           XAN142
     C                   MOVE      A0434         XAN143
     C                   MOVEL     A0435         XAN144
     C                   MOVE      ':'           XAN145
     C                   MOVE      A0435         XAN146
     C                   EVAL      UTDATA2 = XAN14
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * TRANSFER FLYPLASS
     C                   SELECT
     C                   WHEN      *IN04 OR *IN11
     C                   EVAL      UTDATA1 = T0402
     C                   WHEN      *IN12
     C                   EVAL      UTDATA1 = T1202
     C                   WHEN      *IN13 OR *IN15
     C                   EVAL      UTDATA1 = T1302
     C                   WHEN      *IN14
     C                   EVAL      UTDATA1 = T1402
     C                   ENDSL
     C                   MOVEL     A0437         ST2KOD
     C     ST2KOD        CHAIN     STED2                              33
     C                   MOVE      *BLANKS       XAN34
     C                   MOVE      A0437         XAN341
     C                   MOVE      ST2NVN        XAN342
     C                   EVAL      UTDATA2 = XAN34
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * ANTALL KOLLI
     C                   EVAL      UTDATA1 = T0403
     C                   MOVE      A0443         XAN04             4
     C                   EVAL      UTDATA2 = XAN04
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * VEKT
     C                   EVAL      UTDATA1 = T0404
     C                   MOVE      *BLANKS       XAN09
     C                   MOVEL     A0445         XAN091
     C                   MOVE      ','           XAN092
     C                   MOVE      A0445         XAN093
     C                   EVAL      UTDATA2 = XAN09
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
     C                   WHEN      *IN05 OR *IN16
      * FLIGHTNR
     C                   EVAL      UTDATA1 = T0501
     C                   MOVE      *BLANKS       XAN08
     C                   MOVEL     A0531         XAN081
     C                   MOVE      A0532         XAN082
     C                   EVAL      UTDATA2 = XAN08
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * ANKOMST DATO OG TID
     C                   SELECT
     C                   WHEN      *IN05
     C                   EVAL      UTDATA1 = T0502
     C                   WHEN      *IN16
     C                   EVAL      UTDATA1 = T1602
     C                   ENDSL
     C                   MOVE      *BLANKS       XAN14
     C                   MOVE      A0534         XAN141
     C                   MOVE      '.'           XAN142
     C                   MOVE      A0535         XAN143
     C                   MOVEL     A0536         XAN144
     C                   MOVE      ':'           XAN145
     C                   MOVE      A0536         XAN146
     C                   EVAL      UTDATA2 = XAN14
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * ANKOMST FLYPLASS
     C                   SELECT
     C                   WHEN      *IN05
     C                   EVAL      UTDATA1 = T0503
     C                   WHEN      *IN16
     C                   EVAL      UTDATA1 = T1603
     C                   ENDSL
     C                   MOVEL     A05310        ST2KOD
     C     ST2KOD        CHAIN     STED2                              33
     C                   MOVE      *BLANKS       XAN34
     C                   MOVE      A05310        XAN341
     C                   MOVE      ST2NVN        XAN342
     C                   EVAL      UTDATA2 = XAN34
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * ANTALL KOLLI
     C                   EVAL      UTDATA1 = T0504
     C                   MOVE      A0543         XAN04             4
     C                   EVAL      UTDATA2 = XAN04
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * VEKT
     C                   EVAL      UTDATA1 = T0505
     C                   MOVE      *BLANKS       XAN09
     C                   MOVEL     A0545         XAN091
     C                   MOVE      ','           XAN092
     C                   MOVE      A0545         XAN093
     C                   EVAL      UTDATA2 = XAN09
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
     C                   WHEN      *IN06 OR *IN07 OR *IN08 OR *IN09 OR *IN10
      * FLIGHTNR
     C                   EVAL      UTDATA1 = T0601
     C                   MOVE      *BLANKS       XAN08
     C                   MOVEL     A0631         XAN081
     C                   MOVE      A0632         XAN082
     C                   EVAL      UTDATA2 = XAN08
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * PLANLAGT AVGANGSDATO
     C                   EVAL      UTDATA1 = T0602
     C                   MOVE      *BLANKS       XAN14
     C                   MOVE      A0634         XAN141
     C                   MOVE      '.'           XAN142
     C                   MOVE      A0635         XAN143
     C                   EVAL      UTDATA2 = XAN14
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * AVGANGS FLYPLASS
     C                   EVAL      UTDATA1 = T0603
     C                   MOVEL     A0637         ST2KOD
     C     ST2KOD        CHAIN     STED2                              33
     C                   MOVE      *BLANKS       XAN34
     C                   MOVE      A0637         XAN341
     C                   MOVE      ST2NVN        XAN342
     C                   EVAL      UTDATA2 = XAN34
     C  N10              IF        A0662 <> 0
     C                   CAT       '/':3         UTDATA2
     C                   CAT       A0662A:1      UTDATA2
     C                   CAT       ':':0         UTDATA2
     C                   CAT       A0662B:0      UTDATA2
     C                   END
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * ANKOMST FLYPLASS
     C                   EVAL      UTDATA1 = T0604
     C                   MOVEL     A0638         ST2KOD
     C     ST2KOD        CHAIN     STED2                              33
     C                   MOVE      *BLANKS       XAN34
     C                   MOVE      A0638         XAN341
     C                   MOVE      ST2NVN        XAN342
     C                   EVAL      UTDATA2 = XAN34
     C  N10              IF        A0682 <> 0
     C                   CAT       '/':3         UTDATA2
     C                   CAT       A0682A:1      UTDATA2
     C                   CAT       ':':0         UTDATA2
     C                   CAT       A0682B:0      UTDATA2
     C                   END
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * ANTALL KOLLI
     C                   EVAL      UTDATA1 = T0605
     C                   MOVE      A0643         XAN04             4
     C                   EVAL      UTDATA2 = XAN04
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
      * VEKT
     C                   EVAL      UTDATA1 = T0606
     C                   MOVE      *BLANKS       XAN09
     C                   MOVEL     A0645         XAN091
     C                   MOVE      ','           XAN092
     C                   MOVE      A0645         XAN093
     C                   EVAL      UTDATA2 = XAN09
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
     C                   ENDSL
     C                   END
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$tablerow (table row)
      *=====================================================================******
     C     SetTabRow2    begsr
     c* Sequence of this Recd (numeric, converted to char)
     C                   move      bseq          bseqchar          3
     C                   callp     updhtmlvar('SEQ':bseqchar)
     C                   SELECT
     C                   WHEN      *IN01
     C                   EVAL      UTDATA1 = T9001
     C                   EVAL      UTDATA2 = N023
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
     C                   WHEN      *IN03
     C                   IF        N03 <> 'FSR'
     C                   EVAL      UTDATA1 = T9301
     C                   EVAL      UTDATA2 = N03
     C                   callp     updhtmlvar('UTDATA1':UTDATA1)
     C                   callp     updhtmlvar('UTDATA2':UTDATA2)
     C                   callp     wrtsection('tablerow')
     C                   END
     C                   ENDSL
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$foundsome (some Recds were found)
      *=====================================================================******
     C     SetFndSome    begsr
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$endhtml
      *=====================================================================******
     C     SetEnd        begsr
      * Server protocol
     C                   callp     updhtmlvar('PROTOCOL':S_Protocol)
      * Compute run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   endsr
      *=====================================================================******
      * Set html output skeleton member before its read into memory
      *=====================================================================******
     C     SetSkl        begsr
      *------------------
      * Set html output skeleton member
     C                   eval      lng = uppify(lng)
      * "HTMLSRC  " er dft = NORSK, ved å trykke på FLAGGET i inng.
      * kan dette endre stil "HTMLSRCXX" avh. av støttede språk
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC' + lng
     C                   eval      Mbr = 'SS008'
      *------------------
     C                   endsr
      *=====================================================================******
      *  Retrieve environment variables
      *=====================================================================******
     C     RtvEnvVar     begsr
      * Use getenvp to get this server's protocol and name
     C                   eval      S_Protocol =getenv('SERVER_PROTOCOL':
     C                             qusec)
     C                   eval      S_Name     =getenv('SERVER_NAME':
     C                             qusec)
      *
     C                   endsr
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   OPEN      BRIDF
     C     WSUSER        CHAIN(N)  BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   CALLB     'INCGI'
     C                   PARM                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
     C                   eval      rc = docmd('OVRDBF FILE(FSA01L) +
     C                             TOFILE(SMALIBF/FSA01L) +
     C                             SECURE(*YES)')
     C                   open      FSA01L                               50
     C                   eval      rc = docmd('OVRDBF FILE(FNA01L) +
     C                             TOFILE(SMALIBF/FNA01L) +
     C                             SECURE(*YES)')
     C                   open      FNA01L                               50
     C                   open      KODTFS                               50
     C                   open      STED2                                50
     C     KODTFSK       klist
     C                   kfld                    KFSUNI
     C                   kfld                    KFSFNR
     C                   MOVE      'FS'          KFSUNI
N01   *
N01  C                   MOVE      *BLANKS       XAN01             1
N01  C                   MOVE      *BLANKS       XFEILAWB          1
      *
     C                   endsr
      *=====================================================================******
      *  AVSLUTT
      *=====================================================================******
     C     EXIT          begsr
     C                   close     BRIDF
     C                   close     FSA01L
     C                   close     FNA01L
     C                   close     KODTFS
     C                   close     STED2
     C                   eval      *inlr = *on
      *
     C                   endsr
