      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/TNOE093R MODULE(*LIBL/TNOE093R *LIBL/INCGI)
CRTPGM*        ACTGRP(*NEW) AUT(*USE)
      *
      *********************************************************************
      /copy SYSPEDS/qrpgsrcpy,hspecs
      /copy SYSPEDS/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
     FSAEHEUR   UF A E           K DISK    USROPN
     F                                     PREFIX(X)
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy SYSPEDS/qrpgsrcpy,prototypeb
      /copy SYSPEDS/qrpgsrcpy,usec
      /copy SYSPEDS/qrpgsrcpy,variables3
      *
      * Varible for
     D WSUSER          S             10
     D WMODE           S              2
     D JSONstring      S          32000
     D Error           S            150
     D WA              S             15
     D AVD             S              4S 0
     D OPD             S              7  0
     D EUR01A          S             30
     D EUR01B          S             30
     D EUR01C          S             30
     D EUR01D          S             30
     D EUR03A          S             30
     D EUR03B          S             30
     D EUR03C          S             30
     D EUR03D          S             30
     D EUR04           S              2
     D EUR05           S              2
     D EUR06A          S              2S 0
     D EUR06B          S             17
     D EUR06C          S              2
     D EUR07A          S             30
     D EUR07B          S             30
     D EUR07C          S             30
     D EUR07D          S             30
     D EUR07E          S             30
     D EUR081A         S             28
     D EUR081B         S             28
     D EUR081C         S             28
     D EUR081D         S             28
     D EUR081E         S             28
     D EUR081F         S             28
     D EUR081G         S             28
     D EUR081H         S             28
     D EUR081I         S             28
     D EUR082A         S              6S 0
     D EUR082B         S              6S 0
     D EUR082C         S              6S 0
     D EUR082D         S              6S 0
     D EUR082E         S              6S 0
     D EUR082F         S              6S 0
     D EUR082G         S              6S 0
     D EUR082H         S              6S 0
     D EUR082I         S              6S 0
     D EUR083A         S              4
     D EUR083B         S              4
     D EUR083C         S              4
     D EUR083D         S              4
     D EUR083E         S              4
     D EUR083F         S              4
     D EUR083G         S              4
     D EUR083H         S              4
     D EUR083I         S              4
     D EUR084A         S             30A
     D EUR084B         S             30A
     D EUR084C         S             30A
     D EUR084D         S             30A
     D EUR084E         S             30A
     D EUR084F         S             30A
     D EUR084G         S             30A
     D EUR084H         S             30A
     D EUR084I         S             30A
     D EUR09A          S             12S 3
     D EUR09B          S             12S 3
     D EUR09C          S             12S 3
     D EUR09D          S             12S 3
     D EUR09E          S             12S 3
     D EUR09F          S             12S 3
     D EUR09G          S             12S 3
     D EUR09H          S             12S 3
     D EUR09I          S             12S 3
     D EUR10A          S             17
     D EUR10B          S             17
     D EUR10C          S             17
     D EUR10D          S             17
     D EUR10E          S             17
     D EUR10F          S             17
     D EUR10G          S             17
     D EUR10H          S             17
     D EUR10I          S             17
     D EUR12A          S             15
     D EUR12B          S              8S 0
     D EUR12C          S             30

      *get input-string
      /copy syspeds/qrpgsrcpy,prolog3

      * Parse input
     C                   EXSR      Parse
      * Open files etc
     C                   EXSR      INIT
      *
     c                   callp     gethtmlifs(
     C                             '/syspeddev/html/JSON.html':
     C                             '/CGITAG/')
     C                   callp     wrtsection('top')
      * Teste input og utfør
     C  N50              EXSR      TEST

      * ............................................................................................
      * skriv JSON-Object start..(alltid '{' + x ant param. m/komma mellom (IKKE komma etter siste))
      * ............................................................................................
      *
      /free
        JSONstring='{'
        +'¬user¬ : ¬'+%trim(WSUSER)+'¬, '
        +'¬avd¬ : ¬'+%trim(%editc(AVD:'Z'))+'¬, '
        +'¬opd¬ : ¬'+%trim(%editc(OPD:'Z'))+'¬, '
        +'¬errMsg¬ : ¬'+%trim(Error)+'¬, ';
      /end-free
      * JSONfix escaper " i tekst,  for deretter å bytte ¬->"
     c                   call      'JSONFIX'
     c                   parm                    JSONstring
     C                   callp     updHTMLvar('JSONstring':JSONstring)
     C                   callp     wrtsection('JSONlin')
      *
      * ............................................................................................
      * Skriv JSON-LISTE Start (en liste er EN parameter(fra [ til   )
      * ............................................................................................
     c                   eval      JSONstring ='"updateeur1" : ['
     C                   callp     updHTMLvar('JSONstring':JSONstring)
     C                   callp     wrtsection('JSONlin')
      * ............................................................................................
      * Skriv JSON-Liste/Array  Avslutning
      * ............................................................................................
     c                   eval      JSONstring =']'
     C                   callp     updHTMLvar('JSONstring':JSONstring)
     C                   callp     wrtsection('JSONlin')
      * ............................................................................................
      * Skriv JSON-string Avsluttning
      * ............................................................................................
     c                   eval      JSONstring ='}'
     C                   callp     updHTMLvar('JSONstring':JSONstring)
     C                   callp     wrtsection('JSONlin')

      * Quit
     C                   exsr      Exit


      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Lukk fil
     C                   CLOSE     BRIDF
     C  N50              CLOSE     SAEHEUR

      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      * Quit
     C                   MOVE      *ON           *INLR
     C                   return
     C                   endsr
      *
      *********************************************************
     C     Parse         Begsr
      *********************************************************
      * Get input
     C                   EVAL      WSUSER  = zhbgetvar('USER')
     C                   EVAL      WA         = zhbgetvar('AVD')
     C                   EVAL      AVD        = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('OPD')
     C                   EVAL      OPD        = c2n2(WA)
     C                   EVAL      EUR01A     = zhbgetvar('EUR01A')
     C                   EVAL      EUR01B     = zhbgetvar('EUR01B')
     C                   EVAL      EUR01C     = zhbgetvar('EUR01C')
     C                   EVAL      EUR01D     = zhbgetvar('EUR01D')
     C                   EVAL      EUR03A     = zhbgetvar('EUR03A')
     C                   EVAL      EUR03B     = zhbgetvar('EUR03B')
     C                   EVAL      EUR03C     = zhbgetvar('EUR03C')
     C                   EVAL      EUR03D     = zhbgetvar('EUR03D')
     C                   EVAL      EUR04      = zhbgetvar('EUR04')
     C                   EVAL      EUR05      = zhbgetvar('EUR05')
     C                   EVAL      WA         = zhbgetvar('EUR06A')
     C                   EVAL      EUR06A     = c2n2(WA)
     C                   EVAL      EUR06B     = zhbgetvar('EUR06B')
     C                   EVAL      EUR06C     = zhbgetvar('EUR06C')
     C                   EVAL      EUR07A     = zhbgetvar('EUR07A')
     C                   EVAL      EUR07B     = zhbgetvar('EUR07B')
     C                   EVAL      EUR07C     = zhbgetvar('EUR07C')
     C                   EVAL      EUR07D     = zhbgetvar('EUR07D')
     C                   EVAL      EUR07E     = zhbgetvar('EUR07E')
     C                   EVAL      EUR081A    = zhbgetvar('EUR081A')
     C                   EVAL      EUR081B    = zhbgetvar('EUR081B')
     C                   EVAL      EUR081C    = zhbgetvar('EUR081C')
     C                   EVAL      EUR081D    = zhbgetvar('EUR081D')
     C                   EVAL      EUR081E    = zhbgetvar('EUR081E')
     C                   EVAL      EUR081F    = zhbgetvar('EUR081F')
     C                   EVAL      EUR081G    = zhbgetvar('EUR081G')
     C                   EVAL      EUR081H    = zhbgetvar('EUR081H')
     C                   EVAL      EUR081I    = zhbgetvar('EUR081I')
     C                   EVAL      WA         = zhbgetvar('EUR082A')
     C                   EVAL      EUR082A    = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR082B')
     C                   EVAL      EUR082B    = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR082C')
     C                   EVAL      EUR082C    = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR082D')
     C                   EVAL      EUR082D    = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR082E')
     C                   EVAL      EUR082E    = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR082F')
     C                   EVAL      EUR082F    = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR082G')
     C                   EVAL      EUR082G    = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR082H')
     C                   EVAL      EUR082H    = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR082I')
     C                   EVAL      EUR082I    = c2n2(WA)
     C                   EVAL      EUR083A    = zhbgetvar('EUR083A')
     C                   EVAL      EUR083B    = zhbgetvar('EUR083B')
     C                   EVAL      EUR083C    = zhbgetvar('EUR083C')
     C                   EVAL      EUR083D    = zhbgetvar('EUR083D')
     C                   EVAL      EUR083E    = zhbgetvar('EUR083E')
     C                   EVAL      EUR083F    = zhbgetvar('EUR083F')
     C                   EVAL      EUR083G    = zhbgetvar('EUR083G')
     C                   EVAL      EUR083H    = zhbgetvar('EUR083H')
     C                   EVAL      EUR083I    = zhbgetvar('EUR083I')
     C                   EVAL      EUR084A    = zhbgetvar('EUR084A')
     C                   EVAL      EUR084B    = zhbgetvar('EUR084B')
     C                   EVAL      EUR084C    = zhbgetvar('EUR084C')
     C                   EVAL      EUR084D    = zhbgetvar('EUR084D')
     C                   EVAL      EUR084E    = zhbgetvar('EUR084E')
     C                   EVAL      EUR084F    = zhbgetvar('EUR084F')
     C                   EVAL      EUR084G    = zhbgetvar('EUR084G')
     C                   EVAL      EUR084H    = zhbgetvar('EUR084H')
     C                   EVAL      EUR084I    = zhbgetvar('EUR084I')
     C                   EVAL      WA         = zhbgetvar('EUR09A')
     C                   EVAL      EUR09A     = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR09B')
     C                   EVAL      EUR09B     = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR09C')
     C                   EVAL      EUR09C     = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR09D')
     C                   EVAL      EUR09D     = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR09E')
     C                   EVAL      EUR09E     = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR09F')
     C                   EVAL      EUR09F     = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR09G')
     C                   EVAL      EUR09G     = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR09H')
     C                   EVAL      EUR09H     = c2n2(WA)
     C                   EVAL      WA         = zhbgetvar('EUR09I')
     C                   EVAL      EUR09I     = c2n2(WA)
     C                   EVAL      EUR10A     = zhbgetvar('EUR10A')
     C                   EVAL      EUR10B     = zhbgetvar('EUR10B')
     C                   EVAL      EUR10C     = zhbgetvar('EUR10C')
     C                   EVAL      EUR10D     = zhbgetvar('EUR10D')
     C                   EVAL      EUR10E     = zhbgetvar('EUR10E')
     C                   EVAL      EUR10F     = zhbgetvar('EUR10F')
     C                   EVAL      EUR10G     = zhbgetvar('EUR10G')
     C                   EVAL      EUR10H     = zhbgetvar('EUR10H')
     C                   EVAL      EUR10I     = zhbgetvar('EUR10I')
     C                   EVAL      EUR12A     = zhbgetvar('EUR12A')
     C                   EVAL      WA         = zhbgetvar('EUR12B')
     C                   EVAL      EUR12B     = c2n2(WA)
     C                   EVAL      EUR12C     = zhbgetvar('EUR12C')
     C                   ENDSR
      *********************************************************
     C     INIT          Begsr
      *********************************************************
     C                   OPEN      BRIDF
      * Test innlogging
     C     WSUSER        CHAIN     BRIDF                              50
     C  N50BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C                   call      BILIBL
     C                   end
      *
     C     EURKEY        KLIST
     C                   KFLD                    AVD
     C                   KFLD                    OPD

     C   50              eval      Error = 'Invalid userID'
     C  N50              OPEN      SAEHEUR

     c                   endsr
      *
      *______________________________________________________
      * TEST                                             TEST
      *""""""""""""""""""""""""""""""""""""""""""""""""""""""
     C     TEST          BEGSR
     C     EURKEY        CHAIN     SAEHEUR                            55
     C                   IF        *IN55=*ON
     C                   eval      Error = 'Order not found'
     C                   ELSE
     C                   eval      Error = *blanks
     C                   EVAL      XEUR01A=EUR01A
     C                   EVAL      XEUR01B=EUR01B
     C                   EVAL      XEUR01C=EUR01C
     C                   EVAL      XEUR01D=EUR01D
     C                   EVAL      XEUR03A=EUR03A
     C                   EVAL      XEUR03B=EUR03B
     C                   EVAL      XEUR03C=EUR03C
     C                   EVAL      XEUR03D=EUR03D
     C                   EVAL      XEUR04 =EUR04
     C                   EVAL      XEUR05 =EUR05
     C                   EVAL      XEUR06A=EUR06A
     C                   EVAL      XEUR06B=EUR06B
     C                   EVAL      XEUR06C=EUR06C
     C                   EVAL      XEUR07A=EUR07A
     C                   EVAL      XEUR07B=EUR07B
     C                   EVAL      XEUR07C=EUR07C
     C                   EVAL      XEUR07D=EUR07D
     C                   EVAL      XEUR07E=EUR07E

     C                   EVAL      XEUR081A=EUR081A
     C                   EVAL      XEUR081B=EUR081B
     C                   EVAL      XEUR081C=EUR081C
     C                   EVAL      XEUR081D=EUR081D
     C                   EVAL      XEUR081E=EUR081E
     C                   EVAL      XEUR081F=EUR081F
     C                   EVAL      XEUR081G=EUR081G
     C                   EVAL      XEUR081H=EUR081H
     C                   EVAL      XEUR081I=EUR081I
     C                   EVAL      XEUR082A=EUR082A
     C                   EVAL      XEUR082B=EUR082B
     C                   EVAL      XEUR082C=EUR082C
     C                   EVAL      XEUR082D=EUR082D
     C                   EVAL      XEUR082E=EUR082E
     C                   EVAL      XEUR082F=EUR082F
     C                   EVAL      XEUR082G=EUR082G
     C                   EVAL      XEUR082H=EUR082H
     C                   EVAL      XEUR082I=EUR082I
     C                   EVAL      XEUR083A=EUR083A
     C                   EVAL      XEUR083B=EUR083B
     C                   EVAL      XEUR083C=EUR083C
     C                   EVAL      XEUR083D=EUR083D
     C                   EVAL      XEUR083E=EUR083E
     C                   EVAL      XEUR083F=EUR083F
     C                   EVAL      XEUR083G=EUR083G
     C                   EVAL      XEUR083H=EUR083H
     C                   EVAL      XEUR083I=EUR083I
     C                   EVAL      XEUR084A=EUR084A
     C                   EVAL      XEUR084B=EUR084B
     C                   EVAL      XEUR084C=EUR084C
     C                   EVAL      XEUR084D=EUR084D
     C                   EVAL      XEUR084E=EUR084E
     C                   EVAL      XEUR084F=EUR084F
     C                   EVAL      XEUR084G=EUR084G
     C                   EVAL      XEUR084H=EUR084H
     C                   EVAL      XEUR084I=EUR084I
     C                   EVAL      XEUR09A =EUR09A
     C                   EVAL      XEUR09B =EUR09B
     C                   EVAL      XEUR09C =EUR09C
     C                   EVAL      XEUR09D =EUR09D
     C                   EVAL      XEUR09E =EUR09E
     C                   EVAL      XEUR09F =EUR09F
     C                   EVAL      XEUR09G =EUR09G
     C                   EVAL      XEUR09H =EUR09H
     C                   EVAL      XEUR09I =EUR09I

     C                   EVAL      XEUR10A=EUR10A
     C                   EVAL      XEUR10B=EUR10B
     C                   EVAL      XEUR10C=EUR10C
     C                   EVAL      XEUR10D=EUR10D
     C                   EVAL      XEUR10E=EUR10E
     C                   EVAL      XEUR10F=EUR10F
     C                   EVAL      XEUR10G=EUR10G
     C                   EVAL      XEUR10H=EUR10H
     C                   EVAL      XEUR10I=EUR10I
     C                   EVAL      XEUR12A=EUR12A
     C                   EVAL      XEUR12B=EUR12B
     C                   EVAL      XEUR12C=EUR12C
     C                   UPDATE    SAEHEURR
     C                   ENDIF
     C                   ENDSR
