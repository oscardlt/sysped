********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 overflow              ..
10XXX * 02 SH  PTF10 IKKE FAKTURERTE LINJER VED ' ' STATUS
10XXX * 03 jov PTF10 feil i 02 (hoppet ut av leseloopen for HEST = ' ')
10XXX * 04 SH  PTF10 FIKSER EMNERUBRIKK PÅ EPOST
10XXX * 05 SH  PTF10 PLUKK UT på DELSYSTEM
10XXX * 06 SH  PTF10 mindre
10XXX * 07 SH  PTF10 RETT FEIL PÅ ENDRING 5. INIT. WSAVD
10XXX * 08 SH  PTF10 X mot gegge veier ikke ta med
********************************************************************
10XXX * 09 SH  PTF11 stygg feil med firmakode
10XXX * 10 SH  PTF11 diverse forbdringer
10XXX * 11 SH  PTF11 coverpage 70
10XXX * 12 SH  PTF11 feil i sumlisten
10XXX * 13 SH  PTF11 får kundenr før kundnavn
10XXX * 14 SH  PTF11 utelate dupp
10XXX * 15 SH  PTF11 ikke ta med ferdigmeldte
10XXX * 16 SH  PTF11 fra til periode ta bort henting av messagekonstanter
10XXX * 17 JOV PTF11 UDS-parameter for vis kostnad
10XXX * 18 SH  PTF11 fai kostnadstest
10XXX * 19 JOV PTF11 initiere HEDTOP / DS
10XXX * 20 sh  PTF12 X=til XLS       / DS
10XXX * 21 sh  PTF12 fakturaparts navn
12XXX * 22 YBC PTF12 Import viser mottaker, eksport avsender
********************************************************************
      *
      *************************************************************
      *** PROGRAM SKAL SKRIVE UFAKTURERTE OPPDRAG               ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER      ***
      *** LEDIGE INDIKATORER 01-26                              ***
      *** LEDIGE INDIKATORER 27-29 32-43 46-90                  ***
      *************************************************************
      *
     H DECEDIT(',') debug(*yes)
N20  FSYFA37XL  O  A E           K DISK
N16  Fturer14   IF   E           K DISK
N15  FFerdl01   IF   E           K DISK
s18  F*OSTA14   IF   E           K DISK
N02  FFAI4      IF   E           K DISK
     FAVDGR     IF   E           K DISK
     FKODTFM    IF   E           K DISK
     FFIRM      IF   E           K DISK
     FSAML1     IF   E           K DISK
     FKODTV     IF   E           K DISK
     FHEAD1     IF   E           K DISK
     F                                     RENAME(HEADFR:HEAD1R)
     FWRKHE     UF A E           K DISK
     FWRKHE1    IF   E           K DISK
     F                                     RENAME(WRKHER:WRKHER1)
     FWRKHE2    IF   E           K DISK
     F                                     RENAME(WRKHER:WRKHER2)
     FHEADF     IF   E           K DISK
     FFAK4      IF   E           K DISK
N17  FFAKT      IF   E           K DISK    RENAME(FAKTR:FAKTRR)
N17  FKOSBU9    IF   E           K DISK
N17  FLEVEL01   IF   E           K DISK
N21  FCUNDL01   IF   E           K DISK
N18  FFAK3      IF   E           K DISK    RENAME(FAKTR:FAK3R)
     FBRPARF    if   e           k disk
     FSYFA37PF  O    E             PRINTER
N10  FSYFA37PS  O    E             PRINTER
     D                 DS
     D  WUDTÅ                  1      2  0
     D  WUDTM                  3      4  0
     D  WUDTD                  5      6  0
     D  WUDT                   1      6  0
N04  D                 DS
N04  D  WUDTDE                 1      2  0
N04  D  PU01                   3      3
N04  D  WUDTME                 4      5  0
N04  D  PU02                   6      6
N04  D  WUDTÅE                 7      8  0
N04  D  WUDTE                  1      8
     D                 DS
     D  UTDTD                  1      2  0
     D  UTDTM                  3      4  0
     D  UTDTÅ                  5      6  0
     D  UTDT                   1      6  0
     D                 DS
     D  HEDTÅ                  1      4  0
     D  HEDTM                  5      6  0
     D  HEDTD                  7      8  0
     D  HEDTOP                 1      8  0
     D                 DS
     D  UDT1B                  1      2  0
     D  UDT2B                  3      4  0
     D  UDT3B                  5      6  0
     D  UDT13                  1      6  0
N05  D                 DS
N05  D  av                     1     80  0 DIM(20)                              avd
N05  D  WSAV01                 1      4  0
N05  D  WSAV02                 5      8  0
N05  D  WSAV03                 9     12  0
N05  D  WSAV04                13     16  0
N05  D  WSAV05                17     20  0
N05  D  WSAV06                21     24  0
N05  D  WSAV07                25     28  0
N05  D  WSAV08                29     32  0
N05  D  WSAV09                33     36  0
N05  D  WSAV10                37     40  0
N05  D  WSAV11                41     44  0
N05  D  WSAV12                45     48  0
N05  D  WSAV13                49     52  0
N05  D  WSAV14                53     56  0
N05  D  WSAV15                57     60  0
N05  D  WSAV16                61     64  0
N05  D  WSAV17                65     68  0
N05  D  WSAV18                69     72  0
N05  D  WSAV19                73     76  0
N05  D  WSAV20                77     80  0
N05  D  WSAVD                  1     80
N16  D                 DS
N16  D  TSTPER                 1      4  0
N16  D  TSTAAR                 1      2  0
N16  D  TSTMND                 3      4  0
N16  D                 DS
N16  D  HEVKT                  1      9  0
N16  D  HEVKT5                 5      9  0
N16  D                 DS
N16  D  HENT                   1      7  0
N16  D  HENT5                  3      7  0
     D                UDS
     D  UFIRM                  1      2
     D  UAVDF                 22     25  0
     D  UAVDT                 26     29  0
     D  UDT                   30     35  0
     D  UA4                   36     36
     D  USIGN                 37     39
     D  UAVDG                 49     55
     D  USORT                 40     40
N02  D  UDELS1                56     56
N02  D  UDELS2                57     57
N02  D  UDELS3                58     58
N10  D  IUAVD                100    100
N05  D  UAVD                 101    180
N16  D  UPEAAF               181    182  0
N16  D  UPEMMF               183    184  0
N16  D  UPEFRA               181    184  0
N16  D  UPEAAT               185    186  0
N16  D  UPEMMT               187    188  0
N16  D  UPETIL               185    188  0
N17  D  UKOST                189    189
N21  IKUNDR
N21  I              BANKG                       SYBAGI
N21  I              POSTG                       SYPOGI
     C*
N05  C                   MOVE      UAVD          WSAVD
     C                   EXSR      INIT
     C*
     C                   MOVE      '999'         XSG               3
     C                   MOVE      *ZEROS        XAVD              4 0
N10  C     USAM          IFEQ      'J'
N10  c     USAM          OREQ      'K'
N10  C                   WRITE     SHEAD1
N10  c                   Z-ADD     0             ANTLIN            2 0
N10  C                   ENDIF
     C     UA4           COMP      'J'                                    91
     C     LASER         IFEQ      'J'
     C     LASER         OREQ      'A'
     C  N91              Z-ADD     41            XOVERF            2 0
     C   91              Z-ADD     62            XOVERF
     C                   ELSE
     C  N91              Z-ADD     43            XOVERF            2 0
     C   91              Z-ADD     62            XOVERF
     C                   END
N10  C  N91              Z-ADD     40            YOVERF            2 0
N10  C   91              Z-ADD     60            YOVERF
     C     USORT         IFEQ      'A'
     C                   SETON                                        40
     C     *LOVAL        SETLL     WRKHE
     C                   ELSE
     C     *LOVAL        SETLL     WRKHE2
     C                   END
     C*
     C     START         TAG
     C     USORT         IFEQ      'A'
     C                   READ      WRKHE                                  30
     C                   ELSE
     C                   READ      WRKHE2                                 30
     C                   END
     C  N30HEAKEY        CHAIN     HEADF                              30
N16  C                   EXSR      PERSR
     C   30              GOTO      SLUTT
     C     HEST          IFEQ      'S'
     C                   GOTO      START
     C                   END
N15  C     HEAKEY        CHAIN     FERDL01                            35
N15  C     *IN35         IFEQ      '0'
N15  C                   GOTO      START
N15  C                   END
      *
      * BRYTNING VED BRUDD SIGNATUR
      *
     C     HESG          IFNE      XSG
     C                   SETOFF                                       31
     C                   Z-ADD     10            XLN               2 0
     C                   MOVE      HESG          XSG
     C                   MOVE      HEAVD         XAVD
     C                   ELSE
      *
      * BRYTNING VED AVDELINSSORTERING
      *
     C     HEAVD         IFNE      XAVD
     C     USORT         IFEQ      'A'
     C                   SETOFF                                       31
     C                   Z-ADD     10            XLN
     C                   MOVE      HEAVD         XAVD
     C                   END
     C                   END
     C                   END
      *
      * SKRIVER TOTAL VED MINST EN VARELINJE
      *
     C  N31
     CAN 45              DO
s12  C* N31              MOVE      HESG          WWSG
s12  C* N31              Z-ADD     HEAVD         WWAVD
N01  C     XLN           IFGE      XOVERF
N01  C                   Z-ADD     10            XLN
s12  C*                  MOVE      HESG          WWSG
S12  C*                  Z-ADD     HEAVD         WWAVD
s10  C*                  WRITE     HEADER
s10  C   77              WRITE     HEADER
N01  C                   ADD       1             ANTH
N01  C                   END
s10  C*                  WRITE     TOTAL
n10  C   77              WRITE     TOTAL
N10  C                   ADD       1             XLN
      *
      * start sammendragsliste
      *
N10  C     USAM          IFEQ      'J'
N10  C     USAM          OREQ      'K'
N10  C                   WRITE     STOTAL
N10  C                   ADD       1             ANTLIN
N10  C     ANTLIN        IFGE      YOVERF
N10  C                   WRITE     SHEAD1
N10  C                   Z-ADD     0             ANTLIN            2 0
N10  C                   ENDIF
N10  C                   ENDIF
      *
      * slutt sammendragsliste
      *
     C                   Z-ADD     0             XNTOPD            5 0
     C                   Z-ADD     0             XBLOPD           11 2
     C                   END
      *
      * start N31
      *
n10  c     *in31         ifeq      '0'
s10  C* N31              WRITE     HEADER
s10  C* N31              SETON                                        31
s10  C* N31              ADD       1             ANTH              5 0
n10  C   77              WRITE     HEADER
n10  C                   SETON                                        31
n10  C                   ADD       1             ANTH              5 0
n10  c                   end
      *
      * slutt N31
      *
     C                   EXSR      SUM
     C                   EXSR      KDTFMT
s10  C*                  WRITE     DETALJ
S22  c*    heknkf        ifne      0
S22  c*                  z-add     heknkf        kundnr
S22  c*                  else
S22  c*                  z-add     heknsf        kundnr
S22  c*                  end
N22  C                   IF        HEUR = 'A' OR HEUR = 'C' OR
N22  C                             HEUR = 'F' OR HEUR = 'H'
N22  C                   IF        HEKNKF <> 0
N22  C                   z-add     heknkf        kundnr
N22  C                   ELSE
N22  C                   z-add     heknsf        kundnr
N22  C                   END
n21  c     kunkey        chain     cundl01                            66
S22  c* N66              eval      henak=knavn
N22  C  N66              eval      XKNV = KNAVN
N22  C   66              eval      XKNV = HENAK
N22  C                   ELSE
N22  C                   IF        HEKNSF <> 0
N22  C                   z-add     heknsf        kundnr
N22  C                   ELSE
N22  C                   z-add     heknkf        kundnr
N22  C                   END
N22  c     kunkey        chain     cundl01                            66
N22  C  N66              eval      XKNV = KNAVN
N22  C   66              eval      XKNV = HENAS
N22  C                   END
n10  C   77              WRITE     DETALJ
N20  c     skjerm        ifeq      'X'
N20  c                   write     syfa37xlr
N20  c                   end
N17  c                   IF        UKOST = 'J'
N17  c                   EXSR      PRTKOST
N17  c                   ENDIF
N12  C                   MOVE      HESG          WWSG
N12  C                   MOVE      HEAVD         WWAVD
     C                   Z-ADD     0             XBL               9 0
     C                   ADD       1             XLN
     C                   ADD       1             XNTOPD            5 0
     C                   ADD       1             XNTTOT            5 0
     C*
     C     XLN           IFGT      XOVERF
     C                   Z-ADD     10            XLN
s10  C*                  WRITE     HEADER
n10  C   77              WRITE     HEADER
     C                   ADD       1             ANTH
     C                   END
     C*
     C                   GOTO      START
     C*
     C     SLUTT         TAG
     C     ANTH          IFEQ      0
     C                   Z-ADD     0             HEAVD
     C                   MOVE      *BLANKS       HESG
s10  C*                  WRITE     HEADER
n10  C   77              WRITE     HEADER
     C                   ENDIF
     C                   ADD       2             XLN
     C     XLN           IFGT      XOVERF
     C                   Z-ADD     10            XLN
s10  C*                  WRITE     HEADER
n10  C   77              WRITE     HEADER
     C                   ADD       1             ANTH
     C                   END
N01  C     XLN           IFGE      XOVERF
N01  C                   Z-ADD     10            XLN
s10  C*                  WRITE     HEADER
n10  C   77              WRITE     HEADER
N01  C                   ADD       1             ANTH
N01  C                   END
s10  C*                  WRITE     TOTAL
n10  C   77              WRITE     TOTAL
     C                   ADD       2             XLN
     C     XLN           IFGT      XOVERF
     C                   Z-ADD     10            XLN
s10  C*                  WRITE     HEADER
n10  C   77              WRITE     HEADER
     C                   ADD       1             ANTH
     C                   END
s10  C*                  WRITE     GRAND
n10  C   77              WRITE     GRAND
n10  C     USAM          IFEQ      'J'
n10  C     USAM          OREQ      'K'
n10  C                   WRITE     STOTAL
n10  C                   WRITE     SGRAND
n10  C                   ENDIF
     C                   SETON                                        LR
     C                   RETURN
     C*
     C******************************************
     C     SUM           BEGSR
     C******************************************
N10  C     *IN45         IFEQ      '0'
S12  C*                  MOVE      HESG          WWSG
S12  C*                  MOVE      HEAVD         WWAVD
     C                   SETON                                        45
N10  C                   END
     C                   SETOFF                                       44
     C     FAK2K         SETLL     FAK4
     C     STSUM         TAG
     C     HEAVD         READE     FAK4                                   44
     C  N44HEOPD         COMP      FAOPD                              4444
     C   44              GOTO      SLSUM
     C*
     C                   ADD       FABELN        XBLOPD
     C                   ADD       FABELN        XBLTOT           11 2
     C                   ADD       FABELN        XBL
     C                   GOTO      STSUM
     C*
     C     SLSUM         ENDSR
     C*
     C***********************************************
     C     INIT          BEGSR
     C***********************************************
     C     *ENTRY        PLIST
     C                   PARM                    USAML             1
     C     LASER         PARM      LASER         LASER             1
     C     STRING        PARM      STRING        STRING            5
     C     COPYA         PARM      COPYA         COPYA             2
s11  C*    CVP1          PARM      CVP1          CVP1             80
n11  C     CVP1          PARM      CVP1          CVP1             70
S11  C*    CVPN          PARM      CVPN          CVPN             80
N11  C     CVPN          PARM      CVPN          CVPN             70
N10  C                   PARM                    USAM              1
N14  C                   PARM                    UDUPP             1
N20  C                   PARM                    SKJERM            1
     C                   MOVE      COPYA         COPY              2 0
     C                   DUMP
N18  C     FAK3K         KLIST
N18  C                   KFLD                    OPPDAT            1
N18  C                   KFLD                    FIFN
N18  c                   move      'O'           oppdat
     C     HEAKEY        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
n21  C     kunkey        KLIST
n21  C                   KFLD                    fifirm
n21  C                   KFLD                    kundnr
     C     FAK2K         KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C                   KFLD                    YSK
N17  C     KOSBU9K       KLIST
N17  C                   KFLD                    BUST
N17  C                   KFLD                    HEAVD
N17  C                   KFLD                    HEOPD
N17  C     LevKey        KLIST
N17  C                   KFLD                    FIFIRM
N17  C                   KFLD                    BULNR
N10  C                   MOVE      *OFF          *IN77
N10  C     USAM          IFEQ      'J'
N10  C     USAM          OREQ      'N'
N10  C     USAM          OREQ      ' '
N10  C                   MOVE      *ON           *IN77
N10  C                   ENDIF
     C     STRING        IFNE      *BLANKS
     C     STRING        CHAIN     KODTFM                             33
     C                   END
     C     LASER         IFEQ      'A'
     C                   SETON                                        88
     C     UA4           IFNE      'J'
     C                   SETON                                        89
     C                   END
     C                   END
     C*
s09  C*    UFIRM         CHAIN     FIRM                               33
n09  C                   READ      FIRM                                   33
N19  C                   MOVE      *ZEROS        HEDTOP
     C                   MOVE      *ZEROS        YDT               6 0
     C                   MOVE      '   '         YSG               3
     C                   MOVE      ' '           YSK               1
     c                   move      uavdg         kavdg             7
s09  C*                  MOVE      *ZEROS        WSAVD
     C*
     C                   MOVE      UDT           WUDT
     C                   MOVE      UYEAR         UTDTÅ
     C                   MOVE      UMONTH        UTDTM
     C                   MOVE      UDAY          UTDTD
     C     UDT           IFGT      501231
     C     UDT           ADD       19000000      UDT8              8 0
     C                   ELSE
     C     UDT           ADD       20000000      UDT8
     C                   END
N04   * FIKS EMNERUBRIKK
N04  C                   MOVE      WUDTÅ         WUDTÅE
N04  C                   MOVE      WUDTM         WUDTME
N04  C                   MOVE      WUDTD         WUDTDE
N04  C                   MOVE      '.'           PU01
N04  C                   MOVE      '.'           PU02
N04  C                   EVAL      CVP1='Ufakturerte oppdrag tom:'
N04  C     CVP1          CAT       WUDTE:1       CVP1
N10  C                   EVAL      CVPN=CVP1
N10  C     CVPN          CAT       '- sammen':1  CVPN
N10  C     CVPN          CAT       'drag':0      CVPN
     C*
      *
      * hent bookingoppdragstyper - Takler kun definering på FIRMA-nivå
     C     BookKey       klist
     C                   kfld                    DFTUSER          10
     C                   kfld                    NULLKU            8 0
     C                   kfld                    PAID
      *
     C                   Eval      DFTUSER = '*KUNDFT*'+FIFIRM
     C                   MOVEL     'OSOTY'       PAID
     c     BookKey       chain     BRparf
     c                   movel     PAVRDA        BookOTY          50
      *
     C                   EXSR      WRKSR
     C                   Z-ADD     0             ANTH              5 0
N16  c                   move      *zeros        tstper
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
     C     HEDTOP        IFEQ      *ZEROS
     C                   MOVE      HEDTR         HEDTOP
     C                   END
     C                   MOVE      HEDTD         UDT1              2 0
     C                   MOVE      HEDTM         UDT2              2 0
     C                   MOVE      HEDTÅ         UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          UDT1B
     C                   MOVE      UDT2          UDT2B
     C                   MOVE      UDT3          UDT3B
     C*
     C                   ENDSR
     C*
     C*
     C***********************************************
     C     WRKSR         BEGSR
     C***********************************************
     C     AVDKEY        KLIST
     C                   KFLD                    KAVDG
     C                   KFLD                    FAAVD
     C     AVDKE2        KLIST
     C                   KFLD                    KAVDG
     C                   KFLD                    KOVAVD
     C     FAKTKE        KLIST
     C                   KFLD                    FAAVD
     C                   KFLD                    FAOPD
     C     HEKKKK        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C*
     C                   MOVE      UAVDF         FAAVD
     C                   MOVE      *ZEROS        FAOPD
     C*
     C     FAKTKE        SETLL     FAK4
     C     STW           TAG
     C                   READ      FAK4                                   33
     C  N33FAAVD         COMP      UAVDT                              33
     C   33              GOTO      UTW
      *
      * AVDELINGSGRUPPE
      *
     C     UAVDG         IFNE      *BLANKS
     C     AVDKEY        CHAIN     AVDGR                              34
     C   34              GOTO      STW
     C                   END
      *
      * FAKTURERINGSPART
      *
     C     FASK          IFNE      'S'
     C     FASK          ANDNE     'K'
     C     FASK          ANDNE     'X'
     C     FASK          ANDNE     'E'
     C                   GOTO      STW
     C                   END
      *
     C* HEADINGRECORD MÅ FINNES
     C     FAKTKE        CHAIN     HEADF                              44
     C   44FAKTKE        SETGT     FAK4
     C   44              GOTO      STW
      *
      * LINJER MED BELØP 0 BASERT PÅ "L"(SADLINJER) ELLER "D" SKAL IKKE
      * FØRE TIL POST PÅ PURRELISTE
      *
     C     FABELN        IFEQ      *ZEROS
     C     FA01B         IFEQ      'L'
     C     FA01B         OREQ      'D'
     C                   GOTO      STW
     C                   END
     C     FA01B         IFGE      '1'
     C     FA01B         ANDLE     '9'
     C                   GOTO      STW
     C                   END
     C                   END
      *
      * TESTER SAMLEFAKTURA
      *
     C     USAML         IFEQ      'N'
     C     FAOPKO        IFEQ      'C'
     C                   GOTO      STW
     C                   END
     C     FAKTKE        SETLL     SAML1
     C     *IN50         DOUEQ     '1'
     C     FAKTKE        READE     SAML1                                  50
     C  N50FAKUNR        IFEQ      SAKN
     C                   GOTO      STW
     C                   END
     C                   END
     C                   END
     C*
     C                   EXSR      TSTOPD
     C     FAKTKE        SETGT     FAK4
     C                   GOTO      STW
      *
      * LESER ALLE AKTUELLE AVDELINGER FOR STATUS ' ' 'E' OG 'U'
      *
     C     UTW           TAG
     C     KVKEY         KLIST
     C                   KFLD                    UNI
     C                   MOVE      'V'           UNI               1
      *
      * LESER ALLE AKTUELLE AVDELINGER
      *
     C                   SETOFF                                       33
     C     KVKEY         SETLL     KODTV
     C     *IN33         DOUEQ     '1'
     c     LESA          tag
     C     KVKEY         READE     KODTV                                  33
N06  C  N33KOVAVD        IFEQ      *ZEROS
N06  C                   GOTO      LESA
N06  C                   END
      *
      * AVDELINGSGRUPPE
      *
     C  N33UAVDG         IFNE      *BLANKS
     C     AVDKE2        CHAIN     AVDGR                              34
     C   34              GOTO      LESA
     C                   END
      *
     C  N33KOVAVD        IFGE      UAVDF
     C     KOVAVD        ANDLE     UAVDT
     C                   EXSR      HEADBL
     C                   END
     C                   END
     C                   ENDSR
     C*
     C***********************************************
     C     HEADBL        BEGSR
     C***********************************************
     C     HHHKEY        KLIST
     C                   KFLD                    KOVAVD
     C                   KFLD                    STAT              1
     C*
     C* TA MED OPPDRAG MED STATUS ' '
     C                   MOVE      ' '           STAT
     C     HHHKEY        SETLL     HEAD1
     C                   SETOFF                                       34
     C     *IN34         DOUEQ     '1'
     C     HHHKEY        READE     HEAD1                                  34
N02   *
N02   * SKAL IKKE VÆRE FAKTURA PÅ OPPDRAG VED BLANKS STATUS
N02   * (dersom FAIN finnes og IKKE tilhører COST, da er det inntektslinje / skipp oppdraget)
N02  C     *IN34         IFEQ      '0'
N02  C     HEKKKK        setll     fai4                               55
N02  C                   setoff                                       55
N02  C     *in55         doweq     '0'
N02  C     HEKKKK        reade     fai4                                   55
N02  C     *in55         ifeq      '0'
N02   * skjekk om kostnad må ikke være dette
s18  C*    FIFN          chain     kosta14                            56
s18  C*    *in56         ifeq      '1'
n18  C     fak3k         chain     fak3                               56
n18  c  N56fakda         ifne      'K'
N02  C                   goto      FAKTOK
N02  C                   endif
N02  C                   endif
N02  C                   enddo
N02  C                   END
      *
      *
      * VED BLANK SKAL DET IKKE VÆRE UFAKTURERTE FAKTURALINJER PÅ OPPDRAGET
      * HVIS DEN SKAL VÆRE MED PÅ LISTA ( ER ALLEREDE TATT )
      *
     C     HEKKKK        CHAIN     FAK4                               51
     C  N34
     CAN 51              EXSR      TSTOPD
N03  C     FAKTOK        TAG
     C                   END
      *
      * TA MED OPPDRAG MED STATUS 'U'
      *
S03  C**   FAKTOK        TAG
     C                   MOVE      'U'           STAT
     C     HHHKEY        SETLL     HEAD1                              34
     C     *IN34         DOUEQ     '1'
     C     HHHKEY        READE     HEAD1                                  34
     C  N34              EXSR      TSTOPD
     C                   END
      *
      * TA MED OPPDRAG MED STATUS 'E'
      *
     C                   MOVE      'E'           STAT
     C     HHHKEY        SETLL     HEAD1                              34
     C     *IN34         DOUEQ     '1'
     C     HHHKEY        READE     HEAD1                                  34
     C  N34              EXSR      TSTOPD
     C                   END
      *
     C                   ENDSR
     C*
     C***********************************************
     C     TSTOPD        BEGSR
     C***********************************************
      *
      * krysset av for ikke fakturering begge veier
      *
N08  C     HEKDFS        ifeq      'X'
N08  C     HEKDFK        andeq     'X'
N08  C                   goto      uttst
N08  c                   end
N05   *
      *
      * ta med dupp nei
      *
N08  C     UDUPP         ifeq      'N'
N08  C     TRSLAG        ifeq      'FF'
N08  C     TRSLAG        oreq      'VF'
N08  C                   goto      uttst
N08  c                   end
N08  c                   end
N05   *
N05   * TESTER avdeling
N05   *
N05  C     WSAV01        IFNE      *ZEROS
N05  C     HEAVD         LOOKUP    AV                                     33
N10  C     IUAVD         IFEQ      'I'
N05  c  n33              goto      uttst
N10  C                   ELSE
N10  C   33              GOTO      UTTST
N10  C                   END
N05  c                   end
N05   *
N05   * TESTER DELSYSTEM
N05   *
N05  C     UDELS1        IFNE      *BLANKS
N05  C     UDELS1        IFEQ      HEUR
N05  C                   GOTO      OKDELS
N05  C                   END
N05  C     UDELS2        IFEQ      HEUR
N05  C                   GOTO      OKDELS
N05  C                   END
N05  C     UDELS3        IFEQ      HEUR
N05  C                   GOTO      OKDELS
N05  C                   END
N05  C                   GOTO      UTTST
N05  C                   END
N05  C     OKDELS        TAG
      *
      * TESTER SIGNATUR
      *
     C     USIGN         IFNE      *BLANKS
     C     USIGN         ANDNE     HESG
     C                   GOTO      UTTST
     C                   END
      * finnes det eSped oversjø booking-oppdragstyper som skal utelates
     c     BookOTY       ifne      *blanks
     C     HEOT          scan      BookOTY                                33
     C     *IN33         cabeq     '1'           UTTST
     c                   end
N16  c                   exsr      persr
N16  C     UPEFRA        IFNE      *zeros
N16  c     TSTPER        ANDLT     UPEFRA
N16  C                   goto      UTTST
N16  c                   end
      *
N16  C     UPETIL        IFNE      *zeros
N16  c     TSTPER        ANDGT     UPETIL
N16  C                   goto      UTTST
N16  c                   end
N16   *
      * FIKSER DATO HVIS 0
      *
     C     HEDTOP        IFEQ      *ZEROS
     C                   MOVE      HEDTR         HEDTOP
     C                   END
      *
      * TESTER DATOBEGREP
      * DERSOM DATO GITT - TA MED DE MED DATO TIL OG MED...
      *
     C     UDT           IFEQ      0
     C     HEDTOP        ORLE      UDT8
      *
      * KOPIERINGSMAL - TRANSPORTOPPDRAG/NEGATIVT FORTEGN - IKKE MED
      *
     C     HEOPD         IFGT      *ZEROS
     C     HEKKKK        CHAIN     WRKHE1                             35
     C   35              WRITE     WRKHER
     C                   END
     C                   END
     C     UTTST         ENDSR
     C*
N16   ************************************************************************
N16  c     persr         begsr
N16   ************************************************************************
N16   * tester periodebegrep
N16  C                   select
N16  C     HEUR          wheneq    'H'
N16  c     hepro         andne     0
n16  c     hepro         chain     turer14                            33
N16  C  N33TURMND        ifne      *zeros
N16  C                   MOVE      TURAAR        TSTAAR
N16  C                   MOVE      TURMND        TSTMND
N16  C                   end
N16   * PRIO.3. "OPPDRAGETS PERIODE" (=PERIODE FRA 1. FAKTURA PÅ OPPD.)
N16  C     HEDTMP        whenne    *ZEROS
N16  C                   MOVE      HEDTMP        TSTMND
N16  C                   MOVE      HEDTÅP        TSTAAR
N16  C                   other
N16   * PRIO.4. PERIODE UTFRA OPPDRAGSDATO
N16  C                   MOVE      HEDTM         TSTMND
N16  C                   MOVE      HEDTÅ         TSTAAR
N16  C                   endsl
N16  c                   endsr
      *
N17   ************************************************************************
N17  c     PRTKOST       BEGSR
N17   ************************************************************************
N17   * a) budsjett-poster
N17  c                   eval      KType ='Bud.:'
N17  c     Kosbu9K       setll     KOSBU9
N17  c     Kosbu9K       reade     KOSBU9
N17  c                   dow       not %eof(KOSBU9)
N17  c                   if        BUBL <> *zeros
N17  c                   eval      BILNR  = BUBNR
N17  c                   eval      LNAVN  = *blanks
N17  c     LevKey        chain     LEVEL01
N17  c                   eval      KVK    = BUVK
N17  c                   eval      BILTXT = BUTXT
N17  c                   eval      KVAL   = BUVAL
N17  c                   eval      KBL    = BUBL * -1
N17  c                   write     DETALJK
N17  C                   ADD       1             XLN
N17  C     XLN           IFGT      XOVERF
N17  C                   Z-ADD     10            XLN
N17  C   77              WRITE     HEADER
N17  C                   ADD       1             ANTH
N17  C                   END
N17  c                   endif
N17  c     Kosbu9K       reade     KOSBU9
N17  c                   enddo
N17  c*
N17   * b) BURDE ta med åpne bilag som har linjer mot oppdraget (men ennå ikke F-meldt/overført)
     c                   eval      KType ='Op.C:'
N17   * c) førte poster
     c                   if        HEOPD = 155100
     c                   move      'c'           dummy             1
     c                   endif
     c                   eval      KType ='Cost:'
N17  c     HEAKEY        setll     FAKT
N17  c     HEAKEY        reade     FAKT
N17  c                   dow       not %eof(FAKT)
N17  c                   if        FAKDA = 'K'
N17  c                             and FABELN <> 0
N17  c                   eval      BILNR  = FAFAKT
N17  c                   eval      LNAVN  = FAVT
N17  c                   eval      KVK    = FAVK
N17  c                   eval      BILTXT = *BLANKS
N17  c                   eval      KVAL   = FICURR
N17  c                   eval      KBL    = FABELN
N17  c                   write     DETALJK
N17  C                   ADD       1             XLN
N17  C     XLN           IFGT      XOVERF
N17  C                   Z-ADD     10            XLN
N17  C   77              WRITE     HEADER
N17  C                   ADD       1             ANTH
N17  C                   END
N17  c                   endif
N17  c     HEAKEY        reade     FAKT
N17  c                   enddo
N17  c                   ENDSR
